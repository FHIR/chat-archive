---
layout: page
title: "FHIR Chat  · Poor fhirpath in EOB-inst-careTeam constraints · CARIN IG for Blue Button®"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/index.html">CARIN IG for Blue Button®</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html">Poor fhirpath in EOB-inst-careTeam constraints</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="209690847"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209690847" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209690847">(Sep 10 2020 at 18:42)</a>:</h4>
<p>I tried upgrading our server to the latest draft of this IG and its mostly working.<br>
One thing I noticed is that the FHIRPath expressions for the <code>EOB-inst-careTeam-practitioner</code> and <code>EOB-inst-careTeam-organization</code> are rather broken.<br>
Is there an existing tracker that covers this?</p>



<a name="209709545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209709545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209709545">(Sep 10 2020 at 21:09)</a>:</h4>
<p>from the latest draft they are:<br>
EOB-inst-careTeam-practitioner: <code>( careTeam.role.coding.code in ('attending' or 'primary' or 'referring' or 'supervising')) implies careTeam.provider.reference.resolve().is(FHIR.Practitioner)</code><br>
and<br>
EOB-inst-careTeam-organization: <code>( careTeam.role.coding.code='performing') implies careTeam.provider.reference.resolve().is(FHIR.Organization)</code></p>



<a name="209709559"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209709559" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209709559">(Sep 10 2020 at 21:09)</a>:</h4>
<p>each of these is broken in various ways</p>



<a name="209709912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209709912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209709912">(Sep 10 2020 at 21:12)</a>:</h4>
<p>In either case, it ignores the cardinality of the elements.  For repeating fields, these simple paths return a collection and then these expressions are using those collections with operators that only work when the left-hand operand is a singleton</p>



<a name="209710251"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209710251" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209710251">(Sep 10 2020 at 21:15)</a>:</h4>
<p>Additionally, the invariants are declared on the <code>ExplanationOfBenefit.careTeam</code> element.  In our server at least, this is the context of the evaluation.  So they should not include <code>careTeam.</code> in the expressions...they should either be moved to become top-level constraints (on the ExplanationOfBenefit element) or the paths should omit the <code>careTeam</code> part.</p>



<a name="209710329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209710329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209710329">(Sep 10 2020 at 21:16)</a>:</h4>
<p>Finally, in the case of <code>EOB-inst-careTeam-practitioner</code>, the <code>in ('attending' or 'primary' or 'referring' or 'supervising')</code> is not right...I think that should be a union of literals rather than logical ors</p>



<a name="209710387"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209710387" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209710387">(Sep 10 2020 at 21:16)</a>:</h4>
<p>putting those things together, I tried my hand to "fix" these and came up with the following</p>



<a name="209710476"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209710476" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209710476">(Sep 10 2020 at 21:17)</a>:</h4>
<ol>
<li>I added a lot of <code>.where(criteria).exists()</code> stuff</li>
<li>I moved them to be top-level</li>
<li>I used union instead of or</li>
</ol>



<a name="209710622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209710622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209710622">(Sep 10 2020 at 21:18)</a>:</h4>
<p>EOB-inst-careTeam-practitioner: </p>
<div class="codehilite"><pre><span></span><code>careTeam.where(role.where(coding.where(code in (&#39;attending&#39; | &#39;primary&#39; | &#39;referring&#39; | &#39;supervising&#39;)).exists()).exists()).exists() implies
careTeam.where(role.where(coding.where(code in (&#39;attending&#39; | &#39;primary&#39; | &#39;referring&#39; | &#39;supervising&#39;)).exists()).exists()).provider.all(resolve() is Practitioner)
</code></pre></div>



<a name="209710696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209710696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Lamb <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209710696">(Sep 10 2020 at 21:19)</a>:</h4>
<p><span class="user-mention" data-user-id="192132">@Amol Vyas</span> <span class="user-mention" data-user-id="215604">@Saul Kravitz</span> FYI</p>



<a name="209710699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209710699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209710699">(Sep 10 2020 at 21:19)</a>:</h4>
<p>EOB-inst-careTeam-organization: </p>
<div class="codehilite"><pre><span></span><code>careTeam.where(role.where(coding.where(code=&#39;performing&#39;).exists()).exists()).exists() implies
careTeam.where(role.where(coding.where(code=&#39;performing&#39;).exists()).exists()).provider.all(resolve() is Organization)
</code></pre></div>



<a name="209711505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/209711505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#209711505">(Sep 10 2020 at 21:25)</a>:</h4>
<p>THX!</p>



<a name="210021763"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/210021763" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#210021763">(Sep 14 2020 at 15:27)</a>:</h4>
<p>I opened <a href="http://jira.hl7.org/browse/FHIR-28530">FHIR#28530</a> to track this issue</p>



<a name="210262541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/210262541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#210262541">(Sep 16 2020 at 13:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191676">@Lee Surprenant</span>  Doesn't this imply the need for similar rewrites of the other EOB careteam invariants?</p>



<a name="210271433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/210271433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#210271433">(Sep 16 2020 at 14:40)</a>:</h4>
<p>Certainly possible, have a link handy?</p>



<a name="210271791"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/210271791" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#210271791">(Sep 16 2020 at 14:42)</a>:</h4>
<p>I hit the above constraint issue because it was preventing us from validating some of the sample data.  I certainly didn't do an extensive review of all constraints in the spec.</p>



<a name="210291288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/210291288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#210291288">(Sep 16 2020 at 17:05)</a>:</h4>
<p>In <a href="https://github.com/saulakravitz/carin-bb/tree/v0.1.4/fsh">https://github.com/saulakravitz/carin-bb/tree/v0.1.4/fsh</a>, I included your suggestions for the institutional careteam practitioner/organization, and I updated the facility profiles as you suggested so the invariant is on the profile, and not on the careteam field.   I've made no other changes.</p>



<a name="210294449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/210294449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#210294449">(Sep 16 2020 at 17:29)</a>:</h4>
<p>ok, is that version published somewhere?  if so, i'm happy to have a look.  i did have one other issue we hit that i've been meaning to write up...</p>



<a name="210295708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/204607-CARIN%20IG%20for%20Blue%20Button%C2%AE/topic/Poor%20fhirpath%20in%20EOB-inst-careTeam%20constraints/near/210295708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/204607-CARIN-IG-for-Blue-Button/topic/Poor.20fhirpath.20in.20EOB-inst-careTeam.20constraints.html#210295708">(Sep 16 2020 at 17:40)</a>:</h4>
<p>ok, i found it, starting a new thread for it</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
