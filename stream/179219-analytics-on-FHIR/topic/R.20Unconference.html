---
layout: page
title: "FHIR Chat  · R Unconference · analytics on FHIR"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/index.html">analytics on FHIR</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html">R Unconference</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153916201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916201">(Oct 26 2017 at 04:45)</a>:</h4>
<p>I am at the Australian R Unconference today, working on the R client for FHIR</p>



<a name="153916202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916202">(Oct 26 2017 at 04:45)</a>:</h4>
<p>It was written by <span class="user-mention" data-user-id="194597">@Sander Laverman</span> - thanks.</p>



<a name="153916203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916203">(Oct 26 2017 at 04:45)</a>:</h4>
<p>I've beefed it up and I know it pretty well now</p>



<a name="153916204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916204">(Oct 26 2017 at 04:46)</a>:</h4>
<p>I've just reviewed it with one of the leads for R for Australia, and the clear message is that it's basically useless without methods for restructuring the data to make it square</p>



<a name="153916205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916205">(Oct 26 2017 at 04:47)</a>:</h4>
<p>restructuring the data.... needs some new ideas....</p>



<a name="153916206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916206">(Oct 26 2017 at 04:48)</a>:</h4>
<p>I'm wondering about beefing up graphQL to allow for flattening, or exploring some OData conversion specification...</p>



<a name="153916260"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916260" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916260">(Oct 26 2017 at 11:10)</a>:</h4>
<p>I followed this:</p>



<a name="153916261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916261">(Oct 26 2017 at 11:10)</a>:</h4>
<p><a href="https://github.com/graphcool/framework/issues/268" target="_blank" title="https://github.com/graphcool/framework/issues/268">https://github.com/graphcool/framework/issues/268</a></p>



<a name="153916344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916344">(Oct 26 2017 at 22:17)</a>:</h4>
<p>Data Reorganization Directives</p>
<p>GraphQL is a very effectively language for navigating a graph and selecting subset of information from it. However for some uses, the physical structure of the result set is important. This is most relevant when extracting data for statistical analysis in languages such as R. In order to facilitate these kind of uses, FHIR servers should consider supporting the following directives that allow implementers to flatten the return graph for easier analysis</p>
<p>@flatten</p>
<p>This directive indicates the the field to which it is attached is not actually produced in the output graph. Instead, it's children will be processed and added to the output graph as specified in it's place. </p>
<p>Notes:<br>
If @flatten is used on an element with repeating cardinality, then by default, all the children will become lists<br>
When using @flatten, all the collated children must have the same FHIR type. The server SHALL return an error if they don't</p>
<p>@singleton</p>
<p>This directive indicates that an field collates to a single node, not a list. It is only used in association with fields on which a parent has @flatten, and overrides the impact of flattening in making it a list. The server SHALL return an error if there is more than on value when flattening</p>
<p>@first</p>
<p>This is a shortcut for a FHIR path filter [$index = 0] and indicates to only take the first match of the elements. Note that this only applies to the immediate context of the field in the source graph, not to the output graph</p>
<p>@slice(fhirpath)</p>
<p>This indicates that in the output graph, each element in the source will have "." and the result of the FHIRPath as a string appended to the specified name. This slices a list up into multiple single values. For example</p>
<p>name @slice($index) @flatten {given @first @singleton family}</p>
<p>For a resource that has 2 names will result in the output </p>
<p>{<br>
  "Given.1" : "first name, first given",<br>
  "Family.1" : "first name family name",<br>
  "Given.2" : "second name, first given",<br>
  "Family.2" : "second name family name"<br>
}</p>
<p>Other uses might be e.g. Telecom @slice(use) to generate telecom.home for instance.</p>
<p>Notes:<br>
In general, the intent of @slice is to break a list into multiple singletons. However servers do not treat the outputs are singletons unless this is explicitly specified using @singleton</p>



<a name="153916380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/153916380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#153916380">(Oct 27 2017 at 08:35)</a>:</h4>
<p><a href="http://www.healthintersections.com.au/?p=2740" target="_blank" title="http://www.healthintersections.com.au/?p=2740">http://www.healthintersections.com.au/?p=2740</a> - for anyone interested in graphQL or data analysis</p>



<a name="246610155"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/246610155" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Master <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#246610155">(Jul 20 2021 at 15:51)</a>:</h4>
<p>I am having a hard time wrapping my head around how the flatten directive is not breaking the GraphQL official specification. It takes it from a "get what you ask for" to "ask and see what you get" kind of shift. Doesn't returning fields not requested break the GraphQL specification? And then what about returning fields that are not part of the schema? That would definitely break spec. And this adds even more logistical problems considering even the basic example:</p>
<div class="codehilite"><pre><span></span><code>For an example, take this graphQL, and apply it to the patient example:

{
  identifier { system value }
  active
  name { text given family }
}
This will give the output:

{
  &quot;identifier&quot;: [{
      &quot;system&quot;: &quot;urn:oid:1.2.36.146.595.217.0.1&quot;,
      &quot;value&quot;: &quot;12345&quot;
  }],
  &quot;active&quot;: true,
  &quot;name&quot;: [{
    &quot;given&quot;: [&quot;Peter&quot;,&quot;James&quot;],
    &quot;family&quot;: &quot;Chalmers&quot;
  },{
    &quot;given&quot;: [&quot;Jim&quot;]
  },{
    &quot;given&quot;: [&quot;Peter&quot;,&quot;James&quot;],
    &quot;family&quot;: &quot;Windsor&quot;
  }]
}
Adding the @flatten directive changes the output:

{
  identifier @flatten { system value }
  active
  name @flatten { text given family }
}
This has the output:

{
  &quot;system&quot;:[&quot;urn:oid:1.2.36.146.595.217.0.1&quot;],
  &quot;value&quot;:[&quot;12345&quot;],
  &quot;active&quot;:true,
  &quot;given&quot;:[&quot;Peter&quot;,&quot;James&quot;,&quot;Jim&quot;,&quot;Peter&quot;,&quot;James&quot;],
  &quot;family&quot;:[&quot;Chalmers&quot;,&quot;Windsor&quot;]
}
</code></pre></div>
<p>I understand that by using @first as exemplified we can remove the second given name for each patient allowing the response to be better understood as 3 patients instead of 5, but what about the family name? We see two family names and no null field for the missing value. I would expect the example response to be: <code>["Chalmers",null,"Windsor"]</code> since the second patient did not have a family name. Without having a null value though, the data becomes ambiguous very quickly and I don't see much good out of the flatten directive if it is even supported anywhere?</p>
<p><a href="https://github.com/Asymmetrik/graphql-fhir">https://github.com/Asymmetrik/graphql-fhir</a> seems like the biggest open source project for supporting GraphQL on a Node.js server and it does not support the flatten directive still.</p>
<p>I see this spec is still in a draft and has been for quite some time. Is there any consensus to using GraphQL for FHIR or is this a lost cause? I think it is needed as data is becoming more graph like and would be great if we could see FHIR implementations on services like Dgraph or Neo4j. I'm still a newb so maybe they exist, I just haven't found them yet.</p>



<a name="247937534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/247937534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Hellwig <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#247937534">(Aug 02 2021 at 16:14)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="427852">@Anthony Master</span>  couple of thoughts that might help:<br>
Your example patient is actually 1 patient. "Windsor" is his maiden name (see original fhir resource in github).<br>
This shows a problem of the suggested "flatten" directive which seems to lose too much meta information. I wouldn't understand why this was required at all, maybe this was an R thing. Now, as there is the FHIR bulk data api, there shouldn't be an issue with loading data into neo4j for analytics with a little bit of schema config.</p>



<a name="249674588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/249674588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#249674588">(Aug 17 2021 at 03:15)</a>:</h4>
<p>ok it's a fair comment that @flatten and @singleton are problematic with regard to schema.</p>



<a name="249674652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/249674652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#249674652">(Aug 17 2021 at 03:16)</a>:</h4>
<p>And maybe that will mean that they can't be supported, though my implementation does. it's just such a useful thing for a client to save them walking through deep json structures. It's definitely really useful in R, which is orientated towards processing square json structures, but it's useful for any client that is going to process the json returned.</p>



<a name="249674674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/249674674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#249674674">(Aug 17 2021 at 03:18)</a>:</h4>
<p>but your example output looks wrong to me, and would certainly not be preocessible. It's not the same as in the spec.</p>



<a name="249674712"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/249674712" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#249674712">(Aug 17 2021 at 03:18)</a>:</h4>
<p><span class="user-mention" data-user-id="427852">@Anthony Master</span></p>



<a name="249723860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179219-analytics%20on%20FHIR/topic/R%20Unconference/near/249723860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Master <a href="https://fhir.github.io/chat-archive/stream/179219-analytics-on-FHIR/topic/R.20Unconference.html#249723860">(Aug 17 2021 at 14:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179219-analytics-on.20FHIR/topic/R.20Unconference/near/249674588">said</a>:</p>
<blockquote>
<p>ok it's a fair comment that @flatten and @singleton are problematic with regard to schema.</p>
</blockquote>
<p>Thank you for the reply. I have accepted a position as an Interface Specialist and start tomorrow. I was mainly just trying to get the lay of the land a little bit and see where things stood. Implementing GraphQL directives seems to be a big grey area with what they are allowed and not allowed to do in regards to the GraphQL specification. I recently had a similar discussion about implementing a directive from another service provider and there was mixed feedback as to what the spec actually means concerning directives. I have a lot of GraphQL, MySQL, JavaScript experience, no experience with R and obviously a rookie with HL7 (both 2.x and FHIR). Looking forward to the challenges ahead.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
