---
layout: page
title: "FHIR Chat  · enable-when · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html">enable-when</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="170671914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170671914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170671914">(Jul 11 2019 at 20:57)</a>:</h4>
<p>Consider this questionnaire, from the validator test cases:</p>



<a name="170671918"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170671918" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170671918">(Jul 11 2019 at 20:57)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;Questionnaire</span> <span class="na">xmlns=</span><span class="s">&quot;http://hl7.org/fhir&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">value=</span><span class="s">&quot;questionnaire-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;language</span> <span class="na">value=</span><span class="s">&quot;en-US&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;text&gt;</span>
    <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;generated&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">lang=</span><span class="s">&quot;en-US&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>enableWhen test<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/text&gt;</span>
  <span class="nt">&lt;url</span> <span class="na">value=</span><span class="s">&quot;http://hl7.org/fhir/us/hai/Questionnaire/questionnaire-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;draft&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;repeats</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;boolean&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;required</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;repeats</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;enable-when&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;enable when condition true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;boolean&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;enableWhen&gt;</span>
        <span class="nt">&lt;question</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;operator</span> <span class="na">value=</span><span class="s">&quot;=&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;answerBoolean</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/enableWhen&gt;</span>
      <span class="nt">&lt;required</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;repeats</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/Questionnaire&gt;</span>
</pre></div>



<a name="170671996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170671996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170671996">(Jul 11 2019 at 20:58)</a>:</h4>
<p>what does it mean to have a question that is required, but also has an enable-when on it? What is expected in the QR when the enable-when condition is false?</p>



<a name="170672015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170672015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170672015">(Jul 11 2019 at 20:58)</a>:</h4>
<p>Seems to me that this should be an illegal combination - a question with a required=true can't have an enable-when</p>



<a name="170672050"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170672050" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170672050">(Jul 11 2019 at 20:59)</a>:</h4>
<p>Note that the questionnaire validation is all screwed up, which is why I'm looking at this....</p>



<a name="170672622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170672622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170672622">(Jul 11 2019 at 21:06)</a>:</h4>
<p>Yes, seems there should be an invariant forbidding enable-when in combination with required=true.</p>
<p>And also leads to the question: how would one express "must be filled when enabled"?</p>



<a name="170672932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170672932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170672932">(Jul 11 2019 at 21:10)</a>:</h4>
<p>So maybe just the definition of the "required" element should be widened to "... if used in combination with enabledWhen, the item shall only be present when the enabling condition resolves to true"?</p>



<a name="170673103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170673103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170673103">(Jul 11 2019 at 21:12)</a>:</h4>
<p>ah, already specified:</p>
<blockquote>
<p>This element is a modifier because if enableWhen is present for an item, "required" is ignored unless one of the enableWhen conditions is met</p>
</blockquote>



<a name="170673119"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170673119" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170673119">(Jul 11 2019 at 21:12)</a>:</h4>
<p>buried in the middle of the comments</p>



<a name="170673156"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170673156" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170673156">(Jul 11 2019 at 21:13)</a>:</h4>
<p>given that definition, then, this QR should generate 2 errors:</p>



<a name="170673161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170673161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170673161">(Jul 11 2019 at 21:13)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;QuestionnaireResponse</span> <span class="na">xmlns=</span><span class="s">&quot;http://hl7.org/fhir&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">value=</span><span class="s">&quot;questionnaireResponse-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;text&gt;</span>
    <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;generated&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">lang=</span><span class="s">&quot;en-US&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>enableWhen test response<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/text&gt;</span>
  <span class="nt">&lt;questionnaire</span> <span class="na">value=</span><span class="s">&quot;http://hl7.org/fhir/us/hai/Questionnaire/questionnaire-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;completed&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- group 0: spacer --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;enable-when&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;enable when condition true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- group 1: condition true, present (valid) --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;enable-when&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;enable when condition true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- group 2: condition false, present (invalid) --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;enable-when&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;enable when condition true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- group 3: condition true, absent (invalid) --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- group 4: condition false, absent (valie) --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/QuestionnaireResponse&gt;</span>
</pre></div>



<a name="170673168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170673168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170673168">(Jul 11 2019 at 21:14)</a>:</h4>
<p>let me know if any disagrees</p>



<a name="170673305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170673305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170673305">(Jul 11 2019 at 21:15)</a>:</h4>
<p>agreed.</p>



<a name="170677210"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170677210" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170677210">(Jul 11 2019 at 22:09)</a>:</h4>
<p>I have some more questions about enableWhen. The enable-when clause of a question cannot depend on the answer of a question that is an item inside the question, right?</p>



<a name="170677250"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170677250" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170677250">(Jul 11 2019 at 22:09)</a>:</h4>
<p>nor does it make sense for the answer to come from another heirarchy than the one the question is in?</p>



<a name="170677301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170677301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170677301">(Jul 11 2019 at 22:10)</a>:</h4>
<p>and it doesn't really make sense for the question it depends on to come after the question either, right?</p>



<a name="170677349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170677349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170677349">(Jul 11 2019 at 22:11)</a>:</h4>
<p>the first would be an error on the definition, and the third would be a warning on the definition?</p>



<a name="170699947"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170699947" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170699947">(Jul 12 2019 at 07:04)</a>:</h4>
<p>There may be cases where the second actually exists, especially when you try to represent forms that have been designed for paper in a 1:1 manner. This may not be a good idea, but it happens all the time.<br>
So that would be warning (or no issue) for being out of hierarchy.</p>



<a name="170722411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170722411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170722411">(Jul 12 2019 at 13:37)</a>:</h4>
<p>Value can definitely come from outside the hierarchy. Lots of preceding sections to produce a formula for eligibility the enable when met those conditions.</p>



<a name="170722432"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170722432" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170722432">(Jul 12 2019 at 13:37)</a>:</h4>
<p>All the rest seems good.</p>



<a name="170722562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170722562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170722562">(Jul 12 2019 at 13:38)</a>:</h4>
<p>I'm doing validation improvements in our R4 server at the moment too. Expecting updates to my test server next week.</p>



<a name="170723893"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170723893" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170723893">(Jul 12 2019 at 13:56)</a>:</h4>
<p>I realize Grahame's question was about enableWhen, but we also have enableWhenExpression (described <a href="http://hl7.org/fhir/uv/sdc/2019May/expressions.html" target="_blank" title="http://hl7.org/fhir/uv/sdc/2019May/expressions.html">here</a>, though the link is broken) which can depend on anything anywhere in the questionnaire or response.  So, I am not sure we should care too much about what enableWhen depends on.</p>



<a name="170756177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170756177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170756177">(Jul 12 2019 at 21:15)</a>:</h4>
<blockquote>
<p>Value can definitely come from outside the hierarchy</p>
</blockquote>
<p>So that can get pretty complex. Given that the question being answered is at a node in the tree of answers, you find the relevant answer for checking the value by working up the tree looking for any relevant question with a matching linkId. You stop when you find any match.</p>
<p>Do you collect all the answers at the same level, or only the first?</p>



<a name="170756265"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170756265" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170756265">(Jul 12 2019 at 21:16)</a>:</h4>
<blockquote>
<p>I am not sure we should care too much about what enableWhen depends on.</p>
</blockquote>
<p>Whether you use enableWhenExpression, or just simple enableWhen, it's unresolvable if the enabling of a question depends on it's own answer (or a child answer)</p>



<a name="170760831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170760831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170760831">(Jul 12 2019 at 22:41)</a>:</h4>
<p>I don't know about stopping at the first, it's all with that linkId (same question yes, but multiple answers - repeats and groups)</p>



<a name="170762958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170762958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170762958">(Jul 12 2019 at 23:26)</a>:</h4>
<p>you have to stop somewhere. Check out this Q /QR combination:</p>



<a name="170763044"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170763044" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170763044">(Jul 12 2019 at 23:29)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;Questionnaire</span> <span class="na">xmlns=</span><span class="s">&quot;http://hl7.org/fhir&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">value=</span><span class="s">&quot;questionnaire-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;language</span> <span class="na">value=</span><span class="s">&quot;en-US&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;text&gt;</span>
    <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;generated&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">lang=</span><span class="s">&quot;en-US&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>enableWhen test<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/text&gt;</span>
  <span class="nt">&lt;url</span> <span class="na">value=</span><span class="s">&quot;http://hl7.org/fhir/us/hai/Questionnaire/questionnaire-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;draft&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;repeats</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;boolean&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;required</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;repeats</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;enable-when&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;enable when condition true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;boolean&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;enableWhen&gt;</span>
        <span class="nt">&lt;question</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;operator</span> <span class="na">value=</span><span class="s">&quot;=&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;answerBoolean</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/enableWhen&gt;</span>
      <span class="nt">&lt;required</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;repeats</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/Questionnaire&gt;</span>
</pre></div>



<a name="170763045"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170763045" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170763045">(Jul 12 2019 at 23:29)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;QuestionnaireResponse</span> <span class="na">xmlns=</span><span class="s">&quot;http://hl7.org/fhir&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">value=</span><span class="s">&quot;questionnaireResponse-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;text&gt;</span>
    <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;generated&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">lang=</span><span class="s">&quot;en-US&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>enableWhen test response<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/text&gt;</span>
  <span class="nt">&lt;questionnaire</span> <span class="na">value=</span><span class="s">&quot;http://hl7.org/fhir/us/hai/Questionnaire/questionnaire-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;completed&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- group 0: spacer --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
<span class="c">&lt;!--    &lt;item&gt;</span>
<span class="c">      &lt;linkId value=&quot;enable-when&quot; /&gt;</span>
<span class="c">      &lt;text value=&quot;enable when condition true&quot; /&gt;</span>
<span class="c">      &lt;answer&gt;</span>
<span class="c">        &lt;valueBoolean value=&quot;false&quot; /&gt;</span>
<span class="c">      &lt;/answer&gt;</span>
<span class="c">    &lt;/item&gt; --&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- group 1: condition true, present (valid) --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;enable-when&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;enable when condition true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- group 2: condition false, present (invalid) --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;enable-when&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;enable when condition true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- group 3: condition true, absent (invalid) --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- group 4: condition false, absent (valid) --&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;group&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item&gt;</span>
      <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;answer&gt;</span>
        <span class="nt">&lt;valueBoolean</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/answer&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/QuestionnaireResponse&gt;</span>
</pre></div>



<a name="170763046"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170763046" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170763046">(Jul 12 2019 at 23:29)</a>:</h4>
<p>the condition only applies within the group. If you want conditions to apply outside the group, either that questionnaire is illegal - and it shouldn't be, or we need some consistent algorithm to determine how the applicable answer for a condition is resolved.</p>



<a name="170765999"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170765999" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170765999">(Jul 13 2019 at 00:42)</a>:</h4>
<p>actually, there's only one possible algorithm that can work:<br>
- given <code>sourceQ</code> - question that contains the enableWhen reference and <code>targetQ</code> - question that the enableWhen references in the Q<br>
- and also <code>sourceA</code> - answer for <code>sourceQ</code> and <code>targetA</code> -  answer for <code>targetQ</code> in the QR<br>
- work up from <code>sourceQ</code> until you find the Q group that also contains <code>targetQ</code> - this is <code>groupQ</code><br>
- work up from <code>sourceA</code> until you find the QR group that matches <code>groupQ</code> - this is <code>groupA</code><br>
- any <code>targetA</code> in <code>groupA</code> are input for the enableWhen decision</p>



<a name="170766213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170766213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170766213">(Jul 13 2019 at 00:47)</a>:</h4>
<p>I'm writing the validator that way.</p>



<a name="170766449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170766449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170766449">(Jul 13 2019 at 00:53)</a>:</h4>
<p>groupQ and groupA may be the base</p>



<a name="170815729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170815729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170815729">(Jul 14 2019 at 03:09)</a>:</h4>
<p>Enable When can depend on any preceding item.  It isn't currently prohibited from depending on following nodes, but have no issue adding such a prohibition</p>



<a name="170879690"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170879690" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170879690">(Jul 15 2019 at 10:13)</a>:</h4>
<p>no prohibition - just a warning</p>



<a name="170899334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170899334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170899334">(Jul 15 2019 at 14:43)</a>:</h4>
<p>Would it be an error if an ancestor could be disabled by descendants?</p>



<a name="170902793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170902793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170902793">(Jul 15 2019 at 15:20)</a>:</h4>
<blockquote>
<p>Whether you use enableWhenExpression, or just simple enableWhen, it's unresolvable if the enabling of a question depends on it's own answer (or a child answer)</p>
</blockquote>
<p>I agree that having the enabled status of a question depend on itself or a child element is undesirable.   It would be like having an HTML &amp; JavaScript page where there was a checkbox that disabled if you checked it.  It is perfectly valid to make such a page, though.</p>
<p>From LHC-Forms's perspective, the expressions are black boxes into which the Questionnaire and QuesitonnaireResponse are dumped (along with the context node) and there is no telling what parts of those resources will get utilized.  (All processing is handled by fhirpath.js).  I don't see how it would be possible in our case to even provide a warning to the user.</p>
<p>When enabledWhen, it should be possible to provide a warning.</p>



<a name="170902884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170902884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170902884">(Jul 15 2019 at 15:21)</a>:</h4>
<blockquote>
<p>I'm writing the validator that way.</p>
</blockquote>
<p>Are you writing it while <a href="#narrow/stream/179160-social/topic/Where.E2.80.99s.20Grahame/near/170877989" title="#narrow/stream/179160-social/topic/Where.E2.80.99s.20Grahame/near/170877989">kayaking past crocodiles</a>?</p>



<a name="170903262"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170903262" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170903262">(Jul 15 2019 at 15:25)</a>:</h4>
<p>The problem with disabling an element based on child questions is that there's no mechanism to re-enable it.  Is there a reason why we should allow something that we can't think of a real use-case for and which is likely to create grief?</p>



<a name="170903802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170903802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170903802">(Jul 15 2019 at 15:30)</a>:</h4>
<p>My point is that was that we can't always catch those cases, so why complicate things?  An HTML form does not worry about things like that, and it just adds more lines the to the spec.  But, one could argue that we should put up the guard rails where we can; I don't have a strong opinion about it.</p>



<a name="170906201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170906201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170906201">(Jul 15 2019 at 15:56)</a>:</h4>
<p>Saying it's not legal is not the same as saying "implementations must detect illegal behavior".</p>



<a name="170935480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/170935480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#170935480">(Jul 15 2019 at 21:58)</a>:</h4>
<p>right. Validator calls it an error.</p>



<a name="173237975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173237975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sheridan Cook <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173237975">(Aug 14 2019 at 20:16)</a>:</h4>
<p>I'm hitting an error when I try to validate a Questionnaire resource, that includes enableWhen boolean logic, using the <a href="http://test.fhir.org/r4" target="_blank" title="http://test.fhir.org/r4">test.fhir.org/r4</a>  server. </p>
<ul>
<li>
<p>que-7 rule states that if an operator is 'exists", the value must be a boolean (Expression: operator = 'exists' implies (answer is Boolean)).   </p>
</li>
<li>
<p>I believe this invariant rule is the reason I get a conformance error of: "Concept not found (next char = \"t\", in \"true\") at character 1"...when I include the following in the example I'm validating:</p>
</li>
</ul>
<div class="codehilite"><pre><span></span>      &quot;enableWhen&quot;: [
        {
          &quot;question&quot; : &quot;H4/Q5&quot;,
          &quot;operator&quot; : &quot;exists&quot;,
          &quot;answerBoolean&quot;:  true
        }
      ],
      &quot;enableBehavior&quot;: &quot;all&quot;,
</pre></div>


<ul>
<li>The only way I've found around that error is to change the operator or remove answerBoolean entirely (other answer types can pass without problem).  </li>
<li>If I remove answerBoolean entirely I receive an error reminding me that  enableWhen.answer[x] has a cardinality of 1..1. </li>
</ul>
<p>I feel like this is a catch-22 but I'm assuming it's user error on my part.  Is there another way that I should be formating enableWhen.answer under the specific circumstances where the boolean value of a previous question determines whether the later question should be displayed to the user?</p>



<a name="173240318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173240318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173240318">(Aug 14 2019 at 20:41)</a>:</h4>
<p>how are you validating?</p>



<a name="173293516"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173293516" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sheridan Cook <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173293516">(Aug 15 2019 at 14:10)</a>:</h4>
<blockquote>
<p>how are you validating?</p>
</blockquote>
<p>Hi Grahame, I'm copy/pasting the full json Questionnaire resource into the text box on the server UI and selecting the operation: Validation.</p>
<p>When I click upload I receive the following error:   </p>
<p>{<br>
  "resourceType" : "OperationOutcome",<br>
  "text" : {<br>
    "status" : "generated",<br>
    "div" : "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;p&gt;Concept not found (next char = \"t\", in \"true\") at character 1&lt;/p&gt;&lt;/div&gt;"<br>
  },<br>
  "issue" : [<br>
    {<br>
      "severity" : "error",<br>
      "code" : "not-supported",<br>
      "details" : {<br>
        "text" : "Concept not found (next char = \"t\", in \"true\") at character 1"<br>
      },<br>
      "diagnostics" : "(00000000008873B0){FHIRServer.exe} [0000000000C883B0] Unknown function at TMethodImplementationIntercept + $7E37E0\r\n(00000000040DB242){FHIRServer.exe} [00000000044DC242] Unknown function at TMethodImplementationIntercept + $4037672\r\n(00000000040DD0F0){FHIRServer.exe} [00000000044DE0F0] Unknown function at TMethodImplementationIntercept + $4039520\r\n(0000000000049157){FHIRServer.exe} [000000000044A157] Unknown function at __dbk_fcall_wrapper + $2C0F7\r\n(0000000000049A5B){FHIRServer.exe} [000000000044AA5B] Unknown function at __dbk_fcall_wrapper + $2C9FB\r\n(0000000000011576){FHIRServer.exe} [0000000000412576]\r\n(00000000000115C1){FHIRServer.exe} [00000000004125C1]\r\n(00000000008873B0){FHIRServer.exe} [0000000000C883B0] Unknown function at TMethodImplementationIntercept + $7E37E0\r\n(0000000000886AD0){FHIRServer.exe} [0000000000C87AD0] Unknown function at TMethodImplementationIntercept + $7E2F00\r\n(00000000008863AE){FHIRServer.exe} [0000000000C873AE] Unknown function at TMethodImplementationIntercept + $7E27DE\r\n(0000000000886F9F){FHIRServer.exe} [0000000000C87F9F] Unknown function at TMethodImplementationIntercept + $7E33CF\r\n(00000000008BA28E){FHIRServer.exe} [0000000000CBB28E] Unknown function at TMethodImplementationIntercept + $8166BE\r\n(00000000008B88E7){FHIRServer.exe} [0000000000CB98E7] Unknown function at TMethodImplementationIntercept + $814D17\r\n(000000000085F13F){FHIRServer.exe} [0000000000C6013F] Unknown function at TMethodImplementationIntercept + $7BB56F\r\n(000000000085C89A){FHIRServer.exe} [0000000000C5D89A] Unknown function at TMethodImplementationIntercept + $7B8CCA\r\n(000000000085D3FF){FHIRServer.exe} [0000000000C5E3FF] Unknown function at TMethodImplementationIntercept + $7B982F\r\n(0000000000A7774C){FHIRServer.exe} [0000000000E7874C] Unknown function at TMethodImplementationIntercept + $9D3B7C\r\n(0000000003B195C9){FHIRServer.exe} [0000000003F1A5C9] Unknown function at TMethodImplementationIntercept + $3A759F9\r\n(00000000034795C2){FHIRServer.exe} [000000000387A5C2] Unknown function at TMethodImplementationIntercept + $33D59F2\r\n(00000000034780C9){FHIRServer.exe} [00000000038790C9] Unknown function at TMethodImplementationIntercept + $33D44F9\r\n(0000000003471DD4){FHIRServer.exe} [0000000003872DD4] Unknown function at TMethodImplementationIntercept + $33CE204\r\n(00000000034724B5){FHIRServer.exe} [00000000038734B5] Unknown function at TMethodImplementationIntercept + $33CE8E5\r\n(00000000034724B5){FHIRServer.exe} [00000000038734B5] Unknown function at TMethodImplementationIntercept + $33CE8E5\r\n(00000000034724B5){FHIRServer.exe} [00000000038734B5] Unknown function at TMethodImplementationIntercept + $33CE8E5\r\n(000000000346C2FC){FHIRServer.exe} [000000000386D2FC] Unknown function at TMethodImplementationIntercept + $33C872C\r\n(000000000346BCB2){FHIRServer.exe} [000000000386CCB2] Unknown function at TMethodImplementationIntercept + $33C80E2\r\n(000000000346B261){FHIRServer.exe} [000000000386C261] Unknown function at TMethodImplementationIntercept + $33C7691\r\n(000000000347CB6F){FHIRServer.exe} [000000000387DB6F] Unknown function at TMethodImplementationIntercept + $33D8F9F\r\n(000000000347CECE){FHIRServer.exe} [000000000387DECE] Unknown function at TMethodImplementationIntercept + $33D92FE\r\n(00000000038F66FF){FHIRServer.exe} [0000000003CF76FF] Unknown function at TMethodImplementationIntercept + $3852B2F\r\n(0000000000B34AD5){FHIRServer.exe} [0000000000F35AD5] Unknown function at TMethodImplementationIntercept + $A90F05\r\n(0000000003F01CC1){FHIRServer.exe} [0000000004302CC1] Unknown function at TMethodImplementationIntercept + $3E5E0F1\r\n(0000000003EF8C25){FHIRServer.exe} [00000000042F9C25] Unknown function at TMethodImplementationIntercept + $3E55055\r\n(0000000003EF5317){FHIRServer.exe} [00000000042F6317] Unknown function at TMethodImplementationIntercept + $3E51747\r\n(0000000003F13DED){FHIRServer.exe} [0000000004314DED] Unknown function at TMethodImplementationIntercept + $3E7021D\r\n(0000000000647F29){FHIRServer.exe} [0000000000A48F29] Unknown function at TMethodImplementationIntercept + $5A4359\r\n(000000000064989E){FHIRServer.exe} [0000000000A4A89E] Unknown function at TMethodImplementationIntercept + $5A5CCE\r\n(00000000005688F9){FHIRServer.exe} [00000000009698F9] Unknown function at TMethodImplementationIntercept + $4C4D29\r\n(000000000056690A){FHIRServer.exe} [000000000096790A] Unknown function at TMethodImplementationIntercept + $4C2D3A\r\n(000000000056A8BB){FHIRServer.exe} [000000000096B8BB] Unknown function at TMethodImplementationIntercept + $4C6CEB\r\n(0000000000569B6B){FHIRServer.exe} [000000000096AB6B] Unknown function at TMethodImplementationIntercept + $4C5F9B\r\n(000000000012E883){FHIRServer.exe} [000000000052F883] Unknown function at TMethodImplementationIntercept + $8ACB3\r\n(000000000001216D){FHIRServer.exe} [000000000041316D]\r\n(00000000000074D4){KERNEL32.DLL} [00007FFF7A6984D4] BaseThreadInitThunk + $14\r\n(000000000006D851){ntdll.dll   } [00007FFF7B50E851] RtlUserThreadStart + $21\r\n"<br>
    }<br>
  ]<br>
}</p>



<a name="173313778"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173313778" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173313778">(Aug 15 2019 at 18:45)</a>:</h4>
<p>have you got an example of a full questionnaire?</p>



<a name="173314912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173314912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sheridan Cook <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173314912">(Aug 15 2019 at 18:58)</a>:</h4>
<blockquote>
<p>have you got an example of a full questionnaire?</p>
</blockquote>
<p>Sure! <a href="/user_uploads/10155/idxqN_c2H60PC_79K0QsvEjD/QuestionnaireExample1.json" target="_blank" title="QuestionnaireExample1.json">QuestionnaireExample1.json</a> is the one I'm trying to validate currently. I've removed all the answerBooleans except the one found on line 871 to make troubleshooting easier. <br>
<a href="/user_uploads/10155/CtEYbjJzA7k7TEzWOKdu5Axj/QuestionnaireExample2.json" target="_blank" title="QuestionnaireExample2.json">QuestionnaireExample2.json</a> is an example I pulled off the R4 FHIR server (id: "bb") that shares the enableWhen.answerBoolean format that Example 1 has. Both fail validation with the same error noted above.</p>



<a name="173562597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173562597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173562597">(Aug 19 2019 at 17:33)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="222582">@Sheridan Cook</span> Just checking if this got resolved or not.</p>



<a name="173564357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173564357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sheridan Cook <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173564357">(Aug 19 2019 at 17:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> not resolved yet. My solution for now is removing the answerBoolean from the test message to continue validation on other parts of the message,  I'd like to know if that is the correct way of addressing that invariant or if the profile on the R4 profile needs to be modified.</p>



<a name="173623230"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173623230" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173623230">(Aug 20 2019 at 02:12)</a>:</h4>
<p>I <em>think</em> the invariant is correct.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> ?</p>



<a name="173632906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/enable-when/near/173632906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/enable-when.html#173632906">(Aug 20 2019 at 06:39)</a>:</h4>
<p>it's still on my todo list...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
