---
layout: page
title: "FHIR Chat  · fhirpath expression · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html">fhirpath expression</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="265026386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265026386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julia <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265026386">(Dec 15 2021 at 15:32)</a>:</h4>
<p>Looking for help in constructing a fhirpath expression.<br>
Given the following structure (where answer and answerOption are children of item, and there can be hundreds of items):</p>
<p>-item<br>
---answerOption<br>
-----display (Yes)<br>
-----decimalValue (1)<br>
-----display (No)<br>
-----decimalValue (2)<br>
---providedAnswer<br>
-----display (Yes)</p>
<p>Need to get, for any providedAnswer, the decimal value from the answerOption.  Eg, in above example, answer is Yes, therefore decimalValue = 1.<br>
What would be the fhirpath expression? <br>
(using <a href="https://hl7.github.io/fhirpath.js/">https://hl7.github.io/fhirpath.js/</a> for testing)</p>
<p>Thank you in advance.</p>



<a name="265052694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265052694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265052694">(Dec 15 2021 at 18:22)</a>:</h4>
<p>The per-spec answer would probably be <code>%resource.answers().value.ordinal()</code>. I believe answers() and ordinal() is not widely implemented yet. You can play with it at <a href="http://legentix.com/faiabench/#/">http://legentix.com/faiabench/#/</a> by copying a Questionnaire into the left-middle text box, deleting the QuestionnaireResponse in the left bottom field, answering some questions in the middle, hitting the flame symbol on the right and then entering a FHIRPath expression.<br>
<a href="/user_uploads/10155/Guz_ubSOlKMmFh7goATxizLh/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/Guz_ubSOlKMmFh7goATxizLh/image.png" title="image.png"><img src="/user_uploads/10155/Guz_ubSOlKMmFh7goATxizLh/image.png"></a></div>



<a name="265060586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265060586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julia <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265060586">(Dec 15 2021 at 19:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="192169">Tilo Christ</span> <a href="#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265052694">said</a>:</p>
<blockquote>
<p>The per-spec answer would probably be <code>%resource.answers().value.ordinal()</code>. I believe answers() and ordinal() is not widely implemented yet. You can play with it at <a href="http://legentix.com/faiabench/#/">http://legentix.com/faiabench/#/</a> by copying a Questionnaire into the left-middle text box, deleting the QuestionnaireResponse in the left bottom field, answering some questions in the middle, hitting the flame symbol on the right and then entering a FHIRPath expression.<br>
<a href="/user_uploads/10155/Guz_ubSOlKMmFh7goATxizLh/image.png">image.png</a></p>
</blockquote>
<p>So for the above JSON, the entire expression would look like this?  item.providedAnswer.where(%resource.item.answerOption().value.ordinal())</p>



<a name="265063037"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265063037" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265063037">(Dec 15 2021 at 19:36)</a>:</h4>
<p>maybe I'm a bit confused what I'm looking at in your example. I thought it was the QuestionnaireResponse? Is this a piece of Questionnaire or QuestionnaireResponse? What is "providedAnswer" meant to be? answerOption would live in the Questionnaire, but provided answers are part of the response.</p>



<a name="265065895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265065895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julia <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265065895">(Dec 15 2021 at 19:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="192169">Tilo Christ</span> <a href="#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265063037">said</a>:</p>
<blockquote>
<p>maybe I'm a bit confused what I'm looking at in your example. I thought it was the QuestionnaireResponse? Is this a piece of Questionnaire or QuestionnaireResponse? What is "providedAnswer" meant to be? answerOption would live in the Questionnaire, but provided answers are part of the response.</p>
</blockquote>
<p>Yes, that is right.  I need to fetch something from questionnaire.answerOption, based on questionnaireResponse.answer value</p>



<a name="265066291"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265066291" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265066291">(Dec 15 2021 at 19:57)</a>:</h4>
<p>Not necessarily. If that numerical value is handled as an ordinalValue then it gets passed through into the response and you can pick up everything from the response.</p>



<a name="265099952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265099952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265099952">(Dec 16 2021 at 01:06)</a>:</h4>
<p><span class="user-mention" data-user-id="427598">@Julia</span> See <a href="https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/phq9.json">https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/phq9.json</a> for an example of a PHQ-9, which has a total score calculation that selects the ordinalValue value based on the answer from the QuestionnaireResponse.  You can also find the same form in this app: <a href="https://lhcforms.nlm.nih.gov/sdc">https://lhcforms.nlm.nih.gov/sdc</a>, in the "Featured" list on the left after picking a patient.</p>



<a name="265140097"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265140097" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265140097">(Dec 16 2021 at 11:07)</a>:</h4>
<p>It's amazing to see how much the complexity of this shrinks once answers() and ordinal() becomes widely available: <a href="https://github.com/tiloc/faiadashu/blob/main/example/assets/instruments/phq9_instrument.json">https://github.com/tiloc/faiadashu/blob/main/example/assets/instruments/phq9_instrument.json</a></p>



<a name="265161017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265161017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julia <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265161017">(Dec 16 2021 at 14:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="195344">Paul Lynch</span> <a href="#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265099952">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="427598">Julia</span> See <a href="https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/phq9.json">https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/phq9.json</a> for an example of a PHQ-9, which has a total score calculation that selects the ordinalValue value based on the answer from the QuestionnaireResponse.  You can also find the same form in this app: <a href="https://lhcforms.nlm.nih.gov/sdc">https://lhcforms.nlm.nih.gov/sdc</a>, in the "Featured" list on the left after picking a patient.</p>
</blockquote>
<p>Thank you so much!  This is exactly what I was looking for.</p>



<a name="265161157"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265161157" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julia <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265161157">(Dec 16 2021 at 14:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="192169">Tilo Christ</span> <a href="#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265066291">said</a>:</p>
<blockquote>
<p>Not necessarily. If that numerical value is handled as an ordinalValue then it gets passed through into the response and you can pick up everything from the response.</p>
</blockquote>
<p>Thank you very much! This is an interesting approach that I will try out.</p>



<a name="265208104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265208104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265208104">(Dec 16 2021 at 19:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="192169">Tilo Christ</span> <a href="#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265140097">said</a>:</p>
<blockquote>
<p>It's amazing to see how much the complexity of this shrinks once answers() and ordinal() becomes widely available: <a href="https://github.com/tiloc/faiadashu/blob/main/example/assets/instruments/phq9_instrument.json">https://github.com/tiloc/faiadashu/blob/main/example/assets/instruments/phq9_instrument.json</a></p>
</blockquote>
<p>That is definitely a lot simpler.  For anyone else looking for where those functions are defined, see:  <a href="https://build.fhir.org/ig/HL7/sdc/expressions.html#fhirpath">https://build.fhir.org/ig/HL7/sdc/expressions.html#fhirpath</a>, and also the tracker items  <a href="https://jira.hl7.org/browse/FHIR-28173">https://jira.hl7.org/browse/FHIR-28173</a> and <a href="https://jira.hl7.org/browse/FHIR-33539">https://jira.hl7.org/browse/FHIR-33539</a></p>



<a name="265245940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/fhirpath%20expression/near/265245940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/fhirpath.20expression.html#265245940">(Dec 17 2021 at 02:13)</a>:</h4>
<p>I have a great scoring demo resource<br>
<a href="https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/abbey-pain-scale/_history/5?_format=html">https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/abbey-pain-scale/_history/5?_format=html</a><br>
This one uses the ordinal too.<br>
Mind you I used the extension rather than the shortcut method.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
