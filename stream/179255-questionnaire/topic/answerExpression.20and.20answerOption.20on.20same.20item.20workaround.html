---
layout: page
title: "FHIR Chat  · answerExpression and answerOption on same item workaround · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html">answerExpression and answerOption on same item workaround</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="266903407"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/266903407" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#266903407">(Jan 05 2022 at 06:53)</a>:</h4>
<p>For many of our choice questions, we want:</p>
<p>If possible, populate the answer for the user using the answer from the parent questionnaire response<br>
If the answer from the parent questionnaire response is not available, then show a list of choices in a dropdown for the user to select from</p>
<p>This seems to be extremely difficult .</p>
<p>I can't populate the answer using the value from the parent questionnaire response with answerExpression  and use answerOption to set the dropdown values because I can't have both answerExpression  and answerOption on the same item.</p>
<p>If I try to populate the answer using initialExpression, it doesn't seem to work when the question type is choice. </p>
<p>If I change the question type to string, then I can't use the answerOption.</p>
<p>Workaround is to use a  choice question type   then a  conditional fhirpath expression    in the answerExpression   so that if the answer in the parent questionnaire response exists()  then populate with it, otherwise, show the contained valueset to the user.</p>
<p>Now I have a new problem where our HAPI server not liking the contained valueset (issue raised in HAPI stream).</p>
<p>Are there any other suggestions to accomplish what we need?</p>
<p>Also, in some of the FHIR validators, I am getting error messages about loading a contained valueset, but never actually "using" it.  I guess calling it conditionally in the  answerExpression doesn't count as actually using the contained resource.  So, is this going to end up being a problem for the IG?</p>



<a name="266917398"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/266917398" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#266917398">(Jan 05 2022 at 10:10)</a>:</h4>
<p>I'm not sure what you mean by a "parent" response?<br>
But at least initialExpression on a choice type is specified and should work, see this example from <span class="user-mention" data-user-id="195344">@Paul Lynch</span> 's collection: <a href="https://github.com/lhncbc/lforms/blob/master/test/data/R4/questionnaire-initialx.json">https://github.com/lhncbc/lforms/blob/master/test/data/R4/questionnaire-initialx.json</a></p>



<a name="266942738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/266942738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#266942738">(Jan 05 2022 at 14:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="237340">Diane</span> <a href="#narrow/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround/near/266903407">said</a>:</p>
<blockquote>
<p>For many of our choice questions, we want:</p>
<p>If possible, populate the answer for the user using the answer from the parent questionnaire response<br>
If the answer from the parent questionnaire response is not available, then show a list of choices in a dropdown for the user to select from</p>
</blockquote>
<p>That sounds like a combination of initialExpression (for the answer) and answerExpression (for the answer list).</p>
<p><span class="user-mention silent" data-user-id="237340">Diane</span> <a href="#narrow/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround/near/266903407">said</a>:</p>
<blockquote>
<p>I can't populate the answer using the value from the parent questionnaire response with answerExpression</p>
</blockquote>
<p>answerExpression does not populate an answer, but the answer list (answer options).  Perhaps It would be less confusing if it were called answerOptionExpression.</p>
<p><span class="user-mention silent" data-user-id="237340">Diane</span> <a href="#narrow/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround/near/266903407">said</a>:</p>
<blockquote>
<p>Also, in some of the FHIR validators, I am getting error messages about loading a contained valueset, but never actually "using" it.  I guess calling it conditionally in the  answerExpression doesn't count as actually using the contained resource.  So, is this going to end up being a problem for the IG?</p>
</blockquote>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> ?</p>



<a name="266976358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/266976358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#266976358">(Jan 05 2022 at 19:03)</a>:</h4>
<p>Agree w/ Paul - you use initialExpression for population, never answerExpression.  answerExpression is used to populate the list of dropdown options and is mutually exclusive w/ answerOption.</p>
<p>The current invariant in R4 around use of contained resources can detect us in expressions, so in SDC we introduced an extension to accommodate - <a href="https://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-referencesContained.html">https://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-referencesContained.html</a>.  You can see some examples of its use in the CI build.</p>



<a name="267032075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/267032075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#267032075">(Jan 06 2022 at 07:16)</a>:</h4>
<p>I agree that answerExpression  is designed for the list of dropdown options.   In the SDC IG,  it is clearly explained "An expression (FHIRPath, CQL or FHIR Query) that resolves to a list of permitted answers for the question item or that establishes context for a group item. The user may select from among the list to choose answers for the question.".      But, I have been unsuccessful at getting initialExpression to populate when the item type is choice or open-choice.    Instead,  I end up having to use answerExpression   to do the population of the value (and not the permitted answers).   I have never understood why I have to do this workaround.    </p>
<p>Mostly likely, it is something that I am doing wrong.   So, I have now emailed a file to <span class="user-mention" data-user-id="195344">@Paul Lynch</span>    to see if he can see what I am doing wrong.</p>
<p>If I don't have to do the workaround of using answerExpression to populate the initialValue,  then maybe I will have the ability to utilize initialExpression (for the answer) and answerExpression (for the answer list), which would solve many of my problems.</p>



<a name="267032442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/267032442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#267032442">(Jan 06 2022 at 07:24)</a>:</h4>
<p>referencesContained is a great extension to accomodate conditionally used contained resources.  In case anyone needs a link to one of the examples Lloyd has mentioned, see <a href="https://build.fhir.org/ig/HL7/sdc/examples.html#using-answervalueset-with-expressions">https://build.fhir.org/ig/HL7/sdc/examples.html#using-answervalueset-with-expressions</a>.</p>



<a name="267069058"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/267069058" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#267069058">(Jan 06 2022 at 14:52)</a>:</h4>
<p>Replied to <span class="user-mention" data-user-id="237340">@Diane</span>  via email.</p>



<a name="267111045"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/267111045" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#267111045">(Jan 06 2022 at 20:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="195344">Paul Lynch</span>  has found and explained the issue to me.   Thank you!</p>
<p>You can definitely use initialExpression to do the population of a value when the item type is choice or open-choice.</p>
<p>Posting a summary here in case anyone searches fhir chat in the future with this problem.</p>
<p>When you are populating a choice (or open-choice) item type, the value from initialExpression must be a <strong>Coding</strong>.</p>
<p>Examples of fhirpath syntax for the expression:</p>
<p><code>%questionnaire.item.where(linkId = 'Q1.6').answer.value </code></p>
<p>or</p>
<p><code>%questionnaire.item.where(linkId = 'Q1.6').answer.valueCoding</code></p>
<p>What does not work is:</p>
<p><code>%questionnaire.item.where(linkId = 'Q1.6').answer.value.display</code></p>
<p>This does not work either:</p>
<p><code>%questionnaire.item.where(linkId = 'Q1.6').answer.value.code</code></p>
<p>Another important requirement  (wasn't an issue for me but might cause issues for someone else so including it here):</p>
<p>the answer populated must match one of the items in the list (for choice item type)</p>



<a name="267233392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20and%20answerOption%20on%20same%20item%20workaround/near/267233392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20and.20answerOption.20on.20same.20item.20workaround.html#267233392">(Jan 07 2022 at 19:41)</a>:</h4>
<p>Those should work too, as the type can be either choosing, or string</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
