---
layout: page
title: "FHIR Chat  · contained value set validation fails · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html">contained value set validation fails</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="236341047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236341047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236341047">(Apr 27 2021 at 13:57)</a>:</h4>
<p>Hello!<br>
I was trying to follow the questionnaire example here <a href="https://www.hl7.org/fhir/questionnaire-example-gcs.json.html">https://www.hl7.org/fhir/questionnaire-example-gcs.json.html</a> because it defines "contained Value Sets". This is exactly what I need.<br>
Unfortunately if I try to validate an example response against this questionnaire, it fails with the errors:<br>
<code>ValueSet #verbal not found by validator</code><br>
<code>ValueSet #motor not found by validator</code><br>
<code>ValueSet #eye not found by validator</code></p>
<p>Here is the example response I tried to validate:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;QuestionnaireResponse&quot;,
    &quot;questionnaire&quot;: &quot;http://hl7.org/fhir/Questionnaire/gcs&quot;,
    &quot;status&quot;: &quot;completed&quot;,
    &quot;subject&quot;: {
        &quot;reference&quot;: &quot;Patient/some-id&quot;
    },
    &quot;authored&quot;: &quot;2021-04-27T13:56:24.307Z&quot;,
    &quot;item&quot;: [
        {
            &quot;linkId&quot;: &quot;1.1&quot;,
            &quot;answer&quot;: [
                {
                    &quot;valueCoding&quot;: {
                        &quot;system&quot;: &quot;http://loinc.org&quot;,
                        &quot;code&quot;: &quot;LA6557-8&quot;
                    }
                }
            ]
        },
        {
            &quot;linkId&quot;: &quot;1.2&quot;,
            &quot;answer&quot;: [
                {
                    &quot;valueCoding&quot;: {
                        &quot;system&quot;: &quot;http://loinc.org&quot;,
                        &quot;code&quot;: &quot;LA6563-6&quot;
                    }
                }
            ]
        },
        {
            &quot;linkId&quot;: &quot;1.3&quot;,
            &quot;answer&quot;: [
                {
                    &quot;valueCoding&quot;: {
                        &quot;system&quot;: &quot;http://loinc.org&quot;,
                        &quot;code&quot;: &quot;LA6556-0&quot;
                    }
                }
            ]
        }
    ]
}
</code></pre></div>
<p>What is wrong here?</p>



<a name="236342394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236342394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236342394">(Apr 27 2021 at 14:05)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="236343094"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236343094" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236343094">(Apr 27 2021 at 14:09)</a>:</h4>
<p>I have seen smt. similar but slightly different using the validation code in HAPI (5.2. and 5.3, didn't try earlier versions): if one specifies a value set for a Questionnaire answer and make it a contained resource in the Questionnaire, the code in the QuestionnaireResponse are not checked against it (codes not in value set do not generate errors).  I suppose the difference to the case above could be that HAPI only classifies the inability to find the  contained value set as a warning, not an error.</p>



<a name="236344114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236344114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236344114">(Apr 27 2021 at 14:15)</a>:</h4>
<p>I'm using HAPI (Smile CDR) as well and tested Validation using <code>{{fhir-base-url}}/QuestionnaireResponse/$validate</code> with the above example request-body.<br>
<span class="user-mention" data-user-id="194703">@Morten Ernebjerg</span> Do I understand you correctly, that you think HAPI isn't capable of validation contained Value-Sets and therefore returns a warning?<br>
This would not be so great, because this would mean I cannot use this approach without loosing validation for correct answers.</p>



<a name="236344344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236344344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236344344">(Apr 27 2021 at 14:16)</a>:</h4>
<p>A workaround would be to use answer-options <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="236346218"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236346218" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236346218">(Apr 27 2021 at 14:27)</a>:</h4>
<p>It <em>should</em> be capable.</p>



<a name="236346585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236346585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236346585">(Apr 27 2021 at 14:29)</a>:</h4>
<p>What I know is that the attached Questionnaire/QuestionnaireResponse pair (see below) does not cause a validation error in HAPI 5.2. and 5.3, though it should (I have a test that checks for this behavior so I will at least know if it starts working in later HAPI versions <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> ). It works if the value sets are loaded separately, so that is what I do in my case (could, perhaps also be done on-the-fly).</p>
<p>I also asked about it in the HAPI stream (see <a href="#narrow/stream/179167-hapi/topic/Validation.20does.20not.20find.20contained.20ValueSet">this thread</a>), but didn't get an answer and forgot about it again.</p>
<ul>
<li><a href="/user_uploads/10155/VpYgL8lqA0qUXqZuSCAzbumI/test-questionnaire-r4.Questionnaire.json">Questionnaire with contained value set</a> </li>
<li><a href="/user_uploads/10155/sBn-CEn1mZQybuyIFxYyT0Fr/test-questionnaire-response-valid-r4.QuestionnaireResponse.json">QuestionnaireResponse with answer code not in required value set</a></li>
</ul>



<a name="236347271"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236347271" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236347271">(Apr 27 2021 at 14:32)</a>:</h4>
<p>Good to know. I will follow this thread.</p>
<p>Any ideas from HAPI Power-Users? <span class="user-mention" data-user-id="191451">@Patrick Werner</span> :)</p>



<a name="236348140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236348140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236348140">(Apr 27 2021 at 14:36)</a>:</h4>
<p>we had a year ago an issue that contained valuesets get dropped when they were not referenced from the questionnaire itself in hapi, could that be the issue you have? see this <a href="#narrow/stream/179255-questionnaire/topic/Using.20answerOption.2EvalueReference">discussion</a></p>



<a name="236355874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236355874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236355874">(Apr 27 2021 at 15:12)</a>:</h4>
<p>Thank you <span class="user-mention" data-user-id="191478">@Oliver Egger</span> for this share. This looked like a not-to-bad workaround. Unfortunately this didn't work for me either. Still the same error message.<br>
Just to be clear: I used the extension only for the <code>Questionnaire</code> definition, not within the Response, correct?</p>



<a name="236430144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236430144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236430144">(Apr 28 2021 at 00:09)</a>:</h4>
<p>how do you get this error?</p>



<a name="236430162"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236430162" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236430162">(Apr 28 2021 at 00:09)</a>:</h4>
<p>e.g. what is the full validator output?</p>



<a name="236452133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236452133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236452133">(Apr 28 2021 at 05:17)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <br>
I'm using the build in validator of HAPI (SmileCDR) which is executed when doing a POST request to this endpoint <code>{{fhir-base-url}}/QuestionnaireResponse/$validate</code></p>
<p>The full response body looks like this (removed other warnings for clarity):</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
    &quot;issue&quot;: [
        {
            &quot;severity&quot;: &quot;warning&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;ValueSet #verbal not found by validator&quot;,
            &quot;location&quot;: [
                &quot;QuestionnaireResponse.item[0].answer[0]&quot;,
                &quot;Line 16, Col 54&quot;
            ]
        },
        {
            &quot;severity&quot;: &quot;warning&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;ValueSet #motor not found by validator&quot;,
            &quot;location&quot;: [
                &quot;QuestionnaireResponse.item[0].answer[0]&quot;,
                &quot;Line 27, Col 54&quot;
            ]
        },
        {
            &quot;severity&quot;: &quot;warning&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;ValueSet #eye not found by validator&quot;,
            &quot;location&quot;: [
                &quot;QuestionnaireResponse.item[0].answer[0]&quot;,
                &quot;Line 38, Col 54&quot;
            ]
        }
    ]
}
</code></pre></div>



<a name="236612262"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236612262" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236612262">(Apr 29 2021 at 03:07)</a>:</h4>
<p>then you need to ask on the HAPI stream; this works as expected on the command line validator, so it has to do with how the validator is hosted in HAPI</p>



<a name="236628571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/contained%20value%20set%20validation%20fails/near/236628571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/contained.20value.20set.20validation.20fails.html#236628571">(Apr 29 2021 at 07:06)</a>:</h4>
<p>Yes, <span class="user-mention" data-user-id="194703">@Morten Ernebjerg</span> already linked to <a href="#narrow/stream/179167-hapi/topic/Validation.20does.20not.20find.20contained.20ValueSet">this HAPI thread</a> (see above).</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
