---
layout: page
title: "FHIR Chat  · Where to store those logic to determine conditional required · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html">Where to store those logic to determine conditional required</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="256280521"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256280521" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SAM TSAI <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256280521">(Oct 05 2021 at 16:54)</a>:</h4>
<p>Q1: Do you want to receive text notification ? (Yes /No)<br>
Q2: What is your mobile phone number ? </p>
<p>Q2 will become required if Q1's answer is 'Yes'</p>
<p>How to put this kind of logic into Questionnaire ?</p>



<a name="256288800"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256288800" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256288800">(Oct 05 2021 at 17:49)</a>:</h4>
<p>The <a href="http://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-behave.html">SDC</a> implementation guide covers defining constraints using the questionnaire-constraint extension as well as making 'required' expression-based via cqf-expression</p>



<a name="256376844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256376844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256376844">(Oct 06 2021 at 08:36)</a>:</h4>
<p>In my server you just mark q2 as mandatory, and put an enablewhen to activate it only when the answer is yes.</p>



<a name="256376957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256376957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256376957">(Oct 06 2021 at 08:38)</a>:</h4>
<p>Alternatively as Lloyd points out, but it's the constraint expression.<br>
<a href="http://hl7.org/fhir/R4/extension-questionnaire-constraint.html">http://hl7.org/fhir/R4/extension-questionnaire-constraint.html</a></p>



<a name="256385307"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256385307" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ilya Beda <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256385307">(Oct 06 2021 at 09:56)</a>:</h4>
<p><span class="user-mention" data-user-id="427327">@SAM TSAI</span> I have created a sample for your case.<br>
Please check it here <a href="https://sdc.beda.software/#/simple-conditional-question">https://sdc.beda.software/#/simple-conditional-question</a></p>



<a name="256411030"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256411030" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256411030">(Oct 06 2021 at 13:29)</a>:</h4>
<p>Didn't think of that.  <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span>'s solution is better as it doesn't rely on extensions at all :)</p>



<a name="256421040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256421040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256421040">(Oct 06 2021 at 14:31)</a>:</h4>
<p>But I thought the original question was to make the mobile number optional when q1 is no, and mandatory when it is yes? Not to remove the entire question? BTW I was unable to find the portion of the spec that bases "required" on an expression, as mentioned by <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> in his first response.</p>



<a name="256479718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256479718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256479718">(Oct 06 2021 at 20:34)</a>:</h4>
<p>The invariant I linked above does that.<br>
(I'll throw an example together)</p>



<a name="256494060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256494060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256494060">(Oct 06 2021 at 22:22)</a>:</h4>
<p>something like this on the parent of the 2 questions</p>
<div class="codehilite"><pre><span></span><code>&lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/questionnaire-constraint&quot;&gt;
        &lt;extension url=&quot;key&quot;&gt;
            &lt;valueId value=&quot;Q2-req&quot; /&gt;
        &lt;/extension&gt;
        &lt;extension url=&quot;severity&quot;&gt;
            &lt;valueCode value=&quot;error&quot; /&gt;
        &lt;/extension&gt;
        &lt;extension url=&quot;human&quot;&gt;
            &lt;valueString value=&quot;Q2 is required when Q1 is yes&quot; /&gt;
        &lt;/extension&gt;
        &lt;extension url=&quot;expression&quot;&gt;
            &lt;valueString value=&quot;item.where(linkId=&#39;Q1&#39;).answer.value = &#39;yes&#39; implies item.where(linkId=&#39;Q2&#39;).answer.value.exists()&quot; /&gt;
        &lt;/extension&gt;
    &lt;/extension&gt;
</code></pre></div>



<a name="256611005"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256611005" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256611005">(Oct 07 2021 at 16:49)</a>:</h4>
<p>OK, I got the impression from <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>' initial response that there was a way to really affect the required flag. So it seems one can make it required dynamically, but without the visual hints (asterisk at the label etc.) that a filler might use for fields with a required attribute?</p>



<a name="256613249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256613249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256613249">(Oct 07 2021 at 17:03)</a>:</h4>
<p>You can affect the required flag:</p>
<div class="codehilite"><pre><span></span><code>&lt;required&gt;
   &lt;extension value=&quot;http://hl7.org/fhir/StructureDefinition/cqf-expression&quot;&gt;
        &lt;valueExpression&gt;
            &lt;expression value=&quot;your expression here&quot;/&gt;
        &lt;/valueExpression&gt;
    &lt;/extension&gt;
&lt;/required&gt;
</code></pre></div>



<a name="256662630"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256662630" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256662630">(Oct 07 2021 at 22:57)</a>:</h4>
<p>In my example above I forgot to add in the location field to indicate which field was in error.<br>
The cqf-expression format requires that the context be the item itself, so has to either look into it's children (not common here) or try navigating down to the item from the top, which has issues if there are repeating groups involved.<br>
Where I've done this, the invariant expression is far more concise as can put it as close as possible to the item (usually parent item) and then access to the sibbling question is far easier.</p>
<div class="codehilite"><pre><span></span><code>%response.item.where(linkId=&#39;group1&#39;).item.where(linkId=&#39;Q1&#39;).answer.value = &#39;yes&#39; implies %response.item.where(linkId=&#39;group1&#39;).item.where(linkId=&#39;Q2&#39;).answer.value.exists()
</code></pre></div>
<p>or (using the top level select to locate the common parent - which you won't be able to do if this is a repeating group)</p>
<div class="codehilite"><pre><span></span><code>%response.item.where(linkId=&#39;group1&#39;)
.select(item.where(linkId=&#39;Q1&#39;).answer.value = &#39;yes&#39; implies item.where(linkId=&#39;Q2&#39;).answer.value.exists())
</code></pre></div>
<p>vs</p>
<div class="codehilite"><pre><span></span><code>item.where(linkId=&#39;Q1&#39;).answer.value = &#39;yes&#39; implies item.where(linkId=&#39;Q2&#39;).answer.value.exists()
</code></pre></div>
<p>also that expression evaluation will process many more nodes, rather than the few actually involved.</p>



<a name="256946750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256946750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256946750">(Oct 10 2021 at 11:10)</a>:</h4>
<p>I'm currently building out my implementation of the 'constraint' extension. What is the semantics of the "severity" field? I cannot find a list of all the permitted codes, and I am not sure whether there are any differences in behaviour expected?</p>



<a name="256968049"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256968049" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256968049">(Oct 10 2021 at 16:45)</a>:</h4>
<p>Severity indicates whether it's an error, warning, information or best-practice issue if the constraint is violated.  It's supposed to have the same binding as constraint on StructureDefinition.  Can you submit a technical correction for us to fix that <span class="user-mention" data-user-id="192169">@Tilo Christ</span> ?</p>



<a name="256972024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256972024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256972024">(Oct 10 2021 at 17:46)</a>:</h4>
<p>It is bound with a required binding, you can only see that on the full structure tab in the extension.</p>



<a name="256977509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256977509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256977509">(Oct 10 2021 at 19:14)</a>:</h4>
<p>So it is.  So this is a rendering issue then.  When an extension is being defined, the binding <em>ought</em> to show up in both the differential view.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>?</p>



<a name="256980984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256980984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256980984">(Oct 10 2021 at 20:11)</a>:</h4>
<p>The description of the extension is saying the questionnaire can only be complete if the constraint is not violated. Can it still be complete if only a warning constraint is violated?</p>



<a name="256983626"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256983626" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256983626">(Oct 10 2021 at 20:51)</a>:</h4>
<p>Yes.  Though ideally the warning should be displayed an the user should confirm the warning isn't an issue before marking it as complete.</p>



<a name="256986575"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Where%20to%20store%20those%20logic%20to%20determine%20conditional%20required/near/256986575" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Where.20to.20store.20those.20logic.20to.20determine.20conditional.20required.html#256986575">(Oct 10 2021 at 21:36)</a>:</h4>
<p>Also note that if you're doing the storage side too, the invariant can be ignored if the item is in draft mode.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
