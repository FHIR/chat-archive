---
layout: page
title: "FHIR Chat  · Restrict value set based on another answer · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html">Restrict value set based on another answer</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="214534927"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214534927" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214534927">(Oct 26 2020 at 05:36)</a>:</h4>
<p>I have a questionnaire that includes questions for country and state/province.   Is there a way to restrict the listed state/provinces based on which country is selected? </p>
<p>For country, the question is a choice from the ISO 3166-1-2 valueset (2 character country codes). For state/province, the question is a choice from the ISO 3166-2 valueset (three letter province codes prefixed by the appropriate two letter country code). This should make it easy to figure out which province codes belong to which country (all province codes XX-YYY belong to country code XX), but I can't see any way to filter a valueset in the questionnaire.</p>



<a name="214537316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214537316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214537316">(Oct 26 2020 at 06:26)</a>:</h4>
<p>The first question is whether the code system actually exposes the associated country code for the state code as a property.  If it does, <em>and</em> your terminology service supports is, then you can get the property to come along in your value set expansion and have access to it and use answerExpression to adaptably define your answer set based on the answer to the country question.  I don't know that our FHIR copy of 3166-2 does that though.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> ?</p>



<a name="214640206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214640206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214640206">(Oct 26 2020 at 22:16)</a>:</h4>
<p>I think it should. Much better than having people resort to code syntax hacking</p>



<a name="214643393"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214643393" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214643393">(Oct 26 2020 at 22:59)</a>:</h4>
<p>I'm not sure 3166-2 does have these properties in ISO's definition. And I doubt the FHIR ValueSet does either. Using a terminology service and properties sounds like a very "elegant" way of solving the problem (read overly-complex), but it seems to me that simply being able to say give me codes from the specified value set that have the prefix of "code from of previous question" should be straight forward.</p>



<a name="214643717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214643717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214643717">(Oct 26 2020 at 23:02)</a>:</h4>
<p>I don't know if FHIRPath could do that, but presumably CQL could in answerExpression</p>



<a name="214643894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214643894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214643894">(Oct 26 2020 at 23:05)</a>:</h4>
<p>That would be excellent. Time to brush up on CQL.</p>



<a name="214647482"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214647482" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214647482">(Oct 27 2020 at 00:00)</a>:</h4>
<p>If you get it working, feel free to contribute it as an example to the SDC spec :)</p>



<a name="214668912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214668912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214668912">(Oct 27 2020 at 07:50)</a>:</h4>
<p>I'll take a look too. That's roughly what I was trying at the connectathon.</p>



<a name="214918394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214918394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214918394">(Oct 29 2020 at 01:52)</a>:</h4>
<p>Well, I'm stumped. Likely I'm just not seeing it because of my unfamiliarity with either FHIRPath or CQL, but I don't see anyway to manipulate the contents of a ValueSet/CodeSystem.</p>



<a name="214923517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214923517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214923517">(Oct 29 2020 at 03:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="195344">@Paul Lynch</span></p>



<a name="214958258"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Restrict%20value%20set%20based%20on%20another%20answer/near/214958258" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Restrict.20value.20set.20based.20on.20another.20answer.html#214958258">(Oct 29 2020 at 12:18)</a>:</h4>
<p>Do you have the expansion for the ValueSet?  Then you could write an answerExpression like:<br>
<code>%valuesetExp.expansion.contains.where(code.startsWith(%stateCode))</code><br>
Whether that will work depends in part on how picky your form rendering engine is, because it will return "contains" structures rather than Codings, which is what (strictly speaking) is required by the type.  But, the essential field names in the two structures are the same (plus some extra stuff), so it might not care (as in the case of our JavaScript-based <a href="http://lhncbc.github.io/lforms/">LHC-Forms</a> renderer).</p>
<p>For future plans for a more proper way of transforming "contains" to "Coding", see <a href="http://jira.hl7.org/browse/FHIR-29324">J#29324</a>.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
