---
layout: page
title: "FHIR Chat  · Variable scope · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html">Variable scope</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="213456458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213456458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213456458">(Oct 15 2020 at 17:05)</a>:</h4>
<p><a href="http://hl7.org/fhir/R4/extension-variable.html">http://hl7.org/fhir/R4/extension-variable.html</a> says, "The name of the variable will be added to FHIRPath's context when processing descendants of the element that contains this extension."  What about when processing the element (item) itself?  The LHC-Forms implementation supports calculatedExpression referencing variables defined on the same item.  I suppose that it not necessary, but it is nice to have all the expressions listed together on the same item.</p>



<a name="213457048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213457048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213457048">(Oct 15 2020 at 17:09)</a>:</h4>
<p>Yes, should add for the current node too.  Change request for us to clarify?</p>



<a name="213458727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213458727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213458727">(Oct 15 2020 at 17:22)</a>:</h4>
<p>Very good!  We will have at least one thing to vote on at today's call.  <a href="http://jira.hl7.org/browse/FHIR-29264">J#29264</a>.</p>



<a name="213459399"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213459399" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213459399">(Oct 15 2020 at 17:27)</a>:</h4>
<p>No call today</p>



<a name="213459451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213459451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213459451">(Oct 15 2020 at 17:28)</a>:</h4>
<p>(I'd already cancelled it - have a conflict)</p>



<a name="213459471"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213459471" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213459471">(Oct 15 2020 at 17:28)</a>:</h4>
<p>SHould be an easy approval item for next week though</p>



<a name="213459590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213459590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213459590">(Oct 15 2020 at 17:29)</a>:</h4>
<p>Okay-- and thanks for the reminder.</p>



<a name="213861253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213861253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213861253">(Oct 19 2020 at 23:57)</a>:</h4>
<p>Um, on the same node?<br>
Just let me assume that they wouldn't be able to see each other.</p>



<a name="213910228"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213910228" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213910228">(Oct 20 2020 at 12:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> Why not?  It already possible to construct a variable and a calculatedExpression that "see each other" on different nodes.  It seems like an unnecessary and complicating restriction to require that you can't refer to variables on the same item.  The same issue arises between variables.  If your formula is complicated, you might want to define on the same item:</p>
<div class="codehilite"><pre><span></span><code>varA = complicated expression
varB = (varA + ...)/(varA + otherVar)
</code></pre></div>


<p>You would not want to require that varA and varB be different items, which might require the introduction of a new group item into the form simply for sake of putting a variable on it.</p>



<a name="213931514"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213931514" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213931514">(Oct 20 2020 at 14:59)</a>:</h4>
<p>If you are worried about dependency loops, that possibility is warned against in section on <a href="https://build.fhir.org/ig/HL7/sdc/expressions.html#dependencies-between-expressions">expression dependencies</a>.  It is up to the Questionnaire author to avoid such situations, and rendering system is supposed to detect them and produce an error message.</p>



<a name="213932526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213932526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213932526">(Oct 20 2020 at 15:06)</a>:</h4>
<p>Variables could even refer to other variables.  The key is to make clear that order of appearance matters and to define the order in which evaluation needs to occur</p>



<a name="213933104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213933104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213933104">(Oct 20 2020 at 15:09)</a>:</h4>
<p>I had the same thought, that we should specify that, but now I am not sure the order of evaluation matters.  My understanding is you keep evaluating things until the values stabilize.</p>



<a name="213933592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213933592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213933592">(Oct 20 2020 at 15:12)</a>:</h4>
<p>From <a href="https://build.fhir.org/ig/HL7/sdc/expressions.html#dependencies-between-expressions">5.4.1</a>:  "However, in some cases, updates to later elements may trigger an update to earlier elements, which then cascade through again. Systems should allow for this and allow for iterative updating of expressions until values reach a stable state - or until an unstable looping condition is detected. "</p>



<a name="213935457"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213935457" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213935457">(Oct 20 2020 at 15:24)</a>:</h4>
<p>I'm thinking more about whether forward referencing of variables is allowed.  I.e. can you declare a variable that depends on bar, then declare bar (within the same element)?  I would think that would be somewhat hinky.  However, if no one thinks it's a problem, I'm fine with not defining any constraints.</p>



<a name="213936454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213936454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213936454">(Oct 20 2020 at 15:32)</a>:</h4>
<p>I don't know why you would write it that way, but it should not cause a problem (except maybe make it run a little slower, because it would need an extra iteration of evaluation).  Variables can depend on fields which initially do not have a value, but they have to get processed anyway.  A variable depending on another variable that doesn't have a value is handled the same way, and does not need to care whether that other variable is "defined" yet.  Of course, some implementation might keep a list of defined variables, I suppose, and then have an issues with Questionnaires that were using forward-references.  Perhaps it is better to be explicit about whether that is allowed or not.  But, if we disallow it, I would like it be worded in such a way that it does require that systems that don't care do extra error checking that is not necessary.</p>



<a name="213992430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/213992430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#213992430">(Oct 20 2020 at 23:37)</a>:</h4>
<p>My engine was evaluating the expression, putting it into the variable then permitting its use. So it couldn't use other variables not already declared, as they don't exist (yet) - not in scope.<br>
But I guess they could use ones at the same level declared before them.</p>



<a name="214084511"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/214084511" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#214084511">(Oct 21 2020 at 17:20)</a>:</h4>
<p><a href="http://jira.hl7.org/browse/FHIR-29329">J#29329</a>, "Allow variables to be in scope on their own element"</p>



<a name="257450561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/257450561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#257450561">(Oct 13 2021 at 22:44)</a>:</h4>
<p>Is there anything preventing a variable be "re-defined" on a child item?</p>



<a name="257462210"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/257462210" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#257462210">(Oct 14 2021 at 00:52)</a>:</h4>
<p>And now that I'm implementing support for this, what is the scope of a variable on a repeating group?<br>
While processing, does it contain the nodes of all items, or just the repetition that it is processing at a time (asking as this would impact aggregates)</p>



<a name="257462520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/257462520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#257462520">(Oct 14 2021 at 00:56)</a>:</h4>
<p>Not a particularly valid example, but I think it kinda shows the potential issues<br>
(wanting to have the height/weight variables on a per item basis)<br>
<a href="/user_uploads/10155/8pSpFopbQrvZ2i_3n26a_8FS/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/8pSpFopbQrvZ2i_3n26a_8FS/image.png" title="image.png"><img src="/user_uploads/10155/8pSpFopbQrvZ2i_3n26a_8FS/image.png"></a></div>



<a name="257470588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/257470588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#257470588">(Oct 14 2021 at 02:38)</a>:</h4>
<p>Also wondering if there's a way to access properties/extensions from a coding (or answerCoding) from the response (while using expressions)</p>



<a name="257471668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/257471668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#257471668">(Oct 14 2021 at 02:55)</a>:</h4>
<p>Yes.  We've said that it's an error for the name to exist multiple times within the same scope.</p>



<a name="257604968"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Variable%20scope/near/257604968" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Variable.20scope.html#257604968">(Oct 14 2021 at 20:59)</a>:</h4>
<p>Another example for the variable scope context discussion<br>
<a href="/user_uploads/10155/9no3SM2WocQT2zAvAnroOzZ_/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/9no3SM2WocQT2zAvAnroOzZ_/image.png" title="image.png"><img src="/user_uploads/10155/9no3SM2WocQT2zAvAnroOzZ_/image.png"></a></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
