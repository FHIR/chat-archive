---
layout: page
title: "FHIR Chat  · variable scope when populating in repeating groups · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html">variable scope when populating in repeating groups</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="258305537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258305537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258305537">(Oct 20 2021 at 03:05)</a>:</h4>
<p>I see that Brian Postlethwaite  has a separate thread about variable scope when populating in repeating groups.</p>
<p>I didn't want to hijack that one.  I don't know how to confine my variable to one  iteration of the group. </p>
<p>In Link ID 1.1, the user chooses between site type A or site type B.  This selection is stored in variable %siteType.</p>
<p>In Link ID 1.2, there is a answerExpression extension with iif in the value expression<br>
such as  iif(%siteType = 'A',  'X',  'Y')</p>
<p>In Link ID 1.3, there is another answerExpression extension with iif in the value expression<br>
such as iif(%siteType = 'A',  'C',  'D')"</p>
<p>In Link ID 1.4, there is another answerExpression extension with iif in the value expression<br>
such as  iif(%siteType = 'A',  'E',  'F')</p>
<p>These are the results that I want to populate:</p>
<p>Parent Link ID  1  Sites</p>
<p>Link ID 1.1      Site Type   A<br>
Link ID 1.2      X<br>
Link ID 1.3      C<br>
Link ID 1.4      E</p>
<p>Link ID 1.1      Site Type   B<br>
Link ID 1.2      Y<br>
Link ID 1.3      D<br>
Link ID 1.4      F</p>
<p>Link ID 1.1      Site Type   B<br>
Link ID 1.2      Y<br>
Link ID 1.3      D<br>
Link ID 1.4      F</p>
<p>I have tried putting the variable against the parent link ID 1, but that is obviously visible to all of the repeating groups, so every time a new site (group iteration) is added, the variable value causes the previously added sites (group iterations)  to repopulate (incorrectly).</p>
<p>I have also tried making an unneeded  group nesting and putting the variable against it like this: </p>
<p>Parent Link ID  1  Sites</p>
<p>Unneeded grouping 1.1   to store variable %siteType<br>
Link ID 1.1.1      Site Type   A<br>
Link ID 1.1.2      X<br>
Link ID 1.1.3      C<br>
Link ID 1.1.4      E</p>
<p>Unneeded grouping 1.1  to store variable %siteType<br>
Link ID 1.1.1      Site Type   B<br>
Link ID 1.1.2       Y<br>
Link ID 1.1.3      D<br>
Link ID 1.1.4      F</p>
<p>Unneeded grouping 1.1  to store variable %siteType<br>
Link ID 1.1.1      Site Type   B<br>
Link ID 1.1.2      Y<br>
Link ID 1.1.3      D<br>
Link ID 1.1.4      F</p>
<p>But, the variable still seems to be "seen" and modified by any of the group iterations.</p>
<p>How do I contain the variable scope to only the one iteration of the repeating group?  </p>
<p>Do I need to add the extension for itemPopulationContext  to Unneeded grouping 1.1?</p>



<a name="258310829"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258310829" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258310829">(Oct 20 2021 at 04:31)</a>:</h4>
<p>To clarify linkId "1" is a repeating group and declares the %siteType variable?  If so, then my belief is that the value of the %siteType value should be managed separately for each repetition of the group.  <span class="user-mention" data-user-id="195344">@Paul Lynch</span> ?</p>



<a name="258330209"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258330209" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258330209">(Oct 20 2021 at 08:25)</a>:</h4>
<p>That is how I've interpreted it too, and implementing in my renderer.</p>



<a name="258330333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258330333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258330333">(Oct 20 2021 at 08:26)</a>:</h4>
<p>The variable is only visible down the tree, not up.</p>



<a name="258369854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258369854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258369854">(Oct 20 2021 at 13:46)</a>:</h4>
<p>Yes.  linkid "1"  is the repeating group and declares the %siteType variable.     As an alternative, I also tried adding a linkid "1.1"  to declare %siteType.</p>



<a name="258370047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258370047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258370047">(Oct 20 2021 at 13:47)</a>:</h4>
<p>I agree that each repetition of a group should get its own instance of the group's variables.  I will double-check LHC-Forms' behavior.</p>



<a name="258382112"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258382112" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258382112">(Oct 20 2021 at 14:53)</a>:</h4>
<p>LHC-Forms seems to be behaving correctly.  I just created a repeating BMI panel, and and the BMI calculation for each instance is only affected by the weight &amp; height in the group instance.  <span class="user-mention" data-user-id="237340">@Diane</span> , if you will email me your Questionnaire, I will take a look and see if I can spot the problem.</p>



<a name="258399003"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258399003" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258399003">(Oct 20 2021 at 16:30)</a>:</h4>
<p>I just sent the questionnaire to <span class="user-mention" data-user-id="195344">@Paul Lynch</span></p>



<a name="258662047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/variable%20scope%20when%20populating%20in%20repeating%20groups/near/258662047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/variable.20scope.20when.20populating.20in.20repeating.20groups.html#258662047">(Oct 22 2021 at 04:44)</a>:</h4>
<p>In case anyone else is looking for the solution to this type of problem, the answer (thanks to <span class="user-mention" data-user-id="195344">@Paul Lynch</span>  is in the fhirpath.  If your fhirpath expression refers to the entire resource, such as %resource.descendants().where(linkId = '1.1'),   then the variable will keep getting updated and wiping out the previous iterations.  The fhirpath expression should be local to the instance of the group.  In my case, using item.descendants().where(linkId = '1.1')   fixed the problem.     </p>
<p>To answer my question "How do I contain the variable scope to only the one iteration of the repeating group?"   Contain your fhirpath expression to the one iteration of the repeating group.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
