---
layout: page
title: "FHIR Chat  · Problem with x-query syntax · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html">Problem with x-query syntax</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="265489900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265489900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265489900">(Dec 19 2021 at 17:15)</a>:</h4>
<p>As part of cleaning up the SDC spec, I moved the source for all of the examples from JSON to XML (so they could be validated during authoring).  In doing so, I discovered something unpleasant:<br>
<code>          &lt;url value="Condition?patient={{%patient.id}}&amp;amp;active=true"/&gt;</code><br>
fails schema validation because the schema requires the value to match xs:anyURI, and % is not allowed in a URI.  Escaping it as &#x25; doesn't make any difference - it's still considered invalid</p>
<p>Do we change the syntax to $patient.id or something like that instead?  <span class="user-mention" data-user-id="195344">@Paul Lynch</span> <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <br>
Also, Grahame, this suggests that we need to tighten our validator somehow so it yells about the same things that schema validation does.</p>



<a name="265497966"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265497966" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265497966">(Dec 19 2021 at 20:16)</a>:</h4>
<p>That's fhirpath inside the braces, so that would break more things.</p>



<a name="265502796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265502796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265502796">(Dec 19 2021 at 22:08)</a>:</h4>
<p>Potentially, yes.  So - how do we escape the FHIRPath?  Do we just use HTML escaping?</p>



<a name="265511256"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265511256" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265511256">(Dec 20 2021 at 01:09)</a>:</h4>
<p>% is allowed in any Uri, that's the Unicode prefix char. Was news to me that they are uris and I needed to handle that decoding. (I'll need to go check my code now)</p>



<a name="265511995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265511995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265511995">(Dec 20 2021 at 01:24)</a>:</h4>
<p>Hang on, the url for the expression isn't in the url, it's in the expression string value. Which doesn't have that problem.</p>



<a name="265512076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265512076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265512076">(Dec 20 2021 at 01:26)</a>:</h4>
<p>The reference would be if the expression was defined elsewhere if I'm not mistaken.</p>



<a name="265512101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265512101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265512101">(Dec 20 2021 at 01:27)</a>:</h4>
<p>I don't understand this either - there's no way that % is not valid in a URI</p>



<a name="265512149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265512149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265512149">(Dec 20 2021 at 01:28)</a>:</h4>
<p>Won't matter, the value Lloyd is referring to should be in the expression not url field.</p>



<a name="265515611"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265515611" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265515611">(Dec 20 2021 at 02:46)</a>:</h4>
<p>The full context is this:</p>
<div class="codehilite"><pre><span></span><code>      &lt;entry&gt;
        &lt;fullUrl value=&quot;urn:uuid:88f151c0-a954-468a-88bd-5ae15c08e060&quot;/&gt;
        &lt;request&gt;
          &lt;method value=&quot;GET&quot;/&gt;
          &lt;url value=&quot;MedicationStatement?patient={{%patient.id}}&amp;amp;active=true&quot;/&gt;
        &lt;/request&gt;
      &lt;/entry&gt;
</code></pre></div>



<a name="265515641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265515641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265515641">(Dec 20 2021 at 02:48)</a>:</h4>
<p>Which is part of a Bundle referenced by this:<br>
  &lt;extension url="<a href="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-sourceQueries">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-sourceQueries</a>"&gt;<br>
    &lt;valueReference&gt;<br>
      &lt;reference value="#PrePopQuery"/&gt;<br>
    &lt;/valueReference&gt;<br>
  &lt;/extension&gt;</p>



<a name="265539156"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265539156" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265539156">(Dec 20 2021 at 09:30)</a>:</h4>
<p>Then that's not the x-fhir-query I thought you were talking about (in the expression datatype)</p>



<a name="265539195"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265539195" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265539195">(Dec 20 2021 at 09:31)</a>:</h4>
<p>That's a batch search request, and yes your problem might be there.</p>



<a name="265572779"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265572779" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265572779">(Dec 20 2021 at 14:53)</a>:</h4>
<p>Why not just update the schema validation to handle the embedded FHIRPath?  I don't think changing the FHIRPath syntax is the right thing to do.</p>



<a name="265576134"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Problem%20with%20x-query%20syntax/near/265576134" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Problem.20with.20x-query.20syntax.html#265576134">(Dec 20 2021 at 15:17)</a>:</h4>
<p>Validation schema for the type is normative, so that's hard to change.  For now, I've just HTTP-escaped the string and mentioned in the spec that that may be necessary.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
