---
layout: page
title: "FHIR Chat  · STU3 validation error for code in contained value set · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html">STU3 validation error for code in contained value set</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="206031288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206031288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206031288">(Aug 05 2020 at 14:50)</a>:</h4>
<p>Hi <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> I am validating a STU3 QuestionnaireResponse against a Questionnaire with the newest validator (5.0.7-SNAPSHOT) and am getting a strange error for an answer coded with SNOMED CT. The code is in a ValueSet that is contained in the questionnaire (both resources are shown below) and is a valid code. Nonetheless, the validator says (full output pasted in further down):</p>
<div class="codehilite"><pre><span></span><code>Error @ QuestionnaireResponse.item[0].answer[0] (line 12, col52) : The value provided (http://snomed.info/sct::55011004) is not in the options value set in the questionnaire
</code></pre></div>


<p>If I replace the SNOMED code with a LOINC code in both resources, everything works fine. If I enter an invalid SNOMED code, the validator complains about it being invalid, so it is finding the code. Spent 30 minutes going over this and still did not spot the issue - is this a known problem or am I  missing smt?</p>
<p>QuestionnaireResponse resource:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;QuestionnaireResponse&quot;</span><span class="p">,</span>
    <span class="nt">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="nt">&quot;questionnaire&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;reference&quot;</span><span class="p">:</span> <span class="s2">&quot;http://example.com/Questionnaire/testQ&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
    <span class="nt">&quot;item&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="nt">&quot;linkId&quot;</span><span class="p">:</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span>
        <span class="nt">&quot;answer&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="nt">&quot;valueCoding&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://snomed.info/sct&quot;</span><span class="p">,</span>
                <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;55011004&quot;</span>
            <span class="p">}</span>
        <span class="p">}]</span>
    <span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>


<p>Questionnaire resource:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Questionnaire&quot;</span><span class="p">,</span>
    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://example.com/Questionnaire/testQ&quot;</span><span class="p">,</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
    <span class="nt">&quot;item&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="nt">&quot;linkId&quot;</span><span class="p">:</span> <span class="s2">&quot;change&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;choice&quot;</span><span class="p">,</span>
        <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;reference&quot;</span><span class="p">:</span> <span class="s2">&quot;#includesVS&quot;</span>
        <span class="p">}</span>
    <span class="p">}],</span>
    <span class="nt">&quot;contained&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;ValueSet&quot;</span><span class="p">,</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://example.com/ValueSet/testVS&quot;</span><span class="p">,</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;includesVS&quot;</span><span class="p">,</span>
        <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
        <span class="nt">&quot;expansion&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;identifier&quot;</span><span class="p">:</span> <span class="s2">&quot;urn:uuid:1f503a0a-b45d-406e-9bfa-43e78a25fe97&quot;</span><span class="p">,</span>
            <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-06-23T12:08:51.687Z&quot;</span><span class="p">,</span>
            <span class="nt">&quot;contains&quot;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://snomed.info/sct&quot;</span><span class="p">,</span>
                <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;55011004&quot;</span>
            <span class="p">}]</span>
        <span class="p">}</span>
    <span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>


<p>Validator output:</p>
<div class="codehilite"><pre><span></span><code>USERX$ java -jar validator/org.hl7.fhir.validator.jar -version 3.0.2 -ig questionnaire/ examples/test.QuestionnaireResponse.json
FHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 6bc790d98b04). Built 2020-06-07T08:35:37.25+10:00 (59 days old)
Detected Java version: 12.0.2 from /Library/Java/JavaVirtualMachines/adoptopenjdk-12.jdk/Contents/Home on x86_64 (64bit). 4096MB available
Arguments: -version 3.0.2 -ig questionnaire/ examples/test.QuestionnaireResponse.json
Directories: Current = /Users/[REMOVED], Package Cache = /Users/[REMOVED]
  .. FHIR Version 3.0, definitions from hl7.fhir.r3.core#3.0.2
  .. connect to tx server @ http://tx.fhir.org
    (v3.0.2)
+  .. load IG from questionnaire/
  .. validate [examples/test.QuestionnaireResponse.json]
Terminology server: Check for supported code systems for http://snomed.info/sct
*FAILURE* validating examples/test.QuestionnaireResponse.json:  error:1 warn:0 info:0
  Error @ QuestionnaireResponse.item[0].answer[0] (line 12, col52) : The value provided (http://snomed.info/sct::55011004) is not in the options value set in the questionnaire
</code></pre></div>



<a name="206085010"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206085010" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206085010">(Aug 05 2020 at 22:20)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> is the correct action here to post a Git issue against HAPI core?</p>



<a name="206096748"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206096748" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206096748">(Aug 06 2020 at 01:37)</a>:</h4>
<p>yes</p>



<a name="206097119"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206097119" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206097119">(Aug 06 2020 at 01:45)</a>:</h4>
<p>note, though, that this a problem in the questionnaire, not the validator</p>



<a name="206110909"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206110909" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206110909">(Aug 06 2020 at 07:14)</a>:</h4>
<blockquote>
<p>note, though, that this a problem in the questionnaire, not the validator</p>
</blockquote>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> just so I report this correctly: do you mean that it is a problem with the general handling of Questionnaire resources?</p>



<a name="206112264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206112264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206112264">(Aug 06 2020 at 07:39)</a>:</h4>
<p>no it's a problem with your questionnaire</p>



<a name="206112649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206112649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206112649">(Aug 06 2020 at 07:45)</a>:</h4>
<p>I meant to describe it - the embedded value set is not correct:</p>



<a name="206112660"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206112660" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206112660">(Aug 06 2020 at 07:45)</a>:</h4>
<div class="codehilite"><pre><span></span><code>            &quot;contains&quot;: [{
                &quot;system&quot;: &quot;http://snomed.info/sct&quot;,
                &quot;concept&quot; : [{
                  &quot;code&quot;: &quot;55011004&quot;
                }]
            }]
</code></pre></div>



<a name="206128816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206128816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206128816">(Aug 06 2020 at 11:28)</a>:</h4>
<p>Ah right, so I can get it to work if my value set  only contains <code>compose</code>. But the moment I add <code>expansion</code>, I get the error, with or without the <code>compose</code> element. Yet the contained value set validates OK as a standalone. I think my morning coffee is not working, I must admit I still do not see the error in the expansion/the use of expanded value sets (or understand why it works with LOINC but not SNOMED).</p>



<a name="206129022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206129022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206129022">(Aug 06 2020 at 11:30)</a>:</h4>
<p>hmm. what I pasted there is wrong..</p>



<a name="206133836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206133836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206133836">(Aug 06 2020 at 12:31)</a>:</h4>
<p>found the problem and fixed it. It will be in today's release</p>



<a name="206134327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/STU3%20validation%20error%20for%20code%20in%20contained%20value%20set/near/206134327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/STU3.20validation.20error.20for.20code.20in.20contained.20value.20set.html#206134327">(Aug 06 2020 at 12:36)</a>:</h4>
<p>Thanks, as always, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
