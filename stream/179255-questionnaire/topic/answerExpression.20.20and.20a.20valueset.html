---
layout: page
title: "FHIR Chat  · answerExpression  and a valueset · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html">answerExpression  and a valueset</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="264251204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264251204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264251204">(Dec 09 2021 at 03:06)</a>:</h4>
<p>I am trying to do something similar to Brian's   <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span>     "explanation.7   Options from a coding expanded using a fhir query, and a fhirpath expression. Useful when the expression is effected by other values on the form"   at <a href="https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/coding-sampler">https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/coding-sampler</a></p>
<p>The example uses <a href="https://r4.ontoserver.csiro.au/fhir">https://r4.ontoserver.csiro.au/fhir</a>     terminology server, but do I need to use one?  If I want to get the valueset for my answer expression from value set <a href="http://hl7.org/fhir/ValueSet/languages">http://hl7.org/fhir/ValueSet/languages</a>  can I just expand it in the expression without the ontoserver?   Or does expansion require a terminology server in order to call the $expand operation?</p>
<div class="codehilite"><pre><span></span><code>&lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/variable&quot; &gt;
     &lt;valueExpression &gt;
             &lt;description value=&quot;Variable to hold the results of the expansion&quot;/&gt;
             &lt;name value=&quot;vsListOfLanguages&quot;/&gt;
             &lt;language value=&quot;application/x-fhir-query&quot;/&gt;
             &lt;expression value=&quot;$expand?url=http://hl7.org/fhir/ValueSet/languages&quot;/&gt;
     &lt;/valueExpression&gt;
&lt;/extension&gt;
</code></pre></div>
<p>Alternately, if I have used a contained and expanded valueset (like the contained valueset #pre-expanded  at <a href="https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/coding-sampler">https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/coding-sampler</a>),  how can I include that in my answer expression?   </p>
<p>Do I create a variable first?   If yes, would this be the syntax?   I don't know how to get the contained valueset<br>
 #pre-expanded  into the variable.</p>
<div class="codehilite"><pre><span></span><code>&lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/variable&quot; &gt;
    &lt;valueExpression &gt;
        &lt;description value=&quot;Variable for #pre-expanded valueset &quot;/&gt;
        &lt;name value=&quot;vsPreExpanded&quot;/&gt;
        &lt;language value=&quot;text/fhirpath&quot;/&gt;
        &lt;expression value=&quot;#pre-expanded&quot;/&gt;
    &lt;/valueExpression&gt;
&lt;/extension&gt;
</code></pre></div>
<p>Or do I skip the variable creation?  Can I refer to the #pre-expanded  contained  valueset in the answerExpression without putting it into a variable?</p>
<div class="codehilite"><pre><span></span><code>&lt;extension url=&quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-answerExpression&quot; &gt;
    &lt;valueExpression &gt;
        &lt;description value=&quot;select the coded values from the expansion results in the above expression&quot;/&gt;
        &lt;name value=&quot;ListOfLanguages&quot;/&gt;
        &lt;language value=&quot;text/fhirpath&quot;/&gt;
        &lt;expression value=&quot;#pre-expanded.expansion.contains&quot;/&gt;
    &lt;/valueExpression&gt;
&lt;/extension&gt;
</code></pre></div>



<a name="264258154"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264258154" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264258154">(Dec 09 2021 at 05:13)</a>:</h4>
<p>That's an option I hadn't considered, but I believe you should be able to reference that through $questionnaire.contained[0].expansion....</p>



<a name="264384199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264384199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264384199">(Dec 09 2021 at 23:50)</a>:</h4>
<p>Yes, I think that is a better way to reference the contained resource.   It seems like it should work.</p>
<p>My answerExpression is iif(%resource.descendants().where(linkId = 'Q1').answer.value.exists(), %resource.descendants().where(linkId = 'Q1').answer.value, %resource.contained[0].expansion.contains)        but this doesn't work</p>
<p>%resource.contained[0].expansion.contains  by itself  doesn't work either .  No drop down appears with these values.</p>
<p>I am trying to prepopulate from Q1  if it exists; otherwise  show the contained expanded valueset.   </p>
<p>I sent an email to LHC Forms support (Paul)   in case it has something to do with LHC Forms specifically.      Maybe the answerExpression is not compatible with expanded contained valuesets in LHC forms?    Or in the SDC standard?   </p>
<p>If that is the case,  my only option is to use a terminology server with the $expand operation?    How do I pick a terminology server?</p>



<a name="264407043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264407043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264407043">(Dec 10 2021 at 06:09)</a>:</h4>
<p>might need to check on if %resource or %questionnaire is the appropriate thing to connect to (not sure on the context of the path execution you've got there, if its on the QR, then %questionaire is the right one.)</p>



<a name="264464080"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264464080" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264464080">(Dec 10 2021 at 15:38)</a>:</h4>
<p>I think the issue is %questionnaire.contained is needed instead of %resource.contained.</p>



<a name="264672465"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264672465" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264672465">(Dec 13 2021 at 07:51)</a>:</h4>
<p>questionnaire.contained[0].expansion.contains   is what worked.   Thanks!  </p>
<p>Before posting, I tried:</p>
<p>%resource.contained...<br>
resource.contained...<br>
%Questionnaire.contained...<br>
Questionnaire.contained...<br>
%questionnaire.contained...</p>
<p>In the fhirpath testers (Brian's and fhirpath js):</p>
<p>Questionnaire.title  works  but not questionnaire.title</p>
<p>Questionnaire.contained[0].expansion.contains  works but not questionnaire.contained[0].expansion.contains</p>
<p>%resource.contained[0].expansion.contains     works in Brian's fhirpath tester, but not fhirpath js tester</p>
<p>So why is the answerExpression  using questionnaire...  when the fhirpath testers use Questionnaire...?  Do the answerExpressions only use lowercase versions of the resource name  for the fhirpath expression?  This is very confusing.</p>



<a name="264734347"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264734347" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264734347">(Dec 13 2021 at 16:46)</a>:</h4>
<p>I am assume that you mean for the fhirpath.js tester, the demo at <a href="https://hl7.github.io/fhirpath.js/">https://hl7.github.io/fhirpath.js/</a>.  That demo won't have %questionnaire defined, because %questionnaire is only set by a form renderer when a user is filling out a Questionnaire.  FHIRPath can be used in a lot of contexts in which there isn't a Questionnaire (or even a resource), so the demo only defines things like %context that are defined in the FHIRPath specification.  I suppose it would be helpful if the demo listed the variables that are defined.</p>



<a name="264761493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264761493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264761493">(Dec 13 2021 at 19:59)</a>:</h4>
<p>Yes, the fhirpath demo.   When should I be using questionnaire  (lowercase q)  vs.  Questionnaire in my answerExpressions?</p>



<a name="264761961"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264761961" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264761961">(Dec 13 2021 at 20:02)</a>:</h4>
<p>Starting an expression with a resource name like "Questionnaire" means that the object in %context should be checked to make sure it is a resource of that type.  In nearly all cases in a QuestionnaireResponse (all that I can think of), %context will not have a Questionnaire, so it would probably not be useful to start it that way.</p>



<a name="264763523"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264763523" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264763523">(Dec 13 2021 at 20:14)</a>:</h4>
<p>OK. So what does questionnaire  (not the resource name "Questionnaire") do?   I am trying to use an included value set for the answerExpression, so I need to refer to this included valueset.  How does the expression know what %context to use?    Why does questionnaire.contained[0].expansion.contains         work?     Why doesn't   %questionnaire.contained[0]... work?</p>



<a name="264763640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264763640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264763640">(Dec 13 2021 at 20:15)</a>:</h4>
<p>Do you mean %questionnaire?  "questionnaire.contained..."  (without the %) would not work, I don't think.</p>



<a name="264767392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264767392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Diane <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264767392">(Dec 13 2021 at 20:44)</a>:</h4>
<p>Never mind.  %questionnaire is correct.    I understand why.   I was confusing myself.  And you.  <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="264767461"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264767461" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264767461">(Dec 13 2021 at 20:45)</a>:</h4>
<p>No problem.</p>



<a name="264937907"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264937907" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264937907">(Dec 14 2021 at 22:48)</a>:</h4>
<p>Yeah, the fhirpath tester doesn't have a way to define variables, but have been thinking how to do that.</p>



<a name="264937928"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/answerExpression%20%20and%20a%20valueset/near/264937928" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/answerExpression.20.20and.20a.20valueset.html#264937928">(Dec 14 2021 at 22:48)</a>:</h4>
<p>(UI suggestions welcomed there)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
