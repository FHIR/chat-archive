---
layout: page
title: "FHIR Chat  · SDC EnableWhen extension · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html">SDC EnableWhen extension</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="179014216"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179014216" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179014216">(Oct 25 2019 at 01:15)</a>:</h4>
<p>SDC defines an extension for enable when using url <a href="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression" target="_blank" title="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression</a> at <a href="https://build.fhir.org/ig/HL7/sdc/extension-sdc-questionnaire-enableWhenExpression.html" target="_blank" title="https://build.fhir.org/ig/HL7/sdc/extension-sdc-questionnaire-enableWhenExpression.html">https://build.fhir.org/ig/HL7/sdc/extension-sdc-questionnaire-enableWhenExpression.html</a></p>



<a name="179014246"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179014246" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179014246">(Oct 25 2019 at 01:15)</a>:</h4>
<p>the extension does not define how the expression is made aware of the context in the QR in which it is being run</p>



<a name="179014290"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179014290" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179014290">(Oct 25 2019 at 01:16)</a>:</h4>
<p>There is no way, at this time, to use this extension</p>



<a name="179014594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179014594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179014594">(Oct 25 2019 at 01:23)</a>:</h4>
<p>there's basically 2 sets of information to pass to the expression:<br>
- the stack of questions in the Questionnaire<br>
- the stack of answer items in the QuestionnaireResponse</p>
<p>You need this context as soon as your dependency depends on a question within the context of a repeating item above you</p>



<a name="179014642"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179014642" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179014642">(Oct 25 2019 at 01:24)</a>:</h4>
<p>The finnish project ignores this and assumes that the expression is evaluated in the context of the QR itself.</p>



<a name="179015034"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179015034" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179015034">(Oct 25 2019 at 01:35)</a>:</h4>
<p>so what I propose is that the:<br>
- the expression is executed in the context of the QuestionnaireResponse<br>
- there's a variable %qstack which is a collection that has the stack of answer contexts in the QR. Each is a Tuple with .answer and .question properties<br>
- there's a variable %questionnaire that has the actual questionnaire (for simplicity, since it's also the .question for the first entry in the stack)</p>



<a name="179015855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179015855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179015855">(Oct 25 2019 at 01:56)</a>:</h4>
<p>Have you read the content about expressions in SDC?  It indicates how you access answers to other questions, variables that have been defined higher in the questionnaire, etc.</p>



<a name="179015860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179015860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179015860">(Oct 25 2019 at 01:56)</a>:</h4>
<p>I don't think we need anything more.</p>



<a name="179016496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179016496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179016496">(Oct 25 2019 at 02:12)</a>:</h4>
<p>where are you looking? (it would probably help to reference it from the extension)</p>



<a name="179016518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179016518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179016518">(Oct 25 2019 at 02:13)</a>:</h4>
<p>if you are referring to this: <a href="https://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions" target="_blank" title="https://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions">https://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions</a> , then  I don't see any answer to my question</p>



<a name="179016953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179016953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179016953">(Oct 25 2019 at 02:25)</a>:</h4>
<p>Some of the change requests aren't reflected yet which will let you reference the root of the Questionnaire or the QuestionnaireResponse or a particular Question in the Questionnaire.  However, with variable, you can make the values of "previous" answers available.</p>



<a name="179017014"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179017014" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179017014">(Oct 25 2019 at 02:27)</a>:</h4>
<p>so I kind of feel let down, since I can't actually see what matters - perhaps you could provide details....</p>
<p>but it sounds like it doesn't get to the heart of the matter anyway: when you are evaluating enableWhen, you need access to stack for the item you are evaluating it's enabled-ness</p>



<a name="179017274"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179017274" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179017274">(Oct 25 2019 at 02:35)</a>:</h4>
<p>I'm not sure what you mean by "stack".  Are you talking about all of the ancestor items?  (I recall asking for an ancestor ability in FHIRPath a couple of years ago and you weren't thrilled :&gt;)</p>
<p>To get around that, the expectation now is that if you're going to have an item depend on stuff that isn't a descendant of that item, you declare a variable on a higher level item that captures the necessary information.  the expressions within the item then reference the variable - which is available in scope.</p>



<a name="179017340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179017340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179017340">(Oct 25 2019 at 02:37)</a>:</h4>
<p>That's a very hard way to go about the problem.</p>



<a name="179017411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179017411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179017411">(Oct 25 2019 at 02:39)</a>:</h4>
<p>The evaluator has an internal stack of the answers it is working with. It can make that available to the enableWhen expression without the need for the author to define variables</p>



<a name="179017717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179017717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179017717">(Oct 25 2019 at 02:48)</a>:</h4>
<p>By stack, do you mean just the ancestors or do you mean all preceding items?</p>



<a name="179017743"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179017743" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179017743">(Oct 25 2019 at 02:49)</a>:</h4>
<p>all the containing elements that bring you to the answer your evaluating the enabled-ness of</p>



<a name="179017746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179017746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179017746">(Oct 25 2019 at 02:49)</a>:</h4>
<p>I think that ancestor isn't the right word</p>



<a name="179018014"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179018014" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179018014">(Oct 25 2019 at 02:57)</a>:</h4>
<p>but maybe doing via variables is better for re-use</p>



<a name="179018071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179018071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179018071">(Oct 25 2019 at 02:59)</a>:</h4>
<p>I don't expect the tool that's rendering the questionnaire to necessarily have a clue which elements are going to be relevant for subsequent enableWhens.  If it's keeping track of anything, it would either have to be all prior items (which seems kinda big/complicated) or all ancestors (which makes my XPath heart happy, but is a capability I'm surprised to hear you proposing)</p>



<a name="179018139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179018139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179018139">(Oct 25 2019 at 03:01)</a>:</h4>
<p>the engine needs to have the containers (=ancestors) in order to evaluate a normal enable when. It can pass that collection to the expression if we define a way. that's not the same thing as the XPath ancestor thing)</p>



<a name="179018456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/SDC%20EnableWhen%20extension/near/179018456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension.html#179018456">(Oct 25 2019 at 03:10)</a>:</h4>
<p>Would you care to submit a change request? :)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
