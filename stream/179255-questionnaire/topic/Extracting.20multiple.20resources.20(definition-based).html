---
layout: page
title: "FHIR Chat  · Extracting multiple resources (definition-based) · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html">Extracting multiple resources (definition-based)</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="249116291"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249116291" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jing Tang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249116291">(Aug 11 2021 at 14:32)</a>:</h4>
<p>In a questionnaire we have a multiple choice question with repeated answers. We want to extract a separate <code>Observation</code> resource for each answer selected. For example, the user may select 'cough' and 'high blood pressure' and two <code>Observation</code>s should be extracted with the respective codes. We have found this difficult to do using definition-based extraction. 2 ideas: 1) separate each answer option as a single question with a check box with a nested hidden group which has a separate extraction context and includes code to be extracted 2) use enable when to enable separate hidden groups that include separate extraction context and code. Are we on the right track? Any comments / additional ideas? Is structure map recommended for cases like this that are slightly complicated. <span class="user-mention" data-user-id="315122">@Fred Hersch</span> <span class="user-mention" data-user-id="426666">@santosh pingle</span></p>



<a name="249122932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249122932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249122932">(Aug 11 2021 at 15:19)</a>:</h4>
<p>Why are you having issues with definition-based extraction?  It <em>should</em> just be a matter of applying the mechanism once for each answer...</p>



<a name="249141450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249141450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jing Tang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249141450">(Aug 11 2021 at 17:34)</a>:</h4>
<p>Because definition-based extraction relies on setting context for each expected resource, when we expect each answer to create a new resource, we need to create the hidden groups to make it work. Is there a better way of doing this? Are 1) and 2) as I mentioned reasonable approaches?</p>



<a name="249148057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249148057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249148057">(Aug 11 2021 at 18:21)</a>:</h4>
<p>The context would presumably be the same for each - same patient, same observation code, same effective time, etc.  You'd just instantiate the definition information multiple times - once for each value.</p>



<a name="249148122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249148122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249148122">(Aug 11 2021 at 18:22)</a>:</h4>
<p>It may be that we should make that expectation explicit in the SDC documentation - feel free to submit a change request.</p>



<a name="249205427"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249205427" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jing Tang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249205427">(Aug 12 2021 at 07:35)</a>:</h4>
<p>No the observation code would not be the same -- they are different conditions. Imagine a check box list with different symptoms.</p>



<a name="249205838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249205838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jing Tang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249205838">(Aug 12 2021 at 07:41)</a>:</h4>
<p><span class="user-mention" data-user-id="414255">@Aditya K</span></p>



<a name="249240198"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249240198" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249240198">(Aug 12 2021 at 14:17)</a>:</h4>
<p>Well, either the Observation.code would be the same ("diagnosis") or the Observation.value would be the same ("present"), depending on how you break them down.</p>



<a name="249240218"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249240218" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249240218">(Aug 12 2021 at 14:17)</a>:</h4>
<p>Alternatively use Condition.</p>



<a name="249333623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249333623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jing Tang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249333623">(Aug 13 2021 at 08:09)</a>:</h4>
<p>Sorry I'm a bit confused. Because these are different symptoms, we want to use different codes (e.g. cough, shortness of breath, etc) in whatever resource we use (either Observation or Condition). So at the very least we need to have different hidden groups with nested hidden questions with initial answers being set to these different codes. And these hidden groups would only be activated(EDIT: enabled) with certain answers given to the multiple choice question. Are you suggesting something different to this?</p>



<a name="249364634"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249364634" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249364634">(Aug 13 2021 at 14:08)</a>:</h4>
<p>Are your answer values not the codes themselves?</p>



<a name="249538270"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249538270" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Fred Hersch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249538270">(Aug 16 2021 at 00:40)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> . Here is an example that <span class="user-mention" data-user-id="366686">@Jing Tang</span> is referring too. We want to be able to have a <em>multi-select set of check-boxes</em> to indicate the presence of different symptoms as part of a screener type questionnaire.  Here we are following the pattern (for option 3 or 4) here - <a href="https://www.hl7.org/fhir/observation.html#code-interop">https://www.hl7.org/fhir/observation.html#code-interop</a></p>
<p>Here is an example of the Questionnaire Item and the output. We are not sure how to implement the correct definition extraction queries to be able to achieve a situation where if you select multiple choices, for each an Observation resource will be created where:</p>
<p>In this scenario you only create resources for those that have been selected: </p>
<ul>
<li>Observation.code = valueCoding of the answerSelected</li>
<li>Observation.value = valueBoolen(true) - to indicate present</li>
</ul>
<div class="codehilite"><pre><span></span><code>&quot;item&quot;: [
        {
          &quot;text&quot;: &quot;In the past two weeks have you experienced ANY of these symptoms?&quot;,
          &quot;type&quot;: &quot;choice&quot;,
          &quot;linkId&quot;: &quot;1.1.0&quot;,
          &quot;repeats&quot;: true,
          &quot;answerOption&quot;: [
            {
              &quot;valueCoding&quot;: {
                &quot;code&quot;: &quot;386661006&quot;,
                &quot;display&quot;: &quot;Fever&quot;,
                &quot;system&quot;: &quot;http://snomed.info/sct&quot;
              }
            },
            {
              &quot;valueCoding&quot;: {
                &quot;code&quot;: &quot;13645005&quot;,
                &quot;display&quot;: &quot;Shortness of breath&quot;,
                &quot;system&quot;: &quot;http://snomed.info/sct&quot;
              }
            },
            {
              &quot;valueCoding&quot;: {
                &quot;code&quot;: &quot;49727002&quot;,
                &quot;display&quot;: &quot;Cough&quot;,
                &quot;system&quot;: &quot;http://snomed.info/sct&quot;
              }
            },
            {
              &quot;valueCoding&quot;: {
                &quot;code&quot;: &quot;44169009&quot;,
                &quot;display&quot;: &quot;Loss of smell&quot;,
                &quot;system&quot;: &quot;http://snomed.info/sct&quot;
              }
            }
          ]
        }
      ]
    },
</code></pre></div>
<p>In this scenario, for each of the symptoms selected, we will create an Observation resource where the Observation.code = [value of the selected valueCoding] and the Observation.value = valueBoolen (to indicate present or not). For cough this would look like:</p>
<div class="codehilite"><pre><span></span><code>{
&quot;resourceType&quot;: &quot;Observation&quot;,
 &quot;id&quot;: &quot;78354025-1059-4f0f-8b04-8478d696d234&quot;,
  &quot;issued&quot;: &quot;1990-03-12T09:04:10.192-05:00&quot;,
  &quot;meta&quot;: {
    &quot;lastUpdated&quot;: &quot;2021-04-01T12:45:31.338652+00:00&quot;,
    &quot;versionId&quot;: &quot;MTYxNzI4MTEzMTMzODY1MjAwMA&quot;
  },
  &quot;status&quot;: &quot;final&quot;,
  &quot;category&quot;: [
    {
      &quot;coding&quot;: [
        {
          &quot;code&quot;: &quot;exam&quot;,
          &quot;display&quot;: &quot;symptoms&quot;,
          &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/observation-category&quot;
        }
      ]
    }
  ],
  &quot;code&quot;: {
    &quot;coding&quot;: [
      {
        &quot;code&quot;: &quot;49727002&quot;,
        &quot;display&quot;: &quot;Cough&quot;,
        &quot;system&quot;: &quot;http://loinc.org&quot;
      }
    ],
    &quot;text&quot;: &quot;Cough&quot;
  },
  &quot;effectiveDateTime&quot;: &quot;1990-03-12T09:04:10-05:00&quot;,
  &quot;encounter&quot;: {
    &quot;reference&quot;: &quot;Encounter/&lt;encounter_id&gt;&quot;
  },
  &quot;subject&quot;: {
    &quot;reference&quot;: &quot;Patient/&lt;patient_id&gt;&quot;
  },
  &quot;valueBoolean&quot;: {
   &quot;value&quot; : &quot;true&quot;
  }
}
</code></pre></div>



<a name="249587529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249587529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249587529">(Aug 16 2021 at 13:22)</a>:</h4>
<p>Observation-based extraction is not designed for situations where the answer goes in the Observation.code and the Observation.value is fixed to true.  Observation.value is used for situations where the Observation.code comes from item.code and Observation.value comes from item.answer.value[x].  To do what you want, you'll have to use definition-based extraction.</p>



<a name="249640933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249640933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249640933">(Aug 16 2021 at 20:10)</a>:</h4>
<p>I think the question is how can that work with the definition-based extraction. <br>
Observation-based is too limited, which is one reason I presume Jing has gone directly to definition-based extraction</p>



<a name="249655662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249655662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249655662">(Aug 16 2021 at 22:18)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span>, have you encountered this?</p>



<a name="249656052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249656052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249656052">(Aug 16 2021 at 22:22)</a>:</h4>
<p>That doesn't feel like definition would be expressive enough for that either.<br>
I've done multiple resources from different sections of a questionnaire, not from one question to multiple.</p>



<a name="249704314"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Extracting%20multiple%20resources%20%28definition-based%29/near/249704314" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jing Tang <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Extracting.20multiple.20resources.20(definition-based).html#249704314">(Aug 17 2021 at 11:21)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span>! the approach we have taken is using enableWhen + hidden groups, so that groups are enabled (but remain hidden) with certain answers being present in the multiple choice question... this requires each hidden group to have a separate context and is slightly fiddly. but seems to work. not sure if there's a better approach -- we can also explore structure map (which we have a prototype) but we will need to author the structure map.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
