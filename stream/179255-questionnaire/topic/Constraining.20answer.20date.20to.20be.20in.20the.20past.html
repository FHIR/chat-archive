---
layout: page
title: "FHIR Chat  · Constraining answer date to be in the past · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html">Constraining answer date to be in the past</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="208063365"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208063365" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208063365">(Aug 26 2020 at 08:09)</a>:</h4>
<p>Hi <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span>  Suppose we have a questionnaire and one question asks for a date. The date entered must not be in the future (i.e. later than the date on which the answer is collected), e.g. suppose the question is "When was your last visit?" Is there any way to capture this constraint in a Questionnaire? I see the <a href="http://hl7.org/fhir/r4/extension-maxvalue.html">max-value extension</a>, but I am assuming that it only allows specifying a <em>fixed</em> latest allowed date.</p>



<a name="208099329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208099329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208099329">(Aug 26 2020 at 14:34)</a>:</h4>
<p>It sounds like there is a need for a FHIRPath expression there.</p>



<a name="208103620"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208103620" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vladimir Smirnov <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208103620">(Aug 26 2020 at 15:02)</a>:</h4>
<p>Ironically, we've come to this chat today to ask this very same question, only to find it had been asked in the morning! We've been considering using the questionnaire-constraint extension. It contains a FHIRPath expression, and the language has the function today(). But is it an appropriate use of the extension? Its use cases are not really documented, and it appears to be meant for expressing constraints on the resources underlying the Questionnaire, not the Questionnaire itself. It is not clear what resource or element should the FHIRPath expression be written against. The Observation? The QuestionnaireResponse? The QuestionnaireResponse.Item?</p>



<a name="208109517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208109517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208109517">(Aug 26 2020 at 15:44)</a>:</h4>
<p><a href="http://build.fhir.org/extension-questionnaire-constraint.html">http://build.fhir.org/extension-questionnaire-constraint.html</a> would allow you to make such an assertion using FHIRPath</p>



<a name="208110949"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208110949" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vladimir Smirnov <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208110949">(Aug 26 2020 at 15:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past/near/208109517">said</a>:</p>
<blockquote>
<p><a href="http://build.fhir.org/extension-questionnaire-constraint.html">http://build.fhir.org/extension-questionnaire-constraint.html</a> would allow you to make such an assertion using FHIRPath</p>
</blockquote>
<p>What should the FHIRPath be written against? The root of QuestionnaireResponse?</p>



<a name="208119953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208119953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208119953">(Aug 26 2020 at 17:09)</a>:</h4>
<p>The context would be the element the extension appears on - which could be the root or could be an item with in the Questionnaire.  It would be evaluated on the corresponding level of the QuestionnaireResponse</p>



<a name="208155039"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208155039" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208155039">(Aug 26 2020 at 22:04)</a>:</h4>
<p>We do this quite often exactly as above.</p>



<a name="208155124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208155124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208155124">(Aug 26 2020 at 22:05)</a>:</h4>
<p>It's also quite interesting in terms of later validation. It might pass now, but if updating later, what's the rule there...</p>



<a name="208192814"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208192814" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208192814">(Aug 27 2020 at 09:02)</a>:</h4>
<p>Good point about the validation, <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span>, had not considered that . We were considering adding this information as a hint to the UI that it should not allow the user to enter a future date. But once the data is collected, the constraint is effectively defunct in the sense that we'd want (need) to ignore it if validating the QuestionnaireResponse at a later time. I suppose this is actually a generic validation issue for such "time-dependent" constraints everywhere. So maybe we can't have our cake and eat, too?</p>



<a name="208192950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208192950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208192950">(Aug 27 2020 at 09:04)</a>:</h4>
<p>For the server side, that today() validation might substitute the author or lastmod date... But just a thought.</p>



<a name="208209236"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/208209236" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#208209236">(Aug 27 2020 at 12:27)</a>:</h4>
<p>For our usecase that could probably work quite well. But I imagine it would be hard to capture/communicate that expected transformation. I suppose what we wanted to communicate to the UI is actually a notion of "context-sensitive validity" (what is valid <em>at the point in time when the data is enteted</em>) that is difficult to bring together with the usual FHIR validity.</p>
<p>So now I'm thinking the way to go might rather be to have an extension carrying a code to communicate "not in the future". The clients would have to pick that up , but the validator could ignore it. This would be along the lines of the <a href="https://www.hl7.org/fhir/extension-questionnaire-itemcontrol.html">itemControl extension</a> that gives a code indicating how to render an item. Indeed, I suppose one could even use that ext directly by adding a code for "date picker only accepting dates in the past" <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="259356905"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/259356905" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roeland Luykx <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#259356905">(Oct 28 2021 at 08:42)</a>:</h4>
<p>i have the same question and i'm think of the definition for the frontend in the questionnaire. the following proposition i defined</p>
<p>Instance: undefined<br>
InstanceOf: Questionnaire<br>
Usage: #example</p>
<ul>
<li>status = #draft</li>
<li>extension[0].url = "<a href="http://hl7.org/fhir/StructureDefinition/variable">http://hl7.org/fhir/StructureDefinition/variable</a>"</li>
<li>extension[=].valueExpression.name = "todaydate"</li>
<li>extension[=].valueExpression.language = #text/fhirpath</li>
<li>extension[=].valueExpression.expression = "today()"</li>
<li>item[+].linkId = "1"</li>
<li>item[=].text = "Actual date"</li>
<li>item[=].type = #date</li>
<li>item[=].extension[+].url = "<a href="http://hl7.org/fhir/StructureDefinition/maxValue">http://hl7.org/fhir/StructureDefinition/maxValue</a>"</li>
<li>item[=].extension[=].valueDate = "%todaydate"</li>
<li>item[=].extension[=].valueDate.extension.url = "<a href="http://hl7.org/fhir/StructureDefinition/cqf-calculatedValue">http://hl7.org/fhir/StructureDefinition/cqf-calculatedValue</a>"</li>
<li>item[=].extension[=].valueDate.extension.valueString = "max_date"</li>
<li>item[=].extension[+].url = "<a href="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression</a>"</li>
<li>item[=].extension[=].valueExpression.language = #text/fhirpath</li>
<li>item[=].extension[=].valueExpression.expression = "today()"</li>
</ul>
<p>sushi has a problem with the "cannot assign string value: %todaydate. Value does not match element type: date" but somehow it likes me that it could be the in the right direction.</p>
<p>someone an other proposition?</p>



<a name="259398124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/259398124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#259398124">(Oct 28 2021 at 14:37)</a>:</h4>
<p>If you're setting a date to an expression, you can't have valueDate, you need to have a valueExpression</p>



<a name="259427663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Constraining%20answer%20date%20to%20be%20in%20the%20past/near/259427663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Constraining.20answer.20date.20to.20be.20in.20the.20past.html#259427663">(Oct 28 2021 at 17:56)</a>:</h4>
<p>I don't think maxValue takes an Expression.  You could use cqf-expression on maxValue, but maxValue isn't one of the places the SDC IG mentions for using cqf-expression.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
