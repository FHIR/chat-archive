---
layout: page
title: "FHIR Chat  · Repeating answers to a top-level question · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html">Repeating answers to a top-level question</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="251587316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251587316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251587316">(Sep 01 2021 at 16:21)</a>:</h4>
<p>(Bonus points if someone can help point me to the relevant docs; I just spent ~20min trying to find this in guidance at <a href="http://build.fhir.org/questionnaire">http://build.fhir.org/questionnaire</a> and <a href="http://build.fhir.org/questionnaireresponse">http://build.fhir.org/questionnaireresponse</a>.)</p>



<a name="251588908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251588908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251588908">(Sep 01 2021 at 16:30)</a>:</h4>
<p>/poll Let's say I have a Questionnaire with a single question ("tell me the name of a color you like"), and it's marked as "repeats". Now, a user supplies answers indicating they like "Red", and "Green", and "Blue". Does the resulting QuestionnaireReponse...</p>



<a name="251593867"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251593867" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251593867">(Sep 01 2021 at 17:02)</a>:</h4>
<p>Looks like there isn't explicit guidance that says you can't do #2 - we never contemplated anyone would try.  (The fact that QuestionnaireResponse.item.answer repeats I would have thought made the answer obvious.)  Feel free to submit a tracker item.</p>



<a name="251594561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251594561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251594561">(Sep 01 2021 at 17:06)</a>:</h4>
<p>I don't think that's obvious.  In its internal (non-FHIR) format, for a string data type (i.e. not a list) that repeats, LHC-Forms would have three items for these three answers.  LHC-Forms converts those on export to QuestionnaireResponse into a single item with multiple answers.</p>



<a name="251604096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251604096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251604096">(Sep 01 2021 at 18:11)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> are there circumstances where any of the following would not hold?</p>
<hr>
<h3>Top-level items with the same linkId</h3>
<div class="codehilite"><pre><span></span><code>QuestionnaireResponse
  .item.where(value.exists())
  .linkId
  .isDistinct()
</code></pre></div>
<p>I'm guessing this is always true.</p>
<hr>
<h3>Sibling answer.items with the same linkId</h3>
<div class="codehilite"><pre><span></span><code>QuestionnaireResponse
  .descendants()
  .answer
  .select(
      item
      .where(value.exists())
      .linkId
      .isDistinct())
  .allTrue()
</code></pre></div>
<p>I'm guessing this is always true?</p>
<hr>
<h3>Sibling item.items with the same linkId</h3>
<div class="codehilite"><pre><span></span><code>QuestionnaireResponse
  .descendants()
  .item
  .select(
      item
      .where(value.exists())
      .linkId
      .isDistinct())
  .allTrue()
</code></pre></div>
<p>I'm guessing this  is always true.</p>
<hr>
<p>(As you can see, I'm thinking about how to formalize this, and trying to test my understanding at the same time. I suspect there's some interaction with item.type=group that I'm not quite grokking. I'm using <code>.where(value.exists())</code> as a kind of proxy for question-type items, since the item type is only modeled in the Questionnaire, not surfaced in the QuestionnaireResponse.)</p>



<a name="251607866"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251607866" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251607866">(Sep 01 2021 at 18:35)</a>:</h4>
<p>The definition of "repeats" today says:</p>
<blockquote>
<p>An indication, if true, that the item may occur multiple times in the response, collecting multiple answers for questions or multiple sets of answers for groups.</p>
</blockquote>
<p>but if I'm understanding Lloyd's answer to the poll correctly, then "collecting multiple answer for questions" is <em>not</em> a use case where the item will occur multiple times in the response (rather, the item will occur once and there will be multiple answers within it). I've submitted <a href="http://jira.hl7.org/browse/FHIR-33335">FHIR-33335</a> to start, but I don't understand enough to know what exactly to propose.</p>



<a name="251616772"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251616772" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251616772">(Sep 01 2021 at 19:38)</a>:</h4>
<p>If your root item is a group and it repeats, then there will be multiple items with the same link id at the root.</p>



<a name="251616833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251616833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251616833">(Sep 01 2021 at 19:38)</a>:</h4>
<p>Same is true at the non-root level</p>



<a name="251616889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251616889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251616889">(Sep 01 2021 at 19:39)</a>:</h4>
<p>It's only sibling questions that must have distinct linkIds.</p>



<a name="251619388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251619388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251619388">(Sep 01 2021 at 19:55)</a>:</h4>
<p>Cool -- so I think the fhirpath I wrote above is <del>all</del> roughly correct, and if so can be lumped together in a constraint like:</p>
<div class="codehilite"><pre><span></span><code>QuestionnaireResponse
  .union(descendants())
  .select(
    item.where(answer.value.exists())
    .linkId
    .isDistinct())
.allTrue()
</code></pre></div>



<a name="251620279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251620279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251620279">(Sep 01 2021 at 20:02)</a>:</h4>
<p>I've updated the issue to propose this in addition to language tweaks.</p>



<a name="251647207"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251647207" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251647207">(Sep 02 2021 at 00:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> That doesn't look correct to me, for that case Lloyd mentioned of a repeating group.  A QuestionnaireResponse that had two instances of a repeating group will repeat not just the group linkIDs, but the linkIDs of the answered questions within the group.</p>



<a name="251647248"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251647248" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251647248">(Sep 02 2021 at 00:02)</a>:</h4>
<p>Example:</p>



<a name="251647263"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251647263" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251647263">(Sep 02 2021 at 00:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>        {
          &quot;linkId&quot;: &quot;/54126-8/54137-5&quot;,
          &quot;text&quot;: &quot;Diseases history panel&quot;,
          &quot;item&quot;: [
            {
              &quot;linkId&quot;: &quot;/54126-8/54137-5/54140-9&quot;,
              &quot;text&quot;: &quot;History of diseases&quot;,
              &quot;answer&quot;: [
                {
                  &quot;valueCoding&quot;: {
                    &quot;code&quot;: &quot;3982&quot;,
                    &quot;display&quot;: &quot;Abdominal pain&quot;
                  }
                }
              ]
            }
          ]
        },
        {
          &quot;linkId&quot;: &quot;/54126-8/54137-5&quot;,
          &quot;text&quot;: &quot;Diseases history panel&quot;,
          &quot;item&quot;: [
            {
              &quot;linkId&quot;: &quot;/54126-8/54137-5/54140-9&quot;,
              &quot;text&quot;: &quot;History of diseases&quot;,
              &quot;answer&quot;: [
                {
                  &quot;valueCoding&quot;: {
                    &quot;code&quot;: &quot;2315&quot;,
                    &quot;display&quot;: &quot;Back pain&quot;
                  }
                }
              ]
            }
          ]
        }
</code></pre></div>



<a name="251647885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251647885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251647885">(Sep 02 2021 at 00:10)</a>:</h4>
<p>(That example comes from <a href="https://lhcforms.nlm.nih.gov/sdc">https://lhcforms.nlm.nih.gov/sdc</a>.  After picking a form to view, you can choose "Show As"-&gt;"QuestionnaireResponse".)</p>



<a name="251650306"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251650306" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251650306">(Sep 02 2021 at 00:42)</a>:</h4>
<p>I don't think the example you shared here would violate the constraint I proposed -- at least, I believe ".where(item.value.exists())" should effectively ignore any group-type items because they have no direct answers. Does this make sense, or am I still confused?</p>



<a name="251650539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251650539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251650539">(Sep 02 2021 at 00:45)</a>:</h4>
<p>You called descendants(), which will pick up the children of the repeated group, namely the items with the same linkId that have answers.</p>



<a name="251651202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251651202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251651202">(Sep 02 2021 at 00:54)</a>:</h4>
<p>But I think I misread your FHIRPath expression.  I thought it was checking that all of the linkId for items with answers are distinct.  Did you mean to put the isDistinct() inside the select(...)?</p>



<a name="251651423"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251651423" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251651423">(Sep 02 2021 at 00:58)</a>:</h4>
<p>I am checking that the linked IDs for items <em>that are sibling members of the same array</em> and also have answers... are unique. I want this to be true for each items array, but not a cross them. In other words, for every item array "A" at any level of the hierarchy: look at just the items of A that have answers, and and sure their link IDs are unique <em>within A</em>.. That's why isDistinct() sits inside of the select.</p>



<a name="251651965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251651965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251651965">(Sep 02 2021 at 01:05)</a>:</h4>
<p>Okay, that looks correct then.  Sorry for the confusion.  I should have tested it first.</p>



<a name="251659912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251659912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251659912">(Sep 02 2021 at 03:11)</a>:</h4>
<p>It's a hard expression to parse in your head :)</p>



<a name="251713123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251713123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251713123">(Sep 02 2021 at 13:18)</a>:</h4>
<p>I'm very open to ideas for better ones. The main thrust is to capture what seems to be implicit knowledge of the rules in an explicit + computable fashion</p>



<a name="251714582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251714582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251714582">(Sep 02 2021 at 13:29)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> Do you see any issue with replacing QuestionnaireResponse<br>
  .union(descendants()) with QuestionnaireResponse.union(repeat(item))?  It avoids picking up a bunch of nodes that won't have items as children.</p>



<a name="251715411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251715411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251715411">(Sep 02 2021 at 13:34)</a>:</h4>
<p>Won't that just find paths like .item.item.item and miss paths like .item.answer.item ?</p>



<a name="251715503"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251715503" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251715503">(Sep 02 2021 at 13:35)</a>:</h4>
<p>There may be a variant of <code>repeat(item | answer)</code> that works though.</p>



<a name="251755916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251755916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251755916">(Sep 02 2021 at 17:46)</a>:</h4>
<div class="codehilite"><pre><span></span><code>(QuestionnaireResponse | repeat(answer | item))
.select(
  item.where(answer.value.exists())
  .linkId.isDistinct())
.allTrue()
</code></pre></div>
<p>This works, I think.</p>



<a name="251760695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251760695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251760695">(Sep 02 2021 at 18:14)</a>:</h4>
<p>Yes, that looks good.  Another issue with descendants() is would pick up resources under "contains"-- so this is better.</p>



<a name="251811016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/Repeating%20answers%20to%20a%20top-level%20question/near/251811016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/Repeating.20answers.20to.20a.20top-level.20question.html#251811016">(Sep 03 2021 at 01:41)</a>:</h4>
<p>Fhirpath ninjas!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
