---
layout: page
title: "FHIR Chat  · FHIRPath SDC example · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html">FHIRPath SDC example</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="251113970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251113970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251113970">(Aug 29 2021 at 07:36)</a>:</h4>
<p>I am working with <span class="user-mention" data-user-id="235060">@Grey Faulkenberry</span> to implement FHIRPath support into a questionnaire filler. I am trying to get the following SDC example to work: <a href="http://build.fhir.org/ig/HL7/sdc/examples.html#using-enablewhen-enablebehavior-and-enablewhenexpression">http://build.fhir.org/ig/HL7/sdc/examples.html#using-enablewhen-enablebehavior-and-enablewhenexpression</a> . I have 2 questions:</p>
<ol>
<li>am I right in assuming that "repeats" is a typo and it should be repeat (no trailing s)?</li>
<li>is there any kind of implicit / polymorphism etc. specified behavior that should allow "answer.toString()" to work as in the example, or should it be "answer.valueDate.toString()"?</li>
</ol>
<p>I am essentially trying to understand whether our code is broken, or the example is incorrect.</p>



<a name="251115448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251115448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251115448">(Aug 29 2021 at 08:05)</a>:</h4>
<p>which repeats would be a typo?</p>



<a name="251115834"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251115834" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251115834">(Aug 29 2021 at 08:13)</a>:</h4>
<p>the one in expression seems a typo indeed</p>



<a name="251119864"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251119864" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251119864">(Aug 29 2021 at 09:26)</a>:</h4>
<p>I am referring to this overall expression <code>"expression": "%resource.repeats(item).where(linkId='4.2.b.1').answer.valueCoding.code ='female' and today().toString().substring(0, 4).toInteger() - %resource.repeats(item).where(linkId='4.2.b.5').answer.toString().substring(0, 4).toInteger() &gt;= 40"</code> <br>
It has <code>repeats(item)</code> in it two times. </p>
<p>My second question is referring to the second half of the example where it says <code>.answer.toString()</code>.</p>



<a name="251123346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251123346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251123346">(Aug 29 2021 at 10:32)</a>:</h4>
<p>I think you are correct in assuming there are 2 issues with the documentation.<br>
I don't know about the implicit casting, and I don0t find it in FHIRPath. The repeats seems a typo. I think the expression should be </p>
<div class="codehilite"><pre><span></span><code>%resource.repeat(item).where(linkId=&#39;4.2.b.1&#39;).answer.valueCoding.code =&#39;female&#39;
and (today().toString().substring(0, 4).toInteger() - %resource.repeat(item).where(linkId=&#39;4.2.b.5&#39;).answer.valueDate.toString().substring(0, 4).toInteger() &gt;= 40)
</code></pre></div>



<a name="251125007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251125007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251125007">(Aug 29 2021 at 11:03)</a>:</h4>
<p>Can others confirm please?<br>
repeats does not exist in fhirpath, should be repeat. And answer.toString does not resolve, should be answer.valueDate.toString</p>



<a name="251125969"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251125969" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251125969">(Aug 29 2021 at 11:21)</a>:</h4>
<p>answer.valueString is not correct either, it is answer.value</p>



<a name="251126019"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251126019" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251126019">(Aug 29 2021 at 11:22)</a>:</h4>
<p>And you can add .toString() to that also.</p>



<a name="251126138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251126138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251126138">(Aug 29 2021 at 11:24)</a>:</h4>
<p>Check the fhirpath spec for how polymorphic types are defined here<br>
<a href="http://hl7.org/fhirpath/#paths-and-polymorphic-items">http://hl7.org/fhirpath/#paths-and-polymorphic-items</a></p>



<a name="251138316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251138316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251138316">(Aug 29 2021 at 15:06)</a>:</h4>
<p>so from this very compact spec, am I right in assuming that only the field name as specified for the choice is valid (if the FHIR spec says <code>fieldname[x]</code>, then I can only use <code>.fieldname</code>, but not <code>.fieldnameString</code>? So the fully correct example would be <code>%resource.repeat(item).where(linkId='4.2.b.1').answer.value.code ='female' and today().toString().substring(0, 4).toInteger() - %resource.repeat(item).where(linkId='4.2.b.5').answer.value.toString().substring(0, 4).toInteger() &gt;= 40</code>?</p>



<a name="251138860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251138860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251138860">(Aug 29 2021 at 15:17)</a>:</h4>
<p>both resolve (according to <a href="https://hl7.github.io/fhirpath.js/">https://hl7.github.io/fhirpath.js/</a>): <br>
<code>answer.value</code> and <code>answer.valueDate.toString()</code></p>



<a name="251139280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251139280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251139280">(Aug 29 2021 at 15:25)</a>:</h4>
<p>But I am wondering whether the latter "valueDate" is merely a side-effect of the JavaScript/JSON based implementation, or should really resolve according to spec.</p>



<a name="251141666"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251141666" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251141666">(Aug 29 2021 at 16:08)</a>:</h4>
<p>valueDate used to be allowed.  It's not officially allowed any longer, though some of the tool stacks still support it.  Can you submit a change request for us to fix the SDC example?</p>



<a name="251142578"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251142578" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tilo Christ <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251142578">(Aug 29 2021 at 16:25)</a>:</h4>
<p>my favourite pastime on a rainy Sunday: <a href="https://jira.hl7.org/browse/FHIR-33262">https://jira.hl7.org/browse/FHIR-33262</a></p>



<a name="251142655"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251142655" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251142655">(Aug 29 2021 at 16:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="192169">Tilo Christ</span> <a href="#narrow/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example/near/251142578">said</a>:</p>
<blockquote>
<p>my favourite pastime on a rainy Sunday: <a href="https://jira.hl7.org/browse/FHIR-33262">https://jira.hl7.org/browse/FHIR-33262</a></p>
</blockquote>
<p>there are worse pastimes... :)</p>



<a name="251142669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251142669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251142669">(Aug 29 2021 at 16:26)</a>:</h4>
<p>does LHCForms support enableWhenExpression?</p>



<a name="251142673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251142673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251142673">(Aug 29 2021 at 16:27)</a>:</h4>
<p><span class="user-mention" data-user-id="195344">@Paul Lynch</span></p>



<a name="251232729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251232729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251232729">(Aug 30 2021 at 13:55)</a>:</h4>
<p>Not yet, but I am hoping to get started on it this week.  I don't think it will be hard it add.  I just need to get some time to work on it.</p>



<a name="251249355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/251249355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#251249355">(Aug 30 2021 at 15:44)</a>:</h4>
<p>thank you</p>



<a name="252369128"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/FHIRPath%20SDC%20example/near/252369128" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example.html#252369128">(Sep 07 2021 at 20:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191832">Jose Costa Teixeira</span> <a href="#narrow/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example/near/251142669">said</a>:</p>
<blockquote>
<p>does LHCForms support enableWhenExpression?</p>
</blockquote>
<p>Just published <a href="http://lhncbc.github.io/lforms/">LHC-Forms</a> 29.3.0 with enableWhenExpression support.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
