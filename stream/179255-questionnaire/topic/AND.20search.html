---
layout: page
title: "FHIR Chat  · AND search · questionnaire"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/index.html">questionnaire</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html">AND search</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="264733798"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264733798" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erwin foxtree <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264733798">(Dec 13 2021 at 16:42)</a>:</h4>
<p>Hi, I'm trying to search a Hapi FHIR server for questionnaires that match both a particular cpt code ("focus") and coverage code ("program").</p>
<p>The Hapi server has two questionnaires having a <code>useContext</code> that looks as follows:</p>
<div class="codehilite"><pre><span></span><code>&quot;useContext&quot;: [ {
        &quot;code&quot;: {
          &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/usage-context-type&quot;,
          &quot;code&quot;: &quot;program&quot;
        },
        &quot;valueCodeableConcept&quot;: {
          &quot;coding&quot;: [ {
            &quot;system&quot;: &quot;http://XYZ&quot;,
            &quot;code&quot;: &quot;105&quot;
          } ]
        }
      }, {
        &quot;code&quot;: {
          &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/usage-context-type&quot;,
          &quot;code&quot;: &quot;focus&quot;
        },
        &quot;valueCodeableConcept&quot;: {
          &quot;coding&quot;: [ {
            &quot;system&quot;: &quot;http://www.ama-assn.org/go/cpt&quot;,
            &quot;code&quot;: &quot;70480&quot;
          } ]
        }
      } ],
</code></pre></div>
<p>(Both fragments are identical for each questionnaire, except for the program code being "105" vs "104")</p>
<p>Each of the following searches returns one or the other questionnaire:</p>
<p><a href="http://localhost:8080/cqf-ruler-r4/fhir/Questionnaire?context-type-value=focus$http://www.ama-assn.org/go/cpt|70480&amp;context-type-value=program$http://XYZ|104">http://localhost:8080/cqf-ruler-r4/fhir/Questionnaire?context-type-value=focus$http://www.ama-assn.org/go/cpt|70480&amp;context-type-value=program$http://XYZ|104</a></p>
<p><a href="http://localhost:8080/cqf-ruler-r4/fhir/Questionnaire?context-type-value=focus$http://www.ama-assn.org/go/cpt|70480&amp;context-type-value=program$http://XYZ|105">http://localhost:8080/cqf-ruler-r4/fhir/Questionnaire?context-type-value=focus$http://www.ama-assn.org/go/cpt|70480&amp;context-type-value=program$http://XYZ|105</a></p>
<p>However, the if I replace "program" with "focus" in the URLs, I still get the same results, eg:</p>
<p><a href="http://localhost:8080/cqf-ruler-r4/fhir/Questionnaire?context-type-value=focus$http://www.ama-assn.org/go/cpt|70480&amp;context-type-value=focus$http://XYZ|105">http://localhost:8080/cqf-ruler-r4/fhir/Questionnaire?context-type-value=focus$http://www.ama-assn.org/go/cpt|70480&amp;context-type-value=focus$http://XYZ|105</a><br>
(^this should return 0 results?)</p>
<p>...what's the correct way to yield the intersection / "AND" results for both focus and program?</p>



<a name="264735631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264735631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264735631">(Dec 13 2021 at 16:55)</a>:</h4>
<p>That sounds like a bug in HAPI to me.   I would not expect context-type-value=focus$http://XYZ|105 to find anything.</p>



<a name="264783106"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264783106" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264783106">(Dec 13 2021 at 23:00)</a>:</h4>
<p>You should be getting the intersection now...  What do you see in the 'self' link returned by the HAPI server?  Is it paying attention to both parameters?</p>



<a name="264896677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264896677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erwin foxtree <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264896677">(Dec 14 2021 at 17:45)</a>:</h4>
<p>Thanks for all the replies.   I'm dealing w/ an inherited, somewhat complicated codebase that's similar to the set of microservices associated w/ the <a href="https://github.com/HL7-DaVinci/prior-auth">https://github.com/HL7-DaVinci/prior-auth</a> reference implementation. </p>
<p>It's difficult to to ascertain whether this is actually problem w/ the <code>cqf-ruler</code> service, or something else.</p>
<p>However, the following search appears to behave correctly:</p>
<p><a href="http://localhost:8080/cqf-ruler-r4/search?serverId=home&amp;pretty=true&amp;_summary=&amp;resource=Questionnaire&amp;param.0.0=http%3A%2F%2Fwww.ama-assn.org%2Fgo%2Fcpt&amp;param.0.1=70480&amp;param.0.name=context&amp;param.0.type=token&amp;param.1.0=http%3A%2F%2FXYZ&amp;param.1.1=105&amp;param.1.name=context&amp;param.1.type=token">http://localhost:8080/cqf-ruler-r4/search?serverId=home&amp;pretty=true&amp;_summary=&amp;resource=Questionnaire&amp;param.0.0=http%3A%2F%2Fwww.ama-assn.org%2Fgo%2Fcpt&amp;param.0.1=70480&amp;param.0.name=context&amp;param.0.type=token&amp;param.1.0=http%3A%2F%2FXYZ&amp;param.1.1=105&amp;param.1.name=context&amp;param.1.type=token</a></p>
<p>Stripping out the empty values, for clarity:</p>
<div class="codehilite"><pre><span></span><code>http://localhost:8080/cqf-ruler-r4/search?serverId=home&amp;

resource=Questionnaire&amp;

param.0.0=http%3A%2F%2Fwww.ama-assn.org%2Fgo%2Fcpt&amp;
param.0.1=70480&amp;
param.0.name=context&amp;
param.0.type=token&amp;

param.1.0=http%3A%2F%2FXYZ&amp;
param.1.1=105&amp;
param.1.name=context&amp;
param.1.type=token&amp;
</code></pre></div>



<a name="264896792"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264896792" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erwin foxtree <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264896792">(Dec 14 2021 at 17:46)</a>:</h4>
<p>(I am wondering about where this search param notation comes from, and whether it's an official part of any FHIR spec...)</p>



<a name="264899079"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264899079" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264899079">(Dec 14 2021 at 17:58)</a>:</h4>
<p>Well, technically you're allowed to make up your own SearchParameter definitions, so it's theoretically possible to do this in FHIR, though the notion that there's a whole bunch of grouped parameters that are organized based on the parameter name is completely foreign to FHIR.  It's certainly nothing 'standard' or that a regular FHIR server would recognize without a bunch of customization.</p>



<a name="264902211"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264902211" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erwin foxtree <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264902211">(Dec 14 2021 at 18:20)</a>:</h4>
<p>This is one of the results after using the search-query builder at <a href="http://localhost:8080/cqf-ruler-r4/resource?resource=Questionnaire">http://localhost:8080/cqf-ruler-r4/resource?resource=Questionnaire</a></p>



<a name="264902308"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264902308" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erwin foxtree <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264902308">(Dec 14 2021 at 18:21)</a>:</h4>
<p>(<code>context</code>, vs <code>context-type</code> and <code>context-type-value</code>)</p>



<a name="264902316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264902316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erwin foxtree <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264902316">(Dec 14 2021 at 18:21)</a>:</h4>
<p><a href="/user_uploads/10155/BHWltEyUOhpvTyQQB8xMrLRJ/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/BHWltEyUOhpvTyQQB8xMrLRJ/image.png" title="image.png"><img src="/user_uploads/10155/BHWltEyUOhpvTyQQB8xMrLRJ/image.png"></a></div>



<a name="264902417"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264902417" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> erwin foxtree <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264902417">(Dec 14 2021 at 18:22)</a>:</h4>
<blockquote>
<p>You should be getting the intersection now... What do you see in the 'self' link returned by the HAPI server? Is it paying attention to both parameters?</p>
</blockquote>
<p>The <code>self</code> link in the questionnaire resource looks normal, AFAICT:<br>
<a href="http://ABC/Questionnaire/&lt;Condition&gt;Program105">http://ABC/Questionnaire/&lt;Condition&gt;Program105</a></p>
<p>and the bundle <code>self</code> link is:<br>
<a href="http://localhost:8080/cqf-ruler-r4/fhir/Questionnaire?context-type-value=focus%24http%3A%2F%2Fwww.ama-assn.org%2Fgo%2Fcpt%7C70480&amp;context-type-value=focus%24http%3A%2F%2FXYZ%7C105">http://localhost:8080/cqf-ruler-r4/fhir/Questionnaire?context-type-value=focus%24http%3A%2F%2Fwww.ama-assn.org%2Fgo%2Fcpt%7C70480&amp;context-type-value=focus%24http%3A%2F%2FXYZ%7C105</a></p>
<p>(which is properly escaped, but: still yields 1 hit)</p>



<a name="264925542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179255-questionnaire/topic/AND%20search/near/264925542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179255-questionnaire/topic/AND.20search.html#264925542">(Dec 14 2021 at 21:07)</a>:</h4>
<p>Have you tried asking on <a class="stream" data-stream-id="179167" href="/#narrow/stream/179167-hapi">#hapi</a> ?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
