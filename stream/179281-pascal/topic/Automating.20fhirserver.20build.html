---
layout: page
title: "FHIR Chat  · Automating fhirserver build · pascal"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/index.html">pascal</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html">Automating fhirserver build</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="255914821"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255914821" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255914821">(Oct 03 2021 at 02:06)</a>:</h4>
<p>I'm new to pascal (well, I mean, beyond nerd camp for nerds in the mid 90's) and looking at Grahame's instructions for compiling the fhirserver (<a href="https://github.com/grahamegrieve/fhirserver/blob/master/linux-install-instructions.txt">https://github.com/grahamegrieve/fhirserver/blob/master/linux-install-instructions.txt</a>. Aim is to get a dockerized build process that's automated and repeatable, all from the commandline (i.e., without a desktop environment if possible).</p>
<p>I'm installing on ubuntu 20.04 starting from the 3 packages at <a href="https://sourceforge.net/projects/lazarus/files/Lazarus%20Linux%20amd64%20DEB/Lazarus%202.2RC1/">https://sourceforge.net/projects/lazarus/files/Lazarus%20Linux%20amd64%20DEB/Lazarus%202.2RC1/</a></p>
<p>After following <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>'s README steps I can do:</p>
<div class="codehilite"><pre><span></span><code>lazbuild work/fhirserver/packages/fhir.lpk
lazbuild work/fhirserver/packages/fhir4.lpk
</code></pre></div>

<p>with a bunch of warnings, hints, and notes -- but no errors. That's good, right? Do I need to compile other lpks in that packages directory too?  What needs to happen next? (I don't see any executable outputs when I look with <code>find work/fhirserver -executable -type f</code>.)</p>



<a name="255917470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255917470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255917470">(Oct 03 2021 at 02:57)</a>:</h4>
<p>you need to compile all those packages yes</p>



<a name="255917530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255917530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255917530">(Oct 03 2021 at 02:58)</a>:</h4>
<p>once you've compiled all those packages, then you need to compile work/fhirserver/server/fhirserver.lpi</p>



<a name="255917542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255917542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255917542">(Oct 03 2021 at 02:58)</a>:</h4>
<p>that will produce the executable</p>



<a name="255917560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255917560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255917560">(Oct 03 2021 at 02:59)</a>:</h4>
<blockquote>
<p>a dockerized build process that's automated and repeatable</p>
</blockquote>
<p>That'll be a lovely outcome I'd really like</p>



<a name="255917694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255917694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255917694">(Oct 03 2021 at 03:00)</a>:</h4>
<p>and that you got fhir.lpk to build makes it very likely you'll get all the way - that includes all the code I know that depends on recent features of lazarus</p>



<a name="255920047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255920047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255920047">(Oct 03 2021 at 03:46)</a>:</h4>
<p>OK, a couple of issues:</p>
<div class="codehilite"><pre><span></span><code>#14 15.18 (3104) Compiling /work/fhirserver/library/wp/wp_types.pas
#14 15.18 /work/fhirserver/library/wp/wp_types.pas(35,3) Fatal: (10022) Can&#39;t find unit Windows used by wp_types
#14 15.30 Fatal: (1018) Compilation aborted
#14 15.30 Error: /usr/bin/ppcx64 returned an error exitcode
#14 15.30 Error: (lazarus) Compile package fhir_wp 0.0: stopped with exit code 1
#14 15.30 Error: (lazbuild) fhir_wp 0.0 compilation failed
</code></pre></div>
<p>If I skip <code>fhir_wp</code>, compiling the rest of the packages works, but when I move on to compiling <code>server/fhirserver.lpi</code> I see:</p>
<div class="codehilite"><pre><span></span><code> &gt; [11/11] RUN lazbuild work/fhirserver/server/fhirserver.lpi:
#15 1.630 Hint: (lazarus) [RunTool] &quot;/usr/bin/fpc&quot; &quot;-iWTOTP&quot;
#15 1.630 Hint: (lazarus) [RunTool] &quot;/usr/bin/fpc&quot; &quot;-va&quot; &quot;compilertest.pas&quot;
#15 1.630 Hint: (lazarus) [RunTool] &quot;/usr/bin/fpc&quot; &quot;-iWTOTP&quot; &quot;-Px86_64&quot; &quot;-Tlinux&quot;
#15 1.630 Hint: (lazarus) [RunTool] &quot;/usr/bin/fpc&quot; &quot;-va&quot; &quot;compilertest.pas&quot; &quot;-Px86_64&quot; &quot;-Tlinux&quot;
#15 2.022 ### TCodeToolManager.HandleException: [20170422130152] &quot;include file not found &quot;fhir.inc&quot;&quot; at Line=31 Col=5 in &quot;/work/fhirserver/server/fhirserver.lpr&quot;
#15 2.022 Error: (lazbuild) Broken dependency: MarkdownTests
</code></pre></div>
<p>This is after <code>lazbuild work/delphi-markdown/packages/markdownengine.lpk</code>, but I can't tell whether that actually includes MarkdownTests. If I try doing <code>lazbuild work/delphi-markdown/tests/markdowntests.lpk</code> before building the server, I get on to some new errors that have to do with windows32 platform (?)</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>win32 errors?</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite"><pre><span></span><code>#16 1.680 Hint: (lazarus) [RunTool] &quot;/usr/bin/fpc&quot; &quot;-iWTOTP&quot; &quot;-Pi386&quot; &quot;-Twin32&quot;
#16 1.680 Warning: [TPCTargetConfigCache.Update] cannot find real compiler for this platform: Compiler=&quot;/usr/bin/fpc&quot; Options=&quot;-Pi386 -Twin32&quot; RealCompiler=&quot;&quot;
#16 1.777 Hint: (lazarus) Missing state file of LCL 2.2.0.1: /usr/share/lazarus/2.2.0RC1/lcl/units/i386-win32/win32/LCL.compiled
#16 1.777 Hint: (lazarus) Missing state file of LazControls 1.0.1: /usr/share/lazarus/2.2.0RC1/components/lazcontrols/lib/i386-win32/win32/LazControls.compiled
#16 1.781 Hint: (lazarus) Missing state file of lclextensions_package 0.6.1: /usr/share/lazarus/2.2.0RC1/components/lclextensions/lib/i386-win32-win32/lclextensions_package.compiled
#16 1.787 Hint: (lazarus) Missing state file of markdowntests 0.0: /work/delphi-markdown/tests/lib/i386-win32/markdowntests.compiled
#16 1.787 Hint: (lazarus) Missing state file of SynEdit 1.0: /usr/share/lazarus/2.2.0RC1/components/synedit/units/i386-win32/win32/SynEdit.compiled
#16 1.817 Hint: (lazarus) Missing state file of FPCUnitTestRunner 0.1: /usr/share/lazarus/2.2.0RC1/components/fpcunit/lib/i386-win32/win32/FPCUnitTestRunner.compiled
#16 1.817 Hint: (lazarus) Missing state file of IDEIntf 1.0: /usr/share/lazarus/2.2.0RC1/components/ideintf/units/i386-win32/win32/IDEIntf.compiled
#16 1.842 Hint: (lazarus) Missing state file of laz.virtualtreeview_package 5.5.3.1: /usr/share/lazarus/2.2.0RC1/components/virtualtreeview/lib/i386-win32-win32/laz.virtualtreeview_package.compiled
#16 1.842 Hint: (lazarus) Missing state file of PascalTZ 2.2: /work/PascalTZ/package/lib/i386-win32/PascalTZ.compiled
#16 1.856 Hint: (lazarus) Missing state file of fhir_fsl 0.0: /work/fhirserver/packages/lib/i386-win32/fhir_fsl.compiled
#16 1.856 ### TCodeToolManager.HandleException: [20170422130152] &quot;include file not found &quot;fhir.inc&quot;&quot; at Line=31 Col=5 in &quot;/work/fhirserver/library/fsl/fsl_java_utilities.pas&quot;
#16 1.895 Hint: (lazarus) Missing state file of idetester 0.0: /work/lazarus-ide-tester/package/lib/i386-win32/idetester.compiled
#16 1.895 Hint: (lazarus) Missing state file of fhir 0.0: /work/fhirserver/packages/lib/i386-win32/fhir.compiled
#16 2.055 Hint: (lazarus) Missing state file of fhir2 0.0: /work/fhirserver/packages/lib/i386-win32/fhir2.compiled
#16 2.055 Hint: (lazarus) Missing state file of fhir3 0.0: /work/fhirserver/packages/lib/i386-win32/fhir3.compiled
#16 2.365 Hint: (lazarus) Missing state file of fhir4 0.0: /work/fhirserver/packages/lib/i386-win32/fhir4.compiled
#16 2.365 Hint: (lazarus) Missing state file of fhir5 0.0: /work/fhirserver/packages/lib/i386-win32/fhir5.compiled
#16 2.365 Hint: (lazarus) Missing state file of fhir_fui 0.0: /work/fhirserver/packages/lib/i386-win32/fhir_fui.compiled
#16 2.452 Hint: (lazarus) Missing state file of fhir_xver 0.0: /work/fhirserver/packages/lib/i386-win32/fhir_xver.compiled
#16 2.452 Error: ppc386 can&#39;t be executed, error message: Failed to execute &quot;ppc386&quot;, error code: 127
#16 2.506 Error: (lazarus) Compile package FCL 1.0.1: stopped with exit code 1
#16 2.506 Error: (lazarus) [TLazPackageGraph.CompileRequiredPackages] &quot;Exit code 1&quot;
#16 2.506 Error: (lazbuild) Project dependencies of /work/fhirserver/server/fhirserver.lpi
</code></pre></div>
</div></div>



<a name="255922637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255922637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255922637">(Oct 03 2021 at 04:36)</a>:</h4>
<p>SO:</p>



<a name="255922688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255922688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255922688">(Oct 03 2021 at 04:37)</a>:</h4>
<ul>
<li>fhir_wp - don't compile that. I forgot it was there</li>
<li>markdowntests - yes, I missed that. Have to add that to the package list</li>
<li>the last error.... don't know why you're compiling for win32 at all</li>
</ul>



<a name="255922774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255922774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255922774">(Oct 03 2021 at 04:39)</a>:</h4>
<p>I think you need --build-mode=Linux</p>



<a name="255922795"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255922795" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255922795">(Oct 03 2021 at 04:39)</a>:</h4>
<p>btw, once you've built it, it won't run. I'm working on that now - some .so dependency issue, and I find them very hard to figure out (won't run on OSX for the same reason, different .dylib)</p>



<a name="255935297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255935297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255935297">(Oct 03 2021 at 08:36)</a>:</h4>
<p>well, if I could figure out how to commit from my linux dev PC, it would run, but the personal access token thing seems specifically designed to keep me out</p>



<a name="255936953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255936953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255936953">(Oct 03 2021 at 09:05)</a>:</h4>
<p>sorted that out. it should run, at least, though I have a lot of testing to do.</p>



<a name="255937032"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255937032" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255937032">(Oct 03 2021 at 09:06)</a>:</h4>
<p>Here's my experience with cross platform development, when I run into a problem:</p>
<ul>
<li>windows: I find the answer immediately </li>
<li>linux : I find hundreds of different answers, one of which might be correct for me, but I can't figure out which</li>
<li>macos: I can't find <em>anything</em></li>
</ul>



<a name="255938687"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255938687" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255938687">(Oct 03 2021 at 09:36)</a>:</h4>
<p>brew tells me that openSSL 1.1 is installed... but I can't find the dylib files. Where should I look?</p>



<a name="255939311"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255939311" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255939311">(Oct 03 2021 at 09:47)</a>:</h4>
<blockquote>
<p>openssl failed to load: dlopen(libssl.1.1.dylib, 1): image not found</p>
</blockquote>
<p>So I can't find it and neither can my program</p>



<a name="255939354"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255939354" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255939354">(Oct 03 2021 at 09:48)</a>:</h4>
<p>but brew says:</p>



<a name="255939374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/255939374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#255939374">(Oct 03 2021 at 09:48)</a>:</h4>
<blockquote>
<p>brew install <a href="mailto:openssl@1.1">openssl@1.1</a><br>
Warning: <a href="mailto:openssl@1.1">openssl@1.1</a> 1.1.1l is already installed and up-to-date.<br>
To reinstall 1.1.1l, run:<br>
 brew reinstall <a href="mailto:openssl@1.1">openssl@1.1</a></p>
</blockquote>



<a name="256002085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256002085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256002085">(Oct 04 2021 at 03:41)</a>:</h4>
<p>Will try with <code>--buildmode=Linux</code>. Alas I can't help on the MacOS / brew front</p>



<a name="256003558"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256003558" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256003558">(Oct 04 2021 at 04:05)</a>:</h4>
<p>Build succeeds with <code>--build-mode=Linux</code>.  I see when I try running it that at least libChakraCore is missing.</p>



<a name="256003711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256003711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256003711">(Oct 04 2021 at 04:08)</a>:</h4>
<p>that should be resolved now.</p>



<a name="256003761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256003761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256003761">(Oct 04 2021 at 04:09)</a>:</h4>
<p>no. somehow git beat me, and the code to fix that wasn't pushed</p>



<a name="256004076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256004076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256004076">(Oct 04 2021 at 04:15)</a>:</h4>
<p>OK -- I see when I manually install chakraCore I get X related errors. I don't know if the server needs a graphical environment, but I've updated <a href="https://github.com/jmandel/fhirserver/blob/patch-3/Dockerfile">https://github.com/jmandel/fhirserver/blob/patch-3/Dockerfile</a> to give it one...</p>



<a name="256004182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256004182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256004182">(Oct 04 2021 at 04:16)</a>:</h4>
<p>At which point it fails to find <code>/work/fhirserver/exec/64/tz.dat</code> (I note that <code>/work/fhirserver/exec/pack/tz.dat</code> does exist, and if I try to copy this file to the other path and re-run the <code>fhirserver</code>, I get a segfault.)</p>



<a name="256006205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256006205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256006205">(Oct 04 2021 at 04:52)</a>:</h4>
<p>hmm. you shouldn't. the one in /pack is the correct file - it will need all the .dat files in there</p>



<a name="256006222"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256006222" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256006222">(Oct 04 2021 at 04:52)</a>:</h4>
<p>how did you manually install chakracore?</p>



<a name="256006327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256006327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256006327">(Oct 04 2021 at 04:54)</a>:</h4>
<p><a href="https://github.com/jmandel/fhirserver/blob/dc43a3a0c10e0fe6ac83daf09725dc9d5b952d07/Dockerfile#L45">https://github.com/jmandel/fhirserver/blob/dc43a3a0c10e0fe6ac83daf09725dc9d5b952d07/Dockerfile#L45</a></p>



<a name="256006359"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256006359" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256006359">(Oct 04 2021 at 04:55)</a>:</h4>
<p>just copy it into /usr/lib? weird. I'd <em>never</em> do that on windows.</p>



<a name="256006379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256006379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256006379">(Oct 04 2021 at 04:55)</a>:</h4>
<p>anyway, the one in pack should go next to the executable, but the compiler flag for that didn't get pushed.</p>



<a name="256006458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256006458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256006458">(Oct 04 2021 at 04:56)</a>:</h4>
<p>(I'm not sure if that's the right way to install; I was just trying to get past the error)</p>



<a name="256006480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256006480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256006480">(Oct 04 2021 at 04:57)</a>:</h4>
<p>ok</p>



<a name="256007038"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256007038" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256007038">(Oct 04 2021 at 05:05)</a>:</h4>
<p>I just hate git</p>



<a name="256007137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256007137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256007137">(Oct 04 2021 at 05:07)</a>:</h4>
<p>well....... maybe that will sort it.... maybe.</p>



<a name="256007213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256007213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256007213">(Oct 04 2021 at 05:08)</a>:</h4>
<p>so with that commit, chakracore should be in the exec/64  folder now</p>



<a name="256014263"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256014263" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256014263">(Oct 04 2021 at 06:59)</a>:</h4>
<p>the next issue for me to resolve is to get sqlite working on linux</p>



<a name="256031123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256031123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256031123">(Oct 04 2021 at 09:40)</a>:</h4>
<p>nothing special there - standard install of sqlite3 and dev tools, and it's good to go. </p>
<p>These parameters should do the trick:</p>
<p><code>-cmd exec -cfg http://tx.fhir.org/config -version 4 </code></p>



<a name="256031196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256031196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256031196">(Oct 04 2021 at 09:40)</a>:</h4>
<p>it defaults to running on port 80. if you want a different port, create a file web.ini in the same directory:</p>
<div class="codehilite" data-code-language="INI"><pre><span></span><code><span class="k">[web]</span>
<span class="na">http</span><span class="o">=</span><span class="s">{port}</span>
</code></pre></div>



<a name="256068883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256068883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256068883">(Oct 04 2021 at 14:34)</a>:</h4>
<p>I'm running with these updated args, but still seeing </p>
<div class="codehilite"><pre><span></span><code>EFOpenError: Unable to open file &quot;/work/fhirserver/exec/64/tz.dat&quot;: No such file or directory
</code></pre></div>

<p>(This is on commit 80bdd22ae24f9f21798b9ce5882de2d183a5b53c of fhirserver.)</p>



<a name="256102731"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256102731" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256102731">(Oct 04 2021 at 17:55)</a>:</h4>
<p>and that file exists?</p>



<a name="256184097"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256184097" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256184097">(Oct 05 2021 at 06:20)</a>:</h4>
<p>yay well, the server runs on OSX now</p>



<a name="256184137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256184137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256184137">(Oct 05 2021 at 06:21)</a>:</h4>
<p>figuring out the install won't be much fun... every .dylib will hurt</p>



<a name="256229527"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256229527" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256229527">(Oct 05 2021 at 11:41)</a>:</h4>
<p>Is the Linux install working?</p>



<a name="256229826"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256229826" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256229826">(Oct 05 2021 at 11:42)</a>:</h4>
<p>I can test it during the weekend - I can either test the installation, or test the server if the install goes well</p>



<a name="256261917"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256261917" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256261917">(Oct 05 2021 at 15:04)</a>:</h4>
<blockquote>
<p>Grahame Grieve: and that file exists?</p>
</blockquote>
<p>No, <code>/work/fhirserver/exec/64/</code> has only the fhirserver binary inside.</p>



<a name="256297907"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256297907" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256297907">(Oct 05 2021 at 18:46)</a>:</h4>
<p>so the files in exec/pack and exec/pack/linux need to be copied into exec/64 before executing</p>



<a name="256299708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256299708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256299708">(Oct 05 2021 at 18:58)</a>:</h4>
<p>I know I got it most of the way there on Linux the last time that I tried, but that's been a little while now.  I may try to dust it off and give it another try there, too (also probably over the weekend).</p>



<a name="256302133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256302133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256302133">(Oct 05 2021 at 19:12)</a>:</h4>
<p>it's a lot easier now. And Josh's work is making it easier</p>



<a name="256326922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256326922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256326922">(Oct 05 2021 at 22:09)</a>:</h4>
<blockquote>
<p>figuring out the install won't be much fun... every .dylib will hurt</p>
</blockquote>
<p>Not sure if this might help, but homebrew (macOS) creates symlinks to many .dylib files under /usr/local/lib.  OpenSSL seems to be an exception.</p>
<blockquote>
<p>$ brew info openssl<br>
...<br>
openssl&#64;1.1 is keg-only, which means it was not symlinked into /usr/local,<br>
because macOS provides LibreSSL.</p>
</blockquote>



<a name="256330956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256330956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256330956">(Oct 05 2021 at 22:47)</a>:</h4>
<p>Adding the relevant <code>cp</code>s for those config files. Now I see:</p>
<div class="codehilite"><pre><span></span><code>/work/fhirserver/library/fdb/fdb_odbc_fpc.pas(52,1) Fatal: (2002) illegal character &quot;&#39;!&#39;&quot; ($21)
</code></pre></div>

<p>which may be a new source code error in the repo?</p>



<a name="256331049"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256331049" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256331049">(Oct 05 2021 at 22:48)</a>:</h4>
<p>I committed a fix for that several hours ago</p>



<a name="256331089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256331089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256331089">(Oct 05 2021 at 22:49)</a>:</h4>
<p>I git pulled 60sec ago</p>



<a name="256331276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256331276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256331276">(Oct 05 2021 at 22:51)</a>:</h4>
<p>well... git on my linux box says that line is fixed, and everything is committed and pushed.</p>



<a name="256331335"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256331335" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256331335">(Oct 05 2021 at 22:51)</a>:</h4>
<p>but it's very evidently not the case</p>



<a name="256331595"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256331595" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256331595">(Oct 05 2021 at 22:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191926">@Joel Schneider</span> the problem is, so far I can only get the dylibs to load by providing a full path (including version) to the dylibs at their source. But what would I deploy for other users? I find OSX really very hostile.</p>



<a name="256342760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256342760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256342760">(Oct 06 2021 at 01:00)</a>:</h4>
<p>Now at <code>956a0a7b1b45555a5af3b5285853d573c1efb266</code>:</p>
<div class="codehilite"><pre><span></span><code>/work/fhirserver/server/remote_config.pas(414,18) Error: (5000) Identifier not found &quot;UniversalDateTime&quot;
/work/fhirserver/server/remote_config.pas(421,91) Error: (5000) Identifier not found &quot;UniversalDateTime&quot;
remote_config.pas(491) Fatal: (10026) There were 2 errors compiling module, stopping
Fatal: (1018) Compilation aborted
</code></pre></div>



<a name="256377880"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256377880" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256377880">(Oct 06 2021 at 08:45)</a>:</h4>
<p>really? more git won't commit for me. I wish I understood :-(</p>



<a name="256406755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256406755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256406755">(Oct 06 2021 at 13:03)</a>:</h4>
<p>Hrm. We should dig into these git issues. Maybe record a screen cast or something?</p>



<a name="256416479"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256416479" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256416479">(Oct 06 2021 at 14:03)</a>:</h4>
<p>not sure. I decided to try living with git command line. I made my changes and then git commit -a and git push. Said it had, and nothing more to do, but the changes disappeared. I've moved on, rebuilt the repo and installed gitkraken, which is working as I expected</p>



<a name="256416519"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256416519" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256416519">(Oct 06 2021 at 14:03)</a>:</h4>
<p>anyway, compile issues should be sorted now</p>



<a name="256417509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256417509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256417509">(Oct 06 2021 at 14:10)</a>:</h4>
<p>Okay. If gitkraken works for you, great! (The git cli has a learning curve but it's not, like, buggy/lossy.)</p>



<a name="256417570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256417570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256417570">(Oct 06 2021 at 14:10)</a>:</h4>
<p>Rebuilding now...</p>



<a name="256418249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256418249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256418249">(Oct 06 2021 at 14:14)</a>:</h4>
<p>For the dependencies in this project</p>
<div class="codehilite"><pre><span></span><code>    git clone https://github.com/dezlov/PascalTZ &amp;&amp; \
    git clone https://github.com/grahamegrieve/delphi-markdown &amp;&amp; \
    git clone https://github.com/mriscoc/extrasyn &amp;&amp; \
    git clone https://github.com/grahamegrieve/HtmlViewer &amp;&amp; \
    git clone https://github.com/grahamegrieve/lazarus-ide-tester &amp;&amp; \
    git clone https://github.com/Xor-el/QRCodeGenLib4Pascal
</code></pre></div>
<p>...  how do you version these in your development / when do you update them? I'm thinking I should be cloning a specific tag or commit to avoid surprises as these evolve.</p>



<a name="256420525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256420525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256420525">(Oct 06 2021 at 14:29)</a>:</h4>
<p>I haven't considered that. They're pretty stable but I probably should. I may have to fork them</p>



<a name="256420750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256420750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256420750">(Oct 06 2021 at 14:30)</a>:</h4>
<p>If you just want to pin to a git tag or hash, you don't need to fork. If you want to make your own changes... well, fork time.</p>



<a name="256421310"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256421310" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256421310">(Oct 06 2021 at 14:33)</a>:</h4>
<p>Hmm, following your instructions I have two copies o-f <a href="http://libChakraCore.so">libChakraCore.so</a>:</p>
<div class="codehilite"><pre><span></span><code>$ find /work/fhirserver/ | grep -i chakraCore.so
/work/fhirserver/exec/pack/linux/libChakraCore.so
/work/fhirserver/exec/64/libChakraCore.so
</code></pre></div>
<p>... but the fhirserver executable isn't finding these. (I can revert to putting this in /usr/lib, where the fhirserver finds it. Overall I wouldn't check 45MB compiled libraries into your git source tree, since the libChakraCore team already makes these available in a published release.)</p>
<p>Anyway, after putting the lib in a good spot I get:</p>
<div class="codehilite"><pre><span></span><code>fhirserver: malloc.c:3839: _int_malloc: Assertion `chunk_main_arena (bck-&gt;bk)&#39; failed.
</code></pre></div>



<a name="256474397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256474397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256474397">(Oct 06 2021 at 19:57)</a>:</h4>
<p>running out of memory?</p>



<a name="256480537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256480537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256480537">(Oct 06 2021 at 20:40)</a>:</h4>
<p>Definitely not -- this happens instantaneously and I have ~32GB free.</p>



<a name="256488132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256488132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256488132">(Oct 06 2021 at 21:31)</a>:</h4>
<p>no, I'm at a loss. this is ubuntu?</p>



<a name="256489573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256489573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256489573">(Oct 06 2021 at 21:43)</a>:</h4>
<p>Yes, built according to the dockerfile I shared</p>



<a name="256489857"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256489857" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256489857">(Oct 06 2021 at 21:45)</a>:</h4>
<p>It actually generates various outputs when it fails.</p>



<a name="256490136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490136">(Oct 06 2021 at 21:48)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
<p>A medium-sized output</p>
</div><div class="spoiler-content" aria-hidden="true">
<h1>/work/fhirserver/exec/64/fhirserver</h1>
<p>[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000435B73<br>
Exception at 0000000000435B73: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000ED369C<br>
  $00000000007D8FE6  TRYGETVALUE,  line 601 of inc/generics.dictionaries.inc<br>
  $00000000007DAB34  DESTROY,  line 946 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000838100  DESTROY,  line 1631 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000849314  DESTROY,  line 1212 of ../library/fsl/fsl_threads.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000844C15  DELETERANGE,  line 1905 of ../library/fsl/fsl_base.pas<br>
  $0000000000842FCC  SETCOUNT,  line 1382 of ../library/fsl/fsl_base.pas<br>
  $0000000000844FCA  CLEAR,  line 1911 of ../library/fsl/fsl_base.pas<br>
  $0000000000843E83  DESTROY,  line 1629 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $000000000084A8EA  DESTROY,  line 1441 of ../library/fsl/fsl_threads.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000846B4C  DONEUNIT,  line 684 of ../library/fsl/fsl_threads.pas<br>
  $000000000084C6B9  FSL_THREADS_$$_finalize$,  line 1802 of ../library/fsl/fsl_threads.pas<br>
Exception at 0000000000ED369C: EAccessViolation:<br>
Access violation.<br>
realloc(): invalid old size<br>
Aborted (core dumped)</p>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>A shorter output</p>
</div><div class="spoiler-content" aria-hidden="true">
<h1>/work/fhirserver/exec/64/fhirserver</h1>
<p>[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000435B73<br>
Exception at 0000000000435B73: EAccessViolation:<br>
Access violation.<br>
realloc(): invalid old size<br>
Aborted (core dumped)</p>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>A longer output</p>
</div><div class="spoiler-content" aria-hidden="true">
<h1>/work/fhirserver/exec/64/fhirserver</h1>
<p>[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000435B73<br>
Exception at 0000000000435B73: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000423FD0<br>
  $00000000007D8FE6  TRYGETVALUE,  line 601 of inc/generics.dictionaries.inc<br>
  $00000000007DAB34  DESTROY,  line 946 of ../library/fsl/fsl_base.pas<br>
  $00000000046D872D  DESTROY,  line 420 of ../library/fsl/tests/fsl_testing.pas<br>
Exception at 0000000000423FD0: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000423FD0<br>
  $00000000007D8FE6  TRYGETVALUE,  line 601 of inc/generics.dictionaries.inc<br>
  $00000000007DAB34  DESTROY,  line 946 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $000000000087F350  DESTROY,  line 1631 of fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000888C34  DESTROY,  line 1756 of ../library/fdb/fdb_manager.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $000000000088A958  CLOSEUPGMANAGERS,  line 2084 of ../library/fdb/fdb_manager.pas<br>
  $000000000088D049  FDB_MANAGER_$$_finalize$,  line 2090 of ../library/fdb/fdb_manager.pas<br>
  $0000000000439F47<br>
Exception at 0000000000423FD0: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000423FD0<br>
  $00000000007D8FE6  TRYGETVALUE,  line 601 of inc/generics.dictionaries.inc<br>
  $00000000007DAB34  DESTROY,  line 946 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000830F64  DESTROY,  line 223 of ../library/fsl/fsl_logging.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000832190  DESTROY,  line 476 of ../library/fsl/fsl_logging.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000833EA3  FSL_LOGGING_$$_finalize$,  line 763 of ../library/fsl/fsl_logging.pas<br>
  $0000000000439F47<br>
  $000000000088A958  CLOSEUPGMANAGERS,  line 2084 of ../library/fdb/fdb_manager.pas<br>
  $000000000088D049  FDB_MANAGER_$$_finalize$,  line 2090 of ../library/fdb/fdb_manager.pas<br>
  $0000000000439F47<br>
Exception at 0000000000423FD0: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000423FD0<br>
  $00000000007D8FE6  TRYGETVALUE,  line 601 of inc/generics.dictionaries.inc<br>
  $00000000007DAB34  DESTROY,  line 946 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000838100  DESTROY,  line 1631 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000849307  DESTROY,  line 1211 of ../library/fsl/fsl_threads.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000844C15  DELETERANGE,  line 1905 of ../library/fsl/fsl_base.pas<br>
  $0000000000842FCC  SETCOUNT,  line 1382 of ../library/fsl/fsl_base.pas<br>
  $0000000000844FCA  CLEAR,  line 1911 of ../library/fsl/fsl_base.pas<br>
  $0000000000843E83  DESTROY,  line 1629 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $000000000084A8EA  DESTROY,  line 1441 of ../library/fsl/fsl_threads.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000846B4C  DONEUNIT,  line 684 of ../library/fsl/fsl_threads.pas<br>
  $000000000084C6B9  FSL_THREADS_$$_finalize$,  line 1802 of ../library/fsl/fsl_threads.pas<br>
Exception at 0000000000423FD0: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $000000000042DA88<br>
  $00000000007D7662  DOGETCURRENT,  line 171 of inc/generics.dictionaries.inc<br>
  $00000000007D9D71  ENDUNIT,  line 751 of ../library/fsl/fsl_base.pas<br>
  $00000000007DF3C9  FSL_BASE_$$_finalize$,  line 3330 of ../library/fsl/fsl_base.pas<br>
  $0000000000439F47<br>
  $0000000000846B4C  DONEUNIT,  line 684 of ../library/fsl/fsl_threads.pas<br>
  $000000000084C6B9  FSL_THREADS_$$_finalize$,  line 1802 of ../library/fsl/fsl_threads.pas<br>
  $0000000000439F47<br>
  $0000000000833EA3  FSL_LOGGING_$$_finalize$,  line 763 of ../library/fsl/fsl_logging.pas<br>
  $0000000000439F47<br>
  $000000000088A958  CLOSEUPGMANAGERS,  line 2084 of ../library/fdb/fdb_manager.pas<br>
  $000000000088D049  FDB_MANAGER_$$_finalize$,  line 2090 of ../library/fdb/fdb_manager.pas<br>
  $0000000000439F47<br>
Exception at 000000000042DA88: EAccessViolation:<br>
Access violation.<br>
realloc(): invalid old size<br>
Aborted (core dumped)</p>
</div></div>



<a name="256490379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490379">(Oct 06 2021 at 21:50)</a>:</h4>
<p>what parameters are you running the server with?</p>



<a name="256490453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490453">(Oct 06 2021 at 21:51)</a>:</h4>
<p><a href="https://github.com/jmandel/fhirserver/blob/patch-3/Dockerfile#L64">https://github.com/jmandel/fhirserver/blob/patch-3/Dockerfile#L64</a></p>
<div class="codehilite"><pre><span></span><code>ENTRYPOINT [&quot;/bin/entrypoint.sh&quot;]
CMD [&quot;-cmd&quot;,  &quot;exec&quot;,  &quot;-cfg&quot;, &quot;http://tx.fhir.org/config&quot;, &quot;-version&quot;,  &quot;4&quot;]
</code></pre></div>



<a name="256490552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490552">(Oct 06 2021 at 21:52)</a>:</h4>
<p>This is equivalent to:</p>
<div class="codehilite"><pre><span></span><code>/work/fhirserver/exec/64/fhirserver -cmd exec -cfg http://tx.fhir.org/config -version 4
</code></pre></div>



<a name="256490572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490572">(Oct 06 2021 at 21:52)</a>:</h4>
<p>(I think I just cribbed this from you.)</p>



<a name="256490668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490668">(Oct 06 2021 at 21:53)</a>:</h4>
<p>Actually, those outputs were from running by hand with no args.</p>



<a name="256490689"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490689" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490689">(Oct 06 2021 at 21:53)</a>:</h4>
<p>(As documented in the individual spoilers.)</p>



<a name="256490703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490703">(Oct 06 2021 at 21:53)</a>:</h4>
<p>Here are some more, with the args you supplied:</p>



<a name="256490777"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490777" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490777">(Oct 06 2021 at 21:54)</a>:</h4>
<div class="codehilite"><pre><span></span><code>[xcb] Most likely this is a multi-threaded client and XInitThreads has not been called
</code></pre></div>

<p>^ that's interesting</p>



<a name="256490862"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256490862" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256490862">(Oct 06 2021 at 21:54)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<h1>/work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4</h1>
<p>2021-10-06--------------------------------<br>
21:53:47 00:00:00 FHIR Server 1.9.363 Linux-64/FreePascal +Assertions +Debug<br>
21:53:47 00:00:00 /work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4<br>
21:53:47 00:00:00 Loading Dependencies<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000435B73<br>
[xcb] Unknown sequence number while appending request<br>
[xcb] Most likely this is a multi-threaded client and XInitThreads has not been called<br>
[xcb] Aborting, sorry about that.<br>
fhirserver: ../../src/xcb_io.c:145: append_pending_request: Assertion `!xcb_xlib_unknown_seq_number' failed.<br>
Aborted (core dumped)</p>
<h1>/work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4</h1>
<p>2021-10-06--------------------------------<br>
21:53:52 00:00:00 FHIR Server 1.9.363 Linux-64/FreePascal +Assertions +Debug<br>
21:53:52 00:00:00 /work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4<br>
21:53:52 00:00:00 Loading Dependencies<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000435B73<br>
Exception at 0000000000435B73: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000ED369C<br>
  $00000000007D8FE6  TRYGETVALUE,  line 601 of inc/generics.dictionaries.inc<br>
  $00000000007DAB34  DESTROY,  line 946 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000838100  DESTROY,  line 1631 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000849314  DESTROY,  line 1212 of ../library/fsl/fsl_threads.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000844C15  DELETERANGE,  line 1905 of ../library/fsl/fsl_base.pas<br>
  $0000000000842FCC  SETCOUNT,  line 1382 of ../library/fsl/fsl_base.pas<br>
  $0000000000844FCA  CLEAR,  line 1911 of ../library/fsl/fsl_base.pas<br>
  $0000000000843E83  DESTROY,  line 1629 of ../library/fsl/fsl_base.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $000000000084A8EA  DESTROY,  line 1441 of ../library/fsl/fsl_threads.pas<br>
  $00000000007DAE52  FREE,  line 1011 of ../library/fsl/fsl_base.pas<br>
  $0000000000846B4C  DONEUNIT,  line 684 of ../library/fsl/fsl_threads.pas<br>
  $000000000084C6B9  FSL_THREADS_$$_finalize$,  line 1802 of ../library/fsl/fsl_threads.pas<br>
Exception at 0000000000ED369C: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $00000000004356B8<br>
  $00000000007DF3C9  FSL_BASE_$$_finalize$,  line 3330 of ../library/fsl/fsl_base.pas<br>
  $0000000000439F47<br>
  $0000000000846B4C  DONEUNIT,  line 684 of ../library/fsl/fsl_threads.pas<br>
  $000000000084C6B9  FSL_THREADS_$$_finalize$,  line 1802 of ../library/fsl/fsl_threads.pas<br>
Exception at 00000000004356B8: EAccessViolation:<br>
Access violation.<br>
realloc(): invalid old size<br>
Aborted (core dumped)</p>
<h1>/work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4</h1>
<p>2021-10-06--------------------------------<br>
21:54:08 00:00:00 FHIR Server 1.9.363 Linux-64/FreePascal +Assertions +Debug<br>
21:54:08 00:00:00 /work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4<br>
21:54:08 00:00:00 Loading Dependencies<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000435B73<br>
Exception at 0000000000435B73: EAccessViolation:<br>
Access violation.<br>
realloc(): invalid old size<br>
Aborted (core dumped)</p>
<h1>/work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4</h1>
<p>2021-10-06--------------------------------<br>
21:54:11 00:00:00 FHIR Server 1.9.363 Linux-64/FreePascal +Assertions +Debug<br>
21:54:11 00:00:00 /work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4<br>
21:54:11 00:00:00 Loading Dependencies<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000435B73<br>
Exception at 0000000000435B73: EAccessViolation:<br>
Access violation.<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $00000000004356B8<br>
Exception at 00000000004356B8: EAccessViolation:<br>
Access violation.<br>
realloc(): invalid old size<br>
Aborted (core dumped)</p>
<h1>/work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4</h1>
<p>2021-10-06--------------------------------<br>
21:54:16 00:00:00 FHIR Server 1.9.363 Linux-64/FreePascal +Assertions +Debug<br>
21:54:16 00:00:00 /work/fhirserver/exec/64/fhirserver -cmd exec -cfg <a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a> -version 4<br>
21:54:16 00:00:00 Loading Dependencies<br>
[FORMS.PP] ExceptionOccurred <br>
  Sender=EAccessViolation<br>
  Exception=Access violation<br>
  Stack trace:<br>
  $0000000000435B73<br>
[xcb] Unknown sequence number while appending request<br>
[xcb] Most likely this is a multi-threaded client and XInitThreads has not been called<br>
[xcb] Aborting, sorry about that.<br>
fhirserver: ../../src/xcb_io.c:145: append_pending_request: Assertion `!xcb_xlib_unknown_seq_number' failed.<br>
Aborted (core dumped)</p>
</div></div>



<a name="256491033"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256491033" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256491033">(Oct 06 2021 at 21:56)</a>:</h4>
<p>I'm assuming fhirserver needs an GUI so I've created a framebuffer-backed X display for it to run against; if I don't give it this, I get </p>
<div class="codehilite"><pre><span></span><code>(fhirserver:155): Gtk-WARNING **: 21:55:29.347: cannot open display:
</code></pre></div>



<a name="256491153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256491153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256491153">(Oct 06 2021 at 21:57)</a>:</h4>
<p>it doesn't need a display as far as I'm concerned.</p>



<a name="256491213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256491213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256491213">(Oct 06 2021 at 21:58)</a>:</h4>
<p>I don't understand any of this at all.</p>



<a name="256491251"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256491251" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256491251">(Oct 06 2021 at 21:58)</a>:</h4>
<p>the parameters you're using are correct, and it runs fine for me without all this system craziness</p>



<a name="256491264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256491264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256491264">(Oct 06 2021 at 21:58)</a>:</h4>
<p>why would it be different? it's a console application....</p>



<a name="256492165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256492165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256492165">(Oct 06 2021 at 22:06)</a>:</h4>
<p>Hmm. I honestly don't know. When I look at the server binary I see a 417MB file with 243 of mentions of "X11" inside. What do you see?</p>
<div class="codehilite"><pre><span></span><code># du -h  /work/fhirserver/exec/64/fhirserver
417M    /work/fhirserver/exec/64/fhirserver

# strings /work/fhirserver/exec/64/fhirserver | grep -i x11 | wc -l
243

# strings /work/fhirserver/exec/64/fhirserver | grep -i x11 | head
libgdk-x11-2.0.so.0
gdk_x11_get_default_xdisplay
gdk_window_impl_x11_get_type
gdk_x11_drawable_get_xdisplay
gdk_x11_colormap_get_xdisplay
gdk_x11_cursor_get_xdisplay
gdk_x11_image_get_ximage
gdk_x11_colormap_get_xcolormap
gdk_x11_display_get_xdisplay
gdk_x11_get_default_screen
</code></pre></div>



<a name="256492562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256492562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256492562">(Oct 06 2021 at 22:10)</a>:</h4>
<p>that'</p>



<a name="256492607"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256492607" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256492607">(Oct 06 2021 at 22:10)</a>:</h4>
<p>that's why I asked you about parameters. because some parameters will lead to guis, but we're not interested in them</p>



<a name="256492683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256492683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256492683">(Oct 06 2021 at 22:11)</a>:</h4>
<p>but all those are warnings...?</p>



<a name="256492899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256492899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256492899">(Oct 06 2021 at 22:13)</a>:</h4>
<p>The spoilers I included above are the console output of the commands in big font. They don't look like warnings, but hard errors for the most part.</p>



<a name="256493127"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256493127" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256493127">(Oct 06 2021 at 22:15)</a>:</h4>
<p>but you said the spoilers were running without parameters?</p>



<a name="256493651"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256493651" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256493651">(Oct 06 2021 at 22:19)</a>:</h4>
<p>The first set, yes. And then I posted another one. Each one has the full command I ran at the top</p>



<a name="256494054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256494054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256494054">(Oct 06 2021 at 22:22)</a>:</h4>
<p>I see the same command, different outcomes. so it's not predictable? or there's more going on?</p>



<a name="256494928"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256494928" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256494928">(Oct 06 2021 at 22:30)</a>:</h4>
<p>well, I suspect that the problem is the openSSL dependency, but I added some more logging, so try again</p>



<a name="256495547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256495547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256495547">(Oct 06 2021 at 22:36)</a>:</h4>
<p>I do see hints of that when I strace the execution -- it first looks for X11 libraries in a "./tls" directory.</p>



<a name="256495749"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256495749" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256495749">(Oct 06 2021 at 22:38)</a>:</h4>
<p>nothing to do with me...</p>



<a name="256495768"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256495768" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256495768">(Oct 06 2021 at 22:39)</a>:</h4>
<p>presumably this is because gui stuff is linked in.</p>



<a name="256498872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256498872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256498872">(Oct 06 2021 at 23:11)</a>:</h4>
<p>anyway, let me know what the new log is</p>



<a name="256504946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256504946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256504946">(Oct 07 2021 at 00:23)</a>:</h4>
<p>Still seeing all kinds of errors, nondeterministically.  e.g.</p>
<div class="codehilite"><pre><span></span><code>$ docker run --rm  -it   fhirterm
2021-10-07--------------------------------
00:21:18 00:00:00 FHIR Server 1.9.363 Linux-64/FreePascal +Assertions +Debug
00:21:18 00:00:00 /work/fhirserver/exec/64/fhirserver -cmd exec -cfg http://tx.fhir.org/config -version 4
00:21:18 00:00:00 Loading Dependencies
00:21:18 00:00:00 SSL 1.1 from (default)
00:21:18 00:00:00 Timezone Data
[FORMS.PP] ExceptionOccurred
  Sender=EAccessViolation
  Exception=Access violation
  Stack trace:
corrupted double-linked list
</code></pre></div>
<p>... and it still expects X to be there even when called with the CLI args you provided.</p>



<a name="256505074"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256505074" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256505074">(Oct 07 2021 at 00:25)</a>:</h4>
<p>Maybe 5% of the time now it ... doesn't immediately crash, but does output</p>
<div class="codehilite"><pre><span></span><code>[FORMS.PP] ExceptionOccurred
  Sender=EAccessViolation
  Exception=Access violation
  Stack trace:
  $0000000000435B73
</code></pre></div>



<a name="256505260"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256505260" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256505260">(Oct 07 2021 at 00:27)</a>:</h4>
<p>and then... proceeds to use 100% of available CPU for... we'll see how long</p>



<a name="256509206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256509206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256509206">(Oct 07 2021 at 01:18)</a>:</h4>
<p>weird. how would I investigate? Something really low level I'm taking for granted is not true</p>



<a name="256509517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256509517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256509517">(Oct 07 2021 at 01:23)</a>:</h4>
<p><a href="https://forum.lazarus.freepascal.org/index.php/topic,56623.0.html">https://forum.lazarus.freepascal.org/index.php/topic,56623.0.html</a></p>



<a name="256509884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256509884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256509884">(Oct 07 2021 at 01:28)</a>:</h4>
<p>maybe I should try the binary you're compiling?</p>



<a name="256510347"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256510347" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256510347">(Oct 07 2021 at 01:35)</a>:</h4>
<p>or vice versa</p>



<a name="256510672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256510672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256510672">(Oct 07 2021 at 01:39)</a>:</h4>
<p>Huh. For sure you're welcome to try the thing I've compiled -- do you want it as part of the docker image, or just uploaded somewhere on its own?</p>



<a name="256510743"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256510743" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256510743">(Oct 07 2021 at 01:40)</a>:</h4>
<p>I don't know the tool chain, so I don't really know what dependencies it has dynamically linked -- is it likely to be portable?</p>



<a name="256511610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256511610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256511610">(Oct 07 2021 at 01:53)</a>:</h4>
<p>should be, if I understand. Just the binary</p>



<a name="256514031"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256514031" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256514031">(Oct 07 2021 at 02:24)</a>:</h4>
<p><a href="https://cloudflare-ipfs.com/ipfs/QmZiEVubPt8aX6hbvNBQ7ebZ8sSzsqqAhUh5v6fqeYcM1U/fhirserver">https://cloudflare-ipfs.com/ipfs/QmZiEVubPt8aX6hbvNBQ7ebZ8sSzsqqAhUh5v6fqeYcM1U/fhirserver</a></p>



<a name="256517808"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256517808" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256517808">(Oct 07 2021 at 03:22)</a>:</h4>
<p>well, progress of a sort. Your binary bombs on my development PC exactly as you described.</p>



<a name="256517822"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256517822" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256517822">(Oct 07 2021 at 03:23)</a>:</h4>
<p>so it's something to do with the compile, not the execution environment. I will investigate</p>



<a name="256517852"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256517852" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256517852">(Oct 07 2021 at 03:23)</a>:</h4>
<p>is the docker image in the PR up to date?</p>



<a name="256569782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256569782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256569782">(Oct 07 2021 at 12:39)</a>:</h4>
<p>Yes I'm keeping the docker file up to date. I will take it to use your build script today.</p>



<a name="256600281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256600281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256600281">(Oct 07 2021 at 15:45)</a>:</h4>
<p>Looking now and will clean up the script you have -- but I'll note that this kind of monolithic script makes it very hard to cache layers -- like, with a typical Dockerfile when you run "docker build" the system is smart enough to use cached layers for any steps that have already completed. So, like, you'd want to avoid running the full fpclazup process every time you change a single line of source code in fhirserver. So I'll probably refactor these into "build/linux-setup.sh" that covers all the "dependencies" including dev tools and compiling dependent modules; and a "build/linux-compile-fhirserver.sh" or  somesuch.</p>



<a name="256608270"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256608270" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256608270">(Oct 07 2021 at 16:32)</a>:</h4>
<p>When I compile <code>toolkit2/fhirtoolkit.lpr</code>I see:</p>
<blockquote>
<p>(9015) Linking /work/fhirserver/server/C:/work/fhirserver/Exec/64/fhirserver</p>
</blockquote>
<p>which I... don't expect to see ("C:/")</p>



<a name="256613586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256613586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256613586">(Oct 07 2021 at 17:05)</a>:</h4>
<p>Similarly for:</p>
<blockquote>
<p>(9022) Compiling resource &gt;/work/fhirserver/server/lib/x86_64-linux/fhirserver.or<br>
(9015) Linking &gt;/work/fhirserver/server/C:/work/fhirserver/Exec/64/fhirserver</p>
</blockquote>



<a name="256618380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256618380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256618380">(Oct 07 2021 at 17:35)</a>:</h4>
<p>... but this is good progress -- I still need an X server running even with the "CLI" mode, but the sever now runs and tries to download vocabularies, then eventually fails at</p>
<div class="codehilite"><pre><span></span><code>17:18:09 00:10:03 Zero Configuration Process failed: Unable to write the entire buffer: &#39;/root/fhir-server/sct_intl_20190731.cache&#39;
17:18:09 00:10:03 First time, so can&#39;t continue.
EIOException: Unable to write the entire buffer: &#39;/root/fhir-server/sct_intl_20190731.cache&#39;
</code></pre></div>



<a name="256627639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256627639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256627639">(Oct 07 2021 at 18:36)</a>:</h4>
<p>Grahame, can you clarify where <code>libChakraCore.so</code> needs to be in order for <code>$BUILD/tools/lazarus/lazbuild server/fhirserver.lpr</code> to succeed? (And is there any assumption about the current working directory when this command is executed?)</p>



<a name="256630219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256630219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256630219">(Oct 07 2021 at 18:52)</a>:</h4>
<p>In the meantime, code at <a href="https://github.com/grahamegrieve/fhirserver/pull/128">https://github.com/grahamegrieve/fhirserver/pull/128</a> is working (with a few documented workarounds in the PR) and I think it's ready to be merged</p>



<a name="256630289"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256630289" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256630289">(Oct 07 2021 at 18:52)</a>:</h4>
<blockquote>
<p>Linking /work/fhirserver/server/C:/work/fhirserver/Exec/64/fhirserver</p>
</blockquote>
<p>I forgot to includes the build mode</p>



<a name="256630367"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256630367" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256630367">(Oct 07 2021 at 18:53)</a>:</h4>
<blockquote>
<p>Unable to write the entire buffer</p>
</blockquote>
<p>ran out of space?</p>



<a name="256630439"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256630439" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256630439">(Oct 07 2021 at 18:53)</a>:</h4>
<blockquote>
<p>where <a href="http://libChakraCore.so">libChakraCore.so</a> needs to be</p>
</blockquote>
<p>same directory, but probably needs the build mode to be right</p>



<a name="256631335"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256631335" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256631335">(Oct 07 2021 at 18:59)</a>:</h4>
<p>I'm not running out of space.</p>



<a name="256631349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256631349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256631349">(Oct 07 2021 at 18:59)</a>:</h4>
<p>"same directory" as what?</p>



<a name="256631723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256631723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256631723">(Oct 07 2021 at 19:01)</a>:</h4>
<p>/exec/64</p>



<a name="256631840"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256631840" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256631840">(Oct 07 2021 at 19:02)</a>:</h4>
<p>are you still getting the "Unable to write the entire buffer" or is it working?</p>



<a name="256631992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256631992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256631992">(Oct 07 2021 at 19:03)</a>:</h4>
<p>Re: libChakraCore: you mean <code>exec/64</code> and not <code>server/C:/work/fhirserver/Exec/64/</code>, right? (the tzdat files need to be <em>there</em> which seems off).</p>



<a name="256632025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632025">(Oct 07 2021 at 19:03)</a>:</h4>
<p>Re: "unable to write entire buffer" this happened after several minutes/Gb of downloads</p>



<a name="256632108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632108">(Oct 07 2021 at 19:04)</a>:</h4>
<p>Not sure if it's what happens when there's a connectivity blip, or what.</p>



<a name="256632148"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632148" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632148">(Oct 07 2021 at 19:04)</a>:</h4>
<blockquote>
<p>not server/C:/work/fhirserver/Exec/64/</p>
</blockquote>
<p>I said that was because I forgot to include the build mode</p>



<a name="256632205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632205">(Oct 07 2021 at 19:04)</a>:</h4>
<p>OK -- let me know when I can revert this.</p>



<a name="256632249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632249">(Oct 07 2021 at 19:05)</a>:</h4>
<p>I'll push soon.</p>



<a name="256632270"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632270" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632270">(Oct 07 2021 at 19:05)</a>:</h4>
<p>you didn't git pull in your script?</p>



<a name="256632322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632322">(Oct 07 2021 at 19:05)</a>:</h4>
<p>The script sets up the environment; it has by definition just cloned these repos.</p>



<a name="256632386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632386">(Oct 07 2021 at 19:05)</a>:</h4>
<p>May want a different script to do updates, if you're keeping the cloned folders alive over time.</p>



<a name="256632392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632392">(Oct 07 2021 at 19:05)</a>:</h4>
<p>modularity, right. That might not true for <a href="http://linux-fhirserver.sh">linux-fhirserver.sh</a></p>



<a name="256632525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256632525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256632525">(Oct 07 2021 at 19:06)</a>:</h4>
<p>If you're re-pulling dependencies you need to re-build them. So maybe there's a</p>
<ul>
<li>linux-setup</li>
<li>linux-rebuild-dependenceis</li>
<li>linux-fhirserver</li>
</ul>



<a name="256637148"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256637148" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256637148">(Oct 07 2021 at 19:35)</a>:</h4>
<p>(Refactored.)</p>



<a name="256648851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256648851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256648851">(Oct 07 2021 at 21:00)</a>:</h4>
<p>Build is failing now at:</p>
<div class="codehilite"><pre><span></span><code>(10001) PPU Loading /work/fhirserver/packages/lib/x86_64-linux/v2_dictionary_database.ppu
(10011) PPU Source: v2_dictionary_database.pas not found
(10011) PPU Source: fhir.inc not available
(10028) Recompiling v2_dictionary_database, checksum changed for /work/fhirserver/server/lib/linux/fdb_manager.ppu
/work/fhirserver/library/v2/tests/v2_tests.pas(50,83) Fatal: (10022) Can&#39;t find unit v2_dictionary_database used by v2_tests
Fatal: (1018) Compilation aborted
</code></pre></div>
<p>I'm guessing this isn't my fault.</p>



<a name="256650035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256650035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256650035">(Oct 07 2021 at 21:07)</a>:</h4>
<div class="codehilite"><pre><span></span><code>cp ./library/v2/v2_dictionary_database.pas library/v2/tests/
</code></pre></div>

<p>^^ this rescues it.</p>



<a name="256652397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256652397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256652397">(Oct 07 2021 at 21:22)</a>:</h4>
<p>maybe but something really bad is going on three</p>



<a name="256652459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256652459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256652459">(Oct 07 2021 at 21:23)</a>:</h4>
<p>you hacked it to make it worse later</p>



<a name="256652699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256652699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256652699">(Oct 07 2021 at 21:25)</a>:</h4>
<p>but I can't tell what the actual problem is without more output</p>



<a name="256656041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256656041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256656041">(Oct 07 2021 at 21:54)</a>:</h4>
<p>What output would you like?</p>



<a name="256657916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256657916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256657916">(Oct 07 2021 at 22:10)</a>:</h4>
<p>I've set up a GH actions build, so logs should be at <a href="https://github.com/jmandel/fhirserver/runs/3832657077?check_suite_focus=true">https://github.com/jmandel/fhirserver/runs/3832657077?check_suite_focus=true</a> (... I'm assuming it'll break the same way it does for me locally; will take &gt;10min to find out.)</p>



<a name="256659068"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256659068" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256659068">(Oct 07 2021 at 22:20)</a>:</h4>
<p>how to trigger this?</p>



<a name="256659240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256659240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256659240">(Oct 07 2021 at 22:22)</a>:</h4>
<p><a href="https://github.com/jmandel/fhirserver/runs/3832657077?check_suite_focus=true#step:3:22720">https://github.com/jmandel/fhirserver/runs/3832657077?check_suite_focus=true#step:3:22720</a> is the error I'm getting, in the context of the full log</p>



<a name="256659249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256659249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256659249">(Oct 07 2021 at 22:22)</a>:</h4>
<p>(Every push triggers this.)</p>



<a name="256659276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256659276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256659276">(Oct 07 2021 at 22:23)</a>:</h4>
<p>(Every push to my fork, that is; if you merge my fork, you'll have the same behavior, which you may or may not care for.)</p>



<a name="256660292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256660292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256660292">(Oct 07 2021 at 22:33)</a>:</h4>
<p>I do want a build process like this, yes</p>



<a name="256660353"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256660353" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256660353">(Oct 07 2021 at 22:34)</a>:</h4>
<p>but I can't understand the error. It happens when the packages have overlapping search paths, and I can't find any</p>



<a name="256660662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256660662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256660662">(Oct 07 2021 at 22:37)</a>:</h4>
<p>are you still cloning the source file? (What is the source for those builds. btw?)</p>



<a name="256661344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256661344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256661344">(Oct 07 2021 at 22:44)</a>:</h4>
<p>No, as I said, introducing that <code>cp</code> *fixed` the build and it all seems to work swimmingly.</p>



<a name="256661355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256661355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256661355">(Oct 07 2021 at 22:45)</a>:</h4>
<p>But I removed it to show you the errors.</p>



<a name="256661396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256661396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256661396">(Oct 07 2021 at 22:45)</a>:</h4>
<p><a href="https://github.com/jmandel/fhirserver/blob/patch-3/Dockerfile">https://github.com/jmandel/fhirserver/blob/patch-3/Dockerfile</a> is the source for the build</p>



<a name="256661492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256661492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256661492">(Oct 07 2021 at 22:46)</a>:</h4>
<p>(and <a href="https://github.com/jmandel/fhirserver/blob/patch-3/.github/workflows/linux-docker-build.yml">https://github.com/jmandel/fhirserver/blob/patch-3/.github/workflows/linux-docker-build.yml</a> kicks it off)</p>



<a name="256661507"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256661507" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256661507">(Oct 07 2021 at 22:46)</a>:</h4>
<p>what's <a href="http://entrypoint.sh">entrypoint.sh</a> about?</p>



<a name="256661622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256661622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256661622">(Oct 07 2021 at 22:47)</a>:</h4>
<p><a href="http://entrypoint.sh">entrypoint.sh</a> is the script that runs every time the container starts. It</p>
<ul>
<li>starts a headless X server</li>
<li>
<p>executes fhirserver with any CLI arguments passed in to the image, or  if none are passed, defaults to <br>
     *["-cmd",  "exec",  "-cfg", "<a href="http://tx.fhir.org/config">http://tx.fhir.org/config</a>", "-version",  "4", "-local", "$TERMINOLOGY_CACHE"]</p>
</li>
<li>
<p>Evaluates any CLI arguments as needed so, <code>$TERMINOLOGY_CACHE</code> can be an environment variable</p>
</li>
</ul>



<a name="256661797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256661797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256661797">(Oct 07 2021 at 22:49)</a>:</h4>
<p>The idea here is that with <a href="http://entrypoint.sh">entrypoint.sh</a> set up this way, someone can invoke the fhir server as:</p>
<div class="codehilite"><pre><span></span><code>docker run fhir/fhirserver -cmd exec -cfg https://some-other-cfg -version 5
</code></pre></div>

<p>or whatever other combination of args they want to pass in.</p>



<a name="256661888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256661888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256661888">(Oct 07 2021 at 22:50)</a>:</h4>
<p>The <code>docker run fhir/fhirserver</code> bit will act a lot like just running the fhirsever binary (i.e., you can pass it the same args you'd pass the binary), but it takes care of setting up the environment first.</p>



<a name="256662150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256662150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256662150">(Oct 07 2021 at 22:53)</a>:</h4>
<p>for the github pull action, we want to run tests not execute the server, of course. But we're not up to that yet</p>



<a name="256662420"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256662420" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256662420">(Oct 07 2021 at 22:55)</a>:</h4>
<p>i don't understand line 7 of the dockerfile</p>



<a name="256662818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256662818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256662818">(Oct 07 2021 at 22:58)</a>:</h4>
<blockquote>
<p>COPY build/linux-toolchain.sh build/linux-update-dependencies.sh /work/bootstrap/</p>
</blockquote>
<p>The operating model here is that you're starting from a blank slate (fresh Ubuntu filesystem) each time you do a <code>docker build</code>. The only way files get into that filesystem is to copy them in, or to download them from within the build process. COPY takes files from the host directory and puts them into the image. </p>
<p>Here, I copy just a couple of files into the image instead of copying the whole git repo, because of the way Docker builds are cached. Docker's smart enough to notice that the inputs (build/linux-toolchain.sh, build/linux-update-dependencies.sh) haven't changed, so it re-uses the "layer" it has created up through line 13, meaning I don't have to download and re-install the pascal compiler every time I change a single file in the FHIR server's source tree.</p>



<a name="256662886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256662886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256662886">(Oct 07 2021 at 22:59)</a>:</h4>
<p>In line 13 I COPY in the full git repo, because... well, at this point I need to actually build the code.</p>



<a name="256662984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256662984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256662984">(Oct 07 2021 at 23:00)</a>:</h4>
<p>line 7 you copy the two scripts... but you don't need to?</p>



<a name="256663219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256663219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256663219">(Oct 07 2021 at 23:01)</a>:</h4>
<p>oh no I see.</p>



<a name="256665371"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256665371" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256665371">(Oct 07 2021 at 23:23)</a>:</h4>
<p>my real question was, why did you copy them somewhere else. But I think the answer was 'just because' not 'I actually needed ot'</p>



<a name="256665377"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256665377" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256665377">(Oct 07 2021 at 23:23)</a>:</h4>
<p>anyway, I can reproduce the problem.</p>



<a name="256666205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256666205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256666205">(Oct 07 2021 at 23:32)</a>:</h4>
<blockquote>
<p>my real question was, why did you copy them somewhere else</p>
</blockquote>
<p>You mean, to /work/bootstrap instead of to /work/fhirserver? I could have copied to /work/fhirserver/build, yes.</p>



<a name="256666215"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256666215" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256666215">(Oct 07 2021 at 23:32)</a>:</h4>
<blockquote>
<p>Grahame Grieve: anyway, I can reproduce the problem.</p>
</blockquote>
<p>Excellent</p>



<a name="256667610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256667610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256667610">(Oct 07 2021 at 23:49)</a>:</h4>
<p>and I fixed them. I updated the scripts in the master repo - the build should work once you get them</p>



<a name="256669864"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256669864" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256669864">(Oct 08 2021 at 00:14)</a>:</h4>
<p>Thanks -- grabbed.</p>



<a name="256671709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256671709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256671709">(Oct 08 2021 at 00:37)</a>:</h4>
<p><a href="https://github.com/grahamegrieve/fhirserver/blob/master/build/linux-toolchain.sh#L26">https://github.com/grahamegrieve/fhirserver/blob/master/build/linux-toolchain.sh#L26</a> Why did you add this back</p>



<a name="256672405"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256672405" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256672405">(Oct 08 2021 at 00:46)</a>:</h4>
<p>oversight</p>



<a name="256672574"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256672574" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256672574">(Oct 08 2021 at 00:49)</a>:</h4>
<p>Which change was the fix for the compile error I was hitting?</p>



<a name="256672586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256672586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256672586">(Oct 08 2021 at 00:49)</a>:</h4>
<p>deleting the .ppu and .o files</p>



<a name="256672622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256672622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256672622">(Oct 08 2021 at 00:50)</a>:</h4>
<p>thought that might not be necessary after my next push. I'll let you know</p>



<a name="256678167"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256678167" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256678167">(Oct 08 2021 at 02:08)</a>:</h4>
<p>not necessary - I found the problem. weird how it turned up in the wrong place. Anyway, the build scripts work nicely for me now</p>



<a name="256715744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256715744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256715744">(Oct 08 2021 at 09:59)</a>:</h4>
<p>there's going to be test cases.. and one of the thing the tests need is a big snomed file.</p>



<a name="256715764"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256715764" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256715764">(Oct 08 2021 at 09:59)</a>:</h4>
<p>not sure how to deploy that - can't put it in git...</p>



<a name="256763754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256763754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256763754">(Oct 08 2021 at 16:13)</a>:</h4>
<p>How often will these large files change? Do they need to be under version control (where the contents of the test file might need to change even though the file name remains static) or can they be represented with some kind of a content addressing scheme (where you would change the "file open" code in your test cases to specify a new file name when the vocabulary changes)?</p>



<a name="256770680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256770680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256770680">(Oct 08 2021 at 16:59)</a>:</h4>
<p>Maybe <a href="https://docs.github.com/en/repositories/working-with-files/managing-large-files/about-large-files-on-github">this</a> will help?</p>



<a name="256780498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256780498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256780498">(Oct 08 2021 at 18:03)</a>:</h4>
<p>If there's a need for version control, then yes -- but the GH implementation of git-lfs is not free, and I'm not sure we have the need. That's what my questions above are intended to elicit.</p>



<a name="256782188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256782188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256782188">(Oct 08 2021 at 18:15)</a>:</h4>
<p>no need for version control. it hasn't changed for years. I'm going to put it on my website</p>



<a name="256782490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256782490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256782490">(Oct 08 2021 at 18:17)</a>:</h4>
<p>Perfect. Put it on your website, the GH actions config can run <code>wget</code>it to make it locally available before the tests run, and we can use GH Actions caching to prevent re-fetches across runs.</p>



<a name="256783131"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256783131" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256783131">(Oct 08 2021 at 18:21)</a>:</h4>
<p>the test cases need an configuration file with file locations and passwords / key pair locations + passphrases. how should we manage that?</p>



<a name="256783592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256783592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256783592">(Oct 08 2021 at 18:24)</a>:</h4>
<p>They should be managed with GH Secrets and exposed to the container as environment variables.</p>



<a name="256783698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256783698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256783698">(Oct 08 2021 at 18:25)</a>:</h4>
<p>The locations are set by the .sh files. can the .sh write them and the environment variables to a config file?</p>



<a name="256785265"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256785265" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256785265">(Oct 08 2021 at 18:35)</a>:</h4>
<p>Not exactly. There's no secure storage area you can write to between invocations, so what happens instead is you can paste a config file (embedding whatever secrets, etc) into <a href="https://github.com/jmandel/fhirserver/settings/secrets/actions">https://github.com/jmandel/fhirserver/settings/secrets/actions</a> and then have a step in the gh actions script that prints this to a file, so it's available.</p>



<a name="256785316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256785316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256785316">(Oct 08 2021 at 18:35)</a>:</h4>
<p>(Or instead of a full config file as one secret, you can break this down into individual secrets that are managed separately.)</p>



<a name="256785747"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256785747" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256785747">(Oct 08 2021 at 18:38)</a>:</h4>
<p>sorry, I asked slightly the wrong question. I should have asked:</p>
<p>The locations are set by the parameters passed to the .sh files. can the GH Actions write them and the environment variables to a config file?</p>



<a name="256786433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256786433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256786433">(Oct 08 2021 at 18:43)</a>:</h4>
<p>GH Actions lets you run arbitrary scripts. And lets you read secrets that have been configured from the web portal. I'm not really sure what kind of workflow you are describing, but if it can be expressed as a shell script that takes secrets as environment variables, and it can set up the whole environment required by the test scripts before running the test scripts, then it will work.</p>



<a name="256786888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256786888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256786888">(Oct 08 2021 at 18:46)</a>:</h4>
<p>right. so what kind of config files can the shell scripts write to? A ini file? Because that's what currently happens - there's a file /work/fhirserver/exec/64/test-settings.ini that provides all the parameters:</p>
<div class="codehilite" data-code-language="INI"><pre><span></span><code><span class="k">[locations]</span>
<span class="na">fhirserver</span><span class="o">=</span><span class="s">c:\work\fhirserver</span>
<span class="na">fhir-test-cases</span><span class="o">=</span><span class="s">c:\work\org.hl7.fhir\fhir-test-cases</span>
<span class="na">markdown</span><span class="o">=</span><span class="s">c:\work\pascal\markdown</span>
<span class="na">snomed</span><span class="o">=</span><span class="s">C:\work\fhirserver\testcases\snomed\snomed.cache</span>

<span class="k">[mssql]</span>
<span class="na">driver</span><span class="o">=</span><span class="s">SQL Server</span>
<span class="na">server</span><span class="o">=</span><span class="s">(local)</span>
<span class="na">database</span><span class="o">=</span><span class="s">test</span>

<span class="k">[mysql]</span>
<span class="na">driver</span><span class="o">=</span><span class="s">MySQL ODBC 8.0 Unicode Driver</span>
<span class="na">server</span><span class="o">=</span><span class="s">34.122.27.199</span>
<span class="na">database</span><span class="o">=</span><span class="s">test</span>
<span class="na">username</span><span class="o">=</span><span class="s">test</span>
<span class="na">password</span><span class="o">=</span><span class="s">XXX</span>

<span class="k">[email]</span>
<span class="na">sender</span><span class="o">=</span><span class="s">fhir-server@healthintersections.com.au</span>
<span class="na">password</span><span class="o">=</span><span class="s">XXXX</span>
<span class="na">destination</span><span class="o">=</span><span class="s">grahameg@gmail.com</span>

<span class="k">[ssl]</span>
<span class="na">cert</span><span class="o">=</span><span class="s">C:\work\RDPs\certificates\new\fhir.org.crt</span>
<span class="na">key</span><span class="o">=</span><span class="s">C:\work\RDPs\certificates\new\fhir.org.key</span>
<span class="na">cacert</span><span class="o">=</span><span class="s">C:\work\RDPs\certificates\new\fhir.org.int.crt</span>
<span class="na">password</span><span class="o">=</span><span class="s">XXX</span>
</code></pre></div>



<a name="256788608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256788608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256788608">(Oct 08 2021 at 18:57)</a>:</h4>
<p>the source for the snomed file is at <a href="http://www.healthintersections.com.au/FhirServer/snomed.test.cache">http://www.healthintersections.com.au/FhirServer/snomed.test.cache</a></p>



<a name="256790356"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256790356" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256790356">(Oct 08 2021 at 19:09)</a>:</h4>
<p>So if you want to, you could take a version of exactly that config file (with all the details filled in) you listed here and throw it into a secret. Then we could just echo that secret into any file location you wanted right before running the tests.</p>



<a name="256790456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256790456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256790456">(Oct 08 2021 at 19:10)</a>:</h4>
<p>It appears that the secret points to other files that are also secrets; so we would need to capture those as well, if I'm understanding the format correctly.</p>



<a name="256790538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256790538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256790538">(Oct 08 2021 at 19:10)</a>:</h4>
<p>But there is no way that you want to load production server secrets like a TLS key for the <a href="http://fhir.org">fhir.org</a> website as a prerequisite for running tests, right?</p>



<a name="256790635"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256790635" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256790635">(Oct 08 2021 at 19:11)</a>:</h4>
<p>Similarly, I'm not sure why the tests would be connecting to an externally hosted MySQL database.</p>



<a name="256790917"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256790917" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256790917">(Oct 08 2021 at 19:13)</a>:</h4>
<p>there's a test case for checking that all the database infrastructure for MySQL works.</p>



<a name="256790939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256790939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256790939">(Oct 08 2021 at 19:13)</a>:</h4>
<p>it doesn't have to be external</p>



<a name="256791011"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256791011" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256791011">(Oct 08 2021 at 19:14)</a>:</h4>
<p>same for mssql</p>



<a name="256791052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256791052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256791052">(Oct 08 2021 at 19:14)</a>:</h4>
<p>and I wouldn't use the production key for <a href="http://fhir.org">fhir.org</a> in the tests, but I did internally, since I have to have it anyway</p>



<a name="256791107"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256791107" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256791107">(Oct 08 2021 at 19:15)</a>:</h4>
<p>we could check in a testing key and just have the passphrase as the secret</p>



<a name="256791207"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256791207" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256791207">(Oct 08 2021 at 19:15)</a>:</h4>
<p>What are the things that actually need to be secret that the tests require to run?</p>



<a name="256792760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256792760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256792760">(Oct 08 2021 at 19:27)</a>:</h4>
<p>the secrets:</p>
<ul>
<li>email password</li>
<li>ssl passphrase</li>
</ul>
<p>local config:</p>
<ul>
<li>where the files are</li>
<li>what the email addresses are</li>
<li>what the database details are</li>
</ul>



<a name="256793234"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256793234" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256793234">(Oct 08 2021 at 19:30)</a>:</h4>
<p>For ssl, we could just generate a certificate each time the tests run, so this would not need to be a secret.</p>
<p>For email, can you give me the quick rundown on where and how the test suite is interacting with email?</p>



<a name="256793820"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256793820" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256793820">(Oct 08 2021 at 19:35)</a>:</h4>
<p>it sends a test email, to check that emailing works. It occasionally fails, when google introduces a new security requirement</p>



<a name="256802456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256802456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256802456">(Oct 08 2021 at 20:39)</a>:</h4>
<p>Okay, so sounds that's the only true secret in the process.</p>



<a name="256802990"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256802990" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256802990">(Oct 08 2021 at 20:43)</a>:</h4>
<p>right. the destination email address and sender email address are configured, but not secret</p>



<a name="256986250"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256986250" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256986250">(Oct 10 2021 at 21:31)</a>:</h4>
<p>OK, so tests are  running at this point; you can see passing/failing/error output at <a href="https://github.com/jmandel/fhirserver/runs/3853245288?check_suite_focus=true#step:5:17890">https://github.com/jmandel/fhirserver/runs/3853245288?check_suite_focus=true#step:5:17890</a> (I don't really understand the outputs but I expect you might, Grahame.)</p>
<p>(To make this work, I added <a href="https://github.com/jmandel/fhirserver/blob/patch-3/fixtures/test-settings.ini.template">https://github.com/jmandel/fhirserver/blob/patch-3/fixtures/test-settings.ini.template</a> and I fill out the template at runtime via <a href="https://github.com/jmandel/fhirserver/blob/patch-3/.github/workflows/linux-docker-build.yml#L33">https://github.com/jmandel/fhirserver/blob/patch-3/.github/workflows/linux-docker-build.yml#L33</a>)</p>



<a name="256990638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256990638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256990638">(Oct 10 2021 at 22:38)</a>:</h4>
<p>do the first think it is that it looks like the setting locations/fhirserver is missing or blank</p>
<p>[locations]<br>
fhirserver=</p>



<a name="256990683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256990683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256990683">(Oct 10 2021 at 22:38)</a>:</h4>
<p>that's the home directory for the fhirserver repo itself</p>



<a name="256990695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256990695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256990695">(Oct 10 2021 at 22:38)</a>:</h4>
<p>and also locations/snomed</p>



<a name="256991782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256991782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256991782">(Oct 10 2021 at 22:58)</a>:</h4>
<blockquote>
<p>do the first think it is that it looks like the setting locations/fhirserver is missing or blank</p>
</blockquote>
<p>So, this should be set to <code>/work/fhirserver</code>, per <a href="https://github.com/jmandel/fhirserver/blob/patch-3/.github/workflows/linux-docker-build.yml#L19">https://github.com/jmandel/fhirserver/blob/patch-3/.github/workflows/linux-docker-build.yml#L19</a> -- is that the wrong value, or are you saying it's not <em>actually</em> getting set to that value?</p>



<a name="256991795"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256991795" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256991795">(Oct 10 2021 at 22:59)</a>:</h4>
<p>it's not getting set to any value</p>



<a name="256991812"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256991812" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256991812">(Oct 10 2021 at 22:59)</a>:</h4>
<p>there's no evidence I can see that anything in there is set</p>



<a name="256991972"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256991972" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256991972">(Oct 10 2021 at 23:01)</a>:</h4>
<p>Hmm, I'll add some debug printouts.</p>



<a name="256991977"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256991977" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256991977">(Oct 10 2021 at 23:01)</a>:</h4>
<p>When I run locally, what can I look for to determine if these settings are being picked up?</p>



<a name="256992313"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256992313" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256992313">(Oct 10 2021 at 23:06)</a>:</h4>
<p>well, I just committed some a to print the locations explicitly</p>



<a name="256992323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256992323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256992323">(Oct 10 2021 at 23:07)</a>:</h4>
<p>Awesome. I'll merge that.</p>



<a name="256992420"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256992420" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256992420">(Oct 10 2021 at 23:08)</a>:</h4>
<p>On the plus side, I am getting</p>
<p><a href="/user_uploads/10155/k1tkNYAqKsoewWOlhiMtByQ8/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/k1tkNYAqKsoewWOlhiMtByQ8/image.png" title="image.png"><img src="/user_uploads/10155/k1tkNYAqKsoewWOlhiMtByQ8/image.png"></a></div><p>(Though I'm not sure how to tell if that's coming from running the tests locally, or in GH actions.)</p>



<a name="256992451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256992451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256992451">(Oct 10 2021 at 23:09)</a>:</h4>
<p>if you got that, then the email password bit is working for sure</p>



<a name="256995662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256995662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256995662">(Oct 11 2021 at 00:08)</a>:</h4>
<p><a href="https://github.com/jmandel/fhirserver/runs/3853692645?check_suite_focus=true#step:5:55">https://github.com/jmandel/fhirserver/runs/3853692645?check_suite_focus=true#step:5:55</a> your logs indicate the location is populated, I think?</p>



<a name="256996057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256996057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256996057">(Oct 11 2021 at 00:14)</a>:</h4>
<p>certainly do.</p>



<a name="256996078"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256996078" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256996078">(Oct 11 2021 at 00:14)</a>:</h4>
<p>so it's real weird. The file evidently existed, since it's read on line 50. But then it's not found on line 75</p>



<a name="256996109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256996109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256996109">(Oct 11 2021 at 00:15)</a>:</h4>
<p>oh</p>



<a name="256996180"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256996180" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256996180">(Oct 11 2021 at 00:16)</a>:</h4>
<p>apparently some of the tests assume that the current directory is the same as the directory that the executable is run from. There aren't supposed to be any, but there are</p>



<a name="256996693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256996693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256996693">(Oct 11 2021 at 00:24)</a>:</h4>
<p>looks to me like the snomed location is wrong though</p>



<a name="256997232"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/256997232" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#256997232">(Oct 11 2021 at 00:34)</a>:</h4>
<p>I fixed the tests that stood out and added more logging - try again</p>



<a name="257003668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257003668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257003668">(Oct 11 2021 at 02:30)</a>:</h4>
<p>Cool -- <a href="https://github.com/jmandel/fhirserver/runs/3854355842?check_suite_focus=true#step:7:52">https://github.com/jmandel/fhirserver/runs/3854355842?check_suite_focus=true#step:7:52</a> confirms that <code>snomed.test.cache</code> exists; more logs below.</p>



<a name="257003762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257003762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257003762">(Oct 11 2021 at 02:32)</a>:</h4>
<p>I see the problem</p>



<a name="257003765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257003765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257003765">(Oct 11 2021 at 02:32)</a>:</h4>
<p><code>snomed.test.cache</code> vs <code>snomed.cache</code></p>



<a name="257003805"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257003805" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257003805">(Oct 11 2021 at 02:33)</a>:</h4>
<p>Fixing that now.</p>



<a name="257008076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257008076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257008076">(Oct 11 2021 at 03:46)</a>:</h4>
<p>I added some more debugging if you could update- thanks</p>



<a name="257009461"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257009461" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257009461">(Oct 11 2021 at 04:08)</a>:</h4>
<p><a href="https://github.com/jmandel/fhirserver/actions/runs/1327450135">https://github.com/jmandel/fhirserver/actions/runs/1327450135</a> should have more in 15min or so</p>



<a name="257012973"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257012973" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257012973">(Oct 11 2021 at 05:03)</a>:</h4>
<p>so the piece that's failing in one of the tests is</p>
<div class="codehilite" data-code-language="Delphi"><pre><span></span><code> <span class="nb">FileSetReadOnly</span><span class="p">(</span><span class="n">filename</span><span class="o">,</span> <span class="k">true</span><span class="p">)</span><span class="o">;</span>
  <span class="n">FileDelete</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">;</span>
  <span class="n">assertTrue</span><span class="p">(</span><span class="nb">FileExists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">,</span> <span class="s">'FileExists(filename) #3'</span><span class="p">)</span><span class="o">;</span>
</code></pre></div>



<a name="257013037"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257013037" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257013037">(Oct 11 2021 at 05:04)</a>:</h4>
<p>FileSetReadyOnly is </p>
<div class="codehilite" data-code-language="Delphi"><pre><span></span><code>  <span class="k">if</span> <span class="n">readOnly</span> <span class="k">then</span>
    <span class="n">i</span> <span class="o">:=</span> <span class="n">fpchmod</span><span class="p">(</span><span class="n">filename</span><span class="o">,</span> <span class="n">S_IRUSR</span> <span class="k">or</span> <span class="n">S_IRGRP</span> <span class="k">or</span> <span class="n">S_IROTH</span> <span class="k">or</span> <span class="n">S_IRUSR</span> <span class="k">or</span> <span class="n">S_IXGRP</span> <span class="k">or</span> <span class="n">S_IXOTH</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">i</span> <span class="o">:=</span> <span class="n">fpchmod</span><span class="p">(</span><span class="n">filename</span><span class="o">,</span> <span class="n">S_IRWXU</span> <span class="k">or</span> <span class="n">S_IRWXG</span> <span class="k">or</span> <span class="n">S_IRWXO</span><span class="p">)</span><span class="o">;</span>
</code></pre></div>



<a name="257013059"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257013059" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257013059">(Oct 11 2021 at 05:04)</a>:</h4>
<p>so the readonly file can't be deleted on my linux box but can be on the CI build... wonder why it would be different?</p>



<a name="257019908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257019908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257019908">(Oct 11 2021 at 06:45)</a>:</h4>
<p>I think I've fixed the TestFslDateTime test - relied on an implied timezone</p>



<a name="257019920"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257019920" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257019920">(Oct 11 2021 at 06:45)</a>:</h4>
<p>testWebServer_110 [00.000] fail @?#?: CA SSL Certificate not found at /work/fhiserver/fixtures/rootCA.crt - looks like a set up thing?</p>



<a name="257020025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257020025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257020025">(Oct 11 2021 at 06:47)</a>:</h4>
<p>the mysql test - can you add installing the mysql odbc driver?</p>



<a name="257020053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257020053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257020053">(Oct 11 2021 at 06:47)</a>:</h4>
<p>the TestSQLite is confusing - is it possible that /tmp doesn't exist, or access is denied?</p>



<a name="257066342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257066342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257066342">(Oct 11 2021 at 13:45)</a>:</h4>
<blockquote>
<p>Grahame Grieve: so the readonly file can't be deleted on my linux box but can be on the CI build... wonder why it would be different?</p>
</blockquote>
<p>Are you writing unit tests for the OS (i.e., testing that the OS is providing the protection it claims to be)? Like, as a regular user if I own a file with <code>400</code> permissions, I can still delete it -- like</p>
<div class="codehilite"><pre><span></span><code>$ls -l ownj_deletej
-r-------- 1 jmandel jmandel 0 Oct 11 08:40 ownj_deletej

$ rm -f  ownj_deletej
</code></pre></div>
<p>If I leave out <code>-f</code> ("force"), I get a prompt like "rm: remove write-protected regular empty file 'ownj_deletej'?" -- and with <code>-f</code>, the file is deleted straightaway. So the fact that it's "readonly" doesn't mean that the owner can't delete it.</p>



<a name="257066575"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257066575" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257066575">(Oct 11 2021 at 13:47)</a>:</h4>
<p>I'm not sure what your <code>FileDelete</code> is intended to do, but you may need "softer" behavior. Keep in mind that during the CI  process these tests are running in a docker container as root; that might explain the differences you're seeing, and making the server run as an unprivileged user would be nice for other reasons; we can start a separate thread on that once we've got the basics ironed out.</p>



<a name="257066814"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257066814" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257066814">(Oct 11 2021 at 13:49)</a>:</h4>
<blockquote>
<p>/work/fhiserver/fixtures/rootCA.crt </p>
</blockquote>
<p><a href="https://github.com/jmandel/fhirserver/tree/patch-3/fixtures">https://github.com/jmandel/fhirserver/tree/patch-3/fixtures</a> should be mounted at <code>/work/fhirserver/fixtures</code> -- does your error message indicate the <em>file</em> isn't found, or just that there's something unexpected/wrong about the file?</p>



<a name="257067185"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257067185" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257067185">(Oct 11 2021 at 13:52)</a>:</h4>
<p>Re: DB tests, I'm hesitate to dive in here because the configuration space is big and I don't know that I'll be able to see this all the way through. Do you have a complete step by step writeup detailing the components and setup required? <a href="https://github.com/grahamegrieve/fhirserver/blob/master/linux-install-instructions.txtdoesn't">https://github.com/grahamegrieve/fhirserver/blob/master/linux-install-instructions.txtdoesn't</a> mention mysql</p>



<a name="257117793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257117793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257117793">(Oct 11 2021 at 21:16)</a>:</h4>
<p>to rootCA file... it doesn't exist - or doesn't look like it does to the fhirserver</p>



<a name="257117839"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257117839" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257117839">(Oct 11 2021 at 21:17)</a>:</h4>
<p>the root thing is probably the difference for the file test. I'm thinking about that.</p>



<a name="257117874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257117874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257117874">(Oct 11 2021 at 21:17)</a>:</h4>
<p>I would very much like to get at least the mysql test working - it's a forerunner for a whole lot of tests I have yet to add into the linux version that will use a mysql store</p>



<a name="257118647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118647">(Oct 11 2021 at 21:25)</a>:</h4>
<blockquote>
<p>Grahame Grieve: the root thing is probably the difference for the file test. I'm thinking about that.<br>
to rootCA file... it doesn't exist - or doesn't look like it does to the fhirserver</p>
</blockquote>
<p>I'm not sure how this could happen; it's part of the repo that's copied into the container at build time. What makes you say it's absent?</p>



<a name="257118717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118717">(Oct 11 2021 at 21:26)</a>:</h4>
<blockquote>
<p>Grahame Grieve: I would very much like to get at least the mysql test working - it's a forerunner for a whole lot of tests I have yet to add into the linux version that will use a mysql store</p>
</blockquote>
<p>OK. If you can document the setup process (starting from: host machine has a mysql server running but nothing set up) we can try to replicate this in CI.</p>



<a name="257118735"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118735" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118735">(Oct 11 2021 at 21:26)</a>:</h4>
<p>working on the set up</p>



<a name="257118753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118753">(Oct 11 2021 at 21:26)</a>:</h4>
<blockquote>
<p>All Tests [12:23.300] : 3176 ok, 7 errors, 3 failed</p>
</blockquote>
<p>That's pretty good though :-)</p>



<a name="257118770"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118770" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118770">(Oct 11 2021 at 21:27)</a>:</h4>
<p>it is good.</p>



<a name="257118773"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118773" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118773">(Oct 11 2021 at 21:27)</a>:</h4>
<p>assertTrue(FileExists(TestSettings.SSLCAFile), 'CA SSL Certificate not found at '+TestSettings.SSLCAFile);</p>



<a name="257118816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118816">(Oct 11 2021 at 21:27)</a>:</h4>
<p>Typo</p>



<a name="257118820"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118820" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118820">(Oct 11 2021 at 21:27)</a>:</h4>
<p>That'd do the trick.</p>



<a name="257118879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118879">(Oct 11 2021 at 21:28)</a>:</h4>
<blockquote>
<p>/work/fhiserver/fixtures/rootCA.crt</p>
</blockquote>
<p>I should put an <code>r</code> in FHIR. Can't forget the "resoruces".</p>



<a name="257118912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257118912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257118912">(Oct 11 2021 at 21:28)</a>:</h4>
<p>I make both those typos often too</p>



<a name="257183634"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257183634" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257183634">(Oct 12 2021 at 10:58)</a>:</h4>
<p>ok. mysql commands to set up a working test environment from vanilla set up:</p>



<a name="257183661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257183661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257183661">(Oct 12 2021 at 10:58)</a>:</h4>
<div class="codehilite" data-code-language="SQL"><pre><span></span><code><span class="k">create</span> <span class="k">user</span> <span class="s1">'test'</span><span class="o">@</span><span class="s1">'%'</span> <span class="n">identified</span> <span class="k">by</span> <span class="s1">'test'</span><span class="p">;</span>
<span class="k">create</span> <span class="k">database</span> <span class="n">test</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="n">test</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'test'</span><span class="o">@</span><span class="s1">'%'</span><span class="p">;</span>
<span class="n">flush</span> <span class="k">privileges</span><span class="p">;</span>
</code></pre></div>



<a name="257195575"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257195575" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257195575">(Oct 12 2021 at 12:41)</a>:</h4>
<p>And how do we tell the test suite what host and port the DB is running on?</p>



<a name="257195711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257195711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257195711">(Oct 12 2021 at 12:42)</a>:</h4>
<p>And what version of mysql?</p>



<a name="257209070"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257209070" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257209070">(Oct 12 2021 at 14:10)</a>:</h4>
<p>I have MariaDB 10.4.20 working</p>



<a name="257209103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257209103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257209103">(Oct 12 2021 at 14:10)</a>:</h4>
<p>mysql had some issues that I don't recall, sorry</p>



<a name="257209344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257209344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257209344">(Oct 12 2021 at 14:12)</a>:</h4>
<p>I also remember having to add this to the configuration (my.ini): </p>
<div class="codehilite" data-code-language="INI"><pre><span></span><code><span class="na">query_cache_size</span> <span class="o">=</span>  <span class="s">64M</span>
<span class="c1">#query_cache_size =  0</span>
<span class="na">query_cache_min_res_unit</span> <span class="o">=</span><span class="s">2</span>
<span class="na">tmp_table_size</span> <span class="o">=</span> <span class="s">128M</span>
<span class="na">max_heap_table_size</span> <span class="o">=</span> <span class="s">128M</span>
<span class="c1">#skip-name-resolve</span>
<span class="na">innodb_file_per_table</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">innodb_buffer_pool_size</span> <span class="o">=</span> <span class="s">1280M</span>
<span class="na">lower_case_table_names</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">max_binlog_size</span>         <span class="o">=</span> <span class="s">100M</span>
<span class="na">expire_logs_days</span><span class="o">=</span><span class="s">2</span>
<span class="na">innodb_ft_min_token_size</span><span class="o">=</span><span class="s">1</span>
<span class="na">ft_min_word_len</span><span class="o">=</span><span class="s">2</span>
<span class="na">autocommit</span><span class="o">=</span><span class="s">1</span>
<span class="na">connect_timeout</span><span class="o">=</span><span class="s">240</span>
<span class="na">long_query_time</span><span class="o">=</span><span class="s">180</span>
<span class="na">transaction-isolation</span> <span class="o">=</span> <span class="s">READ-COMMITTED</span>
<span class="na">character-set-server</span> <span class="o">=</span> <span class="s">utf8</span>
<span class="na">collation-server</span> <span class="o">=</span> <span class="s">utf8_general_ci</span>
<span class="na">innodb_flush_method</span><span class="o">=</span><span class="s">O_DIRECT</span>
<span class="na">optimizer_switch</span><span class="o">=</span><span class="s">orderby_uses_equalities=off</span>
<span class="na">max_allowed_packet</span><span class="o">=</span><span class="s">128M</span>
</code></pre></div>



<a name="257209718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257209718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257209718">(Oct 12 2021 at 14:14)</a>:</h4>
<p>my DB init commands are the same as Grahame writes, except I added utf8 explicitly<br>
<code>CREATE DATABASE fhirDB CHARACTER SET utf8 COLLATE utf8_unicode_ci;</code></p>



<a name="257209778"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257209778" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257209778">(Oct 12 2021 at 14:14)</a>:</h4>
<p>(Don't know if this helps. I'm trying to catch up, let me know if I can do something - maybe I can take mysql setup because I've done it once)</p>



<a name="257210317"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257210317" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257210317">(Oct 12 2021 at 14:18)</a>:</h4>
<p>Wow. This is a lot of config just to support running tests.</p>



<a name="257216287"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257216287" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257216287">(Oct 12 2021 at 14:54)</a>:</h4>
<p>sorry, not for tests, that was for the prod-like server</p>



<a name="257216311"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257216311" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257216311">(Oct 12 2021 at 14:54)</a>:</h4>
<p>(i missed the context)</p>



<a name="257217766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257217766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257217766">(Oct 12 2021 at 15:03)</a>:</h4>
<p>I think there's a MySQL server in place now (mysql8, host: "mysql", as communicated via .ini param at <a href="https://github.com/jmandel/fhirserver/blob/patch-3/fixtures/test-settings.ini.template#L14">https://github.com/jmandel/fhirserver/blob/patch-3/fixtures/test-settings.ini.template#L14</a>); I'm still seeing errors from <a href="https://github.com/jmandel/fhirserver/runs/3871257411?check_suite_focus=true#step:10:56">https://github.com/jmandel/fhirserver/runs/3871257411?check_suite_focus=true#step:10:56</a></p>



<a name="257220849"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257220849" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257220849">(Oct 12 2021 at 15:23)</a>:</h4>
<p>OK then I'll test the proper config and do the same thing as I did before - check if the text indexing is working , etc. If it's mysql, then we use that</p>



<a name="257248573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257248573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257248573">(Oct 12 2021 at 18:19)</a>:</h4>
<p>port defaults to normal. I haven't got a config for that.</p>



<a name="257248582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257248582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257248582">(Oct 12 2021 at 18:19)</a>:</h4>
<p>host = server</p>



<a name="257248614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257248614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257248614">(Oct 12 2021 at 18:19)</a>:</h4>
<p>version doesn't matter for the tests</p>



<a name="257249473"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257249473" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257249473">(Oct 12 2021 at 18:25)</a>:</h4>
<p>you also have to install the MySQL odbc driver - which I believe is:</p>
<div class="codehilite"><pre><span></span><code>wget https://dev.mysql.com/get/Downloads/Connector-ODBC/8.0/mysql-connector-odbc_8.0.26-1ubuntu20.04_amd64.deb
dpkg -i mysql-connector-odbc_8.0.26–1ubuntu20.04_amd64.deb
</code></pre></div>



<a name="257251024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257251024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257251024">(Oct 12 2021 at 18:36)</a>:</h4>
<p>also can you update from the master - I have some changes to the code.</p>



<a name="257267739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257267739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257267739">(Oct 12 2021 at 20:33)</a>:</h4>
<blockquote>
<p>host = server</p>
</blockquote>
<p>I don't know what this means.</p>



<a name="257268032"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257268032" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257268032">(Oct 12 2021 at 20:35)</a>:</h4>
<blockquote>
<p>Grahame Grieve: also can you update from the master - I have some changes to the code.</p>
</blockquote>
<p>Done.</p>



<a name="257276608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257276608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257276608">(Oct 12 2021 at 21:43)</a>:</h4>
<p>Re: that mysql connector, somehow their ubuntu release has like hundreds of  megs of dependencies. What even is this?</p>



<a name="257280862"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257280862" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257280862">(Oct 12 2021 at 22:21)</a>:</h4>
<p>it's the ODBC driver for mysql for linux?</p>



<a name="257280974"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257280974" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257280974">(Oct 12 2021 at 22:22)</a>:</h4>
<blockquote>
<p>host = server</p>
</blockquote>
<p>you asked, how do you specify the host. That's the server setting in the test-settings.ini... or do I mis-understand?</p>



<a name="257281520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257281520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257281520">(Oct 12 2021 at 22:27)</a>:</h4>
<p>Oh, yeah I guess I already populated the host value then.</p>



<a name="257281655"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257281655" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257281655">(Oct 12 2021 at 22:28)</a>:</h4>
<p>Re; ODBC driver, that doesn't install for me because one of the dependencies is no longer available. The whole distribution process for that driver seems super sketchy and weird, like bad printer drivers.</p>



<a name="257282552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257282552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257282552">(Oct 12 2021 at 22:37)</a>:</h4>
<p>totally agree. it's not a good thing</p>



<a name="257283413"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257283413" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257283413">(Oct 12 2021 at 22:47)</a>:</h4>
<p>but it does work for me. what dependency is no longer available?</p>



<a name="257284175"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257284175" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257284175">(Oct 12 2021 at 22:54)</a>:</h4>
<p>I'm not at the computer anymore, but something like mysql-community-blah</p>



<a name="257422877"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257422877" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257422877">(Oct 13 2021 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> some follow up quetsions on all this. First of all, thanks for doing all this - I appreciate it greatly.</p>
<ul>
<li>what's Dockerfile.slimmed? </li>
<li>we still don't have the tests running? </li>
<li>how does the build work if it executes a process that doesn't finish?</li>
</ul>



<a name="257424629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257424629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257424629">(Oct 13 2021 at 19:37)</a>:</h4>
<blockquote>
<p>what's Dockerfile.slimmed?</p>
</blockquote>
<p>Right now the Docker image you get if you run <code>docker build -f Dockerfile</code> includes the whole fpc toolchain, source code, dev packages, etc. The <code>slimmed</code> package just takes a raw ubuntu image and copies in the <em>compiled</em> output from the build process. If someone wanted a simple way to distribute/run the fhirserver using a Docker registry (i.e., so anyone in the world could just <code>docker run hl7fhir:fhirserver</code> and have it up and running), something like this slimmed image would be the right starting point.</p>



<a name="257424827"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257424827" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257424827">(Oct 13 2021 at 19:38)</a>:</h4>
<blockquote>
<p>we still don't have the tests running?</p>
</blockquote>
<p>Tests are <em>running</em>, so I assume your question is why they're not <em>passing</em>. Current blocker: I don't have a way to install the mysql dependency you said is necessary.</p>



<a name="257425029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257425029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257425029">(Oct 13 2021 at 19:40)</a>:</h4>
<blockquote>
<p>how does the build work if it executes a process that doesn't finish?</p>
</blockquote>
<p>Right now, it'll just run until the GH Actions timeout hits (360 min by default; we could set this lower with a param in the GH Actions job).</p>



<a name="257425059"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257425059" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257425059">(Oct 13 2021 at 19:40)</a>:</h4>
<blockquote>
<p>First of all, thanks for doing all this - I appreciate it greatly.</p>
</blockquote>
<p>You're welcome. It has been a learning experience!</p>



<a name="257427125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427125">(Oct 13 2021 at 19:54)</a>:</h4>
<p>I'm thinking it may be easier to install the binary release for mysql odbc rather than the borked ubuntu packages.</p>



<a name="257427173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427173">(Oct 13 2021 at 19:55)</a>:</h4>
<p>yes indeed, the binary release is what I've been installing</p>



<a name="257427254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427254">(Oct 13 2021 at 19:55)</a>:</h4>
<p>how are the tests running? the docker ends with :<br>
<code>CMD ["-cmd",  "exec",  "-cfg", "http://tx.fhir.org/config", "-version",  "4", "-local", "$TERMINOLOGY_CACHE"]</code></p>



<a name="257427444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427444">(Oct 13 2021 at 19:56)</a>:</h4>
<ul>
<li>but you pointed me to the ubuntu packes at <a href="https://dev.mysql.com/get/Downloads/Connector-ODBC/8.0/mysql-connector-odbc_8.0.26-1ubuntu20.04_amd64.deb">https://dev.mysql.com/get/Downloads/Connector-ODBC/8.0/mysql-connector-odbc_8.0.26-1ubuntu20.04_amd64.deb</a> rather than the generic release tarball at <a href="https://dev.mysql.com/get/Downloads/Connector-ODBC/8.0/mysql-connector-odbc-8.0.26-linux-glibc2.12-x86-64bit.tar.gz">https://dev.mysql.com/get/Downloads/Connector-ODBC/8.0/mysql-connector-odbc-8.0.26-linux-glibc2.12-x86-64bit.tar.gz</a> :-)</li>
</ul>



<a name="257427480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427480">(Oct 13 2021 at 19:57)</a>:</h4>
<p>did I? I'm very sorry if I did that</p>



<a name="257427537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427537">(Oct 13 2021 at 19:57)</a>:</h4>
<p>The <code>CMD</code> line defines the default args that will be passed in when the container starts, if no other CLI args are passed</p>



<a name="257427571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427571">(Oct 13 2021 at 19:57)</a>:</h4>
<p>hmm what overrides that?</p>



<a name="257427584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427584">(Oct 13 2021 at 19:57)</a>:</h4>
<p>But we run the container in the test script at <a href="https://github.com/jmandel/fhirserver/blob/109745215693e144ee645bc3f1a4d3c2db3310f5/.github/workflows/linux-docker-build.yml#L70">https://github.com/jmandel/fhirserver/blob/109745215693e144ee645bc3f1a4d3c2db3310f5/.github/workflows/linux-docker-build.yml#L70</a></p>



<a name="257427655"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427655" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427655">(Oct 13 2021 at 19:58)</a>:</h4>
<p>Where we call it with:</p>
<div class="codehilite"><pre><span></span><code>-tests
</code></pre></div>



<a name="257427757"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427757" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427757">(Oct 13 2021 at 19:59)</a>:</h4>
<p>At <a href="#narrow/stream/179281-pascal/topic/Automating.20fhirserver.20build/near/257249473">https://chat.fhir.org/#narrow/stream/179281-pascal/topic/Automating.20fhirserver.20build/near/257249473</a> you did -- but you wrote "I believe" and not "I promise" ;-)</p>



<a name="257427861"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257427861" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257427861">(Oct 13 2021 at 19:59)</a>:</h4>
<p>We'll see how the tests at <a href="https://github.com/jmandel/fhirserver/runs/3887155777?check_suite_focus=true">https://github.com/jmandel/fhirserver/runs/3887155777?check_suite_focus=true</a> do -- mysql-odbc is now being installed without errors.</p>



<a name="257429194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257429194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257429194">(Oct 13 2021 at 20:07)</a>:</h4>
<p>(Well, almost being installed without errors. Tweaking...)</p>



<a name="257431083"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257431083" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257431083">(Oct 13 2021 at 20:19)</a>:</h4>
<p>where do I find all the apt -install stuff?</p>



<a name="257431810"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257431810" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257431810">(Oct 13 2021 at 20:24)</a>:</h4>
<p>I don't understand the question.</p>
<p>BTW I just committed <a href="https://github.com/jmandel/fhirserver/commit/99b42f04a4db898ebf45b611f060718eedf3be7a">https://github.com/jmandel/fhirserver/commit/99b42f04a4db898ebf45b611f060718eedf3be7a</a> because some of these lpk files don't exist (but previously this wasn't causing errors; not sure why.)</p>



<a name="257435331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257435331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257435331">(Oct 13 2021 at 20:49)</a>:</h4>
<p>oh. I was getting to that</p>



<a name="257435947"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257435947" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257435947">(Oct 13 2021 at 20:53)</a>:</h4>
<p>no I had fixed it - you want what is in my repo</p>



<a name="257436649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257436649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257436649">(Oct 13 2021 at 20:58)</a>:</h4>
<blockquote>
<p>where do I find all the apt -install stuff?</p>
</blockquote>
<p>we need to install git, mysql, wget, unixodbc etc. Where does this happen in the set up?</p>



<a name="257439709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257439709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257439709">(Oct 13 2021 at 21:18)</a>:</h4>
<blockquote>
<p>we need to install git, mysql, wget, unixodbc etc. Where does this happen in the set up?</p>
</blockquote>
<p><a href="https://github.com/jmandel/fhirserver/blob/patch-3/Dockerfile#L5-L12">https://github.com/jmandel/fhirserver/blob/patch-3/Dockerfile#L5-L12</a></p>
<p>(Note that mysql itself isn't installed in the docker image; it's a service we're running in a sibling docker container accessible over the network as host <code>mysql</code>, created <a href="https://github.com/jmandel/fhirserver/blob/patch-3/.github/workflows/linux-docker-build.yml#L17-L24">here</a>.)</p>



<a name="257440318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257440318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257440318">(Oct 13 2021 at 21:22)</a>:</h4>
<p>Still seeing errors at <a href="https://github.com/jmandel/fhirserver/runs/3887632649?check_suite_focus=true#step:10:67">https://github.com/jmandel/fhirserver/runs/3887632649?check_suite_focus=true#step:10:67</a> even after installing libs/bins from <a href="https://dev.mysql.com/get/Downloads/Connector-ODBC/8.0/mysql-connector-odbc-8.0.26-linux-glibc2.12-x86-64bit.tar.gz">https://dev.mysql.com/get/Downloads/Connector-ODBC/8.0/mysql-connector-odbc-8.0.26-linux-glibc2.12-x86-64bit.tar.gz</a></p>



<a name="257441152"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257441152" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257441152">(Oct 13 2021 at 21:28)</a>:</h4>
<p>I don't know what the error means.</p>



<a name="257441289"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257441289" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257441289">(Oct 13 2021 at 21:29)</a>:</h4>
<p>can we get a list of the odbc drivers installed after the mysql driver is installed? It might be that the driver name is slightly different?</p>



<a name="257441405"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257441405" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257441405">(Oct 13 2021 at 21:29)</a>:</h4>
<blockquote>
<p>Grahame Grieve: can we get a list of the odbc drivers installed after the mysql driver is installed? It might be that the driver name is slightly different?</p>
</blockquote>
<p>I have no idea. How do you get a list of ODBC drivers, and how do you tell ODBC drivers from every other library present on the system?</p>



<a name="257441522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257441522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257441522">(Oct 13 2021 at 21:30)</a>:</h4>
<p>I can get you the library name..</p>



<a name="257441630"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257441630" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257441630">(Oct 13 2021 at 21:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>mysql-connector-odbc-8.0.26-linux-glibc2.12-x86-64bit/lib/libmyodbc8w.so
mysql-connector-odbc-8.0.26-linux-glibc2.12-x86-64bit/lib/libmyodbc8a.so
</code></pre></div>
<p>these are copied into <code>/usr/local/lib</code></p>



<a name="257476403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257476403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257476403">(Oct 14 2021 at 04:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> what do you think of this?</p>



<a name="257476436"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257476436" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257476436">(Oct 14 2021 at 04:04)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">echo</span> <span class="s2">"## ODBC info"</span>

odbcinst -j

<span class="nb">echo</span> <span class="s2">"</span><span class="k">$(</span>&lt;/etc/odbcinst.ini<span class="k">)</span><span class="s2">"</span>
</code></pre></div>



<a name="257476446"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257476446" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257476446">(Oct 14 2021 at 04:04)</a>:</h4>
<p>output:</p>
<div class="codehilite"><pre><span></span><code>#14 0.054 ## ODBC info
#14 0.056 unixODBC 2.3.6
#14 0.056 DRIVERS............: /etc/odbcinst.ini
#14 0.056 SYSTEM DATA SOURCES: /etc/odbc.ini
#14 0.056 FILE DATA SOURCES..: /etc/ODBCDataSources
#14 0.056 USER DATA SOURCES..: /root/.odbc.ini
#14 0.056 SQLULEN Size.......: 8
#14 0.056 SQLLEN Size........: 8
#14 0.056 SQLSETPOSIROW Size.: 8
#14 0.056 /work/fhirserver/build/linux-fhirserver.sh: line 7: /etc/odbcinst.ini: No such file or directory
</code></pre></div>



<a name="257476498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257476498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257476498">(Oct 14 2021 at 04:05)</a>:</h4>
<p>where in the chain does mysql get set up?</p>



<a name="257538540"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257538540" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257538540">(Oct 14 2021 at 13:52)</a>:</h4>
<p>I don't know exactly what you are asking. I copy the library files in the first step of the docker file. But I don't do anything that would generate /etc/odbcinst.ini. what is this file and who is responsible for creating it? What should it contain and how should it come to contain that? </p>
<p>I think this is clear, but the doker image does not include any MySQL server components. It only contains the client components that you have pointed me to.</p>



<a name="257538899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257538899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257538899">(Oct 14 2021 at 13:54)</a>:</h4>
<p>Okay I have one lead anyway.</p>



<a name="257538983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257538983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257538983">(Oct 14 2021 at 13:55)</a>:</h4>
<p><a href="https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-installation-binary-unix-tarball.html">https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-installation-binary-unix-tarball.html</a> contains steps three and four which perhaps I should consider following in addition to steps 1 and 2</p>



<a name="257558929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257558929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257558929">(Oct 14 2021 at 15:55)</a>:</h4>
<p>OK, now there should be something like the following present in the docker environment:</p>
<div class="codehilite"><pre><span></span><code>$ cat /etc/odbcinst.ini
[MySQL ODBC 8.0 Driver]
Driver=/usr/local/lib/libmyodbc8w.so
UsageCount=1

[MySQL ODBC 8.0]
Driver=/usr/local/lib/libmyodbc8a.so
UsageCount=1
</code></pre></div>



<a name="257559205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257559205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257559205">(Oct 14 2021 at 15:57)</a>:</h4>
<p>Indeed your <a href="https://github.com/jmandel/fhirserver/runs/3896487331?check_suite_focus=true#step:7:11166">logs show</a>:</p>
<div class="codehilite"><pre><span></span><code>#14 [ 9/10] RUN /work/fhirserver/build/linux-fhirserver.sh /work/bootstrap
#14 0.083 ## ODBC info
#14 0.085 unixODBC 2.3.6
#14 0.085 DRIVERS............: /etc/odbcinst.ini
#14 0.085 SYSTEM DATA SOURCES: /etc/odbc.ini
#14 0.085 FILE DATA SOURCES..: /etc/ODBCDataSources
#14 0.085 USER DATA SOURCES..: /root/.odbc.ini
#14 0.085 SQLULEN Size.......: 8
#14 0.085 SQLLEN Size........: 8
#14 0.085 SQLSETPOSIROW Size.: 8
#14 0.087 [MySQL ODBC 8.0 Driver]
#14 0.087 Driver=/usr/local/lib/libmyodbc8w.so
#14 0.087 UsageCount=1
#14 0.087
#14 0.087 [MySQL ODBC 8.0]
#14 0.087 Driver=/usr/local/lib/libmyodbc8a.so
#14 0.087 UsageCount=1
</code></pre></div>



<a name="257589756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257589756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257589756">(Oct 14 2021 at 19:17)</a>:</h4>
<p>great thanks</p>



<a name="257612295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257612295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257612295">(Oct 14 2021 at 21:56)</a>:</h4>
<p>Progress! <a href="https://github.com/jmandel/fhirserver/runs/3899833569?check_suite_focus=true#step:10:53">https://github.com/jmandel/fhirserver/runs/3899833569?check_suite_focus=true#step:10:53</a> makes it look like some database tests are actually running (and failing, but hey) !</p>



<a name="257613504"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257613504" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257613504">(Oct 14 2021 at 22:06)</a>:</h4>
<p>well, they all pass now, except for MSSQL which is being ignored, but wrongly counted as an error in the wash up. So I have to sort out that, and get to the bottom of the timezone issue causing another failure. And then there's smtp password issue - can we get to that?</p>



<a name="257614118"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257614118" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257614118">(Oct 14 2021 at 22:11)</a>:</h4>
<p>SMTP password should be covered. In my fork I'm using a gmail account that I registered for this purpose; we can configure it however you like in your repository.</p>



<a name="257614467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257614467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257614467">(Oct 14 2021 at 22:14)</a>:</h4>
<p>"Must provide password for SMTP test in /work/fhirserver/exec/64/test-settings.ini"</p>



<a name="257614485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257614485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257614485">(Oct 14 2021 at 22:14)</a>:</h4>
<p>FHIRSERVER_EMAIL_PASSWORD is blank then</p>



<a name="257624588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257624588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257624588">(Oct 14 2021 at 23:50)</a>:</h4>
<p>Hmm, I may be messing that up. Will review.</p>



<a name="257640320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257640320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257640320">(Oct 15 2021 at 03:25)</a>:</h4>
<p><a href="/user_uploads/10155/6FboOUUgH5R75uD_-Utd3djp/image.png">image.png</a> <br>
<a href="https://github.com/jmandel/fhirserver/runs/3901846542?check_suite_focus=true">https://github.com/jmandel/fhirserver/runs/3901846542?check_suite_focus=true</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/6FboOUUgH5R75uD_-Utd3djp/image.png" title="image.png"><img src="/user_uploads/10155/6FboOUUgH5R75uD_-Utd3djp/image.png"></a></div>



<a name="257640452"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257640452" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257640452">(Oct 15 2021 at 03:26)</a>:</h4>
<p>And I don't know why you say the email password is blank; I'm getting:</p>
<p><a href="/user_uploads/10155/CN61Gr-6_ScmiCT0xqmvqU9q/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/CN61Gr-6_ScmiCT0xqmvqU9q/image.png" title="image.png"><img src="/user_uploads/10155/CN61Gr-6_ScmiCT0xqmvqU9q/image.png"></a></div>



<a name="257640705"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257640705" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257640705">(Oct 15 2021 at 03:30)</a>:</h4>
<p>I merged this into your master branch now <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> . You can:</p>
<ol>
<li>Update <a href="https://github.com/grahamegrieve/fhirserver/blob/master/.github/workflows/linux-docker-build.yml#L49">https://github.com/grahamegrieve/fhirserver/blob/master/.github/workflows/linux-docker-build.yml#L49</a> to set <code>FHIRSERVER_EMAIL_SENDER</code> with the gmail account you like</li>
<li>Use <a href="https://github.com/grahamegrieve/fhirserver/settings/secrets/actions">https://github.com/grahamegrieve/fhirserver/settings/secrets/actions</a> to add a Repository Secret called <code>FHIRSERVER_EMAIL_PASSWORD</code> with the value of your choice, like:</li>
</ol>
<p><a href="/user_uploads/10155/QZMQDBNfkSvzrJr1yMXPoicE/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/QZMQDBNfkSvzrJr1yMXPoicE/image.png" title="image.png"><img src="/user_uploads/10155/QZMQDBNfkSvzrJr1yMXPoicE/image.png"></a></div>



<a name="257640715"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257640715" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257640715">(Oct 15 2021 at 03:30)</a>:</h4>
<p>(I can't do this for you without admin access on the repo.)</p>



<a name="257641016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257641016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257641016">(Oct 15 2021 at 03:35)</a>:</h4>
<p>done. Hopefully, that'll mean all tests pass</p>



<a name="257643780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257643780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257643780">(Oct 15 2021 at 04:18)</a>:</h4>
<p>yay they did! awesome</p>



<a name="257770088"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257770088" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257770088">(Oct 15 2021 at 21:48)</a>:</h4>
<p>one last question... reading about how to release the linux server turns into a typical linux experience - a myriad of ways to do it, most of them probably wrong, and I don't know which. I particularly liked this line in the ubuntu package documentation:</p>
<blockquote>
<p>Setting pbuilder up is very easy, run:<br>
<code>$ pbuilder-dist &lt;release&gt; create</code><br>
where &lt;release&gt; is for example xenial, zesty, artful or in the case of Debian maybe sid or buster.</p>
</blockquote>
<p>whatever "xenial, zesty, artful or in the case of Debian maybe sid or buster" might be. No hint as to what they are or why you'd chose one over the other, or maybe you have to do them all. So typical... (or even why 'in the case of debian' since this is a ubuntu guide)</p>



<a name="257773134"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257773134" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257773134">(Oct 15 2021 at 22:13)</a>:</h4>
<p>They are Ubuntu release codenames</p>



<a name="257773295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257773295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257773295">(Oct 15 2021 at 22:14)</a>:</h4>
<p><a href="https://wiki.ubuntu.com/Releases">https://wiki.ubuntu.com/Releases</a></p>



<a name="257773640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257773640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257773640">(Oct 15 2021 at 22:17)</a>:</h4>
<p>What are you working on?</p>



<a name="257774342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257774342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257774342">(Oct 15 2021 at 22:23)</a>:</h4>
<p>I'd consider just offering a dockerized version as the only supported option and see who complains.</p>



<a name="257774418"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257774418" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257774418">(Oct 15 2021 at 22:24)</a>:</h4>
<p>(The folks who want support for specific distos may be the best positioned to maintain those ;-))</p>



<a name="257774725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257774725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257774725">(Oct 15 2021 at 22:27)</a>:</h4>
<p>That might be a reasonable approach to take.</p>



<a name="257775047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257775047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257775047">(Oct 15 2021 at 22:30)</a>:</h4>
<p>And sid and buster are Debian release names - and Ubuntu and Debian are very close (Ubuntu is based on Debian), so it's not necessarily too strange for them to be mentioned alongside the actual Ubuntu releases.</p>



<a name="257779074"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257779074" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257779074">(Oct 15 2021 at 23:09)</a>:</h4>
<p>so you build different distribution packages for your app depending on which ubuntu version? weird</p>



<a name="257779144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257779144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257779144">(Oct 15 2021 at 23:10)</a>:</h4>
<p>the problem with the dockerized version - unless I misunderstand - is the 25 min start up process while everything is compiled</p>



<a name="257779276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257779276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257779276">(Oct 15 2021 at 23:11)</a>:</h4>
<p>Nonono, we'd just publish the image</p>



<a name="257779348"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257779348" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257779348">(Oct 15 2021 at 23:12)</a>:</h4>
<p>That's the intent behind the <code>.slimmed</code> file: something we could push to a Docker registry for easy deployment.</p>



<a name="257779382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257779382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257779382">(Oct 15 2021 at 23:12)</a>:</h4>
<p>Then anyone can do <code>docker run</code> without having to do the <code>docker build</code> process themselves.</p>



<a name="257779590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257779590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257779590">(Oct 15 2021 at 23:15)</a>:</h4>
<p>so one the build was complete</p>
<ul>
<li>delete the source + tools directories</li>
<li>delete all the unnecessary source files</li>
<li>leaving behind just what is needed for executable?</li>
</ul>



<a name="257779690"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257779690" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257779690">(Oct 15 2021 at 23:16)</a>:</h4>
<p>because the stuff that's not needed is about 16GB</p>



<a name="257779941"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257779941" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257779941">(Oct 15 2021 at 23:19)</a>:</h4>
<p>Yeah that's pretty much the deal. But in a Docker file like this you can't just delete content because Docker needs to save each layer of the image as it builds things up. So adding a gigabyte of content in one layer and deleting it in the next layer creates a 2 gigabyte stack of layers instead of zero. You can go through some kind of compacting step to avoid this but what I'm doing instead is just to build up a fresh Ubuntu container <code>FROM ubuntu...</code>  and copying in any requires stuff from the first image,  rather than deleting anything.)</p>



<a name="257782489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257782489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257782489">(Oct 15 2021 at 23:51)</a>:</h4>
<p>well, I can tell you what's required: </p>
<ul>
<li><code>exec/64/fhirserver</code></li>
<li><code>exec/pack/*.*</code></li>
<li><code>exec/pack/linux/*.*</code></li>
</ul>
<p>And all the linux dependencies and maybe mysql</p>



<a name="257782983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257782983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257782983">(Oct 15 2021 at 23:57)</a>:</h4>
<p><a href="https://github.com/grahamegrieve/fhirserver/blob/9cae4a5fe8ebfd984daced2d880fbf2b3390d383/Dockerfile.slimmed#L8">https://github.com/grahamegrieve/fhirserver/blob/9cae4a5fe8ebfd984daced2d880fbf2b3390d383/Dockerfile.slimmed#L8</a> captures it pretty closely already, considering that the pack files have been copied into the first path in original build. But I will clean this up.</p>



<a name="257783042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257783042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257783042">(Oct 15 2021 at 23:58)</a>:</h4>
<p>By the way, if it is possible to remove the dependencies on gtk and X windows, that would save a good chunk of space in the base layers.</p>



<a name="257783782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257783782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257783782">(Oct 16 2021 at 00:06)</a>:</h4>
<p>I looked into that. If I removed gtk, we'd still need it because I'd just need to split the executable into something that would still be needed in some configurations</p>



<a name="257783787"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257783787" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257783787">(Oct 16 2021 at 00:06)</a>:</h4>
<p>btw, add to the list above:</p>



<a name="257783799"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/257783799" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#257783799">(Oct 16 2021 at 00:07)</a>:</h4>
<ul>
<li>exec/64/fhirconsole</li>
</ul>



<a name="258316916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258316916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258316916">(Oct 20 2021 at 06:04)</a>:</h4>
<p>I was trying to run the dockerfile, until I got an error. Is that supposed to be working on  windows or only a *nix machines?</p>



<a name="258317613"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258317613" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258317613">(Oct 20 2021 at 06:15)</a>:</h4>
<p>I don't know. we only tested in on linux so far. what's the error?</p>



<a name="258317801"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258317801" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258317801">(Oct 20 2021 at 06:17)</a>:</h4>
<p>on windows, you'd be better to try the windows batch files though</p>



<a name="258338662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258338662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258338662">(Oct 20 2021 at 09:37)</a>:</h4>
<p>I'm just trying to get a docker image by running <code>docker build</code> on the Dockerfile.</p>



<a name="258338720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258338720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258338720">(Oct 20 2021 at 09:37)</a>:</h4>
<p>I'll try in a linux terminal</p>



<a name="258343665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258343665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258343665">(Oct 20 2021 at 10:19)</a>:</h4>
<p>same error from a windows powershell or windows WSL2 terminal:</p>
<div class="codehilite"><pre><span></span><code> &gt; [ 4/10] RUN /work/bootstrap/linux-toolchain.sh /work/bootstrap:
#8 0.419 /usr/bin/env: &#39;bash\r&#39;: No such file or directory
</code></pre></div>



<a name="258346382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258346382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258346382">(Oct 20 2021 at 10:44)</a>:</h4>
<p>that's a <span class="user-mention" data-user-id="191315">@Josh Mandel</span> question</p>



<a name="258427961"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258427961" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258427961">(Oct 20 2021 at 19:22)</a>:</h4>
<p>and Josh, we're not quite finished until the other docker is built correctly, right?</p>



<a name="258429357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258429357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258429357">(Oct 20 2021 at 19:31)</a>:</h4>
<p>I would only expect this to work on linux; this should WSL on windows, which I'll test from my work PC.</p>



<a name="258429483"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258429483" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258429483">(Oct 20 2021 at 19:32)</a>:</h4>
<blockquote>
<p>Grahame Grieve: and Josh, we're not quite finished until the other docker is built correctly, right?</p>
</blockquote>
<p>"Finished" re: the goal of distributing a built image? Yeah, it'd be good to set up an automated push to a docker registry when certain tags are applied. Do you have a convention for tagging release branches?</p>



<a name="258429575"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258429575" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258429575">(Oct 20 2021 at 19:32)</a>:</h4>
<p>not yet. I have to talk to <span class="user-mention" data-user-id="248736">@Mark Iantorno</span> about how to do releases. But I figured we would just get the release pipeline going before I sorted that out.</p>



<a name="258429647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258429647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258429647">(Oct 20 2021 at 19:33)</a>:</h4>
<p>I want to build the windows installer as part of that too. It looks like I can - all the things I need to do can be done on linux.</p>



<a name="258429676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258429676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258429676">(Oct 20 2021 at 19:33)</a>:</h4>
<p>Cool!</p>



<a name="258430020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258430020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258430020">(Oct 20 2021 at 19:34)</a>:</h4>
<p>authenticate signing: <a href="https://www.ssl.com/how-to/microsoft-authenticode-code-signing-in-linux-with-jsign/">https://www.ssl.com/how-to/microsoft-authenticode-code-signing-in-linux-with-jsign/</a><br>
building the installer: <a href="https://gist.github.com/amake/3e7194e5e61d0e1850bba144797fd797">https://gist.github.com/amake/3e7194e5e61d0e1850bba144797fd797</a></p>
<p>The rest of what happens can be done in shell scripts one way or another</p>



<a name="258430173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258430173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258430173">(Oct 20 2021 at 19:35)</a>:</h4>
<blockquote>
<p>just get the release pipeline going</p>
</blockquote>
<p>I think we're pretty good here; We'll basically want to do <code>docker build -t ghcr.io/grahamegrieve/fhirserver -f Dockerfile.slimmed . &amp;&amp; docker push</code> in whatever deployment action</p>



<a name="258430275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258430275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258430275">(Oct 20 2021 at 19:35)</a>:</h4>
<p>(Re: the docker image piece; the windows release stuff I will leave to your capable hands :-))</p>



<a name="258430656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258430656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258430656">(Oct 20 2021 at 19:37)</a>:</h4>
<p>I don't have a mental picture for what happens after that. The windows executable will end up here: <a href="https://github.com/HealthIntersections/fhirserver/releases">https://github.com/HealthIntersections/fhirserver/releases</a> (well, that's what I think should happen). But what happens with the docker image?</p>



<a name="258430922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258430922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258430922">(Oct 20 2021 at 19:39)</a>:</h4>
<p>The docker image will end up in the <a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry">GH container registry</a> so anyone in the world can <code>docker pull ghcr.io/grahamegrieve/fhirserver</code> and get the latest, or specify <code>:latest</code> explicitly as a suffix for the same behavior, or specify <code>:{{some tag}}</code> explicitly as a suffix to fetch a specific version.</p>



<a name="258431017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258431017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258431017">(Oct 20 2021 at 19:40)</a>:</h4>
<p>how does the version get into the picture with docker push?</p>



<a name="258431132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258431132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258431132">(Oct 20 2021 at 19:41)</a>:</h4>
<p>Before you push, you apply tags; the pushed image can be retrieved with those tags using the <code>:</code> syntax as a suffix to the image name. That's following docker standards/conventions.</p>



<a name="258431358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258431358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258431358">(Oct 20 2021 at 19:42)</a>:</h4>
<p>well, the server has a semver version on it. When we finish the release pipeline, it will go to 2.x.x, and the tag will simply be the version</p>



<a name="258431755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258431755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258431755">(Oct 20 2021 at 19:45)</a>:</h4>
<p>Sounds good to me.</p>



<a name="258431793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258431793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258431793">(Oct 20 2021 at 19:45)</a>:</h4>
<p>Should be easy to meet the <a href="https://docs.docker.com/engine/reference/commandline/tag">requirements</a>.</p>
<blockquote>
<p>A tag name must be valid ASCII and may contain lowercase and uppercase letters, digits, underscores, periods and dashes. A tag name may not start with a period or a dash and may contain a maximum of 128 characters.</p>
</blockquote>



<a name="258432252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258432252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258432252">(Oct 20 2021 at 19:48)</a>:</h4>
<p>should we do snapshot releases of the current? or just formal releases?</p>



<a name="258433070"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258433070" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258433070">(Oct 20 2021 at 19:53)</a>:</h4>
<p>I don't think I'd push an image for every commit, but we could. Would start with releases.</p>



<a name="258433261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258433261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258433261">(Oct 20 2021 at 19:54)</a>:</h4>
<p>if we pushed it with the same version, it would replace the last one, yes?</p>



<a name="258434023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258434023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258434023">(Oct 20 2021 at 19:59)</a>:</h4>
<p>Yes, various combinations possible:</p>
<ul>
<li>Tag each image with a git SHA <em>and</em>  a semver, and <code>:latest</code> and push all tags, so every build is available all the time, and <code>:latest</code> always grabs the latest</li>
<li>Tag each image with some subset of these tags...</li>
</ul>



<a name="258623597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258623597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258623597">(Oct 21 2021 at 21:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191315">Josh Mandel</span> <a href="#narrow/stream/179281-pascal/topic/Automating.20fhirserver.20build/near/258429357">said</a>:</p>
<blockquote>
<p>I would only expect this to work on linux; this should WSL on windows, which I'll test from my work PC.</p>
</blockquote>
<p>Still doesn't work. could it be this line ?</p>
<div class="codehilite"><pre><span></span><code>Xvfb  :99 -screen 0 1024x768x8 -nolisten tcp &amp; \n\
</code></pre></div>



<a name="258623796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258623796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258623796">(Oct 21 2021 at 21:58)</a>:</h4>
<p>Does it work if you remove this line? (I have not tried this on WSL but can do.)</p>



<a name="258629513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258629513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258629513">(Oct 21 2021 at 22:49)</a>:</h4>
<p>I'll try tomorrow. I recall some discussions around enabling graphics so I thought it could be needed</p>



<a name="258629576"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258629576" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258629576">(Oct 21 2021 at 22:49)</a>:</h4>
<p>I don't have a Linux machine, just a Linux terminal prompt on windows. So I don't have X</p>



<a name="258630998"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258630998" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258630998">(Oct 21 2021 at 23:03)</a>:</h4>
<p>This doesn't use X as a grpahical environment though. It uses  Xvfb, a virtual framebuffer. Headless implementation.</p>



<a name="258631446"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631446" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631446">(Oct 21 2021 at 23:06)</a>:</h4>
<p>Confirmed that I can run </p>
<div class="codehilite"><pre><span></span><code>~/fhirserver$ docker build -t grahamegrieve/fhirserver -f Dockerfile .
</code></pre></div>

<p>in WSL2 on my windows laptop. (Though it ... was not fast.)</p>



<a name="258631479"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631479" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631479">(Oct 21 2021 at 23:07)</a>:</h4>
<p>what does not fast mean?</p>



<a name="258631490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631490">(Oct 21 2021 at 23:07)</a>:</h4>
<p>Having done so, </p>
<div class="codehilite"><pre><span></span><code>$ docker run --rm -it grahamegrieve/fhirserver
</code></pre></div>

<p>succeeds in starting the server for me</p>



<a name="258631535"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631535" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631535">(Oct 21 2021 at 23:07)</a>:</h4>
<blockquote>
<p>Grahame Grieve: what does not fast mean?</p>
</blockquote>
<p>I mean, my work laptop is long in the tooth. But my internet connection is <em>fast</em>. This took me </p>
<div class="codehilite"><pre><span></span><code> Building 3848.5s (15/15) FINISHED
</code></pre></div>



<a name="258631540"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631540" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631540">(Oct 21 2021 at 23:07)</a>:</h4>
<p>(!)</p>



<a name="258631642"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631642" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631642">(Oct 21 2021 at 23:08)</a>:</h4>
<p>that's definitely not fast. The full build including tests is taking 30min on github</p>



<a name="258631676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631676">(Oct 21 2021 at 23:09)</a>:</h4>
<p>sorry ~25min</p>



<a name="258631828"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631828" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631828">(Oct 21 2021 at 23:10)</a>:</h4>
<p>GH is caching though, keep in mind (it caches the lazarus stuff until/unless the early lines of the dockerfile change)</p>



<a name="258631897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258631897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258631897">(Oct 21 2021 at 23:11)</a>:</h4>
<p>hmm. I'll time my linux laptop, but it feels about the same starting from scratch</p>



<a name="258632042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258632042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258632042">(Oct 21 2021 at 23:12)</a>:</h4>
<p>It may be; the speedup in GH from caching was only about 5min when I clocked it, because the caching itself isn't super fast. We can cut it out for simplicity if you prefer.</p>



<a name="258632576"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258632576" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258632576">(Oct 21 2021 at 23:17)</a>:</h4>
<p>no keep it</p>



<a name="258668404"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258668404" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258668404">(Oct 22 2021 at 06:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191315">Josh Mandel</span> <a href="#narrow/stream/179281-pascal/topic/Automating.20fhirserver.20build/near/258631446">said</a>:</p>
<blockquote>
<p>Confirmed that I can run </p>
<div class="codehilite"><pre><span></span><code>~/fhirserver$ docker build -t grahamegrieve/fhirserver -f Dockerfile .
</code></pre></div>

<p>in WSL2 on my windows laptop. (Though it ... was not fast.)</p>
</blockquote>
<p>Found it. It's a CR/LF thing. It depends on one's git configuration. To fix it, I had to replace all CRLF to LF</p>



<a name="258668508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258668508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258668508">(Oct 22 2021 at 06:22)</a>:</h4>
<p>unbelievable</p>



<a name="258668826"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258668826" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258668826">(Oct 22 2021 at 06:27)</a>:</h4>
<p>more unbelievable is how silly I am to fix one file, run it for 10 minutes, and only then realizing that of course I have to do the same for all the other .sh scripts</p>



<a name="258671458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258671458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258671458">(Oct 22 2021 at 07:01)</a>:</h4>
<p>Confirmed. It builds ok now.</p>



<a name="258671683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258671683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258671683">(Oct 22 2021 at 07:04)</a>:</h4>
<p>1038 seconds on a Ryzen 9 3900x desktop</p>



<a name="258672024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258672024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258672024">(Oct 22 2021 at 07:08)</a>:</h4>
<p>i now get a <code>First time, so can't continue.</code><br>
What do i need to look at to pick up from here?</p>



<a name="258686591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258686591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258686591">(Oct 22 2021 at 09:36)</a>:</h4>
<p>where do you get that?</p>



<a name="258708242"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258708242" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258708242">(Oct 22 2021 at 13:03)</a>:</h4>
<p><span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span>  did you clone this repository within wsl, or copied in from a Windows git operation performed outside of WSL? Just trying to figure out where your configuration and mine differed. I believe that the default Windows settings for new lines in git are different than the default Linux settings because the operating systems have different conventions. As you point out, configuring git is one way to resolve this; using default git settings in WSL should be another.</p>



<a name="258710712"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258710712" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258710712">(Oct 22 2021 at 13:24)</a>:</h4>
<p>And Grahame for the record what is your</p>
<div class="codehilite"><pre><span></span><code>git config core.autocrlf
</code></pre></div>



<a name="258710805"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258710805" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258710805">(Oct 22 2021 at 13:25)</a>:</h4>
<p>(<a href="https://stackoverflow.com/a/20653073/318206">https://stackoverflow.com/a/20653073/318206</a> has a good overview.)</p>



<a name="258726458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258726458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258726458">(Oct 22 2021 at 15:18)</a>:</h4>
<p>I got the files in Windows</p>



<a name="258726493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258726493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258726493">(Oct 22 2021 at 15:18)</a>:</h4>
<p>So no clone in wsl</p>



<a name="258748798"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258748798" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258748798">(Oct 22 2021 at 17:57)</a>:</h4>
<blockquote>
<p>git config core.autocrlf</p>
</blockquote>
<p>false</p>



<a name="258759124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258759124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258759124">(Oct 22 2021 at 19:10)</a>:</h4>
<p>(Let me RTFM to see if we can prevent others from encountering the same issue)</p>



<a name="258777832"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258777832" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258777832">(Oct 22 2021 at 21:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179281-pascal/topic/Automating.20fhirserver.20build/near/258686591">said</a>:</p>
<blockquote>
<p>where do you get that?</p>
</blockquote>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I just run the docker image, I don't know if there are any parameters when I do that</p>



<a name="258778015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258778015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258778015">(Oct 22 2021 at 21:34)</a>:</h4>
<p>I'm running <code>docker run --rm -it fhirserver</code></p>



<a name="258778037"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258778037" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258778037">(Oct 22 2021 at 21:34)</a>:</h4>
<p>What should I run to get the DB initialized?</p>



<a name="258778385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258778385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258778385">(Oct 22 2021 at 21:38)</a>:</h4>
<p>Do you see an error prior to "First time, so can't continue"? (When I saw this once, it was right after a download failed.)</p>



<a name="258778459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258778459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258778459">(Oct 22 2021 at 21:39)</a>:</h4>
<p>right, sorry I missed that:</p>
<div class="codehilite"><pre><span></span><code>07:07:09 00:00:00 Local Config in /terminology/fhir-server/
07:07:09 00:00:00 Read Zero Config from http://tx.fhir.org/config/config.json
07:07:10 00:00:00 Realm: uv
07:07:10 00:00:00 Download rxnorm-20210208.db. HTTP/1.1 500 Internal Server Error
07:07:10 00:00:00 Zero Configuration Process failed: HTTP/1.1 500 Internal Server Error
</code></pre></div>



<a name="258778655"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258778655" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258778655">(Oct 22 2021 at 21:41)</a>:</h4>
<p>So if you try again you may get a different result. Best to mount in a volume so you don't lose the vocabs that <em>have</em> successfully downloaded between each run.</p>



<a name="258778695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258778695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258778695">(Oct 22 2021 at 21:41)</a>:</h4>
<p>tried a few times, same result.</p>



<a name="258778760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258778760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258778760">(Oct 22 2021 at 21:42)</a>:</h4>
<p>OK -- looks like an error in the cloud-hosted sever's stack then. (<code>HTTP/1.1 500</code>)</p>



<a name="258778974"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258778974" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258778974">(Oct 22 2021 at 21:44)</a>:</h4>
<p>mounting in volume: <code>docker run -v ____</code> ?</p>



<a name="258779108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258779108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258779108">(Oct 22 2021 at 21:45)</a>:</h4>
<p>(I created a volume named fhirserver - what is the path where the volume is mounted?)</p>



<a name="258779671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258779671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258779671">(Oct 22 2021 at 21:51)</a>:</h4>
<p>Let's say you have a host directory like /tmp/term, then you can do</p>
<div class="codehilite"><pre><span></span><code>docker run \
  --rm -it \
  -v /tmp/term:/terminology \
  grahamegrieve/fhirserver
</code></pre></div>

<p>For reference</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ docker inspect fhirserver <span class="p">|</span> jq <span class="s1">'.[].Config.Volumes'</span>
<span class="o">{</span>
  <span class="s2">"/terminology"</span>: <span class="o">{}</span>
<span class="o">}</span>
</code></pre></div>
<p>or</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ cat Dockerfile <span class="p">|</span> grep -i volume
VOLUME /terminology
</code></pre></div>



<a name="258780255"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258780255" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258780255">(Oct 22 2021 at 21:56)</a>:</h4>
<p>thanks</p>



<a name="258780378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258780378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258780378">(Oct 22 2021 at 21:57)</a>:</h4>
<p>(I see the same errors as you :-)</p>



<a name="258780528"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258780528" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258780528">(Oct 22 2021 at 21:58)</a>:</h4>
<p>I can't say I'm happy about that, but I'm kind of happy about that :)</p>



<a name="258781581"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258781581" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258781581">(Oct 22 2021 at 22:08)</a>:</h4>
<p>so I guess the server error is no longer a docker issue but in the pascal code?</p>



<a name="258781631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258781631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258781631">(Oct 22 2021 at 22:08)</a>:</h4>
<p>I think it's an issue with the web server Grahame hosts at <a href="http://tx.fhir.org">tx.fhir.org</a>, which your local server is trying to connect to on startup to fetch vocab filesr</p>



<a name="258781638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258781638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258781638">(Oct 22 2021 at 22:09)</a>:</h4>
<p>i'm trying to see if the files are actually on the server, but they're now</p>



<a name="258781660"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258781660" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258781660">(Oct 22 2021 at 22:09)</a>:</h4>
<p>right.</p>



<a name="258781742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258781742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258781742">(Oct 22 2021 at 22:09)</a>:</h4>
<p>how do we point it to a different config.json file, instead of getting the config.json online?</p>



<a name="258781822"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258781822" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258781822">(Oct 22 2021 at 22:10)</a>:</h4>
<p>no , let me check that in the code</p>



<a name="258782038"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782038" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782038">(Oct 22 2021 at 22:12)</a>:</h4>
<p>oh - first time can't continue in that place - totally my problem. I'll look at it tonight and figure out why - it was broken for a while yesterday but should be good now</p>



<a name="258782130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782130">(Oct 22 2021 at 22:13)</a>:</h4>
<p>ok meanwhile I see that we can pass a -cfg parameter in the command line.</p>



<a name="258782212"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782212" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782212">(Oct 22 2021 at 22:14)</a>:</h4>
<p>Is there a way to pass a parameter to the fhirserver command line when doing docker run?</p>



<a name="258782337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782337">(Oct 22 2021 at 22:15)</a>:</h4>
<p>Just add arguments after "grahamegrieve/fhirserver"</p>



<a name="258782383"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782383" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782383">(Oct 22 2021 at 22:15)</a>:</h4>
<p>in the build line, or can also be just in the run?</p>



<a name="258782391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782391">(Oct 22 2021 at 22:15)</a>:</h4>
<p>like <code>docker run grahamegrieve/fhirserver -cfg /tmp/file</code></p>



<a name="258782445"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782445" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782445">(Oct 22 2021 at 22:16)</a>:</h4>
<p>(But you'll need to point to a file that exists in the container or mount one in)</p>



<a name="258782462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782462">(Oct 22 2021 at 22:16)</a>:</h4>
<p>ok perfect i thought I had to rebuild. thanks</p>



<a name="258782619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782619">(Oct 22 2021 at 22:17)</a>:</h4>
<p>but why do you need to do that? what's actually broken? you need to access the file it says that it can't read...</p>



<a name="258782750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782750">(Oct 22 2021 at 22:19)</a>:</h4>
<p>while I am getting the 500 error from the server, I want to experiment with the config file, <br>
I want to learn how to run a server with my own config.json</p>



<a name="258782871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782871">(Oct 22 2021 at 22:20)</a>:</h4>
<p>For now, I just want to see if I can get it to move on when I have a config file that doesn't have the rxnorm db</p>



<a name="258782884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782884">(Oct 22 2021 at 22:20)</a>:</h4>
<p>well, ok, but why are you getting a 500 error from the server? can you access it in a browser?</p>



<a name="258782951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782951">(Oct 22 2021 at 22:20)</a>:</h4>
<p>no<br>
<code>The webpage at http://tx.fhir.org/config/rxnorm-20210208.db might be temporarily down or it may have moved permanently to a new web address.</code></p>



<a name="258782993"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258782993" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258782993">(Oct 22 2021 at 22:21)</a>:</h4>
<p>oh interesting. the server won't download the .db files... I wonder why</p>



<a name="258783001"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258783001" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258783001">(Oct 22 2021 at 22:21)</a>:</h4>
<p>I will look at this tonight</p>



<a name="258783002"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258783002" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258783002">(Oct 22 2021 at 22:21)</a>:</h4>
<p><a href="https://tx.fhir.org/config/loinc-2.71.cache">https://tx.fhir.org/config/loinc-2.71.cache</a> does work</p>



<a name="258783189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258783189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258783189">(Oct 22 2021 at 22:23)</a>:</h4>
<p>which reminds me <span class="user-mention" data-user-id="191315">@Josh Mandel</span> I got around to looking into putting this stuff into cloud storage. Is there a cloud storage that doesn't suck? both AWS and GCS, I couldn't even figure out how to start doing it - so many configuration options in language I can't understand, and the hl7 guys tell me that AWS doesn't want new publicly available cloud storages...</p>



<a name="258790237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258790237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258790237">(Oct 22 2021 at 23:49)</a>:</h4>
<blockquote>
<p>Is there a cloud storage that doesn't suck? </p>
</blockquote>
<p>I'm not sure what you mean about "new publicly available cloud storages" You can configure S3 public buckets following <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingBucket.html#block-public-access-intro">https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingBucket.html#block-public-access-intro</a></p>



<a name="258790345"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258790345" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258790345">(Oct 22 2021 at 23:50)</a>:</h4>
<p>(Looks like they have introduced defaults designed to prevent <a href="https://www.computerweekly.com/news/252476870/Exposed-AWS-buckets-again-implicated-in-multiple-data-leaks">https://www.computerweekly.com/news/252476870/Exposed-AWS-buckets-again-implicated-in-multiple-data-leaks</a>)</p>



<a name="258790465"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258790465" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258790465">(Oct 22 2021 at 23:52)</a>:</h4>
<p>Or... I put the snomed.test.cache file (for tests) in <a href="https://console.cloud.google.com/storage/browser/ig-build">https://console.cloud.google.com/storage/browser/ig-build</a> which supports public https access -- e.g., at <a href="https://storage.googleapis.com/ig-build/snomed.test.cache">https://storage.googleapis.com/ig-build/snomed.test.cache</a></p>



<a name="258795955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258795955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258795955">(Oct 23 2021 at 01:36)</a>:</h4>
<p>so I created  a sub-folder /tx. now: <a href="https://storage.googleapis.com/ig-build/tx/config.json">https://storage.googleapis.com/ig-build/tx/config.json</a> = access denied.</p>



<a name="258796125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258796125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258796125">(Oct 23 2021 at 01:40)</a>:</h4>
<p>so I have to explicitly add allUsers for all files in the folder :-(</p>



<a name="258796204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258796204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258796204">(Oct 23 2021 at 01:42)</a>:</h4>
<p><a href="https://storage.googleapis.com/ig-build/tx/ucum-essence-2.0.1.xml">https://storage.googleapis.com/ig-build/tx/ucum-essence-2.0.1.xml</a></p>



<a name="258796210"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258796210" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258796210">(Oct 23 2021 at 01:42)</a>:</h4>
<p>why doesn't access to this work? As I said, sucky. permissions model is impossible to navigate</p>



<a name="258797555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258797555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258797555">(Oct 23 2021 at 02:14)</a>:</h4>
<p>There is no such thing as a folder in this paradigm. Merely conventions about <del>file</del> blob name prefixes which happened to include slashes :-)</p>



<a name="258797558"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258797558" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258797558">(Oct 23 2021 at 02:14)</a>:</h4>
<p>But you can set up a bucket so that all files in our public by default which you might want here.</p>



<a name="258798209"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258798209" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258798209">(Oct 23 2021 at 02:31)</a>:</h4>
<p>it was how it was set up but apparently it doesn't matter how it's set up, only how it was set up when the file was uploaded</p>



<a name="258799708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258799708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258799708">(Oct 23 2021 at 03:09)</a>:</h4>
<p>ok sorted that. Uploading will be a nightmare, but... the new zero config URL for the server is <a href="https://storage.googleapis.com/tx-fhir-org">https://storage.googleapis.com/tx-fhir-org</a></p>



<a name="258799711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258799711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258799711">(Oct 23 2021 at 03:09)</a>:</h4>
<p><a href="http://tx.fhir.org">tx.fhir.org</a> will be using that set up from the next time it restarts</p>



<a name="258799985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258799985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258799985">(Oct 23 2021 at 03:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span> you've seen <a href="https://confluence.hl7.org/display/FHIR/Running+your+own+copy+of+tx.fhir.org">https://confluence.hl7.org/display/FHIR/Running+your+own+copy+of+tx.fhir.org</a> ?</p>



<a name="258814068"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258814068" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258814068">(Oct 23 2021 at 09:41)</a>:</h4>
<p>Thanks, just did, i'm now downloading</p>



<a name="258829232"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258829232" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258829232">(Oct 23 2021 at 15:34)</a>:</h4>
<p>Lovely, I get ~350Mb/s from there</p>
<div class="codehilite"><pre><span></span><code>15:30:15 00:00:00 Config: https://storage.googleapis.com/tx-fhir-org
15:30:15 00:00:00 Local Config in /terminology/fhir-server/
15:30:15 00:00:00 Read Zero Config from https://storage.googleapis.com/tx-fhir-org/config.json
15:30:16 00:00:00 Realm: uv
15:30:16 00:00:00 Download rxnorm-20210208.db.................................................. Done (1.3 GB, 29sec)
15:30:45 00:00:29 Download ndc-20210923.db.................................................. Done (60.5 MB, 1sec)
15:30:47 00:00:31 Download unii-20210810.db.................................................. Done (55.2 MB, 6sec)
15:30:54 00:00:38 Download sct_intl_20210731-fixed.cache.................................................. Done (733.0 MB, 23sec)
15:31:18 00:01:02 Download loinc-2.71.cache.................................................. Done (168.0 MB, 4sec)
15:31:22 00:01:06 Download ucum-essence-2.0.1.xml........................................ Done (82.4 KB, 340ms)
15:31:23 00:01:07 Realm: au
15:31:23 00:01:07 Download sct_au_20210630.cache.................................................. Done (898.7 MB, 20sec)
15:31:43 00:01:27 Realm: ca
15:31:43 00:01:27 Download sct_ca_20210331.cache.................................................. Done (0.9 GB, 22sec)
15:32:05 00:01:49 Realm: old
15:32:05 00:01:49 Download sct_intl_20190731.cache.................................................. Done (880.6 MB, 20sec)
15:32:26 00:02:10 Download sct_intl_20200731.cache.................................................. Done (1.0 GB, 24sec)
15:32:50 00:02:34 Download sct_intl_20200131.cache.................................................. Done (1.0 GB, 23sec)
15:33:13 00:02:57 Realm: us
15:33:13 00:02:57 Download sct_us_20210901.cache.................................................. Done (760.3 MB, 17sec)
</code></pre></div>



<a name="258829408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/258829408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#258829408">(Oct 23 2021 at 15:39)</a>:</h4>
<p>Is it expected that I see slow steps like the following each time I start the server, even though the config hasn't changed?</p>
<div class="codehilite"><pre><span></span><code>15:37:19 00:00:05 Installing Package from https://packages.simplifier.net/hl7.fhir.r4.core/4.0.1 to /var/lib/.fhir/packages
</code></pre></div>

<p>If this is expected: is there an underlying reason why contents from <a href="http://packages.simplifier.org">packages.simplifier.org</a> can't be saved locally the way vocabularies are? (I'm thinking that once I have set up the server, or once I have fed in the right volumes with data dependencies... I should be able to start/run it in a totally internal way without it needing to reach to the internet.)</p>



<a name="260068063"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260068063" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260068063">(Nov 02 2021 at 22:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> I broke something, and I don't understand what.</p>



<a name="260068093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260068093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260068093">(Nov 02 2021 at 22:43)</a>:</h4>
<p><a href="https://github.com/HealthIntersections/fhirserver/runs/4086273976?check_suite_focus=true">https://github.com/HealthIntersections/fhirserver/runs/4086273976?check_suite_focus=true</a></p>



<a name="260068155"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260068155" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260068155">(Nov 02 2021 at 22:44)</a>:</h4>
<p>which is because of the changes I made to the dockerfile in the gg-202110-code-scanning branch</p>



<a name="260068177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260068177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260068177">(Nov 02 2021 at 22:44)</a>:</h4>
<p>I wanted to run another executable, but why is it blowing up on it?</p>



<a name="260069884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260069884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260069884">(Nov 02 2021 at 23:05)</a>:</h4>
<p>Let's see...</p>



<a name="260070042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070042">(Nov 02 2021 at 23:06)</a>:</h4>
<p><a href="https://github.com/HealthIntersections/fhirserver/blame/gg-202110-code-scanning/Dockerfile">https://github.com/HealthIntersections/fhirserver/blame/gg-202110-code-scanning/Dockerfile</a></p>



<a name="260070212"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070212" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070212">(Nov 02 2021 at 23:08)</a>:</h4>
<p>You've added lines to the entry point script, with two problems:</p>
<ol>
<li>They are syntactically invalid (need <code>\</code> at the end to continue this block, like the lines above and below</li>
<li>They don't make sense; the entry point script executes every time someone does <code>docker run</code>; it should accept arguments and do one job, but you seem to be trying to do two different</li>
</ol>



<a name="260070246"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070246" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070246">(Nov 02 2021 at 23:08)</a>:</h4>
<p>what entry point script?</p>



<a name="260070261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070261">(Nov 02 2021 at 23:09)</a>:</h4>
<p>I am trying to run another executable, yes, and run it before the test cases</p>



<a name="260070332"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070332" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070332">(Nov 02 2021 at 23:10)</a>:</h4>
<p>The comments are also wrong; you've written "run tests" but the function of this line is to execute server with any supplied arguments (tests are passed in via the GH action but default cmd arguments below are just to run the server with <a href="http://tx.fhir.org">tx.fhir.org</a> configuration)</p>



<a name="260070436"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070436" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070436">(Nov 02 2021 at 23:11)</a>:</h4>
<p>Think of the entry point as a wrapper around the <code>fhirserver</code> executable. The whole job of the entry point is to get configuration in place, pass through any command line args, and get out of the way.</p>



<a name="260070439"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070439" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070439">(Nov 02 2021 at 23:11)</a>:</h4>
<p>so how can I do this then? I build this executable in /work/fhirserver/utilities/codescan/codescan, and I want to run it</p>



<a name="260070450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070450">(Nov 02 2021 at 23:11)</a>:</h4>
<p>before the fhirserver runs</p>



<a name="260070452"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070452" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070452">(Nov 02 2021 at 23:11)</a>:</h4>
<p>If you want to affect the tests that run in CI..</p>



<a name="260070471"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070471" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070471">(Nov 02 2021 at 23:11)</a>:</h4>
<p>You'll want to edit <a href="https://github.com/HealthIntersections/fhirserver/blob/gg-202110-code-scanning/.github/workflows/linux-docker-build.yml#L69">https://github.com/HealthIntersections/fhirserver/blob/gg-202110-code-scanning/.github/workflows/linux-docker-build.yml#L69</a></p>



<a name="260070592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070592">(Nov 02 2021 at 23:13)</a>:</h4>
<p>E.g., add a line like <code>docker run --entrypoint /work/fhir server/.../codescan ... fhirserver</code></p>



<a name="260070625"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070625" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070625">(Nov 02 2021 at 23:13)</a>:</h4>
<p>I suppose I just don't understand the relationship between the dockerfile and this .yml file, and which is done in which</p>



<a name="260070637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070637">(Nov 02 2021 at 23:13)</a>:</h4>
<p>If you need to pass in a a command line arg to the codescan binary, that goes at the end</p>



<a name="260070699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070699">(Nov 02 2021 at 23:14)</a>:</h4>
<p>The Dockerfile builds a docker image with a fhirserver and related tools/libraries inside it</p>



<a name="260070776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070776">(Nov 02 2021 at 23:15)</a>:</h4>
<p>The GH action runs a container based on this image, invoking the executables with whatever arguments are required for the CI process to be happy that this commit is valid</p>



<a name="260070870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260070870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260070870">(Nov 02 2021 at 23:17)</a>:</h4>
<p>The Dockerfile includes a default entry point that executes fhirserver, so real users can basically treat it as the fhirserver. If you want to execute other binaries inside, you need to specify a different entry point</p>



<a name="260073110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260073110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260073110">(Nov 02 2021 at 23:42)</a>:</h4>
<p>so what I don't understand in linux-docker-build.yml is when does the build actually happen?</p>



<a name="260073122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260073122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260073122">(Nov 02 2021 at 23:42)</a>:</h4>
<p>is it Buildx?  if not, what is Buildx doing?</p>



<a name="260073265"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260073265" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260073265">(Nov 02 2021 at 23:44)</a>:</h4>
<p>and what's the <code>`... fhirserver</code> about in what you put above?</p>



<a name="260076143"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260076143" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260076143">(Nov 03 2021 at 00:23)</a>:</h4>
<p><code>docker buildx build</code> at <a href="https://github.com/HealthIntersections/fhirserver/blob/7e072c7e5ab9e2d6e4455f7524c5d0a657be219c/.github/workflows/linux-docker-build.yml#L42">https://github.com/HealthIntersections/fhirserver/blob/7e072c7e5ab9e2d6e4455f7524c5d0a657be219c/.github/workflows/linux-docker-build.yml#L42</a> builds the image.</p>



<a name="260076150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260076150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260076150">(Nov 03 2021 at 00:23)</a>:</h4>
<p>Based on the Dockerfile</p>



<a name="260076264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260076264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260076264">(Nov 03 2021 at 00:24)</a>:</h4>
<p>The <code>...</code> was a placeholder for any arguments you might want to supply like if you need to mount any directories into the container or define any ports. I'm still not sure I understand what the codescan is doing; is it meant to scan the source code in your repository for "Trojan Source" contents?</p>



<a name="260076496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260076496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260076496">(Nov 03 2021 at 00:28)</a>:</h4>
<p>If that's the main reason, you might just run grep outside of all this Dickers stuff as a standalone step -- <a href="https://news.ycombinator.com/item?id=29062307">https://news.ycombinator.com/item?id=29062307</a> has pointers</p>



<a name="260076534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260076534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260076534">(Nov 03 2021 at 00:29)</a>:</h4>
<p>(And I expect someone will build this into existing source code scanning GH actions within a few days.)</p>



<a name="260076546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260076546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260076546">(Nov 03 2021 at 00:29)</a>:</h4>
<p>that was the trigger for me to get around to doing this, but it does other things in the code as well</p>



<a name="260076567"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260076567" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260076567">(Nov 03 2021 at 00:30)</a>:</h4>
<p>Sounds good.</p>



<a name="260079346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079346">(Nov 03 2021 at 01:14)</a>:</h4>
<p>well, I'm getting there, but still not there yet.</p>



<a name="260079357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079357">(Nov 03 2021 at 01:14)</a>:</h4>
<div class="codehilite"><pre><span></span><code>021-11-03T01:00:30.2283884Z ##[group]Run docker run --entrypoint /work/fhirserver/codescan/codescan /work/bootstrap
2021-11-03T01:00:30.2285434Z [36;1mdocker run --entrypoint /work/fhirserver/codescan/codescan /work/bootstrap[0m
2021-11-03T01:00:30.3214919Z shell: /usr/bin/bash -e {0}
2021-11-03T01:00:30.3215465Z ##[endgroup]
2021-11-03T01:00:30.3956267Z docker: invalid reference format.
2021-11-03T01:00:30.3968559Z See &#39;docker run --help&#39;.
2021-11-03T01:00:30.3993955Z ##[error]Process completed with exit code 125.
</code></pre></div>



<a name="260079376"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079376" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079376">(Nov 03 2021 at 01:15)</a>:</h4>
<p>I don't understand what "invalid reference format" means?</p>



<a name="260079476"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079476" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079476">(Nov 03 2021 at 01:16)</a>:</h4>
<p>You need to specify an image. Assuming it's the image that we've tagged as "fhirserver":</p>
<div class="codehilite"><pre><span></span><code>docker run --entrypoint /work/fhirserver/codescan/codescan fhirserver /work/bootstrap
</code></pre></div>



<a name="260079489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079489">(Nov 03 2021 at 01:17)</a>:</h4>
<blockquote>
<p>Assuming it's the image that we've tagged as "fhirserver"</p>
</blockquote>
<p>I don't know what that means.</p>



<a name="260079496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079496">(Nov 03 2021 at 01:17)</a>:</h4>
<p>/work/fhirserver/codescan/codescan is an executable that should exist on the system, and I want to run it</p>



<a name="260079500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079500">(Nov 03 2021 at 01:17)</a>:</h4>
<p><a href="https://github.com/HealthIntersections/fhirserver/blob/7e072c7e5ab9e2d6e4455f7524c5d0a657be219c/.github/workflows/linux-docker-build.yml#L46">https://github.com/HealthIntersections/fhirserver/blob/7e072c7e5ab9e2d6e4455f7524c5d0a657be219c/.github/workflows/linux-docker-build.yml#L46</a> assigns a tag</p>



<a name="260079603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079603">(Nov 03 2021 at 01:19)</a>:</h4>
<p>You need to do "docker run [--entrypoint /path/to/bin] {tag} [cli args]" where {} is a required value and [] is optional</p>



<a name="260079614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079614">(Nov 03 2021 at 01:20)</a>:</h4>
<p>In your case, try the command I listed above</p>



<a name="260079717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260079717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260079717">(Nov 03 2021 at 01:21)</a>:</h4>
<p>ok thanks, I think I understand now.</p>



<a name="260081438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260081438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260081438">(Nov 03 2021 at 01:58)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> sigh. like fhirserver, the code scanner needs gui support. I tried to rip it out, but it's a huge code change for me. Maybe I'm doing it wrong, but any thing with color reasoning brings in the gui framework</p>



<a name="260081491"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260081491" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260081491">(Nov 03 2021 at 01:58)</a>:</h4>
<p>so the code scanner, since it depends on the same base string library that does colour / string wrangling. and so I get this:</p>



<a name="260081493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260081493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260081493">(Nov 03 2021 at 01:58)</a>:</h4>
<p>Oy. The code scanner uses colors?</p>



<a name="260081495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260081495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260081495">(Nov 03 2021 at 01:58)</a>:</h4>
<p>(codescan:1): Gtk-WARNING **: 01:54:49.280: cannot open display: :99</p>



<a name="260081583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260081583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260081583">(Nov 03 2021 at 02:00)</a>:</h4>
<p>it's really hard to fix this, and I thought that we had sorted this out for the FHIRServer, so it should just work?</p>



<a name="260081691"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260081691" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260081691">(Nov 03 2021 at 02:00)</a>:</h4>
<p>I did spend 30 minutes trying to splice the GUI code out, but then I realised just how big a task that is. Might take me 3 or 4 days</p>



<a name="260081745"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260081745" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260081745">(Nov 03 2021 at 02:01)</a>:</h4>
<p>(Er, accidentally deleted this msg; can't fix on mobile but you can see the history.)</p>



<a name="260081819"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260081819" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260081819">(Nov 03 2021 at 02:03)</a>:</h4>
<p>Or we could keep one entry point file and require users to pass an additional arg telling it which executable to run. But I think that clouds the common case DX</p>



<a name="260088253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260088253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260088253">(Nov 03 2021 at 04:12)</a>:</h4>
<p>ok, well, I bit the bullet and reshuffled a little differently, and now my code scanner runs.</p>



<a name="260088257"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260088257" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260088257">(Nov 03 2021 at 04:12)</a>:</h4>
<p>and it tells me that the code in the dependent repositories isn't being updated.</p>



<a name="260088269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260088269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260088269">(Nov 03 2021 at 04:13)</a>:</h4>
<p>looking at the raw log (<a href="https://pipelines.actions.githubusercontent.com/ndybd65Zkxa5S6FQ0UrdL992It9FGwV31XpzWUz7if34N6rUNI/_apis/pipelines/1/runs/116/signedlogcontent/2?urlExpires=2021-11-03T04%3A12%3A15.4520223Z&amp;urlSigningMethod=HMACV1&amp;urlSignature=qXhvJopunSXQEI6xxKCwOebQlb5EDdIg7zmFgeAcQYw%3D">https://pipelines.actions.githubusercontent.com/ndybd65Zkxa5S6FQ0UrdL992It9FGwV31XpzWUz7if34N6rUNI/_apis/pipelines/1/runs/116/signedlogcontent/2?urlExpires=2021-11-03T04%3A12%3A15.4520223Z&amp;urlSigningMethod=HMACV1&amp;urlSignature=qXhvJopunSXQEI6xxKCwOebQlb5EDdIg7zmFgeAcQYw%3D</a>):</p>
<p><code>021-11-03T02:55:00.7044244Z #10 [ 5/10] RUN /work/bootstrap/unix-libraries.sh /work/bootstrap</code></p>



<a name="260088275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260088275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260088275">(Nov 03 2021 at 04:13)</a>:</h4>
<p>that must lead to lines like this running:</p>



<a name="260088278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260088278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260088278">(Nov 03 2021 at 04:13)</a>:</h4>
<p><code>echo "Updating dependencies for linux"</code></p>



<a name="260088281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260088281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260088281">(Nov 03 2021 at 04:13)</a>:</h4>
<p>but no, nothing. So I think that script isn't being executed at all</p>



<a name="260088285"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260088285" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260088285">(Nov 03 2021 at 04:13)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span></p>



<a name="260137258"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260137258" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260137258">(Nov 03 2021 at 13:57)</a>:</h4>
<p>That URI is "expired". But what's going on here is caching of docker layers across CI runs, which we've specifically enabled and can turn off if you don't want it, for a build time penalty. Alternatively, you can modify one of the input input files (e.g., add a comment line to unix-libraries that you update when you want to bust this caching) or alternatively we could play some trick to prevent any caching beyond the point at which the tool chain is installed, like copying a temp file with random content into the container right after that step)m</p>



<a name="260172269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260172269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260172269">(Nov 03 2021 at 17:56)</a>:</h4>
<p>I don't understand. Why does caching stop git update from being run?</p>



<a name="260174046"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260174046" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260174046">(Nov 03 2021 at 18:08)</a>:</h4>
<p>Docker has a "dumb" model for caching layers where:</p>
<ul>
<li>Each line of the Dockerfile represents a "step" of the build process, and the output of each step is a new "layer" (i.e., a docker image representing the state after that step has been run)</li>
<li>Only a few steps (<code>COPY</code> and <code>ADD</code> steps) directly bring external content into their output layer (other steps like <code>RUN</code> can of course fetch files from the network, etc -- but Docker does not attempt to account for this in its caching model)</li>
<li>A step that has already run will never run-run unless its inputs have changed (or the inputs to its predecessors have changed)</li>
</ul>
<p>So... the way it's currently configured, if the inputs to the first <code>COPY</code> step  (<code>build/linux-toolchain.sh</code> and <code>build/unix-libraries.sh</code>) haven't changed, then the <a href="https://github.com/HealthIntersections/fhirserver/blob/16c15813689739c37e4b45503540c7ce61e40d3e/Dockerfile#L16-L20">lines leading up to the next COPY</a> won't run, since they're cached.</p>



<a name="260174727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260174727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260174727">(Nov 03 2021 at 18:12)</a>:</h4>
<p>This  kind of flexibility can be quite helpful, but you have you be intentional about it. I think the main goal is to prevent re-installing <code>fpclazup</code> on every build, since that's particularly slow. We can accomplish this while still re-fetching dependencies (e.g., using "Option 1" from <a href="https://www.keepsecure.ca/blog/2021/advanced-docker-tips-pt2-know-when-to-cache/">https://www.keepsecure.ca/blog/2021/advanced-docker-tips-pt2-know-when-to-cache/</a> to insert a step  between the toolchain script and the dependencies script).</p>



<a name="260174986"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260174986" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260174986">(Nov 03 2021 at 18:14)</a>:</h4>
<p>but <a href="http://linux-fhirserver.sh">linux-fhirserver.sh</a> runs each time, right? We just want <a href="http://unix-libraries.sh">unix-libraries.sh</a> to run before <a href="http://linux-fhirserver.sh">linux-fhirserver.sh</a> runs - should we just call unix-libraries from <a href="http://linux-fhirserver.sh">linux-fhirserver.sh</a>?</p>



<a name="260175117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260175117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260175117">(Nov 03 2021 at 18:15)</a>:</h4>
<p><a href="http://linux-fhirserver.sh">linux-fhirserver.sh</a> runs any time <em>any of the repo contents</em> have changed, except for a few things listed in <a href="https://github.com/HealthIntersections/fhirserver/blob/master/.dockerignore">https://github.com/HealthIntersections/fhirserver/blob/master/.dockerignore</a> -- so that's effectively always.</p>



<a name="260175168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260175168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260175168">(Nov 03 2021 at 18:15)</a>:</h4>
<p>If you want to rebuild the unix libraries every time, we can indeed move that RUN step so it happens after the big COPY and before <a href="http://linux-fhirserver.sh">linux-fhirserver.sh</a> runs</p>



<a name="260175363"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260175363" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260175363">(Nov 03 2021 at 18:16)</a>:</h4>
<p>I just added a <a href="https://github.com/HealthIntersections/fhirserver/commit/219ef3a3edf8d31c49af8f87e19f8727c6a03da9">commit</a> at  <a href="https://github.com/HealthIntersections/fhirserver/blob/gg-202110-code-scanning/Dockerfile">https://github.com/HealthIntersections/fhirserver/blob/gg-202110-code-scanning/Dockerfile</a></p>



<a name="260175896"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260175896" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260175896">(Nov 03 2021 at 18:20)</a>:</h4>
<p>ok thanks. and yes, we do want the latest copes of the libraries each time</p>



<a name="260191676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260191676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260191676">(Nov 03 2021 at 20:17)</a>:</h4>
<p>yay we got there, thanks</p>



<a name="260340147"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260340147" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260340147">(Nov 04 2021 at 21:56)</a>:</h4>
<p>I want to launch the server using a local config.json file. How can I do this? <br>
I have a bind mount to a local folder, but I don't know how I can point to a file in that folder:<br>
my local folder is <code>/mnt/c/work/fhirserver/docker/cache</code>. How would the docker command line look like?<br>
<code>docker run --name tx_server --env PORT=80 --mount type=bind,source=/mnt/c/work/fhirserver/docker/cache,target=/root/fhir-server  -p 80:80 fhirserver -cfg XXX</code></p>



<a name="260340236"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260340236" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260340236">(Nov 04 2021 at 21:57)</a>:</h4>
<p>What should I use as XXX?</p>



<a name="260340444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260340444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260340444">(Nov 04 2021 at 21:59)</a>:</h4>
<p>Why are you mounting a folder into /root/fhir-server? Is that a path that you expect to exist? I would have expected you to mount into something like /my-config. </p>
<p>But in any case for the example, as you have written it, XXX=<code>/root/fhir-server/config.json</code> assuming that /mint/c/work/fhirserver/docker/cache/config.json exists on the host.</p>



<a name="260340522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260340522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260340522">(Nov 04 2021 at 22:00)</a>:</h4>
<p>I have never supplied a local JSON file, only a URL, so I guess I'm also not sure what the server expects for this argument. I'm just answering your top level question about how to refer to a file on a  path that you have mounted into your docker container.</p>



<a name="260340646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260340646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260340646">(Nov 04 2021 at 22:00)</a>:</h4>
<p>You'll also need an argument like <code>-cmd exec</code> and probably other arguments</p>



<a name="260342762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260342762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260342762">(Nov 04 2021 at 22:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191315">Josh Mandel</span> <a href="#narrow/stream/179281-pascal/topic/Automating.20fhirserver.20build/near/260340444">said</a>:</p>
<blockquote>
<p>Why are you mounting a folder into /root/fhir-server? Is that a path that you expect to exist? I would have expected you to mount into something like /my-config. </p>
</blockquote>
<p>that is where the server keeps the cache files. If I use another folder, i'd need to tell the server about that other location (and I don't know how)</p>



<a name="260342837"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260342837" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260342837">(Nov 04 2021 at 22:22)</a>:</h4>
<p>I'm starting with something that works and there try to change a few things, so that I can always come back to a working setup</p>



<a name="260343012"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260343012" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260343012">(Nov 04 2021 at 22:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191315">Josh Mandel</span> <a href="#narrow/stream/179281-pascal/topic/Automating.20fhirserver.20build/near/260340444">said</a>:</p>
<blockquote>
<p>But in any case for the example, as you have written it, XXX=<code>/root/fhir-server/config.json</code> assuming that /mint/c/work/fhirserver/docker/cache/config.json exists on the host.</p>
</blockquote>
<p>it doesn't work. complains about <code>Unable to find the lang file ""</code></p>



<a name="260343054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260343054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260343054">(Nov 04 2021 at 22:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191315">Josh Mandel</span> <a href="#narrow/stream/179281-pascal/topic/Automating.20fhirserver.20build/near/260340646">said</a>:</p>
<blockquote>
<p>You'll also need an argument like <code>-cmd exec</code> and probably other arguments</p>
</blockquote>
<p>This is not needed. The server does start ok (if I use the URL)</p>



<a name="260346722"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260346722" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260346722">(Nov 04 2021 at 23:05)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="191315">@Josh Mandel</span> this has suddenly started happening on the build, running the tests:</p>
<blockquote>
<p>(fhirserver:9): Gtk-WARNING **: 23:04:44.912: cannot open display: :99<br>
Error: Process completed with exit code 1.</p>
</blockquote>



<a name="260347284"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260347284" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260347284">(Nov 04 2021 at 23:11)</a>:</h4>
<p><span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span> I'm not sure what that error means from the server</p>



<a name="260348855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260348855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260348855">(Nov 04 2021 at 23:31)</a>:</h4>
<p>Hmm, that's curious re: display error. Has this happened before? I'll see if I can reproduce locally.</p>



<a name="260348997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260348997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260348997">(Nov 04 2021 at 23:32)</a>:</h4>
<p>hadn't happened since you first set it up, then failed for the last two runs</p>



<a name="260349008"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260349008" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260349008">(Nov 04 2021 at 23:33)</a>:</h4>
<p>(master branch, and PR branch)</p>



<a name="260349341"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260349341" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260349341">(Nov 04 2021 at 23:37)</a>:</h4>
<p>I can't think of any reason why it should fail transiently. Guess I'm not thinking creatively enough.</p>



<a name="260356691"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260356691" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260356691">(Nov 05 2021 at 01:27)</a>:</h4>
<p>Well, I couldn't reproduce locally. On retriggering <a href="https://github.com/HealthIntersections/fhirserver/actions/runs/1423271582">https://github.com/HealthIntersections/fhirserver/actions/runs/1423271582</a> succeeded. I'm retriggering the failed branch build too.</p>



<a name="260356707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260356707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260356707">(Nov 05 2021 at 01:28)</a>:</h4>
<p>I'm puzzled about this failure mode.</p>



<a name="260356767"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260356767" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260356767">(Nov 05 2021 at 01:28)</a>:</h4>
<p>X is having trouble starting? it's a timing thing?</p>



<a name="260356784"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260356784" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260356784">(Nov 05 2021 at 01:28)</a>:</h4>
<p>It's possible there's a race condition, yeah.</p>



<a name="260356870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/260356870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#260356870">(Nov 05 2021 at 01:30)</a>:</h4>
<p>If this happens again let's follow <a href="https://unix.stackexchange.com/a/310688">https://unix.stackexchange.com/a/310688</a> or just add a sleep in the entrypoint file.</p>



<a name="261048960"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261048960" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261048960">(Nov 10 2021 at 20:19)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="191315">@Josh Mandel</span> this happens for every PR created by someone other than you or me:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code>    testSendEmail [00.000] fail @?#?: Must provide password for SMTP test in work/fhirserver/exec/64/test-settings.ini ([email] ***
</code></pre></div>

</blockquote>
<p>(see <a href="https://github.com/HealthIntersections/fhirserver/runs/4162397321?check_suite_focus=true">https://github.com/HealthIntersections/fhirserver/runs/4162397321?check_suite_focus=true</a>)</p>



<a name="261048994"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261048994" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261048994">(Nov 10 2021 at 20:20)</a>:</h4>
<p>I think it can't be co-incidence</p>



<a name="261051311"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261051311" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261051311">(Nov 10 2021 at 20:38)</a>:</h4>
<p>Is it specific to you and me, or are the PRs being made from external forks? Just want to narrow down the permissions issues here.</p>



<a name="261051344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261051344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261051344">(Nov 10 2021 at 20:38)</a>:</h4>
<p>See <a href="https://securitylab.github.com/research/github-actions-preventing-pwn-requests/">https://securitylab.github.com/research/github-actions-preventing-pwn-requests/</a> for background</p>



<a name="261051587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261051587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261051587">(Nov 10 2021 at 20:40)</a>:</h4>
<blockquote>
<p>Due to the dangers inherent to automatic processing of PRs, GitHub’s standard pull_request workflow trigger by default prevents write permissions and secrets access to the target repository.</p>
</blockquote>



<a name="261051856"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261051856" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261051856">(Nov 10 2021 at 20:43)</a>:</h4>
<p>yes could be external PRs - that makes sense. And yes, I can see why they do that.</p>



<a name="261052026"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261052026" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261052026">(Nov 10 2021 at 20:44)</a>:</h4>
<p>... but what's the solution?</p>



<a name="261060172"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060172" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060172">(Nov 10 2021 at 21:53)</a>:</h4>
<p>further reading says 'by default' is misleading - there's no non-default here; it's a hard rule</p>



<a name="261060399"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060399" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060399">(Nov 10 2021 at 21:55)</a>:</h4>
<p>We can run <em>almost all the tests</em> with no secrets at all, right? I think that should be the default, and the tests should pass.</p>



<a name="261060477"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060477" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060477">(Nov 10 2021 at 21:56)</a>:</h4>
<p>yes I'm just sucking it up and making that change.</p>



<a name="261060495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060495">(Nov 10 2021 at 21:56)</a>:</h4>
<p>(We can add back email tests more thoughtfully -- like, maybe in the main branch the password <em>will</em> be present, and when present the tests will require this email test to pass.)</p>



<a name="261060523"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060523" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060523">(Nov 10 2021 at 21:56)</a>:</h4>
<p>it does spectacularly screw up my plans for tx-cache mgmt though</p>



<a name="261060533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060533">(Nov 10 2021 at 21:56)</a>:</h4>
<p>So just make the email tests conditional</p>



<a name="261060546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060546">(Nov 10 2021 at 21:56)</a>:</h4>
<p>Hmm, what's the interaction with tx-cache management?</p>



<a name="261060718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060718">(Nov 10 2021 at 21:58)</a>:</h4>
<p>the plan was that the password to commit the updated tx-cache would use a password in the github repo. But, of course, it won't have one</p>



<a name="261060780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060780">(Nov 10 2021 at 21:58)</a>:</h4>
<p>but even more, if you create a fork in your own gh space, and then work from that, it won't pick up the tx-cache from the server because the org will be different</p>



<a name="261060806"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060806" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060806">(Nov 10 2021 at 21:58)</a>:</h4>
<p>I'm not quite following. The submission of cache updates happens in the build pipeline (core or IG), right?</p>



<a name="261060836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060836">(Nov 10 2021 at 21:59)</a>:</h4>
<p>right. the build pipeline, yes</p>



<a name="261060863"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060863" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060863">(Nov 10 2021 at 21:59)</a>:</h4>
<p>The secrets just need to be present in the build pipeline, then. Don't need to be in any GH actions.</p>



<a name="261060913"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261060913" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261060913">(Nov 10 2021 at 21:59)</a>:</h4>
<p>how do we get them into the build pipeline then? the only way I knew was from a gh repo secret</p>



<a name="261061102"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061102" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061102">(Nov 10 2021 at 22:00)</a>:</h4>
<p>By "build pipeline" I mean:</p>
<ul>
<li>Core: Azure Pipelines maintained by Mark</li>
<li>IGs: Kubernetes based "auto-ig-builder" maintained by me</li>
</ul>
<p>... each of these has its own secret management functionality.</p>



<a name="261061349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061349">(Nov 10 2021 at 22:02)</a>:</h4>
<p>Like when I run the IG publisher I inject a <code>ig.builder.keyfile.ini</code> that you gave me.</p>



<a name="261061396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061396">(Nov 10 2021 at 22:03)</a>:</h4>
<p>oh. great. can you add an entry to it for me?</p>



<a name="261061451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061451">(Nov 10 2021 at 22:03)</a>:</h4>
<p>Um, not readily ;-) Let me see.</p>



<a name="261061529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061529">(Nov 10 2021 at 22:04)</a>:</h4>
<p>it should be</p>



<a name="261061578"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061578" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061578">(Nov 10 2021 at 22:04)</a>:</h4>
<div class="codehilite" data-code-language="INI"><pre><span></span><code><span class="k">[keys]</span>
<span class="na">name</span><span class="o">=</span><span class="s">value</span>
</code></pre></div>



<a name="261061593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061593">(Nov 10 2021 at 22:04)</a>:</h4>
<p>This should be a separate file though, right? like <code>ig.builder.keyfile.ini</code> passed in to the publisher as <code>-api-key-file</code></p>



<a name="261061609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061609">(Nov 10 2021 at 22:04)</a>:</h4>
<p>And this is a different kind of input.</p>



<a name="261061611"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061611" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061611">(Nov 10 2021 at 22:04)</a>:</h4>
<p>y</p>



<a name="261061619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061619">(Nov 10 2021 at 22:04)</a>:</h4>
<p>Maybe?</p>



<a name="261061653"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261061653" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261061653">(Nov 10 2021 at 22:05)</a>:</h4>
<p>I want to put an entry in that ini file?</p>



<a name="261062338"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261062338" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261062338">(Nov 10 2021 at 22:10)</a>:</h4>
<p>I guess it's empty right now -- we set this up but never used it?</p>



<a name="261062382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261062382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261062382">(Nov 10 2021 at 22:10)</a>:</h4>
<p>that makes sense. I want to use it now. So we can add:</p>



<a name="261062397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261062397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261062397">(Nov 10 2021 at 22:10)</a>:</h4>
<p>Don't tell me secrets here ;-)</p>



<a name="261062415"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261062415" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261062415">(Nov 10 2021 at 22:10)</a>:</h4>
<p>[keys]<br>
tx.fhir.org=XX</p>



<a name="261062475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261062475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261062475">(Nov 10 2021 at 22:11)</a>:</h4>
<p>I wasn't going to put it in here <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="261299669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261299669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261299669">(Nov 12 2021 at 19:29)</a>:</h4>
<p>yay: I've redone the existing release process to use github releases</p>



<a name="261299672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261299672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261299672">(Nov 12 2021 at 19:29)</a>:</h4>
<p><a href="https://github.com/HealthIntersections/fhirserver/releases">https://github.com/HealthIntersections/fhirserver/releases</a></p>



<a name="261300375"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261300375" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261300375">(Nov 12 2021 at 19:35)</a>:</h4>
<p>cool! do you apply release tags in git? should we trigger container publication based on this?</p>



<a name="261300447"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261300447" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261300447">(Nov 12 2021 at 19:36)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> a question. I've started releasing my toolkit. It's a bunch of useful stuff in a IDE-lite - a desktop program. It builds and works for windows, linux, and OSX. If I was going to release a linux version, what would be the way to distribute it?</p>



<a name="261300475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261300475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261300475">(Nov 12 2021 at 19:36)</a>:</h4>
<p>well, the gh documentation says that it auto-creates a tag for the release</p>



<a name="261300492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261300492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261300492">(Nov 12 2021 at 19:36)</a>:</h4>
<p>e.g. <a href="https://github.com/HealthIntersections/fhirserver/releases/tag/v2.0.0">https://github.com/HealthIntersections/fhirserver/releases/tag/v2.0.0</a></p>



<a name="261300517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261300517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261300517">(Nov 12 2021 at 19:37)</a>:</h4>
<p>and it would be good to put the linux release there too</p>



<a name="261300732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261300732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261300732">(Nov 12 2021 at 19:38)</a>:</h4>
<p>toolkit options - .zip, .tgz, docker, linux package, installer... the simpler options feel more inadequate but the complex ones feel out of reach</p>



<a name="261301267"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261301267" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261301267">(Nov 12 2021 at 19:42)</a>:</h4>
<p>I don't have experience packaging linux apps; I tend to lean on docker but you might want to evaluate <a href="https://docs.appimage.org/">https://docs.appimage.org/</a> or snap</p>



<a name="261302158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261302158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261302158">(Nov 12 2021 at 19:49)</a>:</h4>
<p>appimage seems like an appropriate option. I can even run it on windows. If only I could do the OSX release process from windows...</p>



<a name="261302811"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/261302811" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#261302811">(Nov 12 2021 at 19:54)</a>:</h4>
<p>I may be able to do the windows release from linux - need to run several windows cli under wine - maybe they will...</p>



<a name="263517573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263517573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263517573">(Dec 02 2021 at 23:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> something's gone wrong with the build set up - see <a href="https://github.com/HealthIntersections/fhirserver/runs/4400650018?check_suite_focus=true">https://github.com/HealthIntersections/fhirserver/runs/4400650018?check_suite_focus=true</a></p>



<a name="263517810"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263517810" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263517810">(Dec 03 2021 at 00:01)</a>:</h4>
<p>It looks like the snomed tests are failing;</p>



<a name="263517816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263517816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263517816">(Dec 03 2021 at 00:02)</a>:</h4>
<p>I can't tell from the logs whether this is an infrastructure issue</p>



<a name="263518089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263518089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263518089">(Dec 03 2021 at 00:04)</a>:</h4>
<p>the snomed loading code hasn't changed, and I'm checking that the file is present, and it is, but it's somehow corrupt...?</p>



<a name="263518421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263518421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263518421">(Dec 03 2021 at 00:09)</a>:</h4>
<p>You mean the cached db file?</p>



<a name="263518496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263518496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263518496">(Dec 03 2021 at 00:10)</a>:</h4>
<p>In theory it should either be present and correct or absent all together when we run the step that downloads it. And we skip the download if it is present.</p>



<a name="263518543"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263518543" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263518543">(Dec 03 2021 at 00:11)</a>:</h4>
<p>We can augment the download step to print out some logging information about file size and hash</p>



<a name="263518657"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263518657" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263518657">(Dec 03 2021 at 00:12)</a>:</h4>
<p>might have to ... I don't know what else could be the problem</p>



<a name="263519408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263519408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263519408">(Dec 03 2021 at 00:21)</a>:</h4>
<p>the hex representation of the SHA-256 hash is 'AA2BF154DC360AD5AFED687638CB8DC1EAE831E2EABD4498F327726F2EF92816' for me</p>



<a name="263519477"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263519477" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263519477">(Dec 03 2021 at 00:22)</a>:</h4>
<p>Of the correct file?</p>



<a name="263519497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263519497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263519497">(Dec 03 2021 at 00:22)</a>:</h4>
<p>my local file that works. Which is the correct file, yes</p>



<a name="263519515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263519515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263519515">(Dec 03 2021 at 00:22)</a>:</h4>
<p>Okay, and that's what's in the GCP bucket?</p>



<a name="263519738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263519738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263519738">(Dec 03 2021 at 00:25)</a>:</h4>
<p>I think so. checking...</p>



<a name="263519809"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263519809" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263519809">(Dec 03 2021 at 00:26)</a>:</h4>
<p>my local file: 914,069,742 bytes</p>



<a name="263519872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263519872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263519872">(Dec 03 2021 at 00:27)</a>:</h4>
<p>Error&gt;<br>
&lt;Code&gt;AccessDenied&lt;/Code&gt;<br>
&lt;Message&gt;Access denied.&lt;/Message&gt;<br>
&lt;Details&gt;Anonymous caller does not have storage.objects.get access to the Google Cloud Storage object.&lt;/Details&gt;<br>
&lt;/Error&gt;</p>
<p>trying to download what's in the cache?</p>



<a name="263519952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263519952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263519952">(Dec 03 2021 at 00:28)</a>:</h4>
<p>and I can't see it's metadata... I'm only an admin, wth. permissions have changed?</p>



<a name="263522312"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263522312" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263522312">(Dec 03 2021 at 01:00)</a>:</h4>
<p>yes the hash is different when running on the server.</p>



<a name="263524050"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263524050" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263524050">(Dec 03 2021 at 01:20)</a>:</h4>
<p>Okay, so your local file and the one in cloud storage match,  and those are both  different from the file from the build pipeline today.</p>



<a name="263524228"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263524228" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263524228">(Dec 03 2021 at 01:22)</a>:</h4>
<p>If you just want to try clearing the cache you can merge the PR I just created</p>



<a name="263524252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263524252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263524252">(Dec 03 2021 at 01:22)</a>:</h4>
<p>( but obviously the file shouldn't be corrupted; it could of course be old...)</p>



<a name="263524636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263524636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263524636">(Dec 03 2021 at 01:27)</a>:</h4>
<p>I don't know if they match, I can't check. They are suppose to</p>



<a name="263525085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263525085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263525085">(Dec 03 2021 at 01:33)</a>:</h4>
<p>Were you unable to check the value in Google cloud storage? It should be publicly available.</p>



<a name="263525179"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263525179" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263525179">(Dec 03 2021 at 01:34)</a>:</h4>
<p>I can't access it at all, even logged in as administrator</p>



<a name="263525191"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263525191" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263525191">(Dec 03 2021 at 01:34)</a>:</h4>
<p>Well that would be a problem then.</p>



<a name="263525251"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263525251" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263525251">(Dec 03 2021 at 01:35)</a>:</h4>
<p>It seems the permissions have indeed been changed.</p>



<a name="263525784"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263525784" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263525784">(Dec 03 2021 at 01:43)</a>:</h4>
<p>I am getting the same error as you and I try to view the file even when authenticated. I tried giving myself explicit storage admin permissions in addition to owner permissions and still no dice.</p>



<a name="263525789"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263525789" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263525789">(Dec 03 2021 at 01:43)</a>:</h4>
<p>The whole thing is marked public for sure.</p>



<a name="263526415"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263526415" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263526415">(Dec 03 2021 at 01:52)</a>:</h4>
<p>It looks like the legacy roles no longer work the way they used to. I added another view all role for all users, which seems to have improved things.</p>



<a name="263526431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263526431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263526431">(Dec 03 2021 at 01:52)</a>:</h4>
<p>That said, my pull  request is failing way before the step where it tries to update the cash, so you might want to check out the compilation error.</p>



<a name="263526433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263526433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263526433">(Dec 03 2021 at 01:52)</a>:</h4>
<p>(deleted)</p>



<a name="263528164"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263528164" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263528164">(Dec 03 2021 at 02:21)</a>:</h4>
<p>Well, my build succeeded after you made those changes, so that was it</p>



<a name="263528224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179281-pascal/topic/Automating%20fhirserver%20build/near/263528224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179281-pascal/topic/Automating.20fhirserver.20build.html#263528224">(Dec 03 2021 at 02:22)</a>:</h4>
<p>Thanks</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
