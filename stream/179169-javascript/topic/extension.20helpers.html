---
layout: page
title: "FHIR Chat  · extension helpers · javascript"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/index.html">javascript</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html">extension helpers</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="269185231"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269185231" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269185231">(Jan 24 2022 at 23:01)</a>:</h4>
<p>I'm almost ready to post a small helper library to assist with handling fhir extensions in typescript/javascript - that will end up in npm.<br>
This is a sample from the unit tests showing how its used</p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code><span class="nx">test</span><span class="p">(</span><span class="s1">'boolean get/set extension value'</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sample</span><span class="o">:</span> <span class="nx">fhir4</span><span class="p">.</span><span class="nx">Coding</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">system</span><span class="o">:</span> <span class="s1">'system'</span><span class="p">,</span> <span class="nx">code</span><span class="o">:</span> <span class="s1">'c'</span><span class="p">,</span> <span class="nx">display</span><span class="o">:</span> <span class="s1">'blah'</span> <span class="p">};</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">sample</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">'{"system":"system","code":"c","display":"blah"}'</span><span class="p">);</span>
    <span class="nx">exHelpers</span><span class="p">.</span><span class="nx">setExtension</span><span class="p">(</span><span class="nx">sample</span><span class="p">,</span> <span class="p">{</span> <span class="nx">url</span><span class="o">:</span> <span class="s1">'exturl'</span><span class="p">,</span> <span class="nx">valueBoolean</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">exHelpers</span><span class="p">.</span><span class="nx">getExtensionBooleanValue</span><span class="p">(</span><span class="nx">sample</span><span class="p">,</span> <span class="s1">'exturl'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">sample</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">'{"system":"system","code":"c","display":"blah","extension":[{"url":"exturl","valueBoolean":true}]}'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

    <span class="nx">exHelpers</span><span class="p">.</span><span class="nx">setExtension</span><span class="p">(</span><span class="nx">sample</span><span class="p">,</span> <span class="p">{</span> <span class="nx">url</span><span class="o">:</span> <span class="s1">'exturl'</span><span class="p">,</span> <span class="nx">valueBoolean</span><span class="o">:</span> <span class="kc">false</span> <span class="p">});</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">exHelpers</span><span class="p">.</span><span class="nx">getExtensionBooleanValue</span><span class="p">(</span><span class="nx">sample</span><span class="p">,</span> <span class="s1">'exturl'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">sample</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">'{"system":"system","code":"c","display":"blah","extension":[{"url":"exturl","valueBoolean":false}]}'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

    <span class="nx">exHelpers</span><span class="p">.</span><span class="nx">clearExtension</span><span class="p">(</span><span class="nx">sample</span><span class="p">,</span> <span class="s1">'exturl'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">sample</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">'{"system":"system","code":"c","display":"blah"}'</span><span class="p">);</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">exHelpers</span><span class="p">.</span><span class="nx">getExtensionBooleanValue</span><span class="p">(</span><span class="nx">sample</span><span class="p">,</span> <span class="s1">'exturl'</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div>
<p>this then makes it pretty easy to make helper methods for handling standard extensions from IGs too</p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code>    <span class="k">export</span> <span class="kd">function</span> <span class="nx">getHidden</span><span class="p">(</span><span class="nx">item</span><span class="o">?:</span> <span class="nx">QuestionnaireItem</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">extensionHelpers</span><span class="p">.</span><span class="nx">getExtensionBooleanValue</span><span class="p">(</span><span class="nx">exturl_questionnaire_hidden</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">export</span> <span class="kd">function</span> <span class="nx">setHidden</span><span class="p">(</span><span class="nx">item</span><span class="o">:</span> <span class="nx">QuestionnaireItem</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="kr">boolean</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">extensionHelpers</span><span class="p">.</span><span class="nx">setExtension</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="p">{</span> <span class="nx">url</span><span class="o">:</span> <span class="nx">exturl_questionnaire_hidden</span><span class="p">,</span> <span class="nx">valueBoolean</span><span class="o">:</span> <span class="nx">value</span> <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div>
<p>Wondering if anyone else has done something similar already?</p>



<a name="269185265"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269185265" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269185265">(Jan 24 2022 at 23:01)</a>:</h4>
<p>(I'm hoping to have the code all on github in the next day or so)</p>



<a name="269188751"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269188751" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269188751">(Jan 24 2022 at 23:43)</a>:</h4>
<p>Ok, so first commit is up there now, still doing more cleanup and docco, but the core routines work fine.<br>
<a href="https://github.com/brianpos/fhir-extension-helpers">https://github.com/brianpos/fhir-extension-helpers</a></p>



<a name="269201958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269201958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269201958">(Jan 25 2022 at 02:40)</a>:</h4>
<p>Nice! For my usage patterns, I find it's also helpful to have non-mutating versions of these (e.g., an <code>addExtension</code> that returns a new object that's like the old one + an extension).</p>



<a name="269206561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269206561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269206561">(Jan 25 2022 at 03:50)</a>:</h4>
<p>I've just pushed some updates with more helper methods, and an optional parameter to create the object if it didn't exist already.<br>
Any suggestions on naming for non mutating versions?<br>
(or just have another namespace for that?)</p>



<a name="269206687"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269206687" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269206687">(Jan 25 2022 at 03:53)</a>:</h4>
<p>My goal was for manipulating large objects, rather than re-creating an entire object.<br>
Or did you think to have something more like:</p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code><span class="kd">let</span> <span class="nx">patient</span> <span class="o">=</span> <span class="p">{</span><span class="nx">resourceType</span><span class="o">:</span><span class="s1">'Patient'</span><span class="p">}</span>
<span class="nx">patient</span><span class="p">.</span><span class="nx">_birthDate</span> <span class="o">=</span> <span class="nx">setExtension</span><span class="p">(</span><span class="nx">patient</span><span class="p">.</span><span class="nx">_birthDate</span><span class="p">,</span> <span class="s1">'https://example.org'</span><span class="p">,</span> <span class="s1">'newValue'</span><span class="p">);</span>
</code></pre></div>
<p>or </p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code><span class="kd">let</span> <span class="nx">patient</span> <span class="o">=</span> <span class="p">{</span><span class="nx">resourceType</span><span class="o">:</span><span class="s1">'Patient'</span><span class="p">}</span>
<span class="nx">patient</span> <span class="o">=</span> <span class="nx">setExtension</span><span class="p">(</span><span class="nx">patient</span><span class="p">,</span> <span class="s1">'https://example.org'</span><span class="p">,</span> <span class="s1">'newValue'</span><span class="p">);</span>
</code></pre></div>
<p>Where the first is for a property extension, and the other is for a resource level extension<br>
Doing this then clones the entire object.</p>



<a name="269206699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269206699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269206699">(Jan 25 2022 at 03:53)</a>:</h4>
<p>So the mutation can be chosen by the caller?</p>



<a name="269213056"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269213056" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269213056">(Jan 25 2022 at 05:58)</a>:</h4>
<p>And now up on npm too!<br>
<a href="https://www.npmjs.com/package/fhir-extension-helpers">https://www.npmjs.com/package/fhir-extension-helpers</a></p>



<a name="269259579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269259579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269259579">(Jan 25 2022 at 13:56)</a>:</h4>
<p>Awesome! Re mutations, your latter example was the kind of pattern I tend to use when available. Separate namespaces is a good thought.</p>



<a name="269827105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269827105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269827105">(Jan 29 2022 at 01:18)</a>:</h4>
<p>I've moved onto the SDC extension package...<br>
Looking good but considering what to do for extensions that support multiple types?<br>
I've generated this so far (which is just grabbing the first type)</p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code><span class="c1">// ----------------------------------------------------------------------</span>
<span class="c1">// maxValue</span>
<span class="c1">// date(0..1) - date, dateTime, time, instant, decimal, integer</span>
<span class="c1">// The inclusive upper bound on the range of allowed values for the data element.</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">exturl_MaxValue</span> <span class="o">=</span> <span class="s2">"http://hl7.org/fhir/StructureDefinition/maxValue"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">getMaxValue</span><span class="p">(</span><span class="nx">element</span><span class="o">:</span> <span class="nx">Element</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">extensionHelpers</span><span class="p">.</span><span class="nx">getExtensionDateValue</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">exturl_MaxValue</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">setMaxValue</span><span class="p">(</span><span class="nx">element</span><span class="o">:</span> <span class="nx">Element</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">extensionHelpers</span><span class="p">.</span><span class="nx">setExtension</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="p">{</span> <span class="nx">url</span><span class="o">:</span> <span class="nx">exturl_MaxValue</span><span class="p">,</span> <span class="nx">valueDate</span><span class="o">:</span> <span class="nx">value</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>I'm thinking that the sensible thing for these cases would be to generate:</p>
<div class="codehilite"><pre><span></span><code>getMaxValueAsDate,
getMaxValueAsDateTime,
getMaxValueAsTime,
getMaxValueAsInstant,
getMaxValueAsDecimal,
getMaxValueAsInteger
</code></pre></div>
<p><span class="user-mention" data-user-id="195344">@Paul Lynch</span> thoughts?<br>
(there are only 3 of these cases in SDC - but I expect this is likely elsewhere too)</p>



<a name="269828282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/269828282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#269828282">(Jan 29 2022 at 01:37)</a>:</h4>
<p>This is the current generated code for the SDC IG if anyone wants to have a look at it and make comments before I push it into an npm package...<br>
<a href="https://gist.github.com/brianpos/94500f42591e97d67bcf771689ade0b7">https://gist.github.com/brianpos/94500f42591e97d67bcf771689ade0b7</a></p>
<blockquote>
<p>Note that I'm not happy with the preferred terminology server extraction, I'd like to have a way that grabs either of the 2 URLs... thoughts on that part?</p>
</blockquote>



<a name="270031562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/270031562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ilya Beda <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#270031562">(Jan 31 2022 at 13:36)</a>:</h4>
<p>It looks good <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> </p>
<p>I just want to mention that there is an alternative way of working with extensions.<br>
Instead of working with extensions in the runtime by getter/setter pair, you can extract all known extensions to the top level.<br>
This approach is used by google <a href="https://github.com/google/fhir/blob/master/proto/google/fhir/proto/r4/uscore.proto#L7137">https://github.com/google/fhir/blob/master/proto/google/fhir/proto/r4/uscore.proto#L7137</a> and aidbox <a href="https://docs.aidbox.app/modules-1/first-class-extensions">https://docs.aidbox.app/modules-1/first-class-extensions</a></p>
<p>The main advantage is that you will get a strongly typed representation, based on a definition from a profile.</p>



<a name="270105608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/270105608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#270105608">(Jan 31 2022 at 21:12)</a>:</h4>
<p>My approach retains the fhir structure so other tools/utilities can work with it and doesn't need to be mutated again to/from the fhir representation.</p>



<a name="270106000"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/270106000" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#270106000">(Jan 31 2022 at 21:15)</a>:</h4>
<p>I do like both those approaches, but need to be all in using those. And then do conversions where you need to.<br>
And have care that your profiled extensions don't clash with names.</p>



<a name="270106093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/270106093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#270106093">(Jan 31 2022 at 21:15)</a>:</h4>
<p>Thanks very much for the feedback too.<br>
I might link the code whem I eventually do a post about them.</p>



<a name="270733695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/270733695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#270733695">(Feb 04 2022 at 15:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191367">Brian Postlethwaite</span> <a href="#narrow/stream/179169-javascript/topic/extension.20helpers/near/269827105">said</a>:</p>
<blockquote>
<p>I'm thinking that the sensible thing for these cases would be to generate:</p>
<div class="codehilite"><pre><span></span><code>getMaxValueAsDate,
getMaxValueAsDateTime,
getMaxValueAsTime,
getMaxValueAsInstant,
getMaxValueAsDecimal,
getMaxValueAsInteger
</code></pre></div>
<p><span class="user-mention silent" data-user-id="195344">Paul Lynch</span> thoughts?<br>
(there are only 3 of these cases in SDC - but I expect this is likely elsewhere too)</p>
</blockquote>
<p>It probably will not surprise Brian that my thought about this is that some languages care too much about types.</p>



<a name="270769352"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/270769352" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#270769352">(Feb 04 2022 at 20:36)</a>:</h4>
<p>Lol, it's not just types here, it's the prop name that's being read.</p>



<a name="271074025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/extension%20helpers/near/271074025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/extension.20helpers.html#271074025">(Feb 08 2022 at 02:46)</a>:</h4>
<p>Have pushed a draft of the SDC helpers too!<br>
<a href="https://www.npmjs.com/package/fhir-sdc-helpers">https://www.npmjs.com/package/fhir-sdc-helpers</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
