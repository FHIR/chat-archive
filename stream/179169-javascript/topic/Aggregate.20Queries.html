---
layout: page
title: "FHIR Chat  · Aggregate Queries · javascript"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/index.html">javascript</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html">Aggregate Queries</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="259279395"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/259279395" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rebecca Green <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#259279395">(Oct 27 2021 at 17:54)</a>:</h4>
<p>Does the <code>cql-execution</code> library support the new Aggregate Queries functionality? <a href="https://cql.hl7.org/2020May/03-developersguide.html#aggregate-queries">https://cql.hl7.org/2020May/03-developersguide.html#aggregate-queries</a></p>



<a name="259294949"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/259294949" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#259294949">(Oct 27 2021 at 19:37)</a>:</h4>
<p>Yes.  Support for aggregate queries was added to <code>cql-execution</code> in version 2.3.0.</p>



<a name="259296632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/259296632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rebecca Green <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#259296632">(Oct 27 2021 at 19:50)</a>:</h4>
<p>Thanks! Just found the answer in the release notes before you posted your reply. I'm confused about how to set the initial aggregate value in cql. If I want the initial value to be 0, how would I express that in CQL?</p>



<a name="259331784"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/259331784" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#259331784">(Oct 28 2021 at 02:13)</a>:</h4>
<p><code>define Sum: ({ 1, 2, 3, 4, 5 }) X aggregate Result starting 0: Result + Result</code></p>



<a name="259331845"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/259331845" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#259331845">(Oct 28 2021 at 02:14)</a>:</h4>
<p>Without the <code>starting</code> clause, the <code>Result</code> accumulator is initially <code>null</code></p>



<a name="259523030"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/259523030" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rebecca Green <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#259523030">(Oct 29 2021 at 13:23)</a>:</h4>
<p>Does an aggregate have to be an Integer or can it be something else like a Tuple for example?</p>



<a name="259523066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/259523066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rebecca Green <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#259523066">(Oct 29 2021 at 13:23)</a>:</h4>
<p>If so how would you express that?</p>



<a name="259542122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/259542122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rebecca Green <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#259542122">(Oct 29 2021 at 15:38)</a>:</h4>
<p>For example I'm trying to write a function similar to this:</p>
<div class="codehilite"><pre><span></span><code>define function AggregateFunction():
  (expand Interval[1, 4]) C
  aggregate S starting ({
    A: null,
    B: null,
    C: null,
    D: null
  } as Tuple {
    A Boolean,
    B Boolean,
    C Boolean,
    D Boolean
  }):
  case
    when C &gt; 1 then S.A is true
    when C = 1 then S.B is true
    when C &lt; 1 then S.C is true
    when C = 0 then S.D is true
    else S
  end
</code></pre></div>
<p>But I'm getting an error this error: <code>Expected an expression of type 'System.Boolean', but found an expression of type 'tuple of A: System.Boolean, B: System.Boolean, C: System.Boolean, D: System.Boolean'.</code> </p>
<p>I thought that by specifying the starting value as the tuple the cql would expect the tuple as a response. Any help? Thoughts on what I'm getting wrong here?</p>



<a name="260064260"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Aggregate%20Queries/near/260064260" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Aggregate.20Queries.html#260064260">(Nov 02 2021 at 22:04)</a>:</h4>
<p>The aggregate can be any type, the accumulator expression is responsible for determining what "accumulating" means for each iteration. This example from the spec, for instance, accumulates sets of intervals:</p>
<div class="codehilite"><pre><span></span><code>define &quot;RolledOutIntervals&quot;:
  MedicationRequestIntervals M
    aggregate R starting (null as List&lt;Interval&lt;DateTime&gt;&gt;): R union ({
      M X
        let S: Max({ end of Last(R) + 1 day, start of X }),
          E: S + duration in days of X
        return Interval[S, E]
    })
</code></pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
