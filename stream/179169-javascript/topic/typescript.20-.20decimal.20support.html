---
layout: page
title: "FHIR Chat  · typescript - decimal support · javascript"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/index.html">javascript</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html">typescript - decimal support</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="243481786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243481786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243481786">(Jun 22 2021 at 07:44)</a>:</h4>
<p>Not directly a typescript issue, but anyone else got any good tips on parsing decimal data in a way that doesn't loose the precision?<br>
parseFloat removes all the trailing precision from it...<br>
I'm using it in my Javascript Questionnaire renderer</p>



<a name="243482258"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243482258" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243482258">(Jun 22 2021 at 07:50)</a>:</h4>
<p>Anyone tried this module? <a href="https://github.com/globalizejs/globalize#number-module">https://github.com/globalizejs/globalize#number-module</a></p>



<a name="243511070"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243511070" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243511070">(Jun 22 2021 at 12:55)</a>:</h4>
<p>I have not.  You might also consider <a href="https://www.npmjs.com/package/big.js">big.js</a> (16M downloads/week) or <a href="https://www.npmjs.com/package/bignumber.js">bignumber.js</a> (5M downloads/week) -- but I have not tried either of those either.</p>



<a name="243544653"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243544653" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243544653">(Jun 22 2021 at 16:47)</a>:</h4>
<p>Brian, I'm usually pretty good at remembering that issue, but I haven't looked at it in JS yet.</p>
<p>I think the problem Brian is asking about is in the JSON parser / serializer; e.g., on chromium-based browsers you get the following behavior:</p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'{"data":3.000000}'</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="nx">returns</span><span class="o">:</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span> <span class="mf">3</span><span class="p">}</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">data</span><span class="o">:</span> <span class="mf">3.0000</span><span class="p">})</span>
 <span class="o">-&gt;</span> <span class="nx">returns</span><span class="o">:</span> <span class="s2">"{\"data\":3}"</span>
</code></pre></div>
<p>Both of which have lost the additional precision on the number... sadly, that is conformant with the spec :sigh:.</p>
<p>For serialization, it <em>may</em> work to use one of those libraries an add a custom <code>replacer</code> function for <code>JSON.stringify</code> (looks good on paper, haven't tested).</p>
<p>Unfortunately, the parser is harder to work around.  Even using the <code>reviver</code> parameter on <code>JSON.parse</code> doesn't help because the value passed in is already a <code>number</code> by the time the function is called.  I would probably start with the polyfill implementation on the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">Mozilla</a> page or an existing C/C++ library I could compile via <a href="https://emscripten.org/">Emscripten</a> (or possibly C# via <a href="https://github.com/theolivenbaum/h5">h5</a>, but I have never used it so I don't know if it actually works =).  Time permitting, I'd like to see a few options and performance test them, but that feels like a lot unless the first attempt had horrible performance.</p>
<p>I'll add it to my (super short, really) list, unless someone else has solved this already (:hopeful look:)?</p>



<a name="243565490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243565490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243565490">(Jun 22 2021 at 19:15)</a>:</h4>
<p>I hadn't thought of it in the context of deserializing a whole JSON object, but yes, in that case it's a bit more complicated than just "use this library".  That said, the original post said "parseFloat removes all the trailing precision from it", so if he is talking about parseFloat, then maybe he is really working w/ the numeric values directly... But of course I am not going to stop you, <span class="user-mention" data-user-id="222054">@Gino Canessa</span>, if you want to spend some time solving for the JSON problem too!</p>



<a name="243566816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243566816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243566816">(Jun 22 2021 at 19:26)</a>:</h4>
<p>Lol <span class="user-mention" data-user-id="191469">@Chris Moesel</span>  =).  I guess it could be in either point, since each step along the way will lose precision.</p>
<p>Guess this is relevant to the larger 'standard FHIR library for JS/TS', since it will need to include a parser/serializer and some object library for precise numeric types (I like your suggestion of <code>big.js</code>).</p>



<a name="243584211"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243584211" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243584211">(Jun 22 2021 at 22:00)</a>:</h4>
<p><a href="https://gitlab.com/shimaore/jsonparse-decimal">https://gitlab.com/shimaore/jsonparse-decimal</a> is the kind of thing that we're talking about, yes? (Integrates a JSON parser + decimal handling)</p>



<a name="243584276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243584276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243584276">(Jun 22 2021 at 22:01)</a>:</h4>
<p>(That particular library doesn't seem super active or popular; just looking at the shape of the solution...)</p>



<a name="243585169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243585169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243585169">(Jun 22 2021 at 22:10)</a>:</h4>
<p>Yes - it has the parser and the dependency on the (also not very active) <a href="https://github.com/MikeMcl/decimal.js-light/">decimal-js.light</a> project.</p>



<a name="243607029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/typescript%20-%20decimal%20support/near/243607029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/typescript.20-.20decimal.20support.html#243607029">(Jun 23 2021 at 04:55)</a>:</h4>
<p>All of these issues yes, but the specific spot I was slipping on was the conversion of user entered text data into the fhir questionnaire answer as valueDecimal...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
