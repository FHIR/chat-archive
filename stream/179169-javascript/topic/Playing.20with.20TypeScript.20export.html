---
layout: page
title: "FHIR Chat  · Playing with TypeScript export · javascript"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/index.html">javascript</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html">Playing with TypeScript export</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="268073229"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268073229" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268073229">(Jan 14 2022 at 21:11)</a>:</h4>
<p>Hi all, it's been a 'to-do' for a while to look at splitting out the TypeScript definitions to be have some runtime (e.g., classes), split into individual files, etc.  I've started working on a pass of changes, using a new language definition to ensure I don't break anything for anyone else.  The current R4 output is in a temp repo: <a href="https://github.com/GinoCanessa/FhirTypeScriptOddsAndEnds">https://github.com/GinoCanessa/FhirTypeScriptOddsAndEnds</a> .</p>
<p>The code to generate it (for those playing with fhir-codegen) is in the <a href="https://github.com/microsoft/fhir-codegen/tree/dev">dev branch</a>.</p>
<p>There are still some things I'm not happy with (e.g., not sure about constructors vs. factory pattern to make parsing easier), but it's a start.  Cheers!</p>



<a name="268084607"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268084607" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268084607">(Jan 14 2022 at 22:55)</a>:</h4>
<p>If I'm constructing (say) a Condition from JSON, at what point do things like the CodeableConcept constructor for Condition.code get executed?</p>



<a name="268084858"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268084858" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268084858">(Jan 14 2022 at 22:57)</a>:</h4>
<p>Do I need to invoke that myself, or will the Condition constructor eventually handle this, or is the expectation that CodeableConcept is acting only as an interferface and nobody ever needs to create instances of that class because a genetic object implementing the interface is sufficient? (If we start attaching behavior to the classes, that would force us into instantiating them...)</p>



<a name="268463827"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268463827" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268463827">(Jan 18 2022 at 22:16)</a>:</h4>
<p>Cool! But I'm not sure I understand the use-case of these model classes.. Are we not able to enforce this validation with JSON schema at runtime (and rely on DT type definitions at develop time)?</p>
<p>In any case, I find my odds-and-ends usually ends up including a set of type predicate guards when I am dealing with polymorphic things, along these lines.:</p>
<div class="codehilite"><pre><span></span><code>export const isPatient = (resource: any): resource is fhir4.Patient =&gt; {
   return resource.resourceType === &#39;Patient&#39;
}
</code></pre></div>



<a name="268464972"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268464972" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268464972">(Jan 18 2022 at 22:25)</a>:</h4>
<blockquote>
<p>Are we not able to enforce this validation with JSON schema at runtime </p>
</blockquote>
<p>Sure -- might want to incorporate something like <a href="https://ajv.js.org/">https://ajv.js.org/</a> if the basis of runtime validation is JSON schema; embedding validation as a capability in classes work too though (and aligns with how some other FHIR language libraries work).</p>



<a name="268465850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268465850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268465850">(Jan 18 2022 at 22:34)</a>:</h4>
<p>Thanks Brian!  This is moving towards the concept of a 'fuller' JS/TS library, and is just one idea I had to move forward.  I've looked at a few things for run-time type checking (like io-ts) but I want to see how much we can get without additional dependencies.  Mostly because I've found people are opinionated about which one to use =).</p>
<p>I also found myself adding back things removed for DT type definitions during development..  Things like instances of enumerations for value-sets, which cannot live in interface files.</p>



<a name="268466132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268466132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268466132">(Jan 18 2022 at 22:37)</a>:</h4>
<p>And blah, missed your earlier questions <span class="user-mention" data-user-id="191315">@Josh Mandel</span> :  That's the kind of thing I am testing with the definitions.  I expect to make some pretty major changes to that pass - right now I'm trying to evaluate if it's better to move to a factory pattern so that you can choose a <code>fromJson</code> and <code>fromObject</code> separately in order to get different behaviors... </p>
<p>Basically, I just wanted to push and see what works and what doesn't.</p>



<a name="268466397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268466397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268466397">(Jan 18 2022 at 22:39)</a>:</h4>
<p>re: ajv.js, I <em>think</em> I remember that the FHIR definitions did not play well with JSON Schema (some sort of design-assumption incompatibility).  I'll add to my list to see if that's true or not though.</p>



<a name="268468744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268468744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268468744">(Jan 18 2022 at 23:01)</a>:</h4>
<p>May be time to investigate <a href="https://datatracker.ietf.org/doc/html/rfc8927">https://datatracker.ietf.org/doc/html/rfc8927</a> for FHIR too! (Avj supports both -- FWIW we've used Avj with JSON schema for basic FHIR validation in SMART Health Cards tooling.)</p>



<a name="268472787"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268472787" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268472787">(Jan 18 2022 at 23:43)</a>:</h4>
<p>the json community re-inventing XML... how adorable</p>



<a name="268477886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/268477886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#268477886">(Jan 19 2022 at 00:47)</a>:</h4>
<p>Show me the namespaces!</p>



<a name="269278880"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/269278880" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike Lohmeier <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#269278880">(Jan 25 2022 at 16:05)</a>:</h4>
<p>We tried using the JSON schemas provided in the r4 downloads, <a href="https://www.hl7.org/fhir/fhir.schema.json.zip">https://www.hl7.org/fhir/fhir.schema.json.zip</a>, before and hit a slew of semantic validations not raising as errors. For example, required fields are not being marked as required. We ended up falling back to the HAPI java validator because so much was missing from the downloadable JSON schemas. I don't think this is a problem with the js JSON validator libs but the actual schemas being generated for the downloads in fhir r4.</p>
<p>Just an FYI for anyone fully depending on those FHIR JSON schemas only.</p>



<a name="269809454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/269809454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#269809454">(Jan 28 2022 at 22:06)</a>:</h4>
<p>Ok, so the next pass is posted for thoughts.  Right now, I've added another tree of exports for interfaces.  So, the root index exports <code>interfaces</code>, <code>models</code>, and <code>valuesets</code>.  There's been a bit of back and forth about required elements/constructors, so what I have tentatively landed on is:</p>
<ul>
<li>Define the interface that contains the elements for a type.</li>
<li>Optional elements are decorated with <code>?</code> syntax, but all elements have <code>|undefined</code> - this allows for adding required properties later, but still have good hinting on what is actually required.</li>
<li>Classes implement the relevant interface (e.g., <code>fhirModels.Patient implements fhirInterfaces.IPatient</code>).</li>
<li>Constructors use the <code>Partial&lt;T&gt;</code> hint so that you can create a class without all the required elements.</li>
<li>Classes define a static factory function (<code>CreateStrict</code> right now) that takes the interface without a partial tag, so that you can ensure you have all required elements.  It throws if something is missing.</li>
<li>Classes define an instance function (<code>checkRequiredElements</code> right now) that checks to see if the instance has values for all required elements (incomplete, but should be enough to give the idea... I have not looked at choice types yet).</li>
</ul>
<p>I have been focused on the generation, so I have not <em>used</em> this output yet (I did make sure it compiles =).  I will get to that when I can, but thought it would be good to post before the weekend.</p>
<p>Cheers!</p>
<p>(edit: one thing I know I want to update is adding an interface around those functions so that they can be used generically).</p>
<p>(edit2: Also, there is a <code>FhirResourceFactory</code> function in <code>models.ts</code> which uses the <code>resourceType</code> value to create a resource of that type)</p>
<p>(edit3: Files are on <a href="https://github.com/GinoCanessa/FhirTypeScriptOddsAndEnds">GitHub</a> =)</p>



<a name="269814645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/269814645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#269814645">(Jan 28 2022 at 22:55)</a>:</h4>
<p>Another note: something I want to evaluate is either using a model like this, or using a separate set of 'strict' models and 'optional' models that both get exported.</p>



<a name="270099213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179169-javascript/topic/Playing%20with%20TypeScript%20export/near/270099213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179169-javascript/topic/Playing.20with.20TypeScript.20export.html#270099213">(Jan 31 2022 at 20:24)</a>:</h4>
<p>Ok, pushed another pass up to <a href="https://github.com/GinoCanessa/FhirTypeScriptOddsAndEnds">GitHub</a>.  I was not happy with how convoluted everything got on the last pass, so I split everything into a 'strict' and 'optional' version.</p>
<p>All interfaces and models are just replicated between the two, so that you can pick and choose when importing:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">OptionalModels</span> <span class="kr">as</span> <span class="nx">fhir4</span> <span class="p">}</span>  <span class="kr">from</span> <span class="s1">'./index'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Patient</span><span class="p">,</span> <span class="nx">OperationOutcome</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">'./strictmodels'</span><span class="p">;</span>
</code></pre></div>
<p>The <code>CreateStrict</code> and <code>checkRequiredElements</code> still exist on the optional, but not on the strict versions.  I would like to add some sort of opposite function to strict (e.g., check if some arbitrary object has the elements to <em>be</em> of a class), but have not added it yet.</p>
<p>Any comments/thoughts/feedback welcome.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
