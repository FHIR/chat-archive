---
layout: page
title: "FHIR Chat  · statefulness of $closure and horizontal scaling · terminology"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/index.html">terminology</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html">statefulness of $closure and horizontal scaling</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153844565"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/statefulness%20of%20%24closure%20and%20horizontal%20scaling/near/153844565" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html#153844565">(Aug 22 2016 at 03:23)</a>:</h4>
<p>We've recently been looking at running replicated instances of our terminology server behind a load balancer.<br>
In this mode, $closure is a problematic operation because it is stateful, but the key for that state (the name parameter) is burried inside the body of the POST request.  If this were pulled out into the URL itself, e.g., as [base]/$closure/{name} then it would be vastly simpler to ensure that the load balancer was directing the closire table operations to the correct replicated instance (and therefore no need to share this state across instances)</p>



<a name="153844570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/statefulness%20of%20%24closure%20and%20horizontal%20scaling/near/153844570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html#153844570">(Aug 22 2016 at 07:25)</a>:</h4>
<p>you wouldn't put all closure operations on the same server?</p>



<a name="153844577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/statefulness%20of%20%24closure%20and%20horizontal%20scaling/near/153844577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html#153844577">(Aug 22 2016 at 08:24)</a>:</h4>
<p>Less likely to be a problem if Web Servers and DB Servers are on separate physical tiers - the 'classic' architecture for handling client session state in load-balanced distributed apps.</p>



<a name="153845116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/statefulness%20of%20%24closure%20and%20horizontal%20scaling/near/153845116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html#153845116">(Aug 25 2016 at 12:53)</a>:</h4>
<p>closure for us is not persistent state, only in-memory<br>
directing all $closure operations to a single instance (in the load balancer) would almost work, but fails for $closure inside a batch operation</p>



<a name="153845117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/statefulness%20of%20%24closure%20and%20horizontal%20scaling/near/153845117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html#153845117">(Aug 25 2016 at 12:54)</a>:</h4>
<p>actually, batch is pretty bad for any kind of front-end that wants to inspect request traffic and do stuff</p>



<a name="153845153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/statefulness%20of%20%24closure%20and%20horizontal%20scaling/near/153845153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html#153845153">(Aug 25 2016 at 21:14)</a>:</h4>
<p>yes. I don't see how you can make $closure not persistent</p>



<a name="153845169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/statefulness%20of%20%24closure%20and%20horizontal%20scaling/near/153845169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html#153845169">(Aug 25 2016 at 23:17)</a>:</h4>
<p>It would be interesting to read <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> on the topic of implementing batch operations in a load-balanced environment as his FHIR servers are hosted on Microsoft Azure.</p>



<a name="153846629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/statefulness%20of%20%24closure%20and%20horizontal%20scaling/near/153846629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/statefulness.20of.20.24closure.20and.20horizontal.20scaling.html#153846629">(Sep 07 2016 at 01:20)</a>:</h4>
<p>The issue with batch is not so much a load-balance problem as one of request filtering through an API Gateway</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
