---
layout: page
title: "FHIR Chat  · Custom CodeSystem/ValueSet using regex · terminology"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/index.html">terminology</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html">Custom CodeSystem/ValueSet using regex</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="238536667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238536667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238536667">(May 12 2021 at 20:11)</a>:</h4>
<p>I have a question about defining a custom CodeSystem where I want the corresponding ValueSet to allow code values based on a regex expression. For example, I would like to allow for code values that match the following regex - "code\\([1-9][0-9]*\\)".</p>
<p>Would the following CodeSystem and ValueSet correctly define and allow for these types of codes?</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>CodeSystem using regex</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>&lt;CodeSystem xmlns="<a href="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
  &lt;id value="codesystem-code-with-index"/&gt;<br>
  &lt;url value="http://example.com/CodeSystem/codesystem-code-with-index"/&gt;<br>
  &lt;version value="1.0"/&gt;<br>
  &lt;status value="active"/&gt;<br>
  &lt;date value="2021-05-12"/&gt;<br>
  &lt;description value="Define a set of codes based on regex."/&gt;<br>
  &lt;caseSensitive value="true"/&gt;<br>
  &lt;content value="complete"/&gt;<br>
  &lt;filter&gt; <br>
    &lt;code value="code-with-index"/&gt;<br>
    &lt;description value="This filter is a regex to express the value 'code' followed by a parenthentically enclosed positive integer representing an index value."/&gt;<br>
    &lt;operator value="regex"/&gt;<br>
    &lt;value value="code\([1-9][0-9]*\)"/&gt;<br>
  &lt;/filter&gt;<br>
&lt;/CodeSystem&gt;</p>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>ValueSet using regex</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>&lt;ValueSet xmlns="<a href="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
  &lt;id value="valueset-code-with-index"/&gt;<br>
  &lt;url value="http://example.com/ValueSet/valueset-code-with-index"/&gt;<br>
  &lt;version value="1.0"/&gt;<br>
  &lt;status value="active"/&gt;<br>
  &lt;date value="2021-05-12"/&gt;<br>
  &lt;description value="A set of codes based on regex."/&gt;<br>
  &lt;compose&gt;<br>
    &lt;include&gt;<br>
      &lt;system value="http://example.com/CodeSystem/codesystem-code-with-index"/&gt;<br>
      &lt;filter&gt; <br>
        &lt;property value="code-with-index"/&gt; <br>
        &lt;op value="regex"/&gt; <br>
        &lt;value value="code\([1-9][0-9]*\)"/&gt; <br>
      &lt;/filter&gt; <br>
    &lt;/include&gt;<br>
  &lt;/compose&gt;<br>
&lt;/ValueSet&gt;</p>
</div></div>



<a name="238545790"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238545790" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238545790">(May 12 2021 at 21:13)</a>:</h4>
<p>I'm not sure I understand.  You're trying to create a custom ValueSet from a custom CodeSystem using a regex to define which codes go into the ValueSet?</p>



<a name="238546420"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238546420" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238546420">(May 12 2021 at 21:19)</a>:</h4>
<p>Correct. My goal is to support coded values based on the regex. In this example, the following coded values would be valid: "code(1)", "code(14)".  The following coded values would be invalid: "code()", "code(a)".</p>
<p>Just wondering if this is possible (seems so from what I can see in the FHIR CodeSystem and ValueSet definitions) and, if possible, is this the correct way of defining it.</p>



<a name="238546784"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238546784" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238546784">(May 12 2021 at 21:22)</a>:</h4>
<p>seems more like a string than a code</p>



<a name="238546873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238546873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238546873">(May 12 2021 at 21:23)</a>:</h4>
<p>seems to me codes need to have a distinct meaning. so what is the distinct meaning of each of these indexes.</p>



<a name="238547265"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238547265" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238547265">(May 12 2021 at 21:27)</a>:</h4>
<p>My goal is to add the CodeSystem to an existing ValueSet so it can be used as a coded value.</p>
<p>The concept would be that the index would be a positive integer value representing a number of iterations for the 'code'.</p>



<a name="238547576"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238547576" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238547576">(May 12 2021 at 21:30)</a>:</h4>
<p>I am trying to avoid defining an extension for this index value as I believe this regex code would be more elegant and less verbose than an extension.</p>



<a name="238548795"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238548795" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238548795">(May 12 2021 at 21:39)</a>:</h4>
<p>regex is a valid filter operator in a ValueSet, so assuming the receiving system implemented that, you should be good.</p>



<a name="238549170"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238549170" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238549170">(May 12 2021 at 21:43)</a>:</h4>
<p><span class="user-mention" data-user-id="192587">@David Pyke</span>, thanks for the confirmation. Yes, my receiving system will understand the regex coded value - as soon as I implement it. ;-)</p>



<a name="238549307"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238549307" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238549307">(May 12 2021 at 21:44)</a>:</h4>
<p>Your CodeSystem contains no codes</p>



<a name="238549452"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238549452" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238549452">(May 12 2021 at 21:45)</a>:</h4>
<p>If you want the regex to match against codes themselves, then the filter should be defined on the <code>concept</code> property</p>



<a name="238549623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238549623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238549623">(May 12 2021 at 21:47)</a>:</h4>
<p>...or the <code>code</code> property - need to check the spec but I'm on the run just now</p>



<a name="238550066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238550066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238550066">(May 12 2021 at 21:50)</a>:</h4>
<p>CodeSystem.filter is defined at the same level as CodeSystem.concept.</p>
<p>CodeSystem.concept does not define a nested 'filter' and CodeSystem.concept is an optional element.</p>
<p>I guess I'm trying to understand how the CodeSystem.filter with operator = 'regex' works in relation to the ValueSet that includes that CodeSystem.</p>



<a name="238550267"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238550267" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238550267">(May 12 2021 at 21:52)</a>:</h4>
<p>CodeSystem.filter selects codes from a parent CodeSystem (via whatever operatior) and would present them as a list to the ValueSet.  The ValueSet would have no idea how they were selected</p>



<a name="238550388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238550388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238550388">(May 12 2021 at 21:54)</a>:</h4>
<p>If you're subsetting a custom codesystem, you would list the individual codes there and then use the regex in the ValueSet to select what codes you wanted.</p>



<a name="238550475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238550475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238550475">(May 12 2021 at 21:55)</a>:</h4>
<p>The CodeSystem and ValueSet operators work independently of each other</p>



<a name="238550641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238550641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238550641">(May 12 2021 at 21:56)</a>:</h4>
<p>Ok. Got it. So it sounds like what I would like (dynamically defined coded values via a regex without an explicit list of codes) isn't the intent of the filter or something that is supported.</p>
<p>I'm now guessing that an extension is the more appropriate approach to represent what I want.</p>



<a name="238550699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238550699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238550699">(May 12 2021 at 21:57)</a>:</h4>
<p>No, you can't create codes via regex.  An extension is what you want</p>



<a name="238550820"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238550820" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238550820">(May 12 2021 at 21:58)</a>:</h4>
<p>Thanks!  I have my path forward now.  <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="238554042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238554042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238554042">(May 12 2021 at 22:31)</a>:</h4>
<p>We've talked about having a regex defined for code systems so that a code system that doesn't explicitly list code values could still expose a basic set of rules that describe what valid codes look like - e.g. a LOINC code being nnnn-n</p>



<a name="238554057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238554057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238554057">(May 12 2021 at 22:31)</a>:</h4>
<p>However, you don't seem to have a 'concept' with defined meaning here?</p>



<a name="238555715"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238555715" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238555715">(May 12 2021 at 22:49)</a>:</h4>
<p>CodeSystem.filter does NOT select codes from a parent CodeSystem.  It defines the existence of a filter that can be used in ValueSets to select a subset of codes from the CodeSystem.  There is no notion of a "parent" CodeSystem in FHIR.</p>



<a name="238674415"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238674415" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a>  Bob Milius <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238674415">(May 13 2021 at 20:15)</a>:</h4>
<p>I thought grammars can be used as code systems.  e.g., The Sequence Variant Nomenclature aka HGVS is described in <a href="http://varnomen.hgvs.org">http://varnomen.hgvs.org</a> and is listed as a code system in <a href="https://www.hl7.org/fhir/terminologies-systems.html">https://www.hl7.org/fhir/terminologies-systems.html</a></p>



<a name="238677354"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Custom%20CodeSystem/ValueSet%20using%20regex/near/238677354" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Custom.20CodeSystem.2FValueSet.20using.20regex.html#238677354">(May 13 2021 at 20:37)</a>:</h4>
<p>yes they can</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
