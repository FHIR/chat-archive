---
layout: page
title: "FHIR Chat  · $closure and CodeSystem versions · terminology"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/index.html">terminology</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html">$closure and CodeSystem versions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="168103062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168103062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168103062">(Jun 14 2019 at 03:05)</a>:</h4>
<p>I am trying to understand how <code>$closure</code> should behave with respect to multiple CodeSystem versions?</p>
<p>Starting from the primary use-case for <code>$closure</code>, i.e., <code>code:below</code> &amp; <code>code:above</code> searches, consider the scenario where <code>Condition</code> resources have been added to our server with <code>Condition.code</code> populated with all of <code>Coding.code</code>, <code>Coding.system</code>, <em>and</em> <code>Coding.version</code>.</p>
<p>Furthermore, consider that, over time, different versions are specified for the same <code>CodeSystem</code>.</p>
<p>Now, when the <code>Coding?code:below=http://mySystem.com|123</code> search arrives we duly collect the unique <code>Codings</code> from <code>Condition.code</code> and send them, along with <code>http://mySystem.com|123</code>, off to our <code>$closure</code> operation.</p>
<p>1. What should it do with the mix of versions?<br>
2. Does it make a difference if the <code>CodeSystem</code> does/does not support concept permanence (i.e., <code>CodeSystem.versionNeeded = true</code>)?</p>



<a name="168172353"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168172353" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168172353">(Jun 14 2019 at 21:16)</a>:</h4>
<p>hey there's a reason why we didn't specify this ;-)</p>



<a name="168172365"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168172365" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168172365">(Jun 14 2019 at 21:16)</a>:</h4>
<p>but yes, it surely would make a difference</p>



<a name="168685183"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168685183" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert McClure <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168685183">(Jun 21 2019 at 14:17)</a>:</h4>
<p><span class="user-mention" data-user-id="191343">@Michael Lawley</span> I know I'm not understanding this but it seem you asking if a version specific search should return concepts that are not in the specified version? Can you help me understand the issue?</p>



<a name="168728771"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168728771" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168728771">(Jun 22 2019 at 00:50)</a>:</h4>
<p>Not quite.  The search above: <code>Condition?code:below=http://mySystem.com|123</code> (there was a typo above) asks for all <code>Condition</code> resources where the <code>code</code> field is <code>123</code> or any of its descendants in the CodeSystem <code>http://mySystem.com</code>. There are no versions specified in the <em>query</em>.  However, there may be different versions specified in the <code>Condition.code</code> entries in the data.</p>



<a name="168728884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168728884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168728884">(Jun 22 2019 at 00:52)</a>:</h4>
<p>The challenge is that in one of these specified versions, <code>A</code>, the code <code>456</code> is not a descendant of <code>123</code> but in another (later) version <code>456</code> is a descendant of <code>123</code>.  So, should it match or not?  There are wide ranging implications for either choice, both semantic and technical.</p>



<a name="168729279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168729279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168729279">(Jun 22 2019 at 01:05)</a>:</h4>
<p>Yes, we really need to think through what we want the behavior to be for this.  However, in many cases it may not be as hard as it sounds.  For SNOMED CT, for example, I suspect that a likely approach will be to base the closure table on the latest version available on the server or the specific version being requested by the client (which should be consistent), regardless of what the version was when any particular instance of data was recorded.  What you have to decide, though, is if (and how) any historical relationships will be included in the subsumption.  If you don't account somehow for historical relationships then any instance data that was recorded with a code that is now inactive in the version being used in the closure table will be ignored.  In some cases that may be acceptable, but I suspect that it many cases it will not be.</p>



<a name="168817087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168817087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168817087">(Jun 24 2019 at 02:07)</a>:</h4>
<p>Agreed <span class="user-mention" data-user-id="191405">@Rob Hausam</span> .  However I am fairly disinclined to automagically use the historical relationships because this has the server deciding on things that are really only in the control of the client to know whether it is appropriate.</p>



<a name="168817154"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168817154" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168817154">(Jun 24 2019 at 02:09)</a>:</h4>
<p>For an example like this, the client could find all now-inactive codes in its data, apply the historical map, and then pass the mapped concepts to the $closure operation.  It would also need to update its client-side join operations to factor in the historical map relationships, if any.</p>



<a name="168817282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168817282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168817282">(Jun 24 2019 at 02:13)</a>:</h4>
<p>Yeah, that might be a reasonable approach to take on it.</p>



<a name="168817553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168817553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168817553">(Jun 24 2019 at 02:21)</a>:</h4>
<p>I'll include this in the whitepaper I'm putting together</p>



<a name="168817605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/%24closure%20and%20CodeSystem%20versions/near/168817605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/.24closure.20and.20CodeSystem.20versions.html#168817605">(Jun 24 2019 at 02:22)</a>:</h4>
<p>great</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
