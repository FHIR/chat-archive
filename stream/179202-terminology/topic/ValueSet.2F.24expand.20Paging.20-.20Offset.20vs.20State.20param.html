---
layout: page
title: "FHIR Chat  · ValueSet/$expand Paging - Offset vs State param · terminology"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/index.html">terminology</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html">ValueSet/$expand Paging - Offset vs State param</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="159184253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159184253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159184253">(Feb 22 2019 at 19:31)</a>:</h4>
<p>Terminology folks, this thread in the <a href="#narrow/stream/179166-implementers/topic/ValueSet.20for.20element.20and.20direction" title="#narrow/stream/179166-implementers/topic/ValueSet.20for.20element.20and.20direction">implementers stream</a> led to us debating the usefulness of the offset param when paging results of a ValueSet.$expand operation. </p>
<p>Because the codes in a ValueSet aren't necessarily ordered, I think it makes more sense to use a kind of <em>pagingID</em> parameter that will let the user save the state from the last $expand instead of the client just passing in the Offset parameter. Grahame suggested I bring the discussion to this stream.</p>



<a name="159317665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159317665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159317665">(Feb 25 2019 at 07:06)</a>:</h4>
<p>I dispute the claim that they aren't ordered.  Happy to accept that the order may not have any special significance, though, but the paging semantics does require the terminology server to maintain some kind of order.<br>
Where I see difficulties is with infinite value sets where there's no obvious or simple natural ordering.<br>
The (very) nice thing about using an offset is that the request is entirely self-contained; no state needs to be preserved server-side to support paging and it's also not tied to a db cursor so is much more cacheable</p>



<a name="159343099"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159343099" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159343099">(Feb 25 2019 at 15:01)</a>:</h4>
<p>Ok, sure, i concede they are technically returned in some type of order, since they are represented by a list or array or something.  (even though  in math/computing: a "set" is a collection of distinct objects that aren't ordered. but this is not important, just kind of awkward...)</p>
<p>But the point I was making is that the order does not matter, and a client is never going to say "just give me the <em>N</em>th code through the <em>K</em>th code" or something without first having gotten codes 1 through <em>N</em>. The param is only used for paging. But instead of letting the client just say "give me the next page", we are making them keep track of the offset/count/total. And the server may not even respect the count they pass in. So we are making it harder for clients to get the list of codes. </p>
<p>In terms of making it better for servers:  The offset param assumes the server just stores the valueset in a big table; that is not always the case. </p>
<p>If the server does not have the codes readily indexable, then they'd have to either:<br>
 - iterate from the beginning each time until they get to the offset, then return the next codes, or<br>
 - cache the whole expansion of codes<br>
Neither of these solutions seem ideal.</p>



<a name="159381109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159381109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159381109">(Feb 25 2019 at 23:09)</a>:</h4>
<p>I just wonder how important this is. <span class="user-mention" data-user-id="191343">@Michael Lawley</span> do you have any statistics on how often the client pages past the first page?</p>



<a name="159381713"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159381713" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159381713">(Feb 25 2019 at 23:18)</a>:</h4>
<p>I could maybe dig out some stats like that, but they'd be heavily client &amp; context dependent.<br>
Most of the use of $expand with a filter parameter only wants the first N (and the UIs we see don't offer ability to go past that).<br>
For us the default max of a "full" $expand call is 50,000 so it's rare that that many codes are ever generated in an expansion.</p>



<a name="159382536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159382536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159382536">(Feb 25 2019 at 23:30)</a>:</h4>
<p>Regarding server-side implementation details, we do not "store the valueset in a big table".  We compile the $expand request into a query and run it, then give you K codes starting from posn N.  Caching happens transparently in the db layer.<br>
Expansion has two parts: matching the set of relevant codes, and ordering the matched codes.  The first part can be very fast, so re-running is not a major problem. The second part is only really useful if the filter parameter is supplied and is only costly when the set of matches is large.  Fortunately people rarely want lots of codes returned when they provide the filter parameter, and even less frequently want a second page of results.</p>



<a name="159382802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159382802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159382802">(Feb 25 2019 at 23:34)</a>:</h4>
<p>There's another significant problem created with using a token rather than start and offset for paging.  As stated earlier, it creates a stateful interaction between the client and server which means that if you've done any horizontal scaling of your back-end, then you need to ensure that the requests for subsequent pages are routed back to the node that served the original request.  This means you need smart routing and smart http caching between the client and server.<br>
It also introduces timeout issues; the paging token will only have a limited lifetime, so all the intermediate layers need to be in alignment to ensure stale results are not served up.<br>
This has been a sore point for the NCTS in the past.</p>



<a name="159384693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159384693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159384693">(Feb 26 2019 at 00:03)</a>:</h4>
<p>That's also, roughly, how I implement this, in C# middle tier code ... <code>valSet.Expansion.Contains = es.Contains.GetRange(offsetNo, countNo); </code> where valSet is a ValueSet object and es is a ValueSet.ExpansionComponent object.  The later is populated by each $expand request which, in turn, results in a DAL call, (T-SQL table-valued function) where query results are automatically cached by the DB Server.</p>



<a name="159385030"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159385030" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159385030">(Feb 26 2019 at 00:10)</a>:</h4>
<p>All things considered, it is this last issue, the entanglement of (stateful) paging with HTTP caching and load balancing / scaling that is the real problem.</p>



<a name="159390057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159390057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159390057">(Feb 26 2019 at 01:42)</a>:</h4>
<p>I have a single server and store stuff in memory. I drop it when memory becomes scarce. I don't mind either way. But it doesn't seem like too big a deal to do routing on an internally constructed token. It might skew your load balancing, but given that I think that following up for extra pages is a uncommon thing to do, it's not that big a deal?</p>



<a name="159390286"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159390286" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159390286">(Feb 26 2019 at 01:46)</a>:</h4>
<p>What we currently do is route stateful calls ($closure and resource search, which also has stateful paging) to one specific server in the cluster. The alternatives, of making a given client's searches stick to a given node in the cluster, seems to require client-side participation involving sticky session headers. Its a nuisance for $closure and resource search, but those aren't typically as high-volume or speed-sensitive for the terminology uses we see. $expand, by contrast, is both of those things, hence our reluctance.</p>



<a name="159390383"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159390383" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159390383">(Feb 26 2019 at 01:48)</a>:</h4>
<p>sure $expand is your high-volume call. but is the follow up high volume?</p>



<a name="159390396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159390396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159390396">(Feb 26 2019 at 01:48)</a>:</h4>
<p>As soon as its a possibility, you have to route it back to the same server it came from</p>



<a name="159390416"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159390416" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159390416">(Feb 26 2019 at 01:49)</a>:</h4>
<p>sure. but is that happening high volume?</p>



<a name="159390419"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159390419" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159390419">(Feb 26 2019 at 01:49)</a>:</h4>
<p>Doesn't matter</p>



<a name="159390554"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159390554" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159390554">(Feb 26 2019 at 01:51)</a>:</h4>
<p>We also currently prohibit $closure (which is fine because its not only stateful but non-idempotent) and search (which is stateful but idempotent) inside batch requests, because otherwise we'd have to open up POST bodies to determine whether they are stateful or not. We really want to avoid having to do that for $expand requests</p>



<a name="159401290"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159401290" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159401290">(Feb 26 2019 at 06:05)</a>:</h4>
<p>define high volume - we might go days or weeks with it not happening, but then someone comes along with a particular use-case or approach to solving their problem and they'll do it all day for a week.  [Note, this is based on looking only at our public server's logs.  There are many other Ontoserver instances out there with potentially wildly different uysage patterns.]</p>



<a name="159401514"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159401514" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159401514">(Feb 26 2019 at 06:11)</a>:</h4>
<p>My position is that, even if getting the next page is a low-volume scenario, changing / adding token-based page routing is has a major impact on implementers running high-volume services.  Routing on an internally constructed token is nasty; it is application semantics bleeding into layers where things should be transparent and has all sorts of knock-on consequences.<br>
e.g., you can get the routing right, but if the response is cached at the HTTP layer, then the cached token for "next" may no longer be valid.  Only solution for a client that gets a 404 on the "next" link is to make a cache-busting request on the original $expand (which may be several pages back) or for the server to know how to tell the cache to pro-actively expire  pages.</p>



<a name="159464274"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159464274" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert McClure <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159464274">(Feb 26 2019 at 22:22)</a>:</h4>
<p>So given all this, are you all saying that not one implementation would support a paged $expand. Ipso facto, any expand bigger than a terminology server's max <em>can never be expanded</em>. Correct?</p>



<a name="159465610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159465610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159465610">(Feb 26 2019 at 22:42)</a>:</h4>
<p>Paged expansions are supported by those servers that implement the offset and count parameters - including mine. However, my Server will not still not expand any Value Set larger than 9,999 as it's not designed as a means of downloading large Code Systems in their entirety.</p>



<a name="159470410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159470410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159470410">(Feb 27 2019 at 00:11)</a>:</h4>
<p>Ontoserver also supports paging $expand using count and offset</p>



<a name="159470495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159470495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159470495">(Feb 27 2019 at 00:13)</a>:</h4>
<p>All servers I know of support paging with the existing mechanism.<br>
<em>Changing</em> the mechanism to be like that for paging Bundles is what I'm pushing back against</p>



<a name="159488227"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159488227" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159488227">(Feb 27 2019 at 07:17)</a>:</h4>
<p>I’m not entirely sure that I’ve folowed you. You can turn your page / offset parameters into a state parameter, and anything else you need, and then it works no differently for you. You don’t have to support anyone else’s state. So I’m not sure why you’re pushing back so hard?</p>



<a name="159552982"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159552982" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159552982">(Feb 27 2019 at 21:14)</a>:</h4>
<p>I don't know why you say "works no differently"?<br>
A state parameter couples the client with a specific node in my stack as well as polluting the http cache. This is because only the original node that did the <code>$expand</code> knows the mapping from the state parameter to the associated <code>$expand</code> parameters.<br>
This means:<br>
1) the routing layer needs to to change to be aware of this parameter<br>
2) the HTTP caching layer needs to to change to be aware of this parameter<br>
3) scaling down the number of nodes needs to worry about stale state; if you shut down the original node you lose the mapping<br>
To me, this is all "works differently".<br>
As <span class="user-mention" data-user-id="191376">@Jim Steel</span> said, we also face similar issues with paging of <code>_search</code> and <code>$closure</code>.  We have a work-around that "works" but is not good; it adversely affects scaling behaviour. Fortunately these cases are not (currently) core issues.  However, <code>$expand</code> is and stateful paging behaviour for <code>$expand</code> would require a major re-work and complexity increase in our deployment models.</p>



<a name="159652732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159652732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159652732">(Feb 28 2019 at 21:13)</a>:</h4>
<p>but you can just put all those things in your state parameter, and ignore it's statefulness</p>



<a name="159655029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159655029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159655029">(Feb 28 2019 at 21:43)</a>:</h4>
<p>What do I do with the ValueSet from the POST?</p>



<a name="159668286"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159668286" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159668286">(Mar 01 2019 at 00:57)</a>:</h4>
<p>oh I hadn't considered the POST usecase</p>



<a name="159799241"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159799241" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159799241">(Mar 02 2019 at 14:18)</a>:</h4>
<p>For the POST you could still have a pagination token parameter (opaque to the client) while keeping all other parameters constant across calls, as is done with <code>offset|</code>.</p>



<a name="159811912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159811912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159811912">(Mar 02 2019 at 19:48)</a>:</h4>
<p>isn't that what we have now?</p>



<a name="159915911"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159915911" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159915911">(Mar 04 2019 at 14:06)</a>:</h4>
<p>No, right now we have an integer with offset semantics ("Offset is number of records (not number of pages)")</p>



<a name="159915934"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159915934" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159915934">(Mar 04 2019 at 14:07)</a>:</h4>
<p>Here I was talking about an opaque value with "next page token" semantics</p>



<a name="159941237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/159941237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#159941237">(Mar 04 2019 at 19:16)</a>:</h4>
<p>right but it would be functionally  equivalent. I don't know that buys anyone</p>



<a name="160053324"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160053324" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160053324">(Mar 05 2019 at 23:58)</a>:</h4>
<p>Leaving aside POST, the main differences are (single) server-calculated tokens vs (multiple) client-calculated "tokens" (_usually_, but not always, only varying the offset value).<br>
When the client is in control, it can also vary the page size allowing "get me the first few, get me the rest" type behaviour. This can be useful for building responsive UIs.  When server is in control, then client has no say on varying page size.<br>
Also, if client asks for count=0, what should the page size be in a server-controlled token?</p>



<a name="160056794"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160056794" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160056794">(Mar 06 2019 at 01:04)</a>:</h4>
<p>From my perspective if we can get agreement on a set of client controlled parameters and servers don't have any concerns with being able to support these across arbitrary data, then that is a big win.</p>



<a name="160056798"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160056798" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160056798">(Mar 06 2019 at 01:04)</a>:</h4>
<p>we made a different call when it comes to search result behavior, and I wonder if there is a structural difference here that explains the difference in assessment.</p>



<a name="160058600"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160058600" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160058600">(Mar 06 2019 at 01:41)</a>:</h4>
<p>I think the differences are around work load and value</p>



<a name="160303635"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160303635" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert McClure <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160303635">(Mar 08 2019 at 16:31)</a>:</h4>
<p>I'm not following the technical end of this but I am concerned that we are defining a process that will create a situation where some value set expansions <em>can</em> <strong>never</strong> <em>be expanded</em>. I understand the futility of expanding a giant value set. But choosing some arbitrary size - for Apleon DTS it's <strong>1000!</strong> - over which it is impossible to get the additional members, is fatal. We need a standard way that in the rare case, something really big, can be created.</p>



<a name="160314994"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160314994" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160314994">(Mar 08 2019 at 18:56)</a>:</h4>
<p>Totally agree there, Rob. I think what we're discussing here is a couple of subtly different ways to accomplish just that.</p>



<a name="160348198"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160348198" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160348198">(Mar 09 2019 at 03:44)</a>:</h4>
<p>Well, what we're discussing is one of either <em>changing</em> an existing mechanism that has worked perfectly well until now, or adding an additional mechanism to do something that is already possible.<br>
I am still struggling to understand what the real value of doing this is.</p>



<a name="160386178"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160386178" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160386178">(Mar 09 2019 at 22:16)</a>:</h4>
<p>As long as today's mechanism is easily supportable by servers without performance concerns, I don't suppose any value in making a change.</p>



<a name="160601146"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160601146" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160601146">(Mar 12 2019 at 19:20)</a>:</h4>
<p>It works "perfectly well" right now because not many people have implemented it. Have any major EHRs implemented it yet? At the fall connectathon, nobody I was working with had started it yet.</p>



<a name="160602646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160602646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160602646">(Mar 12 2019 at 19:37)</a>:</h4>
<p>Our server does not always store the valueset in an indexable structure; we can always iterate over the values though, potentially performing business logic on the values before returning as part of the valueset expansion. There isn't a simple way to say "start at the 1000th code" without either: <br>
 - starting at 1 and iterating over the first 999, then starting at 1000. or<br>
 - on the first request, iterate over the whole entire code set and cache it somewhere in a format that can be indexed, then page from there. <br>
Both of these approaches are less than ideal. </p>
<p>However, if we just use the paging format that everybody can already support because it is the way that paging works for any other resource that isn't this one, then it makes it very simple. It removes the unique server requirement (the paging solution doesn't dictate the data model). And it makes it easier for the client (they don't have to do math. They just say "next" which is the only reason they would want to page anyway).</p>



<a name="160727723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160727723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160727723">(Mar 13 2019 at 21:13)</a>:</h4>
<p>If, as you say, the only reason for paging is to start at the beginning and go next, next, next, then how is that different (performance-wise) from your second strategy above?  (which, as I understand it, is how you'd be doing <code>_search</code> style paging)</p>



<a name="160732274"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160732274" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160732274">(Mar 13 2019 at 22:15)</a>:</h4>
<p>Storing a cache of all of the codes (and other metadata) from the valueset would typically take up a lot more space (It scales with the size of the valueSet: O(n)) than just caching the info about where we are in the search(just a constant amount of data: O(1)). </p>
<p>In terms of time, it would take the same overall amount of time, but having to load the whole set at once to cache it would cause a delay on the first call. This could be kinda weird, but is probably neither here nor there i guess, if they are going to call through all the pages anyways.</p>



<a name="160740120"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160740120" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160740120">(Mar 14 2019 at 00:26)</a>:</h4>
<p>Where you are in the search is an index into something else, is it not?</p>



<a name="160782038"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160782038" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160782038">(Mar 14 2019 at 13:57)</a>:</h4>
<blockquote>
<p>Where you are in the search is an index into something else, is it not?</p>
</blockquote>
<p>Is this like a lead-up question, or the actual question? </p>
<p>Yes, where you are in the search is an index, naturally. <em>Whether that index has to be an integer or not</em> is what we have been going back and forth about, right?</p>



<a name="160827863"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160827863" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160827863">(Mar 14 2019 at 22:14)</a>:</h4>
<p>no, what we are going back and forth on is whether the value has to come from the server or whether the client drives it. (e.g. can the client skip pages, control page size)</p>



<a name="160828376"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160828376" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160828376">(Mar 14 2019 at 22:22)</a>:</h4>
<p>and also whether the server has to remember state. As it is now, the server does not have to remember state. But also, it cannot remember state - it has to rebuild it each time.</p>



<a name="160828386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160828386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160828386">(Mar 14 2019 at 22:22)</a>:</h4>
<p>except that this is not true. I build the state and remember it by a hash value generated on the request.</p>



<a name="160847702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160847702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160847702">(Mar 15 2019 at 05:09)</a>:</h4>
<p>exactly - currently the server does not <em>have</em> to remember state, but it can IF that's an optimisation.</p>



<a name="160876396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160876396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160876396">(Mar 15 2019 at 13:55)</a>:</h4>
<p>I don't really have anything else to add to this thread. If you do not concede that the current parameter does not work for all servers as is, then are we actually discussing anything? I've already stressed the performance concerns. Think outside of your own server and it would be a more useful discussion.</p>



<a name="160887557"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160887557" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160887557">(Mar 15 2019 at 15:57)</a>:</h4>
<p>As a general approach, server trends to be stateless.</p>



<a name="160888840"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160888840" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160888840">(Mar 15 2019 at 16:11)</a>:</h4>
<blockquote>
<p>As a general approach, server trends to be stateless.</p>
</blockquote>
<p>Can you explain this claim? <span class="user-mention" data-user-id="191506">@Yunwei Wang</span></p>



<a name="160891126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160891126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160891126">(Mar 15 2019 at 16:38)</a>:</h4>
<p>Stateful server is easy to implement at small scale but costly at large scale while trying to maintain all server states. Load balancer adds another layer of complexity of sharing states among servers.</p>



<a name="160891627"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160891627" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160891627">(Mar 15 2019 at 16:44)</a>:</h4>
<p>How does a stateless server support paging in a resource that is not ValueSet?</p>



<a name="160891693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160891693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160891693">(Mar 15 2019 at 16:45)</a>:</h4>
<p>with a search interaction *</p>



<a name="160892676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160892676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160892676">(Mar 15 2019 at 16:57)</a>:</h4>
<p>the Bundle.link.url contains page parameter. example here: <br>
<a href="http://build.fhir.org/http.html#paging" target="_blank" title="http://build.fhir.org/http.html#paging">http://build.fhir.org/http.html#paging</a></p>



<a name="160893511"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160893511" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160893511">(Mar 15 2019 at 17:07)</a>:</h4>
<p>This example uses a state param -_-</p>



<a name="160900008"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160900008" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160900008">(Mar 15 2019 at 18:19)</a>:</h4>
<p>and page parameter <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="160901025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160901025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160901025">(Mar 15 2019 at 18:30)</a>:</h4>
<p>I think server can choose either stateful or stateless. It is server implementer's choice. You can implement a stateful ValueSet.$expand by adding  state parameter to your server operation definition.</p>



<a name="160901412"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160901412" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160901412">(Mar 15 2019 at 18:34)</a>:</h4>
<p>Right. The spec does not dictate how the server must implement its solution. The server can use a state param or chose not to. Why would ValueSet be any different?</p>



<a name="160902051"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160902051" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160902051">(Mar 15 2019 at 18:42)</a>:</h4>
<p>Can you clarify "Why would ValueSet be any different". Do you mean all EHR servers (excluding Terminology servers) choose stateful implementation?</p>



<a name="160902478"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160902478" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160902478">(Mar 15 2019 at 18:47)</a>:</h4>
<p>No. The current ValueSet.$expand spec lists the "offset" parameter, but does not list a state parameter option. Why does a server have a choice to use a state param when implementing search for any resource if it does not have the option to implement a state parameter for ValueSet.$expand.</p>



<a name="160903928"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160903928" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160903928">(Mar 15 2019 at 19:04)</a>:</h4>
<p>If I remember correctly, while the paging was added at DSTU2, no terminology server had implemented or would implement paging as stateful. I remembered we argued at that time if offset should page based or index based. But no one at time asked for stateid.</p>



<a name="160904244"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160904244" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160904244">(Mar 15 2019 at 19:08)</a>:</h4>
<p>we covered why search is different to value set $expand much earlier in the process. you can't just add a state parameter, you have to add paging etc</p>



<a name="160904946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160904946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160904946">(Mar 15 2019 at 19:17)</a>:</h4>
<blockquote>
<p>we covered why search is different to value set $expand much earlier in the process. you can't just add a state parameter, you have to add paging etc</p>
</blockquote>
<p>Grahame, I think we all understand the difference between search and $expand. And that you can't add literally just a state parameter and call it good. Obviously, the server would return an extra element that would be used for paging. <em>something something forest for the trees</em>.</p>



<a name="160905249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160905249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160905249">(Mar 15 2019 at 19:20)</a>:</h4>
<p>It sounds like a page-based offset was considered initially, and nobody in the room represented a server that would benefit from a state parameter. Is it too late to consider adding a state parameter? I've exhausted my performance arguments.</p>



<a name="160905506"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160905506" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160905506">(Mar 15 2019 at 19:23)</a>:</h4>
<p><span class="user-mention" data-user-id="195194">@Colby Seyferth</span> I am just wondering , do you view this question as a server implementer or client implementer?</p>



<a name="160905956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160905956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colby Seyferth <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160905956">(Mar 15 2019 at 19:28)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="195194">Colby Seyferth</span> I am just wondering , do you view this question as a server implementer or client implementer?</p>
</blockquote>
<p>My perspective is: EHR Server implementing $expand.</p>



<a name="160918051"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160918051" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160918051">(Mar 15 2019 at 22:17)</a>:</h4>
<p>So there's a middle ground here - we could say that a state parameter could be added and supported for non-POST expands.</p>



<a name="160920431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160920431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160920431">(Mar 15 2019 at 22:59)</a>:</h4>
<p>As long as that doesn't break existing clients</p>
<blockquote>
<p>Servers are not obliged to support paging, but if they do, SHALL support both the offset and count parameters.</p>
</blockquote>



<a name="160926717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/160926717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#160926717">(Mar 16 2019 at 01:10)</a>:</h4>
<p>of course</p>



<a name="187409411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet/%24expand%20Paging%20-%20Offset%20vs%20State%20param/near/187409411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2F.24expand.20Paging.20-.20Offset.20vs.20State.20param.html#187409411">(Feb 04 2020 at 22:59)</a>:</h4>
<p>Following discussions with <span class="user-mention" data-user-id="191356">@Jenni Syed</span> <span class="user-mention" data-user-id="191936">@Michael Donnelly</span> in Sydney, I've now created an issue for $expand paging <a href="http://jira.hl7.org/browse/FHIR-25786" target="_blank" title="http://jira.hl7.org/browse/FHIR-25786">J#25786</a> - <span class="user-mention" data-user-id="195194">@Colby Seyferth</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
