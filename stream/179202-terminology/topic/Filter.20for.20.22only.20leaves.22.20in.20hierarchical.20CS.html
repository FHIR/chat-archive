---
layout: page
title: "FHIR Chat  · Filter for &quot;only leaves&quot; in hierarchical CS · terminology"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/index.html">terminology</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html">Filter for &quot;only leaves&quot; in hierarchical CS</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="203684817"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203684817" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203684817">(Jul 13 2020 at 07:26)</a>:</h4>
<p>I need some help from the terminology experts <span aria-label="smile" class="emoji emoji-263a" role="img" title="smile">:smile:</span> <br>
How do I define a filter to create a ValueSet expansion on a hierarchichal CodeSystem, that only contains the leaves (aka only concepts that have no child concept)...?</p>



<a name="203686208"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203686208" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203686208">(Jul 13 2020 at 07:47)</a>:</h4>
<p>You could use a filter on 'child' with operator exists and value false</p>



<a name="203687887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203687887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203687887">(Jul 13 2020 at 08:10)</a>:</h4>
<p>Ooof. It's so obvious!<br>
I must have been looking through the operator codes without seeing the "exists" value <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> <br>
...need more coffee...<br>
Thanks!</p>



<a name="203688801"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203688801" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203688801">(Jul 13 2020 at 08:22)</a>:</h4>
<p>But hold on. <br>
Are filters <em>not</em> machine readable? I'd have expected a FHIRPath expression somewhere in there...</p>
<p>So in my case the filter would be something like</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;filter&gt;</span>
   <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">&quot;has-no-children&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;description</span> <span class="na">value=</span><span class="s">&quot;allows selection of concepts without child concepts&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;operator</span> <span class="na">value=</span><span class="s">&quot;exists&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;filter&gt;</span>
</code></pre></div>


<p>But the information that this needs to be applied to the CodeSystem.concept.descentants().concept path is not part of the filter definition? Is that correct? How would the system know how to use the filter? Is that just business logic?</p>



<a name="203689096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203689096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203689096">(Jul 13 2020 at 08:25)</a>:</h4>
<p>The other thing I don't understand:<br>
Why am I required to fix the value of the filter in the CodeSystem, when the ValueSet has the option to apply a value to the filter...?<br>
In the above example I would have expected to be able to just say the filter "checks for child concepts" and leave it to the valueset <em>using</em> the filter to decide whether the value should be true or false...</p>



<a name="203690731"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203690731" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203690731">(Jul 13 2020 at 08:46)</a>:</h4>
<p>I don't understand that response. The code system defines what filters you can use, and the value set uses them. Michael was proposing a value set filter</p>



<a name="203694699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203694699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203694699">(Jul 13 2020 at 09:35)</a>:</h4>
<p>But the ValueSet filter can use either a property or a filter of the CodeSystem, since child concept is not a property, i assumed I needed to define a filter on the CodeSystem first, before a ValueSet can use it, no?</p>



<a name="203698055"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203698055" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203698055">(Jul 13 2020 at 10:17)</a>:</h4>
<p>All properties also manifest as filters</p>



<a name="203698147"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203698147" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203698147">(Jul 13 2020 at 10:18)</a>:</h4>
<p>parent and child are well-known properties defined implicitly for any CodeSystem with hierarchy and thus also available as filters.</p>



<a name="203698186"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203698186" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203698186">(Jul 13 2020 at 10:19)</a>:</h4>
<p>You would thus use them in the ValueSet definition.</p>



<a name="203703359"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203703359" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203703359">(Jul 13 2020 at 11:26)</a>:</h4>
<p>Ok, so no Filter definition needed on the CodeSystem?<br>
Is this correct for the ValueSet filter?</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;filter&gt;</span>
  <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">&quot;concept&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;op</span> <span class="na">value=</span><span class="s">&quot;exists&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;filter&gt;</span>
</code></pre></div>


<p>And the Terminology server would know that the code "concept" refers to the child element <code>concept</code> of CodeSystem.concept?<br>
This seems a bit "magical" to me... But it makes sense that the default path for every property and filter would always be CodeSystem.concept...</p>



<a name="203703557"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203703557" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203703557">(Jul 13 2020 at 11:29)</a>:</h4>
<p>The value for code would be child: '&lt;code value="child" /&gt;'</p>



<a name="203703646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203703646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203703646">(Jul 13 2020 at 11:30)</a>:</h4>
<p>It's saying match a concept if the concept's child property does not exist.</p>



<a name="203703696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203703696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203703696">(Jul 13 2020 at 11:31)</a>:</h4>
<p>I think you're getting tripped up thinking about Fhirpath - there is no fhirpath here</p>



<a name="203704489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203704489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203704489">(Jul 13 2020 at 11:42)</a>:</h4>
<p>But yes. The filters are applied relative to each concept, and the filter that references the concept itself is 'concept' (rather than say 'self' or 'this').</p>



<a name="203705041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203705041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203705041">(Jul 13 2020 at 11:50)</a>:</h4>
<p>Where is defined what "child" means...?I feel like I'm missing something...<br>
It's not an element, nor a SearchParameter. How can it be "well known"?</p>



<a name="203705115"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203705115" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203705115">(Jul 13 2020 at 11:51)</a>:</h4>
<p>Oh is it this <a href="http://hl7.org/fhir/concept-properties#child">http://hl7.org/fhir/concept-properties#child</a> : code<br>
in <a href="http://hl7.org/fhir/codesystem.html#status">http://hl7.org/fhir/codesystem.html#status</a> !?</p>



<a name="203705189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203705189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203705189">(Jul 13 2020 at 11:52)</a>:</h4>
<p>Oh well. It's obvious, if you know what you're looking for <span aria-label="smirk" class="emoji emoji-1f60f" role="img" title="smirk">:smirk:</span></p>



<a name="203705349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203705349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203705349">(Jul 13 2020 at 11:54)</a>:</h4>
<p>I somehow didn't expect that bit of information under the "Status" heading <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> <br>
I actually found it by using a full text search on "child" on that page...</p>



<a name="203779377"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203779377" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203779377">(Jul 13 2020 at 22:29)</a>:</h4>
<p><span class="user-mention" data-user-id="191343">@Michael Lawley</span>  perhaps we might have a discussion on searching for leaf nodes in tomorrow's SNOMED on FHIR call?</p>



<a name="203779624"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203779624" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203779624">(Jul 13 2020 at 22:32)</a>:</h4>
<p>it's on my agenda to clarify the use of properties in general, and specifically for filters, in R5</p>



<a name="203791293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203791293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203791293">(Jul 14 2020 at 01:41)</a>:</h4>
<p>Yes, <a href="http://hl7.org/fhir/codesystem.html#properties">http://hl7.org/fhir/codesystem.html#properties</a> should really mention the standard / well-known properties and filters.<br>
I wonder whether there should also be some kind of (extensible) binding for CodeSystem.property.code etc to further document this?</p>



<a name="203791386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203791386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203791386">(Jul 14 2020 at 01:42)</a>:</h4>
<p>Re leaf nodes and SNOMED, sure.  Because of SNOMED's ECL there are other ways to express this too.</p>



<a name="203791485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/Filter%20for%20%22only%20leaves%22%20in%20hierarchical%20CS/near/203791485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/Filter.20for.20.22only.20leaves.22.20in.20hierarchical.20CS.html#203791485">(Jul 14 2020 at 01:44)</a>:</h4>
<p>I'll note also that this example is badly out of date <a href="http://hl7.org/fhir/codesystem-snomedct.html">http://hl7.org/fhir/codesystem-snomedct.html</a> -- the property code values are wrong</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
