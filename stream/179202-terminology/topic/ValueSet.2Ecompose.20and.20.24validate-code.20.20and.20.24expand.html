---
layout: page
title: "FHIR Chat  · ValueSet.compose and $validate-code  and $expand · terminology"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/index.html">terminology</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html">ValueSet.compose and $validate-code  and $expand</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="223422220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223422220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gabriel Kleinoscheg <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223422220">(Jan 20 2021 at 19:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> I just executed the <code>$expand</code> operation on your server (<a href="http://fhir.hausamconsulting.com/">http://fhir.hausamconsulting.com/</a>) against a ValueSet (<a href="http://fhir.hausamconsulting.com/r4/ValueSet/346804/$expand">http://fhir.hausamconsulting.com/r4/ValueSet/346804/$expand</a>) that I loaded onto that server. The ValueSet has got an <code>.expansion</code> but no <code>.compose</code>. As a result the server returned an error. The result is similar, when executing <code>$validate-code</code>.</p>
<p>Subsequently, is it correct to assume that a ValueSet needs to have a <code>.compose</code> for <code>$expand</code> and <code>$validate-code</code> to work properly? Would <code>$expand</code> work in this case if the server  stored expansions (<a href="https://www.hl7.org/fhir/valueset.html#storage">https://www.hl7.org/fhir/valueset.html#storage</a>)?</p>



<a name="223425428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223425428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223425428">(Jan 20 2021 at 19:49)</a>:</h4>
<blockquote>
<p>is it correct to assume that a ValueSet needs to have a .compose for $expand and $validate-code to work properly?</p>
</blockquote>
<p>that depends on what you mean by "properly". A value set with just an expansion is fragile, or error prone. But a server can choose to support it as it is; <a href="http://tx.fhir.org">tx.fhir.org</a> does (or should).</p>



<a name="223430617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223430617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223430617">(Jan 20 2021 at 20:28)</a>:</h4>
<p>what do you want to happen? if you already have a valueset with a .expansion you already have the output of $expand, no? the server could be less transparent and serve up the valueset without altering it, but it makes more sense to me that in the situation where the operation is just going to return you a read on the VS it should be transparent about that.<br>
I would be a little more apt to agree for $validate-code but I would also understand if the terminology server doesn't want to validate when they can't verify the integrity of the expansion</p>



<a name="223440246"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223440246" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223440246">(Jan 20 2021 at 21:44)</a>:</h4>
<p><span class="user-mention" data-user-id="376049">@Gabriel Kleinoscheg</span> I'm not actually quite sure what the behavior of HAPI 5.1.0 (which my server is using currently) is in regard to stored expansions.  It's something that Rob McClure has discussed with James Agnew, but I'm not entirely sure what that has landed with what HAPI has implemented.  I really should know that, though (especially for my own server), so I will try to check that out.</p>



<a name="223445890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223445890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223445890">(Jan 20 2021 at 22:25)</a>:</h4>
<p>There's also a requirement that the supplied expansion is only usable if the $expand call is made with compatible parameters.</p>



<a name="223446103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223446103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223446103">(Jan 20 2021 at 22:27)</a>:</h4>
<p>Yes, we've stated that in our discussions.  And it's kind of obvious (or probably should be) that it has to be that way.  But I'm not sure that we've actually documented that in any detail anywhere in the spec so far?</p>



<a name="223446625"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223446625" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223446625">(Jan 20 2021 at 22:33)</a>:</h4>
<p>I think this is clear:</p>
<blockquote>
<p>If the value set already has an expansion (e.g., a stored expansion):</p>
</blockquote>
<blockquote>
<ul>
<li>Check that the parameters associated with the $expand operation are consistent with the parameters recorded in the expansion</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>If the parameters are inconsistent, then either generate a new expansion, or, if there is no definition (.compose), return an error</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>Additional parameters may be applied to an existing expansion if the server has validated that the result will be the same as if the expansion was generated directly from the value set definition (e.g. text filter, designations included).</li>
</ul>
</blockquote>



<a name="223448428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223448428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223448428">(Jan 20 2021 at 22:51)</a>:</h4>
<p>Yes, I agree that is clear.  I wasn't recalling that we had actually included that level of detail.</p>



<a name="223484404"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223484404" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gabriel Kleinoscheg <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223484404">(Jan 21 2021 at 09:18)</a>:</h4>
<p>Thank you all so far, for your answers.</p>
<p>With "to work properly" I meant that <code>$expand</code> returns an expansion and <code>$validate-code</code> lets you check if a code is part of the ValueSet (containing only a expansion).</p>
<p>I now want to summarize your answers - please correct me if I'm wrong:</p>
<ul>
<li><code>$expand</code> may return an expansion<ul>
<li>if the ValueSet contains a <code>.compose</code> (by default retrieving the most current concepts from the referenced CodeSystem)</li>
<li>if the ValueSet contains only an <code>.expansion</code> it depends on the server if stored expansions are supported. <ul>
<li>For this case, I wonder if there was an expample where I could test this functionality. Especially, what <span class="user-mention" data-user-id="191343">@Michael Lawley</span> mentioned: "Check that the parameters associated with the <code>$expand</code> operation are consistent with the parameters recorded in the expansion".</li>
</ul>
</li>
</ul>
</li>
<li><code>$validate-code</code>requires <code>.compose</code></li>
</ul>



<a name="223486997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223486997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223486997">(Jan 21 2021 at 09:49)</a>:</h4>
<p><a href="http://tx.fhir.org">tx.fhir.org</a> should return you the expansion. I haven't got around to checking expansion parameters yet</p>



<a name="223586181"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179202-terminology/topic/ValueSet.compose%20and%20%24validate-code%20%20and%20%24expand/near/223586181" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert McClure <a href="https://fhir.github.io/chat-archive/stream/179202-terminology/topic/ValueSet.2Ecompose.20and.20.24validate-code.20.20and.20.24expand.html#223586181">(Jan 21 2021 at 23:33)</a>:</h4>
<p>This all would be a lot simpler if we worked to include the <a href="http://build.fhir.org/ig/HL7/cqf-recommendations/terminology.html#using-value-sets">cpg value set profiles (properly generalized)</a> in FHIR core on value set. Vocab is working to do this.  We would then encourage terminology servers (HAPI anyone?) to use these profiles to clarify what the resource can be used to do.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
