---
layout: page
title: "FHIR Chat  · Use 5.0 Extension · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html">Use 5.0 Extension</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="226811305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226811305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Barbro Vessman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226811305">(Feb 18 2021 at 13:46)</a>:</h4>
<p>Hello,</p>
<p>In a profile of the Observation resource I need to use the ValueAttachment extension:  <a href="http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.valueAttachment">http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.valueAttachment</a></p>
<p>However I struggle with getting this to work. I have tried some different things</p>
<div class="codehilite"><pre><span></span><code>Alias: VALUE_ATTACHMENT_EXTENSION = http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.valueAttachment

* component.value.extension[VALUE_ATTACHMENT_EXTENSION].contentType = &quot;RTF&quot;&#39;
* component.extension[VALUE_ATTACHMENT_EXTENSION].contentType = &quot;RTF&quot; ´´´
</code></pre></div>
<p>Both above give this error:  No element found at path component...[VALUE_ATTACHMENT_EXTENSION].contentType for..</p>
<div class="codehilite"><pre><span></span><code>* extension contains http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.valueAttachment named ValueAttachment
</code></pre></div>
<p>Gives this error: Cannot create ValueAttachment extension; unable to locate extension definition for…</p>
<p>Adding the url above as a dependency in sushi-config.yaml gives this error:</p>
<p>Failed to add 0:h to ImplementationGuide instance because SUSHI could not find the IG URL in the dependency IG. To specify the IG URL in your sushi-config.yaml, use the dependency details format:</p>
<p>What am I doing wrong or missing?</p>



<a name="226847975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226847975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226847975">(Feb 18 2021 at 17:30)</a>:</h4>
<p>where are you getting that url from? it doesn't look right to me but I'm not sure what you are trying to reference so it might be right..</p>



<a name="226853949"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226853949" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226853949">(Feb 18 2021 at 18:12)</a>:</h4>
<p>I think there are actual issues w/ those paths too.  For example, this path:</p>
<div class="codehilite"><pre><span></span><code>* component.value.extension[VALUE_ATTACHMENT_EXTENSION].contentType = &quot;RTF&quot;&#39;
</code></pre></div>
<ul>
<li>There is a stray <code>'</code> at the end of the rule.  But that might just be a typo when entering it here (also the stray ``` at the end of the second rule).</li>
<li><code>component.value</code> needs to be <code>component.value[x]</code> (only valid in a profile definition) or a specific type like <code>component.valueQuantity</code> (valid in profiles or instances).  But just <code>component.value</code> does not work (unlike in FHIRPath).</li>
<li><code>extension[VALUE_ATTACHMENT_EXTENSION].contentType</code> is not valid because <code>extension[VALUE_ATTACHMENT_EXTENSION]</code> refers to an <code>Extension</code>, and <code>contentType</code> is not an element on <code>Extension</code>.  I think you really want <code>extension[VALUE_ATTACHMENT_EXTENSION].valueAttachment.contentType</code>.</li>
</ul>
<p>I noticed your <code>VALUE_ATTACHMENT_EXTENSION</code> URL actually ends with <code>.valueAttachment</code> -- is that really a part of the ID, or were you trying to reference the <code>valueAttachment</code> element in the extension?</p>
<p>Last, as <span class="user-mention" data-user-id="237342">@ryan moehrke</span> noted, it would definitely help to know where that extension is defined (in what IG).  You would need to add a reference to the dependency IG itself to the <code>sushi-config.yaml</code> dependencies.  If you've supplied the right IG <code>id</code> and <code>version</code> and still get the error about not finding the IG URL, you may need to use the longer form dependency format so you can provide the <code>uri</code> (<a href="https://fshschool.org/docs/sushi/configuration/#recommended-configuration">docs</a>).</p>



<a name="226875574"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226875574" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226875574">(Feb 18 2021 at 20:32)</a>:</h4>
<p>That extension isn't formally defined in an IG.  It's using the 'implied' extension inter-version format described here: <a href="https://build.fhir.org/versions.html#extensions">https://build.fhir.org/versions.html#extensions</a></p>



<a name="226875635"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226875635" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226875635">(Feb 18 2021 at 20:32)</a>:</h4>
<p>Essentially you can reference anything in a future (or past) FHIR version as an extension.</p>



<a name="226878896"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226878896" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226878896">(Feb 18 2021 at 20:55)</a>:</h4>
<p>would Observation.valueAttachment be the correct path in that paradigm then? if it's a value[x] of type Attachment?<br>
I'm assuming since the spec says it should be <a href="http://elementDefinition.id">elementDefinition.id</a> it should be Observation.component.value[x] &lt;element id="Observation.component.value[x]"&gt;<br>
also what is the context that the extension should be in the instance? I assume as far in the path as possible, but in this case where value[x] exists just doesn't allow the needed datatypes would you ignore the existing value[x]?<br>
so then should it read:</p>
<div class="codehilite"><pre><span></span><code>Alias: VALUE_ATTACHMENT_EXTENSION = http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.component.value[x]

* component.extension[VALUE_ATTACHMENT_EXTENSION].valueAttachment.contentType = &quot;RTF&quot;
</code></pre></div>
<p>And the obvious other follow-up, does Sushi support this extension at all? was the complaining just about the path not using extension.value[x] and/or is there an override for extensions you don't expect/can't tell sushi about?</p>



<a name="226879967"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226879967" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226879967">(Feb 18 2021 at 21:01)</a>:</h4>
<p>I thought you couldn't link (in an IG) to future things since they haven't been published (though would be happy to be corrected).</p>
<p>Specifically, I thought it wasn't acceptable to try and link 'SomeNewResourceInR5', since neither the contents nor the link itself are stable until it has been published.</p>



<a name="226880587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226880587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226880587">(Feb 18 2021 at 21:05)</a>:</h4>
<p>Pointing to R5 things is risky - because if R5 changes, you'll break.  So it's a buyer beware thing.  (Some stuff is pretty safe to point at though.)</p>



<a name="226880684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226880684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226880684">(Feb 18 2021 at 21:06)</a>:</h4>
<p>My understanding was that "valueAttachment" wasn't allowed in FHIRPath - that it was always "value".  But I'm not an expert.</p>



<a name="226887875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226887875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226887875">(Feb 18 2021 at 21:59)</a>:</h4>
<p>SUSHI currently expects to be able to resolve all extension references to an actual <code>StructureDefinition</code> included in an IG package or FHIR core package.  So... it does not (yet) support "implied" extensions.  We'll have to put this on our list -- but until we support it, I wouldn't expect extensions like this to work in SUSHI.</p>



<a name="226903456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226903456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226903456">(Feb 19 2021 at 00:12)</a>:</h4>
<p>Lloyd, the wording of the spec you linked to doesn't say fhirpath it explicitly says <a href="http://ElementDefinition.id">ElementDefinition.id</a> and looking further here <a href="https://www.hl7.org/fhir/elementdefinition.html#id">https://www.hl7.org/fhir/elementdefinition.html#id</a><br>
it seems your extension url would have to be "<a href="http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.component.value[x]:valueAttachment">http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.component.value[x]:valueAttachment</a>"<br>
which wow is quite verbose</p>



<a name="226903707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226903707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226903707">(Feb 19 2021 at 00:15)</a>:</h4>
<p>The extension URL would indeed include be the id, but I don't think it allows you to drill down into type slices.  The extension would just be to Observation.component.value.  You'd then have a valueAttachment in the extension.  I believe a URL that said "extension-Observation.component.value[x]:valueAttachment" wouldn't be a legal URL.</p>



<a name="226903791"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226903791" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226903791">(Feb 19 2021 at 00:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>?</p>



<a name="226904249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226904249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226904249">(Feb 19 2021 at 00:21)</a>:</h4>
<p>"For type choice elements, the id reflects the type slice. e.g. For path = Patient.deceasedBoolean, the id is Patient.deceased[x]:deceasedBoolean"<br>
is what the spec on <a href="http://ElementDefinition.id">ElementDefinition.id</a> says, which is where I got that from. If that means this extension is implicitly illegal that's another thing I can't speak on</p>



<a name="226907340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226907340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226907340">(Feb 19 2021 at 01:02)</a>:</h4>
<p>I agree, that's the id.  But I don't think we can do that in the auto-extension mechanism.</p>



<a name="226928310"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226928310" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Barbro Vessman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226928310">(Feb 19 2021 at 07:27)</a>:</h4>
<p>Thanks a lot for all answers. I really appreciate them all! Yes there were some typos in the example, sorry. MD issues.</p>
<p>I found the url of the extension via Cerners documentation (<a href="https://fhir.cerner.com/millennium/r4/diagnostic/observation/#extensions">https://fhir.cerner.com/millennium/r4/diagnostic/observation/#extensions</a>).  ValueAttachment is mentioned here: <a href="https://www.hl7.org/fhir/extensibility.html">https://www.hl7.org/fhir/extensibility.html</a> but no url.</p>
<p>My conclusion of your answers is that use of this extension is not recommended. And it is not supported when using sushi for creating documentation, since the extension does not exist in an IG.  </p>
<p>The extension is already used to be able to include large content in the Observation resource. Maybe there are other ways? This is how the extension looks in the instance, if that might help:</p>
<div class="codehilite"><pre><span></span><code>          ],
                &quot;component&quot;: [
                    {
                        &quot;extension&quot;: [
                            {
                                &quot;url&quot;: &quot;http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.valueAttachment&quot;,
                                &quot;valueAttachment&quot;: {
                                    &quot;contentType&quot;: &quot;RTF&quot;,
                                    &quot;data&quot;: &quot;e1xydGYxXGFkZWZsYW........&quot;
</code></pre></div>
<p>Thanks again</p>



<a name="226965081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226965081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226965081">(Feb 19 2021 at 13:50)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> - Although <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.component.value[x]:valueAttachment</code> is likely invalid, might <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.component.valueAttachment</code> be valid? This is the style that Cerner uses in their example, which technically is a valid <code>id</code> in a <em>differential</em> since <a href="https://fire.ly/2019/09/13/type-slicing-in-fhir-r4/">choice type renaming</a> is allowed there. </p>
<p><span class="user-mention" data-user-id="366644">@Barbro Vessman</span> - I don't see any existing extensions in R4 core that would allow you to put an attachment on an Observation.  If you need something that will work <em>today</em> with SUSHI, I think you have three choices:</p>
<p>1) You can likely still get SUSHI to output something like this; you just have to do it in a more manual way.  The exact approach depends on if you're looking to use the extension in an instance or to specify the extension in a profile. It also depends on the conversation above regarding whether or not the extension can directly target the <code>valueAttachment</code>.  For now, we'll assume it can as long as it follows the Cerner approach.</p>
<p>1a) To use the extension in an instance, you could do something like this:</p>
<div class="codehilite"><pre><span></span><code>// Fake system because I&#39;m too lazy to find a clinically correct example
Alias: FOO = http://foo.org/codes

Instance: MyObservation
InstanceOf: Observation
* code = FOO#bar
* status = #final
* component.code = FOO#baz
* component.extension.url = &quot;http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.component.valueAttachment&quot;
* component.extension.valueAttachment.contentType = #RTF
* component.extension.valueAttachment.data = &quot;Tm90IHJlYWxseSBSVEY=&quot;
</code></pre></div>
<p><a href="https://fshschool.org/FSHOnline/#/share/3pAdfHw">FSH Online Permalink</a></p>
<p>1b) To explicitly specify that it can be used in a profile, you can use <code>^</code> rules to do so.  This produces the right FHIR w/ a few caveats: (a) SUSHI will complain because it thinks you're trying to define an "inline" extension in a profile, (b) if you try to constrain anything within the extension, it won't have the extension definition available, so it will be using the base Extension definition to create the differential elements.  So... this is probably not advised, but for educational purposes:</p>
<div class="codehilite"><pre><span></span><code>Profile: MyObservationProfile
Parent: Observation
* component.extension contains valueAttachment 0..1
* component.extension[valueAttachment] ^type.profile = &quot;http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.component.valueAttachment&quot;
</code></pre></div>
<p><a href="https://fshschool.org/FSHOnline/#/share/3ayaAK4">FSH Online Permalink</a></p>
<p>Both of the above approaches work because you're explicitly <em>not</em> using the standard FSH approach w/ extensions.  By spelling them out property by property, you're basically using a backdoor past some of the validation and telling SUSHI, "Don't worry, I got this!"</p>
<p>2) You can trick SUSHI by basically creating an imposter of that extension yourself in SUSHI -- even going so far as to give it that exact URL.  Then SUSHI will know what it is and can use it.  For example:</p>
<div class="codehilite"><pre><span></span><code>// Fake system because I&#39;m too lazy to find a clinically correct example
Alias: FOO = http://foo.org/codes

// Trick SUSHI by creating an imposter extension
Extension: ObsComponentAttachment
Id: extension-Observation.component.valueAttachment
* ^url = &quot;http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.component.valueAttachment&quot;
* value[x] only Attachment

// Instance using extension
Instance: MyObservation
InstanceOf: Observation
* code = FOO#bar
* status = #final
* component.code = FOO#baz
* component.extension[ObsComponentAttachment].valueAttachment.contentType = #RTF
* component.extension[ObsComponentAttachment].valueAttachment.data = &quot;Tm90IHJlYWxseSBSVEY=&quot;

// Profile using extension
Profile: MyObservationProfile
Parent: Observation
* component.extension contains ObsComponentAttachment named valueAttachment 0..1
</code></pre></div>
<p><a href="https://fshschool.org/FSHOnline/#/share/2Zvzsff">FSH Online Permalink</a></p>
<p>The issue w/ this one is that if you try to run the SUSHI imposter definition through the IG Publisher, I'm not sure what will happen.</p>
<p>3) You can just create your own extension (w/ its own name, id, url, etc).  The obvious downside here is that any system processing your instances would need to know what this extension is:</p>
<div class="codehilite"><pre><span></span><code>Extension: ObsComponentAttachment
* value[x] only Attachment
</code></pre></div>



<a name="226968371"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226968371" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Barbro Vessman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226968371">(Feb 19 2021 at 14:16)</a>:</h4>
<p>Thank you very much <span class="user-mention" data-user-id="191469">@Chris Moesel</span>  for those options! At the moment my purpose with this is to specify the extension in the profile to be able to create documentation, so I think I will try option 2 and see how that works.</p>



<a name="226969018"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226969018" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226969018">(Feb 19 2021 at 14:21)</a>:</h4>
<p>I think we need to improve the documentation in the spec.  <code>.component.valueAttachment</code> doesn't show up in the <code>id</code> anymore, so if that's the expectation, we need to make it clear.  In practice, I'd expect the "valueAttachment" to show up in the extension, not the path.</p>



<a name="226969077"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226969077" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226969077">(Feb 19 2021 at 14:22)</a>:</h4>
<p>Can someone file a change request so we can land this?</p>



<a name="226981248"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226981248" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226981248">(Feb 19 2021 at 15:43)</a>:</h4>
<p>Sure, I'll try to file something.</p>



<a name="226986113"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226986113" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226986113">(Feb 19 2021 at 16:10)</a>:</h4>
<p><span class="user-mention" data-user-id="372944">@Firely Bot</span> issue show <a href="http://jira.hl7.org/browse/FHIR-31348">FHIR-31348</a></p>



<a name="226986133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/226986133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Firely Bot <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#226986133">(Feb 19 2021 at 16:11)</a>:</h4>
<p><strong><a href="https://jira.hl7.org/browse/FHIR-31348">FHIR-31348 Clarify allowable Extension URLs for converting between versions</a></strong><br>
Status: <strong>Submitted</strong>, Type: <strong>Change Request</strong></p>



<a name="230427736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/230427736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#230427736">(Mar 15 2021 at 22:09)</a>:</h4>
<p>The <a href="https://build.fhir.org/versions.html#extensions">extensions for converting between versions documentation</a> indicates that there are packages for these special versioned extensions, but it also contains this note:</p>
<blockquote>
<p>Note for balloters: these packages will be created when R4 is finalized. Until then, these are broken links.</p>
</blockquote>
<p>R4 was finalized quite a while ago, but the links it refers to are still broken -- and I'm having trouble finding those extension packages in the registry.  Do they actually exist?  If so, are they in the package registry (and under what package ids)?  It would be much easier for me to support this in SUSHI if I can just rely on existing packages rather than having to materialize these virtual extensions myself.</p>



<a name="230428331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/230428331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#230428331">(Mar 15 2021 at 22:12)</a>:</h4>
<p>If I do have to materialize them myself, then I have some follow-up questions. ;-)</p>



<a name="230586647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/230586647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#230586647">(Mar 16 2021 at 20:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> -- Do you have any insight regarding the existence (or lack thereof) of these implied extension packages?</p>



<a name="230589329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/230589329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#230589329">(Mar 16 2021 at 20:53)</a>:</h4>
<p>As far as I know, this is all validator magic.  No packages are defined.  (If they were defined, they'd theoretically have to be updated (for R5 anyhow) every time someone pushed a commit to the CI build, which doesn't seem super practical, though I suppose it's possible.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="230591836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/230591836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#230591836">(Mar 16 2021 at 21:09)</a>:</h4>
<p>OK.  If that's the way it's intended to be then I can submit a change request to remove that verbiage from the documentation. But I'll wait for Grahame's confirmation first.</p>



<a name="230591953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/230591953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#230591953">(Mar 16 2021 at 21:10)</a>:</h4>
<p>To save people the click, this is what I'm referring to:<br>
<a href="/user_uploads/10155/2tiGMO-Le5gUe5dmZuV7gGpu/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/2tiGMO-Le5gUe5dmZuV7gGpu/image.png" title="image.png"><img src="/user_uploads/10155/2tiGMO-Le5gUe5dmZuV7gGpu/image.png"></a></div>



<a name="232830906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/232830906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#232830906">(Apr 01 2021 at 21:58)</a>:</h4>
<p>(deleted)</p>



<a name="232831515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/232831515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#232831515">(Apr 01 2021 at 22:03)</a>:</h4>
<p>(deleted)</p>



<a name="232831898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/232831898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#232831898">(Apr 01 2021 at 22:07)</a>:</h4>
<p>(deleted)</p>



<a name="232832087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/232832087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#232832087">(Apr 01 2021 at 22:09)</a>:</h4>
<p>(deleted)</p>



<a name="232832323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/232832323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#232832323">(Apr 01 2021 at 22:11)</a>:</h4>
<p>The above deleted posts were all just me talking to myself and eventually figuring out that:</p>
<ul>
<li>For implied extensions, the cardinality of the target element should be reflected in the root element of the implied extension</li>
<li>For implied extensions that are complex, the cardinality of the child paths should be reflected in the sub-extension elements</li>
</ul>
<p>It makes sense when you think about it.  But I had to think through it a few times before I figured out no other approach (e.g., putting the cardinalities on <code>value[x]</code>) could possibly work.</p>



<a name="232842389"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/232842389" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#232842389">(Apr 02 2021 at 00:04)</a>:</h4>
<p>OK. Here is a different question.  The spec says:</p>
<blockquote>
<p>Where complex data types have no equivalent in an earlier version, use a complex extension...</p>
</blockquote>
<p>I think that means that if I am in R4 and use an implied extension to reference an R5 element with <code>CodeableReference</code> type, the implied extension will be a complex extension with <code>concept</code> and <code>reference</code> sub-extensions.</p>
<p>But... what if I use an implied extension to reference an R5 element that is a choice of <code>CodeableReference</code> and something else (for example, <code>CodeableReference or string</code>)?  I can't use a simple extension because <code>value[x]</code> in R4 can't hold <code>CodeableReference</code> (nor a complex extension representing <code>CodeableReference</code>). But if I represent the element w/ a complex extension, there is no obvious way to represent that choice between <code>CodeableReference</code> and <code>string</code> (without complicated invariants).  Or is this just a hypothetical problem that is unlikely to actually occur?</p>



<a name="232846364"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/232846364" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#232846364">(Apr 02 2021 at 00:54)</a>:</h4>
<p>And two more questions:</p>
<ol>
<li>
<p>Should we also be replacing old types w/ new types where applicable?  For example, if a DSTU2 element has a type that is <code>Reference(MedicationOrder)</code> should we change that to <code>Reference(MedicationRequest)</code> in the implied extension?</p>
</li>
<li>
<p>What do we do if a DSTU2 element is a reference to a resource that no longer exists in R4?  For example, how would we represent an element whose type is <code>Reference(ImagingObjectSelection)</code> using an implied extension in R4?  We can represent <code>ImagingObjectSelection</code> as a complex extension, but we can't create a <code>Reference</code> to an extension -- so we lose the "referential" aspect of it.</p>
</li>
</ol>



<a name="233501779"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/233501779" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#233501779">(Apr 07 2021 at 14:52)</a>:</h4>
<p>And one more question:  Should implied extensions carry over extensions in the source element from the other version of FHIR?  For example, the <a href="http://hl7.org/fhir/versions.html#extensions">implied extensions documentation</a> uses <code>http://hl7.org/fhir/3.0/StructureDefinition/extension-Patient.animal.species</code> as an example.  If you look at that element in STU3, it actually contains a binding with an extension:</p>
<div class="codehilite"><pre><span></span><code>&quot;binding&quot;: {
  &quot;extension&quot;: [
    {
      &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName&quot;,
      &quot;valueString&quot;: &quot;AnimalSpecies&quot;
    }
  ],
  &quot;strength&quot;: &quot;example&quot;,
  &quot;description&quot;: &quot;The species of an animal.&quot;,
  &quot;valueSetReference&quot;: {
    &quot;reference&quot;: &quot;http://hl7.org/fhir/ValueSet/animal-species&quot;
  }
}
</code></pre></div>
<p>So... should the implied extension also specify that source extension in the binding on <code>Extension.value[x]</code>?  I'm not sure because there is a possibility that the original extension is no longer valid in the version of FHIR you're bringing it into.</p>



<a name="233501913"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/233501913" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#233501913">(Apr 07 2021 at 14:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> -- do you have any insight into any of the questions I've asked above?  The specification is not very thorough in its explanation regarding how all of this should work in practice.</p>



<a name="233512008"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/233512008" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#233512008">(Apr 07 2021 at 15:35)</a>:</h4>
<p>I don't think we've thought about polymophics that include net new data types for this mechanism.  You can submit a change request for us to come up with guidance here</p>
<ol>
<li>
<p>I think so, though that can get messy if there aren't nice correlations.  A change request to clarify would be good</p>
</li>
<li>
<p>I don't think you could meaningfully adopt that in R4 in that situation?  Again, clarification by change request would be good</p>
</li>
</ol>
<p>I don't think there's a requirement to bring across unrecognized extensions.  This particular extension is not one that would need to be propagated, though I'm not clear it's <em>wrong</em> to propagate it.</p>



<a name="233515405"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/233515405" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#233515405">(Apr 07 2021 at 15:55)</a>:</h4>
<p>What is more helpful? One change request to cover <em>all</em> things needing clarification re: implied extensions?  Or specific change requests for each thing needing clarification?</p>



<a name="233534580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/233534580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#233534580">(Apr 07 2021 at 17:59)</a>:</h4>
<p>I think one for the set is fine.  The gist is "we need more clarification here"</p>



<a name="233547610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/233547610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#233547610">(Apr 07 2021 at 19:29)</a>:</h4>
<p><span class="user-mention" data-user-id="372944">@Firely Bot</span> issue show <a href="http://jira.hl7.org/browse/FHIR-31721">FHIR-31721</a></p>



<a name="233547637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Use%205.0%20Extension/near/233547637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Firely Bot <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Use.205.2E0.20Extension.html#233547637">(Apr 07 2021 at 19:30)</a>:</h4>
<p><strong><a href="https://jira.hl7.org/browse/FHIR-31721">FHIR-31721 Clarify details in "Extensions for converting between versions" (a.k.a. implied extensions) </a></strong><br>
Status: <strong>Submitted</strong>, Type: <strong>Change Request</strong></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
