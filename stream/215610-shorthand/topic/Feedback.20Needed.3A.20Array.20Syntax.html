---
layout: page
title: "FHIR Chat  · Feedback Needed: Array Syntax · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html">Feedback Needed: Array Syntax</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="203963085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203963085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203963085">(Jul 15 2020 at 14:34)</a>:</h4>
<p>FHIR Shorthand uses indexes to support building multi-item arrays.  For example, consider this person with three variations of his given names:</p>
<div class="codehilite"><pre><span></span><code>* name[0].given[0] = &quot;William&quot;
* name[0].given[1] = &quot;Robert&quot;
* name[1].given[0] = &quot;Willy&quot;
* name[1].given[1] = &quot;Robby&quot;
* name[2].given[0] = &quot;Will&quot;
* name[2].given[1] = &quot;Rob&quot;
</code></pre></div>


<p>This approach <em>works</em> but it is brittle because you (the author) must keep track of the indexes.</p>
<ul>
<li>If you want to add "Billy Bob" as the second name, you need to add it with index <code>1</code> and then manually increment the index of every name after it.</li>
<li>Similarly, if you want to <em>remove</em> one of the names, you need to then decrement every index after it</li>
<li>God help you if it's an array with 50 items and you realize you mistakenly repeated index 7 (it's happened before).</li>
</ul>
<p>As part of ballot reconciliation, we have the opportunity to fix this.  Here is an approach we've come up with.  We welcome your thoughts and suggestions.  If you have a better idea, we want to hear it!</p>
<blockquote>
<p><strong>KEY:</strong><br>
<code>list[ ]</code> --&gt; last item in list; when list is empty, the equivalent of [+]<br>
<code>list[+]</code> --&gt; add a new item to list<br>
<code>list[n]</code> --&gt; the n+1 item ([0] is first element)</p>
</blockquote>
<div class="codehilite"><pre><span></span><code>* name[0].given[0] = &quot;William&quot;
* name[ ].given[+] = &quot;Robert&quot;
* name[+].given[0] = &quot;Willy&quot;
* name[ ].given[+] = &quot;Robby&quot;
* name[+].given[0] = &quot;Will&quot;
* name[ ].given[+] = &quot;Rob&quot;
</code></pre></div>


<p>This then allows you to add or remove an element in the middle without having to modify all the elements after it.  We would still support omitting the index as a shortcut for <code>[0]</code>, but I've used <code>[0]</code> above because it actually makes for better alignment (and easier reading).</p>



<a name="203963322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203963322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203963322">(Jul 15 2020 at 14:36)</a>:</h4>
<p>I'm attaching a slightly more complex example with a snippet of a CapabilityStatement (attaching before and after).<br>
<a href="/user_uploads/10155/IfbuH7RsRzc-lNJahY4H6HY7/index-example-before.fsh">index-example-before.fsh</a> <br>
<a href="/user_uploads/10155/dG1V02WNT_VPkyR6pi9TJ6Uy/index-example-after.fsh">index-example-after.fsh</a></p>



<a name="203963647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203963647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203963647">(Jul 15 2020 at 14:38)</a>:</h4>
<p>Also note that eventually we would want to marry this with a syntax for more easily working with deeply nested paths (such as the <a href="#narrow/stream/215610-shorthand/topic/shorthand.20for.20deeply.20indented.20.2Fnested.20elements/near/203331180">with syntax</a> that <span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span> suggested) -- but that seemed a bit too far from what was balloted to justify slipping it in as a reconciliation.</p>



<a name="203967542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203967542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203967542">(Jul 15 2020 at 15:08)</a>:</h4>
<p>My concern is trading a compiler error and annoyance for a run-time error and annoyance.  Specifically, if you swap any two lines in the example you get incorrect output without any warnings:</p>
<div class="codehilite"><pre><span></span><code>* name[+].given[0] = &quot;Willy&quot;
* name[+].given[0] = &quot;Will&quot;
* name[ ].given[+] = &quot;Robby&quot;
</code></pre></div>


<p>In this short example, it's easy to see because of the pattern and formatting - but if there are more fields (or an inconsistent number of fields) you now have incorrect output that builds without errors.</p>



<a name="203969372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203969372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203969372">(Jul 15 2020 at 15:21)</a>:</h4>
<p>I don't like that this proposal is adding procedural logic to a statement based language.<br>
How about you do this with aliases? Have a different alias for each name the person has, manage the increments in the alias file. <br>
Even if we had to add procedural increment support ONLY in the alias declaration file, that would be less of a violation of statement based language from procedural based language.</p>



<a name="203973928"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203973928" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203973928">(Jul 15 2020 at 15:52)</a>:</h4>
<p><span class="user-mention" data-user-id="222054">@Gino Canessa</span> -- I understand your concern, but to be clear -- it's also quite possible to mess up explicit indices and not receive any compiler errors. I guess it's a question of which type of a mistake are authors more likely to make?</p>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> -- this is probably silly, but does it feel less procedural if we define <code>item[ ]</code> as "the same item as the previous rule" and <code>item[+]</code> as "the next item" (essentially removing the "verbs" from the descriptions)?</p>



<a name="203974198"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203974198" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203974198">(Jul 15 2020 at 15:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> -- I'm not sure I understand what you're suggesting regarding the aliases.  If you have a moment, could you flesh that out for me?</p>



<a name="203974897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203974897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203974897">(Jul 15 2020 at 15:59)</a>:</h4>
<p>I agree that it is possible, but I believe it is less likely.  I believe something in the toolchain now flags if you skip an element.  As for redefining one twice, I'm not sure if anything does today, but if nothing does, it should be straightforward to add.</p>
<p>These checks can even be implemented with UI notifications (e.g., flag element redefinition, flag array indexes out of order (check for same index or higher in a block)).</p>
<p>There are still issues from copy pasta, since we know that's how repetitive blocks get added, but with everything implicit I don't believe these errors can be detected anymore.</p>



<a name="203977244"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203977244" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203977244">(Jul 15 2020 at 16:16)</a>:</h4>
<p>One thing that I like about sushi is that I can say today (top of file) say <code>name[0]=Alice</code> <code>name[1]=Bob</code> <code>name[2]=Chuck</code> and then 300 lines later I can go "forget that, <code>name[1]=Bart</code></p>



<a name="203977503"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203977503" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203977503">(Jul 15 2020 at 16:18)</a>:</h4>
<p>If we want to keep that, I'd think that this approach is a special case. <br>
Some suggestions:</p>



<a name="203977620"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203977620" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203977620">(Jul 15 2020 at 16:19)</a>:</h4>
<div class="codehilite"><pre><span></span><code>* name[0].given[0] = &quot;William&quot;
* name[ ].given[+] = &quot;Robert&quot;
* name[+].given[0] = &quot;Willy&quot;
* name[ ].given[+] = &quot;Robby&quot;
* name[+].given[0] = &quot;Will&quot;
* name[ ].given[+] = &quot;Rob&quot;
</code></pre></div>


<p>this should not be allowed. Either you're iterating the inner loop or the outer loop.</p>



<a name="203980352"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203980352" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203980352">(Jul 15 2020 at 16:39)</a>:</h4>
<p>I can imagine you could do this</p>
<div class="codehilite"><pre><span></span><code>* with name[] do
**   given[] = &quot;Robert&quot;
**   given[] = &quot;Robby&quot;
**   given[] = &quot;Rob&quot;

* with name[] do
**   given[] = &quot;William&quot;
**   given[] = &quot;Willy&quot;
**   given[] = &quot;Will&quot;
</code></pre></div>



<a name="203980431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/203980431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#203980431">(Jul 15 2020 at 16:40)</a>:</h4>
<p>(notice the subtle suggestion to remove the + or the space inside the [])</p>



<a name="204030405"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/204030405" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#204030405">(Jul 16 2020 at 00:23)</a>:</h4>
<p>I like Jose's syntax.  FHIR Shorthand is supposed to be easy to write, which also means it needs to be easy to read.  Having to keep track of the numbers makes it challenging to write, and I can't tell you how many times I've had to add complex logic to keep track of where I started and where I finished in code that should be compartmentalized.  I have a set of things to add (extensions) which are for different reasons, and have to pass along how many extensions I've already added to another routine that depending on thee situation could add more, and both of these separate routines have to return somehow back to the caller the total count of what they've added.  That's impossible to do in some programming constructs (e.g., declarative languages like XSLT don't let you pass back anything other than the result of the transform, and you cannot modify state [Yes, I've written FSH from an XSLT].  This would make my life so much simpler.</p>



<a name="204033455"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/204033455" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#204033455">(Jul 16 2020 at 01:09)</a>:</h4>
<p>Yeah, I like the <code>with</code> syntax as well... I just don't think we can/should introduce something like that in the reconciliation phase without balloting it.  I thought the proposed array syntax would not be very controversial (and is similar enough to existing syntax) that it might be appropriate for STU1... but I'm starting to have 2nd thoughts about that as well!  It may be that we just work with you (the community) on getting these right early on and put them in the next ballot (and have them available in SUSHI prior to that -- just like we did w/ pre-STU1 features).  I'll have to talk with <br>
<span class="user-mention" data-user-id="191447">@Mark Kramer</span> and the team about this.</p>



<a name="204102185"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/204102185" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#204102185">(Jul 16 2020 at 15:44)</a>:</h4>
<p>Chris, while YOU CAN do something like that in the reconciliation phase, it introduces a new requirement for a system interpreting the language.  As a result, according to existing HL7 rules, you would need to reballot that particular item (and any other breaking change).  If the syntax change were small, you might successfully argue it was a technical correction, but I don't think the with syntax is small as you say.  So I'd probably classify that as "consider for future release", even though I like it very much.</p>



<a name="204102734"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/204102734" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#204102734">(Jul 16 2020 at 15:48)</a>:</h4>
<p>That's only true if you're going normative.  It's totally fine to make substantive changes during reconciliation and not go back to ballot.  The base question is whether the changes are so significant that the validity of the ballot result would be called into question.  (I.e. you can't ballot one spec and publishing something that looks totally different and say it passed STU.)</p>



<a name="204105424"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/204105424" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#204105424">(Jul 16 2020 at 16:07)</a>:</h4>
<p>Thank you for that clarification.  I wasn't aware of that subtlety.  That actually helps me in another DSTU ballot where we added a requirement.</p>



<a name="204106098"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/204106098" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#204106098">(Jul 16 2020 at 16:11)</a>:</h4>
<blockquote>
<p>The base question is whether the changes are so significant that the validity of the ballot result would be called into question.</p>
</blockquote>
<p>Right, and that's why I felt comfortable considering <code>[ ]</code>/<code>[+]</code> array indexers in reconciliation, but less so something more significant like a nested syntax.  But as I noted above, we're leaning toward holding off on the array indexers too...  We don't want to introduce something that is controversial.</p>



<a name="208226583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208226583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kirstine Rosenbeck Gøeg <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208226583">(Aug 27 2020 at 14:47)</a>:</h4>
<p>What is the status of the proposal? I would certainly support the use of [ ]/[+] array indexers.  I am currently implementing questionnaire instances, so some implementation of auto-increment would come in handy :-)</p>



<a name="208234271"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208234271" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208234271">(Aug 27 2020 at 15:36)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="194347">@Kirstine Rosenbeck Gøeg</span> -- that proposal has been folded into an updated proposal that includes support for parameterized RuleSets.  See the slides from the most recent FSH Telecon for details: <a href="https://confluence.hl7.org/display/FHIRI/FHIR+Shorthand+Minutes+2020-08-13?preview=/91981964/91981967/FHIR%20Shorthand%20Conference%20Call-2020-08-13.pptx">https://confluence.hl7.org/display/FHIRI/FHIR+Shorthand+Minutes+2020-08-13?preview=/91981964/91981967/FHIR%20Shorthand%20Conference%20Call-2020-08-13.pptx</a></p>
<p>If you don't want to go through the slides, the array syntax proposal is almost the same as what was proposed, except instead of <code>[ ]</code> to represent the current element, you use <code>[=]</code> instead.  So it's <code>[+]</code> and <code>[=]</code>.  As for implementation, we're currently focused on the FHIR Shorthand 1.0.0 spec finalization and a corresponding release (in the next 2 weeks) and then we'll move on to new features like the array syntax.</p>



<a name="208244155"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208244155" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208244155">(Aug 27 2020 at 16:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> , how does the proposal handle “resetting” sub indexes? Does it recognize that if we have a[0].b[7], when we go to a[1], that we need to go back to b[0]?</p>



<a name="208244329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208244329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208244329">(Aug 27 2020 at 16:49)</a>:</h4>
<p>Also, for the parameterized macros proposal, are there concerns with the $ notation conflicting with the code system $ notation?</p>



<a name="208246334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208246334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208246334">(Aug 27 2020 at 17:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191380">@Elliot Silver</span>  Yes... bumping a higher-level index resets all indexes on childpaths to <code>0</code>.  As for the argument notation (<code>$</code>), that was discussed while I was on vacation, but I assume that we'll change it to something else if we determine it's an issue.  But it's probably ok because you would never use an alias in a RuleSet declaration (only in the rules inside the RuleSet itself).</p>



<a name="208246540"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208246540" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208246540">(Aug 27 2020 at 17:05)</a>:</h4>
<p>what happened to the with syntax?</p>



<a name="208246701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208246701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208246701">(Aug 27 2020 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span> -- nothing yet.  I think the <code>with</code> syntax is complementary to these other proposals -- not a replacement for them.</p>



<a name="208246761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208246761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208246761">(Aug 27 2020 at 17:07)</a>:</h4>
<p>I think the fact that you can change indexing on several levels in one line makes it complicated.  - <code>a[+].b[+]</code> is confusing, perhaps only to me...</p>



<a name="208246826"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208246826" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208246826">(Aug 27 2020 at 17:08)</a>:</h4>
<p>Ok, so that means we don’t need an explicit “set to zero”.<br>
You wouldn’t define an alias inside a rule set, but I can certainly see you using one, or passing it as a parameter. Can one rule set invoke another?</p>



<a name="208246998"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208246998" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208246998">(Aug 27 2020 at 17:09)</a>:</h4>
<p>the reason for me asking about <code>with</code> is that i'd feel safer nesting <code>with</code>s than this <code>a[+].b[+]</code> thing.</p>



<a name="208247187"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208247187" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208247187">(Aug 27 2020 at 17:10)</a>:</h4>
<p>I can see how it’s two different issues. One doesn’t eliminate the need for the other.</p>



<a name="208251243"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208251243" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208251243">(Aug 27 2020 at 17:44)</a>:</h4>
<p>It's not the syntax, but the fact that we have two increments to different levels in one line.</p>



<a name="208251418"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208251418" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208251418">(Aug 27 2020 at 17:45)</a>:</h4>
<p>I think a[+] is fine, a[1].b[+] is fine. just a[+].b[+] (and possible variations) may be too flexible and hard to debug when something goes wrong.</p>



<a name="208251435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208251435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208251435">(Aug 27 2020 at 17:45)</a>:</h4>
<p>No, that wouldn’t happen, I assume. Only one index gets increments on each line.</p>



<a name="208251565"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208251565" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208251565">(Aug 27 2020 at 17:46)</a>:</h4>
<p>I'm looking at the ppt, page 9</p>



<a name="208251571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208251571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208251571">(Aug 27 2020 at 17:46)</a>:</h4>
<p>Agree. a[].b[+] is ok.</p>



<a name="208251916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208251916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208251916">(Aug 27 2020 at 17:49)</a>:</h4>
<p>Ah, I see. No, we shouldn’t have that, it’s confusing.</p>



<a name="208252142"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208252142" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208252142">(Aug 27 2020 at 17:51)</a>:</h4>
<p>I’d rather see an empty array mean 0 or last value, and + be increment (along with reset sub counters).</p>



<a name="208252199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208252199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208252199">(Aug 27 2020 at 17:51)</a>:</h4>
<p>Thanks, that is my feedback indeed (that it is confusing).</p>



<a name="208252362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208252362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208252362">(Aug 27 2020 at 17:53)</a>:</h4>
<p>But it is a separate issue from ‘with’.</p>



<a name="208252374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208252374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208252374">(Aug 27 2020 at 17:53)</a>:</h4>
<p>yes.</p>



<a name="208255745"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208255745" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208255745">(Aug 27 2020 at 18:17)</a>:</h4>
<p>I think that <code>[+]</code> means <code>[0]</code> if the array is empty because you are essentially adding an element to the array.  You had a zero-length array before, so using <code>[ ]</code> or <code>[=]</code> to access the <em>current</em> element is meaningless when there are zero elements.  You need the <code>[+]</code> just to create that first element at index <code>0</code>.</p>



<a name="208255989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208255989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208255989">(Aug 27 2020 at 18:19)</a>:</h4>
<p>It is also what allows a <code>RuleSet</code> to be used to define arbitrary elements on an array via <code>insert</code>s (see the PPT I linked above if you're not familiar w/ this use).  The <code>[+]</code> has to work equally as well at initializing an array and referencing the first element as it does at appending a new element to an existing array.</p>



<a name="208256107"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208256107" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208256107">(Aug 27 2020 at 18:20)</a>:</h4>
<p>hmm, right.</p>



<a name="208256189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208256189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208256189">(Aug 27 2020 at 18:20)</a>:</h4>
<p>Also note that you can still use numeric indexers.  We don't need a "reset" indexer; we already have one: <code>[0]</code>.</p>



<a name="208256305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208256305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208256305">(Aug 27 2020 at 18:21)</a>:</h4>
<p>So aside from the RuleSet use case I noted above, if authors are more comfortable explicitly using <code>[0]</code> on the first element of an array and then using <code>[+]</code> for subsequent elements, that's totally OK.</p>



<a name="208256455"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208256455" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208256455">(Aug 27 2020 at 18:22)</a>:</h4>
<p>A line with multiple + on it needs to be interpreted as "increment the first counter, reset the others"?  it doesn't look intuitive, but I can understand the logic.</p>



<a name="208256645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208256645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208256645">(Aug 27 2020 at 18:24)</a>:</h4>
<p>I understand <span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span>'s concern that managing subcontext of each nested array can be confusing -- but I'm not sure a great way around that aside from using <code>[0]</code> explicitly if you want to and/or using his <code>with</code> idea.  But even with <code>with</code>, I think we'd want to <em>allow</em> the more compact syntax.</p>



<a name="208257075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208257075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208257075">(Aug 27 2020 at 18:28)</a>:</h4>
<blockquote>
<p>A line with multiple + on it needs to be interpreted as "increment the first counter, reset the others"?</p>
</blockquote>
<p>The way I think of <code>a[+].b[+].c[+]</code> is that once you increment <code>a</code> to <em>n</em>, then <code>a[n].b</code> is empty -- so the <code>b[+]</code> adds that first <code>a[n].b</code> element.  And once you have a new <code>a[n].b[0]</code> element, its <code>c</code> array is also empty, so you need the <code>c[+]</code> to add and reference its first element.  That's probably a terrible way to describe it, but it's actually quite consistent if you think about it.</p>



<a name="208257087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208257087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208257087">(Aug 27 2020 at 18:28)</a>:</h4>
<p>Actually, rereading the above --  I don't think RuleSets depend on the + notation. I think my suggestion of [] meaning zero or last would address the issue equally.</p>



<a name="208257148"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208257148" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208257148">(Aug 27 2020 at 18:29)</a>:</h4>
<p>Right, I  agree that it makes a certain sense, but isn't intuitive.</p>



<a name="208257538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208257538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208257538">(Aug 27 2020 at 18:32)</a>:</h4>
<div class="codehilite"><pre><span></span><code>RuleSet: Foo
* bar[ ] = &quot;hello&quot;

Instance: Something
InstanceOf: SomeResource
* insert Foo
* insert Foo
* insert Foo
</code></pre></div>


<p>If <code>[ ]</code> means <code>0</code> or last, then you keep overwriting <code>bar[0]</code> -- because the first time it sets <code>bar[0]</code>, then the next two times the <em>last</em> is still <code>bar[0]</code> (since there is nothing to increment it).</p>



<a name="208257778"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208257778" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208257778">(Aug 27 2020 at 18:34)</a>:</h4>
<p>Ah, I hadn’t considered that use.</p>



<a name="208257846"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208257846" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208257846">(Aug 27 2020 at 18:34)</a>:</h4>
<blockquote>
<p>Right, I agree that it makes a certain sense, but isn't intuitive.</p>
</blockquote>
<p>OK.  So then maybe best practice is: <code>a[+].b[0].c[0]</code>.</p>



<a name="208257960"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208257960" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208257960">(Aug 27 2020 at 18:35)</a>:</h4>
<p>Best practise, but not required, otherwise it messes with your use case.</p>



<a name="208258194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208258194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208258194">(Aug 27 2020 at 18:37)</a>:</h4>
<p>Or maybe we could make a rule that once you declare a <code>[+]</code> in a path, you can't declare another one in the same path.  We'd have to think about if that excludes any meaningful use cases.  It might be fine -- and if so, then we need to think about if it is a restriction that makes things more user-friendly or less user-friendly.  It sounds like you and <span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span> would consider it more user-friendly.</p>



<a name="208258840"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208258840" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208258840">(Aug 27 2020 at 18:43)</a>:</h4>
<p>Hmm gets interesting when you get to ‘insert RuleSet(a[+])’.</p>



<a name="208260991"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208260991" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208260991">(Aug 27 2020 at 18:59)</a>:</h4>
<p>Ha.  Yeah.  I guess so.  But given that parameters are currently defined as doing just straight up string substitution, that would be kind of weird.  But I guess you could write your ruleset that way.</p>



<a name="208264521"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208264521" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208264521">(Aug 27 2020 at 19:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code>RuleSet foo(x):
* $x$[=].value1 = &quot;bar&quot;
* $x$[=].value2 = &quot;baz&quot;

Profile: ...

* insert  foo(a[+])
* a[=].value3 = &quot;first value&quot;
*  insert foo(a[+])
* a[=].value3 = &quot;second value&quot;
</code></pre></div>


<p>Doesn't look all that weird to me.</p>



<a name="208264645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208264645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208264645">(Aug 27 2020 at 19:28)</a>:</h4>
<p>No, just weirder.  It's all relative I guess. ;-)</p>



<a name="208265204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208265204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208265204">(Aug 27 2020 at 19:33)</a>:</h4>
<p>That ends up being this...</p>
<p>a[+][=].value1 = "bar"<br>
a[+][=].value2 = "baz"<br>
a[=].value3 = "first value"<br>
a[+][=].value1 = "bar"<br>
a[+][=].value2 = "baz"<br>
a[=].value3 = "second value"</p>



<a name="208266516"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208266516" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208266516">(Aug 27 2020 at 19:45)</a>:</h4>
<p>Ah, oops, try without the “[=]” inside the ruleset.</p>



<a name="208267028"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208267028" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208267028">(Aug 27 2020 at 19:50)</a>:</h4>
<p>i liken RuleSets to C macros - there are going to be some best practices that even come directly over from the world of macros.  One of the rules that I remember is be careful of having operators in your macro parameters.  Even without the '[=]', that still might not be doing what you think it's doing:</p>
<p>a[+].value1 = "bar"<br>
a[+].value2 = "baz"<br>
a[=].value3 = "first value"<br>
a[+].value1 = "bar"<br>
a[+].value2 = "baz"<br>
a[=].value3 = "second value"</p>
<p>This would end up with (I used XML notation to show that there are four a's in the array):<br>
&lt;a&gt;&lt;value1 value="bar"/&gt;&lt;/a&gt;<br>
&lt;a&gt;&lt;value2 value="baz"/&gt;&lt;value3 value="first value"/&gt;&lt;/a&gt;<br>
&lt;a&gt;&lt;value1 value="bar"/&gt;&lt;/a&gt;<br>
&lt;a&gt;&lt;value2 value="baz"/&gt;&lt;value3 value="second value"/&gt;&lt;/a&gt;</p>



<a name="208271777"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208271777" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208271777">(Aug 27 2020 at 20:28)</a>:</h4>
<p>Good point, <span class="user-mention" data-user-id="192166">@Jean Duteau</span>.  I hadn't caught that, but you're right (of course)!</p>



<a name="208272309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/208272309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#208272309">(Aug 27 2020 at 20:33)</a>:</h4>
<p>btw, my point is not that we should add in checks to detect this.  I think that, like C macros, we are providing a powerful mechanism for IG FSH authors, but with "great power comes great responsibility".</p>



<a name="209347978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/209347978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#209347978">(Sep 08 2020 at 05:51)</a>:</h4>
<p>Having written about 5 pages of IG text illustrating a Measure definition using <span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span>'s  <strong>with </strong>syntax.  I find myself much in favor of it over the [+][=] syntax.  The reason for this is that it creates much more human readable content with less dense code, and shorter lines.  It has a hugely meaningful impact on my productivity to a) not have to read all the repetitive gunge, and b) to NOT have to type it.</p>
<p>I'll post a link later today showing how it looks.</p>



<a name="209381929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/209381929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#209381929">(Sep 08 2020 at 12:59)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="191387">@Keith Boone</span>.  I imagine you still need to use <em>some</em> <code>[+]</code>/<code>[=]</code> syntax, right?  I mean, the <code>with</code> construct doesn't fix the issue regarding needing to add or remove something in the middle of an existing long array...  But it does make you not need to repeat <code>[=]</code> so many times (or maybe allows you to avoid <code>[=]</code> altogether).</p>



<a name="209411328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/209411328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#209411328">(Sep 08 2020 at 16:30)</a>:</h4>
<p>Yeah, somewhat, but not often.  If I had to prioritize the two, <strong>with</strong> is more important than [+][=].  I think [=] is still useful b/c copy/paste is faster than setting up a with for a two-three line case.</p>



<a name="209538253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/209538253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kramer <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#209538253">(Sep 09 2020 at 16:58)</a>:</h4>
<p><span class="user-mention" data-user-id="191387">@Keith Boone</span> when we get to macros, the "with" doesn't have as much power as [+] and [=].  If you consider the CapabilityStatement example in the PPT that Chris mentions above, the ability to combine soft indexing with macros is when serious magic happens. I don't <em>think</em> you can get the same power with "with" but I'm willing to be proven wrong.</p>



<a name="217939360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/217939360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#217939360">(Nov 25 2020 at 21:05)</a>:</h4>
<p>I don't know what is the  status for this, but I'd suggest: </p>
<ol>
<li>using element[0] and element[+] makes sense,  I am not so sure we need element[=] or if that can be omitted as default.</li>
<li>for the first time a repeating element is used, element[+] is equivalent to element</li>
<li>the <code>with</code> syntax or a syntax like </li>
</ol>
<div class="codehilite"><pre><span></span><code>* (with) identifier :
** system  =
** value =
</code></pre></div>
<p>woud be most interesting for example when handling logical models - it allows us to write exactly what we mean (i.e. indented elements). <br>
Combining both we'd have a powerful way to add a lot of content just by copy-pasting and only changing what is needed:</p>
<div class="codehilite"><pre><span></span><code>* with identifier[+] :
** system = http://snomed.ct/info
** value = 12345

* with identifier[+] :
** system = http://snomed.ct/info
** value = 12345

* with identifier[+] :
** system = http://snomed.ct/info
** value = 23456

* with identifier[+] :
** system = http://snomed.ct/info
** value = 34567
</code></pre></div>



<a name="217939522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/217939522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#217939522">(Nov 25 2020 at 21:07)</a>:</h4>
<p>basically the <code>with</code> is an inline macro declaration but cleaner (IMO).</p>



<a name="217939695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/217939695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#217939695">(Nov 25 2020 at 21:08)</a>:</h4>
<p>the example above could perhaps be made leaner, i'm not sure. I don't see what could make my copy-paste easier than this nested/indented syntax</p>



<a name="217940123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/217940123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#217940123">(Nov 25 2020 at 21:13)</a>:</h4>
<p><span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span> (and anyone else playing along), check out the "Wicked FHIR" presentation over in the <a href="https://fshschool.org/downloads/">FSH School Downloads</a> to see the latest on the soft-indexing, parameterized rulesets, and "with" proposals.</p>



<a name="217947159"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Feedback%20Needed%3A%20Array%20Syntax/near/217947159" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax.html#217947159">(Nov 25 2020 at 22:34)</a>:</h4>
<p>I didn't realize you still had all three of auto-indexing, parameterized rulesets and "with" still under consideration. I thought you had decided that parameterized rulesets eliminated the need for at least one of the others.</p>
<p>One thing that may potentially be useful for parameterized rulesets is the ability to specify (part of) the item in the parameters. Consider a Questionnaire where you can have item[] or item[].item[] or item[].item[].item[]. It would be helpful to be able to say:</p>
<div class="codehilite" data-code-language="fsh"><pre><span></span><code>Ruleset ChooseFromValueSet(myItem, myValueSet)
* {myItem}.type = #choice
* {myItem}.answerValueSet = Canonical({myValueSet})
</code></pre></div>
<p>We should be explicit about how soft indexing works in this case. (Is the index evaluated only once on invocation, or does it repeat every time?) </p>
<p>Your capability statement example in the presentation increments the index in the first ruleset, and all other rulesets just reuse that index. Is there a need to be able to increment the index without using it?</p>
<div class="codehilite"><pre><span></span><code>RuleSet Support Resource(resource, expectation)
* rest.resource[=].type = {resource} ...

...
rest.resource[+]
SupportResource(MyResource, MyExpectation)
</code></pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
