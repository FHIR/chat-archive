---
layout: page
title: "FHIR Chat  · slice cardinalities · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html">slice cardinalities</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="198087301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198087301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198087301">(May 19 2020 at 15:57)</a>:</h4>
<p>I'm trying to create slices on MessageHeader.focus to point to a couple of profiles in my IG and I've got the .fsh file looking like this (which I think is correct):</p>
<ul>
<li>focus ^slicing.discriminator.type = #pattern</li>
<li>focus ^slicing.discriminator.path = "reference"</li>
<li>focus ^slicing.rules = #open</li>
<li>focus ^slicing.ordered = false</li>
<li>focus ^slicing.description = "Focus Resource types"</li>
<li>focus contains BDRPatient 1..1</li>
<li>focus[BDRPatient] only Reference(BDRPatient)</li>
<li>focus contains BDRReportableDiagnosis 1..*</li>
<li>focus[BDRReportableDiagnosis] only Reference(BDRReportableDiagnosis)</li>
</ul>
<p>However, the IG ends up looking like this, where the overall cardinality of .focus is correct (2..*) but the cardinality of second slice is wrong:<br>
<a href="/user_uploads/10155/DEJ7A-_wZa7nimyJVvNwGJxN/slice.jpg">slice.jpg</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/DEJ7A-_wZa7nimyJVvNwGJxN/slice.jpg" title="slice.jpg"><img src="/user_uploads/10155/DEJ7A-_wZa7nimyJVvNwGJxN/slice.jpg"></a></div>



<a name="198087393"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198087393" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198087393">(May 19 2020 at 15:57)</a>:</h4>
<p>Looking at the StructureDefinition, it seems to be missing the cardinality on the second slice<br>
      {<br>
        "id": "MessageHeader.focus",<br>
        "path": "MessageHeader.focus",<br>
        "slicing": {<br>
          "discriminator": [<br>
            {<br>
              "type": "pattern",<br>
              "path": "reference"<br>
            }<br>
          ],<br>
          "rules": "open",<br>
          "ordered": false,<br>
          "description": "Focus Resource types"<br>
        },<br>
        "min": 2<br>
      },<br>
      {<br>
        "id": "MessageHeader.focus:BDRPatient",<br>
        "path": "MessageHeader.focus",<br>
        "sliceName": "BDRPatient",<br>
        "min": 1,<br>
        "max": "1",<br>
        "type": [<br>
          {<br>
            "code": "Reference",<br>
            "targetProfile": [<br>
              "<a href="http://hl7.org/fhir/us/birthdefectreporting/StructureDefinition/bdr-patient">http://hl7.org/fhir/us/birthdefectreporting/StructureDefinition/bdr-patient</a>"<br>
            ]<br>
          }<br>
       ]<br>
      },<br>
      {<br>
        "id": "MessageHeader.focus:BDRReportableDiagnosis",<br>
        "path": "MessageHeader.focus",<br>
        "sliceName": "BDRReportableDiagnosis",<br>
        "type": [<br>
          {<br>
            "code": "Reference",<br>
            "targetProfile": [<br>
              "<a href="http://hl7.org/fhir/us/birthdefectreporting/StructureDefinition/bdr-reportablediagnosis">http://hl7.org/fhir/us/birthdefectreporting/StructureDefinition/bdr-reportablediagnosis</a>"<br>
            ]<br>
          }<br>
        ]<br>
      }<br>
    ]<br>
  }<br>
}</p>



<a name="198087552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198087552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198087552">(May 19 2020 at 15:58)</a>:</h4>
<p>Have I messed up the .fsh file or is there maybe a problem in converting it to a StructureDefinition?</p>



<a name="198088215"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198088215" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198088215">(May 19 2020 at 16:02)</a>:</h4>
<p>Orthogonal from the FSH question: Normally, the focus would just point to the Condition - the Patient would hang off the Condition and not be a focus.  What is your event?</p>



<a name="198088555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198088555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198088555">(May 19 2020 at 16:05)</a>:</h4>
<p>The event is submission of a birth defect report to a jurisdictional program. There may be multiple reportable birth defect diagnoses in a message bundle but only a single patient. If the patient shouldn't be a focus, I can remove it. I just always think of the patient as central as well in a case like this.</p>



<a name="198090796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198090796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198090796">(May 19 2020 at 16:22)</a>:</h4>
<p>In an ADT message for a patient admit, the only focus would be the Encounter - even though you're probably sending 100+ resources.  Everything else is just linked somehow to that encounter (possibly through other resources).  Being 'important' has nothing to do with being a focus.  It's "is this the focus of the event code".</p>



<a name="198093463"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198093463" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198093463">(May 19 2020 at 16:41)</a>:</h4>
<p><span class="user-mention" data-user-id="192758">@Craig Newman</span> - I don't know why the cardinality is getting dropped on the 2nd slice. That looks like a bug in the SUSHI generation of the profile to me.  We'll have to try to reproduce this on our end.</p>
<p>I'll add my own orthogonal comment as well -- I'm not sure that the discriminator is correct.  I think it may be more appropriate for the discriminator type to be <code>type</code> and the path to be <code>$this.resolve()</code>.  See: <a href="http://hl7.org/fhir/R4/profiling.html#discriminator">http://hl7.org/fhir/R4/profiling.html#discriminator</a></p>



<a name="198093637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198093637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198093637">(May 19 2020 at 16:42)</a>:</h4>
<p>When using the <code>contains</code>, the more standard usage is to do:</p>
<div class="codehilite"><pre><span></span><code>* focus contains BDRPatient 1..1 and BDRReportableDiagnosis 1..*
</code></pre></div>


<p>instead of:</p>
<div class="codehilite"><pre><span></span><code>* focus contains BDRPatient 1..1
* focus contains BDRReportableDiagnosis 1..*
</code></pre></div>


<p>However, I don't believe we have explicitly disallowed the second usage, so that should work correctly. So this is a bug, but for now using the first syntax shown will give you a workaround to that bug.</p>



<a name="198094062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198094062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198094062">(May 19 2020 at 16:45)</a>:</h4>
<p>Thanks for the feedback. Given Lloyd's advice to limit .focus to the Condition, my original question is probably moot. I think now, rather than slicing, I can just restrict .focus to the reportable diagnosis profile Condition. Does this seem right?</p>
<ul>
<li>focus only Reference(&lt;Condition Profile&gt;)</li>
</ul>



<a name="198094219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198094219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198094219">(May 19 2020 at 16:46)</a>:</h4>
<p>Yep -- that would work!  I'm glad we had this conversation though -- you uncovered a bug for us!  Thanks!</p>



<a name="198094359"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198094359" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198094359">(May 19 2020 at 16:47)</a>:</h4>
<p>And just for completeness, that bug is logged here: <a href="https://github.com/FHIR/sushi/issues/450">https://github.com/FHIR/sushi/issues/450</a>.</p>



<a name="198094520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198094520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198094520">(May 19 2020 at 16:48)</a>:</h4>
<p>I like to break things. I've been the idiot in many idiot-proofing activities. <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span><br>
Thanks for the quick feedback</p>



<a name="198115445"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198115445" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198115445">(May 19 2020 at 19:32)</a>:</h4>
<blockquote>
<p>I've been the idiot in many idiot-proofing activities.</p>
</blockquote>
<p>I can empathise with that!</p>



<a name="198382694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198382694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gaurav Sharma <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198382694">(May 21 2020 at 22:00)</a>:</h4>
<p>Profile:        PatientDataBundle<br>
Parent:         Bundle<br>
Id:             PatientDataBundle</p>
<p>I am trying to create a slice based on fullUrl for which I cannot fix the value or pattern. When trying validate the structure definition. I am getting error as below.<br>
SingleValidationMessage[col=452,row=1,locationString=Parameters.parameter[0].resource.entry[0],message=Could not match discriminator ([fullUrl]) for slice Bundle.entry:Organization in profile <a href="http://labcorp.com/fhir/lvs-er/StructureDefinition/PatientDataBundle">http://labcorp.com/fhir/lvs-er/StructureDefinition/PatientDataBundle</a> - the discriminator [fullUrl] does not have fixed value, binding or existence assertions,severity=error]</p>
<p>Title:          "PatientDataBundle"<br>
Description:    "Bundle for Patient Data that is a parameter within Input"</p>
<ul>
<li>type = #collection</li>
<li>entry ^slicing.discriminator.type = #value</li>
<li>entry ^slicing.discriminator.path = "fullUrl"</li>
<li>entry ^slicing.rules = #open</li>
<li>entry ^slicing.ordered = false   // can be omitted, since false is the default</li>
<li>entry ^slicing.description = "Slice based on the entry.fullUrl pattern"  // optional</li>
<li>entry contains<br>
    Organization 1..* and<br>
    Practitioner 1..* and<br>
    Patient 1..1 and<br>
    ServiceRequest 1..1 and<br>
    Encounter 1..* and<br>
    DiagnosticReport 1..* and<br>
    Observation 1..*</li>
</ul>



<a name="198389837"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slice%20cardinalities/near/198389837" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gaurav Sharma <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slice.20cardinalities.html#198389837">(May 21 2020 at 23:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="304287">Gaurav Sharma</span> <a href="#narrow/stream/215610-shorthand/topic/slice.20cardinalities/near/198382694">said</a>:</p>
<blockquote>
<p>Profile:        PatientDataBundle<br>
Parent:         Bundle<br>
Id:             PatientDataBundle</p>
<p>I am trying to create a slice based on fullUrl for which I cannot fix the value or pattern. When trying validate the structure definition. I am getting error as below.<br>
SingleValidationMessage[col=452,row=1,locationString=Parameters.parameter[0].resource.entry[0],message=Could not match discriminator ([fullUrl]) for slice Bundle.entry:Organization in profile <a href="http://labcorp.com/fhir/lvs-er/StructureDefinition/PatientDataBundle">http://labcorp.com/fhir/lvs-er/StructureDefinition/PatientDataBundle</a> - the discriminator [fullUrl] does not have fixed value, binding or existence assertions,severity=error]</p>
<p>Title:          "PatientDataBundle"<br>
Description:    "Bundle for Patient Data that is a parameter within Input"</p>
<ul>
<li>type = #collection</li>
<li>entry ^slicing.discriminator.type = #value</li>
<li>entry ^slicing.discriminator.path = "fullUrl"</li>
<li>entry ^slicing.rules = #open</li>
<li>entry ^slicing.ordered = false   // can be omitted, since false is the default</li>
<li>entry ^slicing.description = "Slice based on the entry.fullUrl pattern"  // optional</li>
<li>entry contains<br>
    Organization 1..* and<br>
    Practitioner 1..* and<br>
    Patient 1..1 and<br>
    ServiceRequest 1..1 and<br>
    Encounter 1..* and<br>
    DiagnosticReport 1..* and<br>
    Observation 1..*</li>
</ul>
</blockquote>
<p>My bad was trying to do wrong slicing. Changing to following worked fine.</p>
<p>Profile:        PatientDataBundle<br>
Parent:         Bundle<br>
Id:             PatientDataBundle<br>
Title:          "PatientDataBundle"<br>
Description:    "Bundle for Patient Data that is a parameter within Input"</p>
<ul>
<li>type = #collection</li>
<li>entry ^slicing.discriminator.type = #type</li>
<li>entry ^slicing.discriminator.path = "resource"</li>
<li>entry ^slicing.rules = #open</li>
<li>entry ^slicing.ordered = false   // can be omitted, since false is the default</li>
<li>entry ^slicing.description = "Slice based on the entry.fullUrl pattern"  // optional</li>
<li>
<p>entry contains<br>
    Organization 1..* and<br>
    Practitioner 1..* and<br>
    Patient 1..1 and<br>
    ServiceRequest 1..1 and<br>
    Encounter 1..* and<br>
    DiagnosticReport 1..* and<br>
    Observation 1..*</p>
</li>
<li>
<p>entry[Organization].resource only Organization</p>
</li>
<li>entry[Practitioner].resource only Practitioner</li>
<li>entry[Patient].resource only Patient</li>
<li>entry[ServiceRequest].resource only ServiceRequest</li>
<li>entry[Encounter].resource only Encounter</li>
<li>entry[DiagnosticReport].resource only DiagnosticReport</li>
<li>entry[Observation].resource only Observation</li>
</ul>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
