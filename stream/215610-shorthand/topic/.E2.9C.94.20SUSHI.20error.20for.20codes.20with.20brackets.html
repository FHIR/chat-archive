---
layout: page
title: "FHIR Chat  · ✔ SUSHI error for codes with brackets · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20SUSHI.20error.20for.20codes.20with.20brackets.html">✔ SUSHI error for codes with brackets</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="253209287"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20SUSHI%20error%20for%20codes%20with%20brackets/near/253209287" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20SUSHI.20error.20for.20codes.20with.20brackets.html#253209287">(Sep 14 2021 at 07:30)</a>:</h4>
<p>I seem to have found a parametrized rules bug in SUSHI 2.0.0, but wanted to check that I'm not hallucinating before creating a GitHub issue. I notice this while writing a profile and using the UCUM code <code>{#}/(24.h)</code>. When I passed this as a parameter to a parametrized rule, it created errors in some cases - it seems that the parser mistakes the final ")" in the code string for the closing bracket in the rule parameter list. As far as I can tell, it happens only when (1) the parametrized rule has multiple arguments AND (2) the unit code string contains (round) brackets.</p>
<p>Below is an example showing this behavior:</p>
<div class="codehilite"><pre><span></span><code>Alias: $ucum = http://unitsofmeasure.org

// One parameter only
RuleSet: AddUnitsCode(unitCode)
* valueQuantity.code = #{unitCode}

// Two parameters
RuleSet: AddUnits(system, unitCode)
* valueQuantity.system = {system}
* valueQuantity.code = #{unitCode}

// This works - unit code without &quot;()&quot;
Profile: Test1
Parent: Observation
Id: test1
* insert AddUnits($ucum, {#}/min)

// This works - unit code with &quot;()&quot;, but only a single rule set parameter
Profile: Test2
Parent: Observation
Id: test2
* insert AddUnitsCode({#}/(24.h))

// This does NOT work - unit code with &quot;()&quot; and multiple rule set parameters
// SUSHI throws an error and in the output, the final &quot;)&quot; is missing from the unit code
Profile: Test3
Parent: Observation
Id: test3
* insert AddUnits($ucum, {#}/(24.h))
</code></pre></div>



<a name="253210492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20SUSHI%20error%20for%20codes%20with%20brackets/near/253210492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20SUSHI.20error.20for.20codes.20with.20brackets.html#253210492">(Sep 14 2021 at 07:40)</a>:</h4>
<p>did you escape your <code>)</code> ?</p>



<a name="253210609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20SUSHI%20error%20for%20codes%20with%20brackets/near/253210609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20SUSHI.20error.20for.20codes.20with.20brackets.html#253210609">(Sep 14 2021 at 07:41)</a>:</h4>
<p>inside a insert, you'd want to escape: <code>)</code> --&gt; <code>\)</code> - I don't see it here</p>



<a name="253212565"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20SUSHI%20error%20for%20codes%20with%20brackets/near/253212565" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20SUSHI.20error.20for.20codes.20with.20brackets.html#253212565">(Sep 14 2021 at 08:00)</a>:</h4>
<p>Ah, thanks <span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span>, that does indeed do the trick! Now that you mention, I also see this mentioned prominently in the <a href="http://build.fhir.org/ig/HL7/fhir-shorthand/reference.html#inserting-parameterized-rule-sets">corresponding FSH documentation</a>... <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span>. My only excuse is that the fact that it worked for a single parameter led me to believe it smt. more complicated <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="253212570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20SUSHI%20error%20for%20codes%20with%20brackets/near/253212570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20SUSHI.20error.20for.20codes.20with.20brackets.html#253212570">(Sep 14 2021 at 08:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="194703">Morten Ernebjerg</span> has marked this topic as resolved.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
