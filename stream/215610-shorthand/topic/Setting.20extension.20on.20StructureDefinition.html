---
layout: page
title: "FHIR Chat  · Setting extension on StructureDefinition · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html">Setting extension on StructureDefinition</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="196711733"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/196711733" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#196711733">(May 06 2020 at 23:45)</a>:</h4>
<p>We're trying to set the value of an extension on the underlying StructureDefinition for a profile we're defining by using the "escape syntax" (<code>^</code>):</p>
<div class="codehilite"><pre><span></span><code>Profile: NewOnsetOfT2DMDataElementCPG3
Parent: Observation
* ^extension[inferenceExpression].valueExpression.language = #text/cql
* ^extension[inferenceExpression].valueExpression.expression =
  &quot;exists([Condition in \&quot;T2DMConditionVS\&quot;] c where c.onset is within last 2 months)&quot;
* code = ExampleCdsCS#t2dm
</code></pre></div>


<p>Which builds fine, but it seems to be treating the <code>.valueExpression.language</code> part as constraints, rather than instance assignments...</p>
<div class="codehilite"><pre><span></span><code>&quot;extension&quot;: [
    {
      &quot;_sliceName&quot;: &quot;inferenceExpression&quot;,
      &quot;valueExpression&quot;: {
        &quot;language&quot;: {
          &quot;fixedValue&quot;: &quot;text/cql&quot;,
          &quot;_primitive&quot;: true
        },
        &quot;expression&quot;: {
          &quot;fixedValue&quot;: &quot;exists([Condition in \&quot;T2DMConditionVS\&quot;] c where c.onset is within last 2 months)&quot;,
          &quot;_primitive&quot;: true
        }
      }
    }
  ],
</code></pre></div>


<p>Am I missing something about how to set the value of an extension on the underlying StructureDefinition?</p>



<a name="196713166"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/196713166" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#196713166">(May 07 2020 at 00:04)</a>:</h4>
<p>Hmm, this looks broken.  I had a couple of ideas that turned out either not to work or were just invalid.</p>



<a name="196727312"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/196727312" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#196727312">(May 07 2020 at 04:59)</a>:</h4>
<p>I agree that SUSHI seems confused here.  I'd only expect this to work if SUSHI could resolve <code>inferenceExpression</code> to an extension's canonical URL.  Still, I tried it out and even if it does resolve to a valid URL, it's not working right.  This sort of thing works with <code>Instance:</code>, but I guess is not working with <code>^</code> in a profile (even though that is really just operating on the instance of the SD).  We'll have to look into it.</p>
<p>That said, there is another syntax that works.  If you just reference the extension by a numbered index and set its values directly, it is happy.  For example:</p>
<div class="codehilite"><pre><span></span><code>Profile: NewOnsetOfT2DMDataElementCPG3
Parent: Observation
* ^extension[0].url = &quot;http://example.org/url/for/inferenceExpression&quot;
* ^extension[0].valueExpression.language = #text/cql
* ^extension[0].valueExpression.expression =
  &quot;exists([Condition in \&quot;T2DMConditionVS\&quot;] c where c.onset is within last 2 months)&quot;
* code = ExampleCdsCS#t2dm
</code></pre></div>


<p>I don't think you'll get any validation that way though (at least not in SUSHI).</p>



<a name="196762388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/196762388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#196762388">(May 07 2020 at 12:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span>  should we log this as a GH issue?</p>



<a name="196762648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/196762648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#196762648">(May 07 2020 at 12:29)</a>:</h4>
<p>Yes, please -- go ahead!  It was a little too late and I was a little too tired to log it last night!</p>



<a name="196912472"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/196912472" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#196912472">(May 08 2020 at 15:47)</a>:</h4>
<p>Another issue we're seeing with setting values of extensions, not sure if it's related to this or not, but given this example:</p>
<div class="codehilite"><pre><span></span><code>    Instance: ExampleQuestionnaireResponse
    InstanceOf: SDCQuestionnaireResponse
    * status = #completed
    * questionnaire = &quot;Questionnaire/GeneratedQuestionnaire&quot;
    * questionnaire.extension[questionnaireDisplay].valueString = &quot;Generated Questionnaire&quot;
    * subject = Reference(&quot;Patient/123&quot;)
    * authored = &quot;2020-01-01&quot;
    * item[0].linkId = &quot;1&quot;
    * item[0].answer.valueBoolean = true
</code></pre></div>


<p>We're getting this error from SUSHI:</p>
<div class="codehilite"><pre><span></span><code>    error Element QuestionnaireResponse.questionnaire.extension:questionnaireDisplay has minimum cardinality 1 but occurs 0 time(s).
</code></pre></div>


<p>Which also looks suspiciously like this issue: <a href="https://github.com/FHIR/sushi/issues/393" title="https://github.com/FHIR/sushi/issues/393">https://github.com/FHIR/sushi/issues/393</a></p>



<a name="196914963"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/196914963" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#196914963">(May 08 2020 at 16:05)</a>:</h4>
<p>Agreed, that looks like it may be the same issue...  What is the urgency on this and the previous issue you guys reported?  We're pretty busy heading up to Connectathon, so didn't have these bug-fixes planned yet, but if this is an urgent matter that would be good to know so we can try to accommodate as best we can.</p>



<a name="196927537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/196927537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#196927537">(May 08 2020 at 17:45)</a>:</h4>
<p>Not urgent, since SUSHI does actually generate the JSON we want, it just gives this error as part of the build.</p>



<a name="222774797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/222774797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#222774797">(Jan 14 2021 at 19:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191359">Bryn Rhodes</span> <a href="#narrow/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition/near/196912472">said</a>:</p>
<blockquote>
<p>Another issue we're seeing with setting values of extensions, not sure if it's related to this or not, but given this example:</p>
<div class="codehilite"><pre><span></span><code>    Instance: ExampleQuestionnaireResponse
    InstanceOf: SDCQuestionnaireResponse
    * status = #completed
    * questionnaire = &quot;Questionnaire/GeneratedQuestionnaire&quot;
    * questionnaire.extension[questionnaireDisplay].valueString = &quot;Generated Questionnaire&quot;
    * subject = Reference(&quot;Patient/123&quot;)
    * authored = &quot;2020-01-01&quot;
    * item[0].linkId = &quot;1&quot;
    * item[0].answer.valueBoolean = true
</code></pre></div>
<p><span class="user-mention silent" data-user-id="340930">Fred Marsh</span><br>
We're getting this error from SUSHI:</p>
<div class="codehilite"><pre><span></span><code>    error Element QuestionnaireResponse.questionnaire.extension:questionnaireDisplay has minimum cardinality 1 but occurs 0 time(s).
</code></pre></div>
<p>Which also looks suspiciously like this issue: <a href="https://github.com/FHIR/sushi/issues/393">https://github.com/FHIR/sushi/issues/393</a></p>
</blockquote>
<p>Having a similar issue to this one. <a href="/user_uploads/10155/3orWZc0pBZYy8uItNgK0HBS5/eCCDiagnosticReport.fsh">eCCDiagnosticReport.fsh</a> </p>
<div class="codehilite"><pre><span></span><code>Instance: eCCDiagnosticReport
InstanceOf: http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-note
Title: &quot;eCC Diagnostic Report&quot;
Description: &quot;Example eCC Diagnostic report using US Core&quot;
Usage: #example
LNC = http://loinc.org
* id = &quot;eCCDiagnosticReport0&quot;
* identifier.use = #usual
* identifier.type = http://terminology.hl7.org/CodeSystem/v2-0203#MR &quot;Medical Record Number&quot;
* identifier.system = &quot;http://hospital.example.org&quot;
* identifier.value = &quot;eCCDiagnosticReport0&quot;
* status = #final
* category = LNC#LP7839-6 &quot;Pathology&quot;
* code = LNC#60568-3 &quot;Pathology Synoptic report&quot;
* subject = Reference(q201)
* effective.effectiveDateTime = &quot;2021-01-14T10:00:00&quot;
* performer = Reference(pathpract1)
* result = Reference(Adrenal.Bx.Res.129_3.002.011.RC1_sdcFDF1.FormInstanceVersionURI.2157)
* result = Reference(Adrenal.Bx.Res.129_3.002.011.RC1_sdcFDF.f96d3fea-62b3-47e9-8443-f199c2f946f0.ver1.49275.100004300)
* result = Reference(Adrenal.Bx.Res.129_3.002.011.RC1_sdcFDF1.FormInstanceVersionURI.43324)
* result = Reference(Adrenal.Bx.Res.129_3.002.011.RC1_sdcFDF1.FormInstanceVersionURI.56271)
</code></pre></div>
<p>All of the required elements in our instance example are giving the same error: </p>
<div class="codehilite"><pre><span></span><code>error Element DiagnosticReport.status has minimum cardinality 1 but occurs 0 time(s).
</code></pre></div>
<p>Has this been addressed? <span class="user-mention" data-user-id="191469">@Chris Moesel</span></p>



<a name="222777214"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/222777214" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#222777214">(Jan 14 2021 at 20:14)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="192545">@Alex Goel</span>.  The issue you're seeing is due to an errant line in the wrong location: <code>LNC = http://loinc.org</code>.  Aliases are their own standalone definitions in FSH, so you can't have them embedded in another FSH definition.  Try removing that line and adding this to the top of your file:</p>
<div class="codehilite"><pre><span></span><code>Alias: LNC = http://loinc.org
</code></pre></div>
<p>I also noticed that in the file you attached, it said <code>* ^status</code> rather than <code>* status</code>.  It looks like you've fixed it in this message, but just to confirm -- in an <code>Instance</code> you do <em>not</em> use the <code>^</code> symbol.</p>



<a name="222780834"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/222780834" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#222780834">(Jan 14 2021 at 20:41)</a>:</h4>
<p>Whoops Thank you :)</p>



<a name="222781476"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Setting%20extension%20on%20StructureDefinition/near/222781476" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Setting.20extension.20on.20StructureDefinition.html#222781476">(Jan 14 2021 at 20:46)</a>:</h4>
<p>And yes, I fixed the ^ in the message, forgot to remove from file</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
