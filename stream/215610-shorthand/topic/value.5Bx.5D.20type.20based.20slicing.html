---
layout: page
title: "FHIR Chat  · value[x] type based slicing · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html">value[x] type based slicing</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="256192304"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/256192304" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#256192304">(Oct 05 2021 at 07:50)</a>:</h4>
<p>i can't figure out how to do type based slicing on a value[x] element: <a href="https://fshschool.org/FSHOnline/#/share/3ixAYHH">https://fshschool.org/FSHOnline/#/share/3ixAYHH</a></p>



<a name="256192323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/256192323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#256192323">(Oct 05 2021 at 07:50)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Profile: Test
Parent: MedicationRequest
* medication[x] ^slicing.discriminator.type = #type
* medication[x] ^slicing.discriminator.path = &quot;$this&quot;
* medication[x] contains test 0..1 MS
* medication[x][test] only Reference
</code></pre></div>



<a name="256192324"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/256192324" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#256192324">(Oct 05 2021 at 07:50)</a>:</h4>
<p>results in an illegal element:    "id": "MedicationRequest.test"</p>



<a name="256192510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/256192510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#256192510">(Oct 05 2021 at 07:52)</a>:</h4>
<p>i started with: <code>* medication[test] only Reference</code>which leads to: error No element found at path medication[test] for OnlyRule in Test, skipping rule</p>



<a name="256231989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/256231989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#256231989">(Oct 05 2021 at 11:54)</a>:</h4>
<p>What are you trying to accomplish?  If you just use a path like <code>medicationReference</code> or <code>medicationCodeableConcept</code>, the type slicing will happen behind the scenes for you.  You might not see it in the differential (due to choice type renaming), but after you run it through the IG Publisher, you'll see that type slicing is, in fact, applied in the snapshot.</p>
<p>All that said, in theory, I would expect the above to work -- but it's possible we haven't run into someone trying to manually slice a <code>[x]</code> path, since it happens automatically for you.  So it looks like there is probably a bug in SUSHI when you do it manually.</p>



<a name="256232409"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/256232409" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#256232409">(Oct 05 2021 at 11:58)</a>:</h4>
<p><a href="https://github.com/FHIR/sushi/issues/927">SUSHI#927</a></p>



<a name="256249447"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/256249447" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#256249447">(Oct 05 2021 at 13:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> thanks will try the implicit slicing approach (tried it before, but failed. Will try harder and update this thread)</p>



<a name="257351021"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/257351021" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michaela Ziegler <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#257351021">(Oct 13 2021 at 11:47)</a>:</h4>
<p>May I have an related problem? Or I would need some help please.</p>
<p>The goal of my Observation profile is to say, you can have a value, either Quantity or CodeableConcept (that worked):<br>
<a href="http://build.fhir.org/ig/ahdis/ch-crl/branches/master/StructureDefinition-ch-crl-observation-msuffixofpt.html">http://build.fhir.org/ig/ahdis/ch-crl/branches/master/StructureDefinition-ch-crl-observation-msuffixofpt.html</a><br>
<a href="https://fshschool.org/FSHOnline/#/share/3iZYJZg">https://fshschool.org/FSHOnline/#/share/3iZYJZg</a></p>
<p>Additionally I tried to specify this (that worked, but just in the profile):<br>
If you have a valueQuantity, you have to have one valueQuantity.value.<br>
If you have a valueCodeableConcept, you have to have one valueCodeableConcept.coding.<br>
<a href="https://fshschool.org/FSHOnline/#/share/3mNLnjQ">https://fshschool.org/FSHOnline/#/share/3mNLnjQ</a></p>
<p>But then the validation of the example doesn't work anymore:<br>
<a href="https://fshschool.org/FSHOnline/#/share/3FG4zZt">https://fshschool.org/FSHOnline/#/share/3FG4zZt</a></p>
<div class="codehilite"><pre><span></span><code>Sushi: error Element Observation.value[x]:valueQuantity.value has minimum cardinality 1 but occurs 0 time(s). (00:14.0880)
Sushi: File: C:\Users\micha\Documents\GitHub\ch-crl\input\fsh\content-until-v0.2.1\instances\m-SuffixOfpT-unspecified.fsh (00:14.0881)
Sushi: Line: 1 - 10                                                              (00:14.0882)
Sushi: error Element Observation.value[x]:valueCodeableConcept.coding has minimum cardinality 1 but occurs 0 time(s). (00:14.0900)
Sushi: File: C:\Users\micha\Documents\GitHub\ch-crl\input\fsh\content-until-v0.2.1\instances\m-SuffixOfpT.fsh (00:14.0902)
Sushi: Line: 1 - 10                                                              (00:14.0903)
</code></pre></div>



<a name="257355183"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/257355183" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#257355183">(Oct 13 2021 at 12:20)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="233842">@Michaela Ziegler</span>.  This is a bug in SUSHI 2.0.1.  If you upgrade SUSHI to 2.1.1, you'll find that the errors go away.  We will be updating FSH Online to use SUSHI 2.1.1 very soon!</p>
<p>A few other notes about your FSH:</p>
<ul>
<li>If you want to say that <code>value[x]</code> can only be a Quantity or CodeableConcept, then you can use this line to say that <code>* value[x] only Quantity or CodeableConcept</code></li>
<li>You don't have to say <code>valueQuantity only Quantity</code> -- if you reference a <code>valueQuantity</code> slice, SUSHI will automatically add the appropriate type constraint for you (since, by definition, <code>valueQuantity</code> is only a Quantity).  The same applies for <code>valueCodeableConcept</code> (or any other specific type slice).</li>
<li>You also don't have to explicitly specify the slicings for type slices.  As soon as you reference a type slice like <code>valueQuantity</code>, SUSHI will automatically apply the standard type-slicing definition for you.  Note that SUSHI applies <code>#open</code> rules, however, so if you really want it <code>#closed</code> you would have to specify that.  But... if you say <code>* value[x] only Quantity or CodeableConcept</code> then I don't think you need <code>#closed</code> rules anyway since you already said why types are allowed.</li>
</ul>



<a name="257357000"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/257357000" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michaela Ziegler <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#257357000">(Oct 13 2021 at 12:33)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> <br>
Thanks a lot, it works!<br>
And thanks for your helpful notes, always something to learn! (It is from an IG where I used goFSH.)</p>



<a name="257357551"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/257357551" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roeland Luykx <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#257357551">(Oct 13 2021 at 12:37)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> <br>
The version 2.1.1 solves also other problems with some SDC extensions! i.e. valueExpression.language has minimum cardinality 1 but occurs 0</p>



<a name="257359382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/257359382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#257359382">(Oct 13 2021 at 12:51)</a>:</h4>
<p><span class="user-mention" data-user-id="233842">@Michaela Ziegler</span> - Oh... GoFSH did that?  OK.  That's good to know.  Sounds like something we should tweak in GoFSH then!</p>



<a name="257557035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/257557035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Janaka Peiris <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#257557035">(Oct 14 2021 at 15:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span>  A suggestion related to "No element found at path [element] for [X]" error message format: </p>
<p>It would have been great if the [X] has a meaningful description. I see <code>CardRule</code>, <code>OnlyRule</code> and <code>CaretValue</code> kind of shortened form words used (guessing can sometimes be risky if we got a wrong intepretation)</p>
<div class="codehilite"><pre><span></span><code>error No element found at path valueRatio for CardRule in HnDomainVitalSignsObservationOxygenSaturation, skipping rule
  File: D:\_dev\Git_Repo\DIPS\FhirObservation.R4\IG\input\fsh\profiles\HnDomainVitalSignsObservationOxygenSaturation.fsh
  Line: 78
error No element found at path valueRatio for OnlyRule in HnDomainVitalSignsObservationOxygenSaturation, skipping rule
  File: D:\_dev\Git_Repo\DIPS\FhirObservation.R4\IG\input\fsh\profiles\HnDomainVitalSignsObservationOxygenSaturation.fsh
  Line: 79
error No element found at path valueRatio for CaretValueRule in HnDomainVitalSignsObservationOxygenSaturation, skipping rule
  File: D:\_dev\Git_Repo\DIPS\FhirObservation.R4\IG\input\fsh\profiles\HnDomainVitalSignsObservationOxygenSaturation.fsh
  Line: 80
</code></pre></div>



<a name="258107123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/258107123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#258107123">(Oct 18 2021 at 21:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> -- we're taking a deeper look at the issue you reported above in order to fix it, but... <span class="user-mention" data-user-id="239822">@Nick Freiter</span> brought up a good point: Is it even valid to use an arbitrary slice name on a type slice for a 0..1 polymorphic element? The spec for <a href="http://hl7.org/fhir/R4/elementdefinition.html#id">ElementDefinition.id</a> says:</p>
<blockquote>
<p>For type choice elements, the id reflects the type slice. e.g. For path = Patient.deceasedBoolean, the id is Patient.deceased[x]:deceasedBoolean</p>
</blockquote>
<p>Does this imply that for your example of <code>medication[x]</code>, the slice for the <code>Reference</code> type <em>must</em> have slice name <code>medicationReference</code> (and thus, slice name <code>test</code> would be invalid anyway)?</p>



<a name="258689939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/258689939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#258689939">(Oct 22 2021 at 10:07)</a>:</h4>
<p>i think you are right. value[x] slicing is a special form of slicing, and the slice name for a type specific slice is fix. So the slice must be named <code>medicationReference</code> and can't be named <code>test</code></p>



<a name="258689940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/value%5Bx%5D%20type%20based%20slicing/near/258689940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/value.5Bx.5D.20type.20based.20slicing.html#258689940">(Oct 22 2021 at 10:07)</a>:</h4>
<p>it would be nice to throw a meaningful error in this case (and maybe point to implicite type slicing, as it is easier/ more elegant)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
