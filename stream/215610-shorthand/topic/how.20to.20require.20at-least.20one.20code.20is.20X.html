---
layout: page
title: "FHIR Chat  · how to require at-least one code is X · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html">how to require at-least one code is X</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="277445429"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277445429" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277445429">(Apr 01 2022 at 16:38)</a>:</h4>
<p>on a CodeableConcept that is 0..*; I want to say in my profile that at-least one of them must be code X, but not disallow other codes. I thought that simple profiling assignment would do that</p>
<blockquote>
<ul>
<li>subtype = mySystem#myCode</li>
</ul>
</blockquote>
<p>This seems to say in my IG rendering of that profile --&gt; "Required Pattern: At least the following"<br>
BUT, this seems to actually forbid any other code</p>



<a name="277445519"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277445519" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277445519">(Apr 01 2022 at 16:39)</a>:</h4>
<p>I could slice, and get the behavior I want</p>
<div class="codehilite"><pre><span></span><code>* subtype ^slicing.discriminator.type = #value
* subtype ^slicing.discriminator.path = &quot;$this&quot;
* subtype ^slicing.rules = #open
* subtype ^slicing.description = &quot;needs to at least be a disclosure event&quot;
* subtype contains disclosure 1..1
* subtype[disclosure] = http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose &quot;Disclose Record Lifecycle Event&quot;
</code></pre></div>
<p>But that seems so much harder</p>



<a name="277468123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277468123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julian Carter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277468123">(Apr 01 2022 at 19:34)</a>:</h4>
<p>Hi @John,</p>
<p>It seems to me that this is a bug within SUSHI, and that other codes should be allowed when an array element is constrained with an assignment rule as you did here. I've filed an issue in SUSHI (<a href="https://github.com/FHIR/sushi/issues/1055">#1055</a>)to address this.</p>



<a name="277469259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277469259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277469259">(Apr 01 2022 at 19:46)</a>:</h4>
<p>I am not so sure it is sushi fault. because the IG publisher is the one rendering the profile and it is the one indicating "at least the following"</p>



<a name="277469266"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277469266" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277469266">(Apr 01 2022 at 19:46)</a>:</h4>
<p><a href="/user_uploads/10155/3eQu-sELIxsTBIiL-nrbou89/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/3eQu-sELIxsTBIiL-nrbou89/image.png" title="image.png"><img src="/user_uploads/10155/3eQu-sELIxsTBIiL-nrbou89/image.png"></a></div>



<a name="277470020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277470020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277470020">(Apr 01 2022 at 19:54)</a>:</h4>
<p>ah, so sushi is failing to allow it multiple codes in my examples... that the slicing did allow.</p>
<blockquote>
<p>Sushi couldn't be run. Complete output from running Sushi : error Cannot assign <a href="http://hl7.org/fhir/restful-interaction#read">http://hl7.org/fhir/restful-interaction#read</a> "read" to this element; a different Coding is already assigned: {"code":"disclose","system":"http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle","display":"Disclose Record Lifecycle Ev (00:35.0356)</p>
</blockquote>



<a name="277470054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277470054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277470054">(Apr 01 2022 at 19:54)</a>:</h4>
<p>So... it's actually <em>unclear</em> what <code>pattern[x]</code> means on a repeating (<code>0..*</code>) element.  The spec (<a href="http://hl7.org/fhir/R4/elementdefinition-definitions.html#ElementDefinition.pattern_x_">as written</a>) is confusing, but seems to imply that what's in the <code>pattern[x]</code> only has to match on one element in the array. But several people, including Lloyd and Grahame, apparently thought it should apply to <em>all elements</em> in the array.  I brought this up a few months ago and there still seemed to be a lot of confusion (<a href="#narrow/stream/179177-conformance/topic/pattern.5Bx.5D.20on.200.2E.2E*.20elements/near/264222809">this thread is a bit of a roller coaster</a>).  I'm going to revive that thread to see if a decision was made.</p>



<a name="277470187"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277470187" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277470187">(Apr 01 2022 at 19:56)</a>:</h4>
<p>I thought  I remembered discussion on this topic.. and thought I remembered no conclusion.</p>



<a name="277470202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277470202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277470202">(Apr 01 2022 at 19:56)</a>:</h4>
<p>what is odd is that the IG publisher clearly decorates it as "at least..."</p>



<a name="277470261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277470261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277470261">(Apr 01 2022 at 19:57)</a>:</h4>
<p>which is what I figured was happening. and had no examples that stressed this, until now.</p>



<a name="277470966"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277470966" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277470966">(Apr 01 2022 at 20:03)</a>:</h4>
<p>Disclaimer: I am bumbling around in the dark as much as anyone on these things =)</p>
<p>Putting it into FSH online, the differential looks okay to me, as long as you are stating that a conformant AuditEvent <em>must have exactly one</em> <code>disclosure</code> slice.</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="w">  </span><span class="nt">"differential"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"element"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AuditEvent.subtype"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AuditEvent.subtype"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">"slicing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">"discriminator"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value"</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$this"</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="p">],</span><span class="w"></span>
<span class="w">          </span><span class="nt">"rules"</span><span class="p">:</span><span class="w"> </span><span class="s2">"open"</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"needs to at least be a disclosure event"</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nt">"min"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AuditEvent.subtype:disclosure"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AuditEvent.subtype"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">"sliceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"disclosure"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">"min"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">"max"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">"patternCoding"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"disclose"</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle"</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">"display"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Disclose Record Lifecycle Event"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>To me, that reads that:</p>
<ul>
<li>AuditEvent.subtype now has a min cardinality of 1.</li>
<li>The pattern established by <code>disclosure</code> has a cardinality of <code>1..1</code></li>
</ul>



<a name="277471289"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471289" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471289">(Apr 01 2022 at 20:06)</a>:</h4>
<p><span class="user-mention" data-user-id="222054">@Gino Canessa</span> yes, it works if I slice... I just don't think i should have to slice.</p>



<a name="277471362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471362">(Apr 01 2022 at 20:06)</a>:</h4>
<p>I would far prefer in sushi to just say</p>
<blockquote>
<ul>
<li>subtype = <a href="http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose">http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose</a> "Disclose Record Lifecycle Event"</li>
</ul>
</blockquote>



<a name="277471551"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471551" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471551">(Apr 01 2022 at 20:08)</a>:</h4>
<p>The problem with that would be that element id's would no longer be unique.  E.g., if you wanted to have a <code>disclose</code> and a <code>verify</code>, you have no way of adding both of those discriminators uniquely without slicing.</p>



<a name="277471615"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471615" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471615">(Apr 01 2022 at 20:09)</a>:</h4>
<p>Hmm... though I don't know if that matters.</p>



<a name="277471627"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471627" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471627">(Apr 01 2022 at 20:09)</a>:</h4>
<p>understood... if I need more than one... Fine, I will switch to slicing.. and have</p>



<a name="277471681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471681">(Apr 01 2022 at 20:09)</a>:</h4>
<p>(I am trying to work through this from the side of parsing and understanding a differential/snapshot)</p>



<a name="277471718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471718">(Apr 01 2022 at 20:09)</a>:</h4>
<p>I just have many cases where I simply want to say that an element in a profile needs to at-least have X</p>



<a name="277471811"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471811" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471811">(Apr 01 2022 at 20:10)</a>:</h4>
<p>see the other stream for less about sushi, and more about profiling -- <a href="#narrow/stream/179177-conformance/topic/pattern.5Bx.5D.20on.200.2E.2E*.20elements/near/264222809">https://chat.fhir.org/#narrow/stream/179177-conformance/topic/pattern.5Bx.5D.20on.200.2E.2E*.20elements/near/264222809</a></p>



<a name="277471832"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471832" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471832">(Apr 01 2022 at 20:10)</a>:</h4>
<p>Yes.. I am trying to figure out how to say that in an ElementDefinition without slicing though.</p>



<a name="277471881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277471881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277471881">(Apr 01 2022 at 20:11)</a>:</h4>
<p>pattern[x] seems should work... if patern[x] is seen as "at least" which is what gets rendered by the IG publisher.</p>



<a name="277472002"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277472002" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277472002">(Apr 01 2022 at 20:12)</a>:</h4>
<p>My concern is that since <code>ElementDefinition.pattern[x]</code> has a max cardinality of <code>1</code>, I think a pattern like that would prohibit anything else useful from being said downstream.</p>



<a name="277472022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277472022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277472022">(Apr 01 2022 at 20:12)</a>:</h4>
<p>and if that is the conclusion... then it is just up to sushi enforcing that definition on pattern[x], rather than today it is enforcing "all must"</p>



<a name="277472041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277472041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277472041">(Apr 01 2022 at 20:12)</a>:</h4>
<p>(and changing the cardinality there would not help, since what would that even mean?)</p>



<a name="277472116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277472116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277472116">(Apr 01 2022 at 20:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191404">John Moehrke</span> <a href="#narrow/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X/near/277469266">said</a>:</p>
<blockquote>
<p><a href="/user_uploads/10155/3eQu-sELIxsTBIiL-nrbou89/image.png">image.png</a></p>
</blockquote>
<p>this shows subtype as 0..*, with "at least..."</p>



<a name="277472539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277472539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277472539">(Apr 01 2022 at 20:17)</a>:</h4>
<p>Right.  It comes down to what <code>pattern[x]</code> actually <em>means</em> in the context of a <code>0..*</code> element.  Until that is decided for sure, we don't know what SUSHI should do.  As I said in the other thread, someone needs to decide which of these is right:</p>
<ul>
<li>A <code>pattern[x]</code> on a repeating element must match <em>every</em> element in the instance array, OR</li>
<li>A <code>pattern[x]</code> on a repeating element must match <em>at least one</em> element in the instance array</li>
</ul>



<a name="277791173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277791173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277791173">(Apr 04 2022 at 20:46)</a>:</h4>
<p>so... now that FHIR-I has clarified that pattern[x] really means "all"... can we have sushi support for "at least one"?</p>
<p>so where I presumed the following setup an at-least one,</p>
<blockquote>
<p>subtype = <a href="http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose">http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose</a> "Disclose Record Lifecycle Event"</p>
</blockquote>
<p>how about  keyword <code>atLeast</code> that automatically does all the slicing stuff?</p>
<blockquote>
<p>subtype atLeast <a href="http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose">http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose</a> "Disclose Record Lifecycle Event"</p>
</blockquote>
<p>is equivalent to</p>
<div class="codehilite"><pre><span></span><code>* subtype ^slicing.discriminator.type = #value
* subtype ^slicing.discriminator.path = &quot;$this&quot;
* subtype ^slicing.rules = #open
* subtype contains disclosure 1..1
* subtype[disclosure] = http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose &quot;Disclose Record Lifecycle Event&quot;
</code></pre></div>



<a name="277791869"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277791869" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277791869">(Apr 04 2022 at 20:52)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> -- that's an interesting proposal.  I think my one concern w/ it would be that by obscuring the slicing, we might be introducing ways for people to shoot themselves in the foot if they then try to go and do explicit slicing as well.  But... I suppose we could issue warnings for that...  I'd be interested to hear what others in the community think.</p>



<a name="277791981"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277791981" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277791981">(Apr 04 2022 at 20:52)</a>:</h4>
<p>well, isn't that the whole role of sushi? It hides all kinds of complexity behind a more simple (and constrained) encoding</p>



<a name="277792086"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277792086" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277792086">(Apr 04 2022 at 20:53)</a>:</h4>
<p>simple profile assignment when the element is ..1 is proper; but it seems completely useless because of the pattern[x] definition to be done on elements with upper that is not 1.</p>



<a name="277793286"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277793286" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277793286">(Apr 04 2022 at 21:03)</a>:</h4>
<p>Yeah, I get it.  It's just that sometimes when we obscure things, it causes problems.  There is a balance between having just the right amount of magic and having too much magic.  I want to be sure that something like this is closer to the former than the latter.</p>
<p>I know it's not as elegant, but this can be made a bit simpler w/ a RuleSet for the time being:</p>
<div class="codehilite"><pre><span></span><code>RuleSet: requireAtLeastOneMatch(path, slice, pattern)
* {path} ^slicing.discriminator.type = #value
* {path} ^slicing.discriminator.path = &quot;$this&quot;
* {path} ^slicing.rules = #open
* {path} contains {slice} 1..1
* {path}[{slice}] = {pattern}

Profile: AuditEventProfile
Parent: AuditEvent
* insert requireAtLeastOneMatch(subtype, disclosure, http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle#disclose &quot;Disclose Record Lifecycle Event&quot;)
</code></pre></div>
<p><a href="https://fshschool.org/FSHOnline/#/share/3j59yJ5">Example on FSH Online</a></p>



<a name="277794772"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277794772" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277794772">(Apr 04 2022 at 21:15)</a>:</h4>
<p>I guess that is just about as elegant. I have not played with that feature of sushi... too powerful to fully understand is a surely a "razor" defined by someone</p>



<a name="277794899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/277794899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#277794899">(Apr 04 2022 at 21:16)</a>:</h4>
<p>I am more worried there are these kinds of things that I don't know I did. The simple assignment is so easy to use.</p>



<a name="278608333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/how%20to%20require%20at-least%20one%20code%20is%20X/near/278608333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Duncan <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/how.20to.20require.20at-least.20one.20code.20is.20X.html#278608333">(Apr 11 2022 at 20:00)</a>:</h4>
<p>Is there any guidance on slicing vs. invariants for that?  I'm not sure if the FHIRPath would work on the field itself.</p>
<p>Invariant:  some-rule<br>
Expression: '$this.where(coding.system="<a href="http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle">http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle</a>" and coding.type = "disclose").exists()'</p>
<p>Then in the profile</p>
<ul>
<li>subtype obeys some-rule</li>
</ul>
<p>Or if that doesn't work, put the rule on the top of the resource and use subtype instead of $this in the expression.  Is that easier or better than slicing?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
