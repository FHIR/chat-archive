---
layout: page
title: "FHIR Chat  · Binary Adjunct · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html">Binary Adjunct</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="240087387"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240087387" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240087387">(May 24 2021 at 17:59)</a>:</h4>
<p>Does Shorthand have support for the IG Publisher feature of Binary Adjunct files? <a href="https://confluence.hl7.org/pages/viewpage.action?pageId=66938614#ImplementationGuideParameters-BinaryAdjunctFiles">https://confluence.hl7.org/pages/viewpage.action?pageId=66938614#ImplementationGuideParameters-BinaryAdjunctFiles</a></p>



<a name="240109386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240109386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240109386">(May 24 2021 at 20:45)</a>:</h4>
<p>Since this is a feature of the IG Publisher, I don't think there is anything special that FSH/SUSHI have to do in that case.  You should be able to use FSH to set the attachment id to any arbitrary string, so setting it to <code>"ig-loader-[filename]"</code> should work just fine.  And then the IG Publisher picks it up from there.  Is there something special you would expect (or want) FSH/SUSHI to do here?</p>



<a name="240166453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240166453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240166453">(May 25 2021 at 10:13)</a>:</h4>
<p>Given where the FSH files are, the processing of them by sushi, where they get stuffed, how the IG json gets written, ... I figured I would ask if there was a similar feature, or if I needed to hack my way to using this without making sushi angry.</p>



<a name="240180681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240180681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240180681">(May 25 2021 at 12:43)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191404">@John Moehrke</span>.  Hopefully there is not too much hacking involved!  I just decided to try this myself and got it working with a CQL library.  To do that, I had to:</p>
<ol>
<li>Add the following to my <code>sushi-config.yaml</code> to identify where "binary" files can be found:</li>
</ol>
<div class="codehilite"><pre><span></span><code>parameters:
  path-binary: input/cql
</code></pre></div>
<ol start="2">
<li>Create the <code>input/cql</code> folder and put my CQL file in it.  For this test, I used a simple CQL file named <code>HelloWorld.cql</code>:</li>
</ol>
<div class="codehilite"><pre><span></span><code>library HelloWorld version &#39;0.1.0&#39;
using FHIR version &#39;4.0.1&#39;

define Message: &#39;Hello World!&#39;
</code></pre></div>
<ol start="3">
<li>Create the following instance in FSH (I put it in <code>input/fsh/libraries.fsh</code> but any file in <code>input/fsh</code> should do):</li>
</ol>
<div class="codehilite"><pre><span></span><code>Instance: HelloWorld
InstanceOf: Library
* name = &quot;HelloWorld&quot;
* url = &quot;http://example.org/Library/HelloWorld&quot;
* status = #draft
* type = http://terminology.hl7.org/CodeSystem/library-type#logic-library
* content.id = &quot;ig-loader-HelloWorld.cql&quot;
</code></pre></div>
<p>The key is the line w/ <code>content.id</code>.  I also learned (the hard way) that if you define any other properties under <code>content</code> it will not work.  It must have the <code>id</code> <em>only</em>!</p>
<ol start="4">
<li>Run SUSHI to ensure I didn't make any mistakes in the FSH.</li>
<li>Run <code>_genonce.sh</code> to run the IG Publisher.</li>
</ol>
<p>That seemed to do the trick!</p>



<a name="240181067"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240181067" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240181067">(May 25 2021 at 12:46)</a>:</h4>
<p><strong>BUT</strong>... I also discovered that there <em>is</em> an issue when attempting to do this w/ the <code>Binary</code> resource.  Since the <code>Binary</code> resource doesn't use <code>Attachment</code>, you must set the special string <code>"ig-loader-[filename]"</code> directly on the <code>data</code> element.  When you do this, however, SUSHI issues an error because it knows that <code>data</code> should be a base64-encoded string, and it recognizes that <code>"ig-loader-[filename]"</code> is not valid base64 content.  So... we'll need to update SUSHI to support this special case for <code>Binary</code>.</p>



<a name="240181722"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240181722" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240181722">(May 25 2021 at 12:51)</a>:</h4>
<p>ill try. I need this alot in the IHE MHD profile for the examples.</p>



<a name="240183367"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240183367" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240183367">(May 25 2021 at 13:02)</a>:</h4>
<p>Not sure if this is a similar use case ...  We have our Library resources populated by FSH with:</p>
<p><code> "content": [
    {
      "id": "ig-loader-FHIRHelpers.cql",
      "contentType": "text/cql"
    },
    {
      "id": "ig-loader-FHIRHelpers.elm",
      "contentType": "application/elm+json"
 </code>  }</p>
<p>Then we post-process the FSH-generated Library JSON files to add the base64 versions of the referenced files, both CQL and ELM, and add them as the .data element to each entry in the content[] array.   Because of the naming convention pointed out earlier, and the fact that we know where these cql and elm files are located (relative to the FSH output dirs) we can do this in our scripting.   It would be nice to not have to have a separate post-processing script to do this though.  :-)</p>



<a name="240185144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240185144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240185144">(May 25 2021 at 13:15)</a>:</h4>
<p><span class="user-mention" data-user-id="298707">@John Silva</span> -- the binary adjunct loading that John M linked to above should take care of these things for you.  You should not need to maintain your own separate script for that.  Try removing the <code>contentType</code> from the FSH for the libraries (so only <code>id</code> remains) and making sure you've appropriately configured the <code>path-binary</code> parameter to point to wherever you have your CQL (inside the IG folder structure).</p>



<a name="240185281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240185281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240185281">(May 25 2021 at 13:16)</a>:</h4>
<p>Oh.  Also remove the <code>content</code> entry for the <code>.elm</code>.  You should also get that for free from the IG Publisher.  (And do note, these features are provided by the IG Publisher, not SUSHI).</p>



<a name="240189467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240189467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240189467">(May 25 2021 at 13:46)</a>:</h4>
<p>I've logged the SUSHI issue w/ the <code>Binary</code> resource as <a href="https://github.com/FHIR/sushi/issues/819">SUSHI #819</a>.</p>



<a name="240193688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/240193688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#240193688">(May 25 2021 at 14:14)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span>  - thanks.  We haven't used the IG Publisher though, only SUSHI.   I'll have to look into this more to figure out how to do this or to let IG Publisher do this for us.   (Our CQL execution logic expects the cql+elm base64 encoded content in the Library resources.)</p>



<a name="266507118"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/266507118" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#266507118">(Dec 31 2021 at 14:47)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> did you get a contentType working? I understand from Grahame that I need to add the <code>implementationguide-resource-format</code> extension to define these.. but I tried to add that in the sushi-config.yaml but it didn't end up in the fsh-generated IG</p>



<a name="266507212"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/266507212" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#266507212">(Dec 31 2021 at 14:49)</a>:</h4>
<p>this extension is in the sushi release notes associated with a feature for logical models. (I can't find any other mention of this extension, including in the IG documentation)</p>



<a name="266692645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/266692645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#266692645">(Jan 03 2022 at 14:37)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> - no, I did not get it working, but I had not tried it any further after that discussion with you.  If you define an extension in the <code>sushi-config.yaml</code>, it <em>should</em> go through to the fsh-generated IG JSON.  I'll have to take a look.</p>



<a name="266692857"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binary%20Adjunct/near/266692857" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binary.20Adjunct.html#266692857">(Jan 03 2022 at 14:39)</a>:</h4>
<p>okay. No hurry. It does fully work fine with DocumentReference, just not with Binary. I think the Binary is the one that needs the extension, but I am not sure.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
