---
layout: page
title: "FHIR Chat  · Issue with element order · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html">Issue with element order</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="268680833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/268680833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#268680833">(Jan 20 2022 at 11:56)</a>:</h4>
<p>I ran into an issue with SUSHI and the IG Publisher which i believe is caused by the element order in the differential generated by SUSHI.<br>
So, the following FSH slices by target profile:</p>
<div class="codehilite"><pre><span></span><code>Profile:        LuFuBefund
Parent:         DiagnosticReport
Id:             lufu-befund
Title:          &quot;Lungenfunktions-Befund&quot;
Description:    &quot;Ein Befund, i.d.R. bestehend aus mehreren Messungen.&quot;

//Slice result
* result ^slicing.discriminator.type = #value
* result ^slicing.discriminator.path = &quot;$this.resolve()&quot;
* result ^slicing.rules = #open

* result contains gewicht 0..1 and groesse 0..1 and geschlecht-geburt 0..1 and lufu-messwerte 1..*

* result[gewicht] ^type.targetProfile = http://fhir.de/StructureDefinition/observation-de-vitalsign-koerpergewicht
* result[groesse] ^type.targetProfile = http://fhir.de/StructureDefinition/observation-de-vitalsign-koerpergroesse
* result[geschlecht-geburt] ^type.targetProfile = https://www.netzwerk-universitaetsmedizin.de/fhir/StructureDefinition/sex-assigned-at-birth
* result[lufu-messwerte] ^type.targetProfile = https://fhir.miracum.org/uc2/StructureDefinition/lufu-observation
</code></pre></div>
<p>and is processed by SUSHI (v2.2.6) without errors but the IG Publisher (v ) fails with </p>
<blockquote>
<p>java.lang.Exception: Error generating snapshot for Lungenfunktions-Befund(lufu-befund): Unable to generate snapshot for <a href="https://fhir.miracum.org/uc2/StructureDefinition/lufu-befund">https://fhir.miracum.org/uc2/StructureDefinition/lufu-befund</a> in C:\Users\deppenni\MII\miracum-igs\uc2\fsh-generated\resources\structuredefinition-lufu-befund<br>
        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4824)<br>
        at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:4108)<br>
        at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:947)<br>
        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:798)<br>
        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:9079)<br>
Caused by: org.hl7.fhir.exceptions.FHIRException: Unable to generate snapshot for <a href="https://fhir.miracum.org/uc2/StructureDefinition/lufu-befund">https://fhir.miracum.org/uc2/StructureDefinition/lufu-befund</a> in C:\Users\deppenni\MII\miracum-igs\uc2\fsh-generated\resources\structuredefinition-lufu-befund<br>
        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4873)<br>
        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4822)<br>
        ... 4 more<br>
Caused by: org.hl7.fhir.exceptions.DefinitionException: Das Differential hat kein Slice: DiagnosticReport.result/ (b:21 von 31 / 1/ 5) im Profil <a href="https://fhir.miracum.org/uc2/StructureDefinition/lufu-befund">https://fhir.miracum.org/uc2/StructureDefinition/lufu-befund</a><br>
        at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1459)<br>
        at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:657)<br>
        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4871)<br>
        ... 5 more</p>
</blockquote>
<p>(Snapshot cannot be generated because  DiagnosticReport.result has no slice)<br>
If i look at the JSON generated by SUSHI, the element</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
        <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"DiagnosticReport.result"</span><span class="p">,</span>
        <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"DiagnosticReport.result"</span><span class="p">,</span>
        <span class="nt">"slicing"</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">"discriminator"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">,</span>
              <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"$this.resolve()"</span>
            <span class="p">}</span>
          <span class="p">],</span>
          <span class="nt">"rules"</span><span class="p">:</span> <span class="s2">"open"</span>
        <span class="p">},</span>
        <span class="nt">"min"</span><span class="p">:</span> <span class="mi">1</span>
      <span class="p">}</span>
</code></pre></div>
<p>exists, however is it the last element in the differential, while the individual slice definitions are at the beginning. If I move the "DiagnosticReport.result" element to the to start of the element list and pass the JSON to the IG Publisher directly, the IG is build without errors. So I assume SUSHI is generating elements in the wrong order here?</p>



<a name="268692803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/268692803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#268692803">(Jan 20 2022 at 13:41)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="221444">@Noemi Deppenwiese</span>.  SUSHI <em>should</em> put the elements in the right order.  I took your FSH and tried it in FSH Online (which also uses SUSHI 2.2.6) and it produced the elements in the correct order. See: <a href="https://fshschool.org/FSHOnline/#/share/3Kw25z2">https://fshschool.org/FSHOnline/#/share/3Kw25z2</a></p>
<p>Was that the complete example, exactly as you tried it, or did you remove some lines to keep the example short?  I'm just trying to understand why I cannot reproduce the problem.</p>



<a name="268695292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/268695292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#268695292">(Jan 20 2022 at 13:58)</a>:</h4>
<p>Ok weird. Yes, thats exactly my file content. I also tried moving the FSH file to a new folder and run SUSHI with FSHOnly: true, same (wrong element order) result. Also tried uninstalling and reinstalling SUSHI, same result... Maybe something in my npm is broken, I'll try reinstalling that next. Still, thank you!</p>



<a name="268704444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/268704444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#268704444">(Jan 20 2022 at 15:01)</a>:</h4>
<p>Hmmm... What operating system are you on?  I was testing on Mac.</p>



<a name="268704958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/268704958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#268704958">(Jan 20 2022 at 15:04)</a>:</h4>
<p>And when you go to my FSH Online link above, does it come out in the right order for you there?</p>



<a name="268708789"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/268708789" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#268708789">(Jan 20 2022 at 15:26)</a>:</h4>
<p>Yes, FSHOnline works fine. I'm using Windows 10. Node.js un- and reinstall did nothing to fix it. I'll get a colleague to try it on their Windows machine to figure out whether it is Windows or just me....</p>



<a name="268833994"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/268833994" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hank Lenzi <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#268833994">(Jan 21 2022 at 12:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="221444">Noemi Deppenwiese</span> <br>
I tried it on a Linux machine, it build just fine. That's the result (picture)</p>
<p>You might want to review your Java installation, perhaps? I would use the Amazon Corretto (based on OpenJDK but goes  through a certified testing process): </p>
<p><a href="/user_uploads/10155/ylitpqL0JFh392r4ZlEPWG9G/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/ylitpqL0JFh392r4ZlEPWG9G/image.png" title="image.png"><img src="/user_uploads/10155/ylitpqL0JFh392r4ZlEPWG9G/image.png"></a></div>



<a name="269128323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/269128323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#269128323">(Jan 24 2022 at 16:10)</a>:</h4>
<p>Ok, it is just me. My colleague got the correct order using the same node.js and sushi versions as I did. I still get the wrong order. No idea what else could be the cause. Seems like I have to reinstall my OS <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> and switch to running the IG build in docker for now.<br>
(My Java installation also seems to be ok (already using Amazon Coretto..))</p>



<a name="269574182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Issue%20with%20element%20order/near/269574182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Issue.20with.20element.20order.html#269574182">(Jan 27 2022 at 13:51)</a>:</h4>
<p>Yeah, I am perplexed.  I'd love to help you, but I have no idea how.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
