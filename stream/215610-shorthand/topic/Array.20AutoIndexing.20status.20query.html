---
layout: page
title: "FHIR Chat  · Array AutoIndexing status query · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Array.20AutoIndexing.20status.20query.html">Array AutoIndexing status query</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="205632518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Array%20AutoIndexing%20status%20query/near/205632518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kurt Allen <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Array.20AutoIndexing.20status.20query.html#205632518">(Jul 31 2020 at 19:35)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="191469">@Chris Moesel</span> <span class="user-mention" data-user-id="191447">@Mark Kramer</span> <br>
You talked about adding the capability to auto index arrays (reference last element, add new element, etc) recently. Do you still have plans to do this? Any guestimates on timing?</p>
<p>I am doing some funky stuff with arrays that would be easier if I didn't have to automatically increment automatic array indices. Hoping you did the work so I don't have to :-)</p>



<a name="205632717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Array%20AutoIndexing%20status%20query/near/205632717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kramer <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Array.20AutoIndexing.20status.20query.html#205632717">(Jul 31 2020 at 19:37)</a>:</h4>
<p>Hi Kurt, we are planning to Do something with this after the 1.0 release. We’d like to talk to you about ideas you might have associated with macros as a possible workaround.</p>



<a name="205638402"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Array%20AutoIndexing%20status%20query/near/205638402" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kurt Allen <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Array.20AutoIndexing.20status.20query.html#205638402">(Jul 31 2020 at 20:31)</a>:</h4>
<p>Mark, here is what MFSH (Macro FSH) currently does.<br>
Lets talk about this and see what parts make sense to move into FSH.</p>
<hr>
<p>Macros</p>
<hr>
<p>Macros are inserts with the following additions.<br>
a) Named parameters.<br>
   When the macro is defined, named parameters are defined. When called, each of those<br>
   parameters must contain a value.<br>
   #macro XXYYZ(alpha, beta, delta)<br>
   #apply XXYYZ("alpha value", "beta value", "delta value")<br>
   Anywhere in the code that 'alpha' is found, it is replaced with 'alpha value'.<br>
b) Global parameters.<br>
   There are parameters that are defined globally, such as</p>
<p>- the id of the current profile<br>
   - the url of the current profile.<br>
   - parameters that can be set on command line<br>
   many others<br>
   These can be referenced in any macro just as if it was a named parameter.</p>
<p>c) Redirection<br>
   The output of a macro can be redirected to a non-fsh file.<br>
   The output file name can contain global and named parameters which will get expanded when the macro is called/executed (not when it is<br>
   first defined)<br>
   I use this to collate info such as node graph commands I process externalluy to generate svg images, and also to allow embedded<br>
   macros to generate the --intro implementation guide files for each profile.</p>
<div class="codehilite"><pre><span></span><code>   #macro XXYYZ() &gt; &#39;redirection path&#39;
</code></pre></div>


<p>d) Once flags<br>
   The once flag allows a macro to be called only once, even if it is executed multiple times.<br>
   Example of how this can be used:<br>
   Several macros are defined that add distinct sliced Observation.component items. These macros are sometimes used in a profile together, and<br>
   in some profiles separately.<br>
   Each macro calls a common macro to add component slicing; this should only be called once per profile.<br>
   One way to handle this is to force the user to call this macro separately, once per profile, but this requires the user to<br>
   manually add this and allows opportunities to not call it.<br>
   So a macro is defined that implements the required slicing commands, and it is called with the once flag set, so it <br>
   only generates FSH output the first time it is called.<br>
   There are two flavors of the once flag.</p>
<p>- restrict calls to once per profile<br>
   - restrict the calls to once period.<br>
   Named Parameters can be a problem here, as multiple calls can be made with difference named parameter values, and only<br>
   the first call will create output with its unique parameter values.</p>
<p>// this is expanded once per profile.<br>
    #macro once XXYYZ()<br>
    #end</p>
<p>// this is expanded once, no matter how many times it is called.<br>
    #apply once XXYYZ()</p>
<hr>
<p>Fragments</p>
<hr>
<p>A fragment is kinda a cross between a profile and a macro.<br>
The purpose of a fragment is to define a profile fragment that <br>
  a) can be added to multiple profiles (like a macro)<br>
  b) is intended to signal to code generators that each fragment can be treated like a separate 'thing' (class or interface).<br>
  c) breaks the output profile into separate pieces that are functionally unique, implemented in multiple profiles, and documented as separate 'thing'.</p>
<p>Example.<br>
  I create a fragment 'f' that is three Observation.component items.<br>
  I include the fragment in multiple profiles 'a', 'b', and 'c'.</p>
<p>I generate a c# project that implements a class to process these profiles.<br>
  I can generate a method 'm' that can accept an interface 'f' that mimics the fragment 'f'.<br>
  Classes are created that mimic profiles 'a', 'b', and 'c', each of which implements interface 'f'.<br>
  I can call method 'm' with an instance of 'a', 'b', or 'c'.</p>
<p>So a fragment is a part of a profile that is to be implemented in multiple profiles but treated like a 'distinct' item<br>
in generated artifacts (including implementation guide).</p>
<p>The fragment would have a parent class (like Observation).<br>
It should generate an item in the implementation guide showing exactly what it implemented.<br>
It should generate documentation in the documentation guide indicating what profiles implement it.</p>
<p>A profile can include one or more fragments just like a macro.<br>
No named parameters are allowed in a fragment call.</p>
<p>The fragments generate structure definition and other meta data allowing external code generation tools to recognize<br>
when a fragment has been defined, and where it is used. Programming artifacts can be generated from this info.</p>
<p>#Fragment: Observation.Component.NotPreviouslySeenFragment<br>
#Parent: Observation<br>
#Title: "NotPreviously Seen Fragment"<br>
#Description: """</p>
<h1>Adds NotPreviously Seen Component slice.</h1>
<h1>"""</h1>
<p>#apply Observation.Component.Add("notPreviouslySeen", "0..*", "Not Previously Seen", "Not Previously Seen",<br>
  # """<br>
  # This slice contains the optional components that define prevous encounters in which this abnormality was not seen.<br>
  # The value of this component is a codeable concept chosen from the NotPreviouslySeenVS valueset.<br>
  # """,<br>
  #   "ObservationComponentSliceCodesCS#notPreviouslySeen")<br>
  #<br>
  #apply Observation.Component.SetConcept("notPreviouslySeen", "1..1", "NotPreviouslySeenVS")<br>
#end</p>
<hr>
<p>Conditional compilation</p>
<hr>
<p>This is completely experimental and I have not found it to be useful so far, but there may be instances where it may become useful.<br>
This is identical to conditional compilation in c++, c3, etc.<br>
We may want to ignore adding this to FSH. Not sure if it will ever be usefull, though we still need some way to implement<br>
different countries using similar profiles.</p>
<p>i.e.</p>
<p>#if (value1=="true")<br>
if value1 is true, then include all text here.<br>
#else if (value2=="false")<br>
if value1 is false, then include all text here.<br>
#else<br>
otherwise include all text here.<br>
#end</p>
<p>The original purpose of conditional compilation was to allow a profile to be made that could be compiled for different countries.</p>
<p>i.e.<br>
Profile: Hello<br>
Parent: Observation<br>
#if Country == "US"</p>
<ul>
<li>
<p>greeting = "Hello"<br>
#else if Country == "CA"</p>
</li>
<li>
<p>greeting = "Hello, eh"<br>
#else if Country == "NO"</p>
</li>
<li>
<p>greeting = "Uff da"<br>
#else if Country == "AU"</p>
</li>
<li>
<p>greeting = "G'Day"<br>
#end</p>
</li>
</ul>



<a name="205641247"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Array%20AutoIndexing%20status%20query/near/205641247" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Array.20AutoIndexing.20status.20query.html#205641247">(Jul 31 2020 at 21:02)</a>:</h4>
<p><span class="user-mention" data-user-id="192611">@Kurt Allen</span> -- for reference, here is a link to the discussion where we proposed an approach for easier management of arrays.  If you read through the comments, you'll see it got some thumbs up, but there were also several people who did <em>not</em> like it: <a href="#narrow/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax/near/203963085">https://chat.fhir.org/#narrow/stream/215610-shorthand/topic/Feedback.20Needed.3A.20Array.20Syntax/near/203963085</a></p>



<a name="206475569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Array%20AutoIndexing%20status%20query/near/206475569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kramer <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Array.20AutoIndexing.20status.20query.html#206475569">(Aug 10 2020 at 15:37)</a>:</h4>
<p>I'm going to fork off a new topic on Parameterized RuleSet (Macros) so we keep the two conversations distinct.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
