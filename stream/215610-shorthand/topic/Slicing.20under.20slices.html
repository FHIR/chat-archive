---
layout: page
title: "FHIR Chat  · Slicing under slices · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Slicing.20under.20slices.html">Slicing under slices</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="188523462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Slicing%20under%20slices/near/188523462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pétur Valdimarsson <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Slicing.20under.20slices.html#188523462">(Feb 19 2020 at 08:16)</a>:</h4>
<p>Working on a composition profile I ran into some problems trying to slice section under a sliced section. Not sure if this is me not doing the right thing or the slicing logic that needs more love. Here is an abbreviated version of my fsh file:</p>
<div class="codehilite"><pre><span></span>Profile: PatientSummary
Parent: http://hl7.org/fhir/StructureDefinition/Composition
Id: patient-summary
Title: &quot;Patient summary&quot;
Description: &quot;&quot;

* section MS
* section ^slicing.rules = #closed
* section contains alerts 1..1

* section[alerts].section 1..1 MS
* section[alerts].section ^slicing.rules = #closed
* section[alerts].section ^slicing.discriminator.type = #value
* section[alerts].section ^slicing.discriminator.path = &quot;code&quot;
* section[alerts].section contains allergies 1..1 MS

* section[alerts].section[allergies] 1..1 MS
* section[alerts].section[allergies].mode = #snapshot
</pre></div>


<p>Which will result in:</p>
<div class="codehilite"><pre><span></span>error No element found at path section[alerts].section[allergies].mode for PatientSummary, skipping rule
  File: /.../fsh/Simple.fsh
</pre></div>


<p>Any thoughts? Known limitation?</p>



<a name="188540149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Slicing%20under%20slices/near/188540149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Slicing.20under.20slices.html#188540149">(Feb 19 2020 at 12:38)</a>:</h4>
<p>I looked into this a little and it looks like you've found a formerly unknown limitation. It seems the issue is that <code>Composition.section:alerts.section:allergies</code> is a contentReference, and it is also a slice, and our handling of slicing was messing up our handling of contentReferences. I made a fix and I got the output below, which looks correct to my eye:<br>
<a href="/user_uploads/10155/DhbsXX3aR0aVYAAaQSUeAc1S/StructureDefinition-patient-summary.json" target="_blank" title="StructureDefinition-patient-summary.json">StructureDefinition-patient-summary.json</a> </p>
<p>Assuming everything is good with the above, I'll push my fix and it will be in the next version of SUSHI.</p>



<a name="188544974"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Slicing%20under%20slices/near/188544974" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Slicing.20under.20slices.html#188544974">(Feb 19 2020 at 13:47)</a>:</h4>
<p>Sidenote: You could use Simplifier Snippet for sharing longer FHIR resources: <a href="https://simplifier.net/snippet/wardweistra/6" target="_blank" title="https://simplifier.net/snippet/wardweistra/6">https://simplifier.net/snippet/wardweistra/6</a> Like Github Gists, but for FHIR <span aria-label="smile" class="emoji emoji-263a" role="img" title="smile">:smile:</span> <br>
(I did have to change the FHIR version to 4.0.0 though, 4.0.1 will be recognized soon)</p>



<a name="188547010"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Slicing%20under%20slices/near/188547010" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pétur Valdimarsson <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Slicing.20under.20slices.html#188547010">(Feb 19 2020 at 14:10)</a>:</h4>
<p>First of all, thanks for a fast reply and of course for an awesome profiling tool. </p>
<p>Nicely done on the quick localization of the problem &amp; corresponding fix. The profile looks correct, will do a validation when I get to my computer again. </p>
<p>If the branch is available somewhere I'd love to try it out on the larger version of my .fsh file (I have migrated a few profiles from json to fsh and am doing diffs on them to validate the changes)</p>



<a name="188547519"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Slicing%20under%20slices/near/188547519" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Slicing.20under.20slices.html#188547519">(Feb 19 2020 at 14:16)</a>:</h4>
<p>No problem! Glad you're enjoying the tool. </p>
<p>The branch is <code>fix-contentReference-slicing-bug</code>: <a href="https://github.com/FHIR/sushi/tree/fix-contentReference-slicing-bug" target="_blank" title="https://github.com/FHIR/sushi/tree/fix-contentReference-slicing-bug">https://github.com/FHIR/sushi/tree/fix-contentReference-slicing-bug</a>.</p>



<a name="188576264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Slicing%20under%20slices/near/188576264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pétur Valdimarsson <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Slicing.20under.20slices.html#188576264">(Feb 19 2020 at 19:26)</a>:</h4>
<p>Works like a charm. The only unexpected thing I'm seeing is the type BackboneElement part, but I guess that's mainly cosmetic.</p>
<div class="codehilite"><pre><span></span>{
        &quot;id&quot;: &quot;Composition.section:medicalHistory.section:Immunization&quot;,
        &quot;path&quot;: &quot;Composition.section.section&quot;,
        &quot;sliceName&quot;: &quot;Immunization&quot;,
        &quot;type&quot;: [
          {
            &quot;code&quot;: &quot;BackboneElement&quot;
          }
        ]
      },
</pre></div>



<a name="188635391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Slicing%20under%20slices/near/188635391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Slicing.20under.20slices.html#188635391">(Feb 20 2020 at 13:10)</a>:</h4>
<p>It feels a little weird, but the reason SUSHI is putting that in there is because the <code>Composition.section.section</code> element originally does not have a type, because it is a contentReference.  So when we take that contentReference and access child elements of it, it is now a BackboneElement, no longer a contentReference in SUSHI's eyes. So the type has changed, so we include it in the differential.  That's the reasoning at least.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
