---
layout: page
title: "FHIR Chat  · Is SUSHI generating the proper slices? · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Is.20SUSHI.20generating.20the.20proper.20slices.3F.html">Is SUSHI generating the proper slices?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="252079703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Is%20SUSHI%20generating%20the%20proper%20slices%3F/near/252079703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Is.20SUSHI.20generating.20the.20proper.20slices.3F.html#252079703">(Sep 05 2021 at 14:20)</a>:</h4>
<p>I have a profile where I slice on the boolean value of an extension:</p>
<div class="codehilite"><pre><span></span><code>* careTeam MS
* careTeam.extension contains CareTeamClaimScope named careTeamClaimScope 1..1 MS
* careTeam.sequence MS
* careTeam.provider MS
* careTeam.provider only Reference(PASPractitioner or PASOrganization)
* careTeam.role MS
* careTeam.qualification MS
* careTeam ^slicing.discriminator.type = #value
* careTeam ^slicing.discriminator.path = &quot;extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value&quot;
* careTeam ^slicing.rules = #open
* careTeam ^slicing.description = &quot;Slice based on whether the care team member belongs to the overall claim or to an individual claim item.&quot;
* careTeam contains OverallClaimMember 0..14 and ItemClaimMember 0..10
* careTeam[OverallClaimMember].extension[careTeamClaimScope].valueBoolean 1..1
* careTeam[OverallClaimMember].extension[careTeamClaimScope].valueBoolean = true
* careTeam[ItemClaimMember].extension[careTeamClaimScope].valueBoolean 1..1
* careTeam[ItemClaimMember].extension[careTeamClaimScope].valueBoolean = false
</code></pre></div>
<p>I'm unsure if the slicing discriminator path is correct because I'm getting an error about it:</p>
<div class="codehilite"><pre><span></span><code>Slicing cannot be evaluated: Unable to resolve discriminator in definitions: extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value (@char 1)
</code></pre></div>
<p>But I've tried all sorts of paths and always get that error.  When I look at the generated StructureDefinition, I'm slightly confused because of the slicing on extension that happens:</p>
<div class="codehilite"><pre><span></span><code>      {
        &quot;id&quot;: &quot;Claim.careTeam&quot;,
        &quot;path&quot;: &quot;Claim.careTeam&quot;,
        &quot;slicing&quot;: {
          &quot;discriminator&quot;: [
            {
              &quot;type&quot;: &quot;value&quot;,
              &quot;path&quot;: &quot;extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value&quot;
            }
          ],
          &quot;rules&quot;: &quot;open&quot;,
          &quot;description&quot;: &quot;Slice based on whether the care team member belongs to the overall claim or to an individual claim item.&quot;
        },
        &quot;mustSupport&quot;: true
      },
      {
        &quot;id&quot;: &quot;Claim.careTeam.extension&quot;,
        &quot;path&quot;: &quot;Claim.careTeam.extension&quot;,
        &quot;slicing&quot;: {
          &quot;discriminator&quot;: [
            {
              &quot;type&quot;: &quot;value&quot;,
              &quot;path&quot;: &quot;url&quot;
            }
          ],
          &quot;ordered&quot;: false,
          &quot;rules&quot;: &quot;open&quot;
        },
        &quot;min&quot;: 1
      },
</code></pre></div>
<p>The first slicing is my slice on careTeam, the second is the default slicing on extension that occurs.  Then I get the extension slice:</p>
<div class="codehilite"><pre><span></span><code>      {
        &quot;id&quot;: &quot;Claim.careTeam.extension:careTeamClaimScope&quot;,
        &quot;path&quot;: &quot;Claim.careTeam.extension&quot;,
        &quot;sliceName&quot;: &quot;careTeamClaimScope&quot;,
        &quot;min&quot;: 1,
        &quot;max&quot;: &quot;1&quot;,
        &quot;type&quot;: [
          {
            &quot;code&quot;: &quot;Extension&quot;,
            &quot;profile&quot;: [
              &quot;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&quot;
            ]
          }
        ],
        &quot;mustSupport&quot;: true
      },
</code></pre></div>
<p>And then I get four entries that are about slices, but I'm not sure if they are correct:</p>
<div class="codehilite"><pre><span></span><code>      {
        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember&quot;,
        &quot;path&quot;: &quot;Claim.careTeam&quot;,
        &quot;sliceName&quot;: &quot;OverallClaimMember&quot;,
        &quot;min&quot;: 0,
        &quot;max&quot;: &quot;14&quot;
      },
      {
        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope&quot;,
        &quot;path&quot;: &quot;Claim.careTeam.extension&quot;,
        &quot;sliceName&quot;: &quot;careTeamClaimScope&quot;
      },
      {
        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope.value[x]&quot;,
        &quot;path&quot;: &quot;Claim.careTeam.extension.value[x]&quot;,
        &quot;slicing&quot;: {
          &quot;discriminator&quot;: [
            {
              &quot;type&quot;: &quot;type&quot;,
              &quot;path&quot;: &quot;$this&quot;
            }
          ],
          &quot;ordered&quot;: false,
          &quot;rules&quot;: &quot;open&quot;
        },
        &quot;min&quot;: 1
      },
      {
        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope.valueBoolean&quot;,
        &quot;path&quot;: &quot;Claim.careTeam.extension.valueBoolean&quot;,
        &quot;min&quot;: 1,
        &quot;max&quot;: &quot;1&quot;,
        &quot;patternBoolean&quot;: true
      },
</code></pre></div>



<a name="252298649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Is%20SUSHI%20generating%20the%20proper%20slices%3F/near/252298649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Is.20SUSHI.20generating.20the.20proper.20slices.3F.html#252298649">(Sep 07 2021 at 12:42)</a>:</h4>
<p>Ugh.  Slicing is always <em>tricky</em>.  I'm not sure what is going on here.  A few thoughts:</p>
<ul>
<li>Everything you've shown <em>seems</em> OK to me based on my knowledge of slicing, but when you get into slices within nested slices, and then nested slices again -- it's hard to know how the publisher/validator handles that.</li>
<li>You could potentially eliminate one level of slicing (the type slicing) by changing <code>careTeam[OverallClaimMember].extension[careTeamClaimScope].valueBoolean</code> to just <code>careTeam[OverallClaimMember].extension[careTeamClaimScope].value[x]</code> (assuming it has already been constrained to only <code>boolean</code>).  Maybe that would help?</li>
<li>You did not say anything about the <code>ItemClaimNumber</code> slice, but I assume you have four entries about that slice group as well (just like <code>OverallClaimNumber</code>).  Right?</li>
<li>I doubt it would make a difference, but you could also try changing your discriminator to use <code>$this</code>: <code>"$this.extension('http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope').value"</code>.</li>
</ul>



<a name="252305770"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Is%20SUSHI%20generating%20the%20proper%20slices%3F/near/252305770" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Is.20SUSHI.20generating.20the.20proper.20slices.3F.html#252305770">(Sep 07 2021 at 13:35)</a>:</h4>
<p>okay, then I think this is a problem in the validator.  changing it to use $this didn't change anything mainly because the publisher strips that out.</p>



<a name="252312546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Is%20SUSHI%20generating%20the%20proper%20slices%3F/near/252312546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Is.20SUSHI.20generating.20the.20proper.20slices.3F.html#252312546">(Sep 07 2021 at 14:19)</a>:</h4>
<p>OK.  Please report back if/when you hear anything -- especially if it turns out that there is an issue w/ the slicing itself!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
