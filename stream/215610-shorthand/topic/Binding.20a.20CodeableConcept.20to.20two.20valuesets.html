---
layout: page
title: "FHIR Chat  · Binding a CodeableConcept to two valuesets · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html">Binding a CodeableConcept to two valuesets</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="233680131"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233680131" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233680131">(Apr 08 2021 at 16:01)</a>:</h4>
<p>I'm likely trying to do this wrong -- would love advice about 1) how to narrowly fix the specific example here, and 2) what I should be doing instead ;-)</p>
<p>I want to describe a CodeableConcept profile that says "I must contain a Coding from VS1 and a Coding from VS2" (technically I want something even narrower: "I must contain the specific coding X and the specific coding Y", but I'm papering over this by defining two ValueSets each with a single concept). I'm naively writing:</p>
<div class="codehilite"><pre><span></span><code>Profile: C19ServiceCodeableConcept
Parent: CodeableConcept
Id: c19-service-codeable-concept
* . from VS1
* . from VS2
</code></pre></div>
<p>... but I can't use <code>.</code> in this way to refer to the CodeableConcept ("error Cannot bind value set to ; "). Is there something like <code>$this</code> or <code>self</code> that I can write instead, or is my idea just wrong, or is this a rational goal that just isn't supported by syntax today? (Writing <code>* coding from VS1</code> doesn't express my intended meaning, because I don't want <em>all codings</em> bound.)</p>



<a name="233691136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233691136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233691136">(Apr 08 2021 at 17:09)</a>:</h4>
<p>StructureDefinition itself doesn't allow multiple bindings.  If you want multiple bindings, you need to slice coding and define different bindings per slice.</p>



<a name="233691425"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233691425" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233691425">(Apr 08 2021 at 17:11)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> . I'll do this (I'm already using slicing at the level of the resource that contains this CodeableConcept in an array, but I think I need it in both places).</p>



<a name="233693846"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233693846" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233693846">(Apr 08 2021 at 17:24)</a>:</h4>
<p>Here's what I put together, then: <a href="https://fshschool.org/FSHOnline/#/share/39Vr4Lx">https://fshschool.org/FSHOnline/#/share/39Vr4Lx</a></p>
<p>I'd love feedback on whether this is a valid way (and if so: the preferred way?) to say "serviceType[] needs to include at least one CodeableConcept that includes at least these two specific Codings".</p>



<a name="233694036"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233694036" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233694036">(Apr 08 2021 at 17:25)</a>:</h4>
<p>(FYI <span class="user-mention" data-user-id="191647">@Michael O'Keefe</span>  this relates to <a class="stream" data-stream-id="281612" href="/#narrow/stream/281612-smart.2Fscheduling-links">#smart/scheduling-links</a>; figured I'd use it as an excuse to learn a bit more FSH before just asking you to add this to the <a href="https://github.com/inferno-community/fsh-smart-scheduling-links/tree/main/input/fsh">profiles</a>.)</p>



<a name="233694722"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233694722" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233694722">(Apr 08 2021 at 17:29)</a>:</h4>
<p>I don't see anything 'wrong' - but you're not actually specifying multiple bindings?</p>



<a name="233694760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233694760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233694760">(Apr 08 2021 at 17:29)</a>:</h4>
<p>Actually for my discriminator path, I realize this isn't being validated by sushi at all, so I may be doing it wrong:</p>
<div class="codehilite"><pre><span></span><code>Profile: C19ServiceCodeableConcept
Parent: CodeableConcept
Id: c19-service-codeable-concept
* coding ^slicing.discriminator.type = #pattern
* coding ^slicing.discriminator.path = &quot;.&quot;
</code></pre></div>
<p>Is <code>"."</code> the right way to say it? Or should it be <code>"$this"</code>, or something else? (If I change <code>"."</code> to <code>"NO#$$BAD!"</code>, sushi happily passes this through to its output, which made me lose confidence.)</p>



<a name="233694866"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233694866" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233694866">(Apr 08 2021 at 17:30)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    immunizationAppointment 1..1 and
    c19ImmunizationAppointment 1..1
</code></pre></div>
<p>This requires that both required codings are present... I hope?</p>



<a name="233694988"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233694988" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233694988">(Apr 08 2021 at 17:30)</a>:</h4>
<p>(If I needed to bind to two value sets, I could do that with additional lines... but since the codings are directly specified, binding to a valueset would be superfluous, right <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> ?)</p>



<a name="233696885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233696885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233696885">(Apr 08 2021 at 17:41)</a>:</h4>
<p>Specifying codings directly is fine.  You had just asked about multiple bindings, so I was a bit confused when you weren't actually doing that :)</p>



<a name="233708112"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233708112" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233708112">(Apr 08 2021 at 18:47)</a>:</h4>
<p>(Sorry, I had updated my initial question to explain this nuance!)</p>
<blockquote>
<p>(technically I want something even narrower: "I must contain the specific coding X and the specific coding Y", but I'm papering over this by defining two ValueSets each with a single concept).</p>
</blockquote>



<a name="233723024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233723024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233723024">(Apr 08 2021 at 20:30)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="191315">@Josh Mandel</span> -- glad to see you giving FSH a try!  I think you're pretty close to what you want to do.  You <em>do</em> want to use <code>$this</code> as your discriminator path.</p>
<p>Re this:</p>
<div class="codehilite"><pre><span></span><code>* serviceType[c19Service] ^type.profile = &quot;http://example.org/StructureDefinition/c19-service-codeable-concept&quot;
</code></pre></div>
<p>you asked:</p>
<blockquote>
<p>Is there a way to infer "This IG's prefix"?</p>
</blockquote>
<p>and the answer is <em>yes</em>.  You can use the <code>Canonical</code> function to do that:</p>
<div class="codehilite"><pre><span></span><code>* serviceType[c19Service] ^type.profile = Canonical(C19ServiceCodeableConcept)
</code></pre></div>
<p>But actually there is an even simpler way to accomplish what you are trying to do:</p>
<div class="codehilite"><pre><span></span><code>* serviceType[c19Service] only C19ServiceCodeableConcept
</code></pre></div>
<p><a href="https://fshschool.org/FSHOnline/#/share/3uANN7w">https://fshschool.org/FSHOnline/#/share/3uANN7w</a></p>
<p>I'll also confirm, SUSHI does <em>not</em> attempt to validate slicing parameters or individual slices.  That's a level of complexity we did not want to take on and feel pretty ok about that since the IG Publisher will do that validation for you when you build it there.</p>



<a name="233723313"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233723313" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233723313">(Apr 08 2021 at 20:32)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191469">@Chris Moesel</span> for the encouragement, and for answering the questions I knew how to ask, and for answering the questions I didn't know how to ask!</p>



<a name="233725031"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233725031" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233725031">(Apr 08 2021 at 20:44)</a>:</h4>
<p>Yep, you can use <code>only</code> to narrow a choice to a smaller subset of choices (or a single item) - but you can <em>also</em> use <code>only</code> to narrow a type to a profile (or a set of profiles).</p>
<p>All that said, I probably should have mentioned: sometimes the validator gets cranky when you slice an array and then slice a sub-property within that array's items.  So... although I think what you're doing is technically valid, you might want to double-check that the validator handles it OK.  You can do that by creating an example of the <code>VaccineSchedule</code> and seeing if the IG Publisher reports any validation errors on it due to nested slicing.  Hopefully not! (BTW -- I created the simplest of examples here: <a href="https://fshschool.org/FSHOnline/#/share/2QciCAs">https://fshschool.org/FSHOnline/#/share/2QciCAs</a>).</p>



<a name="233725160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233725160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233725160">(Apr 08 2021 at 20:45)</a>:</h4>
<blockquote>
<p>but you can also use only to narrow a type to a profile (or a set of profiles).</p>
</blockquote>
<p>I was just reading <a href="http://hl7.org/fhir/uv/shorthand/reference.html#type-rules">http://hl7.org/fhir/uv/shorthand/reference.html#type-rules</a> -- it wasn't clear to me that you can refer to profiels this way. is this implied by "&lt;element&gt; only {datatype}" ?</p>



<a name="233725326"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233725326" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233725326">(Apr 08 2021 at 20:47)</a>:</h4>
<blockquote>
<p>You can do that by creating an example of the VaccineSchedule and seeing if the IG Publisher reports any validation errors on it due to nested slicing. </p>
</blockquote>
<p>Yeah, it's never clear to me what the existing tools will support, and where they might break. Any thoughts on how to incorporate this kind of "try and see" validation functionality into FSH Online?</p>



<a name="233725632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233725632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233725632">(Apr 08 2021 at 20:49)</a>:</h4>
<p>I guess the challenge would be generating positive and negative examples, and making sure the validator deals with both.</p>



<a name="233726077"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233726077" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233726077">(Apr 08 2021 at 20:52)</a>:</h4>
<p>Yes, I think <code>&lt;element&gt; only {datatype}</code> covers that use case, but also covers the use case of restricting a choice to a single type.  We could probably make that more clear.  There is also some narrative in the spec that addresses it:</p>
<blockquote>
<p>Following standard profiling rules established in FHIR, the data type(s) in a type rule MUST always be more restrictive than the original data type. For example, if the parent data type is Quantity, it can be replaced by SimpleQuantity, since SimpleQuantity is a profile on Quantity (hence more restrictive than Quantity itself), but cannot be replaced with Ratio, because Ratio is not a type of Quantity.</p>
</blockquote>



<a name="233726498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233726498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233726498">(Apr 08 2021 at 20:56)</a>:</h4>
<p>As for FSH Online, "try and see" w/ the Java validator is a little tricky because FSH Online is a fully client-side web application. It is hosted on GitHub pages and has no backend API/database/server -- only the standard GH Pages HTTP server.  So... we can't run Java on the backend, and we can't run Java on the frontend, so... the only way it would work is if there was some other service we could post the FHIR definitions to for validation.</p>



<a name="233726623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233726623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233726623">(Apr 08 2021 at 20:57)</a>:</h4>
<p>And for a variety of reasons we've been intentionally avoiding having to acquire and maintain a real backend server (hence the use of GitHub pages).</p>



<a name="233728492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233728492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233728492">(Apr 08 2021 at 21:04)</a>:</h4>
<blockquote>
<p>the only way it would work is if there was some other service we could post the FHIR definitions to for validation.</p>
</blockquote>
<blockquote>
<p>And for a variety of reasons we've been intentionally avoiding having to acquire and maintain a real backend server (hence the use of GitHub pages).</p>
</blockquote>
<p>Yeah. I get it. Sounds like writing a from-scratch validator in typescript (+ terminology packs) is the only thing for it ;-)</p>



<a name="233728649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233728649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233728649">(Apr 08 2021 at 21:05)</a>:</h4>
<p>A near-term QoL step might be "click here to download a bash script that downloads your profiles from fshonline, loads them into the FHIR jar validator, and invokes it"</p>



<a name="233728967"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233728967" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233728967">(Apr 08 2021 at 21:06)</a>:</h4>
<p>Love your use of bitly for state management BTW ;-)</p>



<a name="233759543"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233759543" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233759543">(Apr 09 2021 at 02:31)</a>:</h4>
<p>Ha.  Yeah, without a backend server we had to get creative for having some way to store and recall state.  Just don't try to type too much information in there. ;-)</p>



<a name="233759719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Binding%20a%20CodeableConcept%20to%20two%20valuesets/near/233759719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Binding.20a.20CodeableConcept.20to.20two.20valuesets.html#233759719">(Apr 09 2021 at 02:34)</a>:</h4>
<p>My idea for an "upgrade" is to support a GitHub integration so users can auth against GitHub and use gists for storing/retrieving longer FSH snippets.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
