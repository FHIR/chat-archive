---
layout: page
title: "FHIR Chat  · Indicating that an extension is mandatory in a slice? · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html">Indicating that an extension is mandatory in a slice?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="215928548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/215928548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#215928548">(Nov 07 2020 at 03:09)</a>:</h4>
<p>I want to indicate that an extension in one of my slices is mandatory:</p>
<div class="codehilite"><pre><span></span><code>* item[DateTime].type from DateTimeItemTypes (required)
* item[DateTime].extension contains http://hl7.org/fhir/StructureDefinition/regex named regex 1..1 MS
</code></pre></div>
<p>But I can't seem to then set this in my instance.  When I do <code>item[2].extension[regex].valueString = "asd"</code>, I get the following error: <code>The element or path you referenced does not exist: item[2].extension[regex].valueString</code>.</p>
<p>I'm assuming that is because the <code>named regex</code> part is in the slice and not in the profile itself?</p>



<a name="215970671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/215970671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#215970671">(Nov 07 2020 at 19:58)</a>:</h4>
<p>Again, is this mixing profiling and instances? Wouldn't the instance be: </p>
<div class="codehilite"><pre><span></span><code>item[2].extension[0].url = http://hl7.org/fhir/StructureDefinition/regex
item[2].extension[0].valueString = &quot;asd&quot;
</code></pre></div>
<p>And then it matches the profiling you've specified?</p>



<a name="215970844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/215970844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#215970844">(Nov 07 2020 at 20:02)</a>:</h4>
<p>I have to say, I find that the shorthand documentation is a little lacking in differentiating how to use extensions in instances versus defining them. </p>
<p>PS. Actually, I think the language is a little lacking in that regard too. It would be nicer if using an extension was easier than having to hand code the elements.</p>
<p>PPS. Actually, I think the language is a little lacking in capabilities for instance creation generally. It would be nicer if creating an instance was easier than having to hand code majority of the elements.</p>



<a name="216039745"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216039745" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216039745">(Nov 09 2020 at 03:02)</a>:</h4>
<p>hmm, i've always specified the extensions in my instances using the name that I've given to them.</p>



<a name="216040177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216040177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216040177">(Nov 09 2020 at 03:13)</a>:</h4>
<p>Really? I tried that once and couldn't get it to work, so I figured I was mis-reading the documentation and that approach only worked for profiling. Hmm, maybe I'll have to go back and try it again.</p>



<a name="216040238"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216040238" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216040238">(Nov 09 2020 at 03:14)</a>:</h4>
<p>yeah, here is other extensions that I specify in my instance and they work properly:</p>
<div class="codehilite"><pre><span></span><code>* item[0].extension[requiredText].valueMarkdown = &quot;Please answer this&quot;
* item[0].extension[sasVariableName].valueString = &quot;SLT&quot;
</code></pre></div>



<a name="216040248"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216040248" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216040248">(Nov 09 2020 at 03:14)</a>:</h4>
<p>and my profile has the following:</p>
<div class="codehilite"><pre><span></span><code>* item.extension contains ItemTitle named title 1..1 MS and
    ItemSASVariableName named sasVariableName 1..1 MS and
    ItemRequiredText named requiredText 0..1 MS and
    http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl named itemControl 0..1 MS
</code></pre></div>



<a name="216040318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216040318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216040318">(Nov 09 2020 at 03:16)</a>:</h4>
<p>Ah, ok. my instances aren't profiled, they're just instances of Questionnaire. I wonder if that changes things.</p>



<a name="216040330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216040330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216040330">(Nov 09 2020 at 03:17)</a>:</h4>
<p>sure, if you haven't defined the extension already, then it probably wouldn't work like I'm doing it.</p>



<a name="216081581"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216081581" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216081581">(Nov 09 2020 at 13:13)</a>:</h4>
<p>You should be able to add any extension that SUSHI knows about, even if that extension is not on the profile. So the line:</p>
<div class="codehilite"><pre><span></span><code>item[2].extension[regex].valueString = &quot;asd&quot;
</code></pre></div>
<p>should work on an <code>Instance</code> of a Questionnaire, or a profile of Questionnaire. I've tried testing out that line on an Instance of Questionnaire, and it was working for me. If you're able to share the full Instance you are defining that is causing the error, that could help so we could recreate this.</p>



<a name="216085676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216085676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216085676">(Nov 09 2020 at 13:51)</a>:</h4>
<p>To add one important clarification to <span class="user-mention" data-user-id="239822">@Nick Freiter</span>'s note above, the example above (for adding an arbitrary extension) only works if <code>regex</code> resolves to an extension by name, id, or url (which, in this case, works out because <code>regex</code> is the actual id of the extension).  The only other way for it to work is for it to resolve to the slice name of an extension in the profile this is an instance of.</p>



<a name="216086189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216086189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216086189">(Nov 09 2020 at 13:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191380">@Elliot Silver</span>  and <span class="user-mention" data-user-id="192166">@Jean Duteau</span> -- I'm sorry the documentation is lacking.  You <em>should</em> be able to reference slices by name in instances.  Since extensions are just slices of extension, it should work for them as well.</p>
<p>As for <code>item[2].extension[regex].valueString = "asd"</code>, <span class="user-mention" data-user-id="239822">@Nick Freiter</span> already noted why this <em>should</em> work no matter what -- but one thing to note is that <code>item[2]</code> will not be recognized by SUSHI as an item in the <code>DateTime</code> slice, so therefore it does not use any of the constraints you specified in <code>item[DateTime]</code>.  You would have to say <code>item[DateTime].extension[regex].valueString = "asd"</code> for it to recognize and use those constraints.  I don't recall for sure, but I think if you want to access the 2nd item in the <code>DateTime</code> slice, you would do <code>item[DateTime][1].extension[regex].valueString = "asd"</code>.</p>



<a name="216099958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216099958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216099958">(Nov 09 2020 at 15:33)</a>:</h4>
<p>Thanks.</p>
<p><span class="user-mention silent" data-user-id="239822">Nick Freiter</span> <a href="#narrow/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F/near/216081581">said</a>:</p>
<blockquote>
<p>You should be able to add any extension that SUSHI knows about, even if that extension is not on the profile. </p>
</blockquote>
<p>What constitutes SUSHI knowing about an extension? Does that require a "contains...named" line, and if so,  can I do that when invoking an extension rather than profiling the resource the extension is used in? (In my case, the resource and extension are both defined in FHIR core, and I'm just creating an instance using it.)</p>



<a name="216109116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216109116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216109116">(Nov 09 2020 at 16:31)</a>:</h4>
<p>SUSHI "knows" about an extension if that extension is defined in FSH using the <code>Extension</code> keyword, or that extension is defined as a StructureDefinition in the dependencies that are specified in the <code>sushi-config.yaml</code> file, or that extension is defined in FHIR Core (since the FHIR Core definitions are always loaded by SUSHI, without the need for specifying a dependency). It does not require a <code>contains...named</code> line on the profile.</p>



<a name="216109605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216109605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216109605">(Nov 09 2020 at 16:35)</a>:</h4>
<p>I'm not sure what you mean by "invoking an extension", but I think an example could help clarify what I mean. The following definition is valid:</p>
<div class="codehilite"><pre><span></span><code>Instance: Foo
InstanceOf: Questionnaire
* item[0].extension[regex].valueString = &quot;asd&quot;
</code></pre></div>
<p>Even though <code>Foo</code> is an instance of <code>Questionnaire</code> directly, and not a profile of <code>Questionnaire</code>, I can reference the <code>regex</code> extension as shown, since SUSHI has loaded the <code>regex</code> extension from the core FHIR definitions.  There is no need to profile <code>Questionnaire</code> with a rule like:</p>
<div class="codehilite"><pre><span></span><code>* extension contains http://hl7.org/fhir/StructureDefinition/regex named regex
</code></pre></div>



<a name="216112253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216112253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216112253">(Nov 09 2020 at 16:54)</a>:</h4>
<p>OK, assuming I have the dependencies in there, how do I define the name "regex"? Can I do:</p>
<div class="codehilite"><pre><span></span><code>Instance: Foo
InstanceOf: Questionnaire
* item[0].extension[&quot;http://hl7.org/fhir/StructureDefinition/regex&quot;].valueString = &quot;asd&quot;
</code></pre></div>



<a name="216113094"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216113094" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216113094">(Nov 09 2020 at 17:00)</a>:</h4>
<p>You can refer to an extension by its name, id, or url, and SUSHI will look for an extension with a matching name, id, or url. So in this case, the <code>regex</code> extension is defined in FHIR to have and id and name of <code>regex</code>, so you can reference it directly as I showed:</p>
<div class="codehilite"><pre><span></span><code>* item[0].extension[regex].valueString = &quot;asd&quot;
</code></pre></div>
<p>There is no need to define the name "regex". If you are in a situation where names may conflict, it is usually best to use the URL. In that case I think the most common approach would be to use an alias, like so:</p>
<div class="codehilite"><pre><span></span><code>Alias: REGEX = http://hl7.org/fhir/StructureDefinition/regex

Instance: foo
InstanceOf: Questionnaire
* item[0].extension[REGEX].valueString = &quot;asd&quot;
</code></pre></div>



<a name="216431089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216431089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216431089">(Nov 12 2020 at 06:03)</a>:</h4>
<p>Hmm, so I just retried this.</p>
<p>I have <code>Alias: $ext-questionnaire-itemControl   = http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl</code> defined.</p>
<p>And in my Questionnaire instance, the following works:</p>
<div class="codehilite" data-code-language="fsh"><pre><span></span><code>...
* item[7].item[2].item[0].linkId    = "outcome_asymp_help"
* item[7].item[2].item[0].text      = "No: the case remains asymptomatic; Yes: the previously asymptomatic case developed symptoms and/or signs of illness."
* item[7].item[2].item[0].type      = #display
* item[7].item[2].item[0].extension[0].url = $ext-questionnaire-itemControl
* item[7].item[2].item[0].extension[0].valueCodeableConcept = $cs-itemControl#help
</code></pre></div>
<p>But none of these work:</p>
<div class="codehilite" data-code-language="fsh"><pre><span></span><code>* item[7].item[2].item[0].extension[$ext-questionnaire-itemControl].valueCodeableConcept = $cs-itemControl#help
* item[7].item[2].item[0].extension[http://hl7.org/fhir/questionnaire-item-control].valueCodeableConcept = $cs-itemControl#help
* item[7].item[2].item[0].extension["http://hl7.org/fhir/questionnaire-item-control"].valueCodeableConcept = $cs-itemControl#help
</code></pre></div>
<p>All result in the error</p>
<div class="codehilite"><pre><span></span><code>Sushi: error The element or path you referenced does not exist: item[7].item[2].item.extension[http://hl7.org/fhir/questionnaire-item-control].valueCodeableConcept (00:08.0336)
</code></pre></div>



<a name="216462105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216462105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216462105">(Nov 12 2020 at 12:42)</a>:</h4>
<p>Which version of SUSHI are you using? There was a bug in SUSHI versions 0.16.0 or earlier which caused SUSHI to fail to find the path of an extension being added to an Instance, if the extension was nested within another element. See the bug report <a href="https://github.com/FHIR/sushi/issues/621">here</a>.</p>



<a name="216475423"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Indicating%20that%20an%20extension%20is%20mandatory%20in%20a%20slice%3F/near/216475423" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F.html#216475423">(Nov 12 2020 at 14:32)</a>:</h4>
<p>OK, I'm using 1.6.0. I wasn't ready jump over to the beta.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
