---
layout: page
title: "FHIR Chat  · Extensions for R5 elements in an R4 IG · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html">Extensions for R5 elements in an R4 IG</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="265948572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/265948572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Power <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#265948572">(Dec 23 2021 at 19:58)</a>:</h4>
<p>I am trying to use a newly defined attribute from R5 in an R4 based IG. I am using the guidance here:<br>
<a href="https://fshschool.org/docs/sushi/configuration/#dependencies">https://fshschool.org/docs/sushi/configuration/#dependencies</a><br>
<a href="http://build.fhir.org/versions.html#extensions">http://build.fhir.org/versions.html#extensions</a></p>
<p>I tried a few things, and couldn't get it to work. To verify: </p>
<ul>
<li>would I used 'r5' as the extension version?</li>
<li>would the URL look like <a href="http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note">http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note</a></li>
</ul>
<p>(and sorry, this is likely not a shorthand specific thing, but I started here since I am using FSH <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>)</p>



<a name="266858771"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266858771" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266858771">(Jan 04 2022 at 20:28)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191913">@Kevin Power</span> -- sorry for the delay!  This one got lost in the holiday shuffle!  You should be able to do this by setting up the dependency in <code>sushi-config.yaml</code>:</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">dependencies</span><span class="p">:</span>
  <span class="nt">hl7.fhir.extensions.r5</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4.0.1</span>
</code></pre></div>
<p>Then using it in a profile and/or instance.  I usually create an alias for the extension URL to simplify things.  For example:</p>
<div class="codehilite"><pre><span></span><code>Alias: R5DiagnosticReportNote = http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note

Profile: MyDiagnosticReportProfile
Parent: DiagnosticReport
Description: &quot;An example profile showing how to use an R5 extension.&quot;
* extension contains R5DiagnosticReportNote named note 0..*
</code></pre></div>
<p>I'm attaching a working project as a zip file with an example profile and two instances.</p>
<p><a href="/user_uploads/10155/iih0ZjPoRCvXnsZLwjoUnO-z/DiagnosticReportNoteExample.zip">DiagnosticReportNoteExample.zip</a></p>



<a name="266859164"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266859164" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266859164">(Jan 04 2022 at 20:31)</a>:</h4>
<p>Note that this will use the <em>current</em> R5 build from the build server -- and it attempts to download it every time (since current can change multiple times per day).  Unfortunately, this means that this will not currently work due to the <em>expired</em> security certificate on <a href="http://build.fhir.org">build.fhir.org</a>. Until that is fixed, the R5 download will fail.  I posted a workaround <a href="#narrow/stream/215610-shorthand/topic/R5.20support/near/266722279">here</a> if you really need to make progress on this while we wait for the build server issue to be fixed.</p>



<a name="266859454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266859454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266859454">(Jan 04 2022 at 20:33)</a>:</h4>
<p>Oh! But since this uses a current build and attempts to download every time, you shouldn't remove the special environment variable until you're done working on it, because as soon as you remove it, local builds will fail again.</p>



<a name="266860207"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266860207" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Power <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266860207">(Jan 04 2022 at 20:40)</a>:</h4>
<p>Ha, just noticed that <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> So left the environment variable set for now.</p>
<p>So, if I start with just the dependency, it seems to download packages and builds fine. However, I get this error when I build a 2nd time:</p>
<blockquote>
<p>Sushi: error Failed to load supplemental FHIR package hl7.fhir.r5.core#current: ENOTEMPTY: directory not empty, rename '/Users/kmpower/.fhir/packages/hl7.fhir.r5.core#current/openapi' -&gt; '/Users/kmpower/.fhir/packages/hl7.fhir.r5.core#current/package/openapi' </p>
</blockquote>



<a name="266862405"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266862405" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Power <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266862405">(Jan 04 2022 at 20:58)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> - If I delete the package folder, it seems to then work. However, once I try to add the extension to my profile, I get the following stack dump:</p>
<div class="codehilite" data-code-language="g-code"><pre><span></span><code>Stack Dump (for debugging):                                                      (00:37.0827)
java.lang.Exception: Error generating snapshot for /Users/kmpower/Documents/GitHub/genomics-reporting/fsh-generated/resources/StructureDefinition-genomics-report(genomics-report): Unable to generate snapshot for http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/genomics-report in /Users/kmpower/Documents/GitHub/genomics-reporting/fsh-generated/resources/StructureDefinition-genomics-report
<span class="w">        </span>at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4810)
<span class="w">        </span>at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:4094)
<span class="w">        </span>at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:944)
<span class="w">        </span>at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:795)
<span class="w">        </span>at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8975)
Caused by: org.hl7.fhir.exceptions.FHIRException: Unable to generate snapshot for http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/genomics-report in /Users/kmpower/Documents/GitHub/genomics-reporting/fsh-generated/resources/StructureDefinition-genomics-report
<span class="w">        </span>at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4859)
<span class="w">        </span>at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4808)
<span class="w">        </span>... 4 more
Caused by: org.hl7.fhir.exceptions.FHIRException: Reference to unknown extension http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note
<span class="w">        </span>at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1163)
<span class="w">        </span>at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1529)
<span class="w">        </span>at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:654)
<span class="w">        </span>at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4857)
<span class="w">        </span>... 5 more
</code></pre></div>
<p>Not sure if that is another symptom of the first problem I mentioned or not.</p>



<a name="266864454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266864454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266864454">(Jan 04 2022 at 21:16)</a>:</h4>
<p>Hopefully you don't have to delete the package folder every time!  If so, that doesn't seem right...</p>



<a name="266864788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266864788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266864788">(Jan 04 2022 at 21:19)</a>:</h4>
<p>As for the error, my only guess is that the IG Publisher is using an older version of FHIR R5 to resolve the special cross-version extensions.  The <code>note</code> element was only added to <code>DiagnosticReport</code> in the last snapshot release.  So if the IG Publisher is using FHIR R5 4.6.0 or lesser, then it wouldn't recognize the <a href="http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note">http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note</a> extension.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> -- is my guess right? Is the IG publisher possibly using an older R5 package to try to resolve cross-version extensions?</p>



<a name="266865648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266865648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Power <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266865648">(Jan 04 2022 at 21:27)</a>:</h4>
<p>Thanks for all the help <span class="user-mention" data-user-id="191469">@Chris Moesel</span> <br>
<a href="https://media4.giphy.com/media/uWlpPGquhGZNFzY90z/giphy.gif?cid=c623cb359pulbwj2mskzt0d529afq0yeznm9t7jjknkttn6e&amp;rid=giphy.gif&amp;ct=g">https://media4.giphy.com/media/uWlpPGquhGZNFzY90z/giphy.gif?cid=c623cb359pulbwj2mskzt0d529afq0yeznm9t7jjknkttn6e&amp;rid=giphy.gif&amp;ct=g</a></p>
<div class="message_inline_image"><a href="https://media4.giphy.com/media/uWlpPGquhGZNFzY90z/giphy.gif?cid=c623cb359pulbwj2mskzt0d529afq0yeznm9t7jjknkttn6e&amp;rid=giphy.gif&amp;ct=g"><img src="https://uploads.zulipusercontent.net/41a3f2ad95bc5e831adf89658128fd8ed5559a29/68747470733a2f2f6d65646961342e67697068792e636f6d2f6d656469612f75576c705047717568475a4e467a5939307a2f67697068792e6769663f6369643d63363233636233353970756c62776a326d736b7a7430643532396166713079657a6e6d3974376a6a6b6e6b74746e3665267269643d67697068792e6769662663743d67"></a></div>



<a name="266865844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266865844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266865844">(Jan 04 2022 at 21:29)</a>:</h4>
<p>My pleasure!  Let's see what Grahame says and we'll take it from there...</p>



<a name="266880047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/266880047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Power <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#266880047">(Jan 04 2022 at 23:44)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> - Just FYI, you might be onto something. I switched over to a different attribute that is also being added in R5 (composition) and everything works as I would expect (so maybe it was in an earlier snapshot that the IG is using).</p>
<p>I will also add that I am not sure what changed, but the weird error I was getting with the build failing the 2nd time has now stopped happening. So, not sure what that is about.</p>



<a name="267011444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20for%20R5%20elements%20in%20an%20R4%20IG/near/267011444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Power <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG.html#267011444">(Jan 06 2022 at 00:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG/near/266864788">said</a>:</p>
<blockquote>
<p>As for the error, my only guess is that the IG Publisher is using an older version of FHIR R5 to resolve the special cross-version extensions.  The <code>note</code> element was only added to <code>DiagnosticReport</code> in the last snapshot release.  So if the IG Publisher is using FHIR R5 4.6.0 or lesser, then it wouldn't recognize the <a href="http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note">http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note</a> extension.  <span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> -- is my guess right? Is the IG publisher possibly using an older R5 package to try to resolve cross-version extensions?</p>
</blockquote>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> - I know you are swamped, but wanted to tag you on this one again to see if you have any thoughts.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
