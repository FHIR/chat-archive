---
layout: page
title: "FHIR Chat  · sushi exporting less resources than it converted · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html">sushi exporting less resources than it converted</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="244614591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244614591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244614591">(Jul 01 2021 at 19:22)</a>:</h4>
<p>Hi. I have an FSH file that contains 11 Measures but sushi exports only 5 Measures in JSON. Sushi reports successful processing of all of the resources (0 Errors) but it says it exported less resources than it converted. Also, there's an error '(node:76987) Warning: Accessing non-existent property 'INVALID_ALT_NUMBER' of module exports inside circular dependency'. A quick Google search suggests is has something to do with Node and ANTLR. The Node version is v16.4.0.<br>
The FSH file is here: <a href="https://pastebin.com/crcDJX1Q">https://pastebin.com/crcDJX1Q</a> Any thoughts on what may be happening?</p>



<a name="244615833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244615833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244615833">(Jul 01 2021 at 19:33)</a>:</h4>
<p>We've seen <code>INVALID_ALT_NUMBER</code> before.  As you found, it is related to ANTLR and happens for Node version 14 and up. Our understanding (and experience) so far, however, is that it is a harmless error.  I would guess it is not related to what you have found, but I have not had a chance to review your FSH yet -- so I guess I can't say for sure!</p>



<a name="244617305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244617305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244617305">(Jul 01 2021 at 19:46)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191469">@Chris Moesel</span> So, I downgraded to node@12 and reinstalled and reran sushi. The issue persists - meaning exporting less resources than it is converting. The FSH resources were converted by gosushi from existing resources if that matters.</p>



<a name="244617498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244617498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244617498">(Jul 01 2021 at 19:48)</a>:</h4>
<p>OK.  I'll try to take a look at your FSH soon.  It's a little difficult because my company blocks pastebin and dropbox and other things like that.  So I have to jump through a few hoops to get at it.  If you have GitHub and can put it in a <a href="https://gist.github.com/">gist</a>, that might be easier for me to access.</p>



<a name="244617771"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244617771" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244617771">(Jul 01 2021 at 19:51)</a>:</h4>
<p>Will do, one min.<br>
Here you go: <a href="https://gist.github.com/citizenrich/f89a2062172a1530a8781b85e7b9a07f">https://gist.github.com/citizenrich/f89a2062172a1530a8781b85e7b9a07f</a></p>



<a name="244622702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244622702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244622702">(Jul 01 2021 at 20:32)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="194192">@Richard Stanley</span>.  I can't reproduce this.  I've used SUSHI 2.0.0 Beta 1, SUSHI 1.3.2, and FSH Online, and in all cases, I am getting 11 measures back (counting the actual JSON documents that are output).  For example, here is a permalink to this on FSH Online: <a href="https://fshschool.org/FSHOnline/#/share/3hcybDE">https://fshschool.org/FSHOnline/#/share/3hcybDE</a></p>
<p>I'm not sure why you would see different results.  Are you sure you're looking in the right folder (<code>fsh-generated/resources</code>)?</p>



<a name="244624809"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244624809" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244624809">(Jul 01 2021 at 20:48)</a>:</h4>
<p>Thanks for having a look <span class="user-mention" data-user-id="191469">@Chris Moesel</span>  Yes, I'm looking in the correct folder. I'm doing FSHOnly generation in an IG which is here: <a href="https://github.com/intrahealth/simple-hiv-ig">https://github.com/intrahealth/simple-hiv-ig</a> It's very strange.</p>



<a name="244626074"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244626074" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244626074">(Jul 01 2021 at 20:59)</a>:</h4>
<p>Oh!  I see it now... Hmmm... Here is an example of what is going on.  In <code>library.fsh</code> you have:</p>
<div class="codehilite"><pre><span></span><code>Instance: HIVSimpleAgeGroup
InstanceOf: Library
Usage: #example
// etc.
</code></pre></div>
<p>and in <code>measure.fsh</code> you have:</p>
<div class="codehilite"><pre><span></span><code>Instance: HIVSimpleAgeGroup
InstanceOf: Measure
Usage: #example
// etc.
</code></pre></div>
<p>So... you have two instances w/ the same name here.  Since you can refer to instances by their name, SUSHI really prefers (and expects) unique names.  IIRC SUSHI keeps a dictionary of instances keyed by name, so if there are two w/ the same name, the last one in wins.  I think that's what is happening here.  If you avoid duplicate names, it should work as expected.  If you want the ids to be the same (between the library and the measure) then you'll just need to set the <code>id</code> using an assignment rule.  E.g.:</p>
<div class="codehilite"><pre><span></span><code>Instance: HIVSimpleAgeGroupLibrary
InstanceOf: Library
Usage: #example
* id = &quot;HIVSimpleAgeGroup&quot;
// etc.
</code></pre></div>
<p>and</p>
<div class="codehilite"><pre><span></span><code>Instance: HIVSimpleAgeGroupMeasure
InstanceOf: Measure
Usage: #example
* id = &quot;HIVSimpleAgeGroup&quot;
// etc.
</code></pre></div>



<a name="244626232"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244626232" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244626232">(Jul 01 2021 at 21:00)</a>:</h4>
<p>It's unfortunate that SUSHI did not log an error for this case.  It really should, so I'll log a bug for that.</p>



<a name="244626454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244626454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244626454">(Jul 01 2021 at 21:02)</a>:</h4>
<p>(Also, sorry that SUSHI wasted your time by not logging an error telling you what was wrong).</p>



<a name="244627219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20exporting%20less%20resources%20than%20it%20converted/near/244627219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20exporting.20less.20resources.20than.20it.20converted.html#244627219">(Jul 01 2021 at 21:09)</a>:</h4>
<p>Thanks so much, <span class="user-mention" data-user-id="191469">@Chris Moesel</span> Yeah, ok, you mentioned that in another GitHub issue and I should have noticed it. Thanks!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
