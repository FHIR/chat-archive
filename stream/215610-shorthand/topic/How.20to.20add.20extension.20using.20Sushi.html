---
layout: page
title: "FHIR Chat  · How to add extension using Sushi · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html">How to add extension using Sushi</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="226142287"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226142287" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Francis <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226142287">(Feb 12 2021 at 14:23)</a>:</h4>
<p>Hi,</p>
<p>I want to add a stand alone extension <a href="https://build.fhir.org/ig/HL7-Canada/ca-baseline/StructureDefinition-ext-aboriginalidentitygroup.html">https://build.fhir.org/ig/HL7-Canada/ca-baseline/StructureDefinition-ext-aboriginalidentitygroup.html</a> to  the Base (R4) Patient resource</p>
<p>I use the following line in the .fsh file:  extension [http://hl7.org/fhir/ca/baseline/StructureDefinition/ext-aboriginalidentitygroup] </p>
<p>The error I am receiving is: error no viable alternative at input '* extension [http://hl7.org/fhir/ca/baseline/StructureDefinition/ext-aboriginalidentitygroup]'</p>
<p>Can anyone point me in the right direction? How do I resolve this? Thanks in advance.</p>
<p><span class="user-mention" data-user-id="192545">@Alex Goel</span></p>



<a name="226152114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226152114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226152114">(Feb 12 2021 at 15:34)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="193795">@Joel Francis</span> -- I think there are a few things going on here.  The most immediate issue is that you should not have a space between <code>extension</code> and <code>[</code>.  So the path representing the extension should be <code>extension[http://hl7.org/fhir/ca/baseline/StructureDefinition/ext-aboriginalidentitygroup]</code>.</p>



<a name="226152495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226152495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226152495">(Feb 12 2021 at 15:37)</a>:</h4>
<p>That said, there is an <a href="https://github.com/FHIR/sushi/issues/674">open bug</a> for SUSHI's handling of extension URLs in paths like this.  We actually have a fix for this under review, but for now, the way around it is to use an alias for the extension URL.  Here is an example (w/ full context for clarity):</p>
<div class="codehilite"><pre><span></span><code>Alias: EX_ABIDGRP = http://hl7.org/fhir/ca/baseline/StructureDefinition/ext-aboriginalidentitygroup
Alias: CS_ABIDTYPE = https://fhir.infoway-inforoute.ca/CodeSystem/aboriginalidentitytype

Instance: MyPatient
InstanceOf: Patient
* extension[EX_ABIDGRP].valueCoding = CS_ABIDTYPE#firstnations &quot;First Nations&quot;
</code></pre></div>



<a name="226152809"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226152809" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226152809">(Feb 12 2021 at 15:39)</a>:</h4>
<p>Since you reference an extension from another IG, you need to specify that IG in your <code>sushi-config.yaml</code> dependencies.  It looks like the IG this comes from only has a <code>current</code> build, so that dependency would look like this:</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">dependencies</span><span class="p">:</span>
  <span class="nt">hl7.fhir.ca.baseline</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">current</span>
</code></pre></div>



<a name="226153763"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226153763" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226153763">(Feb 12 2021 at 15:46)</a>:</h4>
<p>Now, as it turns out, this <em>still</em> doesn't work in SUSHI.  When I run it, I get a few errors, starting with this:</p>
<blockquote>
<p>error Cannot read property 'slicing' of undefined</p>
</blockquote>
<p>I looked into it and found that the <code>StructureDefinition</code> for the <a href="https://build.fhir.org/ig/HL7-Canada/ca-baseline/StructureDefinition-ext-aboriginalidentitygroup.html">Aboriginal Identity Group extension</a> has an <em>incomplete</em> snapshot.  It does not have an element for <code>Extension.value[x]</code> (which is where the <code>slicing</code> would usually go).  Instead it jumps to <code>Extension.value[x]:valueCoding</code> without ever defining the <code>Extension.value[x]</code> element it is sliced from.  I think this is invalid, but perhaps someone like <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> can confirm.  Lloyd, is it valid to have an Extension snapshot without an element for <code>Extension.value[x]</code>? (<a href="https://build.fhir.org/ig/HL7-Canada/ca-baseline/StructureDefinition-ext-aboriginalidentitygroup.xml">StructureDefinition XML here</a>).</p>



<a name="226153803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226153803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226153803">(Feb 12 2021 at 15:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> is that how it would be defined in a Profile too?</p>



<a name="226154488"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226154488" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226154488">(Feb 12 2021 at 15:51)</a>:</h4>
<p><span class="user-mention" data-user-id="192545">@Alex Goel</span> -- In a profile, you specify an extension using the <code>contains</code> keyword.  So to say that a patient profile can contain that extension, assuming the same alias as defined above, your FSH would look like this:</p>
<div class="codehilite"><pre><span></span><code>Profile: PatientProfile
Parent: Patient
* extension contains EX_ABIDGRP named ext-aboriginalidentitygroup 0..1
</code></pre></div>
<p>Then to use it in an instance of the profile, you can now use the local slicename it specified for that extension:</p>
<div class="codehilite"><pre><span></span><code>Instance: MyPatient
InstanceOf: Patient
* extension[ext-aboriginalidentitygroup].valueCoding = CS_ABIDTYPE#firstnations &quot;First Nations&quot;
</code></pre></div>
<p>This still breaks in SUSHI, however, due to the incomplete snapshot in that extension's StructureDefinition, as I noted above.</p>



<a name="226155020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226155020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226155020">(Feb 12 2021 at 15:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi/near/226153763">said</a>:</p>
<blockquote>
<p>Now, as it turns out, this <em>still</em> doesn't work in SUSHI.  When I run it, I get a few errors, starting with this:</p>
<blockquote>
<p>error Cannot read property 'slicing' of undefined</p>
</blockquote>
<p>I looked into it and found that the <code>StructureDefinition</code> for the <a href="https://build.fhir.org/ig/HL7-Canada/ca-baseline/StructureDefinition-ext-aboriginalidentitygroup.html">Aboriginal Identity Group extension</a> has an <em>incomplete</em> snapshot.  It does not have an element for <code>Extension.value[x]</code> (which is where the <code>slicing</code> would usually go).  Instead it jumps to <code>Extension.value[x]:valueCoding</code> without ever defining the <code>Extension.value[x]</code> element it is sliced from.  I think this is invalid, but perhaps someone like <span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> can confirm.  Lloyd, is it valid to have an Extension snapshot without an element for <code>Extension.value[x]</code>? (<a href="https://build.fhir.org/ig/HL7-Canada/ca-baseline/StructureDefinition-ext-aboriginalidentitygroup.xml">StructureDefinition XML here</a>).</p>
</blockquote>
<p><span class="user-mention" data-user-id="248932">@Michael Savage</span> FYI</p>



<a name="226156057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226156057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226156057">(Feb 12 2021 at 16:01)</a>:</h4>
<p>If instead of using the predefined extension, I define a similar one in FSH, it all works well:</p>
<div class="codehilite"><pre><span></span><code>Alias: VS_ABIDGRP = https://fhir.infoway-inforoute.ca/ValueSet/aboriginalidentitygroup
Alias: CS_ABIDTYPE = https://fhir.infoway-inforoute.ca/CodeSystem/aboriginalidentitytype

Extension: ExtensionAboriginalIdentityGroup
Id: ext-aboriginalidentitygroup
* value[x] only Coding
* valueCoding 1..1
* valueCoding from VS_ABIDGRP (preferred)

Profile: PatientProfile
Parent: Patient
Id: profile-patient
* extension contains ExtensionAboriginalIdentityGroup named ext-aboriginalidentitygroup 0..1

Instance: MyPatient
InstanceOf: Patient
* extension[ext-aboriginalidentitygroup].valueCoding = CS_ABIDTYPE#firstnations &quot;First Nations&quot;
</code></pre></div>
<p>I know you want to use the one from the IG, but I just wanted to show that in general it works if the Extension is defined correctly (or at least w/ a complete snapshot).</p>



<a name="226156220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226156220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Francis <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226156220">(Feb 12 2021 at 16:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi/near/226156057">said</a>:</p>
<blockquote>
<p>If instead of using the predefined extension, I define a similar one in FSH, it all works well:</p>
<div class="codehilite"><pre><span></span><code>Alias: VS_ABIDGRP = https://fhir.infoway-inforoute.ca/ValueSet/aboriginalidentitygroup
Alias: CS_ABIDTYPE = https://fhir.infoway-inforoute.ca/CodeSystem/aboriginalidentitytype

Extension: ExtensionAboriginalIdentityGroup
Id: ext-aboriginalidentitygroup
* value[x] only Coding
* valueCoding 1..1
* valueCoding from VS_ABIDGRP (preferred)

Profile: PatientProfile
Parent: Patient
Id: profile-patient
* extension contains ExtensionAboriginalIdentityGroup named ext-aboriginalidentitygroup 0..1

Instance: MyPatient
InstanceOf: Patient
* extension[ext-aboriginalidentitygroup].valueCoding = CS_ABIDTYPE#firstnations &quot;First Nations&quot;
</code></pre></div>
<p>I know you want to use the one from the IG, but I just wanted to show that in general it works if the Extension is defined correctly (or at least w/ a complete snapshot).</p>
</blockquote>
<p>Thaks <span class="user-mention" data-user-id="191469">@Chris Moesel</span></p>



<a name="226162888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226162888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226162888">(Feb 12 2021 at 16:50)</a>:</h4>
<p>I don't think it's legal anymore.  The tooling used to be looser, but we now try hard to be consistent.</p>



<a name="226163320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/How%20to%20add%20extension%20using%20Sushi/near/226163320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/How.20to.20add.20extension.20using.20Sushi.html#226163320">(Feb 12 2021 at 16:52)</a>:</h4>
<p><span class="user-mention" data-user-id="248932">@Michael Savage</span> need a new StructureDefinition for AboriginalIdentityGroup?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
