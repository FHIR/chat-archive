---
layout: page
title: "FHIR Chat  · Sushi: error Failed to load hl7.fhir.r4.core#4.0.1 · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.3A.20error.20Failed.20to.20load.20hl7.2Efhir.2Er4.2Ecore.234.2E0.2E1.html">Sushi: error Failed to load hl7.fhir.r4.core#4.0.1</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="224721028"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%3A%20error%20Failed%20to%20load%20hl7.fhir.r4.core%234.0.1/near/224721028" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Paquette <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.3A.20error.20Failed.20to.20load.20hl7.2Efhir.2Er4.2Ecore.234.2E0.2E1.html#224721028">(Feb 01 2021 at 12:56)</a>:</h4>
<p>I updated our IG project to use Sushi 1.1.0 on Jan 20th and have not seen any errors. Our CI builds (Jenkins) have worked without error until this past Friday.  It was late in the day, so I decided to wait and retry the build this morning. It failed again. This is the error I keep getting:</p>
<div class="codehilite"><pre><span></span><code>Sushi: info  Checking local cache for hl7.fhir.r4.core#4.0.1...                  (00:03.0709)
Sushi: info  Did not find hl7.fhir.r4.core#4.0.1 in local cache.                 (00:03.0712)
Sushi: info  Downloading hl7.fhir.r4.core#4.0.1...                               (00:03.0715)
Sushi: info  Downloaded hl7.fhir.r4.core#4.0.1                                   (00:19.0785)
Sushi: error Failed to load hl7.fhir.r4.core#4.0.1: ENOENT: no such file or directory, open &#39;/home/jpaquette/.fhir/packages/hl7.fhir.r4.core#4.0.1/other/clinicalreasoning-integrating-decision-support-radiology-request.png&#39; (00:23.0869)
Sushi: error Valid StructureDefinition resource not found. The FHIR package in your local cache may be corrupt. Local FHIR cache can be found at &lt;home-directory&gt;/.fhir/packages. For more information, see
https://wiki.hl7.org/FHIR_Package_Cache#Location. (00:23.0877)
Sushi couldn&#39;t be run. Complete output from running Sushi :                      (00:23.0891)
</code></pre></div>
<p>Each time, the "failed to load" file is different.<br>
The Jenkins build is done within a Docker instance, so the <code>.fhir</code> cache will always be empty when starting the actual build process.</p>
<p>I tried to repeat this locally. First, I deleted my local <code>.fhir</code> cache and my local NPM <code>node_modules</code>. I then executed the same NPM build commands that are used in our Jenkins build. I got the same error but with a different file. I checked the local <code>.fhir</code> cache, and the file is there and I was able to open the file with no problem.</p>
<p>I re-ran my local build and of course it succeeded because the <code>.fhir</code> cache now exists.</p>
<p>It seems like that even though the log shows <code>Downloaded hl7.fhir.r4.core#4.0.1</code> the downloading hasn't really completed. I'm assuming that the download is downloading a package tarball. Maybe the expansion of the tarball contents into the cache has not completed when Sushi is trying to load specific files for use.</p>
<p>Thoughts?</p>



<a name="224859629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%3A%20error%20Failed%20to%20load%20hl7.fhir.r4.core%234.0.1/near/224859629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Paquette <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.3A.20error.20Failed.20to.20load.20hl7.2Efhir.2Er4.2Ecore.234.2E0.2E1.html#224859629">(Feb 02 2021 at 11:40)</a>:</h4>
<p>Never mind... I figured it out. We have a mono-repo (Lerna) with 2 IGs in the project. Lerna parallelizes the sub-project scripts so the execution of Sushi/IG generation were over lapping. Specifically the code that extracts the contents of the downloaded packages and moves it under the <code>package</code> directory from each sub-project were interfering with each other. Setting concurrency to 1 for that process solved the problem.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
