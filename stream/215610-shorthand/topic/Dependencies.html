---
layout: page
title: "FHIR Chat  · Dependencies · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html">Dependencies</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="230478530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230478530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Körlinge <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230478530">(Mar 16 2021 at 08:54)</a>:</h4>
<p>Hi everyone! I am getting started using shorthand for a profile/IG that has to extend the german base profile. I have found it in the hl7 registry, the top version points at <a href="https://ig.fhir.de/basisprofile-de/0.2.30/">https://ig.fhir.de/basisprofile-de/0.2.30/</a> - but I cannot get Sushi to find the dependency. I have tried various ways of specifying the id, the url, the version (also tried the r4 version), but I cannot get it to work. Does anyone know how to specify this dependency correctly in config.yml?</p>



<a name="230504702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230504702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230504702">(Mar 16 2021 at 12:41)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="397998">@Max Körlinge</span> -- I was able to find that IG in the FHIR Registry here: <a href="https://registry.fhir.org/package/basisprofil.de|0.2.30">https://registry.fhir.org/package/basisprofil.de|0.2.30</a></p>
<p>A few things to note about it:</p>
<ul>
<li>There is actually a new version (0.2.40)</li>
<li>It is based on FHIR STU3</li>
</ul>
<p>Since it is based on FHIR STU3, and SUSHI only supports FHIR R4, I cannot recommend using it in your own IG.  The version mismatch would cause problems.  It appears that SUSHI <em>does</em> allow you to indicate it as a dependency, but I think this is a bug in SUSHI -- as it <em>should</em> reject IGs that are from a different major version of FHIR from the IG that depends on them.</p>
<p>We don't currently have any plans to support FHIR STU3 in SUSHI, so unfortunately I don't think you'll be able to depend on this IG until it has an R4 version -- or you'll need to develop your own IG using a different tool that supports FHIR STU3.</p>



<a name="230522019"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230522019" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Körlinge <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230522019">(Mar 16 2021 at 14:33)</a>:</h4>
<p>Thank you <span class="user-mention" data-user-id="191469">@Chris Moesel</span> ! I have located a R4 alpha version to use instead at <a href="https://simplifier.net/Basisprofil-DE-R4/~introduction">https://simplifier.net/Basisprofil-DE-R4/~introduction</a>. And Sushi compiles without errors with</p>
<div class="codehilite"><pre><span></span><code>dependencies:
  de.basisprofil.r4:
     uri: http://fhir.de/ImplementationGuide/basisprofil-de-r4
     version: 1.0.0-alpha9
</code></pre></div>
<p>It really was some detective work to find the URI - going to the package files and finding the implementation guide. Is there supposed to be a simpler way to find out which URI to depend on for packages? <br>
I haven't tried to extend anything from it yet though so it remains to be seen if that works.</p>



<a name="230526908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230526908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230526908">(Mar 16 2021 at 14:58)</a>:</h4>
<p>Thanks for the update, <span class="user-mention" data-user-id="397998">@Max Körlinge</span>.  I'm glad that there is an R4 version!</p>
<p>When SUSHI downloads the package, it tries to find the IG URL itself by looking through any <code>ImplementationGuide</code> resources found in the package.  When it does that, it is looking specifically for an <code>ImplementationGuide</code> with a <code>packageId</code> value matching the package id in your declared dependencies.  It looks like Simplifier does not populate the <code>ImplementationGuide.packageId</code> field -- so it doesn't recognize the IG file as a match.  <span class="user-mention" data-user-id="203235">@Ward Weistra</span> -- is there a reason Simplifier does not populate <code>packageId</code> or is this something you could potentially support in the future?</p>



<a name="230531383"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230531383" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Körlinge <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230531383">(Mar 16 2021 at 15:20)</a>:</h4>
<p>Is the URI I input in the dependencies section correct then? To refer directly to the implementation guide uri? </p>
<p>As you can tell, I am a beginner with FSH and FHIR as well <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> just a developer who has to define a profile based on the german national one for our startup. FSH appealed to me because it is code, which I'm used to working with. If I want to create a profile based on one of the german profiles - take for example this one <a href="https://simplifier.net/Basisprofil-DE-R4/VitalSignDE/~overview">https://simplifier.net/Basisprofil-DE-R4/VitalSignDE/~overview</a> - how would I reference that in the "Parent" section of my profile?</p>
<div class="codehilite"><pre><span></span><code>Profile: MyObservation
Parent: http://fhir.de/StructureDefinition/observation-de-vitalsign
</code></pre></div>
<p>or</p>
<div class="codehilite"><pre><span></span><code>Profile: MyObservation
Parent:  VitalSignDE
</code></pre></div>
<p>both give me <code>Structure Definition ... is missing snapshot. Snapshot is required for import</code> error. I am not sure if this means that the dependency failed to import correctly or if it means I am putting the wrong thing in "Parent" - or if I am completely doing the wrong thing here</p>
<p>If there is some documentation that deal with this usecase (extending/profiling from another IG/profile) please direct me there, I haven't been able to find any through google :/</p>



<a name="230538588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230538588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230538588">(Mar 16 2021 at 16:00)</a>:</h4>
<p>Either approach (full canonical URL or formal name) is valid for indicating the parent.  The issue you are running into here is separate... The dependency package that was downloaded apparently does not include the <code>snapshot</code> section in its profiles -- and SUSHI requires the snapshot in order to process the parent definition correctly.  I'm not sure the best way forward here, so I will tag a few people and then present one potential approach.</p>
<ul>
<li>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> -- At one point a while ago, you suggested that you might build in an option on the validator to update a package in the FHIR cache w/ snapshots.  I don't see any documentation about this, so I'm assuming that has not been implemented, but wanted to double-check.</p>
</li>
<li>
<p><span class="user-mention" data-user-id="203235">@Ward Weistra</span>  -- Can you remind me what the current thinking is on this topic?  Is Simplifier considering publishing w/ snapshots?  Do you have any suggestions for how users can use SUSHI w/ published IGs having no snapshots?</p>
</li>
</ul>
<p>Here is a workaround you can use if you'd like.  It's clunky, but it should work:</p>
<ol>
<li>Go to the specific package you want on Simplifier (from the project, click "Packages" tab, then click the specific package)</li>
<li>On the top right, click "Download" and then "Download snapshots" (note: you must be logged in)</li>
<li>This will download a <code>.tgz</code> file representing the package (e.g., <code>de.basisprofile.r4-1.0.0-alpha9.tgz</code>)</li>
<li>Find the corresponding folder in your FHIR cache.  For example, on a mac, this is likely something like: <code>~/.fhir/packages/de.basisprofil.r4#1.0.0-alpha9</code>.  If the folder doesn't exists, create it.  If the folder does exist, delete its contents.</li>
<li>Unzip the <code>.tgz</code> into that folder in your FHIR cache</li>
<li>You've just replaced the package in your cache w/ one that has snapshots, so SUSHI should work now.</li>
</ol>
<p>That's not ideal.  I know.  If someone has any better approaches, I'd love to hear them!</p>



<a name="230565205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230565205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Körlinge <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230565205">(Mar 16 2021 at 18:18)</a>:</h4>
<p>Thanks a lot Chris! For my usecase, since I will only be using one external profile, the workaround will do just fine (I will try it tomorrow in practice). If I have time I will try to write some blog post on this process when it's done for posterity =)</p>



<a name="230585367"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230585367" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230585367">(Mar 16 2021 at 20:27)</a>:</h4>
<p><span class="user-mention" data-user-id="397998">@Max Körlinge</span> -- that would be splendid!  SUSHI and FSH are still young -- so we're still working through things like this, especially as it relates to interaction w/ other tools in the ecosystem... Let me know if you run into any issues trying this out.</p>



<a name="230725234"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230725234" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230725234">(Mar 17 2021 at 16:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> <br>
On pointing to the package from the IG resource: Yes, we look at this next sprint. In our publishing process this wasn't straightforward, but indeed it's mandatory in R4.</p>
<p>On snapshots in packages: Indeed, we discussed this before and I see why this would be useful for non-Java and .NET based tooling. From a technical standpoint we've never been a fan of it because it bloats the size of packages by quite a bit and snapshot generation between the stacks isn't consistent enough to rely on each other's snapshots (although it's being worked on).</p>
<p>On top of that there's also practical impossibilities I learned today: Packages can specify wildcard dependencies, like <a href="https://simplifier.net/nictizstu3-questionnaires/package">this Nictiz project</a> is specifying a dependency on the latest version of the <code>2.0.x</code> range of versions of the <code>nictiz.fhir.nl.stu3.zib2017</code> package. That makes the snapshots of the package necessarily a function of time. Including snapshots would require to update the package every time a new dependency package is added to the range, which would change the NPM API checksum and break the promise of never changing packages.</p>
<p>The 'Download with Snapshots' option you referred to, which we provide on any package page, will calculate the snapshots at that time. And perhaps we can provide that via a non-NPM (because changing packages with changing checksums) API, although that might not in an acceptable time frame.<br>
Would it be an option to add a Java or .NET based 'calculate the snapshots we need' step to sushi? I understand you'd prefer to prevent that dependency if possible, but I'm not sure if there's a good alternative.</p>



<a name="230758672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230758672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230758672">(Mar 17 2021 at 20:12)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="203235">@Ward Weistra</span>.  Oh, that is complex, isn't it?  I also was not aware of wildcard dependencies like you describe (although <code>current</code> is a type of wildcard I guess).</p>
<p>I have to admit, though, I was under the impression that a given package version represented the state of affairs as of when that package was released.  While a wildcard dependency is fine during the development cycle, I'd suggest that all dependencies must be fixed to specific versions at publication time.  Otherwise it seems to me we could land in a real interoperability mess.  What does it mean for a system to support <code>Acme 1.2.0</code> if the technical definition of <code>Acme 1.2.0</code> can change at any moment?  FHIR packages aren't software -- they are formal specifications; so it seems to me that introducing the possibility of unpredictable variation in a published release is a real problem.</p>
<p>That's probably a whole different conversation that should be had somewhere else though.  If it's impractical for you to publish packages w/ snapshots I think we can try to find some other creative solutions.  One could be to invoke the Java tools to generate the snapshots (although that raises some other questions). Another could be to add a switch to SUSHI to automate steps 4-6 above for any <code>tgz</code> package (or to support loading a <code>tgz</code>package dependency in place). Another would be Grahame's idea of supporting a mode on the validator that populates snapshots for a package already in the FHIR cache...</p>



<a name="230830282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230830282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230830282">(Mar 18 2021 at 08:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> I understand your worry with wildcards, but it also solves entire trees of dependencies updating only for trivial changes. In the spec the standard wildcards of NPM have already been <a href="https://confluence.hl7.org/pages/viewpage.action?pageId=35718629#NPMPackageSpecification-Versionreferences">limited to the patch version number only</a>. So, changes SHOULD only be trivial and not impact conformance. (another reason why we should understand and apply good semver versioning in the FHIR community for packages...)</p>
<p>Some way to have the Java (validator?) or .NET (via <a href="http://Simplifier.net">Simplifier.net</a> download or Firely Terminal) stack calculate the correct snapshots at a certain timepoint would indeed work. Such a tool should also look at the wildcard dependencies and update any dependency packages if needed and (re)calculate the snapshots if needed.</p>



<a name="230840011"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230840011" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230840011">(Mar 18 2021 at 10:21)</a>:</h4>
<p><span class="user-mention" data-user-id="397998">@Max Körlinge</span> if you have any questions regading the german base profiles, please join us in <a href="#narrow/stream/179183-german-(d-a-ch)">https://chat.fhir.org/#narrow/stream/179183-german-(d-a-ch)</a></p>



<a name="230854577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/230854577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Körlinge <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#230854577">(Mar 18 2021 at 12:33)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="191450">@Simone Heckmann</span></p>



<a name="233326518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233326518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233326518">(Apr 06 2021 at 14:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/Dependencies/near/230585367">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="397998">Max Körlinge</span> -- that would be splendid!  SUSHI and FSH are still young -- so we're still working through things like this, especially as it relates to interaction w/ other tools in the ecosystem... Let me know if you run into any issues trying this out.</p>
</blockquote>
<p>This is still an issue i'd like to support to fix. <span class="user-mention" data-user-id="191469">@Chris Moesel</span> Would a java cli tool help you which does the snapshot generation for you help?</p>



<a name="233326663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233326663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233326663">(Apr 06 2021 at 14:20)</a>:</h4>
<p>If yes i can probably help.</p>



<a name="233327090"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233327090" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233327090">(Apr 06 2021 at 14:23)</a>:</h4>
<p>This tool then would snapshot a package and then..? I don't like the idea of overwriting a package in the fhir cache too much, also i don't like creating snapshots every run.<br>
What about adding the snapshots to the sushi project?</p>



<a name="233370086"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233370086" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233370086">(Apr 06 2021 at 18:52)</a>:</h4>
<p>Ideally there would be a JS snapshot generator, but I'm not aware of any.  <span class="user-mention" data-user-id="191782">@Brian Kaney</span> -- your shop hasn't done anything like that, has it?  Assuming not then we could potentially launch a Java jar to generate a snapshot -- but I do have a few concerns there:</p>
<ul>
<li>We'd have to rely on the user having Java installed correctly.</li>
<li>We'd also need to figure out where the jar comes from (do we package it in our npm package, download it on the fly, etc).</li>
<li>As you noted, we'd probably want some caching mechanism so we don't run snapshot generation every time.</li>
<li>It wouldn't work on web-based versions of SUSHI (e.g., FSH Online).</li>
</ul>
<p>But those all may be worth it in order to have a working solution for folks using packages without snapshots.</p>
<p>Another potential approach would be to use a web service that does snapshot generation on the fly, but we're not in the position to host such a thing, so someone else would need to provide that.</p>
<p>And one more approach would be to better automate some (or all???) of the steps I noted above (assuming that  90+% of the snapshot-less IGs are coming from Simplifier).</p>



<a name="233373318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233373318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233373318">(Apr 06 2021 at 19:16)</a>:</h4>
<blockquote>
<p>We'd also need to figure out where the jar comes from (do we package it in our npm package, download it on the fly, etc).</p>
</blockquote>
<p>The <a href="https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator">FHIR Java validator</a> has the capability to generate snapshots for a profile with the  -snapshot option.</p>



<a name="233445750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233445750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233445750">(Apr 07 2021 at 07:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/Dependencies/near/233370086">said</a>:</p>
<blockquote>
<p>And one more approach would be to better automate some (or all???) of the steps I noted above (assuming that  90+% of the snapshot-less IGs are coming from Simplifier).</p>
</blockquote>
<p>Yes the easiest solution would be that all FHIR packages are containing Snapshots.</p>



<a name="233445836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233445836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233445836">(Apr 07 2021 at 07:41)</a>:</h4>
<p>Second easiest would be a webservice as a proxy to the fhir package registry, snapshoting and caching the packages</p>



<a name="233450520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233450520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233450520">(Apr 07 2021 at 08:24)</a>:</h4>
<p>The <code>.fhir</code> FHIR cache folder currently contains a <code>packages</code> directory. Tools not being able to generate snapshots themselves could perhaps use a sibling <code>packages-with-snapshots-added</code> folder with the same setup? Not a source of original truth, but a derived folder from the content of <code>packages</code>.<br>
That could then be populated with the Java Validator or Firely Terminal. This would be cleanest given that range dependencies will update and that snapshot generation is not a fixed art yet.</p>
<p>We can also look into making the 'download package with snapshots' endpoint from Simplifier available as an API, but that would then probably be a non-NPM API with some free rate limit per user. I wouldn't want two competing FHIR Package Registry NPM APIs. And preferably not any packages in <code>packages-with-snapshots-added</code> that are not in <code>packages</code>, because then other tools can't necessarily reuse an already downloaded package.</p>



<a name="233450870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233450870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233450870">(Apr 07 2021 at 08:27)</a>:</h4>
<p>i like the idea of the <code>packages-with-snapshots-added</code>folder next to the package folder</p>



<a name="233451373"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233451373" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233451373">(Apr 07 2021 at 08:32)</a>:</h4>
<p>Are the current packages in the cache without snapshots?</p>



<a name="233451435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233451435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233451435">(Apr 07 2021 at 08:33)</a>:</h4>
<p>mixed, All IG Publisher packages are including snapshot, Simplifier doesn't</p>



<a name="233451480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233451480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233451480">(Apr 07 2021 at 08:33)</a>:</h4>
<p>The FHIR package spec doesn't state anything on snapshot vs no snapshot</p>



<a name="233452416"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/233452416" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#233452416">(Apr 07 2021 at 08:42)</a>:</h4>
<p>ok, thanks</p>



<a name="240978923"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/240978923" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Janaka Peiris <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#240978923">(Jun 01 2021 at 17:49)</a>:</h4>
<p>(deleted)</p>



<a name="241158640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/241158640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#241158640">(Jun 02 2021 at 14:42)</a>:</h4>
<p>What can be done here?</p>



<a name="241158961"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/241158961" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#241158961">(Jun 02 2021 at 14:44)</a>:</h4>
<p>I think I also like the idea of a sibling, but could it be under the same package structure? <br>
i.e. could a package contain two sets of files, one with and the other without the snapshots? or is that really another package (which makes it simpler to implement, but I guess harder to maintain)</p>



<a name="241159076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/241159076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#241159076">(Jun 02 2021 at 14:45)</a>:</h4>
<p>alternatively: <br>
could Simplifier open the downloads of snapshot-enabled packages (no login needed), and sushi always get those?</p>



<a name="241159260"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/241159260" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#241159260">(Jun 02 2021 at 14:46)</a>:</h4>
<p>Or we could include an extension in the IG dependsOn to indicate forcing the snapshots.<br>
So that IG-publisher / sushi is in control of which package to download</p>



<a name="241373994"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/241373994" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#241373994">(Jun 03 2021 at 10:46)</a>:</h4>
<p><span class="user-mention" data-user-id="218656">@Robin Bosman</span></p>



<a name="243800938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243800938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243800938">(Jun 24 2021 at 15:12)</a>:</h4>
<p>as i  am still needing a solution i'll probably going to implement a small java application, checking the dependencies in the sushi config yaml, downloading them and checking if snapshots are available and building snapshots for the ones that don't have them.</p>



<a name="243801163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243801163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243801163">(Jun 24 2021 at 15:14)</a>:</h4>
<p>to not overwrite the package cache i would like to add them to a folder sibling<code>packages-with-snapshots-added</code>folder of the package folder.</p>



<a name="243801469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243801469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243801469">(Jun 24 2021 at 15:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> could sushi be configured to first look into the sibling folder for needed dependencies before doing the rest of the package loading?</p>



<a name="243810802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243810802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243810802">(Jun 24 2021 at 16:25)</a>:</h4>
<p>Thank you Patrick. It would be good if a proper solution is found for this (I'd use your patch if you make it available, but I just want to keep pointing to where it hurts)</p>



<a name="243814320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243814320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243814320">(Jun 24 2021 at 16:51)</a>:</h4>
<p>it won't be a patch, rather a pre-processor. Without sushi looking into the proposed folder i would have to overwrite packages in the cache</p>



<a name="243814483"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243814483" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243814483">(Jun 24 2021 at 16:52)</a>:</h4>
<p>If sushi would search in another folder first (or only, handled by the settings) we won't have to overwrite existing cached packages</p>



<a name="243814544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243814544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243814544">(Jun 24 2021 at 16:52)</a>:</h4>
<p>That's an interesting idea, <span class="user-mention" data-user-id="191451">@Patrick Werner</span>.  It sounds like a reasonable approach, but let me discuss it w/ the team before I commit to anything!  The one wrinkle that still exists is that these IGs would still fail in an autobuild environment since the autobuild won't have the special snapshot folder in the cache.</p>



<a name="243814614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243814614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243814614">(Jun 24 2021 at 16:53)</a>:</h4>
<p>then the autobuild would habe to pre-process the sushi file as well...?</p>



<a name="243814738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243814738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243814738">(Jun 24 2021 at 16:54)</a>:</h4>
<p>Right.  Which means we'd need to tie in Josh or someone else who knows how to work w/ the autobuild too.</p>



<a name="243814766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243814766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243814766">(Jun 24 2021 at 16:54)</a>:</h4>
<p><span class="user-mention" data-user-id="203235">@Ward Weistra</span> what do you think about including snapshots into packages with only stable dependeny trees? You wouldn't have to watch for the whole tree all the time, as everything has to be declared to a specific version</p>



<a name="243815874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243815874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243815874">(Jun 24 2021 at 17:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/Dependencies/near/243814738">said</a>:</p>
<blockquote>
<p>Right.  Which means we'd need to tie in Josh or someone else who knows how to work w/ the autobuild too.</p>
</blockquote>
<p>not necessarily right now, the autobuilder is already failing with non-snapshoted packages. So no change here.</p>



<a name="243847824"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243847824" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243847824">(Jun 24 2021 at 21:14)</a>:</h4>
<p>We can do something in the scripts.<br>
We could also do it on the github workflows, but I think this should be deeper in the tools (i.e. inside sushi which is where the complaints show, or inside the autobuild that the github workflows rely on). <br>
I did <a href="https://github.com/HL7/fhir-ig-publisher/issues/282">ask for a solution in the publisher</a> itself</p>



<a name="243901282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243901282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243901282">(Jun 25 2021 at 11:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> <span class="user-mention" data-user-id="191469">@Chris Moesel</span> <span class="user-mention" data-user-id="191832">@Jose Costa Teixeira</span>  I'll admit I went back and forth on this, but think we should start including them, even on the ranged dependencies. Talking to <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> I learned snapshots were always meant from the FHIR spec as a convenience cache so not every tool would need to understand the snapshot generation logic.<br>
Downstream tools (incl sushi) should keep in mind that snapshots are basically a cache, however, which they are allowed to recreate when they have reason to suspect the cache to be outdated (e.g. on ranged dependencies or changes to snapshot generation logic in a toolstack).</p>
<p>Our backlog is long however, so I don't have a time estimation of when we get around to this exactly. Something to balance with other customer needs.<br>
I also expect only to start adding snapshots for newly created package versions (cause we cannot change existing package versions), and will not necessarily check incoming packages via the package feeds for this. So packages without snapshots won't be history any time soon and it would be good to give users a way to use them. Even if only explaining the procedure how to generate or download from Simplifier with snapshots and use those.</p>



<a name="243911170"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/243911170" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#243911170">(Jun 25 2021 at 12:53)</a>:</h4>
<p><span class="user-mention" data-user-id="203235">@Ward Weistra</span> -- That's great!  I think that will help everything go more smoothly in the future (at least for us!).  Thanks for thinking through all the implications for this. Currently the download from Simplifier requires a log-in.  I don't suppose it's any quicker/easier to expose that as a more standard API, is it?  If so, it might be worth considering as well, since that would take care of both past and future packages.</p>



<a name="245552285"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/245552285" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#245552285">(Jul 10 2021 at 14:06)</a>:</h4>
<p>Kind of related to this, how does fsh get the packages / where does it get it from when the IG depends on them? <br>
I have an IG and I want to do dependsOn, where I indicate the package id and url.  Does that url / package id need to be in the registry? (which registry?)</p>



<a name="245552325"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/245552325" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#245552325">(Jul 10 2021 at 14:07)</a>:</h4>
<p>Use scenario - I have a "core" ig and I want to dependOn it for my purpose-specific IGs. the IG is published, with packages and redirects accessible, but Sushi doesn't get the package</p>



<a name="245725313"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/245725313" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#245725313">(Jul 12 2021 at 18:13)</a>:</h4>
<p>(deleted)</p>



<a name="245725946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/245725946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#245725946">(Jul 12 2021 at 18:19)</a>:</h4>
<p>There are a few places we load packages from:</p>
<ul>
<li>First, we try to find it in the local FHIR cache by id and version.  If it's there, that is what we use.</li>
<li>If the package version is <code>current</code>, we grab the <a href="http://build.fhir.org/ig">qas.json file</a> from <code>build.fhir.org</code> and use that to try to find the last build.</li>
<li>Otherwise, we try to find it on <a href="http://packages.fhir.org">packages.fhir.org</a> via <code>http://packages.fhir.org/${packageId}/${version}</code>.</li>
<li>If it's not there and the package is R4B or R5, we try <a href="http://packages2.fhir.org">packages2.fhir.org</a> via <code>http://packages2.fhir.org/packages/${packageId}/${version}</code></li>
</ul>



<a name="245728189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/245728189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#245728189">(Jul 12 2021 at 18:36)</a>:</h4>
<p>I noticed that if the dependency is set to 'current' but it has only been built locally then it won't find it. You have to set it to 'dev'</p>



<a name="245747744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/245747744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#245747744">(Jul 12 2021 at 20:59)</a>:</h4>
<p>Yeah, <code>current</code> specifically means the current build from the CI server.  <code>dev</code> means the latest local build.  If there is no <code>dev</code> locally, it will fall back to <code>current</code>.  But not the other way around.</p>



<a name="245757237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/245757237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#245757237">(Jul 12 2021 at 22:14)</a>:</h4>
<p>Is this documented somewhere? (sorry if i missed it). If not, should it?</p>



<a name="246226159"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/246226159" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#246226159">(Jul 16 2021 at 13:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> To make the 'related questions' chain even longer: How do you resolve dependencies from packages? Just downloading every package, opening up the package.json, reading the dependencies and dowload those all the way down?</p>



<a name="246226821"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/246226821" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#246226821">(Jul 16 2021 at 14:03)</a>:</h4>
<p>Also, on the packages with snapshots front: Our first approach to providing everyone with a solution is to implement a 'generate snapshots for these packages/my dependencies/my entire package cache' as a (free) feature in Firely Terminal. Snapshotting individual resources was already there and the size increase and processing burden are taken up by the consumer' machine. Testing the first release with this internally now.</p>



<a name="246456463"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/246456463" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#246456463">(Jul 19 2021 at 13:45)</a>:</h4>
<p><span class="user-mention" data-user-id="203235">@Ward Weistra</span>, unless I'm misunderstanding, you're asking how we handle dependencies of dependencies? So for example if package <code>A</code> is an explicit dependency, but then package <code>A</code> depends on package <code>B</code>. In SUSHI we don't actually need package <code>B</code>, since if the definitions in <code>A</code> have their snapshot (which we require), that is all of the information that SUSHI needs. So SUSHI only resolves explicitly listed dependencies.</p>



<a name="246478464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/246478464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#246478464">(Jul 19 2021 at 16:32)</a>:</h4>
<p><span class="user-mention" data-user-id="239822">@Nick Freiter</span> Thanks! That explains. <span class="user-mention" data-user-id="191335">@Martijn Harthoorn</span> wondered, since it apparently isn't trivial <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="246616914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/246616914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#246616914">(Jul 20 2021 at 16:40)</a>:</h4>
<p>Yeah, we don't do that at all.  I think there may be a few cases that perhaps it could cause an issue (in rare cases where we need to walk the full inheritance tree and a parent is from a transitive dependency) -- but those cases are very rare and have not yet come up in practice.  In that case, we'd probably just suggest explicitly listing the transitive dependency -- at least for now.  It may be something we need to reconsider in the future though.</p>



<a name="248396516"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/248396516" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#248396516">(Aug 04 2021 at 19:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/Dependencies/near/245725946">said</a>:</p>
<blockquote>
<p>There are a few places we load packages from:</p>
<ul>
<li>First, we try to find it in the local FHIR cache by id and version.  If it's there, that is what we use.</li>
<li>If the package version is <code>current</code>, we grab the <a href="http://build.fhir.org/ig">qas.json file</a> from <code>build.fhir.org</code> and use that to try to find the last build.</li>
<li>Otherwise, we try to find it on <a href="http://packages.fhir.org">packages.fhir.org</a> via <code>http://packages.fhir.org/${packageId}/${version}</code>.</li>
<li>If it's not there and the package is R4B or R5, we try <a href="http://packages2.fhir.org">packages2.fhir.org</a> via <code>http://packages2.fhir.org/packages/${packageId}/${version}</code></li>
</ul>
</blockquote>
<p>Can someone clarify how <code>qas.json</code> is used? What <em>branches</em> of a given dependency are counted toward matching the "current"? Is this limited to main/master, or is there external logic? Otherwise there's a risk taht updates to some random branch on a project might be counted as "the most current" version of a dependency.</p>



<a name="248396712"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/248396712" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#248396712">(Aug 04 2021 at 19:28)</a>:</h4>
<p>(Reading this in light of recent challenges from <a class="stream" data-stream-id="179252" href="/#narrow/stream/179252-IG-creation">#IG creation</a> -- I totally didn't realize that qas.json was being used as a source of truth for anything.)</p>



<a name="248406990"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/248406990" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#248406990">(Aug 04 2021 at 20:48)</a>:</h4>
<p>For SUSHI, the <code>qas.json</code> file is used to find all packages that match the <code>package-id</code> of the desired package. Those packages are then sorted by <code>date</code>, and the newest package is selected. There is no checking based on branch, which does definitely seem like an issue as you pointed out. For my understanding, does the autobuild only publish packages based on the <code>master</code> or <code>main</code> branch of a repo? Or is that something that could vary?</p>



<a name="248407068"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/248407068" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#248407068">(Aug 04 2021 at 20:49)</a>:</h4>
<p>Here is the pseudocode from the IG Publisher that we used to implement our package resolution in SUSHI: <a href="#narrow/stream/215610-shorthand/topic/dev.20dependencies/near/195252120">https://chat.fhir.org/#narrow/stream/215610-shorthand/topic/dev.20dependencies/near/195252120</a>. Our goal is to match the IG Pub behavior.</p>



<a name="248418876"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/248418876" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#248418876">(Aug 04 2021 at 22:51)</a>:</h4>
<p>Thanks Nick! Yeah, we'll need to figure out how to pin these down. Discussion continuing on that thread on <a class="stream" data-stream-id="179252" href="/#narrow/stream/179252-IG-creation">#IG creation</a> .</p>



<a name="265194851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/265194851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#265194851">(Dec 16 2021 at 18:04)</a>:</h4>
<p>I tried to build a sushi project that has dependencies on some IHE published IGs. they could not be found. I used the same coordinates that I see <span class="user-mention" data-user-id="191478">@Oliver Egger</span> was able to use in a classic xml based IG. In sushi-config.yaml</p>
<div class="codehilite"><pre><span></span><code>dependencies:
  ihe.mhd.fhir:
    id: ihemhdfhir
    uri: http://profiles.ihe.net/ITI/MHD/ImplementationGuide/ihe.mhd.fhir
    version: 4.0.3
  IHE.ITI.PDQm:
    id: ihepdqm
    uri: http://profiles.ihe.net/ITI/PDQm/ImplementationGuide/IHE.ITI.PDQm
    version: 2.3.1
</code></pre></div>
<p>sushi error about these is <code>could not be loaded locally or from the FHIR package registry.</code></p>
<p>These are registered in the old and new systems.</p>



<a name="265196883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/265196883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#265196883">(Dec 16 2021 at 18:16)</a>:</h4>
<p>never mind... chair-to-keyboard interface problem.. Need to use formal release numbers, not current CI build. duh</p>



<a name="267984139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/267984139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas Tveit Rosenlund <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#267984139">(Jan 14 2022 at 08:29)</a>:</h4>
<p>I still have a problem. After changing my dependency in the sushi-config.yaml to this: </p>
<div class="codehilite"><pre><span></span><code>dependencies:
    hl7.fhir.no.basis: 2.1.1
</code></pre></div>
<p>I finally get to load the package into the sushi/ig-publisher workflow. However soon after it complains:</p>
<div class="codehilite"><pre><span></span><code>Publishing Content Failed: The package &#39;hl7.fhir.no.basis&#39; has no entry on the current build server
</code></pre></div>
<p>Looks like it only tries to resolve on <a href="http://build.fhir.org">build.fhir.org</a>. Any ideas? The package is built and published using SIMPLIFIER. <span class="user-mention" data-user-id="191469">@Chris Moesel</span></p>



<a name="268021400"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268021400" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268021400">(Jan 14 2022 at 14:36)</a>:</h4>
<p>I think that error message comes from the IG Publisher (not SUSHI), so I'm not sure what it means.  I have not seen it before.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> - what does <code>Publishing Content Failed: The package 'hl7.fhir.no.basis' has no entry on the current build server</code> mean, and how can Thomas fix it?</p>



<a name="268036563"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268036563" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas Tveit Rosenlund <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268036563">(Jan 14 2022 at 16:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/Dependencies/near/268021400">said</a>:</p>
<blockquote>
<p>I think that error message comes from the IG Publisher (not SUSHI), so I'm not sure what it means.  I have not seen it before.  <span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> - what does <code>Publishing Content Failed: The package 'hl7.fhir.no.basis' has no entry on the current build server</code> mean, and how can Thomas fix it?</p>
</blockquote>
<p>I think you are right <span class="user-mention" data-user-id="191469">@Chris Moesel</span> . My mistake.</p>
<p>The problem, I think, is that I use the hl7 provided docker build image in my Github action script (this works fine for building things that are not dependent on other packages): </p>
<div class="codehilite"><pre><span></span><code>- name: 🏃‍♂️ Run IG Publisher
        uses: docker://hl7fhir/ig-publisher-base:latest
        with:
          args: java -jar publisher.jar publisher -ig ${{ env.IG }}/ig.ini -publish https://hl7norway.github.io/no-domain-vitalsigns/
</code></pre></div>
<p>And I suppose that is the same thing running on the  <a href="http://build.fhir.org">build.fhir.org</a>. The problem is that this image only recognizes packages that are built and distributed using that workflow. This is my current interpretation of the error.</p>
<p>So how to solve it. I suppose I can do two tings.</p>
<ol>
<li>Build another version of my docker build image, that contains the no-basis package and see if that works.</li>
<li>Import all dependencies in the Github action and run the IG publisher there (not using docker image), in that case I can probably import the dependencies the normal way using an npm install command. The flip side would be that I use a lot of Github runtime just setting up my IG publisher build environment on the virtual ubuntu node running the script.</li>
</ol>



<a name="268037535"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268037535" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268037535">(Jan 14 2022 at 16:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> - do you have any insight/guidance here?</p>



<a name="268047144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268047144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268047144">(Jan 14 2022 at 17:41)</a>:</h4>
<p>I don't know why this is happening. hl7.fhir.no.basis#2.1.1 is found on <a href="http://packages.fhir.org">packages.fhir.org</a>, so it should just automatically resolve</p>



<a name="268047175"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268047175" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268047175">(Jan 14 2022 at 17:41)</a>:</h4>
<p>do you get any messages in the output related to hl7.fhir.no.basis ?</p>



<a name="268055617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268055617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas Tveit Rosenlund <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268055617">(Jan 14 2022 at 18:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/215610-shorthand/topic/Dependencies/near/268047175">said</a>:</p>
<blockquote>
<p>do you get any messages in the output related to hl7.fhir.no.basis ?</p>
</blockquote>
<p>Actually yes. Sushi says it downloads the package OK:</p>
<div class="codehilite"><pre><span></span><code>Sushi: info  Running SUSHI v2.2.6 (implements FHIR Shorthand specification v1.2.0) (00:00.0527)
Sushi: info  Arguments:                                                          (00:00.0528)
Sushi: info    --out /github/workspace/VitalSigns                                (00:00.0530)
Sushi: info    /github/workspace/VitalSigns                                      (00:00.0531)
Sushi: info  Using configuration file: /github/workspace/VitalSigns/sushi-config.yaml (00:00.0534)
Sushi: info  Importing FSH text...                                               (00:00.0545)
Sushi: info  Preprocessed 91 documents with 25 aliases.                          (00:00.0900)
Sushi: info  Imported 76 definitions and 14 instances.                           (00:00.0963)
Sushi: info  Checking local cache for hl7.fhir.no.basis#2.1.1...                 (00:00.0966)
Sushi: info  Did not find hl7.fhir.no.basis#2.1.1 in local cache.                (00:00.0967)
Sushi: info  Downloading hl7.fhir.no.basis#2.1.1...                              (00:00.0969)
Sushi: info  Checking local cache for hl7.fhir.r4.core#4.0.1...                  (00:00.0985)
Sushi: info  Did not find hl7.fhir.r4.core#4.0.1 in local cache.                 (00:00.0988)
Sushi: info  Downloading hl7.fhir.r4.core#4.0.1...                               (00:00.0990)
Sushi: info  Downloaded hl7.fhir.no.basis#2.1.1                                  (00:01.0662)
Sushi: info  Loaded package hl7.fhir.no.basis#2.1.1                              (00:01.0697)
Sushi: info  Downloaded hl7.fhir.r4.core#4.0.1                                   (00:04.0113)
Sushi: info  Loaded package hl7.fhir.r4.core#4.0.1                               (00:05.0833)
Sushi: info  Converting FSH to FHIR resources...                                 (00:05.0948)
Sushi: info  Converted 51 FHIR StructureDefinitions.                             (00:13.0352)
</code></pre></div>



<a name="268055875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268055875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas Tveit Rosenlund <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268055875">(Jan 14 2022 at 18:50)</a>:</h4>
<p>But the IG-publisher build process still can't find it.<br>
The complete log is here:</p>
<div class="codehilite"><pre><span></span><code>https://github.com/HL7Norway/no-domain/runs/4815170074?check_suite_focus=true
</code></pre></div>



<a name="268057526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268057526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268057526">(Jan 14 2022 at 19:02)</a>:</h4>
<p>I'm not sure why you don't use the normal structure for an IG, so that it runs using the usual infrastructure</p>



<a name="268058327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268058327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268058327">(Jan 14 2022 at 19:08)</a>:</h4>
<p>anyway that means I can't investigate and don't know how to reproduce</p>



<a name="268063018"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268063018" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268063018">(Jan 14 2022 at 19:49)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> -- I was able to reproduce this with just the standard publisher.  Here are the steps:</p>
<ol>
<li><code>git clone git@github.com:HL7Norway/no-domain.git</code> or <code>git clone https://github.com/HL7Norway/no-domain.git</code></li>
<li><code>cd no-domain</code></li>
<li><code>git checkout feature/dipsfsh2-workflow</code></li>
<li><code>cd VitalSigns</code></li>
<li><code>sh _genonce.sh</code> or <code>_genonce.bat</code></li>
</ol>
<p>Things to note:</p>
<ul>
<li>Repo is <a href="https://github.com/HL7Norway/no-domain">https://github.com/HL7Norway/no-domain</a></li>
<li>Must use feature/dipsfsh2-workflow branch (master branch is not setup for publisher)</li>
<li>Must change directory to VitalSigns (root dir is not right directory format)</li>
</ul>



<a name="268063594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268063594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268063594">(Jan 14 2022 at 19:54)</a>:</h4>
<p>It happens after <code>Load Package hl7.terminology.r4#3.0.0</code>.</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Stack Dump (for debugging)</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>org.hl7.fhir.exceptions.FHIRException: The package 'hl7.fhir.no.basis' has no entry on the current build server ({hl7.org.fhir.uv.cdisc-lab=https://build.fhir.org/ig/HL7/cdisc-lab, ihe.fhir.pharm.vac=https://build.fhir.org/ig/IHE/pharm-vaccination, hl7.be.fhir.vitalink.ig=https://build.fhir.org/ig/hl7-be/vitalink-ig, ch.ahdis.ig.cda-fhir-maps=https://build.fhir.org/ig/ahdis/cda-fhir-maps, hl7.fhir.bser=https://build.fhir.org/ig/holmesie/bser, au.csiro.fhir.au-primarycare=https://build.fhir.org/ig/aehrc/primary-care-data-technical, hl7.fhir.ca.core=https://build.fhir.org/ig/scratch-fhir-profiles/CA-Core, ch.fhir.ig.ch-epr-term=https://build.fhir.org/ig/hl7ch/ch-epr-term, openhie.fhir.hiv=https://build.fhir.org/ig/openhie/hiv-ig, ihe.fhir.template=https://build.fhir.org/ig/IHE/ihe-ig-template, hl7.fhir.us.bser=https://build.fhir.org/ig/HL7/bser, ihe.mhd.fhir=https://build.fhir.org/ig/IHE/ITI.MHD, openhie.fhir.template=https://build.fhir.org/ig/openhie/openhie-ig-template, hl7.fhir.us.davinci-hrex=https://build.fhir.org/ig/HL7/davinci-ehrx, hl7.fhir.us.carin-rtpbc=https://build.fhir.org/ig/HL7/carin-rtpbc, hl7.fhir.us.icsr-ae-reporting=https://build.fhir.org/ig/HL7/fhir-icsr-ae-reporting, hl7.fhir.us.sdoh-clinicalcare=https://build.fhir.org/ig/HL7/fhir-sdoh-clinicalcare, ch.fhir.ig.atc=https://build.fhir.org/ig/ahdis/ch-atc, hl7.dk.fhir.template=https://build.fhir.org/ig/hl7dk/dk-ig-template, hl7.fhir.us.carin-bb=https://build.fhir.org/ig/HL7/carin-bb, hl7.fhir.uv.sdc=https://build.fhir.org/ig/HL7/sdc, </p>
<p>&lt;snip&gt;Snipping out a long listing of what looks to be other projects&lt;/snip&gt;</p>
<p>hl7.fhir.us.ccda=https://build.fhir.org/ig/HL7/ccda-on-fhir, ch.hcisolutions.ig.analyzer=https://build.fhir.org/ig/ahdis/hci-analyzer, hl7.fhir.us.specialty-rx=https://build.fhir.org/ig/HL7/fhir-specialty-rx, hl7.fhir.be.riziv=https://build.fhir.org/ig/hl7-be/riziv-inami, hl7.org.nz.fhir.ig.medtech=https://build.fhir.org/ig/HL7NZ/medtech})<br>
    at org.hl7.fhir.utilities.npm.FilesystemPackageCacheManager.loadFromCIBuild(FilesystemPackageCacheManager.java:541)<br>
    at org.hl7.fhir.utilities.npm.FilesystemPackageCacheManager.loadPackage(FilesystemPackageCacheManager.java:503)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.resolveDependency(Publisher.java:3187)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.loadIg(Publisher.java:3027)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:2102)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1643)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:792)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:9033)</p>
</div></div>



<a name="268063608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268063608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268063608">(Jan 14 2022 at 19:54)</a>:</h4>
<p>thanks. I don't have time to investigate this stuff</p>



<a name="268064533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268064533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268064533">(Jan 14 2022 at 20:02)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> and <span class="user-mention" data-user-id="192856">@Thomas Tveit Rosenlund</span> - FOUND IT.  Thomas, your <code>ig.ini</code> does not point to the ImplemenationGuide JSON that SUSHI creates. It points to a different one.  So SUSHI and the IG Publisher are using two different configs.  While the SUSHI config points to <code>hl7.fhir.no.basis#2.1.1</code>, the IG resource that <code>ig.ini</code> points to specifies <code>hl7.fhir.no.basis#dev</code> (<a href="https://github.com/HL7Norway/no-domain/blob/feature/dipsfsh2-workflow/VitalSigns/input/ImplementationGuide-dips.fhir.r4.observations.ig.json">link</a>).  When the publisher can't find a local dev copy of a dependency, it falls back to looking for it on the build server.  So it all makes sense and is working as expected.</p>
<p>You need to either edit your ImplementationGuide JSON so the dependency is correct or you need to have <code>ig.ini</code> point to the ImplementationGuide JSON that SUSHI generates.</p>



<a name="268064904"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268064904" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268064904">(Jan 14 2022 at 20:04)</a>:</h4>
<p>good work. that would be why I recommend a standard set up</p>



<a name="268065730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268065730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268065730">(Jan 14 2022 at 20:10)</a>:</h4>
<p><span class="user-mention" data-user-id="192856">@Thomas Tveit Rosenlund</span> - I'd recommend either removing your custom ImplementationGuide JSON and just using the SUSHI-generated one, OR removing sushi-config.yaml so that SUSHI uses the ImplementationGuide JSON you've provided.  Either way, you end up with a single config, which is good.</p>



<a name="268113176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268113176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas Tveit Rosenlund <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268113176">(Jan 15 2022 at 08:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/Dependencies/near/268065730">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="192856">Thomas Tveit Rosenlund</span> - I'd recommend either removing your custom ImplementationGuide JSON and just using the SUSHI-generated one, OR removing sushi-config.yaml so that SUSHI uses the ImplementationGuide JSON you've provided.  Either way, you end up with a single config, which is good.</p>
</blockquote>
<p>Excactly. Thanks for the help <span class="user-mention" data-user-id="191469">@Chris Moesel</span> you just saved me hours of work, don't know if I would have figured that one out. </p>
<p>The problem is that I don't normaly use a separate ImplementationGuide resource, but the project responsible for these profiles did, and when I tried to put this one into the automated build process we are testing for the HL7 Norway base and domain profiles, it would not work out of the box.  The error messages did not make much sense to me as SUSHI clearly downloaded the package in question.  I will simply remove the IG-resource and make my configuration in the sushi-yaml file the way I use to. </p>
<p>Thanks again!</p>



<a name="268114020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268114020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Thomas Tveit Rosenlund <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268114020">(Jan 15 2022 at 08:27)</a>:</h4>
<p>And just like that, it works beautiflully. Have to fix the sushi-yaml to incorporate the rest of the documentation pages though.</p>
<div class="codehilite"><pre><span></span><code>https://github.com/HL7Norway/no-domain/runs/4825786507?check_suite_focus=true
</code></pre></div>



<a name="268394345"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Dependencies/near/268394345" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Dependencies.html#268394345">(Jan 18 2022 at 14:01)</a>:</h4>
<p>Yes, you'll need to move at least the page listing and any <code>parameters</code> values over to sushi-config.yaml.  The full sushi-config.yaml is documented <a href="https://fshschool.org/docs/sushi/configuration/#full-configuration">here</a>.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
