---
layout: page
title: "FHIR Chat  · Restrict Observation category · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html">Restrict Observation category</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="235635937"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235635937" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235635937">(Apr 22 2021 at 08:01)</a>:</h4>
<p>Hello,<br>
I would like to specify that a specific category coding (system=http://terminology.hl7.org/CodeSystem/observation-category code=laboratory) is present in the array of codeable concepts of <code>Observation.category</code>. Other codings should be allowed too and other codeableconcepts should be allowed. But the one I want to check needs to be present.</p>
<p>I tried the following:</p>
<div class="codehilite"><pre><span></span><code>Alias: ObsCategory = http://terminology.hl7.org/CodeSystem/observation-category

* category 1.. MS SU
* category = ObsCategory#laboratory
</code></pre></div>
<p>But this allowed category to only one codings of another system.</p>
<p>I also tried some slicing on <code>category</code>, but wasn't able to get to what I want. Here is what I tried:</p>
<div class="codehilite"><pre><span></span><code>* category 1..
* category ^slicing.discriminator.type = #pattern
* category ^slicing.discriminator.path = &quot;coding&quot;
* category ^slicing.rules = #open
* category ^slicing.description = &quot;Slice based on category.code pattern&quot;
* category contains labCategory  1..1 MS
* category[labCategory] = ObsCategory#laboratory
</code></pre></div>
<p>When trying to validate against the profile containing this slice, I'm getting the following error:<br>
<code>Internal error: Could not match discriminator ([coding]) for slice Observation.category:labCategory in profile https://.../lab-value - the discriminator [coding] does not have fixed value, binding or existence assertions</code></p>
<p>Any tips on how to accomplish my task? <br>
Thank you.</p>



<a name="235643627"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235643627" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235643627">(Apr 22 2021 at 09:09)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> I saw a similar category slicing here <a href="https://github.com/HL7/genomics-reporting/blob/master/input/fsh/CGGeneral.fsh">https://github.com/HL7/genomics-reporting/blob/master/input/fsh/CGGeneral.fsh</a> and was wondering how this worked for your team there?</p>



<a name="235644235"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235644235" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235644235">(Apr 22 2021 at 09:15)</a>:</h4>
<p>the difference is the last row:<br>
<code>* category[labCategory].coding = ObsCat#laboratory</code><br>
if you slice on coding, you have to set the pattern on coding as well</p>



<a name="235645433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235645433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235645433">(Apr 22 2021 at 09:26)</a>:</h4>
<p>Thank you <span class="user-mention" data-user-id="191451">@Patrick Werner</span>!  This shows me one mor time that men are no computers. I compared my implementation to the other one several times and could not find any differences. </p>
<p>Anyways, the problem is still not solved. Now I get a new error when trying to validate against the profile:<br>
<code>Failed to call access method: java.lang.Error: Error in profile  at Observation.category: Base isSummary = false, derived isSummary = true</code></p>



<a name="235672614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235672614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235672614">(Apr 22 2021 at 13:03)</a>:</h4>
<p>Are you doing something with <code>isSummary</code> or is that error coming out of the blue?</p>



<a name="235673347"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235673347" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235673347">(Apr 22 2021 at 13:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> No, I'm not setting any <code>SU</code> flag anywhere in this Profile.</p>



<a name="235674172"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235674172" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235674172">(Apr 22 2021 at 13:13)</a>:</h4>
<p>Then that error seems... odd.  Without seeing it, however, I can't tell if SUSHI is exporting something wrong in the SD JSON or if the IG Publisher is just doing something wacky on its own.  Is this publicly available somewhere?</p>



<a name="235676233"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235676233" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235676233">(Apr 22 2021 at 13:25)</a>:</h4>
<p>I just pushed the structuredefinition resource to my HAPI(SmileCDR) backend and then tried to validate a new instance using the <code>{baseUrl}/Observation/$validate</code> endpoint. The structure definition is created using sushi compile for this fsh code:<br>
<a href="https://fshschool.org/FSHOnline/#/share/2Qnas92">https://fshschool.org/FSHOnline/#/share/2Qnas92</a></p>



<a name="235676779"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235676779" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235676779">(Apr 22 2021 at 13:28)</a>:</h4>
<p>Strange, I tested it again now and validation succeeded. Maybe SmileCDR needed some time to "see" the updated profile? I have no clue what is going on. Thanks <span class="user-mention" data-user-id="191469">@Chris Moesel</span> for having a look.</p>



<a name="235677030"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235677030" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235677030">(Apr 22 2021 at 13:30)</a>:</h4>
<p>Ha.  OK.  I just started to look at it, but I'll stand down!</p>



<a name="235677749"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235677749" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235677749">(Apr 22 2021 at 13:34)</a>:</h4>
<p>While I'm looking, though... a few thoughts...  Re:</p>
<div class="codehilite"><pre><span></span><code>// Check category
* category 1..
* category ^slicing.discriminator.type = #pattern
* category ^slicing.discriminator.path = &quot;coding&quot;
* category ^slicing.rules = #open
* category ^slicing.description = &quot;Slice based on category.code pattern&quot;
* category contains labCategory  1..1 MS
* category[labCategory].coding = ObsCat#laboratory
</code></pre></div>
<p>This approach is fine and works.  I think you also could have done this:</p>
<div class="codehilite"><pre><span></span><code>// Check category
* category 1..
* category ^slicing.discriminator.type = #pattern
* category ^slicing.discriminator.path = &quot;$this&quot;
* category ^slicing.rules = #open
* category ^slicing.description = &quot;Slice based on category pattern&quot;
* category contains labCategory  1..1 MS
* category[labCategory] = ObsCat#laboratory
</code></pre></div>
<p>To me the latter feels a little more natural, but I expect it is a matter of preference.</p>



<a name="235678600"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235678600" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235678600">(Apr 22 2021 at 13:39)</a>:</h4>
<p>This is great <span class="user-mention" data-user-id="191469">@Chris Moesel</span> ! I just tested if my profile allowed other (additional) category codings or codeable-concept. It didn't, but using your approach it does! (And that's what I wanted) Thank you</p>



<a name="235679130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235679130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235679130">(Apr 22 2021 at 13:42)</a>:</h4>
<p>And regarding this:</p>
<div class="codehilite"><pre><span></span><code>// Check presence of LOINC code
* code.coding ^slicing.discriminator.type = #pattern
* code.coding ^slicing.discriminator.path = &quot;system&quot;
* code.coding ^slicing.rules = #open
* code.coding ^slicing.description = &quot;Slice based on coding system&quot;
* code.coding contains loincCode 1..1 MS
* code.coding[loincCode].system = LNC
</code></pre></div>
<p>If you really just want to ensure that a LOINC code is used in the <code>code</code>, then I think you could avoid the slicing and just use a value set:</p>
<div class="codehilite"><pre><span></span><code>* code from http://loinc.org/vs (required)
</code></pre></div>
<p><code>http://loinc.org/vs</code> represents the value set of all LOINC codes (<a href="http://hl7.org/fhir/R4/loinc.html#implicit">doc</a>) and a value set binding only requires that <em>at least one</em> of the codings matches the value set (<a href="http://hl7.org/fhir/R4/terminologies.html#required">doc</a>).  So I think this says the same thing without needing to slice.  But again, both work, so it's a matter of preference.</p>



<a name="235679323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235679323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235679323">(Apr 22 2021 at 13:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="327858">Christian Nau</span> <a href="#narrow/stream/215610-shorthand/topic/Restrict.20Observation.20category/near/235678600">said</a>:</p>
<blockquote>
<p>This is great <span class="user-mention silent" data-user-id="191469">Chris Moesel</span> ! I just tested if my profile allowed other (additional) category codings or codeable-concept. It didn't, but using your approach it does! (And that's what I wanted) Thank you</p>
</blockquote>
<p><span class="user-mention" data-user-id="327858">@Christian Nau</span> -- I'm surprised.  I really did think your original approach should work too.  But I'm glad that my suggestion seems to work better (even if I don't understand why).</p>



<a name="235679328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235679328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235679328">(Apr 22 2021 at 13:43)</a>:</h4>
<p>Just for my understanding: I thought that <code>^slicing.rules = #open</code> allows other values for codings. So why didn't my approach work?</p>



<a name="235679442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235679442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235679442">(Apr 22 2021 at 13:44)</a>:</h4>
<p>Ok, so I'm not the only one suprised :)</p>



<a name="235679449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235679449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235679449">(Apr 22 2021 at 13:44)</a>:</h4>
<p>I don't know.  That's why I said I was surprised.  I would have expected it to work just fine since your rules are <code>#open</code>.</p>



<a name="235681975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235681975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235681975">(Apr 22 2021 at 13:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/215610-shorthand/topic/Restrict.20Observation.20category/near/235679130">said</a>:</p>
<blockquote>
<p>If you really just want to ensure that a LOINC code is used in the <code>code</code>, then I think you could avoid the slicing and just use a value set:</p>
</blockquote>
<p>Another very appreciated suggestion! I already had a value-set for my lab-value-profile (containing LOINC codes) but forgot to use it here. Thanks!</p>



<a name="235690064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235690064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235690064">(Apr 22 2021 at 14:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="327858">Christian Nau</span> <a href="#narrow/stream/215610-shorthand/topic/Restrict.20Observation.20category/near/235679328">said</a>:</p>
<blockquote>
<p>Just for my understanding: I thought that <code>^slicing.rules = #open</code> allows other values for codings. So why didn't my approach work?</p>
</blockquote>
<p>your approach only checked if the system equals the LOINC System string.<br>
VS binding tells the validator to also check if the value is a valid value</p>



<a name="235690765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235690765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235690765">(Apr 22 2021 at 14:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> The confusion was about the category slicing, not the one for coding.</p>



<a name="235691241"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235691241" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235691241">(Apr 22 2021 at 14:49)</a>:</h4>
<p>a i miss-quoted, my comment was about the difference between fixed systems and VS bindings</p>



<a name="235691418"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235691418" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235691418">(Apr 22 2021 at 14:50)</a>:</h4>
<p>open slicing allows other slices of course</p>



<a name="235691483"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235691483" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235691483">(Apr 22 2021 at 14:51)</a>:</h4>
<p>Ah ok. Yes that's a good point. I already updated the profile to use value-set binding like <span class="user-mention" data-user-id="191469">@Chris Moesel</span> suggested.</p>



<a name="235691703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Restrict%20Observation%20category/near/235691703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Nau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Restrict.20Observation.20category.html#235691703">(Apr 22 2021 at 14:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191451">Patrick Werner</span> <a href="#narrow/stream/215610-shorthand/topic/Restrict.20Observation.20category/near/235691418">said</a>:</p>
<blockquote>
<p>open slicing allows other slices of course</p>
</blockquote>
<p>Yes, but for the way I sliced category it did not allow category-codings from other systems. That's why we were suprised.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
