---
layout: page
title: "FHIR Chat  · ✔ &#x27;mismatched input&#x27; error on regex Invariant · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html">✔ &#x27;mismatched input&#x27; error on regex Invariant</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="250976493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/250976493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eirik Myklebost <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#250976493">(Aug 27 2021 at 18:43)</a>:</h4>
<p>Hi, I'm trying to create an invariant to verify an OID string, but the SUSHI compiler reports an error on the escaped dots.<br>
This is a simplified example of the invariant I'm trying to create:</p>
<div class="codehilite"><pre><span></span><code>Invariant: example
Description: &quot;Should only accept the string: foo:1.2&quot;
Expression: &quot;$this.matches(&#39;foo:1\.2&#39;)&quot;
Severity: #error
</code></pre></div>
<p>The error reported by SUSHI:  <code>error mismatched input '"$this.matches('foo:1\.2')"' expecting STRING</code><br>
<a href="https://regex101.com/r/vrUF0H/1">Example of the regex</a>.</p>
<p>Am I missing something or is this a bug?</p>



<a name="251078664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251078664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eirik Myklebost <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251078664">(Aug 28 2021 at 20:01)</a>:</h4>
<p><a href="https://fshschool.org/FSHOnline/#/share/3yrsNBV">Demo at fsh-school</a>.</p>



<a name="251149483"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251149483" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251149483">(Aug 29 2021 at 18:30)</a>:</h4>
<p>Thanks for providing the example.  I think that the issue is that you need to escape the backslash <code>\</code> in your string.  When I did that (<a href="https://fshschool.org/FSHOnline/#/share/3t9AfAJ">example</a>), it converted without error.</p>
<p>This did also retain the <code>\\</code> in the resulting JSON, but I think that may be what you want anyway because <a href="http://hl7.org/fhirpath/N1/#string">FHIRPath</a> says you should escape backslash too.</p>
<p>All that said, the FSH spec isn't clear about this, and I admit it is a bit confusing, so I will also check w/ the rest of the FSH team to see what they think.</p>



<a name="251149573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251149573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251149573">(Aug 29 2021 at 18:31)</a>:</h4>
<p>(Also, I apologize -- I somehow missed your original post about this and only noticed it when you posted the example later).</p>



<a name="251153867"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251153867" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eirik Myklebost <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251153867">(Aug 29 2021 at 19:50)</a>:</h4>
<p>I'm trying to escape the dot <code>.</code>, which in regex is interpreted as <code>Match any single character</code>, hence the use of backslash. From my understanding your suggestion would result in the following regex: <code>foo:1\\.2</code>, which will escape the backslash instead of the dot, and thereby require a literal backslash match. The regex will then match on e.g. <code>foo:1\A2</code>, <code>foo:1\B2</code>, but I want it to only match on <code>foo:1.2</code>.</p>



<a name="251303537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251303537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eirik Myklebost <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251303537">(Aug 30 2021 at 22:17)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> , any thoughts? Or should I register this as an issue on the SUSHI github?</p>



<a name="251311610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251311610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251311610">(Aug 30 2021 at 23:46)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="223185">@Eirik Myklebost</span> -- SUSHI outputs the resources in JSON, and the invariant expression gets serialized as a JSON string.  JSON requires you to escape <code>\</code> in JSON strings (see <a href="https://www.json.org/json-en.html">here</a> and <a href="https://www.tutorialspoint.com/json_simple/json_simple_escape_characters.htm">here</a>) but does not require you to escape <code>.</code> in JSON strings (for obvious reasons).  So... I believe you <em>have</em> to serialize it as <code>\\.</code> in the JSON string in order to represent a final form of <code>\.</code>.  Because, technically, I think <code>\.</code> alone is invalid in a JSON string since it is an unrecognized escaped character.  So I do still think SUSHI is doing it right.  Does that make sense?</p>



<a name="251311797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251311797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251311797">(Aug 30 2021 at 23:48)</a>:</h4>
<p>For example, if you go to <a href="https://jsonlint.com">https://jsonlint.com</a> and validate <code>{ "foo": "foo\.bar" }</code> you will get validation errors.  But if you change it to <code>{ "foo": "foo\\.bar" }</code> it validates cleanly.</p>



<a name="251343138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251343138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eirik Myklebost <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251343138">(Aug 31 2021 at 07:26)</a>:</h4>
<p>Ah, that makes sense. I will have to try this with the fhir-validator, but I guess it means we'll have to "double escape" when escaping a character in a regex within json.<br>
Thanks for the explanation.</p>
<p>EDIT: This got me thinking. Could the escaping required by json representation be added by SUSHI? This would be a nice feature, but also required if SUSHI was to ever support multiple output formats (XML, Turtle).</p>



<a name="251370718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251370718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251370718">(Aug 31 2021 at 11:44)</a>:</h4>
<p>The thing is that SUSHI also needs to escape <code>\</code>.  Since SUSHI supports <code>\n</code>, <code>\r</code>, <code>\t</code>, something like <code>\node</code> would be ambiguous (is it newline plus <code>ode</code> or is it backslash plus <code>node</code>)?  This is why SUSHI also requires you to escape the <code>\</code>.</p>
<p>For fields that take a true regex (and only a regex), SUSHI supports regex in the form <code>/myregex/</code> -- but I think the only place that happens is in ValueSet filters.</p>



<a name="251378889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251378889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eirik Myklebost <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251378889">(Aug 31 2021 at 12:52)</a>:</h4>
<p>Ok, the behavior is understandable. Thanks again for the explanation, I will mark the topic as resolved.<br>
Maybe this behavior should be documented in the FSH IG and\or fsh-school?</p>



<a name="251378893"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251378893" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251378893">(Aug 31 2021 at 12:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="223185">Eirik Myklebost</span> has marked this topic as resolved.</p>



<a name="251378906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251378906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251378906">(Aug 31 2021 at 12:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="223185">Eirik Myklebost</span> has marked this topic as unresolved.</p>



<a name="251378916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/%E2%9C%94%20%27mismatched%20input%27%20error%20on%20regex%20Invariant/near/251378916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/.E2.9C.94.20&#x27;mismatched.20input&#x27;.20error.20on.20regex.20Invariant.html#251378916">(Aug 31 2021 at 12:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="223185">Eirik Myklebost</span> has marked this topic as resolved.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
