---
layout: page
title: "FHIR Chat  · valueSet according to property · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html">valueSet according to property</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="278458783"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278458783" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278458783">(Apr 10 2022 at 09:44)</a>:</h4>
<p>Let's say I have a codeSystem where every concept has a property we'll call "type". Each concept can be either a procedure or a diagnosis. I need to make separate valueSets according to this property where one valueSet is for procedures and the other is for diagnoses. I've tried to get this to work but cannot figure out the actual way to write this is FSH. Usually when this happens I find an example of this somewhere, goFsh it and learn from that. But I can't find something like this so I was wondering if anyone can give me the line of code I'm looking for. <br>
Something along the lines of:<br>
<code>* include concepts from $code-system where concept.property.valueCode="Diagnosis"</code></p>



<a name="278469413"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278469413" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278469413">(Apr 10 2022 at 13:54)</a>:</h4>
<p>more information:<br>
This is what the VS I'm trying to create looks like:<br>
<a href="/user_uploads/10155/swuPbry2hHBDsp0tnlMkzZev/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/swuPbry2hHBDsp0tnlMkzZev/image.png" title="image.png"><img src="/user_uploads/10155/swuPbry2hHBDsp0tnlMkzZev/image.png"></a></div><p>This is what the CodeSystem looks like (partial):<br>
<a href="/user_uploads/10155/UTDw-0tFENbSR3ktqLfiLKRM/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/UTDw-0tFENbSR3ktqLfiLKRM/image.png" title="image.png"><img src="/user_uploads/10155/UTDw-0tFENbSR3ktqLfiLKRM/image.png"></a></div><p>and this is the small codeSystem containing the type codes:<br>
<a href="/user_uploads/10155/YiLmjo9fAAljAh5F2i4Itcdd/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/YiLmjo9fAAljAh5F2i4Itcdd/image.png" title="image.png"><img src="/user_uploads/10155/YiLmjo9fAAljAh5F2i4Itcdd/image.png"></a></div><p>The error I'm getting when I run sushi is:<br>
<code>error Code "procedure" is not defined for system ICD9IL.
  File: C:\FHIR\IsraelCoreProfile - Current working\input\fsh\ValueSet-icd9il-procedures.fsh
  Line: 9</code></p>



<a name="278502380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278502380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278502380">(Apr 11 2022 at 02:21)</a>:</h4>
<p>That ValueSet definition looks off to me: you want the <code>type</code> property to <code>=</code> the value <code>"procedure"</code>.<br>
But the error you're seeing suggests your code system is not right -- is <code>procedure</code> a valid code in $icd9-il ?  It may be that you should define this property as string-typed?</p>



<a name="278514599"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278514599" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278514599">(Apr 11 2022 at 07:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191343">@Michael Lawley</span>  Sorry, I'm not sure I understand. The main CS ($icd9-il) refers to another CS (icd9-il-code-types) created specially for this purpose: 2 codes - not strings - that allow me to then define for each concept a property, as defined in the smaller CS. <br>
We have done this once before without a hitch. <br>
here: <br>
<a href="/user_uploads/10155/6xZvPgJKZxjYP5bSGao_Z_m6/image.png">image.png</a> <br>
<a href="/user_uploads/10155/wkU6-yu7Rotf8UGTy87fYEjZ/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/6xZvPgJKZxjYP5bSGao_Z_m6/image.png" title="image.png"><img src="/user_uploads/10155/6xZvPgJKZxjYP5bSGao_Z_m6/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/wkU6-yu7Rotf8UGTy87fYEjZ/image.png" title="image.png"><img src="/user_uploads/10155/wkU6-yu7Rotf8UGTy87fYEjZ/image.png"></a></div>



<a name="278514799"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278514799" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278514799">(Apr 11 2022 at 07:03)</a>:</h4>
<p>also - is the line of code I'm using in the valueSet correct? Because that's something we've never tried</p>



<a name="278554196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278554196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278554196">(Apr 11 2022 at 13:36)</a>:</h4>
<p>The ValueSet definition is definitely not right.  It should be something like:</p>
<div class="codehilite"><pre><span></span><code>ValueSet: ICD9ILProcedures
Id: icd9il-procedures
Title: &quot;ICD9 IL Procedures&quot;
Description: &quot;codes of procedures from ICD9-IL&quot;
* ^language = #he-IL
* ^url = $icd9-il-procedures
* ^status = #draft
* ^version = &quot;0.7.0&quot;
* codes from system $icd9-il where type = #procedure
</code></pre></div>
<p>which translates to</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">"resourceType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ValueSet"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"draft"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ICD9ILProcedures"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"icd9il-procedures"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ICD9 IL Procedures"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"codes of procedures from ICD9-IL"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.7.0"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.com/i9p"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"he-IL"</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">"compose"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.com/i9"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"type"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">"op"</span><span class="p">:</span><span class="w"> </span><span class="s2">"="</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"procedure"</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="278554858"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278554858" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278554858">(Apr 11 2022 at 13:41)</a>:</h4>
<p>Note that the ^property.uri in your CodeSystem definition is <em>not</em> defining a system for the code-typed property. It is instead a unique identifier for the property itself.<br>
When you define a property of type <code>code</code>, it is assumed to be a code from the same CodeSystem.  Since it is no, you have two choices -- define it to be of type Coding (which is cumbersome and verbose), or define it to be of type string (which is direct &amp; pragmatic, but not really "the right way").</p>



<a name="278567717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278567717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278567717">(Apr 11 2022 at 15:07)</a>:</h4>
<p><span class="user-mention" data-user-id="191343">@Michael Lawley</span> thanks. <br>
I think you meant  <code>* codes from system $icd9-il where type = "procedure"</code>, no? (i.e. - <code>"procedure"</code> instead of <code>#procedure</code>).  <br>
Then I redid the codeSystem like so:<br>
<a href="/user_uploads/10155/aYCp9ksw_dt2UlBTbZC90eC1/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/aYCp9ksw_dt2UlBTbZC90eC1/image.png" title="image.png"><img src="/user_uploads/10155/aYCp9ksw_dt2UlBTbZC90eC1/image.png"></a></div><p>It seems to work but how would I go about testing it? Like, there should be 31 concepts in this valueSet but obviously the valueset doesn't hold them in any way.</p>



<a name="278612081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278612081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278612081">(Apr 11 2022 at 20:27)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="380122">@Kippi Bordowitz</span>.  Some of this is starting to go outside my realm of expertise -- as we're beyond the FSH part of this and into straight-up CodeSystem and ValueSet design.  One thing I've noted is that <code>CodeSystem</code> has a <a href="http://hl7.org/fhir/R4/codesystem-definitions.html#CodeSystem.filter">filter</a> property on it, described as "a filter that can be used in a value set compose statement when selecting concepts using a filter."  So, I wonder if you need to specify that as well.  You might try something like:</p>
<div class="codehilite"><pre><span></span><code>* ^filter.code = #type
* ^filter.operator = #=
* ^filter.value = &quot;the type to filter on:  procedure or diagnosis&quot;
</code></pre></div>
<p>But, again, this is outside my wheelhouse, so at this point I am guessing.  Since you're into CodeSystem design now, you might consider asking on <a class="stream" data-stream-id="179202" href="/#narrow/stream/179202-terminology">#terminology</a> or <a class="stream" data-stream-id="179252" href="/#narrow/stream/179252-IG-creation">#IG creation</a>.</p>



<a name="278616102"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278616102" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278616102">(Apr 11 2022 at 21:00)</a>:</h4>
<p>Every property defined in a CodeSystem can be used as a simple filter, so you could declare it like above, but it is not required.<br>
<span class="user-mention" data-user-id="380122">@Kippi Bordowitz</span> If you're able to successfully generate the resources (ICD9-IL CodeSystem and the ValueSet), then you can test using the <code>$expand</code> operation.<br>
I believe the igpublisher effectively does this when it generates the page for the ValueSet.  However, if you need/want to test by hand, then you can upload to our Ontoserver public sandbox (<a href="https://r4.ontoserver.csiro.au/fhir">https://r4.ontoserver.csiro.au/fhir</a>) and test it there.</p>



<a name="278666862"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/valueSet%20according%20to%20property/near/278666862" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/valueSet.20according.20to.20property.html#278666862">(Apr 12 2022 at 09:15)</a>:</h4>
<p><span class="user-mention" data-user-id="191343">@Michael Lawley</span> thanks! <br>
I made a small mistake while uploading the valueSet to our hapi-fhir server. once corrected, the testing seems to have worked. <br>
I'm not familiar with $expand so I will have to read up on it.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
