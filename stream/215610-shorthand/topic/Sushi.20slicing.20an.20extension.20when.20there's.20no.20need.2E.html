---
layout: page
title: "FHIR Chat  · Sushi slicing an extension when there&#x27;s no need. · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html">Sushi slicing an extension when there&#x27;s no need.</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="251265435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251265435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251265435">(Aug 30 2021 at 17:39)</a>:</h4>
<p>I have a compound extension and when one of the sub-extensions is hit with an invariant, sushi is slicing that extension.  That's a problem as that causes the invariant to fail and renders the actual json version invalid.</p>



<a name="251265653"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251265653" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251265653">(Aug 30 2021 at 17:41)</a>:</h4>
<p>Source code is here: <a href="https://github.com/Carequality/CEQSubscription/">https://github.com/Carequality/CEQSubscription/</a></p>



<a name="251267156"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251267156" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251267156">(Aug 30 2021 at 17:52)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> ?</p>



<a name="251269554"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251269554" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251269554">(Aug 30 2021 at 18:08)</a>:</h4>
<p>I don't have a moment to look at this right now, but I can see if someone else on the SUSHI team has time.  Can you be more specific about where we should be looking in that IG?  Like what extension and where?</p>



<a name="251270114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251270114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251270114">(Aug 30 2021 at 18:11)</a>:</h4>
<p>The error from Forge is in this <a href="/user_uploads/10155/O5Ys1zCbo2McoAiRi1c-Zf6-/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/O5Ys1zCbo2McoAiRi1c-Zf6-/image.png" title="image.png"><img src="/user_uploads/10155/O5Ys1zCbo2McoAiRi1c-Zf6-/image.png"></a></div>



<a name="251270318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251270318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251270318">(Aug 30 2021 at 18:13)</a>:</h4>
<p>Having the slice in place prevents the invariant.  and we don't want it sliced, just forced valueString</p>



<a name="251272144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251272144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251272144">(Aug 30 2021 at 18:25)</a>:</h4>
<p>So you are putting an invariant on <code>valueString</code>?  If you specify a choice path in SUSHI using the specific type-based path (e.g., <code>valueString</code>), then SUSHI automatically applies type-slicing in order to create an element for that specific path.  This is <em>necessary</em> for choices that have not been constrained to a single type -- but not so necessary if the choice has been constrained to a single type already.  Still, SUSHI does it as a general rule whenever you access a specific choice type like that.  To get around it, apply your invariant directly to <code>value[x]</code> rather than <code>valueString</code>.</p>



<a name="251272280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251272280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251272280">(Aug 30 2021 at 18:26)</a>:</h4>
<p>(Quickly guessing based on screenshot above.  Let me know if I misunderstood it or assumed something I should not have assumed).</p>
<p>EDIT: This wasn't the issue at all.  Ignore above.</p>



<a name="251275411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251275411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251275411">(Aug 30 2021 at 18:47)</a>:</h4>
<p>I had it on value, but not value[x], but the issue remained.  Having it on valueString, didnt' help.</p>



<a name="251275475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251275475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251275475">(Aug 30 2021 at 18:47)</a>:</h4>
<p>If there's someone I can work with, I'd be glad too.</p>



<a name="251276019"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251276019" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251276019">(Aug 30 2021 at 18:51)</a>:</h4>
<p>i think it's your invariant - extension('ceqPushExtension') is asserting the URL of the extension is ceqPushExtension when it's actually '<a href="https://sequoiaproject.org/fhir/push-r4/StructureDefinition/CEQextension">https://sequoiaproject.org/fhir/push-r4/StructureDefinition/CEQextension</a>'</p>



<a name="251276112"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251276112" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251276112">(Aug 30 2021 at 18:52)</a>:</h4>
<p>I've tried both, ceqPushExtension and CEQextension, still get the problem.</p>



<a name="251276174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251276174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251276174">(Aug 30 2021 at 18:52)</a>:</h4>
<p>It's only the Forge warning that's giving me any idea of what might be wrong.</p>



<a name="251276483"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251276483" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251276483">(Aug 30 2021 at 18:55)</a>:</h4>
<p>well, when I changed it as above, I don't get the error anymore:</p>
<div class="codehilite"><pre><span></span><code>Invariant:  CEQ-Param-Name
Description: &quot;searchParamName shall be Patient or PatientID&quot;
Expression: &quot;extension(&#39;https://sequoiaproject.org/fhir/push-r4/StructureDefinition/CEQextension&#39;).extension(&#39;searchParamName&#39;).value in ( &#39;Patient&#39; | &#39;PatientID&#39; )&quot;
Severity:   #error
</code></pre></div>



<a name="251277070"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251277070" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251277070">(Aug 30 2021 at 18:59)</a>:</h4>
<p>I hadn't tried it with using the full URL.</p>



<a name="251277371"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Sushi%20slicing%20an%20extension%20when%20there%27s%20no%20need./near/251277371" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Sushi.20slicing.20an.20extension.20when.20there&#x27;s.20no.20need.2E.html#251277371">(Aug 30 2021 at 19:00)</a>:</h4>
<p>I'll pass that on to the people implementing and see if it makes their lives better!  Thanks!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
