---
layout: page
title: "FHIR Chat  · sushi suddenly failing on cs/vs codes post upgrade · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20suddenly.20failing.20on.20cs.2Fvs.20codes.20post.20upgrade.html">sushi suddenly failing on cs/vs codes post upgrade</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="274386821"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20suddenly%20failing%20on%20cs/vs%20codes%20post%20upgrade/near/274386821" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20suddenly.20failing.20on.20cs.2Fvs.20codes.20post.20upgrade.html#274386821">(Mar 07 2022 at 12:56)</a>:</h4>
<p>I have updated sushi from version from <code>1.3.2</code> to <code>2.3.0</code> . Since then I am getting a new error and I can't quite figure it out.<br>
I have the following ValueSet:<br>
<a href="/user_uploads/10155/r1e-Dx53HAQ8ZlrAl2kfBi-6/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/r1e-Dx53HAQ8ZlrAl2kfBi-6/image.png" title="image.png"><img src="/user_uploads/10155/r1e-Dx53HAQ8ZlrAl2kfBi-6/image.png"></a></div><p>It calls for codes from the following CodeSystem (I have copied only the relevant part as it is much larger):<br>
<a href="/user_uploads/10155/Tn12xeCP1mBe-JwL-yNo3O13/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/Tn12xeCP1mBe-JwL-yNo3O13/image.png" title="image.png"><img src="/user_uploads/10155/Tn12xeCP1mBe-JwL-yNo3O13/image.png"></a></div><p>I am getting the following error(s) from sushi:<br>
<a href="/user_uploads/10155/33UgbApRxvZe0wxPuTrnQHzN/image.png">image.png</a> <br>
I have cut the printout down because it is basically repeating the error for all the codes seen in the first error message. </p>
<div class="message_inline_image"><a href="/user_uploads/10155/33UgbApRxvZe0wxPuTrnQHzN/image.png" title="image.png"><img src="/user_uploads/10155/33UgbApRxvZe0wxPuTrnQHzN/image.png"></a></div><p>I can't find the problem. Would appreciate any assistance.</p>



<a name="274399939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20suddenly%20failing%20on%20cs/vs%20codes%20post%20upgrade/near/274399939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20suddenly.20failing.20on.20cs.2Fvs.20codes.20post.20upgrade.html#274399939">(Mar 07 2022 at 14:38)</a>:</h4>
<p>Thanks for reporting this, <span class="user-mention" data-user-id="380122">@Kippi Bordowitz</span>.  I've done a simple reproduction of the issue on FSH Online here: <a href="https://fshschool.org/FSHOnline/#/share/3vLYBUq">https://fshschool.org/FSHOnline/#/share/3vLYBUq</a></p>
<p>I agree that the above <em>should</em> work, BUT it is not the best practice (or common) approach to defining CodeSystems in FSH.  Since you are using all <code>^</code> rules, it actually would work better as an <code>Instance</code>.  I've tried that and found that it does not produce any errors: <a href="https://fshschool.org/FSHOnline/#/share/3tEoGBY">https://fshschool.org/FSHOnline/#/share/3tEoGBY</a></p>
<p>That said, the BEST approach would be to use the new <a href="https://hl7.org/fhir/uv/shorthand/reference.html#defining-code-systems">CodeSystem syntax</a> introduced in FSH 2.0, which allows you to set metadata properties.  This is much cleaner.  Here is what that would look like: <a href="https://fshschool.org/FSHOnline/#/share/3pJ1uBm">https://fshschool.org/FSHOnline/#/share/3pJ1uBm</a></p>
<div class="codehilite"><pre><span></span><code>CodeSystem: PayingEntityMoH
Id: paying-entity-moh
Title: &quot;Some Title&quot;
Description: &quot;Some Description&quot;
* ^language = #he-IL
* ^status = #draft
* ^url = $payer
* ^content = #complete
* #-888 &quot;display 0&quot; &quot;definition 0&quot;
  * ^property.code = #status
  * ^property.valueCode = #deprecated
* #-999 &quot;display 1&quot; &quot;definition 1&quot;
  * ^property.code = #status
  * ^property.valueCode = #deprecated
* #101 &quot;display 2&quot; &quot;definition 2&quot;
* #102 &quot;display 3&quot; &quot;definition 3&quot;
</code></pre></div>
<p>Also note that <code>^content</code> defaults to <code>#complete</code>, so you don't need to explicitly state that rule if you don't want to. In addition, SUSHI will build default URLs for you too (using the IG canonical), so you only need to set <code>^url</code> if you want to override the default URL that SUSHI assigns.</p>
<p>We can look into why your original FSH doesn't work, but I would highly recommend converting to the latest syntax if possible.  If that is too tedious and you have an existing formal CodeSystem declaration (in JSON), you could use GoFSH to help. It won't use the indent format, but it will still provide a much cleaner representation. (NOTE: you can use GOFSH on <a href="https://fshschool.org/FSHOnline/#/">FSH Online</a> by using the "Convert to FSH" button).</p>



<a name="274400322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20suddenly%20failing%20on%20cs/vs%20codes%20post%20upgrade/near/274400322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20suddenly.20failing.20on.20cs.2Fvs.20codes.20post.20upgrade.html#274400322">(Mar 07 2022 at 14:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> Thanks!<br>
I will first try converting to the new syntax. shouldn't be <strong>too</strong> tedious. Will update on status (resolved/not resolved) once am done.</p>



<a name="274427908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20suddenly%20failing%20on%20cs/vs%20codes%20post%20upgrade/near/274427908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20suddenly.20failing.20on.20cs.2Fvs.20codes.20post.20upgrade.html#274427908">(Mar 07 2022 at 17:35)</a>:</h4>
<p>I've filed <a href="https://github.com/FHIR/sushi/issues/1039">SUSHI-1039</a> to track the bug related to SUSHI not working correctly when defining codes using <code>^concept</code>.</p>



<a name="274431147"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20suddenly%20failing%20on%20cs/vs%20codes%20post%20upgrade/near/274431147" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kippi Bordowitz <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20suddenly.20failing.20on.20cs.2Fvs.20codes.20post.20upgrade.html#274431147">(Mar 07 2022 at 17:56)</a>:</h4>
<p>Glad to report the new system does work. I really wish I could figure out an automatic way of converting the old files to the new format... It was more work than I had anticipated for just the one but we have several of those.</p>



<a name="274442053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/sushi%20suddenly%20failing%20on%20cs/vs%20codes%20post%20upgrade/near/274442053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/sushi.20suddenly.20failing.20on.20cs.2Fvs.20codes.20post.20upgrade.html#274442053">(Mar 07 2022 at 19:07)</a>:</h4>
<p>Hmmm... Round-tripping on FSH Online might be easier.  Basically, copy over the existing CodeSystem FSH (and any aliases it uses), then click "Convert to JSON".  This gets it into FHIR format on the right-hand-side.  Then click "Convert to FSH", which overwrites the left-hand-side with the better FSH representation.</p>
<p>For example, try it w/ this link.  Go here (<a href="https://fshschool.org/FSHOnline/#/share/3ITRlcD">https://fshschool.org/FSHOnline/#/share/3ITRlcD</a>) then click "Convert to JSON" then "Convert to FSH" and you'll see what I mean.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
