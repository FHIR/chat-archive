---
layout: page
title: "FHIR Chat  · Extensions on a slice · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html">Extensions on a slice</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="187084963"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187084963" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187084963">(Jan 31 2020 at 13:53)</a>:</h4>
<p>I'm trying to add an extension only to a specific slice of a coding:</p>
<div class="codehilite"><pre><span></span>//Set and define icd-10-gm slice
* code.coding contains icd-10-gm 1..*
* code.coding[icd-10-gm].extension contains HauptKreuzCode 0..*
</pre></div>


<p>When I try to run SUSHI on this file I get </p>
<div class="codehilite"><pre><span></span>error: No element found at path code.coding[icd-10-gm].extension for MIRACUMCondition, skipping rule
  File: C:\Users\deppenni\MII\fhir-igs\miracum-core-ig\fsh-files\Condition.fsh
  Line: 34
error: No element found at path code.coding[icd-10-gm].extension[HauptKreuzCode] for MIRACUMCondition, skipping rule
  File: C:\Users\deppenni\MII\fhir-igs\miracum-core-ig\fsh-files\Condition.fsh
  Line: 34
</pre></div>


<p>So, how can I access the extension array of a slice?</p>



<a name="187086672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187086672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187086672">(Jan 31 2020 at 14:12)</a>:</h4>
<p>Have you setup the discriminator before declaring the slice?  If so, then I would expect this <em>should</em> work (so then maybe you discovered a bug).  If not, try setting up the discriminator on <code>code.coding</code> first, and then try again.  (You can use the <code>^</code> syntax to setup the discriminator, as shown <a href="http://build.fhir.org/ig/HL7/fhir-shorthand/#step-3-providing-the-slicing-logic" target="_blank" title="http://build.fhir.org/ig/HL7/fhir-shorthand/#step-3-providing-the-slicing-logic">here</a>).</p>



<a name="187087724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187087724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187087724">(Jan 31 2020 at 14:24)</a>:</h4>
<p>Thanks for your respone! I set up the slicing discriminator to use value on system.<br>
I believe now the error is caused by me setting a (non-resolvable) slice profile between the two lines I posted earlier:</p>
<div class="codehilite"><pre><span></span>//Set and define icd-10-gm slice
* code.coding contains icd-10-gm 1..*
* code.coding[icd-10-gm] ^type.profile = &quot;http://fhir.de/StructureDefinition/CodingICD10GM&quot;
* code.coding[icd-10-gm].extension contains HauptKreuzCode 0..*
</pre></div>


<p>(I omitted that before since I did not think it was relevant. I also modify some other ^attributes, but the profile line breaks it. Without it runs fine.)</p>



<a name="187093808"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187093808" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187093808">(Jan 31 2020 at 15:36)</a>:</h4>
<p>There are a few possible things going on here.</p>
<p>First, is the <code>http://fhir.de/StructureDefinition/CodingICD10GM</code> profile accessible to SUSHI?  Is it defined in the same SUSHI project and/or included in one of the dependencies listed in the package.json?</p>
<p>Second, if the answer to the first is <em>yes</em>, then does the <code>http://fhir.de/StructureDefinition/CodingICD10GM</code> zero out <code>extension</code> on the coding?</p>



<a name="187094178"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187094178" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187094178">(Jan 31 2020 at 15:40)</a>:</h4>
<p>The profile is not accessible. Does it have to be?<br>
(It is a draft on Simplifier <a href="https://simplifier.net/Basisprofil-DE-R4/CodingICD10GM" target="_blank" title="https://simplifier.net/Basisprofil-DE-R4/CodingICD10GM">https://simplifier.net/Basisprofil-DE-R4/CodingICD10GM</a>)</p>



<a name="187094738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187094738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187094738">(Jan 31 2020 at 15:47)</a>:</h4>
<p>In order for SUSHI to properly validate that what you're doing is allowed, it probably should be accessible.  Otherwise SUSHI doesn't know about any of the constraints the profile introduces.  It also causes a problem if a path goes into the profiled things sub-elements, because it needs to then get the sub-elements from the profile to properly create the diffs.  I'm guessing that's what is happening here -- it can't find the definition of that profile, so it can't locate the snapshot elements to generate a diff from.  (Just a guess without actually debugging it).</p>



<a name="187095892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187095892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187095892">(Jan 31 2020 at 16:00)</a>:</h4>
<p>Sounds reasonable. Are there any other ways of providing an "external" profile than using packages (Since SUSHI seems to be ignoring the newly added dependency... Or would I get an error if a dependency could not be resolved?)? E.g. just dumping the json file into the folder?</p>



<a name="187111580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187111580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187111580">(Jan 31 2020 at 18:50)</a>:</h4>
<p>I feel like we <em>should</em> be reporting when a dependency can't be resolved (I mean, when you add a dependency into the package.json that can't be resolved).  We probably also should be reporting if we can't resolve a profile URL when we need it.  If we're not reporting either of those, it may be a bug.</p>
<p>We are planning to add support for bring-your-own-JSON, but I think even then we'll require that whatever you bring in have the same canonical root as your FSH project.  Supporting truly _external_ profiles (e.g., from another package) without declaring them as a package dependency isn't on our radar, but maybe it should be.</p>



<a name="187111759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187111759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187111759">(Jan 31 2020 at 18:52)</a>:</h4>
<p>You could <em>try</em> a workaround that <em>might</em> work.  What if you flip the order?</p>
<div class="codehilite"><pre><span></span>//Set and define icd-10-gm slice
* code.coding contains icd-10-gm 1..*
* code.coding[icd-10-gm].extension contains HauptKreuzCode 0..*
* code.coding[icd-10-gm] ^type.profile = &quot;http://fhir.de/StructureDefinition/CodingICD10GM&quot;
</pre></div>


<p>Technically that shouldn't make a difference, but I bet it just might.  This will make it so that when SUSHI processes the extension, it doesn't yet know you're trying to profile the type.  Then it will apply the profile _after_ it's done that.  Again, not sure, but it just might work for now.</p>



<a name="187245644"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Extensions%20on%20a%20slice/near/187245644" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Noemi Deppenwiese <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Extensions.20on.20a.20slice.html#187245644">(Feb 03 2020 at 09:29)</a>:</h4>
<p>Thanks for your help! Now I get a proper <em>404- the package was not found</em> error.  And setting the extension works!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
