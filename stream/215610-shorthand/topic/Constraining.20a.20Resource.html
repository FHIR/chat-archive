---
layout: page
title: "FHIR Chat  · Constraining a Resource · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html">Constraining a Resource</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="198104172"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198104172" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198104172">(May 19 2020 at 17:59)</a>:</h4>
<p>I'm trying to create a profile on Bundle and constrain the first resource in .entry to a particular MessageHeader profile. Looking at other IGs, it feels like I need to do this:<br>
entry[&lt;slice name&gt;].resource ^type.profile = &lt;desired profile&gt;<br>
I tried using the name of the profile I created (BDRMessageHeader) and while it didn't cause a Sushi error, it didn't display correctly. It works fine when I give it the explicit URL for the desired profile. Should this work with just the profile name (like it does when you restrict a Reference element)? Or am I constraining it the wrong way?</p>



<a name="198110001"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198110001" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198110001">(May 19 2020 at 18:47)</a>:</h4>
<p>I think in this situation you would want to use an <code>only</code> rule, as described in more detail here: <a href="http://build.fhir.org/ig/HL7/fhir-shorthand/branches/master/reference.html#data-type-restriction-rules">http://build.fhir.org/ig/HL7/fhir-shorthand/branches/master/reference.html#data-type-restriction-rules</a>. As an example, I think you would want something like this:</p>
<div class="codehilite"><pre><span></span><code>* entry[specialMessage].resource only BDRMessageHeader
</code></pre></div>


<p>Assuming that <code>specialMessage</code> is a slice you have added to the <code>entry</code> element already.</p>



<a name="198110442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198110442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198110442">(May 19 2020 at 18:51)</a>:</h4>
<p>Is it possible to simply state</p>
<div class="codehilite"><pre><span></span><code>* entry[0].resource only BDRMessageHeader
</code></pre></div>



<a name="198112072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198112072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198112072">(May 19 2020 at 19:03)</a>:</h4>
<p>Sushi doesn't seem to like Vassil's solution. I get an error of "No element found at path entry[0].resource"</p>



<a name="198115699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198115699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198115699">(May 19 2020 at 19:34)</a>:</h4>
<p>In the context of a profile, we can't constrain specific elements in the <code>entry</code> array. The <code>entry</code> array is an element that has cardinality <code>0..*</code>, and we can constrain the <em>contents</em> of that array using slicing, but you can't put a constraint on an element at the 0th index.</p>



<a name="198117744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198117744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198117744">(May 19 2020 at 19:51)</a>:</h4>
<p>If you really want to constrain the <em>first</em> entry, you <em>may</em> be able to do that by setting <a href="http://hl7.org/fhir/R4/elementdefinition-definitions.html#ElementDefinition.slicing.ordered">ordered</a> in the slicing definition, but the FHIR spec seems to discourage that.  I'm also not sure how it works with elements that don't belong to a slice (do they go before or after the ordered slices?).</p>
<p>The other approach to enforce a type constraint on the first entry resource would be to use an invariant with a FHIRPath expression saying that the first entry resource must be a certain type.</p>



<a name="198119666"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198119666" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig Newman <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198119666">(May 19 2020 at 20:07)</a>:</h4>
<p>I may be going overboard given the base spec is very clear that the first entry in a message bundle must be a MessageHeader but it did seem worth it to specify the profile to use. I currently have this:</p>
<ul>
<li>entry ^slicing.discriminator.type = #type</li>
<li>entry ^slicing.discriminator.path = "resource"</li>
<li>entry ^slicing.rules = #open</li>
<li>entry ^slicing.ordered = true</li>
<li>entry ^slicing.description = "First entry must be MessageHeader"</li>
<li>entry contains MessageHeader 1..1</li>
<li>entry[MessageHeader].resource 1..1</li>
<li>entry[MessageHeader].resource only BDRMessageHeader </li>
</ul>
<p>But I have to admit that discriminators confuse me. Should the path be resource.resolve()?</p>



<a name="198120149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198120149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198120149">(May 19 2020 at 20:11)</a>:</h4>
<p>It seems to me that the ability to constrain the first entry in a Bundle without making the whole array of entries ordered is something that is necessary for documents, messages, and notifications. The proper way to do that needs to be called out as a pattern to follow. Would that be "an invariant with a FHIRPath expression saying that the first entry resource must be a certain type"?</p>



<a name="198232633"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198232633" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198232633">(May 20 2020 at 17:42)</a>:</h4>
<p><span class="user-mention" data-user-id="192758">@Craig Newman</span> -- if the target is a reference, you need <code>resolve()</code>, otherwise, you do not.  Since <code>entry.resource</code> is <em>not</em> a reference, I think your discriminator path is OK.</p>



<a name="198232962"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198232962" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198232962">(May 20 2020 at 17:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> -- is there a standard way to say that the first element in a list must be of a certain type or profile (for example some kind of "header" type)?  We've established that you <em>might</em> be able to do this with an ordered slicing, but a FHIRPath constraint might be better.  Are those the options?  Is one preferable?</p>



<a name="198245705"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198245705" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198245705">(May 20 2020 at 19:27)</a>:</h4>
<p>There's a change request to allow slicing by position, but it's not applied yet.  (And it would only be appropriate for arrays where the order has defined meaning in the core spec - e.g. HumanName.given)</p>



<a name="198246087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198246087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198246087">(May 20 2020 at 19:30)</a>:</h4>
<p>So is there a recommendation for specifying the first item in a list using R4?</p>



<a name="198246922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/198246922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#198246922">(May 20 2020 at 19:37)</a>:</h4>
<p>Other than with an invariant, no.</p>



<a name="206288604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/206288604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Duncan <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#206288604">(Aug 07 2020 at 17:50)</a>:</h4>
<p>I've run into a similar issue, but the main problem I'm having is more about getting an example to display in the order I'd like.  No matter what I try it puts the MessageHeader in a bundle at the end.</p>
<p>This is how the profile is defined for Bundle.entry:</p>
<ul>
<li>entry 2..2</li>
<li>entry ^slicing.discriminator.type = #type</li>
<li>entry ^slicing.discriminator.path = "resource"</li>
<li>entry ^slicing.rules = #closed</li>
<li>entry ^slicing.ordered = true</li>
<li>entry contains <br>
      PMIRMessageHeaderEntry 1..1 and <br>
      PMIRBundleHistoryEntry 1..1</li>
</ul>
<p>And when I try to create an example using this, I put it in like this (there is more content, but just as an example)</p>
<ul>
<li>entry[PMIRMessageHeaderEntry].fullUrl = "<a href="http://example.com/fhir/MessageHeader/1">http://example.com/fhir/MessageHeader/1</a>"</li>
<li>entry[PMIRBundleHistoryEntry].fullUrl = "<a href="http://example.come/fhir/Bundle/abc">http://example.come/fhir/Bundle/abc</a>"</li>
</ul>
<p>And the output always puts the MessageHeader last.  I tried reversing the order, I tried changing the slice names so the Header came first alphabetically.  It always puts the MessageHeader as the second entry in the Bundle.  I understand the entry isn't really ordered, but it's odd that SUSHI puts the header last no matter what the input is.</p>



<a name="206458780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/206458780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kramer <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#206458780">(Aug 10 2020 at 13:15)</a>:</h4>
<p><span class="user-mention" data-user-id="193299">@Luke Duncan</span> this looks like a bug where SUSHI isn't respecting the order when creating instances. Can you file an issue in JIRA?  <a href="https://jira.hl7.org/browse/FHIR-27321?jql=project%20%3D%20FHIR%20AND%20Specification%20%3D%20%22Shorthand%20(FHIR)%20%5BFHIR-shorthand%5D%22%20">https://jira.hl7.org/browse/FHIR-27321?jql=project%20%3D%20FHIR%20AND%20Specification%20%3D%20%22Shorthand%20(FHIR)%20%5BFHIR-shorthand%5D%22%20</a></p>



<a name="206476987"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/Constraining%20a%20Resource/near/206476987" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Duncan <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/Constraining.20a.20Resource.html#206476987">(Aug 10 2020 at 15:50)</a>:</h4>
<p><span class="user-mention" data-user-id="191447">@Mark Kramer</span> I created this issue:  <a href="https://jira.hl7.org/browse/FHIR-28234">https://jira.hl7.org/browse/FHIR-28234</a></p>
<p>Thanks!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
