---
layout: page
title: "FHIR Chat  · complex extensions · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html">complex extensions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="184970282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/184970282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#184970282">(Jan 07 2020 at 00:03)</a>:</h4>
<p>Creating complex extensions and getting a number of these errors: error: The slice latitude on extension must reference an existing extension, or fix a url if the extension is defined inline.</p>
<p>a) Would be good to include the filename in the error<br>
b) any thoughts why I'm getting the error? sample: (based on the example from <a href="http://build.fhir.org/ig/HL7/fhir-shorthand/#defining-extensions" target="_blank" title="http://build.fhir.org/ig/HL7/fhir-shorthand/#defining-extensions">http://build.fhir.org/ig/HL7/fhir-shorthand/#defining-extensions</a> )</p>
<div class="codehilite"><pre><span></span>Extension: geolocation
Id: geolocation
Description:  &quot;None supplied yet&quot;

* extension contains
    latitude 0..1

// definitions of sub-extensions
* extension[latitude] ^definition = &quot;No description&quot;
* extension[latitude].value[x] only decimal
</pre></div>



<a name="184970379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/184970379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#184970379">(Jan 07 2020 at 00:04)</a>:</h4>
<p>looks like I need to specify the internal url in some way...</p>



<a name="184971431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/184971431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#184971431">(Jan 07 2020 at 00:24)</a>:</h4>
<p>(deleted)</p>



<a name="185016196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185016196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185016196">(Jan 07 2020 at 14:41)</a>:</h4>
<p>Right, I think you need to add the url for the sub-extension:</p>
<div class="codehilite"><pre><span></span>* extension[latitude].url = &quot;latitude&quot;
</pre></div>


<p>I can't access the built documentation (due to the IG Auto Build bug), but the example in the Wiki shows this approach correctly: <a href="https://github.com/HL7/fhir-shorthand/wiki/3.2-Extensions" target="_blank" title="https://github.com/HL7/fhir-shorthand/wiki/3.2-Extensions">https://github.com/HL7/fhir-shorthand/wiki/3.2-Extensions</a></p>
<p>I guess we should think about whether or not it makes sense to infer the url value from the slice name when the author doesn't provide an explicit url value.  That might make sense.</p>



<a name="185016288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185016288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185016288">(Jan 07 2020 at 14:42)</a>:</h4>
<p>Also, I <em>thought</em> we <em>were</em> showing the filename in the error messages, but maybe we missed passing in that metadata for this particular log message.</p>



<a name="185043196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185043196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185043196">(Jan 07 2020 at 19:08)</a>:</h4>
<p>pretty sure I tried that - but will check...</p>



<a name="185044847"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185044847" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185044847">(Jan 07 2020 at 19:26)</a>:</h4>
<p>No - you're right - that did work. Some interesting twists (using a different extension) though. </p>
<p>a) It only needs to be done on the first one - the following works fine (and the ED looks Ok to a cursory view)</p>
<div class="codehilite"><pre><span></span>Extension: practitioner-additional-authorizations
Id: practitioner-additional-authorizations
Description:  &quot;None supplied yet&quot;

* extension contains
    auth 0..1 and
    period 0..1

// definitions of sub-extensions
* extension[auth].url = &quot;auth&quot;
* extension[auth] ^definition = &quot;A code identifying the additional authorisations that a practitioner is authorised to perform&quot;
* extension[auth].value[x] only CodeableConcept

* extension[period] ^definition = &quot;The period the additional authorization is effective&quot;
* extension[period].value[x] only Period
</pre></div>


<p>b) But changing the sub extension name to 'code' results in an error. ie this definition:</p>
<div class="codehilite"><pre><span></span>* extension contains
    code 0..1 and
    period 0..1

// definitions of sub-extensions
* extension[code].url = &quot;code&quot;
* extension[code] ^definition = &quot;A code identifying the additional authorisations that a practitioner is authorised to perform&quot;
* extension[code].value[x] only CodeableConcept

* extension[period] ^definition = &quot;The period the additional authorization is effective&quot;
* extension[period].value[x] only Period
</pre></div>


<p>results in this error (I'm guessing that code is a reserved word):</p>
<div class="codehilite"><pre><span></span>error: No element found at path extension[code].url for practitioner-additional-authorizations, skipping rule
  File: /Users/davidhay/Dropbox/contracting/MOH/ResourcesForRegistryIG/shorthand/extension-practitioner-additional-authorizations.fsh
  Line: 10
error: No element found at path extension[code].value[x] for practitioner-additional-authorizations, skipping rule
  File: /Users/davidhay/Dropbox/contracting/MOH/ResourcesForRegistryIG/shorthand/extension-practitioner-additional-authorizations.fsh
  Line: 12
</pre></div>


<p>c) And it does not like the url being attached to the second sub extension. This definition:</p>
<div class="codehilite"><pre><span></span>* extension contains
    auth 0..1 and
    period 0..1

// definitions of sub-extensions
* extension[auth].url = &quot;auth&quot;
* extension[auth] ^definition = &quot;A code identifying the additional authorisations that a practitioner is authorised to perform&quot;
* extension[auth].value[x] only CodeableConcept

* extension[period].url = &quot;period&quot;
* extension[period] ^definition = &quot;The period the additional authorization is effective&quot;
* extension[period].value[x] only Period
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>error: Cannot fix period to this element; a different uri is already fixed: http://hl7.org/fhir/StructureDefinition/organization-period.
  File: /Users/davidhay/Dropbox/contracting/MOH/ResourcesForRegistryIG/shorthand/extension-practitioner-additional-authorizations.fsh
  Line: 14
</pre></div>



<a name="185050077"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185050077" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185050077">(Jan 07 2020 at 20:14)</a>:</h4>
<p>Issue c) is related to using the slicename 'period' - renaming it makes it work OK...</p>



<a name="185052816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185052816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185052816">(Jan 07 2020 at 20:44)</a>:</h4>
<p>I think <code>a)</code> and <code>c)</code> are actually related.  Here is what's going on... When you say <code>extension contains period 0..1</code>, SUSHI looks for an already existing extension named <code>period</code>.  If it finds one, it uses it (and fixes the <code>url</code>) appropriately.  If it doesn't find one, it sets up the slice so the author can specify the <code>url</code>.  In this case, core FHIR already defines an extension w/ <code>"name": "period"</code> (<a href="http://hl7.org/fhir/R4/extension-organization-period.json.html" target="_blank" title="http://hl7.org/fhir/R4/extension-organization-period.json.html">here</a>), so SUSHI assumes that is what you want and sets it up that way.</p>
<p>This is why <code>a)</code> works .  You don't need to declare the <code>url</code> because SUSHI is using the <code>url</code> from the pre-existing FHIR extension.  It is also why <code>c)</code> fails -- because you can't overwrite an existing fixed value.</p>



<a name="185053010"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185053010" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185053010">(Jan 07 2020 at 20:46)</a>:</h4>
<p>It's an interesting problem.  It seems we might need to adjust how FHIR Shorthand works to make it less ambiguous -- so we know if you are intending to create a <em>new</em> extension or re-use an existing one...  Hmmm....</p>



<a name="185053081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185053081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185053081">(Jan 07 2020 at 20:47)</a>:</h4>
<p>As for <code>b)</code>, I wonder if that is a parser error.  It might be that <code>code</code> is a keyword in our grammar already and that using it in this context confuses the parser.  If that's what is going on, it should be a fairly easy fix.</p>



<a name="185053430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185053430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185053430">(Jan 07 2020 at 20:51)</a>:</h4>
<p>Oh-- I see you had already guessed it was a reserved word.  Good guess!  Ideally though, we don't really want it to be a "reserved" word -- we should allow you to use it in contexts like this.</p>



<a name="185053579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185053579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185053579">(Jan 07 2020 at 20:52)</a>:</h4>
<p>Great to understand how this works! But doesn't this approach mean that names need to be globally unique? Is 'contains' only used for defining sub-extensions?</p>



<a name="185054430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185054430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185054430">(Jan 07 2020 at 21:03)</a>:</h4>
<p><code>contains</code> is used in any context where slices apply.  So... since extensions (and sub-extensions) are really just slices of extension, we use <code>contains</code>.  But you would also use <code>contains</code> to slice any other element as well.  Currently, however, extensions are the only context in which the slice name might refer to an external entity -- so it's the only place where we currently run into this.</p>
<p>Well... that's not entirely true.  In any place we need to look something up by name, there is the possibility of finding the wrong one.  So, for example, <code>performer only Practitioner</code> could refer to the resource Practitioner, but also could refer to a profile with the _name_ Practitioner (if it existed).  The only real way around that is to require full URL identifiers, but that's not very user-friendly.  So... we should document rules about how lookups are performed and what locations are preferred over others -- and if you want something that isn't the "preferred" result of a lookup, only _then_ do you need to use the full URL.</p>
<p>That still doesn't solve the <code>extension contains</code> problem though, since we still can't tell if you want an existing extension or a new one.</p>



<a name="185055212"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/complex%20extensions/near/185055212" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/complex.20extensions.html#185055212">(Jan 07 2020 at 21:11)</a>:</h4>
<p>Using name does seem a bit fragile - to take your 'performer only Practitioner' example, it sounds that it could be quite easy to muck it up. Would alias help out here?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
