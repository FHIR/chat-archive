---
layout: page
title: "FHIR Chat  · dev dependencies · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html">dev dependencies</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="194629249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/194629249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#194629249">(Apr 20 2020 at 02:53)</a>:</h4>
<p>An issue came up when editing another projects  fsh tank. If there is a dependency in package.json labelled #dev, then sushi looks in the local cache to see if the package is there - failing if it can't find it. <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  has suggested that in this scenario sushi should 'fall back' to #current, and attempt to download it...</p>



<a name="194629362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/194629362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#194629362">(Apr 20 2020 at 02:56)</a>:</h4>
<p>that's what #dev is documented to mean</p>



<a name="194673725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/194673725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#194673725">(Apr 20 2020 at 13:23)</a>:</h4>
<p>OK, just found the referenced doc: <a href="https://confluence.hl7.org/pages/viewpage.action?pageId=35718627#IGPublisherDocumentation-DependencyList" title="https://confluence.hl7.org/pages/viewpage.action?pageId=35718627#IGPublisherDocumentation-DependencyList">https://confluence.hl7.org/pages/viewpage.action?pageId=35718627#IGPublisherDocumentation-DependencyList</a></p>
<blockquote>
<p>dev: use the latest local build of the IG. in the absence of a local build, this falls back to using the current version</p>
</blockquote>
<p>We'll look at this in SUSHI.  Thank you!</p>



<a name="194674097"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/194674097" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#194674097">(Apr 20 2020 at 13:26)</a>:</h4>
<p>OK, tracking it in SUSHI as <a href="https://github.com/FHIR/sushi/issues/374" title="https://github.com/FHIR/sushi/issues/374">#374</a>.</p>



<a name="195210962"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/195210962" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#195210962">(Apr 24 2020 at 16:15)</a>:</h4>
<p>So while trying to add support for automatically falling back to <code>#current</code>, we've discovered a difference in how SUSHI handles <code>#current</code> and how the IG Publisher seems to. With SUSHI, if  a dependency is specified as<code>#current</code>, then even if the desired package already exists in the local FHIR cache,  it is overwritten with the newest version found on <a href="https://build.fhir.org/ig/qas.json" title="https://build.fhir.org/ig/qas.json">https://build.fhir.org/ig/qas.json</a>, even if that newest version is exactly the same as what is already cached. We do not try to determine if the package has been updated or not, we just always overwrite.</p>
<p>From some experimenting, it seems like when the IG Publisher sees a dependency that is specified as <code>#current</code>, it does not automatically overwrite that package if it already exists in the local cache. <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> , we were wondering if you could tell us how the IG Publisher determines what to do in this situation. If the IG Publisher uses a certain method for determining when a locally cached <code>#current</code> package needs to be overwritten, and when it does not, we would like to try to match that method in SUSHI.</p>



<a name="195251305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/195251305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#195251305">(Apr 24 2020 at 22:21)</a>:</h4>
<p>being Australian, I am super concerned about bandwidth. (I've currently used 120G of my 80GB allowance 1/3 of the way through the month).</p>



<a name="195252120"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/195252120" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#195252120">(Apr 24 2020 at 22:30)</a>:</h4>
<p>pseudo code is :</p>
<div class="codehilite"><pre><span></span>  <span class="n">NpmPackage</span> <span class="n">npm</span> <span class="o">=</span> <span class="n">loadFromLocalCache</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;current&quot;</span><span class="p">);</span>
  <span class="n">Map</span><span class="o">&lt;</span><span class="n">PackageId</span><span class="p">,</span> <span class="n">URL</span><span class="o">&gt;</span> <span class="n">ciList</span> <span class="o">=</span> <span class="n">loadfrom</span><span class="p">(</span><span class="s">&quot;https://build.fhir.org/ig/qas.json&quot;</span><span class="p">);</span>
  <span class="n">Json</span> <span class="n">json</span> <span class="o">=</span> <span class="n">fetchJson</span><span class="p">(</span><span class="n">ciList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">npm</span><span class="p">.</span><span class="na">name</span><span class="p">())</span> <span class="o">+</span> <span class="s">&quot;/package.manifest.json&quot;</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">currDate</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">packDate</span> <span class="o">=</span> <span class="n">npm</span><span class="p">.</span><span class="na">date</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">currDate</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">packDate</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
  <span class="k">else</span>
      <span class="n">fetchFromCIBuild</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</pre></div>



<a name="195408699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/195408699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#195408699">(Apr 27 2020 at 12:22)</a>:</h4>
<p>Great, thank you for the help! We will look to update that in SUSHI to help save some bandwidth. One more question, where does <code>npm.date()</code> pull the date from? Does it come from the package.json of the relevant package?</p>



<a name="199502644"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/199502644" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#199502644">(Jun 02 2020 at 14:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> we have noticed an odd discrepancy between loading the package <code>hl7.fhir.us.core#3.1.0</code> with the IG Publisher vs with SUSHI. When SUSHI loads this package, it downloads it from <a href="http://packages.fhir.org/hl7.fhir.us.core/3.1.0">packages.fhir.org/hl7.fhir.us.core/3.1.0</a>, and the folder that gets decompressed and added to the FHIR cache has this structure:<br>
<a href="/user_uploads/10155/8sHQo3WYcDsTrpZLhXh_wvMz/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/8sHQo3WYcDsTrpZLhXh_wvMz/image.png" title="image.png"><img src="/user_uploads/10155/8sHQo3WYcDsTrpZLhXh_wvMz/image.png"></a></div><p>The above is the same structure you see if you visit <a href="http://packages.fhir.org/hl7.fhir.us.core/3.1.0">packages.fhir.org/hl7.fhir.us.core/3.1.0</a> and decompress the downloaded package manually.</p>
<p>But if we instead use the IG Publisher to add this package to the cache, the folder that gets decompressed and added to the cache has this structure:<br>
<a href="/user_uploads/10155/KnRb_wRUEtbcj5W4L39lAbZL/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/KnRb_wRUEtbcj5W4L39lAbZL/image.png" title="image.png"><img src="/user_uploads/10155/KnRb_wRUEtbcj5W4L39lAbZL/image.png"></a></div><p>And the <code>example</code>, <code>openapi</code>, <code>other</code>, and <code>xml</code> folders are nested within that <code>package</code> folder. This is the format we would expect based on the specification of FHIR NPM packages. So we are wondering:</p>
<ol>
<li>Is the IG Publisher getting that package from <a href="http://packages.fhir.org">packages.fhir.org</a>?</li>
<li>If yes, is the IG Publisher doing anything special to change the format of the package downloaded from <a href="http://packages.fhir.org">packages.fhir.org</a>?</li>
<li>If yes, do you expect it could be an issue if SUSHI <em>does not</em> change the format of the package in a similar way?</li>
</ol>
<p>Thank you for any insight!</p>



<a name="199556722"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/199556722" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#199556722">(Jun 02 2020 at 21:30)</a>:</h4>
<p>There's history here. When we first wrote the NPM package specification, we said that these other folders would be peers of the <code>package</code> directory. And that's what you're seeing</p>



<a name="199556914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/199556914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#199556914">(Jun 02 2020 at 21:33)</a>:</h4>
<p>but in November last year, at DevDays in Amsterdam, it was pointed out in the Packages session that this is not conformant and they have to sub-folders of <code>package</code> not peers. It's too late to fix previously published packages but all new packages will have the folders as sub-folders. For consistency, those peer folders are turned into sub-folders when the package is installed into the local cache.</p>



<a name="199557081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/199557081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#199557081">(Jun 02 2020 at 21:34)</a>:</h4>
<p>I think it probably does matter that things are consistent. It might not matter to the java tools - they probably ignore the difference when reading the installed package too... not sure. but other tools will eventually run into this. probably. Or possibly, at least</p>



<a name="199629119"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/199629119" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#199629119">(Jun 03 2020 at 14:50)</a>:</h4>
<p>Interesting, thank you for the detailed explanation!</p>



<a name="201166126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/dev%20dependencies/near/201166126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/dev.20dependencies.html#201166126">(Jun 17 2020 at 16:29)</a>:</h4>
<p>BTW -- <span class="user-mention" data-user-id="239822">@Nick Freiter</span> implemented the package restructuring in SUSHI here: <a href="https://github.com/FHIR/sushi/pull/482">https://github.com/FHIR/sushi/pull/482</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
