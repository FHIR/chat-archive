---
layout: page
title: "FHIR Chat  · slicing an extension on a slice · shorthand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/index.html">shorthand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html">slicing an extension on a slice</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="263715247"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263715247" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263715247">(Dec 04 2021 at 15:53)</a>:</h4>
<p>I am struggling with defining a slice on an extension that is inside a slice. where the slice discriminator is the extension's valueReference.identifier.type. I have defined this, which does build</p>
<div class="codehilite"><pre><span></span><code>* agent.extension contains OtherId named otherId 0..* MS
* agent[user].extension[otherId] ^slicing.discriminator.type = #pattern
* agent[user].extension[otherId] ^slicing.discriminator.path = &quot;valueReference.identifier.type&quot;
* agent[user].extension[otherId] ^slicing.rules = #open
* agent[user].extension[otherId] contains
    subject-id 0..1 and
    npi 0..1 and
    provider-id 0..1
* agent[user].extension[otherId][subject-id].valueReference.identifier.type = OtherIdentifierTypes#SAML-subject-id
* agent[user].extension[otherId][subject-id].valueReference.identifier.value 1..1 MS
* agent[user].extension[otherId][subject-id].valueReference.identifier.value ^short = &quot;SAML Attribute subject-id&quot;
</code></pre></div>
<p>but my examples having this... </p>
<div class="codehilite"><pre><span></span><code>* agent[user].extension[otherId][subject-id].valueReference.identifier.type = OtherIdentifierTypes#SAML-subject-id
* agent[user].extension[otherId][subject-id].valueReference.identifier.value = &quot;JohnDoe&quot;
</code></pre></div>
<p>get build error thrown by the build</p>
<div class="codehilite"><pre><span></span><code>error   Slicing cannot be evaluated: Could not match discriminator ([url]) for slice AuditEvent.agent:user.extension:otherId/subject-id in profile http://profiles.ihe.net/ITI/BasicAudit/StructureDefinition/ITI.BasicAudit.SAMLaccessTokenUse.Comprehensive - the discriminator [url] does not have fixed value, binding or existence assertions
</code></pre></div>
<p>First, not sure I did the slice in sushi right, but it seems happy at the sushi level.</p>



<a name="263715252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263715252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263715252">(Dec 04 2021 at 15:53)</a>:</h4>
<p>Oh, this is on AuditEvent resource</p>



<a name="263715334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263715334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263715334">(Dec 04 2021 at 15:55)</a>:</h4>
<p>Here is the IG build, pointing at the example that fails - <a href="http://build.fhir.org/ig/IHE/ITI.BasicAudit/branches/main/AuditEvent-ex-auditPoke-SAML-Comp.html">http://build.fhir.org/ig/IHE/ITI.BasicAudit/branches/main/AuditEvent-ex-auditPoke-SAML-Comp.html</a></p>



<a name="263715507"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263715507" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263715507">(Dec 04 2021 at 15:59)</a>:</h4>
<p>SPECIFICALLY is the following discriminator path legal?</p>
<div class="codehilite"><pre><span></span><code>^slicing.discriminator.path = &quot;valueReference.identifier.type&quot;
</code></pre></div>



<a name="263715724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263715724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263715724">(Dec 04 2021 at 16:01)</a>:</h4>
<p>or does the discriminator path MUST be at the root of the slice?</p>



<a name="263739437"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263739437" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263739437">(Dec 05 2021 at 00:08)</a>:</h4>
<p>It seems a long shot, but should <code>valueReference</code> be <code>value[x]:valueReference</code> throughout?</p>



<a name="263739507"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263739507" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263739507">(Dec 05 2021 at 00:10)</a>:</h4>
<p>I'm pretty sure a discriminator doesn't need to be at the root.</p>



<a name="263740340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263740340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263740340">(Dec 05 2021 at 00:35)</a>:</h4>
<p>I believe that, in FHIRPath, there is no valueReference, there is just value.  so "(value as Reference).identifier.type" should/might work.</p>



<a name="263740538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263740538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263740538">(Dec 05 2021 at 00:41)</a>:</h4>
<p>nope, just tried it and it gets the same error.  sorry.</p>



<a name="263740796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263740796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263740796">(Dec 05 2021 at 00:49)</a>:</h4>
<p>this might be the problem that I had with davinci PAS.  I think that SUSHI has been updated to fix it? or this is entirely new and you've found a new edge case :)</p>



<a name="263919886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263919886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263919886">(Dec 06 2021 at 20:25)</a>:</h4>
<p>This conversation is continuing on the <a class="stream" data-stream-id="179252" href="/#narrow/stream/179252-IG-creation">#IG creation</a> stream here: <a href="#narrow/stream/179252-IG-creation/topic/slicing.20sliced.20extension">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/slicing.20sliced.20extension</a></p>



<a name="263933707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263933707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263933707">(Dec 06 2021 at 22:24)</a>:</h4>
<p>so, a possible sushi problem... Many problems went away when I brought the original definition of the first slice into the second profile. Let me explain. I had a base profile that defined the slice and a set of criteria, I had a second profile that derived off of that first one, adding a bunch more things. This works for some kinds of things, but didn't seem to get everything right. When I copyied the first profile constraints into the second, then some of my problems went away..... Still working on the other issues, so not fully clear yet.</p>



<a name="263934517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/263934517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#263934517">(Dec 06 2021 at 22:32)</a>:</h4>
<p>so it was not specifically a profile derived on a profile. It seems I needed to add the extensions to the .agent in the first profile, adding them in the second is what didn't work as well. Not a problem for me to add them in the first profile, but they are not really needed there.</p>



<a name="264001014"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/264001014" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#264001014">(Dec 07 2021 at 13:33)</a>:</h4>
<p>Interesting.  It's still not clear to me if this is an issue w/ SUSHI or an issue w/ the snapshot generator.  As I noted in the other thread, the snapshot generator did not seem to be correctly generating the slices (it dropped the extension type).  So it's possible that your fix somehow addressed the limitation in the snapshot generator.</p>



<a name="264008597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/264008597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#264008597">(Dec 07 2021 at 14:27)</a>:</h4>
<p>yup, I was just trying to update this stream about that specific hack that got me a bit further. That hack is that I needed to add the extensions in my primary profile, couldn't add them in the secondary profile.</p>



<a name="275389152"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275389152" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275389152">(Mar 15 2022 at 15:32)</a>:</h4>
<p>I am still having trouble slicing an extension in a slice ... Here is my test IG that focuses ONLY on this issue - <a href="http://build.fhir.org/ig/JohnMoehrke/SlicingSlicedExtension/branches/main/index.html">http://build.fhir.org/ig/JohnMoehrke/SlicingSlicedExtension/branches/main/index.html</a></p>



<a name="275430394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275430394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275430394">(Mar 15 2022 at 20:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> I  augmented the json that sushi spits out, and suppressed sushi running.. .but I still get the same error, so I don't think I understood fully the augmention you recommended.</p>
<p>adding in the base and type as shown here.</p>
<div class="codehilite"><pre><span></span><code>      {
        &quot;id&quot;: &quot;AuditEvent.agent:user.extension:extOtherId/npi&quot;,
        &quot;path&quot;: &quot;AuditEvent.agent.extension&quot;,
        &quot;sliceName&quot;: &quot;extOtherId/npi&quot;,
        &quot;min&quot;: 0,
        &quot;max&quot;: &quot;1&quot;,
        &quot;base&quot;: {
            &quot;path&quot;: &quot;Element.extension&quot;,
            &quot;min&quot;: 0,
            &quot;max&quot;: &quot;*&quot;
        },
        &quot;type&quot;: [
          {
            &quot;code&quot;: &quot;Extension&quot;
          }
        ]
      },
      {
        &quot;id&quot;: &quot;AuditEvent.agent:user.extension:extOtherId/npi.valueReference&quot;,
        &quot;path&quot;: &quot;AuditEvent.agent.extension.valueReference&quot;
      },
      {
        &quot;id&quot;: &quot;AuditEvent.agent:user.extension:extOtherId/npi.valueReference.identifier.type&quot;,
        &quot;path&quot;: &quot;AuditEvent.agent.extension.valueReference.identifier.type&quot;,
        &quot;patternCodeableConcept&quot;: {
          &quot;coding&quot;: [
            {
              &quot;code&quot;: &quot;NPI&quot;,
              &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v2-0203&quot;
            }
          ]
        }
      },
</code></pre></div>



<a name="275432877"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275432877" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275432877">(Mar 15 2022 at 20:45)</a>:</h4>
<p>I'm still seeing a bare type="Extension" and no profile declared on extension:extOtherId/npi</p>



<a name="275432895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275432895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275432895">(Mar 15 2022 at 20:45)</a>:</h4>
<p>That declaration needs to include the extension profile</p>



<a name="275433563"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275433563" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275433563">(Mar 15 2022 at 20:51)</a>:</h4>
<p>ah, Ill try that</p>



<a name="275434727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275434727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275434727">(Mar 15 2022 at 21:01)</a>:</h4>
<p>didn't help.. but I might have still done it wrong</p>



<a name="275442450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275442450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275442450">(Mar 15 2022 at 22:07)</a>:</h4>
<p>I committed to github the enhanced json project - <a href="https://github.com/JohnMoehrke/SlicingSlicedExtension">https://github.com/JohnMoehrke/SlicingSlicedExtension</a></p>



<a name="275442470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275442470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275442470">(Mar 15 2022 at 22:07)</a>:</h4>
<p>I welcome further enhancements to make it work</p>



<a name="275577341"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/215610-shorthand/topic/slicing%20an%20extension%20on%20a%20slice/near/275577341" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/215610-shorthand/topic/slicing.20an.20extension.20on.20a.20slice.html#275577341">(Mar 16 2022 at 21:07)</a>:</h4>
<p>I've done some more investigation on this and found some interesting issues in snapshot generation.  Since this topic is in two streams now, I'll just direct you to the other stream where I noted my findings: <a href="#narrow/stream/179252-IG-creation/topic/slicing.20sliced.20extension/near/275577171">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/slicing.20sliced.20extension/near/275577171</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
