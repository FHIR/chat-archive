---
layout: page
title: "FHIR Chat  · fastAPI + fhir.resources · python"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179218-python/index.html">python</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html">fastAPI + fhir.resources</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="234935249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/234935249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#234935249">(Apr 16 2021 at 23:25)</a>:</h4>
<p>I am trying to use fastAPI + fhir.resources.  However,  I am having some issues with it and the OpenAPI docs.  <br>
here is my attempt  in python 3.7.3 following the basic fastAPI tutorial but substituting in the fhir.resources model:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">fhir.resources.practitioner</span> <span class="kn">import</span> <span class="n">Period</span>
<span class="kn">from</span> <span class="nn">fhir.resources.fhirtypes</span> <span class="kn">import</span> <span class="n">PeriodType</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/period/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">PeriodType</span><span class="p">,</span> <span class="n">response_model_exclude_unset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_item</span><span class="p">(</span><span class="n">period</span><span class="p">:</span> <span class="n">Period</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">period</span>
</code></pre></div>
<p>When trying to execute using this object in swagger:</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
  <span class="nt">"resource_type"</span><span class="p">:</span> <span class="s2">"Period"</span><span class="p">,</span>
  <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"string"</span>
<span class="p">}</span>
</code></pre></div>
<p>I get this error:<br>
TypeError: dict() got an unexpected keyword argument 'exclude_unset'</p>



<a name="234935395"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/234935395" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#234935395">(Apr 16 2021 at 23:27)</a>:</h4>
<p>am I missing something obvious in fastAPI.. If we could use fastAPI and get swagger docs out of the box that would be huge.</p>



<a name="235201610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235201610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235201610">(Apr 19 2021 at 15:35)</a>:</h4>
<p>more on this,  the models don't support all of <a href="https://pydantic-docs.helpmanual.io/usage/exporting_models/">Pydantic's dict() method arguments</a>:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="kn">from</span> <span class="nn">fhir.resources.period</span> <span class="kn">import</span> <span class="n">Period</span>
<span class="kn">from</span> <span class="nn">fhir.resources.fhirtypes</span> <span class="kn">import</span> <span class="n">PeriodType</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Period</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"/Users/ehaas/Documents/Python/fastAPI_tutorial/main.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">7</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="nb">dict</span><span class="p">()</span> <span class="n">got</span> <span class="n">an</span> <span class="n">unexpected</span> <span class="n">keyword</span> <span class="n">argument</span> <span class="s1">'exclude_unset'</span>
<span class="p">[</span><span class="n">Finished</span> <span class="ow">in</span> <span class="mf">0.33</span><span class="n">s</span><span class="p">]</span>
</code></pre></div>



<a name="235203602"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235203602" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235203602">(Apr 19 2021 at 15:49)</a>:</h4>
<p>looking at the inheritance of Period:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="p">[</span><span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">fhir</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">Period</span><span class="s1">'&gt;, &lt;class '</span><span class="n">fhir</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">Element</span><span class="s1">'&gt;, &lt;class '</span><span class="n">fhir</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">fhirabstractmodel</span><span class="o">.</span><span class="n">FHIRAbstractModel</span><span class="s1">'&gt;, &lt;class '</span><span class="n">pydantic</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">BaseModel</span><span class="s1">'&gt;, &lt;class '</span><span class="n">pydantic</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Representation</span><span class="s1">'&gt;, &lt;class '</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="s1">'&gt;, &lt;class '</span><span class="nb">object</span><span class="s1">'&gt;]</span>
</code></pre></div>



<a name="235210773"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235210773" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235210773">(Apr 19 2021 at 16:34)</a>:</h4>
<p>I am in over my head with python subclassing and pydantic but the FHIRBaseClass seems to be passing these arguments through so why are the models not allowing it?</p>



<a name="235230569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235230569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Anderson <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235230569">(Apr 19 2021 at 18:56)</a>:</h4>
<p>I'm not sure what's wrong - but I can't recreate your issue.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>can@T410-W10 ~ <span class="o">()</span> $ pip3 install fhir fhir.resources
Collecting fhir
  Using cached fhir-0.0.4.tar.gz <span class="o">(</span><span class="m">18</span> kB<span class="o">)</span>
Building wheels <span class="k">for</span> collected packages: fhir
  Building wheel <span class="k">for</span> fhir <span class="o">(</span>setup.py<span class="o">)</span> ... <span class="k">done</span>
  Created wheel <span class="k">for</span> fhir: <span class="nv">filename</span><span class="o">=</span>fhir-0.0.4-py3-none-any.whl <span class="nv">size</span><span class="o">=</span><span class="m">16555</span> <span class="nv">sha256</span><span class="o">=</span>03bc66e2374d97729a7a856d49dd2a7318ba999205b306a6173ff5ca168296d9
  Stored <span class="k">in</span> directory: /Users/can/Library/Caches/pip/wheels/e6/ac/1b/7fecf3a4531dd5b8129e0b07c606f940bb30633a4b95ac6023
Successfully built fhir
Installing collected packages: fhir
Successfully installed fhir-0.0.4
Collecting fhir.resources
  Downloading fhir.resources-6.1.0-py2.py3-none-any.whl <span class="o">(</span><span class="m">2</span>.3 MB<span class="o">)</span>
     <span class="p">|</span>████████████████████████████████<span class="p">|</span> <span class="m">2</span>.3 MB <span class="m">1</span>.6 MB/s
Collecting pydantic<span class="o">[</span>email<span class="o">]</span>&gt;<span class="o">=</span><span class="m">1</span>.7.2
  Downloading pydantic-1.8.1-cp38-cp38-macosx_10_9_x86_64.whl <span class="o">(</span><span class="m">2</span>.6 MB<span class="o">)</span>
     <span class="p">|</span>████████████████████████████████<span class="p">|</span> <span class="m">2</span>.6 MB <span class="m">17</span>.5 MB/s
Collecting typing-extensions&gt;<span class="o">=</span><span class="m">3</span>.7.4.3
  Downloading typing_extensions-3.7.4.3-py3-none-any.whl <span class="o">(</span><span class="m">22</span> kB<span class="o">)</span>
Collecting email-validator&gt;<span class="o">=</span><span class="m">1</span>.0.3<span class="p">;</span> <span class="nv">extra</span> <span class="o">==</span> <span class="s2">"email"</span>
  Downloading email_validator-1.1.2-py2.py3-none-any.whl <span class="o">(</span><span class="m">17</span> kB<span class="o">)</span>
Requirement already satisfied: idna&gt;<span class="o">=</span><span class="m">2</span>.0.0 <span class="k">in</span> /usr/local/lib/python3.8/site-packages <span class="o">(</span>from email-validator&gt;<span class="o">=</span><span class="m">1</span>.0.3<span class="p">;</span> <span class="nv">extra</span> <span class="o">==</span> <span class="s2">"email"</span>-&gt;pydantic<span class="o">[</span>email<span class="o">]</span>&gt;<span class="o">=</span><span class="m">1</span>.7.2-&gt;fhir.resources<span class="o">)</span> <span class="o">(</span><span class="m">2</span>.10<span class="o">)</span>
Collecting dnspython&gt;<span class="o">=</span><span class="m">1</span>.15.0
  Downloading dnspython-2.1.0-py3-none-any.whl <span class="o">(</span><span class="m">241</span> kB<span class="o">)</span>
     <span class="p">|</span>████████████████████████████████<span class="p">|</span> <span class="m">241</span> kB <span class="m">16</span>.7 MB/s
Installing collected packages: typing-extensions, dnspython, email-validator, pydantic, fhir.resources
Successfully installed dnspython-2.1.0 email-validator-1.1.2 fhir.resources-6.1.0 pydantic-1.8.1 typing-extensions-3.7.4.3

can@T410-W10 ~ <span class="o">()</span> $ ipython
Python <span class="m">3</span>.8.5 <span class="o">(</span>default, Jul <span class="m">21</span> <span class="m">2020</span>, <span class="m">10</span>:42:08<span class="o">)</span>
Type <span class="s1">'copyright'</span>, <span class="s1">'credits'</span> or <span class="s1">'license'</span> <span class="k">for</span> more information
IPython <span class="m">7</span>.16.1 -- An enhanced Interactive Python. Type <span class="s1">'?'</span> <span class="k">for</span> help.

In <span class="o">[</span><span class="m">1</span><span class="o">]</span>: %cpaste
Pasting code<span class="p">;</span> enter <span class="s1">'--'</span> alone on the line to stop or use Ctrl-D.
:from fhir.resources.period import Period
from fhir.resources.fhirtypes import PeriodType

<span class="nv">p</span> <span class="o">=</span> Period<span class="o">()</span>
print<span class="o">(</span>p.dict<span class="o">(</span><span class="nv">exclude_unset</span><span class="o">=</span>True<span class="o">))</span>::::
:--
<span class="o">{}</span>

In <span class="o">[</span><span class="m">2</span><span class="o">]</span>:
</code></pre></div>



<a name="235231032"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235231032" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Anderson <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235231032">(Apr 19 2021 at 18:59)</a>:</h4>
<p>However, the online docs for pydantic suggest that <code>exclude_unset</code> has replaced an older, deprecated keyword <code>skip_defaults</code> - so maybe your installed pydantic module is out of date...</p>



<a name="235235040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235235040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235235040">(Apr 19 2021 at 19:26)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="233081">@Carl Anderson</span>  I will check my environmental variables</p>



<a name="235238371"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235238371" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Anderson <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235238371">(Apr 19 2021 at 19:52)</a>:</h4>
<p>You might try <code>pip show pydantic</code></p>



<a name="235246874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235246874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235246874">(Apr 19 2021 at 20:53)</a>:</h4>
<p>I updated my environment from python 3.7.3 to latest version of python 3.9.4 and that seemed to do the trick.</p>



<a name="235248143"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235248143" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235248143">(Apr 19 2021 at 21:01)</a>:</h4>
<p>also tried a new 3.7.3 environment and that works too</p>



<a name="235374388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235374388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235374388">(Apr 20 2021 at 16:33)</a>:</h4>
<p>I am unable to get the swagger UI to display the resource_type on the response.  I have tried several method arguments and a couple of string values but does anyone know a simple way to get it  to display?</p>



<a name="235375143"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235375143" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235375143">(Apr 20 2021 at 16:37)</a>:</h4>
<p>for example this code:</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">fhir.resources.period</span> <span class="kn">import</span> <span class="n">Period</span>
<span class="kn">from</span> <span class="nn">fhir.resources.fhirtypes</span> <span class="kn">import</span> <span class="n">PeriodType</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/period/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Period</span><span class="p">,</span> <span class="n">response_model_exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_item</span><span class="p">(</span><span class="n">period</span><span class="p">:</span> <span class="n">Period</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">period</span>
</code></pre></div>
<p>results in this:</p>
<p><a href="/user_uploads/10155/OCKoLIYZFMTS4PwSppoJFooH/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/OCKoLIYZFMTS4PwSppoJFooH/image.png" title="image.png"><img src="/user_uploads/10155/OCKoLIYZFMTS4PwSppoJFooH/image.png"></a></div>



<a name="235375421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/fastAPI%20%2B%20fhir.resources/near/235375421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/fastAPI.20.2B.20fhir.2Eresources.html#235375421">(Apr 20 2021 at 16:39)</a>:</h4>
<p>also <span class="user-mention" data-user-id="197422">@Md Nazrul Islam</span>  what is the difference in the the response_model being "Period_type" instead of  "Period".  I didn't see any difference in behavior in my simple little Swagger example?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
