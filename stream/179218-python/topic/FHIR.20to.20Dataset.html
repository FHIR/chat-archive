---
layout: page
title: "FHIR Chat  · FHIR to Dataset · python"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179218-python/index.html">python</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html">FHIR to Dataset</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="187815501"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/187815501" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Théo Ryffel <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#187815501">(Feb 10 2020 at 13:39)</a>:</h4>
<p>Hi @all,<br>
I'm new to this chat <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span></p>
<p>I was wondering, is there any python tool out there to specify and extract a dataset from a FHIR api to do some Machine Learning?<br>
Typical output structure would be a pandas dataframe or a pyTorch Dataset. <br>
I'm looking for smthg which doesn't use Spark, only assumes there is a FHIR api available, and allows to get back a flat dataset containing stuff like Patient age, bodyweight, and last episofe of care date.<br>
Cheers!<br>
Théo</p>



<a name="187927989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/187927989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#187927989">(Feb 11 2020 at 16:32)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="252922">@Théo Ryffel</span>, nothing that does exactly that already, but it shouldn't be too hard to create it with one of the previously mentioned clients: <a href="#narrow/stream/179218-python/topic/FHIR.20101.20Jupyter.20notebook/near/187329666" title="#narrow/stream/179218-python/topic/FHIR.20101.20Jupyter.20notebook/near/187329666">https://chat.fhir.org/#narrow/stream/179218-python/topic/FHIR.20101.20Jupyter.20notebook/near/187329666</a>.<br>
Build the query for the resources you need and  flatten the JSON to a Pandas dataframe.</p>



<a name="187933872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/187933872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex F. Bokov, Ph.D. <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#187933872">(Feb 11 2020 at 17:34)</a>:</h4>
<p>(deleted)</p>



<a name="187933968"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/187933968" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex F. Bokov, Ph.D. <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#187933968">(Feb 11 2020 at 17:35)</a>:</h4>
<p>Funny that you posted this just now-- I also asked <a href="#narrow/stream/179166-implementers/topic/What.20is.20the.20state.20of.20FHIR-.3ECSV.20export.3F/near/187932675" title="#narrow/stream/179166-implementers/topic/What.20is.20the.20state.20of.20FHIR-.3ECSV.20export.3F/near/187932675">a similar question</a> in #implementers </p>
<p>This extends beyond Python-- there needs to be a general-purpose tool for doing this, for any selection of FHIR resources.</p>



<a name="187950077"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/187950077" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#187950077">(Feb 11 2020 at 20:14)</a>:</h4>
<p>Pandas is the way to go ...  I use Pandas to create instances but not the other way. ( well technically I go excel --&gt; Panda df --&gt; FHIR instance.  ) anybody going the other way?</p>



<a name="188022222"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/188022222" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#188022222">(Feb 12 2020 at 15:51)</a>:</h4>
<p><span class="user-mention" data-user-id="196561">@Nick George</span> This seems like an excellent use case for Protobuf based FHIR, right? <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="188035505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/188035505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex F. Bokov, Ph.D. <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#188035505">(Feb 12 2020 at 17:54)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="196561">Nick George</span> This seems like an excellent use case for Protobuf based FHIR, right? <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>
</blockquote>
<p>Wow, I learned several new things googling what you just wrote.</p>
<p>You're talking about <a href="https://github.com/google/fhir" target="_blank" title="https://github.com/google/fhir">https://github.com/google/fhir</a> , right?</p>
<p>But, how would converting a FHIR message to a protobuf string help turn it into a tabular format?</p>
<p>Or, are you saying that the values of individual cells would be chunks of the FHIR message serialized in the protobuf format?</p>



<a name="188037340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/188037340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#188037340">(Feb 12 2020 at 18:11)</a>:</h4>
<p>One of the things they do when converting to Protobuf is converting some difficult fields to a format that's easier to work with in tabular format: <a href="https://youtu.be/iBkyZ86eiiw?t=1635" target="_blank" title="https://youtu.be/iBkyZ86eiiw?t=1635">https://youtu.be/iBkyZ86eiiw?t=1635</a>. But also generally Protobuf might be a good format to work with when doing machine learning.</p>
<div class="youtube-video message_inline_image"><a data-id="iBkyZ86eiiw" href="https://youtu.be/iBkyZ86eiiw?t=1635" target="_blank" title="https://youtu.be/iBkyZ86eiiw?t=1635"><img src="https://i.ytimg.com/vi/iBkyZ86eiiw/default.jpg"></a></div>



<a name="188138746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/188138746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#188138746">(Feb 13 2020 at 19:03)</a>:</h4>
<p>Here is simple and naive FHIR instance to dataframe to csv transform with and without a flattening algorithm.  This is kind of a brute force method as a starting point and there is no round tripping but I think that would be relatively straight forward.</p>
<p><span aria-label="notebook" class="emoji emoji-1f4d3" role="img" title="notebook">:notebook:</span> <a href="https://mybinder.org/v2/gh/Healthedata1/MyBinder/master" target="_blank" title="https://mybinder.org/v2/gh/Healthedata1/MyBinder/master">https://mybinder.org/v2/gh/Healthedata1/MyBinder/master</a></p>
<p>to start the Notebook:</p>
<ol>
<li>click on the <code>FHIR-to-CSV</code> folder</li>
<li>click on the notebook file <code>FHIR-to-csv.ipynb</code></li>
</ol>



<a name="188162342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/188162342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex F. Bokov, Ph.D. <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#188162342">(Feb 13 2020 at 23:09)</a>:</h4>
<blockquote>
<p>Here is simple and naive FHIR instance to dataframe to csv transform with and without a flattening algorithm.  This is kind of a brute force method as a starting point and there is no round tripping but I think that would be relatively straight forward.</p>
<p><span aria-label="notebook" class="emoji emoji-1f4d3" role="img" title="notebook">:notebook:</span> <a href="https://mybinder.org/v2/gh/Healthedata1/MyBinder/master" target="_blank" title="https://mybinder.org/v2/gh/Healthedata1/MyBinder/master">https://mybinder.org/v2/gh/Healthedata1/MyBinder/master</a></p>
<p>to start the Notebook:</p>
<ol>
<li>click on the <code>FHIR-to-CSV</code> folder</li>
<li>click on the notebook file <code>FHIR-to-csv.ipynb</code></li>
</ol>
</blockquote>
<p>Cool! This is very helpful.</p>
<p>I tried an uglier, multi-resource query:</p>
<div class="codehilite"><pre><span></span>http://hapi.fhir.org/baseDstu2/Patient?_id=1834&amp;_revinclude=Encounter:patient&amp;_revinclude=Condition:patient&amp;_revinclude=DiagnosticReport:patient&amp;_include=DiagnosticReport:result&amp;_revinclude=Procedure:subject
</pre></div>


<p>It still worked, though it didn't traverse the branches all the way down, which is to be expected since I didn't tell it how far down to go.</p>
<p>Do you think there is a way to tell <code>squash()</code> to look for distinct elements that share the same <code>start</code>, <code>performedDateTime</code>, <code>issues</code>, <code>onsetDateTime</code>, or <code>effectiveDateTime</code> rounded down to the closest day and put each such set in its own row, creating empty cells for elements that are missing on that day?</p>
<p>FYI, in the process I learned that <code>loads()</code> gets confused by the escaped <code>"</code> s in HAPI DSTU2 <code>text.div</code> values. This can be fixed by replacing the backslashes with double backslashes in the input data.</p>



<a name="188167070"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/188167070" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#188167070">(Feb 14 2020 at 00:23)</a>:</h4>
<p>re the text.div you can pop it out too if you don't need it .<br>
I updated the notebook to show some simple black lists  in a custom flatten function ( you could white list the same way)  This function is simplified version of the <a href="https://pypi.org/project/flatten-json/" target="_blank" title="https://pypi.org/project/flatten-json/">library version</a>.</p>



<a name="191504034"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/191504034" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#191504034">(Mar 23 2020 at 17:00)</a>:</h4>
<p>Here are a couple of example scripts:  </p>
<ol>
<li>The takes a search bundle and converts it to a Panda dataframe flattening the data of interest  ( note the identifiers and codeableConcepts are not flattened) and does some simple stats and plots:</li>
<li>Using GraphQL which does all the work to flatten the data and then convert to Panda dataframe and and does some simple stats and plots:<br>
to start the Notebook:</li>
</ol>
<p><span aria-label="notebook" class="emoji emoji-1f4d3" role="img" title="notebook">:notebook:</span> <a href="https://mybinder.org/v2/gh/Healthedata1/MyBinder/master" target="_blank" title="https://mybinder.org/v2/gh/Healthedata1/MyBinder/master">https://mybinder.org/v2/gh/Healthedata1/MyBinder/master</a></p>
<ol>
<li>click on the <code>FHIR-to-Panda</code> folder</li>
<li>for 1. click on the notebook file <code>Playing_with_pandas_pt4.ipynb</code></li>
<li>for 2. click on the notebook file<code>Playing_with_pandas_pt2.ipynb</code></li>
</ol>



<a name="191748906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/191748906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Théo Ryffel <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#191748906">(Mar 25 2020 at 14:02)</a>:</h4>
<p>I'm looping back here to know if there are any updates. <span class="user-mention" data-user-id="263598">@Alex F. Bokov, Ph.D.</span>  are you now working using <span aria-label="notebook" class="emoji emoji-1f4d3" role="img" title="notebook">:notebook:</span> <a href="https://mybinder.org/v2/gh/Healthedata1/MyBinder/master" title="https://mybinder.org/v2/gh/Healthedata1/MyBinder/master">https://mybinder.org/v2/gh/Healthedata1/MyBinder/master</a> ?</p>
<p>I'm very interested by the SQL on FHIR initiative but I haven't found lots of details about it. In particular what's cool about this idea is that virtually everyone one know this query model, while graphql would be smarter but less user friendly for beginners.</p>
<p>In the meantime, I don't think anyone would want to really transform their FHIR data into SQL tables (well at least not everyone!) and we shouldn't make any assumption on how people really store your data (mongo, postgres+jsonb, etc).  The best way to query data would then be the rest API again because this is the most used interface.</p>
<p>So, putting back together my ideas: I'd like a SQL-like language which would transform the query into (possibly &gt;1) API calls and involve minimal post-processing on the data.</p>
<p>Does this sounds conceptually like feasible? We're trying to do a small proof of concept (open-source) but I'd like feedback on the overall direction before diving too much into it :)</p>



<a name="191806643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/191806643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#191806643">(Mar 25 2020 at 20:27)</a>:</h4>
<p>you should ask this on the <a class="stream" data-stream-id="179219" href="/#narrow/stream/179219-analytics-on-FHIR">#analytics on FHIR</a> channel</p>



<a name="192017955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179218-python/topic/FHIR%20to%20Dataset/near/192017955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Théo Ryffel <a href="https://fhir.github.io/chat-archive/stream/179218-python/topic/FHIR.20to.20Dataset.html#192017955">(Mar 27 2020 at 13:41)</a>:</h4>
<p>Oh god I thought I was already on the #analytics on FHIR channel! Thanks a lot, I'm moving there</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
