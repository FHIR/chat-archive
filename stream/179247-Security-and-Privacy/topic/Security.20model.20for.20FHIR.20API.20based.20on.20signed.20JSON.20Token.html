---
layout: page
title: "FHIR Chat  · Security model for FHIR API based on signed JSON Token · Security and Privacy"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/index.html">Security and Privacy</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html">Security model for FHIR API based on signed JSON Token</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="181802477"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181802477" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivano Tomainu <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181802477">(Nov 25 2019 at 08:56)</a>:</h4>
<p>As anticipated in <a class="stream" data-stream-id="179166" href="/#narrow/stream/179166-implementers">#implementers</a>  stream here is a proposal for discussion about the security model we have implemented.</p>
<p><strong>SCENARIO</strong><br>
We have to publish a FHIR API to a trusted third party (e.g. a private clinic), we don’t want to know the registry of their users, we don’t want to manage singular permissions. The API is invoked from the server of the third party to our server, not directly form a client.</p>
<p><strong>SECURITY CONSTRAINTS</strong><br>
•   Communication between servers must be encrypted<br>
•   We must enable only some third parties to call the service<br>
•   We have to audit WHO used the service, at what time, for which patient…</p>
<p><strong>SECURITY MODEL</strong><br>
The first two requisites are covered by using the TLS protocol, restricted by server IP, with a mutual certification; the certificate is nominal for each party and is released by our Certification Authority (the private key is held by the third party).<br>
To perform the audit trail of the singular operation we ask the caller to assert what follows:<br>
•   Timestamp<br>
•   Requestor ID<br>
•   Operator ID<br>
•   Operator role<br>
•   Resource ID<br>
All mentioned fields must be passed in the header of the REST call, inside a signed JSON token that must have this structure:<br>
BASE64URL(UTF8(JWS Protected Header)) || '.' || BASE64URL(JWS Payload) || '.' || BASE64URL(JWS Signature)<br>
The last part of the token is the signature of header and payload, in accordance with JWS standard (Json Web Signature RFC7515).</p>
<p><strong>IMPLEMENTATION</strong><br>
The JOSE header is structured as follows:<br>
{"typ":"JWS","alg":"SHA256"}<br>
Payload sample:<br>
{"requestorId":"EXTP056","operatorId":"AS0562","operatorRole":"HOPERAT","timeStamp":1568807570957,"resourceId":"&lt;fiscal-code&gt;"}<br>
Signature must be applied with the same certificate used for TLS, that has a public key for signature.</p>
<p><strong>REFERENCE STANDARDS</strong><br>
To design this solution we tried to apply recommendations of the following documentation/standards:<br>
FHIR Release 4: <a href="http://hl7.org/fhir/" target="_blank" title="http://hl7.org/fhir/">http://hl7.org/fhir/</a><br>
Mobile security considerations: <a href="https://www.ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_Suppl_Appx-Z.pdf" target="_blank" title="https://www.ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_Suppl_Appx-Z.pdf">https://www.ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_Suppl_Appx-Z.pdf</a><br>
Security and Privacy module: <a href="http://hl7.org/fhir/R4/secpriv-module.html" target="_blank" title="http://hl7.org/fhir/R4/secpriv-module.html">http://hl7.org/fhir/R4/secpriv-module.html</a><br>
JWS standard: <a href="https://tools.ietf.org/html/rfc7515" target="_blank" title="https://tools.ietf.org/html/rfc7515">https://tools.ietf.org/html/rfc7515</a></p>
<p><strong>SUMMARY</strong><br>
What’s relevant in this security model is that the token is generated by the invoker of the service, not released by an IDP server, it works more like a SAML Assertion rather than a JWT. This simplifies the security level as we don’t have to manage OAuth and to keep the registry of the operators of external parties. Another advantage is that the token is “refreshed” at every call and carries updated attributes for audit trail.</p>



<a name="181833320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181833320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181833320">(Nov 25 2019 at 15:36)</a>:</h4>
<p>This seems rather similar to the IHE IUA profile of OAuth. In that model there is a well defined JWT set of attributes. <br>
I am a fan of Mutual-Authenticated TLS, but it tends to have issues at the server interface. Especially when the server is using TLS accelerators that strip off the TLS.<br>
<a href="https://healthcaresecprivacy.blogspot.com/2016/11/is-iua-oauth-useful-in-service-to.html" target="_blank" title="https://healthcaresecprivacy.blogspot.com/2016/11/is-iua-oauth-useful-in-service-to.html">https://healthcaresecprivacy.blogspot.com/2016/11/is-iua-oauth-useful-in-service-to.html</a></p>



<a name="181833509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181833509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181833509">(Nov 25 2019 at 15:38)</a>:</h4>
<p>IHE is currently updating the IUA profile due to some evolution of some draft IETF specifications. All are welcome to participate in that effort. I am sure that team would welcome your perspective.  <a href="https://github.com/IHE/IT-Infrastructure/tree/master/IUA.b" target="_blank" title="https://github.com/IHE/IT-Infrastructure/tree/master/IUA.b">https://github.com/IHE/IT-Infrastructure/tree/master/IUA.b</a></p>



<a name="181910182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181910182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivano Tomainu <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181910182">(Nov 26 2019 at 10:58)</a>:</h4>
<p>Thanks for your answer John, I've looked at the mentioned solutions and they are indeed similar to our model. The token attributes mentioned in IUA Profile confirm that we are on the right path. <br>
I was wondering: could the lack of a FHIR Resource to describe the token raise an issue?</p>



<a name="181917786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181917786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181917786">(Nov 26 2019 at 12:52)</a>:</h4>
<p>I have setup that resembles yours <span class="user-mention" data-user-id="197698">@Ivano Tomainu</span> , bridging SAML over OAuth2 with JWTs. What part of the model do you think lacks a FHIR Resource modelling?</p>



<a name="181918371"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181918371" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivano Tomainu <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181918371">(Nov 26 2019 at 13:01)</a>:</h4>
<p>The JSON of the payload inside the token.<br>
Consider that I work in a context similar to SAML Identitiy Federation, I'm in charge to release specification for the use of the service.</p>



<a name="181919255"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181919255" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181919255">(Nov 26 2019 at 13:14)</a>:</h4>
<p>your JWT adheres to the JWT spec, right?</p>



<a name="181919375"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181919375" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181919375">(Nov 26 2019 at 13:15)</a>:</h4>
<p>We've done the following: <a href="https://ehealth-dk.atlassian.net/wiki/spaces/EDTW/pages/291176482/Tokens+roles+and+RBAC+ABAC#TheAccessToken" target="_blank" title="https://ehealth-dk.atlassian.net/wiki/spaces/EDTW/pages/291176482/Tokens+roles+and+RBAC+ABAC#TheAccessToken">https://ehealth-dk.atlassian.net/wiki/spaces/EDTW/pages/291176482/Tokens+roles+and+RBAC+ABAC#TheAccessToken</a></p>



<a name="181920528"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/181920528" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivano Tomainu <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#181920528">(Nov 26 2019 at 13:28)</a>:</h4>
<p>Thanks, very useful.<br>
I agree that's more important to adhere to this specification: <a href="https://www.iana.org/assignments/jwt/jwt.xhtml" target="_blank" title="https://www.iana.org/assignments/jwt/jwt.xhtml">https://www.iana.org/assignments/jwt/jwt.xhtml</a><br>
rather than any other for the JSON Payload.</p>



<a name="182366999"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/182366999" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luis Maas <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#182366999">(Dec 02 2019 at 17:14)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="197698">@Ivano Tomainu</span>,<br>
I would also point you to the UDAP profiles for including this type of information in JWTs, specifically: <a href="http://www.udap.org/udap-client-authorization-grants.html" target="_blank" title="http://www.udap.org/udap-client-authorization-grants.html">UDAP Client Authorization Grants using JSON Web Tokens</a>. This particular profile includes an extensions parameter specifically intended to carry the types of metadata you are describing. <br>
In your specialized situation, the Authorization JWT defined in that profile could be used as a standalone Authorization header payload. <br>
Additionally, since your FHIR server is presumably validating the JWT presented by the client, I would also note that the UDAP profiles are designed to link X.509 certificate frameworks to the trust model. This means that the JWT submitted by the client can also be used for authentication, in which case you may be able to simplify your workflow by removing the TLS client-side authentication altogether since client certificate validation is also part of the UDAP flow.<br>
These profiles have been tested at several <a href="https://confluence.hl7.org/display/FHIR/2019-09+Cross+Organization+Application+Access" target="_blank" title="https://confluence.hl7.org/display/FHIR/2019-09+Cross+Organization+Application+Access">HL7 FHIR connectathons</a>. You can also find additional information about UDAP on the <a href="http://build.fhir.org/security.html#AuthZmethods" target="_blank" title="http://build.fhir.org/security.html#AuthZmethods">FHIR Security page</a> and at <a href="http://www.udap.org" target="_blank" title="http://www.udap.org">http://www.udap.org</a>.</p>



<a name="183346874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179247-Security%20and%20Privacy/topic/Security%20model%20for%20FHIR%20API%20based%20on%20signed%20JSON%20Token/near/183346874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivano Tomainu <a href="https://fhir.github.io/chat-archive/stream/179247-Security-and-Privacy/topic/Security.20model.20for.20FHIR.20API.20based.20on.20signed.20JSON.20Token.html#183346874">(Dec 13 2019 at 10:39)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="195299">@Luis Maas</span> , is very interesting the fact that they talk of a JSON Assertion, it's exactly the concept we're replicating from SAML.<br>
A part from that the server architecture is a bit different, we don't use Oauth Server.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
