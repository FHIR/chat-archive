---
layout: page
title: "FHIR Chat  · Auktorisointi Sandbox2:ssa · finnish PHR"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/index.html">finnish PHR</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html">Auktorisointi Sandbox2:ssa</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153932749"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153932749" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esko Niinimäki <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153932749">(Jan 29 2018 at 11:05)</a>:</h4>
<p>Hei,</p>
<p>En ymärrä, miten sandbox2:n auktorisointi toimii. Saisinko apua?<br>
Rekisteröin uuden käyttäjän osoitteessa <a href="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/registeruser" target="_blank" title="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/registeruser">https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/registeruser</a>. <a href="http://www.kanta.fi/documents/12105/4106842/Authorization+guide+for+the+sandbox+environment/045fd8e5-19ca-41af-9827-ebb130654cd2" target="_blank" title="http://www.kanta.fi/documents/12105/4106842/Authorization+guide+for+the+sandbox+environment/045fd8e5-19ca-41af-9827-ebb130654cd2">Oppaan</a> mukaan auktorisointi tehdään GET pyynnöllä (jonka jälkeen palvelu kysyy sotua ja nimeä),  joten yritin selaimella mennä esimerkin <a href="https://fhirsandbox2.kanta.fi/openid-connect-kela/authorize?response_type=code&amp;client_id=Client123&amp;scope=openid+patient/Observation.read+offline_access&amp;redirect_uri=https://app/after-auth&amp;state=b5de575e-ac1b-4c00-b1f1-844d1b9bdb03" target="_blank" title="https://fhirsandbox2.kanta.fi/openid-connect-kela/authorize?response_type=code&amp;client_id=Client123&amp;scope=openid+patient/Observation.read+offline_access&amp;redirect_uri=https://app/after-auth&amp;state=b5de575e-ac1b-4c00-b1f1-844d1b9bdb03">https://fhirsandbox2.kanta.fi/openid-connect-kela/authorize?response_type=code&amp;client_id=Client123&amp;scope=openid+patient/Observation.read+offline_access&amp;redirect_uri=https://app/after-auth&amp;state=b5de575e-ac1b-4c00-b1f1-844d1b9bdb03</a> mukaiseen osoitteeseen, missä Client123 on korvattu saamallani client id:llä, redirect_uri omalla urlilla ja state-parametria hieman muutettu. Selaimen mukaan kuitenkin "Suojatun yhteyden muodostaminen epäonnistui".  Rekisteröimäni clientin scope sisältää mm. openid:n patient/Observation.read:n ja offline_access:n.</p>



<a name="153932786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153932786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153932786">(Jan 29 2018 at 13:44)</a>:</h4>
<p>Oppaassa on vanha osoite, oikea osoite on sandboxin sivulla: "Authorization service in sandbox is located at <a href="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/" target="_blank" title="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/">https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/</a>" eli palvelimen osoite on oikea, mutta sovelluksen nimi on muuttunut,  (<a href="http://www.kanta.fi/en/web/ammattilaisille/tarkeaa-tietoa-kehittajille" target="_blank" title="http://www.kanta.fi/en/web/ammattilaisille/tarkeaa-tietoa-kehittajille">http://www.kanta.fi/en/web/ammattilaisille/tarkeaa-tietoa-kehittajille</a>).</p>



<a name="153934114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153934114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esko Niinimäki <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153934114">(Jan 31 2018 at 12:10)</a>:</h4>
<p>Kiitos Eeva! Oikealla urlillahan tuo toimi. Nyt minulla on kuitenkin ongelma tokenin saamisessa auktorisoinnin jälkeen. Palvelin palauttaa:<br>
&lt;Response [401]&gt;</p>
<p>headers:<br>
{'Access-Control-Allow-Origin': '*',<br>
 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate, no-store',<br>
 'Content-Language': 'en-US',<br>
 'Content-Type': 'application/json;charset=UTF-8',<br>
 'Date': 'Wed, 31 Jan 2018 11:48:37 GMT',<br>
 'Expires': '0',<br>
 'Pragma': 'no-cache, no-cache',<br>
 'Set-Cookie': 'BIGipServerfhirsandbox2-auth.kanta.fi_pool=521553162.30755.0000; '<br>
               'path=/; Httponly; Secure',<br>
 'Strict-Transport-Security': 'max-age=31536000 ; includeSubDomains',<br>
 'Transfer-Encoding': 'chunked',<br>
 'WWW-Authenticate': 'Bearer realm="openidconnect", error="unauthorized", '<br>
                     'error_description="Full authentication is required"',<br>
 'X-Content-Type-Options': 'nosniff',<br>
 'X-FRAME-OPTIONS': 'DENY',<br>
 'X-Powered-By': 'Servlet/3.0',<br>
 'X-XSS-Protection': '1; mode=block'}</p>
<p>text:<br>
{"error":"unauthorized","error_description":"Full authentication is required"}</p>
<p>Olen asettanut post-pyyntöön<br>
urliksi <a href="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/token" target="_blank" title="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/token">https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/token</a><br>
headeriksi 'Accept': 'application/json'<br>
HTTP Basic Authenticationiksi clientid:ClientSecret,  ja*<br>
dataksi<br>
        {'grant_type':'authorization_code”',<br>
    'code':'auktorisointipalvelim antama koodi,<br>
    'redirect_uri':'clientin url'}<br>
*Opas oli hieman epäselvä, yritin myös muotoa "Authorizarion clientid:ClientSecret"</p>
<p>Pystyttekö tuon perusteella kertomaan, mikä voisi olla vikana? Kuinka kauan auktorisointipalvelimen antama koodi on muuten voimassa? Kokeilin myös uudestaan auktorisointia ja sain uuden koodin, vanhensiko se aiemman?</p>



<a name="153934474"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153934474" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153934474">(Feb 01 2018 at 08:20)</a>:</h4>
<p>Koodi tosiaan vanhenee aika nopeasti (riippuu clientin asetuksista, mutta olikohan oletus suunnilleen 30 sekuntia) ja uuden koodin pyyntö vanhentaa edellisen.</p>



<a name="153935249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153935249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esko Niinimäki <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153935249">(Feb 05 2018 at 09:57)</a>:</h4>
<p>Jos tarkoitat Default Max Agea Clientin asetuksissa, on se oletuksena 60000, joten olisiko se sitten millisekunneissa ja tarkoittaa 60 sekuntia?</p>
<p>Joka tapauksessa, käsipelin tuota yritin, joten 30 sekuntia kyllä silloin ylittyi. En sitä kuitenkaan vieläkään saa toimiaan, vaan serveri lähettää edelleen saman virheilmoituksen.</p>



<a name="153935773"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153935773" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153935773">(Feb 07 2018 at 15:02)</a>:</h4>
<p>Tuon Authorization-headerin pitäisi mennä muodossa:<br>
Authorization: Basic Y2xpZW50OnNlY3JldA==</p>
<p>Eli siinä on client:secret  B64 enkoodattuna. Datana olevat parametrit kannattaa lähettää querystring-muodossa, sen pitäisi toimia.</p>



<a name="153937328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153937328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esko Niinimäki <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153937328">(Feb 14 2018 at 10:58)</a>:</h4>
<p>Lähettämäni pyyntö on nyt muodossa:</p>
<p>{<br>
  "args": {}, <br>
  "data": "code=0PinZc&amp;redirect_uri=https%3A%2F%2Fwww.jyu.fi%2Ffi&amp;grant_type=authorization_code", <br>
  "files": {}, <br>
  "form": {}, <br>
  "headers": {<br>
    "Accept": "application/json", <br>
    "Accept-Encoding": "gzip, deflate", <br>
    "Authorization": "Basic NWQ4YjY5YjctYmM3Ni00NjM4LTgzMDctNDcwMGMyZmUzNDFmOkVKc...[katkaistu tähän viestiin]", <br>
    "Connection": "close", <br>
    "Content-Length": "84", <br>
    "Host": "<a href="http://httpbin.org" target="_blank" title="http://httpbin.org">httpbin.org</a>", <br>
    "User-Agent": "python-requests/2.9.1"<br>
  }, <br>
  "json": null<br>
}<br>
Sandbox2 palauttaa kuitenkin edelleen saman virheilmoituksen (mm. datan vaihto formista ei vaikuttanut). Tietysti jos tuo code vanheneekin alle kymmenessä sekunnissa, niin tapani on liian hidas.</p>
<p>"args": {}, <br>
  "data": "", <br>
  "files": {}, <br>
  "form": {<br>
    "code": "2nTPU9", <br>
    "grant_type": "authorization_code", <br>
    "redirect_uri": "<a href="https://www.jyu.fi/fi" target="_blank" title="https://www.jyu.fi/fi">https://www.jyu.fi/fi</a>"<br>
  }</p>
<p>Varmuuden vuoksi kertauksena siis palvelimen vastaus:<br>
<a href="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/token" target="_blank" title="https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/token">https://fhirsandbox2-auth.kanta.fi/phr-authserver-sandbox/token</a><br>
&lt;Response [401]&gt;</p>
<p>{'Access-Control-Allow-Origin': '*',<br>
 'Cache-Control': 'no-cache, no-store, max-age=0, must-revalidate, no-store',<br>
 'Content-Language': 'en-US',<br>
 'Content-Type': 'application/json;charset=UTF-8',<br>
 'Date': 'Wed, 14 Feb 2018 10:08:33 GMT',<br>
 'Expires': '0',<br>
 'Pragma': 'no-cache, no-cache',<br>
 'Set-Cookie': 'BIGipServerfhirsandbox2-auth.kanta.fi_pool=538330378.30755.0000; '<br>
               'path=/; Httponly; Secure',<br>
 'Strict-Transport-Security': 'max-age=31536000 ; includeSubDomains',<br>
 'Transfer-Encoding': 'chunked',<br>
 'WWW-Authenticate': 'Bearer realm="openidconnect", error="unauthorized", '<br>
                     'error_description="Full authentication is required"',<br>
 'X-Content-Type-Options': 'nosniff',<br>
 'X-FRAME-OPTIONS': 'DENY',<br>
 'X-Powered-By': 'Servlet/3.0',<br>
 'X-XSS-Protection': '1; mode=block'}</p>
<p>{"error":"unauthorized","error_description":"Full authentication is required"}</p>



<a name="153937729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153937729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matti Uusitalo <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153937729">(Feb 15 2018 at 13:39)</a>:</h4>
<blockquote>
<p>Lähettämäni pyyntö on nyt muodossa:</p>
<p>{<br>
  "args": {}, <br>
  "data": "code=0PinZc&amp;redirect_uri=https%3A%2F%2Fwww.jyu.fi%2Ffi&amp;grant_type=authorization_code", <br>
  "files": {}, <br>
  "form": {}, <br>
  "headers": {<br>
    "Accept": "application/json", <br>
    "Accept-Encoding": "gzip, deflate", <br>
    "Authorization": "Basic NWQ4YjY5YjctYmM3Ni00NjM4LTgzMDctNDcwMGMyZmUzNDFmOkVKc...[katkaistu tähän viestiin]", <br>
    "Connection": "close", <br>
    "Content-Length": "84", <br>
    "Host": "<a href="http://httpbin.org" target="_blank" title="http://httpbin.org">httpbin.org</a>", <br>
    "User-Agent": "python-requests/2.9.1"<br>
  }, <br>
  "json": null<br>
}</p>
</blockquote>
<p>Voisitko kokeilla lisätä pyyntöön vielä client_id parametrin? Auktorisointioppaan mukaan se on pakollinen jos ei ole annettu client_assertion parametria.</p>



<a name="153937840"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179222-finnish%20PHR/topic/Auktorisointi%20Sandbox2%3Assa/near/153937840" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Esko Niinimäki <a href="https://fhir.github.io/chat-archive/stream/179222-finnish-PHR/topic/Auktorisointi.20Sandbox2.3Assa.html#153937840">(Feb 15 2018 at 17:31)</a>:</h4>
<p>Tarkoitatko siis näin:<br>
{<br>
  "args": {}, <br>
  "data": "client_id=5d8b69b7-bc76-4638-8307-4700c2fe341f&amp;redirect_uri=https%3A%2F%2Fwww.jyu.fi%2Ffi&amp;grant_type=authorization_code&amp;code=nej8YX", <br>
  "files": {}, <br>
  "form": {}, <br>
  "headers": {<br>
    "Accept": "application/json", <br>
    "Accept-Encoding": "gzip, deflate", <br>
    "Authorization": "Basic NWQ4YjY5YjctYmM3Ni00NjM4LTgzMDctNDcwMGMyZmUzNDFmOkVKcWU3cmVZY2xIRXF6SllwWHR3TExPQV9oU0VCZEFCcFdGSUdXbWdCNFQtVWM3b1ZKZEswcXh4TXdmSEJvdnRSejFKczM0QmgwaVNPQTFlbV81VmRn", <br>
    "Connection": "close", <br>
    "Content-Length": "131", <br>
    "Host": "<a href="http://httpbin.org" target="_blank" title="http://httpbin.org">httpbin.org</a>", <br>
    "User-Agent": "python-requests/2.9.1"<br>
  }, <br>
  "json": null<br>
}</p>
<p>Yllä oleva ei toimi myöskään, vaan serveri palauttaa saman 401-vastauksen. Kanta-sivulta <a href="http://www.kanta.fi/en/web/ammattilaisille/tarkeaa-tietoa-kehittajille" target="_blank" title="http://www.kanta.fi/en/web/ammattilaisille/tarkeaa-tietoa-kehittajille">http://www.kanta.fi/en/web/ammattilaisille/tarkeaa-tietoa-kehittajille</a> löytyvä <a href="http://www.kanta.fi/documents/12105/4106842/Authorization+guide+for+the+sandbox+environment/045fd8e5-19ca-41af-9827-ebb130654cd2" target="_blank" title="http://www.kanta.fi/documents/12105/4106842/Authorization+guide+for+the+sandbox+environment/045fd8e5-19ca-41af-9827-ebb130654cd2">auktorisointiopas</a> ei mainitse client_id-, eikä client_assertion-parametrejä.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
