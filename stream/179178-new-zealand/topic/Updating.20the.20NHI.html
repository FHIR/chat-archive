---
layout: page
title: "FHIR Chat  · Updating the NHI · new zealand"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/index.html">new zealand</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html">Updating the NHI</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="169909955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/169909955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#169909955">(Jul 08 2019 at 22:31)</a>:</h4>
<p>Current thoughts on <a href="https://fhirblog.com/2019/07/09/thoughts-about-updating-registries/" target="_blank" title="https://fhirblog.com/2019/07/09/thoughts-about-updating-registries/">updating the NHI</a> (and, likely the HPI also)</p>
<p>feedback welcomed!</p>



<a name="170411793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/170411793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#170411793">(Jul 08 2019 at 23:49)</a>:</h4>
<p>Given that the underlying DB Schema of the NHI Patient Repository is a fairly simple one, I'd question the need to create custom operations to perform basic CRUD tasks. Using 'vanilla' RESTful commands would certainly create an API that's simpler than the existing SOAP interface to the NHI. I'm concerned that what's being proposed in David's Blog Post would make it more complex.</p>



<a name="170415498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/170415498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#170415498">(Jul 09 2019 at 01:09)</a>:</h4>
<p>Well, it's certainly a different style as I pointed out in the post - but the  update documents are quite straightforward to build, and get around the issue of having to submit (and the server process) an entire resource when you only want to change part of it. (And there were the issues with patch that I mentioned). But - would be good to get the perspective of the implementer community - which is why I wrote the post in the first place...</p>



<a name="170434242"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/170434242" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#170434242">(Jul 09 2019 at 08:39)</a>:</h4>
<p>Given how custom it is, not sure on the benefit of using fhir for updates there. It's custom anyway.</p>



<a name="170435177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/170435177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#170435177">(Jul 09 2019 at 08:53)</a>:</h4>
<p>You don't agree with using FHIR operations for this? Part of the issue is that not all of the elements in the resource can be updated by all users (like the general practitioner for example). Using standard rest for, say, an address update would mean that the client would need to read the current resource, update the address, PUT the resource to the server which would need to strip out the elements that can't be updated by the user and update the ones that can be. </p>
<p>Clearly defined operations seemed the simpler (and clearer) approach...</p>



<a name="170496160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/170496160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#170496160">(Jul 09 2019 at 22:34)</a>:</h4>
<p>Because the NHI Repository is a 'single source of truth' for NZ patient demographic data, with (eventually) inputs from all healthcare facilities, there are many complex server-side rules around updates. My inclination would be to leave this complexity where it belongs - on the central server - and allow the client to make PUT requests containing complete patient resources to the Server for potential updates.</p>



<a name="170497342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/170497342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#170497342">(Jul 09 2019 at 22:57)</a>:</h4>
<p>Will be good to get the input of the development team about just how complex this logic will be. In principle that's the simplest approach (and the one most commonly used generally) but the existing system is service (operations) based - and I wonder how complex this logic will be to implement - especially for some of the edge cases and repeating fields. For every update operation the server will need to compare what is in the submitted resource with the all data in the back end systems (not FHIR of course) to determine what has changed. Next, it must determine whether the changed field/s's can be updated at all and whether the current user has the rights to make that change. Finally the change can be applied, and the user notified. </p>
<p>All do-able of course, but what will it take to do so, and what's the performance impact? Having specific operations reduces that complexity (as the nature of the update is specified) and I do wonder just how much more complex it is to the client. They already know what the change is they wish to make, so the resource PUT approach means updating the resource and submitting it, and the operations approach means specifying the change and submitting that.</p>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> - how are other jurisdictions managing FHIR updates to registry data?</p>



<a name="170497884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/170497884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#170497884">(Jul 09 2019 at 23:06)</a>:</h4>
<p>They are done out of band as a request, then processed in.<br>
We do this in our EPD product, just a simple update for the client, and all the hard work done on our end.<br>
The Submitter just sends what they know complete and is curated into the central record.<br>
And many of them don't use fhir to update either.<br>
What you have there is making the job easier for their dev, but more work for everyone else. They can't just send what they have, and let the registry worry about merging all the data together.</p>



<a name="170656459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/170656459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#170656459">(Jul 11 2019 at 17:57)</a>:</h4>
<p>So any other comments (particularly from implementers)?. To summarise, we're looking at 2 'styles' of update:</p>
<ul>
<li>One where there are specific update operations (address, ethnicity, name) etc that the client calls as required.</li>
<li>The other where an updated resource is submitted and the server figures out what changes were made</li>
</ul>
<p>In both cases validation, security and access control is applied, so the update may not proceed (an OperationOutcome with the issues will be returned)</p>



<a name="173054979"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/173054979" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#173054979">(Aug 12 2019 at 20:01)</a>:</h4>
<p>Taking a closer look at PATCH: <a href="https://fhirblog.com/2019/08/13/updating-a-resource-using-patch/" target="_blank" title="https://fhirblog.com/2019/08/13/updating-a-resource-using-patch/">https://fhirblog.com/2019/08/13/updating-a-resource-using-patch/</a> . (Actually, Grahame suggested this right back at the beginning - just getting round to taking a closer look now. Silly me...)</p>



<a name="173058674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/173058674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#173058674">(Aug 12 2019 at 20:43)</a>:</h4>
<p>That looks like a much better solution than custom operations!</p>



<a name="173064990"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/173064990" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#173064990">(Aug 12 2019 at 21:54)</a>:</h4>
<p>Yeah - I kinda kick myself for not taking a closer look earlier...</p>



<a name="173065530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/173065530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#173065530">(Aug 12 2019 at 22:02)</a>:</h4>
<p>Interesting in your address example you insert the collection first otherwise it would fail /as you noted)<br>
However this wouldn't be a problem as you need to know the state of the resource before to know that you're not creating a dup address.<br>
Great write up though.</p>



<a name="173065740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/173065740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#173065740">(Aug 12 2019 at 22:05)</a>:</h4>
<p>exactly. (and thanks!) - a better solution than custom operations do you think?</p>



<a name="179477535"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/179477535" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Moorhouse <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#179477535">(Oct 30 2019 at 21:08)</a>:</h4>
<p>Hi David, Thanks for your thoughts on this. I think that the PATCH verb is easier to support than custom operations. The only reservation is around the manipulation of collections such as addresses - I can see scenarios where a client app is submitting  a "stale" PATCH i.e. where the data has been updated by a third party in the time between the client reading it, the user making the change, and the client resubmitting.<br>
Would atomic operations on collections be a better alternative  - such as requiring ALL addresses to be submitted.</p>



<a name="179497017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179178-new%20zealand/topic/Updating%20the%20NHI/near/179497017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179178-new-zealand/topic/Updating.20the.20NHI.html#179497017">(Oct 31 2019 at 02:42)</a>:</h4>
<p>Thanks for that David. Are you concerned about, say, 2 users trying to remove the same address at different times? I did make the comment below - would that help to resolve this? I am assuming / requiring a read / update using optimistic locking to avoid collisions...</p>
<blockquote>
<p>So for adjusting the array, you need to know the position of the element in the array to remove. This shouldn’t be a problem as the client will have just loaded the patient, and optimistic locking ensures that no-one else has changed it in the interim.</p>
</blockquote>
<p>cheers...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
