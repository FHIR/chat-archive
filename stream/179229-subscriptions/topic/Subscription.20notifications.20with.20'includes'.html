---
layout: page
title: "FHIR Chat  · Subscription notifications with &#x27;includes&#x27; · subscriptions"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/index.html">subscriptions</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html">Subscription notifications with &#x27;includes&#x27;</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="209790669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209790669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209790669">(Sep 11 2020 at 14:53)</a>:</h4>
<p>We're looking at using subscriptions for Da Vinci CDex, where the subscription would be to monitor the Task that had solicited a set of information.  We'd want a subscription notification to fire when the Task was updated, whether to link to a status or to point to the requested data.  I created some examples based on the subscription R4 IG.  One thing I wasn't super sure about was how to handle 'included' data in the notification.  Specifically, if the subscription notification includes data, we'd want not just the Task that had been updated (which would have a Bundle.entry.request.method of PUT), we'd also want the record(s) that the Task pointed to with Task.output (e.g. DocumentReference, Observation, whatever).  At the moment, I'm using a Bundle.entry.request.method of 'GET' for this.  See <a href="https://build.fhir.org/ig/HL7/davinci-ehrx/Bundle-subscription-notification-with-document.json.html">https://build.fhir.org/ig/HL7/davinci-ehrx/Bundle-subscription-notification-with-document.json.html</a> for an example.  My questions:<br>
a) Is it legal to pass back both the 'focus' of the subscription as well as certain related resources?<br>
b) If it is legal, how does the SubscriptionTopic define what comes back?  (And is it configurable at the time you subscribe?)<br>
c) Is GET the appropriate method to list for a resource that's just 'included' but wasn't (necessarily) modified as part of the event that triggered the notification?<br>
(<span class="user-mention" data-user-id="340121">@Matthew Chambers</span> FYI)</p>



<a name="209792729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209792729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209792729">(Sep 11 2020 at 15:09)</a>:</h4>
<p>I don't think we prohibit returning additional bundle entries beyond the "event triggers" responsible for the notification, but...</p>
<p>1) We don't specify how to ask for them / how to describe the inclusions, graph links, elements, etc that you want. Our plan has been to leave this out of scope for R5 (but you could handle it with an extension on the SubscriptionTopic)<br>
2) We don't have a way to differentiate Bundle entries that count as "events" from Bundle entries that are "extra," so you'd want to be sure to differentiate these. Our plan has been <a href="http://build.fhir.org/subscription.html#payload-entries">to define something similar</a> ("<em>TODO: Each entry must be annotated to indicate whether it was gather before or after the event which caused the notification....</em>") so perhaps this could be generalized to tag things as extra.</p>



<a name="209798518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209798518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209798518">(Sep 11 2020 at 15:51)</a>:</h4>
<p>Is there any intention to standardize a mechanism for such tagging in the R4 backport, or are we skipping it for now on the grounds that the specific mechanism hasn't yet been landed for R5?</p>



<a name="209799553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209799553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209799553">(Sep 11 2020 at 15:59)</a>:</h4>
<p>TBD as far as I'm concerned. But in principle the point of the back-port is to take stuff we think is sorted out for R5, and shoehorn it into R4. Given that we think there's <em>some</em> TODO left for R5, I think it'd be fair game for the backport.</p>



<a name="209800112"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209800112" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209800112">(Sep 11 2020 at 16:03)</a>:</h4>
<p>My logical preference is that any changes happen in R5 first and then are reflected in the backport.</p>
<p>That said... <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span> if it's something we feel needs to be defined (so far there has been resistance to defining it), I'd probably be putting the changes in both at the same time for testing.</p>



<a name="209801118"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209801118" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209801118">(Sep 11 2020 at 16:10)</a>:</h4>
<p>Gino and I talked about using a GraphDefinition for this but people are obviously shy of all the complexity for all sorts of good reasons. but the complexity is real</p>



<a name="209801527"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209801527" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209801527">(Sep 11 2020 at 16:13)</a>:</h4>
<p>Yep - IIRC my thoughts were to add to the <a href="http://build.fhir.org/valueset-subscription-payload-content.html">SubscriptionPayloadContent</a> set to signify additional modes.. potentially GraphDefinition, GraphQL, etc..</p>



<a name="209801650"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209801650" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209801650">(Sep 11 2020 at 16:14)</a>:</h4>
<p>Though we also tossed around another field/extension so you can do fun things like GraphDefinition id-only vs full resource</p>



<a name="209803408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209803408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209803408">(Sep 11 2020 at 16:28)</a>:</h4>
<p>For reference, there was also discussion (and I don't recall a resolution) whether those definitions would live in the Subscription or SubscriptionTopic.  <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> , this would be for part <code>b</code> of your question - what does your use case need?  I can see:</p>
<ul>
<li>topic includes a single definition</li>
<li>topic includes a set of definitions to choose from in the subscription</li>
<li>subscription allows arbitrary definitions<br>
as all being viable to define.  Haven't played with it to figure out implementation differences, but what would you be asking for (all else being equal)?</li>
</ul>



<a name="209805188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209805188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209805188">(Sep 11 2020 at 16:43)</a>:</h4>
<p>We're just starting to explore, so not completely sure what we need.  My guess is that ideally we'd have two configurable options - Task only or Task + a defined set of data.  I'm pretty sure we'd be satisfied with a hand-wavy textual description of what the includes were - no one on EHR or payer side would implement GraphDefinition to figure out the data inclusion programmatically.  The specific topic would get hard-coded - at least for the near-term.  Whether Task-only and Task+outputs were one topic with separate definitions selectable at time of subscription or whether they were separate topics, I'm not sure much matters.  I suspect the latter would be less complex, but it makes for a longer list of possible topics.  Given that in my use-case, we're not browsing a topic registry, that doesn't much matter.</p>



<a name="209805996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209805996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209805996">(Sep 11 2020 at 16:50)</a>:</h4>
<p>Fair enough.  Since I'm not familiar with Task usage, would something like include chaining work?</p>



<a name="209806085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209806085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209806085">(Sep 11 2020 at 16:51)</a>:</h4>
<p>Yes, the intention is that it would be based on _include.  (At the moment the needed search criteria to chain on Task.output isn't defined in core, so the IG would need to define one for R4, but that's easy enough.  Change request is in for R5.)</p>



<a name="209806629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209806629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209806629">(Sep 11 2020 at 16:56)</a>:</h4>
<p><code>Bundle.entry.search.mode</code> comes pretty close to differentiating triggering from included resources, but of course it's only allowed on search type bundles today.</p>



<a name="209807125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179229-subscriptions/topic/Subscription%20notifications%20with%20%27includes%27/near/209807125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179229-subscriptions/topic/Subscription.20notifications.20with.20&#x27;includes&#x27;.html#209807125">(Sep 11 2020 at 17:00)</a>:</h4>
<p>Y.  In R5, given that we're defining a new Bundle type, I think allowing mode to be included there is appropriate.  Even the 'outcome' code could theoretically be relevant.  And the semantics of the push are similar to search.  Only thing is that search.score doesn't seem to be terribly relevant - could put a constraint only allowing that for Bundle type of search.  In R4, we could put an extension on Bundle.entry to convey the search.mode (given that the existing invariant would prohibit it for history.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
