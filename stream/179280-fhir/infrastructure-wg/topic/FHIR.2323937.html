---
layout: page
title: "FHIR Chat  · FHIR#23937 · fhir/infrastructure-wg"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/index.html">fhir/infrastructure-wg</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html">FHIR#23937</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="178689211"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/178689211" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#178689211">(Oct 21 2019 at 19:30)</a>:</h4>
<p>Tracker <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=23937" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=23937">GF#23937</a> suggests the dateOp parameters need to be documented. The operation is expected to transform from the string representation of a date/time to a date/time-value. Discussion on FHIR-I today raised the question of whether there are some existing patterns we could use to inform this. Specifically, FHIRPath documents date/time formatting patterns that it uses for the toDateTime, toDate, toTime, and toString functions: <a href="http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#conventions" target="_blank" title="http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#conventions">http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#conventions</a></p>



<a name="178689342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/178689342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#178689342">(Oct 21 2019 at 19:32)</a>:</h4>
<p><span class="user-mention" data-user-id="193430">@Alexander Zautke</span></p>



<a name="179222670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/179222670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#179222670">(Oct 28 2019 at 11:32)</a>:</h4>
<p>I don't mind using FHIRPath in this case.  It would look like the following, right? <code>src.element as dateSrc -&gt; tgt.dateTgt = evaluate(dateSrc, "'2019-10-28'.toDate()")</code>. We could make it shorter by using the shorthand syntax for evaluate here: <code>src.element -&gt; tgt.dateTgt = ("'2019-10-28'.toDate()")</code></p>



<a name="179227008"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/179227008" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#179227008">(Oct 28 2019 at 12:47)</a>:</h4>
<p>Related question: The description of the evaluate function in the mapping language says that 'it must start with a reference to one of the defined variables' if the shorthand syntax is used. Does this sentence imply that you can't begin the statement with a constant as in the example above?</p>



<a name="179467087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/179467087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#179467087">(Oct 30 2019 at 19:15)</a>:</h4>
<p>Any advice <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> ?</p>



<a name="183588337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183588337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183588337">(Dec 16 2019 at 20:41)</a>:</h4>
<p>Plan (from FMG call) is to use this thread to make a list of the various things we may want to do with date.  Then we can evaluate which of those we can do with FHIRPath vs. mapping language vs. what might want changes to one or the other or both.</p>



<a name="183588953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183588953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183588953">(Dec 16 2019 at 20:48)</a>:</h4>
<p>known requirements for dates+times in the mapping language:</p>
<ul>
<li>initialise a target element with a fixed date or with [now]</li>
<li>specify an alternative string format for either source or target</li>
<li>allow conflating separate date/time elements, or splitting to separate date/time fields</li>
<li>switch between local and UTC (in either direction)</li>
<li>convert a date/time + duration to a new date time, or calculate a duration between two dates (v3 IVL)</li>
<li>specify a running century window for dates with YY not YYYY ?</li>
</ul>



<a name="183589480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183589480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183589480">(Dec 16 2019 at 20:54)</a>:</h4>
<p>CQL defines <a href="https://cql.hl7.org/09-b-cqlreference.html#duration" target="_blank" title="https://cql.hl7.org/09-b-cqlreference.html#duration">duration</a> and <a href="https://cql.hl7.org/09-b-cqlreference.html#difference" target="_blank" title="https://cql.hl7.org/09-b-cqlreference.html#difference">difference</a> to support date/time duration calculations at a given precision.</p>



<a name="183589644"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183589644" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183589644">(Dec 16 2019 at 20:56)</a>:</h4>
<p>do you want to bring other requirements suggested by the CQL semantics?</p>



<a name="183592637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183592637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183592637">(Dec 16 2019 at 21:27)</a>:</h4>
<p>Yes, CQL also defines <a href="https://cql.hl7.org/09-b-cqlreference.html#datetime-component-from" target="_blank" title="https://cql.hl7.org/09-b-cqlreference.html#datetime-component-from">date/time component extraction</a></p>



<a name="183592729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183592729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183592729">(Dec 16 2019 at 21:28)</a>:</h4>
<p><a href="https://cql.hl7.org/09-b-cqlreference.html#date-1" target="_blank" title="https://cql.hl7.org/09-b-cqlreference.html#date-1">Date</a>, <a href="https://cql.hl7.org/09-b-cqlreference.html#time-1" target="_blank" title="https://cql.hl7.org/09-b-cqlreference.html#time-1">Time</a>, and <a href="https://cql.hl7.org/09-b-cqlreference.html#datetime-1" target="_blank" title="https://cql.hl7.org/09-b-cqlreference.html#datetime-1">DateTime</a> selectors</p>



<a name="183592933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183592933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183592933">(Dec 16 2019 at 21:31)</a>:</h4>
<p>And precision-based comparison of date/time values (e.g. comparing two date/time values to the day, even though they may be specified further)</p>



<a name="183592973"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183592973" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183592973">(Dec 16 2019 at 21:31)</a>:</h4>
<p>and these things are relevant to the transformation problem?</p>



<a name="183593365"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183593365" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183593365">(Dec 16 2019 at 21:35)</a>:</h4>
<p>date/time component extraction is "splitting to separate date/time fields" above</p>



<a name="183593439"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183593439" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183593439">(Dec 16 2019 at 21:36)</a>:</h4>
<p>Date, Time, and DateTime selectors is "initialise a target element with a fixed date"</p>



<a name="183593462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183593462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183593462">(Dec 16 2019 at 21:36)</a>:</h4>
<p>I'm not sure what's meant by "allow conflating separate date/time elements"</p>



<a name="183593588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183593588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183593588">(Dec 16 2019 at 21:37)</a>:</h4>
<p>Precision-based comparison, I'm not sure, we've found it to be indispensable in quality improvement, so I imagine it would be applicable.</p>



<a name="183593679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183593679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183593679">(Dec 16 2019 at 21:38)</a>:</h4>
<p>source has 2 elements, date and time. Target has one, which is a dateTime (or vice versa)</p>



<a name="183593930"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/183593930" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#183593930">(Dec 16 2019 at 21:41)</a>:</h4>
<p>Ah, gotcha</p>



<a name="189488727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/189488727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#189488727">(Mar 02 2020 at 13:05)</a>:</h4>
<p>While working on ccda mappings we (Firely) needed an implementation of the dateOp function. We implemented three overloads:</p>
<ol>
<li>
<p>dateOp(string input, string datetimeType) <br>
with 'input' in a valid partial datetime format; where datetimeType is either 'Date' or 'DateTime', turning input into a FHIR Date or FHIR DateTime</p>
</li>
<li>
<p>dateOp(string input, string inputFormat, string datetimeType)<br>
as above, but inputFormat allows you to specify the format of the input so it can be parsed into as FHIR Date / DateTime. So the input need not be a valid partial datetime.</p>
</li>
<li>
<p>dateOp(string input, string inputFormat, string outputFormat, string type)<br>
allows you to specify the format in which to write the output and 'type' is the datatype you want returned (could als be a custom datatype, defined by a Logical Model).</p>
</li>
</ol>
<p>For input/outputformats we used the formats that .NET recognizes (<a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/custom-date-and-time-format-strings" target="_blank" title="https://docs.microsoft.com/en-us/dotnet/standard/base-types/custom-date-and-time-format-strings">https://docs.microsoft.com/en-us/dotnet/standard/base-types/custom-date-and-time-format-strings</a>). That is a superset of the informal format strings suggested in FHIRPath.</p>



<a name="269083332"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/269083332" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#269083332">(Jan 24 2022 at 10:12)</a>:</h4>
<p>FHIR-I is trying to move towards a resolution of this issue.<br>
Taking the requirements into from <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> into account, we could have the following solutions:</p>
<ul>
<li>
<p>initialise a target element with a fixed date or with [now]. This can be solved with FHIRPath. <code>src -&gt; tgt.element = ("now()")</code></p>
</li>
<li>
<p>specify an alternative string format for either source or target: Any ideas on how to come to an agreement which format strings to use here? Do we think this should be solved in FHIRPath?</p>
</li>
<li>
<p>allow conflating separate date/time elements, or splitting to separate date/time fields. With the addition of string manipulation in FHIRPath, this seems to be solved as well. See <a href="http://jira.hl7.org/browse/FHIR-27757">FHIR#27757</a>.</p>
</li>
<li>
<p>switch between local and UTC (in either direction). Should be part of the format strings.</p>
</li>
<li>
<p>convert a date/time + duration to a new date time, or calculate a duration between two dates. Can this be done with date math logic in FHIRPath?</p>
</li>
<li>
<p>specify a running century window for dates with YY not YYYY ?. Format string issue as above.</p>
</li>
</ul>



<a name="269083583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/269083583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#269083583">(Jan 24 2022 at 10:15)</a>:</h4>
<p>My proposal would be that we add the the overloads as outlined by <span class="user-mention" data-user-id="191757">@Christiaan Knaap</span> above. Should we leave the format strings up to the implementation?</p>



<a name="269186481"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/FHIR%2323937/near/269186481" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/FHIR.2323937.html#269186481">(Jan 24 2022 at 23:14)</a>:</h4>
<p>Local/UTC conversions - that sounds like fun and danger...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
