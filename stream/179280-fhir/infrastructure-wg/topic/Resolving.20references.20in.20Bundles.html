---
layout: page
title: "FHIR Chat  · Resolving references in Bundles · fhir/infrastructure-wg"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/index.html">fhir/infrastructure-wg</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html">Resolving references in Bundles</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="226617507"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226617507" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226617507">(Feb 17 2021 at 06:09)</a>:</h4>
<p>I've finally completed writing up what I <em>think</em> is the appropriate algorithm for references inside Bundles - in a comment at the end of <a href="http://jira.hl7.org/browse/FHIR-29271">FHIR#29271</a>.  Please review and provide feedback.</p>



<a name="226685075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226685075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226685075">(Feb 17 2021 at 16:36)</a>:</h4>
<p>is the draft under review your most recent edited comment?</p>



<a name="226723101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226723101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226723101">(Feb 17 2021 at 20:49)</a>:</h4>
<p>Yes</p>



<a name="226730236"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226730236" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226730236">(Feb 17 2021 at 21:41)</a>:</h4>
<p>The writeup includes language like "the server MAY look " -- I think "server" refers to "entity processing the Bundle"?</p>



<a name="226730407"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226730407" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226730407">(Feb 17 2021 at 21:42)</a>:</h4>
<p>The branch including "Look for an entry with a fullUrl that matches the versionless reference and a resource.meta.versionId that matches the reference's version id." seems to end without covering all cases.</p>



<a name="226730500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226730500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226730500">(Feb 17 2021 at 21:43)</a>:</h4>
<p>The language about "f (sic) there are entries in the Bundle with no fullUrl entries, the system MAY choose to parse the absolute reference to extract the 'id' and check for a match on the presumption that the base URL for the missing fullUrl would be the same as the absolute URL in the reference"... this feels kind of open-ended. Is it strictly necessary?</p>



<a name="226730781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226730781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226730781">(Feb 17 2021 at 21:45)</a>:</h4>
<blockquote>
<p>Resolving relative references against a UUID base. <br>
This feels like unnecessary complexity to me, and seems to introduce new requirements.</p>
</blockquote>



<a name="226731334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226731334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226731334">(Feb 17 2021 at 21:50)</a>:</h4>
<p>Overall -- WOW, this is a complex process! I worry about implementability / consistency of implementations.</p>



<a name="226732984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226732984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226732984">(Feb 17 2021 at 22:01)</a>:</h4>
<p>I was going to comment on jira but this might be easier to discuss here. This proposal confuses me even more than the existing text - some of these sections have multiple layers of "MAY" and parenthetical statements. The tree of conditional possibilities is even deeper than before. Resolving relative references against a UUID base seems to be an entirely new idea and I don't see a use case for it.</p>



<a name="226733103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226733103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226733103">(Feb 17 2021 at 22:01)</a>:</h4>
<p>I see two basic use cases for references in bundles:</p>



<a name="226733293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226733293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226733293">(Feb 17 2021 at 22:02)</a>:</h4>
<ol>
<li>The most common case that I see in my world, and what I recommend for applications constructing bundles for operational purposes, is that a reference to Patient/123 simply means Patient/123 on the server the bundle is being sent to, and if you want internal bundle references put a urn:uuid in the target resource's fullUrl and use urn:uuid to refer to it.</li>
</ol>



<a name="226733340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226733340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226733340">(Feb 17 2021 at 22:02)</a>:</h4>
<ol start="2">
<li>The other case is a pure data exchange where <a href="https://example.com/fhir">https://example.com/fhir</a> produces a bundle in which every resource has a fullUrl prefixed with <a href="https://example.com/fhir">https://example.com/fhir</a> and every reference is a relative reference that has to be interpreted against that restful base.</li>
</ol>



<a name="226733917"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226733917" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226733917">(Feb 17 2021 at 22:05)</a>:</h4>
<p>There are additional considerations for versioned references, conditional references, references by identifier, and references to some random fullUrl that we're not going to try to resolve. But the basic cases are referring to things on the server trying to process the bundle, and referring to things in the bundle.</p>



<a name="226736385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226736385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226736385">(Feb 17 2021 at 22:16)</a>:</h4>
<p>Also to reiterate an earlier comment I am in favour of not putting any details in this section about resolving references by identifier, other than the first point "The server is not required to perform any resolution whatsoever." It seems like a contradiction to say it's server-specific behaviour and then give a set of rules in the specification for doing it!</p>



<a name="226742053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226742053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226742053">(Feb 17 2021 at 23:09)</a>:</h4>
<p>Maybe there are different rules for different types of Bundles? I think the rules for Transaction/batch, search-set, and messages/documents might be different (as in certain things are allowed or not allowed for each group)</p>



<a name="226748519"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226748519" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226748519">(Feb 18 2021 at 00:17)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span></p>
<ul>
<li>will fix reference to server.  </li>
<li>will finish second branch</li>
<li>we need to cover situations where fullUrl is left unspecified.  It's unfortunate we allowed fullUrl to be omitted, but given we did, we need to handle it</li>
<li>agree this is complex.  I'd love to mandate fullUrl and prohibit in-bundle identifier resolution and conditional reference resolution.  However, that ship appears to have sailed.  We could possibly split it into two sections - good practice resolution (complex enough) and "special cases" for where systems do things that are allowed but unnecessary and which we encourage you to not support so senders will stop creating unnecessary work...</li>
</ul>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> </p>
<ul>
<li>Relative references with urn:uuid: is something that's been supported by the tools for a while and I know is in use in some production systems (necessary or not).  Given it was never explicitly discussed, we'd have grounds for prohibiting it, but it would create implementer pain.  (Especially because they're using the Java validator in production.)</li>
<li>We already have short descriptions of how to handle resolution of identifiers and the change request was to be more explicit. </li>
</ul>
<p><span class="user-mention" data-user-id="192685">@Vassil Peytchev</span> <br>
I'm not aware of any rules that say that conditional references or identifier references are prohibited except in certain cases?  (Happy to reflect if there's a rule though - the more we can push them to the edges, the better.)</p>



<a name="226757713"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226757713" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226757713">(Feb 18 2021 at 02:36)</a>:</h4>
<p>Re: "create implementer pain," endorsing extra/complex behaviors may be net more pain than proscribing them, even if a small number of current systems behave in ways outside of the spec (they can continue to work and just be non-conformant in this one small regard; no need to spread the complexity everywhere)</p>



<a name="226758636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226758636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226758636">(Feb 18 2021 at 02:54)</a>:</h4>
<p>Well, only if the Java validator continues to support the behavior...</p>



<a name="226838020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226838020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226838020">(Feb 18 2021 at 16:27)</a>:</h4>
<p>I didn't mean conditional references or logical references specifically. My first reaction was about relative references possibly referencing resources on a server (outside of the bundle):</p>
<ul>
<li>in Transaction/Batch, it makes sense that they are referencing resources on the server where the transaction/batch is posted</li>
<li>in search results, it makes sense the they are referencing resources on the server that performed the search</li>
<li>In a message or document it makes sense that they would only be relative to the fullUrl base of the resource, if the fullURL is a proper URL and not a URN.</li>
</ul>
<p>If we are looking at all the possible ways references could be written and then resolved, it seems that in some cases some variants may be prohibited, while in other they may be useful.</p>
<p>On fullUrl in the form urn:uuid or urn:oid - I can't see any reasonable argument to have "paths" following the UUID or OID, and that should be disallowed.</p>



<a name="226839701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226839701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226839701">(Feb 18 2021 at 16:36)</a>:</h4>
<p>You definitely can't have paths following the uuid or OID</p>



<a name="226844847"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226844847" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226844847">(Feb 18 2021 at 17:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179280-fhir.2Finfrastructure-wg/topic/Resolving.20references.20in.20Bundles/near/226839701">said</a>:</p>
<blockquote>
<p>You definitely can't have paths following the uuid or OID</p>
</blockquote>
<p>What about a link to the initial version of a newly created resource?</p>



<a name="226869907"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226869907" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226869907">(Feb 18 2021 at 19:53)</a>:</h4>
<p>You still wouldn't have anything following the uuid or OID...</p>



<a name="226870229"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226870229" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226870229">(Feb 18 2021 at 19:55)</a>:</h4>
<p>What about "uurn:uuid:9d1714da-b7e6-455b-bfd2-69ce0ff5fb12/_history/a"?</p>



<a name="226870376"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226870376" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226870376">(Feb 18 2021 at 19:56)</a>:</h4>
<p>How is that meaningful/possible?  How can there be history on something that doesn't have any existence outside the Bundle?</p>



<a name="226870401"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226870401" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226870401">(Feb 18 2021 at 19:56)</a>:</h4>
<p>Do you have a specific use-case?</p>



<a name="226870448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226870448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226870448">(Feb 18 2021 at 19:57)</a>:</h4>
<p>I want my provenance to link to the original version of the resource I'm creating, not to later updates.</p>



<a name="226871081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226871081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226871081">(Feb 18 2021 at 20:01)</a>:</h4>
<p>See <a href="http://jira.hl7.org/browse/FHIR-14138">J#14138</a></p>



<a name="226872885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226872885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226872885">(Feb 18 2021 at 20:13)</a>:</h4>
<p>So you're not wanting to point to a version so much as to say "when this transaction gets executed, the link should be version-specific"?</p>



<a name="226873441"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226873441" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226873441">(Feb 18 2021 at 20:17)</a>:</h4>
<p>Right, and I think that's what the current existing text intended to convey -- you can tag a version on the urn, but don't expect that version number to actually be used, the server will use whatever it picks. Although the current text implies a server will never pay attention to the specific number, which is incorrect when you are referring to an existing (versioned) resource. (Hmm, gets even weirder when you start talking about conditional creates).</p>



<a name="226873912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226873912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226873912">(Feb 18 2021 at 20:21)</a>:</h4>
<p>This sounds like what the X-Provenance header is trying to accomplish, making the Provenance resource refer to the specific version created by the operation it's attached to.</p>



<a name="226874007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226874007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226874007">(Feb 18 2021 at 20:22)</a>:</h4>
<p>so will you only need that concept in transaction bundles?<br>
or is there some other interaction you're thinking of?</p>



<a name="226874040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226874040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226874040">(Feb 18 2021 at 20:22)</a>:</h4>
<p><a href="http://hl7.org/fhir/provenance.html#header">http://hl7.org/fhir/provenance.html#header</a> - but it's unclear how this works with a bundle</p>



<a name="226874620"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226874620" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226874620">(Feb 18 2021 at 20:26)</a>:</h4>
<p>That works for Provenance.  But if you're wanting to create an Encounter and a Condition and say "this Encounter needs to point to this specific version of the Condition", you can't use the X-Provenance mechanism to accomplish that</p>



<a name="226874854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226874854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226874854">(Feb 18 2021 at 20:28)</a>:</h4>
<p>Yep, I've looked at that in the past and there really isn't any way. It's not trivial to actually implement such a thing either, as the referring resource should be updated in the same transaction but the version of the referent may not be known until after the transaction commits - if it's based on a commit timestamp, for example.</p>



<a name="226875093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226875093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226875093">(Feb 18 2021 at 20:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="237342">ryan moehrke</span> <a href="#narrow/stream/179280-fhir.2Finfrastructure-wg/topic/Resolving.20references.20in.20Bundles/near/226874007">said</a>:</p>
<blockquote>
<p>so will you only need that concept in transaction bundles?<br>
or is there some other interaction you're thinking of?</p>
</blockquote>
<p>I don't know of other places where we expect urns to "resolve." (Identifiers? Identifier or code systems?)</p>



<a name="226875614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226875614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226875614">(Feb 18 2021 at 20:32)</a>:</h4>
<p>I'd forgotten X-Provenance. It seems like a straightforward change to describe how it would work on a transaction bundle. I'd also add in language that the transaction can either contain a Provenance resource or the X-Provenance header. Although as Lloyd points out, there are like other cases beyond Provenance that would still need to be addressed.</p>



<a name="226876938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226876938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226876938">(Feb 18 2021 at 20:42)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> , <a href="http://jira.hl7.org/browse/FHIR-31345">J#31345</a>.</p>



<a name="226885921"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226885921" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226885921">(Feb 18 2021 at 21:44)</a>:</h4>
<p>I am missing how we get from</p>
<blockquote>
<p>What about "uurn:uuid:9d1714da-b7e6-455b-bfd2-69ce0ff5fb12/_history/a"?</p>
</blockquote>
<p>to</p>
<blockquote>
<p>I want my provenance to link to the original version of the resource I'm creating, not to later updates.</p>
</blockquote>
<p>I think the following applies from <a href="https://tools.ietf.org/html/rfc8141#section-4.1">section 4.1 of RFC 8141</a>:</p>
<blockquote>
<p>Because a URN is, syntactically, a URI under the "urn" scheme, in    theory a URN can be placed in any protocol slot that allows for a URI [...]</p>
<p>However, this does not imply that, semantically, it always makes  sense in practice to place a URN in a given URI protocol slot; in particular, because a URN might not specify the location of a resource or even point indirectly to one, it might not be appropriate  to place a URN in a URI protocol slot that points to a resource</p>
</blockquote>



<a name="226886975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226886975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226886975">(Feb 18 2021 at 21:52)</a>:</h4>
<p>We get to it by:</p>
<ul>
<li>in a transaction bundle, uuids stand in for the id of a to-be-created resource.</li>
<li>resource ids can be appended with ./_history/X to refer to a specific version of that resource.</li>
<li>I want to refer to a specific version (in this case, the initial version) of a to-be-created resource.</li>
<li>Based on that set of rules, uuid/_history/X should be able to refer to version of the newly created resource.</li>
</ul>



<a name="226890715"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226890715" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226890715">(Feb 18 2021 at 22:10)</a>:</h4>
<p>My understanding is quite different:</p>
<p>In a transaction bundle, fullUrl can contain a urn:uuid or urn:oid value, solely for the purpose of enabling references within the bundle to this particular resource. </p>
<p>Assuming that these fullUrl values will be used in any way outside of the bundle seems to be a stretch (IMO, all the way to non-conformance), and as far as I know is not documented anywhere. </p>
<p>Assuming that the uuid in from a urn:uuid fullUrl "stands in for the id of a to-be-created resource"  is also quite a stretch.</p>
<p>There is likely a much more sensible way to refer to the initial version of the to-be-created resource.</p>



<a name="226899505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226899505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226899505">(Feb 18 2021 at 23:27)</a>:</h4>
<p>The intention isn't that the urn:uuid can be used outside the Bundle.  It's being used as a temporary id in the transaction to support linking.  The question is how you indicate that you want the linking to be version-specific when you're using that temporary id mechanism.</p>



<a name="226902203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226902203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226902203">(Feb 18 2021 at 23:59)</a>:</h4>
<p>In other words the Provenance resource is in the bundle as well?</p>



<a name="226902771"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226902771" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226902771">(Feb 19 2021 at 00:04)</a>:</h4>
<p>Yes.  Or in my example, both Encounter and Condition are in the bundle.</p>



<a name="226904026"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226904026" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226904026">(Feb 19 2021 at 00:19)</a>:</h4>
<p>the other question I would have is: is there any use-case where you need to specify <em>which</em> version of a resource you want to point to (vs that you want to point to whichever version of the resource the current transaction creates) <br>
because in my mind, if we can specify that there is no reason why you would need this paradigm outside of a transaction bundle, and no reason why you would need to point to more than 'current' version (but explicitly) then we could have more of a flag or something indicating 'this temporary reference is version specific and should be replaced as such' - whatever that version may actually be - instead of having to figure out how to apply /_history to a uuid etc.</p>



<a name="226905054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226905054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226905054">(Feb 19 2021 at 00:32)</a>:</h4>
<p>I can't see such a use case (pointing to a version other than what the transaction creates) because if you don't know the identity of the resource, you wouldn't know the version ID that you want to point to.</p>



<a name="226906174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226906174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226906174">(Feb 19 2021 at 00:46)</a>:</h4>
<p>I can't think of a reason to point to anything but the latest/only version of a created resource, although I can think of uses that might point to a specific version of an existing resource. </p>
<p>Don't forget about conditional create though--there may be historical versions of a "new" resource. Again though, I can't think of a use for pointing at a previous version of a resource you are conditionally creating.</p>



<a name="226906980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226906980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226906980">(Feb 19 2021 at 00:58)</a>:</h4>
<p>You <em>would</em> be pointing to the version created by the transaction.  The thing is that you're wanting the refence to be locked to that version, rather than floating and just pointing to the object in general - such that as the referenced thing changes, you'll always end up with the most recent version when traversing the link.</p>



<a name="226907029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226907029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226907029">(Feb 19 2021 at 00:58)</a>:</h4>
<p>In the Encounter/Condition example, I want the Encounter to point to the specific version of the Condition I'm creating <em>now</em> - with this transaction, such that even if the Condition changes in the future, the Encounter always refers to this specific version.</p>



<a name="226907059"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226907059" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226907059">(Feb 19 2021 at 00:59)</a>:</h4>
<p>But if you want to point to an existing version of an existing resource you can just call it out by the RESTful url right?<br>
so I'm not sure how exactly our final version will look like, but theoretically something like versioned:9d1714da-b7e6-455b-bfd2-69ce0ff5fb12 may be better than uurn:uuid:9d1714da-b7e6-455b-bfd2-69ce0ff5fb12/_history/a that would only mean anything in a transaction bundle</p>



<a name="226907301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226907301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226907301">(Feb 19 2021 at 01:02)</a>:</h4>
<p><span class="user-mention" data-user-id="237342">@ryan moehrke</span> , except that we have a mechanism for version references defined in the current spec, and we don't have anything defined for "version:". Going with anything other than saying "a uuid followed by /_history followed by anything will point to the created version" is a breaking change.</p>



<a name="226907309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226907309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226907309">(Feb 19 2021 at 01:02)</a>:</h4>
<p>Sure.  If you're wanting to point to a version that exists outside the Bundle, then you'd use a proper reference.  The sole requirement here is "please establish a link to this other thing in the Bundle and, by the way, please ensure the link is version-specific".  We don't have a good way (that I know of) to do that.  Which is what <span class="user-mention" data-user-id="191380">@Elliot Silver</span> is asking for.</p>



<a name="226909766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226909766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226909766">(Feb 19 2021 at 01:35)</a>:</h4>
<p>Where do we write that /_history is the only way that urls can reference a version specific resource? the only mention here <a href="https://www.hl7.org/fhir/references.html">https://www.hl7.org/fhir/references.html</a> is in an 'eg.' example that just implies vRead format can be used. Is that really enough to call adding a specific keyword to call out this niche case a breaking change? nothing I can find anywhere else uses stronger language and sometimes doesn't even call out /_history at all.</p>
<p>And yes, Lloyd I know that referencing resources that exist outside of the bundle is not the scope of the question,, I was responding to " although I can think of uses that might point to a specific version of an existing resource. " as the only given case where my use-case restrictions may not cover. But as you mentioned that is not in scope for the question anyways.</p>
<p>Also to be clear I'm not saying that version: is our best bet. I'm just trying to pose that we shouldn't be twisting around existing formatting <em>if we don't need to.</em> If uuid/_history/blah is still better than sure go for it, but since as far as we can think this formatting will only be used in 1) a transaction bundle and 2) to point to whatever version <em>will be created by another interaction in said transaction bundle</em> <br>
I'd think something explicit would be better than overloading /_history</p>



<a name="226918231"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226918231" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226918231">(Feb 19 2021 at 04:10)</a>:</h4>
<p>I'm not arguing for throwing /_history on the end of a urn:uuid:....  In fact, I'm pretty sure that's <em>not</em> an option.  Whatever the reference is, it must be a valid URI.  If the URI starts with "urn:uuid:", then it has to follow the rules for that URN syntax - and throwing "/_history" on the end isn't it.  It may be that the solution is to put an extension on the reference.</p>
<p>Certainly if you're going to refer to a specific version of an existing resource, using the full history URL is the <em>only</em> way to do this - and is the completely REST-appropriate way to do so.</p>



<a name="226920339"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226920339" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226920339">(Feb 19 2021 at 04:50)</a>:</h4>
<p>Or we can <del>cheat</del> get creative:</p>
<ol>
<li>reference.reference="urn:uuid:aaa-ss-fsdg" in a transaction means always create a reference to the initial version of the resource created (if the server supports history)</li>
<li>reference.identifier="urn:uuid:aaa-ss-fsdg" in a transaction means always create a non-versioned reference to resource created.</li>
</ol>



<a name="226920984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226920984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226920984">(Feb 19 2021 at 05:02)</a>:</h4>
<p>We can't use a single special id.  There could be many (even hundreds) of distinct resources that each need version-specific links.  Plus hard-coding GUIDs is a recipe for disaster.  If GUIDs are the same across instances they're <em>supposed</em> to refer to the same resource.  I'd much prefer an extension.  At least that's clean and explicit.</p>



<a name="226929132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226929132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226929132">(Feb 19 2021 at 07:41)</a>:</h4>
<p>I think I didn't explain properly my (originally tongue-in-cheek) proposal.</p>
<ol>
<li>The purpose of having a fullUrl of the format urn:uuid or urn:oid is to provide Identity to resources that don't have one. In particular, in transactions/batch Bundles, such fullUrls can be used as a reference pointer to resources that are yet to be created.</li>
<li>References can be literal (URL) or logical (identifier).</li>
<li>UUIDs and OIDs are by definition identifiers.</li>
<li>Based on the above, and the quote from RFC 8141, it seem to me that the proper way to reference resources within a Bundle where the fullUrl is in the format urn:uuid: or urn:oid, is to use reference.identifier.value</li>
<li>With a couple of well thought-out new values for reference.identifier.use and reference.identifier.type we can get a clear and deterministic solution to the original problem (and add clarity to the general issue of resolving references on s bundle).</li>
</ol>



<a name="226968339"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226968339" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226968339">(Feb 19 2021 at 14:16)</a>:</h4>
<p>If a Reference.identifier is specified, there's no expectation the server will resolve it.  It's certainly not treated like a Reference.reference</p>



<a name="226970811"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226970811" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226970811">(Feb 19 2021 at 14:32)</a>:</h4>
<p>There is current language that sets such an expectation for internal references in a bundle</p>
<blockquote>
<p>Note, in addition, that a reference may be by identifier, and if it is, and there is no URL, it may be resolved by scanning the ids in the bundle.</p>
</blockquote>



<a name="226972696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226972696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226972696">(Feb 19 2021 at 14:46)</a>:</h4>
<p>Not that <em>requires</em> resolution</p>



<a name="226972724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226972724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226972724">(Feb 19 2021 at 14:46)</a>:</h4>
<p>And even if it did, there's no expectation they'll get turned into references</p>



<a name="226987109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226987109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226987109">(Feb 19 2021 at 16:17)</a>:</h4>
<p>Given that FHIR servers aren't required to even <em>support</em> versioned resources, wouldn't it be better to make an extension (e.g., <code>&lt;base&gt;/treat-as-version-specific-reference</code>)?  This could be placed either on the reference itself, or on the bundle (for allowed bundle types).</p>



<a name="226994315"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226994315" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226994315">(Feb 19 2021 at 17:02)</a>:</h4>
<p>I'd put it as an extension on the Reference.  Typically this would be something that would vary from reference to reference.</p>



<a name="226995608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226995608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226995608">(Feb 19 2021 at 17:10)</a>:</h4>
<p>Makes sense to me - I wasn't sure if the use cases were more along the lines of 'everything in this transaction should be <del>reference</del> version locked'.</p>



<a name="226996408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226996408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226996408">(Feb 19 2021 at 17:16)</a>:</h4>
<p>Not generally.  References to Patient or Practitioner would rarely be appropriate to be version-locked.  On the other hand, references to Condition or Questionnaire commonly would be.</p>



<a name="226996899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226996899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226996899">(Feb 19 2021 at 17:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="222054">Gino Canessa</span> <a href="#narrow/stream/179280-fhir.2Finfrastructure-wg/topic/Resolving.20references.20in.20Bundles/near/226987109">said</a>:</p>
<blockquote>
<p>Given that FHIR servers aren't required to even <em>support</em> versioned resources, wouldn't it be better to make an extension</p>
</blockquote>
<p>I don't buy this as motivation. What is the behaviour for existing resources if a client includes a version reference and the server doesn't support versions? We already have mechanisms to deal with this.</p>
<p>If we are going to create an extension, I'd suggest something like "reference current version", and allow it to be used for any resource, existing or newly created.</p>
<p>However, I stand by my position that the resolution previously agreed to was to support _history on uuids, and that any change to that is a breaking change.</p>



<a name="226997273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226997273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226997273">(Feb 19 2021 at 17:21)</a>:</h4>
<p>It's only a breaking change if it was documented in the spec somewhere.  And given that the solution would automatically have been broken (because it would have resulted in an invalid URI, breaking a different rule), correcting it would qualify as a technical correction</p>



<a name="226997492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226997492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226997492">(Feb 19 2021 at 17:23)</a>:</h4>
<p>You <em>can't</em> allow <code>/_history</code> on a UUID - it is not a valid <a href="https://tools.ietf.org/html/rfc4122">URN</a>.</p>
<p>With that requirement, I much prefer an extension over building in more conditional processing complexity.</p>
<p>Edit: my note about server support relates to the conditional nature of the processing - I think any major intention in <code>Bundle</code> would need to handle both situations.</p>



<a name="226999306"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/226999306" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#226999306">(Feb 19 2021 at 17:37)</a>:</h4>
<blockquote>
<p>You can't allow /_history on a UUID - it is not a valid <a href="https://tools.ietf.org/html/rfc4122">URN</a>.</p>
</blockquote>
<p>More precisely, it is an invalid URN in the UUID namespace.</p>



<a name="227000125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/227000125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#227000125">(Feb 19 2021 at 17:43)</a>:</h4>
<p>Well, the response to <a href="http://jira.hl7.org/browse/FHIR-14138">J#14138</a> makes it pretty clear that we intended it to work the way I've described. And I'm not arguing whether it is a valid URN or not, I'm pointing out that I believe it to be a breaking change.</p>
<p>Also, <span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> previously <a href="#narrow/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions/near/153917905">said</a>:</p>
<blockquote>
<p>It would be &lt;guid&gt;/_version/xyz, but otherwise yes.</p>
</blockquote>
<p>I'd really like <span class="user-mention" data-user-id="191328">@Ewout Kramer</span>, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> or someone else involved in the original discussion to chime in.</p>



<a name="227001852"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/227001852" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#227001852">(Feb 19 2021 at 17:54)</a>:</h4>
<p>I don't think <a href="http://jira.hl7.org/browse/FHIR-14138">FHIR#14138</a> says anything about UUIDs at all.  I do agree the intention is to ensure that version-specific references in allowed in transactions, but disagree that it discussed UUIDs.</p>
<p>The referenced ticket (<a href="http://jira.hl7.org/browse/FHIR-14005">FHIR#14005</a>) specifically asks about it, and the resolution is:</p>
<blockquote>
<p>Question answered in #14138. You don't need to use urn:uuid, you can have a "symbolic" FHIR reference with a version indication to make this work.</p>
</blockquote>
<p>Which (to me) reads that you <em>cannot</em> use a UUID for a versioned reference, but can use a symbolic one.</p>



<a name="227002253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/227002253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#227002253">(Feb 19 2021 at 17:57)</a>:</h4>
<p>Yeah, I reread <a href="http://jira.hl7.org/browse/FHIR-14005">J#14005</a> too. I don't recall what a "symbolic" reference is.</p>



<a name="227002850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/227002850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#227002850">(Feb 19 2021 at 18:01)</a>:</h4>
<p>I think Lloyd could be more authoritative, but I assume it is just referring to assigning a local URI with a version (e.g., <code>Patient/123/_history/3</code>) within the bundle - knowing that the ID and version will be replaced during processing.</p>



<a name="227378118"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/227378118" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#227378118">(Feb 23 2021 at 03:33)</a>:</h4>
<p>I've updated the proposed language based on our discussions today.  Look at the last comment:<br>
<a href="https://jira.hl7.org/browse/FHIR-29271">https://jira.hl7.org/browse/FHIR-29271</a></p>



<a name="227453101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/227453101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#227453101">(Feb 23 2021 at 15:57)</a>:</h4>
<p>I like it, but I think this is a typo:<br>
"Note that the rules for resolving references in contained resources are the same as those for resolving <strong>resources</strong> in the resource that contains the contained resource.  I.e. the fullUrl of the containing resource is used when determining the base for relative references, etc."<br>
bold is my emphasis: that should be "same as those for resolving references in the resource" right?<br>
that whole 'contained' blurb feels a bit wordy, but I don't have a better proposal so I'm not kicking and screaming for it to change.</p>



<a name="227457269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/227457269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#227457269">(Feb 23 2021 at 16:15)</a>:</h4>
<p>Fixed</p>



<a name="229394452"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/229394452" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#229394452">(Mar 08 2021 at 23:20)</a>:</h4>
<p>Well, after accepting the resolution today, I finally remembered what I meant by resolving the references on the server for Batch and Transaction Bundles.</p>
<p>Scenario: A transaction that contains an Entry of an observation, that points to a patient. In the entry for the observation, the request method is POST, and therefore, the fullUrl is either missing, or it is a URN. The referenced patient is not part of the Bundle, since there are no changes to that resource.</p>
<p>I think it is appropriate in this case to require an attempt to resolve the relative reference <code>Patient/123</code> against the FHIR server where the transaction/Batch is posted.</p>



<a name="229402105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/229402105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#229402105">(Mar 09 2021 at 00:33)</a>:</h4>
<p>And it needs to be a relative reference rather than absolute why?</p>



<a name="229403009"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/229403009" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#229403009">(Mar 09 2021 at 00:44)</a>:</h4>
<p>Because that is how it would look if it wasn't a part of a transaction. Requiring that it has to be an absolute reference would make things harder in cases of a multi-step preparation of transactions/batches.</p>



<a name="229410732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/229410732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#229410732">(Mar 09 2021 at 02:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191506">@Yunwei Wang</span> Can you put this on our agenda to evaluate again next week?</p>



<a name="229562158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/229562158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#229562158">(Mar 09 2021 at 22:01)</a>:</h4>
<p>I think this is the key point - if I POST an Observation containing a relative reference "Patient/123", the POST has no fullUrl for the Observation. There is an expectation (although perhaps I'm expecting too much and it's not spelled out anywhere?) that the server will interpret that reference relative to the server's base.</p>
<p>But if I then wrap that same POST in a transaction bundle, that expectation disappears?</p>



<a name="235752124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/235752124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Lamy <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#235752124">(Apr 22 2021 at 21:35)</a>:</h4>
<p>Based on the final language in <a href="https://jira.hl7.org/browse/FHIR-29271">https://jira.hl7.org/browse/FHIR-29271</a>, any references using reference.identifier fail to resolve. What does it mean to fail in this context? I thought the intent was that servers may choose to resolve identifiers but are not required to.</p>



<a name="235752337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/235752337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#235752337">(Apr 22 2021 at 21:37)</a>:</h4>
<p>We don't dictate what failure to resolve means.  Servers are allowed to treat it as an error, warning or ignore.  Or to fail to even try to resolve in the first place.</p>



<a name="261807838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/261807838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#261807838">(Nov 17 2021 at 16:19)</a>:</h4>
<p>Reviving this old thread... did an extension ever get created to specify a reference should be version-specific?</p>



<a name="261810507"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/261810507" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#261810507">(Nov 17 2021 at 16:36)</a>:</h4>
<p>Is it allowed for me to update Provenance definition with an 'informative' guidance that would 'guide' data recipients (e.g. servers) to upgrade <a href="http://Provenance.target">Provenance.target</a> references to a version specific reference WHEN that recipient is a versioning service, and when the request was to create/update with provenance (e.g. use of X-Provenance header, bundle transaction/batch with create/update and a Provenance)? This would be consistent with the current recommendation for <a href="http://Provenance.target">Provenance.target</a> to be a version specific id, but is indeed new guidance to upgrade non-version links to version specific links.</p>



<a name="261824557"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/261824557" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#261824557">(Nov 17 2021 at 18:10)</a>:</h4>
<p>This referring to <a href="http://jira.hl7.org/browse/FHIR-31345">FHIR-31345</a> that is asking for <a href="http://Provenance.target">Provenance.target</a> handling</p>



<a name="261855949"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/261855949" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#261855949">(Nov 17 2021 at 21:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191380">@Elliot Silver</span> did a tracker item ever get created?</p>



<a name="261859748"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/261859748" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#261859748">(Nov 17 2021 at 22:24)</a>:</h4>
<p>I don't recall creating one, and searching Jira for "version" is useless. I can create one if needed.</p>



<a name="261866495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/261866495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#261866495">(Nov 17 2021 at 23:36)</a>:</h4>
<p>If you can't find one, creating one is the first step I guess</p>



<a name="261867453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/261867453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#261867453">(Nov 17 2021 at 23:48)</a>:</h4>
<p>OK. Rereading the thread, is there a need for a second to clarify not appending _history to urns?</p>



<a name="261869665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/261869665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#261869665">(Nov 18 2021 at 00:13)</a>:</h4>
<p>Sounds like a good idea</p>



<a name="262009913"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/262009913" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#262009913">(Nov 19 2021 at 00:00)</a>:</h4>
<p><a href="http://jira.hl7.org/browse/FHIR-34342">J#34342</a>, <a href="http://jira.hl7.org/browse/FHIR-34344">J#34344</a>, and for fun <a href="http://jira.hl7.org/browse/FHIR-34345">J#34345</a>.</p>



<a name="271267708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/271267708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#271267708">(Feb 09 2022 at 12:15)</a>:</h4>
<p>I'm trying to implement the new proposed algorithm in the context of resolving a resource within a FHIR document. One question regarding the following section: </p>
<div class="codehilite"><pre><span></span><code>Extract the [root] from the Bundle entry&#39;s fullUrl and append the relative reference to it (e.g., &quot;https://fhir.example.org/&quot; + &quot;Patient/123&quot; --&gt; &quot;https://fhir.example.org/Patient/123&quot;)
</code></pre></div>
<p>Does this imply that all bundle fullUrls, if they are absolute urls, need to have the same root? Otherwise how am I supposed to pick the correct root? Or would I need to try out all potential combinations?</p>



<a name="271286185"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/271286185" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#271286185">(Feb 09 2022 at 14:32)</a>:</h4>
<p>The snippet you quoted above is how you turn a relative reference (within a <code>Bundle.entry.resource....reference</code>) into an absolute one. Having constructed this value, you can look for a sibling <code>Bundle.entry</code> whose <code>Bundle.entry.fullUrl</code> equals your constructed value. I'm not sure what "potential combinations" you're referring to. An example might help here.</p>



<a name="271297072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/271297072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#271297072">(Feb 09 2022 at 15:43)</a>:</h4>
<p>I was talking about the situation where you have a bundle containing fullUrls with multiple roots. When resolving the relative reference, I missed the part that you would extract the root of the fullUrl of the entry containing the relative reference. You should not assume that all roots are the same within the bundle and therefore extract the root from any fullUrl.</p>



<a name="271297331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/271297331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#271297331">(Feb 09 2022 at 15:45)</a>:</h4>
<p>Makes definitely more sense :) Thanks!</p>



<a name="271298319"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179280-fhir/infrastructure-wg/topic/Resolving%20references%20in%20Bundles/near/271298319" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179280-fhir/infrastructure-wg/topic/Resolving.20references.20in.20Bundles.html#271298319">(Feb 09 2022 at 15:51)</a>:</h4>
<p>Quite so. If there are clarifications you think would have been helpful here, please do suggest updated language! We've been trying to make this more approachable.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
