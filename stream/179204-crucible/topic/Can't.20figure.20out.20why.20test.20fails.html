---
layout: page
title: "FHIR Chat  · Can&#x27;t figure out why test fails · crucible"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/index.html">crucible</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html">Can&#x27;t figure out why test fails</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="157278207"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157278207" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikhail Lapshin <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157278207">(Jan 31 2019 at 15:09)</a>:</h4>
<p>Hello guys! I'm running Crucible against Aidbox FHIR server and all of  'Base Resources' tests are failing on vread interaction, and I can't understand why. The permalink to one of failed tests is: <a href="https://projectcrucible.org/servers/5c3c642504ebd041c500001a#5c51eb7a04ebd028cd000006/resourcetest_device/X040_Device" target="_blank" title="https://projectcrucible.org/servers/5c3c642504ebd041c500001a#5c51eb7a04ebd028cd000006/resourcetest_device/X040_Device">https://projectcrucible.org/servers/5c3c642504ebd041c500001a#5c51eb7a04ebd028cd000006/resourcetest_device/X040_Device</a></p>
<p>UI says that failure reason is: "Service did not respond with bundle", but I'm pretty sure that response contains a valid history Bundle (you can see it in request inspector). Thanks in advance for any suggestions.</p>



<a name="157286228"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157286228" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157286228">(Jan 31 2019 at 16:54)</a>:</h4>
<p>The weird thing is that the history request is made using XML, but all the other requests are JSON. Attention <span class="user-mention" data-user-id="192576">@Robert Scanlon</span></p>



<a name="157292383"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157292383" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157292383">(Jan 31 2019 at 18:15)</a>:</h4>
<p>Hmmm, this error is generically "for some reason I can't parse the response as a Bundle".  It could be a structural issue with the XML, or it is missing required bundle fields.  The error message isn't very helpful</p>



<a name="157292390"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157292390" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157292390">(Jan 31 2019 at 18:15)</a>:</h4>
<p><a href="https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/resource_test.rb#L406" target="_blank" title="https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/resource_test.rb#L406">https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/resource_test.rb#L406</a></p>



<a name="157292669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157292669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157292669">(Jan 31 2019 at 18:19)</a>:</h4>
<p>As soon as I have a chance I'll try loading it up directly through the fhir models to see if I can get more specifics: <a href="https://github.com/fhir-crucible/fhir_models#resource-basics" target="_blank" title="https://github.com/fhir-crucible/fhir_models#resource-basics">https://github.com/fhir-crucible/fhir_models#resource-basics</a></p>



<a name="157292688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157292688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157292688">(Jan 31 2019 at 18:19)</a>:</h4>
<p>And we'll have to investigate why the client is doing xml in that case as well.  That is strange.</p>



<a name="157356201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157356201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikhail Lapshin <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157356201">(Feb 01 2019 at 14:30)</a>:</h4>
<blockquote>
<p>As soon as I have a chance I'll try loading it up directly through the fhir models to see if I can get more specifics: <a href="https://github.com/fhir-crucible/fhir_models#resource-basics" target="_blank" title="https://github.com/fhir-crucible/fhir_models#resource-basics">https://github.com/fhir-crucible/fhir_models#resource-basics</a></p>
</blockquote>
<p>Just tried to do this and looks like XML file is parsed correctly into the FHIR::Bundfle instance. Here is the source XML document generated by Aidbox and the output of FHIR.from_contents() call:<br>
<a href="https://gist.github.com/mlapshin/e2a4c6b8d394c0701d4ca52a2763ca04" target="_blank" title="https://gist.github.com/mlapshin/e2a4c6b8d394c0701d4ca52a2763ca04">https://gist.github.com/mlapshin/e2a4c6b8d394c0701d4ca52a2763ca04</a> </p>
<p>There are couple of strange log lines complaining about errors, but no exceptions at all.</p>



<a name="157364936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157364936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157364936">(Feb 01 2019 at 16:26)</a>:</h4>
<p>This is definitely a problem with Crucible.  We have actually fixed this in one of the underlying libraries already, but those changes haven't been deployed yet to <a href="http://projectcrucible.org" target="_blank" title="http://projectcrucible.org">projectcrucible.org</a>.  I'll update this thread when we deploy the new version.  Thanks for your patience!</p>



<a name="157365091"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157365091" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikhail Lapshin <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157365091">(Feb 01 2019 at 16:28)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="192576">@Robert Scanlon</span></p>



<a name="157365242"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157365242" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157365242">(Feb 01 2019 at 16:31)</a>:</h4>
<p>(if you would like to see it working right now, you can clone <a href="https://github.com/fhir-crucible/plan_executor" target="_blank" title="https://github.com/fhir-crucible/plan_executor">plan_executor</a>, do <code>bundle install</code>, and then run <code>bundle exec rake crucible:execute[https://openedbox.aidbox.app/fhir/,:stu3,ResourceTest,Device]</code>)</p>



<a name="157528652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Can%27t%20figure%20out%20why%20test%20fails/near/157528652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikhail Lapshin <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Can&#x27;t.20figure.20out.20why.20test.20fails.html#157528652">(Feb 04 2019 at 15:02)</a>:</h4>
<p>Looks like it's fixed in master:</p>
<div class="codehilite"><pre><span></span>ResourceTest_Device
      PASS x000_read_type_test:
      PASS x010_create_new_test: New Device was created.
      PASS x012_conditional_create_(no_matches)_test: New Device was created.
      PASS x013_conditional_create_(one_match)_test: Request was correctly ignored.
      PASS x014_conditional_create_(multiple_matches)_test: Request correctly failed.
      PASS x020_read_existing_test: Successfully read preexisting Device.
      PASS x030_update_existing_test: Updated existing Device.
      PASS x032_conditional_update_(no_matches)_test: New Device was created.
      PASS x033_conditional_update_(one_match)_test: Updated existing Device.
      PASS x034_conditional_update_(multiple_matches)_test: Request correctly failed.
      PASS x040_read_history_of_existing_test: Service responded with bundle.
      PASS x050_version_read_existing_test: Read current version of preexisting Device.
      PASS x055_previous_version_read_existing_test: Read previous version of preexisting Device.
      PASS x060_validate_test: Device was validated.
      PASS x065_validate_existing_test: Existing Device was validated.
      PASS x067_validate_against_a_profile_test: Device was validated.
      PASS x070_delete_existing_test: Existing Device was deleted.
      PASS x075_get_deleted_resource_test: Deleted Device was correctly reported as gone.
Execute ResourceTest completed in 21.671793000015896 seconds.
</pre></div>


<p>Looking forward to see it deployed on <a href="http://projectcrucible.org" target="_blank" title="http://projectcrucible.org">projectcrucible.org</a>.  Thanks for your cooperation, Robert!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
