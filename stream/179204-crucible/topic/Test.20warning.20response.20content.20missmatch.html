---
layout: page
title: "FHIR Chat  · Test warning response content missmatch · crucible"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/index.html">crucible</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Test.20warning.20response.20content.20missmatch.html">Test warning response content missmatch</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="161641832"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Test%20warning%20response%20content%20missmatch/near/161641832" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Test.20warning.20response.20content.20missmatch.html#161641832">(Mar 25 2019 at 13:19)</a>:</h4>
<p>I am getting a warning in the format tests: "requested XML response does not match created resource"</p>
<p>Which is probably true, but I cannot figure out what misses. Crucible creates the patient as:</p>
<div class="codehilite"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
      &lt;Patient
          xmlns=&quot;http://hl7.org/fhir&quot;&gt;
          &lt;meta&gt;
              &lt;tag&gt;
                  &lt;system value=&quot;http://projectcrucible.org&quot;/&gt;
                  &lt;code value=&quot;testdata&quot;/&gt;
              &lt;/tag&gt;
          &lt;/meta&gt;
          &lt;name&gt;
              &lt;family value=&quot;Emerald&quot;/&gt;
              &lt;given value=&quot;Caro&quot;/&gt;
          &lt;/name&gt;
      &lt;/Patient&gt;
</pre></div>


<p>and I return:</p>
<div class="codehilite"><pre><span></span>      &lt;Patient
          xmlns=&quot;http://hl7.org/fhir&quot;&gt;
          &lt;id value=&quot;ad27ea04-124f-424a-9ea7-a2c0f3717672&quot;&gt;&lt;/id&gt;
          &lt;meta&gt;
              &lt;versionId value=&quot;1&quot;&gt;&lt;/versionId&gt;
              &lt;lastUpdated value=&quot;2019-03-25T12:59:28.489250+00:00&quot;&gt;&lt;/lastUpdated&gt;
              &lt;tag&gt;
                  &lt;system value=&quot;http://projectcrucible.org&quot;&gt;&lt;/system&gt;
                  &lt;code value=&quot;testdata&quot;&gt;&lt;/code&gt;
              &lt;/tag&gt;
          &lt;/meta&gt;
          &lt;name&gt;
              &lt;family value=&quot;Emerald&quot;&gt;&lt;/family&gt;
              &lt;given value=&quot;Caro&quot;&gt;&lt;/given&gt;
          &lt;/name&gt;
      &lt;/Patient&gt;
</pre></div>


<p>which is the same as far as I can tell /o\ It all boils down to <a href="https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L83" target="_blank" title="https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L83">https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L83</a> but I do not know enough ruby to follow that. The permalink to the test is <a href="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c98d0ac04ebd03124000013/format001/CT01" target="_blank" title="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c98d0ac04ebd03124000013/format001/CT01">https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c98d0ac04ebd03124000013/format001/CT01</a></p>
<p>Thank you!</p>



<a name="161645620"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Test%20warning%20response%20content%20missmatch/near/161645620" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Test.20warning.20response.20content.20missmatch.html#161645620">(Mar 25 2019 at 14:01)</a>:</h4>
<p>Thanks, this needs to be fixed.  That line calls this method: <a href="https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L309" target="_blank" title="https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L309">https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L309</a> , which then tells the underlying FHIR model library to compare the two resources, excluding any 'id' elements.  But it is valid to add other things in the meta element as well.  So either we should change that to exclude ['id', 'versionId', 'lastUpdated'] (and check to see if there is anything else that can change), or just do ['id','meta']</p>



<a name="161645845"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Test%20warning%20response%20content%20missmatch/near/161645845" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Test.20warning.20response.20content.20missmatch.html#161645845">(Mar 25 2019 at 14:03)</a>:</h4>
<p>Will update here when we resolve this.</p>



<a name="161645851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Test%20warning%20response%20content%20missmatch/near/161645851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Test.20warning.20response.20content.20missmatch.html#161645851">(Mar 25 2019 at 14:03)</a>:</h4>
<p>Thanks!</p>



<a name="161865124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Test%20warning%20response%20content%20missmatch/near/161865124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Test.20warning.20response.20content.20missmatch.html#161865124">(Mar 27 2019 at 14:37)</a>:</h4>
<p><span class="user-mention" data-user-id="213323">@Florian Apolloner</span> -- fixed this issue and things look good now.  Thanks for the report!  <a href="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c9b8a4104ebd07a52000000/format001/CT01" target="_blank" title="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c9b8a4104ebd07a52000000/format001/CT01">https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c9b8a4104ebd07a52000000/format001/CT01</a></p>



<a name="161865418"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Test%20warning%20response%20content%20missmatch/near/161865418" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Test.20warning.20response.20content.20missmatch.html#161865418">(Mar 27 2019 at 14:40)</a>:</h4>
<p>This also addresses 406 issue.  I agree that the test using hte ?_format param would make more sense if we also removed the Accept header, but what we are doing is technically valid still (_format should just override the header), and removing the Accept header would be complicated given the way our client is designed.</p>



<a name="162024785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179204-crucible/topic/Test%20warning%20response%20content%20missmatch/near/162024785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179204-crucible/topic/Test.20warning.20response.20content.20missmatch.html#162024785">(Mar 29 2019 at 07:39)</a>:</h4>
<p><span class="user-mention" data-user-id="192576">@Robert Scanlon</span> Thank you so far, it works as expected. Ah yes I understand that your client might make it hard. If it is easier would it be possible that you make your client send a proper Accept header and then just override _format to an invalid value? This way you should still be able to check the correctness (if the library allows for it)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
