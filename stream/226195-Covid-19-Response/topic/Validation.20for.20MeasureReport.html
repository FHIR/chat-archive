---
layout: page
title: "FHIR Chat  · Validation for MeasureReport · Covid-19 Response"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/index.html">Covid-19 Response</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html">Validation for MeasureReport</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="194604105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194604105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194604105">(Apr 19 2020 at 15:52)</a>:</h4>
<p>I'm trying to track down the source of errors in the Build reported for my MeasureReport examples.  I'm about to push a build that will show these errors.  I cannot seem to track down where/why they are generated.  It's not that I don't understand the logic, what I'm trying to figure out is WHERE these constraints are coming from, because I cannot find them in the Resource definitions.  I'm guessing there's some custom validation code for resources which reference definitions. <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="191401">@Eric Haas</span> <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="194620781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194620781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194620781">(Apr 19 2020 at 22:24)</a>:</h4>
<p>yes there is additional validation that enforces rules stated or implied by the definitions that are not explicitly stated. These are work in progress - do you think they're wrong?</p>



<a name="194625746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194625746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194625746">(Apr 20 2020 at 00:56)</a>:</h4>
<p>There are actually two problems:</p>
<ol>
<li>The Validator converts the resource to R5, and I'm getting an error from the R4 to R5 converter due to our use of of data-absent-reason.  We report a count or a score that is in the measure, but indicate that the reason why @value is missing.  The converter doesn't like this.  As a result, several missing count/score values are being reported as in error by the validator, even though the element is present.</li>
<li>We have several population measures (measure-population) in a group, further clarified with addition code values.  They are each in fact a different, non-stratified measure-population from the same initial-population in a measure.  I could make them measure-observation I guess, but they are just different counts of a population.  Stratifier isn't appropriate because CDC doesn't want all possible ways the data could be stratified across the two facets, just two of the strata are reported: IP = Hospitalized Patients, MP1 = Hospitalized Patients in ICU, and MP2 = ICU patients on a ventilator, and CDC isn't interested in the ratios (they can compute that from the MPs if they choose).</li>
</ol>



<a name="194625865"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194625865" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194625865">(Apr 20 2020 at 01:00)</a>:</h4>
<p>Here's the exception for the conversion error on count.<br>
java.lang.NullPointerException<br>
    at org.hl7.fhir.convertors.VersionConvertor_40_50.convertInteger(VersionConvertor_40_50.java:249)<br>
    at org.hl7.fhir.convertors.VersionConvertor_40_50.convertType(VersionConvertor_40_50.java:3668)<br>
    at org.hl7.fhir.igtools.publisher.Publisher$TypeParserR4.parseType(Publisher.java:442)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.parseType(NarrativeGenerator.java:1146)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator$BaseWrapperMetaElement.getBase(NarrativeGenerator.java:679)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.renderLeaf(NarrativeGenerator.java:1531)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.generateByProfile(NarrativeGenerator.java:1330)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.generateByProfile(NarrativeGenerator.java:1352)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.generateByProfile(NarrativeGenerator.java:1352)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.generate(NarrativeGenerator.java:1248)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.generate(NarrativeGenerator.java:1231)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.generateNarratives(Publisher.java:938)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3480)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:813)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:674)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7103)</p>



<a name="194627839"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194627839" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194627839">(Apr 20 2020 at 02:07)</a>:</h4>
<p>this is reproducible in what is committed?</p>



<a name="194632485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194632485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194632485">(Apr 20 2020 at 04:36)</a>:</h4>
<p>Yes.</p>



<a name="194632496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194632496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194632496">(Apr 20 2020 at 04:37)</a>:</h4>
<p>I can probably create an even simpler example.</p>



<a name="194633166"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194633166" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194633166">(Apr 20 2020 at 04:56)</a>:</h4>
<div class="codehilite"><pre><span></span>public static org.hl7.fhir.r5.model.IntegerType convertInteger(org.hl7.fhir.r4.model.IntegerType src) throws FHIRException {
    org.hl7.fhir.r5.model.IntegerType tgt = new org.hl7.fhir.r5.model.IntegerType(src.getValue());
    copyElement(src, tgt);
    return tgt;
}
</pre></div>


<p>Does not check for null value in src.<br>
problem could be related to Java unboxing? getValue() returns java.lang.Integer, but called constructor would be IntegerType(int value), and so null pointer error</p>



<a name="194634372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194634372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194634372">(Apr 20 2020 at 05:27)</a>:</h4>
<p>/** Demonstrate conversion failure */<br>
package com.ainq.kboone.tools;<br>
import org.hl7.fhir.convertors.VersionConvertor_40_50;<br>
import org.hl7.fhir.r4.model.StringType;<br>
import org.hl7.fhir.r5.model.IntegerType;</p>
<p>public class TestIntegerTypeConversion {</p>
<div class="codehilite"><pre><span></span>public static void main(String[] args) {
    testConversion();
}
public static void testConversion() {
    IntegerType t2 = null;
    org.hl7.fhir.r4.model.IntegerType t = new org.hl7.fhir.r4.model.IntegerType();
    t.addExtension().setUrl(&quot;http://example.com/Any-Value&quot;).setValue(new StringType(&quot;A String Extension&quot;));
    t2 = VersionConvertor_40_50.convertInteger(t);
}
</pre></div>


<p>}</p>



<a name="194634465"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194634465" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194634465">(Apr 20 2020 at 05:29)</a>:</h4>
<p>Initialization of tgt should probably be something like:<br>
org.hl7.fhir.r5.model.IntegerType tgt = src.hasValue() ? new org.hl7.fhir.r5.model.IntegerType(src.getValue()) : new org.hl7.fhir.r5.model.IntegerType();</p>



<a name="194652958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194652958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194652958">(Apr 20 2020 at 09:45)</a>:</h4>
<p>I have this fixed on a local branch, it was fairly straightforward:</p>
<p>Perform a file search/replace operation:<br>
Search for:<br>
org\.hl7\.fhir\.(dstu2|dstu3|r4|r5)\.model\.([A-Za-z0-9]+)Type tgt = new org\.hl7\.fhir\.(dstu2|dstu3|r4|r5)\.model\.([A-Za-z0-9]+)Type\(src\.getValue\(\)\);</p>
<p>Replace With:<br>
org.hl7.fhir.$1.model.$2Type tgt = src.hasValue ?<br>
new org.hl7.fhir.$3.model.$4Type(src.getValue()) :<br>
new org.hl7.fhir.$3.model.$4Type();</p>
<p>Add the following test to VersionConverter_10_30Test:</p>
<p>@Test<br>
  public void testConvertEmptyValuedUnsignedInt() {<br>
    org.hl7.fhir.dstu2.model.UnsignedIntType input = new org.hl7.fhir.dstu2.model.UnsignedIntType();<br>
    input.addExtension().setUrl("http://example.com/AnyValue").setValue(new org.hl7.fhir.dstu2.model.StringType("A value"));<br>
    org.hl7.fhir.dstu3.model.UnsignedIntType output;<br>
    output = (org.hl7.fhir.dstu3.model.UnsignedIntType)VersionConvertor_10_30.convertType(input);<br>
    assertNull(output.getValue());</p>
<p>}</p>



<a name="194663917"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194663917" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194663917">(Apr 20 2020 at 11:51)</a>:</h4>
<p><span class="user-mention" data-user-id="248736">@Mark Iantorno</span> I'm way behind right now - can you look at this?</p>



<a name="194720909"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/226195-Covid-19%20Response/topic/Validation%20for%20MeasureReport/near/194720909" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/226195-Covid-19-Response/topic/Validation.20for.20MeasureReport.html#194720909">(Apr 20 2020 at 19:20)</a>:</h4>
<p>Fix is here: <a href="https://github.com/hapifhir/org.hl7.fhir.core/pull/177" title="https://github.com/hapifhir/org.hl7.fhir.core/pull/177">https://github.com/hapifhir/org.hl7.fhir.core/pull/177</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
