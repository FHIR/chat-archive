---
layout: page
title: "FHIR Chat  · sample code · Vital Signs"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/index.html">Vital Signs</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html">sample code</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="197585137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197585137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197585137">(May 14 2020 at 16:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code>public List&lt;Observation&gt; getObservations(String id, String start, String end, String system, String code)
        throws Exception {
    IQuery&lt;IBaseBundle&gt; query = client.search() //
            .forResource(Observation.class) //
            .where(Observation.CODE.exactly().systemAndCode(system, code)) //
            .and(Observation.SUBJECT.hasId(id));
    if (start != null) {
        Date date = Date.from(LocalDate.parse(start).atStartOfDay().minusDays(2).toInstant(ZoneOffset.UTC));
        query = query.and(Observation.DATE.afterOrEquals().day(date));
    }
    if (end != null) {
        Date date = Date.from(LocalDate.parse(end).atStartOfDay().plusDays(2).toInstant(ZoneOffset.UTC));
        query = query.and(Observation.DATE.beforeOrEquals().day(date));
    }
    Bundle results = query.returnBundle(Bundle.class).execute();
    // Log the results
    // logger.info(ContextUtil.getContext().newXmlParser().setPrettyPrint(true).encodeResourceToString(results));
    ArrayList&lt;Observation&gt; ret = new ArrayList&lt;&gt;();
    ret.addAll(getEntries(results));
    while (results.getLink(Bundle.LINK_NEXT) != null) {
        results = client.loadPage().next(results).execute();
        ret.addAll(getEntries(results));
    }
    ArrayList&lt;Observation&gt; fret = new ArrayList&lt;&gt;();
    for (Observation obs : ret) {
        DateTimeType eff = obs.getEffectiveDateTimeType();
        if ((start == null || eff.after(parseDate(start, eff, false)))
                &amp;&amp; (end == null || eff.before(parseDate(end, eff, true)))) {
            fret.add(obs);
        }
    }
    return fret;
}
</code></pre></div>



<a name="197585282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197585282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197585282">(May 14 2020 at 16:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code>public List&lt;Observation&gt; getBloodPressures(Patient patient) throws Exception {
    return getBloodPressures(patient.getId());
}

public List&lt;Observation&gt; getBloodPressures(String id) throws Exception {
    return getBloodPressures(id, null, null);
}

public List&lt;Observation&gt; getBloodPressures(Patient patient, String start, String end) throws Exception {
    return getBloodPressures(patient.getId(), start, end);
}

public List&lt;Observation&gt; getBloodPressures(String id, String start, String end) throws Exception {
    return getObservations(id, start, end, LoincCode.system, LoincCode.Bp.getCode());
}
</code></pre></div>



<a name="197585462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197585462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197585462">(May 14 2020 at 16:58)</a>:</h4>
<div class="codehilite"><pre><span></span><code>public List&lt;Observation&gt; getAverageBloodPressures(Patient patient) throws Exception {
    return getAverageBloodPressures(patient.getId());
}

public List&lt;Observation&gt; getAverageBloodPressures(String id) throws Exception {
    return getAverageBloodPressures(id, null, null);
}

public List&lt;Observation&gt; getAverageBloodPressures(Patient patient, String start, String end) throws Exception {
    return getAverageBloodPressures(patient.getId(), start, end);
}

public List&lt;Observation&gt; getAverageBloodPressures(String id, String start, String end) throws Exception {
    return getObservations(id, start, end, SnomedConcept.system, &quot;&quot; + SnomedConcept.AverageBp.getSctid());
}
</code></pre></div>



<a name="197585910"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197585910" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197585910">(May 14 2020 at 17:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code>// 723232008 |Average blood pressure (observable entity)|
AverageBp(723232008, &quot;Average blood pressure (observable entity)&quot;),
// 314440001 |Average systolic blood pressure (observable entity)|
AverageSbp(314440001, &quot;Average systolic blood pressure (observable entity)&quot;),
// 314453003 |Average diastolic blood pressure (observable entity)|
AverageDbp(314453003, &quot;Average diastolic blood pressure (observable entity)&quot;),
// 364075005 |Heart rate (observable entity)|
</code></pre></div>



<a name="197588758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197588758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claude Nanjo <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197588758">(May 14 2020 at 17:20)</a>:</h4>
<p>Hi Eric, it looks like we cannot support two FHIR servers at a time, at least for the setup we have for the connectathon so we will have to import the data. Is the last data set you provided to me the latest or do you want to send me an updated set? I will then import it into our FHIR server. This will simulate the pull from the aggregator for now.</p>



<a name="197590405"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197590405" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197590405">(May 14 2020 at 17:32)</a>:</h4>
<p>The data I sent should be close enough, but here's the latest<br>
<a href="/user_uploads/10155/27bUv6QltnHqBhng8c7btwum/ATC-med-2-cimi-avgs.json">ATC-med-2-cimi-avgs.json</a> <a href="/user_uploads/10155/YuiZdYA9en-g7q5DV46YHsnT/ATC-med-2-cimi.json">ATC-med-2-cimi.json</a></p>



<a name="197590673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197590673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claude Nanjo <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197590673">(May 14 2020 at 17:34)</a>:</h4>
<p>Out of the pair, which one should I use in determining whether the patient's blood pressure is in control? I assume the clinically valid average?</p>



<a name="197590998"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197590998" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197590998">(May 14 2020 at 17:38)</a>:</h4>
<p>Yes, use IHM_AVERAGE_IHM_BP_7. For this data I think they are all clinically valid.</p>



<a name="197591055"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197591055" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claude Nanjo <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197591055">(May 14 2020 at 17:38)</a>:</h4>
<p>Perfect. Thank you.</p>



<a name="197594994"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197594994" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Claude Nanjo <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197594994">(May 14 2020 at 18:07)</a>:</h4>
<p>I noticed the algorithm in in the notes. It works for me but when I was generating data to test out the use case, I had it in the algorithm extension:<br>
{<br>
  "resourceType": "Observation",<br>
  "extension": [<br>
    {<br>
      "url": "<a href="http://hl7.org/fhir/hspc/StructureDefinition/BodyPositionExt">http://hl7.org/fhir/hspc/StructureDefinition/BodyPositionExt</a>",<br>
      "valueCodeableConcept": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
            "code": "33586001",<br>
            "display": "Sitting position (finding)"<br>
          }<br>
        ]<br>
      }<br>
    },<br>
    {<br>
      "url": "<a href="http://hl7.org/fhir/hspc/StructureDefinition/MeasurementDeviceExt">http://hl7.org/fhir/hspc/StructureDefinition/MeasurementDeviceExt</a>",<br>
      "valueCodeableConcept": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
            "code": "720738005",<br>
            "display": "Blood pressure cuff, adult size large (physical object)"<br>
          }<br>
        ]<br>
      }<br>
    },<br>
    {<br>
      "url": "<a href="http://hl7.org/fhir/hspc/StructureDefinition/MeasurementSettingExt">http://hl7.org/fhir/hspc/StructureDefinition/MeasurementSettingExt</a>",<br>
      "valueCodeableConcept": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
            "code": "264362003",<br>
            "display": "Home (environment)"<br>
          }<br>
        ]<br>
      }<br>
    },<br>
    {<br>
      "url": "<a href="http://hl7.org/fhir/hspc/StructureDefinition/AlgorithmForBloodPressureAverageExt">http://hl7.org/fhir/hspc/StructureDefinition/AlgorithmForBloodPressureAverageExt</a>",<br>
      "extension": [<br>
        {<br>
          "url": "<a href="http://hl7.org/fhir/hspc/StructureDefinition/AlgorithmTypeExt">http://hl7.org/fhir/hspc/StructureDefinition/AlgorithmTypeExt</a>",<br>
          "valueCodeableConcept": {<br>
            "text": "IHM_AVERAGE_IHM_BP_7"<br>
          }<br>
        },<br>
        {<br>
          "url": "<a href="http://hl7.org/fhir/hspc/StructureDefinition/TimeWindowExt">http://hl7.org/fhir/hspc/StructureDefinition/TimeWindowExt</a>",<br>
          "valueQuantity": {<br>
            "value": 10,<br>
            "unit": "d"<br>
          }<br>
        },<br>
        {<br>
          "url": "<a href="http://hl7.org/fhir/hspc/StructureDefinition/SetSizeExt">http://hl7.org/fhir/hspc/StructureDefinition/SetSizeExt</a>",<br>
          "valueInteger": 30<br>
        }<br>
      ]<br>
    }<br>
  ],<br>
  "status": "final",<br>
  "code": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
        "code": "723232008",<br>
        "display": "Average blood pressure (observable entity)"<br>
      }<br>
    ],<br>
    "text": "Average Home Blood Pressure Panel"<br>
  },<br>
  "subject": {<br>
    "reference": "Patient/X1000003"<br>
  },<br>
  "effectiveDateTime": "2020-05-13T20:34:03-07:00",<br>
  "bodySite": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
        "code": "17137000",<br>
        "display": "Structure of brachial artery (body structure)"<br>
      }<br>
    ]<br>
  },<br>
  "method": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
        "code": "17146006",<br>
        "display": "Arterial pressure monitoring, non-invasive method (regime/therapy)"<br>
      }<br>
    ]<br>
  },<br>
  "component": [<br>
    {<br>
      "code": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
            "code": "314453003",<br>
            "display": "Average diastolic blood pressure (observable entity)"<br>
          }<br>
        ],<br>
        "text": "Diastolic blood pressure"<br>
      },<br>
      "valueQuantity": {<br>
        "value": 96,<br>
        "unit": "mmHg"<br>
      }<br>
    },<br>
    {<br>
      "code": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
            "code": "314440001",<br>
            "display": "Average systolic blood pressure (observable entity)"<br>
          }<br>
        ],<br>
        "text": "Systolic blood pressure"<br>
      },<br>
      "valueQuantity": {<br>
        "value": 148,<br>
        "unit": "mmHg"<br>
      }<br>
    }<br>
  ]<br>
}</p>



<a name="197598375"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/235632-Vital%20Signs/topic/sample%20code/near/197598375" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/235632-Vital-Signs/topic/sample.20code.html#197598375">(May 14 2020 at 18:31)</a>:</h4>
<p>OK, if you could work with the note that would be great. There are some issues with the completeness of the algorithm extension and the use of codeable concept.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
