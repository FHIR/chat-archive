---
layout: page
title: "FHIR Chat  · Conditional Processing · TestScript Resource"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/index.html">TestScript Resource</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/topic/Conditional.20Processing.html">Conditional Processing</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="239265543"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/274423-TestScript%20Resource/topic/Conditional%20Processing/near/239265543" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/topic/Conditional.20Processing.html#239265543">(May 18 2021 at 14:43)</a>:</h4>
<p>As per our discussion during the connectathon, we are interested in adding conditional processing to TestScript but needed more solid use cases to drive what we need/should implement in the resource<br>
We also wanted a implementation, mocked up or otherwise, to test these use cases against and to help us figure out which design is best from a complexity vs flexibility vs processing requirements.</p>



<a name="239265695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/274423-TestScript%20Resource/topic/Conditional%20Processing/near/239265695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/topic/Conditional.20Processing.html#239265695">(May 18 2021 at 14:44)</a>:</h4>
<p>to facilitate this I had mocked up some potential solutions to conditional processing needs:</p>
<div class="codehilite"><pre><span></span><code>Loop based on Test Id:

test id=test1
    name+description etc.
    action
        operation does a polling read
    action
        assert
            checks polling came back completed
            LoopTest
                Wait: ${waitUntilValueFromPoll}
                When: OnFail
test id=test2
    name+description etc.
    action
        operation does a read on completed async result
    action
        assert like normal

Loop Based on action.loopReference

test id=test1
    name+description etc.
    action
        loopReference: pollingOperation
        operation does a polling read
    action
        assert
            checks polling came back completed
            JumpTo:
                Where: pollingOperation
                When: OnFail
                Wait: ${waitUntilValueFromPoll}
test id=test2
    name+description etc.
    action
        operation does a read on completed async result
    action
        assert like normal


test id=test1
    name+description etc.
    action
        operation does a POST
    action
        assert
            type: structural (of structural|conformance|warning)
            is the body correct resourceType
            JumpTo:
                Where: skipBodyVal
                When: OnFail
    action
        assert
            validate profileId
    action
        loopReference: skipBodyVal
        assert
            other important asserts


Conditional actions

test id=test1
    name+description etc.
    action
        operation does a POST
    action
        doIf: is the body correct resourceType
        assert
            validate profileId
    action
        assert
            other important asserts
</code></pre></div>



<a name="239266715"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/274423-TestScript%20Resource/topic/Conditional%20Processing/near/239266715" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/topic/Conditional.20Processing.html#239266715">(May 18 2021 at 14:50)</a>:</h4>
<p>And to start off the discussion of use-cases:<br>
Polling requests for subscriptions and/or bulk data require an indeterminate amount of requests to the polling endpoint - especially servers that reject requests to the polling endpoint after a success has given the client the needed data  as one would need the absolute perfect number of polling requests too few and too many would not process correctly. So some way to define if and how many times an operation and their asserts would need to be run/repeated is important to defining one testscript for the full polling use cases</p>



<a name="239285841"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/274423-TestScript%20Resource/topic/Conditional%20Processing/near/239285841" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/topic/Conditional.20Processing.html#239285841">(May 18 2021 at 16:40)</a>:</h4>
<p>seems this is re-inventing scripting that has already been standardized.</p>



<a name="239285867"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/274423-TestScript%20Resource/topic/Conditional%20Processing/near/239285867" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/topic/Conditional.20Processing.html#239285867">(May 18 2021 at 16:40)</a>:</h4>
<p>reminds me of a dilbert</p>



<a name="240166915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/274423-TestScript%20Resource/topic/Conditional%20Processing/near/240166915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorn Duwel <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/topic/Conditional.20Processing.html#240166915">(May 25 2021 at 10:18)</a>:</h4>
<p>Our use-cases for conditional processing as mentioned in the Connectathon:<br>
Note up front: We test if implementers can exchange FHIR resources based on dummy data that we provide, so next to testing the infrastructure we also test if they have entered our specific data correctly. minimumId has too much limitations (maybe this is a separate discussion), that is why we test this with asserts.</p>
<p>The FHIRpath expressions we test this with are growing pretty complex pretty quick (maybe because the asserts expressions do not recognize any 'context', so they cannot be broken down into smaller pieces). If an implementer fails the large expression, we would like to offer some extra guidance on where the error exactly is and how to solve this. This can perhaps be done looking in two directions (all element names are reflecting their exact intended functionality):</p>
<p>messageOnFail</p>
<div class="codehilite"><pre><span></span><code>&lt;test&gt;
    &lt;action&gt;
        &lt;operation/&gt;
    &lt;/action&gt;
    &lt;action&gt;
        &lt;messageOnFail value=&quot;Guidance on how to solve this&quot;/&gt;
        &lt;assert&gt;
            &lt;label value=&quot;test1&quot;/&gt;
            &lt;expression value=&quot;false&quot;/&gt;
        &lt;/assert&gt;
    &lt;/action&gt;
&lt;/test&gt;
</code></pre></div>
<p>Execute additional asserts (three different variants of <span class="user-mention" data-user-id="237342">@ryan moehrke</span> 's doIf, using assert.label:</p>
<div class="codehilite"><pre><span></span><code>&lt;test&gt;
    &lt;action&gt;
        &lt;operation/&gt;
    &lt;/action&gt;
    &lt;action&gt;
        &lt;assert&gt;
            &lt;label value=&quot;test1&quot;/&gt;
            &lt;expression value=&quot;...&quot;/&gt;
        &lt;/assert&gt;
        &lt;assert&gt;
            &lt;doIfExpression value=&quot;${expressionIsTrue}&quot;/&gt;
            &lt;expression value=&quot;...&quot;/&gt;
        &lt;/assert&gt;
        &lt;assert&gt;
            &lt;doIfTrue value=&quot;test1&quot;/&gt;
            &lt;expression value=&quot;...&quot;/&gt;
        &lt;/assert&gt;
        &lt;assert&gt;
            &lt;doIfFalse value=&quot;test1&quot;/&gt;
            &lt;expression value=&quot;...&quot;/&gt;
        &lt;/assert&gt;
    &lt;/action&gt;
&lt;/test&gt;
</code></pre></div>
<p>Another use case I mentioned is that implementers can provide a PDF as both Binary resource and inline data. At the moment we provide separate TestScripts for each use case and implementers have to select the correct one themselves. It would be more user friendly and easier to maintain if this branching could be done in 1 TestScript:</p>
<div class="codehilite"><pre><span></span><code>&lt;test id=&quot;test1&quot;&gt;
    &lt;executeWhenExpression value=&quot;${expressionIsTrue}&quot;/&gt;
    &lt;executeWhenTestPass value=&quot;test1&quot;/&gt;
    &lt;executeWhenTestFail value=&quot;test2&quot;/&gt;
    &lt;action&gt;
        ...
    &lt;/action&gt;
&lt;/test&gt;
&lt;test id=&quot;test2&quot;&gt;
    &lt;executeWhenTestPass value=&quot;test1&quot;/&gt;
    &lt;action&gt;
        ...
    &lt;/action&gt;
&lt;/test&gt;
&lt;test id=&quot;test3&quot;&gt;
    &lt;executeWhenTestFail value=&quot;test1&quot;/&gt;
    &lt;action&gt;
        ...
    &lt;/action&gt;
&lt;/test&gt;
</code></pre></div>
<p>There are obvious parallels between these mockups, only difference is one being on <code>assert</code> level and the other on <code>test</code> level. Maybe this can be generalized. I also see a lot of dependencies on the 'variables: how and where' discussion we had at the Connectathon</p>



<a name="243934211"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/274423-TestScript%20Resource/topic/Conditional%20Processing/near/243934211" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sunil Bhaskarla <a href="https://fhir.github.io/chat-archive/stream/274423-TestScript-Resource/topic/Conditional.20Processing.html#243934211">(Jun 25 2021 at 15:50)</a>:</h4>
<p><span class="user-mention" data-user-id="237342">@ryan moehrke</span>  According to <a href="http://hl7.org/fhir/testreport.html#scope">TestReport Scope and Usage</a>, "The TestReport structure mirrors the TestScript concepts of having sections for setup, tests, and teardown." Have you considered the TestReport that mirrors the TestScript loop construct idea?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
