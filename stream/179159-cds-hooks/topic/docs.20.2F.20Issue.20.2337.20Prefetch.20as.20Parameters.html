---
layout: page
title: "FHIR Chat  · docs / Issue #37 Prefetch as Parameters · cds hooks"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/index.html">cds hooks</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html">docs / Issue #37 Prefetch as Parameters</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153887240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887240">(May 05 2017 at 03:59)</a>:</h4>
<p>euvitudo opened <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>I would like to suggest that Prefetch be defined as a Parameters resource.  This way we can include any kind of resource, including OperationOutcomes, esp. for those pre-fetch requests that fail.  This would also increase the flexibility in specifying the type of parameter value (i.e., value[x], resource<br>
or part), including not limiting the parameter value to a resource.</p>
</blockquote>



<a name="153887244"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887244" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887244">(May 05 2017 at 04:10)</a>:</h4>
<p>euvitudo edited <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>I would like to suggest that Prefetch be defined as a Parameters resource.  This way we can include any kind of resource, including OperationOutcomes, esp. for those pre-fetch requests that fail.  This would also increase the flexibility in specifying the type of parameter value (i.e., value[x], resource<br>
or part), including not limiting the parameter value to a resource.</p>
</blockquote>



<a name="153887249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887249">(May 05 2017 at 04:32)</a>:</h4>
<p>euvitudo edited <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>I would like to suggest that Prefetch be defined as a Parameters resource.  This way we can include any kind of resource, including OperationOutcomes, esp. for those pre-fetch requests that fail (to possibly address a comment by <span class="user-mention" data-user-email="jmandel@gmail.com" data-user-id="9">@Josh Mandel</span> in #5 ).  This would also increase the flexibility in specifying the type of parameter value (i.e., value[x], resource<br>
or part), including not limiting the parameter value to a resource.</p>
</blockquote>



<a name="153887288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887288">(May 05 2017 at 15:55)</a>:</h4>
<p>jmandel <a href="https://github.com/cds-hooks/docs/issues/37#issuecomment-299503245" target="_blank" title="https://github.com/cds-hooks/docs/issues/37#issuecomment-299503245">commented</a> on <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>I'm not sure I follow. You're describing changes to the "request", but the desired behavior (like "including OperationOutcomes") is about the response. Could you show an example of what you mean <span class="user-mention" data-user-email="euvitudo@gmail.com" data-user-id="821">@Phillip Warner</span>? For example, could you translate the following?</p>
<p>``<br>
{<br>
  "id": "<a href="http://hooks.fhir.me:8082/cds-services/patient-hello-world" target="_blank" title="http://hooks.fhir.me:8082/cds-services/patient-hello-world">http://hooks.fhir.me:8082/cds-services/patient-hello-world</a>",<br>
  "url": "<a href="http://hooks.fhir.me:8082/cds-services/patient-hello-world" target="_blank" title="http://hooks.fhir.me:8082/cds-services/patient-hello-world">http://hooks.fhir.me:8082/cds-services/patient-hello-world</a>",<br>
  "enabled": true,<br>
  "hook": "patient-view",<br>
  "prefetch": {<br>
    "patientToGreet": "Patient/{{Patient.id}}",<br>
    "recentSBP": "Observation?patient={{Patient.id}}&amp;code=8480-6&amp;_sort:desc=date&amp;_limit=1"<br>
  }<br>
}</p>
<div class="codehilite"><pre><span></span>In this example, it&#39;s perfectly possible for the server to respond with a Patient resource for the `patientToGreet` and an OperationOutcomes if the `recentSBP` fails (or a bundle, if things work; and the bundle can also include an OperationOutcome in Bundle.entry where mode=`outcome`, if the request worked but the server has some outcome notes to share).  
~~~
</pre></div>


</blockquote>



<a name="153887290"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887290" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887290">(May 05 2017 at 15:58)</a>:</h4>
<p>(For those following along here in zuip: Note that I' updated my response in github to ask a more precise set of questions.)</p>



<a name="153887307"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887307" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887307">(May 05 2017 at 16:27)</a>:</h4>
<p>euvitudo <a href="https://github.com/cds-hooks/docs/issues/37#issuecomment-299511535" target="_blank" title="https://github.com/cds-hooks/docs/issues/37#issuecomment-299511535">commented</a> on <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>This is specifically with the request to the CDS Service.  In #5 you mention:</p>
<blockquote>
<p>CDS Services need a clear way to tell the difference between "this query wasn't run by the EHR as part of prefetch" vs. "the query was run and returned no results, or an error".</p>
</blockquote>
<p>For example (not a very good example, but it conveys the intent of the suggestion), if you have an invalid patient id (the prefetch fails on this) you then submit the following to the CDS Service:</p>
<div class="codehilite"><pre><span></span>{
  &quot;hookInstance&quot;: &quot;d1577c69-dfbe-44ad-ba6d-3e05e953b2ea&quot;,
  &quot;fhirServer&quot;: &quot;http://hooks.smarthealthit.org:9080&quot;,
  &quot;hook&quot;: &quot;patient-view&quot;,
  &quot;redirect&quot;: &quot;http://hooks2.smarthealthit.org/service-done.html&quot;,
  &quot;user&quot;: &quot;Practitioner/example&quot;,
  &quot;context&quot;: [

  ],
  &quot;patient&quot;: &quot;1288992&quot;,
  &quot;prefetch&quot;: {
    &quot;patientToGreet&quot;: {
      &quot;response&quot;: {
        &quot;status&quot;: &quot;400 Not Found&quot;
      },
      &quot;resource&quot;: {
        &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
        &quot;id&quot;: &quot;15060&quot;,
        &quot;issue&quot;: [
          {
            &quot;severity&quot;: &quot;warning&quot;,
            &quot;code&quot;: &quot;informational&quot;,
            &quot;details&quot;: {
              &quot;text&quot;: &quot;Resource request returns no results.&quot;,
              &quot;coding&quot;: [
                {
                  &quot;system&quot;: &quot;urn:oid:1.2.3.4.5&quot;,
                  &quot;code&quot;: &quot;1234&quot;,
                  &quot;display&quot;: &quot;Resource request returns no results.&quot;
                }
              ]
            }
          }
        ]
      }
    }
  }
}
</pre></div>


<p>If, however, you're using a Parameters, this would look like:</p>
<div class="codehilite"><pre><span></span>{
  &quot;hookInstance&quot;: &quot;d1577c69-dfbe-44ad-ba6d-3e05e953b2ea&quot;,
  &quot;fhirServer&quot;: &quot;http://hooks.smarthealthit.org:9080&quot;,
  &quot;hook&quot;: &quot;patient-view&quot;,
  &quot;redirect&quot;: &quot;http://hooks2.smarthealthit.org/service-done.html&quot;,
  &quot;user&quot;: &quot;Practitioner/example&quot;,
  &quot;context&quot;: [

  ],
  &quot;patient&quot;: &quot;1288992&quot;,
  &quot;prefetch&quot;: {
    &quot;resourceType&quot;: &quot;Parameters&quot;,
    &quot;parameter&quot;: [
      {
        &quot;name&quot;: &quot;patientToGreet&quot;,
        &quot;resource&quot;: {
          &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
          &quot;id&quot;: &quot;15060&quot;,
          &quot;issue&quot;: [
            {
              &quot;severity&quot;: &quot;warning&quot;,
              &quot;code&quot;: &quot;informational&quot;,
              &quot;details&quot;: {
                &quot;text&quot;: &quot;Resource request returns no results.&quot;,
                &quot;coding&quot;: [
                  {
                    &quot;system&quot;: &quot;urn:oid:1.2.3.4.5&quot;,
                    &quot;code&quot;: &quot;1234&quot;,
                    &quot;display&quot;: &quot;Resource request returns no results.&quot;
                  }
                ]
              }
            }
          ]
        }
      }
    ]
  }
}
</pre></div>


<p>Using this, a CDS Service can use a well-known format for understanding the failed prefetch operation and take appropriate action.</p>
<p>As a further note, the Discovery might look like this:</p>
<div class="codehilite"><pre><span></span>{
  &quot;services&quot;: [
    {
      &quot;hook&quot;: &quot;patient-view&quot;,
      &quot;name&quot;: &quot;Static CDS Service Example&quot;,
      &quot;description&quot;: &quot;An example of a CDS service that returns a static set of cards&quot;,
      &quot;id&quot;: &quot;static-patient-greeter&quot;,
      &quot;prefetch&quot;: {
        &quot;resourceType&quot;: &quot;Parameters&quot;,
        &quot;parameter&quot;: [
          {
            &quot;name&quot;: &quot;patientToGreet&quot;,
            &quot;valueString&quot;: &quot;Patient/{{Patient.id}}&quot;
          },
          {
            &quot;name&quot;: &quot;medications&quot;,
            &quot;valueString&quot;: &quot;MedicationOrder?patient={{Patient.id}}&quot;
          }
        ]
      }
    }
  ]
}
</pre></div>


</blockquote>



<a name="153887311"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887311" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887311">(May 05 2017 at 16:42)</a>:</h4>
<p>jmandel <a href="https://github.com/cds-hooks/docs/issues/37#issuecomment-299514979" target="_blank" title="https://github.com/cds-hooks/docs/issues/37#issuecomment-299514979">commented</a> on <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>Thanks - I see what you're describing now! Could you help me understand what you see as the benefits of this approach?</p>
</blockquote>



<a name="153887316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887316">(May 05 2017 at 18:10)</a>:</h4>
<p>euvitudo <a href="https://github.com/cds-hooks/docs/issues/37#issuecomment-299536267" target="_blank" title="https://github.com/cds-hooks/docs/issues/37#issuecomment-299536267">commented</a> on <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<ul>
<li>Using Parameters is similar with the current prefetch definition (discovery and request) specified in the existing CDS Hooks API, and provides a richer set of semantics for reasoning about potential errors, empty responses, etc.</li>
<li>The ability to explicitly convey a datatype, a Resource, or a multi-part parameter; explicit types are easier to reason about.</li>
<li>It is more consistent with Clinical Reasoning, as they use Parameters to pass input.</li>
</ul>
</blockquote>



<a name="153887319"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887319" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887319">(May 05 2017 at 18:41)</a>:</h4>
<p>jmandel <a href="https://github.com/cds-hooks/docs/issues/37#issuecomment-299544238" target="_blank" title="https://github.com/cds-hooks/docs/issues/37#issuecomment-299544238">commented</a> on <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>OK. For history here: we used to use Parameters for _all CDS Hooks operations_, and after careful evaluation, we decided they were verbose and not providing a lot of value...</p>
</blockquote>



<a name="153887320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887320">(May 05 2017 at 18:48)</a>:</h4>
<p>kpshek <a href="https://github.com/cds-hooks/docs/issues/37#issuecomment-299545933" target="_blank" title="https://github.com/cds-hooks/docs/issues/37#issuecomment-299545933">commented</a> on <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>Thanks for the additional details <span class="user-mention" data-user-email="euvitudo@gmail.com" data-user-id="821">@Phillip Warner</span>.</p>
<p><span class="user-mention" data-user-email="jmandel@gmail.com" data-user-id="9">@Josh Mandel</span> is correct that we haven't used the Parameters resource, having made this change a year ago.</p>
<p>Regarding Clinical Reasoning, @brynrhodes, <span class="user-mention" data-user-email="isaacvetter@gmail.com" data-user-id="558">@Isaac Vetter</span>, and myself have been working together for the past several months to see how we can better align both projects. We'll be posting a write-up for our proposals to the two communities for feedback which aims to address your comment on the two projects.</p>
<p>As an aside, and I know you called this out as not a good example <img alt="😛" class="emoji" src="/static/generated/emoji/images/emoji/unicode/1f61b.png" title="😛">, but we should never see a 404 on a patient prefetch for a patient-view hook. Since the EHR is in complete control in this use case, not finding the patient whose chart the clinician just opened would be a major issue.</p>
</blockquote>



<a name="153887321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/docs%20/%20Issue%20%2337%20Prefetch%20as%20Parameters/near/153887321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/docs.20.2F.20Issue.20.2337.20Prefetch.20as.20Parameters.html#153887321">(May 05 2017 at 18:50)</a>:</h4>
<p>kpshek edited <a href="https://github.com/cds-hooks/docs/issues/37" target="_blank" title="https://github.com/cds-hooks/docs/issues/37">Issue #37</a></p>
<blockquote>
<p>I would like to suggest that Prefetch (in CDS Request) be defined as a Parameters resource.  This way we can include any kind of resource, including OperationOutcomes, esp. for those pre-fetch requests that fail (to possibly address a comment by <span class="user-mention" data-user-email="jmandel@gmail.com" data-user-id="9">@Josh Mandel</span> in #5 ).  This would also increase the flexibility in specifying the type of parameter value (i.e., value[x], resource<br>
or part), including not limiting the parameter value to a resource.</p>
</blockquote>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
