---
layout: page
title: "FHIR Chat  · standard algorithm to calculate age in years, months, weeks? · cds hooks"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/index.html">cds hooks</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html">standard algorithm to calculate age in years, months, weeks?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="243064400"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243064400" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge de la Garza <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243064400">(Jun 17 2021 at 18:41)</a>:</h4>
<p>Hi, I have a CDS Hooks server that allows authors of services to specify rule logic that refers to the patient's age in different units.  For example, "If the patient is older than 40 years..." or "If the patient is younger than 18 weeks...", etc.  So I have to be able to calculate the patient's age in different units given their DOB.  In a majority of cases I would expect this to be straightforward, but there are some corner cases where perhaps I could come up with something reasonable, but I'm wondering if there is a recommended standard algorithm to do this.  Some of the cases I'm thinking of are:<br>
-Leap day birthdays. For the purpose of calculating their age, should I treat their birthday on non-leap years as though it were March 1?<br>
-How to calculate age in months. Does the age in months increment on the date anniversary of birth? i.e., if someone is born on 1/15, do they become one month old on 2/15, two months on 3/15, etc? If so, then how to handle birthdays on dates that are not common to all months (29, 30, 31)? Alternatively, I could treat a month as 30 days and calculate based on that, but then 12 months wouldn't add up to a year.</p>
<p>More than answers to these particular questions, I'm wondering if there is an algorithm that HL7 either "owns" or recommends to calculate age.</p>



<a name="243065165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243065165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243065165">(Jun 17 2021 at 18:46)</a>:</h4>
<p>The CQL specification considers Age a duration calculation, and specifies ISO-3601 compliant rules for that calculation: <a href="https://cql.hl7.org/05-languagesemantics.html#timing-calculations">https://cql.hl7.org/05-languagesemantics.html#timing-calculations</a></p>



<a name="243065371"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243065371" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243065371">(Jun 17 2021 at 18:48)</a>:</h4>
<p>And a grundle of examples of calculating durations: <a href="https://cql.hl7.org/15-h-timeintervalcalculations.html">https://cql.hl7.org/15-h-timeintervalcalculations.html</a></p>



<a name="243073176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243073176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243073176">(Jun 17 2021 at 19:42)</a>:</h4>
<p>Does it correctly handle TZ offset? ;-).    What if someone was born in the UK (00:00 offset) and they now live in the US (EDT - 04:00 offset); does the CQL duration logic handle that or does it normalize the date/times to UTZ before doing the Age calculation?</p>



<a name="243074560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243074560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge de la Garza <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243074560">(Jun 17 2021 at 19:52)</a>:</h4>
<p>From section 2 (Calculating Duration in Months) in the examples Bryn linked to, we have:<br>
"A month in CQL is defined as the duration of any time interval which starts at a certain time of day at a certain calendar day of the calendar month and ends at:<br>
-The same time of day at the same calendar day of the ending calendar month, if it exists<br>
-The same time of day at the immediately following calendar date of the ending calendar month, if the same calendar date of the ending month in the ending year does not exist."<br>
What I think the second bullet is saying is that if a person is born on, for example, 3/31, then that person becomes one month old on 5/1 because there is no 4/31.  And then they would become two months old on 5/31.  Am I understanding that correctly?</p>



<a name="243086834"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243086834" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243086834">(Jun 17 2021 at 21:22)</a>:</h4>
<p>Yes, that's correct</p>



<a name="243087303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243087303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243087303">(Jun 17 2021 at 21:27)</a>:</h4>
<p>As far as timezones, first, they only apply if doing calculations with DateTime values; calculations on Date values don't consider timezones. Second, the spec says generally that when doing calculations with DateTime values, timezone offsets should be normalized, but only when the comparison precision is hours or below (i.e. a time precision). So if I'm asking about duration in months, the two dates should not be normalized to the same timezone offset, but if I'm asking about age in minutes or hours, the dates should be normalized to the same timezone offset.</p>



<a name="243104117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243104117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243104117">(Jun 18 2021 at 00:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  - even when doing month diffs the TZ offset matters if the 2 date/times aren't normalized to the same timezone, e.g. GMT (00:00).  [There are corner-cases where you can get an 'off by one' error.]  Of course birthDate is only a Date but for systems that use the birthDateTime extension TZ needs to be taken into account.</p>



<a name="243362044"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243362044" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243362044">(Jun 21 2021 at 10:13)</a>:</h4>
<p>I'd also expect that to be an opt in consideration for that. The number of cases where the time from that extension would be relevant would be very slim, and during those first few days. When you're into months area the date would be the expectation behaviour, and localizing the difference would be a surprising result.</p>



<a name="243396689"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243396689" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243396689">(Jun 21 2021 at 15:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> - I suppose the birthDateTime extension isn't used that frequently, but when it is, e.g. neonatal care, it is very important.  Typically in that environment hours are important, then days, weeks,  etc.</p>



<a name="243678254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/standard%20algorithm%20to%20calculate%20age%20in%20years%2C%20months%2C%20weeks%3F/near/243678254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge de la Garza <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/standard.20algorithm.20to.20calculate.20age.20in.20years.2C.20months.2C.20weeks.3F.html#243678254">(Jun 23 2021 at 16:37)</a>:</h4>
<p>So ideally, a patient's DOB would always be precise to at least the date (yyyy-mm-dd), but because patient.birthDate is of type "date", it can also be given as "yyyy-mm" or "yyyy". When patient.birthDate is less precise than yyyy-mm-dd, how shall age be calculated?  From reading through this link:<br>
<a href="https://cql.hl7.org/05-languagesemantics.html">https://cql.hl7.org/05-languagesemantics.html</a><br>
(particularly section 5), it seems the CQL way to look at this is if, for example, a patient's birthdate is given as simply "1956", then their age in years on today's date, 2021-06-23, would be "[64,65]", which means that there is uncertainty as to whether their age is 64 or 65.  Even though there is uncertainty in the patient's age, some comparisons can still be resolved with certainty, for example, "[64,65] &gt; 18" would be true and "[64,65] &gt; 85" would be false.  However, for certain values on the right side of the inequality, the comparison evaluates to "unknown (null)", for example, "[64,65] &gt;= 65".<br>
But as a practical matter, when my rule engine evaluates the condition, "The patient is 65 or older," it needs a result. Should I just treat an imprecise date as the first date in the specified period?  So "1956" would be treated as though it were "1956-01-01".  This would assure that "older than" conditions that are in the range of uncertainty would always return true, which is probably a good thing.  But the flip side of this is that "younger than" conditions in the range of uncertainty would always return false.  For example if the patient.birthDate is "2003" and the condition is, "The patient is under 18".  If I treat "2003" as "2003-01-01", then the condition will never be true after 2020, even though there is most likely a period in 2021 when the patient is under 18.<br>
Perhaps what I should do is, when a comparison involving imprecise dates would return "unknown (null)", then for the purpose of evaluating the conditions of a rule, treat that as "true".  So if patient.birthDate is "1956", then the condition "The patient is 65 or older" would be true, and if patient.birthDate is "2003", then the condition "The patient is under 18" would also be true.  Any thoughts?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
