---
layout: page
title: "FHIR Chat  · Prefetch Data and subsequent invocations · cds hooks"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/index.html">cds hooks</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html">Prefetch Data and subsequent invocations</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153923384"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923384" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wolfgang Wiessler <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923384">(Dec 07 2017 at 15:41)</a>:</h4>
<p>Hello,</p>
<p>are we required to send the prefetch data with every invocation of the hook instance? So far I have interpreted it that prefetch data needs to be sent with the first invocation of a hook instance. When we invoke it again (e.g. after the CDS service/app redirects back to the EHR), are we expected to provide the prefetch data again?</p>



<a name="153923441"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923441" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Shekleton <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923441">(Dec 07 2017 at 18:35)</a>:</h4>
<p>Hi Wolfgang! Prefetch is an optional aspect of the CDS Service request and the EHR is not obligated to honor any prefetch requests. From our <a href="http://cds-hooks.org/specification/1.0" target="_blank" title="http://cds-hooks.org/specification/1.0">specification</a>:</p>
<p>"An EHR may choose to honor some or all of the desired prefetch templates from an appropriate source."</p>
<p>"It is the CDS Service's responsibility to check to see what prefetched data was satisfied (if any) and manually retrieve any necessary data. If the CDS Service is unable to obtain required data because it cannot access the FHIR server and the request did not contain the necessary pre-fetch keys; the service shall respond with an HTTP 412 Precondition Failed status code."</p>



<a name="153923678"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923678" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wolfgang Wiessler <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923678">(Dec 08 2017 at 09:20)</a>:</h4>
<p>Hi Kevin! That is what I thought. I am currently building our CDS framework implementation and I am testing it against the CDS Sandbox services. Those services are rejecting requests that do not have the matching prefetch. My assumption was that they are not 100% up to spec and I wanted to make sure that this is indeed the case or if services should reject requests if the expected prefetch data is not there.</p>



<a name="153923703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923703">(Dec 08 2017 at 11:57)</a>:</h4>
<p>I was not aware that not caching this data was not up to spec?</p>



<a name="153923802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Shekleton <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923802">(Dec 08 2017 at 19:21)</a>:</h4>
<p><span class="user-mention" data-user-id="194405">@Wolfgang Wiessler</span> - That is correct that those CDS Services that are bundled with our Sandbox assume the prefetched data is always present. <span class="user-mention" data-user-id="192599">@Zach Plata</span> is actually re-writing those CDS Services now and as part of that work, he is changing them to gracefully handle the scenario in which case the prefetched data is not present :)</p>



<a name="153923803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Shekleton <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923803">(Dec 08 2017 at 19:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> - Where are you getting the caching questions from?</p>



<a name="153923808"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923808" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923808">(Dec 08 2017 at 20:19)</a>:</h4>
<p>just from what is above</p>



<a name="153923889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Shekleton <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923889">(Dec 09 2017 at 13:06)</a>:</h4>
<p>I’m sorry, I’m not following. I don’t see any references to caching in this thread</p>



<a name="153923964"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153923964" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153923964">(Dec 09 2017 at 21:35)</a>:</h4>
<p>the notion above is that you should only need to send the pre-fetch data with the first invocation of a hookInstance. And any casual reader would conclude, from the thread, that if a cds service does not do this, it's not up to spec.</p>
<p>But the spec never says that this is an expectation, and it's a <em>hard</em> expectation, since there's no 'done with a hook' call for a CDS service to stop remembering the context. I think there should be more clarity around this</p>



<a name="153924478"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153924478" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wolfgang Wiessler <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153924478">(Dec 12 2017 at 11:24)</a>:</h4>
<p>To summarize:<br>
- The prefetch queries are not mandatory. A CDS Service can ask for that data upon invocation, but it is not guaranteed that the data will be there<br>
- The EHR decides whether to fulfill the prefetch requests (in full or partially)<br>
- The CDS Service is expected to gracefully deal with missing data: 1. Try querying the data via the FHIR API (if available); 2. If the CDS Service cannot get the data, return a proper response (e.g. empty cards array or an info card) </p>
<p>In our case the CDS Service would just return an App Link Card and the app will not have any data pre-filled.</p>
<p>I suppose the "caching" aspect could come in when we only send the prefetch on the first invocation. Then the CDS Service needs to cache that data if it needs it in subsequent requests or it needs to query it again. </p>
<p>To me, sending prefetch (only) makes sense on the first invocation, since this is where you are setting the context of the interaction and kick-start the service. Most subsequent calls are for getting the status/results from the CDS Service after user interaction.</p>



<a name="153929368"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153929368" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153929368">(Jan 17 2018 at 23:42)</a>:</h4>
<p>Is there any way that a client can find out in advance what FHIR queries a service is likely to make of it? the 'definition' returned by the discovery has a prefetch, but that is not necessarily all the data that a service might want from the client (is it?).  It would be nice to look at the definition to understand what data it is expecting to get from the client...</p>



<a name="153929446"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153929446" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Shekleton <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153929446">(Jan 18 2018 at 17:39)</a>:</h4>
<p>We don't have this in CDS Hooks today, no.</p>



<a name="153929447"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153929447" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Shekleton <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153929447">(Jan 18 2018 at 17:39)</a>:</h4>
<p>This question has come up before and you could take this same question and ask it regarding SMART apps, too.</p>



<a name="153929530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Prefetch%20Data%20and%20subsequent%20invocations/near/153929530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brett Esler <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Prefetch.20Data.20and.20subsequent.20invocations.html#153929530">(Jan 18 2018 at 22:55)</a>:</h4>
<p>perhaps a statement of SMART on FHIR scopes that may be needed and list of profile URIs the CDS relies on?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
