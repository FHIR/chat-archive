---
layout: page
title: "FHIR Chat  · FHIR Sandbox Integrations · cds hooks"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/index.html">cds hooks</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html">FHIR Sandbox Integrations</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153904656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153904656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153904656">(Sep 06 2017 at 15:40)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191355">@Kevin Shekleton</span> <span class="user-mention" data-user-id="192599">@Zach Plata</span> <span class="user-mention" data-user-id="196023">@Amy Ballard</span> <span class="user-mention" data-user-id="192232">@Rick Freeman</span> <br>
Is the CDS-Hooks Sandbox as a SMART App deployed to an environment where we can try launching it?</p>



<a name="153904657"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153904657" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153904657">(Sep 06 2017 at 15:42)</a>:</h4>
<p>Also, would you like the CDS-Hooks Sandbox to use a static client-id, or would you like the HSPC Sandbox to create a registration and provide you with a client-id for our system?</p>



<a name="153904658"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153904658" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Shekleton <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153904658">(Sep 06 2017 at 16:07)</a>:</h4>
<p><span class="user-mention" data-user-id="192233">@Travis Cummings</span> - Here's the PR in review: <a href="https://github.com/cerner/cds-hooks-sandbox/pull/24" target="_blank" title="https://github.com/cerner/cds-hooks-sandbox/pull/24">https://github.com/cerner/cds-hooks-sandbox/pull/24</a></p>



<a name="153904804"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153904804" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Amy Ballard <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153904804">(Sep 07 2017 at 14:23)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> I'm launching CDS-Hooks against your Heroku deployment. It launches using the SMART of FHIR auth flow. After it gets the token, I see, in Developer Tools, that it queries the SMART open endpoint, <a href="https://sb-fhir-dstu2.smarthealthit.org/api/smartdstu2/open/Patient/SMART-1288992" target="_blank" title="https://sb-fhir-dstu2.smarthealthit.org/api/smartdstu2/open/Patient/SMART-1288992">https://sb-fhir-dstu2.smarthealthit.org/api/smartdstu2/open/Patient/SMART-1288992</a>, and then it queries the patient I launched with and my FHIR server <a href="http://localhost:8071/dstu2/data/Patient/SMART-665677" target="_blank" title="http://localhost:8071/dstu2/data/Patient/SMART-665677">http://localhost:8071/dstu2/data/Patient/SMART-665677</a>. Is this expected behavior?</p>



<a name="153905088"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153905088" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153905088">(Sep 09 2017 at 04:56)</a>:</h4>
<p><span class="user-mention" data-user-id="196023">@Amy Ballard</span> Yes, the Sandbox executes queries to a default patient and calls the services (these have been executed via commands that were triggered globally on a few JS files, so they execute on page load). You can ignore the first calls for now to 1288992. Soon we will work on re-factoring the Sandbox in it's entirety and the issue should be resolved.</p>



<a name="153905148"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153905148" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153905148">(Sep 09 2017 at 14:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191355">@Kevin Shekleton</span> <span class="user-mention" data-user-id="192599">@Zach Plata</span> I'm here at the FHIR connectathon.  Is this something we can work on today?</p>



<a name="153905154"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153905154" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153905154">(Sep 09 2017 at 15:51)</a>:</h4>
<p>Here's the client ID for the Sandbox: 48163c5e-88b5-4cb3-92d3-23b800caa927</p>



<a name="153909395"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153909395" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153909395">(Sep 20 2017 at 18:29)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> Would you like to keep using the client ID above, or move to a well-known id like "cds-hooks-sandbox"?</p>



<a name="153911004"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153911004" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153911004">(Sep 27 2017 at 14:35)</a>:</h4>
<p><span class="user-mention" data-user-id="192233">@Travis Cummings</span> Sorry for the delay! I think the well-known ID you mentioned would be good. We'll have to make this change in the launch endpoint, and can coordinate changing it in the default HSPC app about the same time. Is this default app already available to everyone?</p>



<a name="153911280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153911280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153911280">(Sep 28 2017 at 17:08)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> Yes the default app is already available.  We can change the client_id associated with it when you are ready with the sandbox integration.</p>



<a name="153911477"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153911477" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153911477">(Sep 29 2017 at 13:29)</a>:</h4>
<p>Great, thanks <span class="user-mention" data-user-id="192233">@Travis Cummings</span> ! We'll let you know when the PR is out to change that client_id and we can coordinate the switch.</p>



<a name="153912203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153912203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153912203">(Oct 04 2017 at 02:31)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> I've been seeing inconsistent launches of the CDS Hooks Sandbox from the HSPC sandbox.  It seems to sometimes load the proper patient (ex: Baby Bili) then very quickly flashes over to Daniel Adams.</p>



<a name="153912204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153912204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153912204">(Oct 04 2017 at 02:33)</a>:</h4>
<p><a href="/user_uploads/10155/dtQCbCFdmsbptiYA7s-2t7fP/CDSHooksLaunch.png" target="_blank" title="CDSHooksLaunch.png">CDSHooksLaunch.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/dtQCbCFdmsbptiYA7s-2t7fP/CDSHooksLaunch.png" target="_blank" title="CDSHooksLaunch.png"><img src="/user_uploads/10155/dtQCbCFdmsbptiYA7s-2t7fP/CDSHooksLaunch.png"></a></div>



<a name="153912205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153912205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153912205">(Oct 04 2017 at 02:33)</a>:</h4>
<p>Other timers it shows Daniel Adams then quickly flashes to the launched patient, Baby Bili.</p>



<a name="153912266"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153912266" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153912266">(Oct 04 2017 at 14:08)</a>:</h4>
<p><span class="user-mention" data-user-id="192233">@Travis Cummings</span> Thanks for bringing this up. I'll take a look today</p>



<a name="153913369"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153913369" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153913369">(Oct 10 2017 at 19:24)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> Have you detected any issue with the patient that is displayed when the CDS Hooks sandbox is launched from the HSPC Sandbox?</p>



<a name="153913377"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153913377" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153913377">(Oct 10 2017 at 20:36)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> Can you let me know, when the CDS Hooks sandbox is launched from the HSPC sandbox, does the CDS Hooks sandbox send the access token to the subsequent CDS Hooks services?  Do they all share the same token or how do the services get access to the HSPC sandbox instance?</p>



<a name="153913379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153913379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153913379">(Oct 10 2017 at 20:59)</a>:</h4>
<p><span class="user-mention" data-user-id="192233">@Travis Cummings</span> I haven't noticed any issues launching the CDS Hooks Sandbox from the HSPC Sandbox on my end. What are you seeing? The inconsistent launch of that Baby Bili issue?</p>
<p>And yes, the CDS Hooks Sandbox sends the access token to services via the fhirAuthorization parameter in the request. All services hooked up will receive the same token (the token the CDS Hooks Sandbox receives, and just passes along, for now).</p>



<a name="153913380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153913380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153913380">(Oct 10 2017 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> I haven't seen the inconsistent patient display today in 5 or 6 launches.  If it happens again, I'll try to use the "change patient" menu and see if I can get bilibaby to show properly.</p>



<a name="153913398"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153913398" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153913398">(Oct 10 2017 at 22:26)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> Do you think the CDS Hooks-HSPC Sandbox integration is something we can demo at the next Argonaut CDS Hooks Team Meeting?  If so, need to do a little work on the HSPC side to make sure the bilirubin cds service and bilirubin app are working together.</p>



<a name="153914769"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153914769" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153914769">(Oct 18 2017 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="192233">@Travis Cummings</span> I'm not on the email chain that gets sent the meeting invites, but you are more than welcome to demo that at the next Argonaut meeting. Please let me know if you encounter any patient/service patient name mismatch leading up to it.</p>



<a name="153914782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153914782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153914782">(Oct 19 2017 at 00:13)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> <span class="user-mention" data-user-id="191355">@Kevin Shekleton</span> <span class="user-mention" data-user-id="192600">@Matt Henkes</span> It seems like the next easiest integration would be for the HSPC sandbox to pass a custom launch parameter that contains context info for the CDS-Hooks sandbox.  I think the first context item would be the a CDS-Hooks service discovery endpoint the CDS-Hooks sandbox can add to the "Select a Service:" box.  This could either be in the form of an action/command or a declaration, singular or plural:</p>
<p>"add_cds_service_discovery_endpoint": "<a href="https://example.com/cds-services" target="_blank" title="https://example.com/cds-services">https://example.com/cds-services</a>"</p>
<p>"cds_service_discovery_endpoint": "<a href="https://example.com/cds-services" target="_blank" title="https://example.com/cds-services">https://example.com/cds-services</a>"</p>
<p>"cds_service_discovery_endpoints": [{"https://example.com/cds-services"}]</p>
<p>Or, what would you like to see?</p>



<a name="153915470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153915470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153915470">(Oct 23 2017 at 17:19)</a>:</h4>
<p><span class="user-mention" data-user-id="192233">@Travis Cummings</span>  Is there any update on the HSPC end for implementing the API for SMART app launches registered from an HSPC sandbox for the CDS Hooks Sandbox? Curious on your thoughts for that specific proposal, as I'm hoping to figure out what this might look like for working on next.</p>



<a name="153917275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917275">(Nov 02 2017 at 06:29)</a>:</h4>
<p><span class="user-mention" data-user-id="192599">@Zach Plata</span> Here is a rough draft on how I think the app launch could work.  Basically the CDS-hook service would return an app link card that contained the URL of the target app.  The CDS-Hooks sandbox would receive that link card and show a button.  When the user clicked the button, the cds-hooks sandbox would send a smart launch request (not a formal smart-on-fhir launch) to the HSPC Sandbox's smart launch invocation endpoint (a new endpoint) with the fhir_url, the open_id token, and the launch url of the app.  The HSPC sandbox would then figure out if a registered app matched the launch url, and perform a persona-launch (launching for a persona user).</p>



<a name="153917276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917276">(Nov 02 2017 at 06:29)</a>:</h4>
<p><a href="/user_uploads/10155/EN6Y7UZ9qDKe0sXzDbKBdxwj/CDS-Hooks-Components.png" target="_blank" title="CDS-Hooks-Components.png">CDS-Hooks-Components.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/EN6Y7UZ9qDKe0sXzDbKBdxwj/CDS-Hooks-Components.png" target="_blank" title="CDS-Hooks-Components.png"><img src="/user_uploads/10155/EN6Y7UZ9qDKe0sXzDbKBdxwj/CDS-Hooks-Components.png"></a></div>



<a name="153917330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917330">(Nov 02 2017 at 15:59)</a>:</h4>
<p><span class="user-mention" data-user-id="192233">@Travis Cummings</span> Thanks for that flow chart! To clarify, when the Sandbox calls the new HSPC launch endpoint, will the Sandbox get the launch code back, so it can trigger the app launch itself? It looks like HSPC is doing the coordination of the app launch on that bottom half of the picture. Also, is there an estimated time on when this new endpoint from HSPC would be available?</p>



<a name="153917496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917496">(Nov 02 2017 at 22:34)</a>:</h4>
<p>I had thought that the CDS Hooks sandbox would ask the HSPC sandbox to launch the app.  Are you proposing the CDS Hooks sandbox registers a launch context with the HSPC sandbox (receiving back a launch code), then just opens the app by passing along the launch code?</p>



<a name="153917497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917497">(Nov 02 2017 at 23:02)</a>:</h4>
<p>If the cds hooks sandbox wants to create the launch context and perform the smart launch, then the cds hooks sandbox would be acting basically like the HSPC's "Sandbox Manager" tool.  </p>
<p>In this case, the process is:<br>
1) the Sandbox Manager creates a launch context (app to launch, params, issuer, launch details, etc)<br>
2) the Sandbox Manager creates a launch code ("key") <br>
3) the Sandbox Manager registers the launch context with the issuer (fhir server) at the endpoint iss + '/_services/smart/Launch' using a POST<br>
4) the Sandbox Manager receives the context back from the registration call and adds it to the windows local storage indexed by the launch code ("key") so the opening window (for the app) can find it (opened with a param ?key=...}</p>



<a name="153917498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917498">(Nov 02 2017 at 23:04)</a>:</h4>
<p>You can see this all in action here:</p>
<p><a href="https://bitbucket.org/hspconsortium/sandbox-manager/raw/ade67887c41d42d0a8d8645ca8057a8443c87371/src/static/js/services.js" target="_blank" title="https://bitbucket.org/hspconsortium/sandbox-manager/raw/ade67887c41d42d0a8d8645ca8057a8443c87371/src/static/js/services.js">https://bitbucket.org/hspconsortium/sandbox-manager/raw/ade67887c41d42d0a8d8645ca8057a8443c87371/src/static/js/services.js</a></p>
<p>In the "factory('launchApp'..." starting at 1925.</p>



<a name="153917499"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917499" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917499">(Nov 02 2017 at 23:05)</a>:</h4>
<p>Note the call to registerContext().  registerContext is defined on line 621 and looks like this:</p>
<div class="codehilite"><pre><span></span>    registerContext: function (app, params, issuer) {
        var deferred = $.Deferred();

        var reqLaunch = fhirClient.authenticated({
            url: issuer + &#39;/_services/smart/Launch&#39;,
            type: &#39;POST&#39;,
            contentType: &quot;application/json&quot;,
            data: JSON.stringify({
                client_id: app.authClient.clientId,
                parameters: params
            })
        });

        $.ajax(reqLaunch)
            .done(deferred.resolve)
            .fail(deferred.reject);
        return deferred;
    }
</pre></div>



<a name="153917500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917500">(Nov 02 2017 at 23:13)</a>:</h4>
<p><span class="user-mention" data-user-id="192233">@Travis Cummings</span> Ah, I should've looked more closely at the first message, that this would not be a formal smart-on-fhir launch. I originally thought the new API would return the opaque launch context for the launch parameter, and the sandbox would append the FHIR server on the iss parameter to launch the app, from the control of the Sandbox.</p>



<a name="153917501"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917501" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917501">(Nov 02 2017 at 23:19)</a>:</h4>
<p>I assume the cds hooks sandbox needs to be able to smart-launch apps when not being launched from the hspc sandbox?</p>



<a name="153917502"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917502" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917502">(Nov 02 2017 at 23:28)</a>:</h4>
<p>Right, and as of right now, if the cds hooks sandbox is launched securely, like through HSPC sandbox, I'm not aware if the secure SMART app launch has been nailed down yet, beyond this case.</p>



<a name="153917505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917505">(Nov 02 2017 at 23:49)</a>:</h4>
<p>To launch an app, the HSPC Sandbox Manager creates a launch context and key (launch code), and then posts it to the iss.  The iss then posts it to the auth server.  The Sandbox Manager then gets back the launch context and opens the app.  It looks like this:</p>



<a name="153917506"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917506" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917506">(Nov 02 2017 at 23:50)</a>:</h4>
<p><a href="/user_uploads/10155/KliMJ8Me53SBKLYJhaTdbr6x/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/KliMJ8Me53SBKLYJhaTdbr6x/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/KliMJ8Me53SBKLYJhaTdbr6x/pasted_image.png"></a></div>



<a name="153917507"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917507" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917507">(Nov 02 2017 at 23:54)</a>:</h4>
<p>I think the cds-hooks sandbox has two options.</p>
<p>1) act like the HSPC Sandbox Manager and create and register the launch context, then open the app</p>
<p>2) delegate launching the app to the HSPC Sandbox Manager (just tell the HSPC Sandbox Manager to launch the app)</p>



<a name="153917509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917509">(Nov 03 2017 at 00:02)</a>:</h4>
<p>For #2, we would probably pass into the CDS Hooks sandbox a extra launch parameter like "smart_launch_delegate=http://...".  Then when a smart app link is clicked, the CDS Hooks sandbox would post to the delegate everything it knew (the app link, the iss, the access token, the user token).</p>



<a name="153917510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917510">(Nov 03 2017 at 00:04)</a>:</h4>
<p>Is there a different option you are think of?  The first option is available right now, the second option would take some work on our side to build the delegate launch stuff.  I could help you with the first option by a pull request if that helped out.</p>



<a name="153917511"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917511" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917511">(Nov 03 2017 at 00:09)</a>:</h4>
<p>Ah, that smart_launch_delegate part was what I was looking for. So when the CDS Hooks Sandbox is launched from HSPC, along with the access token and such, it should retrieve this smart_launch_delegate url, to which the CDS Hooks Sandbox would post to with relevant data.</p>



<a name="153917512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zach Plata <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917512">(Nov 03 2017 at 00:11)</a>:</h4>
<p>I think #2 would be a good option, whenever that is ready. <span class="user-mention" data-user-id="191355">@Kevin Shekleton</span> thoughts on this?</p>



<a name="153917669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917669">(Nov 04 2017 at 18:44)</a>:</h4>
<p>I think the key requirements are:<br>
1. Ensure that the CDS Hooks Sandbox can launch apps (via "App Link") in a way that looks, to the app, exactly like a norma SMART Launch.<br>
2. Ensure that the CDS Hooks Sandbox connects to an underlying clinical data sandbox (like the HSPC or SMART sandbox) through a well-specified protocol, so that anyone can implement another clinical data sandbox and it stays compatible.</p>



<a name="153917670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917670">(Nov 04 2017 at 18:44)</a>:</h4>
<p>I think a non-goal is: making the CDS Hooks sandbox work in front of production EHRs to protect real data.</p>



<a name="153917671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917671">(Nov 04 2017 at 18:46)</a>:</h4>
<p>Given these requirements: my preferred solution is to continue defining a "sandbox launch API" like Travis suggests in #1, and making sure the inputs/outputs are clearly specified. (We did this back when we created the initial SMART auth server; I think that work may have persisted to this day, but it'd be good to double-check. <span class="user-mention" data-user-id="192233">@Travis Cummings</span>  is the protocol in your diagram documented?)</p>



<a name="153917672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917672">(Nov 04 2017 at 18:49)</a>:</h4>
<p>(I prefer #1 because:</p>
<ul>
<li>it leverages an existing protocol and</li>
<li>it gives components like the CDS Hooks sandbox more control -- e.g. you can generate a few launch ids in parallel to anticipate different user choices and speed up the process.</li>
<li>it's very easy for a client to simulate the behavior of #2 if it has access to the API for #1 — but the other direction is not possible.<br>
)</li>
</ul>



<a name="153917880"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917880" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917880">(Nov 06 2017 at 20:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> : <span class="user-mention" data-user-id="192599">@Zach Plata</span> and I met on Friday and talked through some options.  We thought first that the system launching the CDS Hooks sandbox should pass in a "launch registration endpoint" as a launch parameter.  Otherwise the CDS Hooks sandbox would either have to use the issuer or the launch requestor address.</p>



<a name="153917884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917884">(Nov 06 2017 at 20:56)</a>:</h4>
<p>I'm having some doubts.  I'm thinking the endpoint should actually be in the iss server now.  This is for a couple reasons, but mostly because the CDS Hooks sandbox already has an access token to that server.  In that case, there is no "launch registration endpoint" value passed to the CDS Hooks sandbox because it is a well-known endpoint on the iss.  For example, smart/launch-registration or something like that.</p>



<a name="153917888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917888">(Nov 06 2017 at 21:48)</a>:</h4>
<p>(deleted)</p>



<a name="153917889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917889">(Nov 06 2017 at 21:49)</a>:</h4>
<p><a href="/user_uploads/10155/KRCuQDgBkugqy9IfuoG3tl4w/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/KRCuQDgBkugqy9IfuoG3tl4w/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/KRCuQDgBkugqy9IfuoG3tl4w/pasted_image.png"></a></div>



<a name="153917890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917890">(Nov 06 2017 at 22:44)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> <span class="user-mention" data-user-id="192599">@Zach Plata</span> Here is a confluence page we can collaborate on:</p>



<a name="153917891"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153917891" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153917891">(Nov 06 2017 at 22:44)</a>:</h4>
<p><a href="https://healthservices.atlassian.net/wiki/spaces/HSPC/pages/119734296/Registering+a+Launch+Context" target="_blank" title="https://healthservices.atlassian.net/wiki/spaces/HSPC/pages/119734296/Registering+a+Launch+Context">https://healthservices.atlassian.net/wiki/spaces/HSPC/pages/119734296/Registering+a+Launch+Context</a></p>



<a name="153930526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/FHIR%20Sandbox%20Integrations/near/153930526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Travis Cummings <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/FHIR.20Sandbox.20Integrations.html#153930526">(Jan 24 2018 at 19:52)</a>:</h4>
<p>We are exited to announce that SMART app links in your cards now can be launched from the CDS Hooks sandbox to your HSPC Sandbox instance (as the issuer)!  Thanks <span class="user-mention" data-user-id="192599">@Zach Plata</span>  for making this happen!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
