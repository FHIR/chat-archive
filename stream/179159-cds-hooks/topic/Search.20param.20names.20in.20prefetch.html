---
layout: page
title: "FHIR Chat  · Search param names in prefetch · cds hooks"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/index.html">cds hooks</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html">Search param names in prefetch</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153985606"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985606" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985606">(Aug 13 2018 at 01:52)</a>:</h4>
<p>Prefetch templates define queries that a particular service would <em>like</em> to be performed with the results passed as part of the service specification.  However, there are a few things that aren't currently addressed in the CDS Hooks specification:</p>
<ul>
<li>The search parameter names aren't nailed down by FHIR.  Preferred ones are defined, but servers are allowed to define alternate names - and in the case of collisions, will have to define alternate names.  The true meaning of a given search parameter is determined by looking up the search name in the CapabilityStatement for that server and finding what SearchParameter canonical URL it's tied to.  This is a particular issue when the searches may need to use SearchParameters that aren't defined in the core specification.   What is the intention for how this will work?</li>
<li>The standard behavior in FHIR when performing queries is to query with what parameters they support and echo what parameters they actually paid attention to in the 'self' link - and the client system then deals with the discrepancy by filtering or issuing narrower queries.  However, in the hook invocation, there's no mechanism to include the 'self' link.  Is the presumption therefore that if a system doesn't support the fully query exactly as specified, it won't execute that prefetch query?  If not, how is the server to know that what it has isn't exectly what it asked for (and that it might have more data or less data than hoped for)?</li>
<li>Some queries might result in more data than is reasonable to include in the hook call.  Is the expectation that if the result set is too large, that that particular prefetch result will be excluded?</li>
</ul>



<a name="153985824"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985824" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985824">(Aug 13 2018 at 16:00)</a>:</h4>
<blockquote>
<p>Some queries might result in more data than is reasonable to include in the hook call. Is the expectation that if the result set is too large, that that particular prefetch result will be excluded?</p>
</blockquote>
<p>Yes. I'm pretty sure that we even talked about this (somewhere on github) as one of the scenario's for why it's reasonable for an EHR to not satisfy a pre-fetch request.</p>



<a name="153985830"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985830" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985830">(Aug 13 2018 at 16:13)</a>:</h4>
<p>Should the specification make that explicit that systems SHALL NOT return pre-fetch if they don't support the fully query as requested?</p>



<a name="153985846"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985846" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985846">(Aug 13 2018 at 17:10)</a>:</h4>
<blockquote>
<p>Should the specification make that explicit that systems SHALL NOT return pre-fetch if they don't support the fully query as requested?</p>
</blockquote>
<p>Lloyd, are you still talking about a search response's size? If so, we do have this in the spec now:</p>
<blockquote>
<blockquote>
<p>The resulting response, which MUST BE rendered in a single page — no "next page" links allowed — is passed along to the CDS Service using the prefetch parameter (see below for a complete example).<br>
and<br>
the prefetched data given to the CDS Service MUST BE equivalent to the data the CDS Service would receive if it were making its own call to the EHR FHIR server </p>
</blockquote>
</blockquote>
<p>There's also language around how to handle error'd searches.</p>



<a name="153985847"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985847" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985847">(Aug 13 2018 at 17:13)</a>:</h4>
<p>The <a href="https://cds-hooks.org/specification/1.0/#prefetch-query-restrictions" target="_blank" title="https://cds-hooks.org/specification/1.0/#prefetch-query-restrictions">Prefetch query restrictions</a> is the section of the spec that is related. (It's been a while since I read this section of the spec). </p>
<p>The primary goal here is for the CDS service to use search paramters that are supported by the EHR's FHIR server. In practice and for the short-term, this means using US Core's CCDS profiled search terms. Optimally, the search parameters used/useable in CDS Hooks wouldn't be defined in the CDS Hooks specification, but rather would fall back to FHIR while also remaining true to production FHIR servers.</p>



<a name="153985881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985881">(Aug 13 2018 at 19:30)</a>:</h4>
<p>It's not normally an error if someone says "please filter on x" and you don't support that filter - typically you just return the search results without the filter applied and declare that's what you've done.  If we need that to be treated as an error from a prefetch perspective, we should make that explicit.</p>



<a name="153985882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985882">(Aug 13 2018 at 19:32)</a>:</h4>
<p>Where's the language on limiting max number of rows?  (Beyond supporting the _count parameter)</p>



<a name="153985894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985894">(Aug 13 2018 at 20:12)</a>:</h4>
<p>I would think that the case when the server returned results without an expected filter applied should definitely be considered an error condition; if that's the expectation from the FHIR server side we should make a note about in the CDS Hooks prefetch discussion.</p>



<a name="153985895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153985895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153985895">(Aug 13 2018 at 20:12)</a>:</h4>
<p>As far as limiting the max number of rows, we don't have language beyond just supporting the _count parameter. Should we?</p>



<a name="153986100"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986100" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986100">(Aug 14 2018 at 02:23)</a>:</h4>
<p>Also, any thoughts on dealing with non-standard search parameter names?</p>



<a name="153986129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986129">(Aug 14 2018 at 02:49)</a>:</h4>
<p>this is  a copout, but do we really need to?</p>



<a name="153986130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986130">(Aug 14 2018 at 02:51)</a>:</h4>
<p>I've had to introduce 3 in DaVinci already.</p>



<a name="153986131"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986131" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986131">(Aug 14 2018 at 02:51)</a>:</h4>
<p>Now hopefully those will become part of the core spec for R4, but they won't for R3.</p>



<a name="153986132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986132">(Aug 14 2018 at 02:52)</a>:</h4>
<p>(And one of them was the ability to search on Patient for SupplyRequest...)</p>



<a name="153986133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986133">(Aug 14 2018 at 02:52)</a>:</h4>
<p>so not exactly esoteric.</p>



<a name="153986134"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986134" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986134">(Aug 14 2018 at 02:55)</a>:</h4>
<p>For R3, can we say that the service consults the FHIR server / implementing health system as part of implementation to determine supported search params?</p>



<a name="153986138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986138">(Aug 14 2018 at 02:57)</a>:</h4>
<p>We can do that for regular queries, but not for prefetch.</p>



<a name="153986140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986140">(Aug 14 2018 at 02:57)</a>:</h4>
<p>In that case, the client would need to consult the server - and the server might not have a FHIR endpoint</p>



<a name="153986147"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986147" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986147">(Aug 14 2018 at 03:00)</a>:</h4>
<blockquote>
<p>Lloyd McKenzie: We can do that for regular queries, but not for prefetch.</p>
</blockquote>
<p>hence, the words "implementing" and "implementation" <span class="emoji emoji-1f419" title="octopus">:octopus:</span></p>



<a name="153986150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986150">(Aug 14 2018 at 03:01)</a>:</h4>
<p>My expectation was that a service gets defined and then exposes itself to a wide variety of clients running a variety of software.  And I wasn't necessarily expecting what those servers supported to be homogeneous or static.</p>



<a name="153986151"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986151" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986151">(Aug 14 2018 at 03:02)</a>:</h4>
<p>Are services expected to be tuned to a single client or small set of clients?</p>



<a name="153986158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986158">(Aug 14 2018 at 03:06)</a>:</h4>
<p>No. Services should be tuned to widely and commonly implemented API features ... </p>
<p>In the absence of widely implemented APIs, stuff gets harder and either services or clients do need to be tuned. A single client should be configured to meet the query needs of the service.</p>



<a name="153986160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986160">(Aug 14 2018 at 03:09)</a>:</h4>
<p>Right.  But is that tuning expected to be handled out-of-band?  My preference is that the discovery mechanism would expose enough information that a client could determine what it needs to do without human-to-human interaction.  Is that unrealistic/not part of intended scope?</p>



<a name="153986162"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986162" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986162">(Aug 14 2018 at 03:10)</a>:</h4>
<p>I understand and empathize. There isn't a configuration mechanism available.</p>



<a name="153986163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986163">(Aug 14 2018 at 03:15)</a>:</h4>
<p>We could make the prefetch declaration unambiguous by providing a list of search-term  - SearchParameter canonical URL pairs.</p>



<a name="153986194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986194">(Aug 14 2018 at 04:49)</a>:</h4>
<p>Hey Lloyd, what you're suggesting is, I think, well outside of the 80+% case. The more reasonable alternative would be for the client to specify it's FHIR server when calling the discovery endpoint -- thereby enabling the CDS service to adjust it's prefetch queries to the FHIR server's capabilities. An HTTP GET _iss_ parameter would be reasonable. If the client authenticated (using the same jwt mechanism currently specified for the request), the CDS service would be able to keep track of which client had which capabilities. </p>
<p>This is pretty advanced stuff, but the above would solve a generic problem.</p>



<a name="153986196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986196">(Aug 14 2018 at 04:52)</a>:</h4>
<blockquote>
<p>We could make the prefetch declaration unambiguous by providing a list of search-term - SearchParameter canonical URL pairs.</p>
</blockquote>
<p>Another option would be DataRequirements in a CapabilityStatement. (would need to be an extension at this point, but we already defined an extension to support a CDS Hooks service endpoint declaration).</p>



<a name="153986201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986201">(Aug 14 2018 at 04:57)</a>:</h4>
<p>Hey Bryn, DataRequirements would interoperably define what the service expects, but not what the client's FHIR server supports -- which is the specific problem Lloyd is trying to solve (I think).</p>



<a name="153986203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986203">(Aug 14 2018 at 04:59)</a>:</h4>
<p>Oh I see, yes.</p>



<a name="153986321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/Search%20param%20names%20in%20prefetch/near/153986321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/Search.20param.20names.20in.20prefetch.html#153986321">(Aug 14 2018 at 14:07)</a>:</h4>
<p>Listing what each search parameter means is in the 80% for CapabilityStatement and allows the statements to be passive.  The expectation is that whenever clients do a query, they always check the CapabilityStatement before evaluating a query because that's the only way to know what the search parameters mean.  Exposing the linkage in CDSService.prefetch would be consistent with that.</p>
<p>Active, client-centric declarations of capability would be pretty cool, but seem super-advanced and push a lot of complexity into the server.   Some FHIR servers support that to show user permissions, but it's not common.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
