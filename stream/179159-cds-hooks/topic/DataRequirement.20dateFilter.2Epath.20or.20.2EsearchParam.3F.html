---
layout: page
title: "FHIR Chat  · DataRequirement dateFilter.path or .searchParam? · cds hooks"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/index.html">cds hooks</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html">DataRequirement dateFilter.path or .searchParam?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="207269801"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207269801" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207269801">(Aug 18 2020 at 14:57)</a>:</h4>
<p>In the DataRequirement dataType there are, what appears to be 2 ways to specify the search/filtering mechanism, the codeFilter and dateFilter.   What is not clear, especially for the dateFilter, is how and when to use .path vs .searchParam.</p>
<p>For example, if I'm trying to create a DR dataFilter for "patient &gt; 65 yrs old" how would that be encoded in dateFilter?<br>
    dateFilter.path = "birthdate=gt1955-01-01".  (using this because a FHIR server might not implement the age search extension) <br>
or<br>
    dateFilter.serarchParam = "birthdate=gt1955-01-01"<br>
or<br>
    something else?</p>
<p>[Should I be asking this in the Implementers stream rather than here? ]</p>



<a name="207270573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207270573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207270573">(Aug 18 2020 at 15:03)</a>:</h4>
<p>Yeah, it's not specifically CDS Hooks question -- though I don't think there's a dedicated area for broader CDS discussion (maybe <a class="stream" data-stream-id="179220" href="/#narrow/stream/179220-cql">#cql</a> would be worth trying, or <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> could probably answer directly). Where/how are you trying to use a <code>dataFilter</code>?</p>



<a name="207273257"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207273257" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207273257">(Aug 18 2020 at 15:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span>  thanks!   Yes, I was debating to ask here or <a class="stream" data-stream-id="179220" href="/#narrow/stream/179220-cql">#cql</a>  or <a class="stream" data-stream-id="179166" href="/#narrow/stream/179166-implementers">#implementers</a>  -- but didn't want to 'incur the wrath' of double.triple posting ;-)</p>
<p>As my example shows, if the CQL logic was trying to filter on patients greater than a certain age, I want to have a DR that essentially does the same FHIR search filtering as what would happen in the CQL logic.   (even though ?age isn't a standard Patient search parameter)</p>



<a name="207281752"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207281752" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207281752">(Aug 18 2020 at 16:27)</a>:</h4>
<p>No worries! But are you actually issuing a FHIR search? Or... what are you doing with the DR snippet you're creating? That's what I'm confused about.</p>



<a name="207288468"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207288468" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207288468">(Aug 18 2020 at 17:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span>  - this FHIR Clinical Reasoning page shows how the dataRequirement is supposed to be mapped to FHIR URL:</p>
<p><a href="https://www.hl7.org/fhir/clinicalreasoning-cds-on-fhir.html#14.5.2.3">https://www.hl7.org/fhir/clinicalreasoning-cds-on-fhir.html#14.5.2.3</a></p>
<p>`The concept of prefetch data is represented within Clinical Reasoning as a DataRequirement, which can be transformed to an instance level read or type level search interaction as follows:</p>
<p>DataRequirement Element Mapping to FHIR URL<br>
type    [type]{[id] | ?[parameters]}<br>
subject subject={{patientId}}<br>
codeFilter  [path]{=|:in}[code|valueSet]<br>
dateFilter  [path]{eq|lt|gt|ge|le}[valueDateTime|valuePeriod|valueDuration]<br>
sort    _sort=[sort]<br>
limit   _limit=[limit]<br>
This prefetch data can be automatically determined from the data requirements of the PlanDefinition and provided as part of the service definition to the CDS Hooks discovery response.`</p>



<a name="207288931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207288931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207288931">(Aug 18 2020 at 17:26)</a>:</h4>
<p>Maybe, reading 'between the lines' here, the 'transformed to instance-level read' implies 'path' and  'type level search interaction' implies searchParam.    If this is true then I suppose I should use serachParam and then the value has to be a RESTful GET search string?</p>



<a name="207292252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207292252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207292252">(Aug 18 2020 at 17:53)</a>:</h4>
<p>Hmm, are you building a CDS Hooks client, or CDS Hooks services, or something else? The excerpt you cited seems more like an analogy/mapping exercise, but if you're doing CDS Hooks you'd want to create the actual templated <code>prefetch</code> URL rather than a DataRequirement structure.</p>



<a name="207348409"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207348409" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207348409">(Aug 18 2020 at 22:11)</a>:</h4>
<p>The path is used to specify a path in terms of actual elements in the resource, whereas searchParam is used to specify the name of a search parameter to use for the filtering. The data requirements mapping can be used to construct prefetch declarations, we do this for clinical reasoning modules that we expose as CDS Hooks services.</p>



<a name="207417626"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207417626" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207417626">(Aug 19 2020 at 14:51)</a>:</h4>
<p>Brian, yes, this is what we're trying to do -- use the DR as a way to construct the prefetch searches (if you will).   One thing about this approach that has me wondering though, how can you pre-create the prefetch rules before a possible CQL rule has been 'fired'?   Is this a system setup phase where all the possible PlanDefinitions in the system pre-computed the prefetch searches and store them so they are available when (i.e. before0 the CDS Hook actually fires?</p>



<a name="207441161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207441161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207441161">(Aug 19 2020 at 18:01)</a>:</h4>
<p>Yes, exactly, the Library resource has a DataRequirements element, and as part of packaging a CQL library, the DataRequirements for the logic are inferred and persisted in the Library so they can be processed for exactly that type of use case. See this <a href="http://hl7.org/fhir/us/cqfmeasures/Library-EXM146.html">library</a> for example</p>



<a name="207467449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207467449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207467449">(Aug 19 2020 at 22:11)</a>:</h4>
<p>Thanks!  That library example helps show the correlation between the CQL rules and the dataRequirements.   The only one that is missing a DataRequirement is the "age between 2 and 17"; I would assume that would be done using the Patient resource and a searchParam for age, but, of course, age is not a standard Patient search operator (e.g. HAPI doesn't implement it and probably others).</p>
<p>I still have to think about how all these Library (or PlanDefinitions) would be retrieved to create the prefetch criteria before any rule is fired.  There could be many of these on a FHIR server, how would the CDS Hook code (service) know which ones to use (or all?)</p>



<a name="207471850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207471850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207471850">(Aug 19 2020 at 23:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> can you help me understand what this is about? Who implements the mapping described in <a href="https://www.hl7.org/fhir/clinicalreasoning-cds-on-fhir.html#surfacing-clinical-decision-support">https://www.hl7.org/fhir/clinicalreasoning-cds-on-fhir.html#surfacing-clinical-decision-support</a>, and when/why?</p>



<a name="207471899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207471899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207471899">(Aug 19 2020 at 23:06)</a>:</h4>
<p>Like, who turns DataRequirements into a prefetch URL (in time to be added to a CDS Service's hooks discovery endpoint)?</p>



<a name="207485013"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207485013" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207485013">(Aug 20 2020 at 03:17)</a>:</h4>
<p>We have it implemented in our CDS Hooks service, so we dynamically construct the discovery response by walking through the registered PlanDefinitions, and reading the DataRequirements from the Libraries used by those PlanDefinitions. Each PlanDefinition corresponds to a CDS Hooks endpoint, and we use this mapping to turn the DataRequirements into prefetch templates.</p>



<a name="207485165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207485165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207485165">(Aug 20 2020 at 03:21)</a>:</h4>
<p>So decision support services exposing clinical reasoning content via the CDS Hooks API.</p>



<a name="207521625"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207521625" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207521625">(Aug 20 2020 at 13:26)</a>:</h4>
<p>And is John using your CDS Hooks service? Maybe that's the context I'm missing.</p>



<a name="207593451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207593451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207593451">(Aug 21 2020 at 01:36)</a>:</h4>
<p><span class="user-mention" data-user-id="298707">@John Silva</span> , there is a CDS Hooks Service PlanDefinition profile that we use to provide the CDS Hooks endpoint that a given PlanDefinition is surfaced on: <a href="http://hl7.org/fhir/plandefinition-cdshooks-service.html">http://hl7.org/fhir/plandefinition-cdshooks-service.html</a></p>



<a name="207593457"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207593457" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207593457">(Aug 21 2020 at 01:36)</a>:</h4>
<p>That's how we know which PlanDefinitions to run through and what endpoint to use to surface them in the discovery.</p>



<a name="207593476"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207593476" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207593476">(Aug 21 2020 at 01:37)</a>:</h4>
<p>Josh, I don't think John is using the CQF Ruler, not sure though, John?</p>



<a name="207595884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179159-cds%20hooks/topic/DataRequirement%20dateFilter.path%20or%20.searchParam%3F/near/207595884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179159-cds-hooks/topic/DataRequirement.20dateFilter.2Epath.20or.20.2EsearchParam.3F.html#207595884">(Aug 21 2020 at 02:43)</a>:</h4>
<p>Were using some of the <a href="https://github.com/cqframework/cql-execution">https://github.com/cqframework/cql-execution</a> library for executing the CQL.   Not sure that has support for working with the PlanDefinition and its DataDefinitions.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
