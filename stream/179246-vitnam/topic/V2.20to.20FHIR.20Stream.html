---
layout: page
title: "FHIR Chat  · V2 to FHIR Stream · việtnam"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/index.html">việtnam</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html">V2 to FHIR Stream</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153921978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921978">(Nov 29 2017 at 02:24)</a>:</h4>
<div class="codehilite"><pre><span></span>MSH|^~\&amp;|REGADT|MCM|IFENG||199112311501||ADT^A04^ADT_A01|000001|P|2.5|||
EVN|A04|200301101500|200301101400|01||200301101410
PID|||191919^^^GENHOS^MR~371-66-9256^^^USSSA^SS|253763|MASSIE^JAMES^A||19560129|M|||171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;^||(900)485-5344|(900)485-5344||S|C|10199925^^^GENHOS^AN|371-66-9256||&lt;cr&gt;
NK1|1|MASSIE^ELLEN|SPOUSE|171 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)545-1234~(900)545-1200|EC1^FIRST EMERGENCY CONTACT&lt;cr&gt;
NK1|2|MASSIE^MARYLOU|MOTHER|300 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)545-1234~(900)545-1200|EC2^SECOND EMERGENCY CONTACT&lt;cr&gt;
NK1|3&lt;cr&gt;
NK1|4|||123 INDUSTRY WAY^^ISHPEMING^MI^49849^&quot;&quot;^||(900)545-1200|EM^EMPLOYER|19940605||PROGRAMMER|||ACME SOFTWARE COMPANY&lt;cr&gt;
PV1||O|O/R||||0148^ADDISON,JAMES|0148^ADDISON,JAMES|0148^ADDISON,JAMES|AMB|||||||0148^ADDISON,JAMES|S|1400|A|||||||||||||||||||GENHOS|||||199501101410|&lt;cr&gt;
PV2||||||||200301101400||||||||||||||||||||||||||200301101400&lt;cr&gt;
OBX||ST|1010.1^BODY WEIGHT||62|kg|||||F&lt;cr&gt;
OBX||ST|1010.1^HEIGHT||190|cm|||||F&lt;cr&gt;
DG1|1|19||BIOPSY||00|&lt;cr&gt;
GT1|1||MASSIE^JAMES^&quot;&quot;^&quot;&quot;^&quot;&quot;^&quot;&quot;^||171 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)485-5344||||SE^SELF|371-66-925||||MOOSES AUTO CLINIC|171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;|(900)485-5344|&lt;cr&gt;
IN1|0|0|BC1|BLUE CROSS|171 ZOBERLEIN^^ISHPEMING^M149849^&quot;&quot;^||(900)485-5344|90||||||50 OK|&lt;cr&gt;
IN1|2|&quot;&quot;|&quot;&quot;&lt;cr&gt;
</pre></div>



<a name="153921985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921985">(Nov 29 2017 at 02:34)</a>:</h4>
<p><a href="http://www.healthintersections.com.au/A31ToPerson.js" target="_blank" title="http://www.healthintersections.com.au/A31ToPerson.js">http://www.healthintersections.com.au/A31ToPerson.js</a></p>



<a name="153921986"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921986" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921986">(Nov 29 2017 at 02:35)</a>:</h4>
<div class="codehilite"><pre><span></span>function A31ToPerson(aEvent)
{
    // this function mines a A04 message to create a FHIR Patient resource
    // Mostly the Person resource only covers the information in the PID segment.
    //
    // the actual message is the one found in the v2.5 standard (section 3.5.3):
//MSH|^~\&amp;|REGADT|MCM|IFENG||199112311501||ADT^A04^ADT_A01|000001|P|2.5|||
//EVN|A04|200301101500|200301101400|01||200301101410
//PID|||191919^^^GENHOS^MR~371-66-9256^^^USSSA^SS|253763|MASSIE^JAMES^A||19560129|M|||171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;^||(900)485-5344|(900)485-5344||S|C|10199925^^^GENHOS^AN|371-66-9256||&lt;cr&gt;
//NK1|1|MASSIE^ELLEN|SPOUSE|171 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)545-1234~(900)545-1200|EC1^FIRST EMERGENCY CONTACT&lt;cr&gt;
//NK1|2|MASSIE^MARYLOU|MOTHER|300 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)545-1234~(900)545-1200|EC2^SECOND EMERGENCY CONTACT&lt;cr&gt;
//NK1|3&lt;cr&gt;
//NK1|4|||123 INDUSTRY WAY^^ISHPEMING^MI^49849^&quot;&quot;^||(900)545-1200|EM^EMPLOYER|19940605||PROGRAMMER|||ACME SOFTWARE COMPANY&lt;cr&gt;
//PV1||O|O/R||||0148^ADDISON,JAMES|0148^ADDISON,JAMES|0148^ADDISON,JAMES|AMB|||||||0148^ADDISON,JAMES|S|1400|A|||||||||||||||||||GENHOS|||||199501101410|&lt;cr&gt;
//PV2||||||||200301101400||||||||||||||||||||||||||200301101400&lt;cr&gt;
//OBX||ST|1010.1^BODY WEIGHT||62|kg|||||F&lt;cr&gt;
//OBX||ST|1010.1^HEIGHT||190|cm|||||F&lt;cr&gt;
//DG1|1|19||BIOPSY||00|&lt;cr&gt;
//GT1|1||MASSIE^JAMES^&quot;&quot;^&quot;&quot;^&quot;&quot;^&quot;&quot;^||171 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)485-5344||||SE^SELF|371-66-925||||MOOSES AUTO CLINIC|171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;|(900)485-5344|&lt;cr&gt;
//IN1|0|0|BC1|BLUE CROSS|171 ZOBERLEIN^^ISHPEMING^M149849^&quot;&quot;^||(900)485-5344|90||||||50 OK|&lt;cr&gt;
//IN1|2|&quot;&quot;|&quot;&quot;&lt;cr&gt;

   var v2 = aEvent.Source.Message;
   var p = FHIR.newPatient;
   var r = FHIR.makeRequest();
   r.Resource = p;
   aEvent.Dest.FhirRequest = r;

   // fill out the request
   r.id = makePatientId(v2);
   if (r.id == null || r.id == &quot;&quot;)
     r.id = &quot;test&quot;;
   r.ResourceType = frtPatient;
   r.CommandType = fcmdUpdate;
   r.Lang = &quot;en&quot;;


   // now we have to build the Person resource.
   fillOutPatientDetails(p, v2);
   buildNarrative(p, v2);
  }
</pre></div>



<a name="153921987"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921987" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921987">(Nov 29 2017 at 02:56)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">A31ToPerson</span><span class="p">(</span><span class="nx">aEvent</span><span class="p">)</span>
<span class="p">{</span>

   <span class="kd">var</span> <span class="nx">v2</span> <span class="o">=</span> <span class="nx">aEvent</span><span class="p">.</span><span class="nx">Source</span><span class="p">.</span><span class="nx">Message</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">FHIR</span><span class="p">.</span><span class="nx">newPatient</span><span class="p">;</span>
   <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">FHIR</span><span class="p">.</span><span class="nx">makeRequest</span><span class="p">();</span>
   <span class="nx">r</span><span class="p">.</span><span class="nx">Resource</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
   <span class="nx">aEvent</span><span class="p">.</span><span class="nx">Dest</span><span class="p">.</span><span class="nx">FhirRequest</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>

   <span class="nx">Bundle</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">FHIR</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">&quot;Patient?identifier=&quot;</span><span class="o">+</span><span class="nx">MRN</span><span class="p">);</span>
   <span class="k">if</span> <span class="nx">b</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span>
     <span class="nx">patientId</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">resource</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
   <span class="k">else</span> <span class="k">if</span> <span class="nx">b</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">1</span>
     <span class="nx">makeAnError</span><span class="p">(</span><span class="s2">&quot;Multiple matches for Patient &quot;</span><span class="o">+</span><span class="nx">MRN</span><span class="p">);</span>
   <span class="k">else</span>
     <span class="nx">patientId</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="c1">// we&#39;re going to create a new patient</span>

   <span class="c1">// fill out the request</span>
   <span class="nx">r</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">patientId</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">id</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
     <span class="nx">r</span><span class="p">.</span><span class="nx">CommandType</span> <span class="o">=</span> <span class="nx">fcmdUpdate</span><span class="p">;</span>
   <span class="k">else</span>
     <span class="nx">r</span><span class="p">.</span><span class="nx">CommandType</span> <span class="o">=</span> <span class="nx">fcmdCreate</span><span class="p">;</span>
   <span class="nx">r</span><span class="p">.</span><span class="nx">ResourceType</span> <span class="o">=</span> <span class="nx">frtPatient</span><span class="p">;</span>
   <span class="nx">r</span><span class="p">.</span><span class="nx">Lang</span> <span class="o">=</span> <span class="s2">&quot;vn&quot;</span><span class="p">;</span>


   <span class="c1">// now we have to build the Person resource.</span>
   <span class="nx">fillOutPatientDetails</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">v2</span><span class="p">);</span>
   <span class="nx">buildNarrative</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">v2</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>



<a name="153921988"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921988" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921988">(Nov 29 2017 at 02:57)</a>:</h4>
<div class="codehilite"><pre><span></span>function A31ToPerson(aEvent)
{

   var v2 = aEvent.Source.Message;
   var p = FHIR.newPatient;
   var r = FHIR.makeRequest();
   r.Resource = p;
   aEvent.Dest.FhirRequest = r;

   MRN = v2[&quot;PID-3[5 = &#39;MR&#39;]&quot;];
   Bundle b = FHIR.search(&quot;Patient?identifier=&quot;+MRN);
   if b.entry.count = 1
     patientId = b.entry.resource.id;
   else if b.entry.count &gt; 1
     makeAnError(&quot;Multiple matches for Patient &quot;+MRN);
   else
     patientId = &quot;&quot;; // we&#39;re going to create a new patient

   // fill out the request
   r.id = patientId;
   if (r.id != &quot;&quot;)
     r.CommandType = fcmdUpdate;
   else
     r.CommandType = fcmdCreate;
   r.ResourceType = frtPatient;
   r.Lang = &quot;vn&quot;;


   // now we have to build the Person resource.
   fillOutPatientDetails(p, v2);
   buildNarrative(p, v2);
  }
</pre></div>



<a name="153921989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921989">(Nov 29 2017 at 04:05)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">buildNarrative</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">v2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nx">p</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">FHIR</span><span class="p">.</span><span class="nx">newNarrative</span><span class="p">;</span>
  <span class="nx">p</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">statusST</span> <span class="o">=</span> <span class="nx">NarrativeStatusGenerated</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">n2</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-5&quot;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">n2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">a2</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-11&quot;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">address</span> <span class="o">=</span> <span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">+</span><span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mrn</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">Element</span><span class="p">(</span><span class="s2">&quot;PID-3[@5 = \&quot;MR\&quot;].1&quot;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">dob</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-7&quot;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">gender</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-8&quot;</span><span class="p">).</span><span class="nx">DisplayForCode</span><span class="p">;;</span>


  <span class="nx">p</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">div</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">xhtml</span><span class="p">(</span>
    <span class="s2">&quot;&lt;div&gt;Patient &quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot; (&quot;</span><span class="o">+</span><span class="nx">mrn</span><span class="o">+</span><span class="s2">&quot;): &quot;</span><span class="o">+</span><span class="nx">gender</span><span class="o">+</span><span class="s2">&quot;, born &quot;</span><span class="o">+</span><span class="nx">dob</span><span class="o">+</span><span class="s2">&quot;.&lt;br/&gt;Address: &quot;</span><span class="o">+</span><span class="nx">address</span><span class="o">+</span><span class="s2">&quot;&lt;/div&gt;&quot;</span>
  <span class="p">);</span>
<span class="p">}</span>
</pre></div>



<a name="153921990"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921990" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921990">(Nov 29 2017 at 04:05)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">fillOutPatientDetails</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">v2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// MRN. We need to assign a global scope to the mrn. It has to be known based on local config</span>
   <span class="nx">p</span><span class="p">.</span><span class="nx">identifier</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Identifier</span><span class="p">{</span>
     <span class="nx">value</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">Element</span><span class="p">(</span><span class="s2">&quot;PID-3[@5 = \&quot;MR\&quot;].1&quot;</span><span class="p">),</span>
     <span class="c1">// system = lookupURL(v2.Element(&quot;PID-3[@5 = \&quot;MR\&quot;].4&quot;)),</span>
     <span class="nx">system</span> <span class="o">=</span> <span class="s2">&quot;http://hospitals.vn/&quot;</span><span class="o">+</span><span class="nx">v2</span><span class="p">.</span><span class="nx">Element</span><span class="p">(</span><span class="s2">&quot;PID-3[@5 = \&quot;MR\&quot;].4&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/mrn&quot;</span><span class="p">,</span>
     <span class="nx">type</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CodeableConcept</span><span class="p">(){</span> <span class="nx">coding</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
       <span class="k">new</span> <span class="nx">Coding</span><span class="p">(</span> <span class="nx">system</span><span class="o">=</span><span class="s2">&quot;http://hl7.org/fhir/v2/0203&quot;</span><span class="p">,</span> <span class="nx">code</span><span class="o">=</span><span class="s2">&quot;MR&quot;</span><span class="p">){})}</span>
   <span class="p">});</span>

   <span class="nx">p</span><span class="p">.</span><span class="nx">identifier</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Identifier</span><span class="p">{</span>
     <span class="nx">value</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">Element</span><span class="p">(</span><span class="s2">&quot;PID-3[@5 = \&quot;MR\&quot;].1&quot;</span><span class="p">),</span>
     <span class="nx">system</span> <span class="o">=</span> <span class="s2">&quot;http://moh.gov.vn/vss&quot;</span><span class="p">,</span>
     <span class="nx">type</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CodeableConcept</span><span class="p">(){</span> <span class="nx">coding</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
       <span class="k">new</span> <span class="nx">Coding</span><span class="p">(</span> <span class="nx">system</span><span class="o">=</span><span class="s2">&quot;http://hl7.org/fhir/v2/0203&quot;</span><span class="p">,</span> <span class="nx">code</span><span class="o">=</span><span class="s2">&quot;NIIP&quot;</span><span class="p">){})}</span>
   <span class="p">});</span>

  <span class="c1">// Nguyen^Thi Phuong Trang^</span>
  <span class="kd">var</span> <span class="nx">n2</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">[</span><span class="s2">&quot;PID-5&quot;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumanName</span><span class="p">(){</span>
     <span class="nx">text</span> <span class="o">=</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">n2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">n</span><span class="p">.</span><span class="nx">family</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">string</span><span class="p">(</span><span class="nx">n2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">s</span> <span class="o">:</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">given</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">string</span><span class="p">(</span><span class="nx">s</span><span class="p">));</span>

  <span class="c1">// 171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;^</span>
  <span class="kd">var</span> <span class="nx">a2</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-11&quot;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Address</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">text</span> <span class="o">=</span> <span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;\r\n&quot;</span><span class="o">+</span><span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">line</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">string</span><span class="p">(</span><span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">city</span> <span class="o">=</span> <span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">a2</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="nx">p</span><span class="p">.</span><span class="nx">addressList</span><span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>

  <span class="c1">// (900)485-5344|(900)485-5344</span>
  <span class="nx">p</span><span class="p">.</span><span class="nx">telecom</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">ContactPoint</span><span class="p">()</span> <span class="p">{</span><span class="nx">use</span> <span class="o">=</span> <span class="s2">&quot;phone&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-13&quot;</span><span class="p">),</span> <span class="nx">type</span><span class="o">=</span> <span class="s2">&quot;home&quot;</span><span class="p">};</span>
  <span class="nx">p</span><span class="p">.</span><span class="nx">telecom</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">ContactPoint</span><span class="p">()</span> <span class="p">{</span><span class="nx">use</span> <span class="o">=</span> <span class="s2">&quot;phone&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-14&quot;</span><span class="p">),</span> <span class="nx">type</span><span class="o">=</span> <span class="s2">&quot;work&quot;</span><span class="p">};</span>


  <span class="nx">p</span><span class="p">.</span><span class="nx">birthDate</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-7&quot;</span><span class="p">).</span><span class="nx">copy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="nx">reformat</span><span class="p">;</span>
  <span class="c1">// gender &amp; religion: code is also original text. That may not be appropriate, depending on the source of the message</span>
  <span class="nx">string</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="s2">&quot;PID-8&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">=</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="s2">&quot;male&quot;</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="s2">&quot;female&quot;</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">g</span> <span class="o">=</span> <span class="s2">&quot;U&quot;</span><span class="p">)</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">;</span>
  <span class="k">else</span> <span class="c1">// if (g = &quot;O&quot;)</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>



<a name="153921992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921992">(Nov 29 2017 at 05:03)</a>:</h4>
<div class="codehilite"><pre><span></span>// run this every minute
procedure PushProcess() {
  sql = select * from my_database_queue where handled = 0
  for each row in fetch(sql) do {
    // transaction:
    Bundle b = makeResources(row);
    Bundle resp = client.submitTransaction(b);
    for entry in resp.entry do
      if we_have_no_national_id
        update our record with the national id
    runsql(&quot;update row set handled = 1&quot;);
  }
}

procedure makeResources(row) {
  Bundle b = new Bundle();
  b.type = transaction;
  b.id = makeUUID;

  // this row is a changed problem!
  Condition c = new Condition();
  BundleEntry be = b.entry.add;
  be.resource = c;
  if my_record_has_national_id
    c.id = national_id
  else
    c.id = &quot;&quot;; we&#39;re going to create it

  fill out the condition from your databases

}

Security:
3 options to authenticate the client (push process):
 - username/password = Basic Authentication Header
 - Mutual TLS certificates (SSL)
 - Certificate exchange (smart on FHIR &quot;backend services&quot; http://docs.smarthealthit.org/authorization/backend-services/)
</pre></div>



<a name="153921994"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921994" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921994">(Nov 29 2017 at 07:21)</a>:</h4>
<div class="codehilite"><pre><span></span>Pull

on Search Patient do {
  check the user has access to which patients
  build base sql for selecting from patients in scope
    (select * from patients, user_patients
      where patients.patientkey = userPaitents.paitnetkey and userpatients.userkey = [user])
  for each parameter: add to sql statement
    (?name=thi -&gt; and patients.name = &quot;%thi%&quot;)
  create response bundle, type = searchset
  for each row in fetch(sql)
    add entry to bundle
    fill out the resource from your database
}

on read patient do {
  read the id
  check the user has access to the patient [id]
  if so
    fill out the resource from your database
}

on Update patient do {
  read the id
  check the user has access to the patient [id]
  check submitted resource is valid
  check meets business rules
  if so
    fill out your database from the resource
}

on Create patient do {
  check the user has access to create patients
  check submitted resource is valid
  check meets business rules (check ids unique etc)
  if so
    assign an id (next primary key, uuid etc)
    fill out your database from the resource
    return the id in the location header
}

key pull issue:
- only want data that has changed
  GET Patient/[id]/$everything?_lastUpdated=2017-10-23T13:14:15+07:00


Security on pull:

A: Securing systems:
3 options to authenticate the client (push process):
 - username/password = Basic Authentication Header
 - Mutual TLS certificates (SSL)
 - Certificate exchange (smart on FHIR &quot;backend services&quot; http://docs.smarthealthit.org/authorization/backend-services/)

B: Securing the user:
- OAuth (smart on FHIR)

  Authorization: Bearer [token]
</pre></div>



<a name="153921995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921995">(Nov 29 2017 at 07:25)</a>:</h4>
<p>Grahame's server: <a href="http://www.healthintersections.com.au/FhirServer" target="_blank" title="http://www.healthintersections.com.au/FhirServer">http://www.healthintersections.com.au/FhirServer</a></p>



<a name="153921996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raymond Francis Sarmiento <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921996">(Nov 29 2017 at 07:26)</a>:</h4>
<p>Command Line Tool for HAPI FHIR -- <a href="http://hapifhir.io/doc_cli.html" target="_blank" title="http://hapifhir.io/doc_cli.html">http://hapifhir.io/doc_cli.html</a></p>



<a name="153921998"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921998" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raymond Francis Sarmiento <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921998">(Nov 29 2017 at 07:39)</a>:</h4>
<p><a href="https://fhirblog.com/2016/10/19/setting-up-your-own-fhir-server-for-profiling/" target="_blank" title="https://fhirblog.com/2016/10/19/setting-up-your-own-fhir-server-for-profiling/">https://fhirblog.com/2016/10/19/setting-up-your-own-fhir-server-for-profiling/</a></p>



<a name="153921999"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153921999" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raymond Francis Sarmiento <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153921999">(Nov 29 2017 at 07:45)</a>:</h4>
<p>James Agnew's HAPI FHIR github:<br>
<a href="https://github.com/jamesagnew/hapi-fhir" target="_blank" title="https://github.com/jamesagnew/hapi-fhir">https://github.com/jamesagnew/hapi-fhir</a></p>



<a name="153922000"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153922000" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tuan Le <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153922000">(Nov 29 2017 at 07:47)</a>:</h4>
<p>How to build a health database <br>
<a href="https://www.openhealthhub.org/t/howto-build-a-health-database-and-fhir-api-server-in-15-mins-using-open-source/155" target="_blank" title="https://www.openhealthhub.org/t/howto-build-a-health-database-and-fhir-api-server-in-15-mins-using-open-source/155">https://www.openhealthhub.org/t/howto-build-a-health-database-and-fhir-api-server-in-15-mins-using-open-source/155</a></p>



<a name="153922001"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153922001" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raymond Francis Sarmiento <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153922001">(Nov 29 2017 at 07:47)</a>:</h4>
<p>How to build a health database and FHIR server in 15 mins using open source<br>
<a href="https://goo.gl/28pkTz" target="_blank" title="https://goo.gl/28pkTz">https://goo.gl/28pkTz</a></p>
<p>This is essentially HAPI FHIR and MySQL</p>



<a name="153922007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153922007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hanh Dang <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153922007">(Nov 29 2017 at 08:29)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span> thanks</p>



<a name="153922023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153922023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153922023">(Nov 29 2017 at 10:41)</a>:</h4>
<p>by everyone.... see you next time!</p>



<a name="153922025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153922025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raymond Francis Sarmiento <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153922025">(Nov 29 2017 at 10:46)</a>:</h4>
<p>Great stuff, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span><br>
We learned a lot! Have a safe flight :)</p>



<a name="153922184"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179246-vi%E1%BB%87tnam/topic/V2%20to%20FHIR%20Stream/near/153922184" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Trần Ngọc Quốc <a href="https://fhir.github.io/chat-archive/stream/179246-vitnam/topic/V2.20to.20FHIR.20Stream.html#153922184">(Nov 30 2017 at 01:48)</a>:</h4>
<p>thanks</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
