---
layout: page
title: "FHIR Chat  · IG Builder running out of memory · committers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179165-committers/index.html">committers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html">IG Builder running out of memory</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153946383"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946383" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946383">(Mar 20 2018 at 09:07)</a>:</h4>
<p>The difference here may be that the entire container is running out of memory rather than the java process inside the container running out of memory. When the latter happens we should get an error message. The former perhaps not. We tried to prevent this by limiting the memory available to the JVM (so it remains within container limits), which maybe where things are breaking down.</p>



<a name="153946384"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946384" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946384">(Mar 20 2018 at 09:07)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span></p>



<a name="153946385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946385">(Mar 20 2018 at 09:12)</a>:</h4>
<p>BTW do you know how much memory should be enough to run this job?</p>



<a name="153946479"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946479" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946479">(Mar 20 2018 at 14:11)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> -- thanks for looking into this.  I'm currently trying to see if there is a value for the docker run <code>-m</code> parameter (memory limit) that will allow it to work without having to disable the oom killer.  I'll let you know what I find.  BTW -- I've answered some of your other questions over on GH: <a href="https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374602422" target="_blank" title="https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374602422">https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374602422</a> (sorry for fragmenting this discussion).</p>



<a name="153946483"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946483" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946483">(Mar 20 2018 at 14:15)</a>:</h4>
<p>Thanks. That report on timing is interesting -- 5min vs 30min just based on memory allocation</p>



<a name="153946484"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946484" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946484">(Mar 20 2018 at 14:17)</a>:</h4>
<p>I'm inclined to just crank it way up, but I'd like to have property error detections in place, too -- which seems hard to accomplish from within the container. We may need a separate pod (in the kubernetes deployment, which is what manages our hosted environment) to mention for errors...</p>



<a name="153946485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946485">(Mar 20 2018 at 14:18)</a>:</h4>
<p>My last run I tried it with <code>-m 6G</code> and it still failed.  I'm currently trying <code>-m 8G</code> (still running).  I guess our IG must be huge compared to others (or I'm doing something _very_ wrong).</p>



<a name="153946486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946486">(Mar 20 2018 at 14:22)</a>:</h4>
<p>Interesting. Well, none of this is deeply tested, so maybe yours just is significantly bigger than the others. How many resources/profiles/valuesets are you defining?</p>



<a name="153946490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946490">(Mar 20 2018 at 14:29)</a>:</h4>
<p>The run w/ <code>-m 8G</code> succeeded in 19 minutes.  Is it reasonable to request that you allocate <code>8G</code> to the container?</p>
<p>This IG defines 134 logical models (!), 30 profiles, 31 extensions, 41 value sets, and 30 code systems.</p>



<a name="153946640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946640">(Mar 20 2018 at 18:53)</a>:</h4>
<p>that's pretty substantial. I'll spend some time looking at optimization when I get a chance.</p>



<a name="153946644"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946644" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946644">(Mar 20 2018 at 18:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> -- as an update, I actually found that despite passing in <code>-m 8G</code>, my container was <em>actually</em> still only getting 2 GB allocation.  That one successful run was pure luck.  After reconfiguring my docker host (Docker for Mac) so I could specify a limit above 2 GB, I was able to successfully run it with an allocation of 4 GB.  I ran <code>top</code> inside the container while it was running and found that the Java process maxed out at 2.9 GB.  So... that 8 GB thing was totally wrong -- it's not as bad as we thought, but there probably still is some room for optimization!</p>



<a name="153946652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946652">(Mar 20 2018 at 19:12)</a>:</h4>
<p>ok thx. all the definitions + all the resources in 2 dfferent object models + expansions for all the value sets... shouldn't really be 2.9GB... I'll have to investigate. How much html is produced?</p>



<a name="153946656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946656">(Mar 20 2018 at 19:34)</a>:</h4>
<p>FYI -- my final results and recommendations can be found here: <a href="https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374728387" target="_blank" title="https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374728387">https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374728387</a></p>



<a name="153946657"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946657" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946657">(Mar 20 2018 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> does this answer your question or are you looking for something else?</p>



<a name="153946658"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946658" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946658">(Mar 20 2018 at 19:35)</a>:</h4>
<div class="codehilite"><pre><span></span>Checking Output HTML                                                             (00:04:13.0243sec)
found 2946 files
  ... 2946 html files, 0 pages invalid xhtml (0%)                                (00:04:28.0707sec)
  ... 769433 links, 137 broken links (0%)                                        (00:04:28.0707sec)
</pre></div>



<a name="153946661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946661">(Mar 20 2018 at 19:40)</a>:</h4>
<p>that's it, thanks. its not that many pages....</p>



<a name="153946884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179165-committers/topic/IG%20Builder%20running%20out%20of%20memory/near/153946884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179165-committers/topic/IG.20Builder.20running.20out.20of.20memory.html#153946884">(Mar 21 2018 at 16:39)</a>:</h4>
<p>With many, many thanks to <span class="user-mention" data-user-id="191315">@Josh Mandel</span>, the auto-build is now producing my IG.  Hurray!  See the GitHub issue linked above if you want the gory details.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
