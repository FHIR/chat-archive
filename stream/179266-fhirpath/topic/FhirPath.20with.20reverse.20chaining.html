---
layout: page
title: "FHIR Chat  · FhirPath with reverse chaining · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html">FhirPath with reverse chaining</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153977253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> François Macary <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977253">(Jul 23 2018 at 08:25)</a>:</h4>
<p>Search context: <br>
Catalogs implement the Composition resource and entries of a catalog are represented by CatalogEntry resources referenced by section.entry elements of the Composition. In the Catalog profile of Composition, section.entry is constrained to Reference(CatalogEntry).<br>
I want to get all CatalogEntry resources referenced by section Hematology (LOINC 18723-7) of the catalog of id 4. Is the expression below syntactically correct and fit for this purpose?<br>
GET [base]/CatalogEntry?_has:composition.where(id = 4).section.where(code.coding.where(system = %loinc and code = 18716-1))</p>



<a name="153977272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977272">(Jul 23 2018 at 11:23)</a>:</h4>
<p>No, the URL-style query syntax is not integrated like this within FHIRPath.</p>
<p>The only way to do "anything" with http directly, is the resolve() call, but this has to resolve to a single URL, e.g. <code>resolve('http://example.org/Patient/1').name.given</code>. </p>
<p>Also, remember there's no concept of a "server" against which you execute the FHIRPath, it is evaluated against an (abstract) "instance", e.g. a single resource in FHIR.  </p>
<p>Conceivably though, we could introduce a function http-get(string) that can return a bundle, which would be interpreted as a collection: <code>httpget('http://example.org/Patient?name=macary')</code></p>
<p>In practice, you'd need more setup, since the server probably requires authentication and the like - all of this currently outside the scope of FHIRPath.</p>



<a name="153977279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> François Macary <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977279">(Jul 23 2018 at 11:49)</a>:</h4>
<p>Sorry Ewout, my topic title was maybe misleading.<br>
My intent is not to embed URL-style syntax within FHIRPath but the other way round:<br>
I understoodd that FhirPath is usable to express search parameters. So I thought I could leverage a fhirpath expression embedded in my search parameter, which happens to use reverse chaining. <br>
My hope was that the fhirpath expression "composition.where(id = 4).section.where(code.coding.where(system = %loinc and code = xxxx-x))" would have specified the reverse chaining I wanted in my RESTful search: "get resources referenced by Hematology section of catalog 4."<br>
I'm on the server side and my plan was to implement this search with this syntax.<br>
If this does not work, then how is FHIRPath usable in search parameters? <br>
Thank you.</p>



<a name="153977280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977280">(Jul 23 2018 at 11:54)</a>:</h4>
<p>what we say is that the API names search parameters so that the server can prepare the index in advance. it doesn't have to, of course. but that's why named parameters.</p>



<a name="153977281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977281">(Jul 23 2018 at 11:55)</a>:</h4>
<p>we also provide search parmaeter definitions that have fhirpath for the parameters so they can be built automatically.</p>



<a name="153977282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977282">(Jul 23 2018 at 11:55)</a>:</h4>
<p>but that's private to the server, whether it wants to do that or not</p>



<a name="153977303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> François Macary <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977303">(Jul 23 2018 at 14:38)</a>:</h4>
<p>Thank you Grahame.  I'm still struggling with search parameters.<br>
So given my current purpose: Search for CatalogEntry resources referenced under section coded xxx of Composition/4<br>
I might solve it by naming a new composite search parameter for the CatalogEntry resource , which captures the two values _id of the Composition resource and the code of section referencing. <br>
My search would then look like this: GET [base]/CatalogEntry?in-catalog-section=4$18716-1<br>
Sorry for being in the wrong stream, now.</p>



<a name="153977392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977392">(Jul 23 2018 at 22:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span> I wonder if this is beyond our existing paradigm?</p>



<a name="153977454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977454">(Jul 24 2018 at 02:09)</a>:</h4>
<p>Would we follow standard convention and allow "foo ' bar" and 'foo " bar' to be legal, but not "foo bar' or 'foo bar"?</p>



<a name="153977456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977456">(Jul 24 2018 at 02:23)</a>:</h4>
<p>I would think so.  Basically, either of ' or " starts the string and you keep going until you find the 2nd occurrence of the character.</p>



<a name="153977466"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977466" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977466">(Jul 24 2018 at 04:35)</a>:</h4>
<p>yes that makes sense. but it's procedurally difficult</p>



<a name="153977497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977497">(Jul 24 2018 at 07:08)</a>:</h4>
<blockquote>
<p>Would we follow standard convention and allow "foo ' bar" and 'foo " bar' to be legal, but not "foo bar' or 'foo bar"?</p>
</blockquote>
<p>I thought we fixed strings to always use 'xxxxx', since "yyyyy" is an escape for property names. Has that changed?</p>



<a name="153977498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977498">(Jul 24 2018 at 07:15)</a>:</h4>
<p>no it hasn't but I'm finding that it's enduringly painful for me and others who are all confused.... wastes lots of my time</p>



<a name="153977499"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977499" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977499">(Jul 24 2018 at 07:31)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span> I wonder if this is beyond our existing paradigm?</p>
</blockquote>
<p>You mean defining search parameters using a FHIRPath expression, where reverse chaining is involved?  Yes that's outside, currently we have a single instance in scope - and so doing:</p>
<p>Composition.where(id = 4).section.where(...).entry.ofType(Reference).resolve().ofType(CatalogEntry) would only work if you already had the Composition in scope to begin with.</p>
<p>You'd need to switch to "Please bring all Compositions in scope, and then execute this".  Feels like what CQL does with "context Patient", "context Population"....</p>



<a name="153977501"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977501" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977501">(Jul 24 2018 at 07:36)</a>:</h4>
<p>In general, the way CQL uses the "Retrieve" construct to kind of pre-load the evaluation context seems like a good way to do it: <a href="https://github.com/HL7/cql/blob/master/spec/2018May/02-authorsguide.adoc#retrieve" target="_blank" title="https://github.com/HL7/cql/blob/master/spec/2018May/02-authorsguide.adoc#retrieve">https://github.com/HL7/cql/blob/master/spec/2018May/02-authorsguide.adoc#retrieve</a></p>



<a name="153977502"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977502" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977502">(Jul 24 2018 at 07:42)</a>:</h4>
<p>well, actually, I don't think that we can describe what Francois wants with our current search paradigm? (forget the FHIRPath bit)</p>



<a name="153977505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977505">(Jul 24 2018 at 08:49)</a>:</h4>
<p>It is possible in the current Search framework to express exactly what <span class="user-mention" data-user-id="192504">@François Macary</span> intended with his GET example but it is a bit ugly and requires a very specialized searchparameter.</p>
<p>A reverse chain (_has) can express two things:<br>
1. The searchparameter that must chain the two resources together. In the example the most matching standard searchparameter for that is Composition.entry.<br>
2. Filters on the referencing resource. In this example that is _id=4.<br>
So you can express:<br>
<code>GET [base]/Catalogentry?_has:Catalog:entry:_id=4</code><br>
That will return the requested CatalogEntry resources. But it will also include any resources referenced by entries in sections not having code http://loinc.org|18716-1.</p>
<p>So _has cannot express further filters to make a subselection of the references in the linking searchparameter (entry). And that is what is the intent here.</p>
<p>To solve that, you need a searchparameter that already expresses that filter, and use that in the _has. This would be a very specialized searchparameter Composition.hematology-entry, with (corrected) expression<br>
<code>Composition.section.where(code.coding.where(system="http://loinc.org" and code="18716-1")).entry</code><br>
The resulting GET would then be:<br>
<code>GET [base]/CatalogEntry?_has:Catalog:hematology-entry:_id=4</code></p>
<p>Note: Catalog and CatalogEntry are not (yet?) resourcetypes as far as I know, but to connect to the question I used them nonetheless.</p>



<a name="153977812"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977812" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977812">(Jul 25 2018 at 03:01)</a>:</h4>
<p>I'm not a fan of a search parameter definition with a resolve in it, means that if the referenced item changes, it could change the search index value that I generated at the time. Have we done this anywhere?</p>



<a name="153977815"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977815" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977815">(Jul 25 2018 at 03:05)</a>:</h4>
<p>no</p>



<a name="153977817"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FhirPath%20with%20reverse%20chaining/near/153977817" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FhirPath.20with.20reverse.20chaining.html#153977817">(Jul 25 2018 at 03:12)</a>:</h4>
<p>phew, I didn't think we would have.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
