---
layout: page
title: "FHIR Chat  · do all functions work on repeating fields? · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html">do all functions work on repeating fields?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="275502979"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/do%20all%20functions%20work%20on%20repeating%20fields%3F/near/275502979" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html#275502979">(Mar 16 2022 at 12:25)</a>:</h4>
<p>In our implementation, only certain functions will work on repeating fields (i.e. an "input collection" with more than one item).  <br>
I am never sure if this is correct or not...are all functions supposed to work over multiple elements?<br>
If not, is there a way to tell if a function <em>should</em> work over multiple inputs?</p>
<p>Recently this came up on <a href="#narrow/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug">https://chat.fhir.org/#narrow/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug</a> and so I thought that would be a good example to drive discussion.</p>



<a name="275517442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/do%20all%20functions%20work%20on%20repeating%20fields%3F/near/275517442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html#275517442">(Mar 16 2022 at 14:24)</a>:</h4>
<p>In the type system, yes, everything is a collection, but certain functions require singleton collections, as documented in the signature of the function. From the <a href="https://hl7.org/fhirpath/#functions">Functions</a> topic: </p>
<blockquote>
<p>If the function expects the argument passed to a parameter to be a single value (e.g. startsWith(prefix: String)) and it is passed an argument that evaluates to a collection with multiple items, or to a collection with an item that is not of the required type (or cannot be converted to the required type), the evaluation of the expression will end and an error will be signaled to the calling environment.</p>
</blockquote>



<a name="275517586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/do%20all%20functions%20work%20on%20repeating%20fields%3F/near/275517586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html#275517586">(Mar 16 2022 at 14:25)</a>:</h4>
<p>So if the signature indicates the argument is of some type, rather than a <code>collection</code>, then it expects a singleton of that type.</p>



<a name="275532403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/do%20all%20functions%20work%20on%20repeating%20fields%3F/near/275532403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html#275532403">(Mar 16 2022 at 15:58)</a>:</h4>
<p>thanks Bryn.  I read that section as being specific to the arguments/parameters of a function (passed within <code>()</code>) and not to the input collection.  is that wrong?</p>



<a name="275535269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/do%20all%20functions%20work%20on%20repeating%20fields%3F/near/275535269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html#275535269">(Mar 16 2022 at 16:12)</a>:</h4>
<p>In some cases, the function definition explicitly states that an input collection must have a single item.<br>
For example, for <code>toString() : String</code> it says:</p>
<blockquote>
<p>If the input collection contains multiple items, the evaluation of the expression will end and signal an error to the calling environment.</p>
</blockquote>



<a name="275535430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/do%20all%20functions%20work%20on%20repeating%20fields%3F/near/275535430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html#275535430">(Mar 16 2022 at 16:13)</a>:</h4>
<p>But other methods, like <code>length() : Integer</code> have no indication one way or the other</p>
<blockquote>
<p>Returns the length of the input string. If the input collection is empty ({ }), the result is empty.</p>
</blockquote>



<a name="275535481"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/do%20all%20functions%20work%20on%20repeating%20fields%3F/near/275535481" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html#275535481">(Mar 16 2022 at 16:14)</a>:</h4>
<p>What should <code>length()</code> do if the input is a collection?</p>



<a name="275537908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/do%20all%20functions%20work%20on%20repeating%20fields%3F/near/275537908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F.html#275537908">(Mar 16 2022 at 16:27)</a>:</h4>
<p>FWIW there are just a few functions that don't define what they should do (I thought there were more)...so maybe the answer is to open a JIRA so that we can get clarifications on each one individually?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
