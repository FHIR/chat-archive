---
layout: page
title: "FHIR Chat  · &#x27;memberOf&#x27; function not implemented yet · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html">&#x27;memberOf&#x27; function not implemented yet</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="182609685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182609685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182609685">(Dec 04 2019 at 23:00)</a>:</h4>
<p>The Validator and FHIRPathEngine now seem to be attempting to fully validate ElementDefinition.constraint.expression (which apparently wasn't the case before), resulting in a new error when I build the IPS IG, as the constraint expression that we had in Patient.address.country wasn't actually a valid FHIRPath expression.  The human readable for the constraint is "The content of this element SHALL be selected EITHER from ValueSet ISO Country Alpha-2 <a href="http://hl7.org/fhir/ValueSet/iso3166-1-2" target="_blank" title="http://hl7.org/fhir/ValueSet/iso3166-1-2">http://hl7.org/fhir/ValueSet/iso3166-1-2</a> OR MAY be selected from ISO Country Alpha-3 Value Set <a href="http://hl7.org/fhir/ValueSet/iso3166-1-3" target="_blank" title="http://hl7.org/fhir/ValueSet/iso3166-1-3">http://hl7.org/fhir/ValueSet/iso3166-1-3</a>, IF the country is not specified in value Set ISO Country Alpha-2 <a href="http://hl7.org/fhir/ValueSet/iso3166-1-2" target="_blank" title="http://hl7.org/fhir/ValueSet/iso3166-1-2">http://hl7.org/fhir/ValueSet/iso3166-1-2</a>."  I attempted to change it to what I think should be a valid FHIRPath expression:<br>
<code>Patient.address.country.memberOf('http://hl7.org/fhir/ValueSet/iso3166-1-2') or (Patient.address.country.memberOf('http://hl7.org/fhir/ValueSet/iso3166-1-2').not() and Patient.address.country.memberOf('http://hl7.org/fhir/ValueSet/iso3166-1-3'))</code><br>
But when the IG Publisher attempts to execute the expression it gives this error, indicating that memberOf (documented <a href="http://build.fhir.org/fhirpath.html#functions" target="_blank" title="http://build.fhir.org/fhirpath.html#functions">here</a>) hasn't been implemented:</p>
<div class="codehilite"><pre><span></span>Validating Resources                                                             (00:30.0782)
 .. validate /Users/rhausam/git-repo/fhir-ips/resources/ig-uv-ips                (00:30.0782)
 .. /Users/rhausam/git-repo/fhir-ips/resources/ig-uv-ips                         (00:30.0782)
 .. validate /Users/rhausam/git-repo/fhir-ips/examples/IPS-bundle-01             (00:30.0782)
 .. /Users/rhausam/git-repo/fhir-ips/examples/IPS-bundle-01                      (00:30.0782)
     validating Bundle/IPS-examples-Bundle-01                                    (00:30.0782)
Exception in thread &quot;main&quot; java.lang.Error: not Implemented yet
    at org.hl7.fhir.r5.utils.FHIRPathEngine.funcMemberOf(FHIRPathEngine.java:2853)
    at org.hl7.fhir.r5.utils.FHIRPathEngine.evaluateFunction(FHIRPathEngine.java:2735)
    at org.hl7.fhir.r5.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1147)
    at org.hl7.fhir.r5.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1161)
    at org.hl7.fhir.r5.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1161)
    at org.hl7.fhir.r5.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1161)
    at org.hl7.fhir.r5.utils.FHIRPathEngine.evaluate(FHIRPathEngine.java:546)
    at org.hl7.fhir.r5.utils.FHIRPathEngine.evaluateToBoolean(FHIRPathEngine.java:614)
    at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariant(InstanceValidator.java:4558)
    at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariants(InstanceValidator.java:4533)
    at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariants(InstanceValidator.java:4424)
    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:4148)
    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:4069)
    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:4252)
    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:4069)
    at org.hl7.fhir.r5.validation.InstanceValidator.start(InstanceValidator.java:2998)
    at org.hl7.fhir.r5.validation.InstanceValidator.validateResource(InstanceValidator.java:4665)
    at org.hl7.fhir.r5.validation.InstanceValidator.validateContains(InstanceValidator.java:3976)
    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:4175)
    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:4069)
    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:4180)
    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:4069)
    at org.hl7.fhir.r5.validation.InstanceValidator.start(InstanceValidator.java:2977)
    at org.hl7.fhir.r5.validation.InstanceValidator.validateResource(InstanceValidator.java:4665)
    at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:846)
    at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:806)
    at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:3972)
    at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:3949)
    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:773)
    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:656)
    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6637)
</pre></div>


<p>I assume this is a known issue?  Maybe there is a reasonable way to work around this in FHIRPath and still be able to validate that a code is (or isn't) a member of a particular value set? <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>, or anyone?</p>



<a name="182610358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182610358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182610358">(Dec 04 2019 at 23:09)</a>:</h4>
<p>I don't actually understand the fHIRPath. a or a.not or b?</p>



<a name="182610374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182610374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182610374">(Dec 04 2019 at 23:09)</a>:</h4>
<p>I don't think the terminology server understands those value sets anyway?</p>



<a name="182611262"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182611262" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182611262">(Dec 04 2019 at 23:23)</a>:</h4>
<p>it's actually "a or (a.not and b)"<br>
so it's usually expected to be a, but if it isn't a then it must be b - which I think should make sense</p>



<a name="182611477"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182611477" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182611477">(Dec 04 2019 at 23:26)</a>:</h4>
<p>if we need to add support for the code systems / value sets in the terminology server then we should be able to do that - but if we aren't able to check for value set membership then that's not going to help (at least not immediately)</p>



<a name="182612199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182612199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182612199">(Dec 04 2019 at 23:36)</a>:</h4>
<p>Actually the FHIRPath probably might as well be just "a or b" - the "(a.not and b)" doesn't add anything over just "b" here.  Ideally you would want to determine if a particular 3 character code also has a corresponding 2 character code which should be chosen instead, but I don't see an obvious way to do that (unless there is a way with %terminologies.translate, but that might not be supported either?).  So if we don't attempt to enforce that aspect then the expression logic is considerably simpler - but the issue of checking the value set membership still remains.</p>



<a name="182653200"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182653200" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marco Visser <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182653200">(Dec 05 2019 at 12:13)</a>:</h4>
<p>So, if I understand correctly with the following example:</p>
<div class="codehilite"><pre><span></span>&lt;Bundle xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  &lt;id value=&quot;bundle1234&quot;/&gt;
  &lt;type value=&quot;searchset&quot;/&gt;
  &lt;entry&gt;
    &lt;resource&gt;
      &lt;Patient&gt;   &lt;!-- %rootResource --&gt;
        &lt;contained&gt;
            &lt;RelatedPerson&gt;     &lt;!-- %resource --&gt;
                &lt;id value=&quot;rel0304&quot;/&gt;
                &lt;!--    snip    --&gt;
            &lt;/RelatedPerson&gt;
        &lt;/contained&gt;
        &lt;id value=&quot;pat3123&quot;/&gt;
        &lt;!--    snip    --&gt;
      &lt;/Patient&gt;
    &lt;/resource&gt;
  &lt;/entry&gt;
  &lt;!--    snip    --&gt;
&lt;/Bundle&gt;
</pre></div>


<p>&lt;Patient&gt; is %rootResource and &lt;RelatedPerson&gt; is %resource ?</p>



<a name="182653318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182653318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182653318">(Dec 05 2019 at 12:15)</a>:</h4>
<p>RelatedPerson&gt; is %resource<em>if the FHIRPath is run in the context of RelatedPerson</em>, yes</p>



<a name="182653352"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182653352" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marco Visser <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182653352">(Dec 05 2019 at 12:16)</a>:</h4>
<p>Thanks Grahame!</p>



<a name="182657662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182657662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182657662">(Dec 05 2019 at 13:15)</a>:</h4>
<p>Anything more on memberOf?  Or any possible workarounds in its absence? <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="182905387"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182905387" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182905387">(Dec 08 2019 at 19:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> , if I'm understanding correctly, the logic you want is actually an <code>xor</code>. As far as memberOf, if that is not implemented, you could try <code>%terminologies.validateVS</code>, though that usage is documented as draft.</p>



<a name="182912718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182912718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182912718">(Dec 08 2019 at 22:52)</a>:</h4>
<p>I don't think 'xor' will provide anything useful here.  The value sets are mutually exclusive ( a code is either 2-char or 3-char), and even if they overlapped I don't think you would want to exclude codes that were members of both.  Actually I think what would be useful is the value set of 3-char codes without a 2-char equivalent, and then the logic would be "2-char" <strong>or</strong> "3-char without 2-char equivalent".  I agree that %terminologies.validateVS() should also work for this, but I assumed it was even less likely to be implemented than memberOf (because as you say it's documented as draft).  But I can check that out.</p>



<a name="182950346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182950346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182950346">(Dec 09 2019 at 12:24)</a>:</h4>
<p>have you got a good example set (profile, valid resource, invalid resource)?</p>



<a name="182952280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182952280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182952280">(Dec 09 2019 at 12:55)</a>:</h4>
<p>Well, maybe - but I'm not entirely sure if I know what you want in this case.  Nothing that I have now is provably valid from the build perspective because memberOf isn't implemented (and I haven't had a chance yet to try %terminologies.validateVS).  There definitely are invalid and potentially valid versions of the profile.</p>



<a name="182989289"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182989289" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182989289">(Dec 09 2019 at 19:16)</a>:</h4>
<p>so I was asking because I was thinking of implementing memberOf but that means I need test cases</p>



<a name="182996413"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/182996413" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#182996413">(Dec 09 2019 at 20:29)</a>:</h4>
<p>Sure.  Let me do a little more work so that the logic actually does what we're looking for and I'll send you a set.</p>



<a name="185152724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/185152724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#185152724">(Jan 08 2020 at 20:21)</a>:</h4>
<p>Has this been implemented?  I'm no longer getting an error in the IG build when I use memberOf in the constraint expression, but I didn't see anything in the recent FHIRPath commits that addressed it (maybe I missed it).  <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>?  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>?</p>



<a name="185248326"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/185248326" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#185248326">(Jan 09 2020 at 19:48)</a>:</h4>
<p>I think it's implemented. org.hl7.fhir.r5.utils.FHIRPathEngine L1887</p>



<a name="185253331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/185253331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#185253331">(Jan 09 2020 at 20:41)</a>:</h4>
<p>Yes, it appears that it is, as it's working.  Do you know when that was done?</p>



<a name="185253970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/185253970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#185253970">(Jan 09 2020 at 20:48)</a>:</h4>
<p>a few weeks back...?</p>



<a name="186260667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186260667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186260667">(Jan 22 2020 at 06:55)</a>:</h4>
<p>I'm no longer getting the build error, but the memberOf function doesn't appear to be working.  I'm getting this warning:</p>
<div class="codehilite"><pre><span></span>== /Users/rhausam/git-repo/fhir-ips/examples/patient-example-female.xml ==
WARNING: Patient/patient-example-female: Patient.address[0].country: pat-cnt-2or3-char: The content of this element SHALL be selected EITHER from ValueSet ISO Country Alpha-2 http://hl7.org/fhir/ValueSet/iso3166-1-2 OR MAY be selected from ISO Country Alpha-3 Value Set http://hl7.org/fhir/ValueSet/iso3166-1-3, IF the country is not specified in value Set ISO Country Alpha-2 http://hl7.org/fhir/ValueSet/iso3166-1-2. [Patient.address.country.memberOf(&#39;http://hl7.org/fhir/ValueSet/iso3166-1-2&#39;) or Patient.address.country.memberOf(&#39;http://hl7.org/fhir/ValueSet/iso3166-1-3&#39;)]
</pre></div>


<p>when I validate this example instance in the build (or separately with the standalone validator):</p>
<div class="codehilite"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
    &lt;id value=&quot;patient-example-female&quot;/&gt;
    &lt;identifier&gt;
        &lt;system value=&quot;urn:oid:2.16.840.1.113883.2.4.6.3&quot;/&gt;
        &lt;value value=&quot;574687583&quot;/&gt;
    &lt;/identifier&gt;
    &lt;active value=&quot;true&quot;/&gt;
    &lt;name&gt;
        &lt;family value=&quot;DeLarosa&quot;/&gt;
        &lt;given value=&quot;Martha&quot;/&gt;
    &lt;/name&gt;
    &lt;telecom&gt;
        &lt;system value=&quot;phone&quot;/&gt;
        &lt;value value=&quot;+31788700800&quot;/&gt;
        &lt;use value=&quot;home&quot;/&gt;
    &lt;/telecom&gt;
    &lt;gender value=&quot;female&quot;/&gt;
    &lt;birthDate value=&quot;1992-05-01&quot;/&gt;
    &lt;address&gt;
        &lt;line value=&quot;Laan Van Europa 1600&quot;/&gt;
        &lt;city value=&quot;Dordrecht&quot;/&gt;
        &lt;postalCode value=&quot;3317 DB&quot;/&gt;
        &lt;country value=&quot;NL&quot;/&gt;
    &lt;/address&gt;
    &lt;contact&gt;
        &lt;relationship&gt;
            &lt;coding&gt;
                &lt;system value=&quot;http://terminology.hl7.org/CodeSystem/v3-RoleCode&quot;/&gt;
                &lt;code value=&quot;MTH&quot;/&gt;
            &lt;/coding&gt;
        &lt;/relationship&gt;
        &lt;name&gt;
            &lt;family value=&quot;Mum&quot;/&gt;
            &lt;given value=&quot;Martha&quot;/&gt;
        &lt;/name&gt;
        &lt;telecom&gt;
            &lt;system value=&quot;phone&quot;/&gt;
            &lt;value value=&quot;+33-555-20036&quot;/&gt;
            &lt;use value=&quot;home&quot;/&gt;
        &lt;/telecom&gt;
        &lt;address&gt;
            &lt;line value=&quot;Promenade des Anglais 111&quot;/&gt;
            &lt;city value=&quot;Lyon&quot;/&gt;
            &lt;postalCode value=&quot;69001&quot;/&gt;
            &lt;country value=&quot;FR&quot;/&gt;
        &lt;/address&gt;
    &lt;/contact&gt;
&lt;/Patient&gt;
</pre></div>


<p>The code 'NL' is in fact a valid member of the <a href="http://hl7.org/fhir/valueset-iso3166-1-2.html" target="_blank" title="http://hl7.org/fhir/valueset-iso3166-1-2.html">iso3166-1-2</a> value set, so I believe the expression should be evaluating to true and no warning should be generated. <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>? <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>?</p>



<a name="186274699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186274699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186274699">(Jan 22 2020 at 10:50)</a>:</h4>
<p>MemberOf is working. I presume this means there’s a problem on the terminology server.</p>



<a name="186291851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186291851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186291851">(Jan 22 2020 at 14:39)</a>:</h4>
<p>Ok.  Not sure yet what that problem is, since the 3166 value sets are displayed properly in the core build, but I will check further.</p>



<a name="186293522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186293522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186293522">(Jan 22 2020 at 14:57)</a>:</h4>
<p>Hmm.  Posting GET `http://tx.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/iso3166-1-2' works fine, with 'NL' being returned as expected in the expansion.  So it doesn't seem like a terminology server error?  If memberOf is working (however you test it), is it a problem with the evaluation of the FHIRPath expression?  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>? <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>?</p>



<a name="186333433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186333433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186333433">(Jan 22 2020 at 21:34)</a>:</h4>
<p>I’ll investigate tomorrow</p>



<a name="186333492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186333492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186333492">(Jan 22 2020 at 21:35)</a>:</h4>
<p>sounds good - thanks</p>



<a name="186465525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186465525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186465525">(Jan 24 2020 at 05:52)</a>:</h4>
<p>looks like it works for me. Check these test cases - do you think I missed something? -<br>
<a href="https://github.com/FHIR/fhir-test-cases/commit/7a96f17241afb25b94c0db2226a6216df1f090cb" target="_blank" title="https://github.com/FHIR/fhir-test-cases/commit/7a96f17241afb25b94c0db2226a6216df1f090cb">https://github.com/FHIR/fhir-test-cases/commit/7a96f17241afb25b94c0db2226a6216df1f090cb</a></p>



<a name="186467091"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186467091" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186467091">(Jan 24 2020 at 06:34)</a>:</h4>
<p>I just did a fresh build with 1.0.47-SNAPSHOT and I'm still getting the warning:</p>
<div class="codehilite"><pre><span></span>WARNING: Patient/patient-example-female: Patient.address[0].country: pat-cnt-2or3-char: The content of this element SHALL be selected EITHER from ValueSet ISO Country Alpha-2 http://hl7.org/fhir/ValueSet/iso3166-1-2 OR MAY be selected from ISO Country Alpha-3 Value Set http://hl7.org/fhir/ValueSet/iso3166-1-3, IF the country is not specified in value Set ISO Country Alpha-2 http://hl7.org/fhir/ValueSet/iso3166-1-2. [Patient.address.country.memberOf(&#39;http://hl7.org/fhir/ValueSet/iso3166-1-2&#39;) or Patient.address.country.memberOf(&#39;http://hl7.org/fhir/ValueSet/iso3166-1-3&#39;)]
</pre></div>


<p>Your test cases look fine to me.  You are testing exactly what we are doing in IPS, so I don't see why it would be working for you and not for us.  Can you check it in IPS, and see if you get the same warning on patient-example-female.xml as we do?</p>



<a name="186583542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186583542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186583542">(Jan 25 2020 at 18:33)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I assume you haven't had a chance yet to look at this again?  Let me know if you don't see the issue.</p>



<a name="186616498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186616498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186616498">(Jan 26 2020 at 10:57)</a>:</h4>
<p>I don't see the issue. Is it a txCache issue?</p>



<a name="186618524"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186618524" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186618524">(Jan 26 2020 at 11:58)</a>:</h4>
<p>no I do see it and it's a context issue. The context of the expression is Patient.address.country, but the expression is <code>Patient.address.country.memberOf('http://hl7.org/fhir/ValueSet/iso3166-1-2') or Patient.address.country.memberOf('http://hl7.org/fhir/ValueSet/iso3166-1-3')</code></p>
<p>The path is doubled up</p>



<a name="186638227"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186638227" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186638227">(Jan 26 2020 at 21:08)</a>:</h4>
<p>oh, that's interesting - makes sense in retrospect<br>
I guess hadn't thought about whether stating the entire Patient.address.country context was correct (it was already there that way)<br>
that's good to know - thanks</p>



<a name="186653816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186653816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186653816">(Jan 27 2020 at 05:12)</a>:</h4>
<p>Unfortunately, I'm getting the same exact warning message whether I include the 'Patient.address.country.' part of the path in the expression or not:</p>
<div class="codehilite"><pre><span></span>WARNING: Patient/patient-example-female: Patient.address[0].country: pat-cnt-2or3-char: The content of this element SHALL be selected EITHER from ValueSet ISO Country Alpha-2 http://hl7.org/fhir/ValueSet/iso3166-1-2 OR MAY be selected from ISO Country Alpha-3 Value Set http://hl7.org/fhir/ValueSet/iso3166-1-3, IF the country is not specified in value Set ISO Country Alpha-2 http://hl7.org/fhir/ValueSet/iso3166-1-2. [memberOf(&#39;http://hl7.org/fhir/ValueSet/iso3166-1-2&#39;) or memberOf(&#39;http://hl7.org/fhir/ValueSet/iso3166-1-3&#39;)]
</pre></div>


<p>Is there something else that's different?</p>



<a name="186653832"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186653832" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186653832">(Jan 27 2020 at 05:13)</a>:</h4>
<p>I'll double check the txCache.</p>



<a name="186654544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186654544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186654544">(Jan 27 2020 at 05:32)</a>:</h4>
<p>Deleting and re-creating the iso3166 cache by the publisher makes no difference - the cache file has no content.</p>



<a name="186696253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/%27memberOf%27%20function%20not%20implemented%20yet/near/186696253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/&#x27;memberOf&#x27;.20function.20not.20implemented.20yet.html#186696253">(Jan 27 2020 at 16:06)</a>:</h4>
<p>thanks for fixing this - it looks good now!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
