---
layout: page
title: "FHIR Chat  · Selecting from distinct collection in a specified order · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Selecting.20from.20distinct.20collection.20in.20a.20specified.20order.html">Selecting from distinct collection in a specified order</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="230058341"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Selecting%20from%20distinct%20collection%20in%20a%20specified%20order/near/230058341" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Selecting.20from.20distinct.20collection.20in.20a.20specified.20order.html#230058341">(Mar 12 2021 at 16:27)</a>:</h4>
<p>Hi <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> I was playing around with FHIRPath and trying to come up with an expression for reducing a CodeableConcept to a string. The logic I want involves preferences, e.g.</p>
<ol>
<li>if there are codes that are use selected, take the first display value from those</li>
<li>otherwise, if there are codes from code systems I know, take the display string of the first of those</li>
<li>otherwise take <code>CodeableConcept.text </code></li>
</ol>
<p>The generic logic here is I have several expressions that each yield a collection (possibly empty) and I want to go through those collections in a specified order and pick some element from the first non-empty collection. If these were arrays, I would concatenate them in the required order and take the first element, but the <code>union</code> operator does not guarantee to maintain the ordering. I can think of a few very ugly solutions - are there any elegant ones?</p>



<a name="230058606"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Selecting%20from%20distinct%20collection%20in%20a%20specified%20order/near/230058606" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Selecting.20from.20distinct.20collection.20in.20a.20specified.20order.html#230058606">(Mar 12 2021 at 16:28)</a>:</h4>
<p>my first thought is iif() chaining but that could be quite messy and long for all the processing you want to do</p>



<a name="230059895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Selecting%20from%20distinct%20collection%20in%20a%20specified%20order/near/230059895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Selecting.20from.20distinct.20collection.20in.20a.20specified.20order.html#230059895">(Mar 12 2021 at 16:36)</a>:</h4>
<p>Yup, that should work. I did consider it, but I was hoping for something that would avoid this sort of nesting and be more functional-style (a hope I could not make come true myself by reading the spec <span aria-label="smirk" class="emoji emoji-1f60f" role="img" title="smirk">:smirk:</span> )</p>



<a name="230074254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Selecting%20from%20distinct%20collection%20in%20a%20specified%20order/near/230074254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Selecting.20from.20distinct.20collection.20in.20a.20specified.20order.html#230074254">(Mar 12 2021 at 18:13)</a>:</h4>
<p>Using a unions of firsts should work, but it would be long. It's a prime candidate for a function, but given that you're looking for "code systems you know" it couldn't be a standard function (unless everyone agreed what that meant).</p>



<a name="230074701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Selecting%20from%20distinct%20collection%20in%20a%20specified%20order/near/230074701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Selecting.20from.20distinct.20collection.20in.20a.20specified.20order.html#230074701">(Mar 12 2021 at 18:16)</a>:</h4>
<p>but how do you differentiate between the three preferred options in that union'd set?</p>



<a name="230075951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Selecting%20from%20distinct%20collection%20in%20a%20specified%20order/near/230075951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Selecting.20from.20distinct.20collection.20in.20a.20specified.20order.html#230075951">(Mar 12 2021 at 18:26)</a>:</h4>
<p>Mmmm, yes, that's true, sorry. Yep, iif. We considered coalesce(), like CQL has, but opted against it since it was shorthand for iif.</p>



<a name="241684083"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Selecting%20from%20distinct%20collection%20in%20a%20specified%20order/near/241684083" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Selecting.20from.20distinct.20collection.20in.20a.20specified.20order.html#241684083">(Jun 06 2021 at 10:05)</a>:</h4>
<p>(coding.where(system="blah").code | coding.where(system="blah_2nd").code | coding.where(system="3rd_system").code ).first()</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
