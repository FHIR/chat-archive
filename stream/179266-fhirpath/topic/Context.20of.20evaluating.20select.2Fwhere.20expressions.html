---
layout: page
title: "FHIR Chat  · Context of evaluating select/where expressions · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Context.20of.20evaluating.20select.2Fwhere.20expressions.html">Context of evaluating select/where expressions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="222906604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Context%20of%20evaluating%20select/where%20expressions/near/222906604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Context.20of.20evaluating.20select.2Fwhere.20expressions.html#222906604">(Jan 15 2021 at 18:55)</a>:</h4>
<p>I tried looking through the spec to see if there was specific guidance towards this and I didn't notice any, but my question revolves around methods like .contains() and .single() that require the input collection to be one item. <br>
If you put those types of methods into a select() or where() as parameters, are those supposed to resolve without error if the input collection <em>to the select method</em> has multiple items.<br>
For an esoteric example Patient.name.given.select($this.single()) - In my interpretation of the spec this would be equivalent to Patient.name.given as the context that single() is being run in mean that it wouldn't know of any more than one item at a time.<br>
For a more nuanced example Patient.name.given.select($this.contains('Ryan')) - the substring match would normally fail vs an array of names (say, there is a usual "Ryan M" an official "Ryan Moehrke") But again, in my interpretation the select() would allow the contains() method to run against each item individually and get back a list of 'Ryan's that I could assert exist</p>
<p>I bring this up because my quick go-to fhirpath evaluator for testing out my wild theories (<a href="https://hl7.github.io/fhirpath.js/">https://hl7.github.io/fhirpath.js/</a>) does not work this way, both of my examples here throw errors and I honestly don't know who is right..</p>



<a name="224528519"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Context%20of%20evaluating%20select/where%20expressions/near/224528519" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Context.20of.20evaluating.20select.2Fwhere.20expressions.html#224528519">(Jan 29 2021 at 20:28)</a>:</h4>
<p>Now that work group week is mostly over, can I get a read on this?</p>



<a name="224537301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Context%20of%20evaluating%20select/where%20expressions/near/224537301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Context.20of.20evaluating.20select.2Fwhere.20expressions.html#224537301">(Jan 29 2021 at 21:39)</a>:</h4>
<p>My read is that you're correct, but I'm not an expert.  <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="195344">@Paul Lynch</span></p>



<a name="224541219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Context%20of%20evaluating%20select/where%20expressions/near/224541219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Context.20of.20evaluating.20select.2Fwhere.20expressions.html#224541219">(Jan 29 2021 at 22:07)</a>:</h4>
<p>That looks like a bug in fhirpath.js to me.  Patient.name.given.select(length) works, but Patient.name.given.select($this.length) does not work correctly.  I think $this is set to all of "given", but should be each item.</p>



<a name="224595028"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Context%20of%20evaluating%20select/where%20expressions/near/224595028" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Context.20of.20evaluating.20select.2Fwhere.20expressions.html#224595028">(Jan 30 2021 at 17:16)</a>:</h4>
<p>Yes, <span class="user-mention" data-user-id="237342">@ryan moehrke</span>, you are correct, the <code>$this</code> is an iterator variable and only contains the item in the current iteration.</p>



<a name="224723694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Context%20of%20evaluating%20select/where%20expressions/near/224723694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Context.20of.20evaluating.20select.2Fwhere.20expressions.html#224723694">(Feb 01 2021 at 13:18)</a>:</h4>
<p>We will try to get a fix for this into fhirpath.js, but it might be a couple of weeks.</p>



<a name="225102839"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Context%20of%20evaluating%20select/where%20expressions/near/225102839" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Context.20of.20evaluating.20select.2Fwhere.20expressions.html#225102839">(Feb 04 2021 at 00:15)</a>:</h4>
<p><span class="user-mention" data-user-id="237342">@ryan moehrke</span> This is now fixed in version 2.7.3 of fhirpath.js.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
