---
layout: page
title: "FHIR Chat  · variables · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html">variables</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="170506484"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170506484" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170506484">(Jul 10 2019 at 02:13)</a>:</h4>
<p>I'm updating the .net fhirpath engine to handle variables for the Questionnaire pre-population code and was wondering if others have already tackled this problem in the java/js implementations?<br>
I'm expecting that these are to be passed into the evaluation engine and referenced in the same way that environment variables are, using the %varname syntax.<br>
My question is around the behaviour if a variable is referneced that doesn't exist in the engine?<br>
Should that throw an Argument exception, or do null propagation.</p>



<a name="170506604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170506604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170506604">(Jul 10 2019 at 02:16)</a>:</h4>
<p>My test example is a simple Pythagoras calculation (which could be an invariant) where the variables haven't been defined.</p>
<div class="codehilite"><pre><span></span>%x * %x + %y * %y = %z * %z
</pre></div>



<a name="170509107"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170509107" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170509107">(Jul 10 2019 at 03:27)</a>:</h4>
<p>And while I'm on the topic, can the variables be collections rather than just single values (the current .net env vars are only single values)</p>



<a name="170509588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170509588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170509588">(Jul 10 2019 at 03:39)</a>:</h4>
<p>FYI The %ucum variable is one that is set for all environments/contexts</p>



<a name="170550279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170550279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170550279">(Jul 10 2019 at 15:16)</a>:</h4>
<p>For <a href="https://lhcforms.nlm.nih.gov/" target="_blank" title="https://lhcforms.nlm.nih.gov/">LHC-Forms</a>, there is an example with "weight" and "height" variables in the <a href="https://lhcforms.nlm.nih.gov/sdc" target="_blank" title="https://lhcforms.nlm.nih.gov/sdc">SDC app</a>.  Click on "Weight &amp; Height tracking panel", and then in the  "show as" menu, choose "FHIR Questionnaire from server".   Or, if you just want to see the definition, that is <a href="https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/weight-height-questionnaire.json" target="_blank" title="https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/weight-height-questionnaire.json">here</a>.</p>
<p>In our implementation, "variable" can hold the result of any FHIRPath expression.  If it is a structure, then you would need other FHIRPath expressions to pick out the pieces you wanted.</p>
<p>LHC-Forms relies on <a href="https://github.com/HL7/fhirpath.js/" target="_blank" title="https://github.com/HL7/fhirpath.js/">fhirpath.js</a> for FHIRPath expressions.  I just checked the source, and I implemented undefined variable names as resolving to the empty value, [ ].</p>



<a name="170579443"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170579443" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170579443">(Jul 10 2019 at 21:01)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="195344">@Paul Lynch</span> , that BMI calculation is pretty neat. I'll use it for my testing.</p>



<a name="170583236"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170583236" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170583236">(Jul 10 2019 at 22:02)</a>:</h4>
<p>I pass in an interface that provides services to the engine. variables that are not defined are compile time failures</p>



<a name="170584690"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170584690" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170584690">(Jul 10 2019 at 22:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I think your approach is correct.  The FHIRPath spec (May ballot) says, "Attempting to access an undefined environment variable will result in an error, but accessing a defined environment variable that does not have a value specified results in empty ({ })."</p>



<a name="170619853"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170619853" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170619853">(Jul 11 2019 at 10:13)</a>:</h4>
<p>The discussion we are having in the .NET team is: is the name/type/value of the variables supposed to be known at compile time, or just their name and type, so you can vary their value for each call to a compiled statement?</p>



<a name="170619951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170619951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170619951">(Jul 11 2019 at 10:14)</a>:</h4>
<p>I think we're talking about the second of these two?</p>



<a name="170622618"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170622618" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170622618">(Jul 11 2019 at 10:57)</a>:</h4>
<p>Yes, that's true.</p>



<a name="170638432"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170638432" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170638432">(Jul 11 2019 at 14:31)</a>:</h4>
<p>Since I'm working in JavaScript, I am not quite sure what it would mean to compile a FHIRPath expression, or at what point that would be done.  An author of a Questionnaire could set up a Questionnaire variable based on a FHIRPath expression that could return more than one type:</p>
<div class="codehilite"><pre><span></span>iif(today() &gt; @2020,  3,  &#39;why not?&#39;)
</pre></div>


<p>The questionnaire author has the responsibility make sure that what they are writing makes sense.  Whatever used that variable (e.g. other FHIRPath expressions) would need to handle the different types.<br>
Other the other hand, at the the time that multi-type variable was used in a subsequent FHIRPath expression, its type could be checked by the FHIRPath engine and known prior to evaluation (compile time?).  Maybe that is what you meant.  Certainly its value and type would not change during the evaluation (run time).  But, at each run, the type could be different.</p>



<a name="170652370"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170652370" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170652370">(Jul 11 2019 at 17:10)</a>:</h4>
<p>In theory, checking that the FHIRPath expressions make sense could be part of validation, and that would be the "compile-time". For questions that may have different types, at least the set of possible types is known, and that is handled with a choice type. Since the CQFramework's FHIRPath engine is part of the CQL Engine, there is a separate compile-time step, and that is where that checking would occur.</p>



<a name="170676645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/variables/near/170676645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/variables.html#170676645">(Jul 11 2019 at 22:01)</a>:</h4>
<p>I was not referring to a question having multiple types, but to Questionnaire <a href="https://www.hl7.org/fhir/extension-variable.html" target="_blank" title="https://www.hl7.org/fhir/extension-variable.html">variables</a>.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
