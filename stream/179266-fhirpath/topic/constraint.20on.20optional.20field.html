---
layout: page
title: "FHIR Chat  · constraint on optional field · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html">constraint on optional field</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="273280640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273280640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273280640">(Feb 25 2022 at 20:29)</a>:</h4>
<p>A lot of resources have a <code>name</code> field, and a warning regex that <code>name.matches('[A-Z]([A-Za-z0-9_]){0,254}')</code></p>
<p>My validation engine barfs on this when <code>name</code> is absent, because it says that this expression evaluates to <code>{}</code> which is not <code>true</code>.</p>
<p>Should this expression instead be <code>name.exists() implies name.matches('[A-Z]([A-Za-z0-9_]){0,254}')</code> ?</p>



<a name="273280714"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273280714" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273280714">(Feb 25 2022 at 20:29)</a>:</h4>
<p>Ex.: <a href="http://hl7.org/fhir/plandefinition-definitions.html#PlanDefinition">http://hl7.org/fhir/plandefinition-definitions.html#PlanDefinition</a></p>



<a name="273281152"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273281152" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273281152">(Feb 25 2022 at 20:33)</a>:</h4>
<p>Or else put the constraint on <code>name</code> rather than the root element</p>



<a name="273288767"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273288767" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273288767">(Feb 25 2022 at 21:46)</a>:</h4>
<p>As far as I can tell, this only exists on Questionnaire.  And yes, it should be fixed.  We can catch it in R4B if you submit a change request ASAP :)</p>



<a name="273290965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273290965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273290965">(Feb 25 2022 at 22:06)</a>:</h4>
<p>I saw it on a number of resources... did you see the plan def link I posted?</p>



<a name="273290978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273290978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273290978">(Feb 25 2022 at 22:06)</a>:</h4>
<p>will post a change request</p>



<a name="273291662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273291662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273291662">(Feb 25 2022 at 22:13)</a>:</h4>
<p>Yeah, it's present on all the canonicals, it's inherited from the base pattern.</p>



<a name="273291791"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273291791" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273291791">(Feb 25 2022 at 22:14)</a>:</h4>
<p>In most places it has some funky escaping in the source, which is why my search didn't find it.</p>



<a name="273292009"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273292009" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273292009">(Feb 25 2022 at 22:16)</a>:</h4>
<p>filed <a href="https://jira.hl7.org/browse/FHIR-36127">https://jira.hl7.org/browse/FHIR-36127</a> with a list of affected resources (as identified by my engine)</p>



<a name="273292052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273292052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273292052">(Feb 25 2022 at 22:17)</a>:</h4>
<p>Bryn - not sure I follow about inhereited - the expression exists on root elements, not on canonical</p>



<a name="273292138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273292138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273292138">(Feb 25 2022 at 22:18)</a>:</h4>
<p>also <code>name</code> is a <code>string</code>, not a <code>canonical</code>?  sorry if I misunderstand you</p>



<a name="273292587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273292587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273292587">(Feb 25 2022 at 22:20)</a>:</h4>
<p>I just mean that it's defined on the CanonicalResource that is the "base" for all the canonical resources:<br>
<a href="https://build.fhir.org/canonicalresource.html#invs">https://build.fhir.org/canonicalresource.html#invs</a></p>



<a name="273292614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273292614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273292614">(Feb 25 2022 at 22:20)</a>:</h4>
<p>So it's not really "inherited" per se, but that's the root definition of that invariant.</p>



<a name="273292759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273292759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273292759">(Feb 25 2022 at 22:22)</a>:</h4>
<p>huh #TIL</p>



<a name="273321183"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/273321183" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#273321183">(Feb 26 2022 at 06:02)</a>:</h4>
<p>And also another example of why I don't like {} not being interpreted as true.</p>



<a name="274592849"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/274592849" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#274592849">(Mar 08 2022 at 19:24)</a>:</h4>
<p>(<span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> this one)</p>



<a name="274593740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/274593740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#274593740">(Mar 08 2022 at 19:30)</a>:</h4>
<p>The presumption that "{}" equates to "false" creates issues with Questionnaire.enableWhen.  If you have an enableWhen statement of "@1970=@1970-12-15", it's much safer for that to evaluate to 'true' than to 'false'.</p>



<a name="274593765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/274593765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#274593765">(Mar 08 2022 at 19:30)</a>:</h4>
<p>But right now, it evaluates to {}, which means 'false'.</p>



<a name="274607123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/274607123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#274607123">(Mar 08 2022 at 21:07)</a>:</h4>
<p>An empty list (<code>{}</code>) means there is not enough information to assess if it is true or false (i.e., it means "maybe"). Sometimes you might want to treat "maybe" as true, but other times you might want to treat it as false. I personally think it makes sense to default to false.</p>
<p>If you want <code>{}</code> to be treated as true, then you can modify your expression to enforce that.  To take Lloyd's example, you could do:</p>
<div class="codehilite"><pre><span></span><code>(@1970 = @1970-12-15).allTrue()
</code></pre></div>
<p>Since <code>allTrue()</code> is defined to return true on an empty list (<code>{}</code>), this would get you the behavior you want.</p>
<p>Or you could be a little more explicit if you prefer:</p>
<div class="codehilite"><pre><span></span><code>(@1970 = @1970-12-15) or (@1970 = @1970-12-15).empty()
</code></pre></div>



<a name="274884070"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/274884070" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#274884070">(Mar 10 2022 at 19:31)</a>:</h4>
<p>this has come up repeatedly. That constraint is wrong and problematic</p>



<a name="274888190"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constraint%20on%20optional%20field/near/274888190" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constraint.20on.20optional.20field.html#274888190">(Mar 10 2022 at 20:04)</a>:</h4>
<p>The extension has a tracker item to fix (assigned to me)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
