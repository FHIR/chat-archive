---
layout: page
title: "FHIR Chat  · Addressing choice[x] types · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html">Addressing choice[x] types</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="210128877"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210128877" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210128877">(Sep 15 2020 at 13:29)</a>:</h4>
<p>We've had a few people report bugs against HAPI FHIR lately where the investigation revealed that the reported was actually using an invalid FHIRPath expression (typically in a custom SearchParameter).</p>
<p>The common error is around addressing choice[x] types. People seem to often write expressions like this:</p>
<p><code>Patient.extension('http://foo').valueString</code></p>
<p>This of course returns no matches because there is no element called <code>valueString</code>. I'm wondering if it would be reasonable for FHIRPath to allow for this syntax. Or perhaps even if the spec doesn't explicitly allow it, for the implementations to be a bit more lenient and accept it. Anecdotal experience certainly seems to suggest that people find the current way counterintuitive.</p>



<a name="210154919"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210154919" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210154919">(Sep 15 2020 at 16:43)</a>:</h4>
<p>fhirpath.js for a while only supported ".valueString" for something like that (because it didn't have data from the FHIR spec), and now supports both ".value" and ".valueString" to be more compliant.   So, I am in favor of James' proposal, even though at this point we are adding more type information from the FHIR spec for other things.</p>



<a name="210189132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210189132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210189132">(Sep 15 2020 at 20:54)</a>:</h4>
<p>The other thing you could do is validate the fhirpath expression and report that out. We have code like that in our server and also in forge to check the expression works in the context.</p>



<a name="210189168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210189168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210189168">(Sep 15 2020 at 20:54)</a>:</h4>
<p>But there are edge cases on it too.</p>



<a name="210189221"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210189221" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210189221">(Sep 15 2020 at 20:55)</a>:</h4>
<p>But I too support being more lenient on it at execution.</p>



<a name="210202012"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210202012" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210202012">(Sep 15 2020 at 22:57)</a>:</h4>
<p>I'm not sure about changing the spec, but I can change the HAPI processor to be not so strict on request.</p>



<a name="210202049"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210202049" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210202049">(Sep 15 2020 at 22:57)</a>:</h4>
<p>I'm going to extend the tests for this</p>



<a name="210211803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210211803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210211803">(Sep 16 2020 at 01:09)</a>:</h4>
<p>ok so I did that and ran into an additional problem in testing for error handling, so I cleaned the error codes up. Here's my changes:</p>
<p><a href="https://github.com/FHIR/fhir-test-cases/pull/74/files">https://github.com/FHIR/fhir-test-cases/pull/74/files</a></p>



<a name="210233603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210233603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210233603">(Sep 16 2020 at 08:20)</a>:</h4>
<blockquote>
<p>This of course returns no matches because there is no element called <code>valueString</code>. I'm wondering if it would be reasonable for FHIRPath to allow for this syntax. Or perhaps even if the spec doesn't explicitly allow it, for the implementations to be a bit more lenient and accept it. Anecdotal experience certainly seems to suggest that people find the current way counterintuitive.</p>
</blockquote>
<p>It would force implementations to have access to the type information for the resources and datatypes - mine does not yet.  Without this type information, there's no way to know that "value" is an element name, and "String" a type.  The current <code>.value.ofType(String)</code> does not have that disadvantage.  If we would want to extend that principle to the use of FhirPath in discriminators and searchparameter definitions, this would also make those areas harder to implement.  It's no free lunch, that's for sure.</p>



<a name="210240444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210240444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210240444">(Sep 16 2020 at 09:48)</a>:</h4>
<p>that's why I added it as a test mode.</p>



<a name="210240462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210240462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210240462">(Sep 16 2020 at 09:48)</a>:</h4>
<p>but I think your argument is incomplete - you can't not have knowledge to make it work properly</p>



<a name="210259637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210259637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210259637">(Sep 16 2020 at 13:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191328">Ewout Kramer</span> <a href="#narrow/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types/near/210233603">said</a>:</p>
<blockquote>
<p>It would force implementations to have access to the type information for the resources and datatypes</p>
</blockquote>
<p>That is exactly the opposite of what I found, and I wonder why.  In fhirpath.js, the JSON field in the resource being processed says "valueString", not "value", so in order to know that it should be "value", we have to pull in type information for resources.   XML also says "valueString" in the tag, so I wonder how you are getting to "value" without that type information, and having gotten there, why is difficult to know it was once valueString?</p>



<a name="210330355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210330355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210330355">(Sep 16 2020 at 23:00)</a>:</h4>
<p>I agree with Paul there - for FHIR. But it's the opposite way around for, say, CDA. I know that most of you don't care about that ;-)</p>



<a name="210330379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210330379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210330379">(Sep 16 2020 at 23:01)</a>:</h4>
<p>(yet)</p>



<a name="210356637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Addressing%20choice%5Bx%5D%20types/near/210356637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types.html#210356637">(Sep 17 2020 at 07:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179266-fhirpath/topic/Addressing.20choice.5Bx.5D.20types/near/210330355">said</a>:</p>
<blockquote>
<p>I agree with Paul there - for FHIR. But it's the opposite way around for, say, CDA. I know that most of you don't care about that ;-)</p>
</blockquote>
<p>That's exactly it, <span class="user-mention" data-user-id="195344">@Paul Lynch</span> - my FhirPath engine has no idea it's working with Fhir, so Fhir specific things like <code>valueString</code> (i.e. having the typename appended to the element name) etc have been abstracted away by the parsing layer.  I then need type information to add it back - but that's also why this would be a backwards move for me.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
