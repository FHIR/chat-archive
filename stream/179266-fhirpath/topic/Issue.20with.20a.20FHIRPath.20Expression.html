---
layout: page
title: "FHIR Chat  · Issue with a FHIRPath Expression · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html">Issue with a FHIRPath Expression</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="222785443"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Issue%20with%20a%20FHIRPath%20Expression/near/222785443" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joan Harper <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html#222785443">(Jan 14 2021 at 21:17)</a>:</h4>
<p>I have created a Patient profile and I am trying to implement a constraint --&gt; Must have [identifier of type JHN] or [address and phone]</p>
<p>I initially wrote the FHIRPath expression as:<br>
(identifier.type.coding.code="JHN") or (address.exists() and telecom.exists()) --- the two test cases that should trigger the error (no JHN and no address, no JHN and no telecom) come back with success instead of fail.</p>
<p>I tried changing it to:<br>
(identifier.type.coding.code="JHN") or ((address.exists()) and (telecom.exists())) --- I got the same result</p>
<p>If a resource is missing JHN, or address, or phone, the validation succeeds as expected.<br>
If a resource is missing JHN and address, or JHN and phone, the validation succeeds when it should fail.</p>
<p>Does anyone have any idea what is wrong with this FHIRPath expression?</p>
<p>Appreciate any help.<br>
Joanie</p>



<a name="222786085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Issue%20with%20a%20FHIRPath%20Expression/near/222786085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html#222786085">(Jan 14 2021 at 21:21)</a>:</h4>
<p>(identifier.type.coding.code='JHN') or ((address.exists()) and (telecom.exists()))  seems to work as expected here <a href="https://hl7.github.io/fhirpath.js/">https://hl7.github.io/fhirpath.js/</a><br>
(note i had to change your double quotes to single quotes which may have been the underlying issue)</p>



<a name="222787108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Issue%20with%20a%20FHIRPath%20Expression/near/222787108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joan Harper <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html#222787108">(Jan 14 2021 at 21:29)</a>:</h4>
<p>Thanks Ryan.<br>
I changed the double quotes to single quote and now the tests that were missing both JHN and address, or JHN and telecom work.</p>
<p>Now the test where telecom is missing fails and the test where address is missing fails.  These tests should both succeed.</p>
<p>The new expression is (identifier.type.coding.code='JHN') or ((address.exists()) and (telecom.exists())) </p>
<p>I'm so confused by this expression.  This should be pretty straightforward.</p>



<a name="222788261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Issue%20with%20a%20FHIRPath%20Expression/near/222788261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html#222788261">(Jan 14 2021 at 21:38)</a>:</h4>
<p>so what are you cases where you want to pass vs fail?<br>
because how I read your expression it worked as I expected with varying inclusion of your code, an address, or a telecom</p>



<a name="222788693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Issue%20with%20a%20FHIRPath%20Expression/near/222788693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joan Harper <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html#222788693">(Jan 14 2021 at 21:43)</a>:</h4>
<p>if it is missing address but has JHN, it should pass  - this is now failing<br>
if it is missing telecom but has JHN, it should pass  - this is now failing<br>
if it missing a JHN identifier but has address and telecom, it should pass</p>
<p>if it is missing a JHN identifier and address, it should fail<br>
it it is missing a JHN identifier and telecom, it should fail</p>



<a name="222790526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Issue%20with%20a%20FHIRPath%20Expression/near/222790526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html#222790526">(Jan 14 2021 at 21:58)</a>:</h4>
<p>can you send over what patient resource you are working off of? Maybe the JHN identifier is not being recognized correctly in the fhirpath</p>



<a name="222792600"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Issue%20with%20a%20FHIRPath%20Expression/near/222792600" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joan Harper <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html#222792600">(Jan 14 2021 at 22:15)</a>:</h4>
<p>After a bit of back and forth with Ryan, he helped me fix my issue, which was occurring because there was slicing of the identifier.<br>
(identifier.where(type.coding.code='JHN').exists()) or ((address.exists()) and (telecom.exists()))</p>
<p>Ryan, thank you very very much :)</p>
<p>Joanie</p>



<a name="222793319"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Issue%20with%20a%20FHIRPath%20Expression/near/222793319" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Issue.20with.20a.20FHIRPath.20Expression.html#222793319">(Jan 14 2021 at 22:17)</a>:</h4>
<p>yup, because there were multiple identifiers in your examples with different identifier types etc. the previous expression of identifier.type.coding.code='JHN' needed to be modified to make sure <em>at least one</em> identifier has a type of JHN so we used where() for that and then an exists() to make the existence/absence of a matching element into a boolean true/false for the rest of the expression</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
