---
layout: page
title: "FHIR Chat  · Function output as input for next function · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html">Function output as input for next function</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="243407278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/243407278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#243407278">(Jun 21 2021 at 16:23)</a>:</h4>
<p>In the case where I have a resource with name <code>LogicalModel-Person</code>:</p>
<ul>
<li><code>name.indexOf('-'))</code> gives me the outcome <code>12</code>.</li>
<li><code>name.substring(0, 12)</code> gives me the desired outcome <code>LogicalModel</code>.</li>
<li>However, <code>name.substring(0, name.indexOf('-'))</code> just gives back an empty string in FHIRPath Tester and the full name in <a href="https://hl7.github.io/fhirpath.js/">https://hl7.github.io/fhirpath.js/</a>.</li>
</ul>
<p>Is there a way for this to work instead?</p>



<a name="243450560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/243450560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#243450560">(Jun 21 2021 at 22:19)</a>:</h4>
<p>Using quotes around the name</p>



<a name="243450616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/243450616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#243450616">(Jun 21 2021 at 22:20)</a>:</h4>
<p>(think its the back tic char)</p>



<a name="243539833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/243539833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#243539833">(Jun 22 2021 at 16:11)</a>:</h4>
<p>See that I incorrectly reported what which FHIRPath tool gave back in my first post, updated that above. Sorry.</p>



<a name="243539970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/243539970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#243539970">(Jun 22 2021 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> I'm not sure if I understand. Using:</p>
<div class="codehilite"><pre><span></span><code>`name`.substring(0, `name`.indexOf(&#39;-&#39;))
</code></pre></div>
<p>gives me again the full name in fhirpath.js and an error in your FHIRPath Tester:</p>
<div class="codehilite"><pre><span></span><code>Expression compilation error:
Compilation failed: Parsing failure: unexpected &#39;`&#39;; expected Term (Line 1, Column 1); recently consumed:
</code></pre></div>



<a name="243606117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/243606117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#243606117">(Jun 23 2021 at 04:31)</a>:</h4>
<p>This should be working - but I don't get why not...<br>
<a href="/user_uploads/10155/aYQOTXg23CyOa2SFyszr91lW/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/aYQOTXg23CyOa2SFyszr91lW/image.png" title="image.png"><img src="/user_uploads/10155/aYQOTXg23CyOa2SFyszr91lW/image.png"></a></div>



<a name="243660259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/243660259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#243660259">(Jun 23 2021 at 14:31)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> Thought maybe I had an old version of FHIRPath Tester, so uninstalled it and wanted to reinstall.<br>
But now the Microsoft Store 'Install' or 'Get' button doesn't do anything. And the version from <a href="https://github.com/brianpos/FhirPathTester/releases/tag/v1.0.4">https://github.com/brianpos/FhirPathTester/releases/tag/v1.0.4</a> feels quite a bit older.</p>



<a name="243705942"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/243705942" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#243705942">(Jun 23 2021 at 20:11)</a>:</h4>
<p>Yes, it looks like i've not updated with a new tag when I released it last. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span> <br>
I should do another release with the 1.9.0 version of the libs - but need to have a local build of the libs due to minor change to remove the emit code in the setters (if that's still in there, as it doesn't work in the App store based code).</p>



<a name="244698583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244698583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244698583">(Jul 02 2021 at 13:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> So the Microsoft Store install/get works again now (I guess a few reboots later).<br>
With the same resource as you're using:</p>
<div class="codehilite" data-code-language="XML"><pre><span></span><code><span class="nt">&lt;Organization</span> <span class="na">xmlns=</span><span class="s">"http://hl7.org/fhir"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;name</span> <span class="na">value=</span><span class="s">"postlethwaite-kordic"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Organization&gt;</span>
</code></pre></div>
<p>The query </p>
<div class="codehilite"><pre><span></span><code>name.substring(0, name.indexOf(&#39;-&#39;))
</code></pre></div>
<p>gives an empty string:<br>
<a href="/user_uploads/10155/WuE4ikKMUk8jhbsbMIlxKB8S/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/WuE4ikKMUk8jhbsbMIlxKB8S/image.png" title="image.png"><img src="/user_uploads/10155/WuE4ikKMUk8jhbsbMIlxKB8S/image.png"></a></div><p>The query</p>
<div class="codehilite"><pre><span></span><code>`name`.substring(0, `name`.indexOf(&#39;-&#39;))
</code></pre></div>
<p>gives </p>
<div class="codehilite"><pre><span></span><code>Expression compilation error:
Compilation failed: Parsing failure: unexpected &#39;`&#39;; expected Term (Line 1, Column 1); recently consumed:
</code></pre></div>
<p><a href="/user_uploads/10155/R2wyA7CYnk5Lpro5QwDhCvBG/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/R2wyA7CYnk5Lpro5QwDhCvBG/image.png" title="image.png"><img src="/user_uploads/10155/R2wyA7CYnk5Lpro5QwDhCvBG/image.png"></a></div><p>About section says 'New Features in v1.0.8', so I guess that's the version I'm using.</p>



<a name="244699043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244699043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244699043">(Jul 02 2021 at 13:05)</a>:</h4>
<p>On <a href="https://hl7.github.io/fhirpath.js/">https://hl7.github.io/fhirpath.js/</a> both queries just give the full name value...<br>
<a href="/user_uploads/10155/wN8-Iuvo81LwwkrxM5P4Yq6l/image.png">image.png</a><br>
<a href="/user_uploads/10155/EHTSjEIXXsJcgMkewKnuj-gq/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/wN8-Iuvo81LwwkrxM5P4Yq6l/image.png" title="image.png"><img src="/user_uploads/10155/wN8-Iuvo81LwwkrxM5P4Yq6l/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/EHTSjEIXXsJcgMkewKnuj-gq/image.png" title="image.png"><img src="/user_uploads/10155/EHTSjEIXXsJcgMkewKnuj-gq/image.png"></a></div>



<a name="244699301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244699301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244699301">(Jul 02 2021 at 13:07)</a>:</h4>
<p>Both tools correctly give back <code>postlethwaite</code> for:</p>
<div class="codehilite"><pre><span></span><code>&#39;postlethwaite-kordic&#39;.substring(0, &#39;postlethwaite-kordic&#39;.indexOf(&#39;-&#39;))
</code></pre></div>



<a name="244723329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244723329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244723329">(Jul 02 2021 at 16:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> Part of the mystery: Backticks are the escape character for the normative FHIRPath, before that it seems to have been double quotes. (As I understand from <span class="user-mention" data-user-id="191328">@Ewout Kramer</span>)<br>
But still also:</p>
<div class="codehilite"><pre><span></span><code>&quot;name&quot;.substring(0, &quot;name&quot;.indexOf(&#39;-&#39;))
</code></pre></div>
<p>Gives an empty string in the 1.0.8 of FHIRPath tester. Looking forward to test it with the newer release.</p>



<a name="244762012"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244762012" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244762012">(Jul 02 2021 at 22:01)</a>:</h4>
<p>Issue there is the context isn't the parent of name, it's the string. So that name property doesn't exist in the string.</p>



<a name="244762061"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244762061" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244762061">(Jul 02 2021 at 22:02)</a>:</h4>
<p>I've actually come across this issue in the last week too!</p>



<a name="244762169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244762169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244762169">(Jul 02 2021 at 22:03)</a>:</h4>
<p>name.substring(0, %resource.name.indexOf('-')) should work.</p>



<a name="244923811"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244923811" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244923811">(Jul 05 2021 at 11:23)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span>. That indeed works in FHIRPath tester. Not on fhirpath.js though.<br>
Should <code>%resource</code> always be expected to be available when evaluating FHIRPath anywhere?<br>
Is this expected behavior (that the scope there is on the string) for FHIRPath or more a bug in the SDK?</p>



<a name="244924058"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924058" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924058">(Jul 05 2021 at 11:25)</a>:</h4>
<p>Fhirpath.js is able to handle environment variables, but the host has to provide those to it.<br>
I haven't had a chance to try that out withfhirpath.js yet, but was planning to in the next few weeks.</p>



<a name="244924107"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924107" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924107">(Jul 05 2021 at 11:26)</a>:</h4>
<p>(after my current project is released)</p>



<a name="244924176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924176">(Jul 05 2021 at 11:26)</a>:</h4>
<p>I think the simple answer is  <code>name.substring(0, indexOf('-'))</code>.</p>



<a name="244924312"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924312" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924312">(Jul 05 2021 at 11:28)</a>:</h4>
<p>(backquote)name(backquote).substring(0, (backquote)name(backquote).indexOf('-'))<br>
(sorry, no idea how to produce a backquote in markdown)</p>
<p>should be exactly the same as <code>name.substring(0,name.indexOf('-'))</code> and probably return nothing of null.</p>



<a name="244924567"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924567" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924567">(Jul 05 2021 at 11:31)</a>:</h4>
<p>This is because  <code>%resource.name.substring(0,name.indexOf('-'))</code> evaluates to <code>%resource.name.substring(0,%resource.name.name.indexOf('-'))</code></p>



<a name="244924649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924649">(Jul 05 2021 at 11:32)</a>:</h4>
<p>This double <code>name</code> returns nothing, so doing <code>indexOf()</code> on it will return nothing, etc.</p>



<a name="244924674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924674">(Jul 05 2021 at 11:32)</a>:</h4>
<p>The question going on here is what is the $this or %context within the parameters and the string.substring function parameters.<br>
It appears that currently that is the string, and not the parent of the string.</p>



<a name="244924742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924742">(Jul 05 2021 at 11:33)</a>:</h4>
<p>Ewout, that's how I understand it too.</p>



<a name="244924823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244924823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244924823">(Jul 05 2021 at 11:34)</a>:</h4>
<p>And since their is no parent for the node, you have to go from the top again right?</p>



<a name="244925013"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925013" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925013">(Jul 05 2021 at 11:36)</a>:</h4>
<blockquote>
<p>Issue there is the context isn't the parent of name, it's the string. So that name property doesn't exist in the string.</p>
</blockquote>



<a name="244925028"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925028" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925028">(Jul 05 2021 at 11:36)</a>:</h4>
<p>Yes, that's correct!</p>



<a name="244925043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925043">(Jul 05 2021 at 11:36)</a>:</h4>
<p>But that's not an issue - right, this is the intended behaviour.</p>



<a name="244925047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925047">(Jul 05 2021 at 11:36)</a>:</h4>
<p><span class="user-mention" data-user-id="203235">@Ward Weistra</span> where are you testing the fhirpath.js code?</p>



<a name="244925067"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925067" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925067">(Jul 05 2021 at 11:36)</a>:</h4>
<p>But $this is different</p>



<a name="244925087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925087">(Jul 05 2021 at 11:36)</a>:</h4>
<p>$this is only set by specific functions like <code>where</code></p>



<a name="244925111"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925111" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925111">(Jul 05 2021 at 11:37)</a>:</h4>
<p>So not in this example?</p>



<a name="244925278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925278">(Jul 05 2021 at 11:39)</a>:</h4>
<p>That's right. Only functions that take an expression as a parameter will (re)introduce the $this.</p>



<a name="244925482"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925482" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925482">(Jul 05 2021 at 11:41)</a>:</h4>
<p>Take <code>bla.where(x.indexOf(0, $this.length())</code>  ---   after the <code>where</code>, $this is pointing to each repeating <code>bla</code>.  Within <code>indexOf()</code> the $this is still referring to a <code>bla</code> introduced by the <code>where</code> - not the <code>x</code>.   In <code>x.indexOf(0, length())</code>, the <code>length()</code> would use the <code>x</code>, not the <code>$this</code>.</p>



<a name="244925568"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925568" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925568">(Jul 05 2021 at 11:42)</a>:</h4>
<p><a href="http://hl7.org/fhirpath/#functions">http://hl7.org/fhirpath/#functions</a> - last bullet (for $this).</p>



<a name="244925786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244925786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244925786">(Jul 05 2021 at 11:45)</a>:</h4>
<p>Arguments are evaluated with respect to the <em>input collection</em>, and functions taking an expression as an argument introduce a special $this in their scope.</p>



<a name="244927025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244927025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244927025">(Jul 05 2021 at 11:58)</a>:</h4>
<p>So looking up at the examples above, I think all these are equivalent (assuming that there aren't more then 1 name):<br>
<code>name.text.substring(0, indexOf(','))</code><br>
<code>name.text.substring(0, %resource.name.text.indexOf(','))</code><br>
And where the other examples above included the name also, that should not have worked in fhirpath.js, but it does<br>
<code>name.text.substring(0, text.indexOf(','))</code><br>
<a href="/user_uploads/10155/n2eoQldkoppqgdVnfg5dJQBj/image.png">image.png</a> <br>
<a href="/user_uploads/10155/zEX0WrKqgY04XQqfqBKaLh_t/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/n2eoQldkoppqgdVnfg5dJQBj/image.png" title="image.png"><img src="/user_uploads/10155/n2eoQldkoppqgdVnfg5dJQBj/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/zEX0WrKqgY04XQqfqBKaLh_t/image.png" title="image.png"><img src="/user_uploads/10155/zEX0WrKqgY04XQqfqBKaLh_t/image.png"></a></div>



<a name="244927177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244927177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244927177">(Jul 05 2021 at 12:00)</a>:</h4>
<p>And note that if you're doing your own fhirpath.js host example content, this is how you're meant to pass in the environment variables (which I just put into my test host page)</p>
<div class="codehilite"><pre><span></span><code>                    var fhirObject = JSON.parse($(&#39;#fhirResource&#39;).val());
                    var expression = $(&#39;#path&#39;).val();
                    var envVars = [];
                    envVars[&quot;resource&quot;] = fhirObject;
                    var returnedValue = fhirpath.evaluate(fhirObject, expression, envVars, fhirpath_r4_model);
                    $(&#39;#fhirpathOutput&#39;).text(JSON.stringify(returnedValue));
</code></pre></div>



<a name="244928254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244928254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244928254">(Jul 05 2021 at 12:11)</a>:</h4>
<p>Just deployed it here too <br>
<a href="https://smartqedit4.azurewebsites.net/ts/Questionnaire/FhirPath">https://smartqedit4.azurewebsites.net/ts/Questionnaire/FhirPath</a></p>



<a name="244953544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244953544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244953544">(Jul 05 2021 at 16:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> Thanks both!</p>



<a name="244953593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244953593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244953593">(Jul 05 2021 at 16:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191367">Brian Postlethwaite</span> <a href="#narrow/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function/near/244925047">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="203235">Ward Weistra</span> where are you testing the fhirpath.js code?</p>
</blockquote>
<p>Via <a href="https://hl7.github.io/fhirpath.js/">https://hl7.github.io/fhirpath.js/</a>. Not sure who manages that deployment.</p>



<a name="244978236"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/244978236" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#244978236">(Jul 05 2021 at 22:15)</a>:</h4>
<p><span class="user-mention" data-user-id="195344">@Paul Lynch</span> is that you?</p>



<a name="245336837"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/245336837" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#245336837">(Jul 08 2021 at 16:22)</a>:</h4>
<p>Yes, or actually currently <span class="user-mention" data-user-id="273812">@Yury Sedinkin</span>, but I am the right POC.</p>



<a name="245337614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Function%20output%20as%20input%20for%20next%20function/near/245337614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Function.20output.20as.20input.20for.20next.20function.html#245337614">(Jul 08 2021 at 16:28)</a>:</h4>
<p>If there is a bug with fhirpath.js, please report it at <a href="https://github.com/HL7/fhirpath.js/issues">https://github.com/HL7/fhirpath.js/issues</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
