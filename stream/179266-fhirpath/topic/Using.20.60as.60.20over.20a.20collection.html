---
layout: page
title: "FHIR Chat  · Using `as` over a collection · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html">Using `as` over a collection</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="180060406"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180060406" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180060406">(Nov 06 2019 at 18:11)</a>:</h4>
<p><a href="http://hl7.org/fhirpath/index.html#types" target="_blank" title="http://hl7.org/fhirpath/index.html#types">http://hl7.org/fhirpath/index.html#types</a> says:</p>
<blockquote>
<p>If there is more than one item in the input collection, the evaluator will throw an error.</p>
</blockquote>



<a name="180060572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180060572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180060572">(Nov 06 2019 at 18:12)</a>:</h4>
<p>however, there are multiple search parameter expressions in fhir that use it over an element with cardinality &gt; 1  (e.g. <code>Observation.component.value as Quantity</code> where component can repeat)</p>



<a name="180060648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180060648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180060648">(Nov 06 2019 at 18:13)</a>:</h4>
<p>is this an issue with the fhirpath spec?  or is it an issue with fhir's use of it?</p>



<a name="180060742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180060742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180060742">(Nov 06 2019 at 18:14)</a>:</h4>
<p>or is the guidance at <a href="http://hl7.org/fhirpath/index.html#types" target="_blank" title="http://hl7.org/fhirpath/index.html#types">http://hl7.org/fhirpath/index.html#types</a> not applicable for <code>as</code> when used this way?  for example, maybe its only referring to <code>as</code> the function?</p>



<a name="180061300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180061300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180061300">(Nov 06 2019 at 18:19)</a>:</h4>
<p>What would be a use case where you would want to do <code>Observation.component.value as Quantity</code> with multiple components?</p>



<a name="180062320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180062320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180062320">(Nov 06 2019 at 18:29)</a>:</h4>
<p>see <code>component-value-quantity</code> at <a href="https://www.hl7.org/fhir/observation.html#search" target="_blank" title="https://www.hl7.org/fhir/observation.html#search">https://www.hl7.org/fhir/observation.html#search</a></p>



<a name="180062423"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180062423" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180062423">(Nov 06 2019 at 18:30)</a>:</h4>
<p>not sure about real-world use case for it...seems like normally you'd want to seach on the "composite" parameter</p>



<a name="180062438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180062438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180062438">(Nov 06 2019 at 18:30)</a>:</h4>
<p>but I assume the search parameter exists for a reason</p>



<a name="180062981"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180062981" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180062981">(Nov 06 2019 at 18:35)</a>:</h4>
<p>another example where as is used over a collection in fhir is the dom-3 constraint (but this one is pretty complicated):</p>
<div class="codehilite"><pre><span></span>    description = &quot;If the resource is contained in another resource, it SHALL be referred to from elsewhere in the resource or SHALL refer to the containing resource&quot;,
    expression = &quot;contained.where(((&#39;#&#39;+id in (%resource.descendants().reference | %resource.descendants().as(canonical) | %resource.descendants().as(uri) | %resource.descendants().as(url))) or descendants().where(reference = &#39;#&#39;).exists() or descendants().where(as(canonical) = &#39;#&#39;).exists() or descendants().where(as(canonical) = &#39;#&#39;).exists()).not()).trace(&#39;unmatched&#39;, id).empty()&quot;
</pre></div>



<a name="180063040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180063040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180063040">(Nov 06 2019 at 18:36)</a>:</h4>
<p>I see.   There is either a problem with the FHIRPath specification, or a problem with the "Expression" for the component-value-quantity search parameter.</p>



<a name="180063075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180063075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180063075">(Nov 06 2019 at 18:36)</a>:</h4>
<p>for that dom-3 example,  just note the <code>%resource.descendants().as(canonical)</code> i guess</p>



<a name="180063616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180063616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180063616">(Nov 06 2019 at 18:42)</a>:</h4>
<p>It's also worth mentioning that the FHIRPath specification does not document the <code>as</code> an <code>is</code> functions (only the operators). I think the FHIRPath specification should change to allow collections that have more than one item (to specifically support the search parameter extraction and constraints that use them that way).</p>



<a name="180063656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180063656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180063656">(Nov 06 2019 at 18:42)</a>:</h4>
<p><a href="http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/index.html#types" target="_blank" title="http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/index.html#types">http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/index.html#types</a> includes "as" and "is" functions, but they are deprecated.</p>



<a name="180063696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180063696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180063696">(Nov 06 2019 at 18:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> ?</p>



<a name="180065082"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180065082" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180065082">(Nov 06 2019 at 18:56)</a>:</h4>
<p>Interesting. I wonder why they are deprecated. They are used a lot.</p>



<a name="180065306"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180065306" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180065306">(Nov 06 2019 at 18:58)</a>:</h4>
<p>Yes, the FHIRPath spec defines the is and as operators as singleton operators; otherwise there is some ambiguity about the result. It appears though that for the as operator at least, at least one reference implementation doesn't respect that singleton-ness.</p>



<a name="180065391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180065391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180065391">(Nov 06 2019 at 18:59)</a>:</h4>
<p>The is() and as() functions are deprecated because they are defined as operators. They are defined as operators because the arguments are type specifiers, a different syntactic category than expression.</p>



<a name="180065492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180065492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180065492">(Nov 06 2019 at 19:00)</a>:</h4>
<p>(Either that, or that constraint has never been violated in practice).</p>



<a name="180078063"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180078063" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180078063">(Nov 06 2019 at 21:25)</a>:</h4>
<p>I would say there is evidence that as is used with non-singleton collections in some of the built-in FHIRPath expressions used within the FHIR specification (e.g. dom-3).</p>



<a name="180079167"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180079167" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180079167">(Nov 06 2019 at 21:38)</a>:</h4>
<p>Also, per the comment about the argument is a type specifier, I got around this by asking ANTLR for the text of the AST node instead of trying to evaluate the expression (like I would for qualified identifier).</p>



<a name="180079375"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180079375" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180079375">(Nov 06 2019 at 21:41)</a>:</h4>
<p>so i'm still wondering this:  is it a fhirpath issue or a fhir issue?</p>



<a name="180079441"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180079441" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180079441">(Nov 06 2019 at 21:42)</a>:</h4>
<p>should I open a GForge ticket for it?  should it start with fhir-i or fhirpath?</p>



<a name="180079780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180079780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180079780">(Nov 06 2019 at 21:45)</a>:</h4>
<p>per my current understanding and bryn's response, this would be a FHIR issue.<br>
but clearly using <code>as</code> to filter a collection down to just the elements of a given type is a very useful capability...is there something comparable for FHIR to use if it can't use <code>as</code> in this way?</p>



<a name="180079941"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180079941" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180079941">(Nov 06 2019 at 21:47)</a>:</h4>
<p>maybe <code>Observation.component.select(value as Quantity)</code> in this case?</p>



<a name="180084185"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180084185" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180084185">(Nov 06 2019 at 22:43)</a>:</h4>
<p>well. This works in my implementation. Clearly, the FHIR Path test cases don't test out the failure of this on a collection, since I do succeed on these implementations</p>



<a name="180084254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180084254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180084254">(Nov 06 2019 at 22:44)</a>:</h4>
<p>given the massive amount of work a technical correction represents (approximately a month of &gt; 8hrs/day  so far), I'm just not going to correct this right now</p>



<a name="180084268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180084268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180084268">(Nov 06 2019 at 22:44)</a>:</h4>
<p>so I'm not sure what the right resolution is. Take the first example</p>



<a name="180084321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180084321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180084321">(Nov 06 2019 at 22:45)</a>:</h4>
<p><code>Observation.component.value as Quantity</code></p>
<p>I think this is clear, at least, and what I'm trying to do seems reasonable to me - select all the Observation.component.value that are Quantities</p>



<a name="180084590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180084590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180084590">(Nov 06 2019 at 22:49)</a>:</h4>
<p>Or that might be expected to include an assertion that all of the Observation.component.values are Quantities.</p>



<a name="180085846"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180085846" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180085846">(Nov 06 2019 at 23:06)</a>:</h4>
<p>as is not an assertion. things that fail as fall out</p>



<a name="180085982"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180085982" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180085982">(Nov 06 2019 at 23:08)</a>:</h4>
<p>Oops-- yes you are right.</p>



<a name="180107260"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180107260" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180107260">(Nov 07 2019 at 06:57)</a>:</h4>
<p>Agreed on the level of effort, it's trivial to characterize this as a clarification on <code>as</code> behavior, given that at least one system behaves that way. And the behavior is reasonable for <code>as</code>, though I would not say the same for <code>is</code>; in the <code>is</code> case, I think it's still ambiguous and should be treated as an error. So I'm hearing support for considering this a clarification on FHIRPath and submitting as a tracker there?</p>



<a name="180107736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180107736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180107736">(Nov 07 2019 at 07:07)</a>:</h4>
<p>I'd like that</p>



<a name="180107739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180107739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180107739">(Nov 07 2019 at 07:07)</a>:</h4>
<p>for as.</p>



<a name="180107746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180107746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180107746">(Nov 07 2019 at 07:07)</a>:</h4>
<p>is.. I don't know if I used it like that</p>



<a name="180107822"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180107822" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180107822">(Nov 07 2019 at 07:08)</a>:</h4>
<p>if the focus cardinality != 1, I return false from .is()</p>



<a name="180129914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180129914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180129914">(Nov 07 2019 at 13:11)</a>:</h4>
<p>I added a throw for cardinality != 1 for both <code>as</code> and <code>is</code>.  This is how I found the issue with FHIR use of <code>as</code> in the first place.<br>
For <code>is</code>, I havn't seen any such issue...I don't think FHIR is using that on collections with size &gt; 1 and so I agree that one can stay as-is (no pun intended).</p>



<a name="180130139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180130139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180130139">(Nov 07 2019 at 13:14)</a>:</h4>
<p>However, it would be good to nail down the expected behavior of <code>as</code> and <code>is</code> when the left operand is an empty collection.<br>
In our implementation, I had to stop throwing when the input collection to <code>is</code> was empty, but instead of returning false we opted to return an empty collection in this case.</p>



<a name="180130417"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180130417" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180130417">(Nov 07 2019 at 13:18)</a>:</h4>
<p>The spec says:</p>
<blockquote>
<p>If the left operand is a collection with a single item and the second operand is a type identifier, this operator returns true if the type of the left operand is the type specified in the second operand, or a subclass thereof. If the input value is not of the type, this operator returns false. If the identifier cannot be resolved to a valid type identifier, the evaluator will throw an error. If the input collections contains more than one item, the evaluator will throw an error. In all other cases this operator returns the empty collection.</p>
</blockquote>
<p>So our interpretation was that an empty input collection would fall through to that last sentence (which matches a number of other functions) and this seems to be working well.</p>



<a name="180132243"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180132243" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180132243">(Nov 07 2019 at 13:39)</a>:</h4>
<p>I opened <a href="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25188" target="_blank" title="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25188">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25188</a> for this issue</p>



<a name="180165566"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180165566" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180165566">(Nov 07 2019 at 19:20)</a>:</h4>
<p>I also opened <a href="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25189" target="_blank" title="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25189">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25189</a> for the behavior of <code>is</code> on an empty input collection, but I accidentally clicked submit before flagging it for FHIRPath...can someone please correct that?</p>



<a name="180170698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Using%20%60as%60%20over%20a%20collection/near/180170698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Using.20.60as.60.20over.20a.20collection.html#180170698">(Nov 07 2019 at 20:11)</a>:</h4>
<p>fixed</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
