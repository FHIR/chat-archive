---
layout: page
title: "FHIR Chat  · operand errors · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html">operand errors</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153965999"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153965999" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153965999">(May 31 2018 at 01:23)</a>:</h4>
<p>I am getting an error message like:<br>
<code>Problem processing expression (derivation = 'constraint') or (kind = 'logical') or (url = 'http://hl7.org/fhir/StructureDefinition/'+id) in profile http://hl7.org/fhir/StructureDefinition/StructureDefinition path StructureDefinition: Error performing +: right operand has no value</code><br>
from the validation engine because there's no value for <code>id</code>. But this is coming as an exception rather than a validation error. Is it valid to treat any <code>PathEngineException</code> as a validation error, or should the constraint check that <code>id</code> has a value before using it?</p>



<a name="153966002"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966002" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966002">(May 31 2018 at 01:35)</a>:</h4>
<p>In general, an operator in FHIRPath will return empty (<code>{ }</code>) if any of its arguments are empty, so I would think the concatenate there ought to return an empty, rather than throw an exception like that.</p>



<a name="153966004"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966004" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966004">(May 31 2018 at 01:43)</a>:</h4>
<p>That's certainly not the behaviour of FHIRPathEngine.java</p>
<div class="codehilite"><pre><span></span><span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span> <span class="nf">opPlus</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span> <span class="n">left</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span> <span class="n">right</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">PathEngineException</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">PathEngineException</span><span class="o">(</span><span class="s">&quot;Error performing +: left operand has no value&quot;</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">PathEngineException</span><span class="o">(</span><span class="s">&quot;Error performing +: left operand has more than one value&quot;</span><span class="o">);</span>
  <span class="c1">// ...</span>
</pre></div>



<a name="153966042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966042">(May 31 2018 at 08:10)</a>:</h4>
<p>I believe that this is the correct implementation of + as defined in the fhirpath specificatino</p>



<a name="153966043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966043">(May 31 2018 at 08:10)</a>:</h4>
<p>I believe we argued about this</p>



<a name="153966049"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966049" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966049">(May 31 2018 at 08:20)</a>:</h4>
<p>In that case the constraint needs re-writing as:<br>
<code>(derivation = 'constraint') or (kind = 'logical') or (exists(id) and url = 'http://hl7.org/fhir/StructureDefinition/'+id)</code><br>
?</p>



<a name="153966050"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966050" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966050">(May 31 2018 at 08:23)</a>:</h4>
<p>But 4.4.1 of fhirpath says</p>
<blockquote>
<p>For functions or operators that take a single values as input, this means in general if the input is empty, then the result will be empty as well.</p>
</blockquote>



<a name="153966051"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966051" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966051">(May 31 2018 at 08:24)</a>:</h4>
<ul>
<li>has a different definition, I think</li>
</ul>



<a name="153966052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966052">(May 31 2018 at 08:25)</a>:</h4>
<blockquote>
<p>6.6.7. &amp; (string concatenation)<br>
For strings, will concatenate the strings, where an empty operand is taken to be the empty string. This differs from + on two strings, which will result in an empty collection when one of the operands is empty.<br>
<a href="http://hl7.org/fhirpath/#math" target="_blank" title="http://hl7.org/fhirpath/#math">http://hl7.org/fhirpath/#math</a></p>
</blockquote>



<a name="153966053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966053">(May 31 2018 at 08:29)</a>:</h4>
<p>guess I should change that to &amp; not + then</p>



<a name="153966054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966054">(May 31 2018 at 08:32)</a>:</h4>
<p>which will create a different bug, no?  It would result in <code>url</code> being compared with <code>"http://hl7.org/fhir/StructureDefinition/"</code>when there's no <code>id</code></p>



<a name="153966167"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/operand%20errors/near/153966167" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/operand.20errors.html#153966167">(May 31 2018 at 22:31)</a>:</h4>
<p>My take on the code above is that the second test is correct - more than one value is an error, but that the first case should result in the empty list.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
