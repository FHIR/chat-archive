---
layout: page
title: "FHIR Chat  · Equality with partial DateTimes · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html">Equality with partial DateTimes</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="160328241"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160328241" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160328241">(Mar 08 2019 at 21:41)</a>:</h4>
<p>Did the rules around = and ~ for partial DateTime and Time change between <a href="http://hl7.org/fhirpath/" target="_blank" title="http://hl7.org/fhirpath/">http://hl7.org/fhirpath/</a> and <a href="http://hl7.org/fhirpath/2018Sep/" target="_blank" title="http://hl7.org/fhirpath/2018Sep/">http://hl7.org/fhirpath/2018Sep/</a>, or was it simply clarified in the latter?  Also, in the latter, there seem to be two contradictory statements (from 6.1.1. = (Equals)):</p>
<p>1) "For Date, DateTime and Time equality, the comparison is performed at the unit with the most precision of either input." (which suggests that comparison between two DateTimes of differing precision should be attempted)</p>
<p>2) "If the input values have different levels of precision, the result is empty ({ })." (which says the comparison between two DateTimes of differing precision should always result in empty).</p>



<a name="160468538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160468538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160468538">(Mar 11 2019 at 10:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="160634487"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160634487" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160634487">(Mar 13 2019 at 04:36)</a>:</h4>
<p>The rules for equality were brought into alignment with what the various engines were doing. There was variability in the behaviors, and the spec wasn't as clear as it could have been, so we clarified in the 2018Sep ballot, and have since clarified further. If you look at the 2019May draft: <a href="https://github.com/FHIR/fluentpath/blob/master/spec/2019May/index.adoc#equality" target="_blank" title="https://github.com/FHIR/fluentpath/blob/master/spec/2019May/index.adoc#equality">https://github.com/FHIR/fluentpath/blob/master/spec/2019May/index.adoc#equality</a> that's the clarified description (though there may still be some minor edits as I finish applying the trackers over the next few days).</p>



<a name="160881729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160881729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160881729">(Mar 15 2019 at 14:50)</a>:</h4>
<p>Per the link provided by <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> for the May version, the algorithm for determining equality would result in:</p>
<div class="codehilite"><pre><span></span>2012-01 = 2012 // empty
2012-01 = 2011 // false
2012-01 ~ 2012 // false
</pre></div>


<p>Questions:<br>
1) Is that the desired behavior?<br>
2) How is returning empty in the above case (instead of false due to the differing precision) useful?</p>
<p>Comment:  It would be more efficient to return empty whenever the precision differed, and only otherwise proceed to checking equality, because only a single check for equality would be needed.</p>



<a name="160882534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160882534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160882534">(Mar 15 2019 at 14:59)</a>:</h4>
<p>Because the first equality comparison is asking whether some day in the month of January of 2012 is equal to some day in the year 2012, and how can we know whether that's the case?</p>



<a name="160882677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160882677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160882677">(Mar 15 2019 at 15:00)</a>:</h4>
<p>And what does 2012-01 ~ 2012 ask?</p>



<a name="160882742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160882742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160882742">(Mar 15 2019 at 15:01)</a>:</h4>
<p>Where they are equivalent, in which case we don't care about the uncertainty.</p>



<a name="160884507"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160884507" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160884507">(Mar 15 2019 at 15:21)</a>:</h4>
<p>Does that help?</p>



<a name="160889423"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160889423" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160889423">(Mar 15 2019 at 16:17)</a>:</h4>
<p>Yes, although I am confused about the motivation for this behavior.   It would be helpful if the spec could include some use cases to support it, because it is not the only behavior one could imagine.  For instance, "2012-01-14 = 2012" could be asking the question "is there overlap between the two implied ranges of time" or "are they equal to the common precision".   I am not saying that that functionality is needed, but I would have expected = or ~ to support that.</p>



<a name="160925639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/160925639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#160925639">(Mar 16 2019 at 00:45)</a>:</h4>
<p>I can see using <code>=</code> for "are they equal to the common precision", but that's a less general operation and so would want to see a different operation that specifically did that (comparison to a specified precision). I have a hard time seeing <code>=</code> being a reasonable symbol to use to ask the question "is there overlap between the two implied ranges of time" though.</p>



<a name="161021266"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/161021266" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#161021266">(Mar 18 2019 at 00:08)</a>:</h4>
<p>The defined behaviour for = and ~ in dates makes sense to me. <br>
It seems that some more date functions are needed; maybe <br>
overlapDate(date,date):boolean - returns true when, after truncating the more precise date to be the same as the less precise date, the results are equal.  <br>
and<br>
truncDate(date, precision):date</p>



<a name="161351199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/161351199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#161351199">(Mar 21 2019 at 14:39)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  With the algorithm outlined in the <a href="https://github.com/FHIR/fluentpath/blob/master/spec/2019May/index.adoc#equality" target="_blank" title="https://github.com/FHIR/fluentpath/blob/master/spec/2019May/index.adoc#equality">May version</a>, what is the result of:</p>
<div class="codehilite"><pre><span></span>@2018-02-03T22-04:00 = @2018-02-04T06:01+04:00
</pre></div>


<p>This is the same date time, expressed in different time zones, and at different precisions.  I think the answer will clarify what "respecting timezone offsets" means in the phrase, "the comparison is performed by considering each precision in order, beginning with years (or hours for time values), and respecting timezone offsets".  My first attempt to follow that resulted in a comparison of "2018" at -04:00 with "2018" at +04:00, which would be false, but I think the answer for the expression above is supposed to be "empty".</p>



<a name="161352470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Equality%20with%20partial%20DateTimes/near/161352470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Equality.20with.20partial.20DateTimes.html#161352470">(Mar 21 2019 at 14:50)</a>:</h4>
<p>Right, for comparisons, if either or both of the inputs have a timezone offset, the values have to be converted to a common timezone offset prior to running the comparison, which would then result in empty because the values have differing precision.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
