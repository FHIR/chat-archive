---
layout: page
title: "FHIR Chat  · Date Time operations · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html">Date Time operations</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="210931801"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/210931801" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#210931801">(Sep 22 2020 at 21:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> please review this:</p>
<p><a href="https://github.com/FHIR/fhir-test-cases/pull/76/files">https://github.com/FHIR/fhir-test-cases/pull/76/files</a></p>
<p><span class="user-mention" data-user-id="191387">@Keith Boone</span> it seems to me that should add more tests than this - at a minimum, UCUM coded times, decimal values in the quantities, and all the duration units...</p>



<a name="210945108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/210945108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#210945108">(Sep 22 2020 at 23:51)</a>:</h4>
<p>What, you want both code and testing from the same developer? Is the some sort of open source project?  Oh yeah, duh.</p>
<p>Yes.  I’ll put it on my todo list unless someone beats me to it.  I’m curious though, what is 0.5 of a month or year equal to?  Sub integer precision works for any unit smaller than a month (with minor accuraccy lost due to leap seconds maybe, depending on what java does and how you account for it).  For wuick thinks, I usually just work with 30 and 365 days, but whole unit months and years are expected to preserve dates I thought, at least wrt addition/subtraction.</p>
<p>Sorry about white space, I have to go fix how my tab settings are set up in eclipse.</p>



<a name="210945321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/210945321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#210945321">(Sep 22 2020 at 23:54)</a>:</h4>
<p>right. so this is why I want tests, because there's lots of challenges here</p>



<a name="210952825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/210952825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#210952825">(Sep 23 2020 at 02:13)</a>:</h4>
<p>In FHIRPath, date/time arithmetic above weeks is strictly calendar-based, fractions of durations are dropped before the calculation is performed.</p>



<a name="210953112"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/210953112" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#210953112">(Sep 23 2020 at 02:19)</a>:</h4>
<p>Agree with the test outcomes</p>



<a name="210953118"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/210953118" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#210953118">(Sep 23 2020 at 02:20)</a>:</h4>
<p>My engine gives the same result for all 4 tests</p>



<a name="210964533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/210964533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#210964533">(Sep 23 2020 at 06:52)</a>:</h4>
<p>just silently dropped?</p>



<a name="211065903"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211065903" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211065903">(Sep 23 2020 at 21:42)</a>:</h4>
<p>The CQL engine (as encouraged by the spec) issues a warning, but otherwise yes.</p>



<a name="211573063"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211573063" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211573063">(Sep 29 2020 at 02:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> extending these tests, do you agree with all of these:</p>
<div class="codehilite"><pre><span></span><code>@1973-12-25 + 7 &#39;days&#39; = 1974-01-01
@1973-12-25 + 7.7 &#39;days&#39; = 1974-01-01
@1973-12-25T00:00:00.000+10:00 + 7 &#39;days&#39; = 1974-01-01T00:00:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 7.7 &#39;days&#39; = 1974-01-01T00:00:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;s&#39; = 1973-12-25T00:00:01.000+10:00
@1973-12-25T00:00:00.000+10:00 + 0.1 &#39;s&#39; = 1973-12-25T00:00:00.100+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;min&#39; = 1973-12-25T00:01:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;h&#39; = 1973-12-25T01:00:00.000+10:00
@1973-12-25 + 1 &#39;d&#39; = 1973-12-26
@1973-12-25 + 1 &#39;mo&#39; = 1974-01-01
@1973-12-25 + 1 &#39;wk&#39; = 1975-01-01
@1973-12-25 + 1 &#39;a&#39; = 1974-12-24
@1973-12-25T00:00:00.000+10:00 + 1 &#39;second&#39; = 1973-12-25T00:00:01.000+10:00
@1973-12-25T00:00:00.000+10:00 + 0.1 &#39;second&#39; = 1973-12-25T00:00:00.100+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;minute&#39; = 1973-12-25T00:01:00.000+10:00 + 1
@1973-12-25T00:00:00.000+10:00 + 1 &#39;hour&#39; = 1973-12-25T01:00:00.000+10:00
@1973-12-25 + 1 &#39;day&#39; = 1973-12-26
@1973-12-25 + 1 &#39;month&#39; = 1974-01-01
@1973-12-25 + 1 &#39;week&#39; = 1975-01-01
@1973-12-25 + 1 &#39;year&#39; = 1974-12-25
 ```
</code></pre></div>



<a name="211574089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211574089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211574089">(Sep 29 2020 at 02:20)</a>:</h4>
<p>.7 days goes missing?</p>



<a name="211574095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211574095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211574095">(Sep 29 2020 at 02:20)</a>:</h4>
<p>yes see discussion above</p>



<a name="211576203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211576203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211576203">(Sep 29 2020 at 03:06)</a>:</h4>
<p>Here are the results from the Java-based engine:</p>
<div class="codehilite"><pre><span></span><code>define Test1: @1973-12-25 + 7 &#39;days&#39; = @1974-01-01
define Test2: @1973-12-25 + 7.7 &#39;days&#39; = @1974-01-01
define Test3: @1973-12-25T00:00:00.000+10:00 + 7 &#39;days&#39; = @1974-01-01T00:00:00.000+10:00
define Test4: @1973-12-25T00:00:00.000+10:00 + 7.7 &#39;days&#39; = @1974-01-01T00:00:00.000+10:00
define Test5: @1973-12-25T00:00:00.000+10:00 + 1 &#39;s&#39; = @1973-12-25T00:00:01.000+10:00
define Test6: @1973-12-25T00:00:00.000+10:00 + 0.1 &#39;s&#39; = @1973-12-25T00:00:00.100+10:00
define Test7: @1973-12-25T00:00:00.000+10:00 + 1 &#39;min&#39; = @1973-12-25T00:01:00.000+10:00
define Test8: @1973-12-25T00:00:00.000+10:00 + 1 &#39;h&#39; = @1973-12-25T01:00:00.000+10:00
define Test9: @1973-12-25 + 1 &#39;d&#39; = @1973-12-26
define Test10: @1973-12-25 + 1 &#39;mo&#39; = @1974-01-01 // This should be a run-time error
define Test11: @1973-12-25 + 1 &#39;wk&#39;// = @1974-01-01
define Test12: @1973-12-25 + 1 &#39;a&#39; = @1974-12-24 // This should be a run-time error
define Test13: @1973-12-25T00:00:00.000+10:00 + 1 &#39;second&#39; = @1973-12-25T00:00:01.000+10:00
define Test14: @1973-12-25T00:00:00.000+10:00 + 0.1 &#39;second&#39; = @1973-12-25T00:00:00.100+10:00
define Test15: @1973-12-25T00:00:00.000+10:00 + 1 &#39;minute&#39; = @1973-12-25T00:01:00.000+10:00
define Test16: @1973-12-25T00:00:00.000+10:00 + 1 &#39;hour&#39; = @1973-12-25T01:00:00.000+10:00
define Test17: @1973-12-25 + 1 &#39;day&#39; = @1973-12-26
define Test18: @1973-12-25 + 1 &#39;month&#39;// = @1974-01-25
define Test19: @1973-12-25 + 1 &#39;week&#39;// = @1974-01-01
define Test20: @1973-12-25 + 1 &#39;year&#39; = @1974-12-25
</code></pre></div>



<a name="211576302"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211576302" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211576302">(Sep 29 2020 at 03:09)</a>:</h4>
<p>Test11, for example,  should be 1974-01-01, not 1975-01-01, right?</p>



<a name="211576623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211576623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211576623">(Sep 29 2020 at 03:15)</a>:</h4>
<p>umm yeah I have a bunch of updates shortly</p>



<a name="211576898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211576898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211576898">(Sep 29 2020 at 03:20)</a>:</h4>
<p>(y)</p>



<a name="211577314"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211577314" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211577314">(Sep 29 2020 at 03:28)</a>:</h4>
<p>after actually implementing them, I get these:</p>
<div class="codehilite"><pre><span></span><code>@1973-12-25 + 7 &#39;days&#39; = @1974-01-01
@1973-12-25 + 7.7 &#39;days&#39; = @1974-01-01
@1973-12-25T00:00:00.000+10:00 + 7 &#39;days&#39; = @1974-01-01T00:00:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 7.7 &#39;days&#39; = @1974-01-01T00:00:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;sec&#39; = @1973-12-25T00:00:01.000+10:00
@1973-12-25T00:00:00.000+10:00 + 0.1 &#39;sec&#39; = @1973-12-25T00:00:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 10 &#39;msec&#39; = @1973-12-25T00:00:00.010+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;min&#39; = @1973-12-25T00:01:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;h&#39; = @1973-12-25T01:00:00.000+10:00
@1973-12-25 + 1 &#39;d&#39; = @1973-12-26
@1973-12-25 + 1 &#39;mo&#39; = @1974-01-23
@1973-12-25 + 1 &#39;wk&#39; = @1974-01-01
@1973-12-25 + 1 &#39;a&#39; = @1974-12-25
@1975-12-25 + 1 &#39;a&#39; = @1976-12-24
@1973-12-25T00:00:00.000+10:00 + 1 &#39;second&#39; = @1973-12-25T00:00:01.000+10:00
@1973-12-25T00:00:00.000+10:00 + 10 &#39;millisecond&#39; = @1973-12-25T00:00:00.010+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;minute&#39; = @1973-12-25T00:01:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;hour&#39; = @1973-12-25T01:00:00.000+10:00
@1973-12-25 + 1 &#39;day&#39; = @1973-12-26
@1973-12-25 + 1 &#39;month&#39; = @1974-01-25
@1973-12-25 + 1 &#39;week&#39; = @1974-01-01
@1973-12-25 + 1 &#39;year&#39; = @1974-12-25
</code></pre></div>



<a name="211619976"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211619976" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211619976">(Sep 29 2020 at 13:27)</a>:</h4>
<blockquote>
<p>@1973-12-25 + 1 'mo' = @1974-01-23</p>
</blockquote>
<p>I am getting 1974-01-24.   I am adding 365.24/12 days. Is that wrong?</p>



<a name="211620242"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211620242" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211620242">(Sep 29 2020 at 13:29)</a>:</h4>
<p>And I keep on getting confused with the exact literals for dates.  I am pretty sure that UCUM units go between quotes, but our custom calender units not, so, according to what I see here: <a href="http://hl7.org/fhirpath/#addition-2">http://hl7.org/fhirpath/#addition-2</a></p>
<p>This test <code>@1973-12-25 + 1 'month' = @1974-01-25</code> should look like <code>@1973-12-25 + 1 month = @1974-01-25</code>, right?</p>



<a name="211620698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211620698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211620698">(Sep 29 2020 at 13:32)</a>:</h4>
<p>Based on the <a href="http://hl7.org/fhirpath/#datetime-arithmetic">date/time arithmetic</a> topic, <code>@1973-12-25 + 1 'mo'</code> should give an error, on the grounds that it's using a definite-time duration unit as a calendar duration.</p>



<a name="211621141"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211621141" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211621141">(Sep 29 2020 at 13:35)</a>:</h4>
<p>On whether the calendar duration units are supposed to be quoted, the narrative for <a href="http://hl7.org/fhirpath/#quantity">Quantity</a> allows for both, though all the examples show calendar duration keywords without quotes, and the grammar supports the keywords directly.</p>



<a name="211621353"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211621353" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211621353">(Sep 29 2020 at 13:37)</a>:</h4>
<p>Ok, then I meant  <code>@1973-12-15 + 1 month</code>.  In my 365.25/4 addition that gives 1974-01-24  (10:30 in the morning)</p>



<a name="211621582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211621582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211621582">(Sep 29 2020 at 13:38)</a>:</h4>
<p>If we conflate  <code>x month</code> and <code>x  'month'</code>, you'll never get an error that "month" is not a valid UCUM code, right?  So anything between the quotes can be either UCUM or a calender duration?     What does    <code>(2 minutes).ToString()</code> print in your implementation?</p>



<a name="211621636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211621636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211621636">(Sep 29 2020 at 13:39)</a>:</h4>
<p>The same as <code>2 'minutes'</code> and <code>2 'min'</code>?</p>



<a name="211621638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211621638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211621638">(Sep 29 2020 at 13:39)</a>:</h4>
<p>It's calendar-based, so you actually just add 1 month, and get @1974-01-15.</p>



<a name="211621688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211621688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211621688">(Sep 29 2020 at 13:40)</a>:</h4>
<p>oh right. yes, that would happen if I would have implemented it.</p>



<a name="211621859"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211621859" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211621859">(Sep 29 2020 at 13:41)</a>:</h4>
<p><code>(2 minutes).toString()</code> gives <code>2 'minutes'</code> on the Java-based engine</p>



<a name="211622092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211622092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211622092">(Sep 29 2020 at 13:42)</a>:</h4>
<p>That surprises me.</p>



<a name="211622254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211622254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211622254">(Sep 29 2020 at 13:44)</a>:</h4>
<p>But some of the recent discussions have confused me thoroughly here.  I think I understood that year/month are still calender units, separate from UCUM, but that minutes/weeks/days etc are aligned with UCUM min,wk,d.  Is that correct?</p>



<a name="211622412"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211622412" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211622412">(Sep 29 2020 at 13:45)</a>:</h4>
<p>Yes, we have relaxed the "equivalent to UCUM" boundary to days (and weeks), rather than seconds, on the grounds that considering leap seconds is not generally a practical problem.</p>



<a name="211622485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211622485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211622485">(Sep 29 2020 at 13:45)</a>:</h4>
<p>Ok, so if my engine does   (1 week).ToString() = 1 'wk', that's fine?</p>



<a name="211622560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211622560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211622560">(Sep 29 2020 at 13:46)</a>:</h4>
<p>Or am I normalizing to UCUM too eagerly here</p>



<a name="211622900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211622900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211622900">(Sep 29 2020 at 13:48)</a>:</h4>
<p>That expression should be true, yes, but whether you want to be able to round-trip there is another question. The specs (FHIRPath and CQL) don't require the round-trip.</p>



<a name="211622920"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211622920" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211622920">(Sep 29 2020 at 13:48)</a>:</h4>
<p>Though we have been trying to get consistent behavior there.</p>



<a name="211623052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211623052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211623052">(Sep 29 2020 at 13:49)</a>:</h4>
<p>Yeah, I can see you're storing the actual literal, I guess the java implementation will do  <code>1 months.ToString() = 1 'months'</code>  (so we do normalize to within quotes?)</p>



<a name="211625027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211625027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211625027">(Sep 29 2020 at 14:02)</a>:</h4>
<p>Once it's the unit element of a Quantity value, it's just a string, so any processing already has to deal with the fact that it might be a UCUM code, and it might be a calendar duration keyword. So I don't know that we intentionally implemented it to support both, but rather that the most natural implementation supported both as a by-product.</p>



<a name="211675205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211675205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211675205">(Sep 29 2020 at 19:52)</a>:</h4>
<p>I admit to being confused about the calendar periods in the units when I made up the tests</p>



<a name="211675905"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211675905" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211675905">(Sep 29 2020 at 19:58)</a>:</h4>
<p>the reason it's confusing is this table:</p>



<a name="211675937"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211675937" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211675937">(Sep 29 2020 at 19:58)</a>:</h4>
<p><a href="/user_uploads/10155/3AFA6WFUDY8onYgvyPfjiDCq/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/3AFA6WFUDY8onYgvyPfjiDCq/image.png" title="image.png"><img src="/user_uploads/10155/3AFA6WFUDY8onYgvyPfjiDCq/image.png"></a></div>



<a name="211675952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211675952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211675952">(Sep 29 2020 at 19:58)</a>:</h4>
<p>you see that the unit representation has ' in the column</p>



<a name="211682760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211682760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211682760">(Sep 29 2020 at 20:54)</a>:</h4>
<p>Yes, I can see that that table is confusing, it was intended to distinguish between the keyword and the resulting value of the unit element of the Quantity. The Java implementation just turns the keyword into the string representation, so the difference just disappears.</p>



<a name="211682829"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211682829" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211682829">(Sep 29 2020 at 20:55)</a>:</h4>
<p>Does your parser accept the keyword version?</p>



<a name="211683471"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211683471" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211683471">(Sep 29 2020 at 21:00)</a>:</h4>
<p>yes it accepts either. I updated the tests - just committing now. Here's the modified version</p>



<a name="211683761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211683761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211683761">(Sep 29 2020 at 21:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>@1973-12-25 + 7 days = @1974-01-01
@1973-12-25 + 7.7 days = @1974-01-01
@1973-12-25T00:00:00.000+10:00 + 7 days @1974-01-01T00:00:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 7.7 days @1974-01-01T00:00:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 1 second @1973-12-25T00:00:01.000+10:00
@1973-12-25T00:00:00.000+10:00 + 10 millisecond @1973-12-25T00:00:00.010+10:00
@1973-12-25T00:00:00.000+10:00 + 1 minute @1973-12-25T00:01:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 1 hour @1973-12-25T01:00:00.000+10:00
@1973-12-25 + 1 day = @1973-12-26
@1973-12-25 + 1 month = @1974-01-25
@1973-12-25 + 1 week = @1974-01-01
@1973-12-25 + 1 year = @1974-12-25
@1973-12-25 + 1 &#39;d&#39; = @1973-12-26
@1973-12-25 + 1 &#39;mo&#39; -&gt; error
@1973-12-25 + 1 &#39;wk&#39; = @1974-01-01
@1973-12-25 + 1 &#39;a&#39; -&gt; error
@1975-12-25 + 1 &#39;a&#39; -&gt; error
@1973-12-25T00:00:00.000+10:00 + 1 &#39;s&#39; @1973-12-25T00:00:01.000+10:00
@1973-12-25T00:00:00.000+10:00 + 0.1 &#39;s&#39; @1973-12-25T00:00:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 10 &#39;ms&#39; @1973-12-25T00:00:00.010+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;min&#39; @1973-12-25T00:01:00.000+10:00
@1973-12-25T00:00:00.000+10:00 + 1 &#39;h&#39; @1973-12-25T01:00:00.000+10:00
@1974-12-25 + 7 -&gt; error
</code></pre></div>



<a name="211788835"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211788835" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211788835">(Sep 30 2020 at 16:47)</a>:</h4>
<p>"If a definite-quantity duration above seconds appears in a date/time arithmetic calculation, the evaluation will end and signal an error to the calling environment."  (<a href="http://hl7.org/fhirpath/#datetime-arithmetic">http://hl7.org/fhirpath/#datetime-arithmetic</a>).  Shouldn't <code>+ 1 'd'</code> , <code>+ 1 'wk'</code>, <code>+ 1 'min'</code>, and <code>+ 1 'h'</code> result in errors, or is that behavior changing?</p>



<a name="211790298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/211790298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#211790298">(Sep 30 2020 at 16:59)</a>:</h4>
<p>Never mind-- I see that these are tests for a change to the specification.  <a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison.20vs.20equality/near/209114649">https://chat.fhir.org/#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison.20vs.20equality/near/209114649</a></p>



<a name="212124354"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/212124354" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#212124354">(Oct 02 2020 at 20:24)</a>:</h4>
<p>So one thing that we've just noticed in getting these tests to all pass is that we are using the <code>code</code> element of the FHIR Quantity, which means that we need to set the <code>system</code> element as well. So two questions arise:</p>
<ol>
<li>Are all the engines using <code>Quantity.code</code> here, or are some of them using <code>unit</code>?</li>
<li>The <code>system</code> is <code>http://unitsofmeasure.org</code> for the UCUM units, but we don't actually have a system for the calendar duration units, what should the <code>system</code> value be when the <code>code</code> is a calendar duration unit? I propose <code>http://hl7.org/fhirpath/CodeSystem/calendar-units</code></li>
</ol>



<a name="212124611"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/212124611" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#212124611">(Oct 02 2020 at 20:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> , <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> , <span class="user-mention" data-user-id="195344">@Paul Lynch</span> , <span class="user-mention" data-user-id="191469">@Chris Moesel</span> , <span class="user-mention" data-user-id="191676">@Lee Surprenant</span></p>



<a name="212125593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/212125593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#212125593">(Oct 02 2020 at 20:35)</a>:</h4>
<p>I'm coming in late to the conversation.  Are we talking about how we convert <code>1 'wk'</code> and <code>1 week</code> to instances of FHIR <code>Quantity</code> (for the purpose of comparison)?</p>



<a name="212125783"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/212125783" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#212125783">(Oct 02 2020 at 20:36)</a>:</h4>
<p>That's not really a concern in my engine because we're always going the other way (converting FHIR <code>Quantity</code> to CQL <code>Quantity</code> for doing comparisons).  But I'm cool w/ what you propose above if it's useful for FP implementations.</p>



<a name="212129531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/212129531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#212129531">(Oct 02 2020 at 21:11)</a>:</h4>
<p>When fhirpath.js parses <code>1 'wk'</code> it creates an internal FP_Quantity instance which does not bother storing the system, because the unit is either UCUM or one of the calendar durations, and the case easily determined when needed.</p>



<a name="212129985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/212129985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#212129985">(Oct 02 2020 at 21:16)</a>:</h4>
<p>To answer the specific questions from Bryn:<br>
1)  We're really not using FHIR Quantity for that.  FP_Quantity puts the unit in "unit", not "code" (and in fact does not have a "code").<br>
2) I have no objection to creating a code system for the calendar duration units, and the the URI looks fine to me.</p>



<a name="212141536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/212141536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#212141536">(Oct 02 2020 at 23:48)</a>:</h4>
<p>I'm using unit+system+code for UCUM units, and just unit for the other informal FHIRPath defined units, and doing magic on them. I agree that it would be more natural to us a defined system internally, and I'd happily use an agreed one, but I think it's all entirely internal details unless you propose for using the formal definition in other Quantities, which is not a FHIRPath issue</p>



<a name="212178386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date%20Time%20operations/near/212178386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.20Time.20operations.html#212178386">(Oct 03 2020 at 16:08)</a>:</h4>
<p>Having that be an internal implementation detail makes complete sense to me, and I'm also hearing support for the idea of defining the code system, so I've submitted a tracker to that effect: <a href="https://jira.hl7.org/browse/FHIR-28927">https://jira.hl7.org/browse/FHIR-28927</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
