---
layout: page
title: "FHIR Chat  · Matches question · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html">Matches question</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="274771854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274771854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274771854">(Mar 10 2022 at 00:07)</a>:</h4>
<p>According to the spec, matches():</p>
<blockquote>
<p>Returns true when the value matches the given regular expression. Regular expressions should function consistently, regardless of any culture- and locale-specific settings in the environment, should be case-sensitive, use 'single line' mode and allow Unicode characters.</p>
</blockquote>



<a name="274771900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274771900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274771900">(Mar 10 2022 at 00:08)</a>:</h4>
<p>so, should this test pass:</p>



<a name="274771926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274771926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274771926">(Mar 10 2022 at 00:08)</a>:</h4>
<p>'<a href="http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1'.matches('Library')">http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1'.matches('Library')</a></p>



<a name="274772318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274772318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274772318">(Mar 10 2022 at 00:12)</a>:</h4>
<p>my take is that this should not pass. <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> </p>
<p>because it doesn't pass i java or dotnet: both of them treat matches as a full match, not a partial match</p>



<a name="274773802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274773802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274773802">(Mar 10 2022 at 00:31)</a>:</h4>
<p>If you want it to match the full string, you could use the beginning/end of string markers: <br>
'<a href="http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1'.matches('^Library$')">http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1'.matches('^Library$')</a><br>
which would be false.<br>
Without those, I think it should be true.  Otherwise, how would you test whether an expression matches part of a string?</p>



<a name="274782994"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274782994" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274782994">(Mar 10 2022 at 02:46)</a>:</h4>
<p>JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/match">String.match(regex)</a> does not require a full-string match. It works like <span class="user-mention" data-user-id="195344">@Paul Lynch</span> suggests (matches any region; use <code>^</code>/ <code>$</code> to force full-string matches).</p>



<a name="274783319"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274783319" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274783319">(Mar 10 2022 at 02:51)</a>:</h4>
<p>That said, I think I recall discussing CQL <code>matches</code> behavior w/ <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> and he indicated that it should be full-string matching for CQL. Assuming I remember that correctly, I expect that's also the intent for FHIRPath.</p>



<a name="274803825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274803825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274803825">(Mar 10 2022 at 08:29)</a>:</h4>
<p>I'm with Paul on this one. We've been explicit with the other parameters for the regex engine.<br>
(not sure why we'd have said single line too, means can't process narratives, or longer text content)</p>



<a name="274881015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274881015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274881015">(Mar 10 2022 at 19:08)</a>:</h4>
<blockquote>
<p>Otherwise, how would you test whether an expression matches part of a string?</p>
</blockquote>
<div class="codehilite"><pre><span></span><code>&#39;http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1&#39;.matches(&#39;.*Library.*&#39;)
</code></pre></div>



<a name="274881244"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274881244" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274881244">(Mar 10 2022 at 19:10)</a>:</h4>
<p>for me, a full string match is the intent. The spec says "when the value matches the given regular expression" not "when the value has content that matches the given regular expression"</p>
<p>This is a subtle difference. But this certainly needs clarity</p>



<a name="274886555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274886555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274886555">(Mar 10 2022 at 19:51)</a>:</h4>
<p>When languages (e.g. JavaScript, Ruby, Perl) provide the ability to match a string against a regular expression, it is the regular expression that controls whether it is against the full string or not.  I think it would be very unexpected to provide a "match" API that takes a regular expression but always requires it to match against the full string.</p>



<a name="274887715"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274887715" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274887715">(Mar 10 2022 at 20:00)</a>:</h4>
<p>given that's what Java does, it's not going to be that unexpected</p>



<a name="274888048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274888048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274888048">(Mar 10 2022 at 20:03)</a>:</h4>
<p>It's also what XML schema does</p>



<a name="274889867"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274889867" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274889867">(Mar 10 2022 at 20:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179266-fhirpath/topic/Matches.20question/near/274887715">said</a>:</p>
<blockquote>
<p>given that's what Java does, it's not going to be that unexpected</p>
</blockquote>
<p>I guess it has been too many years since I did Java development.  I had to go test that, but you are right.</p>



<a name="274890621"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274890621" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274890621">(Mar 10 2022 at 20:26)</a>:</h4>
<p>Java has both matches() and find() (in Matcher) and find() is the one that will look for a match in a substring of the string.  It sounds like if FHIRPath matches() is supposed to be like Java matches(), then find() should be added as well.</p>



<a name="274890762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274890762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274890762">(Mar 10 2022 at 20:27)</a>:</h4>
<p>I don't understand why Java has both APIs though, when the regular expression can control that.</p>



<a name="274890923"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274890923" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274890923">(Mar 10 2022 at 20:29)</a>:</h4>
<p>A tool I frequently use is <a href="https://regexr.com/">https://regexr.com/</a> (though I tested against several just to be sure - feel free to use whichever tester you would like).</p>
<p>If you enter the text: <code>http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1</code>, you can see the difference in the evaluations:</p>
<table>
<thead>
<tr>
<th>RegEx</th>
<th>IsMatch</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Library</code></td>
<td>true</td>
<td>matches the literal 'Library' in the string</td>
</tr>
<tr>
<td><code>.*Library.*</code></td>
<td>true</td>
<td>matches the entire string</td>
</tr>
<tr>
<td><code>^Library$</code></td>
<td>false</td>
<td>asking for exact literal</td>
</tr>
</tbody>
</table>
<p>Given that every 'tester' I used is consistent, and assuming the intention is that FHIRPath is consistent with regex, I would apply those behaviors.</p>
<p>edit: actually, at <a href="https://regex101.com/">https://regex101.com/</a> it can perform the evaluation in a lot of contexts (PHP versions, JS, Java, .Net).  They are all consistent with the above.</p>



<a name="274892635"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274892635" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274892635">(Mar 10 2022 at 20:46)</a>:</h4>
<p>well, I use that too. But it's testing regex matching, not the behaviour of the match() function, which is where the actual question arises.</p>



<a name="274892677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274892677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274892677">(Mar 10 2022 at 20:46)</a>:</h4>
<p>either way around works - you just have to prefix/suffix for the other case (either ^ &amp; $ or .*)</p>



<a name="274892940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274892940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274892940">(Mar 10 2022 at 20:49)</a>:</h4>
<p>Sure. My point is that matching against <code>Library</code>, <code>.*Library.*</code>, and <code>^Library$</code> are different things in RegEx.  FHIRPath can define any behavior it wants, but if it differs from the behavior of regex there, it will cause confusion down the road.</p>
<p>edit for clarity</p>



<a name="274892960"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274892960" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274892960">(Mar 10 2022 at 20:49)</a>:</h4>
<blockquote>
<p>don't understand why Java has both APIs though, when the regular expression can control that.</p>
</blockquote>
<p>a mature API. If you have contexts in which the regular expression is written for one approach and not the other, then massaging it from one to the other is yucky</p>



<a name="274893024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274893024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274893024">(Mar 10 2022 at 20:50)</a>:</h4>
<blockquote>
<p>if FHIRPath matches() is supposed to be like Java matches(), then find() should be added as well</p>
</blockquote>
<p>I think that's the right thing for us to do here</p>



<a name="274894414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274894414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274894414">(Mar 10 2022 at 21:02)</a>:</h4>
<blockquote>
<p>it differs from the behavior of regex there</p>
</blockquote>
<p>my point is that this is orthogonal. The question isn't regex, the question is the meaning of the match() function. And we're screwed one way or the other because java does it one way and javascript does it another</p>



<a name="274895877"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274895877" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274895877">(Mar 10 2022 at 21:15)</a>:</h4>
<p>Yep, I get that we are discussing the behavior of a FHIRPath function.  It could be defined to do literally anything and would be correct by definition =).</p>
<p>But this is also relevant for the sibling <code>replaceMatches</code> function, which I assume should use the same semantics as <code>matches</code> and depends on what parts of the string are actually matched.</p>



<a name="274904897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274904897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274904897">(Mar 10 2022 at 22:28)</a>:</h4>
<p>Ha.  That's a good point.  <code>replaceMatches</code> wouldn't work very well if it only did full-string matching, now would it?</p>



<a name="274904965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274904965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274904965">(Mar 10 2022 at 22:29)</a>:</h4>
<p>I agree this test should not pass, but also agree that the specification needs some clarity here. I have confirmed that the CQL engine behaves this way (fails the test), and that both the FHIRPath and CQL descriptions of the matches (and replaceMatches) functions are identical. Given that the engines are confirmed to behave this way I think this can be a technical correction to clarify the expected semantics here on FHIRPath and CQL.</p>



<a name="274905749"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274905749" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274905749">(Mar 10 2022 at 22:36)</a>:</h4>
<p>Bryn, how can you replace just 'Library' in <code>http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1</code> via <code>replaceMatches</code> if that test fails?  (assuming normal regex processing that replace <code>.*Library.*</code> would replace the whole string)</p>



<a name="274907622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274907622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274907622">(Mar 10 2022 at 22:54)</a>:</h4>
<p>Hmm.... fair point, so basically the way it works now we can't hit that simple use case :(</p>



<a name="274907723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274907723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274907723">(Mar 10 2022 at 22:55)</a>:</h4>
<p>So as Grahame is suggesting, we'd have to introduce a findMatches() and change replaceMatches to use find semantics.</p>



<a name="274908388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274908388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274908388">(Mar 10 2022 at 23:01)</a>:</h4>
<p>I am not familiar enough with FHIRpath implementations to weigh in on that part.  I do not see any examples of <code>match</code> in the spec, but I do see something under <a href="https://hl7.org/fhirpath/#replacematchesregex-string-substitution-string-string">replaceMatches</a>... which uses the <code>replace</code> function  =).</p>
<p>Assuming that we swap out <code>replace</code> with <code>repalceMatches</code>, the example would indicate that the match semantics would need the be the 'typical regex' version to work.</p>
<p>I also discovered the note in that section that the implementation should generally align with <a href="https://hl7.org/fhirpath/#PCRE">PCRE</a>, in which the original test matches successfully.</p>



<a name="274908750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274908750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274908750">(Mar 10 2022 at 23:05)</a>:</h4>
<p>Oh what a tangled web we weave.</p>



<a name="274908860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274908860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274908860">(Mar 10 2022 at 23:06)</a>:</h4>
<p>Are you saying that PCRE semantics implies the test should pass?</p>



<a name="274909273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274909273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274909273">(Mar 10 2022 at 23:10)</a>:</h4>
<p>As far as I can tell, yes. <a href="https://regex101.com/">https://regex101.com/</a> has the option for testing against PCRE and it passes there.</p>



<a name="274909997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274909997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274909997">(Mar 10 2022 at 23:18)</a>:</h4>
<p>Note that FHIRPath's <a href="https://hl7.org/fhirpath/#replacematchesregex-string-substitution-string-string">replaceMatches</a> says:</p>
<blockquote>
<p>Matches the input using the regular expression in regex and replaces each match with the substitution string.</p>
</blockquote>
<p>I think the phrase "replaces each match" implies that the pattern can match on sequences within the input string (not just the whole string itself).</p>



<a name="274910240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274910240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274910240">(Mar 10 2022 at 23:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> -- As you know, CQL has <a href="https://cql.hl7.org/09-b-cqlreference.html#matches">matches</a>, <a href="https://cql.hl7.org/09-b-cqlreference.html#replacematches">replaceMatches</a>, and <a href="https://cql.hl7.org/09-b-cqlreference.html#splitonmatches">splitOnMatches</a>.</p>
<p>Whether <code>matches</code> is full-string or not is ambiguous.  But <code>replaceMatches</code> contains a description similar to what I pointed out above (implying matches against substrings) and an example that demonstrates this:</p>
<div class="codehilite"><pre><span></span><code>define &quot;ReplaceMatchesFound&quot;: ReplaceMatches(&#39;ABCDE&#39;, &#39;C&#39;, &#39;XYZ&#39;) // &#39;ABXYZDE&#39;
</code></pre></div>
<p>And of course <code>SplitOnMatches</code> would just be silly if the pattern was required to match the whole string.</p>



<a name="274911880"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274911880" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274911880">(Mar 10 2022 at 23:40)</a>:</h4>
<blockquote>
<p>but I do see something under replaceMatches... which uses the replace function =).</p>
</blockquote>
<p>Ha, that one is definitely a bug.</p>



<a name="274912091"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274912091" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274912091">(Mar 10 2022 at 23:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> , agreed, replaceMatches in both FHIRPath and CQL imply find semantics, and splitOnMatches would be silly without it.</p>



<a name="274912228"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274912228" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274912228">(Mar 10 2022 at 23:44)</a>:</h4>
<p>So maybe define a .matchesFull() that has full-string matching semantics and clarify that .matches should use "find" semantics, consistent with PCRE?</p>



<a name="274913307"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/274913307" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#274913307">(Mar 10 2022 at 23:58)</a>:</h4>
<p>And yes, confirmed that the replaceMatches in the CQL engine uses find semantics:</p>
<div class="codehilite"><pre><span></span><code>define TestReplaceMatches: ReplaceMatches(&#39;http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1&#39;, &#39;Library&#39;, &#39;Measure&#39;)
// returns http://fhir.org/guides/cqf/common/Measure/FHIR-ModelInfo|4.0.1
</code></pre></div>



<a name="275217548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275217548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275217548">(Mar 14 2022 at 10:32)</a>:</h4>
<blockquote>
<p>'<a href="http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1'.matches('Library')">http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1'.matches('Library')</a><br>
because it doesn't pass i java or dotnet: both of them treat matches as a full match, not a partial match</p>
</blockquote>
<p>It doesn't?  I am calling the underlying Regex.IsMatch .NET function which according to this: <a href="https://docs.microsoft.com/en-us/dotnet/api/system.text.regularexpressions.regex.ismatch?view=net-6.0">https://docs.microsoft.com/en-us/dotnet/api/system.text.regularexpressions.regex.ismatch?view=net-6.0</a> does a partial match.</p>
<p>I just tested that:</p>
<p><code>Assert.IsTrue(Regex.IsMatch("http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1","Library"))</code> passes...</p>



<a name="275251988"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275251988" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275251988">(Mar 14 2022 at 15:27)</a>:</h4>
<p>Okay, based on feedback here, proposed disposition for this technical correction: <a href="https://jira.hl7.org/browse/FHIR-36257">https://jira.hl7.org/browse/FHIR-36257</a></p>



<a name="275252388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275252388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275252388">(Mar 14 2022 at 15:30)</a>:</h4>
<p>And another one to add .matchesFull() <a href="https://jira.hl7.org/browse/FHIR-36270">https://jira.hl7.org/browse/FHIR-36270</a></p>



<a name="275252745"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275252745" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275252745">(Mar 14 2022 at 15:32)</a>:</h4>
<p>And a technical correction for the replaceMatches example: <a href="https://jira.hl7.org/browse/FHIR-36271">https://jira.hl7.org/browse/FHIR-36271</a></p>



<a name="275255005"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275255005" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275255005">(Mar 14 2022 at 15:47)</a>:</h4>
<p>Thanks Bryn, I added some notes to <a href="http://jira.hl7.org/browse/FHIR-36257">FHIR-36257</a> that could provide additional clarity.</p>
<p>I am not sure I understand the implementation of <code>matchesFull()</code>.  Is it checking to see if an entire string matches a regular expression (e.g., all characters in input are part of a match group)?  What is the use case that needs that vs. either <code>matches</code> or <code>=</code>?</p>



<a name="275304731"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275304731" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275304731">(Mar 14 2022 at 22:10)</a>:</h4>
<p><span class="user-mention" data-user-id="222054">@Gino Canessa</span> your weird and misplaced obsession with standard regex had please not be true.</p>



<a name="275304789"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275304789" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275304789">(Mar 14 2022 at 22:10)</a>:</h4>
<p>specifically the table you posted</p>



<a name="275304899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275304899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275304899">(Mar 14 2022 at 22:11)</a>:</h4>
<p>I don't want to have to scan and reverse engineeer the regex in order to make $test^ work</p>



<a name="275305087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275305087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275305087">(Mar 14 2022 at 22:13)</a>:</h4>
<p>What did I miss?  Following are from online tools (all the ones I tested agree):<br>
<a href="/user_uploads/10155/v0iwUOn6136l4jAiHIcdL5Vv/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/v0iwUOn6136l4jAiHIcdL5Vv/image.png" title="image.png"><img src="/user_uploads/10155/v0iwUOn6136l4jAiHIcdL5Vv/image.png"></a></div>



<a name="275305783"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275305783" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275305783">(Mar 14 2022 at 22:21)</a>:</h4>
<p>(this is consistent with the regex implementation in C#, and I <em>believe</em> the <code>Pattern</code> implementation in Java - though I have not tried it myself)</p>



<a name="275313342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275313342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275313342">(Mar 14 2022 at 23:52)</a>:</h4>
<p>the question is not, what do the underlying regex engines do, the question is, how does the function matches() work.</p>



<a name="275315541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275315541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275315541">(Mar 15 2022 at 00:23)</a>:</h4>
<p>Sure <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> .  But I believe the question came up, and several implementers have chimed since, that other languages have a different behavior for their language's <code>matches</code> function.  <em>Java</em> is the odd duck that has a separate <code>matches</code> and <code>find</code> - <code>find</code> is aligned with what everyone else uses for <code>matches</code>.</p>
<p>I do not think you would disagree if I say that programming languages have idiosyncrasies.  In this case, there are production implementations with both behaviors.  I am offering the view that FHIRPath should align with the general RegEx definition and behavior, instead of adopting the unique Java convention.</p>
<p>Development-wise, changing the Java implementation to use <code>find</code> under-the-hood makes it the same as other languages.  To my knowledge, neither JS (client or node) nor C# have any function that replicates the behavior of Java <code>matches</code>, meaning other SDK developers would need to re-invent the behaviors to match.</p>



<a name="275319521"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275319521" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275319521">(Mar 15 2022 at 01:33)</a>:</h4>
<p>sigh. ok. I have switched it round, and added matchesFull to the java implementation</p>



<a name="275725818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275725818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275725818">(Mar 17 2022 at 20:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span> this breaks the widely used constraint sdf-0: <code>name.matches('[A-Z]([A-Za-z0-9_]){0,254}'</code>&gt;</p>
<p>I am internally treating this as <code>name.matches('^[A-Z]([A-Za-z0-9_]){0,254}$')</code> in the java validator</p>



<a name="275741937"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/275741937" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#275741937">(Mar 17 2022 at 23:27)</a>:</h4>
<p>also eld-19 and eld-20 need wrapping with ^ and $</p>



<a name="276020120"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Matches%20question/near/276020120" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Matches.20question.html#276020120">(Mar 21 2022 at 08:49)</a>:</h4>
<p>Thanks, yes, I will admit that my mental regex parser <em>does</em> work like the Java matches(), so I never noticed these mistakes. We'll fix it in the .NET library too.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
