---
layout: page
title: "FHIR Chat  · FHIRPath constraints · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html">FHIRPath constraints</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="185857572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/185857572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Nash <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#185857572">(Jan 16 2020 at 20:41)</a>:</h4>
<p>Hi, I have a question about FHIRPath constraints. When a constraint evaluates to an empty collection does that imply that the constraint is not satisfied (i.e. should it be treated as if it evaluated to false)?</p>
<p>Specifically, FHIR's Bundle.entry has a constraint, fullUrl.contains('/_history/').not(), that will evaluate to an empty collection when fullUrl is not specified on the entry. In this case, I believe I have to treat the empty collection the same as "true" since transactions and batches aren't required to have a fullUrl. However, this goes against my intuition that constraints should explicitly evaluate to true in order to be considered satisfied.</p>



<a name="185876251"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/185876251" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#185876251">(Jan 17 2020 at 00:17)</a>:</h4>
<p>empty collection is false, and I think that expression is in error.</p>



<a name="185939187"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/185939187" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Nash <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#185939187">(Jan 17 2020 at 17:38)</a>:</h4>
<p>Thank you, Grahame. I'm new to the FHIR community. Are there any steps I can take to help fix the constraint in the spec?</p>



<a name="185940148"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/185940148" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#185940148">(Jan 17 2020 at 17:50)</a>:</h4>
<p>You can sign up to HL7's Jira site (<a href="http://jira.hl7.org" target="_blank" title="http://jira.hl7.org">http://jira.hl7.org</a>) and submit a change request here: <a href="https://jira.hl7.org/projects/FHIR" target="_blank" title="https://jira.hl7.org/projects/FHIR">https://jira.hl7.org/projects/FHIR</a></p>



<a name="185954168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/185954168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Nash <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#185954168">(Jan 17 2020 at 20:35)</a>:</h4>
<p>Reported: <a href="https://jira.hl7.org/browse/FHIR-25525" target="_blank" title="https://jira.hl7.org/browse/FHIR-25525">https://jira.hl7.org/browse/FHIR-25525</a></p>



<a name="186921615"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/186921615" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nik Klassen <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#186921615">(Jan 29 2020 at 19:46)</a>:</h4>
<p>We are running into this again in some other places. Consider <a href="http://Questionnaire.name" target="_blank" title="http://Questionnaire.name">Questionnaire.name</a>. The constraint on this field is <code>name.matches('[A-Z]([A-Za-z0-9_]){0,254}')</code> in FHIRPath, but in XPath it's <code>not(exists(f:name/@value)) or matches(f:name/@value, '[A-Z]([A-Za-z0-9_]){0,254}')</code>. To me this shows pretty clearly that the FHIRPath should have an <code>exists()</code> check. In the case mentioned previously by Aaron, the XPath is <code>not(exists(f:fullUrl[contains(string(@value), '/_history/')]))</code>. Again XPath has an <code>exists()</code> check and FHIRPath does not. It is possible that there are more examples in the StructureDefinitions of XPath treating missing fields correctly with <code>exists()</code> where FHIRPath does not?</p>



<a name="186922983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/186922983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#186922983">(Jan 29 2020 at 20:00)</a>:</h4>
<p>it is possible</p>



<a name="186926310"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/186926310" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nik Klassen <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#186926310">(Jan 29 2020 at 20:38)</a>:</h4>
<p>Is the best thing to do just file bugs for every expression we find?</p>



<a name="186926935"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/186926935" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#186926935">(Jan 29 2020 at 20:45)</a>:</h4>
<p>sure is</p>



<a name="243115849"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243115849" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Prud&#x27;hommeaux <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243115849">(Jun 18 2021 at 04:41)</a>:</h4>
<p>are constraint[n].expression and are constraint[n].xpath both tested? should one (presumably the former) be considered authoritative?</p>



<a name="243115914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243115914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Prud&#x27;hommeaux <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243115914">(Jun 18 2021 at 04:42)</a>:</h4>
<p>I assume that .expression gets code-gen'd into java classes for run-time checks and .xpath is only used if you're e.g. building schematron rules</p>



<a name="243116106"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243116106" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243116106">(Jun 18 2021 at 04:47)</a>:</h4>
<p>expression is authoritative. We can say things using FHIRpath that aren't possible in XPath, and also, XPath only applies the XML serialization</p>



<a name="243116171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243116171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Prud&#x27;hommeaux <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243116171">(Jun 18 2021 at 04:48)</a>:</h4>
<p>ack. is .xpath tested or is it caveat emptor?</p>



<a name="243116205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243116205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243116205">(Jun 18 2021 at 04:49)</a>:</h4>
<p>not tested to the same degree. I think I parse them all, but I'm not sure that they are correct statements</p>



<a name="243116436"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243116436" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Prud&#x27;hommeaux <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243116436">(Jun 18 2021 at 04:53)</a>:</h4>
<p>i can imagine that .expression is compiled into java code which is executed during ingestion in hapi, which is then tested against the corpus of examples.<br>
i can also imagine that the .xpath is translated into Schematron, which <em>could</em> be tested against the corpus of XML examples, but probably isn't.</p>



<a name="243116444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243116444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Prud&#x27;hommeaux <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243116444">(Jun 18 2021 at 04:53)</a>:</h4>
<p>those seem about right?</p>



<a name="243117054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243117054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243117054">(Jun 18 2021 at 05:06)</a>:</h4>
<p>close: not compiled; there's a run time engine that executes FHIRPath</p>
<p>Schematron is generated, yes. And I do test it, but somehow the testing is deficient because people report expression issues that they don't against the FHIRPath - so inspecting my testing is on the to do list</p>



<a name="243820494"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/FHIRPath%20constraints/near/243820494" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/FHIRPath.20constraints.html#243820494">(Jun 24 2021 at 17:37)</a>:</h4>
<p>I have on occasion (generally before a publication) run the XSLT that results from the XPath schematrons through Saxon SA (when I happen to have a licensed version that doesn't blow up on our schemas).  That at least checks that the elements and paths we're navigating are legitimate.  It doesn't check that the rules are enforced correctly though.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
