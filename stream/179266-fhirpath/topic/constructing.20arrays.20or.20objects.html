---
layout: page
title: "FHIR Chat  · constructing arrays or objects · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html">constructing arrays or objects</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="202392051"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202392051" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Harsch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202392051">(Jun 30 2020 at 03:37)</a>:</h4>
<p>Hello, I am trying to construct a result set from a fhirpath query on data that looks like this:<br>
<a href="/user_uploads/10155/NRgTKpeHhv37wmoSnbQzEPKh/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/NRgTKpeHhv37wmoSnbQzEPKh/image.png" title="image.png"><img src="/user_uploads/10155/NRgTKpeHhv37wmoSnbQzEPKh/image.png"></a></div><p>Optimally, I want a JSON structure back that looks like</p>
<div class="codehilite"><pre><span></span><code>[
    {
        &#39;provider&#39;: &#39;HAPI Public Server - Public HAPI Server&#39;
        &#39;resource&#39;:   record_body.entry.resource
    },
    {...}
]
</code></pre></div>


<p>The closest I've gotten is this query:<br>
provider.union(record_body.entry.resource.where(resourceType = 'Observation'))</p>
<p>I'm expecting it might return the provider and the resource object, e.g.:<br>
[<br>
'HAPI Public Server - Public HAPI Server',<br>
record_body.entry.resource,<br>
'HAPI Public Server - Public HAPI Server',<br>
record_body.entry.resource,<br>
...<br>
]</p>
<p>In fhirpath,js this yields<br>
Error: Not implemented: union</p>
<div class="codehilite"><pre><span></span><code>at doInvoke (/Users/harsch/git/patient-portal/patient-web/node_modules/fhirpath/src/fhirpath.js:459:11)
at Object.&lt;anonymous&gt;.engine.FunctionInvocation (/Users/harsch/git/patient-portal/patient-web/node_modules/fhirpath/src/fhirpath.js:501:10)
at Object.&lt;anonymous&gt;.engine.doEval (/Users/harsch/git/patient-portal/patient-web/node_modules/fhirpath/src/fhirpath.js:585:22)
at /Users/harsch/git/patient-portal/patient-web/node_modules/fhirpath/src/fhirpath.js:157:19
</code></pre></div>


<p>So, I guess the crux of my question is: How do you construct arbitrary array or objects with Fhirpath?</p>



<a name="202394133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202394133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202394133">(Jun 30 2020 at 04:16)</a>:</h4>
<p>might be a question for <a class="stream" data-stream-id="179169" href="/#narrow/stream/179169-javascript">#javascript</a> but if you're running in HAPI why are you using the js FHIRPath engine not the java one?</p>



<a name="202442481"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202442481" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202442481">(Jun 30 2020 at 14:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310838">Tim Harsch</span> <a href="#narrow/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects/near/202392051">said</a>:</p>
<blockquote>
<p>In fhirpath,js this yields<br>
Error: Not implemented: union</p>
</blockquote>
<p>In fhirpath.js, the "union" function is not yet implemented, but the union operator "|" is, so you should be able to write:<br>
provider | record_body.entry.resource.where(resourceType = 'Observation')</p>



<a name="202446444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202446444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202446444">(Jun 30 2020 at 14:53)</a>:</h4>
<p>You can use the <code>.select()</code> function to shape the results, but there is no generic object construction syntax in FHIRPath, and the array construction syntax is limited to the use of union.</p>



<a name="202454243"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202454243" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Harsch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202454243">(Jun 30 2020 at 15:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects/near/202394133">said</a>:</p>
<blockquote>
<p>might be a question for <a class="stream" data-stream-id="179169" href="/#narrow/stream/179169-javascript">#javascript</a> but if you're running in HAPI why are you using the js FHIRPath engine not the java one?</p>
</blockquote>
<p>Thanks for the response.  I posted here because I'm only concerned with query syntax  at the moment.  I suspect the <code>not implemented</code> error will not be an issue if I find the proper query.<br>
 HAPI is just one provider I'm fetching data from.  My code is intended for a client processing the data from the provider.</p>



<a name="202455340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202455340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Harsch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202455340">(Jun 30 2020 at 15:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191359">Bryn Rhodes</span> <a href="#narrow/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects/near/202446444">said</a>:</p>
<blockquote>
<p>You can use the <code>.select()</code> function to shape the results, but there is no generic object construction syntax in FHIRPath, and the array construction syntax is limited to the use of union.</p>
</blockquote>
<p>Hmm...  my original query that served me well for some time was this:  <code>provider | record_body.entry.resource.where(resourceType = '${type}')</code>  (an ecmascript template string, $type is a JS var).   which yields an array with providername and N resource objects.  When I had a second provider in my data I would get 2 providers, followed by N resources from the first, and M resources from the second (screenshot below).  So I'm unable to tie the providers back to resources.   Can you think of a way to handle this without object construction?</p>
<p><a href="/user_uploads/10155/rqNx_37vbPO6twz8ojDyCLRn/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/rqNx_37vbPO6twz8ojDyCLRn/image.png" title="image.png"><img src="/user_uploads/10155/rqNx_37vbPO6twz8ojDyCLRn/image.png"></a></div>



<a name="202472890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202472890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202472890">(Jun 30 2020 at 18:00)</a>:</h4>
<p>I haven't tested it, but what about something using .select as Bryn suggested, like: select( provider | $this.entry.....)</p>



<a name="202485831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202485831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Harsch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202485831">(Jun 30 2020 at 19:49)</a>:</h4>
<p>I tried something like this: <code>select( $this.provider | $this.record_body.entry.resource.where(resourceType = 'Observation'))</code> but an issue I see is that providers show up for records that are not Observations as in:<br>
<a href="/user_uploads/10155/QRGgeEFWWUzb4JgyBSqyqzr2/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/QRGgeEFWWUzb4JgyBSqyqzr2/image.png" title="image.png"><img src="/user_uploads/10155/QRGgeEFWWUzb4JgyBSqyqzr2/image.png"></a></div><p>The data file is here:  <a href="https://gist.github.com/timharsch/05d5db2d690e486c38f476fa424a1f98">https://gist.github.com/timharsch/05d5db2d690e486c38f476fa424a1f98</a></p>



<a name="202486304"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202486304" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Harsch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202486304">(Jun 30 2020 at 19:53)</a>:</h4>
<p>It's almost like <a href="http://hl7.org/fhirpath/N1/#string-concatenation">http://hl7.org/fhirpath/N1/#string-concatenation</a>   if there were an &amp; operator I could use in place of pipe.</p>



<a name="202500373"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/constructing%20arrays%20or%20objects/near/202500373" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/constructing.20arrays.20or.20objects.html#202500373">(Jun 30 2020 at 21:56)</a>:</h4>
<p>I guess you are wanting to filter out the bundles that don't have Observations.  Before you do the select, you could do a where:  where(record_body.entry.resource.resourceType.first() = 'Observation').select(...).  I am assuming each bundle only has resources of one type.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
