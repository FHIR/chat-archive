---
layout: page
title: "FHIR Chat  · Is code in a set of codes? · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html">Is code in a set of codes?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="242107020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242107020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242107020">(Jun 09 2021 at 18:09)</a>:</h4>
<p>I'm trying to write an invariant where a code has to be in a set of codes depending on a condition:<br>
If type = C43660, then serviceProvisionCode = C106443, C131710, C131708, and/or C131709.</p>
<p>I've tried writing this as:<br>
type.coding.code != 'C43360' or serviceProvisionCode.where((coding.code in {'C106643','C131710','C131708','C131709'}).not()).count() = 0<br>
OR<br>
type.coding.code != 'C43360' or serviceProvisionCode.where(({'C106643','C131710','C131708','C131709'} contains coding.code).not()).count() = 0</p>
<p>Both of those fail with a "expecting a token name" error:<br>
Problem processing expression type.coding.code != 'C43360' or serviceProvisionCode.where((coding.code in {'C106643','C131710','C131708','C131709'}).not()).count() = 0 in profile <a href="http://hl7.org/fhir/us/spl/StructureDefinition/LabelerBusinessOperation">http://hl7.org/fhir/us/spl/StructureDefinition/LabelerBusinessOperation</a> path HealthcareService: Error @1, 7: Found { expecting a token name<br>
Problem processing expression type.coding.code != 'C43360' or serviceProvisionCode.where(({'C106643','C131710','C131708','C131709'} contains coding.code).not()).count() = 0 in profile <a href="http://hl7.org/fhir/us/spl/StructureDefinition/LabelerBusinessOperation">http://hl7.org/fhir/us/spl/StructureDefinition/LabelerBusinessOperation</a> path HealthcareService: Error @1, 5: Found { expecting a token name</p>
<p>I'm guessing that I'm not specifying the static collection correctly.  Can someone lend me a hand?</p>



<a name="242132721"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242132721" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242132721">(Jun 09 2021 at 21:24)</a>:</h4>
<p>where('C106643' | 'C131710'|'C131708' | 'C131709')</p>



<a name="242135272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242135272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242135272">(Jun 09 2021 at 21:46)</a>:</h4>
<p><code>type.coding.where(code = 'C43360').exists() implies serviceProvisionCode.coding.where(code in ('C106643' | 'C131710' | 'C131708' | 'C131709')).exists()</code></p>



<a name="242135291"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242135291" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242135291">(Jun 09 2021 at 21:46)</a>:</h4>
<p>Using implies makes it a little more readable, IMHO</p>



<a name="242135387"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242135387" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242135387">(Jun 09 2021 at 21:47)</a>:</h4>
<p>This logic is also assuming system, which might be dangerous?</p>



<a name="242139016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242139016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242139016">(Jun 09 2021 at 22:27)</a>:</h4>
<p>thanks to both.  I can't find that syntax in the FHIRPath spec, so a pointer to it would be nice.  As to assuming system, I've already got a required binding so I know the system is fixed.</p>



<a name="242139333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242139333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242139333">(Jun 09 2021 at 22:31)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> I need to say that only those codes are allowed.  I think what you wrote says that one of those codes has to be there, but that others could also be there?</p>



<a name="242142648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242142648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242142648">(Jun 09 2021 at 23:14)</a>:</h4>
<p>Ah, yes:</p>
<div class="codehilite"><pre><span></span><code>type.coding.where(code = &#39;C43360&#39;).exists() implies serviceProvisionCode.coding.select(code = (&#39;C106643&#39; | &#39;C131710&#39; | &#39;C131708&#39; | &#39;C131709&#39;)).allTrue()
</code></pre></div>



<a name="242142766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242142766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242142766">(Jun 09 2021 at 23:16)</a>:</h4>
<p>And the link to the union syntax: <a href="http://hl7.org/fhirpath/#unionother-collection">http://hl7.org/fhirpath/#unionother-collection</a></p>



<a name="242142824"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242142824" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242142824">(Jun 09 2021 at 23:17)</a>:</h4>
<p>FHIRPath by design does not have a list-selector syntax, so constructing a list is effectively a chain of unions.</p>



<a name="242143498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Is%20code%20in%20a%20set%20of%20codes%3F/near/242143498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Is.20code.20in.20a.20set.20of.20codes.3F.html#242143498">(Jun 09 2021 at 23:28)</a>:</h4>
<p>i bow to your fhirpath skills :)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
