---
layout: page
title: "FHIR Chat  · Date/Time comparison · fhirpath"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/index.html">fhirpath</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html">Date/Time comparison</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="196236174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/196236174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#196236174">(May 04 2020 at 20:32)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> From, the FHIRPath spec (<a href="http://hl7.org/fhirpath/N1/#comparison" title="http://hl7.org/fhirpath/N1/#comparison">http://hl7.org/fhirpath/N1/#comparison</a>):</p>
<p>"If one value is specified to a different level of precision than the other, the result is empty ({ }) to indicate that the result of the comparison is unknown."</p>
<p>and (<a href="http://hl7.org/fhirpath/N1/#datetime-equality" title="http://hl7.org/fhirpath/N1/#datetime-equality">http://hl7.org/fhirpath/N1/#datetime-equality</a>):</p>
<p>"If one input has a value for the precision and the other does not, the comparison stops and the result is empty ({ });"</p>
<p>I take this to mean that if we are comparing a fully-specified Date and a fully-specified DateTime as in the FHIRPath spec test <code>testDateTimeGreaterThanDate</code>:</p>
<p><code>now() &gt; Patient.birthDate</code></p>
<p>or the FHIRPath spec test <code>testNow1</code>:</p>
<p><code>Patient.birthDate &lt; now()</code></p>
<p>Then the result should be empty ({}) because a fully-specified Date will never have the same precision as a fully-specified DateTime. However, the test suite thinks that both of these examples should return true.</p>



<a name="196329550"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/196329550" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#196329550">(May 05 2020 at 16:10)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="192334">@John Timm</span> , for date/time comparisons, the comparisons proceeds from years down, so if the comparison results in true or false at any specified precision, then that will be the result. Only in the case that comparison proceeds beyond the specified precision of one of the inputs will the result be null. Does that help?</p>



<a name="196338569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/196338569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#196338569">(May 05 2020 at 17:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> thanks for the explanation. Do these examples adequately capture the algorithm?</p>
<div class="codehilite"><pre><span></span><code>1970-01-01 &lt; 2020-01-01
1970 &lt; 2020 = true (stop) return true

1970-01-01 &lt; 1970-02-01
1970 &lt; 1970 = false
01 &lt; 02 = true (stop) return true

1970-01-01 &lt; 1970-01-01
1970 &lt; 1970 = false
01 &lt; 01 = false
01 &lt; 01 = false (stop) return false


1970-01-01 &lt; 1970-01-01T00:00:00Z
1970 &lt; 1970 = false
01 &lt; 01 = false
01 &lt; 01 = false
NULL &lt; 00 = not comparable, (stop) return empty
</code></pre></div>



<a name="196340706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/196340706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Nash <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#196340706">(May 05 2020 at 17:38)</a>:</h4>
<p>For what it's worth, I too read the spec the way you originally did John. It makes sense to me it should be the way that Bryn describes but it's easy to mis(?)-read the spec. Particularly, "If one value is specified to a different level of precision than the other, the result is empty ({ }) to indicate that the result of the comparison is unknown."</p>



<a name="196699685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/196699685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#196699685">(May 06 2020 at 21:24)</a>:</h4>
<p><span class="user-mention" data-user-id="252986">@Aaron Nash</span> , yes, those examples accurately reflect the behavior. And also agree, it's worth a clarification, can I trouble you to submit that as a tracker as well? Would be good to include that example as a test case too.</p>



<a name="196818788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/196818788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aaron Nash <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#196818788">(May 07 2020 at 19:23)</a>:</h4>
<p><a href="https://jira.hl7.org/browse/FHIR-27055" title="https://jira.hl7.org/browse/FHIR-27055">https://jira.hl7.org/browse/FHIR-27055</a></p>



<a name="203843831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/203843831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#203843831">(Jul 14 2020 at 15:01)</a>:</h4>
<p>I implemented the algorithm mentioned above, but I fail some tests in the <code>tests-fhir-r4.xml</code> file, e.g.</p>
<p><code>Patient.birthDate != @1974-12-25T12:34:00-10:00</code>   (by the way, birthDate = <code>1974-12-25</code>).</p>
<p>Clearly, based on the above discussion, this should return  <code>empty</code>?  The test expects an output of <code>true</code>.</p>



<a name="204192827"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204192827" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204192827">(Jul 17 2020 at 10:55)</a>:</h4>
<p>hmm where did you get this from?</p>



<a name="204192832"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204192832" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204192832">(Jul 17 2020 at 10:55)</a>:</h4>
<p>the current master for the test is here:</p>



<a name="204192970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204192970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204192970">(Jul 17 2020 at 10:56)</a>:</h4>
<p><a href="https://github.com/FHIR/fhir-test-cases/blob/master/r4/fhirpath/tests-fhir-r4.xml">https://github.com/FHIR/fhir-test-cases/blob/master/r4/fhirpath/tests-fhir-r4.xml</a></p>



<a name="204405258"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204405258" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204405258">(Jul 20 2020 at 10:08)</a>:</h4>
<p>I got these from <a href="http://hl7.org/fhirpath/N1/tests.html">http://hl7.org/fhirpath/N1/tests.html</a> and <a href="https://github.com/HL7/FHIRPath/blob/master/tests/r4/tests-fhir-r4.xml">https://github.com/HL7/FHIRPath/blob/master/tests/r4/tests-fhir-r4.xml</a>.</p>



<a name="204405283"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204405283" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204405283">(Jul 20 2020 at 10:09)</a>:</h4>
<p>Seems we have too many copies ;-)</p>



<a name="204411527"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204411527" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204411527">(Jul 20 2020 at 11:35)</a>:</h4>
<p>I didn't find the test case you asked about in what I think is the master?</p>



<a name="204413358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204413358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204413358">(Jul 20 2020 at 11:59)</a>:</h4>
<p>That's right, it is corrected in the master branch of "fhir-test-cases".   It's just hard to know which is <em>the</em> master file, since the other two links I mentioned also seemed pretty authorative.</p>



<a name="204644128"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204644128" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204644128">(Jul 22 2020 at 09:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> - it seems we have two forks of the test files, which have both been edited.</p>
<p>These are the forks I am looking at:</p>
<ul>
<li><a href="https://github.com/HL7/FHIRPath/blob/master/tests/r4/tests-fhir-r4.xml">https://github.com/HL7/FHIRPath/blob/master/tests/r4/tests-fhir-r4.xml</a>.    Let's call this "Bryn's testfile"</li>
<li><a href="https://github.com/FHIR/fhir-test-cases/blob/master/r4/fhirpath/tests-fhir-r4.xml">https://github.com/FHIR/fhir-test-cases/blob/master/r4/fhirpath/tests-fhir-r4.xml</a>. Let's call this "Grahame's testfile"</li>
</ul>
<p>"Bryn's testfile" Has been edited until end of 2019, Grahame's file has been updated in january 2020, so is newer.</p>
<p>Bryn's file includes edits to make the test names unique (very much appreciated!), which are missing in Grahame's.  E.g."testLiteralDate" has numerous repeats, and in Bryn's file these have been made unique. </p>
<p>Grahame's file seem to have "uncorrected" some of the tests:</p>
<p>E.g. in Bryn's file has this test:</p>
<p><code>' 1 \'wk\''.toQuantity() = 1 'wk'</code>.  Which I think is correct, in Grahame's this has been changed to </p>
<p><code>' 1 \'wk\''.toQuantity() = 1 week</code>. Which I think is wrong, since it is converting the definite time quantity <code>wk</code> from UCUM into the calender quantity from CQL.</p>
<p>Grahame's file does have some corrections of incorrect tests in Bryn's though like this one:   </p>
<p><code>name !~ name</code> (true)</p>
<p>I do see Grahame has committed changes to Bryn's file too, so he probably knows about both files.</p>
<p>Can we try to trace what is going on?</p>



<a name="204647641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204647641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204647641">(Jul 22 2020 at 09:54)</a>:</h4>
<p>I certainly didn't 'uncorrect' anything.</p>



<a name="204647695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204647695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204647695">(Jul 22 2020 at 09:55)</a>:</h4>
<p>I do want the master to be the one in fhir-test-cases - it's in with all the other tests, and suitable for integration into build pipelines, and PRs and so forth</p>



<a name="204647717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204647717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204647717">(Jul 22 2020 at 09:55)</a>:</h4>
<p>I can't comment about the specific differences</p>



<a name="204657158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204657158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204657158">(Jul 22 2020 at 12:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison/near/204647641">said</a>:</p>
<blockquote>
<p>I certainly didn't 'uncorrect' anything.</p>
</blockquote>
<p>Then we have to conclude that the files forked before  these changes were made, because I think the <em>original</em> tests had exactly the same test for week as yours has now, Grahame.</p>



<a name="204657238"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204657238" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204657238">(Jul 22 2020 at 12:12)</a>:</h4>
<p>I do remember, that at first, '1 week = 1wk'.</p>



<a name="204657250"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204657250" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204657250">(Jul 22 2020 at 12:12)</a>:</h4>
<p>This was changed in the normative edition.</p>



<a name="204657380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204657380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204657380">(Jul 22 2020 at 12:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison/near/204647695">said</a>:</p>
<blockquote>
<p>I do want the master to be the one in fhir-test-cases - it's in with all the other tests, and suitable for integration into build pipelines, and PRs and so forth</p>
</blockquote>
<p>Yes, I noticed, very useful.</p>



<a name="204657430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204657430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204657430">(Jul 22 2020 at 12:14)</a>:</h4>
<p>But I can imagine the FhirPath spec has its set of tests too.  And indeed it has, if you navigate to the FhirPath spec, there is a menu item "Tests", which lead to yet another version of the file (which has been corrected by Lee).</p>



<a name="204658312"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658312" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658312">(Jul 22 2020 at 12:24)</a>:</h4>
<p>the other problem I had with the tests there is that they are tied to a specific version of FHIR.</p>



<a name="204658346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658346">(Jul 22 2020 at 12:24)</a>:</h4>
<p>we could correct the FHIRPath tests page to link to a list of known test suites</p>



<a name="204658349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658349">(Jul 22 2020 at 12:24)</a>:</h4>
<p>yes! that's painful.</p>



<a name="204658368"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658368" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658368">(Jul 22 2020 at 12:25)</a>:</h4>
<p>since the releases of FhirPath &amp; FHIR are out-of-sync.</p>



<a name="204658406"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658406" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658406">(Jul 22 2020 at 12:25)</a>:</h4>
<p>yes. that's why I moved them to the test cases</p>



<a name="204658496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658496">(Jul 22 2020 at 12:27)</a>:</h4>
<p>But they are under r4/.   you'd like to have them one directory up.</p>



<a name="204658523"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658523" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658523">(Jul 22 2020 at 12:27)</a>:</h4>
<p>which is possible for the tests that don't need FHIR instance data.  There are actually quite a few of these.</p>



<a name="204658696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658696">(Jul 22 2020 at 12:29)</a>:</h4>
<p>One thing Marco and I have been considering is having a bit of data that has all the features you need - but is against a "test" model, so not against FHIR data.  Another option is to use FHIR instances that only use elements that don't differ over r3/r4/r5</p>



<a name="204658797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204658797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204658797">(Jul 22 2020 at 12:30)</a>:</h4>
<p>I'm open to either of them, though I don't know that it's a good investment to build a different object model that only exists to support the tests</p>



<a name="204710865"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204710865" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204710865">(Jul 22 2020 at 19:23)</a>:</h4>
<p>If FHIRPath is really an independent thing, I think it should have its own tests which have as little reference to FHIR as possible.</p>



<a name="204715871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204715871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204715871">(Jul 22 2020 at 20:06)</a>:</h4>
<p>Or only reference Normative content in R4?</p>



<a name="204715899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204715899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204715899">(Jul 22 2020 at 20:06)</a>:</h4>
<p>I think that's where most of there are anyway</p>



<a name="204715963"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204715963" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204715963">(Jul 22 2020 at 20:07)</a>:</h4>
<p>in theory it could have it's own tests but since it doesn't define any content, that's a bit difficult</p>



<a name="204716115"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204716115" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204716115">(Jul 22 2020 at 20:08)</a>:</h4>
<p>Right, and there aren't any "selector" constructs, so you really _can't_ test a lot of FHIRPath without picking some content model.</p>



<a name="204716162"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204716162" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204716162">(Jul 22 2020 at 20:09)</a>:</h4>
<p>And R4 normative is a good a candidate as any (especially given the tests are already written against it:))</p>



<a name="204716232"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204716232" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204716232">(Jul 22 2020 at 20:09)</a>:</h4>
<p>I agree the file at <a href="https://github.com/FHIR/fhir-test-cases/blob/master/r4/fhirpath/tests-fhir-r4.xml">https://github.com/FHIR/fhir-test-cases/blob/master/r4/fhirpath/tests-fhir-r4.xml</a> should be the source of truth, I don't think I knew about that when I was making the changes as part of the normative publication track though.</p>



<a name="204716329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204716329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204716329">(Jul 22 2020 at 20:10)</a>:</h4>
<p>So that's my bad, I'm happy to reconcile those two and submit the updated cases as a PR there and an Errata report to the spec</p>



<a name="204716372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204716372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204716372">(Jul 22 2020 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191359">Bryn Rhodes</span> <a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison/near/204716115">said</a>:</p>
<blockquote>
<p>Right, and there aren't any "selector" constructs, so you really _can't_ test a lot of FHIRPath without picking some content model.</p>
</blockquote>
<p>fhirpath.js got pretty far without adding a FHIR context model.  I agree there are some things that need a model, but something small could probably be created to test that.</p>



<a name="204716451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204716451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204716451">(Jul 22 2020 at 20:11)</a>:</h4>
<p>Do you have those content model independent test cases expressed in the FHIRPath test case format?</p>



<a name="204718929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204718929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204718929">(Jul 22 2020 at 20:31)</a>:</h4>
<p>fhirpath.js (in addition to its own tests) uses tests-fhir-r4.xml and four resource files (observation-example.xml, etc.), but turns them into a yaml format we use for the other tests we wrote.  In that yaml format, we have disabled certain tests and groups of tests for things we do not yet support.  So, it would not be trivial to pull out which ones need a model and which ones don't, but doable.  Few of the fhirpath.js tests are using a model (though that is maybe not surprising given that support for models was added late) - and it looks like none of the non-disabled tests from test-fhir-r4.xml are using a model (though they are using the four test resource files).</p>



<a name="204719748"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/204719748" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#204719748">(Jul 22 2020 at 20:38)</a>:</h4>
<p>So what makes the most sense to me then is to continue on the path of reconciling the fhir-test-cases and FHIRPath published test case files.</p>



<a name="206662320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/206662320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#206662320">(Aug 12 2020 at 05:58)</a>:</h4>
<p>Okay, I've reconciled the differing test files. Tests that will most likely need to be looked at:<br>
4) testDivide5 was changed from <code>1.2 / 1.8 = 0.67</code> to <code>1.2 / 1.8 = 0.66666667</code> per the resolution to this tracker: <a href="https://jira.hl7.org/browse/FHIR-19356">https://jira.hl7.org/browse/FHIR-19356</a></p>
<p>5) testQuantityLiteralWeekToString was changed from <code>1 week.toString()</code> resulting in <code>1 '{week}'</code> (in the FHIRPath version of the tests) to <code>1 week.toString()</code> resulting in <code>1 'week'</code>  per the resolution to this tracker: <a href="https://jira.hl7.org/browse/FHIR-21606">https://jira.hl7.org/browse/FHIR-21606</a></p>
<p>See the resolution to this tracker for more complete details: <a href="https://jira.hl7.org/browse/FHIR-28242">https://jira.hl7.org/browse/FHIR-28242</a></p>



<a name="206662328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/206662328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#206662328">(Aug 12 2020 at 05:59)</a>:</h4>
<p>I've submitted a PR against fhir-test-cases with the updated test cases: <a href="https://github.com/FHIR/fhir-test-cases/pull/67">https://github.com/FHIR/fhir-test-cases/pull/67</a></p>



<a name="206662478"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/206662478" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#206662478">(Aug 12 2020 at 06:02)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span> , <span class="user-mention" data-user-id="191676">@Lee Surprenant</span>, <span class="user-mention" data-user-id="195344">@Paul Lynch</span> , <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> , <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> ,  when you get a chance, please verify these changes, I tried to commit them in a way that would make very clear what was applied, the first commit just updates all the names, the second commit reconciles differences between the tests. And the summary of <a href="http://jira.hl7.org/browse/FHIR-28242">J#28242</a> lists everything that changed. I also added a note to the file to make clear that the source of truth is now the r5 tests in fhir-test-cases.</p>



<a name="206685925"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/206685925" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#206685925">(Aug 12 2020 at 12:13)</a>:</h4>
<p>1.2 / 1.8 = 0.66666667 assumes a step size of 10^-8.  <a href="http://hl7.org/fhirpath/#decimal">4.1.4. Decimal</a> says, "Implementations can provide support for larger decimals and higher precision, but must provide at least the range and precision defined here."  If some implementation supports 10^-9, then 1.2/1.8  would be 0.666666667 (one additional "6").  Does the = operator then need to change to say that comparison is made with the operands rounded to 8 places after the decimal?</p>



<a name="207961980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/207961980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#207961980">(Aug 25 2020 at 13:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> finally had a look at this and left a suggestion to fix an issue on the PR</p>



<a name="208020169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208020169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208020169">(Aug 25 2020 at 20:39)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="195344">@Paul Lynch</span> and <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> . For the decimal rounding issue, I wonder if we should introduce a .round() into the test case, rather than changing the definition of equal?</p>



<a name="208051978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208051978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208051978">(Aug 26 2020 at 04:28)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> I'm working on this, and I have plenty of failing tests. The first issue I have is with this test</p>



<a name="208051983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208051983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208051983">(Aug 26 2020 at 04:28)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testDateNotEqualTimezoneOffsetBefore&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>Patient.birthDate != @1974-12-25T12:34:00-10:00<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="208051989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208051989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208051989">(Aug 26 2020 at 04:28)</a>:</h4>
<p>the relevant text in the specification is:</p>
<blockquote>
<p>DateTime: must be exactly the same, respecting the timezone offset (though +00:00 = -00:00 = Z)</p>
</blockquote>



<a name="208052052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208052052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208052052">(Aug 26 2020 at 04:30)</a>:</h4>
<p>but your test presumes something not stated: that if the DateTimes are not exactly the same, then the comparison is <code>false</code>, where as we have said in the past that it should only be <code>false</code> if you are sure that the dates are not the same (e.g. different precision)</p>



<a name="208052120"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208052120" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208052120">(Aug 26 2020 at 04:32)</a>:</h4>
<p>Agreed if the precisions are different that should be empty</p>



<a name="208052216"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208052216" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208052216">(Aug 26 2020 at 04:35)</a>:</h4>
<p>right. because that's what this test says:</p>



<a name="208052217"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208052217" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208052217">(Aug 26 2020 at 04:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code>        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testDateNotEqual&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>Patient.birthDate != @1974-12-25T12:34:00<span class="nt">&lt;/expression&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="208052259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208052259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208052259">(Aug 26 2020 at 04:36)</a>:</h4>
<p>so I'm going to fix the test "testDateNotEqualTimezoneOffsetBefore"</p>



<a name="208052701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208052701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208052701">(Aug 26 2020 at 04:49)</a>:</h4>
<p>I don't see how this test can pass:</p>
<div class="codehilite"><pre><span></span><code>        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testStringQuantityDayLiteralToQuantity&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>&#39;1 day&#39;.toQuantity() = 1 &#39;{day}&#39;<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="208052780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208052780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208052780">(Aug 26 2020 at 04:51)</a>:</h4>
<p>This should pass:</p>
<div class="codehilite"><pre><span></span><code>        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testStringQuantityDayLiteralToQuantity&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>&#39;1 day&#39;.toQuantity() = 1 &#39;d&#39;<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="208052838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208052838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208052838">(Aug 26 2020 at 04:53)</a>:</h4>
<p>And I don't see how an implementation can pass both of these tests:</p>
<div class="codehilite"><pre><span></span><code>        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testQuantityLiteralWkToString&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>1 &#39;wk&#39;.toString()<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>1 &#39;wk&#39;<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testQuantityLiteralWeekToString&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>1 week.toString()<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>1 &#39;week&#39;<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="208054273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208054273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208054273">(Aug 26 2020 at 05:32)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> who can release a new version of the ucum code?</p>



<a name="208054360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208054360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208054360">(Aug 26 2020 at 05:35)</a>:</h4>
<p>because I made a PR for you approve and release <a href="https://github.com/FHIR/Ucum-java/pull/16">https://github.com/FHIR/Ucum-java/pull/16</a></p>



<a name="208055377"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208055377" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208055377">(Aug 26 2020 at 05:58)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> I don't understand this test:</p>
<div class="codehilite"><pre><span></span><code>        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testEquality7&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>(1 | 1) = (1 | 2 | {})<span class="nt">&lt;/expression&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="208055388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208055388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208055388">(Aug 26 2020 at 05:59)</a>:</h4>
<p>why would this have no outcome?</p>



<a name="208055393"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208055393" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208055393">(Aug 26 2020 at 05:59)</a>:</h4>
<p>from the spec:</p>
<blockquote>
<p>In other words, this function returns the distinct list of elements from both inputs. For example, consider two lists of integers A: 1, 1, 2, 3 and B: 2, 3:</p>
</blockquote>
<div class="codehilite"><pre><span></span><code>A union B // 1, 2, 3
A union { } // 1, 2, 3
</code></pre></div>



<a name="208055403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208055403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208055403">(Aug 26 2020 at 06:00)</a>:</h4>
<p>(1 | 1) = {1}<br>
(1 | 2 | {} ) = {1 ,2}</p>



<a name="208055450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208055450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208055450">(Aug 26 2020 at 06:00)</a>:</h4>
<p>and then equality:</p>



<a name="208055459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208055459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208055459">(Aug 26 2020 at 06:00)</a>:</h4>
<blockquote>
<p>If both operands are collections with multiple items:<br>
Each item must be equal<br>
Comparison is order dependent</p>
</blockquote>



<a name="208055464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208055464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208055464">(Aug 26 2020 at 06:00)</a>:</h4>
<p>so the comparison is false.</p>



<a name="208058796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208058796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208058796">(Aug 26 2020 at 07:06)</a>:</h4>
<p>also, I don't understand the logic here: </p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testNEquality23&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>1.2 / 1.8 != 0.67<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>


<p>what do you think would be true, and why according  to the spec?</p>



<a name="208071849"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208071849" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208071849">(Aug 26 2020 at 09:54)</a>:</h4>
<p>Another one: This cannot be true:</p>
<div class="codehilite"><pre><span></span><code>        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testDateTimeGreaterThanDate&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>now() <span class="ni">&amp;gt;</span> Patient.birthDate<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>


<p>I'm changing it to </p>
<div class="codehilite"><pre><span></span><code>        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testDateTimeGreaterThanDate&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>now() <span class="ni">&amp;gt;</span> Patient.birthDate<span class="nt">&lt;/expression&gt;&lt;/test&gt;</span>
        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testDateGreaterThanDate&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>today() <span class="ni">&amp;gt;</span> Patient.birthDate<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="208097968"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208097968" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208097968">(Aug 26 2020 at 14:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> , working on a 1.0.3 Ucum-java release</p>



<a name="208098105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208098105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208098105">(Aug 26 2020 at 14:26)</a>:</h4>
<p>Agree on testEquality7, that should be false, not empty.</p>



<a name="208098290"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208098290" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208098290">(Aug 26 2020 at 14:27)</a>:</h4>
<p>On testNEquality23, 1.2 / 1.8 should be 0.66666667 (to however many decimal places the implementation supports, but at least 8), so it would not compare equal to 0.67.</p>



<a name="208098809"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208098809" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208098809">(Aug 26 2020 at 14:31)</a>:</h4>
<p>On testDateTimeGreaterThanDate, <code>now() &gt; Patient.birthDate</code> would be true, so long as the value of Patient.birthDate was at most yesterday, because the comparison proceeds from years down.</p>



<a name="208106694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208106694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208106694">(Aug 26 2020 at 15:23)</a>:</h4>
<p>New Ucum release 1.0.3 available: <a href="https://github.com/FHIR/Ucum-java/releases/tag/v1.0.3">https://github.com/FHIR/Ucum-java/releases/tag/v1.0.3</a></p>



<a name="208138931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208138931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208138931">(Aug 26 2020 at 19:45)</a>:</h4>
<p>thanks for the new UCUM release</p>



<a name="208139155"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208139155" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208139155">(Aug 26 2020 at 19:47)</a>:</h4>
<blockquote>
<p>now() &gt; Patient.birthDate would be true, so long as the value of Patient.birthDate was at most yesterday, because the comparison proceeds from years down</p>
</blockquote>
<p>I do not see this written in the spec. What I see is 'strictly greater than'</p>



<a name="208139231"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208139231" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208139231">(Aug 26 2020 at 19:47)</a>:</h4>
<blockquote>
<p>1.2 / 1.8 should be 0.66666667 </p>
</blockquote>
<p>no. 1.2000000/1.8000000 should be 0.66666667; 1.2/1.8 should be 0.67.</p>



<a name="208139301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208139301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208139301">(Aug 26 2020 at 19:48)</a>:</h4>
<p>which is what the reference implementation does</p>



<a name="208156537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208156537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208156537">(Aug 26 2020 at 22:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison/near/208139231">said</a>:</p>
<blockquote>
<p>1.2/1.8 should be 0.67.</p>
</blockquote>
<p>I don't see anything about rounding or precision stated in the <a href="http://hl7.org/fhirpath/#math-2">Math</a> section.</p>



<a name="208156835"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208156835" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208156835">(Aug 26 2020 at 22:24)</a>:</h4>
<p>no. I don't think that's from the spec</p>



<a name="208158285"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208158285" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208158285">(Aug 26 2020 at 22:39)</a>:</h4>
<p>If you are reporting a result, I agree that the final number should have the same number of significant digits.  The trouble is that I don't think FHIRPath knows whether the result is 'final' or intermediate in some larger calculation.</p>



<a name="208158569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208158569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208158569">(Aug 26 2020 at 22:43)</a>:</h4>
<p>no but my implementation does</p>



<a name="208171195"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208171195" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208171195">(Aug 27 2020 at 01:52)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> </p>
<p>Please check the changes at <a href="https://github.com/FHIR/fhir-test-cases/pull/70">https://github.com/FHIR/fhir-test-cases/pull/70</a></p>



<a name="208171263"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208171263" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208171263">(Aug 27 2020 at 01:54)</a>:</h4>
<p>There's one set of changes in there that are driven by a limitation I can't deal with right now: the hapi fhir core library can't deal with a time that has just hours. In fact, that's really a bad thing for FHIRPath to require dealing with. But for now I've worked around it by changing the tests. The others are genuine issues in the tests</p>



<a name="208870573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208870573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208870573">(Sep 02 2020 at 18:54)</a>:</h4>
<p>Agree with the changes, except for:</p>
<ul>
<li><code>testStringQuantityDayLiteralToQuantity</code>, that should be empty</li>
<li><code>testQuantityLiteralWeekToString</code>, why would that convert the calendar unit to a UCUM unit?</li>
<li><code>testNEquality22</code>, <code>testNEquality23</code>, and <code>testDivide5</code>, we didn't want to prescribe support for maintaining significant digits, so can we add a <code>.round()</code> to these tests?</li>
</ul>



<a name="208874741"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208874741" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208874741">(Sep 02 2020 at 19:23)</a>:</h4>
<p><a href="https://github.com/FHIR/fhir-test-cases/pull/71">https://github.com/FHIR/fhir-test-cases/pull/71</a></p>



<a name="208878147"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/208878147" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#208878147">(Sep 02 2020 at 19:50)</a>:</h4>
<p>Left comment on pull request.</p>



<a name="209291139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209291139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209291139">(Sep 07 2020 at 12:39)</a>:</h4>
<p>My tests are failing on <code>encode</code>, <code>decode</code>, <code>escape</code>, <code>unescape</code> and <code>trim</code>.  I have looked at the normative version of FhirPath and the latest fhirpath addendum to FHIR, but cannot find the definitions of these functions . Where should I look?</p>



<a name="209291291"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209291291" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209291291">(Sep 07 2020 at 12:40)</a>:</h4>
<p>All these new encode/decode tests (the group testEncodeDecode) do not carry a name per test, whereas the others do.  Can we add names to them?</p>



<a name="209291889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209291889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209291889">(Sep 07 2020 at 12:48)</a>:</h4>
<p>We agreed that this test is wrong:   "testIntegerBooleanNotTrue",</p>



<a name="209291956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209291956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209291956">(Sep 07 2020 at 12:49)</a>:</h4>
<p>And I don't think these are correct: "testDateNotEqualTimezoneOffsetBefore", "testDateNotEqualTimezoneOffsetAfter", "testDateNotEqualUTC"</p>



<a name="209292314"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209292314" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209292314">(Sep 07 2020 at 12:53)</a>:</h4>
<p>This is from my notes, I'll have to check on why.  I see a reference to <a href="https://jira.hl7.org/browse/FHIR-27033">https://jira.hl7.org/browse/FHIR-27033</a> and <a href="login/#narrow/stream/179266-fhirpath/topic/Singleton.20Evaluation.20of.20Collections">https://chat.fhir.org/login/#narrow/stream/179266-fhirpath/topic/Singleton.20Evaluation.20of.20Collections</a> in reference to "testIntegerBooleanNotTrue".</p>



<a name="209292527"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209292527" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209292527">(Sep 07 2020 at 12:56)</a>:</h4>
<p>The "testDateNotEqual" etc:</p>
<p>One example is this:</p>
<div class="codehilite"><pre><span></span><code>   &lt;test name=&quot;testDateNotEqual&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00&lt;/expression&gt;
    &lt;/test&gt;
</code></pre></div>


<p>For reference, <code>Patient.birthDate</code> is:</p>
<div class="codehilite"><pre><span></span><code>&lt;birthDate value=&quot;1974-12-25&quot;&gt;
        &lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/patient-birthTime&quot;&gt;
            &lt;valueDateTime value=&quot;1974-12-25T14:35:45-05:00&quot;/&gt;
        &lt;/extension&gt;
    &lt;/birthDate&gt;
</code></pre></div>


<p>The datetimes have the same precision, but they are clearly not the same, hence I think this should result in true.</p>



<a name="209292643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209292643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209292643">(Sep 07 2020 at 12:57)</a>:</h4>
<p>(deleted)</p>



<a name="209292768"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209292768" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209292768">(Sep 07 2020 at 12:58)</a>:</h4>
<p>Or is this a timezone issue?</p>



<a name="209295022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209295022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209295022">(Sep 07 2020 at 13:22)</a>:</h4>
<p>no - this is an extension issue. There is no instruction to the FHIRPath engine to pick up the birth time extension</p>



<a name="209295103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209295103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209295103">(Sep 07 2020 at 13:23)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  and I added encode, etc to meet some use cases we had. I believe Bryn created a task to add them to a future version of FHIRPath</p>



<a name="209295160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209295160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209295160">(Sep 07 2020 at 13:24)</a>:</h4>
<p>I think we should have labelled those tests with a version indicator</p>



<a name="209302493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209302493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209302493">(Sep 07 2020 at 14:39)</a>:</h4>
<p>Can I assume the hex encoding/decoding turns the string into hex via UTF8?</p>



<a name="209304319"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209304319" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209304319">(Sep 07 2020 at 14:56)</a>:</h4>
<p>Actually, the base64 is also using UTF8.</p>



<a name="209310055"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209310055" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209310055">(Sep 07 2020 at 16:03)</a>:</h4>
<p>There's variance on how to deal with the padding chars in urlbase64.  I propose stripping '=', but other variants are replacing '=' by '.'</p>



<a name="209310134"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209310134" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209310134">(Sep 07 2020 at 16:04)</a>:</h4>
<p>(and the current test uses the padding char '=', but that then needs to be escaped, which is really defeating the point of urlbase64)</p>



<a name="209323807"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209323807" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209323807">(Sep 07 2020 at 19:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> ?</p>



<a name="209323873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209323873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209323873">(Sep 07 2020 at 19:46)</a>:</h4>
<p>Documentation is on a branch here: <a href="http://build.fhir.org/ig/HL7/FHIRPath/branches/feature-27757-additional-string-functions/">http://build.fhir.org/ig/HL7/FHIRPath/branches/feature-27757-additional-string-functions/</a></p>



<a name="209323876"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209323876" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209323876">(Sep 07 2020 at 19:46)</a>:</h4>
<p>Working through this feedback now.</p>



<a name="209323887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209323887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209323887">(Sep 07 2020 at 19:47)</a>:</h4>
<p>I've added names to the tests and a version attribute to the schema and set it for the new tests (to 2.1.0).</p>



<a name="209323895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209323895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209323895">(Sep 07 2020 at 19:47)</a>:</h4>
<p>Now working through the reported discrepancies</p>



<a name="209324217"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209324217" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209324217">(Sep 07 2020 at 19:54)</a>:</h4>
<p>Agreed on <code>testIntegerBooleanNotTrue</code>, that should result in an error, since a boolean-valued function is being invoked on a non-boolean-valued argument. Same with <code>testIntegerBooleanNotFalse</code>, so I've added <code>invalid="semantic"</code> to those tests.</p>



<a name="209324531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209324531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209324531">(Sep 07 2020 at 20:01)</a>:</h4>
<p>I'll take a look at what is exactly the matter with those date tests, but I think:</p>
<div class="codehilite"><pre><span></span><code> &lt;test name=&quot;testDateNotEqualTimezoneOffsetBefore&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00-10:00&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
    &lt;test name=&quot;testDateNotEqualTimezoneOffsetAfter&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00+10:00&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
    &lt;test name=&quot;testDateNotEqualUTC&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00Z&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
</code></pre></div>


<p>where the Patient.birthDate has precision upto the date should all have an empty result.</p>



<a name="209324549"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209324549" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209324549">(Sep 07 2020 at 20:01)</a>:</h4>
<p>no because some of them you know that it can't the same date</p>



<a name="209324732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209324732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209324732">(Sep 07 2020 at 20:05)</a>:</h4>
<p>&lt;birthDate value="1974-12-25"&gt;.   All of these dates are on the 25th, right?   (it's easy to make a mistake here, so just double checking ;-))</p>



<a name="209325618"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209325618" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209325618">(Sep 07 2020 at 20:24)</a>:</h4>
<p>I think the tests are expecting that the birthTime is being considered, so that's the first thing to get settled</p>



<a name="209326423"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209326423" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209326423">(Sep 07 2020 at 20:40)</a>:</h4>
<p>I think since what we're testing is datetime equality, rather than extension access, I should just put the literal date in the test, rather than reading it from patient.</p>



<a name="209326857"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209326857" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209326857">(Sep 07 2020 at 20:49)</a>:</h4>
<p>good idea.  That's actually useful for other tests too.  Once you've determined that access to instance data by path (and some specific operations) work, we don't have to refer to the model anymore -&gt; makes the tests more reusable across versions....</p>



<a name="209328185"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209328185" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209328185">(Sep 07 2020 at 21:18)</a>:</h4>
<p>I'm passing the tests and not considering birthTime.</p>



<a name="209328199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209328199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209328199">(Sep 07 2020 at 21:19)</a>:</h4>
<p>Changing these tests is tiresome.. I'll be spending several hours in my date time comparison stuff. I really thought these tests align with the spec now</p>



<a name="209351221"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209351221" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209351221">(Sep 08 2020 at 06:59)</a>:</h4>
<p>Let's figure out why you pass, and I fail first. I could be wrong too.  The reason I fail the test is that the precision is different, when this starts to matter: the dates are exactly the same, so you cannot conclude they are unequal, unless you have more precision. Since there is no more precision available in one of the two operands, I return empty.</p>



<a name="209351368"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209351368" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209351368">(Sep 08 2020 at 07:01)</a>:</h4>
<p>I did this based on this piece of text: </p>
<blockquote>
<p>If the values are the same, comparison proceeds to the next precision; if the values are different, the comparison stops and the result is false. If one input has a value for the precision and the other does not, the comparison stops and the result is empty ({ });</p>
</blockquote>



<a name="209354897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209354897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209354897">(Sep 08 2020 at 07:47)</a>:</h4>
<blockquote>
<p>Documentation is on a branch here: <a href="http://build.fhir.org/ig/HL7/FHIRPath/branches/feature-27757-additional-string-functions/">http://build.fhir.org/ig/HL7/FHIRPath/branches/feature-27757-additional-string-functions/</a></p>
</blockquote>
<p>Should I provide feedback on this text here or as tracker items?</p>



<a name="209359466"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209359466" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209359466">(Sep 08 2020 at 08:41)</a>:</h4>
<p>I think the dates are different before the precision differs</p>



<a name="209360568"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209360568" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209360568">(Sep 08 2020 at 08:54)</a>:</h4>
<p>Then you are right, but I just see them all being "1974-12-25"</p>



<a name="209368076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209368076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209368076">(Sep 08 2020 at 10:17)</a>:</h4>
<p>which ones exactly are we talking about?</p>



<a name="209370093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209370093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209370093">(Sep 08 2020 at 10:45)</a>:</h4>
<div class="codehilite"><pre><span></span><code> &lt;test name=&quot;testDateNotEqualTimezoneOffsetBefore&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00-10:00&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
    &lt;test name=&quot;testDateNotEqualTimezoneOffsetAfter&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00+10:00&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
    &lt;test name=&quot;testDateNotEqualUTC&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00Z&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
</code></pre></div>



<a name="209370118"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209370118" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209370118">(Sep 08 2020 at 10:45)</a>:</h4>
<p><code>&lt;birthDate value="1974-12-25"&gt;</code></p>



<a name="209373107"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209373107" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209373107">(Sep 08 2020 at 11:25)</a>:</h4>
<p>For the encoding of human time units, it seems "1 week" = 1 'week'.  But there is also a test:</p>
<div class="codehilite"><pre><span></span><code>    &lt;test name=&quot;testStringQuantityDayLiteralToQuantity&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;&#39;1 day&#39;.toQuantity() = 1 &#39;{day}&#39;&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
</code></pre></div>


<p>where "1 day" = 1 '{day}'.  I am assuming now that should be <code>1 'day'</code>?</p>



<a name="209373221"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209373221" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209373221">(Sep 08 2020 at 11:26)</a>:</h4>
<p>(deleted)</p>



<a name="209373278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209373278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209373278">(Sep 08 2020 at 11:27)</a>:</h4>
<p>(deleted)</p>



<a name="209373876"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209373876" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209373876">(Sep 08 2020 at 11:34)</a>:</h4>
<p>Actually based on this (<a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison.20vs.20equality">https://chat.fhir.org/#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison.20vs.20equality</a>) discussion, it should now be '1 day'.toQuantity() = 1 'd'.</p>



<a name="209373901"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209373901" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209373901">(Sep 08 2020 at 11:34)</a>:</h4>
<p>and even '1 week'.toQuantity() = 1 'wk'.</p>



<a name="209379096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209379096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209379096">(Sep 08 2020 at 12:31)</a>:</h4>
<p>So, I did that now. To be complete, this is what I have done:</p>
<p><a href="/user_uploads/10155/uUIc-aqq30_Rxl7ebJhJTzDi/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/uUIc-aqq30_Rxl7ebJhJTzDi/image.png" title="image.png"><img src="/user_uploads/10155/uUIc-aqq30_Rxl7ebJhJTzDi/image.png"></a></div>



<a name="209379239"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209379239" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209379239">(Sep 08 2020 at 12:33)</a>:</h4>
<p>Is this correct?</p>
<div class="codehilite"><pre><span></span><code>  &lt;test name=&quot;testRound2&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;3.14159.round(3) = 2&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
</code></pre></div>



<a name="209386036"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209386036" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209386036">(Sep 08 2020 at 13:31)</a>:</h4>
<blockquote>
<p>Agreed on testIntegerBooleanNotTrue, that should result in an error, since a boolean-valued function is being invoked on a non-boolean-valued argument.</p>
</blockquote>
<p>So, for <code>not()</code>,  we do <em>not</em> do singleton evaluation of the collection?</p>
<p>I see the spec says:</p>
<blockquote>
<p>In general, when a collection is passed as an argument to a function or operator that expects a single item as input, the collection is implicitly converted to a singleton as follows:</p>
</blockquote>
<p>Is the <code>(0)</code> passed here "as an argument to the function", or not (because it is the focus, not the argument) ?</p>



<a name="209386499"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209386499" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209386499">(Sep 08 2020 at 13:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> , these new tests don't seem to align with your answers on Singleton Evaluation:</p>
<div class="codehilite"><pre><span></span><code> &lt;group&gt;
    name=&quot;from-Zulip&quot;&gt;
    &lt;test inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;(true and &#39;foo&#39;).empty()&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
    &lt;test inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;(true | &#39;foo&#39;).allTrue()&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;false&lt;/output&gt;
    &lt;/test&gt;
  &lt;/group&gt;
</code></pre></div>


<p>(true and 'foo') is 'true'.  So (true and  'foo').empty() is <em>false</em>.</p>
<p>The second one, you said, was an error. That would be a comparable discussion to <code>(0).not()</code>, so I'll wait for that to settle ;-)</p>



<a name="209417619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209417619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209417619">(Sep 08 2020 at 17:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191328">Ewout Kramer</span> <a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison/near/209370093">said</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code> &lt;test name=&quot;testDateNotEqualTimezoneOffsetBefore&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00-10:00&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
    &lt;test name=&quot;testDateNotEqualTimezoneOffsetAfter&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00+10:00&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
    &lt;test name=&quot;testDateNotEqualUTC&quot; inputfile=&quot;patient-example.xml&quot;&gt;
      &lt;expression&gt;Patient.birthDate != @1974-12-25T12:34:00Z&lt;/expression&gt;
      &lt;output type=&quot;boolean&quot;&gt;true&lt;/output&gt;
    &lt;/test&gt;
</code></pre></div>


</blockquote>
<p>FWIW our impl seems to match Ewouts.  The dates are the same and so it goes to time and only one has a time so they are not comparable =&gt; returns empty and not true.<br>
If the tests expect the impl to know about this special extension, then that explains it, but our impl not so clever.  Agree changing it to use literals will be better than testing this implied birthDate extension processing thing (is that even specified somewhere?)</p>



<a name="209418707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209418707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209418707">(Sep 08 2020 at 17:31)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>, <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> , some of the tests have a <code>mode="strict"</code> attribute, what is the intent of that attribute? How do your test runners interpret that?</p>



<a name="209418868"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209418868" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209418868">(Sep 08 2020 at 17:33)</a>:</h4>
<p>There's also a <code>checkOrderedFunctions="true"</code> and <code>ordered="true"</code>. I'm assuming this means that the test runner will check whether the results are ordered, and that these are different representations for the same attribute. Is that correct?</p>



<a name="209463204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209463204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209463204">(Sep 09 2020 at 01:25)</a>:</h4>
<p>I don't do anything with <code>checkOrderedFunctions</code></p>



<a name="209463213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209463213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209463213">(Sep 09 2020 at 01:25)</a>:</h4>
<p>I do use ordered = true to check whether the outcome is in the right order or not</p>



<a name="209463258"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209463258" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209463258">(Sep 09 2020 at 01:26)</a>:</h4>
<p>I don't do anything about "strict"</p>



<a name="209464064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209464064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209464064">(Sep 09 2020 at 01:42)</a>:</h4>
<p>A revisited the tests <code>testDateNotEqualTimezoneOffsetBefore</code>, <code>testDateNotEqualTimezoneOffsetAfter</code>, <code>testDateNotEqualUTC</code>, and agree. I've changed them in the source</p>



<a name="209464233"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209464233" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209464233">(Sep 09 2020 at 01:46)</a>:</h4>
<p><a href="https://github.com/FHIR/fhir-test-cases/commit/2bbdce168f2ff90a1b471fd87d9e1b8ec461a7ef">https://github.com/FHIR/fhir-test-cases/commit/2bbdce168f2ff90a1b471fd87d9e1b8ec461a7ef</a></p>



<a name="209480512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209480512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209480512">(Sep 09 2020 at 07:46)</a>:</h4>
<p>I am using 'strict' - these test exercise the section on strict eval (<a href="http://hl7.org/fhirpath/N1/#type-safety-and-strict-evaluation">http://hl7.org/fhirpath/N1/#type-safety-and-strict-evaluation</a>) - and since e.g. my engine does not have access to structure definitions I don't run these tests.</p>



<a name="209480605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209480605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209480605">(Sep 09 2020 at 07:47)</a>:</h4>
<p>(I have the impression -based on the text in that section- that strict evaluation is optional - so I needed to identify these tests)</p>



<a name="209480709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209480709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209480709">(Sep 09 2020 at 07:49)</a>:</h4>
<p>we can clean those things up as far as I am considered by putting them in a named group. I can exclude tests for stuff I don't (yet) implement based on names.</p>



<a name="209490092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209490092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209490092">(Sep 09 2020 at 09:38)</a>:</h4>
<p>which ones would we put in a group?</p>



<a name="209490582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209490582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209490582">(Sep 09 2020 at 09:44)</a>:</h4>
<p>the ones marked with "strict" now - then the "strict" attribute can be removed.</p>



<a name="209542140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209542140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209542140">(Sep 09 2020 at 17:26)</a>:</h4>
<p>given that this would force a re-order  and a re-assignment out of functional groups, this sounds like a retro-grade step to me</p>



<a name="209603588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/209603588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#209603588">(Sep 10 2020 at 07:25)</a>:</h4>
<p>Yeah, that would be a consequence indeed.</p>



<a name="210215128"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210215128" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210215128">(Sep 16 2020 at 02:15)</a>:</h4>
<p>Okay, addressed changes from <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> 's testing with this <a href="https://github.com/FHIR/fhir-test-cases/pull/75">PR</a></p>



<a name="210258706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210258706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210258706">(Sep 16 2020 at 13:11)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> Where is the "encode" function (used in those tests) defined?</p>



<a name="210259764"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210259764" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210259764">(Sep 16 2020 at 13:20)</a>:</h4>
<p>It's in a PR on the FHIRPath repository: <a href="http://build.fhir.org/ig/HL7/FHIRPath/branches/feature-27757-additional-string-functions/#additional-string-functions">http://build.fhir.org/ig/HL7/FHIRPath/branches/feature-27757-additional-string-functions/#additional-string-functions</a></p>



<a name="210260029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210260029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210260029">(Sep 16 2020 at 13:22)</a>:</h4>
<p>A new version of the FHIRPath specification is being worked on?  When will it be balloted, or did it miss it?</p>



<a name="210260167"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210260167" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210260167">(Sep 16 2020 at 13:23)</a>:</h4>
<p>Not ready for ballot, no, but there are a lot of trackers that have been submitted, see the current outstanding items in JIRA for the whole list, but many of them still need discussion and resolution.</p>



<a name="210310002"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210310002" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210310002">(Sep 16 2020 at 19:38)</a>:</h4>
<p>Other than trackers being submitted as issues are found, there hasn't been a lot of activity. ITS is the Work Group that stewards FHIRPath, so discussions will happen there once we get enough dispositions together to support a block vote or discussion on an ITS call. That is on my list, and I'll certainly post here when I make forward progress on it. And of course you (and anyone else) are welcome to comment on the trackers there to help come to resolution on them.</p>



<a name="210347472"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210347472" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210347472">(Sep 17 2020 at 04:37)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> I don't understand this:</p>
<p>Bryn says:</p>
<blockquote>
<p>Agreed on testIntegerBooleanNotTrue, that should result in an error, since a boolean-valued function is being invoked on a non-boolean-valued argument. Same with testIntegerBooleanNotFalse, so I've added invalid="semantic" to those tests</p>
</blockquote>
<p>Bryn makes a PR, that changes the test from</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testIntegerBooleanNotTrue&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>(0).not() = true<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>


<p>to </p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;testIntegerBooleanNotTrue&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression&gt;</span>(0).not() = false<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="210347611"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210347611" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210347611">(Sep 17 2020 at 04:40)</a>:</h4>
<p>I find the basis for this slippery since .not() is not formally defined. In most languages, you can apply not to an integer value as a boolean test</p>



<a name="210347631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210347631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210347631">(Sep 17 2020 at 04:41)</a>:</h4>
<p>Yes, sorry for the confusion, but as Ewout pointed out, if the singleton vale cannot be implicitly converted to a boolean (and an integer requires explicit conversion), then the collection is evaluated as true if it contains a single element, no matter what the element is.</p>



<a name="210347686"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210347686" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210347686">(Sep 17 2020 at 04:42)</a>:</h4>
<p>The alternative is to say that integers can implicitly convert to booleans</p>



<a name="210347932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210347932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210347932">(Sep 17 2020 at 04:49)</a>:</h4>
<p>not necessarily. The alternative would be to say that .Not() can be applied to integers</p>



<a name="210347943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210347943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210347943">(Sep 17 2020 at 04:50)</a>:</h4>
<p>I don't feel strongly for that, but there is no definition for .not()</p>



<a name="210348001"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210348001" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210348001">(Sep 17 2020 at 04:50)</a>:</h4>
<p>but there is this:</p>



<a name="210348009"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210348009" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210348009">(Sep 17 2020 at 04:51)</a>:</h4>
<blockquote>
<p>IF the collection contains a single node AND the expected input type is Boolean THEN<br>
  The collection evaluates to true</p>
</blockquote>



<a name="210348016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210348016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210348016">(Sep 17 2020 at 04:51)</a>:</h4>
<p>because of this, <code>(0).not() = false</code></p>



<a name="210348679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210348679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210348679">(Sep 17 2020 at 05:04)</a>:</h4>
<p>so I think your commit was right and your comments were not</p>



<a name="210348788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210348788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210348788">(Sep 17 2020 at 05:06)</a>:</h4>
<p>but this makes a mess of this test:</p>



<a name="210348884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210348884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210348884">(Sep 17 2020 at 05:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code>        <span class="nt">&lt;test</span> <span class="na">name=</span><span class="s">&quot;from-zilip-2&quot;</span> <span class="na">inputfile=</span><span class="s">&quot;patient-example.xml&quot;</span><span class="nt">&gt;&lt;expression</span> <span class="na">invalid=</span><span class="s">&quot;semantic&quot;</span><span class="nt">&gt;</span>(true | &#39;foo&#39;).allTrue()<span class="nt">&lt;/expression&gt;&lt;output</span> <span class="na">type=</span><span class="s">&quot;boolean&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/output&gt;&lt;/test&gt;</span>
</code></pre></div>



<a name="210349281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210349281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210349281">(Sep 17 2020 at 05:18)</a>:</h4>
<p>no. not a mess. But definitely beyond the definition, since it doesn't say what to do about items that are not convertible to boolean.</p>



<a name="210349447"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210349447" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210349447">(Sep 17 2020 at 05:22)</a>:</h4>
<p>Right, for that test it’s an error because foo can’t be converted to boolean. For systems that can check types statically, it’s a compile-time error, and a runtime one for dynamically typed systems.</p>



<a name="210349512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210349512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210349512">(Sep 17 2020 at 05:24)</a>:</h4>
<p>I check types statically, but that's still beyond me to be sure that's an error at compile time</p>



<a name="210349525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210349525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210349525">(Sep 17 2020 at 05:24)</a>:</h4>
<p>I know at compile time that the collection might contain a string, but not that it is sure to</p>



<a name="210349538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210349538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210349538">(Sep 17 2020 at 05:25)</a>:</h4>
<p>Defining not for integers specifically would be an option, but I will note that .not() is formally defined in the spec: <a href="http://hl7.org/fhirpath/#not-boolean">http://hl7.org/fhirpath/#not-boolean</a></p>



<a name="210349587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210349587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210349587">(Sep 17 2020 at 05:26)</a>:</h4>
<p>sigh apparently I was searching for <code>.not()</code> not <code>not()</code></p>



<a name="210349609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210349609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210349609">(Sep 17 2020 at 05:27)</a>:</h4>
<p>And defining it only for not() would I think lead to some inconsistent behaviors with the other logical operators.</p>



<a name="210363129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210363129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210363129">(Sep 17 2020 at 08:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191359">Bryn Rhodes</span> <a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison/near/210349609">said</a>:</p>
<blockquote>
<p>And defining it only for not() would I think lead to some inconsistent behaviors with the other logical operators.</p>
</blockquote>
<p>Right, and that's why <code>not()</code> is slightly inconsistent with other operators working on a focus (like <code>allTrue()</code>): <code>not()</code> explicitly applies the logic of singleton evaluation (<a href="http://hl7.org/fhirpath/#singleton-evaluation-of-collections">http://hl7.org/fhirpath/#singleton-evaluation-of-collections</a>) to the focus - whereas the others do not.  Am I right?</p>



<a name="210376320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210376320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210376320">(Sep 17 2020 at 11:31)</a>:</h4>
<p>the others apply it to the individuals items in the collection</p>



<a name="210406366"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210406366" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210406366">(Sep 17 2020 at 15:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179266-fhirpath/topic/Date.2FTime.20comparison/near/210376320">said</a>:</p>
<blockquote>
<p>the others apply it to the individuals items in the collection</p>
</blockquote>
<p>I am not sure how to interpret that.  The "it" seems to refer to <a href="http://hl7.org/fhirpath/#singleton-evaluation-of-collections">http://hl7.org/fhirpath/#singleton-evaluation-of-collections</a>, but that section is explicitly only about functions and operators expecting a singleton item.</p>
<p>Are you saying that allTrue() should convert convertible things in its input collection to Booleans, and non-convertible things to true?</p>



<a name="210442796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179266-fhirpath/topic/Date/Time%20comparison/near/210442796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179266-fhirpath/topic/Date.2FTime.20comparison.html#210442796">(Sep 17 2020 at 19:59)</a>:</h4>
<p>That tests presently say that allTrue() should convert convertible things in its input collection to Booleans, and blow up on non-convertible things</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
