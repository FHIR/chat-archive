---
layout: page
title: "FHIR Chat  · Search resources based on extension values · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html">Search resources based on extension values</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="203930090"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/203930090" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Markku Nikkanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#203930090">(Jul 15 2020 at 08:52)</a>:</h4>
<p>Hello,</p>
<p>I have some extensions in Encounter FHIR object. How do I implement "query matcher" against extension? Any reference implementation available?</p>
<p>Br,<br>
Markku</p>



<a name="203936400"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/203936400" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#203936400">(Jul 15 2020 at 10:11)</a>:</h4>
<p>what's a 'query matcher'?</p>



<a name="204046913"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/204046913" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Markku Nikkanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#204046913">(Jul 16 2020 at 05:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values/near/203936400">said</a>:</p>
<blockquote>
<p>what's a 'query matcher'?</p>
</blockquote>
<p>By "query matcher" I mean a way of doing queries against attributes in an extension. As an example, how to query Encounters having valueString "checkin"?</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;resourceType&quot;: &quot;Encounter&quot;,
  &quot;extension&quot;: [
    {
      &quot;url&quot;: &quot;http://something.com/fhir/#currentQueueStatus&quot;,
      &quot;valueString&quot;: &quot;checkin&quot;
    }
  ],
...
}
</code></pre></div>



<a name="204062989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/204062989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#204062989">(Jul 16 2020 at 09:36)</a>:</h4>
<p>You need to create a custom search parameter. This blog goes over the process: <a href="https://blog.smilecdr.com/2017/02/08/custom-search-parameters-in-hapi-fhir/">https://blog.smilecdr.com/2017/02/08/custom-search-parameters-in-hapi-fhir/</a></p>



<a name="204187017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/204187017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Markku Nikkanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#204187017">(Jul 17 2020 at 09:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191319">James Agnew</span> Thank you for this information. I got it working in Unit Test by creating SearchParam object before adding any test data to h2 database. </p>
<div class="codehilite"><pre><span></span><code>  private static void initialiseTestDatabase() throws ParseException {
    client.create().resource(createSearchParam()).execute();

    // Location with room
    Location l = LocationFactory.create();
    IIdType locationId = client.create().resource(l).execute().getId();
...
</code></pre></div>


<p>What would be proper way to create SearchParam object in hapi-fhir-jpaserver-starter fork? I tried create object at the very end of the JpaRestfulServer initialise with no luck:</p>
<div class="codehilite"><pre><span></span><code>protected void initialize() throws ServletException {
...
    IGenericClient client = ctx.newRestfulGenericClient(serverAddress);
    client.create().resource(createSearchParam()).execute();
</code></pre></div>


<p>It did not work. It seems you cannot call create inside initialise method:</p>
<div class="codehilite"><pre><span></span><code>ca.uhn.fhir.rest.client.exceptions.FhirClientConnectionException: Failed to retrieve the server metadata statement during client initialization. URL used was http://localhost:8888/fhir/metadata
    at ca.uhn.fhir.rest.client.impl.RestfulClientFactory.validateServerBase(RestfulClientFactory.java:312)
</code></pre></div>


<p>Should I start listening Spring or Jetty's lifecycle events that are called after initialisation is ready?</p>



<a name="204188728"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/204188728" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Markku Nikkanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#204188728">(Jul 17 2020 at 09:52)</a>:</h4>
<p>(deleted)</p>



<a name="204449034"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/204449034" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Markku Nikkanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#204449034">(Jul 20 2020 at 17:12)</a>:</h4>
<p>I did not get servlet approach operating. I think that the issue is that no one is listening port 8080 when servlets is being initialised.</p>
<div class="codehilite"><pre><span></span><code>~/repos/my-fhir-service/src/main/webapp/WEB-INF/web.xml

    &lt;servlet&gt;
        &lt;servlet-name&gt;fhirServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;ca.uhn.fhir.jpa.starter.JpaRestfulServer&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;myMigration&lt;/servlet-name&gt;
        &lt;servlet-class&gt;my.project.MyMigration&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;3&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

public class MyMigration extends RestfulServer {
  @Override
  protected void initialize() throws ServletException {
    String serverAddress = HapiProperties.getServerAddress();
    IGenericClient client = ctx.newRestfulGenericClient(serverAddress);
    client.create().resource(createExtensionSearchParam()).execute();
}
</code></pre></div>


<p>Is there any events (Pointcut?) that are sent when JpaRestfulServer initialisation is ready and servlet is listening in port 8080?</p>
<p><a href="https://smilecdr.com/hapi-fhir/apidocs/hapi-fhir-base/ca/uhn/fhir/interceptor/api/Pointcut.html">https://smilecdr.com/hapi-fhir/apidocs/hapi-fhir-base/ca/uhn/fhir/interceptor/api/Pointcut.html</a></p>
<p>Or would it be better to have a separate project that runs all sort of migrations to database like ads the Search Params? Perhaps there is already something ready made frameworks for this e.g.</p>
<p><a href="https://hapifhir.io/hapi-fhir/docs/server_jpa/upgrading.html">https://hapifhir.io/hapi-fhir/docs/server_jpa/upgrading.html</a></p>



<a name="204618295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/204618295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vilensky <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#204618295">(Jul 22 2020 at 00:19)</a>:</h4>
<p>Is this the only Java implementation of the FHIR standard?</p>



<a name="204618938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/204618938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#204618938">(Jul 22 2020 at 00:30)</a>:</h4>
<p>no there are others, but none are complete or open source or tested/reliable anything like HAPI</p>



<a name="204644103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Search%20resources%20based%20on%20extension%20values/near/204644103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Markku Nikkanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values.html#204644103">(Jul 22 2020 at 09:05)</a>:</h4>
<p>I do not know any other approaches than implementing a migration application that runs creates. Search Param objects to HAPI FHIR.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
