---
layout: page
title: "FHIR Chat  · for loop in TermDeferredStorageSvcImpl · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/for.20loop.20in.20TermDeferredStorageSvcImpl.html">for loop in TermDeferredStorageSvcImpl</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="201012899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/for%20loop%20in%20TermDeferredStorageSvcImpl/near/201012899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/for.20loop.20in.20TermDeferredStorageSvcImpl.html#201012899">(Jun 16 2020 at 13:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span>  What's the point with this line? <a href="https://github.com/jamesagnew/hapi-fhir/blob/ac0d8c0fe1897eb870baf29d9141b0914e638ce3/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermDeferredStorageSvcImpl.java#L210">https://github.com/jamesagnew/hapi-fhir/blob/ac0d8c0fe1897eb870baf29d9141b0914e638ce3/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermDeferredStorageSvcImpl.java#L210</a> ? it looks a bit magically to me</p>



<a name="201023253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/for%20loop%20in%20TermDeferredStorageSvcImpl/near/201023253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/for.20loop.20in.20TermDeferredStorageSvcImpl.html#201023253">(Jun 16 2020 at 14:28)</a>:</h4>
<p>We're just trying to add concepts in small batches there.. E.g. if adding LOINC you're adding millions of concepts, maps, properties, valuesets, etc.. So we do this in little repeated chunks in order to avoid having huge outstanding transactions which might impact other stuff going on in the database.</p>
<p>Not entirely sure why 10 was chosen there though.. Probably just arbitrary.</p>
<p>We're likely going to rework this code as a part of our move to using Spring Batch to manage batch jobs. Hard to say whether the 10 will survive that though.. Is it causing you issues?</p>



<a name="201025615"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/for%20loop%20in%20TermDeferredStorageSvcImpl/near/201025615" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/for.20loop.20in.20TermDeferredStorageSvcImpl.html#201025615">(Jun 16 2020 at 14:45)</a>:</h4>
<p>Nope - loading codesystems during initialization is. Nothing big, nothing fancy. The stacktrace and issue is located in the hapi fhir Google groups</p>



<a name="201026944"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/for%20loop%20in%20TermDeferredStorageSvcImpl/near/201026944" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/for.20loop.20in.20TermDeferredStorageSvcImpl.html#201026944">(Jun 16 2020 at 14:53)</a>:</h4>
<p>Side effect is that valueset expansions are never stored in the database which also causes a lot of warn logging</p>



<a name="201119887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/for%20loop%20in%20TermDeferredStorageSvcImpl/near/201119887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/for.20loop.20in.20TermDeferredStorageSvcImpl.html#201119887">(Jun 17 2020 at 09:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> I would expect you will also stumble across this issue (<a href="https://groups.google.com/forum/#!topic/hapi-fhir/i8J1EzbPfdk">https://groups.google.com/forum/#!topic/hapi-fhir/i8J1EzbPfdk</a>) once you start working on the feature of bootstrapping an IG into the server at startup time.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
