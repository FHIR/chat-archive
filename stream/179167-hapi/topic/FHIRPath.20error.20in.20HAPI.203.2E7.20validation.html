---
layout: page
title: "FHIR Chat  · FHIRPath error in HAPI 3.7 validation · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html">FHIRPath error in HAPI 3.7 validation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="158804445"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/158804445" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#158804445">(Feb 18 2019 at 14:42)</a>:</h4>
<p>In HAPI 3.7, we're seeing an error when validating (STU3) against certain custom profiles. Specifically, we see the following errors when posting a valid Practitioner resource (this is from the returned OperationOutcome):</p>
<div class="codehilite"><pre><span></span>&quot;Problem evaluating slicing expression for element in profile http://example.org/fhir/StructureDefinition/MyBugpractitioner-de-basis-0.2 path Practitioner.name (fhirPath = true and (use memberOf &#39;http://hl7.org/fhir/ValueSet/name-use&#39;)): null&quot;
</pre></div>


<p>First bit of the error stack trace is</p>
<div class="codehilite"><pre><span></span>java.lang.UnsupportedOperationException
    at org.hl7.fhir.dstu3.hapi.validation.FhirInstanceValidator$WorkerContextWrapper.expandVS(FhirInstanceValidator.java:535)
    at org.hl7.fhir.r4.elementmodel.Element.getAsICoding(Element.java:775)
    at org.hl7.fhir.r4.model.Base.castToCoding(Base.java:486)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.opMemberOf(FHIRPathEngine.java:1735)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.operate(FHIRPathEngine.java:1333)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1119)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1100)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1118)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.evaluate(FHIRPathEngine.java:503)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.evaluateToBoolean(FHIRPathEngine.java:559)
    at org.hl7.fhir.r4.validation.InstanceValidator.evaluateSlicingExpression(InstanceValidator.java:2571)
    at org.hl7.fhir.r4.validation.InstanceValidator.sliceMatches(InstanceValidator.java:2563)
    at org.hl7.fhir.r4.validation.InstanceValidator.matchSlice(InstanceValidator.java:3801)
    at org.hl7.fhir.r4.validation.InstanceValidator.validateElement(InstanceValidator.java:3505)
    at org.hl7.fhir.r4.validation.InstanceValidator.start(InstanceValidator.java:2681)
    at org.hl7.fhir.r4.validation.InstanceValidator.validateResource(InstanceValidator.java:4020)
   (...)
</pre></div>


<p>The profile is a re-profiling of the <a href="https://simplifier.net/basisprofilde/practitioner-de-basis-0.2-duplicate-2" target="_blank" title="https://simplifier.net/basisprofilde/practitioner-de-basis-0.2-duplicate-2">German Base Practitioner profile</a> in which the following changes are introduced:</p>
<p>1. Make the <code>name</code> field required<br>
2. Slice the <code>name</code> with the discriminator on the value of the <code>name.use</code> field<br>
3. Add a required (1..1) slice in which <code>name.use</code> is required and fixed to "official", and <code>name.given</code>and <code>name.family</code>are required.</p>
<p>The error seems to be related to the profile in question being a re-profling</p>
<p>Is this a known issue and is there perhaps a workaround?</p>



<a name="158840564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/158840564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#158840564">(Feb 19 2019 at 01:04)</a>:</h4>
<p>not sure. I'll have to investigate.</p>



<a name="158840572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/158840572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#158840572">(Feb 19 2019 at 01:05)</a>:</h4>
<p>I think that this is before the change to the new hapi core structure?</p>



<a name="158860497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/158860497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#158860497">(Feb 19 2019 at 09:09)</a>:</h4>
<p>Hm, not sure when the split was -  HAPI 3.7 was released on Feb 6th (release is Git commit #207015c3af5022570c36796ce0f4f0067ff9bc3a).</p>



<a name="159983719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/159983719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#159983719">(Mar 05 2019 at 07:55)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Should I make a GF ticket for this for your current sweep through the validator?</p>



<a name="159986381"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/159986381" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#159986381">(Mar 05 2019 at 08:51)</a>:</h4>
<p>can you reproduce this with the validator.jar?</p>



<a name="159990839"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/159990839" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#159990839">(Mar 05 2019 at 10:08)</a>:</h4>
<p>Just checked with the latest validator JAR and it worked fine, so I suppose this is actually coming from HAPI.</p>



<a name="159991048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/159991048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#159991048">(Mar 05 2019 at 10:11)</a>:</h4>
<p>ok. well, is it because the code is not up to date?</p>



<a name="160020956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/160020956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#160020956">(Mar 05 2019 at 17:14)</a>:</h4>
<p>Just checked again and I see the above error with the most recent HAPI release (3.7). In my setup, I'm afraid I can't check against anything newer so I cannot tell if it has fixed in GitHub.</p>



<a name="160023593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/FHIRPath%20error%20in%20HAPI%203.7%20validation/near/160023593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/FHIRPath.20error.20in.20HAPI.203.2E7.20validation.html#160023593">(Mar 05 2019 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> is there are way to investigate this?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
