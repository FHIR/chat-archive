---
layout: page
title: "FHIR Chat  · Multitenancy on jpaserver-starter seems buggy: tips? · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Multitenancy.20on.20jpaserver-starter.20seems.20buggy.3A.20tips.3F.html">Multitenancy on jpaserver-starter seems buggy: tips?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="218428026"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Multitenancy%20on%20jpaserver-starter%20seems%20buggy%3A%20tips%3F/near/218428026" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Whelan <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Multitenancy.20on.20jpaserver-starter.20seems.20buggy.3A.20tips.3F.html#218428026">(Dec 01 2020 at 14:25)</a>:</h4>
<p>Hello!<br>
I've been exploring hapi-fhir's new multitenancy support using the JPA starter project.</p>
<p>It's been tricky, though:</p>
<ul>
<li>it took quite a while to figure out how to create partitions/tenants (the docs don't mention you must refer to a "DEFAULT" tenant for these operations)</li>
<li>Resource creation  fails if auto_create_placeholder_reference_targets is true and your resource refers to something not yet created (it looks like that makes an update call that doesn't include the request, so the tenant can't be extracted)</li>
<li>...and there's a bug in jpa starter where that flag ^ is set to the value of a different, similarly-named config flag</li>
<li>now that I've gotten this far (with local fixes), I can create tenants <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span>  but when I create a patient &amp; condition for tenant A, then query tenant B for that condition...  it comes back.  :(</li>
</ul>
<p>Is anyone else working with this feature?  Is there anything other than the 5.2.0 release I should be working with? Are there other feature I just need to disable, because they don't play nicely with multi-tenancy yet?</p>
<p>Any guidance at all would be very welcome. :)</p>
<p>I'll of course be happy to contribute my little fixes back, but I really need to know if this is a feature that just isn't usable yet.</p>
<p>Thanks!</p>
<p>EDIT: next issue found: I'm disabling reuse of cached search results, but there's an issue in Spring Boot passing a null from yaml into config... but that's what DaoConfig.setReuseCachedSearchResultsForMillis() requires to disable this feature.<br>
Hmm; and even with search caching disabled, any tenant in the URL returns the same resources. Back to the debugger.</p>



<a name="218481518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Multitenancy%20on%20jpaserver-starter%20seems%20buggy%3A%20tips%3F/near/218481518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Multitenancy.20on.20jpaserver-starter.20seems.20buggy.3A.20tips.3F.html#218481518">(Dec 01 2020 at 21:05)</a>:</h4>
<p>if there are problems with thee starter project, then please submit an issue on the github page</p>



<a name="218481561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Multitenancy%20on%20jpaserver-starter%20seems%20buggy%3A%20tips%3F/near/218481561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Multitenancy.20on.20jpaserver-starter.20seems.20buggy.3A.20tips.3F.html#218481561">(Dec 01 2020 at 21:05)</a>:</h4>
<p>a lot of stuff in regards to configuration has moved a lot</p>



<a name="218481570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Multitenancy%20on%20jpaserver-starter%20seems%20buggy%3A%20tips%3F/near/218481570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Multitenancy.20on.20jpaserver-starter.20seems.20buggy.3A.20tips.3F.html#218481570">(Dec 01 2020 at 21:05)</a>:</h4>
<p><span class="user-mention" data-user-id="367059">@Rob Whelan</span></p>



<a name="218522776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Multitenancy%20on%20jpaserver-starter%20seems%20buggy%3A%20tips%3F/near/218522776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Whelan <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Multitenancy.20on.20jpaserver-starter.20seems.20buggy.3A.20tips.3F.html#218522776">(Dec 02 2020 at 07:37)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191427">@Jens Villadsen</span> , I will — at this point, I'm just hoping to find out how stable this feature is in hapi-fhir, itself.</p>
<p>So far I've found that (once the config issues in jpaserver-starter are fixed) the multi-tenancy works fine for creating resources and fetching them back by ID.  This correctly returns empty (this condition was created in TENANT_A, and I can fetch it there):</p>
<div class="codehilite"><pre><span></span><code>http GET localhost:8080/fhir/TENANT_B/Condition/2
</code></pre></div>
<p>But this returns the Condition, even though it's the wrong  tenant:</p>
<div class="codehilite"><pre><span></span><code>http GET localhost:8080/fhir/TENANT_B/Condition?_id=2
</code></pre></div>
<p>There's a config setting, <code>getAllowReferencesAcrossPartitions</code> that I've also set to false (and double-checked in the debugger), but there's nothing else in config that seems at all relevant.</p>
<p>I'll raise an issue in the hapi-fhir project once I've verified this a bit more.<br>
It does seem like there are real issues, and not just mis-config.</p>
<p>That may be the best way to get some input from someone working on the project, if this feature is still at a stage where basic bugs like this are expected, or if there are known workarounds that'll provide something usable.</p>



<a name="218664639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Multitenancy%20on%20jpaserver-starter%20seems%20buggy%3A%20tips%3F/near/218664639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Whelan <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Multitenancy.20on.20jpaserver-starter.20seems.20buggy.3A.20tips.3F.html#218664639">(Dec 03 2020 at 08:28)</a>:</h4>
<p>Update for anyone following here: James A fixed the blocking bug I hit in core (yesterday), so the fix will be in the next release. <span aria-label="celebration" class="emoji emoji-1f388" role="img" title="celebration">:celebration:</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
