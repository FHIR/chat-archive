---
layout: page
title: "FHIR Chat  · Incorrect meta-data returned on PUT? · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Incorrect.20meta-data.20returned.20on.20PUT.3F.html">Incorrect meta-data returned on PUT?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="154024738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Incorrect%20meta-data%20returned%20on%20PUT%3F/near/154024738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Incorrect.20meta-data.20returned.20on.20PUT.3F.html#154024738">(Dec 12 2018 at 08:41)</a>:</h4>
<p>I've noticed a somewhat confusing behavior with the way HAPI updates meta-data upon PUT  (also reproducible on <a href="http://hapi.fhir.org/baseDstu3" target="_blank" title="http://hapi.fhir.org/baseDstu3">http://hapi.fhir.org/baseDstu3</a>) and just wanted to check that I am not missing smt. before I log an issue. Specifically, the <code>lastUpdated</code> and <code>versionId</code> fields do not seem to be updated synchronously.</p>
<p>Suppose we do the following</p>
<p>1. First, POST a resource  --&gt; get back created resource with <code>lastUpdated</code>and <code>versionId</code><br>
2. Copy the resource returned, make a change somewhere, and then PUT it, <em>including <code>meta</code>-field</em>  --&gt; get back (apparently) updated resource with <code>lastUpdated</code>and <code>versionId</code><br>
3. Finally, GET the resource</p>
<p>Then we find that:</p>
<ul>
<li>The  resource returned from the PUT in step 2 has an updated <code>lastUpdated</code> relative to what came back from the POST in step 2, <em>but</em> the same <code>versionId</code> (viz. the one that included in the body of the PUT request). </li>
<li>In step 3, we get back a resource in which <em>both</em> <code>versionId and </code>lastUpdated`has been updated.</li>
</ul>
<p>In other words, the resource returned on a PUT seem to have a "half-updated" <code>meta</code>-field. However, the ETag header has the correct version. There is also a <code>Content-Location</code>header with the correct versioned path, but no <code>Location</code>header. Also, if we leave out the <code>meta</code>-field in the body of the PUT in step 2,  the right (updated) <code>versionId</code> comes back in response(<a href="https://www.hl7.org/fhir/http.html#update" target="_blank" title="https://www.hl7.org/fhir/http.html#update">in line with the spec</a>: "If the request body includes a meta, the server SHALL ignore the provided versionId and lastUpdated values". </p>
<p>Is there some reason behind this behavior? From the spec it seems that returned the updated resource is not required, only the updated <code>ETag</code>.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
