---
layout: page
title: "FHIR Chat  · Blob data within HAPI DB · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html">Blob data within HAPI DB</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="164014233"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164014233" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164014233">(Apr 23 2019 at 18:08)</a>:</h4>
<p>I can see records in my HAPI database in HFJ_RESOURCE, with I think the actual data itself in HFJ_RES_VER.RES_TEXT. This is a "LONGBLOB" field. Is that the right place to extract this via SQL and how is it possible to convert the blob back to text?</p>



<a name="164024169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164024169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164024169">(Apr 23 2019 at 19:55)</a>:</h4>
<p>I'm not sure how you would (or if you can) do that in Derby<br>
as Kevin suggested, moving to Mysql or Postgresql probably is something you will want to consider (if you haven't)<br>
Postgresql works well for me</p>



<a name="164024511"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164024511" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164024511">(Apr 23 2019 at 19:59)</a>:</h4>
<p>Hi Rob, sorry, should have pointed out  - this is HAPI on MySQL in fact. I can see all the tables in a GUI viewer, but just cannot extract the actual resource data as text. It's encoded somehow. What can you see in HFJ_RES_VER.RES_TEXT?</p>



<a name="164040851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164040851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164040851">(Apr 24 2019 at 00:03)</a>:</h4>
<p>I've now tried Postgres. This shows the same field as a oid datatype. Which I assume is a link to the actual blob of data.  But again I cannot find a way to access the actual resource data via SQL.</p>



<a name="164052056"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164052056" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164052056">(Apr 24 2019 at 04:13)</a>:</h4>
<p>I don't know the answer offhand, but maybe I can take a look and see if I can find something on it</p>



<a name="164061697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164061697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164061697">(Apr 24 2019 at 08:02)</a>:</h4>
<p>if it helps, the java code is:</p>
<p>public static String decodeResource(byte[] theResourceBytes, ResourceEncodingEnum theResourceEncoding) {<br>
        String resourceText = null;<br>
        switch (theResourceEncoding) {<br>
            case JSON:<br>
                resourceText = new String(theResourceBytes, Charsets.UTF_8);<br>
                break;<br>
            case JSONC:<br>
                resourceText = GZipUtil.decompress(theResourceBytes);<br>
                break;<br>
            case DEL:<br>
                break;<br>
        }<br>
        return resourceText;<br>
    }</p>



<a name="164062229"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164062229" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164062229">(Apr 24 2019 at 08:11)</a>:</h4>
<p>On SQL Server 2017 if the encoding is JSONC. The following should work:</p>
<p>SELECT TOP 1000 [PID]   <br>
      ,Convert(varchar(max),DECOMPRESS(RES_TEXT))<br>
  FROM [dbo].[HFJ_RES_VER]</p>



<a name="164068871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164068871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164068871">(Apr 24 2019 at 10:21)</a>:</h4>
<p>thanks Kevin. What I am looking for is a Postgres way to do that SQL statement. I have tried lots of variations of decode, case and lo_get functions but have not yet managed to get a plain text version of the resource. But now I know it might be gzip and not just base64 or something, that may help my searching.</p>



<a name="164068979"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164068979" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164068979">(Apr 24 2019 at 10:23)</a>:</h4>
<p>I thing the format in Postgres might be "bytea" but I don't know how to convert that to plain text.</p>



<a name="164071329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164071329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164071329">(Apr 24 2019 at 11:11)</a>:</h4>
<p>Rik, the decoding is done here: <a href="https://github.com/jamesagnew/hapi-fhir/blob/706af5d5794e117159b635614c72bcb8799df492/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/BaseHapiFhirDao.java#L1142" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/blob/706af5d5794e117159b635614c72bcb8799df492/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/BaseHapiFhirDao.java#L1142">https://github.com/jamesagnew/hapi-fhir/blob/706af5d5794e117159b635614c72bcb8799df492/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/BaseHapiFhirDao.java#L1142</a></p>



<a name="164071334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164071334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164071334">(Apr 24 2019 at 11:11)</a>:</h4>
<p>The loading from the DB (via JPA) here: <a href="https://github.com/jamesagnew/hapi-fhir/blob/c8f2e4bbc94538c582400f002d536d85f81ca011/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/BaseHapiFhirResourceDao.java#L898" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/blob/c8f2e4bbc94538c582400f002d536d85f81ca011/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/BaseHapiFhirResourceDao.java#L898">https://github.com/jamesagnew/hapi-fhir/blob/c8f2e4bbc94538c582400f002d536d85f81ca011/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/BaseHapiFhirResourceDao.java#L898</a></p>



<a name="164073971"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164073971" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164073971">(Apr 24 2019 at 12:00)</a>:</h4>
<p>Thanks Patrick, I will have a look at that. Looks like beautiful code! I am really looking for a non-code based way to do this, via SQL, but this may help work that out. Use case is an SQL enabled but  non-FHIR enabled system needs to read data.</p>



<a name="164077234"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164077234" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164077234">(Apr 24 2019 at 12:48)</a>:</h4>
<p>Most of the out the box FHIR servers store data in a similar way. When I was at NHS Digital we went a more traditional SQL focused route but that meant we had less coverage of FHIR.  <a href="https://github.com/nhsconnect/careconnect-reference-implementation" target="_blank" title="https://github.com/nhsconnect/careconnect-reference-implementation">https://github.com/nhsconnect/careconnect-reference-implementation</a>  Its not that hard to extend but it has to be coded.</p>



<a name="164077909"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/164077909" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#164077909">(Apr 24 2019 at 12:59)</a>:</h4>
<p>If there is no easy SQL to get the data directly we will probably implement a workaround shim that gets the data via REST and feeds it into the SQL based product some other way. Or perhaps using that JPA routine from the source.</p>



<a name="176688236"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/176688236" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#176688236">(Sep 26 2019 at 19:16)</a>:</h4>
<p>Coming back to an old thread. HAPI appears to allow the data to be stored in RES_TEXT field as JSON or JSONC (which is gzip encoded). At least the decodeResource function (shown above) can retrieve those two formats. Is there a server config option to store data in unencoded json?</p>



<a name="176694610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Blob%20data%20within%20HAPI%20DB/near/176694610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Blob.20data.20within.20HAPI.20DB.html#176694610">(Sep 26 2019 at 20:30)</a>:</h4>
<p>There isn't currently, although I do think there should be.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
