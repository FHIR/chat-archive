---
layout: page
title: "FHIR Chat  · HAPI JSON parser drops contained element · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html">HAPI JSON parser drops contained element</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="256741123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/256741123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#256741123">(Oct 08 2021 at 13:41)</a>:</h4>
<p>Hi, all, I am using HAPI 5.3 to convert a QuestionnaireResponse which has contained a Questionnaire. In QuestionnaireResponse, I have the QuestionnaireResponse.questionnaire with canonical ID referred to the contained Questionnaire. I can see the contained list is set from debugger, however, when I used ctx.newJsonParser().encodeResourceToString(), the contained element disappeared. Noticed that encodeResourceToString() takes IBaseResource as the parameter; "contained" is defined in IDomainResource. I am wondering if other people have seen this issue and if there is any solution to resolve it. Thanks for any help in advance.</p>



<a name="256742150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/256742150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#256742150">(Oct 08 2021 at 13:49)</a>:</h4>
<p>add an extension to the QuestionnaireResponse which references the contained resource via the contained id</p>



<a name="256793197"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/256793197" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#256793197">(Oct 08 2021 at 19:30)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191478">@Oliver Egger</span> for your reply. Can you elaborate more details? Is there an existing extension I can use or do I need define my own extension, then the IParser would acknowledge it?</p>



<a name="256794601"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/256794601" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#256794601">(Oct 08 2021 at 19:41)</a>:</h4>
<p>Contained resources need to be referenced, the canonical is for hapi not sufficient, just use your own extension.</p>



<a name="256798477"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/256798477" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#256798477">(Oct 08 2021 at 20:09)</a>:</h4>
<p>Does this look right? Thanks</p>
<p>{<br>
    "resourceType": "QuestionnaireResponse",<br>
    "meta": {<br>
        "profile": [<br>
            "<a href="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse-adapt">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse-adapt</a>"<br>
        ]<br>
    },<br>
    "extension": [<br>
        {<br>
            "url": "<a href="http://hl7.org/fhir/StructureDefinition/contained-id">http://hl7.org/fhir/StructureDefinition/contained-id</a>",<br>
            "valueCanonical": "#q"<br>
        }<br>
    ],<br>
    "contained": [<br>
        {<br>
            "resourceType": "Questionnaire",<br>
            "id": "q",<br>
            "meta": {<br>
                "profile": [<br>
                    "<a href="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-adapt">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-adapt</a>"<br>
                ]<br>
            }<br>
        }<br>
    ],<br>
    "questionnaire": "#q",<br>
    "status": "in-progress"<br>
}</p>



<a name="256845275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/256845275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#256845275">(Oct 09 2021 at 06:26)</a>:</h4>
<ol>
<li>Use valueReference in extension insteaf of valueCanonical, </li>
<li>Use for the extension an url /domain which is under your control</li>
</ol>



<a name="256845556"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/256845556" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#256845556">(Oct 09 2021 at 06:31)</a>:</h4>
<p>See example <a href="https://github.com/hl7ch/covid-19-prom/blob/master/input/resources/questionnaire/coronascience-question-of-the-day-QD1.xml#L174">L174</a></p>



<a name="257065784"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257065784" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257065784">(Oct 11 2021 at 13:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191478">@Oliver Egger</span> Your example really helped me!  Really appreciate it.</p>



<a name="257065965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257065965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257065965">(Oct 11 2021 at 13:42)</a>:</h4>
<p>I am still wondering how HAPI works with respect to those customer defined extensions. Is there any documentation mentions this behavior?</p>



<a name="257066528"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257066528" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257066528">(Oct 11 2021 at 13:47)</a>:</h4>
<p>No not that i am aware of.<br>
It doesn't matter what extension you are using, what matters to hapi: is there an actual reference to or from the contained resource to the surrounding resource.</p>



<a name="257066549"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257066549" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257066549">(Oct 11 2021 at 13:47)</a>:</h4>
<p>If there is none -&gt; drop contained resource.</p>



<a name="257066619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257066619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257066619">(Oct 11 2021 at 13:48)</a>:</h4>
<p>So any extension containing the neede reference will stop dropping the contained resource</p>



<a name="257066704"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257066704" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257066704">(Oct 11 2021 at 13:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> what do you think of (re)moving this check from the parser?</p>



<a name="257066774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257066774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257066774">(Oct 11 2021 at 13:49)</a>:</h4>
<p>I think this is some kind of business/FHIR logic which shouldn't be applied while parsing</p>



<a name="257091456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257091456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257091456">(Oct 11 2021 at 17:02)</a>:</h4>
<p>This check was removed in HAPI FHIR 5.4.0 - As of that release HAPI FHIR will not string contained resources that are manually added to the list for any reason.</p>



<a name="257094292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257094292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257094292">(Oct 11 2021 at 17:26)</a>:</h4>
<p>i totally missed that, sorry. Thanks for the heads-up</p>



<a name="257094841"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257094841" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257094841">(Oct 11 2021 at 17:31)</a>:</h4>
<p>Ah, I see. Thanks for the information.</p>



<a name="257119409"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20JSON%20parser%20drops%20contained%20element/near/257119409" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20JSON.20parser.20drops.20contained.20element.html#257119409">(Oct 11 2021 at 21:34)</a>:</h4>
<p>No worries!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
