---
layout: page
title: "FHIR Chat  · Java Validator Nullpointer · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html">Java Validator Nullpointer</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="184546725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/184546725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#184546725">(Dec 31 2019 at 14:32)</a>:</h4>
<p>When validating against an IG with profiles where derivation isn't set the validator throws some null pointers here:<br>
<a href="https://github.com/hapifhir/org.hl7.fhir.core/blob/630ab0afcba49043ff2b145217e6735baddfaba2/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/conformance/ProfileUtilities.java#L489" target="_blank" title="https://github.com/hapifhir/org.hl7.fhir.core/blob/630ab0afcba49043ff2b145217e6735baddfaba2/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/conformance/ProfileUtilities.java#L489">https://github.com/hapifhir/org.hl7.fhir.core/blob/630ab0afcba49043ff2b145217e6735baddfaba2/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/conformance/ProfileUtilities.java#L489</a></p>
<p>As derived.getDerivation() returns null.</p>



<a name="184546989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/184546989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#184546989">(Dec 31 2019 at 14:39)</a>:</h4>
<p>I think if it getDerivation() returns null just skip the following block?</p>



<a name="184560593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/184560593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#184560593">(Dec 31 2019 at 19:09)</a>:</h4>
<p>why is derivation null?</p>



<a name="184560663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/184560663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#184560663">(Dec 31 2019 at 19:10)</a>:</h4>
<p>I guess because it wasn‘t populated in the StrucDef</p>



<a name="184560697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/184560697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#184560697">(Dec 31 2019 at 19:11)</a>:</h4>
<p>The StructureDefinition itself, which i parsed, does not have have it</p>



<a name="184560703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/184560703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#184560703">(Dec 31 2019 at 19:12)</a>:</h4>
<p>So it ends up as Null in the Instance</p>



<a name="184560742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/184560742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#184560742">(Dec 31 2019 at 19:12)</a>:</h4>
<p>Added a PR to fix it</p>



<a name="184561023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/184561023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#184561023">(Dec 31 2019 at 19:17)</a>:</h4>
<p>fix it how? how can you generate a snapshot if there's no derivation?</p>



<a name="185201922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185201922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185201922">(Jan 09 2020 at 11:07)</a>:</h4>
<p>Sorry for the insufficient explanation last time, was on the mobile phone.<br>
This is used in the Validator at several places: <code>(derived.getDerivation().equals(TypeDerivationRule.SPECIALIZATION))</code>  <br>
When you are validating against a profile which StrucDef doesn't has derivation populated a NullPointer is thrown as there is no null check and the variable derived stays null after parsing the profile.</p>



<a name="185258802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185258802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185258802">(Jan 09 2020 at 21:37)</a>:</h4>
<p>but why is there no derivation, and how can the SD make sense?</p>



<a name="185295222"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185295222" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185295222">(Jan 10 2020 at 09:49)</a>:</h4>
<p>because derivation is 0..1 and not enforced. The parser sets derivation to null if not populated and then later throws a null pointer.</p>



<a name="185295245"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185295245" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185295245">(Jan 10 2020 at 09:49)</a>:</h4>
<p>So this PR is about making these methods null-safe.</p>



<a name="185295318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185295318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185295318">(Jan 10 2020 at 09:50)</a>:</h4>
<p>Why are you expecting StructureDefinition.derivation to be populated when it is 0..1 ?</p>



<a name="185295740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185295740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185295740">(Jan 10 2020 at 09:56)</a>:</h4>
<p>the only case when it shouldn't have a value is when there's no base definition. If there's a base definition, how can it be meaningful if there derivation is unknown?</p>



<a name="185298273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185298273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185298273">(Jan 10 2020 at 10:31)</a>:</h4>
<p>i agree on a logic level, but as far as i can see a StructureDefinition with no derivation is a valid on a technical level as i can't see anything enforcing the population of the derivation. e.g.: <a href="https://simplifier.net/BasisprofilDE/organization-de-basis-0.2/~xml" target="_blank" title="https://simplifier.net/BasisprofilDE/organization-de-basis-0.2/~xml">https://simplifier.net/BasisprofilDE/organization-de-basis-0.2/~xml</a> doesn't have it populated.</p>



<a name="185298580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185298580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185298580">(Jan 10 2020 at 10:35)</a>:</h4>
<p>it's valid on a technical level, but not meaningful for generating a snapshot</p>



<a name="185302952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185302952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185302952">(Jan 10 2020 at 11:48)</a>:</h4>
<p>agree. So i'll update my PR to not default to derivation=constrain - but to catch the NullPointer and Log a meaningful error?</p>



<a name="185303311"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185303311" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185303311">(Jan 10 2020 at 11:54)</a>:</h4>
<p>I just made the change here after our discussion.</p>



<a name="185303512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185303512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185303512">(Jan 10 2020 at 11:57)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="185310353"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Java%20Validator%20Nullpointer/near/185310353" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Java.20Validator.20Nullpointer.html#185310353">(Jan 10 2020 at 13:41)</a>:</h4>
<p>can you push the change?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
