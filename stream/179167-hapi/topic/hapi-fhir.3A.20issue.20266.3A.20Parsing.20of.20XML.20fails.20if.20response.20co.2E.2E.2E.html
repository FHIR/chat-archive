---
layout: page
title: "FHIR Chat  · hapi-fhir: issue 266: Parsing of XML fails if response co... · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi-fhir.3A.20issue.20266.3A.20Parsing.20of.20XML.20fails.20if.20response.20co.2E.2E.2E.html">hapi-fhir: issue 266: Parsing of XML fails if response co...</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153811420"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi-fhir%3A%20issue%20266%3A%20Parsing%20of%20XML%20fails%20if%20response%20co.../near/153811420" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zulip HAPI Bot <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi-fhir.3A.20issue.20266.3A.20Parsing.20of.20XML.20fails.20if.20response.20co.2E.2E.2E.html#153811420">(Dec 03 2015 at 14:19)</a>:</h4>
<p>psosm opened <a href="https://github.com/jamesagnew/hapi-fhir/issues/266" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/issues/266">issue 266</a></p>
<blockquote>
<p>I have just tried to get the conformance profile from the spark server at <a href="http://furore.com" target="_blank" title="http://furore.com">furore.com</a><br>
using: </p>
<p>client.fetchConformance().ofType(Conformance.class).execute();</p>
<p>the execution failed leaving a stack trace like:<br>
ca.uhn.fhir.parser.DataFormatException: javax.xml.stream.XMLStreamException: ParseError at [row,col]:[1,1]<br>
Message: Content ist nicht zulässig in Prolog.<br>
    at ca.uhn.fhir.parser.XmlParser.doXmlLoop(XmlParser.java:253)<br>
    at ca.uhn.fhir.parser.XmlParser.parseResource(XmlParser.java:1036)<br>
    at ca.uhn.fhir.parser.XmlParser.doParseResource(XmlParser.java:191)<br>
    at ca.uhn.fhir.parser.BaseParser.parseResource(BaseParser.java:474)<br>
    at ca.uhn.fhir.rest.client.BaseClient$ResourceResponseHandler.invokeClient(BaseClient.java:531)<br>
    at ca.uhn.fhir.rest.client.BaseClient$ResourceResponseHandler.invokeClient(BaseClient.java:504)<br>
    at ca.uhn.fhir.rest.client.BaseClient.invokeClient(BaseClient.java:354)<br>
    at ca.uhn.fhir.rest.client.GenericClient$BaseClientExecutable.invoke(GenericClient.java:648)<br>
    at ca.uhn.fhir.rest.client.GenericClient$FetchConformanceInternal.execute(GenericClient.java:931)<br>
    at ca.uhn.fhir.rest.client.RestfulClientFactory.validateServerBase(RestfulClientFactory.java:293)<br>
    at ca.uhn.fhir.rest.client.RestfulClientFactory.validateServerBaseIfConfiguredToDoSo(RestfulClientFactory.java:209)<br>
    at ca.uhn.fhir.rest.client.BaseClient.invokeClient(BaseClient.java:188)<br>
    at ca.uhn.fhir.rest.client.GenericClient$BaseClientExecutable.invoke(GenericClient.java:648)<br>
    at ca.uhn.fhir.rest.client.GenericClient$FetchConformanceInternal.execute(GenericClient.java:931)</p>
</blockquote>



<a name="153811421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi-fhir%3A%20issue%20266%3A%20Parsing%20of%20XML%20fails%20if%20response%20co.../near/153811421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zulip HAPI Bot <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi-fhir.3A.20issue.20266.3A.20Parsing.20of.20XML.20fails.20if.20response.20co.2E.2E.2E.html#153811421">(Dec 03 2015 at 14:22)</a>:</h4>
<p>psosm <a href="https://github.com/jamesagnew/hapi-fhir/issues/266#issuecomment-161654034" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/issues/266#issuecomment-161654034">commented</a> on <a href="https://github.com/jamesagnew/hapi-fhir/issues/266" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/issues/266">issue 266</a></p>
<blockquote>
<p>As far as i can see there ist a problem if the response body is preluded with a byte order mark (BOM)<br>
Changing BaseClient.java to use a BOMInputStream (of commons-io) as source for the reader in createReaderFromResponse fixed the problem</p>
<p>I have changed line 494 of BaseClient.java from<br>
Reader reader = new InputStreamReader(theResponse.getEntity().getContent(), charset);<br>
to<br>
                BOMInputStream bomInputStream = new BOMInputStream(theResponse.getEntity().getContent(), false);<br>
                Reader reader = new InputStreamReader(bomInputStream, charset);<br>
which solved the problem</p>
</blockquote>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
