---
layout: page
title: "FHIR Chat  · Named search parameter for all resources · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Named.20search.20parameter.20for.20all.20resources.html">Named search parameter for all resources</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="188964117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Named%20search%20parameter%20for%20all%20resources/near/188964117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Grimes <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Named.20search.20parameter.20for.20all.20resources.html#188964117">(Feb 24 2020 at 20:45)</a>:</h4>
<p>I'm trying to define a named search parameter that works across ALL resources.</p>
<p>This doesn't work, as there doesn't seem to be enough information within either the return type or the type parameter to the annotation for HAPI to associate it with a resource type:</p>
<div class="codehilite"><pre><span></span>  <span class="nd">@Search</span><span class="p">(</span><span class="n">queryName</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">IBundleProvider</span> <span class="nf">patientSearch</span><span class="p">(</span><span class="nd">@OptionalParam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="n">StringOrListParam</span> <span class="n">bars</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>


<p>This works, but it requires me to have an annotated method for every resource type:</p>
<div class="codehilite"><pre><span></span>  <span class="nd">@Search</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">Patient</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">queryName</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">IBundleProvider</span> <span class="nf">patientSearch</span><span class="p">(</span><span class="nd">@OptionalParam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="n">StringOrListParam</span> <span class="n">bars</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Search</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">DiagnosticReport</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">queryName</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">IBundleProvider</span> <span class="nf">reportSearch</span><span class="p">(</span><span class="nd">@OptionalParam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="n">StringOrListParam</span> <span class="n">bars</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">...</span>
</pre></div>


<p>Is there a way to define a named parameter across all resource types that allows me to receive the resource type at runtime and handle that myself? Do I have to generate code to implement this?</p>
<p>BTW, I also tried interceptors... but it seems to bomb out somewhere between <code>SERVER_INCOMING_REQUEST_POST_PROCESSED</code> and <code>SERVER_INCOMING_REQUEST_PRE_HANDLED</code>, which makes it difficult to get at both the search parameter and resource type information.</p>



<a name="189190366"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Named%20search%20parameter%20for%20all%20resources/near/189190366" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Grimes <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Named.20search.20parameter.20for.20all.20resources.html#189190366">(Feb 27 2020 at 06:30)</a>:</h4>
<p>With the help of <span class="user-mention" data-user-id="191343">@Michael Lawley</span> I figured out a nice way of doing this:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SearchProvider</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">IBaseResource</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">IResourceProvider</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">resourceType</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">SearchProvider</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">resourceType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">resourceType</span> <span class="o">=</span> <span class="n">resourceType</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">IBaseResource</span><span class="o">&gt;</span> <span class="nf">getResourceType</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">resourceType</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Search</span><span class="p">(</span><span class="n">queryName</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
  <span class="kd">public</span> <span class="n">IBundleProvider</span> <span class="nf">search</span><span class="p">(</span><span class="nd">@OptionalParam</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="n">StringOrListParam</span> <span class="n">bars</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>


<p>Then just register one for each resource type, using the built-in enum within HAPI:</p>
<div class="codehilite"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">ResourceType</span> <span class="n">resourceType</span> <span class="p">:</span> <span class="n">ResourceType</span><span class="p">.</span><span class="na">values</span><span class="p">())</span> <span class="p">{</span>
  <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">IBaseResource</span><span class="o">&gt;</span> <span class="n">resourceTypeClass</span> <span class="o">=</span> <span class="n">getFhirContext</span><span class="p">()</span>
      <span class="p">.</span><span class="na">getResourceDefinition</span><span class="p">(</span><span class="n">resourceType</span><span class="p">.</span><span class="na">name</span><span class="p">()).</span><span class="na">getImplementingClass</span><span class="p">();</span>
  <span class="n">registerProvider</span><span class="p">(</span><span class="k">new</span> <span class="n">SearchProvider</span><span class="p">(</span><span class="n">resourceTypeClass</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
