---
layout: page
title: "FHIR Chat  · Fhir Sever Not Starting · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html">Fhir Sever Not Starting</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="221104382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/221104382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neil Lott <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#221104382">(Dec 29 2020 at 01:18)</a>:</h4>
<p>Has anyone seen this one?</p>
<p>Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.<br>
2020-12-28 18:11:24.763 ERROR 9967 --- [           main] o.s.b.d.LoggingFailureAnalysisReporter   : </p>
<hr>
<p>APPLICATION FAILED TO START</p>
<hr>
<p>Description:</p>
<p>Field myEntityManagerFactory in ca.uhn.fhir.jpa.search.builder.SearchBuilder required a bean of type 'ca.uhn.fhir.jpa.config.HapiFhirLocalContainerEntityManagerFactoryBean' that could not be found.</p>
<p>The injection point has the following annotations:<br>
    - @org.springframework.beans.factory.annotation.Autowired(required=true)</p>
<p>Action:</p>
<p>Consider defining a bean of type 'ca.uhn.fhir.jpa.config.HapiFhirLocalContainerEntityManagerFactoryBean' in your configuration.</p>
<p>I'm attempting to wrap a fhir server in spring-boot and i'm seeing this now.</p>



<a name="221124909"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/221124909" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#221124909">(Dec 29 2020 at 10:27)</a>:</h4>
<p>Which version of HAPI are you using?</p>



<a name="221153096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/221153096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neil Lott <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#221153096">(Dec 29 2020 at 17:57)</a>:</h4>
<p>5.2.0</p>



<a name="221163304"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/221163304" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#221163304">(Dec 29 2020 at 20:12)</a>:</h4>
<p><span class="user-mention" data-user-id="372576">@Neil Lott</span>  look at the following it should get you around it:</p>
<div class="codehilite"><pre><span></span><code>    @Bean
    public LocalContainerEntityManagerFactoryBean entityManagerFactory(FhirContext fhirContext,
                                                                       DataSource dataSource,
                                                                       ConfigurableListableBeanFactory beanFactory,
                                                                       JtaTransactionManager jtaTransactionManager,
                                                                       JpaVendorAdapter jpaVendorAdapter) {
        LocalContainerEntityManagerFactoryBean entityManagerFactoryBean = new HapiFhirLocalContainerEntityManagerFactoryBean();
        try {
            entityManagerFactoryBean.setJpaVendorAdapter(jpaVendorAdapter);
            entityManagerFactoryBean.setJtaDataSource(dataSource);
            entityManagerFactoryBean.getJpaPropertyMap().putAll(getHibernateProperties(beanFactory, jtaTransactionManager));

            BaseConfig.configureEntityManagerFactory(entityManagerFactoryBean, fhirContext);
            entityManagerFactoryBean.setPersistenceUnitName(&quot;HAPI_PU&quot;);
        } catch (Exception e) {
            throw new ConfigurationException(&quot;Could create LocalContainerEntityManagerFactoryBean due to a configuration issue&quot;, e);
        }
        return entityManagerFactoryBean;
    }
</code></pre></div>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span>  you should be aware of this</p>



<a name="224389966"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/224389966" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kishore Karanam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#224389966">(Jan 28 2021 at 20:43)</a>:</h4>
<p>Me too facing the same issue. Any solution for the same?</p>



<a name="229840818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229840818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergej Reiser <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229840818">(Mar 11 2021 at 12:34)</a>:</h4>
<p><span class="user-mention" data-user-id="191427">@Jens Villadsen</span> Could you please ellaborate a little further on your solution?</p>
<p>I am trying to upgrade from HAPI 5.1.0 to 5.2.1 but the server fails to start and throws the same Excepation as descirbed in the first post.</p>



<a name="229842072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229842072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229842072">(Mar 11 2021 at 12:46)</a>:</h4>
<p>Have you tried on 5.3.0 now that it is released?</p>



<a name="229843147"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229843147" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergej Reiser <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229843147">(Mar 11 2021 at 12:55)</a>:</h4>
<p>Yes i also tried to use 5.3.0 which ends up in the same issue.</p>
<p>Im using <a href="https://github.com/hapifhir/hapi-fhir/tree/master/hapi-fhir-spring-boot/hapi-fhir-spring-boot-starter">hapi-fhir-spring-boot-starter</a> to run a FHIR-Server in a spring-boot based project.<br>
The reason why i tried to upgrade to 5.2.1 first is that there is a sample project which i always used as a reference (apparently this sample was removed in 5.3.0): <a href="https://github.com/hapifhir/hapi-fhir/tree/v5.2.1/hapi-fhir-spring-boot/hapi-fhir-spring-boot-samples/hapi-fhir-spring-boot-sample-server-jpa">hapi-fhir-spring-boot-sample-server-jpa</a>. <br>
But even this sample project fails with the same Exception.</p>
<p>I am aware, that there is another sample project (<a href="https://github.com/hapifhir/hapi-fhir-jpaserver-starter">hapi-fhir-jpaserver-starter</a>) but that one doesn't use the hapi-fhir-spring-boot-starter.</p>



<a name="229844225"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229844225" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229844225">(Mar 11 2021 at 13:03)</a>:</h4>
<p><a href="https://github.com/hapifhir/hapi-fhir-jpaserver-starter">https://github.com/hapifhir/hapi-fhir-jpaserver-starter</a> is the only one that I co-maintain - the other ones are not really maintained anymore</p>



<a name="229872870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229872870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergej Reiser <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229872870">(Mar 11 2021 at 15:59)</a>:</h4>
<p>But HAPI's spring-boot-starter itself (<a href="https://github.com/hapifhir/hapi-fhir/tree/master/hapi-fhir-spring-boot/hapi-fhir-spring-boot-starter">hapi-fhir-spring-boot-starter</a>) is still being maintained as it got a release for 5.3.0 and a pre-release for 5.4.0-PRE1-SNAPSHOT.<br>
It just doesn't seem to work out-of-the-box as it used to do. <br>
Maybe i am mistaken, but shouldn't a spring-boot-starter provide convenient functionality to automatically wire up your application by simply adding the starter to the classpath?</p>
<p>In other words: Shouldn't your code snipped be part of hapi-fhir-spring-boot-starter / <a href="https://github.com/hapifhir/hapi-fhir/tree/master/hapi-fhir-spring-boot/hapi-fhir-spring-boot-autoconfigure">hapi-fhir-spring-boot-autoconfigure</a>?</p>



<a name="229874519"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229874519" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229874519">(Mar 11 2021 at 16:04)</a>:</h4>
<p>The jpa-starter is the only maintained way of getting a ready to use hapi instance. hapi-fhir-spring-boot-starter might have got some (search replace version updates, but no maintainance. Look for yourself: <a href="https://github.com/hapifhir/hapi-fhir/commits/master/hapi-fhir-spring-boot">https://github.com/hapifhir/hapi-fhir/commits/master/hapi-fhir-spring-boot</a>)</p>



<a name="229875098"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229875098" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229875098">(Mar 11 2021 at 16:06)</a>:</h4>
<p>the spring boot project was a community contribution quite some time ago. Afaik there is no maintainer for this part of hapi. So it can work, or it can't. I would take the safe route with the jpa starter project.</p>



<a name="229993424"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229993424" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergej Reiser <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229993424">(Mar 12 2021 at 08:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> thank you for clarifying! I falsely assumed, that every artifact located at <a href="https://github.com/hapifhir/hapi-fhir">https://github.com/hapifhir/hapi-fhir</a> is being maintained. And since the artifacts are being released to Maven-Central i didn't even bother to check the commits. Maybe it should be mentioned in the artifact's readme file.</p>
<p>We have been using hapi-fhir-spring-boot-starter since 4.1.0 and it has served us very well thus far. We will look into hapi-fhir-jpaserver-starter though in order to upgrade to a newer version.</p>



<a name="229994631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/229994631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#229994631">(Mar 12 2021 at 08:47)</a>:</h4>
<p>Yes adding a disclaimer to the Readme which points to the jpastarter project sounds like a good idea. <span class="user-mention" data-user-id="191319">@James Agnew</span> ?</p>



<a name="230031656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/230031656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#230031656">(Mar 12 2021 at 13:55)</a>:</h4>
<p>Definitely agreed</p>



<a name="250793305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/250793305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Dickie <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#250793305">(Aug 26 2021 at 15:45)</a>:</h4>
<p>Hi,</p>
<p>In Instant OpenHIE our scripts aren't working with an update from v5.2.1 to v5.4.1 - all in docker.</p>
<p>Previously, HAPI v5.2.1 connected to a MySQL DB (v5.7) when we configured Spring with the following:</p>
<div class="codehilite" data-code-language="yml"><pre><span></span><code>      - spring.datasource.url=jdbc:mysql://mysql:3306/hapi
      - spring.datasource.username=admin
      - spring.datasource.password=&lt;password&gt;
      - spring.datasource.driverClassName=com.mysql.cj.jdbc.Driver
      - spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect
</code></pre></div>
<p>With HAPI v5.3 onwards the service crashes with the following logs:</p>
<div class="codehilite"><pre><span></span><code>2021-08-26 15:19:21.889 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper [SqlExceptionHelper.java:137] SQL Error: 1146, SQLState: 42S02
2021-08-26 15:19:21.890 [main] ERROR o.h.e.jdbc.spi.SqlExceptionHelper [SqlExceptionHelper.java:142] Table &#39;hapi.HFJ_RESOURCE&#39; doesn&#39;t exist
2021-08-26 15:19:21.892 [main] ERROR c.u.f.j.s.b.sql.SearchQueryExecutor [SearchQueryExecutor.java:136] Failed to create or execute SQL query
org.hibernate.exception.SQLGrammarException: could not extract ResultSet
</code></pre></div>
<p>When I searched through MySQL DB I see that the table name casing has changed from upper to lower case.<br>
Hence <strong>HFJ_RESOURCE</strong> never resolved to <strong>hfj_resource</strong>.</p>
<p>I've tried using the following config to try prevent tables being created in lowercase but no luck:</p>
<div class="codehilite" data-code-language="yml"><pre><span></span><code>      - spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.SpringImplicitNamingStrategy
      - spring.jpa.hibernate.naming.physical-strategy.case-insensitive=false
</code></pre></div>
<p>Not sure what other combinations are out there.</p>
<p><strong>Does anyone have any suggestions for how to resolve the resource table names?</strong></p>



<a name="250851545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/250851545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#250851545">(Aug 26 2021 at 22:36)</a>:</h4>
<p><span class="user-mention" data-user-id="347882">@Kevin Dougan</span> can you have a peek at this one please?</p>



<a name="250924005"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/250924005" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Dougan <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#250924005">(Aug 27 2021 at 12:30)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="364091">@Matthew Dickie</span> ,<br>
What O/S are you using for your MySQL DB?<br>
Also, if you can get access to the DB Server, what is the current value of the MySQL system variable called <strong>lower_case_table_names</strong>?</p>
<p>You might have to change that MySQL system variable, according to the following documentation:<br>
<a href="https://dev.mysql.com/doc/refman/5.7/en/identifier-case-sensitivity.html">https://dev.mysql.com/doc/refman/5.7/en/identifier-case-sensitivity.html</a></p>



<a name="250927102"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Fhir%20Sever%20Not%20Starting/near/250927102" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Dickie <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Fhir.20Sever.20Not.20Starting.html#250927102">(Aug 27 2021 at 12:58)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="347882">@Kevin Dougan</span> <br>
MySQL DB is in a docker container from the official source  - <a href="https://hub.docker.com/_/mysql">https://hub.docker.com/_/mysql</a> tag <strong>5.7</strong> - not sure what OS that is - I assume a unix distribution?<br>
The <code>lower_case_table_names</code> variable is currently set to <strong>0</strong><br>
I'll try to pass in an Environment variable set to <strong>1</strong></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
