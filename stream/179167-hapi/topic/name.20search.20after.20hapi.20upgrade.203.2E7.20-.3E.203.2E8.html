---
layout: page
title: "FHIR Chat  · name search after hapi upgrade 3.7 -&gt; 3.8 · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html">name search after hapi upgrade 3.7 -&gt; 3.8</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="172490447"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172490447" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172490447">(Aug 05 2019 at 09:22)</a>:</h4>
<p>Just upgraded our hapi installation to 3.8 from 3.7 and hapi stopped searching for names.<br>
If i search for a Patient with Patient?name=foo, hapi can't find any patients. However if a create a new Patient searching for names works.<br>
Any idea which kind of index i have to reset?</p>



<a name="172529127"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172529127" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172529127">(Aug 05 2019 at 19:05)</a>:</h4>
<p>Did you run the database migrator command during the upgrade? If not, you probably need to do that..</p>



<a name="172529196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172529196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172529196">(Aug 05 2019 at 19:06)</a>:</h4>
<p>i did. it showed that there is no needed update</p>



<a name="172529393"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172529393" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172529393">(Aug 05 2019 at 19:09)</a>:</h4>
<p>i'm not sure if our server was updated from 3.5 -&gt; 3.7 before .But in 3.7 everything worked. Do you think by upgrading to 3.8 now, something got triggered which didn't showed in 3.7? If so, is it safe to run a migration e.g. from 3.4 - 3.8 just to be sure? or can this cause problems?</p>



<a name="172531885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172531885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172531885">(Aug 05 2019 at 19:42)</a>:</h4>
<p>Yup, it's always safe to run the migrator from older versions, it'll only make changes that are needed.</p>
<p>Can you check your <code>HFJ_SPIDX_STRING</code> table to see if there are any null values in the <code>HASH_IDENTITY</code> column? If so, that's the issue. This column was added in 3.6 but we only switched to using it in 3.8 so if you did a 3.5-&gt;3.x migration without running the migrator that's almost certainly the issue.</p>



<a name="172538188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172538188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172538188">(Aug 05 2019 at 21:05)</a>:</h4>
<p>thanks a lot. I think that caused the issue. Running the migration tool didn't change anything (i think because the index was already created through the first start of 3.7 or 3.8 ? So the script assumes "nothing to do there"?<br>
To prevent such issues, did you ever discuss using liquibase to automatically upgrade DB schema if needed?</p>



<a name="172552781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172552781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172552781">(Aug 06 2019 at 01:24)</a>:</h4>
<p>Yeah, it may be identifying that nothing is needed since some of the indexes have been built already. You could force the indexes to be rebuilt by invoking the <code>$mark-all-resources-for-reindexing</code> operation at the root of the server).</p>
<p>We looked at liquibase and flyway, but ultimately wanted something more flexible (and we suffer a bit from not-inveted-here syndrome :) ). The intent with the migrator tool is definitely that it will be able to run automatically in the future when configured to do so. We're almost there.</p>



<a name="172583714"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172583714" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172583714">(Aug 06 2019 at 12:35)</a>:</h4>
<p>great news. And thanks, reindexing solved all our problems</p>



<a name="172588979"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/name%20search%20after%20hapi%20upgrade%203.7%20-%3E%203.8/near/172588979" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/name.20search.20after.20hapi.20upgrade.203.2E7.20-.3E.203.2E8.html#172588979">(Aug 06 2019 at 13:40)</a>:</h4>
<p>woohoo! man, we really need to automate that</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
