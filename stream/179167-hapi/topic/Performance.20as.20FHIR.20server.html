---
layout: page
title: "FHIR Chat  · Performance as FHIR server · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html">Performance as FHIR server</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153855006"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855006" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855006">(Nov 01 2016 at 10:35)</a>:</h4>
<p>I tried to use HAPI server as FHIR server. I have a request queue placed for the interaction from the client. HAPI server fetch each message from the request queue and process it and successful messages will be moved to response queue. But it is found that HAPI server occupies entire processor load as well as the memory. It is almost 12 minutes to process 1000 request. I am using Oracle database to store FHIR messages. It is not scalable in this way. Can you please give me some suggestions to make the processing bit faster..</p>



<a name="153855007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl M. Davis <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855007">(Nov 01 2016 at 12:01)</a>:</h4>
<p>Binu, there are a whole host of issues to consider, so apologies for all of the incoming questions:</p>
<p>1. What version of HAPI are you using?<br>
2. Do you need to support full text search or terminology services?<br>
3. What is the ratio of reads to writes in those 1000 requests?<br>
4. How many requests per second do you <strong>need</strong> to support?<br>
5. Are you using HAPI's JPA database layer, or is HAPI just wrapping some other backend?</p>



<a name="153855073"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855073" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855073">(Nov 02 2016 at 04:31)</a>:</h4>
<p>Karl, Thank you very much for the response. Please find my response to your queries<br>
1. What version of HAPI are you using?<br>
-- Version 1.4<br>
2. Do you need to support full text search or terminology services?<br>
-- Not necessary<br>
3. What is the ratio of reads to writes in those 1000 requests?<br>
-- Currently 2  minutes is taken to process 100 requests, want to achieve the same in 1 second.<br>
4. How many requests per second do you need to support?<br>
--100 requests / second<br>
5. Are you using HAPI's JPA database layer, or is HAPI just wrapping some other backend?<br>
--I am using HAPI JPA database layer storing data in Oracle database..</p>
<p>what I found today that the bottleneck is with FHIRValidator using the XML file.. The file is huge and it occupies more memory.  Further not enough memory is available for the process to utilized. Is there any mechanism to cache the XML and do the validation? or which is the better mechanism to make validation faster?</p>



<a name="153855201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855201">(Nov 03 2016 at 04:14)</a>:</h4>
<p>what I found today that the bottleneck is FHIRValidator using the XML file.. The file is huge and it occupies more memory. Is there any mechanism to cache the XML and do the validation? or which is the better mechanism to make validation faster?</p>



<a name="153855206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855206">(Nov 03 2016 at 06:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> where did we get to talking about that? The validator is not thread safe, but it's the context that matters - the validator doesn't load or cache it's own stuff. </p>



<a name="153855258"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855258" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855258">(Nov 03 2016 at 10:48)</a>:</h4>
<p>Hi Binu,</p>
<p>Assuming that you're keeping an instance of HAPI's <code>DefaultProfileValidationSupport</code> in memory, and reusing it for all validation activities? That's the class that loads the profile StructureDefinitions into memory and it will keep a cache going as long as you are reusing it. You should see lines like the following in your server logs only once:</p>
<div class="codehilite"><pre>06:46:03.353 [main] INFO  o.h.f.d.h.v.DefaultProfileValidationSupport - Loading structure definitions from classpath: /org/hl7/fhir/instance/model/dstu3/profile/profiles-resources.xml
06:46:04.146 [main] INFO  o.h.f.d.h.v.DefaultProfileValidationSupport - Loading structure definitions from classpath: /org/hl7/fhir/instance/model/dstu3/profile/profiles-types.xml
06:46:04.188 [main] INFO  o.h.f.d.h.v.DefaultProfileValidationSupport - Loading structure definitions from classpath: /org/hl7/fhir/instance/model/dstu3/profile/profiles-others.xml
</pre></div>



<a name="153855289"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855289" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855289">(Nov 03 2016 at 11:13)</a>:</h4>
<p>Thank you James for the timely response..<br>
I am using HAPI 1.4 and DSTU2 in place. It is found that profile resources are spread among many XML files than the three mentioned above in DSTU3  It seems the mistake which I have done that each time new instance of the validator is initiated. I ll have a detailed look into this and let you know the root cause..</p>



<a name="153855298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855298">(Nov 03 2016 at 11:27)</a>:</h4>
<p>Sounds good.</p>
<p>If at all possible, I'd also recommend looking at upgrading HAPI to the latest version (2.0). HAPI FHIR 2.0 still supports the exact same FHIR structures for DSTU2 but has lots of fixes including performance fixes that may help you.</p>



<a name="153855633"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855633" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jasmine Ameerdeen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855633">(Nov 06 2016 at 09:17)</a>:</h4>
<p>Actually, DefaultProfileValidationSupport instance is created every time the FhirResourceDaoDstu2.validate() is invoked. May be this is causing the issue.</p>
<div class="codehilite"><pre>    FhirInstanceValidator val = new FhirInstanceValidator();
    val.setBestPracticeWarningLevel(BestPracticeWarningLevel.Warning);
    val.setValidationSupport(new ValidationSupportChain(new DefaultProfileValidationSupport(), myJpaValidationSupport));
    validator.registerValidatorModule(val);
</pre></div>


<p>Is it okay to autowire this instance?</p>



<a name="153855638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Performance%20as%20FHIR%20server/near/153855638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Performance.20as.20FHIR.20server.html#153855638">(Nov 06 2016 at 12:49)</a>:</h4>
<p>Oh yeah, you definitely want to keep a single instance of that class loaded and reuse it. That will certainly cause bad performance otherwise.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
