---
layout: page
title: "FHIR Chat  · JPA starter - Lucine + Postgres · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/JPA.20starter.20-.20Lucine.20.2B.20Postgres.html">JPA starter - Lucine + Postgres</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="259863303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/JPA%20starter%20-%20Lucine%20%2B%20Postgres/near/259863303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mauricio Burgos Herrera <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/JPA.20starter.20-.20Lucine.20.2B.20Postgres.html#259863303">(Nov 01 2021 at 13:30)</a>:</h4>
<p>I'm want to use the JPA starter server among other things to make use of the terminology service. In the environment (Kubernetes on google cloud) that I'm working on we have a managed Postgres database but not Elasticsearch. In order to support some of the features of the terminology service without having to support an Elasticsearch cluster, I would like to deploy multiple instances of the JPA starter server all connected to the Postgres database and each using lucine with local file.<br>
I've tested the setup locally using docker compose. Importing a CodeSystem and creating a ValueSet works fine, but when I try to <code>$expand</code> the ValueSet I don't get any codes back.</p>
<p>Does anyone has experience with this setup? would this even work?</p>



<a name="260167137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/JPA%20starter%20-%20Lucine%20%2B%20Postgres/near/260167137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/JPA.20starter.20-.20Lucine.20.2B.20Postgres.html#260167137">(Nov 03 2021 at 17:17)</a>:</h4>
<p>I haven't tried that in a while, but it does not work in my experience. The local Lucene index is only updated by operations that occur on that specific node, so if something happens on a different node the next request on the original node works against an outdated index. That has implications for things like search result caching, for example.</p>



<a name="260167364"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/JPA%20starter%20-%20Lucine%20%2B%20Postgres/near/260167364" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/JPA.20starter.20-.20Lucine.20.2B.20Postgres.html#260167364">(Nov 03 2021 at 17:19)</a>:</h4>
<p>There are a couple managed solutions for Elastic on GCP, but if you have a Kubernetes cluster you could always roll your own deployment.</p>



<a name="260272456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/JPA%20starter%20-%20Lucine%20%2B%20Postgres/near/260272456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mauricio Burgos Herrera <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/JPA.20starter.20-.20Lucine.20.2B.20Postgres.html#260272456">(Nov 04 2021 at 13:56)</a>:</h4>
<p>Thanks for the reply! Indeed I've found that the server uses hibernate search internally which behaves as you describe (<a href="https://docs.jboss.org/hibernate/search/6.0/reference/en-US/html_single/#gettingstarted-dependencies">https://docs.jboss.org/hibernate/search/6.0/reference/en-US/html_single/#gettingstarted-dependencies</a>)</p>
<p>In my use-case using h2 + lucine is good enough. To prevent rebuilding the server after every deployment and not depending on elasticsearch, I'm creating an multi-stage image that starts the server loads the terminologies / value sets, and then copies the database files to the final image that we will run in kubernetes :)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
