---
layout: page
title: "FHIR Chat  · HL7v2 Parsing · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html">HL7v2 Parsing</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="226555701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226555701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226555701">(Feb 16 2021 at 18:32)</a>:</h4>
<p>I'm using the HAPI V25structures to parse HL7v2 message &amp; convert that into FHIR resources. I'm facing a strange issue while receiving and parsing the HL7V2 message using HAPI via TCP listener.</p>
<div class="codehilite"><pre><span></span><code>&quot;Determine encoding for message. The following is the first 50 chars of the message for reference, although this may not be where the issue is: MSH|^~\\&amp;|OPENEMR|DrJhonDoe|TEST|UNKNOWN|20210216190432||ADT^A01^ADT_A01|60b647d4-b5a5-4fae-a928-d4a3849de3c8|T|2.5&quot;
</code></pre></div>
<p>Strange that I'm not getting this error when I'm trying to send this message as a string in main function. I'm getting this error only when I send the data over TCP to my Java function.</p>
<p>Here is my Java pgm:</p>
<div class="codehilite"><pre><span></span><code>public static String getPv1SegmentData(String hl7Message) throws HL7Exception {
        String hl7RoomConfiguration = &quot;&quot;;
        try {
// Im just reading the mapping from another config json
        String getHl7ConfigFromFile     = HL7HelperFunction.readHl7ConfigFromFile(&quot;Config.json&quot;);
        String getGqlPath               = getHl7ConfigFromFile.split(&quot;,&quot;)[3].toString();
        HapiContext context             = new DefaultHapiContext();
        context.getParserConfiguration().setValidating(false);
        CanonicalModelClassFactory mcf  = new CanonicalModelClassFactory(&quot;2.5&quot;);
        context.setModelClassFactory(mcf);
        PipeParser parser               = context.getPipeParser();
// Till this it works fine

// this is the portion where its causing error
        ADT_A01 v25Message              = (ADT_A01) parser.parse(hl7Message);
        Terser t25                      = new Terser(v25Message);
        String getPid                   = t25.get(&quot;/.&quot;+getHl7ConfigFromFile.split(&quot;,&quot;)[0]);
        String getBed                   = t25.get(&quot;/.&quot;+getHl7ConfigFromFile.split(&quot;,&quot;)[1]);
        String getRoom                  = t25.get(&quot;/.&quot;+getHl7ConfigFromFile.split(&quot;,&quot;)[2]);
        String getBuilding              = t25.get(&quot;/.&quot;+getGqlPath.split(&quot;/&quot;)[1]);
        String getFloor                 = t25.get(&quot;/.&quot;+getGqlPath.split(&quot;/&quot;)[2]);
        String getFacility              = t25.get(&quot;/.&quot;+getGqlPath.split(&quot;/&quot;)[0]);
        // Parse HL7 and create String
        hl7RoomConfiguration = &quot;Bed:&quot;+getBed+&quot;@&quot;+&quot;Room:&quot;+getRoom+&quot;@&quot;+&quot;Building:&quot;+getBuilding+&quot;@&quot;+&quot;Floor:&quot;+getFloor+&quot;@&quot;+&quot;Facility:&quot;+getFacility+&quot;@&quot;+&quot;PID:&quot;+getPid;

        System.out.println(hl7RoomConfiguration);

        }catch(Exception e) {
            System.out.println(&quot;get Exception --&gt;&quot;+e);
        }
        return hl7RoomConfiguration;
    }
</code></pre></div>



<a name="226608435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226608435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226608435">(Feb 17 2021 at 03:10)</a>:</h4>
<p>While receiving the message from the tcp source. Im converting it to string using the UTF-8 character</p>



<a name="226608450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226608450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226608450">(Feb 17 2021 at 03:11)</a>:</h4>
<div class="codehilite"><pre><span></span><code>InputStream in = connection.getInputStream();
OutputStream out = connection.getOutputStream();
receivedMessageSize = in.read(receivedByeBuffer);
String incomingHl7Message = new String(receivedByeBuffer, StandardCharsets.UTF_8);
</code></pre></div>



<a name="226612944"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226612944" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226612944">(Feb 17 2021 at 04:36)</a>:</h4>
<p>MSH|^~\\...</p>
<p>I'm a totally a newbie for this. Are the duplicate slash right? Ignore my response if yes.</p>



<a name="226613029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226613029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226613029">(Feb 17 2021 at 04:37)</a>:</h4>
<p>yes. java throws  error with single \</p>



<a name="226613079"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226613079" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226613079">(Feb 17 2021 at 04:38)</a>:</h4>
<p>OK</p>



<a name="226613116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226613116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226613116">(Feb 17 2021 at 04:39)</a>:</h4>
<p>i ve posted in stackoverflow too. got 4 upvotes seems like many people problem</p>
<p><a href="https://stackoverflow.com/questions/66230745/hl7v2-hapi-parser-exception-while-receiving-data-via-tcp-ip">https://stackoverflow.com/questions/66230745/hl7v2-hapi-parser-exception-while-receiving-data-via-tcp-ip</a></p>



<a name="226615377"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226615377" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226615377">(Feb 17 2021 at 05:22)</a>:</h4>
<p>What if you use other people's example message(s), e.g.: <a href="http://www.ringholm.com/docs/04300_en.htm">http://www.ringholm.com/docs/04300_en.htm</a></p>



<a name="226617082"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226617082" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226617082">(Feb 17 2021 at 06:01)</a>:</h4>
<p>Same error for all messages</p>



<a name="226763136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226763136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226763136">(Feb 18 2021 at 04:22)</a>:</h4>
<p>I identified the issue. it is because of getting &lt;VT&gt; and &lt;FS&gt; only. When receiving data via normal Basic TCP I am not getting this issue. But this issue I am getting only when receiving the data through MLLP &amp; I couldn't find a better way to handle this characters in the incoming Bytes on  JAVA.</p>



<a name="226811402"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226811402" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226811402">(Feb 18 2021 at 13:46)</a>:</h4>
<p>A related page:</p>
<p>These headers and trailers are usually non-printable characters that would not typically be in the content of HL7 messages. The header is a vertical tab character &lt;VT&gt; its hex value is 0x0b. The trailer is a file separator character &lt;FS&gt; (hex 0x1c) immediately followed by a carriage return &lt;CR&gt; (hex 0x0d)...</p>
<p><a href="http://healthstandards.com/blog/2007/05/02/hl7-mlp-minimum-layer-protocol-defined/">http://healthstandards.com/blog/2007/05/02/hl7-mlp-minimum-layer-protocol-defined/</a></p>



<a name="226812016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226812016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226812016">(Feb 18 2021 at 13:51)</a>:</h4>
<p>Another one:</p>
<p><a href="https://www.c-sharpcorner.com/article/sending-an-hl7-message-receiving-it-using-a-listener-and-sending-an-acknowledge/">https://www.c-sharpcorner.com/article/sending-an-hl7-message-receiving-it-using-a-listener-and-sending-an-acknowledge/</a></p>



<a name="226812706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/226812706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#226812706">(Feb 18 2021 at 13:56)</a>:</h4>
<p>A Java based Tutorial:</p>
<p>Step 4&amp;5&amp;6 of 8 - transmit/parse a dummy MLLP-wrapped HL7 message</p>
<p><a href="https://saravanansubramanian.com/hl72xjavaprogramming/">https://saravanansubramanian.com/hl72xjavaprogramming/</a></p>



<a name="229632070"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/229632070" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#229632070">(Mar 10 2021 at 10:10)</a>:</h4>
<p>This is more complicated than we thought. One can definitely understand that HL7v2 over tcp dont  behave same as MLLP.MLLP is a frame level protocol You can also see in the last link that he is trying to read as input stream. Which is not possible. We need to read MLLP message special way. Wondering if there is a HAPI code of Version 2 that allows to  read input stream</p>



<a name="230290085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/230290085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#230290085">(Mar 15 2021 at 03:20)</a>:</h4>
<p>One way of handling this is using the MLLPMinLowLayer() from HAPI</p>



<a name="230290123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HL7v2%20Parsing/near/230290123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vibin_chander <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HL7v2.20Parsing.html#230290123">(Mar 15 2021 at 03:21)</a>:</h4>
<p>But if the connection is kept open on the sender side you will still face issue</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
