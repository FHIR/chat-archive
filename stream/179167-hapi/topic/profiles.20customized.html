---
layout: page
title: "FHIR Chat  · profiles customized · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html">profiles customized</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153858566"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153858566" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153858566">(Nov 27 2016 at 04:45)</a>:</h4>
<p>Hi James,<br>
As observed from the devdays, I tried to customize the patient resource type for Oman needs. Further, I was able to upload the definition to HAPI server, but data upload fails. How can I specify OmanPatient instead of Patient in the resource type? Is it required to make OmanPatient as an inherited class in HAPI server ?</p>



<a name="153858572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153858572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153858572">(Nov 27 2016 at 08:22)</a>:</h4>
<p>I have noticed MyOrganization under restful-server-example which is inherited from Organization. Further  OrganizationResourceProvider class is available to read data corresponding to MyOrganization. Is it part of the custom profiles? Do we need to implement the similar to manage custom profiles like OmanPatient? </p>



<a name="153858573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153858573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153858573">(Nov 27 2016 at 08:35)</a>:</h4>
<p>Following documentation is found out in HAPI .. Please confirm the way I can define the custom profiles.. <br>
Sometimes you may not know in advance exactly which type you will be receiving. For example, there are Patient resources which conform to several different profiles on a server and you aren't sure which profile you will get back for a specific read, you can declare the "primary" type for a given profile.</p>
<p>This is declared at the FhirContext level, and will apply to any clients created from this context (including clients created before the default was set).<br>
FhirContext ctx = FhirContext.forDstu3();</p>
<p>// Instruct the context that if it receives a resource which<br>
// claims to conform to the given profile (by URL), it should<br>
// use the MyPatient type to parse this resource<br>
ctx.setDefaultTypeForProfile("<a href="http://example.com/StructureDefinition/mypatient" target="_blank" title="http://example.com/StructureDefinition/mypatient">http://example.com/StructureDefinition/mypatient</a>", MyPatient.class);</p>
<p>// You can declare as many default types as you like<br>
ctx.setDefaultTypeForProfile("<a href="http://foo.com/anotherProfile" target="_blank" title="http://foo.com/anotherProfile">http://foo.com/anotherProfile</a>", CustomObservation.class);</p>
<p>// Create a client<br>
IGenericClient client = ctx.newRestfulGenericClient("<a href="http://fhirtest.uhn.ca/baseDstu3" target="_blank" title="http://fhirtest.uhn.ca/baseDstu3">http://fhirtest.uhn.ca/baseDstu3</a>");</p>
<p>// You can also read the resource back like normal<br>
Patient patient = client.read().resource(Patient.class).withId("123").execute();<br>
if (patient instanceof MyPatient) {<br>
   // If the server supplied a resource which declared to conform<br>
   // to the given profile, MyPatient will have been returned so<br>
   // process it differently..<br>
}</p>



<a name="153858664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153858664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153858664">(Nov 28 2016 at 09:32)</a>:</h4>
<p>I am continuing my effort to upload the DutchPatient profile to HAPI server.. the following error occured..<br>
Resource ValueSet/identifier-use not found, specified in path: StructureDefinition.snapshot.element.binding.valueSet[X].<br>
<span class="user-mention" data-user-id="191319">@James Agnew</span> , Can you please advise..</p>



<a name="153858665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153858665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153858665">(Nov 28 2016 at 09:34)</a>:</h4>
<p>I was not able to publish the structure definition of the profile from the Forge tool, instead I tried using HAPI interface itself .. using the CRUD operations. </p>



<a name="153859092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153859092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153859092">(Nov 30 2016 at 02:59)</a>:</h4>
<p>Hi Binu,</p>
<p>Just to confirm, you have created a DSTU2 profile in Forge and you are seeing this issue when uploading the profile to your JPA server instance, or when validating a resource against it?</p>
<p>FYI,  you don't need to generate any HAPI classes in order to do the type of validation you're looking to do. It should be possible to upload the profile definition to HAPI's server and then validate based on that. I will caution you that the validator in DSTU2 is not as powerful as the validator in DSTU3. If you have advanced validation requirements it is sometimes easier to simply code them in Java code and enforce them via an interceptor instead of relying on the native validator.</p>
<p>This situation is a great deal better in STU3 though, the validator works very well on that version.</p>



<a name="153859136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153859136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153859136">(Nov 30 2016 at 07:55)</a>:</h4>
<p>Thank you James for the detailed reply..<br>
What you said is true.. I am trying to upload the profile to JPA server instance and basically trying to apply some constraints ..<br>
I was able to upload the same into public HAPI server with out any issue, please note the following link. <br>
<a href="http://fhirtest.uhn.ca/baseDstu2/StructureDefinition/DutchPatient" target="_blank" title="http://fhirtest.uhn.ca/baseDstu2/StructureDefinition/DutchPatient">http://fhirtest.uhn.ca/baseDstu2/StructureDefinition/DutchPatient</a><br>
Is it the right way to upload the profile? If so, issue is in my HAPI server configuration which I have to trace..</p>
<p>But corresponding to the last element, placeOfBirth is an extension corresponding to which I could not send a value using FHIR message.<br>
Is that means the profile is not verified as expected?</p>



<a name="153859137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153859137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153859137">(Nov 30 2016 at 07:59)</a>:</h4>
<p>I have tried the following FHIR message against the DutchPatient profile..<br>
{<br>
  "resourceType": "Patient",<br>
  "id": "67.20068.14731",<br>
  "meta": {<br>
    "versionId": "1",<br>
    "lastUpdated": "2016-11-30T02:18:24.929-05:00",<br>
    "profile": [<br>
      "<a href="http://example.org/fhir/StructureDefinition/DutchPatient" target="_blank" title="http://example.org/fhir/StructureDefinition/DutchPatient">http://example.org/fhir/StructureDefinition/DutchPatient</a>"<br>
    ]<br>
  },<br>
  "text": {<br>
    "status": "generated",<br>
    "div": "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;div class=\"hapiHeaderText\"&gt; GHASIYA &lt;b&gt;AL WAHEIBI &lt;/b&gt;&lt;/div&gt;&lt;table class=\"hapiPropertyTable\"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Identifier&lt;/td&gt;&lt;td&gt;14731&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Date of birth&lt;/td&gt;&lt;td&gt;&lt;span&gt;01 January 1981&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;"<br>
  },<br>
  "identifier": [<br>
    {<br>
      "value": "14731",<br>
      "period": {<br>
        "start": "2005-03-15"<br>
      }<br>
    }<br>
  ],<br>
  "active": false,<br>
  "name": [<br>
    {<br>
      "family": [<br>
        "AL WAHEIBI"<br>
      ],<br>
      "given": [<br>
        "GHASIYA"<br>
      ]<br>
    }<br>
  ],<br>
  "gender": "female",<br>
  "birthDate": "1981-01-01",<br>
  "deceasedBoolean": true,<br>
  "address": [<br>
    {<br>
      "use": "home"<br>
    }<br>
  ],<br>
  "placeOfBirth" : { <br>
    "url" : "<a href="http://hl7.org/fhir/StructureDefinition/birthPlace" target="_blank" title="http://hl7.org/fhir/StructureDefinition/birthPlace">http://hl7.org/fhir/StructureDefinition/birthPlace</a>",<br>
    "valueString": "Narakal"<br>
  }</p>
<p>}</p>



<a name="153859141"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153859141" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153859141">(Nov 30 2016 at 08:12)</a>:</h4>
<p>In the above message, following element is not accepted<br>
"placeOfBirth" : { <br>
"url" : "<a href="http://hl7.org/fhir/StructureDefinition/birthPlace" target="_blank" title="http://hl7.org/fhir/StructureDefinition/birthPlace">http://hl7.org/fhir/StructureDefinition/birthPlace</a>",<br>
"valueString": "Narakal"<br>
}</p>



<a name="153859579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153859579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153859579">(Dec 01 2016 at 08:11)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> <br>
I am able to upload a test patient profile which is attached here by into the public test HAPI server and able to validate against even the extension added. But when I upload into my local HAPI server, I am getting the following error..<br>
Error: HTTP 400 Bad Request: Resource ValueSet/administrative-gender not found, specified in path: StructureDefinition.snapshot.element.binding.valueSet[x]</p>
<p>I do understand that, it is the verification on the valuset uri, but I would like to know how it is bypassed in the public test server?</p>
<p><a href="/user_uploads/10155/Wd8pWT8dsYhoTV-sZ7f1XG5N/TestPatient.structuredefinition.xml" target="_blank" title="TestPatient.structuredefinition.xml">TestPatient.structuredefinition.xml</a> </p>



<a name="153859625"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153859625" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153859625">(Dec 01 2016 at 16:51)</a>:</h4>
<p>Hi Binu,</p>
<p>Let me have a look if I can replicate your issue with uploading the testpatient profile here locally.</p>
<p>One thing to note, your syntax isn't quite right on that placeofbirth extension. FHIR's extension syntax in JSON should look more like this:</p>
<div class="codehilite"><pre>&quot;extension&quot; : [
{ 
&quot;url&quot; : &quot;http://hl7.org/fhir/StructureDefinition/birthPlace&quot;,
&quot;valueString&quot;: &quot;Narakal&quot;
}
]
</pre></div>



<a name="153859626"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153859626" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153859626">(Dec 01 2016 at 16:51)</a>:</h4>
<p>..which could go in the exact same place in the resource where you have</p>
<div class="codehilite"><pre>&quot;placeOfBirth&quot; : { 
&quot;url&quot; : &quot;http://hl7.org/fhir/StructureDefinition/birthPlace&quot;,
&quot;valueString&quot;: &quot;Narakal&quot;
}
</pre></div>



<a name="153859629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153859629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153859629">(Dec 01 2016 at 17:30)</a>:</h4>
<p>Ok, I'm a bit confused now. I am not able to replicate your issue... I did the following:</p>
<p>1. Create a local server based on the jpaserver-example project<br>
2. Upload your <code>TestPatient.structuredefinition.xml</code> to this server<br>
3. Validate the example Patient with id <code>67.20068.14731</code> that you posted above by POSTing it to <code>http://localhost:8080/hapi-fhir-jpaserver-example/baseDstu2/Patient/$validate</code></p>
<p>The test patient had a couple of JSON syntax error I had to fix, and the profile URL doesn't actually match (TestPatient vs. DutchPatient) but once I fixed those things it validated correctly. There were some validation issues, but nothing about missing valuesets, just normal problems with the patient resource's conformance to that profile</p>
<p>How does this compare to what you're trying to do?</p>



<a name="153860133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153860133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153860133">(Dec 04 2016 at 04:14)</a>:</h4>
<p>Sorry for belated response.. I was bit away.. syntax of the extension is corrected and I could upload the same into the public HAPI.<br>
Right now my issue is only on the first part, getting valueset error while uploading the Structure definition TestPatient.Structuredefinition.xml.</p>
<p>Exactly I am getting 400 Bad Request after the value set warning.. please note the following message</p>
<p>Warning!<br>
Error: HTTP 400 Bad Request: Resource ValueSet/administrative-gender not found, specified in path: StructureDefinition.snapshot.element.binding.valueSet[x]</p>



<a name="153860159"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153860159" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153860159">(Dec 04 2016 at 06:22)</a>:</h4>
<p>Please note the following in my new local server..<br>
Warning!<br>
Error: HTTP 400 Bad Request: Resource contains external reference to URL "<a href="http://hl7.org/fhir/ValueSet/administrative-gender" target="_blank" title="http://hl7.org/fhir/ValueSet/administrative-gender">http://hl7.org/fhir/ValueSet/administrative-gender</a>" but this server is not configured to allow external references</p>



<a name="153860180"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153860180" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153860180">(Dec 04 2016 at 08:27)</a>:</h4>
<p>Please not the following statements about DaoConfig<br>
@Bean()<br>
public DaoConfig daoConfig() {<br>
    DaoConfig retVal = new DaoConfig();<br>
    retVal.setAllowMultipleDelete(true);<br>
<strong>retVal.setAllowInlineMatchUrlReferences(true);</strong> <br>
    return retVal;<br>
}</p>
<p>What is the purpose of "setAllowInlineMatchUrlReferences(true)"?</p>



<a name="153860607"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153860607" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153860607">(Dec 05 2016 at 11:40)</a>:</h4>
<p>That setting allows you to include search strings in references within a resource within a transaction, it's probably not the one you want.</p>
<p>You're looking for </p>
<div class="codehilite"><pre>retVal.setAllowExternalReferences(true);
</pre></div>



<a name="153860652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/profiles%20customized/near/153860652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Binu DGIT <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/profiles.20customized.html#153860652">(Dec 05 2016 at 13:19)</a>:</h4>
<p>That is very much true.. I have fixed the issue .. Thanks</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
