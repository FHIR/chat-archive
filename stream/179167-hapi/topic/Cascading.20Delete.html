---
layout: page
title: "FHIR Chat  · Cascading Delete · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html">Cascading Delete</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="169261465"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169261465" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169261465">(Jun 28 2019 at 20:57)</a>:</h4>
<p>Hi All,</p>
<p>So, lots of people have been asking for a cascading delete function in HAPI FHIR lately ( <span class="user-mention" data-user-id="191372">@René Spronk</span>  <span class="user-mention" data-user-id="191505">@Sean McIlvenna</span> <span class="user-mention" data-user-id="191321">@David Hay</span> ).. This is now available on the public HAPI FHIR server, and will be available as an optional interceptor in the JPA server by this weekend.</p>
<p>Do do a cascading delete, add <code>_cascade=true</code> do your HTTP DELETE URL.</p>



<a name="169262697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169262697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169262697">(Jun 28 2019 at 21:12)</a>:</h4>
<p>Cool! And the CLI?</p>



<a name="169265147"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169265147" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169265147">(Jun 28 2019 at 21:47)</a>:</h4>
<p>Is that standard FHIR, or a HAPI extra?</p>



<a name="169282759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169282759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169282759">(Jun 29 2019 at 05:23)</a>:</h4>
<p>Thanks - just as a point of clarification: if used on e.g. Encounter/123, this would delete the encounter as well as any resources referencing the encounter, expanding the tree to anything that somewhere in the tree structure directly or indirectly references Encounter/123?</p>



<a name="169342374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169342374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169342374">(Jun 30 2019 at 14:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191321">@David Hay</span> - Yup it'll be supported in the CLI<br>
<span class="user-mention" data-user-id="195344">@Paul Lynch</span> - This is a HAPI specific feature. I think HAPI is one of the few that enforces referential integrity in the first place so most wouldn't need this feature anyhow.<br>
<span class="user-mention" data-user-id="191372">@René Spronk</span> - That's how it should work, yup. Definitely welcome any feedback if it's not doing what you expect.</p>



<a name="169342445"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169342445" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169342445">(Jun 30 2019 at 14:45)</a>:</h4>
<p>Oh, and this has been merged to master not for anyone who wants to try it on their own server - This is the interceptor in question: <a href="https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/interceptor/CascadingDeleteInterceptor.java" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/interceptor/CascadingDeleteInterceptor.java">https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/interceptor/CascadingDeleteInterceptor.java</a></p>
<p>Man, I can not tell you how much I love the new interceptor framework. It is so cool for this kind of thing. We have Ken Stevens to thank for most of the hard work on this feature.</p>



<a name="169377310"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169377310" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169377310">(Jul 01 2019 at 08:33)</a>:</h4>
<p>Postman, trying to exec DELETE <a href="http://hapi.fhir.org/baseDstu3/Patient?identifier=1020304050&amp;_cascade=true" target="_blank" title="http://hapi.fhir.org/baseDstu3/Patient?identifier=1020304050&amp;_cascade=true">http://hapi.fhir.org/baseDstu3/Patient?identifier=1020304050&amp;_cascade=true</a> - error 409 Conflict, OperationOutcome states "Trying to delete Condition/1686707/_history/1 but this is not the current version"</p>



<a name="169409053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169409053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169409053">(Jul 01 2019 at 16:20)</a>:</h4>
<p>Ah thanks for letting me know, will investigate.</p>
<p>FYI I have changed the syntax slightly, so you now need to do <code>_cascade=delete</code> (not <code>true</code>). It occurs to me that there are plenty of other behaviours that might also make sense, so a more flexible syntax is better, even if we only support one option right now.</p>



<a name="169466801"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169466801" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169466801">(Jul 02 2019 at 09:41)</a>:</h4>
<p><span class="user-mention" data-user-id="191372">@René Spronk</span> This bug has been (hopefully) fixed</p>



<a name="169467489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169467489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169467489">(Jul 02 2019 at 09:53)</a>:</h4>
<p>Works like a charm. Side observation during testing: using a GET for Patient?_tag=http://www.alpha.alp/use-case| (i.e. no code supplied) produces an error - can't search for 'any tag from a particular coding system' , code is mandatory. Why is that?</p>



<a name="169467714"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169467714" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169467714">(Jul 02 2019 at 09:57)</a>:</h4>
<p>We don't have indexes in the DB to support that search, nothing more interesting than that. Could definitely add if there is a usecase.</p>



<a name="169468707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Cascading%20Delete/near/169468707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Cascading.20Delete.html#169468707">(Jul 02 2019 at 10:13)</a>:</h4>
<p>No particular use case here - during FHIR training courses we ask people to update the patient name in an instance example, and sometimes they modify the tag-value as well (it has the same value as the patients' given name). But there are different ways of dealing with that issue when deleting these training resources from the public test servers (mostly either HAPI or Vonk for the STU3 exercises, we'll reselect the appropriate open test servers for our R4 exercises which we'll start using this September, I'm fairly sure HAPI and Vonk will still be part of our list though - especially now that cleaning up has gotten easier on HAPI than it was before).</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
