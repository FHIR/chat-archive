---
layout: page
title: "FHIR Chat  · etags · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html">etags</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153870957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153870957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153870957">(Feb 10 2017 at 02:40)</a>:</h4>
<p>(Related question to my previous one) If I'm writing a resource provider, is it possible to set an ETag on the response I'm providing to a search? Or an operation? And if so, how do I do that?</p>



<a name="153871101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153871101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153871101">(Feb 11 2017 at 21:04)</a>:</h4>
<p>The server should automatically set the ETag based on the resource version being returned from a read/vread, but I believe it doesn't set it otherwise.</p>



<a name="153871158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153871158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153871158">(Feb 12 2017 at 23:16)</a>:</h4>
<p>Yeah, I'm implementing a server and hoping to set my own ETags (so I can then respect them if they come back in If-None-Match), to support caching</p>



<a name="153871166"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153871166" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153871166">(Feb 13 2017 at 04:46)</a>:</h4>
<p>not the difference between weak and strong etags. FHIR Etags are *nearly* strong etags, but not actually strong. W3C might have redefined strong etags based on our comments, but it's too late now</p>



<a name="153871268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153871268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153871268">(Feb 13 2017 at 21:01)</a>:</h4>
<p>Hmm, interesting..</p>
<p>I'd assume you could achieve this by having your RP methods include parameters of type <code>HttpServletRequest</code> and <code>HttpServletResponse</code>. If you wanted to return a 304 on an arbitrary method, you could create a new exception that extends <code>BaseServerResponseException</code> with a code of 304 and throw that.</p>
<p>I believe this should all work, although I have admittedly not tried it.</p>



<a name="153871481"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153871481" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153871481">(Feb 14 2017 at 23:41)</a>:</h4>
<p>304 on an arbitrary operation is easy. I just throw a ca.uhn.fhir.rest.server.exceptions.NotModifiedException</p>



<a name="153871497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153871497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153871497">(Feb 15 2017 at 01:46)</a>:</h4>
<p>Ah right, I forgot that already existed. :)</p>
<p>So although I haven't seen anyone do it before, what you're doing certainly sounds sensible.. and seems like it should be possible without needing changes to the library.</p>



<a name="153871508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153871508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153871508">(Feb 15 2017 at 02:26)</a>:</h4>
<p>Yeah, I seem to be getting what I need by including request/response as parameters in my RP methods. I'm not sure if the ETags generated for non-reads are things we want to include in the spec. They vary between simple (e.g. for $lookup I'm just using versions of resources, like reads), and not so simple (e.g. $expand or $validate-code)</p>



<a name="153871513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/etags/near/153871513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/etags.html#153871513">(Feb 15 2017 at 02:30)</a>:</h4>
<p>There is a requirement on 304 responses, though, that it should return all the cache-related headers (ETag, Content-Location, Expires, Cache-Control, Vary), that a non-304 response would have returned. I have a vague suspicion that some of these may not be coming through, but when I get to that, if I find any issues I'll flag them on GitHub.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
