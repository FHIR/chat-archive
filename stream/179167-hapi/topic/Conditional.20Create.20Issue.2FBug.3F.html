---
layout: page
title: "FHIR Chat  · Conditional Create Issue/Bug? · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Conditional.20Create.20Issue.2FBug.3F.html">Conditional Create Issue/Bug?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="238468352"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Conditional%20Create%20Issue/Bug%3F/near/238468352" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Conditional.20Create.20Issue.2FBug.3F.html#238468352">(May 12 2021 at 12:56)</a>:</h4>
<p>I have an identifier in an Observation resource that looks as follows:</p>
<div class="codehilite"><pre><span></span><code>                &quot;identifier&quot;: [
                    {
                        &quot;value&quot;: &quot;B4E782FFFF4B4A10-VL-testing-Ren-urn:oid:2.2.2.333-150364-41.34-6048-20210427133226.444+0800&quot;
                    }
                ]
</code></pre></div>
<p>The search on this identifier works fine. However, when I have a Conditional Create in a transaction bundle</p>
<div class="codehilite"><pre><span></span><code>            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;,
                &quot;url&quot;: &quot;Observation&quot;,
                &quot;ifNoneExist&quot;: &quot;identifier=B4E782FFFF4B4A10-VL-testing-Ren-urn:oid:2.2.2.333-150364-41.34-6048-20210427133226.444+0800&quot;
            }
</code></pre></div>
<p>It does not work and now I have multiple resources with identical content loaded on the server.</p>
<p>However, if my resource has a 'system' entry as well as a 'value' entry, then the conditional create works. Am I doing something wrong?</p>
<p>Just in case the problem is due to the lack of a system field I added one to the identifier, gave it a constant value, and added that to the conditional create so it mirrored the Device case. It still failed to work.</p>



<a name="238752851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Conditional%20Create%20Issue/Bug%3F/near/238752851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Conditional.20Create.20Issue.2FBug.3F.html#238752851">(May 14 2021 at 11:36)</a>:</h4>
<p>Turns out (thanks James Agnew) that my identifier has a '+' sign in it which is okay but when used in the URL of the 'ifNoneExist' field,  the '+' sign needs to be escaped. I did not know this but there are two ways to escape a 'space' in a URL, the common %20 but also a '+' sign. Since I did not escape the plus sign, HAPI FHIR decoded the URL and the '+' sign became a 'space'. Thus the conditional create did not find such an identifier.</p>
<p>The solution was to escape the '+' sign (%2B).</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
