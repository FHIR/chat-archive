---
layout: page
title: "FHIR Chat  · xml entity error · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/xml.20entity.20error.html">xml entity error</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153942040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/xml%20entity%20error/near/153942040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/xml.20entity.20error.html#153942040">(Mar 04 2018 at 12:53)</a>:</h4>
<p>I'm experiencing an error round-tripping the example json resources (parse, then encode to string, then parse again), that seems to be to do with xml entities in the narrative:</p>
<p>code: <a href="https://pastebin.com/raw/PWETu8v5" target="_blank" title="https://pastebin.com/raw/PWETu8v5">https://pastebin.com/raw/PWETu8v5</a><br>
error: <a href="https://pastebin.com/raw/CRDN9JWD" target="_blank" title="https://pastebin.com/raw/CRDN9JWD">https://pastebin.com/raw/CRDN9JWD</a></p>
<p>There's a literal unicode <code>©</code> character in the original, which is converted to a <code>&amp;copy</code> entity on the initial parse.  That entity is then written out when encoding, and causes the error on the second parse.</p>
<p>The problem appears to have been introduced between 3.0.0 and 3.1.0.</p>



<a name="153942041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/xml%20entity%20error/near/153942041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/xml.20entity.20error.html#153942041">(Mar 04 2018 at 13:03)</a>:</h4>
<p>Guessing this is relevant?</p>
<div class="codehilite"><pre><span></span>/**
 * Note that as of HAPI FHIR 3.1.0, this method no longer uses
 * the StAX XMLEvent type as the XML representation, and uses a
 * String instead. If you need to work with XML as StAX events, you
 * can use the {@link XmlUtil#parse(String)} and {@link XmlUtil#encode(List)}
 * methods to do so.
 */
</pre></div>



<a name="153942054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/xml%20entity%20error/near/153942054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/xml.20entity.20error.html#153942054">(Mar 04 2018 at 14:41)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="193659">@Ben Spencer</span>, StAX is still used for validation but possibly that is related. I notice in your stack trace that it's using Xerces. The first thing I would try it adding Woodstox to your classpath- Xerces is just awful as an XML provider. You should see a line similar to the following when HAPI first starts:</p>
<div class="codehilite"><pre><span></span>09:39:05.201 [main] INFO  ca.uhn.fhir.util.XmlUtil [DependencyLogImpl.java:75] - FHIR XML procesing will use StAX implementation &#39;Woodstox XML-processor&#39; version &#39;4.4.1&#39;
</pre></div>



<a name="153942055"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/xml%20entity%20error/near/153942055" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/xml.20entity.20error.html#153942055">(Mar 04 2018 at 14:45)</a>:</h4>
<p>hi <span class="user-mention" data-user-id="191319">@James Agnew</span> , that seems to have fixed it, thanks</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
