---
layout: page
title: "FHIR Chat  · Validation with a Profile · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html">Validation with a Profile</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="217747577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217747577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Håkan MacLean <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217747577">(Nov 24 2020 at 12:40)</a>:</h4>
<p>Hi! I must be missing something fundamental here, but I've tried to follow the tutorial to try validation against a published profile, but I just can't get it to work. I have tried adding the profile both in the Resource and to the validator (I'm guessing you should only need to do one of them). This is my code:</p>
<div class="codehilite"><pre><span></span><code>MedicationRequest rx =
    new MedicationRequest()
        .setSubject(new Reference(&quot;subject_id&quot;))
        .setStatus(MedicationRequest.MedicationRequestStatus.ACTIVE);
rx.setMeta(
    new Meta()
        .addProfile(              &quot;https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075&quot;));
FhirContext ctx = FhirContext.forR4();
FhirValidator validator = ctx.newValidator();
IValidatorModule module = new FhirInstanceValidator(ctx);
validator.registerValidatorModule(module);
ValidationOptions validationOptions = new ValidationOptions().addProfile(&quot;http://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075&quot;);
ValidationResult result = validator.validateWithResult(rx, validationOptions);
if (!result.isSuccessful()) {
  result.getMessages().forEach(msg -&gt; System.out.println(msg.getMessage()));
}
Assert.assertTrue(result.isSuccessful());
</code></pre></div>

<p>And the output is:<br>
Profile reference '<a href="https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a>' could not be resolved, so has not been checked</p>
<p>I have tried using another profile as well with the same result.</p>



<a name="217802773"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217802773" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217802773">(Nov 24 2020 at 19:31)</a>:</h4>
<p>what's XXXX?</p>



<a name="217808749"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217808749" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Håkan MacLean <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217808749">(Nov 24 2020 at 20:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179167-hapi/topic/Validation.20with.20a.20Profile/near/217802773">said</a>:</p>
<blockquote>
<p>what's XXXX?</p>
</blockquote>
<p>Sorry <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> , don't know why I removed the link. I updated the example to reflect it. Am I using the wrong URL somehow? When I visit the URL a get a JSON with a StructureDefinition, so it makes sense to me.</p>



<a name="217808875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217808875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217808875">(Nov 24 2020 at 20:25)</a>:</h4>
<p>what's not obvious from what you've written is why you expect '<a href="https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a>' to be resolved</p>



<a name="217809276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217809276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Håkan MacLean <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217809276">(Nov 24 2020 at 20:29)</a>:</h4>
<p>When I hit <a href="https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a> with Postman I get back a FHIR JSON object with a StructureDefinition.</p>
<p>I also tried the same code, but creating a Patient pointing to <a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient">http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient</a>, but got the same result, which is why I expected it to work? But I suspect I have misunderstood something fundamentally here :)</p>



<a name="217809449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217809449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217809449">(Nov 24 2020 at 20:30)</a>:</h4>
<p>the stand alone validator will automatically resolve links like this - mostly - but when you host the validator in HAPI, you have total control over how it acts (e.g. external dependencies), which also gives you the obligation to ensure content is available, or you have implemented the right interfaces</p>



<a name="217809453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217809453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217809453">(Nov 24 2020 at 20:30)</a>:</h4>
<p>but do you really need to host the validator in HAPI?</p>



<a name="217809468"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217809468" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217809468">(Nov 24 2020 at 20:31)</a>:</h4>
<p>what are you actually trying to achieve?</p>



<a name="217813253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217813253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Håkan MacLean <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217813253">(Nov 24 2020 at 21:04)</a>:</h4>
<p>I'm writing unit tests and just want to verify that the MedicationRequests we are creating are complying with a certain Profile.<br>
When you write:<br>
<code>which also gives you the obligation to ensure content is available, or you have implemented the right interfaces</code><br>
Do you mean that my code is missing something? I was trying to follow the example in the HAPI tutorial. Right now I still haven't quite understood what is wrong in my example.</p>



<a name="217817272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217817272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217817272">(Nov 24 2020 at 21:41)</a>:</h4>
<p>you probably don't want to use the HAPI framework for the validator there. You really want to use the standalone validator. <span class="user-mention" data-user-id="248736">@Mark Iantorno</span> is doing a big lift on the validator framework at the moment, and we're making something better for JUnit testing.</p>



<a name="217817304"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217817304" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217817304">(Nov 24 2020 at 21:41)</a>:</h4>
<p>the real problem is the start up time - you certainly don't want the start up on each junit test. Could you run the valdiator as a local web service?</p>



<a name="217821497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217821497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Håkan MacLean <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217821497">(Nov 24 2020 at 22:20)</a>:</h4>
<p>No the startup time is of course a problem, but I thought it would be nice to have just <em>one</em> regression test in our test suit that verifies that we haven't changed anything that breaks the FHIR Profile. So are you saying the HAPI validator currently does not support this use case? In the documentation here <a href="https://hapifhir.io/hapi-fhir/docs/validation/instance_validator.html">https://hapifhir.io/hapi-fhir/docs/validation/instance_validator.html</a> it talks about doing exactly what I want to achieve:<br>
/*</p>
<ul>
<li>Note: You can also explicitly declare a profile to validate against</li>
<li>using the block below.<br>
 */<br>
// ValidationResult result = validator.validateWithResult(obs, new ValidationOptions().addProfile("<a href="http://myprofile.com">http://myprofile.com</a>"));</li>
</ul>
<p>Sorry for being so stubborn, but I still haven't quite understood why my simple example does not work as it seems perfectly aligned with what the docs suggest :)</p>



<a name="217838027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217838027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217838027">(Nov 25 2020 at 02:15)</a>:</h4>
<p>that part works; what doesn't work - and should probably be mentioned there - is that you first have to ensure that that profile and anything it depends on is already loaded</p>



<a name="217838252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217838252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217838252">(Nov 25 2020 at 02:20)</a>:</h4>
<p>I think, though, that what you are doing is better served by just using the validator directly - say, the class org.hl7.fhir.validation.ValidationEngine. You can see how I use in Junit tests looking here: org.hl7.fhir.validation.tests.ValidationEngineTests, or org.hl7.fhir.validation.tests.ValidationTests, though the second is much complicated by being the 'test everything about the validation logic' test set</p>



<a name="217838273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217838273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217838273">(Nov 25 2020 at 02:21)</a>:</h4>
<p>the validation engine in that case is surrounded by a bunch of code that (probably) should do what you're expecting</p>



<a name="217838292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217838292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217838292">(Nov 25 2020 at 02:21)</a>:</h4>
<p>where as HAPI explicitly doesn't, since the general design guideline is that HAPI servers don't use the web directly, especially not implicitly; only be explicit system owner choice</p>



<a name="217856589"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217856589" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217856589">(Nov 25 2020 at 08:37)</a>:</h4>
<p>one possibility to load profiles into hapi is providing it via an implementation guide. the hapi-fhir-jpaserver-starter load's the provided ig's from the <a href="https://github.com/hapifhir/hapi-fhir-jpaserver-starter/blob/master/src/main/resources/application.yaml">configuration</a>. We use this approach for exposing a $validate operation on a <a href="https://github.com/ahdis/hapi-fhir-jpaserver-validator/releases/tag/v1.1.0">server</a> and are <a href="https://github.com/ahdis/hapi-fhir-jpaserver-validator/blob/ig/src/test/java/ch/ahdis/validation/IgValidateR4Test.java">testing</a> this with all implementation guides examples the server is configured. If you are not using the JPA stack you can use ValidationEngine as Grahame has explained.</p>



<a name="217868820"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/217868820" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#217868820">(Nov 25 2020 at 10:48)</a>:</h4>
<p><span class="user-mention" data-user-id="364590">@Håkan MacLean</span> I think your profile URL is not correct in your code example. Yes, you can retrieve a StructureDefinition from it, but that is because it is the Simplifier endpoint and technical id for that FHIR resource. In the resource instance metadata, and also for validating, you need to use the canonical URL of the profile, which is in the StructureDefinition.url field. In this case it reads "<a href="http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest">http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest</a>".</p>



<a name="232412301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/232412301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kashyap Jois <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#232412301">(Mar 30 2021 at 11:54)</a>:</h4>
<p>Hi I am currently trying to use the ValidationEngine to validate a resource against a profile. I am using the profile the <a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient">us-core patient</a> . I keep getting the error Unable to resolve profile. I was wondering if there is any way to validate a resource against a profile that is loaded as a StructureDefinition.<br>
My use case is to use the profile described <a href="http://build.fhir.org/ig/dvci/vaccine-credential-ig/branches/main/StructureDefinition-vaccine-credential-bundle.html">here</a> to validate a bundle that is sent from a mobile client</p>



<a name="232422633"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/232422633" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kashyap Jois <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#232422633">(Mar 30 2021 at 13:13)</a>:</h4>
<p>Ok looks like I need to use</p>
<div class="codehilite"><pre><span></span><code> validator.loadIg(src);
 call this any number of times for the Implementation Guide(s) of interest.
 See https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator for documentation about the src parameter (-ig parameter)
</code></pre></div>
<p>and load the ig which contains all the profiles. But weirdly enough the function loadIg does not exist..<br>
<a href="https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/ValidationEngine.java">Reference</a></p>



<a name="233301116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/233301116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kashyap Jois <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#233301116">(Apr 06 2021 at 11:12)</a>:</h4>
<p>For anyone else who gets stuck due to this, you can use the validators igLoader, load the implementation guide, and then add all the profiles to the cache of the validators context.</p>



<a name="235831541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/235831541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Clotaire Delanchy <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#235831541">(Apr 23 2021 at 12:28)</a>:</h4>
<p>Hello everyone.<br>
I have just discovered FHIR and HAPI FHIR these last days and it seems I have the same problem as <span class="user-mention" data-user-id="364590">@Håkan MacLean</span>: I am creating JSON resources which are based on custom Profiles (available on Simplifier) and I want to validate (manually) that my JSON resources are valid against the profile (by pushing them to a FHIR server with $validate option or just seeing the return when trying to create the resource in the server). I've found that there is a CLI tool for HAPI FHIR server and I am using it to start a local HAPI FHIR very easily. But this HAPI FHIR server starting with the CLI tool use only "basic" FHIR resource, so it validates my resource at creation against the Patient profile (for example) and not the FrPatient profile available on Simplifier.</p>
<p>If I understand correctly the answer of <span class="user-mention" data-user-id="191478">@Oliver Egger</span> and <span class="user-mention" data-user-id="191347">@Mirjam Baltus</span>, I can upload the implementation Guide (containing the link to my custom profiles) to the HAPI server by editing the configuration file. But how can I access the configuration file with the CLI tool? Is it possible to give a custom config file to the HAPI server through this command line interface?</p>
<p>Thank you in advance for your answers, and if I'm not posting in the right topic or stream, don't hesitate to tell me!</p>



<a name="235971435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/235971435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#235971435">(Apr 24 2021 at 13:51)</a>:</h4>
<p><span class="user-mention" data-user-id="407512">@Clotaire Delanchy</span> if you want to validate manually I would suggest to start with the <a href="https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator">FHIR Java validator</a>. You can specify your custom profile and the dependent packages.</p>



<a name="266878704"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Validation%20with%20a%20Profile/near/266878704" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Validation.20with.20a.20Profile.html#266878704">(Jan 04 2022 at 23:28)</a>:</h4>
<p>(deleted)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
