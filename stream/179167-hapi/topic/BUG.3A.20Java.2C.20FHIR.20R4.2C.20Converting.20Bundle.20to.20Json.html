---
layout: page
title: "FHIR Chat  · BUG: Java, FHIR R4, Converting Bundle to Json · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/BUG.3A.20Java.2C.20FHIR.20R4.2C.20Converting.20Bundle.20to.20Json.html">BUG: Java, FHIR R4, Converting Bundle to Json</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="203201839"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/BUG%3A%20Java%2C%20FHIR%20R4%2C%20Converting%20Bundle%20to%20Json/near/203201839" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zak Guler <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/BUG.3A.20Java.2C.20FHIR.20R4.2C.20Converting.20Bundle.20to.20Json.html#203201839">(Jul 07 2020 at 20:56)</a>:</h4>
<p>The issue is when I convert Bundle object to a json fhir document, the reference id ads the resource type to the id.</p>
<p>EX: FHIRConfig.getCtx().newJsonParser().setPrettyPrint(prettyPrint).encodeResourceToString(msgBundle);<br>
will produce the following:<br>
..<br>
                      "reference": "Patient/04f2325e-b068-4a6e-9990-87147e918922"<br>
                    },<br>
                    {<br>
                      "reference": "Practitioner/5ece02c6-551f-46ca-a35f-8b502e849fdd"<br>
                    },<br>
                    {<br>
                      "reference": "Observation/0e179660-6c5e-4e87-af53-9935c57d3a59"<br>
..<br>
What can I do to make sure the resource type is NOT tagged with the id in the output chir document:<br>
"reference": "04f2325e-b068-4a6e-9990-87147e918922"</p>
<p>your help is appreciated.<br>
thanx</p>



<a name="203209422"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/BUG%3A%20Java%2C%20FHIR%20R4%2C%20Converting%20Bundle%20to%20Json/near/203209422" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/BUG.3A.20Java.2C.20FHIR.20R4.2C.20Converting.20Bundle.20to.20Json.html#203209422">(Jul 07 2020 at 22:06)</a>:</h4>
<p>please start by providing code so we know how you are converting</p>



<a name="203304122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/BUG%3A%20Java%2C%20FHIR%20R4%2C%20Converting%20Bundle%20to%20Json/near/203304122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zak Guler <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/BUG.3A.20Java.2C.20FHIR.20R4.2C.20Converting.20Bundle.20to.20Json.html#203304122">(Jul 08 2020 at 18:26)</a>:</h4>
<p>-first we call the @Search get method in the [FHIR-CLIENT] SearchController.<br>
-the search method calls the [FHIR-SERVER] to get the DeathRecord [Bundle].</p>
<div class="codehilite"><pre><span></span><code>    -control goes to the @Search method in the [FHIR-CLIENT] PatientResourceProvider class.
        -[FHIR-CLIENT] passes the parameters to the search method in PatientDao class.
        -[FHIR-CLIENT] goes to EdenmasterService class [findEdenmasterBundles()] to get the data from the database.
        -[FHIR-CLIENT] back to PatientDao to convert the Patient data to a bundle: bundle = edenmasterEntityToFHIRPatient.convertToBundles(edenmasters)
        -[FHIR-CLIENT] in EdenmasterEntityToFHIRPatient...convertToBundles(edenmasters) is where the magic starts:
                            builds the Bundle, Patient, Composition, Observations...etc

    -control comes back to the @Search method in PatientResourceProvider to return as a Bundle object.
</code></pre></div>


<p>-[FHIR-CLIENT] back in the SearchController,  the DeathRecordSubmission class merges the DeathRecord[bundle] with other resource types and creates a new expanded bundle.<br>
-[FHIR-CLIENT] DeathRecordSubmission.toJson(-the new bundle-):</p>
<div class="codehilite"><pre><span></span><code>                return FHIRConfig.getCtx().newJsonParser().setPrettyPrint(prettyPrint).encodeResourceToString(msgBundle);
</code></pre></div>


<p>the full FHIR Document output is attached with this message.</p>
<p>Note:<br>
    The interesting thing is, when I generate the fhie document by calling the FHIR-Server from a tool like POSTMAN, it gereates the reference ids properly without the resourceTypes tagged to it.<br>
    the conversion in the FHIR-Server does not call the FHIRConfig.getCtx().newJsonParser().setPrettyPrint(prettyPrint).encodeResourceToString(msgBundle).</p>
<p>I am also attaching the clean file with this message.</p>
<p>please let me know if you need additional info.<br>
thank you very much for your help in advance. <br>
Zak </p>
<p><a href="/user_uploads/10155/VtwKAiTbOzObS5bHmOZcA0x0/Fhir_Server_SRC_Chat_Fhir_Org.zip">Fhir_Server_SRC_Chat_Fhir_Org.zip</a></p>
<p><a href="/user_uploads/10155/t_CGZsQRcisfYhWK6yFuQZqZ/To_NCHS_udoh_fhir_client_R4_Chat_Fhir_Org.zip">To_NCHS_udoh_fhir_client_R4_Chat_Fhir_Org.zip</a> <a href="/user_uploads/10155/vb9GP1D6q6OzNJuinWLS3Pe8/FHIR_Doc_ReferenceIds_tagged_with_resourceTypes_Chat_Fhir_org.txt">FHIR_Doc_ReferenceIds_tagged_with_resourceTypes_Chat_Fhir_org.txt</a> <a href="/user_uploads/10155/cRiPsWBISRER_hYwl-cY7cFd/FHIR_Doc_ReferenceIds_withOUT_resourceTypes_Chat_Fhir_org.txt">FHIR_Doc_ReferenceIds_withOUT_resourceTypes_Chat_Fhir_org.txt</a></p>



<a name="203733627"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/BUG%3A%20Java%2C%20FHIR%20R4%2C%20Converting%20Bundle%20to%20Json/near/203733627" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zak Guler <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/BUG.3A.20Java.2C.20FHIR.20R4.2C.20Converting.20Bundle.20to.20Json.html#203733627">(Jul 13 2020 at 15:59)</a>:</h4>
<p>Hi any luck with this issue? did I provide you with more code than you requested?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
