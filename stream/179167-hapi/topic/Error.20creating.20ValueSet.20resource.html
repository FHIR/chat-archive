---
layout: page
title: "FHIR Chat  · Error creating ValueSet resource · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20creating.20ValueSet.20resource.html">Error creating ValueSet resource</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153972933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20creating%20ValueSet%20resource/near/153972933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20creating.20ValueSet.20resource.html#153972933">(Jul 02 2018 at 17:45)</a>:</h4>
<p>I have a local installation of the HAPI server. When I attempt to create a ValueSet resource, I am getting the following error:</p>



<a name="153972934"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20creating%20ValueSet%20resource/near/153972934" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20creating.20ValueSet.20resource.html#153972934">(Jul 02 2018 at 17:45)</a>:</h4>
<p>Failed to call access method: org.springframework.dao.DataIntegrityViolationException: could not execute batch; SQL [insert into HFJ_RESOURCE (RES_DELETED_AT, RES_VERSION, FORCED_ID_PID, HAS_TAGS, RES_PUBLISHED, RES_UPDATED, SP_HAS_LINKS, HASH_SHA256, SP_INDEX_STATUS, RES_LANGUAGE, SP_CMPSTR_UNIQ_PRESENT, SP_COORDS_PRESENT, SP_DATE_PRESENT, SP_NUMBER_PRESENT, SP_QUANTITY_PRESENT, SP_STRING_PRESENT, SP_TOKEN_PRESENT, SP_URI_PRESENT, RES_PROFILE, RES_TYPE, RES_VER, RES_ID) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]; constraint [res_encoding]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute batch</p>



<a name="153972935"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20creating%20ValueSet%20resource/near/153972935" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20creating.20ValueSet.20resource.html#153972935">(Jul 02 2018 at 17:45)</a>:</h4>
<p>Has anyone experienced this? Any idea what this is from?</p>



<a name="153973284"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20creating%20ValueSet%20resource/near/153973284" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20creating.20ValueSet.20resource.html#153973284">(Jul 04 2018 at 00:33)</a>:</h4>
<p>I've seen similar errors before when usng HAPI with PostgreSQL, but haven't gone to the effort of tracking down a root cause.  There have been recent modifications to HAPI's database layer, and it's possible your system is encountering a problem when attempting to persist data to a database created by an earlier version of HAPI.  My workaround was to drop &amp; recreate the PosgreSQL database, and let HAPI repopulate it.</p>



<a name="153973285"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20creating%20ValueSet%20resource/near/153973285" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20creating.20ValueSet.20resource.html#153973285">(Jul 04 2018 at 00:50)</a>:</h4>
<p>The 'res_encoding' column was dropped in release 3.3.0:</p>
<blockquote>
<p>This release corrects an inefficiency in the JPA Server, but requires a schema change in order to update. Prior to this version of HAPI FHIR, a CLOB column containing the complete resource body was stored in two tables: HFJ_RESOURCE and HFJ_RES_VER. Because the same content was stored in two places, the database consumed more space than is needed to. </p>
<p>In order to reduce this duplication, the RES_TEXT and RES_ENCODING columns have been dropped from the HFJ_RESOURCE table, and the RES_TEXT and RES_ENCODING columns have been made NULLABLE on the HFJ_RES_VER table. </p>
<p>The following migration script may be used to apply these changes to your database. Naturally you should back your database up prior to making this change.<br>
ALTER TABLE hfj_resource DROP COLUMN res_text;<br>
ALTER TABLE hfj_resource DROP COLUMN res_encoding;<br>
ALTER TABLE hfj_res_ver ALTER COLUMN res_encoding DROP NOT NULL;<br>
ALTER TABLE hfj_res_ver ALTER COLUMN res_text DROP NOT NULL;</p>
</blockquote>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
