---
layout: page
title: "FHIR Chat  · Parser and FHIR rules · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html">Parser and FHIR rules</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="272114168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272114168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272114168">(Feb 16 2022 at 13:20)</a>:</h4>
<p>I just serialized a resource having a contained resource having the narrative (.text) populated. This is not allowed by the FHIR standard, and hapi strips it.</p>
<p>I totally understand, that hapi tries to prevent miss-use of FHIR, but i think a parser/encoder shouldn't enforce "business logic", or at least has a parameter/config to disable this guidance.</p>



<a name="272117344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272117344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272117344">(Feb 16 2022 at 13:48)</a>:</h4>
<p>I actually didn't realize is was not allowed to prescribe the narrative.. I assume this is only if the status is <code>generated</code>?</p>



<a name="272138374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272138374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272138374">(Feb 16 2022 at 16:20)</a>:</h4>
<p>you are right. It is only relevant during narrative rendering/generation. It was a rule back in STU1/2</p>



<a name="272138411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272138411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272138411">(Feb 16 2022 at 16:20)</a>:</h4>
<p>This was already reported to hapi: <a href="https://github.com/hapifhir/hapi-fhir/issues/1466">https://github.com/hapifhir/hapi-fhir/issues/1466</a></p>



<a name="272147597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272147597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272147597">(Feb 16 2022 at 17:21)</a>:</h4>
<p>I think we need to revert the changes made here: <a href="https://github.com/hapifhir/hapi-fhir/commit/287162af914231aa5d994813de9a4d1ea64f0196">https://github.com/hapifhir/hapi-fhir/commit/287162af914231aa5d994813de9a4d1ea64f0196</a></p>



<a name="272148048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272148048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272148048">(Feb 16 2022 at 17:24)</a>:</h4>
<p>Will create a PR (probably tomorrow)</p>



<a name="272193562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272193562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272193562">(Feb 16 2022 at 23:19)</a>:</h4>
<p>fix is ready, will fix the broken tests tomorrow</p>



<a name="272235047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272235047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272235047">(Feb 17 2022 at 09:42)</a>:</h4>
<p><a href="https://github.com/hapifhir/hapi-fhir/pull/3402">https://github.com/hapifhir/hapi-fhir/pull/3402</a></p>



<a name="272235083"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272235083" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272235083">(Feb 17 2022 at 09:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> who should i mark for a review on the PR?</p>



<a name="272281907"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272281907" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272281907">(Feb 17 2022 at 16:08)</a>:</h4>
<p>I just did a quick scan, and I can't even find the rule forbidding narratives in contained resources in R4... Does it still exist?</p>



<a name="272282149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282149">(Feb 17 2022 at 16:10)</a>:</h4>
<p>Yes, the parsers are skipping encoding narratives. My PR removes the code and also changes the unit tests affected by the change.</p>



<a name="272282264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282264">(Feb 17 2022 at 16:10)</a>:</h4>
<p>Ah, you meant the spec <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="272282281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282281">(Feb 17 2022 at 16:10)</a>:</h4>
<p>heh yeah</p>
<p>If it's still a rule, I will say this kind of change makes me at least a bit nervous. I get your point about a parser shouldn't be enforcing business rules, but the counter argument is that if the library lets you do it people will assume it's ok and use it.. and then there may be safety issues since the consumers could miss the existence of that data.</p>



<a name="272282303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282303">(Feb 17 2022 at 16:11)</a>:</h4>
<p>We could make that configurable though in the ParserOptions</p>



<a name="272282335"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282335" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282335">(Feb 17 2022 at 16:11)</a>:</h4>
<p>Or if it's not even a rule anymore we should definitely not enforce it</p>



<a name="272282433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282433">(Feb 17 2022 at 16:12)</a>:</h4>
<p>this was only a rule in STU1 iirc.. will double check on this</p>



<a name="272282682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282682">(Feb 17 2022 at 16:13)</a>:</h4>
<p>Looks like it's gone. I found it in DSTU1: <a href="https://www.hl7.org/fhir/DSTU1/narrative.html">https://www.hl7.org/fhir/DSTU1/narrative.html</a></p>
<blockquote>
<p>Note that contained Resources SHALL NOT have a narrative of their own.</p>
</blockquote>



<a name="272282697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282697">(Feb 17 2022 at 16:13)</a>:</h4>
<p>But it's not in R4 on that page</p>



<a name="272282865"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272282865" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272282865">(Feb 17 2022 at 16:14)</a>:</h4>
<p>I've approved the PR - Please add a changelog though before you merge :)</p>



<a name="272283057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272283057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272283057">(Feb 17 2022 at 16:16)</a>:</h4>
<p>thanks. I added a change yml file, do i have to provide the change at another location as well?</p>



<a name="272292670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272292670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272292670">(Feb 17 2022 at 17:22)</a>:</h4>
<p>checked other PRs. I think i'm good: <a href="https://github.com/hapifhir/hapi-fhir/blob/9f2af9747fbd600c78acd0955554515cdf0394b9/hapi-fhir-docs/src/main/resources/ca/uhn/hapi/fhir/changelog/6_0_0/1466-encode-narratives-of-encoded-resources.yaml">https://github.com/hapifhir/hapi-fhir/blob/9f2af9747fbd600c78acd0955554515cdf0394b9/hapi-fhir-docs/src/main/resources/ca/uhn/hapi/fhir/changelog/6_0_0/1466-encode-narratives-of-encoded-resources.yaml</a></p>



<a name="272301794"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272301794" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272301794">(Feb 17 2022 at 18:22)</a>:</h4>
<p>that's awesome, thanks!</p>



<a name="272310671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Parser%20and%20FHIR%20rules/near/272310671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Parser.20and.20FHIR.20rules.html#272310671">(Feb 17 2022 at 19:29)</a>:</h4>
<p>Thanks for the quick review. <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
