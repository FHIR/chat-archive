---
layout: page
title: "FHIR Chat  · Bug in BaseDateTimeType · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html">Bug in BaseDateTimeType</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="208627598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%20in%20BaseDateTimeType/near/208627598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html#208627598">(Aug 31 2020 at 23:19)</a>:</h4>
<p>hey <span class="user-mention" data-user-id="191319">@James Agnew</span>  there's a pretty serious bug just cropped up in BaseDateTimeType.</p>
<p>Consider this code: </p>
<div class="codehilite"><pre><span></span><code>    <span class="n">String</span> <span class="n">src</span> <span class="o">=</span> <span class="s">&quot;2015-08-25T02:11:36&quot;</span><span class="p">;</span>
    <span class="n">DateTimeType</span> <span class="n">dt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTimeType</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
    <span class="n">Assertions</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="na">primitiveValue</span><span class="p">(),</span> <span class="n">src</span><span class="p">);</span>
    <span class="n">DateTimeType</span> <span class="n">dt2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTimeType</span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="na">getValue</span><span class="p">());</span>
    <span class="n">Assertions</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">dt2</span><span class="p">.</span><span class="na">primitiveValue</span><span class="p">(),</span> <span class="n">src</span><span class="p">);</span>
</code></pre></div>


<p>The second assertion fails:</p>
<div class="codehilite"><pre><span></span><code>org.opentest4j.AssertionFailedError: expected: &lt;2015-08-25T02:11:36+10:00&gt; but was: &lt;2015-08-25T02:11:36&gt;
</code></pre></div>



<a name="208627672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%20in%20BaseDateTimeType/near/208627672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html#208627672">(Aug 31 2020 at 23:20)</a>:</h4>
<p>This is in R5, but I expect it's the same in all versions</p>



<a name="208698171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%20in%20BaseDateTimeType/near/208698171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html#208698171">(Sep 01 2020 at 14:51)</a>:</h4>
<p>Huh, interesting.</p>
<p>I think at one point we errored out if a datetime with time but not TZ was provided, but that was softened at some point and that led to what we have here (a TZ being inferred, which I agree is awful).</p>
<p>Should we just preserve the (technically invalid) string there? (as opposed to throwing an error?)</p>



<a name="208744858"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%20in%20BaseDateTimeType/near/208744858" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html#208744858">(Sep 01 2020 at 20:37)</a>:</h4>
<p>I talked to James about this. It's inherent in the fact that BaseDateTimeType is a PrimitiveType&lt;Date&gt;. This was done originally for Java 6 compatibility and is no longer required. In fact, it's a liability. So we're considering changing the parameter type more recent that supports timezones. This is obviously a big change but Date is definitely liability. </p>
<p>Does anyone have any opinion about this?</p>



<a name="208746548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%20in%20BaseDateTimeType/near/208746548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html#208746548">(Sep 01 2020 at 20:52)</a>:</h4>
<p>Change the type - thats my two cents</p>



<a name="208772442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%20in%20BaseDateTimeType/near/208772442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Karl M. Davis <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html#208772442">(Sep 02 2020 at 02:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType/near/208744858">said</a>:</p>
<blockquote>
<p>I talked to James about this. It's inherent in the fact that BaseDateTimeType is a PrimitiveType&lt;Date&gt;. This was done originally for Java 6 compatibility and is no longer required. In fact, it's a liability. So we're considering changing the parameter type more recent that supports timezones. This is obviously a big change but Date is definitely liability. </p>
<p>Does anyone have any opinion about this?</p>
</blockquote>
<p>I don't think the change would break backwards compatibility in the serialized JSON or XML, right? If not, FWIW, my default opinion is that any code using <code>Date</code> is wrong/broken.</p>



<a name="208772556"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%20in%20BaseDateTimeType/near/208772556" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html#208772556">(Sep 02 2020 at 02:14)</a>:</h4>
<p>right. It doesn't change anything about how the type works except where you use .getValue() / .setValue()</p>



<a name="208772577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%20in%20BaseDateTimeType/near/208772577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.20in.20BaseDateTimeType.html#208772577">(Sep 02 2020 at 02:14)</a>:</h4>
<p>but I've had to fix a few bugs in the last couple of days associated with this usage</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
