---
layout: page
title: "FHIR Chat  · Query data inside interceptor · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Query.20data.20inside.20interceptor.html">Query data inside interceptor</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="244615160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Query%20data%20inside%20interceptor/near/244615160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marek Gocał <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Query.20data.20inside.20interceptor.html#244615160">(Jul 01 2021 at 19:28)</a>:</h4>
<p>I'd like to create a custom interceptor that check permissions based on  data query result. Does hapi support "server side fluet query" -  so I'd like to query data directly from within my jpa server, and not using rest api</p>



<a name="244615608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Query%20data%20inside%20interceptor/near/244615608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marek Gocał <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Query.20data.20inside.20interceptor.html#244615608">(Jul 01 2021 at 19:32)</a>:</h4>
<p>To be more precise what my interceptor does:</p>
<ol>
<li>Receive external (outh provider) token</li>
<li>Call outh service to verify if token is valid</li>
<li>
<p>Get user details for the outh service<br>
<strong>4. Find user that matches user details email (e.g. via system/identifier keys)</strong></p>
</li>
<li>
<p>Filter results based on the user id</p>
</li>
</ol>
<p>So my question is how can you query hapi (from my interceptor) to retrieve user based on system/identifier</p>



<a name="248837951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Query%20data%20inside%20interceptor/near/248837951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joris Scharp <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Query.20data.20inside.20interceptor.html#248837951">(Aug 09 2021 at 12:29)</a>:</h4>
<p>I'm wondering the same, in my case I want to lookup a <code>Device</code> based on the OAuth <code>azp</code> field to determine if a party is authorized for a request. Did you manage to  find out yet <span class="user-mention" data-user-id="424158">@Marek Gocał</span> ? Or perhaps someone else can help?</p>



<a name="248839372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Query%20data%20inside%20interceptor/near/248839372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joris Scharp <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Query.20data.20inside.20interceptor.html#248839372">(Aug 09 2021 at 12:42)</a>:</h4>
<p>For now I just inject the Dao from the <code>BaseJpaRestfulServer</code>; not sure if this is best practice though..</p>
<p><code>daoRegistry.getResourceDao(ResourceTypeEnum.DEVICE.getCode())</code></p>



<a name="249022740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Query%20data%20inside%20interceptor/near/249022740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marek Gocał <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Query.20data.20inside.20interceptor.html#249022740">(Aug 10 2021 at 19:13)</a>:</h4>
<p>Didn't manage to solve my problem yet, but I will try with your solution!</p>



<a name="249023679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Query%20data%20inside%20interceptor/near/249023679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joris Scharp <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Query.20data.20inside.20interceptor.html#249023679">(Aug 10 2021 at 19:20)</a>:</h4>
<p>Yeah works fine for me <span class="user-mention" data-user-id="424158">@Marek Gocał</span> , there's  a slight better way to extract the  DAO (with generics) though. So inside <code>ca.uhn.fhir.jpa.starter.JpaRestfulServer#initialize</code>:</p>
<div class="codehilite"><pre><span></span><code>...
final IFhirResourceDao&lt;Device&gt; deviceDao = daoRegistry.getResourceDao(Device.class);
registerInterceptor(new InjectResourceOriginInterceptor(deviceDao));
...
</code></pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
