---
layout: page
title: "FHIR Chat  · Deadlock exception on sql-server for hfj_forced_id table · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Deadlock.20exception.20on.20sql-server.20for.20hfj_forced_id.20table.html">Deadlock exception on sql-server for hfj_forced_id table</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="188515497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Deadlock%20exception%20on%20sql-server%20for%20hfj_forced_id%20table/near/188515497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sajith Jamal <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Deadlock.20exception.20on.20sql-server.20for.20hfj_forced_id.20table.html#188515497">(Feb 19 2020 at 04:43)</a>:</h4>
<p>Hi all,<br>
I am trying to parse some resources to the to  a HAPI server  with  a Sql Server backend. However some of the transactions fail with a deadlock exception...looking at the sql log...I can see that the lock is caused at the table <a href="/user_uploads/10155/jPEHCcKI5Nm9S4qGK0RzID61/forced_id.PNG" target="_blank" title="forced_id.PNG">hfj_forced_id</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/jPEHCcKI5Nm9S4qGK0RzID61/forced_id.PNG" target="_blank" title="hfj_forced_id"><img src="/user_uploads/10155/jPEHCcKI5Nm9S4qGK0RzID61/forced_id.PNG"></a></div><p>Enabling the Hibernate SQL logs on my app shows some inserts and writes on to the table at what seems to be the same time<br>
<a href="/user_uploads/10155/mHcXluZqRxzmFoPFDaqzulVp/forced_error.PNG" target="_blank" title="forced_error.PNG">forced_error.PNG</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/mHcXluZqRxzmFoPFDaqzulVp/forced_error.PNG" target="_blank" title="forced_error.PNG"><img src="/user_uploads/10155/mHcXluZqRxzmFoPFDaqzulVp/forced_error.PNG"></a></div><p>Scenario:<br>
I have a few hundred bundles of PractitionerRole that I am trying to POST to the HAPI server in a parallel manner at about 50 bundles per second<br>
Each bundle has a 100 PractitionerRoles</p>
<p>I presume this happens when creating a forced_id several times for the resources causing a deadlock. </p>
<p>Other types of databases did not cause this (tested on hsqldb and derby), so I think this is specific to the Sql Server Engine. However I am limited to using Sql Server due to circumstances so I would like to try to resolved this issue</p>
<p>I have also tried setting the transaction isolation level to read_uncommited to no avail at both the spring boot application level as well as the database level<br>
<code>spring.jpa.properties.hibernate.connection.isolation=READ_UNCOMMITED</code><br>
<code>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</code></p>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span>  do you perhaps have some insight into trying to solve this issue?</p>



<a name="188654478"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Deadlock%20exception%20on%20sql-server%20for%20hfj_forced_id%20table/near/188654478" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Deadlock.20exception.20on.20sql-server.20for.20hfj_forced_id.20table.html#188654478">(Feb 20 2020 at 16:41)</a>:</h4>
<p>FYI to anyone- this discussion moved to the Google Group</p>



<a name="188762309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Deadlock%20exception%20on%20sql-server%20for%20hfj_forced_id%20table/near/188762309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Deadlock.20exception.20on.20sql-server.20for.20hfj_forced_id.20table.html#188762309">(Feb 21 2020 at 18:51)</a>:</h4>
<p>Link?</p>



<a name="188811597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Deadlock%20exception%20on%20sql-server%20for%20hfj_forced_id%20table/near/188811597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Deadlock.20exception.20on.20sql-server.20for.20hfj_forced_id.20table.html#188811597">(Feb 22 2020 at 10:43)</a>:</h4>
<p><a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/hapi-fhir/lLuRnQZoaU8/soI1OtvDAQAJ" target="_blank" title="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/hapi-fhir/lLuRnQZoaU8/soI1OtvDAQAJ">https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/hapi-fhir/lLuRnQZoaU8/soI1OtvDAQAJ</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
