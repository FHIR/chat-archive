---
layout: page
title: "FHIR Chat  · hapi with newest java validation · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html">hapi with newest java validation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="214554752"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214554752" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214554752">(Oct 26 2020 at 10:08)</a>:</h4>
<p>The current hapi master branch uses fhir.core 5.1.0. This version doesn't support slicing by pattern on name and address (what we are doing in the german base profiles). This was fixed in fhir.core 5.1.10+</p>



<a name="214554816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214554816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214554816">(Oct 26 2020 at 10:09)</a>:</h4>
<p>I tried updating the fhir.core version for hapi (whole core, and only validation) with 5.10 and 5.16 without success.</p>



<a name="214554839"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214554839" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214554839">(Oct 26 2020 at 10:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Caused by: java.lang.reflect.InvocationTargetException: null
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:566)
        at ca.uhn.fhir.rest.server.method.BaseMethodBinding.invokeServerMethod(BaseMethodBinding.java:245)
        ... 54 common frames omitted
Caused by: java.lang.NoSuchMethodError: org.hl7.fhir.r5.elementmodel.Element.hasParentForValidator()Z
        at org.hl7.fhir.validation.instance.InstanceValidator.setParents(InstanceValidator.java:5096)
        at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:697)
        at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:553)
        at org.hl7.fhir.common.hapi.validation.validator.ValidatorWrapper.validate(ValidatorWrapper.java:165)
        at org.hl7.fhir.common.hapi.validation.validator.FhirInstanceValidator.validate(FhirInstanceValidator.java:211)
        at org.hl7.fhir.common.hapi.validation.validator.BaseValidatorBridge.doValidate(BaseValidatorBridge.java:22)
        at org.hl7.fhir.common.hapi.validation.validator.BaseValidatorBridge.validateResource(BaseValidatorBridge.java:45)
        at org.hl7.fhir.common.hapi.validation.validator.FhirInstanceValidator.validateResource(FhirInstanceValidator.java:29)
        at ca.uhn.fhir.validation.FhirValidator.validateWithResult(FhirValidator.java:245)
</code></pre></div>



<a name="214554997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214554997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214554997">(Oct 26 2020 at 10:10)</a>:</h4>
<p>The structure of the methods in the java validator aren't fitting anymore. Did anyone else tried the same, or started a branch with a newer fhir.core which i didn't see?</p>



<a name="214556487"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214556487" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214556487">(Oct 26 2020 at 10:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> : I have our validator working with the combo hapi 5.2.0-snapshot and fhir.core.version 5.1.15, later is not yet possible due to class name changes, see <a href="https://github.com/ahdis/hapi-fhir-jpaserver-validator/releases/tag/v1.1.0">https://github.com/ahdis/hapi-fhir-jpaserver-validator/releases/tag/v1.1.0</a> if interested.</p>



<a name="214556577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214556577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214556577">(Oct 26 2020 at 10:26)</a>:</h4>
<p>Wow, very helpful. Thank you <span class="user-mention" data-user-id="191478">@Oliver Egger</span></p>



<a name="214556669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214556669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214556669">(Oct 26 2020 at 10:27)</a>:</h4>
<p>Wondering why i got errors wit 5.1.10. Have you tried validating an jnstance against a profile with patternSlicing on name or address? This triggers the reflection nullpointer in my case</p>



<a name="214564981"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214564981" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214564981">(Oct 26 2020 at 12:10)</a>:</h4>
<p>Ok tried to apply your pom changes to the current jpa starter:</p>
<ul>
<li>hapi snapshot 5.2.0 is currently broken, tried 5.1.0</li>
<li>upped *core to 5.1.15</li>
<li>hapi can't resolve datatype strucdefs which have been posted to the server during validation. I then added the data type profiles via ig -&gt; kind of works</li>
<li>now the validator returns:         </li>
</ul>
<div class="codehilite"><pre><span></span><code>{
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;Expected 0 but found 2 prefix elements&quot;,
            &quot;location&quot;: [
                &quot;Patient.name[0]&quot;,
                &quot;Line 24, Col 6&quot;
            ]
        },
        {
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;Expected 0 but found 2 suffix elements&quot;,
            &quot;location&quot;: [
                &quot;Patient.name[0]&quot;,
                &quot;Line 24, Col 6&quot;
            ]
        }
</code></pre></div>



<a name="214565024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214565024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214565024">(Oct 26 2020 at 12:11)</a>:</h4>
<p>The patient example i'm validating doesn't include any name prefis or suffix elements...</p>



<a name="214565531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214565531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214565531">(Oct 26 2020 at 12:17)</a>:</h4>
<p>no sorry, I don't think i have patternSlicing on name or address in our ig's</p>



<a name="214566043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214566043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214566043">(Oct 26 2020 at 12:25)</a>:</h4>
<p>no worries, thanks again for your response!</p>



<a name="214566149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/214566149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#214566149">(Oct 26 2020 at 12:26)</a>:</h4>
<p>In the java validator everything just works.. will try to get the core dependency to a up to date version in the hapi project.</p>



<a name="226803720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/226803720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Meyers <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#226803720">(Feb 18 2021 at 12:40)</a>:</h4>
<p>Hello everyone, were facing a similar response when trying to validate our patient resource against the mii kds person profile. The <a href="https://simplifier.net/MedizininformatikInitiative-ModulPerson/PatientIn/~overview">Structure definition file</a> looks fine imo, so i guess its an hapi related issue. were using 5.2.0 numbat version.</p>
<p>example: </p>
<div class="codehilite"><pre><span></span><code>&quot;address&quot;: [
{
&quot;type&quot;: &quot;both&quot;,
&quot;line&quot;: [
  &quot;Musterstr. 1&quot;
],
  &quot;city&quot;: &quot;Darmstadt&quot;,
  &quot;postalCode&quot;: &quot;64283&quot;,
  &quot;country&quot;: &quot;DE&quot;
 }
]
</code></pre></div>
<p>results in:</p>
<div class="codehilite"><pre><span></span><code>&quot;severity&quot;: &quot;error&quot;,
&quot;code&quot;: &quot;processing&quot;,
&quot;diagnostics&quot;: &quot;Expected 0 but found 1 line elements&quot;,
&quot;location&quot;: [
&quot;Patient.address[0]&quot;,
&quot;Line 36, Col 10&quot;
]
}
</code></pre></div>
<p>If you omit the line, however, the validator then also complains (which is correct): </p>
<div class="codehilite"><pre><span></span><code>{
&quot;severity&quot;: &quot;error&quot;,
&quot;code&quot;: &quot;processing&quot;,
&quot;diagnostics&quot;: &quot;Patient.address:Strassenanschrift.line: minimum required = 1, but only found 0 (from https://www.medizininformatik-initiative.de/fhir/core/modul-person/StructureDefinition/Patient)&quot;,
&quot;location&quot;: [
&quot;Patient.address[0]&quot;,
&quot;Line 36, Col 10&quot;
] }
</code></pre></div>
<p>If u need further information, just let me know pls. thx so far.</p>



<a name="228558205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/228558205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Meyers <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#228558205">(Mar 03 2021 at 09:05)</a>:</h4>
<p>We have just checked if the problem is also present in version 5.3.0 -&gt; unfortunately it is.</p>



<a name="229259529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi%20with%20newest%20java%20validation/near/229259529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi.20with.20newest.20java.20validation.html#229259529">(Mar 08 2021 at 07:51)</a>:</h4>
<p>its a bug. I already added a PR here: <a href="https://github.com/hapifhir/org.hl7.fhir.core/pull/424">https://github.com/hapifhir/org.hl7.fhir.core/pull/424</a><br>
I will add Changelog and Testcase this week, so this bug will be fixed soon.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
