---
layout: page
title: "FHIR Chat  · bundle conditional patch alternative solution · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/bundle.20conditional.20patch.20alternative.20solution.html">bundle conditional patch alternative solution</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="204698693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/bundle%20conditional%20patch%20alternative%20solution/near/204698693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/bundle.20conditional.20patch.20alternative.20solution.html#204698693">(Jul 22 2020 at 17:44)</a>:</h4>
<p>Hello Implementers,<br>
Hapi jpa R4 release inside a bundle txn, conditional patch is not working. Can you please kindly suggest a workaround ?. One possible solution I am thinking is that instead of patch, read the resource again, apply the changed fields on the read resource, apply bundle PUT with setIfMatch (conditional version). Is this ok ofcourse this has a penalty of reading the resource. Are there any other alternatives ?. Can you please kindly suggest. <br>
thanks for your kind help.<br>
(apologies raised this in #implementers forum earlier and got redirected here).</p>



<a name="204709414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/bundle%20conditional%20patch%20alternative%20solution/near/204709414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/bundle.20conditional.20patch.20alternative.20solution.html#204709414">(Jul 22 2020 at 19:08)</a>:</h4>
<p>Can you provide a small test that prooves it?</p>



<a name="204734642"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/bundle%20conditional%20patch%20alternative%20solution/near/204734642" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/bundle.20conditional.20patch.20alternative.20solution.html#204734642">(Jul 22 2020 at 23:25)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="191427">@Jens Villadsen</span> . I have created a simple testcase here. I created in R5 but the issue is in R4 also.<br>
go to this link <a href="http://hapi.fhir.org/transaction">http://hapi.fhir.org/transaction</a> and choose R5 server, </p>
<p>{<br>
  "resourceType": "Bundle",<br>
  "type": "transaction",<br>
  "total": 1,<br>
  "entry": [<br>
    {<br>
      "fullUrl": "Patient/107",<br>
      "resource": {<br>
        "resourceType": "Binary",<br>
        "contentType": "application/json-patch+json",<br>
        "data": "WyB7ICJvcCI6InJlcGxhY2UiLCAicGF0aCI6Ii9iaXJ0aERhdGUiLCAidmFsdWUiOiIxOTMzLTAxLTAxIiB9IF0="<br>
      },<br>
      "request": {<br>
        "method": "PATCH",<br>
        "url": "Patient/107",<br>
        "ifMatch": "4"<br>
      }<br>
    }<br>
  ]<br>
}</p>
<p>Note: data field is basically in base64 form of this <br>
[ { "op":"replace", "path":"/birthDate", "value":"1933-01-01" } ]</p>
<p>you get an error message like this<br>
Warning!<br>
Error: HTTP 400 Bad Request: Invalid match URL[4] - URL has no search parameters<br>
HTTP 400 Bad Request<br>
Response Headers    <br>
x-request-id: DQKWFTclsCMJoOH5<br>
date: Wed, 22 Jul 2020 23:22:32 GMT<br>
server: nginx/1.14.0 (Ubuntu)<br>
transfer-encoding: chunked<br>
x-powered-by: HAPI FHIR 5.1.0-SNAPSHOT REST Server (FHIR Server; FHIR 4.4.0/R5)<br>
connection: keep-alive<br>
content-type: application/fhir+json;charset=utf-8<br>
{<br>
  "resourceType": "OperationOutcome",<br>
  "text": {<br>
    "status": "generated",<br>
    "div": "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\"0\"&gt;&lt;tr&gt;&lt;td style=\"font-weight: bold;\"&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Invalid match URL[4] - URL has no search parameters&lt;/pre&gt;&lt;/td&gt;\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/table&gt;\n\t&lt;/div&gt;"<br>
  },<br>
  "issue": [ {<br>
    "severity": "error",<br>
    "code": "processing",<br>
    "diagnostics": "Invalid match URL[4] - URL has no search parameters"<br>
  } ]<br>
}</p>
<p>Remove "ifMatch" : "4" and run it , it will update correctly.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
