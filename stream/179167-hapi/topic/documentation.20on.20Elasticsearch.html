---
layout: page
title: "FHIR Chat  · documentation on Elasticsearch · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html">documentation on Elasticsearch</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="234752443"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/234752443" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#234752443">(Apr 15 2021 at 21:02)</a>:</h4>
<p>Is there additional documentation that anyone is aware of for setting up and using Elasticsearch - primarily for terminology (but not limited to that)? I'm looking specifically at the jpaserver-starter (5.3.0).  The documentation in the <a href="https://github.com/hapifhir/hapi-fhir-jpaserver-starter#using-elasticsearch">README</a> is fairly minimal and leaves (at least for me) a few things not quite clear. I also didn't find very much on it doing searches on this Zulip stream and in the Google Group.  One thing in particular is, I'm not sure how things are supposed to work alongside or instead of the Lucene searching and what the proper settings are in application.yaml (or anywhere else) for that. And what is the best way to check if Elasticsearch is working correctly and the necessary indexes are all there?  Any suggestions or answers will be appreciated!</p>



<a name="235349838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/235349838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#235349838">(Apr 20 2021 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191427">@Jens Villadsen</span> Do you have some thoughts/suggestions on this - particularly about the proper settings in application.yaml (James suggested checking with you on that)?</p>



<a name="235358451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/235358451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#235358451">(Apr 20 2021 at 15:02)</a>:</h4>
<p>I do have - but I haven't got the time to go into it. I'm currently doing a national COVID solution that takes up 150% of my time. I'll have suggestions and thoughts on this matter after the 7th of may</p>



<a name="235367092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/235367092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#235367092">(Apr 20 2021 at 15:48)</a>:</h4>
<p>Thanks, Jens.  No problem and definitely understand the priorities!</p>



<a name="236584881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/236584881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#236584881">(Apr 28 2021 at 21:34)</a>:</h4>
<p><span class="user-mention" data-user-id="191505">@Sean McIlvenna</span> Do you have any insights or suggestions for the application.yaml elasticsearch settings?  What particularly isn't clear to me is how to set <code>username</code> and <code>password</code> when the Elasticsearch endpoint is on localhost.  My local Elasticsearch endpoint on Ubuntu 20.04 (installed from the Ubuntu repo) doesn't require (or even directly allow?) any credentials, so I haven't figured out how to populate those parameters.  I tried commenting those two parameters out, but that gave: <code>java.lang.IllegalArgumentException: Username may not be null</code>.  I also tried leaving the values empty - that didn't give a exception, but it also so far hasn't worked (value set expansions particularly are failing).</p>



<a name="237084741"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237084741" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237084741">(May 02 2021 at 21:13)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191405">@Rob Hausam</span> , would love to say I know... I didn't setup any of the elastic search stuff, so I'm a bit in the dark. I'll take a quick glance and see if I can spot anything, though.</p>



<a name="237085240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237085240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237085240">(May 02 2021 at 21:16)</a>:</h4>
<p>So, I see this in the <code>hapi-fhir</code> project:</p>
<div class="codehilite"><pre><span></span><code>        final CredentialsProvider credentialsProvider =
                new BasicCredentialsProvider();
        credentialsProvider.setCredentials(AuthScope.ANY,
                new UsernamePasswordCredentials(theUsername, thePassword));
        RestClientBuilder clientBuilder = RestClient.builder(
                new HttpHost(stripHostOfScheme(theHostname), thePort, determineScheme(theHostname)))
                .setHttpClientConfigCallback(httpClientBuilder -&gt; httpClientBuilder
                        .setDefaultCredentialsProvider(credentialsProvider));
</code></pre></div>



<a name="237085288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237085288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237085288">(May 02 2021 at 21:16)</a>:</h4>
<p>It appears that it should be modified to not always assume basic credentials...</p>



<a name="237085355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237085355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237085355">(May 02 2021 at 21:16)</a>:</h4>
<p>But, this is part of the core <code>hapi-fhir</code> project, not the <code>hapi-fhir-jpaserver-starter</code> project... so, it's not as easy to get that changed</p>



<a name="237085415"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237085415" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237085415">(May 02 2021 at 21:17)</a>:</h4>
<p>Thanks, Sean.  I think I've figured out some of it.  I do have Elasticsearch running now and it seems to be indexing - but I'm not sure yet how well and completely it's working.  It seems to not really care (at least in my particular case running on localhost) what the username and password are, as long as they are there.</p>



<a name="237085460"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237085460" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237085460">(May 02 2021 at 21:17)</a>:</h4>
<p>nice!</p>



<a name="237085561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237085561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237085561">(May 02 2021 at 21:18)</a>:</h4>
<p>I'd suggest submitting an issue requesting that this functionality be changed to not always require user/pass</p>



<a name="237085586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237085586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237085586">(May 02 2021 at 21:18)</a>:</h4>
<p>seems like a reasonable change to me</p>



<a name="237086071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237086071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237086071">(May 02 2021 at 21:21)</a>:</h4>
<p>Here is my current <a href="/user_uploads/10155/AjagrFVWdPHhQ7btBug2PhHu/application.yaml">application.yaml</a>.  Any further thoughts you have would be great.</p>



<a name="237086335"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237086335" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237086335">(May 02 2021 at 21:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> I am fairly new to FHIR, so this may be very basic stuff for you. But what's your primary driver to move to ElasticSearch ? Is there an expectation of performance gains on  REST queries ?</p>



<a name="237087108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237087108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237087108">(May 02 2021 at 21:34)</a>:</h4>
<p><span class="user-mention" data-user-id="191783">@dsh</span>  No, probably not that basic at all - I'm still working through figuring it out.  The motivation for trying Elasticsearch was a couple of things.  We were trying to implement type-ahead search using $expand + filter on ValueSet, but the existing search behavior was doing partial string matching but only with an exact match on the full entered text, rather than basing the search on tokens (which would provide a much more natural search result).  Elasticsearch seems potentially able to provide much more configurability and capability in that regard.  Plus the HAPI documentation states that Elasticsearch is now available and that it is likely to become the default in the future, so I thought it would make sense to go ahead and give it a try now and see what it would be able to do.</p>



<a name="237134109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/237134109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#237134109">(May 03 2021 at 09:21)</a>:</h4>
<p>Thanks for sharing that <span class="user-mention" data-user-id="191405">@Rob Hausam</span></p>



<a name="267424025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/267424025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Meyers <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#267424025">(Jan 10 2022 at 11:02)</a>:</h4>
<p>In initial tests on queries on resources with huge volumes (e.g., over &gt;5 million observation resources), we did significantly better with the standard Lucenes engine than with ElasticSearch integration (e.g.: 6 minutes when retrieving all resources via self + next instead of 7 minutes with ElasticSearch). Full text searches via "contains" operator were also significantly faster. <br>
Are there any other experience reports here? Could of course be due to configuration or other technical details.</p>



<a name="267429033"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/267429033" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#267429033">(Jan 10 2022 at 11:53)</a>:</h4>
<p>ElasticSearch is built on top of lucene. So Lucene should always be faster.<br>
ElasticSearch adds in horizontal scalibility</p>



<a name="267433055"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/documentation%20on%20Elasticsearch/near/267433055" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Meyers <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/documentation.20on.20Elasticsearch.html#267433055">(Jan 10 2022 at 12:39)</a>:</h4>
<p>Thanks for the clarification <span class="user-mention" data-user-id="191687">@Kevin Mayfield</span>. Are there any tips (configuration, infrastructure, ...) that you don't constantly run into timeouts with "_summary=count" initial queries (without prior caching) for resources with high entity ? Sure you could increase the timeout parameter (currently 60 seconds afaik), however I think that just counting the resources shouldn't take that long ? We are currently using a mysql database.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
