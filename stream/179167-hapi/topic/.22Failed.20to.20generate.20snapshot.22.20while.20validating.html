---
layout: page
title: "FHIR Chat  · &quot;Failed to generate snapshot&quot; while validating · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html">&quot;Failed to generate snapshot&quot; while validating</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="217293064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217293064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217293064">(Nov 19 2020 at 16:20)</a>:</h4>
<p>when validating an Observation resource against profile <a href="https://simplifier.net/NictizSTU3-Zib2017/ZibAlcoholUse/~xml">https://simplifier.net/NictizSTU3-Zib2017/ZibAlcoholUse/~xml</a> the response contains the following issue: </p>
<div class="codehilite"><pre><span></span><code>&quot;issue&quot;: [ {
     &quot;severity&quot;: &quot;error&quot;,
     &quot;code&quot;: &quot;processing&quot;,
     &quot;diagnostics&quot;: &quot;Failed to generate snapshot&quot;
} ]
</code></pre></div>
<p>The following info in the logs stood out to me:</p>
<div class="codehilite"><pre><span></span><code>Caused by: org.hl7.fhir.exceptions.FHIRException:
Attempt to use a snapshot on profile
&#39;http://nictiz.nl/fhir/StructureDefinition/zib-Encounter&#39;
as Base for generating a snapshot for the profile
http://nictiz.nl/fhir/StructureDefinition/gp-Encounter
before it is generated
</code></pre></div>
<p>the two profiles in the exception can be found here:</p>
<ul>
<li><a href="https://simplifier.net/NictizSTU3-Zib2017/gp-Encounter/~xml">https://simplifier.net/NictizSTU3-Zib2017/gp-Encounter/~xml</a></li>
<li><a href="https://simplifier.net/NictizSTU3-Zib2017/ZibEncounter/~xml">https://simplifier.net/NictizSTU3-Zib2017/ZibEncounter/~xml</a></li>
</ul>
<p>What can I do to resolve this?</p>



<a name="217411410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217411410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Remco Overdevest <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217411410">(Nov 20 2020 at 15:01)</a>:</h4>
<p>running into the same problem here so following this</p>



<a name="217583144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217583144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217583144">(Nov 23 2020 at 02:22)</a>:</h4>
<p>so first of all, what version of HAPI are you using? I fixed up an issue like this a few months ago</p>



<a name="217593492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217593492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217593492">(Nov 23 2020 at 06:43)</a>:</h4>
<p>Are you using derived profiles? English pharmacy profiles (which are based on UK profiles), have this issue with 5.2 HAPI. 5.1 works still.</p>



<a name="217593663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217593663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217593663">(Nov 23 2020 at 06:46)</a>:</h4>
<p>Does the validator itself has this problem when run in standalone mode?</p>



<a name="217593926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217593926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217593926">(Nov 23 2020 at 06:52)</a>:</h4>
<p>No it's just when using hapi validation</p>



<a name="217599706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217599706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217599706">(Nov 23 2020 at 08:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  In my case it's <code> hapiproject/hapi:v5.1.0</code> from docker hub</p>



<a name="217612812"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217612812" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Remco Overdevest <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217612812">(Nov 23 2020 at 10:46)</a>:</h4>
<p>I managed to import the <code>nictiz.fhir.nl.stu3.zib2017 2.0.0</code> implementation guide package by using the version including snapshots. Now running into the next problem with the package <code>nictiz.fhir.nl.stu3.geboortezorg</code> with the following stacktrace:</p>
<div class="codehilite"><pre><span></span><code>Caused by: org.hl7.fhir.exceptions.DefinitionException: Attempt to a slice an element that does not repeat: EpisodeOfCare.diagnosis.condition/EpisodeOfCare.diagnosis.condition from http://fhir.nl/fhir/StructureDefinition/nl-core-episodeofcare in , at element EpisodeOfCare.diagnosis.condition (slice = pregnancy)
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1362)
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1025)
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1025)
    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:612)
    at org.hl7.fhir.common.hapi.validation.support.SnapshotGeneratingValidationSupport.generateSnapshot(SnapshotGeneratingValidationSupport.java:104)
    ... 96 common frames omitted
</code></pre></div>



<a name="217619297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217619297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217619297">(Nov 23 2020 at 12:01)</a>:</h4>
<p><span class="user-mention" data-user-id="365684">@Remco Overdevest</span>  I have had similar errors with other nictiz profiles. I think in those cases the exception is correct, and this  has to be fixed in the profile (StructureDefinition). you can try to report it at <a href="https://bits.nictiz.nl/">https://bits.nictiz.nl/</a></p>



<a name="217619454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217619454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217619454">(Nov 23 2020 at 12:03)</a>:</h4>
<p><span class="user-mention" data-user-id="365684">@Remco Overdevest</span>  what do you mean by "the version including snapshots"? do you have a link?</p>



<a name="217619766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217619766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Remco Overdevest <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217619766">(Nov 23 2020 at 12:06)</a>:</h4>
<p><a href="https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/2.0.3">https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/2.0.3</a> top right <code>Download</code> dropdown and click <code>Download snapshots</code>.</p>



<a name="217632668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217632668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217632668">(Nov 23 2020 at 14:19)</a>:</h4>
<p><span class="user-mention" data-user-id="365684">@Remco Overdevest</span>  i just noticed that, from the stracktrace,  it looks like you're using HL7 FHIR version "r5", while the profile <code>nictiz.fhir.nl.stu3.geboortezorg</code> is based on STU3. this might also cause issues?</p>



<a name="217637180"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/217637180" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Remco Overdevest <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#217637180">(Nov 23 2020 at 14:56)</a>:</h4>
<p><span class="user-mention" data-user-id="294094">@Job Schipper</span> I've noticed that as well but after debugging it seems that the r5 classes are always used with a <code>VersionSpecificWorkerContextWrapper</code>.  This class contains the correct FhirContext(DSTU3). Thanks for checking tho.</p>



<a name="222278276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/222278276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#222278276">(Jan 11 2021 at 10:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  i'm still experiencing this issue. I previously worked around it by removing this profile, but now I do need it. Can you confirm if the fix you mentioned was before or after v5.1.0 ?</p>



<a name="222285688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/%22Failed%20to%20generate%20snapshot%22%20while%20validating/near/222285688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/.22Failed.20to.20generate.20snapshot.22.20while.20validating.html#222285688">(Jan 11 2021 at 11:30)</a>:</h4>
<p>FYI, I now managed to import the package that already contains the snapshots as Remco suggested, so I'm no longer depending on the geneation. Hopefully the fix you mentioned was implemented after v5.1.0, if not I can supply more information to reproduce it on that version.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
