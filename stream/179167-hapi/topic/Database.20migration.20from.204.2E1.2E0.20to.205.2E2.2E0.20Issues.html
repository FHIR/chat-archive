---
layout: page
title: "FHIR Chat  · Database migration from 4.1.0 to 5.2.0 Issues · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Database.20migration.20from.204.2E1.2E0.20to.205.2E2.2E0.20Issues.html">Database migration from 4.1.0 to 5.2.0 Issues</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="222135696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Database%20migration%20from%204.1.0%20to%205.2.0%20Issues/near/222135696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Atterberry <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Database.20migration.20from.204.2E1.2E0.20to.205.2E2.2E0.20Issues.html#222135696">(Jan 08 2021 at 22:43)</a>:</h4>
<p>We’re leveraging the Migrator in the hapi-fhir-jpaserver-migrate project to migrate a HAPI FHIR version 4.1.0 database to a 5.2.0 database. There are a few tasks that need to be skipped in order to complete the conversion successfully. We made no modifications to the 4.1.0 schema. It looks to be related to dropping constraints. In all the cases the original constraint (create unique index …) was mapping to one or a set of columns on the table. The new constraint of the same name added a column or columns.</p>
<p>For us, the following tasks had to be skipped:</p>
<p>5_1_0.20200910.2<br>
5_1_0.20200923.3<br>
5_1_0.20201028.2</p>
<p>Any insights would be appreciated.</p>
<p>Thanks.</p>



<a name="222159543"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Database%20migration%20from%204.1.0%20to%205.2.0%20Issues/near/222159543" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Database.20migration.20from.204.2E1.2E0.20to.205.2E2.2E0.20Issues.html#222159543">(Jan 09 2021 at 07:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span></p>



<a name="222183100"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Database%20migration%20from%204.1.0%20to%205.2.0%20Issues/near/222183100" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Database.20migration.20from.204.2E1.2E0.20to.205.2E2.2E0.20Issues.html#222183100">(Jan 09 2021 at 18:36)</a>:</h4>
<p>Hmm, these are all tasks that drop indexes and as you point out it's mostly just because new indexes will be created with additional columns.</p>
<p>Why did you have to skip them? Can you just manually drop the unwanted indexes?</p>



<a name="222198080"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Database%20migration%20from%204.1.0%20to%205.2.0%20Issues/near/222198080" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Atterberry <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Database.20migration.20from.204.2E1.2E0.20to.205.2E2.2E0.20Issues.html#222198080">(Jan 10 2021 at 00:57)</a>:</h4>
<p>If I don't skip them, I get a non existent index error even though the index is there.  I'm on a Mac using Oracle XE in a Docker container.  It's pretty repeatable.  I just start up the jpa server and allow the database to be created.  I run the migrator and I get the following for the first constraint:</p>
<p>Caused by: org.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException for SQL [ALTER TABLE TRM_CONCEPT_MAP DROP CONSTRAINT IDX_CONCEPT_MAP_URL]; SQL state [72000]; error code [2443]; ORA-02443: Cannot drop constraint  - nonexistent constraint<br>
; nested exception is java.sql.SQLException: ORA-02443: Cannot drop constraint  - nonexistent constraint</p>



<a name="222598588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Database%20migration%20from%204.1.0%20to%205.2.0%20Issues/near/222598588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Atterberry <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Database.20migration.20from.204.2E1.2E0.20to.205.2E2.2E0.20Issues.html#222598588">(Jan 13 2021 at 15:36)</a>:</h4>
<p>Update:  This now looks like a database issue.  </p>
<p>I had two schemas in the Oracle XE instance with the identical structure as generated by starting up the JPA server.  My plan was to leave one schema as is and use the other to apply the migration and then do some comparisons.  The first schema was always there when I introduced the second identical schema and the migration on the second always failed.  Once I removed the second identical schema and applied the migration to the first schema it worked fine.  I have now created two instances of Oracle XE and will do the comparisons that way.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
