---
layout: page
title: "FHIR Chat  · Storing multiple resources at once using Bundle · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Storing.20multiple.20resources.20at.20once.20using.20Bundle.html">Storing multiple resources at once using Bundle</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="182962414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Storing%20multiple%20resources%20at%20once%20using%20Bundle/near/182962414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pelle Wielinga <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Storing.20multiple.20resources.20at.20once.20using.20Bundle.html#182962414">(Dec 09 2019 at 14:54)</a>:</h4>
<p>I'm having some trouble trying to store multiple resources in a single request. If I understand correctly the best way to do this would be using a batch or transaction. Here is some Kotlin code I've been trying with Hapi (both server and client at version 3.8.0). </p>
<div class="codehilite"><pre><span></span>val bundle = Bundle()
bundle.type = Bundle.BundleType.BATCH

conditions.forEach { condition -&gt;
    bundle.addEntry()
            .setResource(condition)
            .request
                    .setUrl(&quot;Condition&quot;)
                    .setMethod(Bundle.HTTPVerb.POST)
}

client.transaction().withBundle(bundle).execute()
</pre></div>


<p>Unfortunately the server is giving me the following error:</p>
<div class="codehilite"><pre><span></span>HTTP 400 : This is the base URL of FHIR server. Unable to handle this request, as it does not contain a resource type or operation name.
</pre></div>


<p>I've tried with <code>Bundle.BundleType.TRANSACTION</code> and with <code>client.transaction().withResources(conditions).execute()</code> as well but both give the same error.</p>
<p>If I don't use my own Hapi server but the one on <code>https://fhirtest.uhn.ca/</code> it does seem to work. Here I've pasted the generated XML in the "transaction" box on the home page. Is there something I need to configure on my Hapi server to make this work?</p>



<a name="182963594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Storing%20multiple%20resources%20at%20once%20using%20Bundle/near/182963594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Storing.20multiple.20resources.20at.20once.20using.20Bundle.html#182963594">(Dec 09 2019 at 15:07)</a>:</h4>
<p>you have to use a transaction bundle and send it against the base url of the FHIR server.</p>



<a name="182963829"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Storing%20multiple%20resources%20at%20once%20using%20Bundle/near/182963829" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Storing.20multiple.20resources.20at.20once.20using.20Bundle.html#182963829">(Dec 09 2019 at 15:09)</a>:</h4>
<p><code>client.transaction().withBundle(bundle).execute()</code>would be the correct one for sending a transaction bundle to the server.</p>



<a name="182965063"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Storing%20multiple%20resources%20at%20once%20using%20Bundle/near/182965063" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pelle Wielinga <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Storing.20multiple.20resources.20at.20once.20using.20Bundle.html#182965063">(Dec 09 2019 at 15:20)</a>:</h4>
<p>Well, this is what I'm doing. This is what I am doing to create the client:</p>
<div class="codehilite"><pre><span></span>        val context = FhirContext.forR4().restfulClientFactory
        val tokenInterceptor = BearerTokenAuthInterceptor(token)

        client = context.newGenericClient(&quot;http://localhost:8080/fhir&quot;)
        client.registerInterceptor(tokenInterceptor)
</pre></div>


<p>I can see a request to <code>http://localhost:8080/fhir</code> with the bundle as an xml body.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
