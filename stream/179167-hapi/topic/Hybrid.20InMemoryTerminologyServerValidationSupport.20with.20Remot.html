---
layout: page
title: "FHIR Chat  · Hybrid InMemoryTerminologyServerValidationSupport with Remot · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html">Hybrid InMemoryTerminologyServerValidationSupport with Remot</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="260506001"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/260506001" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#260506001">(Nov 06 2021 at 10:39)</a>:</h4>
<p>In our validator we are primarily using the InMemoryTerminologyServerValidationSupport class but for SNOMED and other large codesystems we want to pass that to a Terminology Server.</p>
<p>At present I've created an extension InMemoryTerminologyServerValidationSupport with parts of RemoteTerminologyServiceValidationSupport</p>
<p>So if the codeSystem is SNOMED it is sent to the  validation is sent in, it uses code from RemoteTerminologyServiceValidationSupport  </p>
<p><a href="https://github.com/NHSDigital/validation-service-fhir-r4/blob/feature/terminologyServer/src/main/kotlin/com/example/fhirvalidator/shared/TerminologyValidationSupport.java">https://github.com/NHSDigital/validation-service-fhir-r4/blob/feature/terminologyServer/src/main/kotlin/com/example/fhirvalidator/shared/TerminologyValidationSupport.java</a></p>
<p>Is this the right way to do this? <br>
I've not missed a different approach.</p>



<a name="260537341"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/260537341" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#260537341">(Nov 06 2021 at 21:34)</a>:</h4>
<p>That's a decent approach.</p>



<a name="260537421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/260537421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#260537421">(Nov 06 2021 at 21:36)</a>:</h4>
<p>We have something similar in our server where it uses the local TS implementation, and if it doesn't know about the valueaet/codesystem calls out to a remote system if configured.</p>



<a name="260649711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/260649711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#260649711">(Nov 08 2021 at 12:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191687">@Kevin Mayfield</span> i think you also could just add both terminology services to the validation chain. The Chain will then try to pick the validation service capable of this VS/CS</p>



<a name="260652885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/260652885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#260652885">(Nov 08 2021 at 12:58)</a>:</h4>
<p>I'll have another look. I think the InMemory validation was rejecting resources the RemoteValidation could handle (It had the ValueSet but not CodeSystem?)</p>



<a name="261891555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/261891555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#261891555">(Nov 18 2021 at 06:44)</a>:</h4>
<p>We're back with two classes. </p>
<p>Roughly the problem we have is </p>
<p>We have ValueSets in the the validator which reference external CodeSystems (in a remote terminology server)</p>
<p>So we are overriding validateCodeInValueSet in  InMemoryTerminologyServerValidationSupport to disable validation of these valuesets (if the codesystem is on a terminology server)<br>
Also overriding validateCode in RemoteTerminologyServiceValidationSupport to use the validator ValueSet (not the one on the remote terminology server).</p>
<p>Wondering if their is a better way of doing this\?</p>



<a name="261921564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/261921564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#261921564">(Nov 18 2021 at 12:42)</a>:</h4>
<p>to do what exactly?</p>



<a name="261969244"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/261969244" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#261969244">(Nov 18 2021 at 18:28)</a>:</h4>
<p>Personally I'd do the following: Create your own class that extends RemoteTerminologyServiceValidationSupport and put it at the very top of the chain, but also put InMemory farther down the chain.</p>
<p>In your extended class, override the validateCode methods so that they return null when the system is not one you want handed by the remote service. When a validateCode method returns null the chain moves on to the next item in the chain.</p>



<a name="262043202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/262043202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#262043202">(Nov 19 2021 at 09:15)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191319">@James Agnew</span> </p>
<p>It does look like that would nearly work. I think we may be suggesting changing this </p>
<p>protected CodeValidationResult invokeRemoteValidateCode<br>
(<a href="https://github.com/hapifhir/hapi-fhir/blob/92e98592724afcbb4476ecb7eefb7d3915cf21b0/hapi-fhir-validation/src/main/java/org/hl7/fhir/common/hapi/validation/support/RemoteTerminologyServiceValidationSupport.java#L182">https://github.com/hapifhir/hapi-fhir/blob/92e98592724afcbb4476ecb7eefb7d3915cf21b0/hapi-fhir-validation/src/main/java/org/hl7/fhir/common/hapi/validation/support/RemoteTerminologyServiceValidationSupport.java#L182</a>)</p>
<p>So it is accessible in our override methods for validateCode and validateCodeInValuSet <br>
(we want to pass a ValueSet to the terminology server not a valueSet.url as we want to use our definition not the terminology servers definition)</p>



<a name="266912970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/266912970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#266912970">(Jan 05 2022 at 09:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191687">@Kevin Mayfield</span> I believe it would be very valuable to the community to have an exmaple hybrid validation support module as part of the HAPI FHIR starter project as it is common to have the large codesystems like LOINC and SNOMED placed on an already existing terminology server (<span class="user-mention" data-user-id="191451">@Patrick Werner</span>  / <span class="user-mention" data-user-id="191478">@Oliver Egger</span> don't you guys agree?). Would you care to draft a PR to the starter project that enables this feature?</p>



<a name="266916951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/266916951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#266916951">(Jan 05 2022 at 10:06)</a>:</h4>
<p>yep willing to contribute.</p>



<a name="267052645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/267052645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#267052645">(Jan 06 2022 at 11:56)</a>:</h4>
<p>i agree. Ideally configurable through the application.yaml</p>



<a name="270086683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/270086683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#270086683">(Jan 31 2022 at 19:05)</a>:</h4>
<p><span class="user-mention" data-user-id="191687">@Kevin Mayfield</span> any progress on the contribution?</p>



<a name="270174441"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/270174441" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#270174441">(Feb 01 2022 at 09:18)</a>:</h4>
<p>I'm still working on getting suport/permission.</p>



<a name="270328600"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/270328600" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#270328600">(Feb 02 2022 at 03:34)</a>:</h4>
<p>How well does this work when the ValueSet in question includes codes from both local and remote code systems?</p>



<a name="270343306"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Hybrid%20InMemoryTerminologyServerValidationSupport%20with%20Remot/near/270343306" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Hybrid.20InMemoryTerminologyServerValidationSupport.20with.20Remot.html#270343306">(Feb 02 2022 at 07:13)</a>:</h4>
<p>That 'can' be considered a case not supported</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
