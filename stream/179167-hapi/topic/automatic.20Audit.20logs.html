---
layout: page
title: "FHIR Chat  · automatic Audit logs · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html">automatic Audit logs</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="174547273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174547273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174547273">(Aug 30 2019 at 14:03)</a>:</h4>
<p>Does the HAPI server auto generate AuditEvent records for all api access? Is this a configurable setting? also see my discussion on how this enables privacy Audit on <a class="stream" data-stream-id="179247" href="/#narrow/stream/179247-Security-and-Privacy">#Security and Privacy</a></p>



<a name="174678740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174678740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174678740">(Sep 01 2019 at 21:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> - Not currently. I mean, certainly all of the framework is there for someone to be able to implement this kind of rule using our interceptors.. But there is nothing out of the box.</p>
<p>Would this be a useful thing to add? I could certainly see it being fairly easy to build at least..</p>



<a name="174697874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174697874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174697874">(Sep 02 2019 at 07:53)</a>:</h4>
<p>I reckon this would be  a very nice feature to have out-of-the-box <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="174782091"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174782091" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174782091">(Sep 03 2019 at 12:16)</a>:</h4>
<p>I, as a Privacy advocate and Security professional, think it is essential to have. It is available in a few other platforms, and is configurable with default off. The reason is that auditEntry will quickly overwhelm the total real data. Also there should be some purge rule, with a default purge rule of something like a nothing-older-than-a-year.</p>



<a name="174787794"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174787794" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174787794">(Sep 03 2019 at 13:29)</a>:</h4>
<p>I, as a potential patient, also think this is important.</p>



<a name="174797307"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174797307" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174797307">(Sep 03 2019 at 15:07)</a>:</h4>
<blockquote>
<p>Does the HAPI server auto generate AuditEvent records for all api access? Is this a configurable setting? also see my discussion on how this enables privacy Audit on <a class="stream" data-stream-id="179247" href="/#narrow/stream/179247-Security-and-Privacy">#Security and Privacy</a></p>
</blockquote>
<p>see this thread for further development and CR recommending it</p>



<a name="174798808"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174798808" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174798808">(Sep 03 2019 at 15:21)</a>:</h4>
<p>Makes sense. Seems worth trying to implement.</p>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> how would you foresee things like search results (and page loads for subsequent pages of search results) working? A single AuditEvent gets created with <code>AuditEvent.entity</code> references to each resource that appeared in the search results?</p>
<p>Also, WRT adding this to our public test server: are there any concerns with the fact that presumably we'd now be making it possible for someone to check which IPs had recently accessed the test server? How have other test servers addressed this? I guess I could mask the IP address..</p>



<a name="174799188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174799188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174799188">(Sep 03 2019 at 15:25)</a>:</h4>
<p>for search/query/operations that return many results, you do NOT duplicate the result in the AuditEvent. You record the query/operation parameters in an .entity, and another .entity holds the Patient. When the results include more than one patient's data, then multiple AuditEvent resources are recorded, one for each patient.</p>



<a name="174799628"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174799628" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174799628">(Sep 03 2019 at 15:30)</a>:</h4>
<p>Ahhh interesting. I guess in my mind I've always seen AuditEvent as a complete record of "who has seen what" but that makes a lot of sense for it to be fully centred around the more specific question of "who has seen which patients" at least as a default use case.</p>



<a name="174799813"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/174799813" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#174799813">(Sep 03 2019 at 15:32)</a>:</h4>
<p>I guess this behavior on query/search/operations did not get mentioned on the AuditEvent page. I guess that should be another CR?</p>



<a name="175727662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/175727662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#175727662">(Sep 15 2019 at 01:55)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> did you happen to get audit logging into your server? I have a patient app for notifying a patient when activity on their subject based on AuditEvent activity. Just wondering if you implemented this in an experimental way, or in a way that is not turned on in your sandbox servers</p>



<a name="175727947"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/175727947" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#175727947">(Sep 15 2019 at 02:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span>  not yet- will try to do this in the AM. would be fun to test while you're around the connectathon</p>



<a name="175728064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/175728064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#175728064">(Sep 15 2019 at 02:08)</a>:</h4>
<p>Im around all week...</p>



<a name="205052917"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205052917" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Virendra Shinde <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205052917">(Jul 26 2020 at 13:44)</a>:</h4>
<p>Did either of you went ahead and implemented the AuditEvent in HAPI ?</p>



<a name="205053122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205053122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205053122">(Jul 26 2020 at 13:50)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> if you are interested, we actually have done this</p>



<a name="205053124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205053124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205053124">(Jul 26 2020 at 13:51)</a>:</h4>
<p>In HAPI</p>



<a name="205053137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205053137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205053137">(Jul 26 2020 at 13:51)</a>:</h4>
<p>With it being patient centric</p>



<a name="205053356"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205053356" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205053356">(Jul 26 2020 at 13:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span></p>



<a name="205053437"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205053437" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205053437">(Jul 26 2020 at 14:01)</a>:</h4>
<p>+1</p>



<a name="205377194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205377194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205377194">(Jul 29 2020 at 16:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191427">@Jens Villadsen</span>  I'm curious to know how did you achieve it. Can you help?</p>



<a name="205420458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205420458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205420458">(Jul 29 2020 at 22:19)</a>:</h4>
<p>We ended up implementing an interceptor invoked on the pointcuts for  SERVER_OUTGOING_RESPONSE, STORAGE_PRECOMMIT_RESOURCE_CREATED, STORAGE_PRECOMMIT_RESOURCE_UPDATED, STORAGE_PRECOMMIT_RESOURCE_DELETED and SERVER_INCOMING_REQUEST_PRE_HANDLED. Be cautious about when you actually generate the auditevent as the point cuts are hit by multiple threads pr request, which means you must delay invocation of the actual generation of auditevent until you get a call to the pointcut SERVER_PROCESSING_COMPLETED from the main thread of the request again. We successfully got it  to work as intended over XA meaning that our auditevents are put on a queue for async processing iff data is to be returned to a user</p>



<a name="205448161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205448161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205448161">(Jul 30 2020 at 07:20)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191427">@Jens Villadsen</span> this is really helpful. i would further investigate it. For us, its mostly READ operations for now. I think pointcuts for SERVER_INCOMING_REQUEST_PRE_HANDLED and SERVER_OUTGOING_RESPONSE should be helpful. Is there any way we can map the request with a response sharing the same AuditEvent resource or something like that? we also need to parse the request headers. Any suggestions will be appreciated. Thanks so much</p>



<a name="205449453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205449453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205449453">(Jul 30 2020 at 07:38)</a>:</h4>
<p>That is what you need to do by eg. storing the request in the servletRequestDetails so that you can retrieve later on in the SERVER_PROCESSING_COMPLETED pointcut. Be aware that if you intend to produce this on READ, then you also should produce it on SEARCH at least.</p>



<a name="205558145"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205558145" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205558145">(Jul 31 2020 at 05:05)</a>:</h4>
<p>Sure, <span class="user-mention" data-user-id="191427">@Jens Villadsen</span>  We will have to do for search as well. Where do you suggest that we store the request. Do you have any recommendations? Do you think that we should maintain in a map or something in the application layer? </p>
<p>Thanks for your time and support.</p>



<a name="205566548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205566548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205566548">(Jul 31 2020 at 07:56)</a>:</h4>
<p>you have the request in the ServletRequestDetails so you can access the contents there</p>



<a name="205567220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/automatic%20Audit%20logs/near/205567220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/automatic.20Audit.20logs.html#205567220">(Jul 31 2020 at 08:04)</a>:</h4>
<p>oh, I got it. Thanks..  Sorry, I missed it.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
