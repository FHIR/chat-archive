---
layout: page
title: "FHIR Chat  · QuestionnaireResponse with contained Questionnaire · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html">QuestionnaireResponse with contained Questionnaire</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="255433259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/255433259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#255433259">(Sep 29 2021 at 16:50)</a>:</h4>
<p><span class="user-mention" data-user-id="194948">@Raheel Sayeed</span> asked at <a href="#narrow/stream/179166-implementers/topic/Open.20FHIR.20Servers.20that.20support.20Contained.20Resource/near/255396789">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Open.20FHIR.20Servers.20that.20support.20Contained.20Resource/near/255396789</a> about the behavior of some HAPI-based servers including the SMART and Logica sandboxes, where Questionnaires contained within QuestionnaireResponses are stripped at creation time. Is there a HAPI setting that might be responsible for this behavior?</p>



<a name="255448297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/255448297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Venton <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#255448297">(Sep 29 2021 at 18:21)</a>:</h4>
<p>Last I knew there was a bug in HAPI. There are 3 categories of contained resources allowed. 1) Resources that are referenced by the wrapper resource 2) Resources that are referenced by a(nother) resource in the contained list 3) Resources that reference the wrapper resource.</p>
<p>When I was dealing with this, if your contained resource is of category 3, then HAPI doesn't honor that when serializing the resource. It only honors categories 1 and 2. In my case I was trying to stash the Provenance resource into the .contained list. In order to get HAPI to work, I had to code the Provenance to reference itself.</p>



<a name="255456090"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/255456090" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raheel Sayeed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#255456090">(Sep 29 2021 at 19:06)</a>:</h4>
<p>1, 2 did work .But this issue seems to specifically affect QuestionnaireResponse resource type when it contains and references its own Questionnaire.</p>



<a name="255456268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/255456268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raheel Sayeed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#255456268">(Sep 29 2021 at 19:07)</a>:</h4>
<p>Also noting--&gt;  UHN HAPI FHIR @ <a href="http://hapi.fhir.org/baseR4">hapi.fhir.org/baseR4</a> did work. But not SMART and Logica sandboxes</p>



<a name="255522467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/255522467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#255522467">(Sep 30 2021 at 06:05)</a>:</h4>
<p>I think contained resources of type 3 are explicitly not allowed - <a href="https://www.hl7.org/fhir/references.html#contained">the spec says</a>:</p>
<blockquote>
<p>A contained resource SHALL only be included in a resource if something in that resource (potentially another contained resource) has a reference to it.</p>
</blockquote>



<a name="255523402"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/255523402" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#255523402">(Sep 30 2021 at 06:17)</a>:</h4>
<p>Is the issue here perhaps that QuestionnaireResponses reference Questionnaires through canonical URLs and that HAPI does not recognize that as a valid link? That is, maybe it only checks the <code>id</code> element in the contained resource and expects that to occur in a reference inside the wrapper resource or in another contained resource. But in the Q/QR case, the relevant ID used for referencing is the canonical in the <code>url</code> element. I'm not sure if the spec says smt. about that case.</p>



<a name="255527888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/255527888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#255527888">(Sep 30 2021 at 07:08)</a>:</h4>
<p>Indeed, the spec does say smt. about that, viz. that references by canonical are allowed:</p>
<blockquote>
<p>Both Reference and canonical types may refer to contained resources</p>
</blockquote>
<p>So it could be that HAPI has not yet implemented handling of such references for contained resources.</p>



<a name="255589113"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/255589113" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#255589113">(Sep 30 2021 at 15:00)</a>:</h4>
<p>I assume so. Hapi checks for references to or from the contained resource. If none are found the contained resource won‘t be serialized.</p>



<a name="256377341"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/256377341" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#256377341">(Oct 06 2021 at 08:41)</a>:</h4>
<p>Shouldn't the canonical be referencing the contained resource? Which would make it a type 1 reference from your list? Otherwise you'd need an extension under the questionnaire canonical ref field in the QR</p>



<a name="256422543"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/256422543" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#256422543">(Oct 06 2021 at 14:41)</a>:</h4>
<p>I ran into an issue while working with "contained" resource using HAPI. Wondering if people have seen this issue?  Would appreciate any help to resolve the issue. We are using ca.uhn.hapi.fhir:hapi-fhir-base:5.3.0 and the same version of FHIR structure. The issue is that I can't get the "contained" resources when using the context jsonParser to convert the json string to IResource. I can see the Resource in the contained list but when trying to referencing it, got null. In the mean time, setContained() and addContained() don't work either if I manually create a QuestionnaireResponse and trying to set one Questionnaire in the contained list.  Here is the screen shot from my debugger: I can see the "Id" and "meta" but the Quesstionnaire is shown as null. <a href="/user_uploads/10155/IBref1chIliOCiafdpDpJi4Q/Screen-Shot-2021-10-06-at-10.38.27-AM.png">Screen-Shot-2021-10-06-at-10.38.27-AM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/IBref1chIliOCiafdpDpJi4Q/Screen-Shot-2021-10-06-at-10.38.27-AM.png" title="Screen-Shot-2021-10-06-at-10.38.27-AM.png"><img src="/user_uploads/10155/IBref1chIliOCiafdpDpJi4Q/Screen-Shot-2021-10-06-at-10.38.27-AM.png"></a></div><p>I am using the cannonical reference: Here is the JSON payload:<br>
{ <br>
        "resourceType": "QuestionnaireResponse",<br>
        "meta": {<br>
          "profile": [<br>
            "<a href="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse-adapt">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse-adapt</a>"<br>
          ]<br>
        },<br>
        "contained": [<br>
          {<br>
            "resourceType": "Questionnaire",<br>
            "id": "q",<br>
            "meta": {<br>
              "profile": [<br>
                "<a href="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-adapt">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-adapt</a>"<br>
              ]<br>
            }<br>
          }<br>
        ], <br>
        "questionnaire": "#q",<br>
        "status": "in-progress"<br>
      }</p>



<a name="256474996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/256474996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#256474996">(Oct 06 2021 at 20:01)</a>:</h4>
<p>By casting IBaseResource to IDomainResource solved the parsing issue.</p>



<a name="256497386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/QuestionnaireResponse%20with%20contained%20Questionnaire/near/256497386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yolanda <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/QuestionnaireResponse.20with.20contained.20Questionnaire.html#256497386">(Oct 06 2021 at 22:57)</a>:</h4>
<p>Here is the problem with another direction. I am setting the contained with setContained() or addContained(), then use ctx.newJsonParser().encodeResourceToString(Resource). The method encodeResourceToString takes IBaseResource, after that, I don't see the "contained" is retained anymore. Any thoughts?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
