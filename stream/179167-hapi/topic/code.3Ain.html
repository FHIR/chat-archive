---
layout: page
title: "FHIR Chat  · code:in · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html">code:in</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="209570180"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/209570180" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#209570180">(Sep 09 2020 at 21:19)</a>:</h4>
<p>I tried this on Logica, locally running, and on the R4 test server with the same results. I can't seem to get code:in to work when using snomed (for some reason ICD-10 examples I tried did work)? Any ideas?</p>
<p>Here is the ValueSet: <br>
<a href="http://hapi.fhir.org/baseR4/ValueSet?url=http://foo.com/ValueSet/conditions-T2DM-sct-small">http://hapi.fhir.org/baseR4/ValueSet?url=http://foo.com/ValueSet/conditions-T2DM-sct-small</a></p>
<p>Here is Condition that should be found:<br>
<a href="http://hapi.fhir.org/baseR4/Condition/1461176">http://hapi.fhir.org/baseR4/Condition/1461176</a></p>
<p>But this shows empty set:<br>
<a href="http://hapi.fhir.org/baseR4/Condition?code:in=http://foo.com/ValueSet/conditions-T2DM-sct-small">http://hapi.fhir.org/baseR4/Condition?code:in=http://foo.com/ValueSet/conditions-T2DM-sct-small</a></p>



<a name="209834996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/209834996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#209834996">(Sep 11 2020 at 21:03)</a>:</h4>
<p>Also asked this in implementors channel. </p>
<p>Today I discovered something interesting about this problem:<br>
     If I used an ICD10 ValueSet, i.e.  "system": "<a href="http://hl7.org/fhir/sid/icd-10">http://hl7.org/fhir/sid/icd-10</a>"<br>
     the code:in search worked.  </p>
<p>However, if I used a SNOMED or a LOINC coding system in the ValueSet it did NOT work.   That seems very strange?</p>



<a name="224057013"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/224057013" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Denning <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#224057013">(Jan 26 2021 at 15:41)</a>:</h4>
<p>I was wondering if the CapabilityStatement should explicitly indicate if  'code:in' is supported.  See <a href="https://jira.hl7.org/browse/FHIR-30631">https://jira.hl7.org/browse/FHIR-30631</a></p>



<a name="226890448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/226890448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a>  Bob Milius <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#226890448">(Feb 18 2021 at 22:09)</a>:</h4>
<p>Bumping this topic. <br>
I would like to search for Observations with a code found in a ValueSet. Can someone show me an example of a successful search with <code>code:in</code> with HAPI? I'd like to create a valueset with a set of LOINC codes and search for all Observations that are found in that set. I first tried with it with an already existing ValueSet (observation-vitalsignresult), but it didn't return anything, even though I know the fhir server has Observations with codes found in this set.</p>
<div class="codehilite"><pre><span></span><code>http://hapi.fhir.org/baseR4/Observation?code:in=http://hl7.org/fhir/ValueSet/observation-vitalsignresult
</code></pre></div>



<a name="226990638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/226990638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#226990638">(Feb 19 2021 at 16:38)</a>:</h4>
<p>Some further exploration ...</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>ValueSet</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href="http://hapi.fhir.org/baseR4/ValueSet?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult">http://hapi.fhir.org/baseR4/ValueSet?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult</a>'<br>
{<br>
  "resourceType": "Bundle",<br>
  "id": "16ab9c70-4d25-4cfb-ab32-b2f5aecdc0ac",<br>
  "meta": {<br>
    "lastUpdated": "2021-02-19T16:20:18.248+00:00"<br>
  },<br>
  "type": "searchset",<br>
  "total": 1,<br>
  "link": [ {<br>
    "relation": "self",<br>
    "url": "<a href="http://hapi.fhir.org/baseR4/ValueSet?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult">http://hapi.fhir.org/baseR4/ValueSet?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult</a>"<br>
  } ],<br>
  "entry": [ {<br>
    "fullUrl": "<a href="http://hapi.fhir.org/baseR4/ValueSet/observation-vitalsignresult">http://hapi.fhir.org/baseR4/ValueSet/observation-vitalsignresult</a>",<br>
    "resource": {<br>
      "resourceType": "ValueSet",<br>
      "id": "observation-vitalsignresult",<br>
      "meta": {<br>
        "versionId": "1",<br>
        "lastUpdated": "2020-01-13T23:45:14.328+00:00",<br>
        "source": "#txfUBM5pOtfNZNy3",<br>
        "profile": [ "<a href="http://hl7.org/fhir/StructureDefinition/shareablevalueset">http://hl7.org/fhir/StructureDefinition/shareablevalueset</a>" ]<br>
      },<br>
      "extension": [ {<br>
        "url": "<a href="http://hl7.org/fhir/StructureDefinition/structuredefinition-wg">http://hl7.org/fhir/StructureDefinition/structuredefinition-wg</a>",<br>
        "valueCode": "oo"<br>
      } ],<br>
      "url": "<a href="http://hl7.org/fhir/ValueSet/observation-vitalsignresult">http://hl7.org/fhir/ValueSet/observation-vitalsignresult</a>",<br>
      "identifier": [ {<br>
        "system": "urn:ietf:rfc:3986",<br>
        "value": "urn:oid:2.16.840.1.113883.3.88.12.80.62"<br>
      } ],<br>
      "version": "4.0.1",<br>
      "name": "VitalSigns",<br>
      "title": "Vital Signs",<br>
      "status": "active",<br>
      "experimental": false,<br>
      "date": "2019-11-01T09:29:23+11:00",<br>
      "publisher": "FHIR project team",<br>
      "contact": [ {<br>
        "telecom": [ {<br>
          "system": "url",<br>
          "value": "<a href="http://hl7.org/fhir">http://hl7.org/fhir</a>"<br>
        } ]<br>
      } ],<br>
      "description": "This value set indicates the allowed vital sign result types.   The LOINC code for Vitals Signs panel (85353-1) is a grouping structure for a set of vital signs and includes related links (with type=has-member) to the Observations in this set (e.g. respiratory rate, heart rate, BP).  The Blood pressure panel (85354-9) is used to group the component observations Systolic blood pressure (8480-6) and Diastolic blood pressure (8462-4).",<br>
      "copyright": "This content from LOINC® is copyright © 1995 Regenstrief Institute, Inc. and the LOINC Committee, and available at no cost under the license at <a href="http://loinc.org/terms-of-use">http://loinc.org/terms-of-use</a>",<br>
      "compose": {<br>
        "include": [ {<br>
          "system": "<a href="http://loinc.org">http://loinc.org</a>",<br>
          "concept": [ {<br>
            "code": "85353-1"<br>
          }, {<br>
            "code": "9279-1"<br>
          }, {<br>
            "code": "8867-4"<br>
          }, {<br>
            "code": "2708-6"<br>
          }, {<br>
            "code": "8310-5"<br>
          }, {<br>
            "code": "8302-2"<br>
          }, {<br>
            "code": "9843-4"<br>
          }, {<br>
            "code": "29463-7"<br>
          }, {<br>
            "code": "39156-5"<br>
          }, {<br>
            "code": "85354-9"<br>
          }, {<br>
            "code": "8480-6"<br>
          }, {<br>
            "code": "8462-4"<br>
          }, {<br>
            "code": "8478-0"<br>
          } ]<br>
        } ]<br>
      }<br>
    },<br>
    "search": {<br>
      "mode": "match"<br>
    }<br>
  } ]<br>
}</p>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>code:in search</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href="http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult</a>'<br>
{<br>
  "resourceType": "Bundle",<br>
  "id": "a5617f64-3b5e-4cda-b1ec-35c4d6e46f10",<br>
  "meta": {<br>
    "lastUpdated": "2021-02-19T16:17:08.069+00:00"<br>
  },<br>
  "type": "searchset",<br>
  "total": 0,<br>
  "link": [ {<br>
    "relation": "self",<br>
    "url": "<a href="http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult</a>"<br>
  } ]<br>
}</p>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>code:in search with misspelled ValueSet url</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href="http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresul">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresul</a>'<br>
{<br>
  "resourceType": "OperationOutcome",<br>
  "text": {<br>
    "status": "generated",<br>
    "div": "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\"0\"&gt;&lt;tr&gt;&lt;td style=\"font-weight: bold;\"&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Unknown ValueSet: http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresul&lt;/pre&gt;&lt;/td&gt;\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/table&gt;\n\t&lt;/div&gt;"<br>
  },<br>
  "issue": [ {<br>
    "severity": "error",<br>
    "code": "processing",<br>
    "diagnostics": "Unknown ValueSet: http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresul"<br>
  } ]<br>
}</p>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>search for specific code</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href="http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code=http%3A%2F%2Floinc.org%7C9279-1">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code=http%3A%2F%2Floinc.org%7C9279-1</a>'<br>
{<br>
  "resourceType": "Bundle",<br>
  "id": "3dfb67ff-8092-4691-b2d4-3dd503d81b34",<br>
  "meta": {<br>
    "lastUpdated": "2021-02-19T16:27:53.920+00:00"<br>
  },<br>
  "type": "searchset",<br>
  "link": [ {<br>
    "relation": "self",<br>
    "url": "<a href="http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code=http%3A%2F%2Floinc.org%7C9279-1">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code=http%3A%2F%2Floinc.org%7C9279-1</a>"<br>
  }, {<br>
    "relation": "next",<br>
    "url": "<a href="http://hapi.fhir.org/baseR4?_getpages=3dfb67ff-8092-4691-b2d4-3dd503d81b34&amp;_getpagesoffset=1&amp;_count=1&amp;_pretty=true&amp;_bundletype=searchset">http://hapi.fhir.org/baseR4?_getpages=3dfb67ff-8092-4691-b2d4-3dd503d81b34&amp;_getpagesoffset=1&amp;_count=1&amp;_pretty=true&amp;_bundletype=searchset</a>"<br>
  } ],<br>
  "entry": [ {<br>
    "fullUrl": "<a href="http://hapi.fhir.org/baseR4/Observation/1574883">http://hapi.fhir.org/baseR4/Observation/1574883</a>",<br>
    "resource": {<br>
      "resourceType": "Observation",<br>
      "id": "1574883",<br>
      "meta": {<br>
        "versionId": "1",<br>
        "lastUpdated": "2020-10-13T10:44:16.476+00:00",<br>
        "source": "#JGEeCwyhkF4uPqEz",<br>
        "profile": [ "<a href="http://hl7.org/fhir/StructureDefinition/vitalsigns">http://hl7.org/fhir/StructureDefinition/vitalsigns</a>", "<a href="http://hl7.org/fhir/StructureDefinition/resprate">http://hl7.org/fhir/StructureDefinition/resprate</a>" ]<br>
      },<br>
      "status": "final",<br>
      "category": [ {<br>
        "coding": [ {<br>
          "system": "<a href="http://terminology.hl7.org/CodeSystem/observation-category">http://terminology.hl7.org/CodeSystem/observation-category</a>",<br>
          "code": "vital-signs",<br>
          "display": "vital-signs"<br>
        } ]<br>
      } ],<br>
      "code": {<br>
        "coding": [ {<br>
          "system": "<a href="http://loinc.org">http://loinc.org</a>",<br>
          "code": "9279-1",<br>
          "display": "Respiratory rate"<br>
        } ],<br>
        "text": "Respiratory rate"<br>
      },<br>
      "subject": {<br>
        "reference": "Patient/1574669"<br>
      },<br>
      "encounter": {<br>
        "reference": "Encounter/1574875"<br>
      },<br>
      "effectiveDateTime": "2014-04-30T23:39:11+05:30",<br>
      "issued": "2014-04-30T23:39:11.202+05:30",<br>
      "valueQuantity": {<br>
        "value": 16,<br>
        "unit": "/min",<br>
        "system": "<a href="http://unitsofmeasure.org">http://unitsofmeasure.org</a>",<br>
        "code": "/min"<br>
      }<br>
    },<br>
    "search": {<br>
      "mode": "match"<br>
    }<br>
  } ]<br>
}</p>
</div></div>
<div class="spoiler-block"><div class="spoiler-header">
<p>ValueSet/$validate-code "Unable to expand ValueSet"</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href="http://hapi.fhir.org/baseR4/ValueSet/$validate-code?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult&amp;system=http%3A%2F%2Floinc.org&amp;code=9279-1">http://hapi.fhir.org/baseR4/ValueSet/$validate-code?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult&amp;system=http%3A%2F%2Floinc.org&amp;code=9279-1</a>'<br>
{<br>
  "resourceType": "Parameters",<br>
  "parameter": [ {<br>
    "name": "result",<br>
    "valueBoolean": false<br>
  }, {<br>
    "name": "message",<br>
    "valueString": "Unknown code {http://loinc.org}9279-1 - Unable to expand ValueSet[http://hl7.org/fhir/ValueSet/observation-vitalsignresult]"<br>
  } ]<br>
}</p>
</div></div>



<a name="234295884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/234295884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Moritz Kähler <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#234295884">(Apr 13 2021 at 09:39)</a>:</h4>
<p>Are there any news? I face the same problem, I'm unable to run a code:in query. Either the result is empty, unfiltered or I get an error message.</p>



<a name="234310789"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/234310789" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#234310789">(Apr 13 2021 at 11:53)</a>:</h4>
<p>I've had problems with code:in on HAPI before as well.   <br>
Try a few things related to your code:in search:</p>
<ul>
<li><a href="http://hapi.fhir.org/baseR4/ValueSet?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult">http://hapi.fhir.org/baseR4/ValueSet?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult</a>    this ValueSet is definitely there</li>
<li><a href="http://hapi.fhir.org/baseR4/Observation?code=8302-2">http://hapi.fhir.org/baseR4/Observation?code=8302-2</a>  -- and there are Observations that have codes in this ValueSet (Body Height in this example)</li>
<li><a href="http://hapi.fhir.org/baseR4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult">http://hapi.fhir.org/baseR4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult</a> . $expand works (shows as 'pre-calculated')</li>
<li><a href="http://hapi.fhir.org/baseR4/CodeSystem?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult">http://hapi.fhir.org/baseR4/CodeSystem?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult</a>  -  but no associated CodeSystem (I think)</li>
</ul>
<p>Does the code:in operation depend on CodeSystem?</p>



<a name="265204991"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/265204991" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a>  Bob Milius <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#265204991">(Dec 16 2021 at 19:15)</a>:</h4>
<p>bumping this... We would love to be able to search on <code>code:in</code>a valueset</p>



<a name="269401348"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/269401348" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Moritz Kähler <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#269401348">(Jan 26 2022 at 12:16)</a>:</h4>
<p>In Hapi 5.6 this issue is solved.<br>
To use :in operator you need to</p>
<ul>
<li>hibernate.search.enabled: true in yaml file</li>
<li>upload the valueSet</li>
<li>restart hapi server or wait for 10 minutes until the expansion of the valueSet is completed. (Running $expand operation does not help here)</li>
</ul>
<p>Here is an example query that worked for me<br>
<a href="http://localhost:8086/fhir/Observation?code:in=/myValueSetId">http://localhost:8086/fhir/Observation?code:in=/myValueSetId</a></p>
<div class="codehilite" data-code-language="valueset"><pre><span></span><code>{
  "resourceType": "ValueSet",
  "id": "myValueSetId",
  "meta": {
    "versionId": "1",
    "lastUpdated": "2022-01-25T08:46:11.675+00:00",
    "source": "#xa4kq6mWK4hapvjA"
  },
  "url": "/ValueSet/myValueSetId",
  "version": "1.0.0",
  "name": "MyValueSet",
  "status": "active",
  "date": "2018-04-07T06:53:01+10:00",
  "description": "tbd",
  "compose": {
    "include": [ {
      "system": "http://snomed.info/sct",
      "concept": [ {
        "code": "10268700 ",
        "display": "Prostate specific antigen (substance)"
      } ]
    }, {
      "system": "http://loinc.org",
      "concept": [ {
        "code": "2857-1",
        "display": "Prostate specific Ag [Mass/volume] in Serum or Plasma"
      } ]
    } ]
  }
}
</code></pre></div>
<p>(Please note that I used local references)</p>



<a name="269604943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/code%3Ain/near/269604943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jayesh iyer <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/code.3Ain.html#269604943">(Jan 27 2022 at 17:13)</a>:</h4>
<p>Thank you Moritz for this detailed example and explanation of how to get this search to work. I was able to get this to work using these tips.</p>
<p>Thank you very much! <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
