---
layout: page
title: "FHIR Chat  · Source code...Generate contained xml from Java HAPI Bundle？ · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Source.20code.2E.2E.2EGenerate.20contained.20xml.20from.20Java.20HAPI.20Bundle.EF.BC.9F.html">Source code...Generate contained xml from Java HAPI Bundle？</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153847554"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Source%20code...Generate%20contained%20xml%20from%20Java%20HAPI%20Bundle%EF%BC%9F/near/153847554" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jingdong(JD) Li <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Source.20code.2E.2E.2EGenerate.20contained.20xml.20from.20Java.20HAPI.20Bundle.EF.BC.9F.html#153847554">(Sep 17 2016 at 11:59)</a>:</h4>
<p>I have a bundle resource structured like:  bundle/entry/resourece/DiagnosticReport/contained/List/contained/Observation, using Java FHIR HAPI, somehow,  the contained portions were not convered to XML using FHIR context parser. Cannot figure out what I did wrong.  Thanks in advance.</p>
<p>Below is my testing  code (in Java)<br>
===========================================================<br>
public class FHIRContaintedTest {<br>
    private Logger logger;<br>
    public FHIRContaintedTest(){<br>
        System.setProperty("log4j.configurationFile",    FHIRContaintedTest.class.getClassLoader().getResource("log4j2.xml").toString());<br>
        logger = LogManager.getLogger(FHIRContaintedTest.class.getName());<br>
    }<br>
public static void main(String[] args) {<br>
        FhirContext ctx = FhirContext.forDstu2();<br>
        IParser parser = ctx.newXmlParser().setPrettyPrint(true);<br>
        FHIRMaker fm = new FHIRMaker();<br>
        FHIRContaintedTest fc = new FHIRContaintedTest();<br>
        Bundle bundle = fm.makeBundle("JD-Bundle");<br>
        bundle.setType(BundleTypeEnum.COLLECTION);<br>
        Entry rootEntry = fm.makeBundleEntry("JD-Entry");<br>
        DiagnosticReport dxReport = fm.makeDiagnosticReport("JD-Drpt");<br>
        ListResource lstRsc = fm.makeListRsc("JD-ListRsc");<br>
        Observation obs = fm.makeObservation("JD-Obs");<br>
        //add Observation to ListResource.contained<br>
        fc.addToContained(obs, lstRsc);<br>
        //add ListResource to DiagnosticReport.contained<br>
        fc.addToContained(lstRsc, dxReport);<br>
        rootEntry.setResource(dxReport);<br>
        bundle.addEntry(rootEntry);<br>
        String encodeStr = parser.encodeResourceToString(bundle);<br>
        fc.logger.trace(encodeStr);<br>
    }</p>
<p>public void addToContained(BaseResource sml, BaseResource large){<br>
        ContainedDt contained = new ContainedDt();<br>
        ArrayList arrLst = new ArrayList&lt;&gt;();<br>
        arrLst.add(sml);<br>
        contained.setContainedResources(arrLst);<br>
               large.getContained().setContainedResources(arrLst);<br>
    }<br>
}<br>
=======================================================================<br>
public class FHIRMaker {<br>
    public FHIRMaker() {<br>
        // TODO Auto-generated constructor stub<br>
    }<br>
    // Make FHIR Observation<br>
    public Observation makeObservation(String obsName) {<br>
        Observation theObs = new Observation(); //<br>
        theObs.setId("1");<br>
        theObs.setStatus(ObservationStatusEnum.FINAL);<br>
        theObs.getCode().setText(obsName);<br>
        StringDt val = new StringDt();<br>
        val.setValue(obsName + "-value");<br>
        theObs.setValue(val);<br>
        return theObs;<br>
    }<br>
    // Make DiagnosticReport<br>
    public DiagnosticReport makeDiagnosticReport(String drptName) {<br>
        DiagnosticReport drpt = new DiagnosticReport(); <br>
        drpt.setId("1");<br>
        drpt.getCode().setText("test report");<br>
        ResourceReferenceDt pfm = new ResourceReferenceDt();<br>
        pfm.getReference().setValue("Lab Center");<br>
        drpt.setPerformer(pfm);<br>
        return drpt;<br>
    }<br>
    // Make Bundle<br>
    public Bundle makeBundle(String bdlName) {<br>
        Bundle bdl = new Bundle();<br>
        bdl.setType(BundleTypeEnum.DOCUMENT);<br>
        return bdl;<br>
    }<br>
    // Make ListResoruces<br>
    public ListResource makeListRsc(String lstName) {<br>
        ListResource lstRsc = new ListResource();<br>
        lstRsc.setId("1");<br>
        return lstRsc;<br>
    }   <br>
    // Make Bundle-Entry<br>
    public Entry makeBundleEntry(String entName) {<br>
        Entry ent = new Entry();<br>
        return ent;<br>
    }<br>
}<br>
======Below is the XML output, all contained XML elements are missing======================<br>
&lt;Bundle xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
   &lt;type value="collection"&gt;&lt;/type&gt;<br>
   &lt;entry&gt;<br>
      &lt;resource&gt;<br>
         &lt;DiagnosticReport xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
            &lt;id value="1"&gt;&lt;/id&gt;<br>
            &lt;code&gt;<br>
               &lt;text value="test report"&gt;&lt;/text&gt;<br>
            &lt;/code&gt;<br>
            &lt;performer&gt;<br>
               &lt;reference value="Lab center"&gt;&lt;/reference&gt;<br>
            &lt;/performer&gt;<br>
         &lt;/DiagnosticReport&gt;<br>
      &lt;/resource&gt;<br>
   &lt;/entry&gt;<br>
&lt;/Bundle&gt;</p>



<a name="153847651"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Source%20code...Generate%20contained%20xml%20from%20Java%20HAPI%20Bundle%EF%BC%9F/near/153847651" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jingdong(JD) Li <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Source.20code.2E.2E.2EGenerate.20contained.20xml.20from.20Java.20HAPI.20Bundle.EF.BC.9F.html#153847651">(Sep 17 2016 at 14:07)</a>:</h4>
<p>ok,have the problem solved. It looks like for any reason, if you defined an internal observation or other reousrce, the resource contained the internal resource has to particularly reference it, otherwise, FHIR parser will ignore the contained resource during xml generation. </p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
