---
layout: page
title: "FHIR Chat  · STU3 and R4 within on Server · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/STU3.20and.20R4.20within.20on.20Server.html">STU3 and R4 within on Server</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="237163123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/STU3%20and%20R4%20within%20on%20Server/near/237163123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andreas Mautsch <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/STU3.20and.20R4.20within.20on.20Server.html#237163123">(May 03 2021 at 13:49)</a>:</h4>
<p>Hello everybody ..</p>



<a name="237163531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/STU3%20and%20R4%20within%20on%20Server/near/237163531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andreas Mautsch <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/STU3.20and.20R4.20within.20on.20Server.html#237163531">(May 03 2021 at 13:52)</a>:</h4>
<p>I guess this is not the first time someone asks .. but is it possible to implement STU3 and R4 at the same time inside the same HAPI FHir Spring Boot Application ? Unfortunately we have a requirement like this .. I invested about 2 hours of time and at least the application bootstrapped.</p>
<p>I tried to differantiate bei having 2 urls /fhir/dstu3 and /fhir/r4 ... only the first one works ... as getting this far involved some hacky code, I suspect its not desired to do something like this ?</p>



<a name="237166635"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/STU3%20and%20R4%20within%20on%20Server/near/237166635" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig McClendon <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/STU3.20and.20R4.20within.20on.20Server.html#237166635">(May 03 2021 at 14:13)</a>:</h4>
<p>I suspect that it's possible, though I haven't tried.  But I would looking to save the headaches unless there really is some shared state you need to maintain between the two. If you are already ok with two different base URLs, I assume it is much easier to run two instances - or even use a reverse proxy if you want to have them running on the same port/machine. </p>
<p>That said, we use the plain server implementation (not the JPA), and we register the FHIR server servlet with SpringBoot like this:</p>
<div class="codehilite"><pre><span></span><code>    @Bean
    public ServletRegistrationBean&lt;?&gt; v1FhirServletRegistrationBean(RestfulServer v1FhirServlet) {
        ServletRegistrationBean&lt;?&gt; s = new ServletRegistrationBean&lt;&gt;(v1FhirServlet, fhirServerBaseContextPath + &quot;/*&quot;);
        s.setName(&quot;fhirsvr&quot;);
        return s;
    }
</code></pre></div>
<p>With a little Spring-fu, I suspect you could register more than one servlet on different base-urls.</p>



<a name="237167682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/STU3%20and%20R4%20within%20on%20Server/near/237167682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig McClendon <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/STU3.20and.20R4.20within.20on.20Server.html#237167682">(May 03 2021 at 14:20)</a>:</h4>
<p>.. If you're using the JPA version of HAPI, that could present additional problems if you cannot share a single DB configuration between the two versions. SpringBoot doesn't well support having multiple JPA configurations within the same application context because there are a bunch of hidden beans it uses for things like transaction management which are not easily separated.</p>



<a name="237171168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/STU3%20and%20R4%20within%20on%20Server/near/237171168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andreas Mautsch <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/STU3.20and.20R4.20within.20on.20Server.html#237171168">(May 03 2021 at 14:43)</a>:</h4>
<p>ok thank you very much for the fast answer .. basically registering  to ServletRegistrationBeans is what I did<br>
additionally the component scanning needs to be fixed at multiple occasions .. looks very hacky though and still doesn not work finally<br>
i also thought about deploying two instances and using a reverse proxy .. while this is possible its not my first choice, because this will affect the development process as well as the resource usage </p>
<p>jpa is not a thing currently .. thanks again</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
