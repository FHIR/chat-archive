---
layout: page
title: "FHIR Chat  · HAPI contained resource referencing parent · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html">HAPI contained resource referencing parent</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="174015122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174015122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174015122">(Aug 24 2019 at 00:45)</a>:</h4>
<p>HAPI strips out contained resources that are not referenced by the parent. </p>
<p>But these may actually be valid, if the contained resource references the parent, instead of the usual opposite direction. </p>
<p>It filters out this contained resource, even though the target element references the parent (and still does if it uses a proper id in the reference rather than just '#')</p>
<div class="codehilite"><pre><span></span>         &lt;Observation&gt;
            &lt;contained&gt;
               &lt;Provenance&gt;
                  &lt;target&gt;
                     &lt;reference value=&quot;#&quot;/&gt;
                  &lt;/target&gt;
</pre></div>


<p>Is there a way to structure this so HAPI accepts it? Adding a dummy id or something?</p>



<a name="174130609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174130609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174130609">(Aug 26 2019 at 10:39)</a>:</h4>
<p>Is that valid for a contained resource to reference the container but with no references the other way around? My understanding has always been that it isn't...</p>



<a name="174130721"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174130721" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174130721">(Aug 26 2019 at 10:41)</a>:</h4>
<p>that was changed in R4</p>



<a name="174189959"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174189959" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174189959">(Aug 27 2019 at 01:41)</a>:</h4>
<p>Hmm... Well, sounds like we need to remove that check or make it more nuanced then now.</p>
<p><span class="user-mention" data-user-id="191651">@Rik Smithies</span> as a short term workaround you could add a dummy extension from your outer resource pointing to your inner one... it's ugly i know but it would work</p>



<a name="174204003"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174204003" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174204003">(Aug 27 2019 at 07:45)</a>:</h4>
<p>Do we have any references to the change? Wondering what the use case is ... and I've seen a number of 'standards' coming out which (unnecessarily and inconsistently) make use of contained.</p>



<a name="174217961"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174217961" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174217961">(Aug 27 2019 at 11:07)</a>:</h4>
<p>My use case is to add a data item for the  Observation "source system". I wanted to use Provenance but don't want to have a Provenance end point. Hence a contained Provenance in each Observation. And they point to Observation rather than the other way around. <br>
It's a prototype and we may go to full Provenance eventually. But in the mean time I wanted to round trip the data to FHIR and check it all went in and out again, so a contained Provenance does the job for now.</p>



<a name="174227342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174227342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174227342">(Aug 27 2019 at 13:17)</a>:</h4>
<p>That makes sense, probably saves a lot of calls. <br>
The one I've just seen (below), is an example of one I think is wrong. The contained reference is likely to be static (and the contained resource is mandating other contained resources!).<br>
<a href="/user_uploads/10155/0sf6UpKfQ-H82rs1cNst92ei/Contained.PNG" target="_blank" title="Contained.PNG">Contained.PNG</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/0sf6UpKfQ-H82rs1cNst92ei/Contained.PNG" target="_blank" title="Contained.PNG"><img src="/user_uploads/10155/0sf6UpKfQ-H82rs1cNst92ei/Contained.PNG"></a></div>



<a name="174227428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174227428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174227428">(Aug 27 2019 at 13:18)</a>:</h4>
<p>HL7v3 in disguise?</p>



<a name="174248966"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174248966" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174248966">(Aug 27 2019 at 17:06)</a>:</h4>
<p>Well if there is a known set of organizations and they are well identified and re-used, it should not be a contained resource. </p>
<p>A use case for a contained organization is if you have low quality data. e.g. hand entered names "St Agnes Hospital" and "Saint Agnes Hosp".  You can't create a resource for every variation of the name and can't easily canonicalize the strings (and it may not even be the same hospital). So a contained resource with just the name can work. </p>
<p>I have considered an empty reference and putting the org name in reference.display, but I think that might be cheating.</p>



<a name="174346201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174346201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174346201">(Aug 28 2019 at 09:26)</a>:</h4>
<p>Think it's sensible to put in sensible to put in display and reference.identifier where possible - in UK for organisation references  this would be ODS code (and this links to HL7v2 standards in UK) e.g. <br>
  "managingOrganization": {<br>
        "reference": "Organization/self",<br>
        "identifier": {<br>
            "system": "<a href="https://fhir.nhs.uk/Id/ods-organization-code" target="_blank" title="https://fhir.nhs.uk/Id/ods-organization-code">https://fhir.nhs.uk/Id/ods-organization-code</a>",<br>
            "value": "B81603"<br>
        }<br>
    }</p>



<a name="174346229"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174346229" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174346229">(Aug 28 2019 at 09:27)</a>:</h4>
<p>You've then got the choice of following the reference or using the ODS server to resolve the organisation.</p>



<a name="174673632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174673632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174673632">(Sep 01 2019 at 19:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191651">@Rik Smithies</span> - why would that be cheating? Seems a valid use of reference,display to me...</p>



<a name="174680942"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174680942" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174680942">(Sep 01 2019 at 23:15)</a>:</h4>
<p><span class="user-mention" data-user-id="191321">@David Hay</span>  I always assumed display was there to support the actual reference and was not intended to replace it. Is that not the case? One of my main reasons for using contained would not be needed if that use is actually legitimate.</p>



<a name="174680993"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174680993" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174680993">(Sep 01 2019 at 23:17)</a>:</h4>
<p>if there</p>



<a name="174681036"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174681036" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174681036">(Sep 01 2019 at 23:18)</a>:</h4>
<p>it's valid to have just a display, if that's all you have about the target of the reference. Obviously, it's a lot less functional than an actual reference</p>



<a name="174682393"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174682393" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174682393">(Sep 02 2019 at 00:06)</a>:</h4>
<p>I saw it kinda like an intermediate step - "this is all I have right now, as systems mature and become more FHIR enabled then a 'real' reference might become available later..."</p>



<a name="174705469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174705469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174705469">(Sep 02 2019 at 10:08)</a>:</h4>
<p>If it's ok to use reference.display alone for a name or short description of the referenced item that seems to remove one of the uses for a contained resource. Contained can be for when the item is not "identifiable". But if you have more than one data point (so it can't all go in reference.display) then it seems a better chance it can be identified.  An exception could be a forename and surname I suppose, though concatenating them wouldn't seem a big issue for such an "unidentified" person. And it's a lot simpler than contained.</p>



<a name="174705692"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174705692" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174705692">(Sep 02 2019 at 10:12)</a>:</h4>
<p>From working on a GP Connect client (and also supplier) perspective. The references can contain most of what is needed by a client and helps prevent a chatty API.</p>



<a name="174706926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174706926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174706926">(Sep 02 2019 at 10:35)</a>:</h4>
<p>Hi Kevin, do you mean the single string of reference.display is sufficient?<br>
Chat is reduced by both the reference.display and contained resource route. But you can get more structure in contained. But now I am seeing less cases where that middle level of structure is necessary. <br>
If it's a fully identified thing like an ODS reference, then this isn't so much of an issue, that would never really be contained. Reference.display is still helpful there of course. But not on it's own.</p>



<a name="174707526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20contained%20resource%20referencing%20parent/near/174707526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20contained.20resource.20referencing.20parent.html#174707526">(Sep 02 2019 at 10:47)</a>:</h4>
<p>I think that's what I'm seeing. Reference.display is  often sufficient, if not a reference or identifier reference can be followed. If following the reference creates a very chatty interface then contained can be used, if not very chatty consider local caching to avoid repeated reference lookups?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
