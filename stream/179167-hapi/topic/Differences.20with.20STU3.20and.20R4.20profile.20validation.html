---
layout: page
title: "FHIR Chat  · Differences with STU3 and R4 profile validation · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Differences.20with.20STU3.20and.20R4.20profile.20validation.html">Differences with STU3 and R4 profile validation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="177908666"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Differences%20with%20STU3%20and%20R4%20profile%20validation/near/177908666" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juuso Oksanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Differences.20with.20STU3.20and.20R4.20profile.20validation.html#177908666">(Oct 11 2019 at 13:55)</a>:</h4>
<p>Hi.</p>
<p>I've been creating an R4-endpoint for our resource server and I noticed while testing profile validation that the R4 version (and R5 version it would seem) of the IWorkerContext.ValidationResult isOk-method has been changed.</p>
<p>In DSTU3 this method would check if the ValidationResults ConceptDefinitionComponent was not null.<br>
In R4 this method checks if the IssueSeverity of ValidationResult is either null, Information or Warning.</p>
<p>This would give us different error responses in stu3 and r4 endpoints while validating ValueSets with codes from not present code systems (for example LOINC).</p>
<p>In DSTU3 a code system not being present would result in a ValidationResult with isOk returning false.<br>
In R4 a code system not being present would result in a ValidationResult with isOk returning true.</p>
<p>Is this an intended change? And if it is, can you tell why?</p>
<p>I'm pretty new to HAPI so bear with me here.</p>



<a name="177924756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Differences%20with%20STU3%20and%20R4%20profile%20validation/near/177924756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Differences.20with.20STU3.20and.20R4.20profile.20validation.html#177924756">(Oct 11 2019 at 16:36)</a>:</h4>
<p>I believe I changed that. And I changed it because validation tests were failing. However... the only validation infrastructure I support is the R5 infrastructure, which will validate R2-R5. Have you looked at that?</p>



<a name="178080673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Differences%20with%20STU3%20and%20R4%20profile%20validation/near/178080673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Differences.20with.20STU3.20and.20R4.20profile.20validation.html#178080673">(Oct 14 2019 at 07:47)</a>:</h4>
<p>This is probably more of an Hapi question, we are currently looking at supporting both STU3 and R4, why we noticed this difference. It seems that depending on the FHIRContext we have (FhirContext.forDstu3() for example) it seems to pick the corresponding InstanceValidator. Should we use Hapi in different way to have only R5 validation?</p>



<a name="178083030"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Differences%20with%20STU3%20and%20R4%20profile%20validation/near/178083030" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Differences.20with.20STU3.20and.20R4.20profile.20validation.html#178083030">(Oct 14 2019 at 08:24)</a>:</h4>
<p>that's a question for <span class="user-mention" data-user-id="191319">@James Agnew</span>.</p>



<a name="178086312"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Differences%20with%20STU3%20and%20R4%20profile%20validation/near/178086312" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juuso Oksanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Differences.20with.20STU3.20and.20R4.20profile.20validation.html#178086312">(Oct 14 2019 at 09:10)</a>:</h4>
<blockquote>
<p>This is probably more of an Hapi question, we are currently looking at supporting both STU3 and R4, why we noticed this difference. It seems that depending on the FHIRContext we have (FhirContext.forDstu3() for example) it seems to pick the corresponding InstanceValidator. Should we use Hapi in different way to have only R5 validation?</p>
</blockquote>
<p>The R5-version of InstanceValidator is being used in both STU3 and R4 endpoints. This is because the InstanceValidator is wrapped by FhirInstanceValidator which we have registered as a validator module in the FhirValidator, correct?</p>



<a name="178086767"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Differences%20with%20STU3%20and%20R4%20profile%20validation/near/178086767" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juuso Oksanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Differences.20with.20STU3.20and.20R4.20profile.20validation.html#178086767">(Oct 14 2019 at 09:19)</a>:</h4>
<p>Notable changes from STU3 to R4 is that:<br>
-FhirValidator is given the R4 FhirContext instead of STU3 (FhirContext.newValidator())<br>
-FhirInstanceValidator is R4-version instead of STU3 and is given the corresponding ValidationSupportChain</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
