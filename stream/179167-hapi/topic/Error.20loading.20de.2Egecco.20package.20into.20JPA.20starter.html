---
layout: page
title: "FHIR Chat  · Error loading de.gecco package into JPA starter · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html">Error loading de.gecco package into JPA starter</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="238479742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/238479742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#238479742">(May 12 2021 at 14:10)</a>:</h4>
<p>I am trying to load the <a href="https://simplifier.net/packages/de.gecco/1.0.3">de.gecco#1.0.3 FHIR package</a> into the JPA starter server by declaring it in <em>application.yaml</em>. The loading is triggered just fine, but at some point an error is thrown, seemingly because of a problem with a dependency (of which this package has quite a few). The triggering error is this (I have included more complete log output in the expandable spoiler section below):</p>
<div class="codehilite"><pre><span></span><code>Caused by: ca.uhn.fhir.rest.server.exceptions.PreconditionFailedException: Unknown base definition: https://www.medizininformatik-initiative.de/fhir/core/modul-diagnose/StructureDefinition/Diagnose
</code></pre></div>
<p>The profile with this URL is indeed included in the <a href="https://simplifier.net/packages/de.medizininformatikinitiative.kerndatensatz.diagnose/1.0.1">de.medizininformatikinitiative.kerndatensatz.diagnose#1.0.1 package</a> which is declared as a dependency. That particular version of this package <a href="https://registry.fhir.org/package/de.medizininformatikinitiative.kerndatensatz.diagnose%7C1.0.1">is annotated as "unlisted" in the package registry</a>, but is still downloadable from simplifier. Might that be the source of the problem in HAPI or is there perhaps an issue with the dependency resolution?</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Relevant part of server log</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>[...]<br>
2021-05-12 15:43:38.249 [main] INFO  c.u.f.j.p.PackageInstallerSvcImpl [PackageInstallerSvcImpl.java:327] Creating new resource matching ?url=https%3A%2F%2Fwww.netzwerk-universitaetsmedizin.de%2Ffhir%2FStructureDefinition%2Funcertainty-of-presence<br>
2021-05-12 15:43:38.390 [main] INFO  c.u.f.j.p.PackageInstallerSvcImpl [PackageInstallerSvcImpl.java:327] Creating new resource matching ?url=https%3A%2F%2Fwww.netzwerk-universitaetsmedizin.de%2Ffhir%2FStructureDefinition%2Fgecco-bundle<br>
2021-05-12 15:43:38.435 [main] INFO  ca.uhn.fhir.context.FhirContext [FhirContext.java:200] Creating new FHIR context for FHIR version [R4]<br>
2021-05-12 15:43:38.467 [main] WARN  c.u.f.j.p.PackageInstallerSvcImpl [PackageInstallerSvcImpl.java:224] Failed to upload resource of type StructureDefinition with ID null - Error: ca.uhn.fhir.jpa.packages.ImplementationGuideInstallationException: Failure when generating snapshot of StructureDefinition: null<br>
2021-05-12 15:43:38.469 [main] ERROR o.a.c.c.C.[Tomcat].[localhost].[/] [DirectJDKLog.java:175] Servlet.init() for servlet [jpaRestfulServer] threw exception<br>
ca.uhn.fhir.jpa.packages.ImplementationGuideInstallationException: Error installing IG de.gecco#1.0.3: ca.uhn.fhir.jpa.packages.ImplementationGuideInstallationException: Failure when generating snapshot of StructureDefinition: null<br>
    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.install(PackageInstallerSvcImpl.java:225)<br>
    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.install(PackageInstallerSvcImpl.java:175)<br>
    at ca.uhn.fhir.jpa.starter.BaseJpaRestfulServer.initialize(BaseJpaRestfulServer.java:368)<br>
    at ca.uhn.fhir.jpa.starter.JpaRestfulServer.initialize(JpaRestfulServer.java:22)<br>
    at ca.uhn.fhir.rest.server.RestfulServer.init(RestfulServer.java:1285)<br>
    at javax.servlet.GenericServlet.init(GenericServlet.java:203)<br>
    at org.apache.catalina.core.StandardWrapper.initServlet(StandardWrapper.java:1134)<br>
    at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:986)<br>
    at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContext.load(TomcatEmbeddedContext.java:82)<br>
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)<br>
    at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1655)<br>
    at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:658)<br>
    at java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:274)<br>
    at java.base/java.util.TreeMap$ValueSpliterator.forEachRemaining(TreeMap.java:2890)<br>
    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)<br>
    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)<br>
    at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)<br>
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)<br>
    at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)<br>
    at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497)<br>
    at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContext.lambda$deferredLoadOnStartup$0(TomcatEmbeddedContext.java:65)<br>
    at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContext.doWithThreadContextClassLoader(TomcatEmbeddedContext.java:106)<br>
    at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContext.deferredLoadOnStartup(TomcatEmbeddedContext.java:64)<br>
    at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.performDeferredLoadOnStartup(TomcatWebServer.java:305)<br>
    at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start(TomcatWebServer.java:216)<br>
    at org.springframework.boot.web.servlet.context.WebServerStartStopLifecycle.start(WebServerStartStopLifecycle.java:43)<br>
    at org.springframework.context.support.DefaultLifecycleProcessor.doStart(DefaultLifecycleProcessor.java:178)<br>
    at org.springframework.context.support.DefaultLifecycleProcessor.access$200(DefaultLifecycleProcessor.java:54)<br>
    at org.springframework.context.support.DefaultLifecycleProcessor$LifecycleGroup.start(DefaultLifecycleProcessor.java:356)<br>
    at java.base/java.lang.Iterable.forEach(Iterable.java:75)<br>
    at org.springframework.context.support.DefaultLifecycleProcessor.startBeans(DefaultLifecycleProcessor.java:155)<br>
    at org.springframework.context.support.DefaultLifecycleProcessor.onRefresh(DefaultLifecycleProcessor.java:123)<br>
    at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:940)<br>
    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:591)<br>
    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:144)<br>
    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:767)<br>
    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:759)<br>
    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:426)<br>
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:326)<br>
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1309)<br>
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1298)<br>
    at ca.uhn.fhir.jpa.starter.Application.main(Application.java:33)<br>
Caused by: ca.uhn.fhir.jpa.packages.ImplementationGuideInstallationException: Failure when generating snapshot of StructureDefinition: null<br>
    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.generateSnapshot(PackageInstallerSvcImpl.java:413)<br>
    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.install(PackageInstallerSvcImpl.java:221)<br>
    ... 41 common frames omitted<br>
Caused by: ca.uhn.fhir.rest.server.exceptions.PreconditionFailedException: Unknown base definition: <a href="https://www.medizininformatik-initiative.de/fhir/core/modul-diagnose/StructureDefinition/Diagnose">https://www.medizininformatik-initiative.de/fhir/core/modul-diagnose/StructureDefinition/Diagnose</a><br>
    at org.hl7.fhir.common.hapi.validation.support.SnapshotGeneratingValidationSupport.generateSnapshot(SnapshotGeneratingValidationSupport.java:89)<br>
    at org.hl7.fhir.common.hapi.validation.support.ValidationSupportChain.generateSnapshot(ValidationSupportChain.java:66)<br>
    at org.hl7.fhir.common.hapi.validation.support.BaseValidationSupportWrapper.generateSnapshot(BaseValidationSupportWrapper.java:94)<br>
    at org.hl7.fhir.common.hapi.validation.support.SnapshotGeneratingValidationSupport.generateSnapshot(SnapshotGeneratingValidationSupport.java:96)<br>
    at org.hl7.fhir.common.hapi.validation.support.ValidationSupportChain.generateSnapshot(ValidationSupportChain.java:66)<br>
    at org.hl7.fhir.common.hapi.validation.support.BaseValidationSupportWrapper.generateSnapshot(BaseValidationSupportWrapper.java:94)<br>
    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.generateSnapshot(PackageInstallerSvcImpl.java:411)<br>
    ... 42 common frames omitted<br>
[...]</p>
</div></div>



<a name="238563732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/238563732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#238563732">(May 13 2021 at 00:23)</a>:</h4>
<p>I think you'll have to step it to find out exactly where it goes wrong</p>



<a name="238665948"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/238665948" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#238665948">(May 13 2021 at 19:09)</a>:</h4>
<p>OK, will spend some serious time with the debugger when I get back to the office Monday and see if I can find the culprit <span aria-label="magnifying glass" class="emoji emoji-1f50d" role="img" title="magnifying glass">:magnifying_glass:</span> .</p>



<a name="239072203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/239072203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#239072203">(May 17 2021 at 11:32)</a>:</h4>
<p>So, going down the rabbit-hole I found the following: The overall IG load failure error flies in the <a href="https://github.com/hapifhir/hapi-fhir/blob/75c74a22dbd1f0dde3631b540d1898eef2a2666f/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/packages/PackageInstallerSvcImpl.java#L200">method <code>PackageInstallerSvcImpl#install</code></a> when it finds a profile (directly in the package) without a snapshot, tries to generate this snapshot, and than cannot find a profile that the profile in question is based on (re-profiling of). Specifically, the underlying error happens <a href="https://github.com/hapifhir/hapi-fhir/blob/26d030f93e9a3d0bea1bcfdeb74f68e32b970903/hapi-fhir-validation/src/main/java/org/hl7/fhir/common/hapi/validation/support/SnapshotGeneratingValidationSupport.java#L76">here</a> in <code>SnapshotGeneratingValidationSupport#generateSnapshot</code> because <code>ValidationSupportChain#fetchStructureDefinition</code> does not find the StructureDef in any of the validation supports. In my case, the specific chain of re-profiled profiles that triggered this was the following: </p>
<ol>
<li><code>https://www.netzwerk-universitaetsmedizin.de/fhir/StructureDefinition/cardiovascular-diseases</code> - is directly in package, is a re-profiling of...</li>
<li><code>https://www.netzwerk-universitaetsmedizin.de/fhir/StructureDefinition/gecco-base-condition</code> - is directly in package, is a re-profiling of...</li>
<li><code>https://www.medizininformatik-initiative.de/fhir/core/modul-diagnose/StructureDefinition/Diagnose</code> - only present in a dependency  (<code>de.medizininformatikinitiative.kerndatensatz.diagnose#1.0.1</code>)</li>
</ol>
<p>The last profile is not found, triggering the error. So it looks like the code tries to use resources from the dependencies without having pulled them first (I couldn't see where in <code>PackageInstallerSvcImpl#install</code> the dependencies should actually be pulled).</p>



<a name="239072426"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/239072426" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#239072426">(May 17 2021 at 11:34)</a>:</h4>
<p>(PS: As noted in the initial message, the package <code>de.medizininformatikinitiative.kerndatensatz.diagnose#1.0.1</code> is unlisted in the package registry)</p>



<a name="239324823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/239324823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#239324823">(May 18 2021 at 20:57)</a>:</h4>
<p>would you have some example packages 'to spare' in order to  debug it?</p>



<a name="239365852"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/239365852" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#239365852">(May 19 2021 at 05:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191427">@Jens Villadsen</span> Thanks for looking into this - the one case I have seen is triggered by loading the <a href="https://simplifier.net/packages/de.gecco/1.0.3">de.gecco#1.0.3  package</a> . Is that enough? I don't have any "synthetic" packages triggering the behaviour at hand, though I suspect any package with a snapshot-less profile that is based on a profile in a dependency would do the trick.</p>



<a name="240159390"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240159390" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240159390">(May 25 2021 at 08:57)</a>:</h4>
<p>Ahoi <span class="user-mention" data-user-id="191427">@Jens Villadsen</span> <span aria-label="wave" class="emoji emoji-1f44b" role="img" title="wave">:wave:</span> , did you by any chance find time to look at this or is there perhaps also still input from me missing?</p>



<a name="240160391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240160391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240160391">(May 25 2021 at 09:07)</a>:</h4>
<p>I haven't had the time to look at it</p>



<a name="240162219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240162219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240162219">(May 25 2021 at 09:28)</a>:</h4>
<p>Now I have ... you might wan't to bring <span class="user-mention" data-user-id="191319">@James Agnew</span> in on this</p>



<a name="240162975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240162975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240162975">(May 25 2021 at 09:37)</a>:</h4>
<p>Thanks for ringing his doorbell <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="240227296"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240227296" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240227296">(May 25 2021 at 18:04)</a>:</h4>
<p>If find the time, ill have a look as well</p>



<a name="240298748"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240298748" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240298748">(May 26 2021 at 09:34)</a>:</h4>
<p>Update: Problem persists (missing resources from package dependencies at snapshot generation), even with the new updated package <code>de.gecco#1.0.4-rc.1</code> which I believe does not use unlisted packages.</p>



<a name="240305898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240305898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240305898">(May 26 2021 at 10:50)</a>:</h4>
<p>(It seems one can get around the issue by manually declaring  the dependencies for loading, but the JDoc for the <code>ca.uhn.fhir.jpa.packages#install</code> method explicitly says <code>Installs a package and its dependencies.</code>, suggesting that dependency handling is included. Which is, I realize, no picnic cf. <a href="#narrow/stream/179167-hapi/topic/Package.20version.20conflict.20resolution">this other thread on dependency conflicts</a> I opened)</p>



<a name="240306153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240306153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240306153">(May 26 2021 at 10:53)</a>:</h4>
<p>I don't follow ... the loading of packages are done recursively. See <a href="https://github.com/hapifhir/hapi-fhir/blob/75c74a22dbd1f0dde3631b540d1898eef2a2666f/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/packages/PackageInstallerSvcImpl.java#L242">https://github.com/hapifhir/hapi-fhir/blob/75c74a22dbd1f0dde3631b540d1898eef2a2666f/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/packages/PackageInstallerSvcImpl.java#L242</a></p>



<a name="240307136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240307136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240307136">(May 26 2021 at 11:03)</a>:</h4>
<p>But as far as I can tell from debugging, the <code>install</code> method being called is <a href="https://github.com/hapifhir/hapi-fhir/blob/75c74a22dbd1f0dde3631b540d1898eef2a2666f/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/packages/PackageInstallerSvcImpl.java#L200">the one returning <code>void</code></a> which does not seem to call <code>fetchAndInstallDependencies</code> (unlike <a href="https://github.com/hapifhir/hapi-fhir/blob/75c74a22dbd1f0dde3631b540d1898eef2a2666f/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/packages/PackageInstallerSvcImpl.java#L154">the <code>install</code> method returning PackageInstallOutcomeJson`</a>). Or am missing smt.?</p>



<a name="240307407"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240307407" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240307407">(May 26 2021 at 11:06)</a>:</h4>
<p>(the latter <code>install</code> function, on the other hand, expects the StructureDefs to already have snapshots, cf. JDoc)</p>



<a name="240337117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240337117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240337117">(May 26 2021 at 14:53)</a>:</h4>
<p>Ok ... so assuming you are using the hapi-fhir-starter-project ... try add the following:</p>
<div class="codehilite"><pre><span></span><code>                .setFetchDependencies(true)
                .addDependencyExclude(&quot;hl7.fhir.r4.core&quot;)
</code></pre></div>
<p>around line 366, in BaseJpaRestfulServer, then you will see things start happening</p>



<a name="240337311"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240337311" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240337311">(May 26 2021 at 14:54)</a>:</h4>
<p>Eventually you will see the following error:</p>
<div class="codehilite"><pre><span></span><code>2021-05-26 16:52:02.919 [main] INFO  c.u.f.jpa.packages.JpaPackageCache [JpaPackageCache.java:195] Parsing package .tar.gz (28612 bytes) from http://packages.fhir.org/kbv.basis/1.1.3
2021-05-26 16:52:02.948 [main] ERROR o.a.c.c.C.[Tomcat].[localhost].[/] [DirectJDKLog.java:175] Servlet.init() for servlet [jpaRestfulServer] threw exception
ca.uhn.fhir.rest.server.exceptions.InvalidRequestException: Package ID KBV.Basis doesn&#39;t match expected: kbv.basis
    at ca.uhn.fhir.jpa.packages.JpaPackageCache.addPackageToCache(JpaPackageCache.java:199)
    at ca.uhn.fhir.jpa.packages.JpaPackageCache.loadPackage(JpaPackageCache.java:398)
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.base/java.lang.reflect.Method.invoke(Method.java:566)
    at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:208)
    at com.sun.proxy.$Proxy213.loadPackage(Unknown Source)
    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.fetchAndInstallDependencies(PackageInstallerSvcImpl.java:265)
    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.fetchAndInstallDependencies(PackageInstallerSvcImpl.java:268)
</code></pre></div>



<a name="240337717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240337717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240337717">(May 26 2021 at 14:57)</a>:</h4>
<p>with those line added you will see that the packages are found and installed recursively and other stuff starts to bug you from the actual packages</p>



<a name="240344338"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240344338" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240344338">(May 26 2021 at 15:35)</a>:</h4>
<p>Ah, thanks for the tip! Indeed, I see the same now - looks like a version of the recent issue with upper vs. lower-case in package IDs discussed in <a href="#narrow/stream/179166-implementers/topic/Error.20loading.20package.20in.20java.20validator">this thread</a>. Grahame put out a fix in the validator on May 14th, I'm guessing that hasn't propagated to the JPA starter yet?</p>



<a name="240466010"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240466010" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240466010">(May 27 2021 at 13:23)</a>:</h4>
<p>Update: Turns out to be a similar but separate issue, proposed fix here:  <a href="https://github.com/hapifhir/hapi-fhir/pull/2683">https://github.com/hapifhir/hapi-fhir/pull/2683</a></p>



<a name="240620879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240620879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240620879">(May 28 2021 at 15:33)</a>:</h4>
<p>Did you just link to your own link ;)</p>



<a name="240706692"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240706692" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240706692">(May 29 2021 at 15:13)</a>:</h4>
<p><span class="user-mention" data-user-id="194703">@Morten Ernebjerg</span> merged! Thanks for the contribution.</p>



<a name="240755063"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/240755063" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#240755063">(May 30 2021 at 13:08)</a>:</h4>
<p>(deleted)</p>



<a name="243626647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/243626647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#243626647">(Jun 23 2021 at 09:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191427">Jens Villadsen</span> <a href="#narrow/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter/near/240337117">said</a>:</p>
<blockquote>
<p>Ok ... so assuming you are using the hapi-fhir-starter-project ... try add the following:</p>
<div class="codehilite"><pre><span></span><code>                .setFetchDependencies(true)
                .addDependencyExclude(&quot;hl7.fhir.r4.core&quot;)
</code></pre></div>
<p>around line 366, in BaseJpaRestfulServer, then you will see things start happening</p>
</blockquote>
<p>all in favour that I add this as a configuration option for the starter project? <span class="user-mention" data-user-id="191451">@Patrick Werner</span> <span class="user-mention" data-user-id="194703">@Morten Ernebjerg</span> ?</p>



<a name="243626668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/243626668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#243626668">(Jun 23 2021 at 09:28)</a>:</h4>
<p>or should it be default behavior?</p>



<a name="243626824"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/243626824" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#243626824">(Jun 23 2021 at 09:30)</a>:</h4>
<p>I think this should be default behaviour. I also want to add ConceptMaps to the loaded ResourceTypes</p>



<a name="243626848"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/243626848" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#243626848">(Jun 23 2021 at 09:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191427">@Jens Villadsen</span> THanks for suggesting this - I would actually say it should be the default behavior (that was my ow naive assumption when I started...). Are there situation where one would <em>not</em> want this?</p>



<a name="243629793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/243629793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#243629793">(Jun 23 2021 at 10:01)</a>:</h4>
<p>what are the other packages Id's that should always be ignored (besides the r4)?</p>



<a name="243763687"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/243763687" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#243763687">(Jun 24 2021 at 10:03)</a>:</h4>
<p><a href="https://github.com/hapifhir/hapi-fhir-jpaserver-starter/pull/254">https://github.com/hapifhir/hapi-fhir-jpaserver-starter/pull/254</a> <span class="user-mention" data-user-id="191451">@Patrick Werner</span> <span class="user-mention" data-user-id="194703">@Morten Ernebjerg</span>  <span class="user-mention" data-user-id="191319">@James Agnew</span></p>



<a name="243768848"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Error%20loading%20de.gecco%20package%20into%20JPA%20starter/near/243768848" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Error.20loading.20de.2Egecco.20package.20into.20JPA.20starter.html#243768848">(Jun 24 2021 at 11:01)</a>:</h4>
<p>merged. Thanks <span class="user-mention" data-user-id="191427">@Jens Villadsen</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
