---
layout: page
title: "FHIR Chat  · Bug: Exceptions when POSTing a CodeSystem (in transaction) · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.3A.20Exceptions.20when.20POSTing.20a.20CodeSystem.20(in.20transaction).html">Bug: Exceptions when POSTing a CodeSystem (in transaction)</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="198746121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%3A%20Exceptions%20when%20POSTing%20a%20CodeSystem%20%28in%20transaction%29/near/198746121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.3A.20Exceptions.20when.20POSTing.20a.20CodeSystem.20(in.20transaction).html#198746121">(May 26 2020 at 11:00)</a>:</h4>
<p>Trying to upload a CodeSystem (inside a transaction) i get  this exception for every concept:</p>
<div class="codehilite"><pre><span></span><code>May 26 13:00:55 vitu-data tomcat9[4410]: 2020-05-26 13:00:55.045 [hapi-fhir-jpa-scheduler-local-4] ERROR o.h.e.j.batch.internal.BatchingBatch [BatchingBatch.java:128] HHH000315: Exception executing batch [java.sql.BatchUpdateException: Batch entry 0 insert into TRM_CONCEPT (CODEVAL, CODESYSTEM_PID, DISPLAY, INDEX_STATUS, PARENT_PIDS, CODE_SEQUENCE, CONCEPT_UPDATED, PID) values (&#39;HGNC:3197&#39;, 72, &#39;EEF1A1P14&#39;, 1, 24122, NULL, &#39;2020-05-26 13:00:55.034+02&#39;, 12122) was aborted: ERROR: insert or update on table &quot;trm_concept&quot; violates foreign key constraint &quot;fk_concept_pid_cs_pid&quot;
May 26 13:00:55 vitu-data tomcat9[4410]:   Detail: Key (codesystem_pid)=(72) is not present in table &quot;trm_codesystem_ver&quot;.  Call getNextException to see other errors in the batch.], SQL: insert into TRM_CONCEPT (CODEVAL, CODESYSTEM_PID, DISPLAY, INDEX_STATUS, PARENT_PIDS, CODE_SEQUENCE, CONCEPT_UPDATED, PID) values (?, ?, ?, ?, ?, ?, ?, ?)
May 26 13:00:55 vitu-data tomcat9[4410]: 2020-05-26 13:00:55.045 [hapi-fhir-jpa-scheduler-local-4] WARN  o.h.e.jdbc.spi.SqlExceptionHelper [SqlExceptionHelper.java:137] SQL Error: 0, SQLState: 23503
May 26 13:00:55 vitu-data tomcat9[4410]: 2020-05-26 13:00:55.045 [hapi-fhir-jpa-scheduler-local-4] ERROR o.h.e.jdbc.spi.SqlExceptionHelper [SqlExceptionHelper.java:142] Batch entry 0 insert into TRM_CONCEPT (CODEVAL, CODESYSTEM_PID, DISPLAY, INDEX_STATUS, PARENT_PIDS, CODE_SEQUENCE, CONCEPT_UPDATED, PID) values (&#39;HGNC:3197&#39;, 72, &#39;EEF1A1P14&#39;, 1, 24122, NULL, &#39;2020-05-26 13:00:55.034+02&#39;, 12122) was aborted: ERROR: insert or update on table &quot;trm_concept&quot; violates foreign key constraint &quot;fk_concept_pid_cs_pid&quot;
May 26 13:00:55 vitu-data tomcat9[4410]:   Detail: Key (codesystem_pid)=(72) is not present in table &quot;trm_codesystem_ver&quot;.  Call getNextException to see other errors in the batch.
May 26 13:00:55 vitu-data tomcat9[4410]: 2020-05-26 13:00:55.045 [hapi-fhir-jpa-scheduler-local-4] ERROR o.h.e.jdbc.spi.SqlExceptionHelper [SqlExceptionHelper.java:142] ERROR: insert or update on table &quot;trm_concept&quot; violates foreign key constraint &quot;fk_concept_pid_cs_pid&quot;
May 26 13:00:55 vitu-data tomcat9[4410]:   Detail: Key (codesystem_pid)=(72) is not present in table &quot;trm_codesystem_ver&quot;.
May 26 13:00:55 vitu-data tomcat9[4410]: 2020-05-26 13:00:55.046 [hapi-fhir-jpa-scheduler-local-4] ERROR org.quartz.core.JobRunShell [JobRunShell.java:211] Job HAPI.ca.uhn.fhir.jpa.term.TermReindexingSvcImpl threw an unhandled Exception:
</code></pre></div>



<a name="198746862"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Bug%3A%20Exceptions%20when%20POSTing%20a%20CodeSystem%20%28in%20transaction%29/near/198746862" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Bug.3A.20Exceptions.20when.20POSTing.20a.20CodeSystem.20(in.20transaction).html#198746862">(May 26 2020 at 11:08)</a>:</h4>
<p>works fine when posting outside a bundle (maybe related to the getId Bug on urn:uuid Ids?)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
