---
layout: page
title: "FHIR Chat  · type level expunge everything · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/type.20level.20expunge.20everything.html">type level expunge everything</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="197395882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/type%20level%20expunge%20everything/near/197395882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Zacho Grønhøj <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/type.20level.20expunge.20everything.html#197395882">(May 13 2020 at 10:56)</a>:</h4>
<p>Hi - I need to permanently delete all instances of a subset of all resources types (Patient, Appointment, Communication etc., but not the conformance resources StructureDefinition, ValueSet, CodeSystem etc.) on several servers running the hapi fhir jpaserver v4.1.0 DSTU3.</p>
<p>By testing it seems that the hapi-fhir-jpaserver only supports the expunge everything parameter on system level operations (eg. permanently deleting all instances of <em>all</em> resource types on a server), and not on type level operations (permanently deleting all instances of <em>a given resource type</em>). It looks like this is unchanged in v4.2.0 and the soon-to-be-released v5.0.0  (released today?! hooray).</p>
<p>Ok, so I thought, "oh well, I'll just first invoke the type level DELETE operation on all of the resource types I need to permanently delete, before I call the type level expunge operation with the 'expungeDeletedResources' and 'expungeOldVersions' flags set." - however this is not possible, since the DELETE operation is only supported on resource instances, not on resource types.. It seems a bit to use this to mark all instances of a given resource type as deleted. </p>
<p>Can anyone help me figuring out the combination of DELETE/ expunge operations needed in my use case?</p>



<a name="197408885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/type%20level%20expunge%20everything/near/197408885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/type.20level.20expunge.20everything.html#197408885">(May 13 2020 at 13:05)</a>:</h4>
<p>If you enable multi-delete (it's disabled by default) you can use a conditional delete to delete everything by type.</p>
<p>We make it a bit hard because it would be easy to accidentally to a lot of damage. Basically, we require at least one search parameter on the condition, so you can't do:</p>
<p><code>DELETE Patient?</code></p>
<p>...but you could get the same effect by doing:</p>
<p><code>DELETE Patient?_lastUpdated=gt1970</code></p>
<p>Note that expunge has had a lot of performance optimization in the last 6 months. You'll get much more consistent performance if you upgrade to HAPI FHIR 5.0.0.</p>



<a name="197414720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/type%20level%20expunge%20everything/near/197414720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Zacho Grønhøj <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/type.20level.20expunge.20everything.html#197414720">(May 13 2020 at 13:48)</a>:</h4>
<p>Thanks - I can't seem to find any documentation of multi-delete?</p>



<a name="197432588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/type%20level%20expunge%20everything/near/197432588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/type.20level.20expunge.20everything.html#197432588">(May 13 2020 at 15:47)</a>:</h4>
<p>This is the setting: <a href="https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-api/src/main/java/ca/uhn/fhir/jpa/api/config/DaoConfig.java#L1001">https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-api/src/main/java/ca/uhn/fhir/jpa/api/config/DaoConfig.java#L1001</a></p>
<p>Looks like it's literally the only one without documentation! Whoops......</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
