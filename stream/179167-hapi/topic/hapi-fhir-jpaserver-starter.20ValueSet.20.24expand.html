---
layout: page
title: "FHIR Chat  · hapi-fhir-jpaserver-starter ValueSet $expand · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi-fhir-jpaserver-starter.20ValueSet.20.24expand.html">hapi-fhir-jpaserver-starter ValueSet $expand</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="259113296"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/hapi-fhir-jpaserver-starter%20ValueSet%20%24expand/near/259113296" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mauricio Burgos Herrera <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/hapi-fhir-jpaserver-starter.20ValueSet.20.24expand.html#259113296">(Oct 26 2021 at 15:23)</a>:</h4>
<p>Hello!<br>
I'm using the hapi-fhir-jpaserver-starter (hapiproject/hapi:v5.5.1) server and I have loaded the ICD 10 CM CodeSystem and created a ValueSet that contains the whole system.<br>
When I try to $expand the ValueSet with just the url query param I get back an error saying:</p>
<div class="codehilite"><pre><span></span><code>Expansion of ValueSet produced too many codes (maximum 1,000) - Operation aborted!
</code></pre></div>
<p>When doing the $expand operation with a <code>count=10</code> I get the same error but this time  with the maximum value changed:</p>
<div class="codehilite"><pre><span></span><code>Expansion of ValueSet produced too many codes (maximum 10) - Operation aborted!
</code></pre></div>
<p>Looking at the logs I see that a scheduler thread runs a few minutes afterwards <code>hapi-fhir-jpa-scheduler-clustered-3</code> and starts pre-expanding the ValueSet.<br>
After this the $expand queries work as expected.</p>
<ul>
<li>Is there a way to control this process? What is the expected behaviour, how does the scheduler decides what ValueSets to pre-expand?</li>
<li>Right now I'm just using h2 and lucine, would this change if I use Postgres and Elasticsearch?</li>
</ul>
<p>Thanks in advance! :)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
