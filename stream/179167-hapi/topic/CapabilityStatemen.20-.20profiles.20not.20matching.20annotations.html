---
layout: page
title: "FHIR Chat  · CapabilityStatemen - profiles not matching annotations · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html">CapabilityStatemen - profiles not matching annotations</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="181994668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/181994668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tobias Cervin <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#181994668">(Nov 27 2019 at 06:54)</a>:</h4>
<p>Can't seem to become friends with CapabilityStatement in our HAPI fhir-server/facade. Even though our Providers and Models have custom profile-urls and look like this:</p>
<div class="codehilite"><pre><span></span><span class="nd">@RegisterProfileClass</span><span class="o">(</span><span class="n">profile</span> <span class="o">=</span> <span class="n">CUSTOM_PROFILE_URL</span><span class="o">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">EHMMedicationRequest</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ResourceProviderQualifier</span><span class="o">(</span><span class="n">MedicationRequestResourceProvider</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MedicationRequestResourceProvider</span> <span class="kd">extends</span> <span class="n">AbstractValidatingProvider</span><span class="o">&lt;</span><span class="n">EHMMedicationRequest</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">IFhirResourceProvider</span><span class="o">&lt;</span><span class="n">MedicationRequest</span><span class="o">&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="nd">@ResourceDef</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;MedicationRequest&quot;</span><span class="o">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">CUSTOM_PROFILE_URL</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EHMMedicationRequest</span> <span class="kd">extends</span> <span class="n">MedicationRequest</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</pre></div>


<p>The "GET [base]/metadata?mode=full" returns:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MedicationRequest&quot;</span><span class="p">,</span>
          <span class="nt">&quot;profile&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hl7.org/fhir/StructureDefinition/MedicationRequest&quot;</span><span class="p">,</span>
          <span class="err">...</span>
<span class="p">}</span>
</pre></div>


<p>I have tried debugging at the start of the application and found that RuntimeSourceDefinition has the correct custom myResourceProfile. Anyone else wrestled with this?</p>



<a name="182058513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182058513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182058513">(Nov 27 2019 at 21:05)</a>:</h4>
<p>This was part of <a href="https://github.com/jamesagnew/hapi-fhir/pull/1088" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/pull/1088">https://github.com/jamesagnew/hapi-fhir/pull/1088</a> . If you run on 4.1.0, it should work for you (as it works for me ;) )</p>



<a name="182111101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182111101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tobias Cervin <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182111101">(Nov 28 2019 at 14:04)</a>:</h4>
<blockquote>
<p>This was part of <a href="https://github.com/jamesagnew/hapi-fhir/pull/1088" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/pull/1088">https://github.com/jamesagnew/hapi-fhir/pull/1088</a> . If you run on 4.1.0, it should work for you (as it works for me ;) )</p>
</blockquote>
<p>Thanks for reply!</p>
<p>We have bumped up to 4.1.0 but the same issue remains.</p>
<p>Debuging through:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="n">nextEntry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">==</span> <span class="kc">false</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">TypeRestfulInteraction</span><span class="o">&gt;</span> <span class="n">resourceOps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
        <span class="n">CapabilityStatementRestResourceComponent</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="na">addResource</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">resourceName</span> <span class="o">=</span> <span class="n">nextEntry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>

        <span class="n">RuntimeResourceDefinition</span> <span class="n">def</span><span class="o">;</span>
        <span class="n">FhirContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="na">getFhirContext</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">resourceNameToSharedSupertype</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">resourceName</span><span class="o">))</span> <span class="o">{</span>
          <span class="n">def</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getResourceDefinition</span><span class="o">(</span><span class="n">resourceNameToSharedSupertype</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">resourceName</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="n">def</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getResourceDefinition</span><span class="o">(</span><span class="n">resourceName</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">resource</span><span class="o">.</span><span class="na">getTypeElement</span><span class="o">().</span><span class="na">setValue</span><span class="o">(</span><span class="n">def</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">resource</span><span class="o">.</span><span class="na">getProfileElement</span><span class="o">().</span><span class="na">setValue</span><span class="o">((</span><span class="n">def</span><span class="o">.</span><span class="na">getResourceProfile</span><span class="o">(</span><span class="n">serverBase</span><span class="o">)));</span>
</pre></div>


<p>And the custom profiles are nowhere to be found...</p>



<a name="182133913"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182133913" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182133913">(Nov 28 2019 at 20:20)</a>:</h4>
<p>- just to be sure - we are talking about the need for a server to generate a capabilitystatement where it states that eg. the MedicationRequest is profiled according to what is stated in the @ResourceDef.profile annotation ?</p>



<a name="182153381"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182153381" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tobias Cervin <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182153381">(Nov 29 2019 at 06:06)</a>:</h4>
<blockquote>
<p>- just to be sure - we are talking about the need for a server to generate a capabilitystatement where it states that eg. the MedicationRequest is profiled according to what is stated in the @ResourceDef.profile annotation ?</p>
</blockquote>
<p>Just so! <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="182344815"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182344815" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182344815">(Dec 02 2019 at 13:31)</a>:</h4>
<p>its hard to say then. It works for us</p>
<div class="codehilite"><pre><span></span>{
          &quot;type&quot;: &quot;Appointment&quot;,
          &quot;profile&quot;: {
            &quot;reference&quot;: &quot;http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-appointment&quot;
          }, ...
}
</pre></div>



<a name="182421324"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182421324" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tobias Cervin <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182421324">(Dec 03 2019 at 06:56)</a>:</h4>
<blockquote>
<p>its hard to say then. It works for us</p>
</blockquote>
<p>{<br>
          "type": "Appointment",<br>
          "profile": {<br>
            "reference": "<a href="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-appointment" target="_blank" title="http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-appointment">http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-appointment</a>"<br>
          }, ...<br>
}</p>
<div class="codehilite"><pre><span></span>
</pre></div>


<p>Hmm, but that looks different still? Your profile is not a string but an object with a reference (and other members as well?)?</p>



<a name="182422038"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182422038" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182422038">(Dec 03 2019 at 07:12)</a>:</h4>
<p><a href="/user_uploads/10155/u0wfrQFtXHbBATfgKt4__hDl/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/u0wfrQFtXHbBATfgKt4__hDl/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/u0wfrQFtXHbBATfgKt4__hDl/pasted_image.png"></a></div>



<a name="182422057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182422057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182422057">(Dec 03 2019 at 07:13)</a>:</h4>
<p>My profile is a reference - as required by the documentation (STU3)</p>



<a name="182422224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182422224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tobias Cervin <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182422224">(Dec 03 2019 at 07:16)</a>:</h4>
<p>Ah I see, yeah ours is R4 so it's a canonical url only. Still really weird that it doesn't work...</p>



<a name="182423091"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapabilityStatemen%20-%20profiles%20not%20matching%20annotations/near/182423091" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapabilityStatemen.20-.20profiles.20not.20matching.20annotations.html#182423091">(Dec 03 2019 at 07:38)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> should using R4 be a problem?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
