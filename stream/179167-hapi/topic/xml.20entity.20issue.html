---
layout: page
title: "FHIR Chat  · xml entity issue · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/xml.20entity.20issue.html">xml entity issue</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="159908461"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/xml%20entity%20issue/near/159908461" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/xml.20entity.20issue.html#159908461">(Mar 04 2019 at 12:23)</a>:</h4>
<p>I'm attempting to upgrade HAPI from 3.0.0 -&gt; 3.7.0 and I have a failing test due to an issue with xml entities in narrative</p>
<p>Given this example:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
  <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;generated&quot;</span><span class="p">,</span>
    <span class="nt">&quot;div&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;©&lt;/div&gt;&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>I can parse it, but when re-encoding the narrative is turned into:</p>
<div class="codehilite"><pre><span></span>&quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;&amp;copy;&lt;/div&gt;&quot;
</pre></div>


<p>Then when attempting to parse that, I get:</p>
<div class="codehilite"><pre><span></span>ca.uhn.fhir.parser.DataFormatException: String does not appear to be valid XML/XHTML (error is &quot;ParseError at [row,col]:[1,49]
Message: The entity &quot;copy&quot; was referenced, but not declared.&quot;): &lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&amp;copy;&lt;/div&gt;
  at ca.uhn.fhir.util.XmlUtil.parse(XmlUtil.java:1748)
  at ca.uhn.fhir.model.primitive.XhtmlDt.parse(XhtmlDt.java:83)
  at ca.uhn.fhir.model.primitive.XhtmlDt.parse(XhtmlDt.java:41)
  at ca.uhn.fhir.model.api.BasePrimitive.setValueAsString(BasePrimitive.java:111)
  at ca.uhn.fhir.model.primitive.XhtmlDt.setValueAsString(XhtmlDt.java:132)
  at ca.uhn.fhir.parser.ParserState$XhtmlState.attributeValue(ParserState.java:1530)
  at ca.uhn.fhir.parser.ParserState.attributeValue(ParserState.java:66)
  at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:1033)
  at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:938)
  at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:1021)
  at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:938)
  at ca.uhn.fhir.parser.JsonParser.doParseResource(JsonParser.java:183)
  at ca.uhn.fhir.parser.JsonParser.doParseResource(JsonParser.java:165)
  at ca.uhn.fhir.parser.BaseParser.parseResource(BaseParser.java:648)
  at ca.uhn.fhir.parser.BaseParser.parseResource(BaseParser.java:697)
  at ca.uhn.fhir.parser.BaseParser.parseResource(BaseParser.java:707)
  ... 28 elided
Caused by: javax.xml.stream.XMLStreamException: ParseError at [row,col]:[1,49]
Message: The entity &quot;copy&quot; was referenced, but not declared.
  at com.sun.org.apache.xerces.internal.impl.XMLStreamReaderImpl.next(XMLStreamReaderImpl.java:604)
  at com.sun.xml.internal.stream.XMLEventReaderImpl.nextEvent(XMLEventReaderImpl.java:83)
  at ca.uhn.fhir.util.XmlUtil.parse(XmlUtil.java:1735)
  ... 43 more
</pre></div>


<p>(this is stu3)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
