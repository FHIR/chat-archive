---
layout: page
title: "FHIR Chat  · Combining Search not working as expected -- _list and · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html">Combining Search not working as expected -- _list and</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="166209992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166209992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166209992">(May 21 2019 at 20:34)</a>:</h4>
<p>Reference: <a href="https://www.hl7.org/fhir/search.html#combining" target="_blank" title="https://www.hl7.org/fhir/search.html#combining">https://www.hl7.org/fhir/search.html#combining</a></p>
<p>We are working on an IG for a medical formulary.   Roughly the CoveragePlan is a List (with some extra stuff) and the Drugs in the Plan are MedicationKnowledge instances.      The List refers to the MedicationKnowledge items.</p>
<p><strong>Example CoveragePlan</strong> is:  SaulExperimentCP2<br>
<a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/List/SaulExperimentCP2" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/List/SaulExperimentCP2">https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/List/SaulExperimentCP2</a><br>
<strong>Example FormularyDrug</strong> is:<br>
SaulExperimentFD2<br>
<a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge/SaulExperimentFD2" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge/SaulExperimentFD2">https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge/SaulExperimentFD2</a></p>
<p>I'm trying to exercise FHIR-based search on this data, and things are not working as expected when I combine searches as per the documentation.<br>
Here is what works, and what doesn't work.   Basically I can search for (classification=A) and (classification=B) successfully, but searching for (classification=A)<strong>AND</strong>(classification=B) fails.</p>
<div class="codehilite"><pre><span></span>- this **works**:       https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-DrugTierCS%7CBRAND
</pre></div>


<p>- this <strong>works</strong>:        <a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?_list=SaulExperimentCP2&amp;classification=BRAND" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?_list=SaulExperimentCP2&amp;classification=BRAND">https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?_list=SaulExperimentCP2&amp;classification=BRAND</a>     <br>
  - this <strong>works </strong> search by DrugTier  <a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-DrugTierCS%7CBRAND" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-DrugTierCS%7CBRAND">https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-DrugTierCS%7CBRAND</a><br>
    - this <strong>fails</strong>:      search by DrugTier <strong>AND</strong> planID <strong>with</strong> system   <a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-DrugTierCS%7CBRAND&amp;classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-PlanIDCS|12345XX9876543" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-DrugTierCS%7CBRAND&amp;classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-PlanIDCS|12345XX9876543">https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-DrugTierCS%7CBRAND&amp;classification=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/CodeSystem/usdrugformulary-PlanIDCS|12345XX9876543</a><br>
- this <strong>fails</strong>  search by DrugTier and PlanID <strong>without</strong> system   <a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=12345XX9876543&amp;classification=BRAND&amp;_profile=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/StructureDefinition/usdrugformulary-FormularyDrug" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=12345XX9876543&amp;classification=BRAND&amp;_profile=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/StructureDefinition/usdrugformulary-FormularyDrug">https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=12345XX9876543&amp;classification=BRAND&amp;_profile=https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/StructureDefinition/usdrugformulary-FormularyDrug</a></p>
<p>The same failure modes are present if I use the _list to constrain the search to members of the list.</p>



<a name="166212424"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166212424" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166212424">(May 21 2019 at 21:00)</a>:</h4>
<p>The <code>_list</code> search parameter is not yet implemented in HAPI FHIR unfortunately.</p>



<a name="166212922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166212922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166212922">(May 21 2019 at 21:06)</a>:</h4>
<p>Thanks for the quick response.</p>
<p>Is the failure searching for  (classification=A)AND(classification=B)  also expected.</p>



<a name="166262989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166262989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166262989">(May 22 2019 at 12:38)</a>:</h4>
<p>No, that one should work.</p>
<p>The error message there doesn't look like it's coming from HAPI though... A good first step would probably be to see if you can reproduce this on <a href="http://hapi.fhir.org" target="_blank" title="http://hapi.fhir.org">hapi.fhir.org</a> .. If not, this is probably a question for the HSPC developers.</p>



<a name="166272127"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166272127" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166272127">(May 22 2019 at 14:22)</a>:</h4>
<p>Saul's 2nd-to-last query (w/ systems) does fail with a <code>400</code> -- which is the error message I expect <span class="user-mention" data-user-id="191319">@James Agnew</span> is referring to.  But if we take the system out of the picture we have this:</p>
<ul>
<li><a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=BRAND" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=BRAND">Query w/ <code>classification=BRAND</code></a> returns MedicationKnowledge w/ id <code>SaulExperimentFD2</code></li>
<li><a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=12345XX9876543" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=12345XX9876543">Query w/ <code>classification=12345XX9876543</code></a> returns MedicationKnowledge w/ id <code>SaulExperimentFD2</code> (same as above)</li>
<li><a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=BRAND&amp;classification=12345XX9876543" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?classification=BRAND&amp;classification=12345XX9876543">Query w/ <code>classification=BRAND&amp;classification=12345XX9876543</code></a> returns <code>0</code> results.</li>
</ul>
<p>Given that the first two queries are successful and return _the same object_, we expect the third should also be successful.  No error is returned, but it has an empty set of results.  Do you still think that has something to do w/ HSPC implementation?</p>



<a name="166276828"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166276828" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166276828">(May 22 2019 at 15:07)</a>:</h4>
<p>Well, 400 errors coming out of HAPI should typically return an OperationOutcome. E.g.:</p>
<p><a href="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?foo=bar" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?foo=bar">https://api-v8-r4.hspconsortium.org/DrugFormulary1/open/MedicationKnowledge?foo=bar</a></p>
<p>It's suspicious to me that this one doesn't. I'd need to see a stack trace though to be sure..</p>



<a name="166277608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166277608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166277608">(May 22 2019 at 15:15)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> -- right, but can you comment on the results of my last message, which does not trigger the <code>400</code> error at all?</p>



<a name="166279016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166279016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166279016">(May 22 2019 at 15:28)</a>:</h4>
<p>that does look like something that should work, i'd agree.</p>



<a name="166279086"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166279086" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166279086">(May 22 2019 at 15:29)</a>:</h4>
<p>this isn't my server though, so my ability to troubleshoot is limited.. reproducing it on HAPI would be a requirement in order for me to be able to do anything about it</p>



<a name="166301911"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166301911" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166301911">(May 22 2019 at 19:35)</a>:</h4>
<p>Got it, thanks!  <span class="user-mention" data-user-id="215604">@Saul Kravitz</span> -- I'll leave the rest to you if you wish to try to reproduce this on the HAPI server.</p>



<a name="166304750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166304750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166304750">(May 22 2019 at 20:09)</a>:</h4>
<p>Will do.</p>



<a name="166308776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166308776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166308776">(May 22 2019 at 20:55)</a>:</h4>
<p>Short version:  everything works fine on <a href="http://hapi.fhir.org/baseR4" target="_blank" title="http://hapi.fhir.org/baseR4">http://hapi.fhir.org/baseR4</a><br>
Inserted two MedicationKnowledge objects -- <a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/">http://hapi.fhir.org/baseR4/MedicationKnowledge/</a>?<br>
<a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK1" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK1">http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK1</a><br>
<a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK2" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK2">http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK2</a></p>
<p><a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND">http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND</a>    returns both objects, as expected.<br>
<a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND">http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND</a> &amp;classification=12345XX9876544 returns one object, as expected.<br>
<a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND">http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=BRAND</a> &amp;classification=12345XX9876543 returns one object as expected<br>
<a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=12345XX9876544,12345XX9876543" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=12345XX9876544,12345XX9876543">http://hapi.fhir.org/baseR4/MedicationKnowledge/?classification=12345XX9876544,12345XX9876543</a> returns two objects as expected.</p>
<p>In short, works as advertised...sigh....</p>
<p>Thoughts on how to debug the HSPC server?<br>
I loaded the same two objects (MedicationKNowledge sans our extensions) into the HSPC server, and the 'AND' queries fail.</p>



<a name="166324051"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166324051" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166324051">(May 23 2019 at 01:17)</a>:</h4>
<p>Hmm, wonder if this is a bug that's already fixed in 3.8.0. Might be worth waiting for the release (happening this coming tuesday) to see if that resolves things on the HSPC side.</p>



<a name="166366938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Combining%20Search%20not%20working%20as%20expected%20--%20_list%20and/near/166366938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Combining.20Search.20not.20working.20as.20expected.20--.20_list.20and.html#166366938">(May 23 2019 at 14:41)</a>:</h4>
<p>My test also fails on our own build of HAPI 3.7.<br>
Look forward to 3.8 release....</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
