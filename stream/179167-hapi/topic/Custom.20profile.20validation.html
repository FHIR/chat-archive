---
layout: page
title: "FHIR Chat  · Custom profile validation · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html">Custom profile validation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="172590753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172590753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172590753">(Aug 06 2019 at 13:58)</a>:</h4>
<p>I am assisting a developer in implementing validation of a custom profile using HAPI.  What I'd like to be able to do is validate a set of resources against a set of custom profiles, regardless of whether they actually declare conformance to the profile or not.  He thought that starting with a FHIRInstanceValidator would do the trick but I don't see  way to ask "is this resource conformant to this profile?".  Is there a known way of doing this with HAPI?</p>



<a name="172592292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172592292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172592292">(Aug 06 2019 at 14:15)</a>:</h4>
<p>hapi can do this as you can provide the profile to validate against in the $validate operation</p>



<a name="172592396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172592396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172592396">(Aug 06 2019 at 14:16)</a>:</h4>
<p><a href="https://www.hl7.org/fhir/resource-operation-validate.html" target="_blank" title="https://www.hl7.org/fhir/resource-operation-validate.html">https://www.hl7.org/fhir/resource-operation-validate.html</a></p>



<a name="172592725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172592725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172592725">(Aug 06 2019 at 14:19)</a>:</h4>
<p>Yes, I know that it implements that function, so I know that it must have support on the server-side for calling the equivalent, but I can't see it.  I've implemented a server operation and I want to call this validation to ensure my operation parameters conform to the proper profiles.  I'll go look how the $validate operation works to see how we can implement this in our operation.</p>



<a name="172597379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172597379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172597379">(Aug 06 2019 at 15:09)</a>:</h4>
<p>Hmm, do we know that the HAPI $validate function works when given a specific profile?  I am about to test it, but the code would tell me otherwise.<br>
This method:<br>
public MethodOutcome validate(T theResource, IIdType theId, String theRawResource, EncodingEnum theEncoding, ValidationModeEnum theMode, String theProfile, RequestDetails theRequest)</p>
<p>in FhirResourceDaoR4 doesn't actually use the "String theProfile" parameter at all.</p>



<a name="172607079"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172607079" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172607079">(Aug 06 2019 at 17:00)</a>:</h4>
<p>oh, you are right. In FhirResourceDaoR4.java the String containing the profile is never used.<br>
<span class="user-mention" data-user-id="191319">@James Agnew</span> is this a bug?</p>



<a name="172617129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172617129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172617129">(Aug 06 2019 at 18:41)</a>:</h4>
<p>hmm yeah, i'd say that does sound like a bug :(</p>



<a name="172617299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172617299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172617299">(Aug 06 2019 at 18:43)</a>:</h4>
<p>I looked at FhirResourceDaoSTU3 and it also doesn't use the profile string, so it's not a recent bug.  I haven't tested the $validate call with the profile specified on the URL to see if that actually does work or not.</p>



<a name="172618830"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172618830" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172618830">(Aug 06 2019 at 19:01)</a>:</h4>
<p><a href="https://github.com/jamesagnew/hapi-fhir/issues/1414" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/issues/1414">https://github.com/jamesagnew/hapi-fhir/issues/1414</a></p>



<a name="172627104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172627104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172627104">(Aug 06 2019 at 20:49)</a>:</h4>
<p>Okay, notwithstanding the issue raised, is there a workaround?  can I "inject" a profile into a resource and then validate it?  I'm trying to read the HAPI code to see if it will validate a resource that declares it conforms to a profile.</p>



<a name="172627895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172627895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172627895">(Aug 06 2019 at 20:59)</a>:</h4>
<p>I'm not clear on the problem here. The core validator does do profile based validation...</p>



<a name="172630806"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172630806" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172630806">(Aug 06 2019 at 21:40)</a>:</h4>
<p>The issue here is that there is a bug in HAPI's wrapper around the core validator where if you explicitly ask it to validate against a specific profile URI, it ignores that URI. </p>
<p>Jean- you could explicitly declare your profile URL in your Resource.meta.profile element- if that's populated, the validator will use it.</p>



<a name="172631541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172631541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172631541">(Aug 06 2019 at 21:49)</a>:</h4>
<p>except that he said at the beginning: he wants to enforce the validation irrespective of what the resource claims or not</p>



<a name="172631884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172631884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172631884">(Aug 06 2019 at 21:55)</a>:</h4>
<p>yeah, that's the bug, I'm just proposing a temporary workaround while I fix that :)</p>



<a name="172708846"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172708846" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172708846">(Aug 07 2019 at 19:44)</a>:</h4>
<p>This has been fixed in the latest 4.0.0-SNAPSHOT in Maven Central, and on <a href="http://hapi.fhir.org" target="_blank" title="http://hapi.fhir.org">hapi.fhir.org</a></p>
<p>Also of note, we are now using the R5 validator, and a bunch of new caching has been added to the default IValidationSupport implementation used by the JPA server. I'm seeing some decent performance gains in my smoke tests right now.</p>



<a name="172718268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/172718268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#172718268">(Aug 07 2019 at 21:36)</a>:</h4>
<p>The R5 validator is getting pretty solid now. I'm close to moving to asking for test cases with bug reports</p>



<a name="184745434"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/184745434" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#184745434">(Jan 03 2020 at 16:10)</a>:</h4>
<p>Quick question folks -- using <code>http://hapi.fhir.org/baseR4/Patient/$validate</code> works as expected, but when I include <code>?profile=http://bogus/profile/url</code> parameter it seems to ignore it, reporting 200 with "No issues detected during validation". Is this expected behavior for the test server?</p>



<a name="184789944"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/184789944" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#184789944">(Jan 04 2020 at 05:38)</a>:</h4>
<p>not from my pov</p>



<a name="184963531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Custom%20profile%20validation/near/184963531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Custom.20profile.20validation.html#184963531">(Jan 06 2020 at 22:25)</a>:</h4>
<p>Hmm.. okay, it works-for-me now.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
