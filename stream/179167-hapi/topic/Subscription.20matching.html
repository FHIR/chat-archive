---
layout: page
title: "FHIR Chat  · Subscription matching · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Subscription.20matching.html">Subscription matching</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="193610581"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Subscription%20matching/near/193610581" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Seth Rylan Gainey <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Subscription.20matching.html#193610581">(Apr 10 2020 at 19:54)</a>:</h4>
<p>Our team is implementing Subscriptions using HAPI 3.8, but the limit of 1000 active subscriptions is a downside. I see that <a href="https://github.com/jamesagnew/hapi-fhir/pull/1487/files#diff-37147347d1e34e731d224a1afcf2c359R38" title="https://github.com/jamesagnew/hapi-fhir/pull/1487/files#diff-37147347d1e34e731d224a1afcf2c359R38">MAX_SUBSCRIPTION_RESULTS was increased to 50k</a> in 4.1, but it's not clear why this limit was lifted. Is there a performance improvement with subscription matching in 4.1?</p>



<a name="193622946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Subscription%20matching/near/193622946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Subscription.20matching.html#193622946">(Apr 10 2020 at 22:00)</a>:</h4>
<p>Hi Seth- Yup, in 4.1 we added "in memory matching", which allows many subscriptions (depending on the complexity of the criteria you use) to be processed without any database interaction at all. This dramatically increases the scalability of the subscription matcher.</p>
<p>When you submit a subscription to the server, you'll notice an extension added to the response. It details whether your criteria is able to take advantage of the in-memory matcher.</p>



<a name="193769096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Subscription%20matching/near/193769096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Seth Rylan Gainey <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Subscription.20matching.html#193769096">(Apr 13 2020 at 12:57)</a>:</h4>
<p>The changelog and javadocs say that in-memory matching was in 3.7+</p>
<blockquote>
<p>1.1.7HAPI FHIR 3.7.0 (Gale)<br>
Changed subscription processing, if the subscription criteria are straightforward (i.e., no chained references, qualifiers or prefixes) then attempt to match the incoming resource against the criteria in-memory</p>
</blockquote>
<p>Although there as an improvement added in 4.1.0</p>
<blockquote>
<p>Add support for in-memory matching on date comparisons ge,gt,eq,lt,le.</p>
</blockquote>
<p>We'll continue testing. Does it sound right that the upper bound for active Subscription with "non-in-memory" criteria is 1000, and about 50k for in-memory criteria? If so, we may just look at disabling the use of non-in-memory criteria for our server, since they would be a small set of Subscriptions, but a disproportionate performance cost.</p>



<a name="194326159"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Subscription%20matching/near/194326159" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Subscription.20matching.html#194326159">(Apr 16 2020 at 15:53)</a>:</h4>
<p>Hmm, yeah I guess my timeline was wrong. That sounds correct to me.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
