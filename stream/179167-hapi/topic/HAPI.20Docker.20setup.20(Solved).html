---
layout: page
title: "FHIR Chat  · HAPI Docker setup (Solved) · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20Docker.20setup.20(Solved).html">HAPI Docker setup (Solved)</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="224696698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20Docker%20setup%20%28Solved%29/near/224696698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20Docker.20setup.20(Solved).html#224696698">(Feb 01 2021 at 08:25)</a>:</h4>
<p>I'm trying to run HAPI, it goes well, but I have this error when making this query </p>
<p>HAPI Version: <code>HAPI FHIR 5.2.0 REST Server (FHIR Server; FHIR 4.0.1/R4)</code></p>
<p>Sending this request fails <code>localhost:8080/fhir/Patient?identifier=ID_SYSTEM_1|</code>.</p>
<div class="codehilite"><pre><span></span><code>root@hapifhir:/usr/local/tomcat# curl &#39;localhost:8080/fhir/Patient?identifier=ID_SYSTEM_1|&#39;

&lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP Status 400 – Bad Request&lt;/title&gt;&lt;style type=&quot;text/css&quot;&gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400 – Bad Request&lt;/h1&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Exception Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt; Invalid character found in the request target [&amp;#47;fhir&amp;#47;Patient?identifier=ID_SYSTEM_1|]. The valid characters are defined in RFC 7230 and RFC 3986&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid request message framing, or deceptive request routing).&lt;/p&gt;&lt;p&gt;&lt;b&gt;Exception&lt;/b&gt;&lt;/p&gt;&lt;pre&gt;java.lang.IllegalArgumentException: Invalid character found in the request target [&amp;#47;fhir&amp;#47;Patient?identifier=ID_SYSTEM_1|]. The valid characters are defined in RFC 7230 and RFC 3986
        org.apache.coyote.http11.Http11InputBuffer.parseRequestLine(Http11InputBuffer.java:486)
        org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:261)
        org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
        org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)
        org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)
        org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
        java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
        java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
        org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
        java.base&amp;#47;java.lang.Thread.run(Thread.java:834)
&lt;/pre&gt;&lt;p&gt;&lt;b&gt;Note&lt;/b&gt; The full stack trace of the root cause is available in the server logs.&lt;/p&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;h3&gt;Apache Tomcat/9.0.38&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>
<p>This request works on <code>hapi.fhir.org</code>, so not sure what's the fix<br>
Pulled from standard HAPI docker image, with this configuration</p>
<div class="codehilite"><pre><span></span><code>spring:
  datasource:
    url: &#39;jdbc:h2:file:./target/database/h2&#39;

    username: sa
    password: null
    driverClassName: org.h2.Driver
    max-active: 15

  batch:
    job:
      enabled: false

hapi:
  fhir:
    fhir_version: R4
    default_encoding: JSON
    default_pretty_print: false
    tester:

        home:
          name: Local Tester
          server_address: &#39;http://localhost:8080/fhir&#39;
          refuse_to_fetch_third_party_urls: false
          fhir_version: R4
</code></pre></div>



<a name="224853111"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/HAPI%20Docker%20setup%20%28Solved%29/near/224853111" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/HAPI.20Docker.20setup.20(Solved).html#224853111">(Feb 02 2021 at 10:32)</a>:</h4>
<p><strong>Solved</strong></p>
<p>I managed to fix it, I changed <code>server.xml</code> and used docker <code>configs</code> section to override the server.xml. </p>
<p>In particular, I made this change, added <code>relaxedQueryChars='|'</code>. </p>
<div class="codehilite"><pre><span></span><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;
               connectionTimeout=&quot;20000&quot;
               redirectPort=&quot;8443&quot; relaxedQueryChars=&#39;|&#39;/&gt;
</code></pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
