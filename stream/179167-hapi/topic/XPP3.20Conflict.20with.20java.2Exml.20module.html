---
layout: page
title: "FHIR Chat  · XPP3 Conflict with java.xml module · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html">XPP3 Conflict with java.xml module</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="177727684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177727684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177727684">(Oct 09 2019 at 15:51)</a>:</h4>
<p>I'm running into a problem compiling a HAPI Service using HAPI 4.0.1 using OpenJDK 11 that wants to make use of FHIR R4 and needs to use javax.xml.namespace.NamespaceContext.  The compile error is: The package javax.xml.namespace is accessible from more than one module: &lt;unnamed&gt;, java.xml</p>
<p>I've tracked it down (I think) to the the dependency chain:  hapi-fhir-structures-r4-4.0.1.jar which depends on ucum-1.0.2.jar which depends on xpp3-1.1.4c.jar which defines javax.xml.namespace.QName.  This conflicts with javax.xml.namespace package defined in JDK 11.</p>
<p>The xpp package is only used in the org.fhir.ucum.DefinitionParser class to parse UCUM definitions as far as I can tell.</p>
<p>I'm not sure why R4 structures is using this, it isn't found in STU3 or DSTU2 structures.</p>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Can you explain what ucum is used for in R4 Structures?</p>



<a name="177727870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177727870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177727870">(Oct 09 2019 at 15:53)</a>:</h4>
<p>For what it's worth, excluding the XPP artifact resolves the compile issue, but I'd like to understand better what functionality I'm effectively disabling when I do that.</p>



<a name="177728417"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177728417" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177728417">(Oct 09 2019 at 15:58)</a>:</h4>
<p>Also shows up as a depenency in org.hl7.fhir.validation (4.0.0) and hapi-fhir-validation (4.0.1), so a similar question there, what is XPP used for (what will I be disabling)</p>



<a name="177748511"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177748511" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177748511">(Oct 09 2019 at 19:41)</a>:</h4>
<p>the validator uses UCUM.</p>



<a name="177748546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177748546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177748546">(Oct 09 2019 at 19:41)</a>:</h4>
<p>Is this a version issue that the ucum code needs updating? because I use XPP in other places too</p>



<a name="177753699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177753699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177753699">(Oct 09 2019 at 20:36)</a>:</h4>
<p>The issue is that XPP defines javax.xml.namespace.QName which is already defined by Java in its runtime library, and so will run into issues when trying to compile a project using it without a module-info.java.  Ideally, XPP would just reuse Java's javax.xml.namespace.QName class, instead of defining its own, but that package doesn't seem to have had any maintainence for half a decade or more.</p>



<a name="177755483"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177755483" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177755483">(Oct 09 2019 at 20:56)</a>:</h4>
<p>I note that the APIs for QName are exactly the same, and so I think I can resolve this without reducing functionality by removing that package from the XPP library, excluding that dependency from the build via Maven, and adding my patched library.  I'm going to check this out to see if it works.</p>



<a name="177777690"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177777690" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177777690">(Oct 10 2019 at 04:13)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> I'm not following all this. Why hasn't this come up before? Do we need to clone XPP and sort this out? Wouldn't this be a problem for other users of XPP?</p>



<a name="177812220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177812220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keith Boone <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177812220">(Oct 10 2019 at 13:58)</a>:</h4>
<p>I suspect the reason this hasn't come up before is b/c there were workarounds for it in Eclipse prior to 2019-06 release, where you could "import" the JRE libraries using classpath instead of via Module, but that capability no longer exists since that release.  And so the only way you'd come up with it is if: a) you recently upgraded eclipse, and b) are using java XML and XPath libraries to do other work in your services b/c you are dealing with non-FHIR XML content.</p>



<a name="177871179"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177871179" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177871179">(Oct 11 2019 at 01:59)</a>:</h4>
<p>so I use xpp a lot. Maybe I should clone the code so that this isn't a problem anymore</p>



<a name="177871920"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177871920" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177871920">(Oct 11 2019 at 02:18)</a>:</h4>
<p>I wonder if we could work around this by using xpp3_min instead. It doesn't bundle the <code>javax.xml</code> class (which is definitely the issue here). JDK9+ uses the new module system and does not like people bundling stuff like that in random JARs.</p>
<p>XPP is not likely to ever be adapted to modern Java, as far as I can see the last release was 12 years ago.. The better long term solution might be to try to migrate to StAX but that also might be a lot of work. Trying xpp_min seems like the logical first thing to try.</p>



<a name="177871951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/XPP3%20Conflict%20with%20java.xml%20module/near/177871951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/XPP3.20Conflict.20with.20java.2Exml.20module.html#177871951">(Oct 11 2019 at 02:19)</a>:</h4>
<p><span class="user-mention" data-user-id="191387">@Keith Boone</span> can you try that? if AllR5Tests pass, then that'll work fine</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
