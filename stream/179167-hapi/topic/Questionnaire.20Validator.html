---
layout: page
title: "FHIR Chat  · Questionnaire Validator · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html">Questionnaire Validator</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="170766214"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170766214" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170766214">(Jul 13 2019 at 00:47)</a>:</h4>
<p><span class="user-mention" data-user-id="191478">@Oliver Egger</span> I believe that you wrote the enableWhen part of the InstanceValidator, which I'm currently fixing to cope with getting the answer from the right context (see <a href="#narrow/stream/179255-questionnaire/topic/enable-when" title="#narrow/stream/179255-questionnaire/topic/enable-when">https://chat.fhir.org/#narrow/stream/179255-questionnaire/topic/enable-when</a>). I don't understand why there's a DefaultEnableWhenEvaluator. Under what circumstances would it be useful or necessary (or even valid) to replace that implementation? I'm planning to inline it into the validator...</p>
<p>(<span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> <span class="user-mention" data-user-id="191319">@James Agnew</span> )</p>



<a name="170776117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170776117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170776117">(Jul 13 2019 at 06:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> , I'm not aware of any work done by me with enableWhen in the InstanceValidator, so I'm not much help here, please apologize</p>



<a name="170782649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170782649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170782649">(Jul 13 2019 at 09:24)</a>:</h4>
<p>ok I apologise. I don't know why I had it my head that you wrote that code</p>



<a name="170809326"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170809326" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170809326">(Jul 13 2019 at 23:27)</a>:</h4>
<p>Only thing I can think is that it was added to deal with the extension.  In theory,additional extensions could be added in the future</p>



<a name="170859099"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170859099" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170859099">(Jul 15 2019 at 02:18)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> - The EnableWhen logic was written by <span class="user-mention" data-user-id="197084">@Matti Uusitalo</span> (cc <span class="user-mention" data-user-id="192813">@Eeva Turkka</span> ) I believe</p>



<a name="170866184"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170866184" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170866184">(Jul 15 2019 at 05:52)</a>:</h4>
<p>We added the extension point to allow some custom enable when rules based on extensions in Finnish profiles. So it is necessary for us to replace that default implementation for our system, but we did implement the logic to the default implementation in addition to that in case someone else would need it.</p>
<p>(<span class="user-mention" data-user-id="194844">@Okko Kauhanen</span> was also involved)</p>



<a name="170885081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170885081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170885081">(Jul 15 2019 at 11:46)</a>:</h4>
<p>so I don't follow.... you have modifier extensions?</p>



<a name="170886108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170886108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170886108">(Jul 15 2019 at 12:03)</a>:</h4>
<p>We have modifier extension for evaluating enablewhen-condition in a questionnaire, yes. The condition used is fhirpath-expression and we are currently using STU3 in the system. The questionnaires are here: <a href="https://simplifier.net/finnishphr/~resources?category=Example&amp;exampletype=Questionnaire" target="_blank" title="https://simplifier.net/finnishphr/~resources?category=Example&amp;exampletype=Questionnaire">https://simplifier.net/finnishphr/~resources?category=Example&amp;exampletype=Questionnaire</a></p>



<a name="170890202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170890202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170890202">(Jul 15 2019 at 13:04)</a>:</h4>
<p>ok so I see the extension, but it doesn't make a difference to the way that enableWhen works or is evaluated - it's a parallel thing?</p>



<a name="170891050"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170891050" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170891050">(Jul 15 2019 at 13:14)</a>:</h4>
<p>We treat it like "if there's this modifier extension, the fhirpath-condition in the extension of the question resolves the enablewhen to either true or false" and if there isn't that extension, we call the default "super" implementation that we expect to work as fhir says.  It doesn't change the basic logic of enableWhen like "should there be an answer to this question or is an answer allowed here". Some of the questionnaires will have "normal" enable whens that don't have the modifier extension logic.</p>



<a name="170893975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/170893975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#170893975">(Jul 15 2019 at 13:46)</a>:</h4>
<p>hmm. so the extensibility wasn't really right. I'll add an extension point for controlling this</p>



<a name="176911950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/176911950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Juuso Oksanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#176911950">(Sep 30 2019 at 08:18)</a>:</h4>
<p>Is there a new implementation for this extension point? We noticed while migrating HAPI from 3.8.0 to 4.0.0 that the EnableWhenEvaluatorSupplier has been removed from the FhirInstanceValidator.</p>



<a name="176920818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/176920818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#176920818">(Sep 30 2019 at 10:46)</a>:</h4>
<p>I removed it since it was broken (the design was broken). And we couldn't figure out why it should be extensible</p>



<a name="176921286"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/176921286" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#176921286">(Sep 30 2019 at 10:54)</a>:</h4>
<p>Is there a way we could implement support for the modifier extension of the enableWhen behaviour that wouldn't be broken by design?</p>



<a name="176922150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/176922150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#176922150">(Sep 30 2019 at 11:08)</a>:</h4>
<p>what modifier extension</p>



<a name="176925530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/176925530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eeva Turkka <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#176925530">(Sep 30 2019 at 12:06)</a>:</h4>
<p>The one mentioned earlier in this thread: <a href="https://simplifier.net/finnishphr/fiphr-ext-questionnaire-enablewhenenablewhen" target="_blank" title="https://simplifier.net/finnishphr/fiphr-ext-questionnaire-enablewhenenablewhen">https://simplifier.net/finnishphr/fiphr-ext-questionnaire-enablewhenenablewhen</a> <br>
Some questionnaires have a fhirpath condition on some questions instead of the standard enable when (and we are still using STU3, but I believe it will be the same in R4).</p>



<a name="177132374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/177132374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Okko Kauhanen <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#177132374">(Oct 02 2019 at 08:54)</a>:</h4>
<p>FHIRPath-based item visibility logic is vital for our project. We have already built our implementation around it.</p>
<p>The standard enableWhen structure cannot express complex criteria. Extending the enableWhen-structure does not help either, so a parallel implementation is needed.</p>
<p>If this is a bad design choice, how should we proceed?</p>
<p>A similar official extension has been in development, but for some reason, it did not get included in R4:</p>
<p><a href="http://hl7.org/fhir/2018Sep/extension-questionnaire-enablewhen.html" target="_blank" title="http://hl7.org/fhir/2018Sep/extension-questionnaire-enablewhen.html">http://hl7.org/fhir/2018Sep/extension-questionnaire-enablewhen.html</a><br>
"This is only permitted when the containing item does NOT have any enableWhen elements."<br>
"Context of Use: Use on Element ID Questionnaire.item or Element ID Questionnaire.item.item"</p>



<a name="179013214"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/179013214" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#179013214">(Oct 25 2019 at 00:53)</a>:</h4>
<p>ok, getting to this.... the extension should not be a modifier extension</p>



<a name="179013327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/179013327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#179013327">(Oct 25 2019 at 00:56)</a>:</h4>
<p>does this capture the correct meaning of the extension?</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;Questionnaire</span> <span class="na">xmlns=</span><span class="s">&quot;http://hl7.org/fhir&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">value=</span><span class="s">&quot;questionnaire-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;language</span> <span class="na">value=</span><span class="s">&quot;en-US&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;text&gt;</span>
    <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;generated&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">lang=</span><span class="s">&quot;en-US&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>enableWhen test<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/text&gt;</span>
  <span class="nt">&lt;url</span> <span class="na">value=</span><span class="s">&quot;http://hl7.org/fhir/us/hai/Questionnaire/questionnaire-enableWhen-test&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;draft&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;condition&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;boolean&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;required</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;repeats</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;item&gt;</span>
    <span class="nt">&lt;extension</span> <span class="na">url=</span><span class="s">&quot;http://phr.kanta.fi/StructureDefinition/fiphr-ext-questionnaire-enablewhen&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;valueString</span> <span class="na">value=</span><span class="s">&quot;QuestionnaireResponse.descendants().select(item).where(linkId=&#39;condition&#39;).answer.value.ofType(&#39;boolean&#39;)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/extension&gt;</span>
    <span class="nt">&lt;linkId</span> <span class="na">value=</span><span class="s">&quot;enable-when&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;text</span> <span class="na">value=</span><span class="s">&quot;enable when condition true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;boolean&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;required</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;repeats</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/Questionnaire&gt;</span>
</pre></div>



<a name="179013828"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/179013828" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#179013828">(Oct 25 2019 at 01:06)</a>:</h4>
<p><span class="user-mention" data-user-id="194844">@Okko Kauhanen</span> what did you about passing in the current context to the FHIRPath expression when you are evaluating it?</p>



<a name="179015047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Questionnaire%20Validator/near/179015047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Questionnaire.20Validator.html#179015047">(Oct 25 2019 at 01:35)</a>:</h4>
<p>see discussion here: <a href="#narrow/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension" title="#narrow/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension">https://chat.fhir.org/#narrow/stream/179255-questionnaire/topic/SDC.20EnableWhen.20extension</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
