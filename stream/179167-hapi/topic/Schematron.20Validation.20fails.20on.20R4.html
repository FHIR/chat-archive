---
layout: page
title: "FHIR Chat  · Schematron Validation fails on R4 · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Schematron.20Validation.20fails.20on.20R4.html">Schematron Validation fails on R4</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="173669880"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Schematron%20Validation%20fails%20on%20R4/near/173669880" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mukesh Sharma <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Schematron.20Validation.20fails.20on.20R4.html#173669880">(Aug 20 2019 at 15:50)</a>:</h4>
<p>Hi,</p>
<p>I am using HAPI 3.7.0 implementation for FHIR. When I apply schematron validation on a R4 Patient resource, I get the following failure:<br>
Failed to apply Schematron bundleresource://367.fwk360062456:7/org/hl7/fhir/r4/model/schema/patient.sch onto XML source</p>
<p>Resource input that I provide:<br>
&lt;Patient xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
&lt;identifier&gt;<br>
&lt;period&gt;<br>
&lt;start value="2003-05-06"/&gt;<br>
&lt;end value="2000-05-07"/&gt;<br>
&lt;/period&gt;<br>
&lt;/identifier&gt;<br>
&lt;/Patient&gt;</p>
<p>I have validated that a schematron is present in the validation resources jar and has a rule :<br>
&lt;sch:rule context=“f:Patient/f:identifier/f:period”&gt;<br>
&lt;sch:assert test=“not(exists(f:start/@value)) or not(exists(f:end/@value)) or (xs:dateTime(f:start/@value) &lt;= xs:dateTime(f:end/@value))”&gt;per-1: If present, start SHALL have a lower value than end&lt;/sch:assert&gt;<br>
&lt;/sch:rule&gt;</p>
<p><strong>This issue is faced only on R4</strong>. For STU3 and DSTU2, this scenario passes with below outcome :</p>
<p>&lt;OperationOutcome&gt;<br>
&lt;issue&gt;<br>
&lt;severity value="error"/&gt;<br>
&lt;code value="processing"/&gt;<br>
&lt;diagnostics value="[error] in /*:Patient[namespace-uri()='<a href="http://hl7.org/fhir'][1]/*:identifier[namespace-uri()='http://hl7.org/fhir'][1]/*:period[namespace-uri()='http://hl7.org/fhir'][1]" target="_blank" title="http://hl7.org/fhir'][1]/*:identifier[namespace-uri()='http://hl7.org/fhir'][1]/*:period[namespace-uri()='http://hl7.org/fhir'][1]">http://hl7.org/fhir'][1]/*:identifier[namespace-uri()='http://hl7.org/fhir'][1]/*:period[namespace-uri()='http://hl7.org/fhir'][1]</a> @ Patient per-1: If present, start SHALL have a lower value than end Test=not(exists(f:start)) or not(exists(f:end)) or (f:start/@value &lt;= f:end/@value)"/&gt;<br>
&lt;location value="Patient"/&gt;<br>
&lt;/issue&gt;<br>
&lt;/OperationOutcome&gt;</p>
<p>I suspect there is a bug with the SchematronValidator for R4.</p>
<p>Please check.</p>
<p>Regards,<br>
Mukesh</p>



<a name="173687369"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Schematron%20Validation%20fails%20on%20R4/near/173687369" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Schematron.20Validation.20fails.20on.20R4.html#173687369">(Aug 20 2019 at 19:19)</a>:</h4>
<p>That looks like a valid error to me- your start date comes after your end date, so that's not a valid period.</p>



<a name="173694130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/Schematron%20Validation%20fails%20on%20R4/near/173694130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/Schematron.20Validation.20fails.20on.20R4.html#173694130">(Aug 20 2019 at 20:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> I think the point is that the Schematron rule validly fires in DSTU2 and STU3 but not in R4.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
