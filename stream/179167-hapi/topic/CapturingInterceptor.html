---
layout: page
title: "FHIR Chat  · CapturingInterceptor · hapi"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/index.html">hapi</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html">CapturingInterceptor</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153863765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153863765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153863765">(Dec 16 2016 at 18:56)</a>:</h4>
<p>I've been playing around with the capturingInterceptor to try to pull the raw response. However, the stream is always closed after the client execution is done.</p>



<a name="153863766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153863766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153863766">(Dec 16 2016 at 18:57)</a>:</h4>
<p>For example:<br>
Bundle bundle = client.search().byUrl(queryUrl).returnBundle(Bundle.class).execute();<br>
IOUtils.toString(capturingInterceptor.myLastResponse.readEntity());</p>
<p>Will always throw an exception for reading from a closed stream</p>



<a name="153863767"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153863767" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153863767">(Dec 16 2016 at 18:58)</a>:</h4>
<p>Is there some other path that will allow me to get to the raw entity body from the response after the execute?</p>



<a name="153863768"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153863768" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153863768">(Dec 16 2016 at 18:59)</a>:</h4>
<p>HAPI 2.1, if it makes a difference</p>



<a name="153863769"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153863769" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153863769">(Dec 16 2016 at 19:01)</a>:</h4>
<p>It looks like the interceptor has a direct copy of the original response, so it's not that surprising that the stream is closed once HAPI parses it. However, it was a bit surprising because I was expecting the interceptor to be used for this exact situation :)</p>



<a name="153863770"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153863770" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153863770">(Dec 16 2016 at 19:02)</a>:</h4>
<p>I've also been staring at a bunch of code for a while, so I could be missing something.</p>



<a name="153863793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153863793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153863793">(Dec 16 2016 at 22:36)</a>:</h4>
<p>Note: I got past this by creating my own interceptor, calling the bufferResponse() method when the interceptResponse(...) method was called, and copying the entity (in string form for now) to another field.</p>



<a name="153864014"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153864014" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153864014">(Dec 19 2016 at 16:03)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="191356">@Jenni Syed</span> , The right way to avoid the  is to call <code>bufferEntitity()</code> on the <code>IHttpResponse</code> method (presumably that's what you meant by <code>bufferResponse()</code>?) so you're definitely doing this the "right" way.</p>
<p>CaptureInterceptor should probably do exactly what you're doing.. I've only ever used it to capture the request URL which is why it hasn't led to the problem you're talking about. (Any chance you want to contribute your interceptor? Happy to include it if you think it'd be a worthwhile successor to CaptureInterceptor)</p>
<p>As a dumb aside, I see that <code>bufferEntitity</code> has a typo. Sigh, will fix that and deprecate the old method...</p>



<a name="153864016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153864016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153864016">(Dec 19 2016 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> any interest in "fixing" the existing Interceptor? The documentation seems to indicate getting the response is one of the functions that should be available there? If so, I can look at contributing a patch that fixes it.</p>



<a name="153864018"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179167-hapi/topic/CapturingInterceptor/near/153864018" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179167-hapi/topic/CapturingInterceptor.html#153864018">(Dec 19 2016 at 16:13)</a>:</h4>
<p>That'd be awesome, yeah</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
