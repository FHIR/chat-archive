---
layout: page
title: "FHIR Chat  · HAPI partitioning? · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html">HAPI partitioning?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="242651144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242651144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242651144">(Jun 14 2021 at 19:56)</a>:</h4>
<p>Can anyone tell me how $evaluate-measure is treated when HAPI's partitioning is turned on?</p>



<a name="242651220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242651220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242651220">(Jun 14 2021 at 19:56)</a>:</h4>
<p>Can I load the Measure, Library and ValueSet resources onto the DEFAULT partition, and then $evaluate-measure against data in a different partition?</p>



<a name="242651309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242651309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242651309">(Jun 14 2021 at 19:57)</a>:</h4>
<p>i.e.<br>
/fhir/DEFAULT/Measure/SomeMeasure<br>
and then execute<br>
/fhir/SOME-OTHER-PARTITION/Measure/SomeMeasure/$evaluate-measure?periodStart=XXX&amp;periodEnd=YYY</p>



<a name="242656038"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242656038" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242656038">(Jun 14 2021 at 20:38)</a>:</h4>
<p>I don't think cross-partition execution would be supported currently but I've never actually tried it.</p>



<a name="242657363"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242657363" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242657363">(Jun 14 2021 at 20:50)</a>:</h4>
<p><span class="user-mention" data-user-id="194178">@JP</span> any thoughts on what it <em>would</em> take to make that work?</p>



<a name="242657380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242657380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242657380">(Jun 14 2021 at 20:50)</a>:</h4>
<p>Anything I can do to help that along?</p>



<a name="242657387"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242657387" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242657387">(Jun 14 2021 at 20:50)</a>:</h4>
<p>(point me in the right direction?)</p>



<a name="242657929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242657929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242657929">(Jun 14 2021 at 20:55)</a>:</h4>
<p>This is the class that does the data-access from the perspective of the cql evaluation:</p>
<p><a href="https://github.com/hapifhir/hapi-fhir/blob/376a84d2134588eb8b62685c93166318a76bf5a7/hapi-fhir-jpaserver-cql/src/main/java/ca/uhn/fhir/cql/common/retrieve/JpaFhirRetrieveProvider.java#L46">https://github.com/hapifhir/hapi-fhir/blob/376a84d2134588eb8b62685c93166318a76bf5a7/hapi-fhir-jpaserver-cql/src/main/java/ca/uhn/fhir/cql/common/retrieve/JpaFhirRetrieveProvider.java#L46</a></p>
<p>It takes a DaoRegistry as a parameter which it is how it accesses the underlying HAPI database. If there were a way to configure the registry to point to a different partition or to inject a different registry you could in principle access different data. I don't have any experience with HAPI's partitioning scheme so I'm not sure if that's possible but that's where I'd start looking.</p>



<a name="242657946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242657946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242657946">(Jun 14 2021 at 20:55)</a>:</h4>
<p>Is that helpful?</p>



<a name="242658453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242658453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242658453">(Jun 14 2021 at 21:00)</a>:</h4>
<p>very</p>



<a name="242658457"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242658457" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242658457">(Jun 14 2021 at 21:00)</a>:</h4>
<p>thanks</p>



<a name="242661237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242661237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242661237">(Jun 14 2021 at 21:27)</a>:</h4>
<p>Ok. I setup a scenario where the Measure was loaded on DEFAULT partition, and data loaded on "somePartition" partition</p>



<a name="242661251"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242661251" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242661251">(Jun 14 2021 at 21:27)</a>:</h4>
<p>Getting the following right now:</p>



<a name="242661255"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242661255" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242661255">(Jun 14 2021 at 21:27)</a>:</h4>
<p>No interceptor provided a value for pointcut: STORAGE_PARTITION_IDENTIFY_READ</p>



<a name="242661302"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/HAPI%20partitioning%3F/near/242661302" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/HAPI.20partitioning.3F.html#242661302">(Jun 14 2021 at 21:28)</a>:</h4>
<p>Trying to figure out what causes that...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
