---
layout: page
title: "FHIR Chat  · Opioid Prescribing Support IG · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html">Opioid Prescribing Support IG</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="252697643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/252697643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge de la Garza <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#252697643">(Sep 09 2021 at 21:17)</a>:</h4>
<p>Hi, I'm trying to translate to ELM the CQL for recommendation 5 from the Opioid Prescribing Support IG: <a href="http://build.fhir.org/ig/cqframework/opioid-cds/recommendation-05.html">http://build.fhir.org/ig/cqframework/opioid-cds/recommendation-05.html</a><br>
I'm using the cql-to-elm utility that is part of the cql-execution repository on GitHub: <a href="https://github.com/cqframework/cql-execution/blob/master/README.md#to-execute-your-cql">https://github.com/cqframework/cql-execution/blob/master/README.md#to-execute-your-cql</a><br>
I'm able to translate OMTKData2019, OpioidCDSCommon, and OMTKLogicCQL without issue. However I'm getting errors for OpioidCDSREC05:<br>
================================================================================<br>
TRANSLATE C:\Users\garza\Desktop\opioid-prescribing-support-ig\cql\OpioidCDSREC05.cql<br>
Translation failed due to errors:<br>
Error:[7:1, 7:57] Could not load source for library OpioidCDSRoutines, version 1.2.2.<br>
Error:[46:11, 46:18] Could not resolve identifier Routines in the current library.<br>
Error:[57:9, 57:16] Could not resolve identifier Routines in the current library.<br>
Error:[69:13, 69:20] Could not resolve identifier Routines in the current library.<br>
Error:[52:3, 52:22] Could not validate reference to expression Inclusion Criteria because its definition contains errors.<br>
Error:[77:6, 77:36] Could not validate reference to expression Is Recommendation Applicable? because its definition contains errors.<br>
Error:[82:6, 82:36] Could not validate reference to expression Is Recommendation Applicable? because its definition contains errors.<br>
Error:[92:6, 92:36] Could not validate reference to expression Is Recommendation Applicable? because its definition contains errors.</p>
<p>So it seems there is a missing library, and I can't find it anywhere on the Opioid Prescribing Support IG site.  Anyone know where I can get that library?</p>
<p>In trying to find it, I noticed that there is an "R4" version of the IG, that is based on FHIR R4: <a href="http://build.fhir.org/ig/cqframework/opioid-cds-r4/index.html">http://build.fhir.org/ig/cqframework/opioid-cds-r4/index.html</a><br>
The first IG is based on STU3.  I had originally been looking at the STU3 version because that's what was linked to on the Confluence page for the Clinical Reasoning track: <a href="https://confluence.hl7.org/display/FHIR/2021-09+Clinical+Reasoning">https://confluence.hl7.org/display/FHIR/2021-09+Clinical+Reasoning</a><br>
Should the Confluence page be linking to the R4 version of the IG?</p>



<a name="252698819"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/252698819" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#252698819">(Sep 09 2021 at 21:26)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="192535">@Jorge de la Garza</span> , I notice in the path on the translate call that it's <code>opioid-prescribing-support-ig\cql\OpioidCDSRec05.cql</code>, but assuming <code>opioid-prescribing-support-ig</code> is the root of your clone, the path should be <code>opioid-prescribing-support-ig\input\pagecontent\cql\OpioidCDSRec05.cql</code>. Did you make a complete clone of the repository?</p>



<a name="252698881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/252698881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#252698881">(Sep 09 2021 at 21:27)</a>:</h4>
<p>The library it's referencing is called <code>OpioidCDSRoutines</code>, the <code>Routines</code> identifier is a local alias for that library within the <code>OpioidCDSRec05</code> library.</p>



<a name="252698926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/252698926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#252698926">(Sep 09 2021 at 21:27)</a>:</h4>
<p>I just got latest on master and verified that I can translate OpioidCDSRec05, so I'm wondering if maybe you have an incomplete local copy?</p>



<a name="252699068"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/252699068" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#252699068">(Sep 09 2021 at 21:28)</a>:</h4>
<p>And yes, we should probably point to both the opioid-cds (STU3) and opioid-cds-r4 (R4) versions of the repository, we support both versions since we are working with both STU3 and R4 FHIR servers.</p>



<a name="252699404"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/252699404" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#252699404">(Sep 09 2021 at 21:31)</a>:</h4>
<p>Updated the confluence page.</p>



<a name="252724133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/252724133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge de la Garza <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#252724133">(Sep 10 2021 at 02:36)</a>:</h4>
<p>Ah. I didn't realize there was a repository.  I was just trying to transform the CQLs  on the recommendation 5 page.  So when I try to transform the whole cql folder from the repository, then everything transforms without issue. Thanks <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="253261052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/253261052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge de la Garza <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#253261052">(Sep 14 2021 at 14:30)</a>:</h4>
<p>Hi, I'm still working on supporting this IG. To evaluate the CQL, I'm using the <code>cql-execution</code>, <code>cql-exec-fhir</code>, and <code>cql-exec-vsac</code> repos from GitHub. One thing that I'm finding is that the valuesets defined in OpioidCDSCommon.cql do not seem to exist in VSAC. It seems like they only exist as ValueSet resources in the IG.  I suppose I could write something that takes a ValueSet resource and adds the codes to the <code>cql-execution</code> <code>CodeService</code>. Does that sound right, or is there some other way I should be making these valuesets available to the evaluation?</p>



<a name="253265905"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/253265905" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#253265905">(Sep 14 2021 at 14:58)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="192535">@Jorge de la Garza</span> -- as you noted, <code>cql-exec-vsac</code> only supports value sets in VSAC.  We don't currently have an implementation that supports arbitrary FHIR-defined value sets -- although it's possible that <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> has implemented something like this to support some other projects he's worked on.  Bryn?</p>
<p>Assuming there is nothing out there yet, then yes, I think the way forward would be to implement something that can push the FHIR value sets into the <code>CodeService</code>.  Or a script that just adds your value sets to the VS cache file that the service loads on startup.  If you don't use <em>any</em> value sets from VSAC, then you could also just write your own <code>CodeService</code> implementation.</p>



<a name="253328444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/253328444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#253328444">(Sep 14 2021 at 21:40)</a>:</h4>
<p>So, we did write something that will take FHIR ValueSet resources (fully expanded) and output them as a valueset_db.json file suitable for use in the JavaScript engine:</p>



<a name="253328659"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/253328659" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#253328659">(Sep 14 2021 at 21:42)</a>:</h4>
<p><a href="https://github.com/cqframework/cqf-tooling/blob/master/src/main/java/org/opencds/cqf/tooling/terminology/ToJsonValueSetDbOperation.java">https://github.com/cqframework/cqf-tooling/blob/master/src/main/java/org/opencds/cqf/tooling/terminology/ToJsonValueSetDbOperation.java</a></p>



<a name="253328702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/253328702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#253328702">(Sep 14 2021 at 21:42)</a>:</h4>
<p>The docs are pretty horrid, I thought I had doc'ed it when I built it, but... apparently not. It's pretty simple, just in and out directories.</p>



<a name="253328753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/253328753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#253328753">(Sep 14 2021 at 21:43)</a>:</h4>
<p>There's also an EnsureExecutableValueSet that will expand FHIR ValueSets (so long as the definition is trivial)</p>



<a name="253328807"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/253328807" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#253328807">(Sep 14 2021 at 21:43)</a>:</h4>
<p>Longer term, one of the things we're working on this connectathon is a FederatingTerminologyClient:</p>



<a name="253328861"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Opioid%20Prescribing%20Support%20IG/near/253328861" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Opioid.20Prescribing.20Support.20IG.html#253328861">(Sep 14 2021 at 21:44)</a>:</h4>
<p><a href="https://github.com/cqframework/cqf-tooling/pull/298">https://github.com/cqframework/cqf-tooling/pull/298</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
