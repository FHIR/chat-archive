---
layout: page
title: "FHIR Chat  · FHIR and CQL Impl · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html">FHIR and CQL Impl</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153958567"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153958567" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Tarar <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153958567">(May 12 2018 at 15:22)</a>:</h4>
<p>Trying to get my head around CQL and producing a real unit of work for a Usecase.</p>
<p>Need some feed back on<br>
1. CQL Execution<br>
2. Actual Action Evaluation via PlanDef<br>
Does this flow look right?<br>
<span class="user-mention" data-user-id="191813">@ArunSrinivasan</span> <span class="user-mention" data-user-id="194273">@Marcelo caldas</span> <span class="user-mention" data-user-id="191469">@Chris Moesel</span> <a href="user_uploads/10155/7oqr7d_dZfHMxF_6aeRuzKu1/download.jpg" target="_blank" title="user_uploads/10155/7oqr7d_dZfHMxF_6aeRuzKu1/download.jpg">download.jpg</a></p>
<div class="message_inline_image"><a href="user_uploads/10155/7oqr7d_dZfHMxF_6aeRuzKu1/download.jpg" target="_blank" title="download.jpg"><img src="user_uploads/10155/7oqr7d_dZfHMxF_6aeRuzKu1/download.jpg"></a></div>



<a name="153958580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153958580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153958580">(May 12 2018 at 16:05)</a>:</h4>
<p>Can you give a little more context about what this is a depiction of?</p>



<a name="153959592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153959592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Tarar <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153959592">(May 13 2018 at 11:29)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  Attached here is more context. There are muitiple usecases for this pattern. For simplicity I'll decribe one such usecase below. </p>
<p>Paul Coverdell Stroke Registry <br>
When Stroke Patients get discharged, there is a follow-up that happens by care provider orgs ,(eg: Hospice , In home care and many other entities).<br>
The follow up is usally a set of questions are are asked of the patient 7,14,30,... days after discharge. The key here is timeliness. Most of the time this identification of a cohort is a very manual process. Also a lot of Patients are missed in this manual identification of a cohort.</p>
<p>The pattern is  -&gt; initial trigger -&gt; subsequent adjudication -&gt; Cohort Match found</p>
<p>Now initial trigger could be a CDS Hooks based or Subscription based trigger.</p>
<p>For subsequent adjudication , we liked the CQL approach and we think that it could scale. So we are trying to implement a Remote CDS Service , which loads CQL as a Resource. for eample stroke.cql would be exposed as  RemoteCDSSErviceURL/cds-services/stroke/ . The idea is for Triggering mechanisms to dump POST requests with resources as Payloads to this service.</p>
<p>This would mean that the CDS Service will receive a FHIR Resource payload (or a ref) to it so the CQL mapped to that endpoint could be executed and measures calculated. These measures are then applied to PlanDef on the server. </p>
<p>We were trying to validate our understanding and would welcome some feedback or course corrections.We are leveraging one of your implementations @github , trying to undertstand on how cqf-ruler or cqf-engine would fit the need(or develop our own tooling).</p>
<p>Adding another diagram with a bit more context:</p>
<p><a href="/user_uploads/10155/eFLYYJZ9kaoZZAerdMFYi2pD/download-1.jpg" target="_blank" title="download-1.jpg">download-1.jpg</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/eFLYYJZ9kaoZZAerdMFYi2pD/download-1.jpg" target="_blank" title="download-1.jpg"><img src="/user_uploads/10155/eFLYYJZ9kaoZZAerdMFYi2pD/download-1.jpg"></a></div><p><span class="user-mention" data-user-id="191813">@ArunSrinivasan</span> <span class="user-mention" data-user-id="194273">@Marcelo caldas</span></p>



<a name="153960540"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960540" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960540">(May 14 2018 at 16:51)</a>:</h4>
<p>(deleted)</p>



<a name="153960630"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960630" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960630">(May 14 2018 at 20:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> is more familiar w/ the FHIR Clinical Reasoning side of things, and particularly associated Operations, than I am. That said, my understanding of <code>$apply</code> (mostly from <a href="http://hl7.org/fhir/STU3/plandefinition-operations.html#apply" target="_blank" title="http://hl7.org/fhir/STU3/plandefinition-operations.html#apply">here</a>) is that you can't POST the CQL results as input.  I think the <code>$apply</code> operation expects the FHIR server to execute the CQL as part of the operation -- so having a CQL exec service separate from the FHIR server probably doesn't work for this case.</p>



<a name="153960632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960632">(May 14 2018 at 20:07)</a>:</h4>
<p>If this was intended as a point-of-care clinical invocation, then you could probably wrap the CQL in a CDS Hooks service and return suggestion cards -- but it sounds like your use case is for this to be a bit more behind-the-scenes, not necessarily at or during the point of care.  Is that right, <span class="user-mention" data-user-id="194261">@Rishi Tarar</span>?</p>



<a name="153960635"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960635" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960635">(May 14 2018 at 20:21)</a>:</h4>
<p>CQL can be loaded into a FHIR server for execution with the CQL engine using a Library resource. The CQF engine is a stand-alone component that can run CQL and access data from any FHIR server (you provide an endpoint as part of configuring the engine). The CQF ruler is a HAPI FHIR derivative that plugs a CQL engine in and loads CQL from Library resources on the server. In that configuration, the engine will use the JPA layer to access FHIR data in the local FHIR server.</p>



<a name="153960636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960636">(May 14 2018 at 20:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> -- is my understanding of <code>$apply</code> (see above) correct?  And if so, does CQF engine or CQF ruler support <code>$apply</code>?</p>



<a name="153960637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960637">(May 14 2018 at 20:24)</a>:</h4>
<p>So the middle layer here could either be a FHIR server (a modified CQF Ruler would work) or just a custom service that subscribes to the FHIR server generating the events, and then runs the CQL using the FHIR server that originated the event as the endpoint.</p>



<a name="153960638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960638">(May 14 2018 at 20:24)</a>:</h4>
<p>That's correct, $apply isn't a general CQL $evaluate, $apply is specifically about running a PlanDefinition.</p>



<a name="153960639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960639">(May 14 2018 at 20:25)</a>:</h4>
<p>Yes, the CQF Ruler supports $apply, that's what we use in the CDS Hooks servlet to process rules.</p>



<a name="153960640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960640">(May 14 2018 at 20:26)</a>:</h4>
<p>We've toyed with a general $evaluate operation ($cql maybe?) and it would be trivial to implement, but we haven't yet.</p>



<a name="153960641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960641">(May 14 2018 at 20:28)</a>:</h4>
<p>Does <code>$apply</code> actually post the resulting CarePlan to the server as well?  Or does it just return it and it's up to the caller to post it back if they want to save it?</p>



<a name="153960707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960707">(May 14 2018 at 21:05)</a>:</h4>
<p>It just returns it, it's up to the caller to decide what to do with it.</p>



<a name="153960756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153960756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Tarar <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153960756">(May 14 2018 at 23:11)</a>:</h4>
<p>This is awesome feedback <span class="user-mention" data-user-id="191469">@Chris Moesel</span> <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> .</p>
<p>I am thinking of a way where the CDS Package which could constitute of <br>
1. CQL <br>
2. Associated Libraries (Terminology Valuesets etc)<br>
3. Trigger Criteria (CDS Hook or Subscription )</p>
<p><strong>On the flow: </strong><br>
So from what I understood a modified cqf-ruler (custom service) would work. See below<br>
1. Input from either a CDS Hooks(UI Based) or Subscription callback rest hook(backend)<br>
2. The said custom service then "runs" the CQL against the FHIR Server that originated the call<br>
3. The CQL Output measure is determined and CDS SErvice takles and action (Send Card back for CDS Hooks , Take an Action to log a Match for a cohort for Subscription based triggering)</p>
<p><strong>The "runs"  part</strong><br>
Running a CQL against the data from the FHIR Server<br>
1. Looking at the cqf-ruler on git hub , it appears that CQL and Libs are loaded on cql-ruler<br>
2. FHIR Server onbly provides the data </p>
<p><strong>The Plan Definition</strong><br>
It appears Plan Definition and Care Plan are very specific to a FHIR Server and in-situ feedback on Clinical Workflow pathways.<br>
It seems to me they may not be relevant,  to what I am trying to achieve for sentinel background actions like the stroke usecase. </p>
<p>A Custom CQF-RULER type service can meet our needs.</p>
<p>Does this make sense?</p>



<a name="153961414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153961414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153961414">(May 16 2018 at 03:11)</a>:</h4>
<p>You're getting much deeper into <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> 's territory than mine, so I'm afraid I can't provide much confirmation at this point -- as I don't really have any experience w/ cqf-ruler.</p>



<a name="153961440"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153961440" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153961440">(May 16 2018 at 06:39)</a>:</h4>
<p><span class="user-mention" data-user-id="194261">@Rishi Tarar</span> , yes, from what I understand of the use case, this sounds reasonable and a modified CQF-Ruler or equivalent middle layer should be able to handle it.</p>



<a name="153961441"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153961441" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153961441">(May 16 2018 at 06:41)</a>:</h4>
<p>You're right that PlanDefinition and CarePlan are about representing workflow, but I'll just note that PlanDefinition can be used to build Event-Condition-Action rules.</p>



<a name="153961442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153961442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153961442">(May 16 2018 at 06:42)</a>:</h4>
<p>I'm still a little unclear about how CDS Hooks fits into what you're describing, but if it's part of a provider workflow and requires provider interaction then yes, that makes sense.</p>



<a name="153961874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153961874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Tarar <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153961874">(May 16 2018 at 13:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="191469">@Chris Moesel</span>  Thanks for clarifications.</p>
<p>You are right Bryn. The abstract view is that CDS(verb) will have two types of usecases<br>
1. UI Based .. where provider feed back is indeed required<br>
2. Sentinel .. non UI scenarios </p>
<p>The CDS mechanism to deliver "the package" differs for both of these as for UI based you could have PlanDef (Event-Condition-Action) and for Sentinel, you could have (Remote CDS and subsequent downstream actions without burdening the provider or the EHR)</p>
<p>Most of the Pop Health and Public health use cases align well with the Sentinel Scenario. This is only a technical and standards aspect. However the Data USe and Security "must" be respected. And that could be the next level of conversation with the community.</p>
<p>We will give cqf-ruler impl a try.. We are trying to <br>
1. Package cqf-ruler as a Springboot App <br>
2. Expose the cql-engine tooling <br>
3. Try to modularize Loading of  "CDS Package" and expose it as an Endpoint.</p>
<p>We may have some follow up questions.<br>
Thanks for all the feedback. We will see you guys at FHIRDevDays....<br>
<span class="user-mention" data-user-id="194273">@Marcelo caldas</span> <span class="user-mention" data-user-id="191813">@ArunSrinivasan</span> <br>
-RIshi</p>



<a name="153961955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FHIR%20and%20CQL%20Impl/near/153961955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FHIR.20and.20CQL.20Impl.html#153961955">(May 16 2018 at 14:47)</a>:</h4>
<p><span class="user-mention" data-user-id="194261">@Rishi Tarar</span> , that sounds fantastic, see you at FHIRDevDays!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
