---
layout: page
title: "FHIR Chat  · aggregation operators · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.html">aggregation operators</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="160278327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators/near/160278327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.html#160278327">(Mar 08 2019 at 10:29)</a>:</h4>
<p>Hello, I have a CQL problem using the aggregation operators. The documentation says that "If a path is specified, the count returns the number of elements that have a value for the property specified by the path.". What happens if the path traverses array fields ? Do all elements in this array have to have a value for the rest of the path, or only one ?<br>
Another problem I have with the semantics of the aggregation operators is the scope of the aggregation. Taking as example the CQL query "[Patient] A where Count(A.name.given) &gt; 1 return A". The query could either return all patients with more than one name that has at least one given name, or all patient with at least one name having more than one given name. It could be assumed that the scope gets set by default to the source given in the operator. How would a query look like that defines as scope a part of the path (<a href="http://A.name" target="_blank" title="http://A.name">A.name</a>) and not the source (A) ?</p>



<a name="160323066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators/near/160323066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.html#160323066">(Mar 08 2019 at 20:33)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="196537">@Georg Fette</span>.  I'm not entirely sure I understand your question, but in regard to your example:</p>
<div class="codehilite"><pre><span></span>[Patient] A where Count(A.name.given) &gt; 1 return A
</pre></div>


<p>I agree that due to the path-traversal approach that was added for fhirpath, this could be "all patients with more than one name that has at least one given name, or all patient with at least one name having more than one given name."</p>
<p>If you want to be more specific, I think you'll need to do so via more complex queries.  For example:</p>
<div class="codehilite"><pre><span></span>// all patients with more than one name that has at least one given name
[Patient] A where Count((A.name) N where Count(N.given) &gt; 0) &gt; 1
</pre></div>


<p>and</p>
<div class="codehilite"><pre><span></span>// all patients with at least one name having more than one given name
[Patient] A where exists((A.name) N where Count(N.given) &gt; 1)
</pre></div>


<p>I didn't compile and test the CQL above, but I think it portrays the point.  Does that help?  Or did I miss the intent of the question?</p>



<a name="160323619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators/near/160323619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.html#160323619">(Mar 08 2019 at 20:40)</a>:</h4>
<p>ah, those two alternatives would solve the ambiguity. Thank you.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
