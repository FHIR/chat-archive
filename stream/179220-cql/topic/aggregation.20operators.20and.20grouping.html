---
layout: page
title: "FHIR Chat  · aggregation operators and grouping · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.20and.20grouping.html">aggregation operators and grouping</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="181630774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators%20and%20grouping/near/181630774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.20and.20grouping.html#181630774">(Nov 22 2019 at 11:53)</a>:</h4>
<p>Hello I am comparing the properties of CQL and Neo4J's query language Cypher and have a question related to CQL's aggregation operators:<br>
An aggregation operator has to be given a "scope" or a "grouping key" on which the operator performs the aggregation. In Cypher the scope is defined by all identifiers mentioned before the aggregation operator. Thus, "MATCH (A:Person) RETURN count(A.gender)" returns the amount of Person-instances with a given gender property, whereas "MATCH (A:Person) RETURN A, count(A.gender)" returns all Person-instances and in a second colunn the amount of gender properties that each Person-instance contains. Is such a aggregation grouping definition as well specified in CQL ? What should "[Person] A return Count(A.given)" and "[Person] A return A, Count(A.given)" return ?</p>



<a name="181636486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators%20and%20grouping/near/181636486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.20and.20grouping.html#181636486">(Nov 22 2019 at 13:21)</a>:</h4>
<p>The first expression <code>[Person] A return Count(A.given)</code> would return a List of <code>Integer</code>s, with each item in the returned List corresponding to each person's number of reported given names.</p>
<p>I don't think the second expression is valid as-is.  A return statement has to return a single item -- so you'd need to return it either as a Tuple or a List.  Here is what it might look like as a Tuple:</p>
<div class="codehilite"><pre><span></span>[Person] A return { person: A, givenCount: Count(A.given) }
</pre></div>


<p>The above would return a List of <code>Tuple { person Person, givenCount Integer }</code> with each Tuple corresponding to an input Patient.</p>



<a name="181636721"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators%20and%20grouping/near/181636721" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.20and.20grouping.html#181636721">(Nov 22 2019 at 13:24)</a>:</h4>
<p>Note, however, that if we're talking about <code>FHIR</code>, then <code>A.given</code> isn't valid at all since <code>given</code> is actually on <code>Patient.name</code> (which is an array itself).  So if you want a working FHIR example, those queries would have to change a bit.</p>



<a name="181683886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators%20and%20grouping/near/181683886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.20and.20grouping.html#181683886">(Nov 22 2019 at 22:35)</a>:</h4>
<p>Oh, yeah, your right. I should have written "A.gender" instead of "A.given".<br>
But why is "[Person] A return Count(A.given)" returning a list of numbers ? This assumes that the grouping is performed on each Person.<br>
What does "[Person] A return Count(A)" return ? A list of ones ?<br>
Is there a section in the documentation that states how to group within the aggregate operators ?</p>



<a name="181684381"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators%20and%20grouping/near/181684381" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.20and.20grouping.html#181684381">(Nov 22 2019 at 22:42)</a>:</h4>
<p>ah, chapter 5.3. Query Evaluation gives me the explanation, okay.</p>



<a name="181685765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators%20and%20grouping/near/181685765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.20and.20grouping.html#181685765">(Nov 22 2019 at 23:03)</a>:</h4>
<p>so for getting the amount of Persons the count operator has to be wrapped around the retrieve to do the trick ("Count([Person])") ?</p>



<a name="181686409"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/aggregation%20operators%20and%20grouping/near/181686409" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/aggregation.20operators.20and.20grouping.html#181686409">(Nov 22 2019 at 23:15)</a>:</h4>
<p>Yes, that's correct, the aggregate operators in CQL take a list of values; CQL doesn't have a group by shorthand like SQL does, the aggregates are "primitive".</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
