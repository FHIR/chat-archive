---
layout: page
title: "FHIR Chat  · Testing CQL · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html">Testing CQL</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="180636458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/180636458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tien Thai <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#180636458">(Nov 13 2019 at 15:20)</a>:</h4>
<p>My CQL file was successfully compiled by the Measure Authoring Tool (MAT) but the MAT produced a "System error.  Unable to process information" error when packaging the eCQM.  I have also checked this CQL file with the CQL-To_ELM translator and the translation completed successfully.   As a result of this error,  I will not be able to test my eCQM using the Bonnie tool.  Is there any other tool that I can use to test my eCQM?  Thank you very much.</p>



<a name="180636935"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/180636935" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#180636935">(Nov 13 2019 at 15:24)</a>:</h4>
<p>Assuming that your eCQM is using the QDM data model (and not FHIR), I'm not aware of any other tools specifically for testing QDM-based eCQMs (especially if you want them also to consider the HQMF).  I think <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> has a Java CQL engine that supports the QDM data model, but I suspect it would take some work to get it to support eCQM testing in a user-friendly way.</p>
<p>I'd suggest reaching out to the MAT/Bonnie team for help.  I think it's actually the same team behind both tools now, so hopefully they can help you!</p>



<a name="180637498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/180637498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tien Thai <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#180637498">(Nov 13 2019 at 15:30)</a>:</h4>
<p>Thanks very much, Chris.</p>



<a name="181232032"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181232032" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Afaq Khan <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181232032">(Nov 20 2019 at 17:54)</a>:</h4>
<p>We can use flatten to have duplicates added to a list but is there a way except doesnt remove all occurrences of an object in the first list?</p>



<a name="181236765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181236765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181236765">(Nov 20 2019 at 18:51)</a>:</h4>
<p>I'm not sure I understand your question, <span class="user-mention" data-user-id="245475">@Mohammad Afaq Khan</span>.  Are you saying that <code>List{1, 2, 2, 3, 4} except {2, 3}</code> currently returns <code>List{1, 4}</code> but you want it to return <code>List{1, 2, 4}</code> (removing only the <em>first</em> <code>2</code>)?</p>



<a name="181236809"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181236809" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Afaq Khan <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181236809">(Nov 20 2019 at 18:51)</a>:</h4>
<p>Yes, that is my desired outcome</p>



<a name="181236894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181236894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Afaq Khan <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181236894">(Nov 20 2019 at 18:52)</a>:</h4>
<p>It's very hard to do because we cant loop and set counters up when we define something as an integer we cant update its value</p>



<a name="181237433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181237433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Afaq Khan <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181237433">(Nov 20 2019 at 18:59)</a>:</h4>
<p>I want to remove the number of occurrences of "2" present in the second list from the first list so if the second list had 2 instances of "2" the returned list after the except should have no "2"s in it</p>



<a name="181238608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181238608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181238608">(Nov 20 2019 at 19:11)</a>:</h4>
<p>You're right.  That's a tough one!  Although it may be possible, no simple solutions come to mind...  I'll think about it some more though.</p>



<a name="181238990"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181238990" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Afaq Khan <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181238990">(Nov 20 2019 at 19:15)</a>:</h4>
<p>Ok thanks <span class="user-mention" data-user-id="191469">@Chris Moesel</span>  appreciate the help</p>



<a name="181246622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181246622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Afaq Khan <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181246622">(Nov 20 2019 at 20:35)</a>:</h4>
<p>Btw IndexOf only returns the first instance of the second argument</p>



<a name="181264729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181264729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181264729">(Nov 21 2019 at 00:26)</a>:</h4>
<p>I thought I had a nice solution, but then I remembered that CQL doesn't support recursion (when it wouldn't compile).  Anyway, in case it sparks any ideas for you:</p>
<div class="codehilite"><pre><span></span>library Test version &#39;1.0&#39;

context Patient

// NOTE: This does NOT compile because of recursive reference to strictExcept!
define function strictExcept(sourceList List&lt;Integer&gt;, exceptList List&lt;Integer&gt;):
  if Count(exceptList) &gt; 0 then
    strictExcept(removeFirstOccurrence(sourceList, First(exceptList)), Tail(exceptList))
  else
    sourceList

define function removeFirstOccurrence(list List&lt;Integer&gt;, item Integer):
  if item in list then
    flatten List{Take(list, IndexOf(list, item)), Skip(list, IndexOf(list, item) + 1)}
  else
    list

define strictExceptTest: strictExcept(List{1,2,2,2,3,4}, List{2,3})
</pre></div>



<a name="181264937"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181264937" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181264937">(Nov 21 2019 at 00:30)</a>:</h4>
<p>Whoops -- copied in the wrong one up there at first.  Now it's fixed.  Well, still <em>broken</em> -- but broken in the <em>expected</em> way.  Again, just hoping it might help spur some other ideas.</p>



<a name="181294710"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/181294710" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#181294710">(Nov 21 2019 at 11:12)</a>:</h4>
<p>Is it just that you want to compute the distinct before you do the except?</p>



<a name="182043717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/182043717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tien Thai <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#182043717">(Nov 27 2019 at 18:04)</a>:</h4>
<p>in QDM, is it safe to assume that each medication order must have a relevant period (i.e. start date and end date)?  By that I mean the values for both medication's start date and end date are always available?   If one of them is missing, lets say if the end date is NULL, is it possible to assign todays' date to this end date?  Thanks.</p>



<a name="182491292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/182491292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#182491292">(Dec 03 2019 at 20:24)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="249396">@Tien Thai</span> , no, in QDM, whether the start and end date are present for a given interval is determined by the underlying data. If end date is null for an inclusive interval, then that indicates that the interval continues to the "end of time".</p>



<a name="182491346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Testing%20CQL/near/182491346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Testing.20CQL.html#182491346">(Dec 03 2019 at 20:24)</a>:</h4>
<p>Assigning today's date for missing dates in source data is typically not advised, since it is making assumptions about what the underlying system means.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
