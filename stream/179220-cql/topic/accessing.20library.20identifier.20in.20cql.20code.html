---
layout: page
title: "FHIR Chat  · accessing library identifier in cql code · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html">accessing library identifier in cql code</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="243387618"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/243387618" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vasyl Herman <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#243387618">(Jun 21 2021 at 14:10)</a>:</h4>
<p>Hello, Folks! </p>
<p>Is there a way to access <code>library.identirier.id</code> in <code>cql</code> code.<br>
<a href="/user_uploads/10155/iqZKSOGADIUHWB2_u_JfkYel/image.png">image.png</a><br>
I'd like to define "Measure name", meaning whatever I set after <code>library</code> it would reflect in "Measure name" definition:</p>
<div class="message_inline_image"><a href="/user_uploads/10155/iqZKSOGADIUHWB2_u_JfkYel/image.png" title="image.png"><img src="/user_uploads/10155/iqZKSOGADIUHWB2_u_JfkYel/image.png"></a></div><div class="codehilite" data-code-language="Bash"><pre><span></span><code>library TEST_Logic version <span class="s1">'0.0.0'</span>
using FHIR version <span class="s1">'4.0.1'</span>

context Patient

define <span class="s2">"Measure name"</span>:
    identifier.id // TEST_Logic
</code></pre></div>
<p>Thanks!</p>



<a name="243426464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/243426464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#243426464">(Jun 21 2021 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="376706">@Vasyl Herman</span> -- that's definitely an interesting idea, but AFAIK CQL does not insert any implicit definitions to reference that information.  Contexts sometime insert an implicit definition (e.g. the <code>Patient</code> context inserts a <code>Patient</code> definition) -- but I don't think there is any mechanism that exposes library metadata like the identifier or version for use in the CQL logic itself. <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> -- correct if I'm wrong (i.e., if you snuck something like this in there without me noticing <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span> )</p>



<a name="243435089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/243435089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Corey Sanders <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#243435089">(Jun 21 2021 at 20:01)</a>:</h4>
<p>I'm fairly certain this doesn't exist in the Java engine. In the case where you have libraries referencing other libraries, it isn't completely clear to me what you would even want it to return. If you know that you always want a constant value, though, you could simulate the behavior by defining an input parameter that is echoed back out in a define. </p>
<div class="codehilite"><pre><span></span><code>library TEST_Logic version &#39;0.0.0&#39;
using FHIR version &#39;4.0.1&#39;

parameter LibName default &#39;Unknown&#39;

context Patient

define &quot;Measure name&quot;:
    &quot;LibName&quot;
</code></pre></div>



<a name="243534244"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/243534244" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#243534244">(Jun 22 2021 at 15:30)</a>:</h4>
<p>No, there's nothing like this in the spec now. Feel free to submit a tracker if it's a feature that's really needed, but Corey's solution sounds like a better approach to me.</p>



<a name="243556470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/243556470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Riley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#243556470">(Jun 22 2021 at 18:08)</a>:</h4>
<p>Plus one on this feature from me as well, since oftentimes a client user doesn't have the fhir patient id, they have an identifier that.... identifies the patient such as an MRN or an SSN. Would help with interoperability to client systems.</p>



<a name="243559317"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/243559317" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#243559317">(Jun 22 2021 at 18:28)</a>:</h4>
<p>The CQL library identifiers (as in Vasyl's example) which exist in CQL/ELM are actually a different thing than Patient identifiers which exist in FHIR despite having the same name. You do have access to Patient identifiers. Something like this would do it:</p>
<div class="codehilite" data-code-language="cql"><pre><span></span><code>library Test version '1.0.0'

using FHIR version '4.0.1'
include FHIRHelpers version '4.0.1'

context Patient

define "Identifier":
  Patient.identifier I
    return Tuple { assigner : I.assigner.display, value : I.value}
</code></pre></div>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
  <span class="nt">"resourceType"</span><span class="p">:</span> <span class="s2">"Patient"</span><span class="p">,</span>
  <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"test"</span><span class="p">,</span>
  <span class="nt">"identifier"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"use"</span><span class="p">:</span> <span class="s2">"usual"</span><span class="p">,</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"coding"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"http://terminology.hl7.org/CodeSystem/v2-0203"</span><span class="p">,</span>
            <span class="nt">"code"</span><span class="p">:</span> <span class="s2">"MR"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"urn:oid:1.2.36.146.595.217.0.1"</span><span class="p">,</span>
      <span class="nt">"value"</span><span class="p">:</span> <span class="s2">"12345"</span><span class="p">,</span>
      <span class="nt">"period"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"start"</span><span class="p">:</span> <span class="s2">"2001-05-06"</span>
      <span class="p">},</span>
      <span class="nt">"assigner"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"display"</span><span class="p">:</span> <span class="s2">"Acme Healthcare"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"active"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">"name"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"use"</span><span class="p">:</span> <span class="s2">"official"</span><span class="p">,</span>
      <span class="nt">"family"</span><span class="p">:</span> <span class="s2">"Chalmers"</span><span class="p">,</span>
      <span class="nt">"given"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"Peter"</span><span class="p">,</span>
        <span class="s2">"James"</span>
      <span class="p">]</span>
    <span class="p">}],</span>
  <span class="nt">"gender"</span><span class="p">:</span> <span class="s2">"male"</span><span class="p">,</span>
  <span class="nt">"birthDate"</span><span class="p">:</span> <span class="s2">"1974-12-25"</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nv">Patient</span><span class="o">=</span>Patient<span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="nb">test</span><span class="o">)</span>
<span class="nv">Identifier</span><span class="o">=[</span>Tuple <span class="o">{</span>
    <span class="s2">"assigner"</span>: Acme Healthcare
    <span class="s2">"value"</span>: <span class="m">12345</span>
<span class="o">}]</span>
</code></pre></div>



<a name="244134184"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244134184" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vasyl Herman <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244134184">(Jun 28 2021 at 12:06)</a>:</h4>
<p>Thank all of you guys!<br>
Could I ask? Is it correct way to retrieve a Patient's Social Security Number:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>define <span class="s2">"SSN"</span>:
<span class="o">(</span>singleton from <span class="o">(</span>
    Patient.identifier identifier
     where identifier.system.value <span class="o">=</span> <span class="s1">'http://hl7.org/fhir/sid/us-ssn'</span><span class="o">))</span>.value.value
</code></pre></div>
<p>Or is there more elegant way?</p>



<a name="244139141"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244139141" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vasyl Herman <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244139141">(Jun 28 2021 at 12:50)</a>:</h4>
<p>I was able to shape my query with <code>return</code> but I am not sure I am doing right:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>define <span class="s2">"SSN"</span>:
<span class="o">(</span>singleton from <span class="o">(</span>
  Patient.identifier identifier
    where identifier.type.coding <span class="k">in</span> Code <span class="o">{</span>code: <span class="s1">'SS'</span>, system: <span class="s1">'http://terminology.hl7.org/CodeSystem/v2-0203'</span>, display: <span class="s1">'Social Security Number'</span><span class="o">}</span>
        <span class="o">))</span> I
     <span class="k">return</span> I.value.value
</code></pre></div>



<a name="244179646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244179646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244179646">(Jun 28 2021 at 17:36)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="376706">@Vasyl Herman</span> , best practice would be to define a codesystem and code for referencing the <code>SS</code> code from the v2-0203 code system. I also wonder whether using the <code>system</code> of the identifier and specifying that it be <code>http://hl7.org/fhir/sid/us-ssn</code> would work? That's more a content question though.</p>



<a name="244179933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244179933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244179933">(Jun 28 2021 at 17:38)</a>:</h4>
<p>For accessing the identifier, that's correct syntax, but you could use FHIRHelpers to avoid the .value accessors:</p>
<div class="codehilite"><pre><span></span><code>define &quot;SSN&quot;:
  (singleton from (
    Patient.identifier I
      where I.system = &#39;http://hl7.org/fhir/sid/us-ssn&#39;
  )).value
</code></pre></div>



<a name="244182283"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244182283" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vasyl Herman <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244182283">(Jun 28 2021 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>, the sample above gives me an Object like that:<br>
<a href="/user_uploads/10155/xvq-bP2UmItHMwYiC41Fmcsp/Screenshot-2021-06-28-at-20.54.51.png">Screenshot-2021-06-28-at-20.54.51.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/xvq-bP2UmItHMwYiC41Fmcsp/Screenshot-2021-06-28-at-20.54.51.png" title="Screenshot-2021-06-28-at-20.54.51.png"><img src="/user_uploads/10155/xvq-bP2UmItHMwYiC41Fmcsp/Screenshot-2021-06-28-at-20.54.51.png"></a></div>



<a name="244184152"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244184152" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vasyl Herman <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244184152">(Jun 28 2021 at 18:11)</a>:</h4>
<p>I tried to defide a codesystem and code for referensing the <code>SS</code> like so:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>codesystem <span class="s2">"IdentifierType"</span>: <span class="s1">'http://terminology.hl7.org/CodeSystem/v2-0203'</span>
code <span class="s2">"Social Security Number"</span>: <span class="s1">'SS'</span> from <span class="s2">"IdentifierType"</span> display <span class="s1">'Social Security Number'</span>
context Patient

define <span class="s2">"SSN"</span>:
  <span class="o">(</span>singleton from <span class="o">(</span>
    Patient.identifier identifier
      where identifier.type.coding <span class="k">in</span> <span class="s2">"Social Security Number"</span>
      <span class="o">))</span>.value.value
</code></pre></div>
<p>But there is a downside, it is working unless you have all three keys matching in a <code>code</code> Object of Patient.identifier.type.coding[]:  <code>system</code>, <code>code</code> and <code>display</code>. If you remove the <code>display</code> either from the code definition or a Patient's bundle it returns <code>null</code></p>



<a name="244184693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244184693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vasyl Herman <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244184693">(Jun 28 2021 at 18:15)</a>:</h4>
<p>I also wonder why nither <br>
<code>where identifier in "Social Security Number"</code> <br>
nor  <br>
<code>where identifier type in "Social Security Number"</code> <br>
doesn't work for an identifier as it does for a regular FHIR resource say <code>Enconter</code>?</p>



<a name="244186766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244186766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244186766">(Jun 28 2021 at 18:31)</a>:</h4>
<p>When performing terminology comparisons, use the equivalent operator (<code>~</code>), which only compares the <code>code</code> and <code>system</code> elements (whereas <code>=</code> compares all attributes, including <code>display</code>).</p>



<a name="244187013"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244187013" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244187013">(Jun 28 2021 at 18:33)</a>:</h4>
<p>As far as <code>where identifier in "Social Security Number"</code>, that feels like a different operation and if we overloaded <code>in</code> to support that it may lead to confusion, what you're saying there is more something like identifier _is_ a Social Security Number, where in that context "is" means "has a system of Social Security Number".</p>



<a name="244187117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/accessing%20library%20identifier%20in%20cql%20code/near/244187117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/accessing.20library.20identifier.20in.20cql.20code.html#244187117">(Jun 28 2021 at 18:34)</a>:</h4>
<p>For the <code>type in "Social Security Number"</code> case, if you defined "Social Security Number" as a ValueSet with any known codes for describing Social Security Number, that would work.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
