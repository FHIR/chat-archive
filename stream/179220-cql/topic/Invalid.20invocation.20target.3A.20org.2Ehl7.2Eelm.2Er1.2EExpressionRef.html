---
layout: page
title: "FHIR Chat  · Invalid invocation target: org.hl7.elm.r1.ExpressionRef · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Invalid.20invocation.20target.3A.20org.2Ehl7.2Eelm.2Er1.2EExpressionRef.html">Invalid invocation target: org.hl7.elm.r1.ExpressionRef</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="270579835"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Invalid%20invocation%20target%3A%20org.hl7.elm.r1.ExpressionRef/near/270579835" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Stevens <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Invalid.20invocation.20target.3A.20org.2Ehl7.2Eelm.2Er1.2EExpressionRef.html#270579835">(Feb 03 2022 at 16:49)</a>:</h4>
<p>So I'm trying to use the $cql operation on CQF ruler to validate some CQL before persisting it, but when I POST, it returns 3 errors saying <br>
<code>Invalid invocation target: org.hl7.elm.r1.ExpressionRef</code>. Looking at the locations in the CQL, it looks like it's referring to defines where i've used fluent functions. This is my library I'm testing my validation stuff with:</p>
<div class="codehilite"><pre><span></span><code>library demographics version &#39;1.0&#39;

using FHIR version &#39;4.0.0&#39;

context Patient

define &quot;first_name&quot;: Patient.name[0].given[0]
define &quot;last_name&quot;: Patient.name[0].family
define &quot;date_of_birth&quot;: Patient.birthDate
define &quot;age&quot;: AgeInYears()
define &quot;gender&quot;: Patient.gender
define &quot;race&quot;: Patient.valueOmbCategoryRace()
define &quot;ethnicity&quot;: Patient.valueOmbCategoryEthnicity()
define &quot;birthsex&quot;: Patient.valueUSCoreBirthSex()
define &quot;zip&quot;: Patient.address.postalCode[0]
define &quot;state&quot;: Patient.address.state[0]

// Helper Functions from FHIRCommon
define function Extensions(domainResource DomainResource, url String):
  domainResource.extension E
      where E.url = url
        return E
define function Extensions(element Element, url String):
  element.extension E
      where E.url = url
        return E
define function Extension(domainResource DomainResource, url String):
  singleton from &quot;Extensions&quot;(domainResource, url)
define function Extension(element Element, url String):
  singleton from Extensions(element, url)

define fluent function valueOmbCategoryRace(patient Patient):
  Extension(Extension(patient, &#39;http://hl7.org/fhir/us/core/StructureDefinition/us-core-race&#39;), &#39;ombCategory&#39;).value
define fluent function valueOmbCategoryEthnicity(patient Patient):
  Extension(Extension(patient, &#39;http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity&#39;), &#39;ombCategory&#39;).value
define fluent function valueUSCoreBirthSex(patient Patient):
  Extension(patient, &#39;http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex&#39;).value
</code></pre></div>
<p>However, this library is already stored in CQF Ruler and runs perfectly fine when using the $evaluate operation. Is this error in relation to how the two operations operate? or is there something else wrong I'm not seeing?</p>



<a name="270729042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Invalid%20invocation%20target%3A%20org.hl7.elm.r1.ExpressionRef/near/270729042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Invalid.20invocation.20target.3A.20org.2Ehl7.2Eelm.2Er1.2EExpressionRef.html#270729042">(Feb 04 2022 at 15:22)</a>:</h4>
<p><span class="user-mention" data-user-id="421123">@Andy Stevens</span> , trying this in my local IDE, with the library addition above, I get errors in the comparison of the <code>url</code> attribute in the <code>Extensions</code> function definitions that I need to include FHIRHelpers. Once I include that it compiles. Is that include declaration missing here?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
