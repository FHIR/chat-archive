---
layout: page
title: "FHIR Chat  · Hooking up CQL engine to FHIR server · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html">Hooking up CQL engine to FHIR server</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="248302593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248302593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ravi.kuchi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248302593">(Aug 04 2021 at 01:44)</a>:</h4>
<p>Hi, I am looking to hook-up CQL engine to my FHIR server so I can execute CQL against the data present in my FHIR server. My server is SmileCDR (Licensed version of Hapi) and the FHIR version is 3.0.2. I checked both cqf-ruler and cql_execution_service projects. On the cqf-ruler project I see that it works on the data that is posted on the hapi version of the server but I want it to work with the data present on my server . On the cql_execution_service project, I am getting lot of errors mainly I think because it is outdated and there seems to be some work needed to make it usable. So, I am looking for guidance as to which implementation I would refer and begin with so I could serve my purpose.<br>
Just to be clear on the ask, I am looking to execute the 'evaluate' operation</p>



<a name="248323128"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248323128" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248323128">(Aug 04 2021 at 08:31)</a>:</h4>
<p>I can't help you with a hook-up version of a CQL engine but HAPI itself recently integrated the cqf execution engine to enable the $evaluate operation. <a href="https://hapifhir.io/hapi-fhir/docs/server_jpa_cql/cql.html">https://hapifhir.io/hapi-fhir/docs/server_jpa_cql/cql.html</a></p>
<p>Maybe you can license this extension for SmileCDR.</p>
<p>I'm the main developer of <a href="https://github.com/samply/blaze">Blaze</a>, I FHIR Server that also has an internal CQL engine. If evaluation performance is important to you, my first tests between HAPI and Blaze show that Blaze is about 1000x faster.</p>



<a name="248344166"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248344166" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ravi.kuchi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248344166">(Aug 04 2021 at 12:42)</a>:</h4>
<p>Thanks for the input <span class="user-mention" data-user-id="197470">@Alexander Kiel</span> , I am aware that Smile also has support to $evaluate-measure but I am looking at $evaluate so I can execute the CQL statements captured in a Library.</p>



<a name="248349482"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248349482" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248349482">(Aug 04 2021 at 13:28)</a>:</h4>
<p>This website allows you to run arbitrary CQL against an arbitrary FHIR server: <a href="https://cql-runner.dataphoria.org/">https://cql-runner.dataphoria.org/</a></p>



<a name="248349508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248349508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248349508">(Aug 04 2021 at 13:28)</a>:</h4>
<p>Code for it is here: <a href="https://github.com/DBCG/cql_runner">https://github.com/DBCG/cql_runner</a></p>



<a name="248349587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248349587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248349587">(Aug 04 2021 at 13:29)</a>:</h4>
<p>Basically, it's using the $cql operation of a CQF Ruler, but that in turn is just using a specific configuration of the evaluator.</p>



<a name="248354558"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248354558" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ravi.kuchi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248354558">(Aug 04 2021 at 14:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> , I tried that tool as well,I changed the datasource to another server (<a href="http://test.fhir.org/r4">http://test.fhir.org/r4</a>) but it does not seem to pick the data from the new server, I saw the parameters it was sending in the developer tools and it does not reflect the server that I have changed to:<br>
{<br>
  "resourceType": "Parameters",<br>
  "parameter": [<br>
    {<br>
      "name": "code",<br>
      "valueString": "library TestArtifact version '1'\n\nusing FHIR version '4.0.0'\n\ninclude \"FHIRHelpers\" version '4.0.0' called FHIRHelpers\n\ncodesystem \"SNOMED\": '<a href="http://snomed.info/sct'\ncodesystem">http://snomed.info/sct'\ncodesystem</a> \"CONDCLINSTATUS\": '<a href="http://terminology.hl7.org/CodeSystem/condition-clinical'\ncodesystem">http://terminology.hl7.org/CodeSystem/condition-clinical'\ncodesystem</a> \"CONDVERSTATUS\": '<a href="http://terminology.hl7.org/CodeSystem/condition-ver-status'\n\ncode">http://terminology.hl7.org/CodeSystem/condition-ver-status'\n\ncode</a> \"Essential hypertension (disorder) code\": '59621000' from \"SNOMED\" display 'Essential hypertension (disorder)'\ncode \"Malignant hypertensive chronic kidney disease (disorder) code\": '285831000119108' from \"SNOMED\" display 'Malignant hypertensive chronic kidney disease (disorder)'\ncode \"Condition Active code\": 'active' from \"CONDCLINSTATUS\" display 'Active'\ncode \"Condition Confirmed code\": 'confirmed' from \"CONDVERSTATUS\" display 'Confirmed'\n\nconcept \"Condition Active\": { \"Condition Active code\" } display 'Active'\nconcept \"Condition Confirmed\": { \"Condition Confirmed code\" } display 'Confirmed'\n\ncontext Patient\n\ndefine \"AgeRange-548\":\n  AgeInYears() &gt;= 60 and AgeInYears() &lt;= 85\n\ndefine \"Essential hypertension (disorder)\":\n  exists(ActiveCondition([Condition: \"Essential hypertension (disorder) code\"]))\n\ndefine \"Malignant hypertensive chronic kidney disease (disorder)\":\n  exists(Confirmed([Condition: \"Malignant hypertensive chronic kidney disease (disorder) code\"]))\n\ndefine \"MeetsInclusionCriteria\":\n  \"AgeRange-548\"\n  and \"Essential hypertension (disorder)\"\n\ndefine \"MeetsExclusionCriteria\":\n  \"Malignant hypertensive chronic kidney disease (disorder)\"\n\ndefine \"InPopulation\":\n  \"MeetsInclusionCriteria\" and not \"MeetsExclusionCriteria\"\n\ndefine \"Recommendation\":\n  if \"InPopulation\" then ''\n  else null\n\n\ndefine \"Rationale\":\n  if \"InPopulation\" then null\n  else null\n\ndefine \"Errors\":\n  null\n\n\ndefine function Confirmed(CondList List&lt;Condition&gt;):\n  CondList C where C.verificationStatus ~ \"Condition Confirmed code\"\n\ndefine function ActiveCondition(CondList List&lt;Condition&gt;):\n  CondList C\n    where C.clinicalStatus ~ \"Condition Active code\"\n      and C.abatement is null\n"<br>
    },<br>
    {<br>
      "name": "patientId",<br>
      "valueString": "P48"<br>
    },<br>
    null,<br>
    {<br>
      "name": "context",<br>
      "valueString": "Patient"<br>
    },<br>
    {<br>
      "name": "terminologyServiceUri",<br>
      "valueString": "<a href="https://cql-sandbox.alphora.com/cqf-ruler-r4/fhir">https://cql-sandbox.alphora.com/cqf-ruler-r4/fhir</a>"<br>
    },<br>
    {<br>
      "name": "terminologyUser"<br>
    },<br>
    {<br>
      "name": "terminologyPass"<br>
    }<br>
  ]<br>
}</p>



<a name="248355491"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248355491" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ravi.kuchi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248355491">(Aug 04 2021 at 14:15)</a>:</h4>
<p>Here is the service definition in cqf-ruler, it does not have parameters to change dataSource, so may be that is the limitation<br>
@SuppressWarnings("unchecked")<br>
    @Operation(name = "$cql")<br>
    public Bundle evaluate(@OperationParam(name = "code") String code,<br>
            @OperationParam(name = "patientId") String patientId,<br>
            @OperationParam(name = "periodStart") String periodStart,<br>
            @OperationParam(name = "periodEnd") String periodEnd,<br>
            @OperationParam(name = "productLine") String productLine,<br>
            @OperationParam(name = "terminologyServiceUri") String terminologyServiceUri,<br>
            @OperationParam(name = "terminologyUser") String terminologyUser,<br>
            @OperationParam(name = "terminologyPass") String terminologyPass,<br>
            @OperationParam(name = "context") String contextParam,<br>
            @OperationParam(name = "executionResults") String executionResults,<br>
            @OperationParam(name = "parameters") Parameters parameters) {</p>



<a name="248355722"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248355722" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ravi.kuchi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248355722">(Aug 04 2021 at 14:17)</a>:</h4>
<p>It would be great if this operation could accept a dataSource so we can plug in any FHIR server and run CQL against the data</p>



<a name="248370743"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248370743" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248370743">(Aug 04 2021 at 16:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="192784">ravi.kuchi</span> <a href="#narrow/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server/near/248344166">said</a>:</p>
<blockquote>
<p>Thanks for the input <span class="user-mention silent" data-user-id="197470">Alexander Kiel</span> , I am aware that Smile also has support to $evaluate-measure but I am looking at $evaluate so I can execute the CQL statements captured in a Library.</p>
</blockquote>
<p>Do you mean <a href="http://hl7.org/fhir/2018jan/operation-servicedefinition-evaluate.html">http://hl7.org/fhir/2018jan/operation-servicedefinition-evaluate.html</a>? I know, you are on STU3 but it seems that ServiceDefinition is no longer part of R4. Sorry that I can't help.</p>



<a name="248384756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248384756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ravi.kuchi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248384756">(Aug 04 2021 at 17:57)</a>:</h4>
<p>There are two operations $cql and $evaluate that are used in cqf-ruler that allows you to execute CQL statements in a Library against a FHIR server and they provide outcome for each of the statements. I find this feature powerful and useful especially in Decision Supporting Systems where we have rules for Prior Authorization</p>



<a name="248387497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248387497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248387497">(Aug 04 2021 at 18:18)</a>:</h4>
<p>Ok. How is this different from $evaluate-measure? Do you have a Measure in play with $evaluate or $cql? What are the possible result formats? In $evaluate-measure it's only a MeasureReport with various poluation and stratifier counts.</p>



<a name="248387858"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248387858" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ravi.kuchi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248387858">(Aug 04 2021 at 18:21)</a>:</h4>
<p>Checkout examples at <a href="https://cql-runner.dataphoria.org/">https://cql-runner.dataphoria.org/</a> <br>
you can run arbitrary cql</p>



<a name="248388130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248388130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248388130">(Aug 04 2021 at 18:23)</a>:</h4>
<p>Ok I know already about it. But this is not a standarized API in FHIR. In your use case we liked to build cohorts (populations) to $evaluate-measure was a good fit for us. But yes, you can do many many more things with CQL.</p>



<a name="248412875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248412875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dave Carlson <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248412875">(Aug 04 2021 at 21:43)</a>:</h4>
<p>Library $evaluate operation is defined in the published CPG IG:  <a href="https://build.fhir.org/ig/HL7/cqf-recommendations/OperationDefinition-cpg-library-evaluate.html">https://build.fhir.org/ig/HL7/cqf-recommendations/OperationDefinition-cpg-library-evaluate.html</a></p>



<a name="248446357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248446357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248446357">(Aug 05 2021 at 07:31)</a>:</h4>
<p><span class="user-mention" data-user-id="191395">@Dave Carlson</span> Thanks. This looks good.</p>



<a name="248497900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248497900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248497900">(Aug 05 2021 at 16:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197470">Alexander Kiel</span> <a href="#narrow/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server/near/248323128">said</a>:</p>
<blockquote>
<p>I'm the main developer of <a href="https://github.com/samply/blaze">Blaze</a>, I FHIR Server that also has an internal CQL engine. If evaluation performance is important to you, my first tests between HAPI and Blaze show that Blaze is about 1000x faster.</p>
</blockquote>
<p>Blaze looks very good specially with Quality Reporting UI, I tried the basic CQL example of COVID patients and it worked flawlessly. </p>
<p><span class="user-mention" data-user-id="197470">@Alexander Kiel</span>  as Blaze is standalone and cannot be embedded in HAPI, I would like to understand how to accomplish  the data sync between HAPI server and Blaze CQL engine. This sync is needed for a more real time reporting and analytics. Any pointers are much appreciated.</p>
<p>On a different note, does Blaze support GraphQL  ? If so, what GraphQL capabilities does it have? Is it even possible to do population health queries (i.e. count of COVID-19 patients) using GraphQL in Blaze ?</p>



<a name="248526519"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248526519" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248526519">(Aug 05 2021 at 19:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191783">@dsh</span> I'm glad you like the Blaze so far.</p>
<blockquote>
<p>I would like to understand how to accomplish the data sync between HAPI server and Blaze CQL engine.</p>
</blockquote>
<p>You can use subscriptions to sync the resources from HAPI to Blaze. I have started a documentation <a href="https://github.com/samply/blaze/blob/master/docs/data-sync.md">here</a>. I would be interested if that works for you. Especially regarding the referential integrity.</p>
<blockquote>
<p>On a different note, does Blaze support GraphQL ?</p>
</blockquote>
<p>Unfortunately no. But feel free to open an issue with your use-case.</p>
<blockquote>
<p>Is it even possible to do population health queries (i.e. count of COVID-19 patients) using GraphQL in Blaze ?</p>
</blockquote>
<p>IMHO, <a href="http://www.hl7.org/fhir/clinicalreasoning-quality-reporting.html">quality reporting</a> using CQL is a perfect fir for doing population health queries. Blaze is used as backend for the <a href="https://samplelocator.bbmri.de/search">Sample Locator</a> were you can do exactly that.</p>



<a name="248534458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248534458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248534458">(Aug 05 2021 at 20:50)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="197470">@Alexander Kiel</span>  This looks super interesting! I'm just now playing around with Blaze but I'm seeing 'Referential integrity violated' errors on a relatively simple bundle (here: <a href="https://pastebin.com/ZAxmVEhM">https://pastebin.com/ZAxmVEhM</a>). This seems odd. Am I missing something on importing data that is different from HAPI? I've tried transaction bundles with PUTs as well. I've also tried the blazectl tool (nice use of Go btw) and it only loads one or two of the initial entries (Patient and Organization).</p>



<a name="248658206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248658206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248658206">(Aug 06 2021 at 19:34)</a>:</h4>
<p><span class="user-mention" data-user-id="194192">@Richard Stanley</span> I'm very happy that you liked Blaze so far. Referencing resources in batch bundles is problematic, because all requests in a batch should be without dependencies:</p>
<blockquote>
<p>For a batch, there SHALL be no interdependencies between the different entries in the Bundle that cause change on the server. The success or failure of one change SHOULD not alter the success or failure or resulting content of another change. -- <a href="https://www.hl7.org/fhir/http.html#brules">https://www.hl7.org/fhir/http.html#brules</a></p>
</blockquote>
<p>I would recommend to always use a transaction bundle for changes. However, if I change the bundle type to transaction, the Location <code>Location-HIVSimple</code> can't be created because the <code>managingOrganization</code> reference points to <code>Organization/Organization-HIVSimple</code> which will not be the identity of the Organization you also create in this bundle, because you use POST. At POST the server will generate the ID. However, if you use the fullUrl of the bundle entries as references, you can reference resources even if they will be assigned different IDs from the server. The bundle <a href="https://gist.github.com/alexanderkiel/c8bd1568efa39ebf187461623ed37e54">https://gist.github.com/alexanderkiel/c8bd1568efa39ebf187461623ed37e54</a> works with Blaze.</p>
<p>I tried the same with HAPI and your bundle as transaction bundle works correctly with HAPI but my version with the fullUrl references do not work. I will read the section on <a href="https://www.hl7.org/fhir/bundle.html#references">resolving references in bundles</a> tomorrow again. I had this before. I'm not sure if my interpretation of the spec is right. I would be happy if you could help me here.</p>



<a name="248658881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/248658881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#248658881">(Aug 06 2021 at 19:40)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="197470">@Alexander Kiel</span> this is super helpful. I would not be surprised that the issue comes down to me not being great at FHIR :) I'll have a go!</p>



<a name="249054486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249054486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249054486">(Aug 11 2021 at 00:10)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="197470">@Alexander Kiel</span> I'm troubleshooting an issue when issuing the $evaluate-measure operation to Blaze: </p>
<div class="codehilite"><pre><span></span><code>{&quot;issue&quot;:[{&quot;severity&quot;:&quot;error&quot;,&quot;code&quot;:&quot;value&quot;,&quot;diagnostics&quot;:&quot;Could not load source for library FHIRCommon, version 4.0.1...
</code></pre></div>
<p>I can confirm that the CQL source is in the Library, which is on the server. Have you seen this before in Blaze? I see other issues with Publisher building/referencing proper CQL in Library resources but I wanted to check if this could be a Blaze thing.</p>



<a name="249083212"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249083212" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249083212">(Aug 11 2021 at 08:54)</a>:</h4>
<p><span class="user-mention" data-user-id="194192">@Richard Stanley</span> Do you reference the FHIRCommon library from your library? Currently Blaze doesn't support library references except for some hard codes functions from FHIRHelpers.</p>



<a name="249125325"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249125325" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249125325">(Aug 11 2021 at 15:36)</a>:</h4>
<p>That's exactly right. I'm referencing another CQL/Library. Thanks for the clarification!</p>



<a name="249125480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249125480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249125480">(Aug 11 2021 at 15:38)</a>:</h4>
<p>Quick point of clarification. Is FHIR Helpers (and Model-Info) required to be put on the server or is it there already? I've been PUTting them but if its not necessary then I can relax that requirement.</p>



<a name="249220718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249220718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249220718">(Aug 12 2021 at 11:06)</a>:</h4>
<p>Yes, it's not required to upload model-info and FHIRHelpers. Unlike in HAPI were it is required. Overall, since Blaze itself only support R4 in the moment, the model is constraint to R4 too. If you need more functions in FHIRHelpers, I can implement them without problem.</p>



<a name="249273764"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249273764" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249273764">(Aug 12 2021 at 18:27)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="197470">@Alexander Kiel</span> I'm getting further. Curious if you have advice on this, I'm seeing an odd error, "error","code":"not-found", on a simple CQL file with $evaluate-measure.<br>
Edit: I'm being dumb, wasn't paying attention to url encoding. :)</p>



<a name="249275914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249275914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249275914">(Aug 12 2021 at 18:46)</a>:</h4>
<p>@Richard Ok that was a simple 404, or? If you have suggestions for better error messages, I‘ll implement them.</p>



<a name="249422955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249422955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249422955">(Aug 13 2021 at 22:47)</a>:</h4>
<p><span class="user-mention" data-user-id="197470">@Alexander Kiel</span> Is the 'subject' parameter supported on $evaluate-measure at this time? I see an error with it. </p>
<div class="codehilite"><pre><span></span><code>$ curl -sXPOST &#39;http://localhost:8080/fhir/Measure/BlazeStratifierTest/$evaluate-measure?periodStart=1970&amp;periodEnd=2030&amp;subject=C6Z4H2E5VIJ7BPCU&#39;
java.util.concurrent.CompletionException: java.lang.IllegalArgumentException: No matching clause: subject
    at java.base/java.util.concurrent.CompletableFuture.encodeThrowable(Unknown Source)
    at java.base/java.util.concurrent.CompletableFuture.completeThrowable(Unknown Source)
    at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(Unknown Source)
    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
    at java.base/java.lang.Thread.run(Unknown Source)
</code></pre></div>



<a name="249475875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249475875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249475875">(Aug 14 2021 at 20:18)</a>:</h4>
<p><span class="user-mention" data-user-id="194192">@Richard Stanley</span> No it's not supported. Can you please write an issue?</p>



<a name="249476161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Hooking%20up%20CQL%20engine%20to%20FHIR%20server/near/249476161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Hooking.20up.20CQL.20engine.20to.20FHIR.20server.html#249476161">(Aug 14 2021 at 20:27)</a>:</h4>
<p>Yep, will do! Thanks</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
