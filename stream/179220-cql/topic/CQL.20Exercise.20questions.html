---
layout: page
title: "FHIR Chat  · CQL Exercise questions · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html">CQL Exercise questions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="234396598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234396598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234396598">(Apr 13 2021 at 20:38)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> We have a few questions about the CQL Exercises: <a href="https://github.com/cqframework/cqf-exercises">https://github.com/cqframework/cqf-exercises</a></p>
<p>When would we use expand? Can you give an example? <br>
 Exercise 8, how does it create the tuples from 2 lists that seem like they would be the same? <br>
    ○ Would this not return 0s? <br>
Exercise 10: What does context do? Why is the context Patient? The context for Patient does not seem to matter for this group of Observations. Is this how the CQL kind of views the data e.g. from a Patient-centric perspective?</p>



<a name="234858533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234858533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Francis <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234858533">(Apr 16 2021 at 14:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  kind of struggling with the same questions from the exercise. Any help or guidance is appreciated please and thanks</p>



<a name="234873833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234873833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234873833">(Apr 16 2021 at 15:28)</a>:</h4>
<p>One of the most useful examples for expand (the use case it was introduced to support specifically) is as part of determining average daily dose. Part of that calculation involves calculating the days in an interval:</p>
<div class="codehilite"><pre><span></span><code>expand { Interval[@2010-01-01, @2010-01-31] } per day
</code></pre></div>
<p>This returns a list of intervals, one for each day in the input period, which we then use to aggregate the daily dose for medications with an active prescription on that day.</p>



<a name="234874611"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234874611" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234874611">(Apr 16 2021 at 15:33)</a>:</h4>
<p>In Exercise 8, looking at the result of just the multi-source query with no restrictions might help:</p>
<div class="codehilite"><pre><span></span><code>define &quot;Quantitative Laboratory Result Pairs&quot;:
  from
    &quot;Quantitative Laboratory Results&quot; O1,
    &quot;Quantitative Laboratory Results&quot; O2
</code></pre></div>



<a name="234874834"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234874834" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234874834">(Apr 16 2021 at 15:34)</a>:</h4>
<p>This returns all pairs of Quantitative Laboratory Results:</p>
<div class="codehilite"><pre><span></span><code>Quantitative Laboratory Result Pairs=[Tuple {
    &quot;O1&quot;: org.hl7.fhir.r4.model.Observation@e4871af7
    &quot;O2&quot;: org.hl7.fhir.r4.model.Observation@e4871af7
}, Tuple {
    &quot;O1&quot;: org.hl7.fhir.r4.model.Observation@e4871af7
    &quot;O2&quot;: org.hl7.fhir.r4.model.Observation@251765e9
}, Tuple {
    &quot;O1&quot;: org.hl7.fhir.r4.model.Observation@e4871af7
    &quot;O2&quot;: org.hl7.fhir.r4.model.Observation@de86d67e
}, Tuple {
    &quot;O1&quot;: org.hl7.fhir.r4.model.Observation@e4871af7
    &quot;O2&quot;: org.hl7.fhir.r4.model.Observation@66ce16b1
}, Tuple {
... &lt;snipped for brevity&gt;
</code></pre></div>



<a name="234875083"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234875083" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234875083">(Apr 16 2021 at 15:35)</a>:</h4>
<p>Perhaps a clearer example:</p>
<div class="codehilite"><pre><span></span><code>define &quot;Input List&quot;: { &#39;A&#39;, &#39;B&#39;, &#39;C&#39; }
define &quot;Input List Pairs&quot;:
  from &quot;Input List&quot; X, &quot;Input List&quot; Y
</code></pre></div>



<a name="234875133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234875133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234875133">(Apr 16 2021 at 15:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Input List=[A, B, C]
Input List Pairs=[Tuple {
    &quot;X&quot;: A
    &quot;Y&quot;: A
}, Tuple {
    &quot;X&quot;: A
    &quot;Y&quot;: B
}, Tuple {
    &quot;X&quot;: A
    &quot;Y&quot;: C
}, Tuple {
    &quot;X&quot;: B
    &quot;Y&quot;: A
}, Tuple {
    &quot;X&quot;: B
    &quot;Y&quot;: B
}, Tuple {
    &quot;X&quot;: B
    &quot;Y&quot;: C
}, Tuple {
    &quot;X&quot;: C
    &quot;Y&quot;: A
}, Tuple {
    &quot;X&quot;: C
    &quot;Y&quot;: B
}, Tuple {
    &quot;X&quot;: C
    &quot;Y&quot;: C
}]
</code></pre></div>



<a name="234875931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234875931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234875931">(Apr 16 2021 at 15:40)</a>:</h4>
<p>On the question of context, CQL allows the model to specify a context, which you can think of as a "default filter" with respect to a particular context. Patient is the most common context, but models can define any number of them. In FHIR specifically, this corresponds roughly to the notion of a "compartment", and the FHIR model info includes context definitions for each compartment definition in the FHIR specification.</p>



<a name="234876699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234876699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234876699">(Apr 16 2021 at 15:45)</a>:</h4>
<p>There's an explanation of the impact of context in the <a href="http://build.fhir.org/ig/HL7/cql/02-authorsguide.html#retrieve-context">Retrieve Context</a> topic of the Author's Guide.</p>



<a name="234876770"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234876770" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234876770">(Apr 16 2021 at 15:46)</a>:</h4>
<p>Does that help?</p>



<a name="234876840"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234876840" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234876840">(Apr 16 2021 at 15:46)</a>:</h4>
<p>(And apologies for the delays in getting back to this) <span class="user-mention" data-user-id="193795">@Joel Francis</span> <span class="user-mention" data-user-id="192545">@Alex Goel</span></p>



<a name="234879582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234879582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234879582">(Apr 16 2021 at 16:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>define &quot;Quantitative Laboratory Result Pairs&quot;:
  from
    &quot;Quantitative Laboratory Results&quot; O1,
    &quot;Quantitative Laboratory Results&quot; O2
</code></pre></div>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> No worries on the delay! I'm not clear on why this returns what the lists. In reading these functions it seems like these would be the same list and you're subtracting 1 from 1. How does the CQL know that it should iterate through these lists to produce the pairs?</p>



<a name="234881669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234881669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234881669">(Apr 16 2021 at 16:14)</a>:</h4>
<p>The "from" clause is setting up the sources for a query. The <code>Quantitative Laboratory Results</code> expression returns a list of lab results, so this is saying, "from Quantitative Laboratory Results with the name O1 and Quantitative Laboratory Results as the name O2, perform the following query". The definition of a multi-source query starts with the set of all possible combinations of the input sources (also known as cartesian product of sets).</p>



<a name="234881989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234881989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234881989">(Apr 16 2021 at 16:16)</a>:</h4>
<p>If you're familiar with SQL, it's the same as saying:</p>
<div class="codehilite"><pre><span></span><code>select *
  from &quot;Quantitative Laboratory Results&quot; O1, &quot;Quantitative Laboratory Results&quot; O2
</code></pre></div>
<p>Or in join syntax:</p>
<div class="codehilite"><pre><span></span><code>select *
  from &quot;Quantitative Laboratory Results&quot; O1 cross join &quot;Quantitative Laboratory Results&quot; O2
</code></pre></div>



<a name="234882219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20Exercise%20questions/near/234882219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20Exercise.20questions.html#234882219">(Apr 16 2021 at 16:18)</a>:</h4>
<p>The <a href="http://build.fhir.org/ig/HL7/cql/03-developersguide.html#multi-source-queries">Multi-source queries</a> topic has more discussion as well.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
