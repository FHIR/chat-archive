---
layout: page
title: "FHIR Chat  · ✔ QA errors from Publisher on Library resolution · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html">✔ QA errors from Publisher on Library resolution</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="246615053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246615053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246615053">(Jul 20 2021 at 16:25)</a>:</h4>
<p>Hi folks. I'm seeing a common QA error from Publisher in my Library resources. The FSH generating the Library resources doen't specify relatedArtifacts directly though I can do so if it solves this. (Also, does anyone understand the error for  machine processing?)<br>
<a href="/user_uploads/10155/1NzSMhIZIiyOOI5LMy2870D3/Screen-Shot-2021-07-20-at-12.22.59.png">Screen-Shot-2021-07-20-at-12.22.59.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/1NzSMhIZIiyOOI5LMy2870D3/Screen-Shot-2021-07-20-at-12.22.59.png" title="Screen-Shot-2021-07-20-at-12.22.59.png"><img src="/user_uploads/10155/1NzSMhIZIiyOOI5LMy2870D3/Screen-Shot-2021-07-20-at-12.22.59.png"></a></div>



<a name="246616897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246616897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246616897">(Jul 20 2021 at 16:39)</a>:</h4>
<p>The "name" element of a canonical resource should be a code-friendly name (alphanumeric, doesn't start with a number, etc).</p>



<a name="246617618"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246617618" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246617618">(Jul 20 2021 at 16:45)</a>:</h4>
<p>The ModelInfo and FHIRHelpers issues are because those libraries are supposed to be in the base, but they aren't yet present (R4B added them, but isn't published yet, and to really take advantage of it you'd have to base your IG on R4B). There's also not another IG that actually has them published officially anywhere, working on that but that's another story. So what I typically do is actually copy them in locally. You can see an example of that here: <a href="https://github.com/cqframework/cqf-ccc/tree/master/input/resources/library">https://github.com/cqframework/cqf-ccc/tree/master/input/resources/library</a></p>



<a name="246617648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246617648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246617648">(Jul 20 2021 at 16:45)</a>:</h4>
<p>It's not a great solution, but once the actual solution is in place, it will be easy to refactor to incorporate.</p>



<a name="246620349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246620349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246620349">(Jul 20 2021 at 17:06)</a>:</h4>
<p>Is there any reason I can't use FHIRCommon.json in another IG, as it's url is for ccc: "<a href="http://fhir.org/guides/cqf/ccc/Library/FHIRCommon">http://fhir.org/guides/cqf/ccc/Library/FHIRCommon</a>"?</p>



<a name="246622028"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246622028" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246622028">(Jul 20 2021 at 17:20)</a>:</h4>
<p>If you include a copy in your IG, update the URL to match your IG's base canonical.</p>



<a name="246633693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246633693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246633693">(Jul 20 2021 at 18:56)</a>:</h4>
<p>Hmm. I still see the "Canonical URL '<a href="http://hl7.org/fhir/Library/FHIRHelpers|4.0.1">http://hl7.org/fhir/Library/FHIRHelpers|4.0.1</a>' does not resolve" error and some errors are multiplying. Where does Publisher insist on using "<a href="http://hl7.org/fhir/">http://hl7.org/fhir/</a>" as the base canonical? It's not setup that way in my IG.</p>



<a name="246636711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246636711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246636711">(Jul 20 2021 at 19:22)</a>:</h4>
<p>So, are you using the publisher to do the CQL translation?</p>



<a name="246641028"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246641028" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246641028">(Jul 20 2021 at 19:56)</a>:</h4>
<p>Yes, indeed.</p>



<a name="246657253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657253">(Jul 20 2021 at 22:07)</a>:</h4>
<p>Okay, the translator has had some fixes recently to address this issue and the publisher hasn't been updated yet. Use the CQF Tooling to build (which will also refresh generated content in libraries and measures and plandefinitions, and package all your artifacts into the bundles directory, and other goodies).</p>



<a name="246657279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657279">(Jul 20 2021 at 22:07)</a>:</h4>
<p>We're working on getting all that in to the publisher, but it's not there yet.</p>



<a name="246657293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657293">(Jul 20 2021 at 22:07)</a>:</h4>
<p>So... follow the pattern in sample-content-ig:</p>



<a name="246657296"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657296" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657296">(Jul 20 2021 at 22:07)</a>:</h4>
<p><a href="https://github.com/cqframework/sample-content-ig">https://github.com/cqframework/sample-content-ig</a></p>



<a name="246657301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657301">(Jul 20 2021 at 22:07)</a>:</h4>
<p>Specifically, the _updateCQFTooling scripts</p>



<a name="246657303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657303">(Jul 20 2021 at 22:07)</a>:</h4>
<p>And the _refresh scripts</p>



<a name="246657362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657362">(Jul 20 2021 at 22:08)</a>:</h4>
<p>Same pattern as the publisher, _updateCQFTooling to download the latest, _refresh to refresh the generated content.</p>



<a name="246657385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657385">(Jul 20 2021 at 22:08)</a>:</h4>
<p>Then run _genonce to build with the updated content.</p>



<a name="246657392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657392">(Jul 20 2021 at 22:08)</a>:</h4>
<p>So, I'm not sure how that plays with SUSHI though.</p>



<a name="246657410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246657410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246657410">(Jul 20 2021 at 22:08)</a>:</h4>
<p>Do you run sushi as a separate step, or is it part of the _genonce call?</p>



<a name="246658102"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246658102" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246658102">(Jul 20 2021 at 22:18)</a>:</h4>
<p>And if you use the CQF Tooling to do the translation, you have to tell the publisher not to, comment out the input/cql path:</p>



<a name="246658116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246658116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246658116">(Jul 20 2021 at 22:18)</a>:</h4>
<p><a href="https://github.com/cqframework/sample-content-ig/blob/master/input/mycontentig.xml#L119">https://github.com/cqframework/sample-content-ig/blob/master/input/mycontentig.xml#L119</a></p>



<a name="246660467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246660467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246660467">(Jul 20 2021 at 22:53)</a>:</h4>
<p>Ok thanks. I use sushi separately but also in publisher. I’ll have a try!</p>



<a name="246666900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246666900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246666900">(Jul 21 2021 at 00:31)</a>:</h4>
<p>By default, if the publisher detects an <code>input/fsh</code> folder, it will run SUSHI as part of the build.  You can turn this off by passing a <code>-no-sushi</code> flag when you run <code>_genonce</code>.</p>



<a name="246668684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/246668684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#246668684">(Jul 21 2021 at 01:02)</a>:</h4>
<p>Ok thanks, did not know that. Yeah, my goal has been a true fsh-cql-measure IG pipeline.</p>



<a name="256265370"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/256265370" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#256265370">(Oct 05 2021 at 15:22)</a>:</h4>
<p>By way of update, I've tried many iterations of getting a CQL-FSH pipeline to build correctly and there are errors in each attempt that are different depending on the approach. I'll surface this here in case someone wants to try on their own IG and work through it.</p>



<a name="256283530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/256283530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#256283530">(Oct 05 2021 at 17:14)</a>:</h4>
<p>Would you mind creating a couple dummy IGs in a repo you can share to show the different approaches you've tried?</p>



<a name="256317978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/256317978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#256317978">(Oct 05 2021 at 20:58)</a>:</h4>
<p>Hi, thanks <span class="user-mention" data-user-id="194178">@JP</span> . Here's the sample content IG, but using sushi-config to build the IG itself, and a simple FSH/CQL setup. <a href="https://github.com/citizenrich/sample-content-ig">https://github.com/citizenrich/sample-content-ig</a> The methods I've tried are 1) do everything in fsh-generated/resources, which means creating folders for libary and measure after the fact and moving them over, or 2) do everything in input/resources which means moving stuff generated by sushi into that folder (also library and measure folders in addition), but then _genonce without sushi fails because it complains it can't find anything. It's not an exact copy of my work but hopefully a minimal non-working example.</p>



<a name="256543419"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/256543419" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#256543419">(Oct 07 2021 at 08:47)</a>:</h4>
<p><span class="user-mention" data-user-id="194178">@JP</span> I'll be looking at this more today if you have a few minutes to check it out.</p>



<a name="256632146"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/256632146" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#256632146">(Oct 07 2021 at 19:04)</a>:</h4>
<p>I won't have a chance to look at it today. Do you have some time early next week we can discuss?</p>



<a name="256733098"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/256733098" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#256733098">(Oct 08 2021 at 12:39)</a>:</h4>
<p>Absolutely. I'll have another go at it as well before then.</p>



<a name="257034593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257034593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257034593">(Oct 11 2021 at 09:08)</a>:</h4>
<p>So, I had another go this morning and can now generate Library resources with CQL using _refresh that don't show the 'can't resolve fhir helpers' etc errors in qa.html. The issue seems to be avoiding the use of Sushi for the IG resource itself, and instead use the usual XML. The steps I followed:</p>
<ul>
<li>use xml ig not sushi</li>
<li>use includes/menu.xml not sushi</li>
<li>comment out input/cql binary stuff in xml</li>
<li>fshonly - true in sushi</li>
<li>mv Library templates created by Sushi to input/resources or publisher errors with duplicate resources.<br>
Then:</li>
</ul>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>mv fsh-generated/resources/Library-* input/resources/
bash _refresh.sh
bash _genonce.sh -no-sushi
</code></pre></div>
<p>The result is attached in screen shot. Still errors, but closer. If you can have a go at this, that would be great.<br>
<a href="/user_uploads/10155/X9k8cKuEeTXqVBHcRsJM80DO/Screen-Shot-2021-10-11-at-10.49.45.png">Screen-Shot-2021-10-11-at-10.49.45.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/X9k8cKuEeTXqVBHcRsJM80DO/Screen-Shot-2021-10-11-at-10.49.45.png" title="Screen-Shot-2021-10-11-at-10.49.45.png"><img src="/user_uploads/10155/X9k8cKuEeTXqVBHcRsJM80DO/Screen-Shot-2021-10-11-at-10.49.45.png"></a></div>



<a name="257056342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257056342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257056342">(Oct 11 2021 at 12:25)</a>:</h4>
<p>There are also errors from $measure-evaluate if folks have a hint how to troubleshoot:<br>
"Failed to call access method: java.lang.NullPointerException: Cannot invoke \"org.opencds.cqf.cql.evaluator.measure.common.PopulationDef.getCriteriaExpression()\" because \"inclusionDef\" is null"<br>
and<br>
"Failed to call access method: java.lang.NullPointerException: Cannot invoke \"String.contains(java.lang.CharSequence)\" because \"date\" is null"</p>



<a name="257072399"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257072399" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257072399">(Oct 11 2021 at 14:31)</a>:</h4>
<p>Are those $evaluat-measure errors from that same IG?</p>



<a name="257073174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257073174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257073174">(Oct 11 2021 at 14:36)</a>:</h4>
<p>They should be, but I'm testing two in parallel. Update: I had some help from Bryn this morning and have squashed many of the IG errors, so in a bit I'll rerun the $measure-evaluate stuff.</p>



<a name="257091362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257091362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257091362">(Oct 11 2021 at 17:01)</a>:</h4>
<p><span class="user-mention" data-user-id="194178">@JP</span> I see the error "ParameterDefinition.type: minimum required = 1, but only found 0 (from <a href="http://hl7.org/fhir/StructureDefinition/ParameterDefinition">http://hl7.org/fhir/StructureDefinition/ParameterDefinition</a>)". The CQL snippet is:</p>
<div class="codehilite"><pre><span></span><code>library Test version &#39;0.1.0&#39;

using FHIR version &#39;4.0.1&#39;

include FHIRHelpers version &#39;4.0.1&#39;

include AgeRanges version &#39;0.1.0&#39; called AR

context Patient

define &quot;Gender&quot;:
  Patient.gender
...
</code></pre></div>
<p>In the Library generated by CQF tooling, however, gender is missing a type:</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;name&quot;: &quot;Gender&quot;,
  &quot;use&quot;: &quot;out&quot;,
  &quot;min&quot;: 0,
  &quot;max&quot;: &quot;1&quot;
},
</code></pre></div>
<p>I can log an issue in GitHub, but any suggestions on how this could be broken of my own design first?</p>



<a name="257176758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257176758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257176758">(Oct 12 2021 at 09:53)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="194178">@JP</span> So, the repo <a href="https://github.com/citizenrich/sample-content-ig">https://github.com/citizenrich/sample-content-ig</a> has the exact steps in the readme to reproduce the two errors I'm encountering. One is just above, where Patient.gender has no type in the Library after running CQF tooling. The second, and blocker (I have a demo tomorrow :) is this: Failed to call access method: java.lang.NullPointerException: Cannot invoke \"String.contains(java.lang.CharSequence)\" because \"date\" is null". FYI <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="257230095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257230095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257230095">(Oct 12 2021 at 16:19)</a>:</h4>
<p>Looking at the null pointer now.</p>



<a name="257241306"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257241306" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257241306">(Oct 12 2021 at 17:31)</a>:</h4>
<p>$evaluate-measure is actually a GET request rather than a POST request. Try this:</p>
<p>curl GET  '<a href="http://localhost:8080/cqf-ruler-r4/fhir/Measure/SimpleAgeGroup/$evaluate-measure?periodStart=1970&amp;periodEnd=2021">http://localhost:8080/cqf-ruler-r4/fhir/Measure/SimpleAgeGroup/$evaluate-measure?periodStart=1970&amp;periodEnd=2021</a>' | jq</p>



<a name="257241932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257241932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257241932">(Oct 12 2021 at 17:35)</a>:</h4>
<p>There's another issue which is that the CQL has a "Measurement Period" of type "Date" and it should be "DateTime"</p>



<a name="257243736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257243736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257243736">(Oct 12 2021 at 17:47)</a>:</h4>
<p>Ok. I'll make those changes and try again in just a bit.</p>



<a name="257244236"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257244236" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257244236">(Oct 12 2021 at 17:50)</a>:</h4>
<p>One more issue is that the generated Measure resource isn't quite right:</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code>  <span class="nt">"group"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"code"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"coding"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">"code"</span><span class="p">:</span> <span class="s2">"cohort"</span><span class="p">,</span>
            <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"http://somewhere.org/fhir/uv/mycontentig/CodeSystem/OpenHIE"</span><span class="p">,</span>
            <span class="nt">"display"</span><span class="p">:</span> <span class="s2">"cohort"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">"population"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Initial Population"</span><span class="p">,</span>
          <span class="nt">"code"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"coding"</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">"code"</span><span class="p">:</span> <span class="s2">"initial-population"</span><span class="p">,</span>
                <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"http://terminology.hl7.org/CodeSystem/measure-population"</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">},</span>
          <span class="nt">"criteria"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"language"</span><span class="p">:</span> <span class="s2">"text/cql"</span><span class="p">,</span>
            <span class="nt">"expression"</span><span class="p">:</span> <span class="s2">"Initial Population"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">"stratifier"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"criteria"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"language"</span><span class="p">:</span> <span class="s2">"text/cql"</span><span class="p">,</span>
            <span class="nt">"expression"</span><span class="p">:</span> <span class="s2">"Age Group"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"code"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"coding"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">"code"</span><span class="p">:</span> <span class="s2">"cohort"</span><span class="p">,</span>
            <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"http://somewhere.org/fhir/uv/mycontentig/CodeSystem/OpenHIE"</span><span class="p">,</span>
            <span class="nt">"display"</span><span class="p">:</span> <span class="s2">"cohort"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">"population"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Denominator"</span><span class="p">,</span>
          <span class="nt">"code"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"coding"</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">"code"</span><span class="p">:</span> <span class="s2">"denominator"</span><span class="p">,</span>
                <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"http://terminology.hl7.org/CodeSystem/measure-population"</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">},</span>
          <span class="nt">"criteria"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"language"</span><span class="p">:</span> <span class="s2">"text/cql"</span><span class="p">,</span>
            <span class="nt">"expression"</span><span class="p">:</span> <span class="s2">"Denominator"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">"stratifier"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"criteria"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"language"</span><span class="p">:</span> <span class="s2">"text/cql"</span><span class="p">,</span>
            <span class="nt">"expression"</span><span class="p">:</span> <span class="s2">"Age Group"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"code"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"coding"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">"code"</span><span class="p">:</span> <span class="s2">"cohort"</span><span class="p">,</span>
            <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"http://somewhere.org/fhir/uv/mycontentig/CodeSystem/OpenHIE"</span><span class="p">,</span>
            <span class="nt">"display"</span><span class="p">:</span> <span class="s2">"cohort"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">"population"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"description"</span><span class="p">:</span> <span class="s2">"Numerator"</span><span class="p">,</span>
          <span class="nt">"code"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"coding"</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">"code"</span><span class="p">:</span> <span class="s2">"numerator"</span><span class="p">,</span>
                <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"http://terminology.hl7.org/CodeSystem/measure-population"</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">},</span>
          <span class="nt">"criteria"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"language"</span><span class="p">:</span> <span class="s2">"text/cql"</span><span class="p">,</span>
            <span class="nt">"expression"</span><span class="p">:</span> <span class="s2">"Numerator"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">"stratifier"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"criteria"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"language"</span><span class="p">:</span> <span class="s2">"text/cql"</span><span class="p">,</span>
            <span class="nt">"expression"</span><span class="p">:</span> <span class="s2">"Age Group"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</code></pre></div>



<a name="257244360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257244360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257244360">(Oct 12 2021 at 17:51)</a>:</h4>
<p>That's three different groups each with a different population. It should be one group with 3 populations.</p>



<a name="257244639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257244639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257244639">(Oct 12 2021 at 17:53)</a>:</h4>
<p>I think your Measure definition should look like:</p>
<div class="codehilite" data-code-language="fsh"><pre><span></span><code>Alias: $OpenHIE = http://somewhere.org/fhir/uv/mycontentig/CodeSystem/OpenHIE

CodeSystem: OpenHIE
Id: OpenHIE
Title: "OpenHIE CodeSystem"
Description: "OpenHIE CodeSystem"
* ^url = $OpenHIE
* #cohort "cohort"

Alias: $measure-scoring = http://terminology.hl7.org/CodeSystem/measure-scoring
Alias: $measure-population = http://terminology.hl7.org/CodeSystem/measure-population

Instance: SimpleAgeGroup
InstanceOf: Measure
Title: "SimpleAgeGroup"
Description: "SimpleAgeGroup"
* identifier.system = "http://somewhere.org/fhir/uv/mycontentig/Measure"
* version = "0.0.0"
* status = #draft
* experimental = true
* date = "2021-07-01"
* publisher = "OpenHIE"
* library[+] = Canonical(Test)
* name = "SimpleAgeGroup"
* url = "http://somewhere.org/fhir/uv/mycontentig/Measure/SimpleAgeGroup"
* identifier.value = "SimpleAgeGroup"
* scoring = $measure-scoring#proportion
* group[+]
  * code = $OpenHIE#cohort "cohort"
  * population[+]
    * description = "Initial Population"
    * code = $measure-population#initial-population
    * criteria.language = #text/cql
    * criteria.expression = "Initial Population"
  * population[+]
    * description = "Denominator"
    * code = $measure-population#denominator
    * criteria.language = #text/cql
    * criteria.expression = "Denominator"
  * population[+]
    * description = "Numerator"
    * code = $measure-population#numerator
    * criteria.language = #text/cql
    * criteria.expression = "Numerator"
  * stratifier[0].criteria.language = #text/cql
  * stratifier[=].criteria.expression = "Age Group"
</code></pre></div>



<a name="257244746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257244746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257244746">(Oct 12 2021 at 17:54)</a>:</h4>
<p>We should add validation to the ruler to catch things like that. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="257245171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257245171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257245171">(Oct 12 2021 at 17:57)</a>:</h4>
<p>With those 3 changes:</p>
<ol>
<li>GET instead of POST</li>
<li>DateTime instead of Date for MeasurementPeriod</li>
<li>Reworked Measure resource</li>
</ol>
<p>I get a successful eval.</p>



<a name="257245525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257245525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257245525">(Oct 12 2021 at 17:59)</a>:</h4>
<p>And &lt;100ms when it's warmed up. ~4ms per patient. <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>
<p>You've got a branch with additional performance enhancements. Don't tell anyone.</p>



<a name="257249822"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257249822" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257249822">(Oct 12 2021 at 18:28)</a>:</h4>
<p>Thanks very much <span class="user-mention" data-user-id="194178">@JP</span> the corrections worked.</p>



<a name="257348667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257348667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257348667">(Oct 13 2021 at 11:25)</a>:</h4>
<p><span class="user-mention" data-user-id="194178">@JP</span> Quick follow-up. I'm seeing an error: "Failed to call access method: org.opencds.cqf.cql.engine.exception.InvalidOperatorArgument: Expected CalculateAgeInYearsAt(Date, Date), CalculateAgeInYearsAt(DateTime, DateTime)... Found CalculateAgeInYearsAt(org.opencds.cqf.cql.engine.runtime.Date, org.opencds.cqf.cql.engine.runtime.DateTime)"</p>



<a name="257349133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257349133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257349133">(Oct 13 2021 at 11:29)</a>:</h4>
<p>The line in question is in two files but is the same:</p>
<div class="codehilite"><pre><span></span><code>parameter &quot;Measurement Period&quot; Interval&lt;DateTime&gt; default Interval[@2020-01-01T, @2020-12-31T]
</code></pre></div>
<p>I added the T at the end per <a href="https://cql.hl7.org/02-authorsguide.html#simple-values">https://cql.hl7.org/02-authorsguide.html#simple-values</a></p>



<a name="257352421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257352421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257352421">(Oct 13 2021 at 11:59)</a>:</h4>
<p>Also, is it possible to map the $evaluate-measure periodStart/End to this parameter in some way, and if so, where does it live? <span class="user-mention" data-user-id="197470">@Alexander Kiel</span></p>



<a name="257364921"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257364921" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257364921">(Oct 13 2021 at 13:29)</a>:</h4>
<p>The $evaluate-measure implementation in HAPI maps periodStart/End to the Measurement Period parameter, are you seeing different behavior there?</p>



<a name="257383632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257383632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257383632">(Oct 13 2021 at 15:18)</a>:</h4>
<p>As Bryn mentioned, the periodStart and End are mapped to that CQL parameter. That’s done internally as part of the $evaluate-measure implementation.</p>
<p>Did you delete the generated Libraries and refresh them after making that change to the CQL?</p>



<a name="257390268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257390268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257390268">(Oct 13 2021 at 15:57)</a>:</h4>
<p>Bryn: I'm trying to understand the behavior. Ok, so the default will be overridden by the $evaluate-measure operation. Got it.<br>
JP: I issue PUTs so it should override the existing stuff. But, I'll try blowing away the cqf-ruler db.</p>



<a name="257559443"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257559443" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257559443">(Oct 14 2021 at 15:58)</a>:</h4>
<p>So yes, removing the DB worked. Thanks <span class="user-mention" data-user-id="194178">@JP</span> and <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> I hope you won't mind a quick follow-up. This is an error I'm getting from $evaluate-measure: Cannot invoke \"org.opencds.cqf.cql.evaluator.measure.common.PopulationDef.getCriteriaExpression()\" because \"inclusionDef\" is null". Is this indicating an error with a Measure resource or the CQL?</p>



<a name="257560372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257560372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257560372">(Oct 14 2021 at 16:03)</a>:</h4>
<p>That’s an issue with the Measure resource. A proportion Measure requires at least Initial Population, Denominator, and Numerator.</p>



<a name="257560468"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257560468" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257560468">(Oct 14 2021 at 16:04)</a>:</h4>
<p>If they are specified incorrectly in the Measure resource you’ll get that exception.</p>



<a name="257732755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257732755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257732755">(Oct 15 2021 at 17:15)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="194178">@JP</span> Stratifiers are successfully reported out for combinations such as:</p>
<div class="codehilite"><pre><span></span><code>define &quot;Age Group/Sex&quot;:
  &quot;Age Group&quot;.code + &#39;:&#39; + &quot;Sex&quot;
</code></pre></div>
<p>But I'm not getting Location to be reported out as a stratifier. My goal is Age Group * Sex * Encounter.Last(Location). Location is required to be a codeableconcept for supplementary data, but is that the same for stratifiers?</p>



<a name="257733890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257733890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257733890">(Oct 15 2021 at 17:23)</a>:</h4>
<p>Yes, it needs to be a codeableconcept or string.</p>



<a name="257737014"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257737014" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257737014">(Oct 15 2021 at 17:44)</a>:</h4>
<p>Ok, I'm getting successful CQL evaluations, such as for this example provided by Bryn, but it doesn't appear in the measure report.</p>
<div class="codehilite"><pre><span></span><code>define &quot;Location&quot;:
  First([Encounter] E
    return &quot;GetLocation&quot;(First(E.location).location)
  )

define &quot;Most Recent Encounter Location Reference&quot;:
  Last([Encounter] E
    return First(E.location L
      return L.location
    )
      //sort by start of period
  )

// works with cql not evaluate-measure
define &quot;Location Code Revised&quot;:
  singleton from (
    [Location] L
      let identifier: singleton from (L.identifier I)
      // let identifier: singleton from (L.identifier I where I.system = &#39;https://github.com/synthetichealth/synthea&#39;)
      where L.id = Last(Split(&quot;Most Recent Encounter Location Reference&quot;.reference, &#39;/&#39;))
      return CodeableConcept {
        coding: {
          Coding {
            code: code { value: identifier.value },
            system: identifier.system
          }
        }
      }
  )
</code></pre></div>



<a name="257739853"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257739853" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257739853">(Oct 15 2021 at 18:04)</a>:</h4>
<p>Hmm... Mind giving the full example? Is it in that same repo from before?</p>



<a name="257935544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/257935544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#257935544">(Oct 17 2021 at 17:41)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="194178">@JP</span>, thanks, the repo is: <a href="https://github.com/intrahealth/simple-hiv-ig">https://github.com/intrahealth/simple-hiv-ig</a> I've tried to simplify to the minimal working/non-working examples with stratifiers. The attempts at location are in the measure.fsh and kitchensink.cql.</p>



<a name="258105324"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258105324" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258105324">(Oct 18 2021 at 21:42)</a>:</h4>
<p>Bit swamped at the moment but I asked colleague <span class="user-mention" data-user-id="409302">@Zack Austin</span> to take a look.</p>



<a name="258109235"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258109235" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258109235">(Oct 18 2021 at 22:14)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="194178">@JP</span> and <span class="user-mention" data-user-id="409302">@Zack Austin</span> There's a lot of hacks to try to make it work, but no success. There are a couple of simple bundles for tests in the repo so you can see what evaluates with CQL.</p>



<a name="258353822"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258353822" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258353822">(Oct 20 2021 at 11:55)</a>:</h4>
<p><span class="user-mention" data-user-id="194178">@JP</span> <span class="user-mention" data-user-id="409302">@Zack Austin</span>  I've updated the repo so that if you have a minute to look it is should be easier to identify any problems. Essentially, stratifiers are working with cqf-ruler-r4 for age groups and gender/sex (and I expect in general!). </p>
<p>However, I cannot get one to work for Encounter.Location. The attempts start here:<br>
<a href="https://github.com/intrahealth/simple-hiv-ig/blob/4d20b7841325e42b5854217626add81a6152d7f8/input/cql/KitchenSink.cql#L145">https://github.com/intrahealth/simple-hiv-ig/blob/4d20b7841325e42b5854217626add81a6152d7f8/input/cql/KitchenSink.cql#L145</a><br>
Measures are all defined in /input/fsh/measure.fsh. Examples of Measure Reports are in /measurereports. There are two tests for the KitchenSink which show that some of the methods I've tried should evaluate to either a code or a string for Encounter.Location but the stratifiers don't show up in $evaluate-measure ops.</p>



<a name="258685464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258685464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258685464">(Oct 22 2021 at 09:26)</a>:</h4>
<p>I've simplified the CQL expressions to try to get to the root of the issue. These expressions pass CQL evaluation but stratifiers using them are dropped at some point in the $evaluate-measure operation. I've extended the periodStart/End to try to ensure the test cases capture them, used fhirpath to ensure they are correct, tried different variations, and done some other troubleshooting but must still be missing something.</p>
<div class="codehilite"><pre><span></span><code>// Bundle.entry.resource.ofType(Encounter)[0].serviceProvider.reference
define &quot;serviceProvider&quot;:
  Last([Encounter]).serviceProvider.reference.value

define &quot;assert serviceProvider is string&quot;:
  &quot;serviceProvider&quot; is String

// Bundle.entry.resource.ofType(Encounter)[0].location[0].location.reference
define &quot;Naive Location&quot;:
  Last([Encounter]).location[0].location.reference.value
  // sort by start of period
  // where E.period overlaps AR.&quot;Measurement Period&quot;

define &quot;assert Naive Location is string&quot;:
  &quot;Naive Location&quot; is String
</code></pre></div>
<p>Result from CQL evaluation:</p>
<div class="codehilite"><pre><span></span><code>serviceProvider=Organization/Organization-HIVSimple
assert serviceProvider is string=true
Naive Location=Location/Location-HIVSimple
assert Naive Location is string=true
</code></pre></div>



<a name="258767163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258767163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258767163">(Oct 22 2021 at 20:08)</a>:</h4>
<p>I'm not getting stratifiers with latest CQFRuler with JustGender.</p>



<a name="258767441"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258767441" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258767441">(Oct 22 2021 at 20:10)</a>:</h4>
<p>I was wondering if the "/" in Naive Location was causing a problem so I tried removing it.  It didn't fix the issue (still no stratifier) so I tried JustGender to make sure it was a valid repro and I got no stratifiers for that either.</p>



<a name="258876453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258876453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258876453">(Oct 24 2021 at 12:27)</a>:</h4>
<p><span class="user-mention" data-user-id="217210">@Rob Reynolds</span>  It's not merged into main I think. Make sure you're on the feature-stratification branch, e.g.:</p>
<div class="codehilite"><pre><span></span><code>git checkout feature-stratification
mvn jetty:run -am --projects cqf-ruler-r4
</code></pre></div>
<p>Please share the results. I have successful results for age group, gender, group*gender, just not location. The _runcqf bash script has all of the fun to reproduce. Note that the script uses a Python-based bulk data generator based on FSH, so you may want to just run it selectively and is designed for *nix systems.</p>



<a name="258880322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258880322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258880322">(Oct 24 2021 at 14:02)</a>:</h4>
<p>That might be it. I’ll check later today.</p>
<p>Rob</p>



<a name="258881069"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258881069" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258881069">(Oct 24 2021 at 14:23)</a>:</h4>
<p>Have you pushed that branch?</p>
<p>I thought I had looked for other branches, but wondered if I had maybe missed something.</p>
<p>But in double-checking, the only branch I see is gh-pages and it's pretty stale (last updated 2 months ago).</p>
<p><a href="/user_uploads/10155/dd1u2IaTdH2iMk7EXxzN2cRM/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/dd1u2IaTdH2iMk7EXxzN2cRM/image.png" title="image.png"><img src="/user_uploads/10155/dd1u2IaTdH2iMk7EXxzN2cRM/image.png"></a></div>



<a name="258896706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258896706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258896706">(Oct 24 2021 at 20:29)</a>:</h4>
<p>Wait.  You mean I need to run a different branch of CQF Ruler.  (thanks Bryn!)</p>



<a name="258896753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258896753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258896753">(Oct 24 2021 at 20:29)</a>:</h4>
<p>I'll look into that.   (sorry, I thought you were saying I needed to use a different branch of simple-hiv-ig) .</p>



<a name="258937879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/258937879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#258937879">(Oct 25 2021 at 09:59)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="217210">@Rob Reynolds</span> yeah, sorry for the confusion, I meant the feature-stratification branch of cqf-ruler.</p>



<a name="259465966"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/259465966" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zack Austin <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#259465966">(Oct 28 2021 at 23:33)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="194192">@Richard Stanley</span> , I was able to get back values for both the JustLocation and AgeGroupGenderLocation Measures on latest for the rulers feature-stratification branch.</p>
<p><a href="/user_uploads/10155/CPzDjKjwhEtoDJi0CfbC2s3P/MR-AgeGroupGenderLocation.PNG">MR-AgeGroupGenderLocation.PNG</a><br>
<a href="/user_uploads/10155/4VQCh-QOMYZVB8Wi1Eq8OWYs/MR-JustLocation.PNG">MR-JustLocation.PNG</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/CPzDjKjwhEtoDJi0CfbC2s3P/MR-AgeGroupGenderLocation.PNG" title="MR-AgeGroupGenderLocation.PNG"><img src="/user_uploads/10155/CPzDjKjwhEtoDJi0CfbC2s3P/MR-AgeGroupGenderLocation.PNG"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/4VQCh-QOMYZVB8Wi1Eq8OWYs/MR-JustLocation.PNG" title="MR-JustLocation.PNG"><img src="/user_uploads/10155/4VQCh-QOMYZVB8Wi1Eq8OWYs/MR-JustLocation.PNG"></a></div><p>Do these values look correct to you?</p>
<p>I used the Patient-HIVSimple Test Case for these results.</p>



<a name="259504622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/259504622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#259504622">(Oct 29 2021 at 10:08)</a>:</h4>
<p>That's fantastic and exactly what I expected <span class="user-mention" data-user-id="409302">@Zack Austin</span> If you have any hints on what I'm doing wrong, please do share. Also, if you can share the postman collections I can try to reproduce. Did you have to change anything in a Library or Measure?</p>



<a name="259584997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/259584997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zack Austin <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#259584997">(Oct 29 2021 at 21:22)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="194192">@Richard Stanley</span> , I did run the knowledge artifacts for your Measures and Libraries through the cqf-tooling project's IG Refresh operation: <a href="https://github.com/cqframework/cqf-tooling">https://github.com/cqframework/cqf-tooling</a></p>
<p>The IGRefresh operator will update and generate any knowledge artifact resources in input/resources/library and input/resources/measure and can potentially ease the development burden of some of this work.</p>
<p>An example of the command: -RefreshIG -root-dir="D:\src\code\intrahealth\simple-hiv-ig" -rp="D:\src\code\intrahealth\simple-hiv-ig\input\resources" -ip="input/simple-hiv-ig.xml" -t -d -p -fs=http://localhost:8080/cqf-ruler-r4/fhir/</p>
<p>Would result in updated fhir resources for your measures and libraries: </p>
<p><a href="/user_uploads/10155/Eb4REvltV72l0sylC4h99ySX/Capture-Process-1.PNG">Capture-Process-1.PNG</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/Eb4REvltV72l0sylC4h99ySX/Capture-Process-1.PNG" title="Capture-Process-1.PNG"><img src="/user_uploads/10155/Eb4REvltV72l0sylC4h99ySX/Capture-Process-1.PNG"></a></div><p>As well as updated measure bundles:</p>
<p><a href="/user_uploads/10155/GLMAYehcUbQqgv76LIi5Adr9/Capture-Process-2.PNG">Capture-Process-2.PNG</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/GLMAYehcUbQqgv76LIi5Adr9/Capture-Process-2.PNG" title="Capture-Process-2.PNG"><img src="/user_uploads/10155/GLMAYehcUbQqgv76LIi5Adr9/Capture-Process-2.PNG"></a></div><p>Another thing I did was modify your Patient Test Case bundle for Patient-HIVSimple from POSTs to PUTs:</p>
<p><a href="/user_uploads/10155/4mmnEm4Lb2h6q4ODkvfDjBJy/Capture-Process-3.PNG">Capture-Process-3.PNG</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/4mmnEm4Lb2h6q4ODkvfDjBJy/Capture-Process-3.PNG" title="Capture-Process-3.PNG"><img src="/user_uploads/10155/4mmnEm4Lb2h6q4ODkvfDjBJy/Capture-Process-3.PNG"></a></div><p>Doing POSTs instead would actually change the resource IDs of your test cases in the cqf-ruler:</p>
<p><a href="/user_uploads/10155/qM6jXs9VTW8Ya5sfHl_2I5VZ/Capture-Process-POST.PNG">Capture-Process-POST.PNG</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/qM6jXs9VTW8Ya5sfHl_2I5VZ/Capture-Process-POST.PNG" title="Capture-Process-POST.PNG"><img src="/user_uploads/10155/qM6jXs9VTW8Ya5sfHl_2I5VZ/Capture-Process-POST.PNG"></a></div><p>At a first glance that seems like a bug to me and may need to be fixed in the ruler -- and may of been what was tripping you up.</p>



<a name="259585341"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/259585341" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zack Austin <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#259585341">(Oct 29 2021 at 21:26)</a>:</h4>
<p>Here is the postman collection that I used in the examples:</p>
<p><a href="/user_uploads/10155/kWSrNgsK-GadEYBrWCON2oOa/Intrahealth.postman_collection.json">Intrahealth.postman_collection.json</a></p>



<a name="259807859"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/259807859" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#259807859">(Oct 31 2021 at 20:53)</a>:</h4>
<p><code>POST</code> generates a new id while <code>PUT</code> uses the Id you pass in:</p>
<p><a href="https://www.hl7.org/fhir/http.html#create">https://www.hl7.org/fhir/http.html#create</a><br>
(server SHALL ignore the Id)</p>
<p><a href="https://www.hl7.org/fhir/http.html#update">https://www.hl7.org/fhir/http.html#update</a></p>



<a name="260044564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/260044564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#260044564">(Nov 02 2021 at 19:20)</a>:</h4>
<p>Sorry for my self-instantiated errors. Thanks so very much <span class="user-mention" data-user-id="409302">@Zack Austin</span> and <span class="user-mention" data-user-id="194178">@JP</span>.</p>



<a name="260044583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%E2%9C%94%20QA%20errors%20from%20Publisher%20on%20Library%20resolution/near/260044583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.E2.9C.94.20QA.20errors.20from.20Publisher.20on.20Library.20resolution.html#260044583">(Nov 02 2021 at 19:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="194192">Richard Stanley</span> has marked this topic as resolved.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
