---
layout: page
title: "FHIR Chat  · CQF Ruler CQL to FHIR Query · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20CQL.20to.20FHIR.20Query.html">CQF Ruler CQL to FHIR Query</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="261056259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20CQL%20to%20FHIR%20Query/near/261056259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Stevens <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20CQL.20to.20FHIR.20Query.html#261056259">(Nov 10 2021 at 21:19)</a>:</h4>
<p>An issue we ran into using CQF Ruler is that we kept getting stream timeouts while trying to run some CQL against a FHIR server (about 7 retrieve statements). We ended up running it against a basic (almost) empty HAPI FHIR server and looked at the logs to see what kind of FHIR queries CQF Ruler was making. </p>
<p>We found out that having CQL in the form of <code>[Observation: code in "concepts"]</code> would make a FHIR query of an Observation with only the search parameter of subject=Patient.id, so it was returning all Observations for the patient, and when using against a server where a patient has 27,000 Observations, it causes a timeout. </p>
<p>However, I then changed the CQL retrieve to <code>[Observation: "concepts"]</code> and the HAPI FHIR logs showed a FHIR query of an Observation with subject=Patient.id and code=all of the codes in the defined concept set, so that does the correct kind of query</p>
<p>Is this an issue with how the ruler evaluates different cql syntax, or is there something else that we're missing here?</p>



<a name="261069984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20CQL%20to%20FHIR%20Query/near/261069984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20CQL.20to.20FHIR.20Query.html#261069984">(Nov 10 2021 at 23:14)</a>:</h4>
<p>That is interesting that you are seeing different query behavior there, I just verified that the ELM output for those two is the same (assuming "concepts" is a reference to a value set?)</p>



<a name="261070087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20CQL%20to%20FHIR%20Query/near/261070087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20CQL.20to.20FHIR.20Query.html#261070087">(Nov 10 2021 at 23:15)</a>:</h4>
<p>I will dig in and see if I can tell what's going on</p>



<a name="261149916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20CQL%20to%20FHIR%20Query/near/261149916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Riley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20CQL.20to.20FHIR.20Query.html#261149916">(Nov 11 2021 at 15:49)</a>:</h4>
<p>Bryn, is there an elm datastructure (trace?) we could send to help you  investigate?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
