---
layout: page
title: "FHIR Chat  · Exception in CQL Execution over CQFRuler · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html">Exception in CQL Execution over CQFRuler</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="272416585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/272416585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abdelali Boussadi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#272416585">(Feb 18 2022 at 15:39)</a>:</h4>
<p>Hi all,</p>
<p>I followed this walkthrough: <a href="https://github.com/cqframework/content-ig-walkthrough">https://github.com/cqframework/content-ig-walkthrough</a> for my own CQL Library.</p>
<p>On Atom, the CQL code is running correctly, I also tested it on this sandbox: <a href="https://cql-runner.dataphoria.org/">https://cql-runner.dataphoria.org/</a> and everything want good.<br>
However, when I try to test my CDS Service using the CDS Hooks sandbox I don’t have any result displayed.</p>
<p>So I tried to display the response from the CQFRuler for this http request using Postman and i got this message (see below), it seems that the CQFRuler is trying to transalte the CQL code even if the FHIR Library already contains the code translated to ELM, I'm a little bit lost ! many thanks for your help.</p>
<p>**ERROR: Exception in CQL Execution.<br>
Unable translate library epidyolex02pharmacist<br>
org.opencds.cqf.cql.engine.exception.CqlException: Unable translate library epidyolex02pharmacist<br>
at org.opencds.cqf.cql.evaluator.engine.execution.TranslatingLibraryLoader.translate(TranslatingLibraryLoader.java:147)<br>
at org.opencds.cqf.cql.evaluator.engine.execution.TranslatingLibraryLoader.load(TranslatingLibraryLoader.java:88)<br>
at org.opencds.cqf.cql.evaluator.engine.execution.CacheAwareLibraryLoaderDecorator.load(CacheAwareLibraryLoaderDecorator.java:49)<br>
at ca.uhn.fhir.cql.r4.helper.LibraryHelper.resolveLibraryById(LibraryHelper.java:203)<br>
at ca.uhn.fhir.cql.r4.helper.LibraryHelper.resolvePrimaryLibrary(LibraryHelper.java:227)<br>
at org.opencds.cqf.r4.servlet.CdsHooksServlet.doPost(CdsHooksServlet.java:184)<br>
at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)<br>
at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)<br>
at org.eclipse.jetty.servlet.ServletHolder$NotAsync.service(ServletHolder.java:1459)<br>
at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799)<br>
at org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1631)<br>
at org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:228)<br>
at org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)<br>
at org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1601)<br>
at org.eclipse.jetty.servlets.CrossOriginFilter.handle(CrossOriginFilter.java:319)<br>
at org.eclipse.jetty.servlets.CrossOriginFilter.doFilter(CrossOriginFilter.java:273)<br>
at org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:201)<br>
at org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1601)<br>
at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:548)<br>
at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)<br>
at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:600)<br>
at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)<br>
at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235)<br>
at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624)<br>
at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)<br>
at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1434)<br>
at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)<br>
at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:501)<br>
at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594)<br>
at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)<br>
at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1349)<br>
at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)<br>
at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234)<br>
at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)<br>
at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)<br>
at org.eclipse.jetty.server.Server.handle(Server.java:516)<br>
at org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:400)<br>
at org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:645)<br>
at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:392)<br>
at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277)<br>
at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311)<br>
at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)<br>
at org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104)<br>
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338)<br>
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315)<br>
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173)<br>
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)<br>
at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409)<br>
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:883)<br>
at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1034)<br>
at java.base/java.lang.Thread.run(Unknown Source)**</p>



<a name="272962128"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/272962128" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#272962128">(Feb 23 2022 at 15:16)</a>:</h4>
<p>Is there somewhere that you have the IG content posted so I can try to reproduce this?</p>



<a name="272966787"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/272966787" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abdelali Boussadi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#272966787">(Feb 23 2022 at 15:47)</a>:</h4>
<p>Unfortunately not yet, however, I moved to an other issue since this post. I used the function called </p>
<p>"Is Opioid Analgesic with Ambulatory Misuse Potential" from this library </p>
<p><a href="https://build.fhir.org/ig/cqframework/opioid-cds-r4/Library-library-OpioidCDSCommon.html">https://build.fhir.org/ig/cqframework/opioid-cds-r4/Library-library-OpioidCDSCommon.html</a>  in my CQL code. </p>
<p>On Atom the code is showing no error but the Publisher displays this error and refuse to translate the CQL code </p>
<p>ERROR: epidiolexCommon: Could not resolve call to operator AnyInValueSet with signature (list&lt;FHIR.code&gt;,System.ValueSet).</p>
<p>below my CQL library</p>
<p>library epidiolexCommon version '1.0.0'<br>
using FHIR version '4.0.1'<br>
include "FHIRHelpers" version '4.0.1' called FHIRHelpers<br>
codesystem RXNORM: '2.16.840.1.113883.6.88'<br>
valueset "SAM medication codes": '<a href="https://smt.esante.gouv.fr/fhir/ValueSet/epidyolex01pharmacist-sam-ig">https://smt.esante.gouv.fr/fhir/ValueSet/epidyolex01pharmacist-sam-ig</a>'<br>
//code "Epidiolex code": '197685' from RXNORM display 'etodolac 300 MG'</p>
<p>define function "Is Epidiolex ?"(value List&lt;MedicationRequest&gt;):<br>
  value Rx<br>
    let MedRef: if (Rx.medication is FHIR.Reference) then (Rx.medication as FHIR.Reference).reference else null,<br>
      Med: if MedRef is null then (Rx.medication as FHIR.CodeableConcept).coding else SingletonFrom([Medication: id in (Last(Split(MedRef, '/')))] Med return Med.code.coding)<br>
    where Med.code in "SAM medication codes"</p>
<div class="codehilite"><pre><span></span><code>return
      MedicationRequest {
        id: Rx.id,
        status: Rx.status,
        intent: Rx.intent,
        category: Rx.category,
        medication: FHIR.CodeableConcept{ coding: Med },
        subject: Rx.subject,
        authoredOn: Rx.authoredOn,
        recorder: Rx.recorder,
        dosageInstruction: Rx.dosageInstruction,
        dispenseRequest: Rx.dispenseRequest
      }
</code></pre></div>



<a name="272971039"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/272971039" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#272971039">(Feb 23 2022 at 16:16)</a>:</h4>
<p>The publisher includes CQL translation, but uses an older version of the translator. If you use the _refresh script (in the <a href="https://github.com/cqframework/sample-content-ig">Sample Content IG</a>, it will use the latest translator. It adds a step to the build in that whenever you change the CQL, you need to run _refresh and then run _genonce to build the IG. You also have to turn off the binary adjunct file loading in the publisher (remove the path-binary parameter from the IG).</p>



<a name="272971125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/272971125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#272971125">(Feb 23 2022 at 16:16)</a>:</h4>
<p>We're working on an update to the publisher so that it will use the latest, but haven't gotten that submitted to the publisher yet.</p>



<a name="272971172"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/272971172" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#272971172">(Feb 23 2022 at 16:16)</a>:</h4>
<p>All that is to say that the error you're getting above is a known issue with the translator that has since been addressed.</p>



<a name="273060781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/273060781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abdelali Boussadi <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#273060781">(Feb 24 2022 at 08:43)</a>:</h4>
<p>Sorry Bryn, I didn't get your last point: "You also have to turn off the binary adjunct file loading in the publisher (remove the path-binary parameter from the IG)." ?</p>



<a name="273092245"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/273092245" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#273092245">(Feb 24 2022 at 13:59)</a>:</h4>
<p>The publisher uses the 'path-binary' parameter to find CQL files to translate, so you have to turn that off:<br>
<a href="https://github.com/cqframework/sample-content-ig/blob/master/input/mycontentig.xml#L119">https://github.com/cqframework/sample-content-ig/blob/master/input/mycontentig.xml#L119</a></p>



<a name="274092044"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Exception%20in%20CQL%20Execution%20over%20CQFRuler/near/274092044" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sukanta Barai <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Exception.20in.20CQL.20Execution.20over.20CQFRuler.html#274092044">(Mar 04 2022 at 07:51)</a>:</h4>
<p>Hi Team,<br>
Could you please let me know ,<br>
how can we create data model or customize schema like FHIR or QDM.<br>
So we can using customize schema instead of FHIR or QDM for CQL.<br>
Please provide me any example which will help me to create customise schema. Need your help. I am new in CQL.<br>
Also let me know the data format of FHIR and QDM.<br>
How does any customize data model like PHIR can read from CQL-ENGINE or CQL-Language-Server?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
