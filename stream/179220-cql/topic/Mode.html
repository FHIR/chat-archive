---
layout: page
title: "FHIR Chat  · Mode · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Mode.html">Mode</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153837085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Mode/near/153837085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erich Schulz <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Mode.html#153837085">(Jul 10 2016 at 09:03)</a>:</h4>
<p>bit worried about the "Mode" operation <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> - it is polymorphic in that it can return either a list or a single item... seems like a bit of an outlier...</p>



<a name="153837086"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Mode/near/153837086" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Erich Schulz <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Mode.html#153837086">(Jul 10 2016 at 09:04)</a>:</h4>
<p>ie this is my current implementation:</p>
<div class="codehilite"><pre>function mode(values, defaults) {                           
  if (!values.length) return null                           
  var clusterFunction = function(a) { return a.toString() } 
  var max = 0, mode = []                                    
  var counted = _.countBy(values, clusterFunction)          
  max = _.max(_.values(counted))                            
  _.forIn(counted, function(v,k) {                          
    if (v === max) mode.push(parseFloat(k))                 
  })                                                        
  formalise(mode, defaults) // add in type etc              
  var res = mode.length &gt; 1                                 
    ? {value: mode, type: &#39;List&#39;}                           
    : mode[0]                                               
  return res                                                
}                                                           
</pre></div>



<a name="153837492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Mode/near/153837492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Mode.html#153837492">(Jul 12 2016 at 04:08)</a>:</h4>
<p>Yeah, that's a good question. I would tend to argue that it should be the same return type, always returning a list of elements, even if there is only a single result. That's a change to the spec though, the spec actually defines it as returning a single value, and the behavior for ties is unspecified. That should be made explicit in the spec. Do you mind submitting a comment and we can discuss it on the next CDS WG call?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
