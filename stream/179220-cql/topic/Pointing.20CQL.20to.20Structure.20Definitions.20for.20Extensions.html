---
layout: page
title: "FHIR Chat  · Pointing CQL to Structure Definitions for Extensions · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Pointing.20CQL.20to.20Structure.20Definitions.20for.20Extensions.html">Pointing CQL to Structure Definitions for Extensions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="233303740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Pointing%20CQL%20to%20Structure%20Definitions%20for%20Extensions/near/233303740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Amlung <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Pointing.20CQL.20to.20Structure.20Definitions.20for.20Extensions.html#233303740">(Apr 06 2021 at 11:40)</a>:</h4>
<p>Hi all, I'm new to the chat but just getting started with CQL and could use a little help. I'm working with a <a href="https://build.fhir.org/ig/jamlung-ri/PEPFAR-WHO-Simple-HIV/branches/main/index.html">basic custom FHIR IG</a> that I generated for this work. I am wondering how I can incorporate the <a href="https://build.fhir.org/ig/jamlung-ri/PEPFAR-WHO-Simple-HIV/branches/main/artifacts.html#2">Extension Definitions</a> that I made into the <a href="https://github.com/jamlung-ri/PEPFAR-WHO-Simple-HIV/blob/main/cql/HIV_Indicator_AV3.cql">CQL language</a> that I started. How can I point my CQL to pull from a particular Structure Definition (e.g. estimatedAge in the linked CQL above)?</p>



<a name="233320598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Pointing%20CQL%20to%20Structure%20Definitions%20for%20Extensions/near/233320598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Pointing.20CQL.20to.20Structure.20Definitions.20for.20Extensions.html#233320598">(Apr 06 2021 at 13:43)</a>:</h4>
<p>There is in-progress tooling <a href="https://github.com/cqframework/cqf-tooling/blob/master/src/main/java/org/opencds/cqf/tooling/modelinfo/StructureDefinitionToModelInfo.java#L42">here</a> to generate ModelInfo from structure definitions. Once the ModelInfo is generated, it can be referenced from your CQL with a <code>using</code> declaration. The ModelInfo will have first-class elements for extensions and slices defined in the profiles.</p>



<a name="233321383"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Pointing%20CQL%20to%20Structure%20Definitions%20for%20Extensions/near/233321383" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Pointing.20CQL.20to.20Structure.20Definitions.20for.20Extensions.html#233321383">(Apr 06 2021 at 13:48)</a>:</h4>
<p>In lieu of that, you can access extensions directly in the CQL using functions like this:</p>
<div class="codehilite"><pre><span></span><code>/*
@description: Returns any US Core extensions defined on the given resource with the specified id.
@comment: NOTE: Extensions are not the preferred approach, but are used as a way to access
content that is defined by extensions but not yet surfaced in the CQL model info.
*/
define function USExtensions(domainResource DomainResource, id String):
  domainResource.extension E
      where E.url = (&#39;http://hl7.org/fhir/us/core/StructureDefinition/&#39; + id)
        return E

/*
@description: Returns the single US Core extension (if present) on the given resource with the specified id.
@comment: This function uses singleton from to ensure that a run-time exception is thrown if there
is more than one extension on the given resource with the specified url.
*/
define function USExtension(domainResource DomainResource, id String):
  singleton from USExtensions(domainResource, id)
</code></pre></div>



<a name="233321495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Pointing%20CQL%20to%20Structure%20Definitions%20for%20Extensions/near/233321495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Pointing.20CQL.20to.20Structure.20Definitions.20for.20Extensions.html#233321495">(Apr 06 2021 at 13:49)</a>:</h4>
<p>You could also follow that same pattern and write functions to expose specific extensions.</p>



<a name="233531199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Pointing%20CQL%20to%20Structure%20Definitions%20for%20Extensions/near/233531199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Amlung <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Pointing.20CQL.20to.20Structure.20Definitions.20for.20Extensions.html#233531199">(Apr 07 2021 at 17:37)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> ! Are there any CQL examples that use these functions in the code you pasted? I think this method should work, but an example should help me get the syntax right.</p>



<a name="233541759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Pointing%20CQL%20to%20Structure%20Definitions%20for%20Extensions/near/233541759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Amlung <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Pointing.20CQL.20to.20Structure.20Definitions.20for.20Extensions.html#233541759">(Apr 07 2021 at 18:48)</a>:</h4>
<p>Actually, <span class="user-mention" data-user-id="194192">@Richard Stanley</span> pointed me to a CQF Exercise that helped me: <a href="https://github.com/cqframework/cqf-exercises/blob/master/input/cql/Exercises09Key.cql">https://github.com/cqframework/cqf-exercises/blob/master/input/cql/Exercises09Key.cql</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
