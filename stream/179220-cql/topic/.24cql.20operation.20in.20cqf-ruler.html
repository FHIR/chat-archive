---
layout: page
title: "FHIR Chat  · $cql operation in cqf-ruler · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.24cql.20operation.20in.20cqf-ruler.html">$cql operation in cqf-ruler</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="189752924"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%24cql%20operation%20in%20cqf-ruler/near/189752924" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffrey Taylor <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.24cql.20operation.20in.20cqf-ruler.html#189752924">(Mar 05 2020 at 01:19)</a>:</h4>
<p>I've been experimenting with the proposed <code>$cql</code> operation that is implemented in the cqf-ruler.</p>
<p>I'm trying to do a simple test query to query for all the male patients in the server. I'm issuing a <code>POST</code> to <code>http://cqm-sandbox.alphora.com/cqf-ruler-dstu3/fhir/$cql</code> with the following body</p>
<div class="codehilite"><pre><span></span>{
&quot;resourceType&quot;: &quot;Parameters&quot;,
&quot;parameter&quot;: [
        {
            &quot;name&quot;: &quot;code&quot;,
            &quot;valueString&quot;: &quot;using FHIR version &#39;3.0.0&#39; context Patient define IsMale: Patient.gender.value = &#39;male&#39;&quot;
        },
        {
            &quot;name&quot;: &quot;context&quot;,
            &quot;valueString&quot;: &quot;Population&quot;
        }
    ]
}
</pre></div>


<p>I think i expect some sort of Bundle or Array of patients back. I can't seem to get any meaningful response back. Am i doing something technically wrong, or are my expectations wrong?</p>



<a name="189821350"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%24cql%20operation%20in%20cqf-ruler/near/189821350" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Schuler <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.24cql.20operation.20in.20cqf-ruler.html#189821350">(Mar 05 2020 at 18:24)</a>:</h4>
<p>Try:</p>
<p>using FHIR version '3.0.0' <br>
context Population <br>
define IsMale: [Patient] P where P.gender.value = 'male'</p>



<a name="189823590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%24cql%20operation%20in%20cqf-ruler/near/189823590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffrey Taylor <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.24cql.20operation.20in.20cqf-ruler.html#189823590">(Mar 05 2020 at 18:47)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191897">@Christopher Schuler</span>  that worked! The patients that match the criteria came back as expected.</p>
<p>Out of curiosity, an unexpected thing happened however (probably another of my syntax errors?). The return bundle includes an error, seemingly about my <code>context?</code>. See below. What is causing this?</p>
<div class="codehilite"><pre><span></span>{
  &quot;resourceType&quot;: &quot;Bundle&quot;,
  &quot;type&quot;: &quot;collection&quot;,
  &quot;entry&quot;: [
    {
      &quot;fullUrl&quot;: &quot;Patient&quot;,
      &quot;resource&quot;: {
        &quot;resourceType&quot;: &quot;Parameters&quot;,
        &quot;id&quot;: &quot;Patient&quot;,
        &quot;parameter&quot;: [
          {
            &quot;name&quot;: &quot;location&quot;,
            &quot;valueString&quot;: &quot;[1:28]&quot;
          },
          {
            &quot;name&quot;: &quot;error&quot;,
            &quot;valueString&quot;: &quot;Expected a list with at most one element, but found a list with multiple elements.&quot;
          }
        ]
      }
    },
    {
      &quot;fullUrl&quot;: &quot;IsMale&quot;,
      &quot;resource&quot;: {
        &quot;resourceType&quot;: &quot;Parameters&quot;,
        &quot;id&quot;: &quot;IsMale&quot;,
        &quot;parameter&quot;: [
          {
            &quot;name&quot;: &quot;location&quot;,
            &quot;valueString&quot;: &quot;[1:47]&quot;
          },
          {
            &quot;name&quot;: &quot;value&quot;,
            &quot;resource&quot;: {
              &quot;resourceType&quot;: &quot;Bundle&quot;,
              &quot;type&quot;: &quot;collection&quot;,
              &quot;entry&quot;: [ ALL PATIENTS IN THIS ARRAY AS EXPECTED ]
</pre></div>



<a name="189824646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%24cql%20operation%20in%20cqf-ruler/near/189824646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Schuler <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.24cql.20operation.20in.20cqf-ruler.html#189824646">(Mar 05 2020 at 18:59)</a>:</h4>
<p>Hmm. Not sure. I will look into that and get back to you. Thanks!</p>



<a name="189825175"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/%24cql%20operation%20in%20cqf-ruler/near/189825175" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffrey Taylor <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/.24cql.20operation.20in.20cqf-ruler.html#189825175">(Mar 05 2020 at 19:04)</a>:</h4>
<p>I did some digging, it looks like it may be the same error reported here: <a href="https://github.com/DBCG/cql_runner/issues/32" target="_blank" title="https://github.com/DBCG/cql_runner/issues/32">https://github.com/DBCG/cql_runner/issues/32</a>. If so, that's helpful to know (maybe it's not with cql input, but something underlying in the execution engine - to be fixed for others to benefit.). I'll dive in and take a look too.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
