---
layout: page
title: "FHIR Chat  · FSH and CQF Tooling · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html">FSH and CQF Tooling</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="251245721"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FSH%20and%20CQF%20Tooling/near/251245721" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html#251245721">(Aug 30 2021 at 15:21)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="194178">@JP</span> Per our conversation earlier, I'm trying to make the CQFTooling work with FSH. Here are (roughly) the steps I'm following to use CQFTooling with FSH.</p>
<ul>
<li>copy in the _refresh and _updateCQFTooling scripts to the IG.</li>
<li>run _update <code>bash _updateCQFTooling.sh</code></li>
<li>change the vars in refresh script:</li>
</ul>
<div class="codehilite"><pre><span></span><code># resources_path=$PWD/input/resources
resources_path=$PWD/fsh-generated/resources
# ig_resource_path=./input/anc-cds.xml
ig_resource_path=./fsh-generated/resources/ImplementationGuide-simple.hiv.ig.json
</code></pre></div>
<p>FYI, FHIR Helpers, Common and Model-Info are all in CQL format.</p>
<p>Process:</p>
<ul>
<li>run sushi</li>
<li>try refresh...</li>
</ul>
<div class="codehilite"><pre><span></span><code>&lt;output of _refresh&gt;
No paths found for the Directory /Users/richard/src/github.com/intrahealth/simple-hiv-ig/input/tests/measure/KitchenSink:
java.lang.NullPointerException
    at java.base/java.util.Objects.requireNonNull(Objects.java:208)
    at java.base/sun.nio.fs.UnixFileSystem.getPath(UnixFileSystem.java:260)
    at java.base/java.nio.file.Path.of(Path.java:147)
    at java.base/java.nio.file.Paths.get(Paths.java:69)
    at org.opencds.cqf.tooling.utilities.IOUtils.copyFile(IOUtils.java:164)
    at org.opencds.cqf.tooling.measure.MeasureProcessor.bundleFiles(MeasureProcessor.java:193)
    at org.opencds.cqf.tooling.measure.MeasureProcessor.bundleMeasures(MeasureProcessor.java:142)
    at org.opencds.cqf.tooling.processor.IGBundleProcessor.bundleIg(IGBundleProcessor.java:25)
    at org.opencds.cqf.tooling.processor.IGProcessor.publishIG(IGProcessor.java:79)
    at org.opencds.cqf.tooling.operation.RefreshIGOperation.execute(RefreshIGOperation.java:34)
    at org.opencds.cqf.tooling.Main.main(Main.java:208)
</code></pre></div>
<p>The tooling seems to expect some stuff in resources/tests/measure/MeasureName whereas the Atom plugin is fine with tests/MeasureName</p>



<a name="251247240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FSH%20and%20CQF%20Tooling/near/251247240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html#251247240">(Aug 30 2021 at 15:31)</a>:</h4>
<p>If I put copy tests over into a measure/ dir, then the next error is that it cant find FHIR Helpers.</p>
<div class="codehilite"><pre><span></span><code>java.lang.RuntimeException: /Users/richard/src/github.com/intrahealth/simple-hiv-ig/fsh-generated/resources/FHIRHelpers.json (No such file or directory)
    at org.opencds.cqf.tooling.utilities.IOUtils.readResource(IOUtils.java:240)
    at org.opencds.cqf.tooling.utilities.IOUtils.readResource(IOUtils.java:203)
    at org.opencds.cqf.tooling.utilities.ResourceUtils.getR4DepLibraryResources(ResourceUtils.java:219)
    at org.opencds.cqf.tooling.utilities.ResourceUtils.getDepLibraryResources(ResourceUtils.java:136)
    at org.opencds.cqf.tooling.library.LibraryProcessor.bundleLibraryDependencies(LibraryProcessor.java:67)
    at org.opencds.cqf.tooling.measure.MeasureProcessor.bundleMeasures(MeasureProcessor.java:124)
    at org.opencds.cqf.tooling.processor.IGBundleProcessor.bundleIg(IGBundleProcessor.java:25)
    at org.opencds.cqf.tooling.processor.IGProcessor.publishIG(IGProcessor.java:79)
    at org.opencds.cqf.tooling.operation.RefreshIGOperation.execute(RefreshIGOperation.java:34)
    at org.opencds.cqf.tooling.Main.main(Main.java:208)
11:30:15.713 [main] WARN  o.o.cqf.tooling.utilities.LogUtils - Measure will not be bundled because Library Dependency bundling failed.
</code></pre></div>



<a name="251247387"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FSH%20and%20CQF%20Tooling/near/251247387" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html#251247387">(Aug 30 2021 at 15:32)</a>:</h4>
<p>This is because FSH prefixes files with their resource, type, ie. <code>Library-FHIRHelpers</code></p>



<a name="258627718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FSH%20and%20CQF%20Tooling/near/258627718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html#258627718">(Oct 21 2021 at 22:31)</a>:</h4>
<p><span class="user-mention" data-user-id="195840">@David Winters</span> put together something pretty cool here using FSH to make PlanDefinitions and ActivityDefinitions for this Cervical Cancer CDS use case: <a href="https://github.com/ccsm-cds-tools/ccsm-cds-with-tests">https://github.com/ccsm-cds-tools/ccsm-cds-with-tests</a></p>
<p>It would be neat to turn this into a template for making CPGs. Right now I feel like the CQF-tooling does making spreadsheets and CQL into CPGs, but making PlanDefinitions and ActivityDefinitions requires a lot of manual work, which can be handled more easily by FSH. It would be great to get this on the CQF Github, once the templates are made</p>



<a name="258706469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FSH%20and%20CQF%20Tooling/near/258706469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Winters <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html#258706469">(Oct 22 2021 at 12:48)</a>:</h4>
<p>I think this is a great idea and it isn't something that occurred to <span class="user-mention" data-user-id="324272">@Michael O'Hanlon</span> and I when we started <a href="https://github.com/ccsm-cds-tools">ccsm-cds-with-tests</a>.  If there was a community template for making CPGs with FSH we would transition over to using it.</p>



<a name="258709378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FSH%20and%20CQF%20Tooling/near/258709378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html#258709378">(Oct 22 2021 at 13:12)</a>:</h4>
<p>I think CCSM is a good place to start making the template. Take a PD and an AD then strip out the CCSM stuff.</p>



<a name="258709420"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FSH%20and%20CQF%20Tooling/near/258709420" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html#258709420">(Oct 22 2021 at 13:13)</a>:</h4>
<p>The more challenging part is what <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  pointed out with the CQF-Tooling/publisher needing updates to accomodate FSH</p>



<a name="258711674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/FSH%20and%20CQF%20Tooling/near/258711674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/FSH.20and.20CQF.20Tooling.html#258711674">(Oct 22 2021 at 13:31)</a>:</h4>
<p>FWIW, my method to doing FSH-&gt;CQL right now is:</p>
<div class="codehilite"><pre><span></span><code># remove these from a previous run or you&#39;ll get a dupe error
# the rm -rf approach is a bit harsh, check your IG to make sure you don&#39;t have ones that FSH doesn&#39;t generate
rm -rf input/resources/Library-* input/resources/library-*
# sushi as usual but with FSHOnly: true
sushi
mv fsh-generated/resources/Library-* input/resources/
# now use the cqf tooling script
bash _refresh.sh
bash _genonce.sh -no-sushi
</code></pre></div>
<p>The only limitation is that the publisher needs to use the XML template for IGs (input/my-ig.xml), meaning that Sushi can't be used for creating the IG. Or, at least I couldn't make it work. IIRC, the issue is that you need Publisher to use sushi or it can't find all of the IG resources.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
