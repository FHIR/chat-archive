---
layout: page
title: "FHIR Chat  · Debug and coverage output · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Debug.20and.20coverage.20output.html">Debug and coverage output</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="203229591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Debug%20and%20coverage%20output/near/203229591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Debug.20and.20coverage.20output.html#203229591">(Jul 08 2020 at 04:11)</a>:</h4>
<p><a href="http://jira.hl7.org/browse/FHIR-27474">J#27474</a> suggests that we consider defining debug and coverage output annotations for CQL. Debug output has been added to the Java reference implementation here: <a href="https://github.com/DBCG/cql_engine/tree/master/engine/src/main/java/org/opencds/cqf/cql/engine/debug">https://github.com/DBCG/cql_engine/tree/master/engine/src/main/java/org/opencds/cqf/cql/engine/debug</a>, and I know that there is something similar in the JavaScript engine to support the coverage feature in Bonnie. Should we consider something along these lines as the starting point here? <span class="user-mention" data-user-id="191469">@Chris Moesel</span> <span class="user-mention" data-user-id="197045">@Sam Sayer</span></p>



<a name="203260844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Debug%20and%20coverage%20output/near/203260844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sayer <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Debug.20and.20coverage.20output.html#203260844">(Jul 08 2020 at 12:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> can you share a sample of the coverage from the Java engine?</p>



<a name="203261199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Debug%20and%20coverage%20output/near/203261199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Debug.20and.20coverage.20output.html#203261199">(Jul 08 2020 at 12:30)</a>:</h4>
<p>I didn't work closely with this part of the JS engine, but I think the general approach is that the JS engine stores values of each expression, using the expression's localId.  When a run is completed, you know which expressions were executed and which ones weren't (because the ones that weren't don't have an entry in the localId map of results).  Bonnie also wanted to keep track of the individual results which added some complication for queries since query logic loops on each item in the source.  I don't remember exactly how that was resolved...</p>



<a name="203331563"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Debug%20and%20coverage%20output/near/203331563" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Debug.20and.20coverage.20output.html#203331563">(Jul 08 2020 at 22:28)</a>:</h4>
<p>I don't have a serialization of the results yet, just the structures as defined at that link, but conceptually, it sounds like it's doing the same thing that Chris described, saving the value for each node that is visited (well, values, in the case that the node is visited multiple times).</p>



<a name="203385285"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Debug%20and%20coverage%20output/near/203385285" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sam Sayer <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Debug.20and.20coverage.20output.html#203385285">(Jul 09 2020 at 13:32)</a>:</h4>
<p>I think the JS engine doesn't currently hold multiple values, it can only say whether or not the node was hit. I believe that was one of the improvements we wanted to make with the move to FHIR. <span class="user-mention" data-user-id="254422">@Chris Hossenlopp</span> has the most JS engine experience so he can confirm/deny what I said.</p>



<a name="203386448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Debug%20and%20coverage%20output/near/203386448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Hossenlopp <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Debug.20and.20coverage.20output.html#203386448">(Jul 09 2020 at 13:44)</a>:</h4>
<p>The JS engine results currently have the first "truthy" value or last "falsey" for each localId. "truthy" meaning non-empty list, not null, or true.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
