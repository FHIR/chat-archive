---
layout: page
title: "FHIR Chat  · Generate a FHIR bundle · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html">Generate a FHIR bundle</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="190569738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/190569738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Pfeffer <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#190569738">(Mar 14 2020 at 00:23)</a>:</h4>
<p>Has anyone written a CQL pattern for generating a FHIR bundle that you can share?</p>



<a name="190792516"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/190792516" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#190792516">(Mar 16 2020 at 23:26)</a>:</h4>
<p>So, since the FHIR 4.0.0 model info was generated from the XSD FHIR schema, it actually uses the "ResourceContainer" type whereever a "Resource" appears inline in the spec. So that means you need to process each type independently, and it ends up being a bit... verbose:</p>
<div class="codehilite"><pre><span></span>define function Bundle(Resources List&lt;Resource&gt;):
  Bundle {
    entry:
      Resources R
        return FHIR.Bundle.Entry {
          resource: ResourceContainer(R)
        }
  }

define function ResourceContainer(Resource Resource):
  ResourceContainer {
    AdverseEvent: Resource as AdverseEvent,
    AllergyIntolerance: Resource as AllergyIntolerance,
    Appointment: Resource as Appointment,
    ...
  }
</pre></div>


<p>In the soon to be published 4.0.1 modelinfo, you can actually just say:</p>
<div class="codehilite"><pre><span></span>define function Bundle(Resources List&lt;Resource&gt;):
  Bundle {
    entry:
      Resources R
        return FHIR.Bundle.Entry {
          resource: R
        }
  }
</pre></div>


<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span>, this turns out to be at least one concrete difference between the 4.0.0 and 4.0.1 model infos, directly resulting from the different toolchains used to create them.</p>



<a name="190839269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/190839269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#190839269">(Mar 17 2020 at 12:23)</a>:</h4>
<p>Thanks for the heads up, <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>.  Now we know that the CQL FHIR 4.0.0 model is <em>not</em> compatible w/ the CQL FHIR 4.0.1 model -- so runtimes will need to support them independently (i.e., you can't use a FHIR 4.0.0 model provider w/ a FHIR 4.0.1 CQL library).  That's definitely a good thing to know!  And... it looks like the difference is an <em>improvement</em>, so that's good to see!</p>



<a name="191024214"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/191024214" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Pfeffer <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#191024214">(Mar 18 2020 at 18:39)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> Thank you!</p>



<a name="191065604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/191065604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Afaq Khan <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#191065604">(Mar 19 2020 at 02:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> Thanks for explaining!</p>



<a name="191204284"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/191204284" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Pfeffer <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#191204284">(Mar 20 2020 at 05:33)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> Is there any way to do this in FHIR 3, as well?</p>



<a name="191297273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/191297273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#191297273">(Mar 20 2020 at 20:21)</a>:</h4>
<p>Yes, the same pattern should work, FHIR '3.0.0' has a ResourceContainer, but FHIR '3.0.1' does not.</p>



<a name="245441850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245441850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245441850">(Jul 09 2021 at 13:18)</a>:</h4>
<p>We've been using the CQF-Tooling to generate FHIR bundles from CQL files (PlanDefinition, Library, ValueSets), but we were wondering where in the CQF-Tooling code we could find the function that generates the PlanDefinition. It seems like one is generated when we run the refresh script in an IG, but we want to try to do this outside of an IG. Can someone point us at the right file or set of files in the CQF-Tooling? <a href="https://github.com/cqframework/cqf-tooling">https://github.com/cqframework/cqf-tooling</a> <span class="user-mention" data-user-id="416084">@Paul Puscas</span></p>



<a name="245610448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245610448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245610448">(Jul 11 2021 at 14:48)</a>:</h4>
<p><span class="user-mention" data-user-id="192545">@Alex Goel</span>   </p>
<p>Each resource type that gets refreshed has a FHIR specific Refresh Operation that defaults to the location of the respective resources in an IG, like this: <a href="https://github.com/cqframework/cqf-tooling/blob/a45090374b140e01cbf96143a92279da48b7cc72/src/main/java/org/opencds/cqf/tooling/measure/r4/RefreshR4MeasureOperation.java#L26">https://github.com/cqframework/cqf-tooling/blob/a45090374b140e01cbf96143a92279da48b7cc72/src/main/java/org/opencds/cqf/tooling/measure/r4/RefreshR4MeasureOperation.java#L26</a>.</p>
<p>But I believe for each Resource you can override the default path with a command line argument, like this: <a href="https://github.com/cqframework/cqf-tooling/blob/a45090374b140e01cbf96143a92279da48b7cc72/src/main/java/org/opencds/cqf/tooling/operation/RefreshGeneratedContentOperation.java#L48">https://github.com/cqframework/cqf-tooling/blob/a45090374b140e01cbf96143a92279da48b7cc72/src/main/java/org/opencds/cqf/tooling/operation/RefreshGeneratedContentOperation.java#L48</a>.</p>
<p>So I think you just need to use the arguments for your respective Resources.</p>



<a name="245690618"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245690618" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245690618">(Jul 12 2021 at 14:07)</a>:</h4>
<p><span class="user-mention" data-user-id="217210">@Rob Reynolds</span> Thanks Rob! I see the Measure and Library functions, but not the PlanDefinition functions, but the refresh does both Measures and PlanDefinitions? We think it's this: <a href="https://github.com/cqframework/cqf-tooling/blob/a45090374b140e01cbf96143a92279da48b7cc72/src/main/java/org/opencds/cqf/tooling/operation/RefreshIGOperation.java">https://github.com/cqframework/cqf-tooling/blob/a45090374b140e01cbf96143a92279da48b7cc72/src/main/java/org/opencds/cqf/tooling/operation/RefreshIGOperation.java</a></p>



<a name="245690835"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245690835" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245690835">(Jul 12 2021 at 14:09)</a>:</h4>
<p>And this: <a href="https://github.com/cqframework/cqf-tooling/blob/a45090374b140e01cbf96143a92279da48b7cc72/src/main/java/org/opencds/cqf/tooling/processor/PlanDefinitionProcessor.java">https://github.com/cqframework/cqf-tooling/blob/a45090374b140e01cbf96143a92279da48b7cc72/src/main/java/org/opencds/cqf/tooling/processor/PlanDefinitionProcessor.java</a></p>



<a name="245836664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245836664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245836664">(Jul 13 2021 at 14:54)</a>:</h4>
<p><span class="user-mention" data-user-id="217210">@Rob Reynolds</span> I spoke too soon! These seem to refresh the PlanDefinitions, but is there a way to automatically build them from the CQL, like the Measures? We were expecting to find a file structure similar to Measures in the CQF-Tooling</p>



<a name="245873322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245873322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245873322">(Jul 13 2021 at 19:14)</a>:</h4>
<p><span class="user-mention" data-user-id="192545">@Alex Goel</span> - <code>PlanDefinition</code> is a bit more open-ended than <code>Measure</code> in that it can represent a wider variety of clinical logic such as arbitrary treatment workflows, cds services, etc. So whereas it's relatively straightforward to generate some types of <code>Measure</code> resources from CQL it's not possible to do that for <code>PlanDefinition</code> in a general way. When the cqf-tooling "refreshes" a <code>PlanDefinition</code> resource it merely fills out some meta-data based on whatever <code>Library</code> or CQL is referenced.</p>



<a name="245873504"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245873504" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245873504">(Jul 13 2021 at 19:16)</a>:</h4>
<p>IOW, it's expected that the <code>PlanDefinition</code> skeleton and logic would be authored "some other way" and then the tooling takes it from there to ease manual maintenance of things like relatedArtifacts.</p>



<a name="245874587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245874587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Goel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245874587">(Jul 13 2021 at 19:24)</a>:</h4>
<p>Got it! Thanks <span class="user-mention" data-user-id="194178">@JP</span></p>



<a name="245988216"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Generate%20a%20FHIR%20bundle/near/245988216" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Generate.20a.20FHIR.20bundle.html#245988216">(Jul 14 2021 at 16:58)</a>:</h4>
<p><span class="user-mention" data-user-id="192545">@Alex Goel</span>  What <span class="user-mention" data-user-id="194178">@JP</span> said.  <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
