---
layout: page
title: "FHIR Chat  · CQF Ruler - /$cql · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html">CQF Ruler - /$cql</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="276939061"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/276939061" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Montavon <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#276939061">(Mar 28 2022 at 22:34)</a>:</h4>
<p>I am trying to execute CQL using the CQF Ruler and the Swagger UI. The response that I am getting back is not what I am expecting. </p>
<p>I am successfully posting to /$cql:<br>
curl -X 'POST' \<br>
  '<a href="http://localhost:8080/fhir/$cql">http://localhost:8080/fhir/$cql</a>' \<br>
  -H 'accept: application/fhir+json' \<br>
  -H 'Content-Type: application/fhir+json' \<br>
  -d '{"resourceType":"Parameters","parameter":[{"name":"code","valueString":"define \"Inequality Expression\":\n  4 != 5"}]}'</p>
<p>The response status is 200 and the headers look good:<br>
connection: keep-alive <br>
 content-encoding: gzip <br>
 content-type: application/fhir+json;charset=UTF-8 <br>
 date: Mon,28 Mar 2022 22:06:21 GMT <br>
 keep-alive: timeout=60 <br>
 transfer-encoding: chunked <br>
 x-powered-by: HAPI FHIR 5.5.3 REST Server (FHIR Server; FHIR 4.0.1/R4) <br>
 x-request-id: Fw0yTyFbFncZIipZ </p>
<p>But, I am getting a response body that looks like this: <br>
{<br>
  "resourceType": "Parameters",<br>
  "parameter": [<br>
    {<br>
      "name": "value",<br>
      "valueString": "null"<br>
    },<br>
    {<br>
      "name": "resultType",<br>
      "valueString": "Null"<br>
    }<br>
  ]<br>
}</p>
<p>How do I get the result of the executed CQL? Any help would be greatly appreciated!</p>



<a name="276944166"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/276944166" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#276944166">(Mar 28 2022 at 23:54)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="440004">@Joel Montavon</span> , the $cql operation lets you evaluate expressions of CQL, but the text you're providing is actually a declaration statement: <code>define InequalityExpression: 4 != 5</code>. The expression is just <code>4 != 5</code>. Also, the parameter is named <code>expression</code>, but it looks like you have <code>code</code> as the parameter name?</p>



<a name="276944215"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/276944215" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#276944215">(Mar 28 2022 at 23:55)</a>:</h4>
<p>It's definitely not a very helpful response, you really should be getting an error message about not providing the expected <code>expression</code> parameter.</p>



<a name="277021380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/277021380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Montavon <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#277021380">(Mar 29 2022 at 15:23)</a>:</h4>
<p>Thanks! I missed that. </p>
<p>I'm not a JAVA programmer and looking for a way to evaluate CQL code on the fly for a node.js program. The <a href="https://github.com/DBCG/cql_execution_service">cql_execution_service</a> is basically what I am looking for but has not been recently updated. Is the cql_execution_service not being maintained and the cqf-ruler is preferred going forward? I've also tried using the CQL-to-ELM translator to convert the CQL to ELM as JSON and then using <a href="https://github.com/cqframework/cql-execution">cql-execution</a> to evaluate. However, this requires writing the CQL and ELM to disk and is slow. I haven't tried this yet but, instead of using $cql, it looks like I could load the CQL code as a library or measure and $evaluate or $evaluate-measure. What is the best way to execute CQL on the fly?</p>



<a name="277033203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/277033203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Winters <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#277033203">(Mar 29 2022 at 16:41)</a>:</h4>
<p>You could take a look at <a href="https://github.com/asbi-cds-tools/cql-worker">cql-worker</a>, but this requires you to pre-translate your CQL to ELM since it uses the <a href="https://github.com/cqframework/cql-execution">cql-execution-engine</a>.  It can work either in the browser or node.</p>



<a name="277213510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/277213510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#277213510">(Mar 30 2022 at 22:58)</a>:</h4>
<p>Yes, the cql_execution_service hasn't been updated in a while, we've been focused on CQF Ruler support, which does have a $cql implementation, so that's been our preferred approach for ad-hoc execution.</p>



<a name="277369078"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/277369078" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Montavon <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#277369078">(Apr 01 2022 at 04:12)</a>:</h4>
<p>Thanks for the responses! Are there any examples showing what the request body should look like for creating a library or measure in the cqf-ruler (i.e., POST /library or POST /measure)? For example, if I wanted to create a library with a single definition like define InequalityExpression: 4 != 5. I can't seem to figure it out from the <a href="https://cloud.alphora.com/sandbox/r4/cqm/fhir/swagger-ui/?page=Library#/Library/post_Library">Swagger-UI</a> documentation or from the <a href="http://build.fhir.org/ig/HL7/cqf-recommendations/OperationDefinition-cpg-library-evaluate.html">CQF recommendations</a>.</p>



<a name="277415958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/277415958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Stevens <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#277415958">(Apr 01 2022 at 13:18)</a>:</h4>
<p>For putting CQL in a Library resource, you would just need to base64 encode your CQL and place it in <a href="http://Library.content.data">Library.content.data</a>, as well as include a Library.status (as per FHIR spec), as well as setting Library.content.contentType as text/cql (don't know if this is required to evaluate CQL, but we use it to differentiate Libraries and its what example Libraries have looked like). For example, here's the FHIR Helpers Library in JSON: <a href="https://www.hl7.org/fhir/library-fhir-helpers.json.html">https://www.hl7.org/fhir/library-fhir-helpers.json.html</a></p>



<a name="277418710"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF%20Ruler%20-%20/%24cql/near/277418710" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Corey Sanders <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF.20Ruler.20-.20.2F.24cql.html#277418710">(Apr 01 2022 at 13:36)</a>:</h4>
<p>To be clear, you don't need to put your CQL into a library resource to be able to execute it via the $cql operation in cqf-ruler. You certainly can and should if you have CQL that you are going to be executing repeatedly, but you also just pass in ad-hoc CQL and execute it without storing the code in a Library.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>curl --silent -k -X <span class="s1">'POST'</span> <span class="se">\</span>
<span class="s1">'https://cloud.alphora.com/sandbox/r4/cqm/fhir/$cql'</span> <span class="se">\</span>
-H <span class="s1">'accept: application/fhir+json'</span> <span class="se">\</span>
-H <span class="s1">'Content-Type: application/fhir+json'</span> <span class="se">\</span>
-d <span class="s1">'{"resourceType":"Parameters","parameter":[{"name":"expression","valueString":"4 != 5"}]}'</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>{
  &quot;resourceType&quot;: &quot;Parameters&quot;,
  &quot;parameter&quot;: [ {
    &quot;name&quot;: &quot;value&quot;,
    &quot;valueString&quot;: &quot;true&quot;
  }, {
    &quot;name&quot;: &quot;resultType&quot;,
    &quot;valueString&quot;: &quot;Boolean&quot;
  } ]
}
</code></pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
