---
layout: page
title: "FHIR Chat  · PlanDefinition-&gt;Action-&gt;Condition · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html">PlanDefinition-&gt;Action-&gt;Condition</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="240380310"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240380310" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240380310">(May 26 2021 at 19:45)</a>:</h4>
<p>I have a segment of a PlanDefinition that utilizes two subpopulations that looks like this: <br>
{<br>
    "title": "Use only if benefit outweighs risk and monitor patient ECG",<br>
    "description": "Increased risk of prolonged QTc likely",<br>
    "condition": [{<br>
        "kind": "applicability",<br>
        "expression": {<br>
            "language": "text/cql",<br>
            "expression": "There exists a medication statement with a code from Citaloprams whose value is greater than or equal to 60 mg/d OR There exists a medication request with a code from Citaloprams whose value is greater than or equal to 60 mg/d"<br>
        }<br>
    }, {<br>
        "kind": "applicability",<br>
        "expression": {<br>
            "language": "text/cql",<br>
            "expression": "There exists a medication statement with a code from QT Prolonging Agents OR There exists a medication request with a code from QT Prolonging Agents"<br>
        }<br>
    }],<br>
    "dynamicValue": [{<br>
        "path": "activity.extension",<br>
        "expression": {<br>
            "language": "text/cql",<br>
            "expression": "Indicator"<br>
        }<br>
    }],<br>
    "action": [{<br>
        "prefix": "Usually Avoid Combination"<br>
    }]<br>
}</p>
<p>My problem is that when I run this rule I get a card returned when each expression is true. My understanding was that if I have multiple conditions they are combined using AND semantics  so the overall condition is only true if both conditions are true. Therefore I should only have 1 card returned instead of two identical ones.</p>



<a name="240446201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240446201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Winters <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240446201">(May 27 2021 at 10:33)</a>:</h4>
<p>That's my understanding as well based upon the <a href="https://www.hl7.org/fhir/plandefinition-definitions.html#PlanDefinition.action.condition">comment on the condition element</a>.</p>



<a name="240446403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240446403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Winters <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240446403">(May 27 2021 at 10:35)</a>:</h4>
<p><span class="user-mention" data-user-id="196276">@Rich Boyce</span> I'm assuming you're using cqf-ruler?  Have you tried testing the CQL separately to ensure it's operating the way you expect it to?</p>



<a name="240452252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240452252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240452252">(May 27 2021 at 11:37)</a>:</h4>
<p>I am using the cqf-ruler. I have tested portions of the CQL and it seems to work appropriately, however when I string the entire thing together as in the section I shared, that is when I am experiencing odd behavior</p>



<a name="240461408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240461408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240461408">(May 27 2021 at 12:49)</a>:</h4>
<p>That is not expected behavior, especially if you’re getting duplicate cards from the same action. Is there a way we can repro?</p>



<a name="240463908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240463908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240463908">(May 27 2021 at 13:06)</a>:</h4>
<p>I can bundle the PlanDefinition, Library, CQL, ValueSets, and the patient-view request I am making if you would like. Currently I am testing this locally.</p>



<a name="240639133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240639133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240639133">(May 28 2021 at 17:54)</a>:</h4>
<p>I think the issue is in <a href="https://github.com/DBCG/org-opencds-cqf-cds/blob/master/src/main/java/org/opencds/cqf/cds/hooks/R4HookEvaluator.java">https://github.com/DBCG/org-opencds-cqf-cds/blob/master/src/main/java/org/opencds/cqf/cds/hooks/R4HookEvaluator.java</a>. It doesn't seem to me that the logic described in the HL7 documentation is met here. I think actionComponents should be a Set instead of a List and if conditionsMet is false then actionComponents should be cleared.</p>



<a name="240645644"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240645644" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240645644">(May 28 2021 at 18:46)</a>:</h4>
<p>Would you mind filing an issue on that github repo?</p>



<a name="240647377"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/PlanDefinition-%3EAction-%3ECondition/near/240647377" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/PlanDefinition-.3EAction-.3ECondition.html#240647377">(May 28 2021 at 19:03)</a>:</h4>
<p><span class="user-mention" data-user-id="194178">@JP</span> Will do</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
