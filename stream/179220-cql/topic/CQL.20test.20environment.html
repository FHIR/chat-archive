---
layout: page
title: "FHIR Chat  · CQL test environment · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html">CQL test environment</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="181686069"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/181686069" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#181686069">(Nov 22 2019 at 23:08)</a>:</h4>
<p>Is there somewhere an openly available CQL execution engine with a web user interface and an attached FHIR repository with a bit of play examples as content. This would make experimenting with CQL easier as one could just see to what self created queries evaluate to.</p>



<a name="181686449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/181686449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#181686449">(Nov 22 2019 at 23:15)</a>:</h4>
<p>Yes, we host a CQL Runner here: <a href="http://cql-runner.dataphoria.org" target="_blank" title="http://cql-runner.dataphoria.org">http://cql-runner.dataphoria.org</a></p>



<a name="181686516"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/181686516" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#181686516">(Nov 22 2019 at 23:16)</a>:</h4>
<p>You can configure the test server you want to run it against, but by default we have a simple sandbox up that it uses.</p>



<a name="181686534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/181686534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#181686534">(Nov 22 2019 at 23:16)</a>:</h4>
<p>No guarantees on availability there, but we try to keep it up and running and functional.</p>



<a name="181703851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/181703851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#181703851">(Nov 23 2019 at 07:08)</a>:</h4>
<p>ah, cool, thanks</p>



<a name="182101066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182101066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182101066">(Nov 28 2019 at 11:27)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="196537">@Georg Fette</span>. In the meantime, I have written a FHIR Server with integrated CQL engine which is called <a href="https://github.com/life-research/blaze" target="_blank" title="https://github.com/life-research/blaze">Blaze</a>. Since this week, I have also a web UI called <a href="https://github.com/samply/blaze-quality-reporting-ui" target="_blank" title="https://github.com/samply/blaze-quality-reporting-ui">Blaze Quality Reporting</a> with a Public Demo at <a href="https://blaze.life.uni-leipzig.de/quality-reporting" target="_blank" title="https://blaze.life.uni-leipzig.de/quality-reporting">https://blaze.life.uni-leipzig.de/quality-reporting</a>.</p>



<a name="182101465"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182101465" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182101465">(Nov 28 2019 at 11:34)</a>:</h4>
<p>ah, nice</p>



<a name="182101603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182101603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182101603">(Nov 28 2019 at 11:36)</a>:</h4>
<p>what interface does a working CQL engine have to expose, so that in one of those test environments the engine could be replaced by another engine, to compare their results and performances ?</p>



<a name="182101810"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182101810" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182101810">(Nov 28 2019 at 11:40)</a>:</h4>
<p>I implement <a href="https://www.hl7.org/fhir/clinicalreasoning-quality-reporting.html" target="_blank" title="https://www.hl7.org/fhir/clinicalreasoning-quality-reporting.html">https://www.hl7.org/fhir/clinicalreasoning-quality-reporting.html</a> and especially <a href="https://www.hl7.org/fhir/operation-measure-evaluate-measure.html" target="_blank" title="https://www.hl7.org/fhir/operation-measure-evaluate-measure.html">https://www.hl7.org/fhir/operation-measure-evaluate-measure.html</a>. There might be other ways to execute CQL over FHIR, but that's what I found.</p>



<a name="182102202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182102202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182102202">(Nov 28 2019 at 11:47)</a>:</h4>
<p>is the Blaze CQL engine hardwired with its FHIR server or can its FHIR server be exchanged ?</p>



<a name="182102583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182102583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182102583">(Nov 28 2019 at 11:54)</a>:</h4>
<p>It's not totally hardwired. I have different modules in the develop Branch. It's written in Clojure, so it is possible to use it from Java. One had to provide clear interfaces for retrieve and provide an object graph which can be navigated like I do it currently.</p>



<a name="182491534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182491534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182491534">(Dec 03 2019 at 20:26)</a>:</h4>
<p>The Java-based CQL engine defines interfaces for an engine DataProvider, though that's more about how the engine gets to the data, rather than how the environment would call CQL.</p>



<a name="182491606"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182491606" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182491606">(Dec 03 2019 at 20:27)</a>:</h4>
<p>The CQF Ruler defines a proposed $cql operation, but we don't have enough implementation experience with that yet to put it in a balloted spec. If there's interest in seeing that, we could add it to something like CPG-on-FHIR.</p>



<a name="182494677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182494677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182494677">(Dec 03 2019 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> Can you please point to the $cql operation?</p>



<a name="182511965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182511965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Schuler <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182511965">(Dec 04 2019 at 00:07)</a>:</h4>
<p><span class="user-mention" data-user-id="197470">@Alexander Kiel</span> You can find the operation here: <a href="https://github.com/DBCG/cqf-ruler/blob/master/dstu3/src/main/java/org/opencds/cqf/dstu3/providers/CqlExecutionProvider.java#L216" target="_blank" title="https://github.com/DBCG/cqf-ruler/blob/master/dstu3/src/main/java/org/opencds/cqf/dstu3/providers/CqlExecutionProvider.java#L216">https://github.com/DBCG/cqf-ruler/blob/master/dstu3/src/main/java/org/opencds/cqf/dstu3/providers/CqlExecutionProvider.java#L216</a></p>
<p>I don't believe that we any docs around the operation... You can call it using a POST request:<br>
POST {baseUrl}/$cql (e.g. <a href="http://localhost:8080/cqf-ruler-dstu3/fhir/$cql" target="_blank" title="http://localhost:8080/cqf-ruler-dstu3/fhir/$cql">http://localhost:8080/cqf-ruler-dstu3/fhir/$cql</a>)<br>
Body:<br>
{<br>
    "resourceType": "Parameters",<br>
    "parameter": [<br>
        {<br>
            "name": "code",<br>
            "valueString": "your cql code"<br>
        },<br>
        {<br>
            "name": "patientId",<br>
            "valueString": "the patient your evaluating the cql against"<br>
        },<br>
        {<br>
            "name": "periodStart",<br>
            "valueString": "if evaluating measure logic, this is the start of the measurement period"<br>
        },<br>
        {<br>
            "name": "periodEnd",<br>
            "valueString": "if evaluating measure logic, this is the end of the measurement period"<br>
        },<br>
        {<br>
            "name": "context",<br>
            "valueString": "the context of the library (i.e. Patient, Population, etc..."<br>
        }<br>
    ]<br>
}</p>
<p>That should get you going. We also enable more advanced settings like defining parameters and pointing to a specific terminology endpoint. I can expand on those if you're interested.</p>



<a name="182535066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182535066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182535066">(Dec 04 2019 at 08:29)</a>:</h4>
<p><span class="user-mention" data-user-id="191897">@Christopher Schuler</span> I see. That is similar of what <a href="http://cql-runner.dataphoria.org" target="_blank" title="http://cql-runner.dataphoria.org">http://cql-runner.dataphoria.org</a> expected of an API. It returns a Bundle with an entry for each expression definition as a Parameter s resource with name, location and result. With that you can basically execute what you want and get the results. I went away from <a href="http://cql-runner.dataphoria.org" target="_blank" title="http://cql-runner.dataphoria.org">http://cql-runner.dataphoria.org</a>  because the API it uses was not defined. Now if $cql is planned, I would be happy to discuss use cases.</p>
<p>In the meantime, we use $evaluate-measure. It fits you main use case, counting populations, well. But it has quite an overhead for our ad hoc queries, because we create a Library and Measure resource for each query.</p>
<p>On the other hand, we have use cases were $evaluate-measure is a better fit, because we have stable measures, which are called regularly. On top of that we need stratifiers which to my knowledge aren't possible to calculate with CQL only because it has no group by.</p>



<a name="182714778"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182714778" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182714778">(Dec 05 2019 at 23:14)</a>:</h4>
<p>It's true that CQL has no group by, but it does have aggregate functions, and with those, group by is just a shorthand. For example:</p>
<div class="codehilite"><pre><span></span>define GroupBy:
  ([Medication] M return M.code) MCode
    return { MCode, Count([Medication] M where M.code = MCode) }
</pre></div>



<a name="182739937"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182739937" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182739937">(Dec 06 2019 at 08:47)</a>:</h4>
<p>This is an interesting way of expressing a group by. Although it seems a bit hard to read when a construct like this is integrated in a larger statement. Can defines be called with parameters ? Then such definitions could be extracted from complicated statements where group bys are needed to make the code more readable.</p>



<a name="182741740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182741740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182741740">(Dec 06 2019 at 09:16)</a>:</h4>
<blockquote>
<p>Can defines be called with parameters ?</p>
</blockquote>
<p><span class="user-mention" data-user-id="196537">@Georg Fette</span> You can define functions.</p>



<a name="182742060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQL%20test%20environment/near/182742060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Georg Fette <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQL.20test.20environment.html#182742060">(Dec 06 2019 at 09:21)</a>:</h4>
<p>ah, nice, didn't know that yet</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
