---
layout: page
title: "FHIR Chat  · Utility to convert CQL to Library · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html">Utility to convert CQL to Library</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="224939342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/224939342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#224939342">(Feb 02 2021 at 21:28)</a>:</h4>
<p>Hi folks. Is there an existing utility that converts CQL to a Library resource (not the Base64 encoded bit), e.g. the required fields like relatedArtifact etc?</p>



<a name="224941571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/224941571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#224941571">(Feb 02 2021 at 21:45)</a>:</h4>
<p>Yes, the cqf-tooling is able to do that:</p>
<p><a href="https://github.com/cqframework/cqf-tooling/blob/master/src/main/java/org/opencds/cqf/tooling/Main.java#L45">https://github.com/cqframework/cqf-tooling/blob/master/src/main/java/org/opencds/cqf/tooling/Main.java#L45</a></p>



<a name="224949455"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/224949455" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#224949455">(Feb 02 2021 at 22:56)</a>:</h4>
<p>The publisher will also do it, with binary adjunct files: <a href="https://confluence.hl7.org/display/FHIR/Implementation+Guide+Parameters">https://confluence.hl7.org/display/FHIR/Implementation+Guide+Parameters</a></p>



<a name="224951936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/224951936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#224951936">(Feb 02 2021 at 23:23)</a>:</h4>
<p>And the publisher produces a very nice narrative for Library resources (hat tip <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> )</p>



<a name="224958015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/224958015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#224958015">(Feb 03 2021 at 00:30)</a>:</h4>
<p>Thanks, I'll have a look at the publisher! On the cqf-tooling, I see an error on the CQL path. This must be user error, but any hints?</p>
<div class="codehilite"><pre><span></span><code>$ ls /Users/richard/src/github.com/intrahealth/madx-hiv/input/pagecontent/cql/
total 8
drwxr-xr-x  3 richard  staff    96B Feb  2 19:21 .
drwxr-xr-x  3 richard  staff    96B Feb  2 19:21 ..
-rw-r--r--  1 richard  staff   217B Feb  2 19:21 DEMOG-0.0.1.cql
~/src/github.com/cqframework/cqf-tooling [master|✔]
$ java -jar /Users/richard/Downloads/tooling-1.3.0-jar-with-dependencies.jar -CqlToR4Library -ptld=/Users/richard/src/github.com/intrahealth/madx-hiv/input/pagecontent/cql
Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: The path to the CQL Content is required
    at org.opencds.cqf.tooling.library.BaseLibraryGenerator.buildArgs(BaseLibraryGenerator.java:118)
    at org.opencds.cqf.tooling.library.BaseLibraryGenerator.execute(BaseLibraryGenerator.java:52)
    at org.opencds.cqf.tooling.Main.main(Main.java:159)
</code></pre></div>



<a name="225057673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225057673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225057673">(Feb 03 2021 at 18:20)</a>:</h4>
<p>Looks like the docs are a bit out of date:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>java -jar /Users/richard/Downloads/tooling-1.3.0-jar-with-dependencies.jar -CqlToR4Library -ptcql<span class="o">=</span>/Users/richard/src/github.com/intrahealth/madx-hiv/input/pagecontent/cql -op<span class="o">=</span>/Users/richard/src/github.com/intrahealth/madx-hiv/input/resources/library
</code></pre></div>
<p>Make sure the output folder exists before running the command.</p>



<a name="225185716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225185716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225185716">(Feb 04 2021 at 16:36)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="225221651"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225221651" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225221651">(Feb 04 2021 at 21:00)</a>:</h4>
<p>Thanks for the guidance. It runs without error to stdout but the library resource is not created. Output is named <code>all-libraries-bundle.json</code> and content is:</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;resourceType&quot;: &quot;Bundle&quot;
}
</code></pre></div>
<p>I don't think it's an issue with the CQL. I've confirmed that the CQL can be converted to ELM without errors. Here it is:</p>
<div class="codehilite"><pre><span></span><code>library DEMOG version &#39;0.0.1&#39;

using FHIR version &#39;4.0.1&#39;

include FHIRHelpers version &#39;4.0.1&#39;

context Patient

define &quot;Initial Population&quot;:
    Patient.gender = &#39;female&#39;

define &quot;Denominator&quot;:
    &#39;Initial Population&#39;
</code></pre></div>
<p>Edit: I can reproduce the same output using the <code>cqframework/sample-content-ig</code> repo.</p>



<a name="225233868"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225233868" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225233868">(Feb 04 2021 at 22:33)</a>:</h4>
<p>You need to have the "skeleton" library resource available, like this example in the sample-ig: <a href="https://github.com/FHIR/sample-ig/blob/master/input/examples/Library-example.json">https://github.com/FHIR/sample-ig/blob/master/input/examples/Library-example.json</a></p>



<a name="225233921"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225233921" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225233921">(Feb 04 2021 at 22:33)</a>:</h4>
<p>That link in the "<a href="http://content.id">content.id</a>" element is how it knows which library file to package in which library resource. Does that help?</p>



<a name="225234011"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225234011" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225234011">(Feb 04 2021 at 22:34)</a>:</h4>
<p>In other words, it won't automatically create a Library resource, it needs the basic information to be present (and won't overwrite anything that's in that source resource that isn't generated by the tooling)</p>



<a name="225237216"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225237216" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225237216">(Feb 04 2021 at 23:01)</a>:</h4>
<p>Ok, thanks. I'll have a try. Does that template need also apply to the Measure generation? I've also seen an error "Could not load source for library FHIRHelpers", which I must be putting in the wrong place and it's not being found.</p>



<a name="225249713"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225249713" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225249713">(Feb 05 2021 at 01:27)</a>:</h4>
<p>So, I've tried putting FHIR Helpers as CQL in the folders, or as /Library. It's still <code>Could not load source for library FHIRHelpers, version 4.0.1</code> Where must it be?</p>



<a name="225251443"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225251443" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225251443">(Feb 05 2021 at 01:52)</a>:</h4>
<p>All the CQL sorce resolves from the same cql folder. Are you running the cqf-tooling or the publisher?</p>



<a name="225331460"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225331460" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Stanley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225331460">(Feb 05 2021 at 17:42)</a>:</h4>
<p>I'm using the cqf-tooling. I can try publisher to create Library resources as well.</p>



<a name="225344623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225344623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dave Carlson <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225344623">(Feb 05 2021 at 19:26)</a>:</h4>
<p>HI <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> can you clarify the relationship and overlap between cqf-tooling and publishing tools?  Hoping that they share common components/code, e.g. for populating Libraries.  Can these tools be used in combination for complementary behavior?  The cqf-tooling appears to have a helpful feature to create bundles of the outputs (library, valueset, plandef, etc) for posting to CQF Ruler.  I'd like to do the same with publisher outputs for cpg-on-fhir and CDS.</p>



<a name="225345708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225345708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225345708">(Feb 05 2021 at 19:34)</a>:</h4>
<p>Yes, the cqf-tooling and the IG publisher can be used together for complementary behavior. This is how the Connectathon IG is built:</p>
<p><a href="https://github.com/DBCG/connectathon/tree/master/fhir401">https://github.com/DBCG/connectathon/tree/master/fhir401</a></p>
<p>First, the cqf-tooling is run which produces the Bundles, among other things, and then the IG publisher is run to produce the complete IG. The main overlap in their behavior is the fact that they can both translate CQL and produce Library resources. If the cqf-tooling is used, it does that. If the additional features of the cqf-tooling are not needed just the IG publisher can be used.</p>



<a name="225347013"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225347013" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dave Carlson <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225347013">(Feb 05 2021 at 19:44)</a>:</h4>
<p>Thanks JP.  I saw this during the connectathon and did a very quick initial test.  I found one disconnect where cqf-tooling expected to find CQL under input/pagecontent, whereas the publisher expects under /input/cql (which is my preference for IG content).</p>



<a name="225347513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Utility%20to%20convert%20CQL%20to%20Library/near/225347513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Utility.20to.20convert.20CQL.20to.20Library.html#225347513">(Feb 05 2021 at 19:49)</a>:</h4>
<p>Yes, the cqf-tooling is currently hard-coded for <code>input/pagecontent/cql/</code>.  There's an issue tracking that here: </p>
<p><a href="https://github.com/cqframework/cqf-tooling/issues/95">https://github.com/cqframework/cqf-tooling/issues/95</a></p>
<p>We expect to make that configurable or derive it from the IG resource.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
