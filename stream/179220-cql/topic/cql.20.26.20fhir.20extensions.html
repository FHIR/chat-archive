---
layout: page
title: "FHIR Chat  · cql &amp; fhir extensions · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html">cql &amp; fhir extensions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="178887925"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/178887925" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffrey Taylor <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#178887925">(Oct 23 2019 at 19:37)</a>:</h4>
<p>Is there a way to specific a FHIR extension in a CQL query?</p>
<p>Here is an example:</p>
<div class="codehilite"><pre><span></span>library &quot;test&quot; version &#39;1&#39;

valueset &quot;Some Condition VS&quot;: &#39;1.2.3.4&#39;

context Patient

define &quot;Some Condition&quot;:
  exists([Condition: &quot;Some Condition VS&quot;])
  and exists // extension with url &quot;http://test.com&quot; &amp; valueString &quot;123&quot;
</pre></div>


<p>The operator <code>exists([Condition: "Some Condition VS"])</code> finds the patients that have a condition inside of the <code>'1.2.3.4'</code> valueset, but I want to further restrain the query by looking for a specific value on a fhir extension.</p>



<a name="178903922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/178903922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#178903922">(Oct 23 2019 at 22:45)</a>:</h4>
<p>Yes, extensions are exposed in the FHIR model, so you can access them like any other element:</p>
<div class="codehilite"><pre><span></span>library &quot;test&quot; version &#39;1&#39;

valueset &quot;Some Condition VS&quot;: &#39;1.2.3.4&#39;

context Patient

define &quot;Some Condition&quot;:
  exists(
        [Condition: &quot;Some Condition VS&quot;] C
          where exists (
                C.extension E
                  where E.url = &#39;http://test.com&#39;
                      and E.value = &#39;123&#39;
            )
    )
</pre></div>



<a name="178909060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/178909060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Afaq Khan <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#178909060">(Oct 24 2019 at 00:09)</a>:</h4>
<p>(deleted)</p>



<a name="178942201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/178942201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saoji Adhe <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#178942201">(Oct 24 2019 at 11:26)</a>:</h4>
<p>Hi ,<br>
i want to test cqf-ruler-0.1.13-SNAPSHOT.jar with hapi-fhir-3.8 , to test $evaluate-measure <br>
but it's not working with example given by hspc in there documentation <br>
anybody know about where i will get example related to $evaluate-measure, $apply, cds-hooks etc...<br>
Thank you in advance.</p>



<a name="178949645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/178949645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffrey Taylor <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#178949645">(Oct 24 2019 at 13:09)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>, this clicked - appreciate you sharing this example.</p>



<a name="178954872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/178954872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#178954872">(Oct 24 2019 at 14:05)</a>:</h4>
<p><span class="user-mention" data-user-id="196449">@Saoji Adhe</span> I would be more than happy, if you gave <a href="https://alexanderkiel.gitbook.io/blaze/deployment/quick-start" target="_blank" title="https://alexanderkiel.gitbook.io/blaze/deployment/quick-start">Blaze</a> a try. It supports $evaluate-measure, although with <code>initial-population</code> only were the CQL expression has to be called <code>InInitialPopulation</code>. Please also see this <a href="https://github.com/life-research/blaze/blob/master/evaluate-measure.sh" target="_blank" title="https://github.com/life-research/blaze/blob/master/evaluate-measure.sh">script</a> which calls $evaluate-measure the way it's currently supported.</p>



<a name="188146394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/188146394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eghonghon Okpah <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#188146394">(Feb 13 2020 at 20:20)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  Thanks you for sharing the fhir extension cql  query structure  <br>
Please find below a code snap and test patient extension structure I am testing out  <br>
define ValidBasic: <br>
  exists(<br>
        [Basic] B<br>
          where exists (<br>
                B.extension HE<br>
                  where HE.url = '<a href="http://sample.com/fhir/StructureDefinition/isHospice" target="_blank" title="http://sample.com/fhir/StructureDefinition/isHospice">http://sample.com/fhir/StructureDefinition/isHospice</a>'<br>
                      and HE.value = true<br>
            )<br>
    )</p>
<p>"extension": [<br>
     {<br>
      "url": "<a href="http://sample.com/fhir-extensions/Basic-originalReasonEntitlementCode" target="_blank" title="http://sample.com/fhir-extensions/Basic-originalReasonEntitlementCode">http://sample.com/fhir-extensions/Basic-originalReasonEntitlementCode</a>",<br>
      "valueCodeableConcept": {<br>
        "coding": [<br>
          {<br>
            "system": "CodeSystem",<br>
            "code": "11429006",<br>
            "display": "OREC"<br>
          }<br>
        ]<br>
      }},<br>
    {<br>
      "url": "<a href="http://sample.com/fhir/StructureDefinition/isHospice" target="_blank" title="http://sample.com/fhir/StructureDefinition/isHospice">http://sample.com/fhir/StructureDefinition/isHospice</a>",<br>
      "valueBoolean": "true"<br>
    }<br>
  ],</p>
<p>My results evaluate to a false when I execute my test case, even though the URL and the value are both contained within the extension</p>



<a name="188254194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/188254194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#188254194">(Feb 14 2020 at 22:38)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="221800">@Eghonghon Okpah</span> , I can confirm this behavior in the cql-runner, but I think we have fixed this already in the latest version of the engine. Where are you seeing this behavior?</p>



<a name="188521181"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/188521181" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eghonghon Okpah <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#188521181">(Feb 19 2020 at 07:28)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  we are using CQL Engine Version: 1.3.10-SNAPSHOT</p>



<a name="188554465"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/cql%20%26%20fhir%20extensions/near/188554465" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/cql.20.26.20fhir.20extensions.html#188554465">(Feb 19 2020 at 15:30)</a>:</h4>
<p>So digging on this a bit more and it is a known issue that we are currently working on a fix for: <a href="https://github.com/DBCG/cql_engine/issues/262" target="_blank" title="https://github.com/DBCG/cql_engine/issues/262">https://github.com/DBCG/cql_engine/issues/262</a> and <a href="https://github.com/cqframework/clinical_quality_language/pull/482" target="_blank" title="https://github.com/cqframework/clinical_quality_language/pull/482">https://github.com/cqframework/clinical_quality_language/pull/482</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
