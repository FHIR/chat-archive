---
layout: page
title: "FHIR Chat  · Best Way To Retrieve FHIR Extension data  with CQL · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html">Best Way To Retrieve FHIR Extension data  with CQL</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="260283555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/260283555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Riley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#260283555">(Nov 04 2021 at 15:09)</a>:</h4>
<p>What would be the best approach to pull extension data like race/ethnicity from a US-Core Patient FHIR Resource definition like in this example here? <a href="https://www.hl7.org/fhir/us/core/Patient-example.json.html">https://www.hl7.org/fhir/us/core/Patient-example.json.html</a></p>



<a name="260320719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/260320719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Corey Sanders <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#260320719">(Nov 04 2021 at 19:18)</a>:</h4>
<p>There are some examples on how to do this in the SupplementalDataElements library here - <a href="https://github.com/DBCG/connectathon/blob/master/fhir401/input/pagecontent/cql/SupplementalDataElements-2.0.0.cql">https://github.com/DBCG/connectathon/blob/master/fhir401/input/pagecontent/cql/SupplementalDataElements-2.0.0.cql</a></p>



<a name="260341634"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/260341634" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#260341634">(Nov 04 2021 at 22:10)</a>:</h4>
<p>There is a FHIRCommon library <a href="https://build.fhir.org/ig/cqframework/cqf/Library-FHIRCommon.html">here</a> that defines Extension functions for this purpose.</p>



<a name="260341688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/260341688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#260341688">(Nov 04 2021 at 22:11)</a>:</h4>
<p>They are based on the Extension functions used in the eCQM content, but trying to get a base common FHIR library that defines them once and gets reused.</p>



<a name="260341833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/260341833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#260341833">(Nov 04 2021 at 22:12)</a>:</h4>
<p>Also note that in 1.5, we are starting to use fluent functions to enable access to extensions like this <a href="https://build.fhir.org/ig/HL7/fhir-qi-core/Library-QICoreElements.html">QICoreElements</a></p>



<a name="260425831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/260425831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Riley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#260425831">(Nov 05 2021 at 16:06)</a>:</h4>
<p>thank you Bryn, what's the best way to use the FHIRCommons library in cqf-ruler? We're trying to load FHIRCommons in a script but the engine can't find the source library..</p>



<a name="260530194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/260530194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#260530194">(Nov 06 2021 at 18:59)</a>:</h4>
<p>Is the <a href="https://build.fhir.org/ig/cqframework/cqf/Library-FHIRCommon.html">FHIRCommon</a> library loaded in the ruler?</p>



<a name="261045739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/261045739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Riley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#261045739">(Nov 10 2021 at 19:57)</a>:</h4>
<p>Sorry for the late response Bryn, yes we have FHIRCommons as a library within CQF-Ruler. name: "FHIRCommon", title" "FHIR Commons". Is that all we need for cql-engine to reference the library?</p>



<a name="261070204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/261070204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#261070204">(Nov 10 2021 at 23:16)</a>:</h4>
<p>Yes, that should do it. Are you running a Library/$evaluate?</p>



<a name="261175890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/261175890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Riley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#261175890">(Nov 11 2021 at 19:33)</a>:</h4>
<p>Yes, we're running Library/&lt;id&gt;/$evaulate with an embedded dataendpoint like so:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Parameters&quot;,
    &quot;parameter&quot;: [{
            &quot;name&quot;: &quot;patientId&quot;,
            &quot;valueString&quot;: &quot;11364&quot;
        },
        {
            &quot;name&quot;: &quot;context&quot;,
            &quot;valueString&quot;: &quot;Patient&quot;
        },
        {
            &quot;name&quot;: &quot;dataEndpoint&quot;,
            &quot;valueEndpoint&quot;: {
                &quot;resourceType&quot;: &quot;Endpoint&quot;,
                &quot;id&quot;: &quot;428&quot;,
                &quot;meta&quot;: {
                    &quot;versionId&quot;: &quot;1&quot;,
                    &quot;lastUpdated&quot;: &quot;2021-10-20T13:53:15.805+00:00&quot;,
                    &quot;source&quot;: &quot;#5cb4405b-5cad-41&quot;
                },
                &quot;identifier&quot;: [{
                    &quot;system&quot;: &quot;http://example.org/enpoint-identifier&quot;,
                    &quot;value&quot;: &quot;omopv53onfhir4&quot;
                }],
                &quot;status&quot;: &quot;active&quot;,
                &quot;connectionType&quot;: {
                    &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/endpoint-connection-type&quot;,
                    &quot;code&quot;: &quot;hl7-fhir-rest&quot;
                },
                &quot;name&quot;: &quot;OMOPonFHIR v5.3.1 on R4&quot;,
                &quot;payloadType&quot;: [{
                    &quot;coding&quot;: [{
                        &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/endpoint-payload-type&quot;,
                        &quot;code&quot;: &quot;any&quot;
                    }]
                }],
                &quot;address&quot;: &quot;https://OMMITINGENDPOINT/fhir/&quot;,
                &quot;header&quot;: [&quot;Basic OMMITINGCREDENTIALS&quot;]
            }
        }
    ]
}
</code></pre></div>



<a name="264338403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/264338403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Stevens <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#264338403">(Dec 09 2021 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> I wanted to follow up on this again, we also wanted to have a common library of helper function for internal uses that we can refer to in other libraries, how exactly should the library be referenced in the CQL? We've tried <code>include FHIRCommon version 4.0.1</code> but that didn't work</p>



<a name="264759490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/264759490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#264759490">(Dec 13 2021 at 19:44)</a>:</h4>
<p>There's an explanation of how to do it here: <a href="https://fhir.org/guides/cqf/common/#contents">https://fhir.org/guides/cqf/common/#contents</a></p>



<a name="264759621"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/264759621" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#264759621">(Dec 13 2021 at 19:45)</a>:</h4>
<p>Note that we are working on NPM resolution in the atom and vs code plugins, so while the approach described at that link works for the refresh tooling (and the publisher if you're using the pub;isher to do CQL translation directly), it will give errors in the Atom and VS Code plugins until next release.</p>



<a name="264763277"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/264763277" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Riley <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#264763277">(Dec 13 2021 at 20:12)</a>:</h4>
<p>Is there a more direct approach we can use in CQF ruler itself? We do need the common libraries hosted in the IG, but we have a few utilities we wrote ourselves that we want to host in CQF ruler and use as well.</p>



<a name="264772671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/264772671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#264772671">(Dec 13 2021 at 21:30)</a>:</h4>
<p>Is there an issue that prevents you from loading a FHIR Library with your utilities in it to the cqf-ruler?</p>



<a name="265308641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/265308641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Stevens <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#265308641">(Dec 17 2021 at 15:15)</a>:</h4>
<p>So we can load libraries into cqf ruler fine, our main question is how do we refer to them in other scripts. For example, the link Bryn included says to have a line for <code>include fhir.cqf.common.FHIRCommon</code> to use functions in there. If we had a CQL Library named "ObservationHelperFunctions", how would we refer to it (what would the namespace be) in another script to use those functions defined in the file?</p>



<a name="265352453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Best%20Way%20To%20Retrieve%20FHIR%20Extension%20data%20%20with%20CQL/near/265352453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Best.20Way.20To.20Retrieve.20FHIR.20Extension.20data.20.20with.20CQL.html#265352453">(Dec 17 2021 at 19:57)</a>:</h4>
<p>The cqf-ruler currently doesn't support namespaces or loading referenced IGs, so if you placed the same file on the server the include would be:</p>
<p><code>include FHIRCommon</code></p>
<p>I thought we had an issue tracking that but we did not so I added one:<br>
<a href="https://github.com/DBCG/cqf-ruler/issues/406">https://github.com/DBCG/cqf-ruler/issues/406</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
