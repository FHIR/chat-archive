---
layout: page
title: "FHIR Chat  · List Manipulation · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/List.20Manipulation.html">List Manipulation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="244908468"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/List%20Manipulation/near/244908468" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adrien Prost <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/List.20Manipulation.html#244908468">(Jul 05 2021 at 08:35)</a>:</h4>
<p>Hello, I was wondering if the basic CQL libraries come with functions for creating lists and appending elements into them? The use case here is to be able to assign multiple possible diagnoses to a patient into a list in which subsequently filter out excluded diagnoses ?</p>



<a name="244913954"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/List%20Manipulation/near/244913954" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adrien Prost <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/List.20Manipulation.html#244913954">(Jul 05 2021 at 09:34)</a>:</h4>
<p>An important point to add, is that I am also asking whether or not we can define variables in CQL, so that we can modify lists in a function for example</p>



<a name="245256754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/List%20Manipulation/near/245256754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/List.20Manipulation.html#245256754">(Jul 07 2021 at 23:49)</a>:</h4>
<p>Like some other declarative languages there are no facilities in CQL for mutating existing Lists or other definitions. Instead you use queries, definitions, and other operators to create NEW Lists.</p>
<div class="codehilite" data-code-language="cql"><pre><span></span><code>  define "Diagnosis 1":
      { 'alive and kicking' }

  define "Diagnosis 2":
       { 'doing ok' }

  define "Diagnosis 3":
       { 'not doing great' }

  define "All Possible Diagnoses":
      "Diagnosis 1" union "Diagnosis 2" union "Diagnosis 3"

  define function FilterExcludedDiagnosis(diagnoses List&lt;System.String&gt;):
      diagnoses D where D != 'doing ok'

  define "Filtered Diagnoses":
    FilterExcludedDiagnosis("All Possible Diagnoses")

  define "Filtered Inline Instead":
     "All Possible Diagnoses" D where D != 'alive and kicking'

  define "Or Use Set Operators":
    "All Possible Diagnoses" except "Diagnosis 3"
</code></pre></div>
<p>I find it easiest to conceptualize the paradigm as "pipes and filters":</p>
<p>input data -&gt; (transform) -&gt; intermediate data -&gt; (filter) -&gt;  output data </p>
<p>data set 1 -&gt; (union) -&gt; output data<br>
data set 2 -------^</p>



<a name="245288617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/List%20Manipulation/near/245288617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adrien Prost <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/List.20Manipulation.html#245288617">(Jul 08 2021 at 09:06)</a>:</h4>
<p>Okay, thanks. I my case our diagnoses are results of decision trees where node outputs can have multiple outgoing edges, what I did is represent nodes as functions which all return a list of possible diagnoses, the function uses conditional statements to compute the correct output and then returns either the function of the  descendent node from the single outgoing edge or the union of all the descendant nodes.</p>



<a name="245288775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/List%20Manipulation/near/245288775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Adrien Prost <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/List.20Manipulation.html#245288775">(Jul 08 2021 at 09:08)</a>:</h4>
<p>The problem is that I am not sure that this method will be very efficient in practice with complex decision trees</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
