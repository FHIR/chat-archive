---
layout: page
title: "FHIR Chat  · Evaluation of arbitrary population types · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html">Evaluation of arbitrary population types</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="234908257"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/234908257" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#234908257">(Apr 16 2021 at 19:29)</a>:</h4>
<p>I'm looking at measures that have populations that aren't very <em>typical</em>... I'm finding that the logic in HAPI for measure evaluation would have problems processing logic for non-standard populations. For example, I see:</p>
<div class="codehilite"><pre><span></span><code>switch (populationType) {
  case INITIALPOPULATION:
    ...
  case NUMERATOR:
    ...
}
</code></pre></div>
<p>Which would be a problem for a measure that doesn't have a population type of INITIALPOPULATION, NUMERATOR, DENOMINATOR, etc.<br>
Are there any plans to broaden this logic to support arbitrary population types?</p>



<a name="234908794"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/234908794" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#234908794">(Apr 16 2021 at 19:33)</a>:</h4>
<p>Are there any plans to support stratifiers?</p>



<a name="234909174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/234909174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#234909174">(Apr 16 2021 at 19:36)</a>:</h4>
<p>And, lastly (I think), is there any documentation on how the hapi-fhir-jpaserver-cql module evaluates a given Measure? Seems like there's lots of logic/decisions in the code, and I'm trying to figure out how best to share that logic (requirements?) with an analyst responsible for developing a measure that can be evaluated using HAPI.</p>



<a name="234920981"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/234920981" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#234920981">(Apr 16 2021 at 21:04)</a>:</h4>
<p>Hi Sean, the populationType code system in the base specification is based on the standard population types from specifications currently in use, but we specifically made the binding extensible to support other calculation methodologies (FHIR-Saner has already defined some of these in their implementation guide). The HAPI server evaluation logic understands the population types in the base spec, so would have to be extended to support additional ones.</p>



<a name="234921624"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/234921624" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#234921624">(Apr 16 2021 at 21:07)</a>:</h4>
<p>For stratifier calculation, that is something we are in the process of adding, we'll be testing that in the upcoming connectathon.</p>



<a name="234921995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/234921995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#234921995">(Apr 16 2021 at 21:09)</a>:</h4>
<p>And for communicating requirements, there's been quite a bit of work in that space recently, take a look at some of the examples in the May ballot of the QM IG: <a href="http://build.fhir.org/ig/HL7/cqf-measures/Measure-measure-exm125-FHIR.html">http://build.fhir.org/ig/HL7/cqf-measures/Measure-measure-exm125-FHIR.html</a></p>



<a name="234923199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/234923199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#234923199">(Apr 16 2021 at 21:16)</a>:</h4>
<p>We're working on refining the presentation, but the information is there for what would be the human readable content of the measure. Does that help?</p>



<a name="234934100"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/234934100" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#234934100">(Apr 16 2021 at 23:09)</a>:</h4>
<p>Thanks for that info <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>! Saner is one of the measures that I had in mind... Saner, for example, creates different populations for each calculable metric. For example, a population for the # of total patients with COVID, another population for the # of total patients with COVID on a ventilator, etc. If we developed another measure that behaved similarly with the use of populations but for fundamentally different calculations than SANER, I get the impression we would have to coordinate with you to add support for those populations..??</p>



<a name="235199373"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/235199373" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#235199373">(Apr 19 2021 at 15:20)</a>:</h4>
<p>Got a chance to check out that link <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> ... that's not quite what I had in mind. That's per-measure documentation. What I had in mind was more-so <em>system</em> documentation describing how HAPI processes a measure/CQL.</p>



<a name="235729295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/235729295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#235729295">(Apr 22 2021 at 18:50)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191505">@Sean McIlvenna</span> , unfortunately there's not a lot of documentation there. At the highest level, it works by switching on the scoring type and evaluating the population criteria appropriate for that population type, patient-at-a-time, aggregating results if it's a summary request. So handling new scoring types/population types would be a matter of introducing new cases in that switch. Note that there is some refactoring going on in this layer right now and that should be done pretty soon, it might make sense to wait for the result of that and see how to apply in that newly refactored evaluation logic?</p>



<a name="235751279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/235751279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#235751279">(Apr 22 2021 at 21:28)</a>:</h4>
<p>No worries. After discussing with Rick for a bit, I think the proper way of handling this would actually be to create a separate <code>Measure.group</code> for each data element, each with a population of <code>initial-population</code>. So, rather than abstracting at <code>Measure.group.population</code>, abstracting at <code>Measure.group</code>.</p>



<a name="235751301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/235751301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#235751301">(Apr 22 2021 at 21:28)</a>:</h4>
<p>Regardless, you're probably right, it makes sense to hold off until your refactoring is done.</p>



<a name="235751354"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Evaluation%20of%20arbitrary%20population%20types/near/235751354" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Evaluation.20of.20arbitrary.20population.20types.html#235751354">(Apr 22 2021 at 21:29)</a>:</h4>
<p>With all of that said, I'd love to see more documentation on <em>how</em> this module of HAPI processes a given Measure.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
