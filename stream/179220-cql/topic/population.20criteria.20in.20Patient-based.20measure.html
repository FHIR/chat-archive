---
layout: page
title: "FHIR Chat  · population criteria in Patient-based measure · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/population.20criteria.20in.20Patient-based.20measure.html">population criteria in Patient-based measure</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="182593689"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/population%20criteria%20in%20Patient-based%20measure/near/182593689" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tien Thai <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/population.20criteria.20in.20Patient-based.20measure.html#182593689">(Dec 04 2019 at 20:09)</a>:</h4>
<p>Supposed I have defined an expression that returns a single tuple containing a decimal number such as one below:</p>
<p>define "Active Prescriptions In The Opioid Episode with Average MME":<br>
  "Opioid Prescriptions With Total MME" ActiveMedication<br>
    return {<br>
      averageMME: Round(ActiveMedication.totalMME / "Length Of The Opioid Episode", 2)<br>
    }</p>
<p>Assuming my measure is a patient-based measure, how would I identify a patient with averageMME &gt; 50 in the numerator?  I have added the above expression in the Numerator and it compiles OK (see below) but failed when saving grouping with the following error:<br>
Numerator 1 : For Patient-based Measures, all definitions directly added to populations must return a Boolean.</p>
<p>define "Numerator":<br>
  "Active Prescriptions In The Opioid Episode with Average MME" A<br>
    where A.averageMME &gt; 50.0</p>
<p>Can you please let me know how to get around this issue? Your help is appreciated.</p>
<p>TT</p>



<a name="182601718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/population%20criteria%20in%20Patient-based%20measure/near/182601718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/population.20criteria.20in.20Patient-based.20measure.html#182601718">(Dec 04 2019 at 21:29)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="249396">@Tien Thai</span>.  Your Numerator is a query -- so it will actually return a list of "Active Prescriptions In The Opioid Episode with Average MME" that have the averageMME &gt; 50.0.  A list is not a boolean, so it doesn't work as a numerator.  I think what you really want to know is if the patient has any episodes that met that criteria.  If I correctly understand what you're trying to do, it's as simple as wrapping that query with <code>exists</code> :</p>
<div class="codehilite"><pre><span></span>define &quot;Numerator&quot;:
  exists (&quot;Active Prescriptions In The Opioid Episode with Average MME&quot; A
where A.averageMME &gt; 50.0)
</pre></div>



<a name="182602525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/population%20criteria%20in%20Patient-based%20measure/near/182602525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tien Thai <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/population.20criteria.20in.20Patient-based.20measure.html#182602525">(Dec 04 2019 at 21:37)</a>:</h4>
<p>Chris, <br>
Thank you very much for your quick response.  Yes, that is exactly what I am trying to do.  I have tried your approach before and it gave me a validation error because the "Active Prescriptions In The Opioid Episode with Average MME" expression returns a single tuple (i.e. averageMME) and so exists will not work in this case.   I have been trying several approaches so far none is working.  Many thanks.</p>
<p>TT</p>



<a name="182603794"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/population%20criteria%20in%20Patient-based%20measure/near/182603794" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/population.20criteria.20in.20Patient-based.20measure.html#182603794">(Dec 04 2019 at 21:51)</a>:</h4>
<p>Oh.  OK -- without the full source, it was hard to tell that it returned a singleton.  If that's the case, have you tried:</p>
<div class="codehilite"><pre><span></span>define &quot;Numerator&quot;:
 &quot;Active Prescriptions In The Opioid Episode with Average MME&quot;.averageMME &gt; 50.0
</pre></div>



<a name="182664336"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/population%20criteria%20in%20Patient-based%20measure/near/182664336" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tien Thai <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/population.20criteria.20in.20Patient-based.20measure.html#182664336">(Dec 05 2019 at 14:36)</a>:</h4>
<p>Yes, it works.  Thank you very much for your help, Chris!<br>
TT</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
