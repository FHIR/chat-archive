---
layout: page
title: "FHIR Chat  · CQF-Ruler $cql help · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF-Ruler.20.24cql.20help.html">CQF-Ruler $cql help</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="259115224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF-Ruler%20%24cql%20help/near/259115224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Stevens <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF-Ruler.20.24cql.20help.html#259115224">(Oct 26 2021 at 15:34)</a>:</h4>
<p>I have a question about the $cql operation currently available on CQF-Ruler. In the code for the operation, it looks like there's not  an option to define an external data source like for the Library $evaluate measure. Is this a known limitation of the operation, where the CQL has to be registered as a library on CQF-Ruler to be evaluated using an external data source or am I missing something? <span class="user-mention" data-user-id="194178">@JP</span> I think you would probably know best since you've helped my teammate with cqf-ruler stuff before</p>



<a name="259117355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF-Ruler%20%24cql%20help/near/259117355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF-Ruler.20.24cql.20help.html#259117355">(Oct 26 2021 at 15:48)</a>:</h4>
<p>The intent is for both those operations to support the same set of parameters so they can access data in the same way, but it sounds like accessing external data isn't wired up in the $cql operation. It should be a straightforward change because they're both running the cql-evaluator underneath, it sounds like the dataEndpoint parameter just needs to be wired up to a provider parameter to the evaluate call.</p>



<a name="259129042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF-Ruler%20%24cql%20help/near/259129042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF-Ruler.20.24cql.20help.html#259129042">(Oct 26 2021 at 17:09)</a>:</h4>
<p>Using the evaluator modules is still a WIP in the ruler. The current implementation is inline. Still hammering out the interfaces so that those modules can be reused with Android, VS Code, eCR Now, etc. Getting there, but it's slow going. <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="259145065"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF-Ruler%20%24cql%20help/near/259145065" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Stevens <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF-Ruler.20.24cql.20help.html#259145065">(Oct 26 2021 at 19:02)</a>:</h4>
<p>Now im switching back to using Libraries and $evaluate but its giving an error in the logs saying "Unknown element 'valueEndpoint' found while parsing", and it worked a few days ago so I dont know what couldve happened to cause this. My post body is </p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Parameters&quot;,
    &quot;parameter&quot;: [
        {
            &quot;name&quot;: &quot;patientId&quot;,
            &quot;valueString&quot;: &quot;11364&quot;
        },
        {
            &quot;name&quot;: &quot;context&quot;,
            &quot;valueString&quot;: &quot;Patient&quot;
        },
        {
            &quot;name&quot;: &quot;dataEndpoint&quot;,
            &quot;valueEndpoint&quot;: &quot;Endpoint/1&quot;
        }
    ]
}
</code></pre></div>
<p>where Endpoint/1 is a valid resource on the server</p>



<a name="260168102"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF-Ruler%20%24cql%20help/near/260168102" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF-Ruler.20.24cql.20help.html#260168102">(Nov 03 2021 at 17:25)</a>:</h4>
<p>Apologies for missing this Andy. The operation expects the actual Endpoint resource, not just a reference to an existing one.</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Parameters&quot;,
    &quot;parameter&quot;: [
        {
            &quot;name&quot;: &quot;patientId&quot;,
            &quot;valueString&quot;: &quot;11364&quot;
        },
        {
            &quot;name&quot;: &quot;context&quot;,
            &quot;valueString&quot;: &quot;Patient&quot;
        },
        {
            &quot;name&quot;: &quot;dataEndpoint&quot;,
            &quot;resource&quot;:  {
                &quot;resourceType&quot;: &quot;Endpoint&quot;,
               // The rest of the Endpoint here
}
        }
    ]
}
</code></pre></div>



<a name="260168324"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/CQF-Ruler%20%24cql%20help/near/260168324" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/CQF-Ruler.20.24cql.20help.html#260168324">(Nov 03 2021 at 17:27)</a>:</h4>
<p>We could probably overload the operation to support an Endpoint reference. Endpoint references currently don't work well in OAuth environments because the headers are static, and in real-world environments it's expected that the refresh token will refresh periodically. The cqf-ruler currently doesn't support such a scenario.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
