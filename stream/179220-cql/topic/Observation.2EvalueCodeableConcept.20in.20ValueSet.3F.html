---
layout: page
title: "FHIR Chat  · Observation.valueCodeableConcept in ValueSet? · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Observation.2EvalueCodeableConcept.20in.20ValueSet.3F.html">Observation.valueCodeableConcept in ValueSet?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="236524237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Observation.valueCodeableConcept%20in%20ValueSet%3F/near/236524237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Observation.2EvalueCodeableConcept.20in.20ValueSet.3F.html#236524237">(Apr 28 2021 at 15:09)</a>:</h4>
<p>Trying to do the following:</p>
<p><code>define "matchingObservations":
  exists ([Observation: "MyValueSet1"] Obs
    where Obs.valueCodeableConcept in MyValueSet2
  )
</code><br>
The idea is that first need to filter possible Observations that have Observation.code in the MyValueSet1 and then filter by only those that have the Observation.valueCodeableConcept in MyValueSet2.    This syntax doesn't seem to be allowed (using Atom CQL plugin).   If I use this syntax it is allowed but doesn't work (with CQL Framework)</p>
<p><code>define "matchingObservations":
  exists ([Observation: "MyValueSet1"] Obs
    where Obs.value in MyValueSet2
  )
</code><br>
Any pointers?   I saw a Github thread about this (<a href="https://github.com/cqframework/clinical_quality_language/issues/564">https://github.com/cqframework/clinical_quality_language/issues/564</a> ); does this just not work in CQL Framework yet?</p>
<p>Update: I was able to get it to work by adding 'as CodeableConcept'</p>
<p><code>define "matchingObservations":
  exists ([Observation: "MyValueSet1"] Obs
    where Obs.value as CodeableConcept in MyValueSet2
  )
</code></p>
<p>Now I'm onto the next step -- retrieving a value (string) from this Observation.   Not sure how to do this:</p>
<p><code>define "myBodySite":
  exists ([Observation: "MyValueSet1"] Obs
    where Obs.value as CodeableConcept in MyValueSet2
    return Obs.bodySite.text
  )
</code></p>



<a name="236756399"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Observation.valueCodeableConcept%20in%20ValueSet%3F/near/236756399" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Observation.2EvalueCodeableConcept.20in.20ValueSet.3F.html#236756399">(Apr 29 2021 at 22:22)</a>:</h4>
<p>exists returns a boolean.</p>
<div class="codehilite"><pre><span></span><code>define &quot;myBodySite&quot;:
  [Observation: &quot;MyValueSet1&quot;] Obs
    where Obs.value as CodeableConcept in MyValueSet2
    return Obs.bodySite.text
</code></pre></div>



<a name="236757293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Observation.valueCodeableConcept%20in%20ValueSet%3F/near/236757293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Reynolds <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Observation.2EvalueCodeableConcept.20in.20ValueSet.3F.html#236757293">(Apr 29 2021 at 22:31)</a>:</h4>
<p>But, that returns a list of strings.  Not sure if that's what you want.</p>
<div class="codehilite"><pre><span></span><code>define &quot;myBodySite&quot;:
  Last(
    [Observation: &quot;MyValueSet1&quot;] Obs
      where Obs.value as CodeableConcept in &quot;MyValueSet2&quot;
      sort by effective
  ).bodySite.text
</code></pre></div>
<p>?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
