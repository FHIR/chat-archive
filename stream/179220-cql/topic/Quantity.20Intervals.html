---
layout: page
title: "FHIR Chat  · Quantity Intervals · cql"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/index.html">cql</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html">Quantity Intervals</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="267459479"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/267459479" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#267459479">(Jan 10 2022 at 16:09)</a>:</h4>
<p>Are Quantities a valid point type for intervals? The spec says:</p>
<blockquote>
<p>An interval must be defined using a point type that supports comparison, as well as Successor and Predecessor operations, and Minimum and Maximum Value operations.</p>
</blockquote>
<p>However neither Successor, Predecessor, Minimum or Maximum Value operations are defined for Quantity. </p>
<p>On the other hand there are tests with Quantity Intervals like <code>QuantityIntervalUnion1To15</code>.</p>



<a name="267470254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/267470254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#267470254">(Jan 10 2022 at 17:21)</a>:</h4>
<p><span class="user-mention" data-user-id="197470">@Alexander Kiel</span> - I think the intent is that quantity <em>is</em> supported in an interval.  Successor and Predecessor are actually defined for <code>Quantity</code> (see the <a href="https://cql.hl7.org/09-b-cqlreference.html#successor">CQL Reference</a>).  You're right that MinimumValue and MaximumValue are not explicitly defined for <code>Quantity</code>; probably because it's unclear what unit should be used for min/max Quantity type.  But for the purposes of something like an interval, it's really the min/max of the <code>Quantity.value</code> (which is min/max of <code>Decimal</code>) that matters.  So... sounds like a clarification is needed in the spec.  <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>?</p>



<a name="267471427"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/267471427" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#267471427">(Jan 10 2022 at 17:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span>  Thanks. You are right. Successor and Predecessor are defined for Quantity in the CQL Reference. But Quantity is not defined in the <a href="https://cql.hl7.org/04-logicalspecification.html#predecessor">ELM Reference</a>. Because I implement my CQL evaluator on top of ELM, I actually don't look in the CQL Reference very often. So I guess that the ELM Reference needs to be extended.</p>
<p>As for minimum- / maximum value. In an interval context the unit should just be the unit of the explicit boundary. But standalone the unit is not clear. Also it is not clear if the quantity is an integer or a decimal one.</p>



<a name="267476765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/267476765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#267476765">(Jan 10 2022 at 18:04)</a>:</h4>
<p>I agree that the unit should be the unit of the boundary, but... the minimum/maximum functions take in a type declaration, and I don't think it's possible to put the quantity unit into a type declaration. So if Minimum/Maximum were to explicitly support <code>Quantity</code> then the unit in the return value I guess would have to just be null.</p>
<p>Things also get ambiguous for intervals w/ mixed units (e.g., <code>Interval[1 'mg', 1000 'g']</code>).  If you just apply minimum/maximum to quantity values (w/out paying attention to unit at all), then you can get different max width intervals depending on if the interval quantity units are normalized or not.  So that's fun.</p>
<p>As for a quantity being an integer or decimal, by definition, <a href="https://cql.hl7.org/09-b-cqlreference.html#quantity">CQL Quantity</a> value is always a <code>Decimal</code>.</p>



<a name="267482023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/267482023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#267482023">(Jan 10 2022 at 18:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> </p>
<blockquote>
<p>As for a quantity being an integer or decimal, by definition, CQL Quantity value is always a Decimal.</p>
</blockquote>
<p>If this is true than that sentence from the <a href="https://cql.hl7.org/09-b-cqlreference.html#successor">Successor - CQL Reference</a> has redundant information. So the integer part should be removed.</p>
<blockquote>
<p>For Quantity values, the successor is equivalent to adding 1 if the quantity is an integer, and the minimum precision value for the Decimal type if the quantity is a decimal. The units are unchanged.</p>
</blockquote>



<a name="267485233"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/267485233" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#267485233">(Jan 10 2022 at 19:09)</a>:</h4>
<p>Oh.  I read right past that part.  Ugh.  It may be that although the datatype is a <code>Decimal</code>, successor should treat it like datatype <code>Integer</code> if it does not have a fractional component (i.e., a pseudo-Integer).  This is probably another bit that should be clarified, as I agree that it is confusing.  Good catch, <span class="user-mention" data-user-id="197470">@Alexander Kiel</span>.</p>



<a name="267582310"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/267582310" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#267582310">(Jan 11 2022 at 13:44)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> <span class="user-mention" data-user-id="191469">@Chris Moesel</span> What's next? Can I help to fix the spec? Should I issue PR's on the HL7/cql repo? I've currently two other PR's open on that repo.</p>



<a name="267582939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/267582939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#267582939">(Jan 11 2022 at 13:49)</a>:</h4>
<p>Since these are proposed changes to the spec (even if just fixing errors / clarifying), I think you need to submit a change request on Jira so they can be voted on in a WG.  Then they can be applied to the spec after that.</p>



<a name="270416823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/270416823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#270416823">(Feb 02 2022 at 16:49)</a>:</h4>
<p>Apologies for the delays here <span class="user-mention" data-user-id="197470">@Alexander Kiel</span> and <span class="user-mention" data-user-id="191469">@Chris Moesel</span> , I've submitted trackers to clarify these and we'll get these included in the upcoming Errata.</p>



<a name="270416825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/270416825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#270416825">(Feb 02 2022 at 16:49)</a>:</h4>
<p><a href="https://jira.hl7.org/browse/FHIR-35926">https://jira.hl7.org/browse/FHIR-35926</a></p>



<a name="270416882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/270416882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#270416882">(Feb 02 2022 at 16:49)</a>:</h4>
<p><a href="https://jira.hl7.org/browse/FHIR-35925">https://jira.hl7.org/browse/FHIR-35925</a></p>



<a name="270420000"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179220-cql/topic/Quantity%20Intervals/near/270420000" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179220-cql/topic/Quantity.20Intervals.html#270420000">(Feb 02 2022 at 17:05)</a>:</h4>
<p>(deleted)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
