---
layout: page
title: "FHIR Chat  · $document · IPS"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/index.html">IPS</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html">$document</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="239273079"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239273079" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239273079">(May 18 2021 at 15:25)</a>:</h4>
<p>I've split up the Bundle example and posted it to <a href="https://server.fire.ly/">https://server.fire.ly/</a>. It's possible to call $document on Composition/30551ce1-5a28-4356-b684-1e639094ad4d. <a href="https://server.fire.ly/Composition/30551ce1-5a28-4356-b684-1e639094ad4d/$document">https://server.fire.ly/Composition/30551ce1-5a28-4356-b684-1e639094ad4d/$document</a> will contain the same resources as provided in the example Bundle <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="239273426"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239273426" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239273426">(May 18 2021 at 15:27)</a>:</h4>
<p>That's great.  I'm working on doing pretty much the same on my HAPI server.  Hopefully shouldn't be too long for that.</p>



<a name="239273879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239273879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239273879">(May 18 2021 at 15:30)</a>:</h4>
<p>When I try this server/composition combo in our Inferno IPS tests, I get a <code>415</code> error:</p>



<a name="239273888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239273888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239273888">(May 18 2021 at 15:30)</a>:</h4>
<div class="codehilite"><pre><span></span><code>      &quot;severity&quot;: &quot;error&quot;,
      &quot;code&quot;: &quot;not-supported&quot;,
      &quot;details&quot;: {
        &quot;coding&quot;: [
          {
            &quot;system&quot;: &quot;http://hl7.org/fhir/dotnet-api-operation-outcome&quot;,
            &quot;code&quot;: &quot;5011&quot;
          }
        ],
        &quot;text&quot;: &quot;Resource for Composition/30551ce1-5a28-4356-b684-1e639094ad4d was found but in a different informationmodel: Fhir4.0.&quot;
      }
    }```
</code></pre></div>



<a name="239273955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239273955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239273955">(May 18 2021 at 15:30)</a>:</h4>
<p>Specifically for <code>GET https://server.fire.ly/Composition/30551ce1-5a28-4356-b684-1e639094ad4d </code></p>



<a name="239274999"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239274999" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239274999">(May 18 2021 at 15:37)</a>:</h4>
<p>It looks like it's because Inferno isn't adding <code>;fhirVersion=4.0</code> to the <code>Accept: application/fhir+json</code> header, so the server is thinking it should default to FHIR 3.0</p>



<a name="239276897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239276897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reinhard Egelkraut <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239276897">(May 18 2021 at 15:49)</a>:</h4>
<p>I've added the FHIR version to the URL from <span class="user-mention" data-user-id="193430">@Alexander Zautke</span> so it looked like this:<br>
<a href="https://server.fire.ly/r4/Composition/30551ce1-5a28-4356-b684-1e639094ad4d/$document">https://server.fire.ly/r4/Composition/30551ce1-5a28-4356-b684-1e639094ad4d/$document</a><br>
and it worked for me</p>



<a name="239276930"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239276930" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239276930">(May 18 2021 at 15:49)</a>:</h4>
<p>Good idea. Let me give that a try</p>



<a name="239276992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239276992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reinhard Egelkraut <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239276992">(May 18 2021 at 15:50)</a>:</h4>
<p>I took the base URL from conman and hoped for the best <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="239277188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239277188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reinhard Egelkraut <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239277188">(May 18 2021 at 15:50)</a>:</h4>
<p>the Accept header is fine though, that does not cause any problems</p>



<a name="239277252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239277252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239277252">(May 18 2021 at 15:51)</a>:</h4>
<p>Using the <code>/r4/</code> endpoint, I'm able to get tests to run</p>



<a name="239277328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239277328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reinhard Egelkraut <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239277328">(May 18 2021 at 15:51)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="239277406"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239277406" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239277406">(May 18 2021 at 15:52)</a>:</h4>
<p>Here are the results of running the "document operation tests" in Inferno against <span class="user-mention" data-user-id="193430">@Alexander Zautke</span> 's server: <a href="https://inferno-qa.healthit.gov/community/bj3yeOxOqI3/test_sets/ad_hoc_testing/#IPSOperations/ad_hoc_testing_IPSOperations_IpsDocumentOperationSequence">https://inferno-qa.healthit.gov/community/bj3yeOxOqI3/test_sets/ad_hoc_testing/#IPSOperations/ad_hoc_testing_IPSOperations_IpsDocumentOperationSequence</a></p>



<a name="239277587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239277587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239277587">(May 18 2021 at 15:53)</a>:</h4>
<p>Oh, sorry. Yes, the server is running on STU3 by default. You need to add an Accept-Header with "application/fhir+json; fhirVersion=4.0" or use /r4 in the base url</p>



<a name="239282452"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239282452" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen MacVicar <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239282452">(May 18 2021 at 16:19)</a>:</h4>
<p><span class="user-mention" data-user-id="193430">@Alexander Zautke</span> Does the server only support using GET for the $document operation? I get a 501 trying to do it with a POST. (abbreviated response below)</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
  &quot;id&quot;: &quot;fa4fa726-1522-4b79-ac4e-52678f2db9a9&quot;,
  &quot;issue&quot;: [
    {
      &quot;severity&quot;: &quot;warning&quot;,
      &quot;code&quot;: &quot;not-supported&quot;,
      &quot;diagnostics&quot;: &quot;/Composition&quot;
    },
    {
      &quot;severity&quot;: &quot;warning&quot;,
      &quot;code&quot;: &quot;not-supported&quot;,
      &quot;diagnostics&quot;: &quot;/30551ce1-5a28-4356-b684-1e639094ad4d&quot;
    },
    {
      &quot;severity&quot;: &quot;warning&quot;,
      &quot;code&quot;: &quot;not-supported&quot;,
      &quot;diagnostics&quot;: &quot;persist=true&quot;
    }
  ]
}
</code></pre></div>



<a name="239284090"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239284090" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239284090">(May 18 2021 at 16:29)</a>:</h4>
<p>When I test against Alexander's server, I get (among others) this message: <code>Bundle.AllergyIntolerance[1]: AllergyIntolerance.code.coding[0].code: This element is not allowed by the profile http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips</code></p>



<a name="239285044"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239285044" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239285044">(May 18 2021 at 16:35)</a>:</h4>
<p>One of the two <code>AllergyIntolerance</code> resources uses <code>no-known-food-allergies</code>, the other uses a SNOMED code that doesn't appear to be part of the required binding slice for <code>AllergyIntolerance.code</code>:</p>



<a name="239285049"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239285049" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239285049">(May 18 2021 at 16:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code>              &quot;system&quot;: &quot;http://snomed.info/sct&quot;,
              &quot;code&quot;: &quot;373270004&quot;,
              &quot;display&quot;: &quot;Substance with penicillin structure and antibacterial mechanism of action (substance)&quot;
            }
</code></pre></div>



<a name="239286159"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239286159" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239286159">(May 18 2021 at 16:42)</a>:</h4>
<p>It's not necessary that the SNOMED code match one in the allergyIntoleranceGPSCode slice, as that code may be a legitimate SNOMED CT allergy code but <strong>not</strong> be one that is in the GPS.  The GPS slice is there to call attention to the GPS (and identify what codes are included in it, which may be important if you are in a non SNOMED member country).  But it doesn't restrict the codes used to only those that are in that slice, as the open slicing rule allows codes that don't match any of the ones in the slice to still be used.</p>



<a name="239286548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239286548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239286548">(May 18 2021 at 16:45)</a>:</h4>
<p>Hm. I guess I'm not sure then why the validator is complaining that <code>code.coding[0].code</code> isn't allowed?</p>



<a name="239293982"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239293982" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239293982">(May 18 2021 at 17:32)</a>:</h4>
<p>I've seen that error show up before.  I think it might be due to an error in the profile (maybe?).  If there is a way that you can try it with the connecthon branch package, that might be instructive (and hopefully useful).</p>



<a name="239299448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239299448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239299448">(May 18 2021 at 18:08)</a>:</h4>
<p>Ok; I'll give that a try later today</p>



<a name="239302431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239302431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239302431">(May 18 2021 at 18:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> I tried this with the conectathon branch package, and those errors went away.</p>



<a name="239302508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239302508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239302508">(May 18 2021 at 18:27)</a>:</h4>
<p><a href="/user_uploads/10155/ZS6MBLTyOooFWpWGYMVWBcnk/Screen-Shot-2021-05-18-at-14.27.06.png">Screen-Shot-2021-05-18-at-14.27.06.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/ZS6MBLTyOooFWpWGYMVWBcnk/Screen-Shot-2021-05-18-at-14.27.06.png" title="Screen-Shot-2021-05-18-at-14.27.06.png"><img src="/user_uploads/10155/ZS6MBLTyOooFWpWGYMVWBcnk/Screen-Shot-2021-05-18-at-14.27.06.png"></a></div>



<a name="239311483"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239311483" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239311483">(May 18 2021 at 19:26)</a>:</h4>
<p>Excellent!</p>



<a name="239322076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239322076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239322076">(May 18 2021 at 20:39)</a>:</h4>
<p><span class="user-mention" data-user-id="191647">@Michael O'Keefe</span> I've fixed the issue for DO-02 (can't deploy it unfortunately). The other issues are not related to the server, right? Do you see an error in the composition?</p>



<a name="239322475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239322475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael O&#x27;Keefe <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239322475">(May 18 2021 at 20:41)</a>:</h4>
<p><span class="user-mention" data-user-id="193430">@Alexander Zautke</span> I believe you are correct that the other issues are related to us sending some of the resources to the validator without their referenced resources. I don't think they are actual composition-related errors</p>



<a name="239322536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239322536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239322536">(May 18 2021 at 20:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> Can you give me an Composition ID that I can test $document operation?</p>



<a name="239323201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239323201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239323201">(May 18 2021 at 20:47)</a>:</h4>
<p><span class="user-mention" data-user-id="193430">@Alexander Zautke</span> I rerun test using my local dev branch. There are two issues found: <br>
<a href="/user_uploads/10155/OiwqmDQhEVYj7MtbpOPCt7ki/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/OiwqmDQhEVYj7MtbpOPCt7ki/image.png" title="image.png"><img src="/user_uploads/10155/OiwqmDQhEVYj7MtbpOPCt7ki/image.png"></a></div>



<a name="239323319"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239323319" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239323319">(May 18 2021 at 20:47)</a>:</h4>
<p>Test it on which server, <span class="user-mention" data-user-id="191506">@Yunwei Wang</span>?  I'm working to have instances (at least one) available for that on my server, but I haven't yet been able to load the individual resources via a transaction bundle - for some reason that is giving an error right now and I'm trying to track that down.  I can post them individually, but that will take me a little longer.</p>



<a name="239323653"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239323653" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239323653">(May 18 2021 at 20:50)</a>:</h4>
<p>Here's a Postman collection to validate and create the individual resources<br>
<a href="/user_uploads/10155/FQJZnPwDkiAe9oiztdKd4SyO/IPS.postman_collection.json">IPS.postman_collection.json</a></p>



<a name="239323736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239323736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239323736">(May 18 2021 at 20:50)</a>:</h4>
<p>Went down that path today :D</p>



<a name="239323765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239323765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239323765">(May 18 2021 at 20:50)</a>:</h4>
<p>Oh no problem. I have run tests on both <span class="user-mention" data-user-id="193430">@Alexander Zautke</span> and <span class="user-mention" data-user-id="191364">@Peter Jordan</span></p>



<a name="239324764"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239324764" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239324764">(May 18 2021 at 20:57)</a>:</h4>
<p>I should have something for you shortly.</p>



<a name="239329985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239329985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239329985">(May 18 2021 at 21:37)</a>:</h4>
<p>The HAPI server is choking on the Observation 2639657a-c19a-48e2-82cc-471e13b8ad94.  All the other supporting resources are created fine (I haven't created the Composition yet), but this one errors out with that same "Index 0 out of bounds for length 0"error that I mentioned before with the transaction bundle.  But it validates just fine with the FHIR validator.  So I still need to figure out what's going on with it.</p>



<a name="239330079"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239330079" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239330079">(May 18 2021 at 21:38)</a>:</h4>
<p>At least I know for sure where the error is coming from now.</p>



<a name="239334020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239334020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239334020">(May 18 2021 at 22:12)</a>:</h4>
<p>And now I know what the error is - it appears to be a HAPI server bug!  The HAPI server will not let me PUT (or POST) the Observation resource with a CodeableConcept containing 'text' only:</p>
<div class="codehilite"><pre><span></span><code>    &quot;code&quot;: {
        &quot;text&quot;: &quot;Blood typing&quot;
    },
</code></pre></div>
<p>That causes the error, even though it's perfectly valid in the base FHIR spec and the IPS IG, and it passes the Java validator just fine.  If I add a 'coding' in the datatype then the resource is created without a problem.</p>



<a name="239334299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239334299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239334299">(May 18 2021 at 22:15)</a>:</h4>
<p>So now you can test $document on my server with <a href="http://Composition.id">Composition.id</a> = 30551ce1-5a28-4356-b684-1e639094ad4d (but that one Observation is just slightly different).</p>



<a name="239389856"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239389856" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239389856">(May 19 2021 at 09:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span>  I run an Inferno test on your server. There are two issues. One is that Bundle.entry does not have fullUrl. The other one is one Observation entry does not have value</p>



<a name="239397466"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239397466" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239397466">(May 19 2021 at 10:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191506">@Yunwei Wang</span> I will look at the details between now and our 10:30 UTC session.  I think the second one is probably as it is intended - and if so, we should discuss.</p>



<a name="239435613"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239435613" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen MacVicar <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239435613">(May 19 2021 at 14:38)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> We figured out the issue that was causing the <code>$document</code> operation to fail on your server when we used POST. The http library we're using was silently adding a <code>Content-Type</code> header.  So it's a problem on our end rather than your end.</p>



<a name="239436219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239436219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239436219">(May 19 2021 at 14:42)</a>:</h4>
<p>Ah, good.  I'm glad you figured out.  I has also been able to confirm that it did work for me using Postman.</p>



<a name="239545061"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239545061" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239545061">(May 20 2021 at 07:14)</a>:</h4>
<p>.. general question .. a conformant server offering the $document operation shall or may support persistency and graph definitions ?</p>



<a name="239545589"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239545589" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239545589">(May 20 2021 at 07:20)</a>:</h4>
<p>Both parameters are optional: <a href="https://www.hl7.org/fhir/composition-operation-document.html">https://www.hl7.org/fhir/composition-operation-document.html</a></p>



<a name="239551782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239551782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239551782">(May 20 2021 at 08:13)</a>:</h4>
<p>I see, my question is how optionality should be interpreted : is optional for the consumer (you are not required to send them) or for both (the server is not expected to support all of the parameters)</p>



<a name="239559797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239559797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239559797">(May 20 2021 at 09:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191506">@Yunwei Wang</span>  I tried the IPS $document validation. The report (<a href="https://inferno-qa.healthit.gov/community/Ct1lvqcjUW/">https://inferno-qa.healthit.gov/community/Ct1lvqcjUW/</a>) includes several validation errors (..missing parts..). <br>
I tried also to validate the IPS bundle returned by the same operation, saved on a file, with the Inferno tool and the only returned error is the well-known one with the ATC code. <br>
are the two tools using different validators ?</p>



<a name="239571084"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239571084" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239571084">(May 20 2021 at 11:02)</a>:</h4>
<p>can an IG make them required? I am not sure if there is a mechanism like with resources (profiles) for operations.</p>



<a name="239581439"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239581439" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen MacVicar <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239581439">(May 20 2021 at 12:26)</a>:</h4>
<p>I see other errors when I try to validate that bundle at <a href="https://inferno-qa.healthit.gov/validator">https://inferno-qa.healthit.gov/validator</a><br>
Did you select the IPS Bundle profile under advanced options?</p>



<a name="239592204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239592204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239592204">(May 20 2021 at 13:36)</a>:</h4>
<p>I used <a href="https://inferno.healthit.gov/">https://inferno.healthit.gov/</a> with the IPS package selected this is the only Validation error:<br>
Bundle.entry[21].resource.ofType(AllergyIntolerance).code.coding[0]: The code "J01CA" is not valid in the system <a href="http://www.whocc.no/atc">http://www.whocc.no/atc</a>; The code provided (<a href="http://www.whocc.no/atc#J01CA">http://www.whocc.no/atc#J01CA</a>) is not valid in the value set 'All codes known to the system' (from <a href="http://tx.fhir.org/r4">http://tx.fhir.org/r4</a>) for '<a href="http://www.whocc.no/atc#J01CA">http://www.whocc.no/atc#J01CA</a>' on line 1. Jump to error.</p>



<a name="239592638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239592638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239592638">(May 20 2021 at 13:39)</a>:</h4>
<p>same result if I use directly the java validator</p>



<a name="239592870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239592870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen MacVicar <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239592870">(May 20 2021 at 13:40)</a>:</h4>
<p><a href="http://inferno-qa.healthit.gov">inferno-qa.healthit.gov</a> and <a href="http://inferno.healthit.gov">inferno.healthit.gov</a> are not necessarily using the same version of the validator.<br>
Using the validator on <a href="http://inferno-qa.healthit.gov">inferno-qa.healthit.gov</a>, I get the following error:</p>
<blockquote>
<p>Bundle: Bundle.entry:composition: minimum required = 1, but only found 0 (from <a href="http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips">http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips</a>) on line 1.</p>
</blockquote>



<a name="239592907"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239592907" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239592907">(May 20 2021 at 13:41)</a>:</h4>
<p>no differences with <a href="https://inferno-qa.healthit.gov/">https://inferno-qa.healthit.gov/</a></p>



<a name="239593093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239593093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239593093">(May 20 2021 at 13:42)</a>:</h4>
<p>So is that what we are expecting/wanting?</p>



<a name="239593185"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239593185" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239593185">(May 20 2021 at 13:42)</a>:</h4>
<p>mmhh...that means that the object retrieved using the ARC client is not the same of that obtained and processed by the validator...</p>



<a name="239594374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239594374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239594374">(May 20 2021 at 13:50)</a>:</h4>
<p>I think I'm not quite following all of this discussion.  Remind me what the ARC client is?  We can also do something about resolving the  'code "J01CA" is not valid' error.  I can add support for that (and whatever other ATC codes that we know we need at the moment) to <a href="http://tx.fhir.org">tx.fhir.org</a>.</p>



<a name="239594579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239594579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239594579">(May 20 2021 at 13:51)</a>:</h4>
<p>..ARC is just another REST Client..</p>



<a name="239594825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239594825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239594825">(May 20 2021 at 13:53)</a>:</h4>
<p>for the ATC code I'll send to you the missing codes</p>



<a name="239596436"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239596436" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen MacVicar <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239596436">(May 20 2021 at 14:02)</a>:</h4>
<p>When I try to validate just the Composition from the Bundle, I get errors. Which means that it doesn't fit the profile, so it doesn't satisfy the condition for the composition slice of the Bundle. So it seems like a valid error to me.</p>



<a name="239598288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239598288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239598288">(May 20 2021 at 14:13)</a>:</h4>
<p>The only way that you could successfully validate the Composition independently is if the validator is able to resolve all of the section.entry references and can check the referred to resource instances to determine if all of the profile constraints are being satisfied  - which I don't believe will be possible.  That's why we would validate the Composition as part of the entire bundle.</p>



<a name="239610398"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239610398" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239610398">(May 20 2021 at 15:23)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="191415">@Giorgio Cangioli</span> The inferno-qa server is not updated to the latest fix yet. There is a problem for the current Composition validation. When Inferno test the receiving bundle, it validates each entry of the bundle individually. That is fine for all entry except Composition since Composition has some mandatory section.reference values with specific profiles (slicing by profile). Validator could not validates those references with Composition itself only. We have a fix for that but it is on my dev branch and not merged to deployment branch yet. We will complete the code reviews and deployment hopefully this or next week. I will let you know when that is done.</p>



<a name="239618784"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/207835-IPS/topic/%24document/near/239618784" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Giorgio Cangioli <a href="https://fhir.github.io/chat-archive/stream/207835-IPS/topic/.24document.html#239618784">(May 20 2021 at 16:15)</a>:</h4>
<p>Great ! <br>
I'd like to advertise inferno in my affiliate, let me know when I should do it</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
