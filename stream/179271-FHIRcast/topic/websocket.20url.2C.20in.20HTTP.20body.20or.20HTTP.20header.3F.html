---
layout: page
title: "FHIR Chat  · websocket url, in HTTP body or HTTP header? · FHIRcast"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/index.html">FHIRcast</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html">websocket url, in HTTP body or HTTP header?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="181936825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/181936825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#181936825">(Nov 26 2019 at 16:09)</a>:</h4>
<p>When a FHIRcast client requests and is granted a new websocket subscription, the Hub returns a <code>wss://</code> url which the client subsequently connects to and event notifications are sent over.</p>



<a name="181936879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/181936879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#181936879">(Nov 26 2019 at 16:10)</a>:</h4>
<p>Both in our <a href="https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal" target="_blank" title="https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal">informal wiki writeup</a> and in our <a href="http://fhircast.org/specification/Feb2020Ballot/" target="_blank" title="http://fhircast.org/specification/Feb2020Ballot/">draft websocket spec</a>, the Hub returns this wss url in the body of the HTTP response.</p>



<a name="181936884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/181936884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#181936884">(Nov 26 2019 at 16:10)</a>:</h4>
<p>On a recent II call, <span class="user-mention" data-user-id="202436">@Bill Wallace</span> recommended that this wss url is returned to the subscribing client, not in the HTTP body, but rather in the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location">Content-Location</a> HTTP header. Bill made the point that this would make FHIRcast a bit more consistent with <a href="http://dicom.nema.org/medical/dicom/current/output/html/part18.html#sect_9.4.3" target="_blank" title="http://dicom.nema.org/medical/dicom/current/output/html/part18.html#sect_9.4.3">DICOM's use of websockets</a> (which do the same thing). Re-using an existing HTTP header also feels classy and a bit more RESTful. My understanding of Content-Location is that this would be an appropriate use of the header. I've <a href="https://github.com/HL7/fhircast-docs/pull/303" target="_blank" title="https://github.com/HL7/fhircast-docs/pull/303">written up a PR</a> to make this change to our draft websockets spec.</p>



<a name="181936892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/181936892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#181936892">(Nov 26 2019 at 16:10)</a>:</h4>
<p>Does anyone have feedback or concern about this change? Especially if you've already developed support for websockets? (<span class="user-mention" data-user-id="196152">@George Kustas</span> , <span class="user-mention" data-user-id="192821">@Martin Bellehumeur</span> , <span class="user-mention" data-user-id="194364">@Leo Bergnéhr</span> , <span class="user-mention" data-user-id="194356">@Will Maethner</span> , <span class="user-mention" data-user-id="219196">@Wouter Devriendt</span> )</p>



<a name="181944549"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/181944549" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George Kustas <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#181944549">(Nov 26 2019 at 17:33)</a>:</h4>
<p>Sounds OK to me, but there are several implementations working now that will need to change. I think that is OK, since we’re all in “RSNA demo code” now. We’ll have to make a video and share it. Lots happening!</p>



<a name="182663048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/182663048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Bellehumeur (Visage Imaging) <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#182663048">(Dec 05 2019 at 14:21)</a>:</h4>
<blockquote>
<p>Does anyone have feedback or concern about this change? Especially if you've already developed support for websockets? (<span class="user-mention silent" data-user-id="196152">George Kustas</span> , <span class="user-mention silent" data-user-id="192821">Martin Bellehumeur</span> , <span class="user-mention silent" data-user-id="194364">Leo Bergnéhr</span> , <span class="user-mention silent" data-user-id="194356">Will Maethner</span> , <span class="user-mention silent" data-user-id="219196">Wouter Devriendt</span> )</p>
</blockquote>
<p>For us it will require a change that could take some time.  I have filed the request.</p>



<a name="182663230"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/182663230" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Bellehumeur (Visage Imaging) <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#182663230">(Dec 05 2019 at 14:23)</a>:</h4>
<p>Congrats to <span class="user-mention" data-user-id="196152">@George Kustas</span>  for the launch of Powercast at RSNA.  I think the first FHIRcast hub on the market.  You’re a pioneer! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="182677533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/182677533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George Kustas <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#182677533">(Dec 05 2019 at 16:39)</a>:</h4>
<p>Team effort from <span class="user-mention" data-user-id="192821">@Martin Bellehumeur</span> , <span class="user-mention" data-user-id="194360">@Niklas Svenzén</span> ,  Barco,  Primordial and more who really pulled it all together to show FhirCast  do it's thing. Context sharing off course, but also two-way clinical findings updates (including measurements).</p>



<a name="190772020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/190772020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George Kustas <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#190772020">(Mar 16 2020 at 19:57)</a>:</h4>
<p>I am finally implementing this in our hub and running into a problem. It appears that only "http" and "https" are valid in the content-location. The client is throwing the exception. Any suggestions <span class="user-mention" data-user-id="192821">@Martin Bellehumeur</span> , <span class="user-mention" data-user-id="202436">@Bill Wallace</span> , <span class="user-mention" data-user-id="191864">@Isaac Vetter</span></p>



<a name="190773193"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/190773193" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George Kustas <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#190773193">(Mar 16 2020 at 20:06)</a>:</h4>
<p>after reading this, I'm not so sure that we should be using content-location for the websocket connection endpoint: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location</a></p>



<a name="190777103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/190777103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#190777103">(Mar 16 2020 at 20:41)</a>:</h4>
<p>In general, there doesn't seem to be a restriction on the URI protocol that can be used in content-location. Whether that header is the appropriate place for the websocket URL, I don't know. One thing to consider might be the difference in <a href="https://en.wikipedia.org/wiki/HTTP/1.1_Upgrade_header#Use_with_WebSocket" target="_blank" title="https://en.wikipedia.org/wiki/HTTP/1.1_Upgrade_header#Use_with_WebSocket">HTTP 1.1</a> and <a href="https://tools.ietf.org/html/rfc8441" target="_blank" title="https://tools.ietf.org/html/rfc8441">HTTP/2</a> in the way the websocket connection is bootstrapped...</p>



<a name="190791247"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/190791247" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George Kustas <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#190791247">(Mar 16 2020 at 23:09)</a>:</h4>
<p>The fact that using it caused an exception in the Microsoft .Net implemented library worries me. I don't think we're using it as intended. Perhaps this would be a better alternative: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-WebSocket-Accept" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-WebSocket-Accept">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-WebSocket-Accept</a>. But I would rather keep it in the body for now.</p>



<a name="190816735"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/190816735" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Bellehumeur (Visage Imaging) <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#190816735">(Mar 17 2020 at 08:08)</a>:</h4>
<p>I tested against sandbox.js and my PACS client gets the content-location header.  Which hub have you added to?  I tried connect and connect2 but did not see the header set.</p>



<a name="190845531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/190845531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George Kustas <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#190845531">(Mar 17 2020 at 13:18)</a>:</h4>
<p>INtertesting... What library is your client using? IS that javascript?</p>



<a name="201029961"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/201029961" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#201029961">(Jun 16 2020 at 15:13)</a>:</h4>
<p>Hey Guys - sorry for the ridiculously late response. <span class="user-mention" data-user-id="196152">@George Kustas</span>, this is excellent feedback. I think that the last thing we want to do is have the base spec be incompatible with a framework as common as .Net's HttpClient. </p>
<p><span class="user-mention" data-user-id="192821">@Martin Bellehumeur</span> - any concern with switching back to the response body?</p>
<h1>Background</h1>
<p>In <a href="https://github.com/HL7/fhircast-docs/pull/303">PR#303</a>, we updated the Subscription Response from the Hub to return a websocket wss: url via the Content-Location header; however, this causes some issues with web communication patterns in .NET Framework. Basically, when using the Framework HttpClient class and SendAsync, if Content-Location is set on a response, the HttpClient will reset the URI of the request to the value of the Content-Location header (like a redirect). This causes issues when our content location is a "wss://" prefixed URI because the HttpClient only accepts "http://" or "https://" protocols, obviously. There doesn't appear to be a reasonable way to work around this issue with HttpClient, even using a configurable HttpClientHandler.</p>



<a name="201368980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/201368980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Bellehumeur (Visage Imaging) <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#201368980">(Jun 19 2020 at 09:30)</a>:</h4>
<p>Hi Isaac, I have no concerns with switching back to the response body.</p>



<a name="209787898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179271-FHIRcast/topic/websocket%20url%2C%20in%20HTTP%20body%20or%20HTTP%20header%3F/near/209787898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179271-FHIRcast/topic/websocket.20url.2C.20in.20HTTP.20body.20or.20HTTP.20header.3F.html#209787898">(Sep 11 2020 at 14:31)</a>:</h4>
<p>PR here: <a href="https://github.com/HL7/fhircast-docs/pull/333">https://github.com/HL7/fhircast-docs/pull/333</a> <br>
cc/ <span class="user-mention" data-user-id="194452">@Bas van den Heuvel</span> , <span class="user-mention" data-user-id="196152">@George Kustas</span> , <span class="user-mention" data-user-id="238450">@Endre Berki</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
