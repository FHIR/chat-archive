---
layout: page
title: "FHIR Chat  · Java validator picks wrong version? · argonaut"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/index.html">argonaut</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html">Java validator picks wrong version?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="247049127"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247049127" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247049127">(Jul 24 2021 at 01:28)</a>:</h4>
<p>I run latest java validator against a Provenance resource</p>
<div class="codehilite"><pre><span></span><code>java -jar validator_cli_5.4.9.jar -version 4.0.1 -ig hl7.fhir.us.core -profile http://hl7.org/fhir/us/core/StructureDefinition/us-core-provenance provenance-1.xml
</code></pre></div>
<p>I got a strange error</p>
<div class="codehilite"><pre><span></span><code>  Validate provenance-1.xmlValidation Infrastructure fail validating provenance-1.xml: Problem processing expression ($this.agent.who.resolve().is Practitioner or Device) implies exists() in profile http://hl7.org/fhir/us/core/StructureDefinition/us-core-provenance path Provenance.agent[0].onBehalfOf: Error @1, 2: Found Practitioner expecting a &quot;)&quot;
Exception in thread &quot;main&quot; org.hl7.fhir.exceptions.FHIRException: org.hl7.fhir.exceptions.FHIRException: Problem processing expression ($this.agent.who.resolve().is Practitioner or Device) implies exists() in profile http://hl7.org/fhir/us/core/StructureDefinition/us-core-provenance path Provenance.agent[0].onBehalfOf: Error @1, 2: Found Practitioner expecting a &quot;)&quot;
    at org.hl7.fhir.validation.ValidationEngine.validate(ValidationEngine.java:339)
    at org.hl7.fhir.validation.cli.services.ValidationService.validateSources(ValidationService.java:91)
    at org.hl7.fhir.validation.ValidatorCli.doValidation(ValidatorCli.java:238)
    at org.hl7.fhir.validation.ValidatorCli.main(ValidatorCli.java:159)
</code></pre></div>
<p>When I look the header of the log, I notice a strange version (US Core v3.1.0) is used for validation</p>
<div class="codehilite"><pre><span></span><code>  Load FHIR v4.0 from hl7.fhir.r4.core#4.0.1 - 4575 resources (00:03.0904)
  Load hl7.terminology#2.1.0 - 3767 resources (00:01.0078)
  Terminology server http://tx.fhir.org - Version 1.9.378 (00:01.0239)
  Load hl7.fhir.us.core#3.1.0 - 143 resources (00:00.0042)
</code></pre></div>
<p>The validator document says when NOT specifing a version, the _current published version_ of the IG is used.<br>
The current published version of US Core is 4.0.0 not 3.1.0</p>
<p>So the question is why validator pulls US Core v3.1.0 as "current published version"?<br>
<span class="user-mention" data-user-id="191401">@Eric Haas</span> <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span></p>



<a name="247049406"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247049406" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247049406">(Jul 24 2021 at 01:36)</a>:</h4>
<p>That seems like a package server issue - <span class="user-mention" data-user-id="248736">@Mark Iantorno</span> ?</p>



<a name="247186142"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247186142" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247186142">(Jul 26 2021 at 10:38)</a>:</h4>
<p>hrm that's no good</p>



<a name="247186149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247186149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247186149">(Jul 26 2021 at 10:39)</a>:</h4>
<p>I"ll look into it this morning</p>



<a name="247186243"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247186243" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247186243">(Jul 26 2021 at 10:40)</a>:</h4>
<p>So the fhir version is fine, it's the us core version profile version that's the incorrect one, right?</p>



<a name="247201379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247201379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247201379">(Jul 26 2021 at 13:25)</a>:</h4>
<p>Yes. US Core is default set to v3.1.0. The correct default version (current published) is v4.0.0</p>



<a name="247205248"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247205248" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247205248">(Jul 26 2021 at 13:55)</a>:</h4>
<p>So, strangely enough, when I run that command:</p>



<a name="247205255"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247205255" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247205255">(Jul 26 2021 at 13:55)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  Load hl7.terminology#2.1.0 - 3767 resources (00:02.0823)
  Terminology server http://tx.fhir.org - Version 1.9.378 (00:01.0434)
  Load hl7.fhir.us.core#1.0.1 - 52 resources (00:00.0015)
  Get set...  go (00:00.0518)
</code></pre></div>



<a name="247205264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247205264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247205264">(Jul 26 2021 at 13:55)</a>:</h4>
<p>I get v1.0.1</p>



<a name="247205276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247205276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247205276">(Jul 26 2021 at 13:55)</a>:</h4>
<p>which is also not correct</p>



<a name="247205912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247205912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247205912">(Jul 26 2021 at 14:00)</a>:</h4>
<p><span class="user-mention" data-user-id="203235">@Ward Weistra</span> any reason why the latest package would be incorrect?</p>



<a name="247217369"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247217369" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247217369">(Jul 26 2021 at 15:20)</a>:</h4>
<p><span class="user-mention" data-user-id="248736">@Mark Iantorno</span> I don't think it's anything in the FHIR registry mechanics that does this. FHIR Package API (<a href="https://app.swaggerhub.com/apis-docs/firely/Simplifier.net_FHIR_Package_API/1.0.1#/default/get__package_name_">https://app.swaggerhub.com/apis-docs/firely/Simplifier.net_FHIR_Package_API/1.0.1#/default/get__package_name_</a>) nicely lists 4.0.0 as the latest.</p>
<p>Searching on Registry UI also gives you latest package for this: <a href="https://registry.fhir.org/results?query=%22http%3A%2F%2Fhl7.org%2Ffhir%2Fus%2Fcore%2FStructureDefinition%2Fus-core-provenance%22&amp;latestFilter=true">https://registry.fhir.org/results?query=%22http%3A%2F%2Fhl7.org%2Ffhir%2Fus%2Fcore%2FStructureDefinition%2Fus-core-provenance%22&amp;latestFilter=true</a>. Though IF the Java validator is getting this from the package ecosystem, which I'm not sure about, it would of course be using the API. There's a specific catalog search endpoint to search on canonical or other terms, which would be perfect for this.</p>
<p>I remember overhearing there's some specific US realm logic in the IG Publisher (perhaps Java validator too?), perhaps it is somewhere in there?</p>



<a name="247217474"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247217474" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247217474">(Jul 26 2021 at 15:21)</a>:</h4>
<p>Or, given that it's different for both of you, it could be package cache related? Could just empty your package cache to be sure.</p>



<a name="247218378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247218378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247218378">(Jul 26 2021 at 15:27)</a>:</h4>
<p>Interesting. It works after empty package cache. Thanks <span class="user-mention" data-user-id="203235">@Ward Weistra</span></p>



<a name="247222646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247222646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247222646">(Jul 26 2021 at 15:58)</a>:</h4>
<p>I run some tests with different version of US Core. Here is the steps:</p>
<p>clean package cache<br>
run validator_cli.jar with <code>-ig hl7.fhir.us.core</code><br>
validator loaded <code>hl7.fhir.us.core#4.0.0</code> -- ok<br>
run validator_cli.jar with <code>-ig hl7.fhir.us.core#3.1.1</code><br>
validator loaded <code>hl7.fhir.us.core#3.1.1</code> -- ok<br>
run validator_cli.jar with <code>-ig hl7.fhir.us.core</code><br>
validator loaded <code>hl7.fhir.us.core#3.1.1</code> -- NOT ok<br>
run validator_cli.jar with <code>-ig hl7.fhir.us.core#3.1.0</code><br>
validator loaded <code>hl7.fhir.us.core#3.1.0</code> -- ok<br>
run validator_cli.jar with <code>-ig hl7.fhir.us.core</code><br>
validator loaded <code>hl7.fhir.us.core#3.1.0</code> -- NOT ok<br>
run validator_cli.jar with <code>-ig hl7.fhir.us.core#3.2.0</code><br>
validator loaded <code>hl7.fhir.us.core#3.2.0</code> -- ok<br>
run validator_cli.jar with <code>-ig hl7.fhir.us.core</code><br>
validator loaded <code>hl7.fhir.us.core#3.1.0</code> -- NOT ok<br>
remove hl7.fhir.us.core#3.1.0 from package cache<br>
run validator_cli.jar with <code>-ig hl7.fhir.us.core</code><br>
validator loaded <code>hl7.fhir.us.core#3.1.1</code> -- NOT ok</p>
<p>For the results, I found that when there are multiple versions in package cache, the validator always pick the lowest version not the highest. Is this a validator bug?</p>



<a name="247238476"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247238476" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247238476">(Jul 26 2021 at 17:59)</a>:</h4>
<p>package cache strikes again!</p>



<a name="247238485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247238485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247238485">(Jul 26 2021 at 17:59)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="203235">@Ward Weistra</span></p>



<a name="247238647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247238647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247238647">(Jul 26 2021 at 18:00)</a>:</h4>
<p>I am unsure of the code implications of this <span class="user-mention" data-user-id="191506">@Yunwei Wang</span> , but can you get by just clearing your cache for now</p>



<a name="247240497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247240497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247240497">(Jul 26 2021 at 18:12)</a>:</h4>
<p>I did it again. It is the same result. </p>
<p>clear package cache<br>
run validator_cli.jar with -ig hl7.fhir.us.core<br>
validator loaded hl7.fhir.us.core#4.0.0 -- ok<br>
run validator_cli.jar with -ig hl7.fhir.us.core#3.1.1<br>
validator loaded hl7.fhir.us.core#3.1.1 -- ok<br>
run validator_cli.jar with -ig hl7.fhir.us.core<br>
validator loaded hl7.fhir.us.core#3.1.1 -- NOT ok</p>
<p>I don't know why the last validation uses the v3.1.1 instead of v4.0.0<br>
<span class="user-mention" data-user-id="248736">@Mark Iantorno</span></p>



<a name="247241297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247241297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247241297">(Jul 26 2021 at 18:18)</a>:</h4>
<p>Okay, but can you get it to work the way you want</p>



<a name="247241333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247241333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247241333">(Jul 26 2021 at 18:18)</a>:</h4>
<p>Like, if you clear the cache and then run it with the version you need, does it work?</p>



<a name="247241381"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247241381" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Iantorno <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247241381">(Jul 26 2021 at 18:19)</a>:</h4>
<p>or, are you saying that your use case involves multiple runs with different versions</p>



<a name="247245116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247245116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247245116">(Jul 26 2021 at 18:48)</a>:</h4>
<p>Yes. I can get it work. I will create a JIRA ticket for the multiple versions issue. Thanks</p>



<a name="247319891"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247319891" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247319891">(Jul 27 2021 at 11:16)</a>:</h4>
<p><span class="user-mention" data-user-id="248736">@Mark Iantorno</span> <a href="https://martinfowler.com/bliki/TwoHardThings.html">https://martinfowler.com/bliki/TwoHardThings.html</a></p>
<blockquote>
<p>There are only two hard things in Computer Science: cache invalidation and naming things.</p>
</blockquote>



<a name="247356776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Java%20validator%20picks%20wrong%20version%3F/near/247356776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F.html#247356776">(Jul 27 2021 at 16:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="203235">Ward Weistra</span> <a href="#narrow/stream/179175-argonaut/topic/Java.20validator.20picks.20wrong.20version.3F/near/247319891">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="248736">Mark Iantorno</span> <a href="https://martinfowler.com/bliki/TwoHardThings.html">https://martinfowler.com/bliki/TwoHardThings.html</a></p>
<blockquote>
<p>There are only two hard things in Computer Science: cache invalidation, naming things, and off-by-one errors.</p>
</blockquote>
</blockquote>
<p>Fixed it for you!  <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
