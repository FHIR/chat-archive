---
layout: page
title: "FHIR Chat  · FHIR-27905: search by reference · argonaut"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/index.html">argonaut</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html">FHIR-27905: search by reference</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="214213554"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214213554" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214213554">(Oct 22 2020 at 16:38)</a>:</h4>
<p>in  <a href="http://jira.hl7.org/browse/FHIR-27905">J#27905</a> <span class="user-mention" data-user-id="192576">@Robert Scanlon</span>  asked to  Clarify search by reference conformance expectations</p>
<p>What do implementers think is minimum needed?</p>
<p>e.g. : add bullet in <a href="http://build.fhir.org/ig/HL7/US-Core/general-guidance.html#search-syntax">Search Syntax</a> to say...( paraphasing )</p>
<p>search by reference ... Patient/123 or just 123 or [base]/Patient/123</p>
<p>more formally stated as :</p>
<ul>
<li>note for values of type <code>reference</code> (how to search by <a href="#.html">reference</a>), the syntax {base}/{Type}/[id] means that the base url and Type values (where unambiguous*) are optional <em>for the client</em> to supply</li>
</ul>
<p>"where unambiguous"  means for a search parameter like <code>patient</code> the Type is assumed to be Patient.  For a search parameter of <code>subject</code> it cannot be assumed.</p>



<a name="214246429"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214246429" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214246429">(Oct 22 2020 at 20:51)</a>:</h4>
<p>How do people feel about stating that formally in terms of server requirements?  The server SHALL support search values of type reference of the form [base]/[Type]/[id] and [Type]/[id] in all cases.  The server SHALL support search values of type reference of the form [id] where Type is unambiguous.</p>



<a name="214246968"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214246968" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214246968">(Oct 22 2020 at 20:55)</a>:</h4>
<p>I worry that people may interpret what 'optional for the client' means in terms of server requirements differently.  Unless somewhere it is stated that 'optional for client' means 'required for server' at all times... though that seems like a dangerous statement.</p>



<a name="214248138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214248138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214248138">(Oct 22 2020 at 21:05)</a>:</h4>
<blockquote>
<p>The server SHALL support search values of type reference of the form [base]/[Type]/[id] and [Type]/[id] in all cases. The server SHALL support search values of type reference of the form [id] where Type is unambiguous.</p>
</blockquote>
<p>Can you give examples of these (apparently) three different cases? I am not sure I follow...</p>



<a name="214249075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214249075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214249075">(Oct 22 2020 at 21:14)</a>:</h4>
<ol>
<li><code>https://example.com/fhir/Procedure?patient=5</code></li>
<li><code>https://example.com/fhir/Procedure?patient=Patient/5</code></li>
<li><code>https://example.com/fhir/Procedure?patient=https://example.com/fhir/Patient/5</code></li>
</ol>



<a name="214255391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214255391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214255391">(Oct 22 2020 at 22:24)</a>:</h4>
<p>Thanks. Would the proposed rules apply to any and all references? Only the ones marked Must Support? Specific references only?</p>



<a name="214255586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214255586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214255586">(Oct 22 2020 at 22:26)</a>:</h4>
<p>only the searchparameters of type <code>reference</code> that are named in the guide:  eg: AllergyIntolerance <code>patient</code> parameter</p>



<a name="214572408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214572408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214572408">(Oct 26 2020 at 13:26)</a>:</h4>
<p>Do <strong>Patient/5</strong> and <strong>https://example.com/fhir/Patient/5</strong> and mean different things?  Or should the server treat them as if they were the same?  I.e. if the resource on the server is using a relative URL in the reference, should it only find results if the relative reference is provided?  Of should the server normalize the received search value and normalize the references in the resources and then do the search by comparing the normalized values?</p>
<p>I'm not sure I like having a server attempt to normalize the value received in the search parameter.  Some references may be local to that logical FHIR server, but some might refer to an external FHIR server, so you'd then have to figure out when to normalize and when not to.  But if you don't normalize, then if some resources have a full URL, and some just have the relative part, you'll probably only get a subset of what you expect.</p>



<a name="214575616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214575616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214575616">(Oct 26 2020 at 13:52)</a>:</h4>
<p>We assume that the server knows its own base URL, and normalizes if and only if the URL matches that.</p>



<a name="214580161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214580161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214580161">(Oct 26 2020 at 14:27)</a>:</h4>
<p>Knowing your own base URL is tricky when you have reverse proxies, load-balanced VIPs, API managers etc.  Especially if those are managed by a different entity than  the one that manages the FHIR server.   This has been a problem for us in other areas already.</p>



<a name="214581668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214581668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214581668">(Oct 26 2020 at 14:38)</a>:</h4>
<p>Yes, that has been a complete nuisance for us as well. We've done full URL rewriting in a proxy layer, but that's a layer we control.</p>



<a name="214599275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214599275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214599275">(Oct 26 2020 at 16:38)</a>:</h4>
<p>Are you re-writing in your HTTP response bodies as well?  I get re-writing stuff in the URL and HTTP headers, but trying to re-write everything in the actual body sounds terrible.  And if/when we support signing FHIR resources, that would break signatures.</p>



<a name="214600410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214600410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214600410">(Oct 26 2020 at 16:45)</a>:</h4>
<p>Yes. This isn't actually a production solution yet, but it rewrites URLs in the response body. In a typical deployment, the actual full URL of the GCP FHIR store is an internal implementation detail that the customer will not want to expose outside of the proxy and may not remain stable over time anyway.</p>



<a name="214605973"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214605973" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214605973">(Oct 26 2020 at 17:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191764">Cooper Thompson</span> <a href="#narrow/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference/near/214572408">said</a>:</p>
<blockquote>
<p>Do <strong>Patient/5</strong> and <strong>https://example.com/fhir/Patient/5</strong> and mean different things?  Or should the server treat them as if they were the same?  I.e. if the resource on the server is using a relative URL in the reference, should it only find results if the relative reference is provided?  Of should the server normalize the received search value and normalize the references in the resources and then do the search by comparing the normalized values?</p>
<p>I'm not sure I like having a server attempt to normalize the value received in the search parameter.  Some references may be local to that logical FHIR server, but some might refer to an external FHIR server, so you'd then have to figure out when to normalize and when not to.  But if you don't normalize, then if some resources have a full URL, and some just have the relative part, you'll probably only get a subset of what you expect.</p>
</blockquote>
<p>I would like your opinion on this,  This is to guide the client on allowed formats - so if the relative reference and absolute reference mean different things - The client needs to know this.</p>



<a name="214623713"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214623713" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214623713">(Oct 26 2020 at 19:45)</a>:</h4>
<p>We also do the symmetric thing, a full URL reference in a resource will match a search for Patient/5 if the URL begins with the server's base URL. I would recommend that app clients always search for Patient/5, which puts the burden on the other side (whoever is writing the resources) to get it right.</p>



<a name="214632492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214632492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214632492">(Oct 26 2020 at 21:00)</a>:</h4>
<p>From our (Epic) perspective, right now we just support the raw ID (patient=5), and we always assume that the ID is relative to our logical server, and we don't address the subject issue.  Our logical server can be known by many different URLs, but we need to know all the URLs we are known as to generate fullUrl for search bundles anyway, so it isn't a hard problem to accept an absolute URL reference and chop off the URL part.  </p>
<p>I personally think it would be nice if we could get rid of absolute URLs in the REST API, and to my knowledge fullUrl in the search bundle is the big annoying one.  However if we normalize reference searching to require the full URL format, then we're adding in another absolute URL requirement, and I'd rather we remove them.  </p>
<p>I'm not bothered about Patient/5 vs. 5 for distinguishing the resource type of the subject you want, though it seems like a token-style syntax would be better there.  It seems like Reference.type (ResourceType) is really the qualifier we want, but because of the REST API URL structure, that is I think entirely redundant with the path components of the reference.</p>



<a name="214655161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214655161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214655161">(Oct 27 2020 at 02:22)</a>:</h4>
<p>Agree that a good base, and what I've seen in the wild, is the unqualified patient=X</p>



<a name="214655169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214655169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214655169">(Oct 27 2020 at 02:22)</a>:</h4>
<p>I would definitely be interested in reasons why this might be hard on a client app</p>



<a name="214655190"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214655190" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214655190">(Oct 27 2020 at 02:23)</a>:</h4>
<p>when FHIR supported the old subject param everywhere, we saw a lot of variation (and mistakes) in the way those parameters were used, but patient simplified this and removed a lot of the deviation we saw in applications.</p>



<a name="214708949"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214708949" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214708949">(Oct 27 2020 at 14:43)</a>:</h4>
<p>I have no objection to patient=5. The only caveat is "Servers SHOULD reject a search where the logical id refers to more than one matching resource across different types"  but that isn't likely to come up often.</p>



<a name="214709192"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214709192" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214709192">(Oct 27 2020 at 14:45)</a>:</h4>
<blockquote>
<p>I would definitely be interested in reasons why this might be hard on a client app</p>
</blockquote>
<p>From a generic client library perspective, <code>reference_param=Type/id</code> should always work when searching by any reference, while <code>reference_param=id</code> may or may not work depending on if that parameter applies to multiple types.  So I can <strong>imagine</strong> some generic FHIR clients being explicit about the type always as a rule , and being surprised they have to understand that the parameter only applies to one type and therefore they can't prepend the type to the id always, automatically.</p>



<a name="214709348"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214709348" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214709348">(Oct 27 2020 at 14:46)</a>:</h4>
<p>I stress <strong>imagine</strong> because the client library I've worked on does not do this, and I would be surprised if the popular java, .net, and javascript libraries do this today (though I haven't looked deeply at them in some time).</p>



<a name="214709514"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214709514" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214709514">(Oct 27 2020 at 14:47)</a>:</h4>
<p>Also, the language in the <a href="https://www.hl7.org/fhir/search.html#reference">search section</a> is a little loose on if <code>reference_param=Type/id</code> is always expected to work or only will work in cases where the type is ambiguous, so that may be another count against this imagined scenario.</p>



<a name="214709923"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214709923" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214709923">(Oct 27 2020 at 14:49)</a>:</h4>
<p>I think the explicit type should always be allowed and the language clarified if necessary. There's no value in disallowing it for unambiguous types.</p>



<a name="214710929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/FHIR-27905%3A%20search%20by%20reference/near/214710929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/FHIR-27905.3A.20search.20by.20reference.html#214710929">(Oct 27 2020 at 14:55)</a>:</h4>
<p>I would hope it is not much of a burden to accept both forms on unambiguous types to provide a little more leeway on the client side.  But I recognize it is more stuff to maintain if there aren't any cases where there are ambiguous types (in US Core, today).</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
