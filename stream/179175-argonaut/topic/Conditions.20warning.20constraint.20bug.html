---
layout: page
title: "FHIR Chat  · Conditions warning constraint bug · argonaut"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/index.html">argonaut</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html">Conditions warning constraint bug</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="273902879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/273902879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#273902879">(Mar 03 2022 at 00:36)</a>:</h4>
<p>Hello, I think there's a bug in the UsCoreCondition warning constraint:<br>
<code>where(category.memberOf('http://hl7.org/fhir/us/core/ValueSet/us-core-condition-category')).exists()</code></p>
<p>AFAIKT, memberOf is not defined for repeated fields.</p>
<p>Should this instead be<br>
<code>category.where(memberOf('http://hl7.org/fhir/us/core/ValueSet/us-core-condition-category')).exists()</code><br>
?</p>



<a name="273993223"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/273993223" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#273993223">(Mar 03 2022 at 15:57)</a>:</h4>
<p>@GG ? or any other FHIR path wizards can you confirm?</p>



<a name="274037654"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/274037654" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#274037654">(Mar 03 2022 at 20:49)</a>:</h4>
<p>from <a href="https://hl7.org/fhirpath/#functions">https://hl7.org/fhirpath/#functions</a></p>
<blockquote>
<p>With a few minor exceptions (e.g. the today() function), functions in FHIRPath always operate on a collection of values (referred to as the input collection) and produce another collection as output (referred to as the output collection), even though these may be collections of just a single item.</p>
</blockquote>



<a name="274038298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/274038298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#274038298">(Mar 03 2022 at 20:54)</a>:</h4>
<p>but i'm not actually sure if that applies here or not.  i've always been confused about when you need a .where and when you dont</p>



<a name="274041065"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/274041065" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#274041065">(Mar 03 2022 at 21:15)</a>:</h4>
<p>FWIW, I checked our implementation and our memberOf function wants a singleton input collection as well, so I think nick is right that <code>category.where(memberOf('http://hl7.org/fhir/us/core/ValueSet/us-core-condition-category')).exists()</code> would be the better option. <br>
would still be interested in hearing confirmation that this is "correct" though</p>



<a name="274043275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/274043275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#274043275">(Mar 03 2022 at 21:31)</a>:</h4>
<p>If we assume that <code>category.memberOf</code> returns a collection, it would presumably be like <code>{true, false, false}</code>.... I still think <br>
<code>where({true, false, false})</code><br>
would be invalid?  I.e., the arg to where should be a condition to evaluate per element, not a collection of bools, IIUC</p>



<a name="274058340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/274058340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#274058340">(Mar 03 2022 at 23:51)</a>:</h4>
<p>(deleted)</p>



<a name="274423356"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/274423356" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#274423356">(Mar 07 2022 at 17:08)</a>:</h4>
<p>Should I file this as an issue in Jira?  pull request in github?  sorry, haven't contributed much to US core yet...</p>



<a name="274428430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/274428430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#274428430">(Mar 07 2022 at 17:39)</a>:</h4>
<p>Jira tracker please</p>



<a name="275545573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/275545573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#275545573">(Mar 16 2022 at 17:10)</a>:</h4>
<p><span class="user-mention" data-user-id="196561">@Nick George</span> did you ever open an issue for this one?  I re-raised it at <a href="#narrow/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F">https://chat.fhir.org/#narrow/stream/179266-fhirpath/topic/do.20all.20functions.20work.20on.20repeating.20fields.3F</a> but didn't open anything yet (for either "what should functions do by default when its not specified what to do for an input collection" or for this particular expression)</p>



<a name="275545686"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/275545686" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#275545686">(Mar 16 2022 at 17:11)</a>:</h4>
<p>I was reminded of it because I found another US Core expression with a similar issue (provenance-1)...I did open an issue for that one</p>



<a name="275689384"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/275689384" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#275689384">(Mar 17 2022 at 16:45)</a>:</h4>
<p>please log a tracker</p>



<a name="275707493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179175-argonaut/topic/Conditions%20warning%20constraint%20bug/near/275707493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179175-argonaut/topic/Conditions.20warning.20constraint.20bug.html#275707493">(Mar 17 2022 at 18:40)</a>:</h4>
<p><a href="http://jira.hl7.org/browse/FHIR-36328">FHIR-36328</a> is the one I had opened for that provenance-1 issue.</p>
<p>Now I submitted <a href="http://jira.hl7.org/browse/FHIR-36336">FHIR-36336</a> for this Condition one, but I accidentally hit submit before finishing the title.  should be "Problematic fhirpath in Condition Profile constraint us-core-1"</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
