---
layout: page
title: "FHIR Chat  · How to register in the CommonTrust Network · smart/health-cards"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/index.html">smart/health-cards</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html">How to register in the CommonTrust Network</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="250727241"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250727241" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Snow <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250727241">(Aug 26 2021 at 06:07)</a>:</h4>
<p>I'm a week or two into my journey of building out VCI SMART Health Cards for the 19 immunization registries we represent as a vendor. I'm struggling to figure out how to get the state registries we represent registered in the CommonTrust Network.  I see the vci-directory repo, but I'm still unsure how to resolve this.  My questions are</p>
<p>1) Where and how does one register each State Registry (Issuer)?</p>
<p>2) Can we, as an IIS vendor, register on behalf of each jurisdiction?  If so, how would that be set up?  <em>We provide the hosting for most of the registries where this will sit</em></p>
<p>3) I see the form<br>
<a href="https://github.com/the-commons-project/vci-directory/blob/main/VCI%20Directory%20Agreement.pdf">https://github.com/the-commons-project/vci-directory/blob/main/VCI%20Directory%20Agreement.pdf</a></p>
<p>From the requirements, the QR Code I am generating passes the outlined checks via the health-cards-validation-SDK and the VerifierPortal.html.  However, it does fail with "Unsupported QR" when scanning through the SMART Health Card Verifier, so I'm guessing there is still something I need to fix before being able to submit???</p>
<p>SHC Below (QR Code Attached <a href="/user_uploads/10155/-VmRWAhUlhD4EeAg1Ylm9oIx/QRCode-0.png">QRCode-0.png</a> ):<br>
shc:/567629595326546034602925407728043360287028656767542228092862372537602870286471674522280928616339334332065224086144414137380308744003110441427137390544064524376640254560404128055563207745255477416232764062626057360106253333611232742435036952315964117642583866105337416662592922095425650407236939456720502871722930254100263655002465002164533831126922102903082435643926320550565610455050507504206666374272593926642953252063612865572803400340765372247265575600323275041207427175124326097122726241634069124266537121097624237112712342100569640053716860766973327558037122562821032759355300100720661057063865647372610950357445402423353711655744395541437744580445347769096637293959050326346422273167247664062706234340383873725674635432286600417311653173262936764109356961333212743621667500237569722535637405706670540333074437593424232759203431292637590933003728322577770371764043352037352027126468717473236068314575216376392056533258345445637466206445097704547005223406005674654165566163615061406822412341335404414273262256707656084122127700572344732075604064644072112427357559323032547730520629075567062207310527550042594344117566390554674307542768777665030725342969245262691235385520535923457143632272537165322574324222597011562039695812126600317333456142314524102106453203393352635460342035610309573710612374376963116259037410270574626442263860573557765766302008263137446962574568535460374571000577046343500857420457305250670404733453082374202020355050207420016553715230530477370730454545504207416540740852532273755425324156524050664029373832036539673275643231435875054206366706745643302044576244212962654356566134077225047237253820</p>
<div class="message_inline_image"><a href="/user_uploads/10155/-VmRWAhUlhD4EeAg1Ylm9oIx/QRCode-0.png" title="QRCode-0.png"><img src="/user_uploads/10155/-VmRWAhUlhD4EeAg1Ylm9oIx/QRCode-0.png"></a></div>



<a name="250764121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250764121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Denning <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250764121">(Aug 26 2021 at 12:34)</a>:</h4>
<p>I think that Verifier app has a different set of trusted issuers than those listed at <a href="https://raw.githubusercontent.com/the-commons-project/vci-directory/main/vci-issuers.json">https://raw.githubusercontent.com/the-commons-project/vci-directory/main/vci-issuers.json</a> so it probably does not have <a href="https://testing.envisiontechnology.com/HL7SmartHealthCardDemo">https://testing.envisiontechnology.com/HL7SmartHealthCardDemo</a> as an issuer</p>



<a name="250764652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250764652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250764652">(Aug 26 2021 at 12:39)</a>:</h4>
<p>Will see if <span class="user-mention" data-user-id="328301">@JP Pollak</span> can weigh in. The SMART Health Cards Verifier app should happily display information from any spec-conformant issuer (albeit with a warning label if the issue is not part of the configured trust network). The "QR not supported" error is something I would expect only if the QRs contains something other than immunization records.</p>



<a name="250765160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250765160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250765160">(Aug 26 2021 at 12:43)</a>:</h4>
<p>Re: Common Trust, I think the right first step is to get included in the VCI directory. That's a public, transparent resource that serves as an on-ramp into trust networks like common trust.</p>
<p>It sounds like you have already found the VCI Directory application form and are passing the validator, which is a great start.  The states that turn this feature on will be the ones to actually apply for inclusion in the directory; you can help them fill out the forms etc but we will list individual states rather than technology vendors in the VCI directory.</p>



<a name="250776388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250776388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP Pollak <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250776388">(Aug 26 2021 at 14:00)</a>:</h4>
<p>thanks Josh. <span class="user-mention" data-user-id="192608">@Kevin Snow</span> yes to Josh's point about starting with VCI Directory- that's the best onramp into the CommonTrust Network and hopefully it's a quick step to get each state added.</p>



<a name="250776816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250776816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> JP Pollak <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250776816">(Aug 26 2021 at 14:03)</a>:</h4>
<p>also: awesome that you're digging in! :)</p>



<a name="250855522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250855522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Snow <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250855522">(Aug 26 2021 at 23:14)</a>:</h4>
<p>Thanks all.  We verbally communicated with our jurisdictions today that they will need to be the ones that apply and at least gave them a rough idea of what this process will look like.  People had a lot of questions, so we might assist one of the states through the process first; hopefully, soon after that, we'll be able to flush through the rest </p>
<p>Regarding the QR code not scanning in the mobile app, I'll try adjusting the payload to look as close as possible to one of the <a href="https://spec.smarthealth.cards/examples/example-00-b-jws-payload-expanded.json">examples</a>, fingers crossed that it helps pinpoint the difference.</p>
<p>Again, thank you all for the timely response.  It came in handy having that information for our community call.</p>



<a name="250956039"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250956039" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Kizer <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250956039">(Aug 27 2021 at 16:20)</a>:</h4>
<p><span class="user-mention" data-user-id="192608">@Kevin Snow</span> just a shot in the dark, but could you try generating a new SHC with the <code>iss</code> value all lower case?</p>



<a name="250990464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250990464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Snow <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250990464">(Aug 27 2021 at 20:25)</a>:</h4>
<p><span class="user-mention" data-user-id="365368">@James Kizer</span>  Unfortunately, no luck.  I updated the code to use the iss with all lowercase and to also generate as similar as possible to the example <a href="https://spec.smarthealth.cards/examples/example-00-b-jws-payload-expanded.json">here</a>.  The attached screenshot shows minor differences, nothing I can tell that should break it from that. The QR codes passes the VerifierPortal and health-cards-validation-SDK but the mobile app yields the attached screenshot.  I don't know if it helps but the code I'm using for the proof of concept is available on github <a href="https://github.com/snowke/smarthealth-card-immunization-poc/blob/main/src/SMARTHealthCardImmunizationPoC-ConsoleApp/SMARTHealthCardImmunizationPoC-ConsoleApp/Program.cs">here</a>.</p>
<p>I believe the author of the library I'm using is on here.<br>
CC: <span class="user-mention" data-user-id="191391">@Angus Millar</span> </p>
<p>If anyone has any ideas I'd definitely appreciate it.  I'm clearly missing something obvious.</p>
<p>shc:/5676295953265460346029254077280433602870286567675422280928623725376028702864716745222809286163393343320652240861444141373803087440031104414271373905440645243766402545604041280555632077452554774162327640626260573601062531315371707424357641442772412940673444046006342043093421362562734438002421395207702527743008247266520069285600626512593808632905032029085756307322584356103477587706040700572112207536580371403757696660223267330372377757666831036141300677757250057257300552320660047067203140672369453059525521097632217171632243410632596367577700414072325958400420565857445536067711346027505211123657437505234236664409356209534206731227552939347325367240270645373142265658206153663824717705050000666829245255736811204123627057303106343763077643706873563344536727602158122704365623573759123325556728237659732352245464352223704238326112114511236644312773676974364035743765583976762700083423037228373725677126200072275556243432064409362645103904111126053041776470377552070338770061523824413808576377333777606621070860554541340077345312400770613856693955732339557444290374323340606571113244062407317623565031372377722809241231373450232212311070347238320742403956252669077520275662424541447431585632005934256275037159613629420850341159254368620039255529102905053707596824607638313435674405110626355922392550307066255327057730326234677635355720376655347632656204540625055037444523640767053565384567053110045474084250094223045730705807715054082335343507262020235050743220013355583154246830052534317043656357586035292321255827610859441032095228404412353460412525095076293231325065296257702106407050740823305845303027417130033257273312095836126036</p>
<p><a href="/user_uploads/10155/TnqSqINLAscQ9L2E1P956WBR/content_diff-2021-08-27_14-07-48.png">content_diff-2021-08-27_14-07-48.png</a> <a href="/user_uploads/10155/C8SY0x76Qzh0iA1vzPWZGpt9/QRCode-0.png">QRCode-0.png</a> <a href="/user_uploads/10155/fU-psVLsq095s_5h_oJ5wFDA/Screenshot_20210827-141249.png">Screenshot_20210827-141249.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/TnqSqINLAscQ9L2E1P956WBR/content_diff-2021-08-27_14-07-48.png" title="content_diff-2021-08-27_14-07-48.png"><img src="/user_uploads/10155/TnqSqINLAscQ9L2E1P956WBR/content_diff-2021-08-27_14-07-48.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/C8SY0x76Qzh0iA1vzPWZGpt9/QRCode-0.png" title="QRCode-0.png"><img src="/user_uploads/10155/C8SY0x76Qzh0iA1vzPWZGpt9/QRCode-0.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/fU-psVLsq095s_5h_oJ5wFDA/Screenshot_20210827-141249.png" title="Screenshot_20210827-141249.png"><img src="/user_uploads/10155/fU-psVLsq095s_5h_oJ5wFDA/Screenshot_20210827-141249.png"></a></div>



<a name="250994532"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/250994532" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Kizer <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#250994532">(Aug 27 2021 at 20:58)</a>:</h4>
<p>It looks like "Smart" still contains a capital "S". Perhaps also try removing the <code>.0</code> at the end of <code>nbf</code>. Generally though, the SHC looks good to me so I can't see why it <em>should</em> be failing in the verifier</p>



<a name="251027696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251027696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251027696">(Aug 28 2021 at 04:42)</a>:</h4>
<p><span class="user-mention" data-user-id="192608">@Kevin Snow</span>  Hi Guys, yes that is my library. I'm starting to get the impression my QR Code images are not correct in some way. What does work, yet may still not prove ultimately correct, is that scanning my QR Codes with an iPhone camera and then pasting the resulting string into the 'Numeric QR Data' text box as seen here: <a href="https://demo-portals.smarthealth.cards/VerifierPortal.html">Verifier Portal</a>. From that point forward everything checks out correct in my testing. Yet I suspect the QR Code image is somehow not correct.  If I attempt to scan my QR Code using the "Scan QR Code" button on the same page  I find that it never recognises the QR Code, it just never completes a scan.<br>
So what is it that I'm doing wrong with the QR Code creation?<br>
I know my JWS Token is correct.<br>
I then chunk the JWS as a string into chunks smaller than 1195 in string length.<br>
I then numeric encode each chunk by doing the below. It gets the integer value of each char of the string and subtracts 45 and then converts that integer into a 0 padded string. So integer 5 becomes "05" and integer 15 remains as sting "15". (Integer.ToString("D2") does that padding) </p>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="k">public</span> <span class="kt">string</span> <span class="nf">Encode</span><span class="p">(</span><span class="kt">string</span> <span class="n">JWSToken</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">StringBuilder</span> <span class="n">StringBuilder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="kt">char</span> <span class="n">Char</span> <span class="k">in</span> <span class="n">JWSToken</span><span class="p">.</span><span class="n">ToCharArray</span><span class="p">())</span>
      <span class="p">{</span>
        <span class="kt">int</span> <span class="n">Integer</span> <span class="p">=</span> <span class="n">Char</span> <span class="p">-</span> <span class="m">45</span><span class="p">;</span>
        <span class="n">StringBuilder</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">"D2"</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">StringBuilder</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div>
<p>This gives me the numeric portion of my QR Code payload. <br>
I then have the prefix which is a string of "shc:/" which is not numeric encoded,. Where if there are many chunks that string looks like this "shc:/2/3/" where 2 is the current chunk and 3 is the total chunks. This all happens in the class <a href="https://github.com/angusmillar/SmartHealthCard/blob/master/SmartHealthCard.QRCode/Chunker/SmartHealthCardJwsChunker.cs">SmartHealthCardJwsChunker </a><br>
Then I feed both of these into the QR Code library I use <a href="https://github.com/manuelbl/QrCodeGenerator">manuelbl/QrCodeGenerator</a>.<br>
That QR Code library allows you to specify segments to be encoded into the QR Code in different ways. For the prefix "shc:/" I get it's ASCII bytes and provide that to the QR Code libaray as  <code>QrSegment.MakeBytes(Encoding.ASCII.GetBytes("shc:/))</code>, and I provide the numeric encoded data to the same libaray as <code>QrSegment.MakeNumeric(Chunk.NumericSegment)</code><br>
That is all done in this class : <a href="https://github.com/angusmillar/SmartHealthCard/blob/master/SmartHealthCard.QRCode/Encoder/QRCodeEncoder.cs">QRCodeEncoder</a>.</p>
<p>I will have to play some more and see where I'm going wrong. I'm surprised the vanilla iPhone camera scan output string works yet other scanners fail.</p>



<a name="251028224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251028224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251028224">(Aug 28 2021 at 04:53)</a>:</h4>
<p>Another thought, does anyone else have a working example of using that QR Code library: <a href="https://github.com/manuelbl/QrCodeGenerator/tree/master/QrCodeGenerator">manuelbl/QrCodeGenerator</a>. I remember I was lead to it by a post on these forums. It is hard to find QR Code libraries that support multi segments of Numeric and non-numeric as this one reports too.</p>



<a name="251260716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251260716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251260716">(Aug 30 2021 at 17:07)</a>:</h4>
<p>Interesting -- the example QR above scans for me, but the deflated payload has a non-breaking space character at the front, which makes it invalid JSON.</p>



<a name="251261266"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251261266" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251261266">(Aug 30 2021 at 17:10)</a>:</h4>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="c1">// In the code below, x is the deflated payload...</span>

<span class="c1">// This fails</span>
<span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>

<span class="c1">// Because the following is a BOM/ZERO WIDTH NO-BREAK SPACE (https://www.fileformat.info/info/unicode/char/feff/index.htm)</span>
<span class="c1">// instead of `{`</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span>

<span class="c1">// And this works</span>
<span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">))</span>
</code></pre></div>



<a name="251273568"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251273568" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251273568">(Aug 30 2021 at 18:35)</a>:</h4>
<p><span class="user-mention" data-user-id="192608">@Kevin Snow</span> does this give you any insight? Starting from the payload in your QR:</p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code><span class="k">import</span> <span class="nx">pako</span> <span class="kr">from</span> <span class="s1">'pako'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">b64u</span> <span class="kr">from</span> <span class="s1">'base64url'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="s1">'3FLLbtswEPyVYHuVJUpOY1i3OAX6OBQFkvYS-EBTa4sFHwK5Euoa-rIe-kn9hS5lJ20AJ5feKvCgXe7Ozgz314-fB9AxQg0tURfroiCMpN0uRzfoqL0jVK3zxu_2ufK2aM3i1spALUpDrZKhadB6yMBttlCXV3Mhlpfz-VUuMhgU1AegfYdQ3z8OiH_a89QfXx2DWQoY6Pk6bW3v9HdJTOvFQuUH3ZRLWGegAjboSEtz22--oqJEadvq8AVDksfKL3ORl4yXsqveNYbpHiBg9H1QeDfRh9NFdpIDyhvDaEcmPCDsWSMj98Z8DoYLHvprwQUPwRngTyyH-5OD0uIRRFptGA-uHdeEOM3Y6QGZ7T188G2KVzmsRxa40Sz-jaSEVS5flzNRzioB45idZVO-zOb9U4sjSerTdvDTdwYJ0wMNUint8MY3E4LyDe_LRDzuI6E9LRO_DC9L7sOuSM4WUTeFGr4xAHekWZVYwLgeM-hOFkx0thjQJW5_O8hFXqk-TFdJ7J22R4hqEiySLOPpY283GPhCTF_KsoFbH2zKMkOpyPPfARodOyMnk1c3F2_RYZDm4p2PnSZp2L71cw5W_6WD1fKsg4t_c5DPOP4GAAD__wMA'</span>

<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">b64u</span><span class="p">.</span><span class="nx">toBuffer</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">pako</span><span class="p">.</span><span class="nx">inflateRaw</span><span class="p">(</span><span class="nx">y</span><span class="p">)).</span><span class="nx">toString</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mf">0</span><span class="p">),</span> <span class="s2">"BAD BOM!"</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">1</span><span class="p">)));</span>
</code></pre></div>
<p>Yields the following:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ node test.mjs

<span class="m">65279</span> BAD BOM!

<span class="o">{</span>
  iss: <span class="s1">'https://testing.envisiontechnology.com/hl7Smarthealthcarddemo'</span>,
  &lt;&lt;snipped <span class="k">for</span> brevity&gt;&gt;
</code></pre></div>



<a name="251333935"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251333935" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Snow <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251333935">(Aug 31 2021 at 05:27)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> That was it!  Between what you just mentioned and what <span class="user-mention" data-user-id="328301">@JP Pollak</span> let me know about the mobile app scanning error, I was able to figure out the part of the code that needed to be fixed and then I verified the QR code scanned through the mobile after the change  <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span> I just sent a PR your way with an update to the Compress method that allows the QR codes to scan.</p>
<p>A huge thank you to everyone for their help on this!!!  The views I was looking at did not include these characters; who knows how long this would have taken to trace down otherwise.  If we ever get some in-person HL7 conferences again, I owe you all a round <span aria-label="beers" class="emoji emoji-1f37b" role="img" title="beers">:beers:</span> </p>
<p><del>BAD BOM!</del></p>



<a name="251346822"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251346822" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251346822">(Aug 31 2021 at 08:01)</a>:</h4>
<p>Hi Guys, I've taken in the GitHub PR <span class="user-mention" data-user-id="192608">@Kevin Snow</span> and published new Nuget packages. However, I am still seeing little difference in my testing outcomes. The issue I face is that the QR Code is never recognised/scanned by the <a href="https://demo-portals.smarthealth.cards/VerifierPortal.html">VerifierPortal</a> when using my phone camera (Android or iPhone) or my PC webcam. Yet if I paste in the raw QR Code data, as seen below, into the  VerifierPortal site it can decompress and parse out the FHIR resources as expected. Yet this worked for me before the BOM removal change. So I don't follow what this changed has achieved. <span class="user-mention" data-user-id="192608">@Kevin Snow</span> are you able to post here a QR Code that does scan, I don't have any that are successful.</p>
<p>Raw QR Code data:<br>
shc:/567629595326546034602925407728043360287028656767542228092862372537602870286471674522280928631257543955373326336433625405344041074041337645635404364111764477337138652903546329363664590353042940564167704040036057360157292933610870742428535076646709214228656220065471726330695538686343520635527576322644585366035505384538713430505503760056716164583223646543565600435823083904407020045908097345232765341106760453224276772739345070644059363732064031256374720530287238087563314422005956663374052225406975542306747043716059030526453872324550342110385622226150007262065272266310212936236770032036631233333650034445446845056812753555250845361122246227277660105457211233666665582359120734397231773720426527116429246839416471766036743040742103286545742769410054297024087364286234215056325707595868310705216137071225241224683927097771744452447125331029333743003040030661062245683938205930211052563673552123552573765732414540454563204125393005693329032464255723765767267632630374263257624341450064504110105527717552656827663428286612765422665426762171240841572769107631225624323624573721616045693930222405216265580909760721766539396777500758253935332562525324234330053404103610454171126504654277335762503953684573553062251173623930212553450328114407663372571064746404414053263325565332600030414368720831672223637103522630535059030460532171070531703253531242544245746777335654683055290939117408555204053553642966633312672452571270351005563555080564335244087764331103040460756839425030710873380676612226127161627665390567626505247067117643315654244440421026544369267374202020355050207420012457043226112841663656236536602927287123250570740929572064093030683539053153690867583329342563077410224465382804603043715977257131581166207162412156406141684332585433046258</p>



<a name="251384333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251384333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251384333">(Aug 31 2021 at 13:28)</a>:</h4>
<p>Excellent progress <span class="user-mention" data-user-id="192608">@Kevin Snow</span>  -- glad this helped. For the BOM issue, I've submitted an issue on our testing tool at <a href="https://github.com/smart-on-fhir/health-cards-validation-SDK/issues/145">https://github.com/smart-on-fhir/health-cards-validation-SDK/issues/145</a> So future developers to get clear feedback about this kind of issue.</p>



<a name="251384888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251384888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251384888">(Aug 31 2021 at 13:32)</a>:</h4>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span> that's troubling :-) do you have an example of one of the QRs you are now generating, which is not scanning correctly? Is it possible that the pull request introduced changes to something other than the payload, or that other changes accumulated in the project between releases?</p>



<a name="251385494"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251385494" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251385494">(Aug 31 2021 at 13:35)</a>:</h4>
<p>Looking through <a href="https://github.com/angusmillar/SmartHealthCard/pull/2/files">https://github.com/angusmillar/SmartHealthCard/pull/2/files</a> -- there's not a whole lot of surface area changing...</p>



<a name="251460292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251460292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Snow <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251460292">(Aug 31 2021 at 21:09)</a>:</h4>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span>  I was able to get the bar code to scan through the Verifier Portal using the latest NuGet package.  I attached QR Codes generated with 1.0.0 (QRCode-Include-BOM.png) and 1.0.1 (QRCode-Exclude-BOM.png).  It did take some work to get the image to line up just right for the webcam.  I'm using the code <a href="https://github.com/snowke/smarthealth-card-immunization-poc/blob/main/src/SMARTHealthCardImmunizationPoC-ConsoleApp/SMARTHealthCardImmunizationPoC-ConsoleApp/Program.cs">here</a> and just updating the package references to try both.  <a href="/user_uploads/10155/TWA7aCotqs1KX_o3_Z4k_PfW/QRCode-Exclude-BOM.png">QRCode-Exclude-BOM.png</a> <a href="/user_uploads/10155/Mk3HXxz_3Y53CrF-kTVmx4S9/QRCode-Include-BOM.png">QRCode-Include-BOM.png</a>.</p>
<div class="message_inline_image"><a href="/user_uploads/10155/TWA7aCotqs1KX_o3_Z4k_PfW/QRCode-Exclude-BOM.png" title="QRCode-Exclude-BOM.png"><img src="/user_uploads/10155/TWA7aCotqs1KX_o3_Z4k_PfW/QRCode-Exclude-BOM.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/Mk3HXxz_3Y53CrF-kTVmx4S9/QRCode-Include-BOM.png" title="QRCode-Include-BOM.png"><img src="/user_uploads/10155/Mk3HXxz_3Y53CrF-kTVmx4S9/QRCode-Include-BOM.png"></a></div>



<a name="251460681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251460681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251460681">(Aug 31 2021 at 21:11)</a>:</h4>
<p>I have the same results as Kevin -- both QRs scan for me; the former validates and the latter fails to validate in personal pet testing app (<a href="http://jmandel.github.io/health-card-scanner-demo">http://jmandel.github.io/health-card-scanner-demo</a>)</p>



<a name="251478255"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/How%20to%20register%20in%20the%20CommonTrust%20Network/near/251478255" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/How.20to.20register.20in.20the.20CommonTrust.20Network.html#251478255">(Aug 31 2021 at 23:46)</a>:</h4>
<p>Thank you both for your help <span class="user-mention" data-user-id="192608">@Kevin Snow</span>  and <span class="user-mention" data-user-id="191315">@Josh Mandel</span> .  I have finally managed to get a few to scan, it took a bit of camera holding and playing around. I also managed to get a multi-part QR Code to scan as well. I was surprised just how much data you can stuff inside a single QR Code.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
