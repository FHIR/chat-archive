---
layout: page
title: "FHIR Chat  · Identifying smart cards · smart/health-cards"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/index.html">smart/health-cards</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html">Identifying smart cards</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="256308007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256308007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256308007">(Oct 05 2021 at 19:52)</a>:</h4>
<p>An issue raised with me after the HL7 Australia webinar on smart health cards yesterday: there's no way for the issuer to include any identifier in the card source that allows it to link the card back to an internal context; any queries/provenance related information has to be resolved by a human. </p>
<p>It's possible to arrange the issuing of the cards such that the <code>nbf</code> property in the jws is unique, but that has obvious problems at scale. Or else the source system could include a <code>jti</code> - I don't see that the spec rules it out, since it doesn't comment on it. Has anyone used the jti for that? Or else the spec could allow the bundle to have an id, which would be the same as the jti field.</p>
<p>Comments?</p>



<a name="256333572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256333572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256333572">(Oct 05 2021 at 23:13)</a>:</h4>
<p>We don't rule this out; we generally try to avoid creating any unnecessary correlation handles, but if do you have a valid use case for this it's not something that we would expect to cause problems. JWT specification defines default semantics indicating that clients should ignore any claims they don't understand.</p>



<a name="256389265"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256389265" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256389265">(Oct 06 2021 at 10:31)</a>:</h4>
<p><code>Bundle.id</code> can be populated in our <a href="http://hl7.org/fhir/uv/shc-vaccination/2021Sep/StructureDefinition-shc-vaccination-bundle-ad.html#tab-snapshot">fallback profile</a>.</p>
<p>I think it's appropriate to not have <code>id</code> included in the primary (data minimization) profile, but if you disagree please let us know.</p>



<a name="256390623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256390623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256390623">(Oct 06 2021 at 10:45)</a>:</h4>
<p>I think jti is better. it's the jws itself, not the bundle, that has an id.</p>



<a name="256391386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256391386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256391386">(Oct 06 2021 at 10:52)</a>:</h4>
<p>But I think this is worth a comment - a line, at max, in the smart card spec. (not the ig?)</p>



<a name="256407230"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256407230" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256407230">(Oct 06 2021 at 13:06)</a>:</h4>
<p>What would the line say? Implementers SHOULD NOT create unnecessary correlation handles but MAY populate standard JWT claims such as <code>jti</code> if their infrastructure requires it? </p>
<p>I'll note that the (say, sha256) hash of the entire JWS might also serve this need without adding to the payload size.</p>



<a name="256412990"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256412990" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256412990">(Oct 06 2021 at 13:42)</a>:</h4>
<p>but shas may clash. Likely to - much more than nbf. So I don't think you could use that</p>



<a name="256413983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256413983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256413983">(Oct 06 2021 at 13:48)</a>:</h4>
<p>Wait, what do you mean by "might"?</p>



<a name="256414123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256414123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256414123">(Oct 06 2021 at 13:49)</a>:</h4>
<p><a href="https://crypto.stackexchange.com/questions/47809/why-havent-any-sha-256-collisions-been-found-yet#47810">https://crypto.stackexchange.com/questions/47809/why-havent-any-sha-256-collisions-been-found-yet#47810</a></p>



<a name="256414689"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256414689" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256414689">(Oct 06 2021 at 13:53)</a>:</h4>
<p>That said, it's important to talk about the use case here. My understanding was that you just wanted a handle for issuer-internal lookups/workflows. It would be very easy for a given an issuer to make sure they never issue two cards with the same identifier (whether that's a random jti or a hash over the card or anything else).</p>



<a name="256422394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256422394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256422394">(Oct 06 2021 at 14:40)</a>:</h4>
<p>(keep in mind also that the sha256 hash function is used by the ES256 signing algorithm, so if you could generate sha256 collisions, you could swap JWS payloads at will :-))</p>



<a name="256424525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256424525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Paquin <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256424525">(Oct 06 2021 at 14:54)</a>:</h4>
<p>A SHA-256 collision would immediately invalidate the algorithm and lead to its deprecation; it is safe to assume collisions are infeasible (vs. impossible) to obtain (assuming its preimage is unique, which is the case if you hash the full SHC).</p>



<a name="256485266"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256485266" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256485266">(Oct 06 2021 at 21:10)</a>:</h4>
<p>well, technically, what matters with a hash for a signature is not there will never be collisions, but that it's infeasible to compute an alternative source that leads to the same hash.</p>



<a name="256485538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256485538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256485538">(Oct 06 2021 at 21:12)</a>:</h4>
<p>"never issue two cards with the same hash over the card" - hard because what do you do if it does generate the same hash? I suppose you regenerate it with a new nbf and you're good.</p>



<a name="256485675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256485675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256485675">(Oct 06 2021 at 21:13)</a>:</h4>
<p>but ok, sha-256 is a lot more resistant to collisions at all than I estimated in my head (I was many orders of magnitude out <span aria-label="slight frown" class="emoji emoji-1f641" role="img" title="slight frown">:slight_frown:</span>)</p>



<a name="256486355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Identifying%20smart%20cards/near/256486355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Identifying.20smart.20cards.html#256486355">(Oct 06 2021 at 21:17)</a>:</h4>
<p>so it wouldn't hurt to have a sentence somewhere: 'issuers that want to identify cards later for provenance/investigation purposes can either (a) remember the hash of the card, (b) ensure that the nbf values are unique, or (c) populate the jti in the payload (not recommended, because of byte minimization)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
