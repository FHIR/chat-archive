---
layout: page
title: "FHIR Chat  · IPS · smart/health-cards"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/index.html">smart/health-cards</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html">IPS</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="253167603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253167603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253167603">(Sep 13 2021 at 22:01)</a>:</h4>
<p>If you'd like to convert an IPS to a SHC, you can do this:</p>
<ul>
<li>
<p>Post your IPS as a transaction to <a href="http://test.fhir.org/r4">http://test.fhir.org/r4</a> (web workaround: go to that address in your browser, paste the IPS into the text box at the bottom of the page, and choose 'upload')</p>
</li>
<li>
<p>observe the id of the patient created (look at the id of the second resource in the response)</p>
</li>
<li>
<p>fetch a healthcare card for the patient created (web workaround: <a href="http://test.fhir.org/r4/Patient/[id]/$health-cards-issue?credentialType=https://smarthealth.cards%23health-card">http://test.fhir.org/r4/Patient/[id]/$health-cards-issue?credentialType=https://smarthealth.cards%23health-card</a>)</p>
</li>
</ul>
<p>bingo, you have yourself an SHC generated from the IPS.</p>



<a name="253167673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253167673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253167673">(Sep 13 2021 at 22:01)</a>:</h4>
<p><a href="/user_uploads/10155/vI29vURGRkY55Hxv5mJ5XTvO/qr.png">qr.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/vI29vURGRkY55Hxv5mJ5XTvO/qr.png" title="qr.png"><img src="/user_uploads/10155/vI29vURGRkY55Hxv5mJ5XTvO/qr.png"></a></div>



<a name="253167766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253167766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253167766">(Sep 13 2021 at 22:02)</a>:</h4>
<p>That was generated from <span class="user-mention" data-user-id="191364">@Peter Jordan</span>'s sample IPS. It's necessary that the IPS has immunizations coded with one of the valid SHC coding systems, or it will be ignored.</p>



<a name="253167842"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253167842" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253167842">(Sep 13 2021 at 22:03)</a>:</h4>
<p>There's a piece of functionality that IPS has that SHC doesn't, and maybe it should. In IPS, you can say, 'the patient hasn't had this type of vaccination'. It seems to me like that would be an edge case for covid certs</p>



<a name="253248207"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253248207" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Lee <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253248207">(Sep 14 2021 at 13:17)</a>:</h4>
<p>The payload below is what I get when I scan the QR code. It looks like it is missing the <code>shc:/</code> header in the payload.</p>
<p><code>56762959532654603460292540772804336028702865676754222809286237253760287028647167452228092862676756640775452733594526440840395570532363315424440541063307566255713324083245655533382608634305290341261266314211605736010841353153717074243574414406734158062960381252755236356224593774032473582003427131374511262236630420060310040630532733280565082055557255065627326227662109390503322837745370713842542541543776623009741071537071301204712237644410585971715305673361416139454321293021125843200828103935761068655752000822743376254445225433571023125460617443375027633405246505045609733207670604732558063640342636602735456658725568350639544028366830036900601112285254654153703028607671611234296756444575750934066621230825115271052136653069654560370460636023267645242227032865405765105561564010392512076223365620003252031109375209624220695977556677663840086625596105706155074256032333746929052477423462653435502574295204056405063455736233580665345068655936567337762111116857562159122465415068703226221160446231283606560539107522337131540368385054402704327138565964236872343930263440674555123052537337223538356875452050335977722254286261606172613643314300637168386236767024303353743461033856675737347068450306343362387353275854554455725856107364094464622543504075236900640336657573092576642864662807773539122120013640353324066836417245085630285374357774583227762063215065392358312635271211773921672108066223247441325011405945312744260420631070113554766571773054645372536058663359127474</code></p>



<a name="253248524"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253248524" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Lee <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253248524">(Sep 14 2021 at 13:19)</a>:</h4>
<p>When I do manually add the header though it becomes valid and I'm able to decode the bundle.</p>



<a name="253269072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253269072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253269072">(Sep 14 2021 at 15:16)</a>:</h4>
<p>mine? oh?</p>



<a name="253270555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253270555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Denning <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253270555">(Sep 14 2021 at 15:25)</a>:</h4>
<p>I got the same (no "shc:/") when scanned using the IOS shortcut that Josh pointed out in <a href="#narrow/stream/284830-smart.2Fhealth-cards/topic/iPhone.20camera.20No.20Usable.20Data/near/239810439">https://chat.fhir.org/#narrow/stream/284830-smart.2Fhealth-cards/topic/iPhone.20camera.20No.20Usable.20Data/near/239810439</a></p>



<a name="253270971"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253270971" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253270971">(Sep 14 2021 at 15:28)</a>:</h4>
<p>weird. my code is definitely feeding shc:/ in at the start</p>



<a name="253275559"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253275559" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253275559">(Sep 14 2021 at 15:58)</a>:</h4>
<p>ok, so this is something that actually confused me. The spec says:</p>
<blockquote>
<p>When embedding a JWS string in QR codes, the JWS string SHALL be encoded as Numerical Mode QR codes consisting of the digits 0-9</p>
</blockquote>
<p>So I turned numeric mode on the QRCode library I'm using (ZXing). Which means that it ignores "shc:/" since they're not numeric. </p>
<p>So I don't have a clue what I'm supposed to do here....</p>



<a name="253276737"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253276737" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reece Adamson <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253276737">(Sep 14 2021 at 16:04)</a>:</h4>
<p>The JWS segment is Numeric encoded, but the<code>shc:/</code> segment is byte encoded. You need to use a library that supports mixed mode qr codes (e.g. see this <a href="https://www.npmjs.com/package/qrcode#manual-mode">Javascript QR Code Library</a>).</p>
<p>This can also be seen in action in the <a href="https://github.com/smart-on-fhir/health-cards/blob/main/generate-examples/src/index.ts#L180-L188">specification example generation code here</a>.</p>



<a name="253276756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253276756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neelima Karipineni <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253276756">(Sep 14 2021 at 16:05)</a>:</h4>
<p>Should be a multi-segment code with the shc:/ portion being bytes and the rest numeric. We have a js example at <a href="https://github.com/dvci/health-cards-walkthrough/blob/main/SMART%20Health%20Cards.ipynb">https://github.com/dvci/health-cards-walkthrough/blob/main/SMART%20Health%20Cards.ipynb</a> and C# example at <a href="https://github.com/StateOfCalifornia/DigitalCovid19VaccineRecord-API/blob/a98b914440968cc98dd123dbc74886694a8f2a68/Infrastructure/QrCodeApi/QrApiService.cs">https://github.com/StateOfCalifornia/DigitalCovid19VaccineRecord-API/blob/a98b914440968cc98dd123dbc74886694a8f2a68/Infrastructure/QrCodeApi/QrApiService.cs</a>.</p>



<a name="253276998"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253276998" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253276998">(Sep 14 2021 at 16:06)</a>:</h4>
<p><a href="https://github.com/smart-on-fhir/health-cards/wiki/Libraries-for-SMART-Health-Cards">https://github.com/smart-on-fhir/health-cards/wiki/Libraries-for-SMART-Health-Cards</a> has a set of QR generation libraries that are known to support &gt;1 segment with different encodings</p>



<a name="253277067"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253277067" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253277067">(Sep 14 2021 at 16:06)</a>:</h4>
<p>well, I don't get to use any of those, and I don't have access to a qrcode generator that does segments.</p>



<a name="253277086"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253277086" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253277086">(Sep 14 2021 at 16:07)</a>:</h4>
<p>What does "get to" mean?</p>



<a name="253277139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253277139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253277139">(Sep 14 2021 at 16:07)</a>:</h4>
<p><a href="https://github.com/nayuki/QR-Code-generator">https://github.com/nayuki/QR-Code-generator</a> has c bindings as a common denomniator</p>



<a name="253277171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253277171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253277171">(Sep 14 2021 at 16:07)</a>:</h4>
<p>yes just saw that. Guess I'm going that path</p>



<a name="253277345"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/IPS/near/253277345" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/IPS.html#253277345">(Sep 14 2021 at 16:08)</a>:</h4>
<p>(this is what the EU covid cert spec defines base45 encoding to avoid -- it's a good trick; if we wanted to use it with JWTs instead of CBOR, we'd have to introduce another compression step into the mix, to have binary data to pass <em>into</em> that encoding.)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
