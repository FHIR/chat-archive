---
layout: page
title: "FHIR Chat  · Validation Error · smart/health-cards"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/index.html">smart/health-cards</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html">Validation Error</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="254005730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254005730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254005730">(Sep 20 2021 at 07:02)</a>:</h4>
<p>When I validate this card at <a href="https://demo-portals.smarthealth.cards/VerifierPortal.html">https://demo-portals.smarthealth.cards/VerifierPortal.html</a> it says: </p>
<blockquote>
<p>JWS.payload.vc.type SHOULD NOT contain 'https://smarthealth.cards#covid19', no covid immunization or observation found (Warning)</p>
</blockquote>
<div class="codehilite"><pre><span></span><code>shc:/56762959532654603460292540772804336028702865676754222809286237253760287028647167452228092862676756640775452733594526440840395570532363315424440541063307566255713324083245655533382608634305290341261266314211605736011041313153717074243574414406734174043054283344715444266067755228640373587408675242057467406359383271752050040838666624540959452569742507075608745565522669762271593666520810666877750445637503527645655944110969272131360074334075550433423738060856666458402520123669720621254031123331090850522571620459326604644022721044570862665231671064342405523655532700280352055352506339063938523358632829596803620960567269060603640728226228577652052041352130637164593854330454555604076622597064526558417158507525714423443872522536624044673975614424652023002577303112075063096753097464032842654265693608372809737565750454730535322531533463225968044024773311446263236227224020006467100573442135217212337372675357612810684569636157695535635341684032281029254165250605411257727167207152590905040366340340343668082338602404313675555636376767530926315674450072666537085574617255396365397109587111382025055675665958771006271167043329341105745657035727086220053728533008683775690676223440673407003940230939034431592545100358244543200870737774123242757105443621547161677056602465356010123376583433242304357756236541700808363162706000606729763234070761616260605407456409636945393432570568252311053556702575706371373600615506043632690636350712623572037335505736357445750411017706236169621207522310593128677677003259244526565704043072692271296668055233503768717076633411536135593465634411264329687541696306661145570728305020587211437233071024380420
</code></pre></div>
<p>I think that this is wrong; it is a covid immunization</p>



<a name="254051350"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254051350" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Paquin <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254051350">(Sep 20 2021 at 13:39)</a>:</h4>
<p>The dev tool (and the related portal) currently only recognizes the CVX codes for the <a href="https://www.cdc.gov/vaccines/covid-19/info-by-product/index.html">CDC-approved</a> vaccines. I opened <a href="https://github.com/smart-on-fhir/health-cards-dev-tools/issues/155">issue 155</a> to track.</p>



<a name="254082744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254082744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254082744">(Sep 20 2021 at 17:00)</a>:</h4>
<p><span class="user-mention" data-user-id="385047">@Christian Paquin</span> I get this error:</p>



<a name="254082749"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254082749" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254082749">(Sep 20 2021 at 17:00)</a>:</h4>
<p>key[Jizn1dsadf9Q7ll9KpF6WsxzGm4NLfwMHne_btToh-o]: 'kid' does not match thumbprint in issuer key. expected: P0dT_um48eUyAcuwnquYNyhkF6yFeSqD0MwarDEX-RY, actual: Jizn1dsadf9Q7ll9KpF6WsxzGm4NLfwMHne_btToh-o (Error)</p>



<a name="254082763"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254082763" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254082763">(Sep 20 2021 at 17:00)</a>:</h4>
<p>for the key</p>



<a name="254082804"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254082804" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254082804">(Sep 20 2021 at 17:01)</a>:</h4>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
  <span class="nt">"keys"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"kty"</span><span class="p">:</span> <span class="s2">"EC"</span><span class="p">,</span>
      <span class="nt">"use"</span><span class="p">:</span> <span class="s2">"sig"</span><span class="p">,</span>
      <span class="nt">"crv"</span><span class="p">:</span> <span class="s2">"P-256"</span><span class="p">,</span>
      <span class="nt">"kid"</span><span class="p">:</span> <span class="s2">"Jizn1dsadf9Q7ll9KpF6WsxzGm4NLfwMHne_btToh-o"</span><span class="p">,</span>
      <span class="nt">"x"</span><span class="p">:</span> <span class="s2">"6BCsFU2b4brCIu84tLirgRklxqnjo4qFrkz6vAD1WGY"</span><span class="p">,</span>
      <span class="nt">"y"</span><span class="p">:</span> <span class="s2">"-EocuDdDkTQkUJTyyUbUQuF3Gaa1fG8NLhFFkDXWMSs"</span><span class="p">,</span>
      <span class="nt">"alg"</span><span class="p">:</span> <span class="s2">"ES256"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>



<a name="254082898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254082898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254082898">(Sep 20 2021 at 17:01)</a>:</h4>
<p>but I calculate a different thumbprint for that key, <code>VLJ4BhnFrN0aSnQ5RKUPH7vXjzFPkh4zCe_-Ma0duIU</code></p>



<a name="254083011"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254083011" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254083011">(Sep 20 2021 at 17:02)</a>:</h4>
<p>I'm hashing <code>{"crv":"P-256","kty":"EC","x":"6BCsFU2b4brCIu84tLirgRklxqnjo4qFrkz6vAD1WGY","y";"-EocuDdDkTQkUJTyyUbUQuF3Gaa1fG8NLhFFkDXWMSs"}</code> - how does the portal come up with the thumbprint?</p>



<a name="254083541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254083541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254083541">(Sep 20 2021 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="390125">@Larry Joy</span></p>



<a name="254090253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254090253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christian Paquin <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254090253">(Sep 20 2021 at 17:51)</a>:</h4>
<p>The validation tool uses the <code>npm</code>  <code>jose</code> package to calculate the <code>kid</code>. Are you using SHA-256 for the kid calculation? Are you placing the properties in alphabetical order, per <a href="https://datatracker.ietf.org/doc/html/rfc7638#section-3">section 3</a> of RFC 7638?</p>



<a name="254091585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254091585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254091585">(Sep 20 2021 at 18:00)</a>:</h4>
<p>yes, SHA-256 from openSSL, and it calculated this example OK: <a href="https://connect2id.com/products/nimbus-jose-jwt/examples/jwk-thumbprints">https://connect2id.com/products/nimbus-jose-jwt/examples/jwk-thumbprints</a></p>
<p>And yes, alphabetic - I showed that abvove</p>



<a name="254092133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254092133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Larry Joy <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254092133">(Sep 20 2021 at 18:03)</a>:</h4>
<p>Here is code to compute the KID on a browser client that agrees with the jose implementation:<br>
The key is to sort the properties in alphabetical order and only include the required properties</p>
<p>//<br>
// Computes the 'kid' of a JWK key using SHA-256<br>
//<br>
async function computeKid(keyJwk) {</p>
<div class="codehilite"><pre><span></span><code>// Kid computation requires properties in alphabetical order
keyJwk = { &quot;crv&quot;: &quot;P-256&quot;, &quot;kty&quot;: &quot;EC&quot;, &quot;x&quot;: keyJwk.x, &quot;y&quot;: keyJwk.y, };

const keyBytes = new Uint8Array(JSON.stringify(keyJwk).split(&#39;&#39;).map(c =&gt; c.charCodeAt(0)));

return window.crypto.subtle.digest({ name: &quot;SHA-256&quot;, }, keyBytes)
    .then(function (hash) {
        return arrayBufferToBase64url(hash);
    })
    .catch(function (err) {
        console.error(err);
    });
</code></pre></div>

<p>}</p>



<a name="254094152"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254094152" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254094152">(Sep 20 2021 at 18:16)</a>:</h4>
<p>thanks for the help. I made a typo, which is why I was getting it wrong</p>



<a name="254103776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/284830-smart/health-cards/topic/Validation%20Error/near/254103776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/284830-smart/health-cards/topic/Validation.20Error.html#254103776">(Sep 20 2021 at 19:22)</a>:</h4>
<p>anyway, I'm happy, I can get my cards into Apple Health ;-)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
