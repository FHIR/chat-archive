---
layout: page
title: "FHIR Chat  · FHIR Mapping language &amp; extensions [copy of query posted in · mapping-framework"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/index.html">mapping-framework</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/FHIR.20Mapping.20language.20.26.20extensions.20.5Bcopy.20of.20query.20posted.20in.html">FHIR Mapping language &amp; extensions [copy of query posted in</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="260635744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/FHIR%20Mapping%20language%20%26%20extensions%20%5Bcopy%20of%20query%20posted%20in/near/260635744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dave Barnet <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/FHIR.20Mapping.20language.20.26.20extensions.20.5Bcopy.20of.20query.20posted.20in.html#260635744">(Nov 08 2021 at 10:00)</a>:</h4>
<p>Hopefully a quick and easy question/answer. We are looking at transforming STU3 profiles into R4 profiles. Most of the mappings are provided on the R4 resources on the "R3 Conversions" tab. It looks like there's a general format to the syntax in that elements that are on the base resouce and not in a backbone element are addressed directly (for example src.identifier -&gt; tgt.identifier;) those in a backbone element are put into their own group and dealt with. I'm a bit unsure as to what to do with extensions. For example, is the source (STU3 profile) has a complex extension that part of now belongs on a R4 element - what's the mapping language syntax? For example, within a STU3 MedicationRequest we have a complex extension that has information about repeat medication<br>
Extension url:https:[base]/StructureDefinition/Extension-MedicationRepeatInformation<br>
extension url: numberOfRepeatPrescriptionsAllowed (as an integer)<br>
extension url: numberOfRepeatPrescriptionsIssued (as an integer)<br>
The numberOfRepeatPrescriptionsAllowed now maps to the R4 element MedicationRequest.dispenseRequest.numberOfRepeatsAllowed<br>
How would we represent this in FHIR mapping language? - in terms of how do you reference an element in a complex extension?</p>



<a name="261908929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/FHIR%20Mapping%20language%20%26%20extensions%20%5Bcopy%20of%20query%20posted%20in/near/261908929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/FHIR.20Mapping.20language.20.26.20extensions.20.5Bcopy.20of.20query.20posted.20in.html#261908929">(Nov 18 2021 at 10:23)</a>:</h4>
<p>you match first the complex extension and match then within the complex extension, same as you would do with a backbone element. <br>
I don't have an example for R3 to R4, but for R4 to CDA we do the following (where ch-emed-ext-treatmentplan is a complex extension):</p>
<p><a href="https://github.com/hl7ch/cda-fhir-maps/blob/master/input/maps/BundleToCdaChEmed.map#L433">https://github.com/hl7ch/cda-fhir-maps/blob/master/input/maps/BundleToCdaChEmed.map#L433</a></p>
<div class="codehilite"><pre><span></span><code>  medicationDispense.extension as extension where url=&#39;http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan&#39;
    -&gt; supply.entryRelationship as entryRelationship, entryRelationship.typeCode=&#39;REFR&#39;,
        entryRelationship.substanceAdministration as substanceAdministration
          then MTPReferenceEntryContentModule(extension, substanceAdministration) &quot;MTP-Reference&quot;;
</code></pre></div>
<p>and then <a href="https://github.com/hl7ch/cda-fhir-maps/blob/master/input/maps/BundleToCdaChEmed.map#L286">https://github.com/hl7ch/cda-fhir-maps/blob/master/input/maps/BundleToCdaChEmed.map#L286</a></p>
<div class="codehilite"><pre><span></span><code>group MTPReferenceEntryContentModule(source ext: Extension, target substanceAdministration : SubstanceAdministration) {
 ext.extension as extension where $this.url=&#39;id&#39; then {
    extension.valueIdentifier as valueIdentifier -&gt; substanceAdministration.id as id then IdentifierII(valueIdentifier, id) &quot;id&quot;;
  } &quot;id&quot;;
</code></pre></div>
<p>you can do this also without a group and list the rules after then.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
