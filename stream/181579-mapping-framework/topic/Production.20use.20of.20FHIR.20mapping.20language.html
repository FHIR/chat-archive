---
layout: page
title: "FHIR Chat  · Production use of FHIR mapping language · mapping-framework"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/index.html">mapping-framework</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html">Production use of FHIR mapping language</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="262367328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/262367328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Rocco <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#262367328">(Nov 22 2021 at 19:35)</a>:</h4>
<p>Hi - relatively new to FHIR. The challenge I'm faced with is consuming data from a certain EHR vendor's proprietary API and transforming the consumed data to FHIR resources. One thing I'm come across is the FHIR mapping language (<a href="http://hl7.org/fhir/r4/mapping-language.html">http://hl7.org/fhir/r4/mapping-language.html</a>). Is the mapping language spec only intended to transform data from one version of FHIR to another, or does my use-case also fit the intended use-case of the mapping language spec? Have others' implemented this spec in a production system? I see there are mapping engines available in Java, can anyone speak to how stable they are or even point me to an example implementation? Thanks.</p>



<a name="262372318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/262372318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#262372318">(Nov 22 2021 at 20:19)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="262385705"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/262385705" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#262385705">(Nov 22 2021 at 22:19)</a>:</h4>
<p><span class="user-mention" data-user-id="458359">@Anthony Rocco</span> you can use the mapping language to convert from non-fhir representation, e.g. from CDA to FHIR, you need to have a Logical Model of the data if it is not FHIR. The Java reference implementation includes FHIR Mapping Language support, you can use with the FHIR validator directly. We do use this implementation on top of hapi in matchbox (see <a href="https://github.com/ahdis/matchbox">https://github.com/ahdis/matchbox</a>) however not yet in production, you can try it out here: <a href="https://ahdis.github.io/matchbox-formfiller/#/mappinglanguage">https://ahdis.github.io/matchbox-formfiller/#/mappinglanguage</a> which uses the test instance <a href="https://test.ahdis.ch/matchbox/fhir/metadata">https://test.ahdis.ch/matchbox/fhir/metadata</a></p>



<a name="262468062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/262468062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Rocco <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#262468062">(Nov 23 2021 at 15:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191478">Oliver Egger</span> <a href="#narrow/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language/near/262385705">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="458359">Anthony Rocco</span> you can use the mapping language to convert from non-fhir representation, e.g. from CDA to FHIR, you need to have a Logical Model of the data if it is not FHIR. The Java reference implementation includes FHIR Mapping Language support, you can use with the FHIR validator directly. We do use this implementation on top of hapi in matchbox (see <a href="https://github.com/ahdis/matchbox">https://github.com/ahdis/matchbox</a>) however not yet in production, you can try it out here: <a href="https://ahdis.github.io/matchbox-formfiller/#/mappinglanguage">https://ahdis.github.io/matchbox-formfiller/#/mappinglanguage</a> which uses the test instance <a href="https://test.ahdis.ch/matchbox/fhir/metadata">https://test.ahdis.ch/matchbox/fhir/metadata</a></p>
</blockquote>
<p>Thanks for the reply Oliver! When you say "you need to have a Logical Model of the data if it is not FHIR", is there a specific way this model needs to be defined in order for the mapping engine to function properly, ie.  a json representation of the model?</p>
<p>EDIT: Looking at this some more I see the data needs to be represented as a FHIR structure definition resource, is that correct? So then I take it the structure definition resource is able to be used to represent non-FHIR data models?</p>



<a name="262470589"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/262470589" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#262470589">(Nov 23 2021 at 15:26)</a>:</h4>
<p>It needs to be expressed as a StructureDefinition.  (Syntax can be XML, JSON or RDF)</p>



<a name="262483245"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/262483245" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#262483245">(Nov 23 2021 at 17:01)</a>:</h4>
<p>yes, see 5.3.5.4 Logical Models <a href="http://www.hl7.org/fhir/structuredefinition.html#logical">http://www.hl7.org/fhir/structuredefinition.html#logical</a></p>



<a name="262626526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/262626526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Rocco <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#262626526">(Nov 24 2021 at 18:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191478">Oliver Egger</span> <a href="#narrow/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language/near/262483245">said</a>:</p>
<blockquote>
<p>yes, see 5.3.5.4 Logical Models <a href="http://www.hl7.org/fhir/structuredefinition.html#logical">http://www.hl7.org/fhir/structuredefinition.html#logical</a></p>
</blockquote>
<p>Thanks! One thing I'm not fully understanding - even after looking at some examples - is the difference between "snapshot" and "differential" and which I would use when defining a non-FHIR structure.</p>



<a name="262629932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/262629932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#262629932">(Nov 24 2021 at 19:13)</a>:</h4>
<p>Use the differential, this is then applied to the snapshot of the base definition. if you are defining the StructureDefinition in an Implementation Guide the snapshot will be automatically created, see example here: <a href="https://www.alis-connect.ch/fhir/StructureDefinition-Header.html">https://www.alis-connect.ch/fhir/StructureDefinition-Header.html</a></p>



<a name="263052456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/263052456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Rocco <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#263052456">(Nov 29 2021 at 18:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191478">@Oliver Egger</span> </p>
<p>I started to put together a POC for using FHIR mapping language w/ the mapping engine in the HAPI library. </p>
<p>I'm performing the transform like this:</p>
<div class="codehilite"><pre><span></span><code>        Element source = Manager.parse(context, new FileInputStream(sourcePath), Manager.FhirFormat.XML);
        Element destination = Manager.build(context, context.getStructure(DESTINATION_URL));

        structureMapUtilities.transform(null, source, structureMaps.get(mapUrl), destination);
</code></pre></div>
<p>However the compose method for IParser expected a Resource, not an Element, ie<br>
<code>void compose(OutputStream var1, Resource var2) throws IOException;</code></p>
<p>Any idea how to serialize the destination object to xml then? Thanks</p>
<p><a href="/user_uploads/10155/vxbtOoTKpCDCg-RcZymC8zgH/Transformer.java">Transformer.java</a></p>



<a name="263053414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/263053414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#263053414">(Nov 29 2021 at 19:02)</a>:</h4>
<p>you need to use the parsers from org.hl7.fhir.r5.elementmodel, see <a href="https://github.com/ahdis/matchbox/blob/main/src/main/java/ch/ahdis/matchbox/mappinglanguage/StructureMapTransformProvider.java#L190">https://github.com/ahdis/matchbox/blob/main/src/main/java/ch/ahdis/matchbox/mappinglanguage/StructureMapTransformProvider.java#L190</a></p>



<a name="263164099"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Production%20use%20of%20FHIR%20mapping%20language/near/263164099" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anthony Rocco <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language.html#263164099">(Nov 30 2021 at 15:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191478">Oliver Egger</span> <a href="#narrow/stream/181579-mapping-framework/topic/Production.20use.20of.20FHIR.20mapping.20language/near/263053414">said</a>:</p>
<blockquote>
<p>you need to use the parsers from org.hl7.fhir.r5.elementmodel, see <a href="https://github.com/ahdis/matchbox/blob/main/src/main/java/ch/ahdis/matchbox/mappinglanguage/StructureMapTransformProvider.java#L190">https://github.com/ahdis/matchbox/blob/main/src/main/java/ch/ahdis/matchbox/mappinglanguage/StructureMapTransformProvider.java#L190</a></p>
</blockquote>
<p>Thanks Oliver!  I tried performing the mapping in step 8 here <a href="https://github.com/ahdis/fhir-mapping-tutorial/blob/master/maptutorial/step8/logical/structuredefinition-tleft.xml">https://github.com/ahdis/fhir-mapping-tutorial/blob/master/maptutorial/step8/logical/structuredefinition-tleft.xml</a> using my program, however it fails because Manager.parse expects there to be a snapshot in the StructureDefinition for TLeft. I tried adding a snapshot node with the same value as differential but then get the error <code>org.hl7.fhir.exceptions.DefinitionException: Unable to find type 'code' for name 'd' on property TLeft.d</code>. What would be the correct thing to do here?</p>
<p>Edit: I suspect this is because I havent loaded the definition for code? I think I need to download the definitions zip from here <a href="http://hl7.org/fhir/downloads.html">http://hl7.org/fhir/downloads.html</a> and load that into my context.</p>
<p>Edit: Yep, got it working.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
