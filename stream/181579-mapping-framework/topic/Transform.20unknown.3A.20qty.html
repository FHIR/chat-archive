---
layout: page
title: "FHIR Chat  · Transform unknown: qty · mapping-framework"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/index.html">mapping-framework</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Transform.20unknown.3A.20qty.html">Transform unknown: qty</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="241577776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Transform%20unknown%3A%20qty/near/241577776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Corey Wen <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Transform.20unknown.3A.20qty.html#241577776">(Jun 04 2021 at 18:48)</a>:</h4>
<p>I'm trying to use qty to transform a string into a Quantity resource. More generally I am trying to map a part in a QuestionnaireResponse (QR) to a quantity, specifically to Medication.strength.numerator. When I try to post my mapping to <a href="https://test.ahdis.ch/r4/StructureMap">this URL</a> it's successfully converts the mapping to a StructureMap.<br>
The part in the mapping that uses qty is <code>strength.numerator = qty(val)</code>, where <code>val</code> is the answer as  a string such as "5 mg".<br>
When I POST the QR I get the error "Failed to call access method: java.lang.Error: Rule \"value\": Transform Unknown: qty".<br>
I've also been trying to use <a href="https://www.hl7.org/fhir/mapping-language.html">evaluate</a> and <a href="http://hl7.org/fhirpath/">FHIRpath expressions</a>,<br>
I didn't fully understand the syntax described for evaluate, so any examples would be useful.<br>
Eventually I tried <code>evaluate(val, toQuantity)</code> in the mapping which was then converted to StructureMap w/ no errors, but when posting the QR  I got the following error, where "val" in the QR == "23.4 mg"<br>
<code>"Failed to call access method: org.hl7.fhir.exceptions.FHIRException: Exception executing transform strength.numerator = evaluate(valtoQuantity) on Rule \"value\": Error @1, 2: Premature ExpressionNode termination at unexpected token \"mg\""</code></p>



<a name="241583045"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Transform%20unknown%3A%20qty/near/241583045" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joee Garcia <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Transform.20unknown.3A.20qty.html#241583045">(Jun 04 2021 at 19:35)</a>:</h4>
<p>I was also getting that error when I tried using qty(val) so as a work-around, I just call create('Quantity') like below:</p>
<div class="codehilite" data-code-language="answeritem"><pre><span></span><code>    answerItem.answer as answer -&gt; observation.value = create('Quantity') as newQty then {
      answer.value as vs -&gt; newQty.value = vs;
      src -&gt; newQty.unit = '/a';
      src -&gt; newQty.system = 'http://unitsofmeasure.org';
      src -&gt; newQty.code = '/a';
    };
  };
</code></pre></div>



<a name="241592396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Transform%20unknown%3A%20qty/near/241592396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Corey Wen <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Transform.20unknown.3A.20qty.html#241592396">(Jun 04 2021 at 20:59)</a>:</h4>
<p>Why is newQty .unit and .code set equal to <code>'/a'</code>? Also, in your example, is answer.value a string or is it guaranteed to be a number?<br>
In the case answer.value is "12.3 mg" how can the .value of Quantity be assigned? Is there a way to parse out the number and unit without the qty transform?<br>
I believe qty accepts strings in the form <code>[comparator]value[space]unit</code> which is why I've looking to use it.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
