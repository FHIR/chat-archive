---
layout: page
title: "FHIR Chat  · My own engine taught me something today · mapping-framework"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/index.html">mapping-framework</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/My.20own.20engine.20taught.20me.20something.20today.html">My own engine taught me something today</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="166725705"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/My%20own%20engine%20taught%20me%20something%20today/near/166725705" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/My.20own.20engine.20taught.20me.20something.20today.html#166725705">(May 28 2019 at 15:07)</a>:</h4>
<p>While I was working on my implementation of a mapping engine, I debugged what I thought was incorrect behaviour.  This is what I had:</p>
<div class="codehilite"><pre><span></span>data.values as values where (blockindex = 1 and groupindex = 0 and itemid = &#39;id_1125&#39;) then
{
    values.value as value -&gt; tgt.name as name then
     {
           value -&gt; name.given
     }
}  &quot;rule_select_name&quot;;
</pre></div>


<p>To my surprise, my engine only generated an empty "given" element within an "name" element in the target.  </p>
<p>While debugging I discovered the engine did what it was supposed to do.  Although I interpreted the rule <code>value -&gt; name.given</code> as a rule that would copy the contents of value into given, this is not what it is supposed to do, since it is not a "simple form" according to <a href="https://www.hl7.org/fhir/mapping-language.html#simple" target="_blank" title="https://www.hl7.org/fhir/mapping-language.html#simple">https://www.hl7.org/fhir/mapping-language.html#simple</a>. </p>
<p>So what it did was for all occurrences in "value" (1 instance), run the target rule. Which does nothing more that create the target element.</p>
<p>I guess what I should have done is:</p>
<div class="codehilite"><pre><span></span>   values.value as value -&gt; tgt.name as name, name.given = value;
</pre></div>


<p>Which does indeed work fine.</p>
<p>Is this the intended behaviour? If so, isn't the syntax a bit confusing?  Or should be allow x -&gt; y.z to be a "simple form" too?</p>



<a name="166757309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/My%20own%20engine%20taught%20me%20something%20today/near/166757309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/My.20own.20engine.20taught.20me.20something.20today.html#166757309">(May 28 2019 at 20:42)</a>:</h4>
<p>maybe it would be useful, though would we have cardinality restrictions on the inner?</p>



<a name="166790230"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/My%20own%20engine%20taught%20me%20something%20today/near/166790230" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/My.20own.20engine.20taught.20me.20something.20today.html#166790230">(May 29 2019 at 07:22)</a>:</h4>
<p>Yes, the inner should be 0..1, to not mess with the logic that everywhere the context itself is 0..1, and the context variable name (its children) may select repeating items.</p>



<a name="166790316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/My%20own%20engine%20taught%20me%20something%20today/near/166790316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/My.20own.20engine.20taught.20me.20something.20today.html#166790316">(May 29 2019 at 07:24)</a>:</h4>
<p>Though in the end, it means there's two ways to do it, and the "correct" one is shorter too.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
