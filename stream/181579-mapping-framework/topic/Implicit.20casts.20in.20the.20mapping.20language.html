---
layout: page
title: "FHIR Chat  · Implicit casts in the mapping language · mapping-framework"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/index.html">mapping-framework</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html">Implicit casts in the mapping language</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="173097709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Implicit%20casts%20in%20the%20mapping%20language/near/173097709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html#173097709">(Aug 13 2019 at 09:09)</a>:</h4>
<p>During yesterday's FHIR-I call, we discussed issue <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22774" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22774">GF#22774</a> (Document support for implicit casts in mapping language), which basically asks us to be explicit about what happens in mapping language statements like these</p>
<p>tgt.active = true<br>
tgt.url = '<a href="http://bla.org" target="_blank" title="http://bla.org">http://bla.org</a>'</p>
<p>Although these assignments look obvious (which is why we would love to keep them this way), they implicitly require a cast from a "system" primitive (a bool and a string here) and some datatype in the target model (here FHIR string and FHIR uri).  It's not obvious from the current documentation which casts are allowed (could you assign an integer value to a decimal for example?) and how the engine could ask the target model to 'execute' these casts .</p>
<p>The current documentation suggests that the engine can ask the model to create an instance of any target type, but it would need more knowledge about the model to know that it represents a primitive value. It may then assume the target instance has a "value" that it can assign the primitive to. As I stated before, the alternative is that the target model itself runs the casts, which would require some kind of "instantiate and initialize" callback into the target model, passing in the primitive value.</p>
<p>For now, my mapping engine requires you to explicitly call a constructor function like so:</p>
<p>tgt.active = bool(true)<br>
tgt.url = uri('<a href="http://bla.org" target="_blank" title="http://bla.org">http://bla.org</a>')</p>
<p>which assumes the target model installs these custom extension functions into the language.  I really don't like it, so I am interested to discuss better approaches.</p>



<a name="173132890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Implicit%20casts%20in%20the%20mapping%20language/near/173132890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html#173132890">(Aug 13 2019 at 17:22)</a>:</h4>
<p>In CQL we support model-defined implicit conversions, so that we can say <code>tgt.url = 'http://bla.org'</code>. In the CQL case, that's an expression, so what's happening is the <code>tgt.url</code> is being implicitly converted to a string, so it's equivalent to saying <code>tgt.url.value = 'http://bla.org'</code>. It requires context for the compiler to be able to infer the appropriate conversion, so there are cases where it doesn't apply (e.g. in a sort clause) but in general it works quite well.</p>



<a name="173259430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Implicit%20casts%20in%20the%20mapping%20language/near/173259430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html#173259430">(Aug 15 2019 at 02:06)</a>:</h4>
<p>so I think that we should be explicit that in FHIRPath, assignments are allowed that involve implicit conversions between types, and that it's the underlying type definitions that define what type conversions are possible. </p>
<p>Then, in FHIR, we'll have to figure out how to document what type conversions are possible, and how they work</p>



<a name="173526506"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Implicit%20casts%20in%20the%20mapping%20language/near/173526506" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html#173526506">(Aug 19 2019 at 08:46)</a>:</h4>
<p>Internally in the .NET FHIR API I am introducing the difference between "FHIR.string" and "System.String", which was implicit so far.  I would be helpful if we could tag the 'value' attributes in the definitions of the FHIR primitives so it mentions "System.String".</p>



<a name="173530123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Implicit%20casts%20in%20the%20mapping%20language/near/173530123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html#173530123">(Aug 19 2019 at 09:46)</a>:</h4>
<p>see the discussion on the <a class="stream" data-stream-id="179177" href="/#narrow/stream/179177-conformance">#conformance</a> channel right now</p>



<a name="173670388"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Implicit%20casts%20in%20the%20mapping%20language/near/173670388" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html#173670388">(Aug 20 2019 at 15:57)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> -- Maybe I am missing something obvious, but the grammar defines several types for literals (integer, number, string, datetime, time, bool). In my experimentation, I rely on the parser and use the appropriate type coercion in my engine's implementation language. So if the parser tells me the literal is a kind of BOOL, I don't think I need more explicit instructions... Currently there doesn't seem to be a literal for URI data type defined in the grammar.</p>



<a name="173671165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Implicit%20casts%20in%20the%20mapping%20language/near/173671165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html#173671165">(Aug 20 2019 at 16:06)</a>:</h4>
<p>You do need more information, since it is at present unknown how to get from a BOOL (which is of type System.Bool) to a FHIR Bool instance (of type FHIR.bool) - unless all your models target FHIR, in which case you can hard-wire these conversions.  E.g. if the target is V2, what would the assignment do?</p>



<a name="173671365"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Implicit%20casts%20in%20the%20mapping%20language/near/173671365" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Implicit.20casts.20in.20the.20mapping.20language.html#173671365">(Aug 20 2019 at 16:09)</a>:</h4>
<p>I see, I am thinking all FHIR atm.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
