---
layout: page
title: "FHIR Chat  · context in where clause:  context or context.element? · mapping-framework"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/index.html">mapping-framework</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html">context in where clause:  context or context.element?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="185159808"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/context%20in%20where%20clause%3A%20%20context%20or%20context.element%3F/near/185159808" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html#185159808">(Jan 08 2020 at 21:38)</a>:</h4>
<p>The <a href="https://www.hl7.org/fhir/mapping-language.html#7.7.0.7.1" target="_blank" title="https://www.hl7.org/fhir/mapping-language.html#7.7.0.7.1">FHIR mapping language</a> specifies for the source where condition:</p>
<blockquote>
<p>where [condition]: a FHIRPath expression that is evaluated to boolean on the context. If the expression returns false, the source element has no match</p>
</blockquote>
<p>what is exactly 'evaluated to boolean <strong>on the context</strong>', is it context or context.element? context.element is defined as</p>
<blockquote>
<p>The element is an (optional) name of a child element of the context. If the name is not provided, the source is the context. If it is provided, the rule will apply once for each element on the context that matches this name.</p>
</blockquote>
<p>From this description I would assume the following where clauses to evaluate the length of source.a2 (context.element as context):</p>
<div class="codehilite"><pre><span></span>  source.a2 as a where length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b &quot;;
  source.a2 as a where $this.length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b&quot;;
  source.a2 as a where source.a2.length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b&quot;;
  source.a2 as a where %source.a2.length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b&quot;;
</pre></div>


<p>the Java fhir mapping language also evaluates the above rules, however the <a href="https://www.hl7.org/fhir/mapping-tutorial.html#step3" target="_blank" title="https://www.hl7.org/fhir/mapping-tutorial.html#step3">tutorial</a> describe it the following way (context as context):</p>
<div class="codehilite"><pre><span></span>  source.a2 as a where a2.length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b&quot;;
</pre></div>


<p>also the example in the spec itself: </p>
<div class="codehilite"><pre><span></span>src.value : integer 0..* default 10 first as vs0
    where value &gt;= 10 check value &lt;= 100
    log value
</pre></div>


<p>which cannot be evaluated with the java fhir mapping language. is this an implementation issue or need the examples be corrected? <span class="user-mention" data-user-id="193430">@Alexander Zautke</span> <span class="user-mention" data-user-id="191363">@Vadim Peretokin</span> <span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="185160476"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/context%20in%20where%20clause%3A%20%20context%20or%20context.element%3F/near/185160476" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html#185160476">(Jan 08 2020 at 21:46)</a>:</h4>
<p>Context is properly defined by the StructureMap resource as: "Type or variable this rule applies to".  Meaning in this case the child element. So in your example it would be "a2". Always, at least to my interpretation.</p>



<a name="185160508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/context%20in%20where%20clause%3A%20%20context%20or%20context.element%3F/near/185160508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html#185160508">(Jan 08 2020 at 21:47)</a>:</h4>
<p>Therefore I would agree that the example is not correct and should be updated</p>



<a name="185160635"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/context%20in%20where%20clause%3A%20%20context%20or%20context.element%3F/near/185160635" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html#185160635">(Jan 08 2020 at 21:49)</a>:</h4>
<p><code>source.a2 as a where %source.a2.length()&lt;20 -&gt; target.a2 = a "rule_a20b";</code> What is <code>%source</code> supposed to be here?</p>



<a name="185161579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/context%20in%20where%20clause%3A%20%20context%20or%20context.element%3F/near/185161579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html#185161579">(Jan 08 2020 at 21:59)</a>:</h4>
<blockquote>
<p><code>source.a2 as a where %source.a2.length()&lt;20 -&gt; target.a2 = a "rule_a20b";</code> What is <code>%source</code> supposed to be here?</p>
</blockquote>
<p>I have the group defined as: group  tutorial(source source : TLeft, target target : TRight) and then I can also access the source parameter in the fhirpath expression as a variable with %source</p>



<a name="185263415"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/context%20in%20where%20clause%3A%20%20context%20or%20context.element%3F/near/185263415" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html#185263415">(Jan 09 2020 at 22:30)</a>:</h4>
<p>Ahh, yes, of course. Then <code>source.a2 as a where %source.a2.length()&lt;20 -&gt; target.a2 = a "rule_a20b";</code>should also work.</p>



<a name="185263639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/context%20in%20where%20clause%3A%20%20context%20or%20context.element%3F/near/185263639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html#185263639">(Jan 09 2020 at 22:32)</a>:</h4>
<p>Would the first one be valid? Or only the second one? The third option would only work, in my opinion, if a2 would have a child called "source".</p>



<a name="185264237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/context%20in%20where%20clause%3A%20%20context%20or%20context.element%3F/near/185264237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/context.20in.20where.20clause.3A.20.20context.20or.20context.2Eelement.3F.html#185264237">(Jan 09 2020 at 22:39)</a>:</h4>
<blockquote>
<p>Would the first one be valid? Or only the second one? The third option would only work, in my opinion, if a2 would have a child called "source".</p>
</blockquote>
<p>I think 1 (length()&lt;20 ), 2 ($this.length()&lt;20) and 4 (%source.a2.length()&lt;20 if source is a variable) should be valid, but not 3  source.a2.length()&lt;20.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
