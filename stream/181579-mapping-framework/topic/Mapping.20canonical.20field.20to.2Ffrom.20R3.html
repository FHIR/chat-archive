---
layout: page
title: "FHIR Chat  · Mapping canonical field to/from R3 · mapping-framework"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/index.html">mapping-framework</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html">Mapping canonical field to/from R3</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="198892976"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/198892976" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#198892976">(May 27 2020 at 13:51)</a>:</h4>
<p>I am looking at the <a href="http://hl7.org/fhir/R4/questionnaireresponse-version-maps.html">R4 -&gt; STU3 maps of <code>QuestionnaireResponse</code></a>. The field <code>questionnaire</code> changed type, from a reference (STU3) to a canonical URL (R4). However, the mapping (in either direction) is simply</p>
<div class="codehilite"><pre><span></span><code>src.questionnaire -&gt; tgt.questionnaire;
</code></pre></div>


<p>Is there some automatic mapping done (behind the scenes) when the R4 type is <code>canonical</code>?</p>



<a name="198895793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/198895793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#198895793">(May 27 2020 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="199697385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/199697385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#199697385">(Jun 04 2020 at 01:43)</a>:</h4>
<p>well, it's not done behind the scenes, but in one of the libraries:</p>
<div class="codehilite"><pre><span></span><code>group canonical2Reference(source src : canonical, target tgt : ReferenceR3) &lt;&lt;types&gt;&gt; {
  src.id -&gt; tgt.id &quot;Element-id&quot;;
  src.extension where (url.startsWith(&#39;http://hl7.org/fhir/3.0/StructureDefinition&#39;).not() and (url != &#39;http://hl7.org/fhir/StructureDefinition/rendered-value&#39;)) -&gt; tgt.extension &quot;Element-extensions&quot;;
  src.value -&gt; tgt.reference &quot;reference&quot;;
  src.extension as e where url = &#39;http://hl7.org/fhir/StructureDefinition/rendered-value&#39; then {
    e.value -&gt; tgt.display;
  };
}
</code></pre></div>


<p>And the equivalent exists in R3 -&gt; R4</p>



<a name="199702642"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/199702642" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#199702642">(Jun 04 2020 at 03:52)</a>:</h4>
<p>Ok, but is that statement valid in the FHIR mapping language?</p>



<a name="199702656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/199702656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#199702656">(Jun 04 2020 at 03:53)</a>:</h4>
<p>umm. yes? I mean, it compiles and executes ok...</p>



<a name="199756849"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/199756849" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#199756849">(Jun 04 2020 at 14:42)</a>:</h4>
<p>Just to make sure I get this right: the "trivial map" <code>src.x -&gt; tgt.y</code> can actually involve a standard type transformation if  <code>src.x</code> and <code>tgt.y</code> have different types? If so, is there a list of the type pairs where this happens?</p>



<a name="199759844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/199759844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#199759844">(Jun 04 2020 at 15:02)</a>:</h4>
<p>Yes, that happens for all types for which there is a group with a &lt;&lt;types&gt;&gt; annotation</p>



<a name="199760019"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/199760019" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#199760019">(Jun 04 2020 at 15:02)</a>:</h4>
<p>Have a look here: <a href="https://github.com/FHIR/interversion/blob/master/r4/R4toR3/primitives.map">https://github.com/FHIR/interversion/blob/master/r4/R4toR3/primitives.map</a></p>



<a name="199803385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/181579-mapping-framework/topic/Mapping%20canonical%20field%20to/from%20R3/near/199803385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/181579-mapping-framework/topic/Mapping.20canonical.20field.20to.2Ffrom.20R3.html#199803385">(Jun 04 2020 at 20:19)</a>:</h4>
<p>Great, thanks <span class="user-mention" data-user-id="193430">@Alexander Zautke</span> !</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
