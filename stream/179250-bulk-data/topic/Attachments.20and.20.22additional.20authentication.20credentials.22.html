---
layout: page
title: "FHIR Chat  · Attachments and &quot;additional authentication credentials&quot; · bulk data"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/index.html">bulk data</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html">Attachments and &quot;additional authentication credentials&quot;</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="246160697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246160697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dennis Patterson <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246160697">(Jul 15 2021 at 21:46)</a>:</h4>
<p>Imagine a successful export with requiresAccessToken = true in the response.  The bulk client retrieves a DocumentReference .ndjson file and is about to resolve one of the DocumentReference's content attachment urls.   The <a href="https://build.fhir.org/ig/HL7/bulk-data/export.html#attachments">attachment section of the build spec</a> says "the url location must be accessible by a client with a valid access token, and SHALL NOT require the use of additional authentication credentials."</p>
<p>I have always read this as requiring a holistic approach where the client's JWT credentials are used in a client assertion presented to a single authorization server token url and the resulting access token used consistently from export request to checking the status to downloading both ndjson files and attachments (noting of course that tokens expire and they may need to ask for another).  Consistent "authentication credentials" is <em>not</em> solely referring to the client's own identify assertion, but rather in conjunction with a consistent authorization server url (i.e. no switching mid-workflow for a different type of token).   It's a bit legalese but I wanted to state it explicitly to ensure agreement.</p>



<a name="246161556"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246161556" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246161556">(Jul 15 2021 at 21:55)</a>:</h4>
<p>The intention is that when requiresAccessToken==true, the client can use the same process it used for getting access tokens to manage the export to also </p>
<ul>
<li>get an access token for fetching the output ndjson files</li>
<li>get an access token for fetching binary attachment content</li>
</ul>



<a name="246161631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246161631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246161631">(Jul 15 2021 at 21:56)</a>:</h4>
<p>I'm not sure if you've looked through the ballot responses, but we did have some clarifying language on his front that was part of the block vote this week.</p>



<a name="246724829"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246724829" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dennis Patterson <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246724829">(Jul 21 2021 at 14:10)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191315">@Josh Mandel</span> ! Could you or <span class="user-mention" data-user-id="191414">@Dan Gottlieb</span> post the jira(s) with the updated language?</p>



<a name="246725647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246725647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246725647">(Jul 21 2021 at 14:16)</a>:</h4>
<p><a href="https://jira.hl7.org/browse/FHIR-32114">https://jira.hl7.org/browse/FHIR-32114</a> and <a href="https://jira.hl7.org/browse/FHIR-32772">https://jira.hl7.org/browse/FHIR-32772</a></p>



<a name="246730089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246730089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dennis Patterson <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246730089">(Jul 21 2021 at 14:49)</a>:</h4>
<p>For this discussion, the sentence I found most helpful from the first jira is "This definition [of requiresAccessToken] should be clear that we're talking about 'downloading the generated files requires the same authorization mechanism as the $export operation itself' – not just any bearer token, but the <strong>same scheme</strong> as the kickoff, polling, etc."</p>



<a name="246877710"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246877710" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dennis Patterson <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246877710">(Jul 22 2021 at 17:16)</a>:</h4>
<p>It might be even clearer to say "the same scheme and same token url"</p>



<a name="246881585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246881585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246881585">(Jul 22 2021 at 17:45)</a>:</h4>
<p>The sentence you are quoting was just the issue description; it's important to evaluate the actual resolution if you want to make wording tweaks. Resolution was to add</p>
<blockquote>
<p>downloading the generated files requires the same authorization mechanism as the $export operation itself</p>
</blockquote>



<a name="246881626"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246881626" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246881626">(Jul 22 2021 at 17:45)</a>:</h4>
<p>If this is unclear, feel free to submit a follow up requesting specific additional changes.</p>



<a name="246889149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246889149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246889149">(Jul 22 2021 at 18:43)</a>:</h4>
<p>"servers SHALL populate the Attachment.contentType code as well as either the data element or the url element". Should that be either data or url <strong>or both</strong>?</p>



<a name="246889286"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246889286" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246889286">(Jul 22 2021 at 18:44)</a>:</h4>
<blockquote>
<p>either the data element or the url element</p>
</blockquote>
<p>I haven't heard a use case for populating both; has this come up in your experience?</p>



<a name="246889399"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246889399" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246889399">(Jul 22 2021 at 18:45)</a>:</h4>
<p>It is mentioned in US Core IG: "us-core-6: DocumentReference.content.attachment.url or <a href="http://DocumentReference.content.attachment.data">DocumentReference.content.attachment.data</a> or both SHALL be present."</p>



<a name="246890126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246890126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246890126">(Jul 22 2021 at 18:51)</a>:</h4>
<p>We don't currently prohibit this, but (again) we haven't heard a use case for populating both.</p>



<a name="246890200"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246890200" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246890200">(Jul 22 2021 at 18:52)</a>:</h4>
<p>So it is an "inclusive OR".</p>



<a name="246890238"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Attachments%20and%20%22additional%20authentication%20credentials%22/near/246890238" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22.html#246890238">(Jul 22 2021 at 18:52)</a>:</h4>
<p>I mean, ... if you want it to be? I don't know that we have super strict semantics on this. (And I'm trying to understand whether it matters.)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
