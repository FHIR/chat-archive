---
layout: page
title: "FHIR Chat  · Multivalued parameters in _typeFilter · bulk data"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/index.html">bulk data</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html">Multivalued parameters in _typeFilter</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="228964775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/228964775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> G G <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#228964775">(Mar 05 2021 at 14:46)</a>:</h4>
<p>I have a question about how I should go about implementing _typeFilter in Bulk Export. The docs show an example with a single _typeFilter, which the filters separated by a comma. Here it is </p>
<div class="codehilite"><pre><span></span><code>$export?
  _type=
    MedicationRequest,
    Condition&amp;
  _typeFilter=
    MedicationRequest%3Fstatus%3Dactive,
    MedicationRequest%3Fstatus%3Dcompleted%26date%3Dgt2018-07-01T00%3A00%3A00Z
</code></pre></div>
<p>But what if I need to filter with logically OR'ed parameters within a single filter? For example, this: </p>
<div class="codehilite"><pre><span></span><code>$export?
  _type=
    MedicationRequest,
    Condition&amp;
  _typeFilter=
    MedicationRequest%3Fmedication%3DMedication/123,Medication/456,
    MedicationRequest%3Fstatus%3Dcompleted%26date%3Dgt2018-07-01T00%3A00%3A00Z
</code></pre></div>
<p>Since _typeFilter uses commas to differ between multiple parameters, is this a supported use case at all? The commas in the value list will cause issues in processing won't they, since commas are used as filter delimiters? To me it feels as though _typeFilter should have 0..* instances in the request. Should I assume that the presence of a comma is not enough to actually split the filters, and i should look for the presence of a comma, followed by a resource type? Or am I missing something glaringly obvious here?</p>



<a name="228966021"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/228966021" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#228966021">(Mar 05 2021 at 14:54)</a>:</h4>
<p>I think the expectation is that commas within a type filter clause should be escaped.</p>
<p>Still, this is something we should address in the Bulk Data 1.5 ballot/reconciliation process, though, since now we support submission using post where it would be more natural to repeat the perimeter or something like it I don't think this came up at all during our discussions this year, which is part of why type filter has still been labeled experimental, and we would not necessarily need to maintain backwards compatibility.</p>



<a name="228999593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/228999593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> G G <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#228999593">(Mar 05 2021 at 18:17)</a>:</h4>
<p>Ah I see. Whatever processing HAPI is doing to the get requests is causing all commas from input (escaped or not) to get resolved to unescaped commas come $export time, so I've resolved this using a regex  that can correctly identify individual typeFilters. FWIW I would support moving to supporting only POST requests for export, as well as supporting multiple _typeFilter parameters.</p>



<a name="229020000"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229020000" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229020000">(Mar 05 2021 at 20:33)</a>:</h4>
<p>We didn't want to break any (nonexperimental) usage of bulk data 1.0, but <span class="user-mention" data-user-id="191414">@Dan Gottlieb</span> I assume you'd be on board with changing type filter to be used only with POST.</p>



<a name="229205697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229205697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229205697">(Mar 07 2021 at 18:01)</a>:</h4>
<p>Yup, agree that it's worth considering! <span class="user-mention" data-user-id="195874">@G G</span> <span class="user-mention" data-user-id="191315">@Josh Mandel</span>  presumably you're thinking that repeated <code>_typeFilter</code> parameters would be ORs (analogous to how the commas are currently used and how the Patient parameter handles repeated values in Post requests) rather than ANDs (analogous to how multiple search params work in a REST query)?</p>



<a name="229205703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229205703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229205703">(Mar 07 2021 at 18:02)</a>:</h4>
<p>Also, any reason not to allow repeated <code>_typeFilter</code> params in GET requests too (IIRC we went POST only for the Patient parameter to avoid potential confusion on how to represent the referenced patients)?</p>



<a name="229205775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229205775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229205775">(Mar 07 2021 at 18:02)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span> , <span class="user-mention" data-user-id="191676">@Lee Surprenant</span>  - I believe you both have _typeFilter implementations in your servers. What are your thoughts on allowing repeating of the parameter to indicate logical ORs?</p>



<a name="229206922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229206922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229206922">(Mar 07 2021 at 18:19)</a>:</h4>
<p>Yeah they would be ORs. Only reason I see for limiting use in to POST only would be avoiding inconsistency --  for _type in GET, we still want to use comma separation. perhaps what we should do though is to say that _types can be separated using commas as well as using multiple repeated parameters, and that they are always combined with "or".</p>



<a name="229207574"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229207574" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229207574">(Mar 07 2021 at 18:29)</a>:</h4>
<p>That could work and I like the consistency, though it's another requirement that servers would have to support in v1.5 (or 2.0 or whatever :)</p>



<a name="229226709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229226709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229226709">(Mar 07 2021 at 23:29)</a>:</h4>
<p>Our server accepts multiple _typeFilter parameters but only one condition per resource type, you get an error if you try to specify the same resource type more than once</p>



<a name="229371441"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229371441" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> G G <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229371441">(Mar 08 2021 at 20:51)</a>:</h4>
<p>That's interesting. I am on board with supporting multiples, but it seems like the doc example shows that multiple filters on the same resource type should have their results unioned: <a href="https://hl7.org/fhir/uv/bulkdata/export/index.html#example-request-with-_typefilter">https://hl7.org/fhir/uv/bulkdata/export/index.html#example-request-with-_typefilter</a> . Is this a strict requirement of the spec? Currently HAPI just grabs the first _typeFilter relevant to the resource type.</p>



<a name="229372275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/229372275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#229372275">(Mar 08 2021 at 20:57)</a>:</h4>
<blockquote>
<p>multiple filters on the same resource type should have their results unioned</p>
</blockquote>
<p>Right; I think <span class="user-mention" data-user-id="191912">@Michele Mottini</span> is saying his implementation is a bit narrower (which is fine/expected; this is experimental territory after all).</p>



<a name="230363106"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/Multivalued%20parameters%20in%20_typeFilter/near/230363106" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/Multivalued.20parameters.20in.20_typeFilter.html#230363106">(Mar 15 2021 at 15:22)</a>:</h4>
<p>I drafted some language covering repeating parameters in kickoff requests to include in the next version of the IG (v1.1, formerly v1.5) at <a href="https://github.com/HL7/bulk-data/pull/102/files#diff-4ec03c0948a3420a72f90f30bb8773e72b3cb2dcc88c8b56cfdd0b3faef84b5e">https://github.com/HL7/bulk-data/pull/102/files#diff-4ec03c0948a3420a72f90f30bb8773e72b3cb2dcc88c8b56cfdd0b3faef84b5e</a> - open to edits / suggestions here or on the PR!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
