---
layout: page
title: "FHIR Chat  · _typeFilter and nested or · bulk data"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/index.html">bulk data</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/_typeFilter.20and.20nested.20or.html">_typeFilter and nested or</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="219649065"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/_typeFilter%20and%20nested%20or/near/219649065" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RB Johnson <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/_typeFilter.20and.20nested.20or.html#219649065">(Dec 11 2020 at 19:15)</a>:</h4>
<p>If an export request is made with a _typeFilter that has a nested 'or' it is necessary to escape the nested 'or' so that it isn't considered part of the _typeFilter parameter. Thus after separating the different filters in _typeFilter it would be necessary to unescape the nested 'or's. In this case should just the 'or's be unescaped or should all search parameter special characters be unescaped? </p>
<p>As an example, a user is passing the following searches in _typeFilter:<br>
Observation?code=a,b<br>
Condition?code=system|ha125</p>
<p>Ignoring the url encoding for readability, would this be written as:<br>
Observation?code=a\,b,Condition?code=system|ha125<br>
or<br>
Observation?code=a\,b,Condition?code=system\|ha125</p>
<p>My thought is that the first one avoids unnecessary escapes, but the second is more consistent so that all special characters at the same 'level' are escaped the same amount.</p>



<a name="219664263"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/_typeFilter%20and%20nested%20or/near/219664263" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/_typeFilter.20and.20nested.20or.html#219664263">(Dec 11 2020 at 21:25)</a>:</h4>
<p>This is a bit tricky to discuss without URLencoding -- in general, you almost never expect to see <code>?code=a\,b</code> in a FHIR query, unless you're working with a coding system that defines a literal code of "a,b" (pretty unusual in my experience, which makes the note at <a href="http://build.fhir.org/search.html#escaping">http://build.fhir.org/search.html#escaping</a> a pretty obscure one).</p>



<a name="219664614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/_typeFilter%20and%20nested%20or/near/219664614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/_typeFilter.20and.20nested.20or.html#219664614">(Dec 11 2020 at 21:28)</a>:</h4>
<p>I think the intention for the following <a href="http://hl7.org/fhir/uv/bulkdata/export/index.html#experimental-query-parameters">spec example</a>:</p>
<div class="codehilite"><pre><span></span><code>  _typeFilter=
    MedicationRequest%3Fstatus%3Dactive,
    MedicationRequest%3Fstatus%3Dcompleted%26date%3Dgt2018-07-01T00%3A00%3A00Z
</code></pre></div>
<p>... is that the literal query would go over the wire as:</p>
<div class="codehilite"><pre><span></span><code>_typeFilter=MedicationRequest%253Fstatus%253Dactive%2CMedicationRequest%253Fstatus%253Dcompleted%2526date%253Dgt2018-07-01T00%253A00%253A00Z
</code></pre></div>
<p>(which includes individual filter expressions that have been double-URL-encoded! Note things like <code>%253F</code>, which is a question mark double-encoded.)</p>



<a name="219664776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/_typeFilter%20and%20nested%20or/near/219664776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/_typeFilter.20and.20nested.20or.html#219664776">(Dec 11 2020 at 21:29)</a>:</h4>
<p>The server then URLdecodes it to get:</p>
<div class="codehilite"><pre><span></span><code>MedicationRequest%3Fstatus%3Dactive,MedicationRequest%3Fstatus%3Dcompleted%26date%3Dgt2018-07-01T00%3A00%3A00Z
</code></pre></div>
<p>... which it processes by splitting on <code>,</code> to get the two filters.</p>



<a name="219664868"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179250-bulk%20data/topic/_typeFilter%20and%20nested%20or/near/219664868" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179250-bulk-data/topic/_typeFilter.20and.20nested.20or.html#219664868">(Dec 11 2020 at 21:30)</a>:</h4>
<p>Note, this section of the spec is marked as "experimental" for a reason: I'm not sure how much consistent real-world support exists, especially at this level of detail :)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
