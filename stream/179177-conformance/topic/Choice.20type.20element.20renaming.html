---
layout: page
title: "FHIR Chat  · Choice type element renaming · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html">Choice type element renaming</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153910975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153910975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153910975">(Sep 27 2017 at 13:32)</a>:</h4>
<p>I have a question about element renaming.</p>
<p>FHIR states that if a profile constrains a polymorphic choice type element (e.g. "value[x]") to a single type, then the profile<br>
SHOULD|SHALL rename the element by replacing the "[x]" suffix with the name of the selected datatype (e.g. "valueString").</p>
<p>Questions:</p>
<ul>
<li>Is it mandatory for a profile that constrains a choice type element to perform the renaming ("value[x]" =&gt; "valueString")? i.e. SHALL, not SHOULD?</li>
<li>Is it mandatory for a derived profile that further constrains an choice type constraint to specify the new element name ("valueString")?</li>
</ul>
<p>Note that if FHIR chooses to define element renaming as optional, then it becomes more difficult to match profile constraints to the base profile; if element renaming is not consistent throughout derived profiles, the snapshot generator logic may have to fall back to inspecting and comparing the actual element type constraints.</p>
<p>Example of layered choice type element constraints with inconsistent element renaming:<br>
0) FHIR Core resource: Observation.value[x]<br>
1) User base profile: Observation.valueString, type.code = "string"<br>
2) User derived profile: Observation.value[x], type.code = "string", max = 1</p>
<p>From a tooling implementer perspective, I'd prefer if FHIR would define element renaming as mandatory, as this reduces implementation complexity. However considering we need to gracefully handle a large set of existing profiles that may not adhere to this rule, I guess tools will have to handle this anyway and my question is rather academic...?</p>



<a name="153911024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911024">(Sep 27 2017 at 15:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191351">@Chris Grenz</span> <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> ?</p>



<a name="153911028"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911028" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911028">(Sep 27 2017 at 15:17)</a>:</h4>
<p>I would expect once a valueString always a valueString - that is the intent of the profile so any profile derived from it should strictly adhere to that.</p>



<a name="153911029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911029">(Sep 27 2017 at 15:17)</a>:</h4>
<p>Yes, that's what I would expect. But is it guaranteed/mandatory?</p>



<a name="153911044"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911044" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911044">(Sep 27 2017 at 18:03)</a>:</h4>
<p>In earlier versions this was a bit ambiguous. Now (I think) we've clarified and there's no optionality:</p>
<ul>
<li>value[x] constrains <em>all</em> types using this choice.</li>
<li>valueString is a type slice of value[x] and only constrains string instances of value[x]<br>
In terms of inheritance (profile to base), the paths <em>must</em> match.  So, in <span class="user-mention" data-user-id="191336">@Michel Rutten</span> 's example, 2) is a constraint of 0) and not 1).</li>
</ul>



<a name="153911045"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911045" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911045">(Sep 27 2017 at 18:04)</a>:</h4>
<p>Some things to note:</p>
<ul>
<li>In Michel's example, 1) is effectively a no-op since valueString is by definition a type slice of value[x] for string types.</li>
<li>2) would limit value[x] to <em>only</em> strings.  1) would <em>not</em> limit the available types</li>
</ul>



<a name="153911046"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911046" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911046">(Sep 27 2017 at 18:07)</a>:</h4>
<p>See <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12259" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12259">GF#12259</a> for resolution on this topic.</p>



<a name="153911196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911196">(Sep 28 2017 at 09:14)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191351">@Chris Grenz</span>, thank you for the clarification.</p>
<p>Your proposal makes perfect sense. I seem to remember that we discussed this during a FHIR-I evening session and reached consensus that this is how<br>
we want to proceed towards R4.</p>
<p>So I agree that Future R4 implementations should adhere to your description above. However I'm not sure if this already applies to STU3 implementations?</p>
<p>For our FHIR tools, we're trying to strike a balance between backwards and forwards compatibility. The tools should maintain to support existing profiles that users have created, published to Simplifier and taken into production.<br>
We try to be forgiving when reading data (e.g. fix/auto-correct if possible) and strict when generating (i.e. conform to the spec). If I update the API snapshot generator to strictly follow your rules, then this could break some existing profiles with choice type element constraints.</p>
<p>Specifically this comment of yours: "2) would limit value[x] to only strings."</p>
<p>I understand the subtle difference and agree on this for R4. However I don't think that we can expect any STU3 FHIR user to be aware of this rule, as this wasn't clearly defined yet during STU3 publication. Therefore I'm quite reluctant to introduce this (new) interpretation in existing STU3 logic...</p>



<a name="153911217"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911217" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911217">(Sep 28 2017 at 12:41)</a>:</h4>
<p>I'm not sure <em>what</em> STU3 users should/would expect in these situations.  <em>I</em> always interpreted the standard in the R4 way and was surprised that Grahame has a different approach.  In your example, by Grahame's logic, 1) limits the type to strings only and 2) would then be further constraining valueString to max=1.<br>
<span class="user-mention" data-user-id="191316">@Grahame Grieve</span> - what do you think Forge should do?<br>
What's probably best would be to check the STU3 validators and see how they operate.  And, look for STU3 official profiles and try to discern intent.</p>



<a name="153911964"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911964" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911964">(Oct 03 2017 at 02:57)</a>:</h4>
<p>we don't want needless variation. So it should be a SHALL - SHALL rename to valueString. and derived profiles SHALL use valueString. If they don't, the derivation is wrong.</p>



<a name="153911965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153911965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153911965">(Oct 03 2017 at 02:58)</a>:</h4>
<p>I don't know about R3, but the IG publisher is all R4, even when publishing old IGs, so we can just look ahead, I think</p>



<a name="153912034"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153912034" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153912034">(Oct 03 2017 at 10:33)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>,</p>



<a name="153912102"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153912102" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153912102">(Oct 03 2017 at 19:29)</a>:</h4>
<p>To be crystal clear:<br>
a) <code>Extension.valueString</code> is <em>not</em> a valid id.<br>
b) The presence of <code>Extension.value[x]:valueString</code> alone does NOT constrain valid types for value[x].</p>



<a name="153912104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153912104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153912104">(Oct 03 2017 at 19:31)</a>:</h4>
<p>If an element is defined with <code>path: "Extension.valueString"</code>, it SHALL be interpreted as id <code>Extension.value[x]:valueString</code> in R4. Personally I'd recommend this interpretation in R3 as well.</p>



<a name="153912235"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153912235" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153912235">(Oct 04 2017 at 09:33)</a>:</h4>
<p>Still a bit concerned about incompatible interpretation difference inbetween STU3 and R4.</p>
<p>Ewout always assumed that a choice type element constraint with a renamed path (<code>valueString</code>) effectively restricts the allowed type choices to that single type. This interpretation does not affect the behavior of the .NET snapshot generator for STU3, as it will happily merge any constraints it encounters, regadless of wether they are actually valid or not; that is up to the validator to determine. However it definitely affects the implementation of the .NET validator.</p>
<p>I think that the current STU3 .NET validator interprets a constraint on a renamed choice type element (<code>valueString</code>) to implicitly restrict the set of allowed type options to the specified single type.</p>
<p>It appears that this behavior is now different from the behavior of the IG publisher with R4 interpretation...?</p>



<a name="153912238"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153912238" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153912238">(Oct 04 2017 at 10:13)</a>:</h4>
<p>umm, what's the difference?</p>



<a name="153912242"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153912242" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153912242">(Oct 04 2017 at 11:17)</a>:</h4>
<p>If I understand correctly:</p>
<ul>
<li>
<p>STU3 (as currently implemented by .NET validator):<br>
A constraint on renamed choice type element (e.g. <code>valueString</code>) is interpreted to limit the type choices. So the validator will reject all other types.</p>
</li>
<li>
<p>R4 (as currently implemented by IG Publisher)<br>
A constraint on renamed choice type element (e.g. <code>valueString</code>) is interpreted to further restrict that specific type. It does NOT limit the valid type options. So the validator will accept other types (introduced by the base profile).</p>
</li>
</ul>



<a name="153912617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153912617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153912617">(Oct 05 2017 at 13:52)</a>:</h4>
<p>I agree with your understanding <span class="user-mention" data-user-id="191336">@Michel Rutten</span> . The R3 validators selected one possible interpretation which is now at odds with R4.</p>



<a name="153912679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153912679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153912679">(Oct 05 2017 at 19:40)</a>:</h4>
<p>hmm. I'll add a test for this. note, though, that the main validator, we ask people to use the R4 validator now</p>



<a name="153913050"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Choice%20type%20element%20renaming/near/153913050" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Choice.20type.20element.20renaming.html#153913050">(Oct 09 2017 at 08:45)</a>:</h4>
<p>Thanks for the feedback. I'll discuss this with Ewout, as he is responsible for the implementation of the .NET validator.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
