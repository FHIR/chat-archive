---
layout: page
title: "FHIR Chat  · Snapshot Generation · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html">Snapshot Generation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153853167"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853167" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853167">(Oct 19 2016 at 12:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191351">@Chris Grenz</span> <span class="user-mention" data-user-id="191336">@Michel Rutten</span> I have committed all the changes from Thursday night discussion at Baltimore (svn revision 10025). Please check that there are no remaining issues</p>



<a name="153853177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853177">(Oct 19 2016 at 12:46)</a>:</h4>
<p>Will do!</p>



<a name="153853186"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853186" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853186">(Oct 19 2016 at 16:19)</a>:</h4>
<p>I've downloaded the new definitions.zip from <a href="http://hl7-fhir.github.io" target="_blank" title="http://hl7-fhir.github.io">hl7-fhir.github.io</a>. The contained xml files have timestamp 2016-10-18 10:45 - Is that the most recent version?</p>



<a name="153853187"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853187" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853187">(Oct 19 2016 at 16:21)</a>:</h4>
<p>Github hasn't been updating - see the committer's chat</p>



<a name="153853188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853188">(Oct 19 2016 at 16:21)</a>:</h4>
<p>OK, thanks Lloyd!</p>



<a name="153853189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853189">(Oct 19 2016 at 16:22)</a>:</h4>
<p>I'll try again tomorrow.</p>



<a name="153853487"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853487" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853487">(Oct 20 2016 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Seeing the following differences to my implementation when comparing the Patient profile. Not sure all of these are agreed upon:</p>
<ul>
<li><a href="http://Patient.id" target="_blank" title="http://Patient.id">Patient.id</a>: base.max:"*" - appears often, should be max:"1"</li>
<li>ele-1 constraint (and condition) not inherited, also ext-1.  Is included on BackboneElement?</li>
<li>No base element where element introduced, e.g. Patient.identifier - not sure if this is intentional? Thought base was to be included always to simplify implementations?</li>
<li>Not including mappings from types (see Patient.identifier - Identifier type mappings not included)</li>
<li><a href="http://Patient.contact.id" target="_blank" title="http://Patient.contact.id">Patient.contact.id</a> - comments not included</li>
</ul>



<a name="153853552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853552">(Oct 20 2016 at 21:30)</a>:</h4>
<p>found and fixed the base.max problem - was getting cardinalities from the parent not the child</p>



<a name="153853553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853553">(Oct 20 2016 at 21:30)</a>:</h4>
<p>don'tf follow the ele-1 issue - it's appearing everywhere I think it should</p>



<a name="153853558"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853558" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853558">(Oct 20 2016 at 21:33)</a>:</h4>
<p>same for ext-1</p>



<a name="153853559"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853559" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853559">(Oct 20 2016 at 21:34)</a>:</h4>
<p>base: 'is provided when the element definition is not the original definition of an element'</p>



<a name="153853560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853560">(Oct 20 2016 at 21:34)</a>:</h4>
<p>I don't think think constraints and mappings should be cloned out of the type - they apply, so they shouldn't be denormalised </p>



<a name="153853561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853561">(Oct 20 2016 at 21:35)</a>:</h4>
<p>and I don't follow the issue about comments on <a href="http://Patient.contact.id" target="_blank" title="http://Patient.contact.id">Patient.contact.id</a></p>



<a name="153853716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853716">(Oct 21 2016 at 14:38)</a>:</h4>
<p>I think ele-1/ext-1 and comments are both how we're handling inheritance from the types - I grab everything from the types the same way as from base (type upstream from base).  I think this was the consensus from Thursday as well as between <span class="user-mention" data-user-id="191336">@Michel Rutten</span>  and I.  It's in line with the thinking that <em>all</em> things needed to validate an element should be included in the snapshot (if the element is present, all relevant constraints are included).</p>



<a name="153853717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853717">(Oct 21 2016 at 14:40)</a>:</h4>
<p>definition of base is unfortunate...makes a parser look in 2 places. We planned to use base.max in our JSON/XML converter to determine whether an element is an array - now have to look in 2 places and hope that a snapshot provided doesn't elect to omit base (it's optional?).  Would rather see it mandatory.</p>



<a name="153853741"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853741" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853741">(Oct 21 2016 at 20:11)</a>:</h4>
<p>base is not optional. It must be provided if the definition is not the original definition</p>



<a name="153853742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853742">(Oct 21 2016 at 20:12)</a>:</h4>
<p>I don't recall agreeing that we would inline everything from the types into the snapshot. In fact, what I remember is that I was passionately opposed to that, but we agreed that there are some cases in which it would make sense to inline everything into the snapshot, and so a snapshot generator could choose to do that. but I don't have time to do that as an option between now and my milestone deadline</p>



<a name="153853743"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853743" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853743">(Oct 21 2016 at 20:13)</a>:</h4>
<p>as it happens, I fixed a bug in my code around the dual location for max yesterday, so I can see the point of just making base mandatory</p>



<a name="153853744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853744">(Oct 21 2016 at 20:13)</a>:</h4>
<p>do you want to propose a task?</p>



<a name="153853885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853885">(Oct 24 2016 at 10:05)</a>:</h4>
<ul>
<li>
<p>Concerning the merging of type profiles, I seem to remember from the Baltimore discussion that we agreed that this is the correct and desired approach. I specifically asked for confirmation that all elements should inherit the "ele-1" constraint from Element root, and @Gramahe I seem to recall that you agreed on this. IMHO, this makes the snapshot much more complete and useful. (Sorry Grahame...)</p>
</li>
<li>
<p>Concerning <a href="http://Patient.contact.id" target="_blank" title="http://Patient.contact.id">Patient.contact.id</a> - comment should be merged from the string datatype profile<br>
  =&gt; "RFC 4122"</p>
</li>
<li>
<p>Same for Patient.photo - comment should be merged from Attachment datatype profile <br>
  =&gt; "When providing a summary view (for example with Observation.value[x]) Attachment should be represented with a brief display text such as &amp;quot;Attachment&amp;quot;."</p>
</li>
<li>
<p>Concerning ElementDefinition.Base - IIRC we agreed that we only generate these for elements that are actually derived from a base, and not for newly introduced elements. (Sorry Chris...)</p>
</li>
</ul>



<a name="153853887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853887">(Oct 24 2016 at 10:10)</a>:</h4>
<p>Note that if a profile specifies a constraint on a child element of a type profile, than the snapshot need to merge these onto the original child element definitions from the type profile. So we need to implement logic to merge type profiles anway, right?</p>



<a name="153853888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853888">(Oct 24 2016 at 10:22)</a>:</h4>
<p>hey Michel. We agree that ele-1 would be on all types, including all anonymous types. I've made it so </p>



<a name="153853889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853889">(Oct 24 2016 at 10:23)</a>:</h4>
<p>Chris wants more - he wants to inline content from the types to the containing models</p>



<a name="153853890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853890">(Oct 24 2016 at 10:23)</a>:</h4>
<p>we agree that this could be a useful option for generating snapshots, but would not be necessary</p>



<a name="153853891"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853891" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853891">(Oct 24 2016 at 10:24)</a>:</h4>
<p>but your next 2 comments make it sound as though you think some information should be inlined. I don't agree</p>



<a name="153853892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853892">(Oct 24 2016 at 10:24)</a>:</h4>
<p>I think I do type profiles correctly now</p>



<a name="153853894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853894">(Oct 24 2016 at 11:27)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I've noticed that fully merging type profiles has huge benefits in Forge &amp; Simplifier. It makes it completely explicit to the end user which constraints are being inherited. Also this allows Forge to completely verify that your differential constraints are valid and don't conflict with any of the inherited constraints. For example, a profiler may not define a custom mapping on any element with id "ele-1". It also works great for extensions, by merging in the underlying extension definition. Without type profile merging, all of this becomes implicit and is no longer verifiable based on the snapshot. IMHO this conflicts with the ultimate goal of making everything fully computable.</p>
<p>Frankly, I don't really see a valid reason not to merge type profiles into the snapshot, except maybe for the additional burden on the library implementers. However many users will rely on the existing open source FHIR API libraries. And if not, then they can inspect the existing .NET/Java library source code as a guideline for their own custom implementation. I've found that the hardest challenge is solving the recursion problem. Eventually I've realized that you can avoid recursion by doing a breadth-first expansion. The .NET library currently implements a simplified version of this, just smart enough to handle <a href="http://Element.id" target="_blank" title="http://Element.id">Element.id</a> and Extension.extension.</p>
<p>Considering that the FHIR .NET library is already capable of merging type profiles, and it provides such useful benefits in Forge &amp; Simplifier, we'd really like to maintain and leverage our current implementation. We could easily make this behavior configurable, but imho providing various snapshot options will only confuse the community so I'm not a strong proponent of that.</p>
<p>I fully understand that you have serious time constraints and won't be able to implement this anytime soon. However imho this shouldn't hold us back from correcting/clarifying the spec. Maybe we can assist by generating official snapshots from the current .NET library, until the build can handle this?</p>



<a name="153853895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853895">(Oct 24 2016 at 11:27)</a>:</h4>
<p><a href="/user_uploads/10155/x0noqvUv7h0f4nje_FFUj6bp/Patient.structuredefinition.xml" target="_blank" title="Patient.structuredefinition.xml">Patient.structuredefinition.xml</a> </p>



<a name="153853896"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853896" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853896">(Oct 24 2016 at 11:28)</a>:</h4>
<p>Attached an example snapshot of the default DSTU-2 Patient resource by the current .NET API.</p>



<a name="153853897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853897">(Oct 24 2016 at 11:40)</a>:</h4>
<p>Taking a step back, if FHIR defines the snapshot component in such a form that by default, it does not provide sufficient information for profiling tools such as Forge &amp; Simplifier, then what is the use of generating and including this? In that case, profiling tools would always need to implement their own differential completion logic anyway. Which seems to defeat the purpose of serializing the snapshot component. Right?</p>



<a name="153853902"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853902" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853902">(Oct 24 2016 at 13:22)</a>:</h4>
<p>"Chris wants more - he wants to inline content from the types to the containing models"</p>
<p>What Chris and I are proposing is to always merge the constraints of the <strong>root</strong> element of the datatype. However datatype child nodes are only inlined if the user profile specifies any child constraints. So for example, <strong>Patient.identifier</strong> is merged with constraints from <strong>Identifier</strong> datatype root element definition. However e.g. <strong>Identifier.system</strong> is not inlined, unless the user profile specifies any constraints on children of <strong>Patient.identifier</strong>. In that case, the snapshot generator inlines all the child elements of the <strong>Identifier</strong> datatype and merges any user profile child constraints on top of them.</p>
<p>For example, primitive datatypes are merged with the base profile Element:<br>
- Merge primitive root element on top of base profile root = <strong>Element</strong> (=&gt; datatype root inherits "ele-1")<br>
- Inline children of base profile = <strong>Element.id</strong>, <strong>Element.extension</strong></p>
<p>So eventually, <strong>Element.id</strong> recursively picks up the "ele-1" constraint from Element root:<br>
- <strong>string</strong> root inherits "ele-1" from <strong>Element</strong> snapshot root<br>
- <strong>identifier</strong> root inherits "ele-1" from <strong>string</strong> snapshot root<br>
- <strong>Element.id</strong> inherits "ele-1" from <strong>identifier</strong> snapshot root</p>



<a name="153853903"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853903" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853903">(Oct 24 2016 at 13:51)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> Agree. If an element is included, it should include everything needed to validate.  Note that this makes no statement about <em>which</em> elements to include.</p>



<a name="153853905"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853905" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853905">(Oct 24 2016 at 13:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191351">@Chris Grenz</span> Correct, that is what I meant to explain.</p>



<a name="153853907"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853907" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853907">(Oct 24 2016 at 14:28)</a>:</h4>
<p><a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12179" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12179">GF#12179</a> supports this viewpoint...moved by Grahame?</p>



<a name="153853913"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853913" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853913">(Oct 24 2016 at 16:48)</a>:</h4>
<p>So my memory isn't failing me... thx Chris ;p</p>



<a name="153853914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853914">(Oct 24 2016 at 16:53)</a>:</h4>
<p>Anyway <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> considering your huge workload, I think that for now it would be sufficient to clearly define the desired behavior in the spec. I don't think it's that big of a problem if it takes a while for the official build to support this functionality. Forge &amp; Simplifier will be able to generate their own (complete) snapshots anyway, even for core datatypes and profiles. Also the FHIR .NET API library can provide a customized version of definitions.xml.zip that contains complete snapshots. So delayed implementation in the build wouldn't keep us from progressing.</p>



<a name="153853915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853915">(Oct 24 2016 at 17:00)</a>:</h4>
<p>BTW I'd rather keep ElementDefinition.Base empty for newly introduced elements. IMHO this better conveys the intended meaning than a self-referential Base declaration, which to me seems a bit of a leaky abstraction. <span class="user-mention" data-user-id="191351">@Chris Grenz</span> if it is more convenient for your implementation to always have a base, then couldn't you add a simple pre-processing step to fill in missing Base elements? This way, self-referential base elements remain an internal implementation detail of your logic and don't need to be serialized to the snapshot.</p>



<a name="153853916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853916">(Oct 24 2016 at 17:01)</a>:</h4>
<p>it's certainly possible either way - I don't find it a "leaky abstraction" - the base of a new element is itself.</p>



<a name="153853917"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853917" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853917">(Oct 24 2016 at 17:02)</a>:</h4>
<p>The intent is to convey the original cardinality, not convey whether the element in hand is a new specialization or not.</p>



<a name="153853918"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853918" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853918">(Oct 24 2016 at 17:11)</a>:</h4>
<p>And if it were, having base in all cases explicitly indicates whether a new element *is* the introduction/specialization - no further inspection needed.</p>



<a name="153853919"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853919" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853919">(Oct 24 2016 at 17:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191351">@Chris Grenz</span>  I see your point, your suggestion does improve symmetry/uniformity. I don't have a very strong opinion on this. Just seems a bit noisy, but I guess I can live with it. Impact on our implementation is minimal.</p>



<a name="153853920"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853920" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853920">(Oct 24 2016 at 17:14)</a>:</h4>
<p>Yeah, I wasn't crazy about base being introduced at all since it's redundant.  But if it's there, might as well ensure it's consistent (which current technical constraints don't/cannot).</p>



<a name="153853921"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853921" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853921">(Oct 24 2016 at 17:33)</a>:</h4>
<p>I agree we should inline types when we can - the challenge is that type profiles might not all be available at the time the snapshot is generated.  I don't think we want to make snapshot generation dependent on the availability of all profiles.  That in turn means that snapshots may not generate the same each time.  Is that something we're ok with?</p>



<a name="153853925"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853925" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853925">(Oct 24 2016 at 17:58)</a>:</h4>
<p>I think we define a "standard" form and then describe the ways in which it may degrade (or expound) based on need.  It may degrade primarily due to lack of access to dependent profiles.  It could also degrade due to app specific needs (such as omitting descriptive elements) within the limits of the constraints.</p>



<a name="153853928"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853928" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853928">(Oct 24 2016 at 18:05)</a>:</h4>
<p>so I think you're using confusing language here:</p>



<a name="153853929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853929">(Oct 24 2016 at 18:07)</a>:</h4>
<p>why would we inline some things from a type, and why would we not? </p>



<a name="153853930"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853930" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853930">(Oct 24 2016 at 18:08)</a>:</h4>
<p>We would unless the type profile wasn't available for some reason</p>



<a name="153853931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853931">(Oct 24 2016 at 18:08)</a>:</h4>
<p>firstly, are you claiming that if you don't duplicate the constraints out of a type, to the element, then they don't apply? </p>



<a name="153853932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853932">(Oct 24 2016 at 18:08)</a>:</h4>
<p>Not at all. The inverse - since they apply, they should be inlined.</p>



<a name="153853933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853933">(Oct 24 2016 at 18:09)</a>:</h4>
<p>and if you claim that the do apply after all, then why inline *some* things from a type - which things? - and confuse matters by putting them in 2 places?</p>



<a name="153853938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853938">(Oct 24 2016 at 18:11)</a>:</h4>
<p>The proposal was that the element lineage passes up the resource lineage (e.g. Patient, DomainResource, Resource) and then into the type lineage (Patient.meta.tag -&gt; Resource.meta.tag -&gt; Meta.tag -&gt; Coding -&gt; Element)</p>



<a name="153853939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853939">(Oct 24 2016 at 18:11)</a>:</h4>
<p>I don't understand how that is an answer to my questions</p>



<a name="153853941"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853941" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853941">(Oct 24 2016 at 18:12)</a>:</h4>
<p>A "standard" snapshot should accumulate/inherit from all points in this lineage</p>



<a name="153853942"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853942" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853942">(Oct 24 2016 at 18:14)</a>:</h4>
<p>what we agreed was that (a) types should inherit properly - and I think i do that now - and (b) you could inline things from elements to types if you wanted</p>



<a name="153853944"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853944" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853944">(Oct 24 2016 at 18:15)</a>:</h4>
<p>"if you wanted" meaning a snapshot form other than the "standard" ("canonical"? not sure what the best word is here) one.</p>



<a name="153853945"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853945" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853945">(Oct 24 2016 at 18:16)</a>:</h4>
<p>my memory of the discussion is that we agreed that you could inline into the snapshot if you wanted. Though I have no memory of talking about inlining *some* things from a type and not others</p>



<a name="153853946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853946">(Oct 24 2016 at 18:16)</a>:</h4>
<p>So in <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> 's case, if the type profiles weren't available, a legal snapshot could omit them, but they wouldn't match to the "standard" profile.  The build was intended to implement this "standard" snapshot (which would for instance included ele-1 for all elements).</p>



<a name="153853947"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853947" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853947">(Oct 24 2016 at 18:17)</a>:</h4>
<p>I don't remember that either - *all* "things" from a type should be inlined</p>



<a name="153853948"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853948" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853948">(Oct 24 2016 at 18:17)</a>:</h4>
<p>which would include ele-1</p>



<a name="153853949"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853949" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853949">(Oct 24 2016 at 18:18)</a>:</h4>
<p>Lloyd's case beats me. It's degenerate. I can't generate or process things correctly when things are missing</p>



<a name="153853950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853950">(Oct 24 2016 at 18:18)</a>:</h4>
<p>but you're saying that children elements are not inlined. so you're saying some things</p>



<a name="153853951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853951">(Oct 24 2016 at 18:19)</a>:</h4>
<p>the selection of *which* elements is a separate topic.  For the ones that are included, they should include the complete elementdefinition (inherited from the entire lineage).</p>



<a name="153853952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853952">(Oct 24 2016 at 18:21)</a>:</h4>
<p><a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12179" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12179">GF#12179</a> is explicit on the inheriting from types even including the ele-1 example...</p>



<a name="153853953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853953">(Oct 24 2016 at 18:22)</a>:</h4>
<p>no. I have *no idea* what you and Michel are on about then. I inherit everything correctly, so far as I can tell, and you're talking about something else. </p>



<a name="153853956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853956">(Oct 24 2016 at 18:27)</a>:</h4>
<p>In the current build for <a href="http://hl7-fhir.github.io/patient.profile.xml.html" target="_blank" title="http://hl7-fhir.github.io/patient.profile.xml.html">Patient</a>, the snapshot for the Patient.telecom element has no constraints.  The lineage for Patient.telecom is (Patient.telecom -&gt; ContactPoint -&gt; Element).  Therefore, the snapshot should include 2 constraints, cpt-2 and ele-1.</p>



<a name="153853957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853957">(Oct 24 2016 at 18:28)</a>:</h4>
<p>this is *not* a matter of inheritance at all</p>



<a name="153853958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853958">(Oct 24 2016 at 18:29)</a>:</h4>
<p>you are saying that information from the type should inlined in the element so that you can process it correctly without access to the type. But only some information, so you can only process it partially correctly </p>



<a name="153853959"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853959" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853959">(Oct 24 2016 at 18:29)</a>:</h4>
<p>sorry, but I'm not making sense of that </p>



<a name="153853960"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853960" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853960">(Oct 24 2016 at 18:30)</a>:</h4>
<p>Your point is that since I don't include Patient.telecom.system, I'm not including *all* the type information?</p>



<a name="153853962"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853962" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853962">(Oct 24 2016 at 18:31)</a>:</h4>
<p>yes</p>



<a name="153853964"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853964" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853964">(Oct 24 2016 at 18:33)</a>:</h4>
<p>I think our point was that selection of which elements to include was an independent decision from what is the correct form of a single element.</p>



<a name="153853965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853965">(Oct 24 2016 at 18:33)</a>:</h4>
<p>And that the contents of a single element in "standard form" should be character-wise comparable (possibly with some ordering concessions) with any generated snapshot.</p>



<a name="153853967"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853967" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853967">(Oct 24 2016 at 18:34)</a>:</h4>
<p>I disagree with that and what I remember is that the inclusion of any duplicative information was a choice for the generator, and that a snapshot comparision tool had to allow for that</p>



<a name="153853968"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853968" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853968">(Oct 24 2016 at 18:35)</a>:</h4>
<p>What were you supporting in <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12179" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12179">GF#12179</a> ?</p>



<a name="153853969"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853969" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853969">(Oct 24 2016 at 18:35)</a>:</h4>
<p>doing the inheritence correctly, which I had not been</p>



<a name="153853973"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853973" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853973">(Oct 24 2016 at 18:40)</a>:</h4>
<p>If I created a Patient profile (my-patient) and constrained Patient.telecom.system min=1, would Patient.telecom *then* include cpt-1 and ele-1 (since all children of telecom would be included)?</p>



<a name="153853975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853975">(Oct 24 2016 at 18:42)</a>:</h4>
<p>I don't follow your 'since'</p>



<a name="153853977"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853977" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853977">(Oct 24 2016 at 18:42)</a>:</h4>
<p>once a child of telecom is included, all children would be included.</p>



<a name="153853978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853978">(Oct 24 2016 at 18:42)</a>:</h4>
<p>telecom.system, .value, .use, .rank, etc.</p>



<a name="153853979"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853979" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853979">(Oct 24 2016 at 18:44)</a>:</h4>
<p>oh yes. I mis read that. Yes, you would inline all of it in the snapshot.</p>



<a name="153853980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853980">(Oct 24 2016 at 18:44)</a>:</h4>
<p>so then cpt-1 and ele-1 would appear in Patient.telecom</p>



<a name="153853989"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853989" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853989">(Oct 24 2016 at 18:52)</a>:</h4>
<p>then they would, yes, because you inlining the data tyep</p>



<a name="153853990"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853990" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853990">(Oct 24 2016 at 18:52)</a>:</h4>
<p>and I did check that this works properly now too </p>



<a name="153853993"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853993" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853993">(Oct 24 2016 at 18:54)</a>:</h4>
<p>you're adding things profile-by-profile...I'm adding them element-by-element. Our world-views are different....</p>



<a name="153853996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853996">(Oct 24 2016 at 18:56)</a>:</h4>
<p>sufficiently different that I don't even know what you mean</p>



<a name="153853997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853997">(Oct 24 2016 at 18:57)</a>:</h4>
<p>I have all the profiles loaded into my tool and build all the lineages as I describe.  I then generate snapshots by deciding which (fully populated) elements to include.  I'm not loading or not loading additional profiles to add to the snapshot.</p>



<a name="153853998"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153853998" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153853998">(Oct 24 2016 at 18:58)</a>:</h4>
<p>So my point of view was to agree upon what a *complete* element looks like.</p>



<a name="153854056"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854056" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854056">(Oct 25 2016 at 09:04)</a>:</h4>
<p>"the challenge is that type profiles might not all be available at the time the snapshot is generated. I don't think we want to make snapshot generation dependent on the availability of all profiles. That in turn means that snapshots may not generate the same each time."</p>
<p>To quote Grahame, seems like we're moving the deckchairs around.</p>
<p>If we want to validate conformance against a profile that has references to external profiles, then we always need access to the information in those external profiles. If we allow the snapshot component to omit information from external profiles because they may be missing, then we put the burden to resolve the external profiles on the consuming application. If the application can't resolve external profiles either, then all bets are off and any computations against the profile are unreliable, esp. validation.</p>
<p>Therefore, I don't see the benefits of allowing a "partial" snapshot by defining type profile merging as optional. If an application cannot rely on the snapshot to provide all required structural and type information, then the whole effort of serializing the snapshot seems moot. Because in that case, profile-based applications will have to dynamically resolve and generate all the required information necessary to compute reliable results anyway. So then why serialize a useless partial snapshot?</p>
<p>Concrete, I propose:<br>
- if the differential contains an element constraint with a single type, then for the snapshot we merge those diff constraints on top of the snapshot root element from the target type profile<br>
- if the differential also specifies constraints on child elements, then we inline all the datatype child elements and merge the diff constraints on top of them</p>
<p>Note: the snapshot generator in the .NET API library tries to handle errors (such as unresolved external references) gracefully by trying to continue generating the snapshot, finally returning a partial, incomplete result and a set of operation outcome issues. This way, a client application can detect and interpret errors and decide how to deal with the returned partial and incomplete snapshot. If the generator reports any issues, then the generated snapshot is not reliable.</p>



<a name="153854064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854064">(Oct 25 2016 at 09:14)</a>:</h4>
<p>what we said in baltimore was:<br>
- generated types need to get inheritance right. I've done that now<br>
- inlining the types would be optional. I'm not doing that right now, but I may get to it later (to make it optional)<br>
- if you don't inline the types, any consuming software will have to resolve the types<br>
- if you do inline the types, you could have consistency issues because editors won't have authority to update dependent profiles </p>
<p>I don't think that a minimal snapshot is useless. The hard part of snapshot is doing the actual snapshot; following a link and applying a new set of rules is really quite trivial by comparison. </p>



<a name="153854065"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854065" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854065">(Oct 25 2016 at 09:14)</a>:</h4>
<p>According to general FHIR principles, I'd rather move the burden to the server implementers and resolve external type profiles at authoring time, when tools can provide useful feedback to the profile author.</p>



<a name="153854067"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854067" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854067">(Oct 25 2016 at 09:15)</a>:</h4>
<p>well, you can. But I object strenuously to making it always required</p>



<a name="153854071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854071">(Oct 25 2016 at 09:16)</a>:</h4>
<p>Off course in practice there will be situations where an external profile cannot be resolved. That's why the FHIR .NET API tries to handle this gracefully. But the resulting snapshot will be incomplete and unreliable.</p>



<a name="153854073"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854073" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854073">(Oct 25 2016 at 09:16)</a>:</h4>
<p>"if you do inline the types, you could have consistency issues because editors won't have authority to update dependent profiles" <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> can you explain this?</p>



<a name="153854075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854075">(Oct 25 2016 at 09:19)</a>:</h4>
<p>so Author A writes type profile Ta<br>
Author B write resource profile Rb<br>
Rb uses Ta, so it inlines Ta<br>
Now Author A updates profile Ta to version 2. <br>
Rb is now wrong</p>



<a name="153854105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854105">(Oct 25 2016 at 09:39)</a>:</h4>
<p>Yes, but IIRC FHIR states that if a new version of a profile introduces any breaking changes, then the new version should have a new, unique canonical url. Right?</p>
<p>- Author A creates Ta*, <strong>compatible</strong> with Ta<br>
- Profile author B regenerates Tb* by inlining Ta*.<br>
  Then profile Tb* is compatible with profile Tb.<br>
  After all, the total set of resource instances conforming to Tb* is the same as the set that conforms to Tb.<br>
  So for profile validation, Tb and Tb* are interchangeable.<br>
  So author B is not strictly required to update the snapshot.<br>
  However if he chooses to, then the author is allowed to republish Tb* as a new version of Tb with the same canonical url.<br>
- Author A creates Ta2, <strong>incompatible</strong> with Ta and Ta*<br>
- Profile author B regenerates Tb2 by inlining Ta2.<br>
  Then profile Tb2 is <strong>incompatible</strong> with profile Tb and Tb*.<br>
  So profile Tb2 must be published with a new canonical url.</p>



<a name="153854108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854108">(Oct 25 2016 at 09:40)</a>:</h4>
<p>actually, your interpretation of breaking changes is not correct</p>



<a name="153854109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854109">(Oct 25 2016 at 09:40)</a>:</h4>
<p>Can you please enlighten me?</p>



<a name="153854110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854110">(Oct 25 2016 at 09:41)</a>:</h4>
<p>you've said that compatible means they are interchangeable for validation, but what we've said is that as long as instances conformant to Ta are also conformant to Ta*, then this is not a breaking change</p>



<a name="153854111"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854111" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854111">(Oct 25 2016 at 09:41)</a>:</h4>
<p>so they are not interchangable</p>



<a name="153854114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854114">(Oct 25 2016 at 09:42)</a>:</h4>
<p>Ah so Ta* is allowed to relax constraints of Ta, so a bigger set of resources would now be conformant?</p>



<a name="153854115"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854115" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854115">(Oct 25 2016 at 09:43)</a>:</h4>
<p>yes</p>



<a name="153854121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martijn Harthoorn <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854121">(Oct 25 2016 at 09:52)</a>:</h4>
<p>I think the definition of "breaking changes" is problematic. Since there will be definitions of both the old version and the new version - both with the same canonical uri living in the world. So from the author perspective, there is backwards compatibility. But from a collaboration perspective, this order is not guaranteed.</p>



<a name="153854122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854122">(Oct 25 2016 at 09:53)</a>:</h4>
<blockquote>
<p>Chris wants more - he wants to inline content from the types to the containing models</p>
</blockquote>
<p>Yes, if a differential moves into a type, that type should be included in the snapshot. At least, that's the assumption I've been working with in my validator and the previous versions of the snapshot generator.</p>



<a name="153854123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854123">(Oct 25 2016 at 09:55)</a>:</h4>
<p>no he wants something different to that. If you reference a type he wants to duplicate some information from the type into the profile - when you don't walk into it</p>



<a name="153854124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854124">(Oct 25 2016 at 09:56)</a>:</h4>
<p>@<strong>Martijn</strong> yes the definition is problematic, but the converse - Michel's definition - is much more problematic, because it means that there's no forwards migration path that doesn't mean a rewrite for trivial changes. In CDA space, this has proven a major issue</p>



<a name="153854125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854125">(Oct 25 2016 at 10:11)</a>:</h4>
<p>- Author A publishes Ta* which relaxes Ta constraints<br>
- profile Tb*, which inlines Ta*, describes a new version of the implemented system</p>
<p>- Assume that Sb represents the set of profiles that validate against Tb<br>
  Assume that Sb* represents the set of resources that validate against Tb*<br>
  So Sb* contains Sb and some additional resources</p>
<p>- I don't think that there is a reasonable expectation that a system that has implemented Tb will automatically support Tb*<br>
  Since it is not guaranteed that the system is able to handle the additional resources in set Sb*<br>
  So profile Tb* is not guaranteed to describe the actual capabilities of the implemented system<br>
- So profile Tb still describes the <strong>guaranteed</strong> capabilities of the implemented system<br>
  So I wouldn't say Tb is now wrong.</p>



<a name="153854126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854126">(Oct 25 2016 at 10:11)</a>:</h4>
<p>there is a reaonable assumption unless the reference was version specific </p>



<a name="153854127"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854127" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854127">(Oct 25 2016 at 10:14)</a>:</h4>
<blockquote>
<p>so Author A writes type profile Ta<br>
Author B write resource profile Rb<br>
Rb uses Ta, so it inlines Ta<br>
Now Author A updates profile Ta to version 2. <br>
Rb is now wrong</p>
</blockquote>
<p>This issue exists when the profile "walks into" Ta as well.  Author B -when he wrote his profile- looked at type profile Ta when he produced his profile. and added applicable child constraints. It's debatable whether author B would like his profile to "automatically" accepts a broader set of instances if author A decides to change Ta by easing a constraint. Though I do agree that is our current methodology.   It's even more debatable for developers, who probably want a "snapshotted" version at compile time of their software.  Except maybe for some generic servers, I expect most developers don't want their software to automagically adapt if a type profile they depend on changes.</p>



<a name="153854128"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854128" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854128">(Oct 25 2016 at 10:14)</a>:</h4>
<p>How can there be an expectation on a system to support additional resources that it wasn't originally designed for?</p>



<a name="153854129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854129">(Oct 25 2016 at 10:15)</a>:</h4>
<p>Well, Spark could do that for example. But systems built on top of an existing database - no you can't expect them to do that.</p>



<a name="153854130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854130">(Oct 25 2016 at 10:16)</a>:</h4>
<p>Yes, I was thinking about e.g. a (non-dynamic) user interface such as an input form.</p>



<a name="153854131"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854131" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854131">(Oct 25 2016 at 10:17)</a>:</h4>
<p>is that how you design your software? clone type definitions so that when the source type definition is changed, you also have to manually update all the things that use it to tell them to use the new version?</p>



<a name="153854132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854132">(Oct 25 2016 at 10:45)</a>:</h4>
<p>Yes, I fully expect Epic to work this way for example.  They will implement Argonaut, but they will take a snapshot at the moment they implement and test the software. Any changes to dependent types will be done - but manually when the Epic team decides to update the dependent definitions. And this is the moment snapshots are re-generated.</p>
<p>But Spark - no - it will adapt immediately</p>
<p>Simplifier - yet another situation: we'd like to generate Snapshots once, not every single time someone requests the StructureDefinition. This requires dependency tracking.</p>



<a name="153854141"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854141" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854141">(Oct 25 2016 at 11:33)</a>:</h4>
<p><span class="user-mention" data-user-email="grahame@healthintersections.com.au">@Grahame Grieve</span> software design &amp; implementation usually depends on the requirements and budget of the client. For specific use cases, I expect that systems implement a final, vetted version of the IG that both client and vendor/integrator agreed upon (and may even be set into law). In such cases, I don't think there is an expectation for the implemented system to support unforeseen future requirements. Otherwise, vendors would have to rethink their business model... ;p</p>
<p>Also, the term "snapshot" suggests that the component represents the state of some information at a specific moment in time (specified by StructureDefinition.date).</p>



<a name="153854150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854150">(Oct 25 2016 at 14:29)</a>:</h4>
<p>While I'm certainly interested in how we'll handle dependencies between profiles, determining the "standard" element format is a separate issue.  ALL snapshots will have dependency management issues - we've been dealing with that for years at this point.<br>
My question is: "Should an element included in a snapshot contain all known parts (mappings, constraints, aliases, etc.) including those parts inherited from base *and* type profiles?"</p>



<a name="153854158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854158">(Oct 25 2016 at 16:25)</a>:</h4>
<p>Changing the canonical URLs of all impacted profiles as soon as there's a breaking change to one of them is a huge pain.</p>



<a name="153854160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854160">(Oct 25 2016 at 17:07)</a>:</h4>
<p><span class="user-mention" data-user-id="191351">@Chris Grenz</span> the answer to your question is no. When you say that an element has a type, then you are saying that the value domain of the type applies to the element. It is not necessary to copy any of the value domain into the element that is assigned the type in order for those things to apply. </p>



<a name="153854162"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854162" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854162">(Oct 25 2016 at 17:09)</a>:</h4>
<p>you can choose to duplicate some information as a matter of publishing convenience but it should never be required to do so, and replicating some, but not all, is problematic for any consumer since they are required to find the source in order to know what you have and haven't duplicated</p>



<a name="153854167"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854167" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854167">(Oct 25 2016 at 17:15)</a>:</h4>
<p>While I understand your position (I think), to the casual observer you are advocating just that - replicating some but not all of what's needed to evaluate/describe an element (not including anything "brought in" from the type).  If we can be clear enough about that, I might be amenable.</p>
<p>I don't much care for though the contents of a single element changing based on (what looks like) the addition of child elements, e.g. the content of the element for Patient.maritalStatus changes if Patient.maritalStatus.system is included (since now everything from CodeableConcept is inlined).  I understand *why* that happens, but it's subtle to an observer.</p>



<a name="153854168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854168">(Oct 25 2016 at 17:16)</a>:</h4>
<p>I don't understand in which respect I am advocating some but not all </p>



<a name="153854169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854169">(Oct 25 2016 at 17:17)</a>:</h4>
<p>Again, you're "building up" the snapshot by applying whole profiles incrementally.  I'm assembling the whole thing and then determining which elements to include.</p>



<a name="153854170"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854170" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854170">(Oct 25 2016 at 17:20)</a>:</h4>
<p>If something forces the application of the type profile (including a child), then Patient.maritalStatus will include the ele-1 constriant.  If not, it won't.  What's included in an element depends on outside factors (even though the constraint is effective either way).</p>



<a name="153854171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854171">(Oct 25 2016 at 17:20)</a>:</h4>
<p>Running use cases in my head...</p>



<a name="153854172"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854172" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854172">(Oct 25 2016 at 17:22)</a>:</h4>
<p>I'm not sure what you mean 'application of the type profile' </p>



<a name="153854173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854173">(Oct 25 2016 at 17:22)</a>:</h4>
<p>if the profile uses a type profile, and the adds additional constraints on it by walking into it, then the snapshot has to include all the type it references </p>



<a name="153854176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854176">(Oct 25 2016 at 17:43)</a>:</h4>
<p>Different mental model here - when you "walk into" the type, you apply the type profile at that point.  I hold everything in memory/model and link together a lineage - Patient.maritalStatus -&gt; CodeableConcept -&gt; Element.  I then build each element by aggregating the contents of the lineage.  That why my element contents don't change when I opt to include more/less elements in the snapshot.</p>



<a name="153854177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854177">(Oct 25 2016 at 17:44)</a>:</h4>
<p>so what's the difference between 'there are no children' and 'I didn't include the children'?</p>



<a name="153854178"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854178" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854178">(Oct 25 2016 at 17:44)</a>:</h4>
<p>in the snapshot, nothing. By either of our methods.</p>



<a name="153854180"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854180" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854180">(Oct 25 2016 at 17:52)</a>:</h4>
<p>In my model, not include Patient.maritalStatus.system is just suppression of extra detail.  In yours, it's an effect of not considering ("walking into") the type at all.  I think both are understandable (after extensive discussion!) - which would the average IT person assume?</p>



<a name="153854181"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854181" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854181">(Oct 25 2016 at 17:54)</a>:</h4>
<p>maybe dependent on whether you're a modeler (my viewpoint) or an implementer (yours).</p>



<a name="153854182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854182">(Oct 25 2016 at 17:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> 's coming at it from a modeling standpoint as well...</p>



<a name="153854183"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854183" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854183">(Oct 25 2016 at 17:56)</a>:</h4>
<p>I think he's primarily looking at from a publishing view point - it's about dependencies. you've got an element focus, not a type focus. What I was establishing is that your interest is different to Michel's focus</p>



<a name="153854184"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854184" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854184">(Oct 25 2016 at 17:56)</a>:</h4>
<p>True...</p>



<a name="153854185"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854185" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854185">(Oct 25 2016 at 17:56)</a>:</h4>
<p>I still think that we should stick to what we agreed in Baltimore: It's not necessary to inline profiles, but you can to the degree you find it useful. You and Michel have differing degrees to each (and to me)</p>



<a name="153854186"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854186" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854186">(Oct 25 2016 at 17:58)</a>:</h4>
<p>Interesting how we can come out of meetings nodding together with different ideas in our heads!</p>



<a name="153854187"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854187" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854187">(Oct 25 2016 at 17:58)</a>:</h4>
<p>I can get on board with a type focus....</p>



<a name="153854188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854188">(Oct 25 2016 at 17:59)</a>:</h4>
<p>breaks my tooling</p>



<a name="153854189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854189">(Oct 25 2016 at 17:59)</a>:</h4>
<p>badly</p>



<a name="153854190"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854190" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854190">(Oct 25 2016 at 17:59)</a>:</h4>
<p>now I have to decide how deeply to navigate "up" the tree and stop (maybe) before I jump into the types.</p>



<a name="153854192"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854192" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854192">(Oct 25 2016 at 18:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> - how does Forge work - do you decide which elements to include independently of calculating the contents of an element? Or do the elements "appear" as profiles are added (Patient.maritalStatus.system appears when CodeableConcept is added/applied)?</p>



<a name="153854342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854342">(Oct 26 2016 at 11:21)</a>:</h4>
<p>Forge goes further than a regular snapshot; when loading/creating a profile, Forge expands the children of all complex types, regardless of wether the profile specifies differential child constraints - so the author can select the children and constrain them. The fully expanded structure is kept in memory. A separate layer generates the differential by including only nodes with actual constraints.<br>
On order to determine which elements to expand, Forge inspects the element type. If an element has a single complex type, then the children are being expanded (recursively).<br>
Recently I've integrated the new and improved snapshot generation logic from the FHIR .NET API into Forge. I'm now reimplementing change tracking. When change tracking is finished, I want to leverage the new API snapshot generator logic to dynamically expand elements on the fly. So for example, if you constrain a choice type to single complex type such as CodeableConcept, then I'd like Forge to inline the child elements on the fly. Same for extensions. Also I want to implement a command to allow authors to manually expand elements with name references.</p>



<a name="153854349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854349">(Oct 26 2016 at 14:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I agree that merging a (partial) type profile should not (and does not) change the meaning of the element definition, as the merged constraints are implied by the type profile constraint. However it does affect the completeness/usefulness of the snapshot component.</p>
<p><span class="user-mention" data-user-id="191351">@Chris Grenz</span>:</p>
<div class="codehilite"><pre><span></span> &quot;I don&#39;t much care for though the contents of a single element changing based on (what looks like) the addition of child elements&quot;
</pre></div>


<p>Agreed. Let's consider Grahame's approach for a profile with and without child constraints on Patient.identifier.system:</p>
<p>(1) Patient profile with constraint on identifier, but without any child constraints:</p>
<p>Patient.identifier          =&gt; not merged</p>
<p>(2) Patient profile with constraint on identifier and additional child constraints:</p>
<p>Patient.identifier          =&gt; merged onto Identifier<br>
Patient.identifier.use      =&gt; merged onto Identifier.use</p>
<p>So snapshot representation of the element "Patient.identifier" depends on the existance of nested child constraints...? So for example, element mappings and constraints inherited from the type profile root element are not merged into the snapshot, unless there are child constraints. This seems strange and could become a source of confusion.</p>
<p>I agree that for convenience, we should be able to generate a (partial) snapshot even if some external profiles are unavailable. However it should be clear to the author that the resulting snapshot will be incomplete.</p>



<a name="153854387"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854387" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854387">(Oct 26 2016 at 20:22)</a>:</h4>
<p>so the basic problem is that a user of the snapshot does not know when they need to consult with the type or not? I've been deciding that based on whether there is children or not - and automatically doing it for primitive types</p>



<a name="153854537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854537">(Oct 27 2016 at 14:16)</a>:</h4>
<p>Correct. I think the snapshot is generally more useful if individual snapshot ElementDefinitions always include relevant type constraints. Regardless of the presence or content of associated child constraints in the differential.<br>
Maximizing completeness improves the usefulness of the snapshot, as well as minimizing variance. The latter also facilitates comparison.</p>



<a name="153854828"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Snapshot%20Generation/near/153854828" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Snapshot.20Generation.html#153854828">(Oct 31 2016 at 10:05)</a>:</h4>
<blockquote>
<p>I think there are excellent patterns already in place for package management in Java and .NET (and others) - should we have something similar in the FHIR SD model?</p>
</blockquote>
<p>Yes, so this is a different issue than the "merging" and "path walking" issues above. I don't want to confuse both here, but it's really also true I realized that our dependencies are comparable to what happens in package management for libraries - and that means that our version management can learn from that. We know one of the popular strategies recently is actually doing what I described: give every solution a private copy of the dependencies (and its dependencies). Though it's fair to say there are fierce discussions about what's the right solution there too. </p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
