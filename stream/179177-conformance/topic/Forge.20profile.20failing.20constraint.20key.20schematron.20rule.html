---
layout: page
title: "FHIR Chat  · Forge profile failing constraint key schematron rule · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Forge.20profile.20failing.20constraint.20key.20schematron.20rule.html">Forge profile failing constraint key schematron rule</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153892261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Forge%20profile%20failing%20constraint%20key%20schematron%20rule/near/153892261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Eastwood <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Forge.20profile.20failing.20constraint.20key.20schematron.20rule.html#153892261">(Jun 05 2017 at 00:12)</a>:</h4>
<p>Hello, we have created a number of profiles using Forge (and have the snapshot generation turned on) and are working on ensuring it is valid against the STU3 published schema and schematrons.</p>
<p>However, validating against STU3 structuredefinition.sch results in the error:<br>
<code>eld-14: Constraints must be unique by key</code><br>
Which is located in the structuredefinition.sch's rule context of <code>f:StructureDefinition/f:snapshot/f:element</code></p>
<p>Looking for instances of <code>/StructureDefinition/snapshot/element/constraint/key/@value</code> returns many instances of keys that are indeed not unique, such as: </p>
<ul>
<li>"dom-1", "dom-2", "dom-3" &amp; "dom-4" all of which are constraints of <a href="https://www.hl7.org/fhir/domainresource.html#invs" target="_blank" title="https://www.hl7.org/fhir/domainresource.html#invs">DomainResource</a></li>
<li>"ele-1" which is a constraint of <a href="https://www.hl7.org/fhir/element.html" target="_blank" title="https://www.hl7.org/fhir/element.html">Element</a></li>
<li>"ext-1" which is a constraint of Extension </li>
<li>"per-1" which is a constraint of <a href="http://www.hl7.org/fhir/datatypes-definitions.html#period" target="_blank" title="http://www.hl7.org/fhir/datatypes-definitions.html#period">Period</a></li>
</ul>
<p>So it appears that these low level constraints are 'inherited' from their various predecessor types. However, as each (e.g.) element in the profile snapshot section has the 'ele-1' constraint, the schematron rule enforcing key uniqueness cannot be passed.</p>
<p>Alternatively, this may be an error in the schematron. Any poking in the right direction would be appreciated.</p>



<a name="153892299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Forge%20profile%20failing%20constraint%20key%20schematron%20rule/near/153892299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Forge.20profile.20failing.20constraint.20key.20schematron.20rule.html#153892299">(Jun 05 2017 at 14:13)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="192270">@Rob Eastwood</span>, interesting finding. Unfortunately I don't have a quick solution, as I think this needs to be resolved in the FHIR standard first. My reasoning would be:<br>
- Constraints defined by a certain profile should also apply to derived/referencing profiles.<br>
- So we want the snapshot to merge all the inherited (externally defined) constraints.<br>
- Inevitably, snapshots are then expected to contain duplicate instances of the same common constraint(s).<br>
I think the proper solution would be to update the eld-14 validation rule to only apply to the differential component; i.e. constraints should be unique by key in the differential component of the defining profile.</p>



<a name="153892330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Forge%20profile%20failing%20constraint%20key%20schematron%20rule/near/153892330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Eastwood <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Forge.20profile.20failing.20constraint.20key.20schematron.20rule.html#153892330">(Jun 05 2017 at 23:00)</a>:</h4>
<p>Thank you <span class="user-mention" data-user-id="191336">@Michel Rutten</span> - that makes sense. <br>
May I ask, what would be the proper way to have the eld-14 validation update raised up?</p>



<a name="153892334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Forge%20profile%20failing%20constraint%20key%20schematron%20rule/near/153892334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Forge.20profile.20failing.20constraint.20key.20schematron.20rule.html#153892334">(Jun 05 2017 at 23:39)</a>:</h4>
<p>Keys only have to be unique within the scope of a single element (whether in snapshot or differential), so there should be no need to update the spec.  If there's a single element anywhere in a StructureDefinition with multiple constraints with the same key, that would be a problem.</p>



<a name="153892343"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Forge%20profile%20failing%20constraint%20key%20schematron%20rule/near/153892343" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Eastwood <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Forge.20profile.20failing.20constraint.20key.20schematron.20rule.html#153892343">(Jun 06 2017 at 01:16)</a>:</h4>
<p>Apologies for the noise <span class="user-mention" data-user-id="191336">@Michel Rutten</span>  and <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> - please scratch that.<br>
On closer examination it turns out that it was a local issue in content that we fed into Forge, which had the constraint key duplication.<br>
But also thank you both for your explanations.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
