---
layout: page
title: "FHIR Chat  · Validator problem for compound enableWhen clause? · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html">Validator problem for compound enableWhen clause?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="195502292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195502292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195502292">(Apr 28 2020 at 05:27)</a>:</h4>
<p>I am using the (4.2.20-SNAPSHOT) Java validator to validate QuestionnaireResponses against a Questionnaire. One of the questions (call it N2) should only be shown if at least one of two previous questions (N0 &amp; N1) have been answered with a specific answer. On the other hand, <em>if</em> N2 is enabled, it must be answered. <a href="http://hl7.org/fhir/R4/questionnaire-definitions.html#Questionnaire.item.enableWhen" title="http://hl7.org/fhir/R4/questionnaire-definitions.html#Questionnaire.item.enableWhen">The R4 enableWhen documentation</a> says</p>
<blockquote>
<p>(...) treat "enableWhen"s as being joined by an "or" clause. This element is a modifier because if enableWhen is present for an item, "required" is ignored unless one of the enableWhen conditions is met.</p>
</blockquote>
<p>So I did the following</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Questionnaire&quot;</span><span class="p">,</span>
    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://example.com/qexampel&quot;</span><span class="p">,</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
    <span class="nt">&quot;item&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
            <span class="nt">&quot;linkId&quot;</span><span class="p">:</span> <span class="s2">&quot;N0&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
            <span class="nt">&quot;linkId&quot;</span><span class="p">:</span> <span class="s2">&quot;N1&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span>
            <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;linkId&quot;</span><span class="p">:</span> <span class="s2">&quot;N2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;enableWhen&quot;</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="nt">&quot;question&quot;</span><span class="p">:</span> <span class="s2">&quot;N0&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;answerInteger&quot;</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;question&quot;</span><span class="p">:</span> <span class="s2">&quot;N1&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;answerInteger&quot;</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>


<p>The following should now be a valid answer because N2 should not be enabled:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;QuestionnaireResponse&quot;</span><span class="p">,</span>
    <span class="nt">&quot;questionnaire&quot;</span><span class="p">:</span> <span class="s2">&quot;http://example.com/qexampel&quot;</span><span class="p">,</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
    <span class="nt">&quot;item&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="nt">&quot;linkId&quot;</span><span class="p">:</span> <span class="s2">&quot;N0&quot;</span><span class="p">,</span>
            <span class="nt">&quot;answer&quot;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="nt">&quot;valueInteger&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;linkId&quot;</span><span class="p">:</span> <span class="s2">&quot;N1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;answer&quot;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="nt">&quot;valueInteger&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>


<p>However, the validator says</p>
<div class="codehilite"><pre><span></span><code>*FAILURE* validating qtest/test.questionnaireresponse.json:  error:1 warn:0 info:0
  Error @ QuestionnaireResponse (line 1, col2) : No response answer found for required item &quot;N2&quot;
</code></pre></div>


<p>If I remove one of the conditions in the enableWHen, the error disappears. Is there an issue with how the validator handles multiple enableWhen conditions or did I read the specs wrong?</p>



<a name="195565629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195565629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195565629">(Apr 28 2020 at 13:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> - do we still have an issue with evaluating 'required' elements in the presence of enableWhen?</p>



<a name="195575197"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195575197" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195575197">(Apr 28 2020 at 14:51)</a>:</h4>
<p><span class="user-mention" data-user-id="194703">@Morten Ernebjerg</span> have a look at Questionnaire.item.enableBehavior. This defines this behaviour.</p>



<a name="195575360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195575360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195575360">(Apr 28 2020 at 14:52)</a>:</h4>
<p>The "or" statement in description is only valid if you are evaluating repeating elements. Then only one repetition has to be true</p>



<a name="195575480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195575480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195575480">(Apr 28 2020 at 14:53)</a>:</h4>
<p>The description text here should be improved. Do you mind opening a JIRA Ticket for this <span class="user-mention" data-user-id="194703">@Morten Ernebjerg</span> ?</p>



<a name="195579403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195579403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195579403">(Apr 28 2020 at 15:18)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> ah, thanks!  I did indeed not spot this because I thought the formulation in <a href="http://hl7.org/fhir/R4/questionnaire-definitions.html#Questionnaire.item.enableWhen" title="http://hl7.org/fhir/R4/questionnaire-definitions.html#Questionnaire.item.enableWhen">the documentation of Questionnaire.item.enableWhen</a> clearly specified that it was always an OR:</p>
<blockquote>
<p>If multiple repetitions of this extension are present, the item should be enabled when the condition for any of the repetitions is true. I.e. treat "enableWhen"s as being joined by an "or" clause. </p>
</blockquote>
<p>I will put in a tickets (might take a few hours though, busy days...)(</p>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> When I validate the <code>Questionnaire</code> given above against the base spec, I get no errors so it seems constraint <em>que-12</em> (<code>enableWhen.count() &gt; 2 implies enableBehavior.exists()</code>) is not enforced.</p>



<a name="195579813"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195579813" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195579813">(Apr 28 2020 at 15:21)</a>:</h4>
<p>And actually, my initial question still lingers. Whether or not one takes AND or OR for the enableWhen, the condition is not met in the above example --&gt; <code>required: true</code> on conditional question should be ignored --&gt; response should be valid. Or...?</p>



<a name="195580367"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195580367" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195580367">(Apr 28 2020 at 15:25)</a>:</h4>
<p>But adding  <code>"enableBehavior": "any"</code> does it indeed make the above come out without errors <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="195589125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195589125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195589125">(Apr 28 2020 at 16:23)</a>:</h4>
<p>You are mixing two<code>OR</code>: the one you are refering to only applies to repeating items. Imagine asking for all medication of a patient in a repeatable item. Adding a enable when if the patient takes a certain medication will look in every reported repetition/medication. If one of these matches (OR) then the enableWhen is triggered.</p>



<a name="195589234"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195589234" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195589234">(Apr 28 2020 at 16:24)</a>:</h4>
<p>enableBehavior changes the behavior in the case you have multiple enableWhens attached to an item.</p>



<a name="195589293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195589293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195589293">(Apr 28 2020 at 16:24)</a>:</h4>
<p>But yes guidance, especially on the enableWhen element would be nice (made the same mis-assumption in the past).</p>



<a name="195589323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195589323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195589323">(Apr 28 2020 at 16:25)</a>:</h4>
<p>So the tracker would be for having better guidance</p>



<a name="195657030"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195657030" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195657030">(Apr 29 2020 at 03:49)</a>:</h4>
<p>que-12 has an error. It should be :</p>
<p><code>(enableWhen.count() &gt;= 2 implies enableBehavior.exists()) </code></p>



<a name="195657624"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195657624" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195657624">(Apr 29 2020 at 03:58)</a>:</h4>
<p>so it shouldn't make any difference whether it's all or any</p>



<a name="195658898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195658898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195658898">(Apr 29 2020 at 04:23)</a>:</h4>
<p>I hacked the validator to make that work</p>



<a name="195717105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/195717105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#195717105">(Apr 29 2020 at 14:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span>  Ah OK, now I see what was meant by "multiple repetitions".... I created ticket  <a href="https://jira.hl7.org/browse/FHIR-26993" title="https://jira.hl7.org/browse/FHIR-26993">#FHIR-26993</a> for this.</p>



<a name="197525534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197525534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197525534">(May 14 2020 at 08:51)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> Back again <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span>  I was wondering what the behaviour was for STU3 for the case that I specify 2 conditions in <code>enableWhen</code> that refer to different (non-repeatable questions). Does it behave like <code>enableBehaviour:  "any"</code> or <code>enableBehaviour: "all"</code>? I tried to surmise it from the R3 --&gt; R4 maps, but as far as I can tell, there <code>enableBehaviour</code> is not included anywhere, despite the fact that it is required if there are multiple <code>enableWhen</code> conditions.</p>



<a name="197537934"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197537934" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197537934">(May 14 2020 at 11:08)</a>:</h4>
<p>this appears to be the relevant behavior: </p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">checkConditionResults</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">EnableWhenResult</span><span class="o">&gt;</span> <span class="n">evaluationResults</span><span class="p">,</span> <span class="n">QuestionnaireItemComponent</span> <span class="n">questionnaireItem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">questionnaireItem</span><span class="p">.</span><span class="na">hasEnableBehavior</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">questionnaireItem</span><span class="p">.</span><span class="na">getEnableBehavior</span><span class="p">()</span> <span class="o">==</span> <span class="n">EnableWhenBehavior</span><span class="p">.</span><span class="na">ANY</span><span class="p">)</span> <span class="o">||</span> <span class="n">evaluationResults</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">evaluationResults</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">anyMatch</span><span class="p">(</span><span class="n">EnableWhenResult</span><span class="p">::</span><span class="n">isEnabled</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">questionnaireItem</span><span class="p">.</span><span class="na">hasEnableBehavior</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">questionnaireItem</span><span class="p">.</span><span class="na">getEnableBehavior</span><span class="p">()</span> <span class="o">==</span> <span class="n">EnableWhenBehavior</span><span class="p">.</span><span class="na">ALL</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">evaluationResults</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">allMatch</span><span class="p">(</span><span class="n">EnableWhenResult</span><span class="p">::</span><span class="n">isEnabled</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//TODO: Throw exception? enableBehavior is mandatory when there are multiple conditions</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div>



<a name="197537956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197537956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197537956">(May 14 2020 at 11:08)</a>:</h4>
<p>in otherwords: an exception. Do you want to make a test case (Q/QR combination) that I can add to the unit tests ?</p>



<a name="197554093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197554093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197554093">(May 14 2020 at 13:33)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> If I read this correctly, it is code from the R4 validation, right? (<a href="https://github.com/eevaturkka/hapi-fhir/blob/master/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/DefaultEnableWhenEvaluator.java#L37">here</a>). So is the point that when validating an STU3 Q/QR pair, it comes through here as well and always returns <code>true</code> because there is never any <code>enableBehaviour</code>?</p>
<p>I'd be happy to add an STU3 test case for this - where do I submit it?</p>



<a name="197597980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197597980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197597980">(May 14 2020 at 18:29)</a>:</h4>
<p>that's actually the R5 code. But submit me an R3 test case. You can just send them to me, or make an issue or a PR against <a href="https://github.com/FHIR/fhir-test-cases">https://github.com/FHIR/fhir-test-cases</a></p>



<a name="197691295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197691295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197691295">(May 15 2020 at 13:36)</a>:</h4>
<p>OK, will go via the repo.</p>
<p>BTW I see that when you convert an STU3 questionnaire to an R4 one with the validator, it seems to insert <code>enableBehaviour: "any"</code> for all questions. Yet I cannot see that  in the <a href="http://hl7.org/fhir/R4/questionnaire-version-maps.html#2.37.11.1">STU3 --&gt; R4 map in the Questionnaire documentation</a> - am I missing smt. or is the validator using a different map?</p>



<a name="197695632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197695632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197695632">(May 15 2020 at 14:04)</a>:</h4>
<p>This is conversion the <code>-native</code> option which, I suppose, might just about answer my question for me... Without this option, I get an error (for a minimal 3-question example)</p>
<div class="codehilite"><pre><span></span><code>Exception in thread &quot;main&quot; java.lang.Error: Cannot set property operator on enableWhen
    at org.hl7.fhir.r5.elementmodel.Element.setProperty(Element.java:378)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.processTarget(StructureMapUtilities.java:1827)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1412)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1399)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeDependency(StructureMapUtilities.java:1458)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1420)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1399)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeDependency(StructureMapUtilities.java:1458)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1420)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1399)
    at org.hl7.fhir.r5.utils.StructureMapUtilities.transform(StructureMapUtilities.java:1361)
    at org.hl7.fhir.validation.ValidationEngine.transformVersion(ValidationEngine.java:1754)
    at org.hl7.fhir.validation.cli.services.ValidationService.transformVersion(ValidationService.java:157)
    at org.hl7.fhir.validation.Validator.main(Validator.java:168)
</code></pre></div>



<a name="197725720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197725720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197725720">(May 15 2020 at 17:33)</a>:</h4>
<p>yes it does use the native conversion internally, but that's still not using the internal conversion, which is <a href="https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/conv30_50/Questionnaire30_50.java">https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/conv30_50/Questionnaire30_50.java</a></p>



<a name="197924760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20problem%20for%20compound%20enableWhen%20clause%3F/near/197924760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20problem.20for.20compound.20enableWhen.20clause.3F.html#197924760">(May 18 2020 at 12:14)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> PR is in, just let me know if adjustments are needed.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
