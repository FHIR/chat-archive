---
layout: page
title: "FHIR Chat  · Validator failure for own ValueSet defintion with SNOMED CT · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html">Validator failure for own ValueSet defintion with SNOMED CT</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="183139357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183139357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183139357">(Dec 11 2019 at 09:20)</a>:</h4>
<p>We define <a href="https://fhir.ch/ig/ch-epr-term/ValueSet-DocumentEntry.typeCode.html" target="_blank" title="https://fhir.ch/ig/ch-epr-term/ValueSet-DocumentEntry.typeCode.html">ValueSets</a> which contain a finite list of SNOMED CT codes and and additional codes from an other CodeSystem. We defined them via compose even though it is a list of fixed codes because we have designations for the different languages. We bind this ValueSet to a profiled DocumentReference (see <a href="https://github.com/hl7ch/ch-epr-term/blob/testing/examples/documentreference/Docu.xml" target="_blank" title="https://github.com/hl7ch/ch-epr-term/blob/testing/examples/documentreference/Docu.xml">example</a>). </p>
<p>The Java Validator/IG Publisher <a href="http://build.fhir.org/ig/hl7ch/ch-epr-term/branches/testing/qa.html" target="_blank" title="http://build.fhir.org/ig/hl7ch/ch-epr-term/branches/testing/qa.html">fails</a> for this examples with the message:</p>
<div class="codehilite"><pre><span></span>None of the codes provided are in the value set http://fhir.ch/ig/ch-epr-term/ValueSet/DocumentEntry.typeCode (http://fhir.ch/ig/ch-epr-term/ValueSet/DocumentEntry.typeCode, and a code from this value set is required) (codes = http://snomed.info/sct#371532007)
</pre></div>


<p>A first analysis revealed that the Validator does not validate the code locally with the provided ValueSet because the code is from SNOMED CT which is not a complete CodeSystem. In the next step the Validator then sends the ValueSet together with the code to <a href="http://tx.fhir.org" target="_blank" title="http://tx.fhir.org">tx.fhir.org</a>. This <a href="http://build.fhir.org/ig/hl7ch/ch-epr-term/branches/testing/qa-tx.html#l25" target="_blank" title="http://build.fhir.org/ig/hl7ch/ch-epr-term/branches/testing/qa-tx.html#l25">fails</a> now because the <a href="https://fhir.ch/ig/ch-epr-term/CodeSystem-2.16.756.5.30.1.127.3.4.html" target="_blank" title="https://fhir.ch/ig/ch-epr-term/CodeSystem-2.16.756.5.30.1.127.3.4.html">second code system</a> is not known to <a href="http://tx.fhir.org" target="_blank" title="http://tx.fhir.org">tx.fhir.org</a> (it is defined currently only in our implementation guide).</p>
<p>This leads to three questions I would happy to get some feedback:<br>
- is our approach correct with defining ValueSets with compose or should we provide already expanded ValueSets in our Implementation Guide?<br>
- could the validation logic be extend, that if  a code can be validated within a ValueSet event though it is not a complete CodeSystem so that the code does not need to be validated with <a href="http://tx.fhir.org" target="_blank" title="http://tx.fhir.org">tx.fhir.org</a>? (This would not work in all cases would be more an optimization)? if yes, we would start to work on a pull request<br>
- can also a local code system be supplied to <a href="http://tx.fhir.org" target="_blank" title="http://tx.fhir.org">tx.fhir.org</a> (inlined in the ValueSet)?</p>



<a name="183145205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183145205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183145205">(Dec 11 2019 at 10:48)</a>:</h4>
<p>your approach is fine. can we turn this into a concise test case?</p>



<a name="183145309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183145309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183145309">(Dec 11 2019 at 10:50)</a>:</h4>
<p>though when I look at your value sets.. that's not how snomed extensions work...</p>



<a name="183145922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183145922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183145922">(Dec 11 2019 at 10:58)</a>:</h4>
<blockquote>
<p>though when I look at your value sets.. that's not how snomed extensions work...</p>
</blockquote>
<p>thanks,  this needs to be addressed by our snomed national release center, they have just started the process, I will put it on the agenda, i see them this afternoon</p>



<a name="183146237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183146237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183146237">(Dec 11 2019 at 11:02)</a>:</h4>
<blockquote>
<p>your approach is fine. can we turn this into a concise test case?</p>
</blockquote>
<p>leaving the snomed extension discussion aside, where would be the place to start with testcases for validator/terminology server? fhir-test-cases/validator?</p>



<a name="183146272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183146272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183146272">(Dec 11 2019 at 11:03)</a>:</h4>
<p>yes. but this time I've added it - your profiles etc were nice and small</p>



<a name="183149326"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183149326" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183149326">(Dec 11 2019 at 11:48)</a>:</h4>
<p>I think that the right approach s that L349 and L72 of ValueSetCheckerSImple, instead of throwing an exception when the code system is not supported, that's when you consult the terminology server, for just that include. it happens elsewhere like that, so not sure why not here</p>



<a name="183216153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183216153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183216153">(Dec 12 2019 at 00:09)</a>:</h4>
<p>ok this should be fixed now</p>



<a name="183240302"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183240302" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183240302">(Dec 12 2019 at 09:09)</a>:</h4>
<p>confirmed, thanks a lot <span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="183240455"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183240455" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183240455">(Dec 12 2019 at 09:10)</a>:</h4>
<p>glad I can fix something</p>



<a name="183241056"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183241056" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183241056">(Dec 12 2019 at 09:17)</a>:</h4>
<blockquote>
<blockquote>
<p>though when I look at your value sets.. that's not how snomed extensions work...</p>
</blockquote>
<p>thanks,  this needs to be addressed by our snomed national release center, they have just started the process, I will put it on the agenda, i see them this afternoon</p>
</blockquote>
<p>they are aware of the situation, next spring a snomed ct swiss edition is planned where the codes are included.</p>



<a name="183241711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183241711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183241711">(Dec 12 2019 at 09:24)</a>:</h4>
<div class="codehilite"><pre><span></span>This leads to three questions I would happy to get some feedback:
- is our approach correct with defining ValueSets with compose or should we provide already expanded ValueSets in our Implementation Guide?
</pre></div>


<p>I've gone with 'already expanded valueSets' to get around ecl issues. Wondering if this is correct?</p>



<a name="183245761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Validator%20failure%20for%20own%20ValueSet%20defintion%20with%20SNOMED%20CT/near/183245761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Validator.20failure.20for.20own.20ValueSet.20defintion.20with.20SNOMED.20CT.html#183245761">(Dec 12 2019 at 10:16)</a>:</h4>
<p>well, there's no fixed answer to this. In general, it's better to distribute the formal definition of the value set, rather than a particular expansion that's correct under your conditions at a given time. that way, people can generate a correct expansion locally given their own conditions. Does that matter...? depends how tightly you control the conditions. But my general observation is that the distributors always think they have better control than they do. </p>
<p>OTOH, distributing the formal definition rather than the expansion assumes that everyone can correctly evaluate the definition. Which my server can't right now...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
