---
layout: page
title: "FHIR Chat  · Slicing a discriminator element · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html">Slicing a discriminator element</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="165629428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165629428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pieter Edelman <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165629428">(May 14 2019 at 14:57)</a>:</h4>
<p>Suppose I'm slicing Observation.component based on code.coding.code + code.coding.system. I then define my slices and I would like to say "SHALL use at least this SNOMED CT concept as coding, but could have other concepts as well". I could do either of the following:</p>
<ul>
<li>In each component slice I could slice the component.code.coding with one required slice for the SNOMED CT concept leaving other codings open</li>
<li>In each component slice I could set a fixed component.code.coding.code and .system and leave coding set to 1..*</li>
</ul>
<p>Both options lead to different outcomes in the .Net validator 1.5.2 UI and the Java validator 3.8.0 CLI. The former leads to unrecognized slices. I.e. when you validate, it cannot match data to slice definitions. The latter solution works well, but disallows adding additional codings on any of the slices.</p>
<p>Question:</p>
<ul>
<li>Is my setup possible at all and if so what would be the recommended profiling method?</li>
</ul>



<a name="165649108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165649108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165649108">(May 14 2019 at 18:37)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="216303">@Pieter Edelman</span>, both approaches are valid (with different behavior). Looks like a bug in the validator(s).<br>
<span class="user-mention" data-user-id="191328">@Ewout Kramer</span>?<br>
BTW I think there's a third option. You could put constraints on the default child elements of the slice introduction element (with the slicing discriminator). These constraints should apply to all slices. This prevents you from having to repeat the same constraints in each named slice. However, I'm not sure if the validator(s), or any other implementations, support this already...</p>



<a name="165687355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165687355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165687355">(May 15 2019 at 05:23)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="216303">@Pieter Edelman</span> .  the validation error you describe for the java validator is described it in <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21472" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21472">GF#21472</a>. But for your usecase I would suggest another profiling way.  Use pattern/code slicing and patternCodeableConcept within the components which requires that you have of  one of the mentioned codes in your slice. As an example to illustrate this, see the modified blood pressure profile: <a href="https://github.com/hapifhir/org.hl7.fhir.core/blob/30803a7a410bec0d9c3f52b34dd799c5aa3a9830/org.hl7.fhir.validation/src/test/resources/validation-examples/observation-bp-profile.xml" target="_blank" title="https://github.com/hapifhir/org.hl7.fhir.core/blob/30803a7a410bec0d9c3f52b34dd799c5aa3a9830/org.hl7.fhir.validation/src/test/resources/validation-examples/observation-bp-profile.xml">https://github.com/hapifhir/org.hl7.fhir.core/blob/30803a7a410bec0d9c3f52b34dd799c5aa3a9830/org.hl7.fhir.validation/src/test/resources/validation-examples/observation-bp-profile.xml</a> .</p>



<a name="165693247"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165693247" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pieter Edelman <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165693247">(May 15 2019 at 07:39)</a>:</h4>
<p><span class="user-mention" data-user-id="191478">@Oliver Egger</span> The pattern slicing works brilliantly. I have one additional twist to the whole setup: we have a bigger lab use case where a component should contain 2 codings. One in LOINC and one in a Dutch system. For the Dutch system the equivalency is not necessarily 1..1 so I just want to say "Use LOINC X + use a code from Dutch system"</p>
<p>A way to say this could have been:</p>
<div class="codehilite"><pre><span></span>      &lt;patternCodeableConcept&gt;
        &lt;coding&gt;
          &lt;system value=&quot;http://loinc.org&quot; /&gt;
          &lt;code value=&quot;85354-9&quot; /&gt;
        &lt;/coding&gt;
        &lt;coding&gt;
          &lt;system value=&quot;http://dutch.lab.system&quot; /&gt;
        &lt;/coding&gt;
      &lt;/patternCodeableConcept&gt;
</pre></div>


<p>But the Java quite elegantly says:</p>
<p><code>Error @ Observation.component[1] (line 14, col16) : Unsupported CodeableConcept pattern - must be just one coding - for discriminator(code) for slice Observation.component:component1</code></p>
<p>Does this mean it is legal to specify, but just not supported, or does it mean that it is illegal to specify that way? If illegal: what could be a solution here?</p>



<a name="165693426"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165693426" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pieter Edelman <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165693426">(May 15 2019 at 07:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> We'll file something for the .Net validator unless it has already been filed (pattern slicing). For Forge you might want to check the visual behavior for Forge STU3. The pattern title lists "no name" when you specify just system. It updates when you list both system and code. Just a visual glitch. If specifying a system + code is required then maybe a check could be added for that. We did not try R4 for reference on this.</p>



<a name="165693437"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165693437" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165693437">(May 15 2019 at 07:43)</a>:</h4>
<p>you can submit a test case for the java validator... I'll be doing a run of validator work shortly</p>



<a name="165713938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165713938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pieter Edelman <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165713938">(May 15 2019 at 13:25)</a>:</h4>
<blockquote>
<p>you can submit a test case for the java validator... I'll be doing a run of validator work shortly</p>
</blockquote>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  Do you have a ticketing system for the Java validator?</p>



<a name="165728145"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165728145" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165728145">(May 15 2019 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="216303">@Pieter Edelman</span> <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  since i was working last week on <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21240" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21240">GF#21240</a> for adding support to pattern[x] on elements  I added an example  to the validation suite and a pull request extending pattern[x]  support for slicing, see <a href="https://github.com/hapifhir/org.hl7.fhir.core/pull/23" target="_blank" title="https://github.com/hapifhir/org.hl7.fhir.core/pull/23">https://github.com/hapifhir/org.hl7.fhir.core/pull/23</a></p>



<a name="165740440"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165740440" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165740440">(May 15 2019 at 18:30)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="216303">@Pieter Edelman</span>, thanks for the feedback! Forge tries to generate a useful name from the available info, should be easy to fix the pattern.</p>



<a name="165763494"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165763494" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165763494">(May 15 2019 at 23:13)</a>:</h4>
<p><span class="user-mention" data-user-id="216303">@Pieter Edelman</span> <a href="https://github.com/hapifhir/org.hl7.fhir.core/issues" target="_blank" title="https://github.com/hapifhir/org.hl7.fhir.core/issues">https://github.com/hapifhir/org.hl7.fhir.core/issues</a></p>



<a name="165785389"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165785389" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pieter Edelman <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165785389">(May 16 2019 at 07:05)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="216303">Pieter Edelman</span> <span class="user-mention silent" data-user-id="191316">Grahame Grieve</span>  since i was working last week on <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21240" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21240">GF#21240</a> for adding support to pattern[x] on elements  I added an example  to the validation suite and a pull request extending pattern[x]  support for slicing, see <a href="https://github.com/hapifhir/org.hl7.fhir.core/pull/23" target="_blank" title="https://github.com/hapifhir/org.hl7.fhir.core/pull/23">https://github.com/hapifhir/org.hl7.fhir.core/pull/23</a></p>
</blockquote>
<p>That's fast! Awesome :)</p>



<a name="165785980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20a%20discriminator%20element/near/165785980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pieter Edelman <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20a.20discriminator.20element.html#165785980">(May 16 2019 at 07:18)</a>:</h4>
<blockquote>
<p>Hi <span class="user-mention silent" data-user-id="216303">Pieter Edelman</span>, thanks for the feedback! Forge tries to generate a useful name from the available info, should be easy to fix the pattern.</p>
</blockquote>
<p>Cool! Do you need any additional info?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
