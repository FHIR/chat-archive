---
layout: page
title: "FHIR Chat  · Slice Cardinality Confusion · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html">Slice Cardinality Confusion</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="256138987"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256138987" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256138987">(Oct 04 2021 at 21:52)</a>:</h4>
<p>According to <a href="https://www.hl7.org/fhir/profiling.html#slice-cardinality">5.1.0.12 Slice Cardinality</a>:</p>
<blockquote>
<p>When an element of a fixed cardinality m..n is sliced, the following rules apply:</p>
<ul>
<li>Each slice cannot have a greater cardinality than the maximum number of slices allowed</li>
</ul>
</blockquote>
<p>I'm having trouble understanding what this rule means.  What is a "greater cardinality"? Is that in terms of min or max?  And does it really mean to compare to "maximum number of slices allowed" (because I don't understand how the number of slices is relevant)?  Or does it mean "maximum number of items allowed in the sliced element"?</p>



<a name="256149357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256149357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256149357">(Oct 04 2021 at 23:24)</a>:</h4>
<p>i would interpret that as saying the slice cardinality can't be greater than n.  So you can't say identifer = 0..1 and then slice it and say that slice X must appear 2 times.</p>



<a name="256155345"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256155345" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256155345">(Oct 05 2021 at 00:23)</a>:</h4>
<p>almost - slice max can't be  greater than element max</p>



<a name="256233798"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256233798" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256233798">(Oct 05 2021 at 12:09)</a>:</h4>
<p>OK.  We actually implemented SUSHI that way.  We emit an error if your slice max is &gt; your element max.  But... We received <a href="#narrow/stream/215610-shorthand/topic/Slicing.20cardinalits.20validation.20Error">requests to remove the error</a> because a profile of a profile might zero out a sliced element that was inherited from the parent -- in which case you'd be forced to go through and zero out all the inherited slices too (which is annoying).  Apparently the IG Publisher allows slice max &gt; element max, so they thought it was an allowable situation. I was on board w/ removing the error until I saw the bit in the spec that I quoted above.</p>
<p>Any thoughts on this, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>?  It sounds like the spec requires that if you zero out a sliced element, you must also zero out all the slices. Since this is tedious, I'm thinking about having SUSHI automatically do it for you.</p>



<a name="256235429"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256235429" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256235429">(Oct 05 2021 at 12:23)</a>:</h4>
<p>Wait. But if you have a sliced optional element with 0..n which has two optional slices with 0..1 each. <br>
That means you can't decide, say, in a derived profile, that you don't want the optional element at all and constrain it to 0..0, because n &gt; 0 ?</p>



<a name="256236440"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256236440" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256236440">(Oct 05 2021 at 12:31)</a>:</h4>
<p>You <em>can</em> mark the element <code>0..0</code>.  That's fine.  But then you should also mark its slices as <code>0..0</code> since they are no longer optional (they are now prohibited since the whole array is prohibited).</p>



<a name="256245578"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256245578" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256245578">(Oct 05 2021 at 13:32)</a>:</h4>
<p>If there's a slice that's 1..5 in a parent profile, you can't make it go away in a child profile.  You can't ever make the overall element 0..0.</p>



<a name="256247323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256247323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256247323">(Oct 05 2021 at 13:44)</a>:</h4>
<p>The defacto minimum cardinality is the sum of the minimums of the slices</p>



<a name="256247382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256247382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256247382">(Oct 05 2021 at 13:44)</a>:</h4>
<p>You can't constrain the overall max below that minimum</p>



<a name="256247487"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256247487" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256247487">(Oct 05 2021 at 13:45)</a>:</h4>
<p>Slice cardinalities must always be satisfied.  It's not a situation of "if you have this element, then you must meet these cardinalities".</p>



<a name="256249851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256249851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256249851">(Oct 05 2021 at 13:59)</a>:</h4>
<p>ugh thats inconvenient  <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span> <br>
I saw several use-cases were the derived profile constrained the sliced element to 0..0 to express: "we don't need/use that"</p>



<a name="256249969"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256249969" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256249969">(Oct 05 2021 at 13:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> - agreed on all points.  I think the main issue of confusion here was related to max cardinality.  If you say an element can have at most <em>n</em> items, and then you define a slice saying it can have at most <em>n+1</em> items, then that slice max can never actually be achieved without violating the overall element cardinality.</p>



<a name="256249972"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256249972" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256249972">(Oct 05 2021 at 13:59)</a>:</h4>
<p>After your input this would mean, that these usecases would have to create their own "alligned" profile to do such things.</p>



<a name="256250169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256250169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256250169">(Oct 05 2021 at 14:00)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="191469">@Chris Moesel</span> for keeping track of the actual issue. The issue was only max card. related.</p>



<a name="256250263"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256250263" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256250263">(Oct 05 2021 at 14:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191469">Chris Moesel</span> <a href="#narrow/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion/near/256236440">said</a>:</p>
<blockquote>
<p>You <em>can</em> mark the element <code>0..0</code>.  That's fine.  But then you should also mark its slices as <code>0..0</code> since they are no longer optional (they are now prohibited since the whole array is prohibited).</p>
</blockquote>



<a name="256250408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256250408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256250408">(Oct 05 2021 at 14:02)</a>:</h4>
<p>I think this needs a test case for the validators, currently the java validator allows only setting the element to 0..0</p>



<a name="256253434"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256253434" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256253434">(Oct 05 2021 at 14:19)</a>:</h4>
<p>Agree that the validator should catch and prevent this.  Care to submit a Git issue?</p>



<a name="256331600"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256331600" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256331600">(Oct 05 2021 at 22:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191451">Patrick Werner</span> <a href="#narrow/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion/near/256249851">said</a>:</p>
<blockquote>
<p>ugh thats inconvenient  <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span> <br>
I saw several use-cases were the derived profile constrained the sliced element to 0..0 to express: "we don't need/use that"</p>
</blockquote>
<p>With luck, the derived profile can leave the sliced element not marked must support, then it can be ignored in implementations.</p>



<a name="256341791"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256341791" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256341791">(Oct 06 2021 at 00:50)</a>:</h4>
<p>Well, except sender must satisfy cardinalities regardless of how things are marked</p>



<a name="256544612"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slice%20Cardinality%20Confusion/near/256544612" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion.html#256544612">(Oct 07 2021 at 08:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179177-conformance/topic/Slice.20Cardinality.20Confusion/near/256253434">said</a>:</p>
<blockquote>
<p>Agree that the validator should catch and prevent this.  Care to submit a Git issue?</p>
</blockquote>
<p><a href="https://github.com/hapifhir/org.hl7.fhir.core/issues/616">https://github.com/hapifhir/org.hl7.fhir.core/issues/616</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
