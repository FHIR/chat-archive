---
layout: page
title: "FHIR Chat  · Element id for constrained choice type elements · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html">Element id for constrained choice type elements</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153911252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911252">(Sep 28 2017 at 14:55)</a>:</h4>
<p>Another question.</p>
<p>We've defined  rules for generating a standard element id. For renamed choice type elements constrained to a single type, the convention is the generate an id that includes both the original and the new element name:<br>
"{parent-path}.{original-element-name}:{new-element-name}"<br>
For example: "Observation.value[x]:valueString"</p>
<p>The element id generator in the FHIR .NET API picks up the second part (after ":") from the sliceName property. So when the user constrains a choice type elements to a single type:<br>
1. Forge determines the new element name, depending on the selected type<br>
2. Forge updates the .path property to include the new element name<br>
3. Forge initializes the .sliceName property with the new element name<br>
4. Forge re-generates the element id from the new element name and sliceName</p>
<p>This actually introduces a sliceName value on an unsliced choice type element without a slice entry. Rick Geimer pointed out that this may be invalid...?</p>
<p>If FHIR does not allow assigning a slice name to an unsliced choice type element, then the element id generator would have to detect renamed choice type elements by inspecting ElementDefinition.Base.Path - which is generally unavailable in the differential...</p>



<a name="153911262"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911262" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911262">(Sep 28 2017 at 16:12)</a>:</h4>
<p>Type choices are implicitly sliced by type with slices for each allowed type.  In other words, it is NOT valid to directly slice value[x].  You may reslice one of the existing slices: <code>Extension.value[x]:valueCoding/loinc-slice</code></p>



<a name="153911667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911667">(Oct 02 2017 at 13:00)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191351">@Chris Grenz</span>, thank you for chipping in. Do you mean that my current approach is invalid, i.e. it is NOT allowed to initialize the sliceName property for a renamed choice type element? So instead, I should explicitly leave sliceName empty and generate the correct element Id using different means.</p>



<a name="153911680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911680">(Oct 02 2017 at 13:07)</a>:</h4>
<p>valueString is already a slice of value[x]. A slice then would actually be a re-slice of valueString:<br>
<code>Extension.value[x]:valueString/mySlice</code></p>



<a name="153911683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911683">(Oct 02 2017 at 13:11)</a>:</h4>
<p>Following your interpretation, so if we consider valueString to be an (implicit) slice on value[x], then FHIR dictates we SHALL initialize the sliceName property, in this case to "valueString"?<br>
In other words, my current logic is correct and I should report back to Rick that this approach is actually valid/mandatory?</p>



<a name="153911711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911711">(Oct 02 2017 at 13:31)</a>:</h4>
<p>I'd say to be consistent, the snapshot should include valueString as slice name for the type slice. This could not be modified in the differential (similar to the discriminator on Resource.extension)</p>



<a name="153911795"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911795" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911795">(Oct 02 2017 at 14:43)</a>:</h4>
<p>Great, then I don't need to change my current logic! ;p<br>
Thank you for your help. I'll inform Rick about our discussion.</p>



<a name="153911836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911836">(Oct 02 2017 at 16:19)</a>:</h4>
<p>Trying to follow this.. It doesn't entirely make sense to me. What is the approach we are concluding, to indicate in a profile that value[x] SHALl be valueString? (limiting the selection of value[x] to JUST valueString). There are two criteria that I can think would be considered:<br>
1) what type is allowed by value[x]? (how do you limit the selection of type to one or just a few types?)<br>
2) is value[x] required? (how do you indicate that value[x] is required, even if the options are limited to a smaller subset)?</p>



<a name="153911855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911855">(Oct 02 2017 at 18:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191505">@Sean McIlvenna</span> valueString is a slice (an implicit type slice) of value[x].  In STU3 there's some ambiguity about this and that ambiguity will be resolved in R4.  <em>Some</em> implementations in R3 interpreted the presence of valueString to be a constraint on value[x] limiting all instances to string. Some did not.  Directly to your questions:<br>
1) the type element of ElementDefinition on the value[x] declaration limits the valid types.  To further constrain allowable types, restate the type block in a differential for the value[x] element.<br>
2) making value[x] required means adding min=1 (or more) to the value[x] element.</p>



<a name="153911856"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911856" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911856">(Oct 02 2017 at 18:17)</a>:</h4>
<p>So it sounds like for both of these scenarios, all that needs to exist is:</p>
<div class="codehilite"><pre><span></span>&lt;element id=&quot;Observation.value[x]&quot;&gt;
  &lt;min value=&quot;1&quot; /&gt;
  &lt;type&gt;
    &lt;code value=&quot;Quantity&quot; /&gt;
  &lt;/type&gt;
  &lt;type&gt;
    &lt;code value=&quot;string&quot; /&gt;
  &lt;/type&gt;
&lt;/element&gt;
</pre></div>



<a name="153911857"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911857" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911857">(Oct 02 2017 at 18:18)</a>:</h4>
<p>It sounds like what you're saying is that slices are NOT needed/desired to represent this scenario...</p>



<a name="153911858"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911858" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911858">(Oct 02 2017 at 18:19)</a>:</h4>
<p>Makes the value mandatory and of type String or Quantity. As stated, this will work in all validators.</p>



<a name="153911859"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153911859" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153911859">(Oct 02 2017 at 18:20)</a>:</h4>
<p>So, I don't think this is the same way that <span class="user-mention" data-user-id="191336">@Michel Rutten</span> is doing this... <span class="user-mention" data-user-id="191336">@Michel Rutten</span> , can you confirm?</p>



<a name="153912033"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153912033" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153912033">(Oct 03 2017 at 10:31)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191505">@Sean McIlvenna</span>, Forge supports both. If you constrain value[x] to a <em>single</em> type, then the element is renamed to e.g. valueString. But if you specify multiple type constraints, then the element retains the original name e.g. value[x].</p>



<a name="153912075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153912075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153912075">(Oct 03 2017 at 15:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> , So when does Forge decide to create a slice out of the choice?</p>



<a name="153912076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153912076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153912076">(Oct 03 2017 at 15:10)</a>:</h4>
<p>The user decides, by clicking on the "slice" button. Then Forge creates an actual slice entry and allows you to add slices. Forge detects when you slice a choice type element and automatically initializes the slicing discriminator for a type slice to { Type = "Type", Path = "$this" }. The user should make sure that all the slices have different type constraints, Forge does not validate this (yet).</p>



<a name="153912077"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153912077" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153912077">(Oct 03 2017 at 15:13)</a>:</h4>
<p>Constraining a choice type element to a single type is considered an "implicit slice". This causes the element to be renamed, but it does not introduce an actual slice entry (in both differential and snapshot).</p>



<a name="153912080"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153912080" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153912080">(Oct 03 2017 at 15:18)</a>:</h4>
<p>Note that if you constrain a slice of a choice type element to a single type, Forge maintains the original element name. Element renaming only applies if a choice type element is constrained to a <em>single</em> datatype (and not sliced).</p>



<a name="153912116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Element%20id%20for%20constrained%20choice%20type%20elements/near/153912116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Element.20id.20for.20constrained.20choice.20type.20elements.html#153912116">(Oct 03 2017 at 19:49)</a>:</h4>
<p>Why would the element be "renamed" due to the presence of a type slice? It should just have a sliceName of the reserved name (valueString).</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
