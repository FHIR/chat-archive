---
layout: page
title: "FHIR Chat  · preserve order of repeatable elements · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html">preserve order of repeatable elements</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153844268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allan Bro Hansen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844268">(Aug 18 2016 at 11:47)</a>:</h4>
<p>Hi<br>
I disagree with this statement about ordering of xml-element (or a least with a possible interpretation of it):<br>
"When an element is allowed to repeat, the elements are ordered, and implementations must preserve order (note: the meaning of the order may not be known)"<br>
(from <a href="https://www.hl7.org/fhir/xml.html" target="_blank" title="https://www.hl7.org/fhir/xml.html">https://www.hl7.org/fhir/xml.html</a>)</p>
<p>This could be read as: Whenever a FHIR-ressource is created/updated: the order of ..* related elements must either be persisted or validated against some rules to ensure that the same order is returned.</p>
<p>I strongly believe that it should be a case-by-case decision whether the order must be maintained/matters.</p>
<p>Some examples of what I consider strange behaviour if we follow the statement:<br>
Example1  <br>
If a client reads a fhir-ressource with 2 business identifier:<br>
FHIR-ressource<br>
- Businessidentifer:<br>
   -&gt; SomeBusinessIdentifier<br>
   -&gt; AnotherBusinessIdentifier<br>
And this clients now adds a third business identifer and PUT's this to the server:<br>
FHIR-ressource<br>
- Businessidentifer:<br>
   -&gt; SomeBusinessIdentifier<br>
   -&gt; SomeNewBusinessIdentifier<br>
   -&gt; AnotherBusinessIdentifier<br>
Now the server should be now obligued to maintain this order?</p>
<p>Example2  <br>
If a client reads a fhir-appointment with 3 participations:<br>
FHIR-appointment<br>
Participants<br>
   -&gt; PatientParticipation (it is a patient because of the actor)<br>
   -&gt; LocationParticipation (it is a location because of the actor)<br>
   -&gt; PractitionerParticipation (it is a practitioner because of the actor)<br>
And this clients now updates the appointment in some way but changes the order of the participants.<br>
Now the server should be now obligued to maintain this order of the participants - or just reject the update because of the order.</p>
<p>Some other thoughts:<br>
- if FHIR did use xsd we would have xs:all to define a unordered behaviour<br>
- HL7 version 3 did have ActRrelationship.sequenceNumber to define a fixed sequence</p>
<p>Any comments on this? Do you agree or disagree with me? (or have I missed some FHIR-defined way to specify an unordered list)</p>



<a name="153844269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844269">(Aug 18 2016 at 11:50)</a>:</h4>
<p>You have interpeted 'implementations must preserve order' more expansively than we intended. </p>



<a name="153844270"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844270" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844270">(Aug 18 2016 at 11:51)</a>:</h4>
<p><a href="http://hl7-fhir.github.io/updates.html" target="_blank" title="http://hl7-fhir.github.io/updates.html">http://hl7-fhir.github.io/updates.html</a></p>



<a name="153844271"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844271" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844271">(Aug 18 2016 at 11:52)</a>:</h4>
<p>What that sentence intends to say is that when you are reading and writing elements, the order does matter, and the reading and writing code needs to able to preserve order. </p>



<a name="153844272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844272">(Aug 18 2016 at 11:53)</a>:</h4>
<p>and reordering the elements may change the meaning</p>



<a name="153844273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844273">(Aug 18 2016 at 11:53)</a>:</h4>
<p>The requirement to preserve order doesn't automatically apply if you are editing the resource, but you should understand the meaning of the order, if there is one, when re-ordering</p>



<a name="153844274"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844274" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844274">(Aug 18 2016 at 11:54)</a>:</h4>
<p>we could be clearer about the scope of our statement</p>



<a name="153844275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844275">(Aug 18 2016 at 11:54)</a>:</h4>
<p>In other words: this rule applies to serialization libraries and persistence layers -- not to clients editing a resource. One reason the current language may be unclear is that the word "implementations" can mean so many things (and to different people).</p>



<a name="153844288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844288">(Aug 18 2016 at 12:17)</a>:</h4>
<p>yes that's what's unclear</p>



<a name="153844372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844372">(Aug 18 2016 at 23:00)</a>:</h4>
<p><span class="user-mention" data-user-id="192120">@Allan Bro Hansen</span> Would you be willing to submit a change request for us to clarify the spec?</p>



<a name="153844419"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844419" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allan Bro Hansen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844419">(Aug 19 2016 at 08:17)</a>:</h4>
<p>Thank you for the clarification. And yes, of course "the code" should maintain the order until it knows whether the order matters (almost goes without saying). <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> : I'll be looking at a change request later today or monday.</p>



<a name="153844421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844421">(Aug 19 2016 at 08:39)</a>:</h4>
<p>Could this be exemplified even more? AFAIK, order in xml is not part of the xml spec but can of course be mandated with schemas. On the other hand, in JSON, an array of objects is an ordered sequence. Since, FHIR is supporting both formats, I need some clarification on this matter. It must somehow mean that a 'collection' (an unordered list/set) when serialized in one format (xml) has one meaning but some other meaning when serialized to another format (JSON)?</p>



<a name="153844423"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844423" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allan Bro Hansen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844423">(Aug 19 2016 at 08:51)</a>:</h4>
<p>A possible "better" statement:<br>
"<br>
- When an element is allowed to repeat, the elements are ordered, and implementations must be able to preserve order if the order matters<br>
(see also <a href="https://www.hl7.org/fhir/conformance-rules.html#cardinality" target="_blank" title="https://www.hl7.org/fhir/conformance-rules.html#cardinality">https://www.hl7.org/fhir/conformance-rules.html#cardinality</a> for a further description of elements with cardinality &gt; 1)<br>
"<br>
To replace<br>
- When an element is allowed to repeat, the elements are ordered, and implementations must preserve order (note: the meaning of the order may not be known)</p>



<a name="153844429"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844429" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844429">(Aug 19 2016 at 10:52)</a>:</h4>
<p><span class="user-mention" data-user-id="191427">@Jens Villadsen</span> meaning is the same in both formats. Both formats are explicitly serialised in a particular order. What we are saying is that the serialization order is significant, and the technical infrastructure needs to be able to access the items in the right orde</p>



<a name="153844430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844430">(Aug 19 2016 at 10:53)</a>:</h4>
<p>of course, the order might be be meaningful. or it might be meaningful to the writer but not the reader. That's tricky, and we can't make tha untricky</p>



<a name="153844431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844431">(Aug 19 2016 at 10:54)</a>:</h4>
<p>Allan, I'd like to go further than your proposal and replace implementations with 'the technical infrastructure needs to be able to access the items in the right order'</p>



<a name="153844434"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844434" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844434">(Aug 19 2016 at 11:15)</a>:</h4>
<p>OK, just to understand it from <a href="https://www.hl7.org/fhir/conformance-rules.html#cardinality" target="_blank" title="https://www.hl7.org/fhir/conformance-rules.html#cardinality">https://www.hl7.org/fhir/conformance-rules.html#cardinality</a>:</p>
<p>... </p>
<p>"For elements that have cardinality &gt; 1, the order in which they appear may have meaning. Unless the element definition (either in this specification or the extension) defines a meaning to the order explicitly, the meaning of the order is not defined, and implementations are allowed to reorder the elements. Note that it is not possible to define a meaning for the order of the elements in a profile using a StructureDefinition. When there is no definition of the meaning of the order, implementations that need to choose a single element from a list of elements for some use SHALL do so based on the semantics of the content of the elements that repeats. Profiles and Implementation guides may often make rules about this selection process."</p>
<p>The order cannot be defined using StructureDefinitions. - So if there is a defined order, it is not expressed in  terms of computable syntax or computable semantics by the StructureDefinition. Does that mean that it is OK to define an order expressed in human computable language and that is currently the only way do define such an order?</p>



<a name="153844435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844435">(Aug 19 2016 at 11:37)</a>:</h4>
<p>yes that's what it means. But I don't know why we said you couldn't define the order in a profile. I think we were concerned that people would change the order from the base. but if the base doesn't assign an order....</p>



<a name="153844444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844444">(Aug 19 2016 at 12:17)</a>:</h4>
<p>OK - its just, when you read that order can be defined (with a technical mindset - FHIR is, in many aspects a technical standard), I would expect that order to be computable by a machine. It is however not the case here</p>



<a name="153844445"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844445" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844445">(Aug 19 2016 at 12:24)</a>:</h4>
<p>what would 'computable by machine' mean? </p>



<a name="153844446"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844446" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844446">(Aug 19 2016 at 12:25)</a>:</h4>
<p>eg. order expressed in a schema or having an index attribue on the elements</p>



<a name="153844447"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844447" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844447">(Aug 19 2016 at 12:27)</a>:</h4>
<p>index attribute is a different question. that would mean that the actual order wasn't the order. It has nothing to do with meaning </p>



<a name="153844448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844448">(Aug 19 2016 at 12:27)</a>:</h4>
<p>what would the schema express? </p>



<a name="153844449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844449">(Aug 19 2016 at 12:45)</a>:</h4>
<p>you're right ... it cannot be done</p>



<a name="153844450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844450">(Aug 19 2016 at 12:59)</a>:</h4>
<p>at least I dont know how</p>



<a name="153844451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allan Bro Hansen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844451">(Aug 19 2016 at 13:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> : In respect to replacing "implementations": I think the important part is to include the "if the order matters". "Technical infrastructure" sounds very low-level (hardware/network) and I don't think FHIR should be concerned with that.  </p>



<a name="153844469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844469">(Aug 19 2016 at 16:53)</a>:</h4>
<p>When you persist an instance, you must retain the order of repeating elements whether the order has meaning or not - otherwise you'll break digital signatures</p>



<a name="153844470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844470">(Aug 19 2016 at 16:54)</a>:</h4>
<p>Obviously if you're updating the instance, you're going to break the signature anyhow, so changing the order of things doesn't matter.  Changing the order should only be done in an update with an awareness of what meaning (if any) is associated to the ordering of a collection.</p>



<a name="153844591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allan Bro Hansen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844591">(Aug 22 2016 at 11:30)</a>:</h4>
<p>Lloyd, could you please elaborate on "otherwise you'll break digital signatures" - is it the hashCode of e.g. a Java-object? <br>
My point is that the order is only mandatory to persist in the our system/database if the order matters. Likewise the order should not be guaranteed between multiple GETs.<br>
So e.g. in my first initial example given that the order of business identifers does not matter: it is complety legit to - as a response to a GET or a PUT - return the business identifers in whatever order the server likes - and the order may even be different on the next GET.</p>



<a name="153844681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844681">(Aug 22 2016 at 21:39)</a>:</h4>
<p>If you store an instance and then respond to a query, if the order of the elements on the way out isn't identical to what the order was when the data was signed, the signature will be broken.  The FHIR canonical algorithm for signatures treats the order of all repeating elements as significant (because some of them are significant and differentiating would create more complexity than it's worth).</p>



<a name="153844687"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844687" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allan Bro Hansen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844687">(Aug 22 2016 at 22:53)</a>:</h4>
<p>Okay, now I understand that you are in fact addressing the XML signature, and the signature value of the XML document.<br>
Still, I am talking about a POST or PUT operation in which the client has requested to get the created/updated ressource returned (Prefer-header with value return=representation). The returned resource will most likely be different than the one specified by the client: a logical id is added for a POST (if the resource is presisted), a version or lastUpdated meta-data will be updated (if included), other derived values may have changed. So changing the order of repeatable elements is just one of many possible differences between the post and returned ressource (unless logical id and meta-data are not included in the FHIR canonical algorithm for signatures?).<br>
So to me it appears  that changing the order of repeatable elements for a PUT/POST response is allowed altough not preferable.<br>
The signature issue is also addressed here: <a href="https://www.hl7.org/fhir/updates.html#2.10.6" target="_blank" title="https://www.hl7.org/fhir/updates.html#2.10.6">https://www.hl7.org/fhir/updates.html#2.10.6</a>.</p>



<a name="153844688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844688">(Aug 22 2016 at 23:02)</a>:</h4>
<p>When we sign an instance, it's a canonical signature that can be used for XML or JSON.  If you want to retain signature validity, the id would need to be pre-assigned (using PUT or as part of a Bundle or something).  And certainly there are circumstances where a server might not retain everything as received.  But the base expectation in FHIR is that order is retained.  Changing the order is equivalent in impact to throwing away a couple of elements.  It's within the rights of servers to do so, but doing so degrades the data received.</p>



<a name="153844690"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844690" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Allan Bro Hansen <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844690">(Aug 22 2016 at 23:14)</a>:</h4>
<p>ok, thank you for the clarification. We do not let the clients define the logical id of our ressource - so for a POST the signature will always be broken with the returned ressource (if a ressource is returned)</p>



<a name="153844695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844695">(Aug 23 2016 at 00:41)</a>:</h4>
<p>We should probably talk about whether id should actually be part of the canonicalization algorithm because that's probably true of most servers - and it's not clear it should be part of the signed content.</p>



<a name="153844698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844698">(Aug 23 2016 at 00:49)</a>:</h4>
<p>if id is not part of the signature, then links are not signed. There's almost no point then.</p>



<a name="153844699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844699">(Aug 23 2016 at 00:53)</a>:</h4>
<p>I am not sure we have proven the point of signing FHIR resource instances... An assembled and serialized document, yes.   Not much actual work and lots of questions  <a href="http://wiki.hl7.org/index.php?title=FHIR_Digital_Signature_Working_Page" target="_blank" title="http://wiki.hl7.org/index.php?title=FHIR_Digital_Signature_Working_Page">http://wiki.hl7.org/index.php?title=FHIR_Digital_Signature_Working_Page</a></p>



<a name="153844746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/preserve%20order%20of%20repeatable%20elements/near/153844746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/preserve.20order.20of.20repeatable.20elements.html#153844746">(Aug 23 2016 at 03:38)</a>:</h4>
<p>You're signing the link, not the linked-to content.  If you care about the linked-to content, then you'd need an extension on the reference containing a hash of the thing you're pointing to.  Signing the ids inside a bundle makes sense, just not the root id of the instance.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
