---
layout: page
title: "FHIR Chat  · Uniqueness of constraint keys · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Uniqueness.20of.20constraint.20keys.html">Uniqueness of constraint keys</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="213082103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Uniqueness%20of%20constraint%20keys/near/213082103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Uniqueness.20of.20constraint.20keys.html#213082103">(Oct 12 2020 at 20:21)</a>:</h4>
<p>Somewhere along the line, I got the idea that constraint keys should be globally unique across an IG.  But I noticed in US Core that <code>us-core-1</code> is defined differently in multiple profiles -- so it obviously is <em>not</em> globally unique within the IG.  Looking at the doc, I see that it only guarantees uniqueness within a single Structure Definition.</p>
<p>Because FSH treats invariants as 1st-class objects, however, their names (which correspond to <code>ElementDefinition.constraint.key</code>) are globally unique.  So in FSH right now, it is impossible to re-use the same constraint key across multiple profiles (except when you also want the definition of the constraint to be the same -- which is actually a good feature for re-use).</p>
<p>Is it a best practice to have globally unique constraint keys (with <em>different</em> definitions), or is this something that we shouldn't care about and should allow to happen easily in FSH?</p>



<a name="213089228"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Uniqueness%20of%20constraint%20keys/near/213089228" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Uniqueness.20of.20constraint.20keys.html#213089228">(Oct 12 2020 at 21:41)</a>:</h4>
<p>The key is referring to something within the StructureDefinition.  There's no ability to point to a constraint independent of model, so enforcing uniqueness wouldn't accomplish much.  Also note that if a model inherits an invariant from a StructureDefinition defined in another IG, you can't use that key in your refined model, even though it might not appear elsewhere in the current IG.</p>



<a name="213092997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Uniqueness%20of%20constraint%20keys/near/213092997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Uniqueness.20of.20constraint.20keys.html#213092997">(Oct 12 2020 at 22:37)</a>:</h4>
<p>I think it's fine if FSH doesn't support that</p>



<a name="213229630"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Uniqueness%20of%20constraint%20keys/near/213229630" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Uniqueness.20of.20constraint.20keys.html#213229630">(Oct 13 2020 at 23:20)</a>:</h4>
<p>From an authoring perspective since there is no global invariant index (that I know of). The simplest approach was to increment within an SD.</p>



<a name="213237544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Uniqueness%20of%20constraint%20keys/near/213237544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Uniqueness.20of.20constraint.20keys.html#213237544">(Oct 14 2020 at 01:25)</a>:</h4>
<p>Incrementing within an SD isn't terribly future-proof.  (If a new invariant gets added in the base, you're faced with renumbering your invariants.)  It's better if you use a different prefix in the derived model than the parent model.  You only have to worry about being unique within the inheritance tree.</p>



<a name="213281056"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Uniqueness%20of%20constraint%20keys/near/213281056" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Uniqueness.20of.20constraint.20keys.html#213281056">(Oct 14 2020 at 12:32)</a>:</h4>
<p>BTW -- after further review, I see I mis-spoke above.  I said that keys need only be unique within the SD, but actually, eld-14 (<code>constraint.select(key).isDistinct()</code>) only enforces uniqueness within the constraint array of an element.  So it's even possible to have duplicate keys within an SD as long as they're not in the same element.  Seems like a bad idea to me, but technically it is allowed.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
