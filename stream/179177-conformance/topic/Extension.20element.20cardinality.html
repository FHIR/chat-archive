---
layout: page
title: "FHIR Chat  · Extension element cardinality · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html">Extension element cardinality</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="225540922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225540922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225540922">(Feb 08 2021 at 13:07)</a>:</h4>
<p>When I make one specific extension mandatory (<code>1..*</code>), the cardinality of the extension element remains the default <code>0..*</code>. For example: See <code>Subscription.criteria.extension:trigger-description</code> and <code>Subscription.criteria.extension</code> in <a href="http://fhir.org/guides/argonaut/scheduling/StructureDefinition-argo-sub-notif.html">StructureDefinition-argo-sub-notif</a>.</p>
<p>Intuitively one would say that this means: IF you are adding any extension, you should at least have one <code>trigger-description</code> in there. While the current behavior of validators (.NET and Java) just seems to ignore the cardinality of the <code>.extension</code> element and throw an error when you do not provide one.</p>
<p>The IG publisher seems to not render the <code>.extension</code> cardinality, the <a href="https://simplifier.net/packages/fhir.argonaut.scheduling/1.0.0/files/118316">.NET Simplifier.net renderer</a> doesn't render it if it hasn't been changed (which Forge doesn't let the user do) in that profile.</p>
<p>Should we make clear in the spec that the cardinality of <code>.extension</code> is ignored? We couldn't find it mentioned.<br>
Should we going forward remove it from snapshot generation?</p>



<a name="225544729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225544729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225544729">(Feb 08 2021 at 13:37)</a>:</h4>
<p>Hmmm...  SUSHI automatically aggregates extension cardinalities to the base extension element.  So if you say <code>extension:race</code> is <code>1:1</code>, SUSHI automatically bumps <code>extension</code> to <code>1..*</code>.  It does the same for slices; if you say <code>component:systolic</code> is <code>1..1</code> and <code>component:diastolic</code> is <code>1..1</code>, SUSHI automatically bumps <code>component</code> to <code>2..*</code>.  Is this incorrect?</p>
<p>I thought that if you wanted to say that a specific extension is required only if any extension is present, you would have to use an <code>invariant</code>; e.g., <code>extension.exists() implies extension("http://hl7.org/fhir/us/core/StructureDefinition/us-core-race").exists()</code>.</p>



<a name="225545159"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225545159" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225545159">(Feb 08 2021 at 13:41)</a>:</h4>
<p>The more general question is indeed on any slicing. Currently, <a href="https://simplifier.net/TouchstoneDemoproject/PatientMandatoryExtensions-duplicate-2/~overview">even if <code>Patient.identifier</code> is <code>0..*</code> and you have a slice <code>Patient.identifier:bsn</code> with cardinality <code>1..1</code></a> the .NET validator <a href="https://simplifier.net/touchstonedemoproject/patient01-noextensions/$validate">will still return an error if you do not provide the <code>bsn</code> slice</a>. Forge will allow you to edit the cardinality of <code>Patient.identifier</code> to match your intentions, but as we see it might not serve any other purpose than visual.</p>



<a name="225545579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225545579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225545579">(Feb 08 2021 at 13:44)</a>:</h4>
<p>The question indeed came up whether Forge should calculate those combined cardinalities for you and whether it would matter. Or whether we should just not render them in our rendering, since they seem to be ignored.</p>



<a name="225545796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225545796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225545796">(Feb 08 2021 at 13:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> Indeed, that's also what <span class="user-mention" data-user-id="193430">@Alexander Zautke</span> suggested, the 'IF any, then at least one of X'-case should be done with an invariant. Which would at least allow us to assume we don't need to support that with cardinalities and should be able to calculate a combined cardinality.</p>



<a name="225546561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225546561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225546561">(Feb 08 2021 at 13:53)</a>:</h4>
<p>OK, I think I misunderstood your original message, <span class="user-mention" data-user-id="203235">@Ward Weistra</span>, but I get it now.  It sounds like at least a few of us are on the same page here, but we need it spelled out in a more official capacity as well as some guidance re: whether we <em>need</em> to put aggregate cardinalities in the differential (and/or snapshot) or if that aggregation is implicit and does not need to be explicitly recorded in the differential/snapshot.  Is that right?</p>



<a name="225547171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225547171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225547171">(Feb 08 2021 at 13:57)</a>:</h4>
<p>That's it <span class="user-mention" data-user-id="191469">@Chris Moesel</span>. Calculate just for display but ignored, calculate and use or just leave out.<br>
I'd like to hear the behavior and intentions of the Java stack in validating, snapshot generating and rendering of these situations so we can align.</p>



<a name="225619392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225619392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225619392">(Feb 08 2021 at 22:33)</a>:</h4>
<p>well, I thought that I had a test to check this- the minimum cardinality of an element is the sum of the minimum cardinalities of it's slices. And if a slice is mandatory, an overall minimum cardinality of the element = 0 doesn't override the fact that the slice is mandatory; it's just an error.</p>



<a name="225619613"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225619613" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225619613">(Feb 08 2021 at 22:34)</a>:</h4>
<p>that's why I don't render the cardinality of the root for extensions - it's not expected to say anything interesting. But the maximum can; I'll review how this works</p>



<a name="225690154"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225690154" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225690154">(Feb 09 2021 at 13:38)</a>:</h4>
<p>Thanks for the confirmation, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> -- I for one am glad that we implemented it correctly!  Less work for me! ;-)</p>



<a name="225724988"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225724988" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225724988">(Feb 09 2021 at 17:23)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>. Based on that we plan to:</p>
<ul>
<li>Start calculating the min cardinality for extensions array in Forge, like <span class="user-mention" data-user-id="191469">@Chris Moesel</span> is doing. (Even though tooling currently generally seems to ignore it, it's the right thing going forward)</li>
<li>Continue to render the slice entry cardinality, because of consistency and that it can provide extra information.</li>
<li>Likely continue the current behavior in validation (consider a slice mandatory with a min cardinality of 1, even if entry slice has min cardinality of 0) for backwards compatibility. Unless current tests and stack alignment say differently.</li>
</ul>
<p>Btw, the Argonaut examples I referred to above are from 2018 apparently, so it might well not be representative of the current validation/snapshot generation behavior and sure is not for rendering.</p>



<a name="225811416"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225811416" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225811416">(Feb 10 2021 at 09:26)</a>:</h4>
<p>Perhaps we should add to <a href="http://hl7.org/fhir/R4/profiling.html#slice-cardinality">http://hl7.org/fhir/R4/profiling.html#slice-cardinality</a>:</p>
<ul>
<li>The sum of the minimum cardinalities must be less or equal to <strong><code>m</code> and</strong> <code>n</code></li>
</ul>
<p>(I'd also like to clarify the first bullet there, if I'm reading it right, to:</p>
<ul>
<li>Each slice's maximum cardinality cannot be larger than <code>n</code>)</li>
</ul>



<a name="225996588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225996588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225996588">(Feb 11 2021 at 14:19)</a>:</h4>
<p><span class="user-mention" data-user-id="372944">@Firely Bot</span> issue create "Add clarity on cardinality of sliced element"</p>
<p>Add to <a href="http://hl7.org/fhir/R4/profiling.html#slice-cardinality">http://hl7.org/fhir/R4/profiling.html#slice-cardinality</a>:</p>
<ul>
<li>The sum of the minimum cardinalities must be less or equal to <strong><code>m</code> and</strong> <code>n</code></li>
</ul>
<p>Clarify the first bullet point to:</p>
<ul>
<li>Each slice's maximum cardinality cannot be larger than <code>n</code></li>
</ul>



<a name="225996591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225996591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Firely Bot <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225996591">(Feb 11 2021 at 14:19)</a>:</h4>
<p>Select the issue type from <a href="https://jira.hl7.org/projects/FHIR">project FHIR</a> you want to report:</p>
<p><a href="https://jira.hl7.org/secure/CreateIssueDetails!init.jspa?pid=10405&amp;description=%0AAdd+to+http%3A%2F%2Fhl7.org%2Ffhir%2FR4%2Fprofiling.html%23slice-cardinality%3A%0A%2A+The+sum+of+the+minimum+cardinalities+must+be+less+or+equal+to+%2A%2A%60m%60+and%2A%2A+%60n%60%0A%0AClarify+the+first+bullet+point+to%3A%0A%2A+Each+slice%27s+maximum+cardinality+cannot+be+larger+than+%60n%60%0A%0A_Reported+from+Zulip+topic+%5BExtension+element+cardinality%7Chttps%3A%2F%2Fchat.fhir.org%2F%23narrow%2Fstream%2F179177%2Ftopic%2FExtension%2520element%2520cardinality%2Fnear%2F1613053140%5D+with+Firely+Bot._&amp;summary=Add+clarity+on+cardinality+of+sliced+element&amp;issuetype=10600">Change Request</a>, <a href="https://jira.hl7.org/secure/CreateIssueDetails!init.jspa?pid=10405&amp;description=%0AAdd+to+http%3A%2F%2Fhl7.org%2Ffhir%2FR4%2Fprofiling.html%23slice-cardinality%3A%0A%2A+The+sum+of+the+minimum+cardinalities+must+be+less+or+equal+to+%2A%2A%60m%60+and%2A%2A+%60n%60%0A%0AClarify+the+first+bullet+point+to%3A%0A%2A+Each+slice%27s+maximum+cardinality+cannot+be+larger+than+%60n%60%0A%0A_Reported+from+Zulip+topic+%5BExtension+element+cardinality%7Chttps%3A%2F%2Fchat.fhir.org%2F%23narrow%2Fstream%2F179177%2Ftopic%2FExtension%2520element%2520cardinality%2Fnear%2F1613053140%5D+with+Firely+Bot._&amp;summary=Add+clarity+on+cardinality+of+sliced+element&amp;issuetype=10800">Technical Correction</a>, <a href="https://jira.hl7.org/secure/CreateIssueDetails!init.jspa?pid=10405&amp;description=%0AAdd+to+http%3A%2F%2Fhl7.org%2Ffhir%2FR4%2Fprofiling.html%23slice-cardinality%3A%0A%2A+The+sum+of+the+minimum+cardinalities+must+be+less+or+equal+to+%2A%2A%60m%60+and%2A%2A+%60n%60%0A%0AClarify+the+first+bullet+point+to%3A%0A%2A+Each+slice%27s+maximum+cardinality+cannot+be+larger+than+%60n%60%0A%0A_Reported+from+Zulip+topic+%5BExtension+element+cardinality%7Chttps%3A%2F%2Fchat.fhir.org%2F%23narrow%2Fstream%2F179177%2Ftopic%2FExtension%2520element%2520cardinality%2Fnear%2F1613053140%5D+with+Firely+Bot._&amp;summary=Add+clarity+on+cardinality+of+sliced+element&amp;issuetype=10801">Question</a> or <a href="https://jira.hl7.org/secure/CreateIssueDetails!init.jspa?pid=10405&amp;description=%0AAdd+to+http%3A%2F%2Fhl7.org%2Ffhir%2FR4%2Fprofiling.html%23slice-cardinality%3A%0A%2A+The+sum+of+the+minimum+cardinalities+must+be+less+or+equal+to+%2A%2A%60m%60+and%2A%2A+%60n%60%0A%0AClarify+the+first+bullet+point+to%3A%0A%2A+Each+slice%27s+maximum+cardinality+cannot+be+larger+than+%60n%60%0A%0A_Reported+from+Zulip+topic+%5BExtension+element+cardinality%7Chttps%3A%2F%2Fchat.fhir.org%2F%23narrow%2Fstream%2F179177%2Ftopic%2FExtension%2520element%2520cardinality%2Fnear%2F1613053140%5D+with+Firely+Bot._&amp;summary=Add+clarity+on+cardinality+of+sliced+element&amp;issuetype=10802">Comment</a></p>
<p><em>Don't have an HL7 Jira account yet? <a href="https://jira.hl7.org/secure/CreateIssue.jspa?pid=11200&amp;issuetype=11300">Create one for free.</a></em></p>



<a name="225996935"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/225996935" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#225996935">(Feb 11 2021 at 14:21)</a>:</h4>
<p><a href="http://jira.hl7.org/browse/FHIR-31054">FHIR#31054</a></p>



<a name="226322419"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/226322419" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#226322419">(Feb 14 2021 at 20:09)</a>:</h4>
<p><span class="user-mention" data-user-id="372944">@Firely Bot</span> issue show <a href="http://jira.hl7.org/browse/FHIR-31054">FHIR-31054</a></p>



<a name="226322420"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Extension%20element%20cardinality/near/226322420" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Firely Bot <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Extension.20element.20cardinality.html#226322420">(Feb 14 2021 at 20:09)</a>:</h4>
<p><strong><a href="https://jira.hl7.org/browse/FHIR-31054">FHIR-31054 Add clarity on cardinality of sliced element</a></strong><br>
Status: <strong>Triaged</strong>, Type: <strong>Technical Correction</strong></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
