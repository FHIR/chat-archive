---
layout: page
title: "FHIR Chat  · Dynamic context for FHIR-Path expression · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html">Dynamic context for FHIR-Path expression</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153956552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956552">(May 07 2018 at 15:52)</a>:</h4>
<p>ok, so here's the thing:<br>
exposition:<br>
I have a resource ChargeItemDefinition, that defines rules of whether or not a BillingCode is applicable in a specific context. And I have the ChargeItem resource that provides the context for an instance. ChargeItem points to ChargeItemDefinition.<br>
Now I want to define an operation, that evaluates the rules in ChargeitemDefinition in the context of a ChargeItem instance. </p>
<p>problem:<br>
How do I define a FHIRpath expression in the ChargeItemDefinition resource that is evaluated in the context of the ChargeItem. I feel like I need some sort of placeholder for that, but I can't find any documentation on how to do that...</p>
<p>...or is that out of scope for FHIRpath and I need to read up on CQL? <span class="emoji emoji-1f61d" title="stuck out tongue closed eyes">:stuck_out_tongue_closed_eyes:</span></p>



<a name="153956561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956561">(May 07 2018 at 15:59)</a>:</h4>
<p>You would need the concept of having several instances of resources in the evaluation workspace of your evaluator and being able to refer to them from a FHIRPath expression.  I am not aware we have that in FhirPath....</p>



<a name="153956565"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956565" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956565">(May 07 2018 at 16:03)</a>:</h4>
<p>So FHIRPath only works within the scope of one single resource? I didn't realize that...</p>



<a name="153956569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956569">(May 07 2018 at 16:05)</a>:</h4>
<p>FHIRPath can certain traverse referenced types and profiles</p>



<a name="153956577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956577">(May 07 2018 at 16:08)</a>:</h4>
<p>Ok, so I guess it's not a big deal to create an expression to say ChargeItem.code=1234 is not allowed, if ChargeItem.subject.gender=male, or something... My problem is, that I need to persist the expression outside the ChargeItem resource...</p>



<a name="153956579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956579">(May 07 2018 at 16:09)</a>:</h4>
<p>..but then apply it to ChargeItem...</p>



<a name="153956584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956584">(May 07 2018 at 16:11)</a>:</h4>
<p>Does this dynamicValue thing in the Definition resources help?</p>



<a name="153956591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956591">(May 07 2018 at 16:17)</a>:</h4>
<p>There's no environment-variable in FHIRpath that could access the parameters of an operation, is there? I mean I could pass the ChargeItem instance id when calling the operation and then maybe do something like param.resolve()</p>



<a name="153956615"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956615" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956615">(May 07 2018 at 16:42)</a>:</h4>
<p>Doesn't PlanDefinition have the exact same problem with action.condition.expression and action.dynamicValue.expression...? <br>
These expressions wouldn't resolve whithin the context of the PlanDefinition but rather in the context given by the in-parameters of PlanDefinition/$apply, if I read the spec right side up...</p>



<a name="153956623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956623">(May 07 2018 at 16:55)</a>:</h4>
<p>...or am I overthinking this? I might as well just add some prose to the operation description saying that all expressions in ChargeItemDefinition need to be evaluated in the scope of the ChargeItem resource and leave the rest to business logic of whichever system implements the operation...</p>



<a name="153956638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956638">(May 07 2018 at 17:31)</a>:</h4>
<p>I'd recommend leaving the implementation to the server.  Different servers might implement differently.  (I'll avoid the temptation to comment on the wisdom of business rules being tied to administrative gender... :&gt;)</p>



<a name="153956662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956662">(May 07 2018 at 18:37)</a>:</h4>
<p>You say that now, that I found the %context variable ! :-(</p>



<a name="153956664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956664">(May 07 2018 at 18:39)</a>:</h4>
<p>So I'd define my expressions relative to %context and put some prose into the definition, that %context needs to be replaced by the current ChargeItem instance at runtime and leave the rest to the implementer's invention. Fair?</p>



<a name="153956670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956670">(May 07 2018 at 19:16)</a>:</h4>
<p>ok, first draft: I have a definition for billing code 30110 in the current ChargeItem resource that may not be billed in combination with the code 13250. So I need to make sure, the code 13250 does not appear in the current ChargeItem's Account. %context is supposed to be replaced with the instance of the current ChargeItem at runtime.</p>
<div class="codehilite"><pre><span></span>    <span class="nt">&lt;applicability&gt;</span>
        <span class="nt">&lt;description</span> <span class="na">value=</span><span class="s">&quot;Exclude: 13250&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;language</span> <span class="na">value=</span><span class="s">&quot;text/fhirpath&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;expression</span> <span class="na">value=</span><span class="s">&quot;ChargeItem.where(code=&#39;http://fhir.de/CodingSystem/kbv/ebm|13250&#39; and account=%context.account).count() = 0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/applicability&gt;</span>
</pre></div>


<p>My syntax may be way off, but before I refine it: is this generally something you could do using FHIRPath without breaking it?</p>



<a name="153956673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Dynamic%20context%20for%20FHIR-Path%20expression/near/153956673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Dynamic.20context.20for.20FHIR-Path.20expression.html#153956673">(May 07 2018 at 19:19)</a>:</h4>
<p>um. I think this topic has ventured too deep into the scope of the fhirpath-stream... I'll ask over there...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
