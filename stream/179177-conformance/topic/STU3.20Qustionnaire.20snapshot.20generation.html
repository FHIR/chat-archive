---
layout: page
title: "FHIR Chat  · STU3 Qustionnaire snapshot generation · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html">STU3 Qustionnaire snapshot generation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="276856349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/276856349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans van Amstel <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#276856349">(Mar 28 2022 at 11:04)</a>:</h4>
<p>One of our derived profiles is based on the stu3 questionnaire resource when we try to use the snapshot of this resource in the firely .NET sdk it creates a stack overflow exception.</p>
<p>The reason for this seems to be that the snapshot that we create using the HL7 validator (several version tried including the latest, 18th March 2022) creates an absolute reference instead of an relative reference.</p>
<p><code>"contentReference": "http://hl7.org/fhir/StructureDefinition/Questionnaire#Questionnaire.item",</code></p>
<p>When I view the snapshot on the HL7 website it has an relative reference.</p>
<p><code>&lt;contentReference value="#Questionnaire.item"/&gt; </code></p>
<p>Also when I create the snapshot of our derived profile usign the Firely terminal the generated snapshot has an relative reference.</p>
<p>The derived profile only adds metadata and does not contrain or influence the questionnaire.item.</p>
<p>In our build pipeline we are using the HL7 validator for snapshot generation, validation etc. How can we usign the HL7 validator makes sure the snapshot has the relative reference instead of the absolute reference?</p>



<a name="276878096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/276878096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#276878096">(Mar 28 2022 at 14:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="276935595"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/276935595" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#276935595">(Mar 28 2022 at 21:48)</a>:</h4>
<p>no the relative content references must be replaced with absolute content references when a snapshot is generated</p>



<a name="278523804"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/278523804" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Simons <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#278523804">(Apr 11 2022 at 08:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation/near/276935595">said</a>:</p>
<blockquote>
<p>no the relative content references must be replaced with absolute content references when a snapshot is generated</p>
</blockquote>
<p>As <span class="user-mention" data-user-id="218569">@Hans van Amstel</span> indicated, that is not what is in the HL7 FHIR downloadable specs, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> :<br>
from <code>https://hl7.org/fhir/R4/definitions.xml.zip</code>, line 381561:</p>
<div class="codehilite"><pre><span></span><code>          &lt;element id=&quot;Questionnaire.item.item&quot;&gt;
            &lt;path value=&quot;Questionnaire.item.item&quot;/&gt;
            &lt;short value=&quot;Nested questionnaire items&quot;/&gt;
            &lt;definition value=&quot;Text, questions and other groups to be nested beneath a question or group.&quot;/&gt;
            &lt;comment value=&quot;There is no specified limit to the depth of nesting.  However, Questionnaire authors are encouraged to consider the impact on the user and user interface of overly deep nesting.&quot;/&gt;
            &lt;requirements value=&quot;Reports can consist of complex nested groups.&quot;/&gt;
            &lt;min value=&quot;0&quot;/&gt;
            &lt;max value=&quot;*&quot;/&gt;
            &lt;base&gt;
              &lt;path value=&quot;Questionnaire.item.item&quot;/&gt;
              &lt;min value=&quot;0&quot;/&gt;
              &lt;max value=&quot;*&quot;/&gt;
            &lt;/base&gt;
            &lt;contentReference value=&quot;#Questionnaire.item&quot;/&gt;        &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; line 381561
            &lt;condition value=&quot;que-1&quot;/&gt;
            &lt;constraint&gt;
              &lt;key value=&quot;ele-1&quot;/&gt;
              &lt;severity value=&quot;error&quot;/&gt;
              &lt;human value=&quot;All FHIR elements must have a @value or children&quot;/&gt;
              &lt;expression value=&quot;hasValue() or (children().count() &amp;gt; id.count())&quot;/&gt;
              &lt;xpath value=&quot;@value|f:*|h:div&quot;/&gt;
              &lt;source value=&quot;http://hl7.org/fhir/StructureDefinition/Element&quot;/&gt;
            &lt;/constraint&gt;
            &lt;isModifier value=&quot;false&quot;/&gt;
            &lt;isSummary value=&quot;false&quot;/&gt;
            &lt;mapping&gt;
              &lt;identity value=&quot;rim&quot;/&gt;
              &lt;map value=&quot;.outboundRelationship[typeCode=COMP].target&quot;/&gt;
            &lt;/mapping&gt;
          &lt;/element&gt;
        &lt;/snapshot&gt;
</code></pre></div>



<a name="278524460"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/278524460" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#278524460">(Apr 11 2022 at 08:52)</a>:</h4>
<p>I believe you, but that's basically considered in error retrospectively</p>



<a name="278524485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/278524485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#278524485">(Apr 11 2022 at 08:52)</a>:</h4>
<p>oh no - that's the base questionnaire definition, right?</p>



<a name="278526081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/278526081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Simons <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#278526081">(Apr 11 2022 at 09:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation/near/278524485">said</a>:</p>
<blockquote>
<p>oh no - that's the base questionnaire definition, right?</p>
</blockquote>
<p>correct - I am fine either way - but we now have a discrepancy that is causing conformance challenges using snapshots generated with one toolset in another toolset (which I am guessing is using this base definition)</p>



<a name="278529390"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/278529390" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#278529390">(Apr 11 2022 at 09:41)</a>:</h4>
<p>in the base definition, it is a local reference, so that's not wrong</p>



<a name="278529458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/278529458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#278529458">(Apr 11 2022 at 09:41)</a>:</h4>
<p>anyway, I believe that this is a dot net tool problem, so you should take it up with <span class="user-mention" data-user-id="203235">@Ward Weistra</span>'s team somewhere</p>



<a name="278531647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/278531647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Simons <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#278531647">(Apr 11 2022 at 10:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation/near/278529458">said</a>:</p>
<blockquote>
<p>anyway, I believe that this is a dot net tool problem, so you should take it up with <span class="user-mention silent" data-user-id="203235">Ward Weistra</span>'s team somewhere</p>
</blockquote>
<p>Thank you - for clarifying - you're saying that in a dependent profile snapshot it has to become an absolute uri - to the base definition - since no longer within that base.</p>
<p><code>"contentReference": "http://hl7.org/fhir/StructureDefinition/Questionnaire#Questionnaire.item",</code></p>
<p>We have started that conversation with <span class="user-mention" data-user-id="203235">@Ward Weistra</span> at Firely on the .Net tooling.</p>



<a name="278594330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/STU3%20Qustionnaire%20snapshot%20generation/near/278594330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ward Weistra <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation.html#278594330">(Apr 11 2022 at 18:08)</a>:</h4>
<p>Reported as <a href="https://github.com/FirelyTeam/firely-net-sdk/issues/2039">https://github.com/FirelyTeam/firely-net-sdk/issues/2039</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
