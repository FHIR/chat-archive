---
layout: page
title: "FHIR Chat  · Slicing by target profile of a reference? · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html">Slicing by target profile of a reference?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153901122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901122">(Aug 09 2017 at 11:16)</a>:</h4>
<p>Is it possible to slice by target profile of a reference, and if so: what's the discriminator?</p>



<a name="153901123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901123">(Aug 09 2017 at 11:17)</a>:</h4>
<p>I would have guesses "Type:Profile Path:reference" but that doesn't seem to work</p>



<a name="153901135"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901135" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901135">(Aug 09 2017 at 13:22)</a>:</h4>
<p>Great question...!</p>
<p>The spec  may provide some clues:<br>
<a href="https://www.hl7.org/fhir/profiling.html#discriminator" target="_blank" title="https://www.hl7.org/fhir/profiling.html#discriminator">https://www.hl7.org/fhir/profiling.html#discriminator</a></p>
<p>I think discriminator type "profile" is specifically intended to match type.profile and not type.targetProfile. Maybe you could leverage the special .resolve() fhir path expression that is specifically allowed in this context?</p>



<a name="153901136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901136">(Aug 09 2017 at 13:32)</a>:</h4>
<p>Looks like the LipidProfile example tries to slice DiagnosticReport.result on target profile:<br>
<a href="http://hl7.org/fhir/lipidprofile.profile.xml.html" target="_blank" title="http://hl7.org/fhir/lipidprofile.profile.xml.html">http://hl7.org/fhir/lipidprofile.profile.xml.html</a></p>
<div class="codehilite"><pre><span></span>&lt;discriminator&gt;
  &lt;type value=&quot;value&quot;/&gt;
  &lt;path value=&quot;reference.code&quot;/&gt;
&lt;/discriminator&gt;
</pre></div>


<p>However I'm not sure if this is actually correct, as the documentation on discriminators suggests the use of the resolve() operator...?</p>



<a name="153901137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901137">(Aug 09 2017 at 13:35)</a>:</h4>
<p>The official documentation suggests the following syntax:</p>
<p>Context: List.entry<br>
Discriminator type: profile<br>
Discriminator path: item.reference.resolve()</p>
<p>"Entries are differentiated by a profile tag on the <em>target</em> of the reference, as specified by a structure definition"</p>



<a name="153901139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901139">(Aug 09 2017 at 13:36)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> &amp; <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> any suggestions?</p>



<a name="153901361"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901361" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901361">(Aug 09 2017 at 20:32)</a>:</h4>
<p>I'll defer to <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> on this one.</p>



<a name="153901416"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901416" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901416">(Aug 10 2017 at 04:51)</a>:</h4>
<p>well, the lipid thing looks wrong, though the validator works on it. weird.</p>



<a name="153901417"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/153901417" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#153901417">(Aug 10 2017 at 04:52)</a>:</h4>
<p>the official documentation Michel quoted is what I think is correct</p>



<a name="154022055"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022055" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022055">(Nov 30 2018 at 09:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> <span class="user-mention" data-user-id="191336">@Michel Rutten</span>  I'm re-engaging this topic as we have the same question now for the IPS IG and haven't yet found a working FHIRPath expression for the discriminator path.  The documentation on this has changed for R4, as 'reference' has been removed and for the List.entry example the discriminator path is now <code>item.resolve()</code>.  We're slicing on the Composition.section.entry reference of an already sliced section (for example Composition.section:sectionMedications.entry).  Composition.section.entry is modeled differently from List.entry which is used in the documentation, as Composition.section:sectionMedications.entry itself is of type Reference rather than the additional List.entry.item element.   An example of what we have right now (we've tried various permutations) is:</p>
<div class="codehilite"><pre><span></span>        &lt;element id=&quot;Composition.section:sectionMedications.entry&quot;&gt;
            &lt;path value=&quot;Composition.section.entry&quot;/&gt;
            &lt;slicing&gt;
                &lt;discriminator&gt;
                    &lt;type value=&quot;profile&quot;/&gt;
                    &lt;path value=&quot;resolve()&quot;/&gt;
                &lt;/discriminator&gt;
                &lt;rules value=&quot;openAtEnd&quot;/&gt;
            &lt;/slicing&gt;
            &lt;min value=&quot;1&quot;/&gt;
            &lt;mustSupport value=&quot;true&quot;/&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Composition.section:sectionMedications.entry:medicationStatement&quot;&gt;
            &lt;path value=&quot;Composition.section.entry&quot;/&gt;
            &lt;sliceName value=&quot;medicationStatement&quot;/&gt;
            &lt;min value=&quot;1&quot;/&gt;
            &lt;type&gt;
                &lt;code value=&quot;Reference&quot;/&gt;
                &lt;targetProfile value=&quot;http://hl7.org/fhir/uv/ips/StructureDefinition/MedicationStatement-uv-ips&quot;/&gt;
            &lt;/type&gt;
            &lt;mustSupport value=&quot;true&quot;/&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Composition.section:sectionMedications.entry:medicationStatement.reference&quot;&gt;
            &lt;path value=&quot;Composition.section.entry.reference&quot;/&gt;
            &lt;min value=&quot;1&quot;/&gt;
            &lt;mustSupport value=&quot;true&quot;/&gt;
        &lt;/element&gt;
</pre></div>


<p>And when parsing an IPS bundle example the QA shows this error:</p>
<div class="codehilite"><pre><span></span>Bundle/IPS-examples-Bundle-01: Bundle.entry[5].resource.code.coding error   Unable to resolve discriminator
</pre></div>


<p>Most likely we're doing something wrong, so any suggestions as to what the correct FHIRPath syntax should be for this would be most welcome.</p>



<a name="154022059"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022059" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022059">(Nov 30 2018 at 09:52)</a>:</h4>
<p>I've looked into where the 'Unable to resolve discriminator' exception is thrown in FHIRPathEngine, but so far that hasn't really shed any light on the issue.</p>



<a name="154022060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022060">(Nov 30 2018 at 09:55)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191405">@Rob Hausam</span>, hard to say... the snapshot generator and validator in the FHIR .NET API haven't been updated to R4 yet, so we can't actually test your example. However <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> recently mentioned that he had implemented support for profile-based discriminators. Ewout, can you provide some clarification?</p>



<a name="154022109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022109">(Nov 30 2018 at 14:57)</a>:</h4>
<p>I think this issue was different than we originally thought and the error messages are now resolved.  But if anyone is able to confirm that the syntax we are using is correct (or not), that would be great.</p>



<a name="154022357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022357">(Dec 02 2018 at 15:15)</a>:</h4>
<p>I believe that the <code>resolve()</code> syntax for the path expression is correct, as that fixes the 'Unable to resolve discriminator' error.  But, unfortunately, it results in a new type of error when evaluating the example bundle:</p>
<div class="codehilite"><pre><span></span>Problem evaluating slicing expression for element in profile http://hl7.org/fhir/uv/ips/StructureDefinition/Composition-uv-ips path Bundle.entry[1].resource.section[1].entry (fhirPath = true and resolve().conformsTo(&#39;http://hl7.org/fhir/uv/ips/StructureDefinition/Condition-uv-ips&#39;)): null
</pre></div>


<p>The reference to the Condition-uv-ips profle is the correct one, but it doesn't recognize the identified resource in the bundle as being one of those, even though the resource instance in the bundle has the meta profile tag:</p>
<div class="codehilite"><pre><span></span>                &lt;meta&gt;
                    &lt;profile value=&quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Condition-uv-ips&quot;/&gt;
                &lt;/meta&gt;
</pre></div>


<p>Not sure at this point where to look next to fix this, so any suggestions are very welcome.</p>



<a name="154022358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022358">(Dec 02 2018 at 15:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> <span class="user-mention" data-user-id="191328">@Ewout Kramer</span>  <span class="user-mention" data-user-id="191336">@Michel Rutten</span>?</p>



<a name="154022451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022451">(Dec 03 2018 at 10:41)</a>:</h4>
<blockquote>
<p>Hi <span class="user-mention" data-user-id="191405">@Rob Hausam</span>, hard to say... the snapshot generator and validator in the FHIR .NET API haven't been updated to R4 yet, so we can't actually test your example. However <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> recently mentioned that he had implemented support for profile-based discriminators. Ewout, can you provide some clarification?</p>
</blockquote>
<p>Since I have not implemented this at all yet, these errors must come from the Java IG/validator ;-)  </p>
<p>Syntax-wise, the single "resolve()" looks ok, since that is in line with the List.entry example here (<a href="http://build.fhir.org/profiling.html#discriminator" target="_blank" title="http://build.fhir.org/profiling.html#discriminator">http://build.fhir.org/profiling.html#discriminator</a>).</p>



<a name="154022489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022489">(Dec 03 2018 at 13:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> </p>
<div class="codehilite"><pre><span></span>Bundle/IPS-examples-Bundle-01: Bundle.entry[5].resource.code.coding error   Unable to resolve discriminator
</pre></div>


<p>This error from the ValidationEngine is pointing to the 5th Bundle entry of the IPS-examples-Bundle-01 example resource which is a Condition. The specific path points to the Condition.code.coding element. The "Unable to resolve discriminator" message is being thrown because the IPS Condition Profile's slicing definition on the Condition.code.coding element does not contain a discriminator.path.</p>
<p>Here's the differential definition of the IPS Condition Profile Condition.code.coding element:</p>
<div class="codehilite"><pre><span></span>    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Condition.code.coding&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Condition.code.coding&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;slicing&gt;</span>
            <span class="nt">&lt;description</span> <span class="na">value=</span><span class="s">&quot;Discriminated by value set biding&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;rules</span> <span class="na">value=</span><span class="s">&quot;open&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/slicing&gt;</span>
        <span class="nt">&lt;definition</span> <span class="na">value=</span><span class="s">&quot;Identification of the condition, problem or diagnosis or recording of &amp;quot;problem absent&amp;quot; or of &amp;quot;problems unknown&amp;quot;.&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;min</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;mustSupport</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
</pre></div>


<p>As you can see, the slicing element does not contain a discriminator. So, the FHIRPathEngine does not have a path to evaluate.</p>



<a name="154022667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154022667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154022667">(Dec 04 2018 at 03:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191370">@Richard Ettema</span> Yes, that's what I was referring to (but not explicitly) when I said "I think this issue was different than we originally thought and the error messages are now resolved".  We had the "Unable to resolve discriminator" error when the discriminator path was there, and  removing the discriminator path (and therefore the entire discriminator including the type since path is required) is what we did to resolve the errors.  And I think that makes sense, as the discriminator isn't always required and in this case as long as the value sets that are bound for each slice are not overlapping (as is supposed to be the case) then when they are evaluated the validator can determine the correct slice.</p>



<a name="154024245"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154024245" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154024245">(Dec 10 2018 at 22:13)</a>:</h4>
<p>If you remove the discriminator, then you're not slicing anymore (or if you are, you're declaring new slices based on the discriminator of the parent...)</p>



<a name="154024261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154024261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154024261">(Dec 10 2018 at 22:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  Not sure about that.  It's obviously not <strong>recommended</strong>, but this statement on the profiling.html page clearly indicates that it is allowed: "A structure definition is not required to designate any discriminator at all for a slice, but those that don't identify discriminators are describing content that is very difficult to process, and so this is discouraged."  With that said, though, I think we do need a discriminator - but it needs to be one that actually works when validating instance data.  So far I haven't been able to discover what that is exactly.  If you are now back and have some availability, I would like to find some time to go over with you the details of the slicing and discriminators and the issues that we are having, and either see what we need to do differently for it to work correctly, see what might need still to be fixed in the spec or tooling, or see what we think Grahame may need to agree to pass as an acceptable error or warning.</p>



<a name="154024264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154024264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154024264">(Dec 10 2018 at 22:45)</a>:</h4>
<p>If you're just declaring slicing with a description, you can, but that means there's no computable behavior happening with validators or anything else that doesn't write custom code based on what you put in slicing.description.</p>



<a name="154024265"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154024265" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154024265">(Dec 10 2018 at 22:48)</a>:</h4>
<p>The validator doesn't currently support slicing by profile of a target reference.  Doing so is quite processing intensive.  The general recommendation is to instead slice by something that's distinct for each profile (e.g. a fixed code or something).   One thing you can do is have your profiles mandate that they're declared in meta.profile and then slice by value looking at that.</p>



<a name="154024268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/154024268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#154024268">(Dec 10 2018 at 22:51)</a>:</h4>
<p>Agree.  We do want the discriminator.  We ended up removing it because that wasn't "wrong" and was the only way that we found to resolve some errors.  But I want to put it back and have it work.</p>



<a name="156581755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/156581755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#156581755">(Jan 22 2019 at 05:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> any progress?</p>



<a name="156582069"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/156582069" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#156582069">(Jan 22 2019 at 05:51)</a>:</h4>
<p>We have similar problems. When slicing by profile:resolve() the ig publisher give the error</p>
<blockquote>
<p>Problem evaluating slicing expression for element in profile <a href="http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/composition-phs-1" target="_blank" title="http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/composition-phs-1">http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/composition-phs-1</a> path Composition.section[1].entry (fhirPath = true and resolve().conformsTo('<a href="http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/allergyintolerance-summary-1" target="_blank" title="http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/allergyintolerance-summary-1">http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/allergyintolerance-summary-1</a>')): null</p>
</blockquote>
<p>If I have an example that tries to meet the profile. <br>
We are using STU3</p>



<a name="156582545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/156582545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#156582545">(Jan 22 2019 at 06:03)</a>:</h4>
<p><span class="user-mention" data-user-id="191682">@Richard Townley-O'Neill</span> I didn't get back to this over the holidays or leading up to the WGM and we didn't manage to get to it in our evening session on IGs or another time during the week last week in San Antonio.  But we need to get it resolved for IPS (using R4).  I think I'll start with <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>'s suggestion to mandate that the instance declares meta.profile and try to slice by value on that via the reference and see if that proves to be a sufficiently workable approach.  Not as powerful, but it seems as if it should work.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> also will be working on IGs and will need time from him if there are still issues.</p>



<a name="156582751"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/156582751" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#156582751">(Jan 22 2019 at 06:09)</a>:</h4>
<p>Our profiles are mandating meta.profile:</p>
<div class="codehilite"><pre><span></span>      &lt;constraint&gt;
        &lt;key value=&quot;inv-dh-cmp-01&quot;/&gt;
        &lt;severity value=&quot;error&quot;/&gt;
        &lt;human value=&quot;One meta.profile shall be http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/composition-phs-1&quot;/&gt;
        &lt;expression value=&quot;meta.profile.where($this=&amp;#39;http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/composition-phs-1&amp;#39;).exists()&quot;/&gt;
      &lt;/constraint&gt;
</pre></div>



<a name="156582834"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/156582834" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#156582834">(Jan 22 2019 at 06:11)</a>:</h4>
<p>Oh!. Just reread Lloyd's suggestion. I'll give that a go.</p>



<a name="157519493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/157519493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#157519493">(Feb 04 2019 at 12:34)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="191682">@Richard Townley-O'Neill</span> <span class="user-mention" data-user-id="191336">@Michel Rutten</span>  Does anyone have example(s) of the correct syntax for doing this with resolve()?  I'm trying to slice on the fixed canonical value of meta.profile across the reference.  I think I'm getting close, but I haven't figured out the correct syntax that works yet.</p>



<a name="157519579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/157519579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#157519579">(Feb 04 2019 at 12:35)</a>:</h4>
<p>The documentation seems rather sparse on this.</p>



<a name="157519891"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/157519891" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#157519891">(Feb 04 2019 at 12:41)</a>:</h4>
<p>I'll have a chance to look at this on Wednesday my time</p>



<a name="157519955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/157519955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#157519955">(Feb 04 2019 at 12:42)</a>:</h4>
<p>great</p>



<a name="157727481"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/157727481" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#157727481">(Feb 06 2019 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Did you have a chance to take a look at this?  I'll keep doing some work on it further in the meantime.</p>



<a name="157739172"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/157739172" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#157739172">(Feb 07 2019 at 00:02)</a>:</h4>
<p>do you want to add a test case for this, and we'll iterate on it</p>



<a name="157739783"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/157739783" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#157739783">(Feb 07 2019 at 00:13)</a>:</h4>
<p>ok - will do that</p>



<a name="158022631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/158022631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#158022631">(Feb 11 2019 at 11:03)</a>:</h4>
<p>I <span class="user-mention" data-user-id="191405">@Rob Hausam</span>, I can't find a concrete example of such an expression. You may be able to get some inspiration from a profile created by colleague @Vadim: <a href="https://simplifier.net/temporary-swedish-pa/mymedicationrequest" target="_blank" title="https://simplifier.net/temporary-swedish-pa/mymedicationrequest">https://simplifier.net/temporary-swedish-pa/mymedicationrequest</a><br>
Specifically, look at the expression for constraint "medication-1" on the root element. This expression uses resolve() to inspect another (sibling) element.</p>



<a name="160555860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/160555860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#160555860">(Mar 12 2019 at 09:43)</a>:</h4>
<p>I'd expect NOT to use resolve when profiling across a reference and instead to rely on the targetProfile element of type.  However, that seems to be at odds with the valueset comments.  Here's an example:</p>
<div class="codehilite"><pre><span></span>{
    &quot;differential&quot;: {
        &quot;element&quot;: [
            {
        &quot;id&quot;:&quot;Encounter.participant&quot;,
                &quot;path&quot;: &quot;Encounter.participant&quot;,
                &quot;slicing&quot;: {
                    &quot;discriminator&quot;: [{
                        &quot;type&quot;: &quot;profile&quot;,
                        &quot;path&quot;: &quot;individual.reference&quot;
                    }],
                    &quot;rules&quot;: &quot;open&quot;
                }
            },
            {
        &quot;id&quot;: &quot;Encounter.participant:withParticularID&quot;,
                &quot;path&quot;: &quot;Encounter.participant&quot;,
                &quot;sliceName&quot;: &quot;withParticularID&quot;
            },
            {
        &quot;id&quot;: &quot;Encounter.participant:withParticularID.individual.reference&quot;,
                &quot;path&quot;: &quot;Encounter.participant.individual.reference&quot;,
                &quot;type&quot;: [{
                    &quot;code&quot;: &quot;string&quot;,
                    &quot;targetProfile&quot;: &quot;http://example.com/fhir/StructureDefinition/practitioner-with-particular-id&quot;
                }]
            }
        ]
    }
}
</pre></div>



<a name="160556102"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/160556102" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#160556102">(Mar 12 2019 at 09:46)</a>:</h4>
<p><a href="http://hl7.org/fhir/STU3/valueset-discriminator-type.html" target="_blank" title="http://hl7.org/fhir/STU3/valueset-discriminator-type.html">http://hl7.org/fhir/STU3/valueset-discriminator-type.html</a> in STU3 is silent on the matter.  R4 clarified (badly IMO): <a href="http://hl7.org/fhir/valueset-discriminator-type.html" target="_blank" title="http://hl7.org/fhir/valueset-discriminator-type.html">http://hl7.org/fhir/valueset-discriminator-type.html</a> that resolve() was to be used.  This requires the validator to match a .resolve() path with <code>type.targetProfile</code> (backtracking) and a non resolve() path with <code>type.profile</code>.</p>



<a name="160556177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/160556177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#160556177">(Mar 12 2019 at 09:47)</a>:</h4>
<p>This leaves the question of when both profile and targetProfile are set (which is legal as far as I can tell...)?  Is one to be treated as discriminator and the other as validation?</p>



<a name="160568019"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/160568019" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#160568019">(Mar 12 2019 at 13:09)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="191351">@Chris Grenz</span>  In IPS we still have these questions, and would like to get this "resolved". :)</p>



<a name="160757613"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/160757613" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#160757613">(Mar 14 2019 at 07:27)</a>:</h4>
<p>I don't know the answer to this</p>



<a name="161744015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/161744015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#161744015">(Mar 26 2019 at 09:22)</a>:</h4>
<p>WGM topic?</p>



<a name="161744140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/161744140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#161744140">(Mar 26 2019 at 09:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> - maybe open a clarification tracker that can be triaged to WGM in person.</p>



<a name="162087702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/162087702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#162087702">(Mar 29 2019 at 22:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191351">@Chris Grenz</span> good suggestion - I'll probably do that on the plane home from Finland on Sunday (or maybe tomorrow, but don't think I will get to it tonight after a good but intense week)</p>



<a name="173061216"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/173061216" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#173061216">(Aug 12 2019 at 21:13)</a>:</h4>
<p>do we now know the answer to this? I have a also a related question: if i slice on the resource/target profile. Which counts: meta statement about the profile in the target, or if the entry validates against one of the slices, what happens if it validates against 2 slices?</p>



<a name="173095708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/173095708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#173095708">(Aug 13 2019 at 08:34)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191451">@Patrick Werner</span>, interesting question. Ewout explains that the .NET Validator probably performs a "greedy" match, i.e. map to the first slice entry with a matching targetProfile and ignore any others. An advanced validator implementation could try to match against all specified targetProfiles and report ambiguous matches. However this would be quite cpu-intensive, hence the current "greedy" approach.</p>



<a name="173510823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20by%20target%20profile%20of%20a%20reference%3F/near/173510823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20by.20target.20profile.20of.20a.20reference.3F.html#173510823">(Aug 19 2019 at 01:56)</a>:</h4>
<p>I think the Java reference implementation currently tries to match everything and hollers if it finds more than one (or none).  Profiles certainly shouldn't rely on a greedy match approach (i.e. all target profiles need to be mutually exclusive)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
