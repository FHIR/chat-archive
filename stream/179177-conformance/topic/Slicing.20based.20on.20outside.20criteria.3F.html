---
layout: page
title: "FHIR Chat  · Slicing based on outside criteria? · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html">Slicing based on outside criteria?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="154012340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012340">(Oct 26 2018 at 10:13)</a>:</h4>
<p>Hi,<br>
is there a way to select a slice for validation based on a criteria which lies outside the slice?<br>
E.g. a FHIRPath expression that has to evaluate as "true" to select a slice.<br>
Example: Patient has 3 different slices for name, the correct one is selected based on citizenship, so each slice would need a FHIRPath-expression of kind "citizenship=XX" for selection of the correct slice to validate the instance...</p>



<a name="154012342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012342">(Oct 26 2018 at 10:33)</a>:</h4>
<p>If there is a slice discriminator, you may add 3 FHIRPath expressions that say "citizenship=DE and name.xyz=(your value for xyz in a German name)"., with the value of the xyz element being the discriminator etc.<br>
If you don't have a discriminator, maybe add an extension that represents one ("name-style" =&gt; DE, FR, ES, ...)</p>



<a name="154012343"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012343" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012343">(Oct 26 2018 at 10:37)</a>:</h4>
<p>Well, we figured this usecase would come up some time ;-)   See <a href="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_id=677&amp;tracker_item_id=12641" target="_blank" title="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_id=677&amp;tracker_item_id=12641">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_id=677&amp;tracker_item_id=12641</a>.  But I don't think Grahame nor me bothered to implement it....</p>



<a name="154012346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012346">(Oct 26 2018 at 10:59)</a>:</h4>
<p>That would be this extension: <a href="http://build.fhir.org/extension-elementdefinition-selector.html" target="_blank" title="http://build.fhir.org/extension-elementdefinition-selector.html">http://build.fhir.org/extension-elementdefinition-selector.html</a><br>
right?</p>



<a name="154012349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012349">(Oct 26 2018 at 11:03)</a>:</h4>
<p>If I understand this correct, the extension would be added to the relevant elements in each slice.<br>
But what is the root of the FHIRPath expression then? If it is the sliced element, you would not be able to refer to an element elsewhere in the resource?</p>



<a name="154012350"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012350" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012350">(Oct 26 2018 at 11:04)</a>:</h4>
<p>Wouldn't %resource work to get you back to the root of the resource?</p>



<a name="154012351"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012351" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012351">(Oct 26 2018 at 11:04)</a>:</h4>
<p>Argh, right</p>



<a name="154012352"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012352" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012352">(Oct 26 2018 at 11:28)</a>:</h4>
<p>This sounds exactly like what we are looking for. However I am not sure I understand the usage correctly. If each slice has a FHIR-Path expression that must evaluate to "true" to select the slice, then what is the discriminator?</p>
<p>Or rather, if the discriminator was a FHIRPath, would the Expression in the extension then only be the value matching the expression...?</p>



<a name="154012353"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012353" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012353">(Oct 26 2018 at 11:34)</a>:</h4>
<p>There is essentially no discriminator (which is a fixed code somewhere in the definitions), but rather an entrance criteria for each slice, represented in FHIRPath.  So, each slice would have its own FHIRPath expression, that - if it evaluates to true on the instance - triggers the constraints for that slice.</p>
<p>So, you could slice on -say- Observation.referenceRange like so:<br>
slice A1: low &lt;= 100y<br>
slice A2: low &gt; 100y</p>



<a name="154012355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012355">(Oct 26 2018 at 11:45)</a>:</h4>
<p>Thanks, awesome!!</p>



<a name="154012356"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012356" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012356">(Oct 26 2018 at 11:46)</a>:</h4>
<p>Now, we just need to build it into our validators ;-)  But your lucky, I am reviewing the.NET  validator over the coming period. Who knows ;-)</p>



<a name="154012357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012357">(Oct 26 2018 at 11:48)</a>:</h4>
<p>Becomes interesting  when multiple selectors match simultaneously...</p>



<a name="154012358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012358">(Oct 26 2018 at 11:55)</a>:</h4>
<p>Is the Gforge item puts it:</p>
<blockquote>
<p>This would also allow for instances to fit in multiple slices (note: this is unlike the behaviour of the familiar switch statement), deeply changing the semantics of slices. The consequences of this might be far-reaching at this moment in the publication cycle so we suggest to add this "selector" as an extension, allowing toolsmiths to experiment with it and get feedback on it."</p>
</blockquote>



<a name="154012400"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154012400" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154012400">(Oct 26 2018 at 13:20)</a>:</h4>
<p>I have not implemented this</p>



<a name="154013562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154013562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154013562">(Oct 30 2018 at 07:51)</a>:</h4>
<p>Would this be a correct usage of the extension in a differential to express that a Patient's name must validate against the Profile "humanname-de-basis" if the citizenship is "DE"?</p>
<div class="codehilite"><pre><span></span> <span class="nt">&lt;StructureDefinition</span> <span class="na">xmlns=</span><span class="s">&quot;http://hl7.org/fhir&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;url</span> <span class="na">value=</span><span class="s">&quot;http://example.org/fhir/StructureDefinition/MyPatient&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;name</span> <span class="na">value=</span><span class="s">&quot;MyPatient&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;status</span> <span class="na">value=</span><span class="s">&quot;draft&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;fhirVersion</span> <span class="na">value=</span><span class="s">&quot;3.0.1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;kind</span> <span class="na">value=</span><span class="s">&quot;resource&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;abstract</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;Patient&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;baseDefinition</span> <span class="na">value=</span><span class="s">&quot;http://hl7.org/fhir/StructureDefinition/Patient&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;derivation</span> <span class="na">value=</span><span class="s">&quot;constraint&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;differential&gt;</span>
        <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Patient.name&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Patient.name&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;slicing&gt;</span>
                <span class="nt">&lt;rules</span> <span class="na">value=</span><span class="s">&quot;open&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/slicing&gt;</span>
        <span class="nt">&lt;/element&gt;</span>
        <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Patient.name:Name-DE&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;extension</span> <span class="na">url=</span><span class="s">&quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-selector&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;valueString</span> <span class="na">value=</span><span class="s">&quot;$this.extension(&#39;http://hl7.org/fhir/StructureDefinition/patient-citizenship&#39;).valueString=&#39;DE&#39;&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/extension&gt;</span>
            <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Patient.name&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;sliceName</span> <span class="na">value=</span><span class="s">&quot;Name-DE&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;type&gt;</span>
                <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">&quot;HumanName&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;profile</span> <span class="na">value=</span><span class="s">&quot;http://fhir.de/StructureDefinition/humanname-de-basis&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;/differential&gt;</span>
<span class="nt">&lt;/StructureDefinition&gt;</span>
</pre></div>



<a name="154013580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154013580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154013580">(Oct 30 2018 at 10:50)</a>:</h4>
<p>No, since it would look for an extension under <a href="http://Patient.name" target="_blank" title="http://Patient.name">Patient.name</a> (and you could already do that with normal discriminators), I think you mean:</p>
<p><code>%resource.extension(.....).value = 'DE'</code></p>
<p>Note that in FHIRPath, the type suffixes do not exist, so it is not <code>extension(....).valueString</code>, but just <code>.value</code>.</p>



<a name="154013591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154013591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154013591">(Oct 30 2018 at 11:46)</a>:</h4>
<p>Oh, ok! So it would be the structure as above but with  the FHIRPath expression<br>
<code>%resource.extension('http://hl7.org/fhir/StructureDefinition/patient-citizenship').value='DE'</code></p>



<a name="154013592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Slicing%20based%20on%20outside%20criteria%3F/near/154013592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Slicing.20based.20on.20outside.20criteria.3F.html#154013592">(Oct 30 2018 at 11:52)</a>:</h4>
<p>Should there be anything in particular (like a keyword) in slicing.description<br>
or would validators know how this works based on the existence of the extensions?<br>
(eld-1 says there needs to be a description if there's no discriminator....)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
