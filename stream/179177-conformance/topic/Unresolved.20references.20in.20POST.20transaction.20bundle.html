---
layout: page
title: "FHIR Chat  · Unresolved references in POST transaction bundle · conformance"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/index.html">conformance</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Unresolved.20references.20in.20POST.20transaction.20bundle.html">Unresolved references in POST transaction bundle</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="249074528"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Unresolved%20references%20in%20POST%20transaction%20bundle/near/249074528" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Unresolved.20references.20in.20POST.20transaction.20bundle.html#249074528">(Aug 11 2021 at 07:01)</a>:</h4>
<p>I came across a transaction bundle that contains a  single POST request for a Condition resource which</p>
<ol>
<li>has no <code>fullUrl</code> assigned, and</li>
<li>contains a relative reference (<code>Patient/1234</code>)</li>
</ol>
<p>My question is whether this is allowed (or whether it is up to the validator implementer). The .NET and Java validators disagree on this, the former issuing only a warning for the Bundle, the latter two errors (see below for example).</p>
<p>The spec says that "For transactions and batches, entries MAY not have fullURLs when the entry.request.method = POST" (<a href="http://www.hl7.org/FHIR/r4/bundle.html#bundle-unique">here</a>). However, <a href="http://www.hl7.org/FHIR/r4/bundle.html#references">the rules for reference resolution in a Bundle</a> imply that if the fullUrl of a resource is missing, the resolution of a relative reference fails and the reference "has no defined meaning within this specification". However, I have not been able to find a statement on whether this renders the resource invalid or not (or whether that classification is left up to the implementer).  Even if it is a free choice, it seems to be something the validators should ideally align on.</p>
<p>A simple example is the resource below. The .NET validator <a href="https://simplifier.net/validate">https://simplifier.net/validate</a> gives only a warning about not being able to resolve the reference in <code>subject</code>, but the Java CLI validator (version 5.4.9) gives two errors:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>*FAILURE*: <span class="m">2</span> errors, <span class="m">0</span> warnings, <span class="m">0</span> notes
  Error @ Bundle.entry<span class="o">[</span><span class="m">0</span><span class="o">]</span>.resource.ofType<span class="o">(</span>Condition<span class="o">)</span>.subject : Relative Reference appears inside Bundle whose entry is missing a fullUrl
  Error @ Bundle.entry<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">(</span>line <span class="m">4</span>, col16<span class="o">)</span> : Bundle entry missing fullUrl
</code></pre></div>
<p>Example Bundle:</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
    <span class="nt">"resourceType"</span><span class="p">:</span> <span class="s2">"Bundle"</span><span class="p">,</span>
    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"transaction"</span><span class="p">,</span>
    <span class="nt">"entry"</span><span class="p">:</span> <span class="p">[{</span>
        <span class="nt">"resource"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"resourceType"</span><span class="p">:</span> <span class="s2">"Condition"</span><span class="p">,</span>
            <span class="nt">"subject"</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">"reference"</span><span class="p">:</span> <span class="s2">"Patient/1234"</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"POST"</span><span class="p">,</span>
            <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"Condition"</span>
        <span class="p">}</span>
    <span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>



<a name="249075841"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Unresolved%20references%20in%20POST%20transaction%20bundle/near/249075841" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Unresolved.20references.20in.20POST.20transaction.20bundle.html#249075841">(Aug 11 2021 at 07:21)</a>:</h4>
<p>The Java validator might well be right - this part of the validation in the .NET engine has been written during the STU3 timeframe, and I know we've made some changes to the spec since. I am interested to know the outcome - if necessary we will update the .NET validator to align better with the Java one.</p>



<a name="249199734"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179177-conformance/topic/Unresolved%20references%20in%20POST%20transaction%20bundle/near/249199734" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179177-conformance/topic/Unresolved.20references.20in.20POST.20transaction.20bundle.html#249199734">(Aug 12 2021 at 05:40)</a>:</h4>
<p>The rules for reference resolution in Bundle have been further clarified for R5, but I don't know if the changes have made it yet to <a href="https://build.fhir.org">https://build.fhir.org</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
