---
layout: page
title: "FHIR Chat  · Post data to spark - exception on ExtrapolateMethod · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html">Post data to spark - exception on ExtrapolateMethod</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153898188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Post%20data%20to%20spark%20-%20exception%20on%20ExtrapolateMethod/near/153898188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santosh Jami <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html#153898188">(Jul 26 2017 at 00:44)</a>:</h4>
<p>I am getting the Object reference not set to an instance of an object exception on ExtrapolateMethod when posting Bundle to Spark. Any ideas? </p>
<p>Here is the exception stack trace, <br>
System.NullReferenceException occurred<br>
  HResult=0x80004003<br>
  Message=Object reference not set to an instance of an object.<br>
  Source=Spark.Engine<br>
  StackTrace:<br>
   at Spark.Engine.Extensions.EntryExtensions.ExtrapolateMethod(ILocalhost localhost, EntryComponent entry, IKey key) in C:\git\sparkdevelop2\src\Spark.Engine\Extensions\InteractionExtensions.cs:line 50<br>
   at Spark.Engine.Service.FhirServiceExtensions.ResourceManipulationOperationFactory.GetManipulationOperation(EntryComponent entryComponent, ILocalhost localhost, ISearchService service) in C:\git\sparkdevelop2\src\Spark.Engine\Service\FhirServiceExtensions\ResourceManipulationOperationFactory.cs:line 62<br>
   at Spark.Engine.Service.FhirServiceExtensions.TransactionService.&lt;HandleTransaction&gt;b__9_0(EntryComponent e) in C:\git\sparkdevelop2\src\Spark.Engine\Service\FhirServiceExtensions\TransactionService.cs:line 105<br>
   at Spark.Engine.Service.FhirServiceExtensions.TransactionService.HandleTransaction(Bundle bundle, IInteractionHandler interactionHandler) in C:\git\sparkdevelop2\src\Spark.Engine\Service\FhirServiceExtensions\TransactionService.cs:line 105<br>
   at Spark.Engine.Service.FhirService.Transaction(Bundle bundle) in C:\git\sparkdevelop2\src\Spark.Engine\Service\FhirService.cs:line 314<br>
   at Spark.Controllers.FhirController.Transaction(Bundle bundle) in C:\git\sparkdevelop2\src\Spark\Controllers\FhirController.cs:line 175<br>
   at System.Web.Http.Controllers.ReflectedHttpActionDescriptor.ActionExecutor.&lt;&gt;c__DisplayClass10.&lt;GetExecutor&gt;b__9(Object instance, Object[] methodParameters)<br>
   at System.Web.Http.Controllers.ReflectedHttpActionDescriptor.ExecuteAsync(HttpControllerContext controllerContext, IDictionary`2 arguments, CancellationToken cancellationToken)</p>
<p>And here is my xml body for the post request to Spark server:</p>
<p>&lt;Bundle xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" title="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>"&gt;<br>
    &lt;type value="collection"/&gt;<br>
    &lt;entry&gt;<br>
        &lt;resource&gt;<br>
            &lt;Patient&gt;<br>
                &lt;id value="PID-patient-identification"/&gt;<br>
                &lt;text&gt;<br>
                    &lt;status value="generated"/&gt;<br>
                    &lt;xhtml:div xmlns:xhtml="<a href="http://www.w3.org/1999/xhtml" target="_blank" title="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>"&gt;<br>
                        &lt;p class="L"&gt;FASTING:NO&lt;/p&gt;<br>
                    &lt;/xhtml:div&gt;<br>
                &lt;/text&gt;<br>
                &lt;identifier&gt;<br>
                    &lt;use value="official"/&gt;<br>
                    &lt;type&gt;<br>
                        &lt;coding&gt;<br>
                            &lt;code value="PT"/&gt;<br>
                        &lt;/coding&gt;<br>
                    &lt;/type&gt;<br>
                    &lt;value value=""/&gt;<br>
                &lt;/identifier&gt;<br>
                &lt;name&gt;<br>
                    &lt;use value="official"/&gt;<br>
                    &lt;family value=""/&gt;<br>
                &lt;/name&gt;<br>
                &lt;telecom&gt;<br>
                    &lt;system value="phone"/&gt;<br>
                    &lt;value value=""/&gt;<br>
                    &lt;use value="home"/&gt;<br>
                &lt;/telecom&gt;<br>
                &lt;gender value="female"/&gt;<br>
                &lt;birthDate value=""/&gt;<br>
                &lt;address&gt;<br>
                    &lt;use value="home"/&gt;<br>
                &lt;/address&gt;<br>
            &lt;/Patient&gt;<br>
        &lt;/resource&gt;<br>
    &lt;/entry&gt;<br>
&lt;/Bundle&gt;</p>
<p>I went to <a href="http://fhirtest.uhn.ca/create" target="_blank" title="http://fhirtest.uhn.ca/create">http://fhirtest.uhn.ca/create</a> to test the same above message. When I did a create, got a 201 Success response.<br>
Any ideas?</p>
<p>Thanks<br>
Santosh Jami</p>



<a name="153898191"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Post%20data%20to%20spark%20-%20exception%20on%20ExtrapolateMethod/near/153898191" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html#153898191">(Jul 26 2017 at 01:15)</a>:</h4>
<p>I don't know what is going here as far as the error is concerned, however the SPARK server is DSTU2, and the HAPI server at the address you provided is an SUT3 server.<br>
Can't spot anything in that bundle that looks nasty.<br>
(Validation on the empty strings must have been suppressed and ignored)<br>
A pretty sparse Patient example, assuming you weren't after comments on the content of the resource itself...</p>



<a name="153898192"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Post%20data%20to%20spark%20-%20exception%20on%20ExtrapolateMethod/near/153898192" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santosh Jami <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html#153898192">(Jul 26 2017 at 01:19)</a>:</h4>
<p>Thanks Brian.I selected DSTU2 for hapi. Have you posted any successful bundle to Spark or may be point me where I can get a test bundle message to post to Spark and test it?</p>



<a name="153898194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Post%20data%20to%20spark%20-%20exception%20on%20ExtrapolateMethod/near/153898194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santosh Jami <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html#153898194">(Jul 26 2017 at 01:26)</a>:</h4>
<p>I posted this example that I got from github,  <a href="https://github.com/ewoutkramer/fhir-net-api/blob/7bf0863b2a7ef061cde1f05e80359d5f23f4681a/src/Hl7.Fhir.Specification.Tests/TestData/grahame-validation-examples/bundle-good.xml" target="_blank" title="https://github.com/ewoutkramer/fhir-net-api/blob/7bf0863b2a7ef061cde1f05e80359d5f23f4681a/src/Hl7.Fhir.Specification.Tests/TestData/grahame-validation-examples/bundle-good.xml">https://github.com/ewoutkramer/fhir-net-api/blob/7bf0863b2a7ef061cde1f05e80359d5f23f4681a/src/Hl7.Fhir.Specification.Tests/TestData/grahame-validation-examples/bundle-good.xml</a><br>
The end point I hit was <a href="http://spark.furore.com/fhir" target="_blank" title="http://spark.furore.com/fhir">http://spark.furore.com/fhir</a><br>
But got same exception - Am I missing somethins? AM sure the bundles are tested on Spark. </p>
<p>{<br>
  "resourceType": "Bundle",<br>
  "id": "bundle",<br>
  "type": "collection",<br>
  "entry": [<br>
    {<br>
      "fullUrl": "<a href="http://acme.com/Patient/pat1" target="_blank" title="http://acme.com/Patient/pat1">http://acme.com/Patient/pat1</a>",<br>
      "resource": {<br>
          "resourceType": "Patient",<br>
          "id" : "pat1",<br>
          "link" : {<br>
            "type" : "refer",<br>
            "other" : {<br>
              "reference" : "Patient/pat2"<br>
            }<br>
          }<br>
        }<br>
    },<br>
    {<br>
      "fullUrl": "<a href="http://acme.com/Patient/pat2" target="_blank" title="http://acme.com/Patient/pat2">http://acme.com/Patient/pat2</a>",<br>
      "resource": {<br>
        "resourceType": "Patient",<br>
        "id" : "pat1"<br>
      }<br>
    }<br>
  ]<br>
}</p>



<a name="153898198"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Post%20data%20to%20spark%20-%20exception%20on%20ExtrapolateMethod/near/153898198" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html#153898198">(Jul 26 2017 at 02:06)</a>:</h4>
<p>I haven't actively been working with spark for some time as we have our own implementation, so sorry can't ad much more for now.</p>



<a name="153898199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Post%20data%20to%20spark%20-%20exception%20on%20ExtrapolateMethod/near/153898199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html#153898199">(Jul 26 2017 at 02:06)</a>:</h4>
<p>You can get the code from github and debug it yourself though ;)</p>



<a name="153898201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Post%20data%20to%20spark%20-%20exception%20on%20ExtrapolateMethod/near/153898201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Santosh Jami <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html#153898201">(Jul 26 2017 at 02:10)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> . Looking at the code, I found there is a null check missing in the code,<br>
  return entry.Request.Method ?? DetermineMethod(localhost, key);<br>
my entry.Request is null, entry.Request.Method always fails</p>



<a name="153898205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Post%20data%20to%20spark%20-%20exception%20on%20ExtrapolateMethod/near/153898205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Post.20data.20to.20spark.20-.20exception.20on.20ExtrapolateMethod.html#153898205">(Jul 26 2017 at 03:03)</a>:</h4>
<p>Yup, looks like a bug.<br>
You could either fix it and make a pull request, or just add the data in your submitted bundle ;)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
