---
layout: page
title: "FHIR Chat  · System.FormatException FhirDateTime --&gt; ToDateTimeOffset() · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/System.2EFormatException.20FhirDateTime.20--.3E.20ToDateTimeOffset().html">System.FormatException FhirDateTime --&gt; ToDateTimeOffset()</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153892663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/System.FormatException%20FhirDateTime%20--%3E%20ToDateTimeOffset%28%29/near/153892663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Harald Sømnes Hanssen <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/System.2EFormatException.20FhirDateTime.20--.3E.20ToDateTimeOffset().html#153892663">(Jun 07 2017 at 13:07)</a>:</h4>
<p>Hi.</p>
<p>I'm having an issue with using FhirDateTime when time is represented by dots</p>
<p>The exception goes like this<br>
"System.FormatException: 'The string '2016-05-05T12.00.00' is not a valid AllXsd value.'"</p>
<p>This value is in an FhirDateTime object.<br>
var dateTime = new FhirDateTime(dateStr);<br>
var dateTimeOffset = dateTime.ToDateTimeOffset() --&gt; causes the exception</p>
<p>The problem here, is that my computer uses the format hh.mm.ss format instead of hh:mm:ss (which is very annoying). An easy fix would be to change the format on my computer, however, this is just a quickfix and does not solve the problem:</p>
<p>Making sure that the ToDateTimeOffset() gets a date in the expected format before it converts the date. </p>
<p>Is there a reasonable way of tackling it?</p>



<a name="153892757"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/System.FormatException%20FhirDateTime%20--%3E%20ToDateTimeOffset%28%29/near/153892757" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/System.2EFormatException.20FhirDateTime.20--.3E.20ToDateTimeOffset().html#153892757">(Jun 07 2017 at 21:22)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="192139">@Harald Sømnes Hanssen</span>, the challenge is that the FHIR datetime format does not map 1-1 to the C# DateTimeOffset datatype. For example, FHIR allows partial dates such as year-month, however you cannot express this in native C# datatypes. Therefore the API internally manages FHIR datetime values as strings, providing extension methods for mapping from/to C# datatypes - however that conversion is not always possible. Consequently, you have to do some additional work in your client logic. We're open to suggestions about improving the API, so please feel free to submit your ideas.</p>



<a name="153892878"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/System.FormatException%20FhirDateTime%20--%3E%20ToDateTimeOffset%28%29/near/153892878" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Harald Sømnes Hanssen <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/System.2EFormatException.20FhirDateTime.20--.3E.20ToDateTimeOffset().html#153892878">(Jun 08 2017 at 07:20)</a>:</h4>
<p>Hi Michael</p>
<p>Wouldn't it be better to map the date by properties and set the desired format when you created the FhirDateTime object?</p>
<p>For example, <br>
     public FhirDateTime(int year, int month, int day, int hr, int min, int sec = 0, string dateTimeXmlFormat, string dateTimeFormat)</p>
<p>Or at least have an outputmethod in the FhirDateTime?</p>
<p>public ToDateTime(string outputDateTimeFormat = null)</p>
<p>When you are transferring dates between systems, it is vital to be able to get the correct date without having to create temporary solutions.</p>
<p>In my case, the ToDateTime method would have probably solved the issue I'm having, where I'm transferring the date from FHIR service to a hl7 v3 connector.</p>



<a name="153893057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/System.FormatException%20FhirDateTime%20--%3E%20ToDateTimeOffset%28%29/near/153893057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/System.2EFormatException.20FhirDateTime.20--.3E.20ToDateTimeOffset().html#153893057">(Jun 09 2017 at 04:17)</a>:</h4>
<p>Not sure what you'd like us to do here.<br>
We've provided helper methods to go to/from c# datetime and datetimeoffset classes to the FhirDateTime class. If you pass a string that isn't a FHIR string to the constructor, yes it breaks.</p>



<a name="153893058"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/System.FormatException%20FhirDateTime%20--%3E%20ToDateTimeOffset%28%29/near/153893058" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/System.2EFormatException.20FhirDateTime.20--.3E.20ToDateTimeOffset().html#153893058">(Jun 09 2017 at 04:18)</a>:</h4>
<p>There are extension methods in Hl7.Fhir.Support that go from the C# format to the fhirDate classes.<br>
<a href="https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.Fhir.Core/Support/DateExtensions.cs#L17" target="_blank" title="https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.Fhir.Core/Support/DateExtensions.cs#L17">https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.Fhir.Core/Support/DateExtensions.cs#L17</a><br>
Can highly recommend using these going from internal models to FHIR models.</p>



<a name="153893060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/System.FormatException%20FhirDateTime%20--%3E%20ToDateTimeOffset%28%29/near/153893060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/System.2EFormatException.20FhirDateTime.20--.3E.20ToDateTimeOffset().html#153893060">(Jun 09 2017 at 04:20)</a>:</h4>
<p>While I'm talking about the handy extras, theres one for Guid too.<br>
<a href="https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.Fhir.Core/Support/GuidExtensions.cs#L17" target="_blank" title="https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.Fhir.Core/Support/GuidExtensions.cs#L17">https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.Fhir.Core/Support/GuidExtensions.cs#L17</a></p>
<div class="codehilite"><pre><span></span>string id = Guid.NewGuid().ToFhirId(); // much cleaner and consistent format
</pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
