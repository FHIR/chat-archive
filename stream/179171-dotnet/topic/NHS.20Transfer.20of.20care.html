---
layout: page
title: "FHIR Chat  · NHS Transfer of care · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html">NHS Transfer of care</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="154011396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154011396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154011396">(Oct 23 2018 at 13:14)</a>:</h4>
<p>Marc Riding   <br>
12:01 PM</p>
<p></p>
<p> </p>
<p>--- Moved from &lt;Implementers&gt;</p>
<p>Hi Guys,</p>
<p>I am really struggling here, any tutorials on using the hl7.fhir .net libs would be greatly appreciated.</p>
<p>Like I said, I am trying to construct something like <a href="https://nhsconnect.github.io/ITK-FHIR-Mental-Health-eDischarge/engage_jon_burrows.html" target="_blank" title="https://nhsconnect.github.io/ITK-FHIR-Mental-Health-eDischarge/engage_jon_burrows.html">https://nhsconnect.github.io/ITK-FHIR-Mental-Health-eDischarge/engage_jon_burrows.html</a> </p>
<p>Just really confusing how to go about constructing this xml. Am really disappointed the nhs has just dropped us off at the deep end. Is anyone else going through the same thing ?<br>
Ewout Kramer: Hi @Marc Riding, here is a link to the docs for the C# FHIR API: <a href="http://docs.simplifier.net/fhirnetapi/index.html" target="_blank" title="http://docs.simplifier.net/fhirnetapi/index.html">http://docs.simplifier.net/fhirnetapi/index.html</a></p>
<hr>
<p>Martijn Harthoorn: Hi Marc, You probably need something like this:</p>
<p>var eoc = new EpisodeOfCare();<br>
 // add fields / data to the resource</p>
<p>var bundle = new Bundle();<br>
 bundle.Entry.Add(new Bundle.EntryComponent { Resource = eoc });</p>
<hr>
<p>Ewout Kramer: If you have more questions on how to use it, join us at the #net stream.</p>
<hr>
<p>Thanks for the help guys, really appreciate it, I will plod on using trial and error for now, I am making some progress, but very slow. Reminds me of when I first learnt to program, that sort of pace!</p>
<p>Thanks again</p>



<a name="154011397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154011397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154011397">(Oct 23 2018 at 13:30)</a>:</h4>
<p>I have got the following code working:</p>
<div class="codehilite"><pre><span></span>    &#39;&#39; Create patient resource object.
    Dim myPat As Hl7.Fhir.Model.Patient
    myPat = New Hl7.Fhir.Model.Patient()
    myPat.BirthDate = &quot;31/01/2001&quot;

    &#39;&#39; Create Name resource object.
    Dim myHumanName = New HumanName()
    myHumanName.Given = New String() {&quot;Marc&quot;}
    myHumanName.Family = &quot;Riding&quot;
    myHumanName.Prefix = New String() {&quot;Mr&quot;}

    &#39;&#39; Create Address resource object.
    Dim myAddr = New Address
    myAddr.Text = &quot;addrText1&quot;

    &#39;&#39; Add name &amp; addr to patient object
    myPat.Name.Add(myHumanName)
    myPat.Address.Add(myAddr)

    &#39;&#39; Create bundle object, add pat to bundle.
    Dim myBundle As New Bundle()
    myBundle.AddResourceEntry(myPat, &quot;url0001&quot;)

    &#39;&#39; Dim myAdmitSection As New Composition.SectionComponent
    &#39;&#39; myAdmitSection.Title = &quot;Admission Details&quot;

    &#39;&#39; Dim myComposition As New Composition
    &#39;&#39; myComposition.Section.Add(myAdmitSection)

    &#39;&#39; myBundle.AddResourceEntry(myComposition)

    &#39;&#39; Serialize bundle to xml.
    Dim serializer As New FhirXmlSerializer()
    Dim rawxml = New FhirXmlSerializer().SerializeToString(myBundle)

    TextBox1.Text = rawxml
</pre></div>


<p>... This is producing the following XML:<br>
&lt;Bundle xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
    &lt;entry&gt;<br>
        &lt;fullUrl value="url0001" /&gt;<br>
        &lt;resource&gt;<br>
            &lt;Patient&gt;<br>
                &lt;name&gt;<br>
                    &lt;family value="Riding" /&gt;<br>
                    &lt;given value="Marc" /&gt;<br>
                    &lt;prefix value="Mr" /&gt;<br>
                &lt;/name&gt;<br>
                &lt;birthDate value="31/01/2001" /&gt;<br>
                &lt;address&gt;<br>
                    &lt;text value="addrText1" /&gt;<br>
                &lt;/address&gt;<br>
            &lt;/Patient&gt;<br>
        &lt;/resource&gt;<br>
    &lt;/entry&gt;<br>
&lt;/Bundle&gt;</p>
<p>So I am making some progress, any hints on how to create the Composition and the slice("Admission Details") ? - the section I have that's commented is not working.</p>
<p>Marc</p>



<a name="154011403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154011403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154011403">(Oct 23 2018 at 14:05)</a>:</h4>
<div class="codehilite"><pre><span></span>Dim composition  = new Hl7.Fhir.Model.Composition()
&#39;&#39; assign composition properties
&#39;&#39; add section
Dim adSection = new Hl7.Fhir.Model.Composition.SectionComponent()
adSection.Title = &quot;Admission Details&quot;
&#39;&#39;  add other section properties
&#39;&#39; add adSection to composition
composition.Section.Add(adSection )
</pre></div>



<a name="154011405"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154011405" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154011405">(Oct 23 2018 at 14:17)</a>:</h4>
<p>Hi Yunwei, </p>
<p>thanks for the reply buddy, do you know hew to add the composition to the Bundle ?</p>



<a name="154011410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154011410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154011410">(Oct 23 2018 at 14:38)</a>:</h4>
<p>The same as you added patient. Add composition as a resource entry to bundle</p>
<div class="codehilite"><pre><span></span>myBundle.addResourceEntry(composition, null)
</pre></div>



<a name="154011424"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154011424" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154011424">(Oct 23 2018 at 14:58)</a>:</h4>
<p>Thanks again Yunwei, I was missing the URL param, thought I was getting a type error.</p>



<a name="154012338"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154012338" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154012338">(Oct 26 2018 at 09:42)</a>:</h4>
<p>Hi guys,</p>
<p>Making good progress with things, got most of the eDischarge sections created and added to the bundle.</p>
<p>Wonder if anyone can advise me on creating a custom (NHS) resource/profile. </p>
<p>Below is what the example xml should come out like , so should I just construct it by hand using xml literals in .net ? or is there a more programmatical method to create these careConnect/NHS-specific entries ?</p>
<div class="codehilite"><pre><span></span>&lt;entry&gt;
    &lt;fullUrl value=&quot;urn:uuid:f8deaa1e-62ac-41cb-a475-9df3ea737a8e&quot;/&gt;
    &lt;resource&gt;
        &lt;AllergyIntolerance&gt;
            &lt;id value=&quot;f8deaa1e-62ac-41cb-a475-9df3ea737a8e&quot;/&gt;
            &lt;meta&gt;
                &lt;profile value=&quot;https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-AllergyIntolerance-1&quot;/&gt;
            &lt;/meta&gt;
            &lt;identifier&gt;
                &lt;system value=&quot;https://tools.ietf.org/html/rfc4122&quot;/&gt;
                &lt;value value=&quot;17faf6c5-2897-458d-9893-3428c755fffb&quot;/&gt;
            &lt;/identifier&gt;
            &lt;clinicalStatus value=&quot;active&quot;/&gt;
            &lt;verificationStatus value=&quot;confirmed&quot;/&gt;
            &lt;category value=&quot;food&quot;/&gt;
            &lt;code&gt;
                &lt;coding&gt;
                    &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;
                    &lt;code value=&quot;256349002&quot;/&gt;
                    &lt;display value=&quot;Peanut - dietary&quot;/&gt;
                &lt;/coding&gt;
            &lt;/code&gt;
            &lt;patient&gt;
                &lt;reference value=&quot;urn:uuid:f919dedc-3c62-462f-a171-8d86c5aaa074&quot;/&gt;
            &lt;/patient&gt;
            &lt;assertedDate value=&quot;2015-03-13&quot;/&gt;
            &lt;reaction&gt;
                &lt;manifestation&gt;
                    &lt;coding&gt;
                        &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;
                        &lt;code value=&quot;247472004&quot;/&gt;
                        &lt;display value=&quot;Weal&quot;/&gt;
                    &lt;/coding&gt;
                &lt;/manifestation&gt;
            &lt;/reaction&gt;
        &lt;/AllergyIntolerance&gt;
    &lt;/resource&gt;
&lt;/entry&gt;
</pre></div>



<a name="154012339"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154012339" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154012339">(Oct 26 2018 at 09:49)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="196741">@Marc Riding</span>, you can easily create resource instances programmatically using the PoCo classes from the Hl7.Fhir.Core library, for example:</p>
<div class="codehilite"><pre><span></span>var at = new Hl7.Fhir.Model.AllergyIntolerance()
{
   Id = &quot;1&quot;,
   Identifier = new List&lt;Identifier&gt;()
   {
      new Identifier(&quot;http://example.org/fhir/mysystem&quot;, &quot;abc123&quot;)
   },
   // ...
};
</pre></div>



<a name="154017955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154017955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154017955">(Nov 13 2018 at 12:22)</a>:</h4>
<p>Hi all,</p>
<p>I am now creating these fhir resources, and have created the ones which have ready-made PoCo's from hl7.fhir.core  (thanks Michel).</p>
<p>But for instance I would like to create a resource of profile type:  <a href="https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-MedicationStatement-1" target="_blank" title="https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-MedicationStatement-1">https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-MedicationStatement-1</a> </p>
<p>This uses <a href="http://hl7.org/fhir/StructureDefinition/MedicationStatement" target="_blank" title="http://hl7.org/fhir/StructureDefinition/MedicationStatement">http://hl7.org/fhir/StructureDefinition/MedicationStatement</a> as the constrained type (this is like a base/superclass I assume ?)</p>
<p>So I am able to create the Hl7.Fhir.Model.MedicationStatement PoCo, but how do I create the care-connect version of the medication statement resource ? </p>
<p>Marc</p>



<a name="154017993"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154017993" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154017993">(Nov 13 2018 at 13:46)</a>:</h4>
<p>You create a Hl7.Fhir.Model.MedictionStatement object filling it based on the profile rules: do not populate elements that are removed in the profile (like basedOn it seems), always fill all required elements etc.</p>



<a name="154018011"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018011" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018011">(Nov 13 2018 at 14:11)</a>:</h4>
<p>Thanks  Michele,</p>
<p>That is what I was doing, but what about for elements that are in the custom profile, but NOT in the standard model ? - the one I need to create is the "medicationReference" element (it is 1..1 on the profile). Obviously there is no PoCo field or method/function for this element.</p>
<p>Marc</p>



<a name="154018015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018015">(Nov 13 2018 at 14:27)</a>:</h4>
<p>A profile cannot add new elements to a resource (except as extensions)</p>



<a name="154018016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018016">(Nov 13 2018 at 14:28)</a>:</h4>
<p><code>medicationReference</code> is part of MedicationStatament and it is in the class - look for MedicationElement</p>



<a name="154018017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018017">(Nov 13 2018 at 14:29)</a>:</h4>
<p>you have to set it to a ResourceReference so it is rendered as medicationReference</p>



<a name="154018020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018020">(Nov 13 2018 at 14:31)</a>:</h4>
<p>sorry - Medication not MedicationElement</p>



<a name="154018330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018330">(Nov 14 2018 at 09:50)</a>:</h4>
<p>Thanks again Michele,</p>
<p>I am still having trouble with the example above. I cannot work out how to use the .net code to add a medication reference to a medication statement. Tbh I can't even seem do this in the standard model, let alone our custom nhs profile.</p>
<p>Also, when googling for custom fhir resources I came across this forums where <span class="user-mention" data-user-id="191328">@Ewout Kramer</span>  mentions about using profiles-resources.xml file to add custom resources to the .net/poco library. Is this an option ?</p>
<p>Edit - sorry, might be useful if I actually post the link to the forum ;)<br>
<a href="https://github.com/ewoutkramer/fhir-net-api/issues/337" target="_blank" title="https://github.com/ewoutkramer/fhir-net-api/issues/337">https://github.com/ewoutkramer/fhir-net-api/issues/337</a></p>



<a name="154018435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018435">(Nov 14 2018 at 14:39)</a>:</h4>
<p><span class="user-mention" data-user-id="196741">@Marc Riding</span> If you send me the details of what you are attempting to do then I'll write you some example code to achieve it. PM me the the details</p>



<a name="154018523"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018523" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018523">(Nov 14 2018 at 16:31)</a>:</h4>
<p>To set the medication reference: <code>new Hl7.Fhir.Model.MedicationStatement { Medication = new Hl7.Fhir.Model.ResourceReference( "Medication/the-id") . . . }</code></p>



<a name="154018524"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154018524" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154018524">(Nov 14 2018 at 16:32)</a>:</h4>
<p>Don't think trying to re-generate the library with profiles would be the way to go - everything you need is in the standard library</p>



<a name="154019408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154019408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154019408">(Nov 18 2018 at 13:07)</a>:</h4>
<p>MedicationReference is in the standard resource profile. If it's help examples are on the demo CCRI server. This example has the TOC document broken down into sections and then resources within the section <a href="https://data.developer.nhs.uk/ccri/ed/patient/1172/document/8" target="_blank" title="https://data.developer.nhs.uk/ccri/ed/patient/1172/document/8">https://data.developer.nhs.uk/ccri/ed/patient/1172/document/8</a> <br>
This is based on the documentviewer which NHS TOC should have told you about.</p>



<a name="154019536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/NHS%20Transfer%20of%20care/near/154019536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc Riding <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/NHS.20Transfer.20of.20care.html#154019536">(Nov 19 2018 at 11:46)</a>:</h4>
<p>Thanks for all the help guys, </p>
<p>I managed to get the medication list and references created. They wouldn't serialize once I got them into the composition &amp; bundle, but luckily enough for now we are relieved of creating these resources as our medications are not snomed-encoded - We are leaving the medications as xhtml at the section level for now.</p>
<p>Marc</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
