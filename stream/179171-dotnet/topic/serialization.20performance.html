---
layout: page
title: "FHIR Chat  · serialization performance · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html">serialization performance</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="179487610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179487610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179487610">(Oct 30 2019 at 23:25)</a>:</h4>
<p>I am doing some performance testing and it takes 2 / 3 msec to serialize a 13 KB bundle containing 3 patients - that seems pretty slow. Is this  the expected performance? Or maybe I am doing something wrong...</p>



<a name="179487999"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179487999" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179487999">(Oct 30 2019 at 23:30)</a>:</h4>
<p>The string or stream serializer?</p>



<a name="179488073"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179488073" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179488073">(Oct 30 2019 at 23:32)</a>:</h4>
<p>In my server I've gone to the stream serializer to reduce string allocations and garbage collection.</p>



<a name="179488083"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179488083" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179488083">(Oct 30 2019 at 23:32)</a>:</h4>
<p>On a single instance not so significant, but for a server it all adds up.</p>



<a name="179530110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179530110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179530110">(Oct 31 2019 at 13:20)</a>:</h4>
<p>Are you serializing from a POCO or an ITypedElement?</p>



<a name="179533160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179533160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179533160">(Oct 31 2019 at 13:57)</a>:</h4>
<p>Serializing from a POCO to string</p>



<a name="179533298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179533298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179533298">(Oct 31 2019 at 13:59)</a>:</h4>
<div class="codehilite"><pre><span></span>            var xml = File.ReadAllText(@&quot;c:\temp\bundle.xml&quot;);

            var xmlParser = new FhirSerialization.FhirXmlParser(FhirModel.Version.DSTU2);
            var bundle = xmlParser.Parse&lt;FhirModel2.Bundle&gt;(xml);
            var watch = Stopwatch.StartNew();
            bundle = xmlParser.Parse&lt;FhirModel2.Bundle&gt;(xml);
            watch.Stop();
            Console.WriteLine(&quot;Parse: {0}ms&quot;, watch.ElapsedMilliseconds);

            var xmlSerializer = new FhirSerialization.FhirXmlSerializer(FhirModel.Version.DSTU2);
            var bundleXml = xmlSerializer.SerializeToString(bundle);
            watch.Restart();
            const int count = 10;
            for (var i=0; i&lt;count; i++)
            {
                xmlSerializer = new FhirSerialization.FhirXmlSerializer(FhirModel.Version.DSTU2);
                bundleXml = xmlSerializer.SerializeToString(bundle);
            }
            watch.Stop();
            Console.WriteLine(&quot;Serialize x {1}: {0}ms&quot;, watch.ElapsedMilliseconds, count);
</pre></div>



<a name="179570757"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179570757" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179570757">(Oct 31 2019 at 20:04)</a>:</h4>
<p>Also assuming this is not the first time when it leads in all the reflection stuff?<br>
The first one is always considerably longer.<br>
Looking at the code I think it's outside your timer.</p>



<a name="179574725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179574725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179574725">(Oct 31 2019 at 20:45)</a>:</h4>
<p>Not the first one - first one takes multiple seconds</p>



<a name="179578014"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179578014" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179578014">(Oct 31 2019 at 21:21)</a>:</h4>
<p>3 msec to serialize 13 KB is not thumbs up...</p>



<a name="179616971"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179616971" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179616971">(Nov 01 2019 at 11:14)</a>:</h4>
<p>I agree with that for sure. Was confirming what you're seeing.</p>



<a name="179626995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/179626995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#179626995">(Nov 01 2019 at 13:47)</a>:</h4>
<p>Thanks Brian - I wanted confirmation that was not something specific to our fork of the library</p>



<a name="180200200"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/180200200" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#180200200">(Nov 08 2019 at 03:46)</a>:</h4>
<p>I did an experiment of writing a trivial serializer for a bundle of patients to get a baseline speed:</p>
<div class="codehilite"><pre><span></span>Serialize X 1,000: 3,275.0ms
New serialize X 1,000: 123.0ms
</pre></div>



<a name="180200313"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/180200313" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#180200313">(Nov 08 2019 at 03:49)</a>:</h4>
<p>Code is something like this:</p>
<div class="codehilite"><pre><span></span>        public void Serialize(JsonWriter writer)
        {
            writer.WriteStartObject();
            writer.WritePropertyName(&quot;resourceType&quot;); writer.WriteValue(&quot;Bundle&quot;);
            writer.WritePropertyName(&quot;type&quot;); writer.WriteValue(TypeElement.ObjectValue);
            writer.WritePropertyName(&quot;total&quot;); writer.WriteValue(TotalElement.ObjectValue);
            writer.WritePropertyName(&quot;link&quot;);
            writer.WriteStartArray();
            foreach(var link in Link)
            {
                link.Serialize(writer);
            }
            writer.WriteEndArray();
            writer.WritePropertyName(&quot;entry&quot;);
            writer.WriteStartArray();
            foreach (var entry in Entry)
            {
                entry.Serialize(writer);
            }
            writer.WriteEndArray();
            writer.WriteEndObject();
        }
</pre></div>


<p>and so on down for the various classes</p>



<a name="180237685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/180237685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#180237685">(Nov 08 2019 at 15:07)</a>:</h4>
<p><a href="https://github.com/CareEvolution/fhir-net-api/compare/multiversions...CareEvolution:serializationexperiment" target="_blank" title="https://github.com/CareEvolution/fhir-net-api/compare/multiversions...CareEvolution:serializationexperiment">https://github.com/CareEvolution/fhir-net-api/compare/multiversions...CareEvolution:serializationexperiment</a></p>



<a name="180241444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/180241444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> VP Herisse <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#180241444">(Nov 08 2019 at 15:45)</a>:</h4>
<p>That seems better :)</p>



<a name="180380225"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/180380225" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#180380225">(Nov 10 2019 at 20:37)</a>:</h4>
<p>I did a similar experiment with the xmlwriter a while ago too.</p>



<a name="180380266"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/180380266" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#180380266">(Nov 10 2019 at 20:38)</a>:</h4>
<p>Have been considering doing a code generated version of these as a separate assembly too, providing extension methods.</p>



<a name="180380287"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/180380287" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#180380287">(Nov 10 2019 at 20:39)</a>:</h4>
<p>What you're missing is all the extensions processing too, but that's  not going to break anything in terms of raw speed.</p>



<a name="180380330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/180380330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#180380330">(Nov 10 2019 at 20:40)</a>:</h4>
<p>And while we're here, could do it with the new netcore 30 json handling.</p>



<a name="181733563"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/181733563" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#181733563">(Nov 23 2019 at 22:16)</a>:</h4>
<p>I implemented complete JSON and XML fast serialization: <a href="https://github.com/CareEvolution/fhir-net-api/pull/1" target="_blank" title="https://github.com/CareEvolution/fhir-net-api/pull/1">https://github.com/CareEvolution/fhir-net-api/pull/1</a></p>



<a name="188723548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/188723548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#188723548">(Feb 21 2020 at 11:30)</a>:</h4>
<p>Mind if I grabbed this to have an alternative serializers for the core packages?</p>



<a name="188775027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/serialization%20performance/near/188775027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/serialization.20performance.html#188775027">(Feb 21 2020 at 21:13)</a>:</h4>
<p>Not at all</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
