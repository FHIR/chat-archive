---
layout: page
title: "FHIR Chat  · Fhir Path Additional function &#x27;resolve()` · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Fhir.20Path.20Additional.20function.20&#x27;resolve().60.html">Fhir Path Additional function &#x27;resolve()`</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153997900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Fhir%20Path%20Additional%20function%20%27resolve%28%29%60/near/153997900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Fhir.20Path.20Additional.20function.20&#x27;resolve().60.html#153997900">(Sep 19 2018 at 01:48)</a>:</h4>
<p>Hi Guys, I seem to find that the FHIR Path function named <code>resolve()</code> does not work or is not supported with the .NET FHIR Path implementation (STU3 or the develop-r4). <br>
If I do use a path with it I get an exception and the following message <code>Unknown symbol 'resolve'</code>. In FHIR R4 there is a search parameter for the AuditEvent Resource that now uses this resolve() method, like this: <code>AuditEvent.agent.who.where(resolve() is Patient)</code>.<br>
Only looking to bring this to peoples attention and wondering should I add it as a GitHub issue?<br>
On a side note, I really don't understand how resolve() should work. It appears that when used the FHIR path implementation is somehow intended to retrieve the target, no idea how they can happen?</p>



<a name="153997931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Fhir%20Path%20Additional%20function%20%27resolve%28%29%60/near/153997931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Fhir.20Path.20Additional.20function.20&#x27;resolve().60.html#153997931">(Sep 19 2018 at 02:35)</a>:</h4>
<p>This is going to be fun.</p>



<a name="153997932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Fhir%20Path%20Additional%20function%20%27resolve%28%29%60/near/153997932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Fhir.20Path.20Additional.20function.20&#x27;resolve().60.html#153997932">(Sep 19 2018 at 02:36)</a>:</h4>
<p>Yes, resolve is expected to reach out and load that resource into the scope of the navigator.</p>



<a name="153997933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Fhir%20Path%20Additional%20function%20%27resolve%28%29%60/near/153997933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Fhir.20Path.20Additional.20function.20&#x27;resolve().60.html#153997933">(Sep 19 2018 at 02:52)</a>:</h4>
<p>Oh yes Angus, you can implement the resolve function yourself and add it to the fhirpath symbol table.<br>
Just like I've done for other custom functions in the fhirpath tester.<br>
(and hope that you've registered the fhir extended functions already)<br>
<a href="https://github.com/brianpos/FhirPathTester/blob/master/UWP/CustomFluentPathFunctions.cs#L30" target="_blank" title="https://github.com/brianpos/FhirPathTester/blob/master/UWP/CustomFluentPathFunctions.cs#L30">https://github.com/brianpos/FhirPathTester/blob/master/UWP/CustomFluentPathFunctions.cs#L30</a></p>



<a name="153998024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Fhir%20Path%20Additional%20function%20%27resolve%28%29%60/near/153998024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Fhir.20Path.20Additional.20function.20&#x27;resolve().60.html#153998024">(Sep 19 2018 at 08:37)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191391">@Angus Millar</span>, the Hl7.Fhir.Core library provides implementations for some custom FhirPath functions, including "resolve":<br>
<a href="https://github.com/ewoutkramer/fhir-net-api/blob/develop/src/Hl7.Fhir.Core/FhirPath/ElementNavFhirExtensions.cs#L100" target="_blank" title="https://github.com/ewoutkramer/fhir-net-api/blob/develop/src/Hl7.Fhir.Core/FhirPath/ElementNavFhirExtensions.cs#L100">https://github.com/ewoutkramer/fhir-net-api/blob/develop/src/Hl7.Fhir.Core/FhirPath/ElementNavFhirExtensions.cs#L100</a><br>
Call the static method to initialize FhirPath engine with custom functions:</p>
<div class="codehilite"><pre><span></span>Hl7.FhirPath.FhirPathCompiler.DefaultSymbolTable.AddFhirExtensions();
</pre></div>



<a name="154000926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Fhir%20Path%20Additional%20function%20%27resolve%28%29%60/near/154000926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Fhir.20Path.20Additional.20function.20&#x27;resolve().60.html#154000926">(Sep 28 2018 at 04:43)</a>:</h4>
<p>Thanks, <span class="user-mention" data-user-id="191336">@Michel Rutten</span> this was the gem I needed. It still took a bit of investigation to work out what to do but I feel I now have it working. For others that might be stuck here, I will share what I found.</p>
<div class="codehilite"><pre><span></span>            //Add in the extended FhirPath functions from the fhir.net API as pointed out by Michel in the link above, in the namespace: Hl7.Fhir.FhirPath
            //Below adds this extended support, it supports some FHIR Path functions (hasValue, resolve, htmlchecks), of which resolve is what I needed.
            Hl7.FhirPath.FhirPathCompiler.DefaultSymbolTable.AddFhirExtensions();
            var oFhirEvaluationContext = new Hl7.Fhir.FhirPath.FhirEvaluationContext(Navigator);
            //The resolve() function then also needs to be provided an external resolver delegate that performs the resolve
            //that delegate can be set as below. Here I am providing my own implementation &#39;IPyroFhirPathResolve.Resolver&#39;
            oFhirEvaluationContext.Resolver = IPyroFhirPathResolve.Resolver;
            IEnumerable&lt;IElementNavigator&gt; ResultList = Navigator.Select(Expression, oFhirEvaluationContext);
            foreach (IElementNavigator oElement in ResultList)
            {
              //process what is found by that FHIR path Expression, if any
            }
</pre></div>


<p>My 'Resolver' implementation is simpler than what the full fhir path resolve() requires as I only need to source resource reference urls when the target is a specified resource type, for example, this type of FHIRPath expression <code>AuditEvent.entity.what.where(resolve() is Patient)</code>, which are now found all though R4 search parameter definitions. To do this I have a 'PyroRequestUri' implementation that parses FHIR references and takes into account, among other things,  the server known base URL. So that implementation can work out the target Resource type in any reference, such as <code>https://stu3.test.pyrohealth.net/fhir/Patient/12345</code> or <code>Patient/12345</code> or even <code>http://someserver.com/over/here/Patient/12345</code> where the target in these examples is Patient.<br>
So my Resolver does this and then returns a <code>Hl7.Fhir.ElementModel.IElementNavigator</code> of which I have a concrete implementation called <code>PyroElementNavigator</code>. The important property to set is the <code>Type</code> property to the found Resource name "Patient" in the examples.<br>
This now seems to be working as required for collecting search indexes from resources based on the resolve() function. And I do not take the hit of needing to actually lookup and resolve the reference to an actual resource at an endpoint. Of course in other use cases of resolve() in FHIR path this would not do, another implementation would be required, yet for server resource indexing it seems fine.</p>
<p>Hope this might help someone. Please point out any issues you might see with it.</p>
<div class="codehilite"><pre><span></span>public Hl7.Fhir.ElementModel.IElementNavigator Resolver(string url)
    {
      PyroElementNavigator PyroElementNavigator = new PyroElementNavigator();
      var PyroRequestUri = IPyroRequestUriFactory.CreateFhirRequestUri();
      if (PyroRequestUri.FhirRequestUri.Parse(url))
      {
        PyroElementNavigator.Name = PyroRequestUri.FhirRequestUri.ResourseName;
        //This type property is the key property to set for resolve() as it needs to match the comparison
        //for example &#39;AuditEvent.agent.who.where(resolve() is Patient)&#39; Patient is Patient
        PyroElementNavigator.Type = PyroRequestUri.FhirRequestUri.ResourseName;
        PyroElementNavigator.Value = PyroRequestUri.FhirRequestUri.ResourseName;
        PyroElementNavigator.Location = url;
        return PyroElementNavigator;
      }
      else
      {
        return null;
      }
    }
</pre></div>



<a name="154001459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Fhir%20Path%20Additional%20function%20%27resolve%28%29%60/near/154001459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Fhir.20Path.20Additional.20function.20&#x27;resolve().60.html#154001459">(Sep 29 2018 at 13:54)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191391">@Angus Millar</span>, thank you for sharing your code! Solid demonstration of how to inject custom functionality into the FhirPath engine, and why we need this.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
