---
layout: page
title: "FHIR Chat  · Develop FHIR API with MVC Web API and Hl7.Fhir.STU3 package · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html">Develop FHIR API with MVC Web API and Hl7.Fhir.STU3 package</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="163100646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163100646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannah <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163100646">(Apr 11 2019 at 13:48)</a>:</h4>
<p>Hi,</p>
<p>I am new to FHIR and I am trying to developing my own FHIR API (server side) with MVC Web API and Hl7.Fhir.STU3 package. I got some problem when posting FHIR object with JSON format from client (using Postman) to my API. The following is what I've done to create the API.</p>
<p>(1) created a ASP.NET MVC Web API project in visual studio<br>
(2) installed Hl7.Fhir.STU3 package by typing "Install-Package Hl7.Fhir.STU3 -Version 1.2.0" in the package manager console<br>
(3) created a ApiController called "PatientController.cs" and created a post method in it (see below code):<br>
using Hl7.Fhir.Model;<br>
using System.Web.Http;<br>
namespace FHIR.API.Controllers<br>
{<br>
public class PatientController : ApiController<br>
{<br>
// POST api/values<br>
public void Post(Hl7.Fhir.Model.Patient patientObj)<br>
{<br>
string dateOfBirth = patientObj.BirthDate;<br>
}<br>
}<br>
}<br>
(4) To test this API, in postman, send a http post request to my FHIR API with a sample "Patient" FHIR JSON object (The "Patient" FHIR object is copied from FHIR website)<br>
(5) Debug the API PatientController "Post" Method, all properties in "patientObj" is null. It seems that the "Patient" FHIR object sent from Postman is not mapped into the API Hl7.Fhir.Model.Patient object.</p>
<p>Could you please advise if I am doing anything wrong when using Hl7.Fhir.STU3 package to develop my own FHIR API server? I am using vs 2013 and .net 4.5.</p>
<p><strong><strong><em><strong><em><strong><em><strong><em><strong><em><strong><em><strong><em><strong><em><strong><em><strong><em>Sample Patient FHIR Object</em></strong></em></strong></em></strong></em></strong></em></strong></em></strong></em></strong></em></strong></em></strong></em></strong></strong>*<br>
{<br>
"resourceType": "Patient",<br>
"id": "xcda",<br>
"identifier": [<br>
{<br>
"use": "usual",<br>
"type": {<br>
"coding": [<br>
{<br>
"system": "<a href="http://terminology.hl7.org/CodeSystem/v2-0203" target="_blank" title="http://terminology.hl7.org/CodeSystem/v2-0203">http://terminology.hl7.org/CodeSystem/v2-0203</a>",<br>
"code": "MR"<br>
}<br>
]<br>
},<br>
"system": "urn:oid:2.16.840.1.113883.19.5",<br>
"value": "12345"<br>
}<br>
],<br>
"active": true,<br>
"name": [<br>
{<br>
"family": "Levin",<br>
"given": [<br>
"Henry"<br>
]<br>
}<br>
],<br>
"gender": "male",<br>
"birthDate": "1932-09-24",<br>
"managingOrganization": {<br>
"reference": "Organization/2.16.840.1.113883.19.5",<br>
"display": "Good Health Clinic"<br>
}<br>
}<br>
<strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong><strong>*</strong></p>
<p>Thanks a lot.</p>
<p>Hannah</p>



<a name="163118825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163118825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kenneth Myhra <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163118825">(Apr 11 2019 at 17:12)</a>:</h4>
<p>There is not a 1-1 mapping between the POCO representation in the fhir-net-api and the representation in XML/JSON. You need to do some parsing in your request pipeline.</p>



<a name="163128588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163128588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannah <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163128588">(Apr 11 2019 at 19:09)</a>:</h4>
<p>Ok I see. Thank you for the information, Kenneth. </p>
<p>Actually I see the source cod specifically marked the properties defined in FHIR spec to be not mapped, please see below code from "Hl7.Fhir.Model" in the package. <br>
For example, the property "BirthDate" of Patient FHIR object  is decorated with two attributes "IgnoreDataMemberAttribute" and "NotMapped",  however, the property "BirthDateElement" is marked as DataMember to be serialized. Not sure why it's designed as this and if there is an easy way for us to turn it off or we have to customize the source code to remove those two attributes?</p>
<p>/// &lt;summary&gt;<br>
        /// The date of birth for the individual<br>
        /// &lt;/summary&gt;<br>
        [FhirElement("birthDate", InSummary=true, Order=140)]<br>
        [DataMember]<br>
        public Hl7.Fhir.Model.Date BirthDateElement<br>
        {<br>
            get { return _BirthDateElement; }<br>
            set { _BirthDateElement = value; OnPropertyChanged("BirthDateElement"); }<br>
        }</p>
<div class="codehilite"><pre><span></span>    private Hl7.Fhir.Model.Date _BirthDateElement;

    /// &amp;lt;summary&amp;gt;
    /// The date of birth for the individual
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;remarks&amp;gt;This uses the native .NET datatype, rather than the FHIR equivalent&amp;lt;/remarks&amp;gt;
    [NotMapped]
    [IgnoreDataMemberAttribute]
    public string BirthDate
    {
        get { return BirthDateElement != null ? BirthDateElement.Value : null; }
        set
        {
            if (value == null)
              BirthDateElement = null; 
            else
              BirthDateElement = new Hl7.Fhir.Model.Date(value);
            OnPropertyChanged(&quot;BirthDate&quot;);
        }
    }
</pre></div>



<a name="163140452"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163140452" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163140452">(Apr 11 2019 at 21:55)</a>:</h4>
<p>Add a media formatter and using XmlSerializer/JsonSerializer in the FHIR nuget package serialize the inbound xml/json steam  to FHIR instance. The same for outbound messages.</p>



<a name="163141027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163141027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163141027">(Apr 11 2019 at 22:03)</a>:</h4>
<p>Because FHIR resource classes are generated from FHIR xml  schema. All data types in FHIR are inherited from Element type. FHIR .NET package wraps around Element type to simplify developer's work. In your example, BirthDate in FHIR xml schema is Date type which inherited from Element. So the genereated class has public Date BirthDateElement property. Most c# developers use either string or .NET DateTime type for date/dateTime. To simplify that, the code generator also creates public string BrithDate wrapping around BirthDateElement property. But when serialized to xml/json stream, only the BirthDateElement is serialized/deserialized since the Date property is what specified in the standard, not the string property.</p>



<a name="163168221"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163168221" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163168221">(Apr 12 2019 at 08:01)</a>:</h4>
<p>There is a project on github that provides an implementation of the facade you can use.<br>
<a href="https://github.com/brianpos/fhir-net-web-api" target="_blank" title="https://github.com/brianpos/fhir-net-web-api">https://github.com/brianpos/fhir-net-web-api</a><br>
Theres an example project in there to show how to use it.<br>
Comes in either full net framework or aspnet core.</p>



<a name="163168362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163168362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163168362">(Apr 12 2019 at 08:03)</a>:</h4>
<p>That handles all the controller and formatting stuff for you, and you implement the storage logic.</p>



<a name="163168382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163168382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163168382">(Apr 12 2019 at 08:03)</a>:</h4>
<p>(all the stuff that Yunwei mentions)</p>



<a name="163168579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163168579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163168579">(Apr 12 2019 at 08:07)</a>:</h4>
<p>I'm planning to push it as a NuGet package, but not there just yet.</p>



<a name="163202759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Develop%20FHIR%20API%20with%20MVC%20Web%20API%20and%20Hl7.Fhir.STU3%20package/near/163202759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hannah <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Develop.20FHIR.20API.20with.20MVC.20Web.20API.20and.20Hl7.2EFhir.2ESTU3.20package.html#163202759">(Apr 12 2019 at 15:54)</a>:</h4>
<p>Hi Brian and Yunwei,</p>
<p>Thanks a lot for the explanation, I will try that. much appreciated.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
