---
layout: page
title: "FHIR Chat  · HttpClient based FhirClient · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html">HttpClient based FhirClient</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="202967277"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/202967277" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#202967277">(Jul 06 2020 at 09:07)</a>:</h4>
<p>We're working on the updated FhirClient that uses HttpClient underneath, which means that the OnBeforeEvent and OnAfterEvents need to be replaced.<br>
How do others feel about code along the lines of this:</p>
<div class="codehilite"><pre><span></span><code>var handler = new AuthorizationMessageHandler();
handler.Authorization = new AuthenticationHeaderValue(&quot;Bearer&quot;, bearerToken);
var server = new HttpFhirClient(handler);
</code></pre></div>


<p>And this class could be something as simple as this:</p>
<div class="codehilite"><pre><span></span><code>public class AuthorizationMessageHandler : HttpClientHandler
{
    public System.Net.Http.Headers.AuthenticationHeaderValue Authorization { get; set; }
    protected async override Task&lt;HttpResponseMessage&gt; SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
    {
        if (Authorization != null)
            request.Headers.Authorization = Authorization;
        return await base.SendAsync(request, cancellationToken);
    }
}
</code></pre></div>



<a name="202967531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/202967531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#202967531">(Jul 06 2020 at 09:10)</a>:</h4>
<p>If you need to look at the raw response before the FHIR client processes it, you could do something similar to the above, but process the content returned from the base.SendAsync before returning from the handler</p>



<a name="203122312"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/203122312" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sandhya <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#203122312">(Jul 07 2020 at 16:01)</a>:</h4>
<p>Curious did anyone implemented USCore compatibility validation in their application. Did you use Firely Nuget package?</p>



<a name="203318659"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/203318659" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeremy Chapman <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#203318659">(Jul 08 2020 at 20:29)</a>:</h4>
<p>would it be useful to provide a default handler so it doesn't need to be implemented in all solutions, but could be if neessary?</p>



<a name="208512361"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/208512361" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#208512361">(Aug 31 2020 at 01:00)</a>:</h4>
<p>This is the super simple version, but more likely you'll want to get the auth token from somewhere, and handle when it needs to be refreshed, and when you get 401s etc.</p>



<a name="210458345"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/210458345" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#210458345">(Sep 17 2020 at 22:17)</a>:</h4>
<p>I've done a quick fake fhir client that roughly emulates the FhirClient but using the HttpClient under the hood<br>
<a href="https://www.nuget.org/packages/brianpos.Fhir.R4.httpclient">https://www.nuget.org/packages/brianpos.Fhir.R4.httpclient</a><br>
Reason I did it was in Azure function apps under high load the existing client will consume all sockets and start causing failures.<br>
In other projects I just went back to raw doing it, but thought was time to at least do some effort.<br>
May only be usefull till the v2 fhirclient comes out of alpha and into the sunlight <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="210782053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/210782053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#210782053">(Sep 21 2020 at 18:36)</a>:</h4>
<p>The 2.0 .NET API beta2 is nearly there - we're publishing it this week!</p>



<a name="210835897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/210835897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#210835897">(Sep 22 2020 at 07:32)</a>:</h4>
<p>Awesome!</p>



<a name="210835906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/210835906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#210835906">(Sep 22 2020 at 07:32)</a>:</h4>
<p>Mine was only to get over a prod hurdle.</p>



<a name="210835937"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/210835937" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#210835937">(Sep 22 2020 at 07:33)</a>:</h4>
<p>And for those who want 1.9.0 compatibility</p>



<a name="210875111"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/HttpClient%20based%20FhirClient/near/210875111" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marco Visser <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/HttpClient.20based.20FhirClient.html#210875111">(Sep 22 2020 at 14:10)</a>:</h4>
<p>The 2.0 .NET API beta2 is now released. See <a href="https://github.com/FirelyTeam/fhir-net-api/releases">https://github.com/FirelyTeam/fhir-net-api/releases</a> for source code and for the NuGet Packages: <a href="https://www.nuget.org/packages?q=hl7.fhir">https://www.nuget.org/packages?q=hl7.fhir</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
