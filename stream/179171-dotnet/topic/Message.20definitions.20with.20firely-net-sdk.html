---
layout: page
title: "FHIR Chat  · Message definitions with firely-net-sdk · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html">Message definitions with firely-net-sdk</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="229819002"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/229819002" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pash <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#229819002">(Mar 11 2021 at 09:26)</a>:</h4>
<p>Hi everyone. <br>
I need to validate the incoming message and have public message definitions to restrict resources/codes etc by event type. Please advise how to create a message definition (well, probably creation is simple - just use models from the lib but anyway) and validate incoming messages using it with firely-net-sdk?</p>



<a name="229819374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/229819374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#229819374">(Mar 11 2021 at 09:29)</a>:</h4>
<p>Defining a message structure (=profiling) isn't easy at all [if you're new to it], see <a href="http://build.fhir.org/conformance-module.html">http://build.fhir.org/conformance-module.html</a> .. creating/parsing a message is easy, as is validation, using the ,net SDK, the definition of a profile is not.</p>



<a name="229824431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/229824431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pash <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#229824431">(Mar 11 2021 at 10:09)</a>:</h4>
<p><span class="user-mention" data-user-id="191372">@René Spronk</span>  I see. So starting from the easiest: just check if the message contains 1 Patient. Assume this definition is created: <a href="https://www.codepile.net/pile/kBLDjWB9">https://www.codepile.net/pile/kBLDjWB9</a>  (in memory. By the way, please feel free to add notes there is something looks wrong), how to use it to check the message? I want to investigate how hard is to do it using the best practices and obviously dirty workaround here - validate it manually.</p>



<a name="229825425"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/229825425" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#229825425">(Mar 11 2021 at 10:17)</a>:</h4>
<p>Validation strategies can be found here: <a href="http://build.fhir.org/validation.html">http://build.fhir.org/validation.html</a> - what approach you choose depends on your requirements</p>



<a name="229831067"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/229831067" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pash <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#229831067">(Mar 11 2021 at 11:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191372">@René Spronk</span> hm, I need only validation with MessageDefinition, don't need full profile validation (not sure if it possible, but it is also my question). So just need to check if Bundle with a specific event type (in the MessageHeader) has a set of resources (and additionally validate some properties in that resources, but lets start from an easier example ) and be able to publish that profiles as contracts for third parties. Any advice on how to do it with firely-net-sdk?</p>



<a name="229831157"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/229831157" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#229831157">(Mar 11 2021 at 11:08)</a>:</h4>
<p>I'm not a .net SDK user myself, so I'll leave that to others to respond to.</p>



<a name="229831732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/229831732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pash <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#229831732">(Mar 11 2021 at 11:13)</a>:</h4>
<p><span class="user-mention" data-user-id="191372">@René Spronk</span>  np, thank you for help!</p>
<p><span class="user-mention" data-user-id="191347">@Mirjam Baltus</span>  probably you can help with my stupid question?</p>



<a name="229836632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/229836632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#229836632">(Mar 11 2021 at 11:57)</a>:</h4>
<p><span class="user-mention" data-user-id="352507">@Pash</span> Actually this is not a stupid question at all, but I also have to say that I do not know of a straightforward solution. I think you will have to code the validation by hand.<br>
The MessageHeader of the message could contain a link to the MessageDefinition. With that, I would try to see if the MessageHeader.event[x] matches the one in the definition. Or, if it is not linked, I would try to find the relevant MessageDefinition by using a lookup on the event code in the MessageHeader. After that, I would run through the focus resources in the definition to see if they are listed in the message header, plus also perhaps do a check on the Bundle to see if they're included. But again, this would all be done by coding the important parts of my checks.</p>



<a name="230592857"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/230592857" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pash <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#230592857">(Mar 16 2021 at 21:17)</a>:</h4>
<p>Trying to validate Resource using custom StructureDefinition. In MessageDefinition I have reference to custom StructureDefinition (where specified validation rules valid ONLY in the current context). How to validate resource by only 1 (and every time different) StructureDefinition? I see it is "InMemoryProfileResolver" in FHIR NET lib, but it is private. So I need to create profile resolvers and validators on a fly (not sure if it is a good solution). Any advice?</p>



<a name="230596466"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/230596466" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pash <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#230596466">(Mar 16 2021 at 21:46)</a>:</h4>
<p>Should I create my own custom IResourceResolver?</p>



<a name="231462843"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/231462843" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#231462843">(Mar 23 2021 at 12:43)</a>:</h4>
<p><span class="user-mention" data-user-id="352507">@Pash</span> You can point the validator to use a specific profile to validate against. Here's an example:</p>
<div class="codehilite" data-code-language="C#"><pre><span></span><code><span class="kt">var</span> <span class="n">source</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CachedResolver</span><span class="p">(</span><span class="k">new</span> <span class="n">MultiResolver</span><span class="p">(</span><span class="k">new</span> <span class="n">DirectorySource</span><span class="p">(</span><span class="s">@"MyProfileFolder"</span><span class="p">,</span>
                    <span class="k">new</span> <span class="nf">DirectorySourceSettings</span><span class="p">()</span> <span class="p">{</span> <span class="n">IncludeSubDirectories</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}),</span>
                    <span class="n">ZipSource</span><span class="p">.</span><span class="n">CreateValidationSource</span><span class="p">()));</span>

<span class="kt">var</span> <span class="n">ctx</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ValidationSettings</span>
<span class="p">{</span>
    <span class="n">ResourceResolver</span> <span class="p">=</span> <span class="n">source</span><span class="p">,</span>
    <span class="n">GenerateSnapshot</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
<span class="p">};</span>
<span class="kt">var</span> <span class="n">validator</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Validator</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">validator</span><span class="p">.</span><span class="n">Validate</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">@"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"</span><span class="p">);</span>
</code></pre></div>
<p>My example just validates a Patient poco against the US Core Patient profile.<br>
If you put all your custom profiles in the folder,  you can expand the last line to validate against a specific profile depending on some determining value.</p>



<a name="232447985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/232447985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeena a <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#232447985">(Mar 30 2021 at 15:44)</a>:</h4>
<p>Hi, <br>
I am using the .net firely library to validate my bundle resource and I get an error on the extenisons - {Text="Unable to resolve reference to profile 'http://XXX/patient-code'"} this is expected in my case as the extensions haven't been published yet. Is there a way to treat these as just warnings. and not error to be able to validate the bundle.</p>



<a name="232601442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Message%20definitions%20with%20firely-net-sdk/near/232601442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marten Smits <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Message.20definitions.20with.20firely-net-sdk.html#232601442">(Mar 31 2021 at 14:31)</a>:</h4>
<p>See my answer here: <a href="https://github.com/FirelyTeam/firely-net-sdk/discussions/1675">https://github.com/FirelyTeam/firely-net-sdk/discussions/1675</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
