---
layout: page
title: "FHIR Chat  · XML Serialise Error · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html">XML Serialise Error</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153864760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864760">(Dec 22 2016 at 14:35)</a>:</h4>
<p>I'm trying to serialise a resource to XML using the latest DSTU2 Nuget package. The code I am using is as follows </p>
<p>var tt = FhirSerializer.SerializeResourceToXml(_resource);</p>



<a name="153864761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864761">(Dec 22 2016 at 14:36)</a>:</h4>
<p>When the resource is an "OperationDefinition" it works fine</p>



<a name="153864763"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864763" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864763">(Dec 22 2016 at 14:37)</a>:</h4>
<p>When the resource is a "ValueSet" it throws an exception as below</p>



<a name="153864764"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864764" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864764">(Dec 22 2016 at 14:37)</a>:</h4>
<p>[XmlException: Data at the root level is invalid. Line 1, position 1.]<br>
   System.Xml.XmlTextReaderImpl.Throw(Exception e) +72<br>
   System.Xml.XmlTextReaderImpl.Throw(String res, String arg) +192<br>
   System.Xml.XmlTextReaderImpl.ParseRootLevelWhitespace() +341<br>
   System.Xml.XmlTextReaderImpl.ParseDocumentContent() +311<br>
   System.Xml.XmlTextReaderImpl.Read() +148<br>
   System.Xml.XmlReader.MoveToContent() +43<br>
   System.Xml.Linq.XElement.Load(XmlReader reader, LoadOptions options) +27<br>
   System.Xml.Linq.XElement.Parse(String text, LoadOptions options) +90<br>
   Hl7.Fhir.Serialization.XmlFhirWriter.WritePrimitiveContents(Object value, XmlSerializationHint xmlFormatHint) +117<br>
   Hl7.Fhir.Serialization.PrimitiveValueWriter.Serialize(Object value, XmlSerializationHint hint) +96<br>
   Hl7.Fhir.Serialization.DispatchingWriter.write(PropertyMapping prop, Object instance, SummaryType summary, SerializationMode mode) +74<br>
   Hl7.Fhir.Serialization.DispatchingWriter.Serialize(PropertyMapping prop, Object instance, SummaryType summary, SerializationMode mode) +281<br>
   Hl7.Fhir.Serialization.ComplexTypeWriter.write(ClassMapping mapping, Object instance, SummaryType summary, PropertyMapping prop, SerializationMode mode) +446<br>
   Hl7.Fhir.Serialization.ComplexTypeWriter.writeProperty(ClassMapping mapping, Object instance, SummaryType summary, SerializationMode mode, PropertyMapping prop) +563<br>
   Hl7.Fhir.Serialization.ComplexTypeWriter.Serialize(ClassMapping mapping, Object instance, SummaryType summary, SerializationMode mode) +426<br>
   Hl7.Fhir.Serialization.DispatchingWriter.write(PropertyMapping prop, Object instance, SummaryType summary, SerializationMode mode) +290<br>
   Hl7.Fhir.Serialization.DispatchingWriter.Serialize(PropertyMapping prop, Object instance, SummaryType summary, SerializationMode mode) +281<br>
   Hl7.Fhir.Serialization.ComplexTypeWriter.write(ClassMapping mapping, Object instance, SummaryType summary, PropertyMapping prop, SerializationMode mode) +446<br>
   Hl7.Fhir.Serialization.ComplexTypeWriter.writeProperty(ClassMapping mapping, Object instance, SummaryType summary, SerializationMode mode, PropertyMapping prop) +563<br>
   Hl7.Fhir.Serialization.ComplexTypeWriter.Serialize(ClassMapping mapping, Object instance, SummaryType summary, SerializationMode mode) +426<br>
   Hl7.Fhir.Serialization.ResourceWriter.Serialize(Object instance, SummaryType summary, Boolean contained, String root) +822<br>
   Hl7.Fhir.Serialization.&lt;&gt;c__DisplayClass1_0.&lt;SerializeToXml&gt;b__0(XmlWriter xw) +128<br>
   Hl7.Fhir.Serialization.FhirSerializer.xmlWriterToString(Action`1 serializer) +123<br>
   Hl7.Fhir.Serialization.FhirSerializer.SerializeToXml(Base data, SummaryType summary, String root) +77<br>
   Hl7.Fhir.Serialization.FhirSerializer.SerializeResourceToXml(Resource resource, SummaryType summary) +7</p>



<a name="153864765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864765">(Dec 22 2016 at 14:38)</a>:</h4>
<p>Any ideas what might be causing this?</p>



<a name="153864767"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864767" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864767">(Dec 22 2016 at 14:53)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191362">@Richard Kavanagh</span> I cannot reproduce the error using some example ValueSets. Can you share your own ValueSet resource for debugging purposes?</p>



<a name="153864768"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864768" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864768">(Dec 22 2016 at 14:57)</a>:</h4>
<p>Strangely enough, it is one of the V2 valuesets from the core pack. If I serialise it as JSON it works fine.</p>



<a name="153864769"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864769" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864769">(Dec 22 2016 at 15:00)</a>:</h4>
<p>The JSON serialisation is</p>



<a name="153864770"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864770" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864770">(Dec 22 2016 at 15:01)</a>:</h4>
<p>{<br>
  "resourceType": "ValueSet",<br>
  "id": "v2-0717",<br>
  "meta": {<br>
    "profile": [<br>
      "<a href="http://hl7.org/fhir/StructureDefinition/valueset-shareable-definition" target="_blank" title="http://hl7.org/fhir/StructureDefinition/valueset-shareable-definition">http://hl7.org/fhir/StructureDefinition/valueset-shareable-definition</a>"<br>
    ]<br>
  },<br>
  "text": {<br>
    "status": "additional",<br>
    "div": "removed"<br>
  },<br>
  "url": "<a href="http://hl7.org/fhir/ValueSet/v2-0717" target="_blank" title="http://hl7.org/fhir/ValueSet/v2-0717">http://hl7.org/fhir/ValueSet/v2-0717</a>",<br>
  "version": "2.8.2",<br>
  "name": "v2 Access Restriction Value",<br>
  "status": "active",<br>
  "experimental": true,<br>
  "publisher": "HL7, Inc",<br>
  "codeSystem": {<br>
    "extension": [<br>
      {<br>
        "url": "<a href="http://hl7.org/fhir/StructureDefinition/valueset-oid" target="_blank" title="http://hl7.org/fhir/StructureDefinition/valueset-oid">http://hl7.org/fhir/StructureDefinition/valueset-oid</a>",<br>
        "valueUri": "urn:oid:2.16.840.1.133883.18.388"<br>
      }<br>
    ],<br>
    "system": "<a href="http://hl7.org/fhir/v2/0717" target="_blank" title="http://hl7.org/fhir/v2/0717">http://hl7.org/fhir/v2/0717</a>",<br>
    "caseSensitive": false,<br>
    "concept": [<br>
      {<br>
        "code": "ALL",<br>
        "display": "All"<br>
      },<br>
      {<br>
        "code": "DEM",<br>
        "display": "All demographic data"<br>
      },<br>
      {<br>
        "code": "DRG",<br>
        "display": "Drug"<br>
      },<br>
      {<br>
        "code": "HIV",<br>
        "display": "HIV status and results"<br>
      },<br>
      {<br>
        "code": "LOC",<br>
        "display": "Patient Location"<br>
      },<br>
      {<br>
        "code": "NO",<br>
        "display": "None"<br>
      },<br>
      {<br>
        "code": "OI",<br>
        "display": "Opt in all registries (HIPAA)"<br>
      },<br>
      {<br>
        "code": "OO",<br>
        "display": "Opt out all registries (HIPAA)"<br>
      },<br>
      {<br>
        "code": "PID-17",<br>
        "display": "Religion"<br>
      },<br>
      {<br>
        "code": "PID-7",<br>
        "display": "Date of Birth"<br>
      },<br>
      {<br>
        "code": "PSY",<br>
        "display": "Psychiatric Mental health"<br>
      },<br>
      {<br>
        "code": "SMD",<br>
        "display": "Sensitive medical data"<br>
      },<br>
      {<br>
        "code": "STD",<br>
        "display": "Sexually transmitted diseases"<br>
      }<br>
    ]<br>
  }<br>
}</p>



<a name="153864771"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864771" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864771">(Dec 22 2016 at 15:07)</a>:</h4>
<p><span class="user-mention" data-user-id="191362">@Richard Kavanagh</span> Indeed, with this valueset I can reproduce the issue. I'll register a ticket so Ewout can investigate and solve the bug after his vacation.</p>



<a name="153864772"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864772" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864772">(Dec 22 2016 at 15:07)</a>:</h4>
<p>I found the issue..</p>



<a name="153864774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864774">(Dec 22 2016 at 15:08)</a>:</h4>
<p>I'll raise the issue on GitHub</p>



<a name="153864775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864775">(Dec 22 2016 at 15:09)</a>:</h4>
<p>Looks like the serializer fails on this line: "div": "removed"<br>
The "removed" element contents is not valid Xhtml...</p>



<a name="153864776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864776">(Dec 22 2016 at 15:09)</a>:</h4>
<p>This should be something like "&lt;p&gt;removed&lt;/p&gt;"</p>



<a name="153864777"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864777" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864777">(Dec 22 2016 at 15:10)</a>:</h4>
<p>Yes - I found that... eventually !!</p>



<a name="153864778"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864778" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864778">(Dec 22 2016 at 15:10)</a>:</h4>
<p>But it would be nice if the API would handle this gracefully.</p>



<a name="153864779"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864779" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864779">(Dec 22 2016 at 15:12)</a>:</h4>
<p>If you're going to register an issue on github, you can mention this as it will help to solve the issue quickly.</p>



<a name="153864780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864780">(Dec 22 2016 at 15:12)</a>:</h4>
<p>I guess technically as the text is typed as XHTML then it should accept text without tags. XHTML does not require any tags</p>



<a name="153864781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864781">(Dec 22 2016 at 15:13)</a>:</h4>
<p>See the examples here</p>



<a name="153864782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864782">(Dec 22 2016 at 15:13)</a>:</h4>
<p><a href="http://www.hl7.org/implement/standards/fhir/narrative.html#Narrative" target="_blank" title="http://www.hl7.org/implement/standards/fhir/narrative.html#Narrative">http://www.hl7.org/implement/standards/fhir/narrative.html#Narrative</a></p>



<a name="153864783"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864783" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864783">(Dec 22 2016 at 15:15)</a>:</h4>
<p>I guess it depends on how strict we want to define the standard. Strictly speaking valid Xhtml should always have a root element.</p>



<a name="153864784"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864784" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864784">(Dec 22 2016 at 15:16)</a>:</h4>
<p>Well spec is clear, we should accept plain text.</p>



<a name="153864785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864785">(Dec 22 2016 at 15:22)</a>:</h4>
<p>To be honest I suspect the code is right and the spec probably needs work. I'll leave that for Ewout to progress if required. A more graceful exception would be useful though.</p>



<a name="153864786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864786">(Dec 22 2016 at 15:22)</a>:</h4>
<p>Issue #281 raised on github </p>



<a name="153864788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/XML%20Serialise%20Error/near/153864788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/XML.20Serialise.20Error.html#153864788">(Dec 22 2016 at 15:24)</a>:</h4>
<p>Agreed, and thank you!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
