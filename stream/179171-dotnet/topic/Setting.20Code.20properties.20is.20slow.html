---
layout: page
title: "FHIR Chat  · Setting Code properties is slow · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html">Setting Code properties is slow</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="179988847"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/179988847" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#179988847">(Nov 05 2019 at 23:24)</a>:</h4>
<div class="codehilite"><pre><span></span>            var patient = new Hl7.Fhir.Model.DSTU2.Patient();
            var watch = Stopwatch.StartNew();
            const int count = 10_000;
            for ( var i = 0; i &lt; count; i++ )
            {
                patient.Gender = Hl7.Fhir.Model.AdministrativeGender.Female;
            }
            watch.Stop();
            Console.WriteLine( &quot;Set code X {0:N0}: {1:N1} msec&quot;, count, watch.ElapsedMilliseconds );
</pre></div>



<a name="179988887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/179988887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#179988887">(Nov 05 2019 at 23:24)</a>:</h4>
<p>Output: <code>Set code X 10,000: 62.0 msec</code></p>



<a name="179988985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/179988985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#179988985">(Nov 05 2019 at 23:26)</a>:</h4>
<p>(for non-code properties the time is &lt; 1 msec)</p>



<a name="180011811"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180011811" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180011811">(Nov 06 2019 at 08:37)</a>:</h4>
<p>Property setters raise the <code>PropertyChanged</code> event. Did you hook up a subscriber?</p>



<a name="180019925"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180019925" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180019925">(Nov 06 2019 at 10:47)</a>:</h4>
<p>I'd expect it's the try parse enumeration stuff. But without using the profiler couldn't be sure.<br>
Would be a good example to try with the dotnet profiler.</p>



<a name="180020047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180020047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180020047">(Nov 06 2019 at 10:48)</a>:</h4>
<p>Also, the optimizer with a native property might optimizer things out, but can't be sure.</p>



<a name="180036332"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180036332" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180036332">(Nov 06 2019 at 14:20)</a>:</h4>
<p>The slowness comes from GetAttributeOnEnum() (<a href="https://github.com/FirelyTeam/fhir-net-common/blob/develop/src/Hl7.Fhir.Support/Utility/ReflectionHelper.cs#L219" target="_blank" title="https://github.com/FirelyTeam/fhir-net-common/blob/develop/src/Hl7.Fhir.Support/Utility/ReflectionHelper.cs#L219">https://github.com/FirelyTeam/fhir-net-common/blob/develop/src/Hl7.Fhir.Support/Utility/ReflectionHelper.cs#L219</a>) - that is called every time</p>



<a name="180036683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180036683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180036683">(Nov 06 2019 at 14:24)</a>:</h4>
<p>I created an issue <a href="https://github.com/FirelyTeam/fhir-net-api/issues/1169" target="_blank" title="https://github.com/FirelyTeam/fhir-net-api/issues/1169">https://github.com/FirelyTeam/fhir-net-api/issues/1169</a></p>



<a name="180380150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180380150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180380150">(Nov 10 2019 at 20:35)</a>:</h4>
<p>Any suggestions <span class="user-mention" data-user-id="191912">@Michele Mottini</span> there is also the mirror property element that has the string representation in it, which is what is going on there, converting the enum to the string representation.</p>



<a name="180380156"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180380156" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180380156">(Nov 10 2019 at 20:35)</a>:</h4>
<p>We could generate a hash table I guess.</p>



<a name="180386643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180386643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180386643">(Nov 10 2019 at 23:47)</a>:</h4>
<p>Yes, hash tables is the way to go</p>



<a name="180408585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180408585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180408585">(Nov 11 2019 at 09:27)</a>:</h4>
<p>I see a PR coming :-)</p>



<a name="180478621"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/180478621" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#180478621">(Nov 12 2019 at 03:32)</a>:</h4>
<p>I was thinking about them more, and from a generation perspective, a switch/case function would be better, though that then can't be extended with other values, but that isn't the issue with the current stuff anyway. code vs data - where it sits in memory...</p>



<a name="181975202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Setting%20Code%20properties%20is%20slow/near/181975202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Setting.20Code.20properties.20is.20slow.html#181975202">(Nov 26 2019 at 23:35)</a>:</h4>
<p>Turns out that there is already a cache - it is just a matter of using it: <a href="https://github.com/FirelyTeam/fhir-net-common/pull/16" target="_blank" title="https://github.com/FirelyTeam/fhir-net-common/pull/16">https://github.com/FirelyTeam/fhir-net-common/pull/16</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
