---
layout: page
title: "FHIR Chat  · server parameter processing · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/server.20parameter.20processing.html">server parameter processing</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="210483362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/server%20parameter%20processing/near/210483362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/server.20parameter.20processing.html#210483362">(Sep 18 2020 at 06:38)</a>:</h4>
<p>Just a little gotcha out there for those writing servers when porting over to netcore...<br>
HttpUtility.ParseQueryString has some fun behaviours...<br>
The parts in the query have meaning for FHIR, seperate by <code>&amp;</code> is a logical <code>and</code>, seperate with a <code>,</code> means a logical <code>or</code></p>
<p>Instead you should use the QueryHelpers.ParseQuery() routine.</p>
<p><a href="https://trackjs.com/blog/query-string-parsing/">https://trackjs.com/blog/query-string-parsing/</a></p>
<p>The NameValueCollection will convert this<br>
<code>Observation?date=le2018-04&amp;date=ge2018-04,le2018-04</code><br>
into</p>
<div class="codehilite"><pre><span></span><code>name : `date`
value : `le2018-04,ge2018-04,le2018-04` (single string)
</code></pre></div>


<p>The new structure has a StringValues object, which is a collection of strings, so produces </p>
<div class="codehilite"><pre><span></span><code>name : `date`
value : `le2018-04` and `ge2018-04,le2018-04` (2 strings, as was in the originalstring intent)
</code></pre></div>


<p>This issue is in the Spark server here <span class="user-mention" data-user-id="192710">@Kenneth Myhra</span> <br>
<a href="https://github.com/FirelyTeam/spark/blob/326c41bfe6aa63907e85c016d55f280029f95ec8/src/Spark.Engine/Extensions/HttpHeadersExtensions.cs#L72">https://github.com/FirelyTeam/spark/blob/326c41bfe6aa63907e85c016d55f280029f95ec8/src/Spark.Engine/Extensions/HttpHeadersExtensions.cs#L72</a></p>
<p><span class="user-mention" data-user-id="191757">@Christiaan Knaap</span> , <span class="user-mention" data-user-id="222054">@Gino Canessa</span>, <span class="user-mention" data-user-id="191912">@Michele Mottini</span>  not sure if your servers are also susceptible to this too.<br>
I'll be posting an update to the fhir-net-web-api to resolve it in my facade project this weekend for those using this nuget package.</p>



<a name="210513415"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/server%20parameter%20processing/near/210513415" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/server.20parameter.20processing.html#210513415">(Sep 18 2020 at 12:52)</a>:</h4>
<p>Thanks for checking Brian. Our server is OK,  we use <code>HttpRequestMessageExtensions.GetQueryNameValuePairs() </code></p>



<a name="214730268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/server%20parameter%20processing/near/214730268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/server.20parameter.20processing.html#214730268">(Oct 27 2020 at 16:59)</a>:</h4>
<p>We're not susceptible to this, but thanks for the mention anyway!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
