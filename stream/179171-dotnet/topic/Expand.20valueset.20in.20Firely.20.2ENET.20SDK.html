---
layout: page
title: "FHIR Chat  · Expand valueset in Firely .NET SDK · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Expand.20valueset.20in.20Firely.20.2ENET.20SDK.html">Expand valueset in Firely .NET SDK</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="221647181"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Expand%20valueset%20in%20Firely%20.NET%20SDK/near/221647181" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stine Johansen <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Expand.20valueset.20in.20Firely.20.2ENET.20SDK.html#221647181">(Jan 05 2021 at 13:47)</a>:</h4>
<p>Hi, I have the following query working in Postman, which I want to do with the  Firely .NET SDK, but I can't see any way to define count or offset when using "ExpandValueSet"? </p>
<p>Working query in Postman: {baseUrl}/ValueSet/{valueset-name}/$expand?count=100&amp;offset=10</p>
<p>Anyone have any experience with this?</p>



<a name="221827060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Expand%20valueset%20in%20Firely%20.NET%20SDK/near/221827060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Mundi <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Expand.20valueset.20in.20Firely.20.2ENET.20SDK.html#221827060">(Jan 06 2021 at 21:37)</a>:</h4>
<p>Hi, so I just tried testing this out on HAPI FHIR server R4 from a C# console application using Hl7.Fhir.R4 NuGet package.  The valueset can be seen at <a href="http://hapi.fhir.org/baseR4/ValueSet/1729316">http://hapi.fhir.org/baseR4/ValueSet/1729316</a>. In the console application, I created a FhirClient using a base Uri of <a href="http://hapi.fhir.org/baseR4">http://hapi.fhir.org/baseR4</a>. To keep it simple, I just called client.get() then checked to see if it had an expansion, and then used the Contains property on the ValueSet’s Expansion property. Since Contains property is an IEnumerable&lt;&gt; you can use Linq on it.</p>
<p>var valSet = (ValueSet)client.Get(“ValueSet/1729316”);</p>
<p>if (valSet.HasExpansion) // it does, with 54 elements<br>
{<br>
    var subset = valSet.Expansion.Contains.Skip(5).Take(10);<br>
}</p>
<p>Hope this helps a little.  I’m still learning FHIR.</p>



<a name="221841698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Expand%20valueset%20in%20Firely%20.NET%20SDK/near/221841698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Expand.20valueset.20in.20Firely.20.2ENET.20SDK.html#221841698">(Jan 07 2021 at 00:14)</a>:</h4>
<p>I don't k ow the syntax with that routine, but that would grab all the data locally, and then filter client side with linq.</p>



<a name="221863071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Expand%20valueset%20in%20Firely%20.NET%20SDK/near/221863071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stine Johansen <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Expand.20valueset.20in.20Firely.20.2ENET.20SDK.html#221863071">(Jan 07 2021 at 07:09)</a>:</h4>
<p>Thanks for the tip! I tried your code, and even though there are 1851 expansion, I got HasExpansion == false. However, I see that I can use it like an HttpClient and managed to get all elements with the following, so I think I'll manage to implement some paging as well.</p>
<div class="codehilite"><pre><span></span><code>   public ValueSet ExpandValueSet(string valueSetName)
    {
        var valSet = (ValueSet) _client.Get($&quot;ValueSet/{valueSetName}/$expand?count=10000&quot;);
        return valSet;
    }
</code></pre></div>



<a name="221864567"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Expand%20valueset%20in%20Firely%20.NET%20SDK/near/221864567" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Expand.20valueset.20in.20Firely.20.2ENET.20SDK.html#221864567">(Jan 07 2021 at 07:40)</a>:</h4>
<p>You can also use the operation methods on the FhirClient, instead of the more low level Get:</p>
<div class="codehilite" data-code-language="C#"><pre><span></span><code>   <span class="kt">var</span> <span class="n">p</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Parameters</span><span class="p">();</span>
   <span class="n">p</span><span class="p">.</span><span class="n">Parameter</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Parameters</span><span class="p">.</span><span class="n">ParameterComponent</span><span class="p">()</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"count"</span><span class="p">,</span> <span class="n">Value</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="p">(</span><span class="m">10000</span><span class="p">)</span> <span class="p">});</span>
   <span class="n">p</span><span class="p">.</span><span class="n">Parameter</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Parameters</span><span class="p">.</span><span class="n">ParameterComponent</span><span class="p">()</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"offset"</span><span class="p">,</span> <span class="n">Value</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="p">(</span><span class="m">2000</span><span class="p">)</span> <span class="p">});</span>

  <span class="kt">var</span> <span class="n">valSet</span> <span class="p">=</span> <span class="p">(</span><span class="n">ValueSet</span><span class="p">)</span> <span class="n">client</span><span class="p">.</span><span class="n">InstanceOperation</span><span class="p">(</span><span class="n">ResourceIdentity</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="s">"ValueSet"</span><span class="p">,</span> <span class="s">"{valueSetName}"</span><span class="p">),</span> <span class="s">"expand"</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">useGet</span><span class="p">:</span><span class="k">true</span><span class="p">);</span>
</code></pre></div>



<a name="221939653"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Expand%20valueset%20in%20Firely%20.NET%20SDK/near/221939653" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joe Mundi <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Expand.20valueset.20in.20Firely.20.2ENET.20SDK.html#221939653">(Jan 07 2021 at 13:13)</a>:</h4>
<p>Great tip Mirjam, thank you!  One question I still have, and it looks like Stine ran into something similar, is that sometimes a ValueSet has an expansion contained within its representation and sometimes it does not. Is that just bad test data in the HAPI server, or is ValueSet going to be unpredictable and should we just call the $expand operation?  </p>
<p>Also, is there more documentation about what are the FHIR client capabilities? I would never have known to try the code you listed above without digging deep into the source code.</p>



<a name="222311509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Expand%20valueset%20in%20Firely%20.NET%20SDK/near/222311509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Expand.20valueset.20in.20Firely.20.2ENET.20SDK.html#222311509">(Jan 11 2021 at 15:28)</a>:</h4>
<p>A ValueSet does not need to have an expansion element. If the ValueSet is defined by enumerating all the codes with the ValueSet.include part, that would already give you the list of codes you need. ValueSets can also be defined with a filter, in which case you will need the expansion if you need to check a code against the list, or if you want to show the codes that are in the ValueSet. Please do keep in mind that not all servers are capable of performing a $expand, or might only be able to create an expansion for smaller code systems.</p>
<p>The documentation of the FhirClient is still lacking detail, I'm afraid . But the FhirClient has methods for all the interactions listed on the RestFul FHIR page in the specs, and the SDK code has a lot of inline documentation.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
