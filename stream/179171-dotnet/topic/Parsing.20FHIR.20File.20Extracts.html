---
layout: page
title: "FHIR Chat  · Parsing FHIR File Extracts · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html">Parsing FHIR File Extracts</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="244619428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244619428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gregg Ripley <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244619428">(Jul 01 2021 at 20:03)</a>:</h4>
<p>Greetings.  I am an experienced software engineer with very much beginners knowledge of FHIR and message structures.  I recently been tasked with converting a set of json FHIR file extracts so I can load them into a relational DB (i.e. SQL).  I am struggling to understand how to parse these files as I am getting parsing errors.  For example, I am attempting to parse the "Condition" entity and I get this error: "Exception thrown: 'Hl7.Fhir.ElementModel.StructuralTypeException' in Hl7.Fhir.Support.dll<br>
Additional information: Type checking the data: Encountered unknown element 'resourceId' at location 'Condition.resourceId[0]' while parsing<br>
"</p>
<p>My environment is .NET and leveraging the R5 Core SDK library.  The data set's documentation indicated as "These resources are FHIR R5 preview 2 (version 4.4) compliant. ".  The data is in .JSON representation with a single extract in each folder.  Each folder represents a data entity (condition, patient,  encounter, etc).   A sample of a single line is demonstrated at the end of my message.</p>
<p>I apologize if this is the wrong group or message board for this type of posting.  If that is the case, please direct me to the appropriate location.  Any help on this would be greatly appreciated.  If I could be directed to a good resource would be equally appreciated.</p>
<p>Thanks<br>
Gregg</p>
<hr>
<p>Release Format<br>
FHIR and FHIR+ resources are delivered in new line delimited json files (ndjson). Schema files are delivered as a text file that contains a json object.</p>
<p>FHIR Resources<br>
FHIR resources have the following top-level keys/values:<br>
   resourceId – logical id, an extraction of <a href="http://resource.id">resource.id</a><br>
   resource – FHIR resource content<br>
Further information regarding the structure of each resource can be found by referencing the corresponding <a href="http://hl7.org">hl7.org</a> FHIR schema.</p>
<p>{<br>
    "resourceId": "{GUID}",<br>
    "resource": {<br>
        "abatementDateTime": "{DateTime}",<br>
        "clinicalStatus": {<br>
            "coding": [<br>
                {<br>
                    "code": "{integer}",<br>
                    "display": "{condition display}",<br>
                    "system": "{systemId}"<br>
                }<br>
            ],<br>
            "text": "Resolved"<br>
        },<br>
        "code": {<br>
            "coding": [<br>
                {<br>
                    "code": "{integer}",<br>
                    "display": "{condition display}",<br>
                    "system": "{systemId}"<br>
                }<br>
            ],<br>
            "text": "{Symptom Description}"<br>
        },<br>
        "id": "{GUID}",<br>
        "identifier": [<br>
            {<br>
                "system": "{SystemURL},<br>
                "type": {<br>
                    "coding": [<br>
                        {<br>
                            "code": "{Code Name}",<br>
                            "display": "{Code Name}",<br>
                            "system": "{SystemURL}"<br>
                        }<br>
                    ],<br>
                    "text": "{Code Name}"<br>
                },<br>
                "use": "{use}",<br>
                "value": "{Integer}"<br>
            },<br>
            {<br>
                "system": "{System Id},<br>
                "type": {<br>
                    "coding": [<br>
                        {<br>
                            "code": "{Code}",<br>
                            "display": "{Display}",<br>
                            "system": "<a href="http://hl7.org/v2/diagnosis-id">http://hl7.org/v2/diagnosis-id</a>"<br>
                        }<br>
                    ],<br>
                    "text": "DXID"<br>
                },<br>
                "use": "{use}",<br>
                "value": "{Integer}"<br>
            }<br>
        ],<br>
        "meta": {<br>
            "lastUpdated": "{DateTime}"<br>
        },<br>
        "onsetDateTime": "{DateTime}",<br>
        "resourceType": "Condition",<br>
        "subject": {<br>
            "reference": "{Guid}",<br>
            "type": "Patient"<br>
        }<br>
    }</p>



<a name="244620544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244620544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244620544">(Jul 01 2021 at 20:13)</a>:</h4>
<p>As I wrote in <a class="stream" data-stream-id="179166" href="/#narrow/stream/179166-implementers">#implementers</a> : the Condition resource is just the "resource" object, not the entire JSON, so you should extract and parse only that piece</p>



<a name="244626281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244626281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gregg Ripley <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244626281">(Jul 01 2021 at 21:01)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191912">@Michele Mottini</span> for the reply.  I was thinking I could take the file "as-is" and parse as it was given to me.  With a little bit of "parsing the resource" file, I was able to successfully parse a record (i.e. Condition in this case as a POC).  I just need to rifle through each given fileset as provided to me and rip out the actual object contained in the "resource" object just as you said.  Thanks a ton!</p>



<a name="244633851"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244633851" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244633851">(Jul 01 2021 at 22:17)</a>:</h4>
<p>That doesn't lookike a valid fhir json structure.</p>



<a name="244634049"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244634049" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244634049">(Jul 01 2021 at 22:19)</a>:</h4>
<p>Is doesn't have the <code>resourceType: "Condition"</code> property and the id property is not named right.<br>
Might want to recheck some examples from the R5 spec to compare.</p>



<a name="244638372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244638372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gregg Ripley <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244638372">(Jul 01 2021 at 23:09)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> , When I posted, I copied and didn't want to relay any potential PHI so I obfuscated it heavily out of caution.  Also, the "resourceType": "Condition" is present if you look  6 lines from the bottom up.  I was able to successfully parse the "Condition" object as it was embedded in a "resource" object.  However, I was hoping I could parse the "resource" object and then retrieve the "resource" and cast it as a Condition.  When I try to parse it as a "resource", I get similar parsing errors.  What I plan to do is rifle through the raw extracts and rip out the "Condition" objects (and all the other objects such as Patient, Encounter, etc) and parse those.  That's the plan anyway after successfully parsing the first one.</p>
<p>I have a team of analysts that just received this data extract and need to quickly review it.  This team are all SQL folks.  I need to convert this to simple SQL tables (no relationships at this point, just raw viewable data).</p>



<a name="244656823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244656823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244656823">(Jul 02 2021 at 03:45)</a>:</h4>
<p>Sorry, missed the resoureType in there as you point out.<br>
The fhir parser won't be able to understand your custom wrapper that is around it - has that come straight out of the DB of Spark or HAPI or something like that?<br>
(also interesting that the <code>ResourceID</code> property in your custom wrapper isn't in the <code>id</code> property on resource itself...)<br>
To process that, you'd need to extract the resource from the wrapper, and then the FHIR serializer should be able to handle that no problem, and you could cast that to the Condition (or just parse using the generic with Condition, and remove the need to cast too)</p>



<a name="244750598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244750598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gregg Ripley <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244750598">(Jul 02 2021 at 19:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> , to your point, I am stripping out the 'wrapper' of the actual FHIR object and it's working great.  I am going to examine recreating these JSONHD files and see if I can import them into an instance of the FHIR server (SQLite) via the VonkLoader.  With this, my thinking is to export to an equivalent MS SQL so we can review the data.  I am still working through it, but so far, I'm making progress.  I appreciate all the feedback!</p>



<a name="244761608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Parsing%20FHIR%20File%20Extracts/near/244761608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Parsing.20FHIR.20File.20Extracts.html#244761608">(Jul 02 2021 at 21:56)</a>:</h4>
<p>Good to hear.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
