---
layout: page
title: "FHIR Chat  · Custom FHIR validations · dotnet"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/index.html">dotnet</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html">Custom FHIR validations</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="154011184"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011184" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassiel Oliva <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011184">(Oct 22 2018 at 19:30)</a>:</h4>
<p>I'm implementing an API in order to accept FHIR resources to create laboratory orders. I'm trying to perform custom validations and based in some business rules I would like to require a field or not. For example patient's address. In some cases I just want to require zip code but in some cases I want to require the entire address. It is possible to achieve this with the fhir .net API and FhirValidator or do I need to perform those validations by myself?</p>



<a name="154011298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011298">(Oct 23 2018 at 07:51)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="196707">@Yassiel Oliva</span>, sure you can. I suggest you look into FHIRPath constraints, they allow you to define such business rules, and are supported by both .NET and Java API's.</p>



<a name="154011299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011299">(Oct 23 2018 at 07:53)</a>:</h4>
<p>FHIRPath constraints are supported by the standard validator implementations, probably no need to author any custom logic.</p>



<a name="154011321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011321">(Oct 23 2018 at 09:37)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="196707">@Yassiel Oliva</span> - I have created a demo project that shows how to run the validator in case you needed help there: <a href="https://github.com/ewoutkramer/Furore.Fhir.ValidationDemo" target="_blank" title="https://github.com/ewoutkramer/Furore.Fhir.ValidationDemo">https://github.com/ewoutkramer/Furore.Fhir.ValidationDemo</a></p>



<a name="154011912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassiel Oliva <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011912">(Oct 24 2018 at 15:55)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> can you provide me an example of how to achieve this? I'm pretty new to Fhir and I'm having issues trying to define custom rules. My current use case is I'm receiving a <code>Bundle</code> representing a Laboratory order via API and I want to validate for example incoming <code>ServiceRequest</code> in order to see if the requested services are tagged as orderable or not.</p>



<a name="154011915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassiel Oliva <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011915">(Oct 24 2018 at 16:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span> I'm having troubles running the validation demo offline because of a missing file:  <code>specifications.zip</code> Where do I need to place the file? <a href="/user_uploads/10155/3naA7ioEp5XYNV4K8miBsia_/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/3naA7ioEp5XYNV4K8miBsia_/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/3naA7ioEp5XYNV4K8miBsia_/pasted_image.png"></a></div>



<a name="154011917"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011917" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011917">(Oct 24 2018 at 16:07)</a>:</h4>
<p>The specification.zip archive is part of the <code>Hl7.Fhir.Specification</code> NuGet package. After installing the package, this file should be added to the root folder of your project. In Visual Studio, please ensure following settings:</p>
<div class="codehilite"><pre><span></span>Build Action = Content
Copy to Output Directory = Copy if newer
</pre></div>


<p>This ensures that the compiler copies specification.zip to the output directory. The API expects this file to be located in the same folder as the assembly.</p>



<a name="154011931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011931">(Oct 24 2018 at 16:32)</a>:</h4>
<p>For information about authoring constraints, see the FHIRPath specification:<br>
<a href="http://hl7.org/fhirpath/" target="_blank" title="http://hl7.org/fhirpath/">http://hl7.org/fhirpath/</a></p>



<a name="154011932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154011932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154011932">(Oct 24 2018 at 16:32)</a>:</h4>
<p>For examples, you can inspect the core resources, as many introduce their own constraints.<br>
e.g. pat-1 on Patient:<br>
<a href="http://hl7.org/fhir/patient.html#invs" target="_blank" title="http://hl7.org/fhir/patient.html#invs">http://hl7.org/fhir/patient.html#invs</a></p>



<a name="154012341"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154012341" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154012341">(Oct 26 2018 at 10:27)</a>:</h4>
<p>If you are just running the exe, it should end up in the same directory as the .exe...</p>



<a name="154012788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154012788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154012788">(Oct 27 2018 at 00:02)</a>:</h4>
<p>Or you can put the file wherever you like - AppData, UserData etc, and use the DirectorySourceResolver with the path that you use.</p>



<a name="154020943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154020943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yassiel Oliva <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154020943">(Nov 26 2018 at 22:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span> we are having issues to perform the validations. We tried with <code>Fhir.Specification.STU3</code> and <code>Fhir.Specification.R4</code> but validation is failing with both validators. We have selected a sample patient info for each version:</p>
<p><a href="https://www.hl7.org/fhir/patient-example-a.json.html" target="_blank" title="https://www.hl7.org/fhir/patient-example-a.json.html">https://www.hl7.org/fhir/patient-example-a.json.html</a><br>
<a href="http://hl7.org/fhir/2018Sep/patient-example-a.json.html" target="_blank" title="http://hl7.org/fhir/2018Sep/patient-example-a.json.html">http://hl7.org/fhir/2018Sep/patient-example-a.json.html</a></p>
<div class="codehilite"><pre><span></span>            var parser = new FhirJsonParser();
            var patient = parser.Parse&lt;Patient&gt;(File.ReadAllText(&quot;samplePatient.json&quot;));
            var validator = new Validator();

            var result = validator.Validate(patient);

            Console.WriteLine(result.Success);
            foreach (var err in result.Issue.Select(e =&gt; e.Details.Text))
                Console.WriteLine(err);
</pre></div>


<p>with both versions we are getting the same validation issue:<br>
<code>Unable to resolve reference to profile 'http://hl7.org/fhir/StructureDefinition/Patient'</code></p>
<p>Are we missing something?</p>



<a name="154021184"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154021184" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154021184">(Nov 27 2018 at 23:10)</a>:</h4>
<p>You need to pass some settings into the validator..</p>
<div class="codehilite"><pre><span></span>        ValidationSettings settings = ValidationSettings.Default;
        settings.EnableXsdValidation = false;
        settings.Trace = false;
        settings.ResourceResolver =    ...need to add some form of resolver so the validator can find the profiles.
        settings.TerminologyService = ... need to add some form of terminology server
</pre></div>



<a name="154021294"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154021294" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154021294">(Nov 28 2018 at 11:04)</a>:</h4>
<p>Yes - the Validator needs access to the definitions of the FHIR resources, these are normally shipped with the Specification library (specification.zip).  That's the first step - the other steps are:</p>
<ul>
<li>the Validator will need to be told how to get to that specification.zip. </li>
<li>This is done by passing it a concrete implementation of IResourceResolver</li>
<li>The resource resolver can be indicated in the ValidationSettings you pass to the constructor of the validator</li>
</ul>
<p>The .NET API ships with a few concrete implementations for IResourceResolver - one for resolving references to definitions in the specification.zip, one for resolving it from a directory.</p>
<p>I wrote an example Windows Forms application that does all this (don't worry if you're not on Windows, the code is quite windows independent):<br>
<a href="https://github.com/ewoutkramer/Furore.Fhir.ValidationDemo/blob/master/MainForm.cs" target="_blank" title="https://github.com/ewoutkramer/Furore.Fhir.ValidationDemo/blob/master/MainForm.cs">https://github.com/ewoutkramer/Furore.Fhir.ValidationDemo/blob/master/MainForm.cs</a>.</p>
<p>I spoke about this part of the API at DevDays last year: <a href="https://vimeo.com/album/5317523/video/243081070" target="_blank" title="https://vimeo.com/album/5317523/video/243081070">https://vimeo.com/album/5317523/video/243081070</a> (video), I also have a slide deck about it here: <a href="https://www.slideshare.net/DevDays/validation-in-net-and-java-ewout-james" target="_blank" title="https://www.slideshare.net/DevDays/validation-in-net-and-java-ewout-james">https://www.slideshare.net/DevDays/validation-in-net-and-java-ewout-james</a></p>
<p>Hope that helps.  And yes, I guess I should add some documentation about this at our docs site (<a href="http://docs.simplifier.net/fhirnetapi/index.html" target="_blank" title="http://docs.simplifier.net/fhirnetapi/index.html">http://docs.simplifier.net/fhirnetapi/index.html</a>)</p>



<a name="154021295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/154021295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#154021295">(Nov 28 2018 at 11:06)</a>:</h4>
<p>By the way, the R4 validator is still totally broken - We try to release the first R4-validator in the 1.1 release of the API.</p>



<a name="160084663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/160084663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Andersen <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#160084663">(Mar 06 2019 at 10:44)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span>  I don't know the state of the R4 validator atm, but is it correct to assume that it's an issue that the R4 validator, can't validate profiles  that doesn't have a URL starting with "<a href="http://hl7.org/fhir/StructureDefinition/" target="_blank" title="http://hl7.org/fhir/StructureDefinition/">http://hl7.org/fhir/StructureDefinition/</a>". Specifically code in ProfilePreprocessor.</p>



<a name="160093045"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/160093045" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martijn Harthoorn <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#160093045">(Mar 06 2019 at 13:02)</a>:</h4>
<p>We are not aware of this issue. And we have some unit tests that seem to say otherwise. Is it possible to send us the profile for us to debug it?</p>



<a name="160119596"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/160119596" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Andersen <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#160119596">(Mar 06 2019 at 18:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191335">@Martijn Harthoorn</span> Sure I could do that tomorrow when I'm back at work, but the "issue" seems to be located in <a href="https://github.com/FirelyTeam/fhir-net-api/blob/develop/src/Hl7.Fhir.Specification/Validation/ProfilePreprocessor.cs" target="_blank" title="https://github.com/FirelyTeam/fhir-net-api/blob/develop/src/Hl7.Fhir.Specification/Validation/ProfilePreprocessor.cs">https://github.com/FirelyTeam/fhir-net-api/blob/develop/src/Hl7.Fhir.Specification/Validation/ProfilePreprocessor.cs</a><br>
line: if (instance.InstanceType != null) _profiles.SetInstanceType(ModelInfo.CanonicalUriForFhirCoreType(instance.InstanceType));<br>
But maybe im using the validator wrong, but all my debugging leads to that point where it always "thinks" it's a Fhir Core type.</p>



<a name="160119730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/160119730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Andersen <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#160119730">(Mar 06 2019 at 18:14)</a>:</h4>
<p><span class="user-mention" data-user-id="191335">@Martijn Harthoorn</span> I'm using a derived POCO class. But the more I read about Fhir profiling in net-fhir-api, the more it seems to be the wrong approach.</p>



<a name="160131758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/160131758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#160131758">(Mar 06 2019 at 20:31)</a>:</h4>
<p>That namespace is where core data types live.<br>
Creating other types in there is bad practice, and will be confusing to look at. HL7 didn't create them...<br>
If its your profile, usie your own namespace.</p>



<a name="160131881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/160131881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#160131881">(Mar 06 2019 at 20:32)</a>:</h4>
<p>And from memory, the instance type is always a core type.</p>



<a name="160136138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/160136138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Andersen <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#160136138">(Mar 06 2019 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> What namespace are your referring to? I haven't posted the namespace for my derived POCO class anywhere?</p>



<a name="160186814"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/160186814" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martijn Harthoorn <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#160186814">(Mar 07 2019 at 10:47)</a>:</h4>
<p>I think Brian meant the start of the canonical url, or the canonical base as we call them on Simplifier.</p>



<a name="162233673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/162233673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#162233673">(Apr 01 2019 at 12:30)</a>:</h4>
<blockquote>
<p>@Ewout Kramer I don't know the state of the R4 validator atm, but is it correct to assume that it's an issue that the R4 validator, can't validate profiles that doesn't have a URL starting with "<a href="http://hl7.org/fhir/StructureDefinition/" target="_blank" title="http://hl7.org/fhir/StructureDefinition/">http://hl7.org/fhir/StructureDefinition/</a>". Specifically code in ProfilePreprocessor.</p>
</blockquote>
<p>That is absolutely correct at the moment, however there is a very recent PR (<a href="https://github.com/FirelyTeam/fhir-net-api/pull/917" target="_blank" title="https://github.com/FirelyTeam/fhir-net-api/pull/917">https://github.com/FirelyTeam/fhir-net-api/pull/917</a>) that will fix this. We expect to have it ready in version 1.3 of the API!</p>



<a name="164984828"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/164984828" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sanjay shekhar <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#164984828">(May 06 2019 at 14:13)</a>:</h4>
<p>I am using hl7.fhir.stu3.specification nuget package for the validation of fhir resource.I have resource with extension which is giving error.<br>
Is there any way to turn off that extension url validation?</p>



<a name="164991044"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/164991044" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#164991044">(May 06 2019 at 15:26)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="220895">@sanjay shekhar</span>, what kind of error are you getting? The preferred approach would be to fix the models.</p>



<a name="165041092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165041092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sanjay shekhar <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165041092">(May 07 2019 at 04:17)</a>:</h4>
<blockquote>
<p>Hi <span class="user-mention silent" data-user-id="220895">sanjay shekhar</span>, what kind of error are you getting? The preferred approach would be to fix the models.</p>
</blockquote>
<p>I have one observation resource which has extension as following <br>
"extension": [<br>
          {<br>
            "url": "http:\/\/hl7.org\/fhir\/StructureDefinition\/T_ObservationImageExtension",<br>
            "valueReference": {<br>
              "reference": "ImagingStudy\/test ImageStudy Extention"<br>
            }<br>
          }<br>
        ]<br>
first I parse it using FhirJsonParser to resource<br>
and then pass it to validator<br>
like below</p>
<p>CachedResolver source = new CachedResolver(new MultiResolver(<br>
                                                   new DirectorySource(Environment.CurrentDirectory),<br>
                                                   ZipSource.CreateValidationSource()));</p>
<div class="codehilite"><pre><span></span>            // prepare the settings for the validator
            ValidationSettings validationSettings = new ValidationSettings
            {
                ResourceResolver = source,
                GenerateSnapshot = true,
                Trace = false,
                EnableXsdValidation = true,
                ResolveExteralReferences = false,

            };

       // var sd = source.FindStructureDefinition(@&quot;https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-GPC-Patient-1&quot;)

        Validator validator = new Validator(validationSettings);
</pre></div>


<p>I have the specification zip file copied to source directory <br>
using specification hl7.fhir.specification nuget 1.2.1</p>
<p>result operation outcome has this issue</p>
<p>"issue": [<br>
        {<br>
            "severity": "error",<br>
            "code": "incomplete",<br>
            "details": {<br>
                "coding": [<br>
                    {<br>
                        "system": "<a href="http://hl7.org/fhir/dotnet-api-operation-outcome" target="_blank" title="http://hl7.org/fhir/dotnet-api-operation-outcome">http://hl7.org/fhir/dotnet-api-operation-outcome</a>",<br>
                        "code": "4000"<br>
                    }<br>
                ],<br>
                "text": "Unable to resolve reference to profile '<a href="http://hl7.org/fhir/StructureDefinition/T_ObservationImageExtension" target="_blank" title="http://hl7.org/fhir/StructureDefinition/T_ObservationImageExtension">http://hl7.org/fhir/StructureDefinition/T_ObservationImageExtension</a>'"<br>
            },<br>
            "location": [<br>
                "Observation.extension[0]"<br>
            ]<br>
        }</p>



<a name="165072064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165072064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165072064">(May 07 2019 at 13:49)</a>:</h4>
<p>The validator needs access to all core &amp; custom profiles that the instance touches (directly or indirectly), in order to perform the validation. If one or more profiles are missing/unresolved, the validation report is incomplete.<br>
I'd suggest to put all your custom profiles in a separate folder and make sure that the <code>DirectorySource</code> can find them.</p>



<a name="165077883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165077883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Jahagirdar <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165077883">(May 07 2019 at 14:50)</a>:</h4>
<p>thanks Michel for the reply.<br>
we would need some more information:<br>
1. if we don;t want to create custom profile, is there any way to inform Validation Code to skip the validation of reference? Currently it gives error only for extension having ValueReference param.<br>
2. Please suggest on how to create the profile ? Any hints would be helpful.</p>



<a name="165080805"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165080805" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165080805">(May 07 2019 at 15:19)</a>:</h4>
<p>If I understand correctly, I think all you need to do is to put the required extension definitions in a directory, such as the ObervationImageExtension in the example above. This ensures that the validator can verify the extensions that are present in your instance. You don't have to create custom profiles if you don't need them.</p>



<a name="165080946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165080946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165080946">(May 07 2019 at 15:20)</a>:</h4>
<p>In case you want/decide to create a new/custom profile, you can use e.g. Forge, the FHIR profile editor, which you can download for free from Simplifier: <a href="https://simplifier.net/downloads/forge" target="_blank" title="https://simplifier.net/downloads/forge">https://simplifier.net/downloads/forge</a></p>



<a name="165081027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165081027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165081027">(May 07 2019 at 15:21)</a>:</h4>
<p>To learn more about FHIR profiling, visit e.g. <a href="https://simplifier.net/guide/profilingacademy" target="_blank" title="https://simplifier.net/guide/profilingacademy">https://simplifier.net/guide/profilingacademy</a></p>



<a name="165081110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165081110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165081110">(May 07 2019 at 15:22)</a>:</h4>
<p>(but it looks like you don't really need to create custom profiles in this case)</p>



<a name="165085930"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165085930" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Jahagirdar <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165085930">(May 07 2019 at 16:13)</a>:</h4>
<p>thanks Michel.<br>
We actually dont need custom profile. But since we are using FHIR specification validation , the validation fails.<br>
is there any other way to indicate validation that it can skip validation for ImagingStudy</p>



<a name="165086343"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165086343" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165086343">(May 07 2019 at 16:17)</a>:</h4>
<p>AFAIK, there is no easy way to skip a specific part of the validation.<br>
Preferred way is to give the validator all the necessary information - otherwise results are not guaranteed to be complete/reliable.</p>



<a name="165086454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165086454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165086454">(May 07 2019 at 16:18)</a>:</h4>
<p>Did you try to initialize the DirectorySource with the extension definitions that you use? That shouldn't be hard.</p>



<a name="165086631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165086631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165086631">(May 07 2019 at 16:20)</a>:</h4>
<p>Core extension definitions are part of the spec. You can download them from <a href="http://hl7.org/fhir/downloads.html" target="_blank" title="http://hl7.org/fhir/downloads.html">http://hl7.org/fhir/downloads.html</a>.<br>
You can also download extension definitions from the FHIR registry (<a href="https://registry.fhir.org/" target="_blank" title="https://registry.fhir.org/">https://registry.fhir.org/</a>) or from Simplifier (<a href="https://simplifier.net" target="_blank" title="https://simplifier.net">https://simplifier.net</a>).</p>



<a name="165086898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165086898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Jahagirdar <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165086898">(May 07 2019 at 16:23)</a>:</h4>
<p>I will try to initialize with extension definition. thanks. I will update here.</p>



<a name="165087088"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165087088" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165087088">(May 07 2019 at 16:25)</a>:</h4>
<p>Note: same goes for other dependencies, e.g. if you want the validator to verify your terminology bindings, you'd have to provide the required valuesets.</p>



<a name="165093163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179171-dotnet/topic/Custom%20FHIR%20validations/near/165093163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179171-dotnet/topic/Custom.20FHIR.20validations.html#165093163">(May 07 2019 at 17:39)</a>:</h4>
<p>I encounter the same issues, and with mine, since I don't care on that specific rule, I just ignore/remove those incomplete errors and let it pass through.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
