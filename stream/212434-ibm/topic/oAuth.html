---
layout: page
title: "FHIR Chat  · oAuth · ibm"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/index.html">ibm</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html">oAuth</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="248576797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/248576797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#248576797">(Aug 06 2021 at 06:43)</a>:</h4>
<p>Scenario 1: patient/Patient.read<br>
It is observed that when we send scopes "patient/Medication.read patient/AllergyIntolerance.read patient/CarePlan.read patient/CareTeam.read patient/Condition.read patient/Device.read patient/DiagnosticReport.read patient/DocumentReference.read patient/Encounter.read patient/Goal.read patient/Immunization.read patient/Location.read patient/MedicationRequest.read patient/Observation.read patient/Organization.read patient/Practitioner.read patient/Procedure.read patient/Provenance.read" in the token, to read Patientdetails with URL  "<a href="http://3.84.221.213:9443/fhir-server/api/v4/Patient/17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be">http://3.84.221.213:9443/fhir-server/api/v4/Patient/17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be</a>"</p>
<p>it denies access (as expected) because we have not given "patient/Patient.read" in the scope list in the token.</p>
<p>Following is a snapshot of the detailed trace<br>
[8/6/21, 5:52:24:261 UTC] 0000002b AuthzPolicyEn 1   read permission for 'Patient/17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be' is not granted by any of the provided scopes: [patient/Medication.read, patient/AllergyIntolerance.read, patient/CarePlan.read, patient/CareTeam.read, patient/Condition.read, patient/Device.read, patient/DiagnosticReport.read, patient/DocumentReference.read, patient/Encounter.read, patient/Goal.read, patient/Immunization.read, patient/Location.read, patient/MedicationRequest.read, patient/Observation.read, patient/Organization.read, patient/Practitioner.read, patient/Procedure.read, patient/Provenance.read] with context id(s): [17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be]<br>
[8/6/21, 5:52:24:262 UTC] 0000002b FHIRUserTrans 1   Marking transaction for rollback.<br>
[8/6/21, 5:52:24:262 UTC] 0000002b FHIRUserTrans 1   Rolling back transaction on current thread...<br>
[8/6/21, 5:52:24:264 UTC] 0000002b CacheTransact I   Transaction failed - afterCompletion(status = 4)<br>
[8/6/21, 5:52:24:264 UTC] 0000002b FHIRPersisten 1   Transaction rolled back - clearing local maps<br>
[8/6/21, 5:52:24:266 UTC] 0000002b FHIRResource  1   Requested interaction is not permitted by any of the passed scopes.</p>
<p>Scenario 2: patient/AllergyIntolerance.read<br>
When we send scopes "patient/Medication.read patient/CarePlan.read patient/CareTeam.read patient/Condition.read patient/Device.read patient/DiagnosticReport.read patient/DocumentReference.read patient/Encounter.read patient/Goal.read patient/Immunization.read patient/Location.read patient/MedicationRequest.read patient/Observation.read patient/Organization.read patient/Practitioner.read patient/Procedure.read patient/Provenance.read patient/Patient.read" , with no patient/AllergyIntolerance.read in it, it still allows access to Allergy of the patient (<a href="http://3.84.221.213:9443/fhir-server/api/v4/AllergyIntolerance?patient=17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be">http://3.84.221.213:9443/fhir-server/api/v4/AllergyIntolerance?patient=17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be</a>) and gives 200 OK. It is expected here, that it should deny access to this resource.</p>
<p>In the trace, we could not locate any log with  AuthzPolicyEn 1, the way it was present when we ran scenario 1. </p>
<p>Even when we send no scopes in the token, the FHIR server still gives access to allergyIntolerance.</p>
<p>Are we missing anything? Please help.</p>



<a name="248849639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/248849639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#248849639">(Aug 09 2021 at 13:59)</a>:</h4>
<p>Hi Mahesh, do you actually get the allergyIntolerance back or do you get just an empty page of results?</p>



<a name="248851597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/248851597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#248851597">(Aug 09 2021 at 14:10)</a>:</h4>
<p>What the fhir-smart interceptor does is it converts the searches into Patient Compartment searches.<br>
Then, mostly to deal with <code>_include</code> and <code>_revinclude</code> search parameters, it also confirms that the user has access to all the resources it is about to return.  So, if AllergyIntolerance search cannot find any AllergyIntolerance for the "in-context" patient then I think it is expected that it will return en empty page.<br>
With that said, I agree that it would be better to reject the search up-front.  This can be done via either a gateway or within the FHIR Server, but the fhir-smart interceptor does not currently do that.  Care to open an issue for it?</p>



<a name="249099887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249099887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249099887">(Aug 11 2021 at 12:31)</a>:</h4>
<p>Thank you for your explanation of our previous questions. After we uploaded all resource-type data to a patient, the FHIR server started to honor scopes as expected. That means it will honor scopes only when there is patient data for those scopes.</p>
<p>While we were testing with the Inferno tool, now we are getting an error "UnsupportedOperationException: SMART scopes with context type 'user' are not yet supported.". </p>
<p>URL called: <br>
<a href="http://54.88.8.62:9443/fhir-server/api/v4/Practitioner/17b350debf6-c44c90a7-7703-4bd9-bd57-6df97a2c0b9f">http://54.88.8.62:9443/fhir-server/api/v4/Practitioner/17b350debf6-c44c90a7-7703-4bd9-bd57-6df97a2c0b9f</a></p>
<p>Token sent:<br>
       {<br>
  "iss": "<a href="https://identityserverforfhir.azurewebsites.net">https://identityserverforfhir.azurewebsites.net</a>",<br>
  "nbf": 1628683595,<br>
  "iat": 1628683595,<br>
  "exp": 1628687195,<br>
  "aud": "<a href="http://54.88.8.62:9443/fhir-server/api/v4">http://54.88.8.62:9443/fhir-server/api/v4</a>",<br>
  "scope": "launch openid fhirUser user/Medication.read user/AllergyIntolerance.read user/CarePlan.read user/CareTeam.read user/Condition.read user/Device.read user/DiagnosticReport.read user/DocumentReference.read user/Encounter.read user/Goal.read user/Immunization.read user/Location.read user/MedicationRequest.read user/Observation.read user/Organization.read user/Patient.read user/Practitioner.read user/Procedure.read user/Provenance.read offline_access",<br>
  "group": [<br>
    "FHIRUsers",<br>
    "FHIRAdmins"<br>
  ],<br>
  "amr": [<br>
    "pwd"<br>
  ],<br>
  "client_id": "Inferno",<br>
  "sub": "fhiruser",<br>
  "auth_time": 1628679442,<br>
  "idp": "local",<br>
  "sid": "C98717AE4B6939B04B9D68763BBE60D0",<br>
  "patient": "17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be",<br>
  "patient_id": "17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be",<br>
  "upn": "fhiruser",<br>
  "need_patient_banner": "false",<br>
  "smart_style_url": "<a href="https://identityserverforfhir.azurewebsites.net/SmartOnFHIR/v1.json">https://identityserverforfhir.azurewebsites.net/SmartOnFHIR/v1.json</a>",<br>
  "jti": "8C0419C23EBBC63990064C53821C14F4"<br>
}</p>
<p>Response received: <br>
{<br>
  "resourceType": "OperationOutcome",<br>
  "issue": [<br>
    {<br>
      "severity": "fatal",<br>
      "code": "exception",<br>
      "details": {<br>
        "text": "UnsupportedOperationException: SMART scopes with context type 'user' are not yet supported."<br>
      }<br>
    }<br>
  ]<br>
}</p>
<p>Could you please help us with that?</p>



<a name="249104716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249104716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249104716">(Aug 11 2021 at 13:11)</a>:</h4>
<blockquote>
<p>That means it will honor scopes only when there is patient data for those scopes.</p>
</blockquote>
<p>yep.  however, I think you've convinced me that we should be more restrictive (even with no data being returned) and so I opened <a href="https://github.com/IBM/FHIR/issues/2669">https://github.com/IBM/FHIR/issues/2669</a> and that change is now expected for IBM FHIR Server 4.9.0</p>



<a name="249106852"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249106852" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249106852">(Aug 11 2021 at 13:28)</a>:</h4>
<p>Yes absolutely. As I see the last comment on the issue in github it says "use of user/ permissions is still not implemented for some cases" For now we are looking for read permission. Any idea when that can be available approximately? Is there any custom fix we can do till release for short- term. I mean if we can get Jar with this change (final release can take its own time as per schedule and it is ok)</p>
<p>Thanks a lot and appreciate your help.</p>



<a name="249133009"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249133009" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249133009">(Aug 11 2021 at 16:32)</a>:</h4>
<p>We merged <a href="https://github.com/IBM/FHIR/pull/2675">https://github.com/IBM/FHIR/pull/2675</a> this morning and that is now also expected for 4.9.0</p>



<a name="249133061"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249133061" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249133061">(Aug 11 2021 at 16:32)</a>:</h4>
<p>you can checkout and build from main today</p>



<a name="249133410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249133410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249133410">(Aug 11 2021 at 16:35)</a>:</h4>
<p>In the past I left supporting <code>user/</code> scopes as a TODO because, for most cases, it should really be tied to a more granular permissions model.  However, thats extremely challenging to do in a generic fhir server like ours, so this pull request just goes with the proposal that I read on Zulip a while back:  <a href="#narrow/stream/179170-smart/topic/Authorization.20for.20transactions/near/213346765">https://chat.fhir.org/#narrow/stream/179170-smart/topic/Authorization.20for.20transactions/near/213346765</a></p>



<a name="249133682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249133682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249133682">(Aug 11 2021 at 16:37)</a>:</h4>
<p>If you do check out from main, let us know how it goes ASAP because we are <em>very</em> close to releasing 4.9.0.  We're testing it on a few projects ourselves, but it would be <em>great</em> to have some independent verification of these late-breaking fhir-smart changes.</p>



<a name="249213364"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249213364" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249213364">(Aug 12 2021 at 09:27)</a>:</h4>
<p>Hi Lee</p>
<p>Where can I get fhir-smart-4.9.0.jar? I can test that with latest release of  IBM FHIR Server 4.9.0. Also what will be dependencies for this jar or it will work with old version of dependencies?</p>
<p>Right now we are having following dependencies in usrlib folder</p>
<p><a href="/user_uploads/10155/q_avLsQTjFbdQJoPHgbxuc3w/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/q_avLsQTjFbdQJoPHgbxuc3w/image.png" title="image.png"><img src="/user_uploads/10155/q_avLsQTjFbdQJoPHgbxuc3w/image.png"></a></div><p>Thanks<br>
Mahesh</p>



<a name="249236270"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249236270" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249236270">(Aug 12 2021 at 13:44)</a>:</h4>
<p>We tagged 4.9.0 last night and the artifacts have been promoted to Maven Central.  So you can get from <a href="https://repo1.maven.org/maven2/com/ibm/fhir/fhir-smart/4.9.0/">https://repo1.maven.org/maven2/com/ibm/fhir/fhir-smart/4.9.0/</a> or you can use Maven to get it (and its transitive dependencies).  I don't think there were any dependency version updates for fhir-smart in this release.</p>



<a name="249237903"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249237903" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249237903">(Aug 12 2021 at 13:59)</a>:</h4>
<p>Great. I saw the code change in github.  Please see attached screenshot of inferno. <br>
During bulk export, we would need to honor system scopes. Also, has signature algorithm something to do with FHIR server?</p>
<p><a href="/user_uploads/10155/mCMSxADqG9sqabYVFuu4UPDT/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/mCMSxADqG9sqabYVFuu4UPDT/image.png" title="image.png"><img src="/user_uploads/10155/mCMSxADqG9sqabYVFuu4UPDT/image.png"></a></div>



<a name="249239830"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249239830" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249239830">(Aug 12 2021 at 14:14)</a>:</h4>
<p>Cool, I havn't done too much with that.  Please open an issue for it at <a href="http://github.com/ibm/fhir">github.com/ibm/fhir</a> with what you're seeing and what you'd like to see.</p>



<a name="249268123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249268123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249268123">(Aug 12 2021 at 17:45)</a>:</h4>
<blockquote>
<p>has signature algorithm something to do with FHIR server?</p>
</blockquote>
<p>From the FHIR server side, I think its just about being able to validate the tokens we get passed.  We opened an issue requesting specific support for ES384/RS384 in OpenLiberty a while back and the ticket is still open...but I havn't tried it in a while and there's always a chance that it could be made to work despite the issue being open still.  If you decide to give it a go, let us know how it goes.</p>



<a name="249702322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/249702322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#249702322">(Aug 17 2021 at 10:56)</a>:</h4>
<p>Hi Lee</p>
<p>We tested latest version of smart and scoping is working as expected. really appreciate your help for addressing this in  your busy release schedule.</p>
<p>I will test more and get you some feedback.</p>
<p>Thanks<br>
Mahesh</p>



<a name="256036525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/256036525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#256036525">(Oct 04 2021 at 10:29)</a>:</h4>
<p>We successfully installed the latest IBM FHIR 4.9.2 and worked fine with basic authentication.</p>
<p>Now when we configured it to use the SMART feature it is giving us the below exception. while running a GET on <a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Patient">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Patient</a> </p>
<p>We have the following jars under userlib.<br>
      fhir-smart-4.9.2.jar<br>
      java-jwt-3.13.0.jar</p>
<p>Do you think we are missing more dependencies?</p>
<p>Exception:<br>
[INFO    ] Received request: tenantId:[default] dsId:[default] user:[fhiruser] method:[GET] uri:[https://fhir.secureit.co.in:9443/fhir-server/api/v4/Patient]<br>
[INFO    ] Transaction failed - afterCompletion(status = 4)<br>
[WARNING ] Application {http://resources.server.fhir.ibm.com/}Create has thrown exception, unwinding now<br>
com/fasterxml/jackson/databind/JsonDeserializer<br>
[WARNING ] Exception in handleFault on interceptor org.apache.cxf.jaxrs.interceptor.JAXRSDefaultFaultOutInterceptor@341d5864<br>
com/fasterxml/jackson/databind/JsonDeserializer<br>
[ERROR   ] An unexpected error occurred during error handling. No further error processing will occur.<br>
com/fasterxml/jackson/databind/JsonDeserializer<br>
[ERROR   ] SRVE0777E: Exception thrown by application class 'org.apache.cxf.service.invoker.AbstractInvoker.createFault:167'<br>
org.apache.cxf.interceptor.Fault: com/fasterxml/jackson/databind/JsonDeserializer<br>
at org.apache.cxf.service.invoker.AbstractInvoker.createFault(AbstractInvoker.java:167)<br>
at [internal classes]<br>
at com.ibm.fhir.server.filter.rest.FHIRRestServletFilter.doFilter(FHIRRestServletFilter.java:155)<br>
at javax.servlet.http.HttpFilter.doFilter(HttpFilter.java:127)<br>
at [internal classes]<br>
Caused by: java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/JsonDeserializer<br>
at com.auth0.jwt.JWTDecoder.&lt;init&gt;(JWTDecoder.java:32)<br>
at com.auth0.jwt.JWT.decode(JWT.java:45)<br>
at com.ibm.fhir.smart.AuthzPolicyEnforcementPersistenceInterceptor.beforeSearch(AuthzPolicyEnforcementPersistenceInterceptor.java:113)<br>
at com.ibm.fhir.persistence.interceptor.impl.FHIRPersistenceInterceptorMgr.fireBeforeSearchEvent(FHIRPersistenceInterceptorMgr.java:175)<br>
at com.ibm.fhir.server.util.FHIRRestHelper.doSearch(FHIRRestHelper.java:1076)<br>
at com.ibm.fhir.server.util.FHIRRestHelper.doSearch(FHIRRestHelper.java:1017)<br>
at com.ibm.fhir.server.resources.Search.doSearch(Search.java:74)<br>
at com.ibm.fhir.server.resources.Search.searchGet(Search.java:51)<br>
at com.ibm.fhir.server.resources.Search$Proxy$_$$_WeldClientProxy.searchGet(Unknown Source)<br>
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>
at java.lang.reflect.Method.invoke(Method.java:498)<br>
at com.ibm.ws.jaxrs20.cdi.component.JaxRsFactoryImplicitBeanCDICustomizer.serviceInvoke(JaxRsFactoryImplicitBeanCDICustomizer.java:342)<br>
... 4 more</p>
<p>[INFO    ] Error while setting request context or processing request<br>
com/fasterxml/jackson/databind/JsonDeserializer<br>
[INFO    ] Completed request[0.04 secs]: tenantId:[default] dsId:[default] user:[fhiruser] method:[GET] uri:[https://fhir.secureit.co.in:9443/fhir-server/api/v4/Patient] status:[400]</p>



<a name="256044380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/256044380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#256044380">(Oct 04 2021 at 11:44)</a>:</h4>
<p><a href="https://github.com/IBM/FHIR/blob/main/fhir-smart/src/main/java/com/ibm/fhir/smart/AuthzPolicyEnforcementPersistenceInterceptor.java#L113">https://github.com/IBM/FHIR/blob/main/fhir-smart/src/main/java/com/ibm/fhir/smart/AuthzPolicyEnforcementPersistenceInterceptor.java#L113</a></p>
<p>Error on this line</p>



<a name="256229168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/256229168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#256229168">(Oct 05 2021 at 11:40)</a>:</h4>
<p>Hi Mahesh, sorry to hear that.  The concerning line is this one:</p>
<blockquote>
<p>Caused by: java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/JsonDeserializer</p>
</blockquote>
<p>Which version of the jackson jars do you have in userlib (alongside fhir-smart) ?</p>



<a name="256426096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/256426096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#256426096">(Oct 06 2021 at 15:02)</a>:</h4>
<p>We have the following jars under userlib.<br>
      fhir-smart-4.9.2.jar<br>
      java-jwt-3.13.0.jar</p>
<p>For the previous versions of IBM FHIR we had this same set of jars and it worked fine.</p>



<a name="256430598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/256430598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#256430598">(Oct 06 2021 at 15:29)</a>:</h4>
<p>OK, I additionally have these ones:</p>
<ul>
<li>commons-codec-1.14.jar</li>
<li>jackson-annotations-2.11.0.jar</li>
<li>jackson-core-2.11.0.jar</li>
<li>jackson-databind-2.11.0.jar</li>
</ul>
<p>You may have just gotten lucky that those other ones were in our webapp.  Like maybe the Cassandra stuff that was in there was pulling those in, but for 4.9.2 we slimmed it down a bit (via <a href="https://github.com/IBM/FHIR/pull/2757">https://github.com/IBM/FHIR/pull/2757</a>).</p>



<a name="256430787"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/256430787" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#256430787">(Oct 06 2021 at 15:30)</a>:</h4>
<p>With that said, this conversation has motivated me to see about removing our java-jwt dependency (the thing that pulls in those transitive dependencies).  So I opened <a href="https://github.com/IBM/FHIR/pull/2833">https://github.com/IBM/FHIR/pull/2833</a> as a draft PR...let me know what you think.</p>



<a name="256430879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/oAuth/near/256430879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/oAuth.html#256430879">(Oct 06 2021 at 15:30)</a>:</h4>
<p>Unless we do something like that, you'll need to be sure you're packaging all the fhir-smart dependencies in userlib</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
