---
layout: page
title: "FHIR Chat  · Delete Job · ibm"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/index.html">ibm</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html">Delete Job</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="260089599"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260089599" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260089599">(Nov 03 2021 at 04:46)</a>:</h4>
<p>While testing a case (BDE-10: Bulk Data Server returns "202 Accepted" for delete request) in Inferno we received the following exception. Please let us know how do we handle this.</p>
<p>Job deletion is not supported with the configured (in-memory) database.</p>
<p>com.ibm.fhir.exception.FHIROperationException: Job deletion is not supported with the configured (in-memory) database.  [probeId=ac-1e-0-bf-64dd1ae5-19b6-4b78-87b3-829a85a226cd]<br>
at com.ibm.fhir.operation.bulkdata.util.BulkDataExportUtil.buildOperationException(BulkDataExportUtil.java:143)<br>
at com.ibm.fhir.operation.bulkdata.util.BulkDataExportUtil.buildOperationException(BulkDataExportUtil.java:139)<br>
at com.ibm.fhir.operation.bulkdata.client.action.batch.BatchCancelRequestAction.run(BatchCancelRequestAction.java:120)<br>
at com.ibm.fhir.operation.bulkdata.client.BulkDataClient.delete(BulkDataClient.java:517)<br>
at com.ibm.fhir.operation.bulkdata.processor.impl.ExportImportImpl.delete(ExportImportImpl.java:154)<br>
at com.ibm.fhir.operation.bulkdata.StatusOperation.doInvoke(StatusOperation.java:61)<br>
at com.ibm.fhir.server.operation.spi.AbstractOperation.invoke(AbstractOperation.java:57)<br>
at com.ibm.fhir.server.util.FHIRRestHelper.doInvoke(FHIRRestHelper.java:1171)<br>
at com.ibm.fhir.server.resources.Operation.invokeDelete(Operation.java:171)<br>
at com.ibm.fhir.server.resources.Operation$Proxy$_$$_WeldClientProxy.invokeDelete(Unknown Source)<br>
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>
at java.lang.reflect.Method.invoke(Method.java:498)<br>
at com.ibm.ws.jaxrs20.cdi.component.JaxRsFactoryImplicitBeanCDICustomizer.serviceInvoke(JaxRsFactoryImplicitBeanCDICustomizer.java:342)<br>
at com.ibm.ws.jaxrs20.server.LibertyJaxRsServerFactoryBean.performInvocation(LibertyJaxRsServerFactoryBean.java:641)<br>
at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.performInvocation(LibertyJaxRsInvoker.java:160)<br>
at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:101)<br>
at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:273)<br>
at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:213)<br>
at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:444)<br>
at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:112)<br>
at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:59)<br>
at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:96)<br>
at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)<br>
at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:123)<br>
at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:274)<br>
at com.ibm.ws.jaxrs20.endpoint.AbstractJaxRsWebEndpoint.invoke(AbstractJaxRsWebEndpoint.java:137)<br>
at com.ibm.websphere.jaxrs.server.IBMRestServlet.handleRequest(IBMRestServlet.java:146)<br>
at com.ibm.websphere.jaxrs.server.IBMRestServlet.doDelete(IBMRestServlet.java:131)<br>
at javax.servlet.http.HttpServlet.service(HttpServlet.java:712)<br>
at com.ibm.websphere.jaxrs.server.IBMRestServlet.service(IBMRestServlet.java:96)<br>
at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1258)<br>
at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:746)<br>
at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:443)<br>
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.invokeTarget(WebAppFilterChain.java:183)<br>
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:94)<br>
at com.ibm.fhir.server.filter.rest.FHIRRestServletFilter.doFilter(FHIRRestServletFilter.java:155)<br>
at javax.servlet.http.HttpFilter.doFilter(HttpFilter.java:127)<br>
at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:197)<br>
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:91)<br>
at com.ibm.ws.security.jaspi.JaspiServletFilter.doFilter(JaspiServletFilter.java:56)<br>
at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:197)<br>
at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:91)<br>
at com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:1002)<br>
at com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1140)<br>
at com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1011)<br>
at com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:75)<br>
at com.ibm.ws.webcontainer40.servlet.CacheServletWrapper40.handleRequest(CacheServletWrapper40.java:85)<br>
at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:938)<br>
at com.ibm.ws.webcontainer.osgi.DynamicVirtualHost$2.run(DynamicVirtualHost.java:279)<br>
at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink$TaskWrapper.run(HttpDispatcherLink.java:1159)<br>
at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.wrapHandlerAndExecute(HttpDispatcherLink.java:428)<br>
at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.ready(HttpDispatcherLink.java:387)<br>
at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:566)<br>
at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleNewRequest(HttpInboundLink.java:500)<br>
at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.processRequest(HttpInboundLink.java:360)<br>
at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.ready(HttpInboundLink.java:327)<br>
at com.ibm.ws.channel.ssl.internal.SSLConnectionLink.determineNextChannel(SSLConnectionLink.java:1100)<br>
at com.ibm.ws.channel.ssl.internal.SSLConnectionLink$MyReadCompletedCallback.complete(SSLConnectionLink.java:675)<br>
at com.ibm.ws.channel.ssl.internal.SSLReadServiceContext$SSLReadCompletedCallback.complete(SSLReadServiceContext.java:1824)<br>
at com.ibm.ws.tcpchannel.internal.WorkQueueManager.requestComplete(WorkQueueManager.java:504)<br>
at com.ibm.ws.tcpchannel.internal.WorkQueueManager.attemptIO(WorkQueueManager.java:574)<br>
at com.ibm.ws.tcpchannel.internal.WorkQueueManager.workerRun(WorkQueueManager.java:958)<br>
at com.ibm.ws.tcpchannel.internal.WorkQueueManager$Worker.run(WorkQueueManager.java:1047)<br>
at com.ibm.ws.threading.internal.ExecutorServiceImpl$RunnableWrapper.run(ExecutorServiceImpl.java:238)<br>
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)<br>
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)<br>
at java.lang.Thread.run(Thread.java:748)</p>



<a name="260139722"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260139722" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260139722">(Nov 03 2021 at 14:15)</a>:</h4>
<p>the OpenLiberty jbatch default is to use an in-memory job database.  that doesn't support purging (what we do when we see a delete of a completed job).<br>
you'll need to use a real job database to support deletes.</p>



<a name="260239513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260239513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260239513">(Nov 04 2021 at 08:15)</a>:</h4>
<p>Thank you, Lee and Paul, delete job worked after we did the change suggested by Paul.</p>



<a name="260249965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260249965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260249965">(Nov 04 2021 at 10:11)</a>:</h4>
<p>Sorry there, the delete job worked just once. Now it fails. I have the configuration in bulkdata.xml as below <br>
    &lt;variable name="BATCH_DB_NAME" defaultValue="fhirdb"/&gt;<br>
    &lt;variable name="BATCH_DB_SCHEMA" defaultValue="fhir_jbatch"/&gt;<br>
    &lt;variable name="BATCH_DB_PORT" defaultValue="5432"/&gt;<br>
    &lt;variable name="BATCH_DB_USER" defaultValue="postgres"/&gt;<br>
    &lt;variable name="BATCH_DB_PASS" defaultValue="password"/&gt;<br>
    &lt;variable name="BATCH_DB_SSL" defaultValue=""/&gt;<br>
    &lt;variable name="BATCH_DB_SSL_CERT_PATH" defaultValue=""/&gt;</p>
<div class="codehilite"><pre><span></span><code>&lt;dataSource id=&quot;fhirbatchDS&quot; jndiName=&quot;jdbc/fhirbatchDB&quot; type=&quot;javax.sql.XADataSource&quot; statementCacheSize=&quot;200&quot; syncQueryTimeoutWithTransactionTimeout=&quot;true&quot;&gt;
    &lt;jdbcDriver javax.sql.XADataSource=&quot;org.postgresql.xa.PGXADataSource&quot; libraryRef=&quot;sharedLibPostgres&quot;/&gt;
    &lt;properties.postgresql
         serverName=&quot;localhost&quot;
         portNumber=&quot;${BATCH_DB_PORT}&quot;
         databaseName=&quot;${BATCH_DB_NAME}&quot;
         user=&quot;${BATCH_DB_USER}&quot;
         password=&quot;${BATCH_DB_PASS}&quot;                     
     /&gt;
    &lt;connectionManager maxPoolSize=&quot;200&quot; minPoolSize=&quot;40&quot;/&gt;
&lt;/dataSource&gt;
</code></pre></div>

<p>The error message we are getting is as below <br>
An authentication alias should be used instead of defining a user name and password on dataSource[fhirbatchDS].</p>
<p>[11/4/21 9:40:13:988 UTC] 0000001c com.ibm.fhir.server.filter.rest.FHIRRestServletFilter        I Received request: tenantId:[default] dsId:[default] user:[fhiruser] method:[DELETE] uri:[https://fhir.secureit.co.in:9443/fhir-server/api/v4/$bulkdata-status?job=LqzauvqtHSmkpChVHo%2B1MQ]<br>
[11/4/21 9:40:14:723 UTC] 0000001c com.ibm.ws.jca.cm.ConnectorService                           I J2CA8050I: An authentication alias should be used instead of defining a user name and password on dataSource[fhirbatchDS].<br>
[11/4/21 9:40:15:737 UTC] 0000001c com.ibm.fhir.server.resources.FHIRResource                   E The existing job has failed to delete<br>
com.ibm.fhir.exception.FHIROperationException: The existing job has failed to delete  [probeId=ac-1e-0-bf-e4b8d9d3-c645-488f-a4ba-a3478c83e38b]<br>
    at com.ibm.fhir.operation.bulkdata.util.BulkDataExportUtil.buildOperationException(BulkDataExportUtil.java:143)<br>
    at com.ibm.fhir.operation.bulkdata.util.BulkDataExportUtil.buildOperationException(BulkDataExportUtil.java:139)<br>
    at com.ibm.fhir.operation.bulkdata.client.action.batch.BatchCancelRequestAction.deleteJob(BatchCancelRequestAction.java:411)<br>
    at com.ibm.fhir.operation.bulkdata.client.action.batch.BatchCancelRequestAction.run(BatchCancelRequestAction.java:118)<br>
    at com.ibm.fhir.operation.bulkdata.client.BulkDataClient.delete(BulkDataClient.java:517)<br>
    at com.ibm.fhir.operation.bulkdata.processor.impl.ExportImportImpl.delete(ExportImportImpl.java:154)<br>
    at com.ibm.fhir.operation.bulkdata.StatusOperation.doInvoke(StatusOperation.java:61)<br>
    at com.ibm.fhir.server.operation.spi.AbstractOperation.invoke(AbstractOperation.java:57)<br>
    at com.ibm.fhir.server.util.FHIRRestHelper.doInvoke(FHIRRestHelper.java:1171)<br>
    at com.ibm.fhir.server.resources.Operation.invokeDelete(Operation.java:171)<br>
    at com.ibm.fhir.server.resources.Operation$Proxy$_$$_WeldClientProxy.invokeDelete(Unknown Source)<br>
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>
    at java.lang.reflect.Method.invoke(Method.java:498)<br>
    at com.ibm.ws.jaxrs20.cdi.component.JaxRsFactoryImplicitBeanCDICustomizer.serviceInvoke(JaxRsFactoryImplicitBeanCDICustomizer.java:342)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsServerFactoryBean.performInvocation(LibertyJaxRsServerFactoryBean.java:641)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.performInvocation(LibertyJaxRsInvoker.java:160)<br>
    at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:101)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:273)<br>
    at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:213)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:444)<br>
    at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:112)<br>
    at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:59)<br>
    at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:96)<br>
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)<br>
    at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:123)<br>
    at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:274)<br>
    at com.ibm.ws.jaxrs20.endpoint.AbstractJaxRsWebEndpoint.invoke(AbstractJaxRsWebEndpoint.java:137)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.handleRequest(IBMRestServlet.java:146)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.doDelete(IBMRestServlet.java:131)<br>
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:712)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.service(IBMRestServlet.java:96)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1258)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:746)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:443)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.invokeTarget(WebAppFilterChain.java:183)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:94)<br>
    at com.ibm.fhir.server.filter.rest.FHIRRestServletFilter.doFilter(FHIRRestServletFilter.java:155)<br>
    at javax.servlet.http.HttpFilter.doFilter(HttpFilter.java:127)<br>
    at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:197)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:91)<br>
    at com.ibm.ws.security.jaspi.JaspiServletFilter.doFilter(JaspiServletFilter.java:56)<br>
    at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:197)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:91)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:1002)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1140)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1011)<br>
    at com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:75)<br>
    at com.ibm.ws.webcontainer40.servlet.CacheServletWrapper40.handleRequest(CacheServletWrapper40.java:85)<br>
    at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:938)<br>
    at com.ibm.ws.webcontainer.osgi.DynamicVirtualHost$2.run(DynamicVirtualHost.java:279)<br>
    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink$TaskWrapper.run(HttpDispatcherLink.java:1159)<br>
    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.wrapHandlerAndExecute(HttpDispatcherLink.java:428)<br>
    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.ready(HttpDispatcherLink.java:387)<br>
    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:566)<br>
    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleNewRequest(HttpInboundLink.java:500)<br>
    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.processRequest(HttpInboundLink.java:360)<br>
    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.ready(HttpInboundLink.java:327)<br>
    at com.ibm.ws.channel.ssl.internal.SSLConnectionLink.determineNextChannel(SSLConnectionLink.java:1100)<br>
    at com.ibm.ws.channel.ssl.internal.SSLConnectionLink$MyReadCompletedCallback.complete(SSLConnectionLink.java:675)<br>
    at com.ibm.ws.channel.ssl.internal.SSLReadServiceContext$SSLReadCompletedCallback.complete(SSLReadServiceContext.java:1824)<br>
    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.requestComplete(WorkQueueManager.java:504)<br>
    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.attemptIO(WorkQueueManager.java:574)<br>
    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.workerRun(WorkQueueManager.java:958)<br>
    at com.ibm.ws.tcpchannel.internal.WorkQueueManager$Worker.run(WorkQueueManager.java:1047)<br>
    at com.ibm.ws.threading.internal.ExecutorServiceImpl$RunnableWrapper.run(ExecutorServiceImpl.java:238)<br>
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)<br>
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)<br>
    at java.lang.Thread.run(Thread.java:748)</p>
<p>[11/4/21 9:40:15:752 UTC] 0000001c com.ibm.fhir.server.filter.rest.FHIRRestServletFilter        I Completed request[1.765 secs]: tenantId:[default] dsId:[default] user:[fhiruser] method:[DELETE] uri:[https://fhir.secureit.co.in:9443/fhir-server/api/v4/$bulkdata-status?job=LqzauvqtHSmkpChVHo%2B1MQ] status:[500]</p>



<a name="260361761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260361761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260361761">(Nov 05 2021 at 03:09)</a>:</h4>
<p>Lee, did you get a chance to look at this?</p>



<a name="260371072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260371072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260371072">(Nov 05 2021 at 06:50)</a>:</h4>
<p>Hello Lee and Paul,</p>
<p>You can ignore the earlier message.</p>
<p>Here is the scenario:</p>
<p>After starting the ubuntu server, the very first time the 'job delete' works fine, at least we get the correct response code. But when I visited the logs, there were errors and the job delete was not completely successful. Please see an attached snapshot of different logs (SuccessfulJobDelete_Log.zip). <a href="/user_uploads/10155/oLDNFjcDjKxUiiyM8gjDwnRZ/SuccessfulJobDelete_Log.zip">SuccessfulJobDelete_Log.zip</a></p>
<p>When we attempted a fresh bulk export and further job delete it failed, I think it is because the earlier job delete was not completely successful. Please see attached logs (SecondJobDelete_Log.zip). <a href="/user_uploads/10155/qrcAqv2IiawPn66k1NjV_Izr/SecondJobDelete_Log.zip">SecondJobDelete_Log.zip</a></p>
<p>Please let me know if you need more information.</p>
<p>Thank you.</p>



<a name="260393664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260393664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260393664">(Nov 05 2021 at 11:31)</a>:</h4>
<p>Do you know how to retrieve the "job logs"?  The console logs you sent are interesting, but maybe the job logs will have more info on the first exception:</p>
<div class="codehilite"><pre><span></span><code>[INFO    ] FFDC1015I: An FFDC Incident has been created: &quot;java.lang.NullPointerException com.ibm.jbatch.container.artifact.proxy.ItemReaderProxy 40&quot; at ffdc_21.11.05_05.43.03.0.log
</code></pre></div>
<p>doc:  <a href="https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#4105-job-logs">https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#4105-job-logs</a></p>



<a name="260399300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260399300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260399300">(Nov 05 2021 at 12:38)</a>:</h4>
<p>Hello Lee, </p>
<p>Please see attached logs folder <a href="/user_uploads/10155/A79vGuagBKfxDfuHv-vM4Q6N/logs.zip">logs.zip</a>  after I tried a fresh bulk export followed by a successful delete. This was run through Inferno, and Inferno runs some other test cases apart from Bulk export and Delete. Please check only logs related to DELETE job.</p>
<p>Thank you.</p>



<a name="260751934"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/260751934" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#260751934">(Nov 09 2021 at 04:13)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> , </p>
<p>Did you get a chance to check the logs? Please let me know if you need more information.</p>
<p>Thank you, <br>
Sagar</p>



<a name="264989796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/264989796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#264989796">(Dec 15 2021 at 10:35)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="191676">@Lee Surprenant</span>  . <br>
We installed the latest IBM FHIR server, but the delete job fails intermittently. Did you get a chance to see the logs attached in the earlier chat here? Please let us know your thoughts. <br>
Thank you,<br>
Sagar</p>



<a name="265005314"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/265005314" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#265005314">(Dec 15 2021 at 12:55)</a>:</h4>
<p>Hi Sagar, thanks for your patience.  I suggest you open an issue at <a href="https://github.com/IBM/FHIR/issues">https://github.com/IBM/FHIR/issues</a> and attach your log.<br>
It looks to me like inferno is doing a Group/$export with the default resource types which results in an export job with 66 partitions.<br>
The job starts to run these partitions (4 at a time) and then we receive the DELETE.<br>
When our server receives the DELETE, it will take one of two actions:</p>
<ol>
<li>If the job is running, it will try to stop the job</li>
<li>If the job is completed, it will purge the job</li>
</ol>
<p>The job execution's step1 logs all look good to me...they recognize the DELETE and exit with a status of STOPPED.<br>
But then the overall execution gets marked with status FAILED for some reason:</p>
<div class="codehilite"><pre><span></span><code>[11/5/21 12:29:18:990 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   startedPartitions = [0, 1, 2, 3], numThreads = 3
[11/5/21 12:29:18:990 UTC] com.ibm.jbatch.container.context.impl.JobContextImpl           Returing ref (non-clone) to job context properties
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   Calling analyzeStatus(): PartitionReplyMsg: partition #: 3exec info: TopLevelNameIntanceExecutionInfo:jobName=bulkgroupexportchunkjob:instanceId=2:executionId=2, PARTITION_FINAL_STATUS, FAILED, FAILED
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   CWWKY0013I: Partition 3 ended with batch status FAILED and exit status FAILED for step step1 for job instance 2 and job execution 2.
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   Iterate through loop with finishedPartitions = [com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl$FinishedPartition@4e6ab5ff, com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl$FinishedPartition@66ff0a1e, com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl$FinishedPartition@53a4855b]
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   startedPartitions = [0, 1, 2, 3, 4], numThreads = 3
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.context.impl.JobContextImpl           Returing ref (non-clone) to job context properties
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   For partitioned step: step1, the partition # 1 ended with status &#39;COMPLETED
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   For partitioned step: step1, the partition # 0 ended with status &#39;COMPLETED
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   For partitioned step: step1, the partition # 3 ended with status &#39;FAILED
[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.BaseStepControllerI   CWWKY0019W: Step step1 failed with batch status FAILED and exit status null for job instance 2 and job execution 2.
[11/5/21 12:29:19:465 UTC] com.ibm.jbatch.container.controller.impl.BaseStepControllerI   CWWKY0030I: An exception occurred while running the step step1.
com.ibm.jbatch.container.exception.BatchContainerRuntimeException: One or more partitions failed: [For partitioned step: step1, the partition # 3 ended with status &#39;FAILED]
    at com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl.checkFinishedPartitionsForFailures(PartitionedStepControllerImpl.java:1021)
    at com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl.invokeCoreStep(PartitionedStepControllerImpl.java:475)
    at com.ibm.jbatch.container.controller.impl.BaseStepControllerImpl.execute(BaseStepControllerImpl.java:295)
    at com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl.execute(PartitionedStepControllerImpl.java:201)
    at com.ibm.jbatch.container.controller.impl.ExecutionTransitioner.doExecutionLoop(ExecutionTransitioner.java:118)
    at com.ibm.jbatch.container.controller.impl.WorkUnitThreadControllerImpl.executeCoreTransitionLoop(WorkUnitThreadControllerImpl.java:96)
    at com.ibm.jbatch.container.controller.impl.WorkUnitThreadControllerImpl.executeWorkUnit(WorkUnitThreadControllerImpl.java:178)
    at com.ibm.jbatch.container.controller.impl.WorkUnitThreadControllerImpl$AbstractControllerHelper.runExecutionOnThread(WorkUnitThreadControllerImpl.java:503)
    at com.ibm.jbatch.container.controller.impl.WorkUnitThreadControllerImpl.runExecutionOnThread(WorkUnitThreadControllerImpl.java:92)
    at com.ibm.jbatch.container.util.BatchWorkUnit.run(BatchWorkUnit.java:113)
    at com.ibm.ws.context.service.serializable.ContextualRunnable.run(ContextualRunnable.java:79)
    at com.ibm.ws.threading.internal.ExecutorServiceImpl$RunnableWrapper.run(ExecutorServiceImpl.java:238)
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
    at java.util.concurrent.FutureTask.run(FutureTask.java:266)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
    at java.lang.Thread.run(Thread.java:748)
</code></pre></div>
<p>Still, it proceeds to set the overall job batch status (and the Job Exist Status) to STOPPED.<br>
Then, we try the purge and it fails with the following:</p>
<div class="codehilite"><pre><span></span><code>[11/5/21 12:29:19:436 UTC] 00000031 com.ibm.ws.logging.internal.impl.IncidentImpl                I FFDC1015I: An FFDC Incident has been created: &quot;com.ibm.ws.jbatch.rest.internal.resources.RequestException: The specified job instance, 2, cannot be purged because it has active job executions. com.ibm.ws.jbatch.rest.internal.resources.RequestRouter 71&quot; at ffdc_21.11.05_12.29.19.1.log
[11/5/21 12:29:19:464 UTC] 0000001d com.ibm.ws.logging.internal.impl.IncidentImpl                I FFDC1015I: An FFDC Incident has been created: &quot;com.ibm.jbatch.container.exception.BatchContainerRuntimeException: One or more partitions failed: [For partitioned step: step1, the partition # 3 ended with status &#39;FAILED] com.ibm.jbatch.container.controller.impl.BaseStepControllerImpl 296&quot; at ffdc_21.11.05_12.29.19.0.log
</code></pre></div>
<p>It will take some work to investigate any further, but we already have a couple folks looking into bulkdata right now, so the timing is good.  Thanks again.</p>



<a name="265116017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/265116017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#265116017">(Dec 16 2021 at 06:10)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> </p>
<p>Thank you for your reply, I have created an issue at <a href="https://github.com/IBM/FHIR/issues/3120">https://github.com/IBM/FHIR/issues/3120</a> . Also attached fresh set of logs in the issue.<br>
Please assign it appropriately and let me know if you need more information.</p>
<p>Thank you,<br>
Sagar</p>



<a name="265156603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/265156603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#265156603">(Dec 16 2021 at 13:39)</a>:</h4>
<p>HI <span class="user-mention" data-user-id="392120">@Sagar Sarvankar</span> basically your job is a STOPPING state with <code>"batchStatus": "STOPPING",[\n]"</code> it's looping over this status.  When you run with <code>trace.specification = *=fine</code>  you essentially bury the machine, and extend the amount of time it takes to process the batch job being stopped.  Could you retry with <code>*=info:- org.jboss.*=FINE:io.openliberty.microprofile.*=FINE:com.ibm.fhir.*=FINE:javax.batch.*=FINE:com.ibm.ws.jbatch.*=FINE:com.ibm.ws.*=INFO:com.ibm.jbatch.*=FINE:com.ibm.ws.jbatch.rest.*=FINEST</code>?   Also is there a reason you running with OpenJDK 1.8? Using the OpenJ9 (Semeru JVM) may actually help performance wise - <a href="https://developer.ibm.com/languages/java/semeru-runtimes/downloads/">https://developer.ibm.com/languages/java/semeru-runtimes/downloads/</a></p>



<a name="265290229"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Delete%20Job/near/265290229" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Delete.20Job.html#265290229">(Dec 17 2021 at 12:41)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="192632">@Paul Bastide</span> , <br>
Thank you for your quick reply.  I did the changes that you mentioned, but those did not work.</p>
<p>Here is the pattern I identified in the cases that it passes and fails.</p>
<p>Using Postman:<br>
Performed two different requests<br>
GET            <a href="https://fhirserver.justtest.in:9443/fhir-server/api/v4/Group/17db31227ca-52d96331-11d8-4ebd-8bc5-f4ef2d39a4ec/$export">https://fhirserver.justtest.in:9443/fhir-server/api/v4/Group/17db31227ca-52d96331-11d8-4ebd-8bc5-f4ef2d39a4ec/$export</a><br>
DELETE     <a href="https://fhirserver.justtest.in:9443/fhir-server/api/v4/$bulkdata-status?job=k_d8cTAU%2BUeVEwqURPZ3oA">https://fhirserver.justtest.in:9443/fhir-server/api/v4/$bulkdata-status?job=k_d8cTAU%2BUeVEwqURPZ3oA</a></p>
<p>After the GET is completed, if I quickly do a DELETE then job gets deleted and returns success.<br>
After the GET is completed, if I take my own time to send DELETE, then it returns Internal Server Error (500).</p>
<p>Looking at the logs I observed that, if the DELETE is sent while the export is in progress it works, else it returns 500. I am not sure if that observation is correct. I have attached the Postman logs of both the above scenarios. Could you please check that? <a href="/user_uploads/10155/ZhtTTTGFw_QG-WPkgMUBv0BM/Postman.zip">Postman.zip</a></p>
<p>Using Inferno:<br>
Tried several times and it just worked once, whereas it failed all the times otherwise. Could you please check the logs for the same here? <a href="/user_uploads/10155/PU-g96azGprhWrjuHb7uKVEY/Inferno.zip">Inferno.zip</a></p>
<p>We are very close in passing the Inferno tool with IBM FHIR. If the DELETE works fine, we will be good.</p>
<p>Please let me know your thoughts.</p>
<p>Regards,<br>
Sagar</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
