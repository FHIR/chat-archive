---
layout: page
title: "FHIR Chat  · Discussion · ibm"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/index.html">ibm</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html">Discussion</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="182673319"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182673319" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182673319">(Dec 05 2019 at 15:58)</a>:</h4>
<p>A new entry in the performance testing landscape:  <a href="#narrow/stream/179239-tooling/topic/Tests.20for.20FHIR.20REST.20API.3A.20stresty" title="#narrow/stream/179239-tooling/topic/Tests.20for.20FHIR.20REST.20API.3A.20stresty">https://chat.fhir.org/#narrow/stream/179239-tooling/topic/Tests.20for.20FHIR.20REST.20API.3A.20stresty</a></p>



<a name="182673411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182673411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182673411">(Dec 05 2019 at 15:59)</a>:</h4>
<p>The other one (thats been on my list to look into again for a LONG time) was <a href="https://github.com/FirelyTeam/Wind.Tunnel" target="_blank" title="https://github.com/FirelyTeam/Wind.Tunnel">https://github.com/FirelyTeam/Wind.Tunnel</a></p>



<a name="182673438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182673438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182673438">(Dec 05 2019 at 15:59)</a>:</h4>
<p>would be great if we could help one of these get to "industry benchmark" level</p>



<a name="182723739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182723739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182723739">(Dec 06 2019 at 02:14)</a>:</h4>
<p>I wonder what we do on this front:  <a href="#narrow/stream/179166-implementers/topic/Searching.20with.20_elements.20and.20choice.20types" title="#narrow/stream/179166-implementers/topic/Searching.20with.20_elements.20and.20choice.20types">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Searching.20with.20_elements.20and.20choice.20types</a></p>



<a name="182723753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182723753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182723753">(Dec 06 2019 at 02:14)</a>:</h4>
<p>since its built into our parser, i'm guessing we actually want the full choiceElement (e.g. valueQuantity and not just value)?</p>



<a name="182776374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182776374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182776374">(Dec 06 2019 at 16:17)</a>:</h4>
<p><span class="user-mention" data-user-id="197632">@Gidon Gershinsky</span> I saw your post at <a href="#narrow/stream/179250-bulk-data/topic/Parquet.20Bulk.20Data.20format" title="#narrow/stream/179250-bulk-data/topic/Parquet.20Bulk.20Data.20format">https://chat.fhir.org/#narrow/stream/179250-bulk-data/topic/Parquet.20Bulk.20Data.20format</a> :-)<br>
I'm not sure if it helps you or not, but we have a module called <code>fhir-examples</code> which contains:</p>
<ol>
<li>all examples from the fhir spec;</li>
<li>a set of generated examples from us which includes:</li>
</ol>
<ul>
<li>"minimal" examples for each </li>
<li>"complete-mock" examples which include fake data in every field</li>
<li>"complete-absent" examples which include every field but no data</li>
<li>a set of "index" files for quickly iterating over subsets of the examples</li>
</ul>
<ol start="3">
<li>a couple simple java classes to help get a Reader for the index files and resource examples</li>
</ol>



<a name="182776525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182776525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182776525">(Dec 06 2019 at 16:18)</a>:</h4>
<p>"complete-absent" examples are especially helpful for finding cases where you fail to deal with the fact all fhir primitives can have extensions and no data (a common source of NullPointerExceptions)</p>



<a name="182776823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182776823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182776823">(Dec 06 2019 at 16:21)</a>:</h4>
<p>finally, to ensure strong test coverage, the generated examples include at least one resource example for each allowed "choice".  for example, if a resource has an element choice[x] with 3 allowed choices, we generate at least 3 examples of this resource.</p>



<a name="182777501"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182777501" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182777501">(Dec 06 2019 at 16:28)</a>:</h4>
<p>(deleted)</p>



<a name="182894357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182894357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gidon Gershinsky <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182894357">(Dec 08 2019 at 14:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191676">@Lee Surprenant</span>  thanks, this is certainly helpful. We understand Parquet encryption, but any assistance with FHIR will be appreciated. In fact, it will be great if we can work together on that channel, pushing Parquet-for-FHIR-standard; or, at the very least, if we can be in touch with you to get advice on FHIR-related questions.</p>



<a name="182967223"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182967223" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182967223">(Dec 09 2019 at 15:37)</a>:</h4>
<p><span class="user-mention" data-user-id="197632">@Gidon Gershinsky</span> <span class="user-mention" data-user-id="251796">@Eliot Salant</span> <br>
per a quick search, here are the spec examples with contained resources:</p>
<div class="codehilite"><pre><span></span>activitydefinition-medicationorder-example.json
activitydefinition-questionnaire.json
actualgroup-questionnaire.json
allergyintolerance-questionnaire.json
auditevent-example-error.json
auditevent-questionnaire.json
biologicallyderivedproduct-questionnaire.json
bmi-questionnaire.json
bodyheight-questionnaire.json
bodytemp-questionnaire.json
bodyweight-questionnaire.json
bp-questionnaire.json
careplan-example-f001-heart.json
careplan-example-f002-lung.json
careplan-example-f003-pharynx.json
careplan-example-f201-renal.json
careplan-example-f202-malignancy.json
careplan-example-f203-sepsis.json
careplan-example-GPVisit.json
careplan-example-integrated.json
careplan-example-pregnancy.json
careplan-example.json
careplan-questionnaire.json
careteam-example.json
catalog-questionnaire.json
cdshooksrequestgroup-questionnaire.json
cdshooksserviceplandefinition-questionnaire.json
chargeitem-questionnaire.json
cholesterol-questionnaire.json
claim-example-cms1500-medical.json
claim-example-oral-bridge.json
claim-example-oral-contained-identifier.json
claim-example-oral-contained.json
claim-example-vision-glasses-3tier.json
claim-questionnaire.json
claimresponse-questionnaire.json
clinicaldocument-questionnaire.json
clinicalimpression-questionnaire.json
codesystem-questionnaire.json
communication-example-fm-solicited-attachment.json
communication-questionnaire.json
communicationrequest-example-fm-solicit-attachment.json
communicationrequest-questionnaire.json
composition-questionnaire.json
computableplandefinition-questionnaire.json
conceptmap-questionnaire.json
condition-questionnaire.json
consent-questionnaire.json
contract-questionnaire.json
coverage-questionnaire.json
coverageeligibilityrequest-questionnaire.json
coverageeligibilityresponse-example-benefits-2.json
coverageeligibilityresponse-questionnaire.json
cqf-questionnaire-questionnaire.json
cqllibrary-questionnaire.json
detectedissue-questionnaire.json
devicedefinition-questionnaire.json
devicemetricobservation-questionnaire.json
devicerequest-questionnaire.json
deviceusestatement-questionnaire.json
diagnosticreport-genetics-questionnaire.json
diagnosticreport-questionnaire.json
documentmanifest-example.json
documentmanifest-fm-attachment.json
documentreference-example.json
elementdefinition-de-questionnaire.json
encounter-example-home.json
eventdefinition-questionnaire.json
evidencevariable-questionnaire.json
explanationofbenefit-questionnaire.json
familymemberhistory-genetic-questionnaire.json
familymemberhistory-questionnaire.json
goal-questionnaire.json
group-questionnaire.json
groupdefinition-questionnaire.json
guidanceresponse-example.json
guidanceresponse-questionnaire.json
hdlcholesterol-questionnaire.json
headcircum-questionnaire.json
healthcareservice-example.json
heartrate-questionnaire.json
hlaresult-questionnaire.json
immunization-questionnaire.json
immunizationevaluation-questionnaire.json
immunizationrecommendation-questionnaire.json
implementationguide-questionnaire.json
invoice-questionnaire.json
json-edge-cases.json
ldlcholesterol-questionnaire.json
library-questionnaire.json
lipidprofile-questionnaire.json
list-example-double-cousin-relationship-pedigree.json
list-example-familyhistory-f201-roel.json
list-example-familyhistory-genetics-profile-annie.json
list-example-familyhistory-genetics-profile.json
measure-questionnaire.json
measurereport-cms146-cat1-example.json
measurereport-cms146-cat2-example.json
measurereport-cms146-cat3-example.json
media-questionnaire.json
medication-questionnaire.json
medicationadministration-questionnaire.json
medicationadministration0301.json
medicationadministration0302.json
medicationadministration0303.json
medicationadministration0304.json
medicationadministration0305.json
medicationadministration0306.json
medicationadministration0307.json
medicationadministration0309.json
medicationadministration0310.json
medicationadministration0311.json
medicationadministrationexample3.json
medicationdispense-questionnaire.json
medicationdispense0301.json
medicationdispense0302.json
medicationdispense0303.json
medicationdispense0304.json
medicationdispense0305.json
medicationdispense0306.json
medicationdispense0308.json
medicationdispense0309.json
medicationdispense0310.json
medicationdispense0312.json
medicationdispense0313.json
medicationdispense0314.json
medicationdispense0315.json
medicationdispense0317.json
medicationdispense0319.json
medicationdispense0320.json
medicationdispense0329.json
medicationdispense0330.json
medicationdispense0331.json
medicationdispenseexample8.json
medicationexample0301.json
medicationexample0302.json
medicationexample0303.json
medicationexample0304.json
medicationexample0305.json
medicationexample0306.json
medicationexample0307.json
medicationexample0308.json
medicationexample0309.json
medicationexample0310.json
medicationexample0311.json
medicationexample0312.json
medicationexample0316.json
medicationexample0320.json
medicationexample0321.json
medicationexample15.json
medicationknowledge-example.json
medicationknowledge-questionnaire.json
medicationrequest-questionnaire.json
medicationrequest0301.json
medicationrequest0302.json
medicationrequest0303.json
medicationrequest0304.json
medicationrequest0305.json
medicationrequest0306.json
medicationrequest0307.json
medicationrequest0309.json
medicationrequest0310.json
medicationrequest0315.json
medicationrequest0316.json
medicationrequest0317.json
medicationrequest0318.json
medicationrequest0319.json
medicationrequest0321.json
medicationrequest0322.json
medicationrequest0323.json
medicationrequest0328.json
medicationrequest0329.json
medicationrequest0330.json
medicationrequest0331.json
medicationrequest0332.json
medicationrequest0333.json
medicationrequest0336.json
medicationrequest0337.json
medicationrequest0338.json
medicationrequest0339.json
medicationrequestexample1.json
medicationstatement-questionnaire.json
medicationstatementexample1.json
medicationstatementexample2.json
medicationstatementexample7.json
medicinalproduct-questionnaire.json
medicinalproductauthorization-questionnaire.json
medicinalproductcontraindication-questionnaire.json
medicinalproductindication-questionnaire.json
medicinalproductinteraction-questionnaire.json
messagedefinition-questionnaire.json
messageheader-questionnaire.json
nutritionorder-questionnaire.json
observation-example-10minute-apgar-score.json
observation-example-1minute-apgar-score.json
observation-example-20minute-apgar-score.json
observation-example-2minute-apgar-score.json
observation-example-5minute-apgar-score.json
observation-genetics-questionnaire.json
observation-questionnaire.json
oxygensat-questionnaire.json
parameters-questionnaire.json
patient-questionnaire.json
picoelement-questionnaire.json
plandefinition-example-cardiology-os.json
plandefinition-example-kdn5-simplified.json
plandefinition-example.json
plandefinition-options-example.json
plandefinition-protocol-example.json
plandefinition-questionnaire.json
procedure-questionnaire.json
provenance-questionnaire.json
questionnaire-example-gcs.json
questionnaire-profile-example-ussg-fht.json
questionnaire-questionnaire.json
questionnaireresponse-example.json
questionnaireresponse-questionnaire.json
requestgroup-example.json
requestgroup-kdn5-example.json
requestgroup-questionnaire.json
researchdefinition-questionnaire.json
researchelementdefinition-questionnaire.json
resprate-questionnaire.json
riskassessment-example-population.json
riskassessment-questionnaire.json
servicerequest-example-lipid.json
servicerequest-example2.json
servicerequest-genetics-questionnaire.json
servicerequest-questionnaire.json
shareableactivitydefinition-questionnaire.json
shareablecodesystem-questionnaire.json
shareablelibrary-questionnaire.json
shareablemeasure-questionnaire.json
shareableplandefinition-questionnaire.json
shareablevalueset-questionnaire.json
specimen-example-isolate.json
specimen-example.json
specimen-questionnaire.json
specimendefinition-questionnaire.json
structuremap-questionnaire.json
substance-example-amoxicillin-clavulanate.json
substance-questionnaire.json
substancereferenceinformation-questionnaire.json
substancespecification-questionnaire.json
supplydelivery-questionnaire.json
supplyrequest-questionnaire.json
task-example1.json
task-questionnaire.json
triglyceride-questionnaire.json
valueset-example-hierarchical.json
valueset-nhin-purposeofuse.json
valueset-questionnaire.json
valuesets.json (2 matches)
vitalsigns-questionnaire.json
vitalspanel-questionnaire.json
</pre></div>



<a name="182967674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/182967674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#182967674">(Dec 09 2019 at 15:41)</a>:</h4>
<p>you have a couple options for getting them:</p>
<ol>
<li>download them from the spec:  navigate to <a href="https://www.hl7.org/fhir/downloads.html" target="_blank" title="https://www.hl7.org/fhir/downloads.html">https://www.hl7.org/fhir/downloads.html</a> and donwload the JSON "Examples"</li>
<li>grab them from our <code>fhir-examples</code> project...as indicated above we've copied all the spec examples into a module (and combined with some of our own) and added a couple helper classes for getting them.  for example, you could add a new <code>index</code> file that contains just the examples listed above</li>
</ol>



<a name="187451022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/187451022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#187451022">(Feb 05 2020 at 13:03)</a>:</h4>
<p><span class="user-mention" data-user-id="192334">@John Timm</span> where, in your opinion, would a utility such as this belong:</p>
<div class="codehilite"><pre><span></span>    protected Code convertToCodeSubtype(Visitable parent, String elementName, Code value) {
        Class&lt;?&gt; targetType = ModelSupport.getElementType(parent.getClass(), elementName);
        if (value.getClass() != targetType) {
            MethodType mt = MethodType.methodType(targetType, String.class);
            try {
                MethodHandle methodHandle = MethodHandles.publicLookup().findStatic(targetType, &quot;of&quot;, mt);
                value = (Code) methodHandle.invoke(((Code)value).getValue());
            } catch (Throwable e) {
                throw new IllegalArgumentException(&quot;Value of type &#39;&quot; + value.getClass() +
                    &quot;&#39; cannot be used to populate target of type &#39;&quot; + targetType + &quot;&#39;&quot;);
            }
        }
        return value;
    }
</pre></div>



<a name="187451096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/187451096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#187451096">(Feb 05 2020 at 13:04)</a>:</h4>
<p>currently I have that in the CopyingVisitor which my FHIRPathPatch visitors extend (they are the only ones using it today), but I'm wondering if it should be a static helper instead</p>



<a name="187558145"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/187558145" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#187558145">(Feb 06 2020 at 15:33)</a>:</h4>
<p><span class="user-mention" data-user-id="192334">@John Timm</span> another one for you.  Today we have both:</p>
<ul>
<li><code>ModelSupport.getTypeName(Class&lt;?&gt; type)</code></li>
<li>
<p><code>ModelSupport.getResourceTypes()</code><br>
 and </p>
</li>
<li>
<p><code>FHIRUtil.getResourceTypeName(Resource resource)</code></p>
</li>
<li><code>FHIRUtil.getResourceTypeNames()</code> </li>
</ul>
<p>In general, I think we were deprecating the methods in FHIRUtil and switching things over to ModelSupport.<br>
Should we deprecate <code>FHIRUtil.getResourceTypeNames()</code> in favor of <code>ModelSupport.getResourceTypes()</code>?<br>
Should we  introduce a <code>ModelSupport.getResourceTypeNames()</code> and deprecate  <code>FHIRUtil.getResourceTypeNames()</code>?</p>
<p>Also, as you look at <a href="https://github.com/IBM/FHIR/issues/623" target="_blank" title="https://github.com/IBM/FHIR/issues/623">https://github.com/IBM/FHIR/issues/623</a>, I'm wondering if we should have a variant of the <code>getResourceTypes()</code> and <code>getResourceTypeNames()</code> methods that controls whether or not they return:<br>
A. abstract supertypes like Resource / DomainResource; and/or<br>
B. "logical" resource types like MetadataResource (and/or Definition?)</p>



<a name="187559829"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/187559829" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#187559829">(Feb 06 2020 at 15:51)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="192334">John Timm</span> where, in your opinion, would a utility such as this belong:</p>
</blockquote>
<div class="codehilite"><pre><span></span>protected Code convertToCodeSubtype(Visitable parent, String elementName, Code value) {
    Class&lt;?&gt; targetType = ModelSupport.getElementType(parent.getClass(), elementName);
    if (value.getClass() != targetType) {
        MethodType mt = MethodType.methodType(targetType, String.class);
        try {
            MethodHandle methodHandle = MethodHandles.publicLookup().findStatic(targetType, &quot;of&quot;, mt);
            value = (Code) methodHandle.invoke(((Code)value).getValue());
        } catch (Throwable e) {
            throw new IllegalArgumentException(&quot;Value of type &#39;&quot; + value.getClass() + 
                &quot;&#39; cannot be used to populate target of type &#39;&quot; + targetType + &quot;&#39;&quot;);
        }
    }
    return value;
}
</pre></div>


<div class="codehilite"><pre><span></span>
</pre></div>


<p>I think we can leave it where it is for now. I think we'd like to encourage users of the API to use the code subtypes directly.</p>



<a name="187560034"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/187560034" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#187560034">(Feb 06 2020 at 15:53)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="192334">John Timm</span> another one for you.  Today we have both:</p>
<ul>
<li><code>ModelSupport.getTypeName(Class&lt;?&gt; type)</code></li>
<li>
<p><code>ModelSupport.getResourceTypes()</code><br>
 and </p>
</li>
<li>
<p><code>FHIRUtil.getResourceTypeName(Resource resource)</code></p>
</li>
<li><code>FHIRUtil.getResourceTypeNames()</code> </li>
</ul>
<p>In general, I think we were deprecating the methods in FHIRUtil and switching things over to ModelSupport.<br>
Should we deprecate <code>FHIRUtil.getResourceTypeNames()</code> in favor of <code>ModelSupport.getResourceTypes()</code>?<br>
Should we  introduce a <code>ModelSupport.getResourceTypeNames()</code> and deprecate  <code>FHIRUtil.getResourceTypeNames()</code>?</p>
<p>Also, as you look at <a href="https://github.com/IBM/FHIR/issues/623" target="_blank" title="https://github.com/IBM/FHIR/issues/623">https://github.com/IBM/FHIR/issues/623</a>, I'm wondering if we should have a variant of the <code>getResourceTypes()</code> and <code>getResourceTypeNames()</code> methods that controls whether or not they return:<br>
A. abstract supertypes like Resource / DomainResource; and/or<br>
B. "logical" resource types like MetadataResource (and/or Definition?)</p>
</blockquote>
<p>There's really only one logical resource type that we need to deal with at the moment (MetadataResource). The list will should not return "logical" resource types once 623 is completed. As for "abstract" resource types, the client could filter those out pretty easily (really it's only Resource and DomainResource). I will think about this as I work 623 and whether we should introduce other method signatures. I agree that we should deprecate FHIRUtil methods that overlap with ModelSupport.</p>



<a name="188478011"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/188478011" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#188478011">(Feb 18 2020 at 18:34)</a>:</h4>
<p><span class="user-mention" data-user-id="197632">@Gidon Gershinsky</span> <span class="user-mention" data-user-id="251796">@Eliot Salant</span> FYI I wrote up a guide on "how to create a new persistence layer" for the IBM FHIR Server:  <a href="https://ibm.github.io/FHIR/guides/BringYourOwnPersistence" target="_blank" title="https://ibm.github.io/FHIR/guides/BringYourOwnPersistence">https://ibm.github.io/FHIR/guides/BringYourOwnPersistence</a></p>



<a name="188478018"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/188478018" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#188478018">(Feb 18 2020 at 18:34)</a>:</h4>
<p>please let me know what you think</p>



<a name="194673259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/194673259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#194673259">(Apr 20 2020 at 13:19)</a>:</h4>
<p>I recently did some work to enable OpenID Connect / OAuth 2.0 in my local branch.  We've had some exemplary config commented out in our default <code>server.xml</code> for quite some time, but I never had the time to try it out until now.<br>
<a href="https://github.com/IBM/FHIR/pull/939" title="https://github.com/IBM/FHIR/pull/939">https://github.com/IBM/FHIR/pull/939</a> modifies this commented out config in order to pass more of the Inferno test tool, although work remains to pass more of it.</p>



<a name="194673972"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/194673972" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#194673972">(Apr 20 2020 at 13:25)</a>:</h4>
<p>One thing I discovered during this effort is that Liberty supports "dynamic client registration", but that it requires you to create 3 tables associated with storing and caching the clients in a databaseStore.<br>
Paul added a comment to suggest moving the DDL for these tables out of our doc and into somewhere more executable:<br>
<a href="https://github.com/IBM/FHIR/pull/939/files/6f1f9c3c1a2fd1cf39932974b3884dc01c5f183b#diff-46968fda8c8c67feeaad01de47b14d30" title="https://github.com/IBM/FHIR/pull/939/files/6f1f9c3c1a2fd1cf39932974b3884dc01c5f183b#diff-46968fda8c8c67feeaad01de47b14d30">https://github.com/IBM/FHIR/pull/939/files/6f1f9c3c1a2fd1cf39932974b3884dc01c5f183b#diff-46968fda8c8c67feeaad01de47b14d30</a></p>
<p>Question:  is it worth moving these into <code>fhir-persistence-schema</code> so they can get created like the rest of our tables?<br>
Should they have their own separate "action"? (e.g. a <code>--oauth-client-store</code> flag you pass to the tool to have it create these)?</p>



<a name="194811886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/194811886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#194811886">(Apr 21 2020 at 14:43)</a>:</h4>
<p>I think it's worthy of a separate action</p>



<a name="194811930"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/194811930" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#194811930">(Apr 21 2020 at 14:43)</a>:</h4>
<p>when I see it laid out here, I think a separate flag makes sense</p>



<a name="194811940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/194811940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#194811940">(Apr 21 2020 at 14:43)</a>:</h4>
<p>it's a good idea</p>



<a name="194855282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/194855282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#194855282">(Apr 21 2020 at 20:12)</a>:</h4>
<p>haha, I just pushed an update that creates it as part of the create-schema and update-schema actions</p>



<a name="194855316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/194855316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#194855316">(Apr 21 2020 at 20:12)</a>:</h4>
<p>i pushed and then signed on here and saw your messages</p>



<a name="194925162"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/194925162" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#194925162">(Apr 22 2020 at 12:55)</a>:</h4>
<p>no worries - I think both are fine!</p>



<a name="212329606"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212329606" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike Schroeder <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212329606">(Oct 05 2020 at 17:15)</a>:</h4>
<p>Issue 1504 analysis:</p>
<p><strong>Current processing of local references for transaction bundles:</strong></p>
<ol>
<li>bundle entries can have a local reference specified in the Bundle.Entry.fullUrl field - the local reference must start with 'urn:'</li>
<li>for resources specified in POST and PUT requests, we look for reference fields containing references starting with 'urn:' and if they match a bundle entry local reference, we replace them with the actual resource reference of the resource in the matching bundle entry</li>
<li>
<p>we build a map of [local reference --&gt; real resource reference] to enable the local reference resolution in the previous step. The map is built as follows:<br>
   a. after a POST request is processed, its [local ref --&gt; real resource ref] mapping is added to the map (because it's only at that point that we know the logical ID the resource was created with)<br>
   b. after all POST resources have been processed, but before any PUT resources have been processed, all PUT [local ref --&gt; real resource ref] mappings are added to the map (we can do this before processing because PUT requests are updates, so resources already have logical ID set)</p>
</li>
<li>
<p>processing order of requests is all POST requests first, then PUT requests</p>
</li>
</ol>
<p><strong>With current code, the following scenarios work:</strong></p>
<ol>
<li>any POST resource containing a local reference to a POST resource processed before it in the bundle will have the reference resolved properly because each POST resource has its mapping added to the map after being processed, meaning a mapping for a resource already processed will exist when a resource lower in the bundle is processed</li>
<li>any PUT resource containing a local reference to a POST resource will have the reference resolved properly because all POST resources will have their mappings added to the map before any PUT resources are processed.</li>
<li>any PUT resource containing a local reference to another PUT resource will have the reference resolved properly because all PUT resources will have their mappings added to the map before any PUT resources are processed.</li>
</ol>
<p><strong>With current code, the following scenarios fail:</strong></p>
<ol>
<li>any POST resource containing a local reference to a PUT resource will not have the reference resolved properly because the PUT resources will not have their mappings added to the map until after all POST resources have been processed.</li>
<li>any POST resource containing a local reference to a POST resource below it in the bundle will not have the reference resolved properly because the POST resource lower in the bundle will not have its mapping in the map at the time the resource higher in the bundle is processed.</li>
</ol>
<p><strong>Options to fix failing scenarios:</strong></p>
<ul>
<li>Failing scenario 1 can be fixed simply by adding PUT resource mappings to the map before processing POST resources</li>
<li>Failing scenario 2 I think can only be fixed by 'pre-allocating' logical IDs for resources to be created. This would allow the mappings to be added to the map before processing any POST resources, but would require that the logical ID be passed into and used by the persistence layer on resource creation.</li>
</ul>
<p><strong>Cases where mapping can't be added until after resource is processed:</strong></p>
<ol>
<li>On POSTs, there is a conditional create option based on the Bundle.Entry.Request.ifNoneExist field. A search query can be specified in that field, and if a single search result is found for that query, the POSTed resource is not created. Instead, the metadata for the search result will be returned, meaning that the logical ID could be different than a pre-allocated ID. So if that Bundle.Entry.Request.ifNoneExist field is populated, we wouldn't want to add a mapping before processing that resource.</li>
<li>On PUTs, there is a conditional update option based on the Bundle.Entry.Request.url field. A search query can be specified on the end of that url (i.e. Patient?_id=abc). If no search results are returned for the query AND if the resource ID is null, a create will be performed rather than an update, meaning we wouldn't know the logical ID until after the create. So if the Bundle.Entry.Request.url field contains a query string, we wouldn't want to add a mapping before processing that resource.</li>
</ol>
<ul>
<li>For these cases, if we really wanted to support resolution of local references to them, we could execute the searches prior to fully processing the resources, just to get the logical ID for our mappings.</li>
</ul>



<a name="212334482"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212334482" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212334482">(Oct 05 2020 at 17:58)</a>:</h4>
<p>Great analysis.  Does FHIR spec say anything about those "failing scenarios"?  Trying to gauge whether a client should reasonably expect those scenarios to work or not...</p>



<a name="212334613"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212334613" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212334613">(Oct 05 2020 at 17:59)</a>:</h4>
<p>My current inclination would be to make the easy fix for scenario 1 and just punt on scenario 2 (unless we think this violates the specification in some way)</p>



<a name="212336541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212336541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike Schroeder <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212336541">(Oct 05 2020 at 18:14)</a>:</h4>
<p>The spec (<a href="https://www.hl7.org/fhir/http.html#transaction">https://www.hl7.org/fhir/http.html#transaction</a>) isn't real straight-forward, but it does say the following:<br>
<code>A transaction may include references from one resource to another in the bundle, including circular references where resources refer to each other. When the server assigns a new id to any resource in the bundle which has a POST method as part of the processing rules above, it SHALL also update any references to that resource in the same bundle as they are processed (see about Ids in a bundle).</code><br>
I think that implies we should probably support both failing scenarios. As far as the conditional create and updates, the spec says this:<br>
<code>Note that transactions and conditional create/update/delete are complex interactions and it is not expected that every server will implement them. Servers that don't support the batches or transactions SHOULD return an HTTP 400 error and MAY include an OperationOutcome. </code><br>
So I think it's more reasonable that we don't support local references to bundle entries with conditional creates/updates - the last 2 scenarios listed above.</p>



<a name="212339120"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212339120" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212339120">(Oct 05 2020 at 18:34)</a>:</h4>
<blockquote>
<p>it SHALL also update any references to that resource in the same bundle as they are processed (see about Ids in a bundle)</p>
</blockquote>
<p>really wonder what they mean by "as they are processed" there and whether it could be construed to support our current behavior where order matters</p>



<a name="212339299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212339299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212339299">(Oct 05 2020 at 18:36)</a>:</h4>
<p>i guess that reading doesn't jive with the "circular" comment</p>



<a name="212339841"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212339841" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212339841">(Oct 05 2020 at 18:40)</a>:</h4>
<p>so what would pre-computing resource ids look like?<br>
something like this:</p>
<ol>
<li>turn the "generate a new resource id into standalone utility (if it isn't already)...currently that is used in <code>create</code></li>
<li>use this utility to generate a resource id for any resources being created as part of the bundle</li>
<li>under the covers, during bundle processing, we switch all the <code>create</code> operations into <code>create-via-update</code> operations and pass our pre-allocated resource id to ResourceHelper.doUpdate (instead of calling doCreate like it does now)<br>
?</li>
</ol>



<a name="212339874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212339874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212339874">(Oct 05 2020 at 18:40)</a>:</h4>
<blockquote>
<p>So I think it's more reasonable that we don't support local references to bundle entries with conditional creates/updates - the last 2 scenarios listed above.</p>
</blockquote>
<p>+1 from me on this part of it</p>



<a name="212345108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212345108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike Schroeder <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212345108">(Oct 05 2020 at 19:22)</a>:</h4>
<p>I was thinking the following for the pre-allocation process:</p>
<p>Currently, the FHIRPersistence class generates the new ID in its create() method. I think we'd want to do the following:</p>
<ol>
<li>Turn the ID generator into stand-alone utility (one already exists for the JDBC persistence layer - TimestampPrefixedUUID - which is called by FHIRPersistenceJDBCImpl.create() ).</li>
<li>Either 1) add a new FHIRPersistence.create() interface, same as the current one except that it takes one additional parameter - 'logicalId', or 2) just change the existing create() interface to take the additional 'logicalId' parameter</li>
<li>Add a new ResourceHelper.doCreate() interface (or just change the existing doCreate() interface) that takes the additional 'logicalId' parameter, which will be passed along to the FHIRPersistence.create() method.</li>
<li>For all non-conditional POST requests, generate an ID and add a mapping to the [local ref--&gt;real resource ref] mapping table</li>
<li>Now just process the POST requests followed by the PUT requests as we do now, with the slight change that POST requests will pass their logicalId on the call to doCreate(). Since we've got a mapping for every non-conditional POST or PUT request in the mapping table before starting any processing, all local references should be resolved properly to their actual resource references, regardless of order of processing.  </li>
</ol>
<p>But I like your idea of calling doUpdate and using the <code>create-via-update</code>path instead of messing with adding/changing the doCreate() interfaces. Would just have to make sure the Bundle.Entry.Response sent back was equivalent to what would be sent back from doCreate.</p>



<a name="212345597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Discussion/near/212345597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Discussion.html#212345597">(Oct 05 2020 at 19:27)</a>:</h4>
<p>pretty sure that we do return a 201 when you PUT for the first time (create-on-update).  but seems your approach would work similarly.  no strong preference.  i think the most "interesting" bit will be where to put the newly-extracted utility for generating ids.  <br>
i sort of like the idea of delegating that to the PL (so, for example, our jdbc impl can generate these special ids, but a different PL could do simpler ones), but I think it will be much easier just move the code to <code>fhir-core</code> (or similar)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
