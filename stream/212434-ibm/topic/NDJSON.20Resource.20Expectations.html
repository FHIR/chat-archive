---
layout: page
title: "FHIR Chat  · NDJSON Resource Expectations · ibm"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/index.html">ibm</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html">NDJSON Resource Expectations</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="244715785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/244715785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#244715785">(Jul 02 2021 at 15:06)</a>:</h4>
<p>Hi </p>
<p>I need some help in bulk export. (IBM FHIR Server)</p>
<p>I am getting this error. I am using storageProviders type as file</p>
<p>{<br>
"resourceType": "OperationOutcome",<br>
"id": "c0-a8-0-69-5031ca80-1f6a-49b1-af4a-dfc757338946",<br>
"issue": [<br>
{<br>
"severity": "fatal",<br>
"code": "not-supported",<br>
"details": {<br>
"text": "storageType is disallowed, error processing request"<br>
},<br>
"expression": [<br>
"&lt;empty&gt;"<br>
]<br>
}<br>
]<br>
}</p>
<p>And here is my configuration</p>
<p>"storageProviders": {<br>
"default": {<br>
"type": "file",<br>
"_type": "ibm-cos|aws-s3|file|https",<br>
"validBaseUrls": [],<br>
"fileBase": "C:/Projects/Code/FHIR/IBM/liberty-runtime/wlp/usr/servers/fhir-server/output",<br>
"bucketName": "fhir-performance",<br>
"location": "us",<br>
"endpointInternal": "<a href="https://s3.us-east.cloud-object-storage.appdomain.cloud">https://s3.us-east.cloud-object-storage.appdomain.cloud</a>",<br>
"endpointExternal": "<a href="https://s3.us-east.cloud-object-storage.appdomain.cloud">https://s3.us-east.cloud-object-storage.appdomain.cloud</a>",<br>
"auth": {<br>
"type": "hmac",<br>
"accessKeyId": "key",<br>
"secretAccessKey": "secret"<br>
},<br>
"_iam_auth": {<br>
"type": "iam",<br>
"iamApiKey": "apiKey",<br>
"iamResourceInstanceId": "resourceId"<br>
},</p>



<a name="244732095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/244732095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#244732095">(Jul 02 2021 at 17:14)</a>:</h4>
<p>Are you subscribed in <a class="stream" data-stream-id="212434" href="/#narrow/stream/212434-ibm">#ibm</a> ? I'll migrate this question over there.</p>



<a name="244732142"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/244732142" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#244732142">(Jul 02 2021 at 17:14)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="179250" href="/#narrow/stream/179250-bulk-data/topic/NDJSON.20Resource.20Expectations">#bulk data &gt; NDJSON Resource Expectations</a> by <span class="user-mention silent" data-user-id="191315">Josh Mandel</span></p>



<a name="244960723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/244960723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#244960723">(Jul 05 2021 at 17:48)</a>:</h4>
<p>Please try this... </p>
<div class="codehilite"><pre><span></span><code>curl -k -u &quot;fhiruser:change-password&quot; -H &quot;Content-Type: application/fhir+json&quot; \
    -X GET &#39;https://localhost:9443/fhir-server/api/v4/$export?_outputFormat=application/fhir%2Bndjson&amp;_type=Patient&#39; -v
</code></pre></div>



<a name="245317612"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245317612" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245317612">(Jul 08 2021 at 14:06)</a>:</h4>
<p>Hi</p>
<p>For enabling smart module, are there any changes apart from fhir-server-config.json?<br>
We are testing with inferno testing tool and facing some issues.</p>
<p>Thanks<br>
Mahesh</p>



<a name="245331334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245331334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245331334">(Jul 08 2021 at 15:37)</a>:</h4>
<p>yes, the fhir-smart module extends the ibm fhir server for this use case but its not prepackaged.  its a little confusing.</p>



<a name="245331500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245331500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245331500">(Jul 08 2021 at 15:38)</a>:</h4>
<p>the documentation is in 5.3.3 under <a href="https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#53-openid-connect-and-oauth-20">https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#53-openid-connect-and-oauth-20</a></p>



<a name="245331617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245331617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245331617">(Jul 08 2021 at 15:39)</a>:</h4>
<p>so there's sort of three parts:</p>
<ol>
<li>configuring liberty to validate the tokens.  this can be skipped if the tokens are validated in front of the server</li>
<li>advertising support (this is what is done through the fhir-server-config file)</li>
<li>dropping the fhir-smart jar file into the server's userlib directory</li>
</ol>



<a name="245345314"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245345314" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245345314">(Jul 08 2021 at 17:33)</a>:</h4>
<p>Ok great I will try that. Also can we change the certificate? Seems that inferno testing tool doesn't like self signed s=certificate. Do you have any steps for that? </p>
<p>As we were testing some steps about security, we wanted to set security policy such that only few APIs are allowed e.g. Patient, Problem and Medication scopes. If we set that through OAuth then still it exposes other scopes also whereas it should not.</p>
<p>Thanks<br>
Mahesh</p>



<a name="245362382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245362382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245362382">(Jul 08 2021 at 19:48)</a>:</h4>
<p>Yes, you can change the certificate.  The docs for that are at <a href="https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#5231-configure-the-keystores">https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#5231-configure-the-keystores</a> but we mostly just rely on what Liberty provides for this.  If you happen to be running on Kubernetes, we might be able to offer some more guidance.</p>



<a name="245362561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245362561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245362561">(Jul 08 2021 at 19:50)</a>:</h4>
<blockquote>
<p>We wanted to set security policy such that only few APIs are allowed e.g. Patient, Problem and Medication scopes. If we set that through OAuth then still it exposes other scopes also whereas it should not.</p>
</blockquote>
<p>the SMART auth server is what adds the scopes to the token.  THe IBM FHIR Server fhir-smart module should properly enforce the granted SMART scopes.<br>
Its not clear to me which of those 2 you're having an issue with.  If you think the IBM FHIR Server (with the fhir-smart jar in the userlib) is returning resources it shouldn't, do let us know.</p>



<a name="245362787"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245362787" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245362787">(Jul 08 2021 at 19:51)</a>:</h4>
<p>seperately, its possible to restrict the IBM FHIR Server's REST api to select interactions on select resources types...if that is something you are interested in i can provide more info</p>



<a name="245429421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245429421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245429421">(Jul 09 2021 at 11:10)</a>:</h4>
<p>Hi Lee thanks a lot for detailed explanation. <a href="https://inferno.healthit.gov/inferno">https://inferno.healthit.gov/inferno</a> is the tool where are are testing FHIR Apis. Also we dropped in fhir-smart-4.8.3.pom<br>
fhir-smart-4.8.3.jar and some dependencies in userlib directory. Still getting some errors. Has anybody tested with Inferno? What changes are required to get it going with inferno? Does anybody has steps?</p>
<p>Thanks<br>
Mahesh</p>



<a name="245432633"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245432633" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245432633">(Jul 09 2021 at 11:50)</a>:</h4>
<p>I will anyway put any issues as we face it while testing</p>



<a name="245435337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245435337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245435337">(Jul 09 2021 at 12:21)</a>:</h4>
<p><strong>REQUEST: For allergy it fails</strong><br>
<a href="http://3.92.187.231:9443/fhir-server/api/v4/AllergyIntolerance?patient=17a818c38f8-229c1e6d-26a8-4b4a-aa8b-4bc81582bf4c">http://3.92.187.231:9443/fhir-server/api/v4/AllergyIntolerance?patient=17a818c38f8-229c1e6d-26a8-4b4a-aa8b-4bc81582bf4c</a></p>
<p>RESPONSE:<br>
{<br>
  "resourceType": "OperationOutcome",<br>
  "issue": [<br>
    {<br>
      "severity": "fatal",<br>
      "code": "invalid",<br>
      "details": {<br>
        "text": "Fault: 'com.ibm.fhir.search.parameters.QueryParameter com.ibm.fhir.search.util.SearchUtil.buildInclusionCriteria(java.lang.String, java.util.Set, java.lang.String)'"<br>
      }<br>
    }<br>
  ]<br>
}</p>
<p>Caused by: java.lang.NoSuchMethodError: 'com.ibm.fhir.search.parameters.QueryParameter com.ibm.fhir.search.util.SearchUtil.buildInclusionCriteria(java.lang.String, java.util.Set, java.lang.String)'<br>
    at com.ibm.fhir.smart.AuthzPolicyEnforcementPersistenceInterceptor.beforeSearch(AuthzPolicyEnforcementPersistenceInterceptor.java:162)<br>
    at com.ibm.fhir.persistence.interceptor.impl.FHIRPersistenceInterceptorMgr.fireBeforeSearchEvent(FHIRPersistenceInterceptorMgr.java:175)<br>
    at com.ibm.fhir.server.util.FHIRRestHelper.doSearch(FHIRRestHelper.java:1058)<br>
    at com.ibm.fhir.server.util.FHIRRestHelper.doSearch(FHIRRestHelper.java:999)<br>
    at com.ibm.fhir.server.resources.Search.doSearch(Search.java:73)<br>
    at com.ibm.fhir.server.resources.Search.searchGet(Search.java:51)<br>
    at com.ibm.fhir.server.resources.Search$Proxy$_$$_WeldClientProxy.searchGet(Unknown Source)<br>
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>
    at java.base/java.lang.reflect.Method.invoke(Method.java:566)<br>
    at com.ibm.ws.jaxrs20.cdi.component.JaxRsFactoryImplicitBeanCDICustomizer.serviceInvoke(JaxRsFactoryImplicitBeanCDICustomizer.java:342)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsServerFactoryBean.performInvocation(LibertyJaxRsServerFactoryBean.java:641)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.performInvocation(LibertyJaxRsInvoker.java:160)<br>
    at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:101)</p>
<p><strong>FOR DEVICE IT WORKS</strong><br>
<a href="http://3.92.187.231:9443/fhir-server/api/v4/Device?patient=17a818c38f8-229c1e6d-26a8-4b4a-aa8b-4bc81582bf4c">http://3.92.187.231:9443/fhir-server/api/v4/Device?patient=17a818c38f8-229c1e6d-26a8-4b4a-aa8b-4bc81582bf4c</a></p>



<a name="245435352"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245435352" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245435352">(Jul 09 2021 at 12:21)</a>:</h4>
<p>Do I need to so some config changes?</p>



<a name="245445823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245445823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245445823">(Jul 09 2021 at 13:52)</a>:</h4>
<p>Thats kind of a weird error.  Please make sure the version of <code>fhir-smart</code> you are using matches the version of the IBM FHIR Server that you're using.</p>



<a name="245445906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245445906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245445906">(Jul 09 2021 at 13:53)</a>:</h4>
<p>We've done some testing with inferno, although we found that the program edition didn't test what we were most interested in and so we've mostly used the community edition.</p>



<a name="245446966"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245446966" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245446966">(Jul 09 2021 at 14:01)</a>:</h4>
<p>Yeah that is same 4.8.3 both way. It seems that there are some dependencies or configuration settings which are causing issues. I found some issues similar to this. Not sure whether we need to make changes in search config file.</p>
<p><a href="https://github.com/IBM/FHIR/issues/300">https://github.com/IBM/FHIR/issues/300</a></p>
<p>BTW without Smart it works fine to get all the resources, but again it is wide open. Smart FHIR gives security but never returns required resources.</p>



<a name="245447898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245447898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245447898">(Jul 09 2021 at 14:08)</a>:</h4>
<p><a href="/user_uploads/10155/reVsp4nCAxlnssSWZchNVIjz/extension-search-parameters.json">extension-search-parameters.json</a> <a href="/user_uploads/10155/_7o2On8qSUd1_XCTsmLBWr7m/fhir-server-config.json">fhir-server-config.json</a></p>



<a name="245448524"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245448524" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245448524">(Jul 09 2021 at 14:13)</a>:</h4>
<p><a href="https://github.com/IBM/FHIR/issues/300">https://github.com/IBM/FHIR/issues/300</a> is quite different from a NoSuchMethodError:</p>



<a name="245448721"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245448721" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245448721">(Jul 09 2021 at 14:15)</a>:</h4>
<p>one place we've used for testing our fhir server together with keycloak for smart app launch is <a href="https://github.com/Alvearie/health-patterns/tree/main/data-access">https://github.com/Alvearie/health-patterns/tree/main/data-access</a></p>



<a name="245448766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245448766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245448766">(Jul 09 2021 at 14:15)</a>:</h4>
<p>i've been meaning to point inferno at that demo setup for a while but havn't gotten to it yet.  perhaps it could be of some use as an example.</p>



<a name="245449661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245449661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245449661">(Jul 09 2021 at 14:23)</a>:</h4>
<p>here are the libs used in that env:</p>
<div class="codehilite"><pre><span></span><code>$ ls fhir/userlib
commons-codec-1.14.jar         fhir-smart-4.8.3.jar           jackson-core-2.11.0.jar        java-jwt-3.13.0.jar
fhir-ig-us-core-4.8.3.jar      jackson-annotations-2.11.0.jar jackson-databind-2.11.0.jar
</code></pre></div>
<p>(my PR to bring it to 4.8.3 just got merged)</p>



<a name="245451707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245451707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245451707">(Jul 09 2021 at 14:38)</a>:</h4>
<p>oh we have java-jwt-3.13.0.pom, java-jwt-3.13.0.jar, fhir-smart-4.8.3.pom and fhir-smart-4.8.3.jar files only. Where I can find rest of jar files?</p>



<a name="245451765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245451765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245451765">(Jul 09 2021 at 14:39)</a>:</h4>
<p>i use maven to get them</p>



<a name="245451774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245451774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245451774">(Jul 09 2021 at 14:39)</a>:</h4>
<p>/home/ubuntu/liberty-runtime/wlp/usr/servers/fhir-server/userlib this is my folder</p>



<a name="245451908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245451908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245451908">(Jul 09 2021 at 14:40)</a>:</h4>
<p>oh ok let me search there and get them one by one and try out. the .pom files are needed right?</p>



<a name="245451936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245451936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245451936">(Jul 09 2021 at 14:40)</a>:</h4>
<p>here's the pom for this demo env:  <a href="https://github.com/lmsurpre/health-patterns/blob/main/data-access/pom.xml">https://github.com/lmsurpre/health-patterns/blob/main/data-access/pom.xml</a></p>



<a name="245451969"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245451969" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245451969">(Jul 09 2021 at 14:41)</a>:</h4>
<p>with a pom like that you can just mvn clean install and it will copy the transitive dependencies</p>



<a name="245451996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245451996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245451996">(Jul 09 2021 at 14:41)</a>:</h4>
<p>obviously its just one way to do it though</p>



<a name="245467640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245467640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245467640">(Jul 09 2021 at 16:50)</a>:</h4>
<p>Seems that following code is throwing error</p>
<p><a href="https://github.com/IBM/FHIR/blob/main/fhir-smart/src/main/java/com/ibm/fhir/smart/AuthzPolicyEnforcementPersistenceInterceptor.java">https://github.com/IBM/FHIR/blob/main/fhir-smart/src/main/java/com/ibm/fhir/smart/AuthzPolicyEnforcementPersistenceInterceptor.java</a></p>
<div class="codehilite"><pre><span></span><code>                    // Build the Patient compartment inclusion criteria search parameter
</code></pre></div>

<p><strong>                        QueryParameter inclusionCriteria = SearchUtil.buildInclusionCriteria(PATIENT, patientIdFromToken, event.getFhirResourceType());</strong></p>
<p>Anything to do with compartment config?</p>
<p>Mahesh</p>



<a name="245468414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245468414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245468414">(Jul 09 2021 at 16:56)</a>:</h4>
<p>While getting device using </p>
<p><a href="http://3.92.187.231:9443/fhir-server/api/v4/Device?patient=17a818c38f8-229c1e6d-26a8-4b4a-aa8b-4bc81582bf4c">http://3.92.187.231:9443/fhir-server/api/v4/Device?patient=17a818c38f8-229c1e6d-26a8-4b4a-aa8b-4bc81582bf4c</a></p>
<p>We are getting following warning, see if it can give some clue about some configuration issue?</p>
<p>Found multiple resource-specific search parameters, '<a href="http://hl7.org/fhir/us/core/SearchParameter/us-core-device-patient">http://hl7.org/fhir/us/core/SearchParameter/us-core-device-patient</a>' and '<a href="http://hl7.org/fhir/SearchParameter/Device-patient">http://hl7.org/fhir/SearchParameter/Device-patient</a>', for code 'patient' on resource type 'Device'; use search parameter filtering to disambiguate. Using '<a href="http://hl7.org/fhir/us/core/SearchParameter/us-core-device-patient">http://hl7.org/fhir/us/core/SearchParameter/us-core-device-patient</a>'.</p>
<p>Thanks<br>
Mahesh</p>



<a name="245469766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245469766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245469766">(Jul 09 2021 at 17:05)</a>:</h4>
<p><a href="https://github.com/IBM/FHIR/blob/main/fhir-search/src/main/java/com/ibm/fhir/search/util/SearchUtil.java">https://github.com/IBM/FHIR/blob/main/fhir-search/src/main/java/com/ibm/fhir/search/util/SearchUtil.java</a> line 318 is generating warning mentioned above.</p>



<a name="245481963"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245481963" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245481963">(Jul 09 2021 at 18:44)</a>:</h4>
<p>wrt the warning, thats saying that you have multiple search parameters that share a common code.  this is an unfortunate consequence of IGs like US Core redefining the search parameters that come with the base spec.<br>
since they use exactly the same expression, you can probably just ignore the warning.<br>
otherwise, if you want to make the warning go away, you can add "search parameter disambiguation" to your fhir-server-config.  for example, for this specific search parameter, the following config tells the server to use the base spec's search parameter definition:  <a href="https://github.com/IBM/FHIR/blob/main/demo/fhir/config/default/fhir-server-config.json#L60">https://github.com/IBM/FHIR/blob/main/demo/fhir/config/default/fhir-server-config.json#L60</a></p>



<a name="245523513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245523513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245523513">(Jul 10 2021 at 01:51)</a>:</h4>
<p>So our situation right now is</p>
<p>with samrt-fhir jar files and dependencies, only patient export works, allergies and all other are not working due to error </p>
<p>QueryParameter inclusionCriteria = SearchUtil.buildInclusionCriteria(PATIENT, patientIdFromToken, event.getFhirResourceType());</p>
<p>We looked in code also but are not getting any clue. There might be only two possibilities</p>
<ol>
<li>Either are are missing some Jar file (We downloaded and copied all Jar file to userlib folder, just copy no install. I hope that is sufficient)</li>
<li>Or we aremissing some config file (We are using same fhir config file as yours just changed the Auth URLs)</li>
</ol>
<p>Any thoughts on what can go wrong? Without Smart-Fhir it works perfect without any restrictions.</p>
<p>Thanks<br>
Mahesh</p>



<a name="245534793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245534793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245534793">(Jul 10 2021 at 07:12)</a>:</h4>
<p>This is our token</p>
<p>{<br>
  "iss": "<a href="https://identityserverforfhir.azurewebsites.net">https://identityserverforfhir.azurewebsites.net</a>",<br>
  "nbf": 1625901023,<br>
  "iat": 1625901023,<br>
  "exp": 1625904623,<br>
  "aud": "<a href="http://35.173.213.75:9443/fhir-server/api/v4">http://35.173.213.75:9443/fhir-server/api/v4</a>",<br>
  "scope": "launch/patient openid fhirUser patient/Medication.read patient/AllergyIntolerance.read patient/CarePlan.read patient/CareTeam.read patient/Condition.read patient/Device.read patient/DiagnosticReport.read patient/DocumentReference.read patient/Encounter.read patient/Goal.read patient/Immunization.read patient/Location.read patient/MedicationRequest.read patient/Observation.read patient/Organization.read patient/Patient.read patient/Practitioner.read patient/Procedure.read patient/Provenance.read patient/Patient.write offline_access",<br>
  "group": [<br>
    "FHIRUsers",<br>
    "FHIRAdmins"<br>
  ],<br>
  "amr": [<br>
    "pwd"<br>
  ],<br>
  "client_id": "Inferno",<br>
  "sub": "818727",<br>
  "auth_time": 1625896133,<br>
  "idp": "local",<br>
  "sid": "79B57016D38830A721312876B9F8E6CD",<br>
  "patient": "17a818c38f8-229c1e6d-26a8-4b4a-aa8b-4bc81582bf4c",<br>
  "patient_id": "17a818c38f8-229c1e6d-26a8-4b4a-aa8b-4bc81582bf4c",<br>
  "upn": "818727",<br>
  "need_patient_banner": "false",<br>
  "smart_style_url": "<a href="https://identityserverforfhir.azurewebsites.net/SmartOnFHIR/v1.json">https://identityserverforfhir.azurewebsites.net/SmartOnFHIR/v1.json</a>",<br>
  "jti": "8E44AB5C7303464F19E7FA1687D57448"<br>
}</p>
<p>And </p>
<p>Algorithm and token type<br>
{<br>
  "alg": "RS256",<br>
  "kid": "987701C6B82719A6BD6DB54F24B42CC2",<br>
  "typ": "at+jwt"<br>
}</p>



<a name="245692927"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245692927" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245692927">(Jul 12 2021 at 14:25)</a>:</h4>
<blockquote>
<p>allergies and all other are not working due to error</p>
</blockquote>
<p>sorry to hear that you're still having trouble with it.  is it still the originally-reported error (Caused by: java.lang.NoSuchMethodError: 'com.ibm.fhir.search.parameters.QueryParameter com.ibm.fhir.search.util.SearchUtil.buildInclusionCriteria(java.lang.String, java.util.Set, java.lang.String)' or some other error?</p>



<a name="245820755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245820755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245820755">(Jul 13 2021 at 13:01)</a>:</h4>
<p>Hi Lee</p>
<p>Will it be ok to give you access to my linux server if you want to look into any settings?<br>
Another option is I can upload my server liberty folder which you can download<br>
I have oAuth setup on Azure, my liberty is configured for that. I will provide username and password for that also.</p>
<p>Will this help to figure out what we are missing? </p>
<p>I think what we are looking at is simple working of smart-fhir based on scopes, e.g. if we are requesting patient and problems then only two should be allowed and rest all should be denied. </p>
<p>I think there might be something minor we might be missing <a href="/user_uploads/10155/XlGDgRCWtzA-Hi7rh0HtzA-l/config.zip">config.zip</a></p>
<p>Thanks<br>
Mahesh</p>



<a name="245821603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245821603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245821603">(Jul 13 2021 at 13:07)</a>:</h4>
<p>What would be most useful is if you share the error from the log.  Let me know if you need help finding the log.  If your using our docker container, its configured to go to console by default.</p>



<a name="245821765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245821765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245821765">(Jul 13 2021 at 13:08)</a>:</h4>
<p>Otherwise, the project I referenced above (<a href="https://github.com/Alvearie/health-patterns/tree/main/data-access">https://github.com/Alvearie/health-patterns/tree/main/data-access</a>) is intended as a complete working example and I worked to make that README as easy-to-follow as possible.  Did you try it?</p>



<a name="245822531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245822531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245822531">(Jul 13 2021 at 13:14)</a>:</h4>
<p>no problem. Let me try fresh, will clean everything and provide you log</p>
<p>Mahesh</p>



<a name="245830130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245830130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245830130">(Jul 13 2021 at 14:11)</a>:</h4>
<p><a href="/user_uploads/10155/WocNCGVMcLYT9i_CghEzRuRl/log.zip">log.zip</a> </p>
<p>Please see the log file. It is giving error while I try to get allergies. </p>
<p>I am sending scope to allow everything, not sure why smart is not allowing it</p>
<p>launch/patient openid fhirUser offline_access patient/Medication.read patient/AllergyIntolerance.read patient/CarePlan.read patient/CareTeam.read patient/Condition.read patient/Device.read patient/DiagnosticReport.read patient/DocumentReference.read patient/Encounter.read patient/Goal.read patient/Immunization.read patient/Location.read patient/MedicationRequest.read patient/Observation.read patient/Organization.read patient/Patient.read patient/Practitioner.read patient/Procedure.read patient/Provenance.read patient/Patient.write</p>
<p>Mahesh</p>



<a name="245830450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245830450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245830450">(Jul 13 2021 at 14:13)</a>:</h4>
<p>I would suggest to review config I sent earlier along with log files.</p>



<a name="245847950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245847950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245847950">(Jul 13 2021 at 16:09)</a>:</h4>
<p>the logs indicate you are running IBM FHIR Server version 4.8.0:<br>
<code>[7/13/21, 14:06:24:538 UTC] 0000001d com.ibm.fhir.server.FHIRApplication                          I FHIR Server version 4.8.0 build id 'Integration_refs/tags/4.8.0_8c843c76a1ccbbfccd96ab75c3a950a5c827ba51' starting.</code></p>



<a name="245848165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245848165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245848165">(Jul 13 2021 at 16:10)</a>:</h4>
<p><a href="#narrow/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations/near/245445823">https://chat.fhir.org/#narrow/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations/near/245445823</a></p>



<a name="245938459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245938459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245938459">(Jul 14 2021 at 09:45)</a>:</h4>
<p>Interesting, I downloaded latest release from <a href="https://github.com/ibm/fhir/releases">https://github.com/ibm/fhir/releases</a> which is FHIR 4.8.3, not sure why log is showing 4.8.o. Still I changed fhir-smart from 4.8.3 to 4.8.0 to match with whatever it says in log. In this case seems that smart configuration is not taking effect (restarted server also) and it keeps all objects wide open and not honoring scopes.</p>
<p>Mahesh</p>



<a name="245960111"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245960111" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245960111">(Jul 14 2021 at 13:36)</a>:</h4>
<blockquote>
<p>I downloaded latest release from <a href="https://github.com/ibm/fhir/releases">https://github.com/ibm/fhir/releases</a> which is FHIR 4.8.3, not sure why log is showing 4.8.o</p>
</blockquote>
<p>not sure how thats possible.  i confirmed that the artifacts at <a href="https://github.com/IBM/FHIR/releases/tag/4.8.3">https://github.com/IBM/FHIR/releases/tag/4.8.3</a> look right to me.<br>
have you downloaded and installed 4.8.0 previously?</p>
<blockquote>
<p>In this case seems that smart configuration is not taking effect (restarted server also) and it keeps all objects wide open and not honoring scopes.</p>
</blockquote>
<p>and the fhir-smart jar (and dependencies) are in your userlib? any errors in the logs?</p>



<a name="245967240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245967240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245967240">(Jul 14 2021 at 14:26)</a>:</h4>
<p>Let me do it again from start. I tried both 4.8.0 jar as well as 4.8.3 jar. 4.8.0 Jar is not showing any effect of Smart and 4.8.3 is throwing error. </p>
<p>I will keep you posted</p>
<p>Mahesh</p>



<a name="245967391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245967391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245967391">(Jul 14 2021 at 14:27)</a>:</h4>
<p>FYI personally, i find working with the docker image a little easier / less error-prone</p>



<a name="245983114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/245983114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#245983114">(Jul 14 2021 at 16:20)</a>:</h4>
<p>one thing you could try doing is to set a TRACE_SPEC of <code>com.ibm.fhir.persistence.interceptor.*=fine</code> so that you can see if the interceptor is even getting loaded.  info on setting the TRACE_SPEC is at <a href="https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#312-logging-and-trace">https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#312-logging-and-trace</a></p>



<a name="246213364"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/246213364" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#246213364">(Jul 16 2021 at 11:55)</a>:</h4>
<p>Yeah I am anyway preparing fresh box. Let me test again step by step. I will update in a bit.</p>



<a name="246436025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/246436025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#246436025">(Jul 19 2021 at 09:57)</a>:</h4>
<p>Hi</p>
<p>We installed fresh 4.8.3 and confirmed all the Jar versions and logs. <br>
Now we configured OAuth, please see Server.XML and JWTRs.xml. Here we have configured users in Fhirusers group. <a href="/user_uploads/10155/WCHbIz6O5uxzk9oeUboJBSUh/server.xml">server.xml</a> <a href="/user_uploads/10155/EBJOpLvs-GVhjdh7dNwMDH8w/jwtRS.xml">jwtRS.xml</a> <a href="/user_uploads/10155/sP7npUji16BywwRYLoCJ3bL5/fhir-server-config.json">fhir-server-config.json</a></p>
<p>We are using Outh from our Azure Server, it is sending scope along with token properly (please see bellow for token). Since basic auth is false in config json file, we are expecting Allergy API to work properly with 200 response.. Now somehow Liberty is throwing error 403 when we try to get to allergies API after successful authentication in OAuth. Are we missing any user setting in liberty server.xml or jwtRS?</p>
<p>{<br>
  "iss": "<a href="https://identityserverforfhir.azurewebsites.net">https://identityserverforfhir.azurewebsites.net</a>",<br>
  "nbf": 1626686866,<br>
  "iat": 1626686866,<br>
  "exp": 1626690466,<br>
  "aud": "<a href="http://3.86.177.215:9443/fhir-server/api/v4">http://3.86.177.215:9443/fhir-server/api/v4</a>",<br>
  "scope": "launch/patient openid fhirUser patient/Medication.read patient/AllergyIntolerance.read patient/CarePlan.read patient/CareTeam.read patient/Condition.read patient/Device.read patient/DiagnosticReport.read patient/DocumentReference.read patient/Encounter.read patient/Goal.read patient/Immunization.read patient/Location.read patient/MedicationRequest.read patient/Observation.read patient/Organization.read patient/Patient.read patient/Practitioner.read patient/Procedure.read patient/Provenance.read offline_access",<br>
  "group": [<br>
    "FHIRUsers",<br>
    "FHIRAdmins"<br>
  ],<br>
  "amr": [<br>
    "pwd"<br>
  ],<br>
  "client_id": "Inferno",<br>
  "sub": "fhiruser",<br>
  "auth_time": 1626673707,<br>
  "idp": "local",<br>
  "sid": "4B90892A443BEC26395EE752C2094C73",<br>
  "patient": "17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be",<br>
  "patient_id": "17ab437f80b-f1907e67-e141-467c-b3d9-c3f8ebd867be",<br>
  "upn": "fhiruser",<br>
  "need_patient_banner": "false",<br>
  "smart_style_url": "<a href="https://identityserverforfhir.azurewebsites.net/SmartOnFHIR/v1.json">https://identityserverforfhir.azurewebsites.net/SmartOnFHIR/v1.json</a>",<br>
  "jti": "247B25C32AE454CD78168129E67EFB47"<br>
}</p>



<a name="246601870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/246601870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#246601870">(Jul 20 2021 at 14:55)</a>:</h4>
<p>Hi Lee</p>
<p>Any help here will be appreciated. </p>
<p>Thanks<br>
Mahesh</p>



<a name="246616812"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/246616812" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#246616812">(Jul 20 2021 at 16:39)</a>:</h4>
<p>Hi Mahesh, I'm on vacation this week (and next), so I might be slow (or might not respond at all for a bit).</p>
<blockquote>
<p>Now somehow Liberty is throwing error 403 when we try to get to allergies API after successful authentication in OAuth.</p>
</blockquote>
<p>I had a peak at the config.zip you sent earlier and I may know the issue.<br>
Specifically  this line:</p>
<div class="codehilite"><pre><span></span><code>&lt;group id=&quot;usersGroup&quot; access-id=&quot;group:https://localhost:8443/auth/realms/test/fhirUser&quot;/&gt;
</code></pre></div>
<p>Please try replacing that with the following:</p>
<div class="codehilite"><pre><span></span><code>&lt;group id=&quot;usersGroup&quot; access-id=&quot;group:https://identityserverforfhir.azurewebsites.net/FHIRUsers&quot;/&gt;
</code></pre></div>
<p>This part is definitely a bit tricky/confusing, but what Liberty is doing is appending the group name from the access token to the issuer url to uniquely identify the group and we're mapping users in that group to our FHIRUsers security-role.</p>



<a name="246617587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/246617587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#246617587">(Jul 20 2021 at 16:45)</a>:</h4>
<p>For example, if your token had something like this insead:</p>
<div class="codehilite"><pre><span></span><code>&quot;group&quot;: [
&quot;fhirUser&quot;
],
</code></pre></div>
<p>then the access-id would be <code>group:https://identityserverforfhir.azurewebsites.net/FHIRUsers</code> instead.</p>



<a name="246702205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/NDJSON%20Resource%20Expectations/near/246702205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/NDJSON.20Resource.20Expectations.html#246702205">(Jul 21 2021 at 10:34)</a>:</h4>
<p>Awesome. Seems that OAuth is working properly now, SMART is still giving scope issues. It either blocks everything or opens everything. It doesn't honor scopes. Tried resources as given in <a href="https://github.com/Alvearie/health-patterns/blob/main/data-access/fhir/config/default/fhir-server-config.json">https://github.com/Alvearie/health-patterns/blob/main/data-access/fhir/config/default/fhir-server-config.json</a></p>
<p>Thanks<br>
Mahesh</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
