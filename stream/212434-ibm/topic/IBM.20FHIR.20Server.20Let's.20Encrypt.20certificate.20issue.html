---
layout: page
title: "FHIR Chat  · IBM FHIR Server Let&#x27;s Encrypt certificate issue · ibm"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/index.html">ibm</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/IBM.20FHIR.20Server.20Let&#x27;s.20Encrypt.20certificate.20issue.html">IBM FHIR Server Let&#x27;s Encrypt certificate issue</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="274528539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/IBM%20FHIR%20Server%20Let%27s%20Encrypt%20certificate%20issue/near/274528539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yannick Börner <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/IBM.20FHIR.20Server.20Let&#x27;s.20Encrypt.20certificate.20issue.html#274528539">(Mar 08 2022 at 11:31)</a>:</h4>
<p>Hi everyone, </p>
<p>we are trying to run the IBM FHIR server v4.10.2 and KeyCloak within a docker-compose. All these components are behind an nginx proxy and hosted on Digital Ocean with Let's Encrypt certificates. We are currently stuck with this error message: </p>
<div class="codehilite"><pre><span></span><code>ibm-fhir       | [3/6/22, 20:06:46:347 UTC] 00000028 IncidentImpl  I   FFDC1015I: An FFDC Incident has been created: &quot;org.apache.http.conn.HttpHostConnectException: Connect to keycloak.example.tech:443 [keycloak.example.tech/167.237.178.187] failed: Connection timed out (Connection timed out) com.ibm.ws.security.common.jwk.impl.JwKRetriever 792&quot; at ffdc_22.03.06_20.06.46.0.log
ibm-fhir       | [3/6/22, 20:06:46:356 UTC] 00000028 JwKRetriever  E   CWWKS6049E: A JSON Web Key (JWK) was not returned from the URL [https://keycloak.example.tech/auth/realms/Example/protocol/openid-connect/certs]. The response status was [0] and the content returned was [IOException: Connect to keycloak.example.tech:443 [keycloak.example.tech/167.237.178.187] failed: Connection timed out (Connection timed out) java.net.ConnectException: Connection timed out (Connection timed out)].
ibm-fhir       | [3/6/22, 20:06:46:359 UTC] 00000028 TAIJwtUtils   E   CWWKS5524E: The MicroProfile JWT feature encountered an error while creating a JWT by using the [jwtConsumer] configuration and the token included in the request. CWWKS6031E: The JSON Web Token (JWT) consumer [jwtConsumer] cannot process the token string. CWWKS6029E: The JSON Web Token (JWT) cannot be validated because a signing key cannot be found. The configured signature algorithm [RS256] requires a key to validate the token.
ibm-fhir       | [3/6/22, 20:06:46:360 UTC] 00000028 MicroProfileJ E   CWWKS5523E: The MicroProfile JWT feature cannot authenticate the request because the token that is included in the request cannot be validated. CWWKS5524E: The MicroProfile JWT feature encountered an error while creating a JWT by using the [jwtConsumer] configuration and the token included in the request. CWWKS6031E: The JSON Web Token (JWT) consumer [jwtConsumer] cannot process the token string. CWWKS6029E: The JSON Web Token (JWT) cannot be validated because a signing key cannot be found. The configured signature algorithm [RS256] requires a key to validate the token.
ibm-fhir       | [3/6/22, 20:06:46:362 UTC] 00000028 FHIRRestServl I   Received request: tenantId:[default] dsId:[default] user:[&amp;lt;unauthenticated&amp;gt;] method:[GET] uri:[https://fhir.example.tech/fhir-server/api/v4/Person]
</code></pre></div>
<p>I attached our configuration files for the FHIR server and the docker-compose.yml. We suspect it has something to do with the Let's Encrypt certificate, which the IBM FHIR server seems to have an issue with. The entire setup does work with a different kind of certificate. Has anyone seen this type of error before? <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> Is there anything wrong in our configuration files that catches your eye?</p>
<p><a href="/user_uploads/10155/Gukab-wruS07FDQ3EwdXguKo/docker-compose.yml">docker-compose.yml</a></p>
<p><a href="/user_uploads/10155/P16mXPaG73DwVfFb0SIgwBvR/fhir-server-config.json">fhir-server-config.json</a> </p>
<p><a href="/user_uploads/10155/bK1FMBENaK73IMmFD3qCdznC/jwtRS.xml">jwtRS.xml</a> </p>
<p><a href="/user_uploads/10155/StyrI4QgN9PNxrwnnjvZh4W3/server.xml">server.xml</a></p>



<a name="274535208"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/IBM%20FHIR%20Server%20Let%27s%20Encrypt%20certificate%20issue/near/274535208" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/IBM.20FHIR.20Server.20Let&#x27;s.20Encrypt.20certificate.20issue.html#274535208">(Mar 08 2022 at 12:43)</a>:</h4>
<p>Hi Yannick, it definitely sounds like the FHIR Server is not able to dereference the JWKS endpoint.  I see you have that set to <code>https://keycloak.example.tech/auth/realms/Test/protocol/openid-connect/certs</code></p>
<p>I recommend to <code>docker exec</code> to the fhir server container and confirm you can dereference that from there (and that it has the expected cert).<br>
Assuming that works, then perhaps you'll need to add the TLS cert for that endpoint to your server's truststore.</p>



<a name="274535496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/IBM%20FHIR%20Server%20Let%27s%20Encrypt%20certificate%20issue/near/274535496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/IBM.20FHIR.20Server.20Let&#x27;s.20Encrypt.20certificate.20issue.html#274535496">(Mar 08 2022 at 12:46)</a>:</h4>
<p>In general, that shouldn't be needed for a valid cert that is signed by a trusted root CA because we set SEC_TLS_TRUSTDEFAULTCERTS to true by default :  <a href="https://github.com/IBM/FHIR/blob/main/fhir-server-webapp%2Fsrc%2Fmain%2Fliberty%2Fconfig%2FconfigDropins%2Fdefaults%2FtrustDefault.xml#L3">https://github.com/IBM/FHIR/blob/main/fhir-server-webapp%2Fsrc%2Fmain%2Fliberty%2Fconfig%2FconfigDropins%2Fdefaults%2FtrustDefault.xml#L3</a></p>
<p>So while you're in there you could confirm that:</p>
<ol>
<li>you have our <code>trustDefault.xml</code> snippet in your configDropins/defaults; and</li>
<li>you havn't overridden the SEC_TLS_TRUSTDEFAULTCERTS env var to something other than true</li>
</ol>



<a name="274653649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/IBM%20FHIR%20Server%20Let%27s%20Encrypt%20certificate%20issue/near/274653649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yannick Börner <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/IBM.20FHIR.20Server.20Let&#x27;s.20Encrypt.20certificate.20issue.html#274653649">(Mar 09 2022 at 08:00)</a>:</h4>
<p>Hi Lee, thank you for getting back to us so quickly. We are able to confirm 1. and 2. and your suspicion was correct: We could <strong>not</strong> reach the KeyCloak server at <code>https://keycloak.example.tech</code> from within the docker container. We'll investigate why that is the case a bit later today and report back to you <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="274739128"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/IBM%20FHIR%20Server%20Let%27s%20Encrypt%20certificate%20issue/near/274739128" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yannick Börner <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/IBM.20FHIR.20Server.20Let&#x27;s.20Encrypt.20certificate.20issue.html#274739128">(Mar 09 2022 at 19:23)</a>:</h4>
<p><span class="user-mention" data-user-id="191676">@Lee Surprenant</span> We were able to find the issue thanks to your hints! However, the actual cause is too embarrassing for us to reveal :D</p>



<a name="274739372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/IBM%20FHIR%20Server%20Let%27s%20Encrypt%20certificate%20issue/near/274739372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/IBM.20FHIR.20Server.20Let&#x27;s.20Encrypt.20certificate.20issue.html#274739372">(Mar 09 2022 at 19:24)</a>:</h4>
<p>Oh, we’ve all been there :-)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
