---
layout: page
title: "FHIR Chat  · Bulk Export · ibm"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/index.html">ibm</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html">Bulk Export</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="254211862"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254211862" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254211862">(Sep 21 2021 at 14:03)</a>:</h4>
<p>Below are a couple of errors we are getting while testing a section on Bulk in Inferno:</p>
<p>1 - <br>
     Request:  GET   <a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/$bulkdata-status?job=oVWUczflBh_chJhcTfY2Hw">https://fhir.secureit.co.in:9443/fhir-server/api/v4/$bulkdata-status?job=oVWUczflBh_chJhcTfY2Hw</a></p>
<div class="codehilite"><pre><span></span><code>Response:
</code></pre></div>

<p>{<br>
  "transactionTime": "2021-09-21T10:53:53.879Z",<br>
  "request": "<a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Group/17b5e38b010-74858f83-7570-45cb-979b-8d00b694a293/$export">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Group/17b5e38b010-74858f83-7570-45cb-979b-8d00b694a293/$export</a>",<br>
  "requiresAccessToken": true,<br>
  "output": [<br>
    {<br>
      "type": "Provenance",<br>
      "url": "<strong>KTwhDhHknT5k7lLtqB8eUQM2e0LuvIgX7NQSLqbH5_A/Provenance_1.ndjson</strong>",<br>
      "count": 1<br>
    },<br>
    {<br>
      "type": "AllergyIntolerance",<br>
      "url": "<strong>KTwhDhHknT5k7lLtqB8eUQM2e0LuvIgX7NQSLqbH5_A/AllergyIntolerance_1.ndjson</strong>",<br>
      "count": 1<br>
    }<br>
  ],<br>
  "error": []<br>
}</p>
<p>Can we get a complete URL in the highlighted section above? The reason is that Inferno further uses the URL above to access the respective resources. In the current situation, when it tries to access the same, it fails because the URL is incomplete.</p>
<p>2 - <br>
    After the bulk export was completed, we could not find below resources<br>
     Device<br>
     Organization<br>
     Practitioner </p>
<div class="codehilite"><pre><span></span><code> Is there a way to configure the export of the above resources or do you need to add support for this in IBM FHIR?
</code></pre></div>



<a name="254219934"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254219934" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254219934">(Sep 21 2021 at 14:51)</a>:</h4>
<p>it sounds like you're using file-based "storageProvider" in your fhir-server-config.json<br>
for the file-based export, we don't support proxying the exported files from the server and so we cannot give you a full URL (or if we did, it would be a <code>file:</code> url).<br>
are you able to use aws-s3 / ibm-cos?  if you need to keep the data local, you could look at using MinIO which is what our CI pipeline tests</p>



<a name="254369515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254369515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254369515">(Sep 22 2021 at 13:46)</a>:</h4>
<p>Hi Lee</p>
<p>Will you please help us with second point?<br>
2 - <br>
    After the bulk export was completed, we could not find below resources<br>
     Device<br>
     Organization<br>
     Practitioner </p>
<div class="codehilite"><pre><span></span><code> Is there a way to configure the export of the above resources or do you need to add support for this in IBM FHIR?
</code></pre></div>



<a name="254370094"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254370094" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254370094">(Sep 22 2021 at 13:50)</a>:</h4>
<p>HI Mahesh, a few questions... how many resources are stored in the Device / Organization and Practitioner resource types?  a simple FHIR Search can confirm.  What was the $export request was it on Patient or a System Level export?</p>



<a name="254530348"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254530348" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254530348">(Sep 23 2021 at 12:59)</a>:</h4>
<p>1 - $export is on group level:<br>
     Request GET <a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Group/17b5e38b010-74858f83-7570-45cb-979b-8d00b694a293/$export">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Group/17b5e38b010-74858f83-7570-45cb-979b-8d00b694a293/$export</a></p>
<div class="codehilite"><pre><span></span><code>  Response 202 Accepted

 After the export is completed below is the list of resources exported. If you see here, device, organization, and practitioner resources are missing.
</code></pre></div>

<p>image.png</p>
<p>2 - Device resource details<br>
    Request GET <a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device</a></p>
<div class="codehilite"><pre><span></span><code> Response
</code></pre></div>

<p>{<br>
    "resourceType": "Bundle",<br>
    "id": "cc4382af-9409-4d04-9141-f4a37ec80b91",<br>
    "type": "searchset",<br>
    "total": 3,<br>
    "link": [<br>
        {<br>
            "relation": "self",<br>
            "url": "<a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device?_count=10&amp;_page=1">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device?_count=10&amp;_page=1</a>"<br>
        }<br>
    ],<br>
    "entry": [<br>
        {<br>
            "id": "17b587c2d01-038ded08-f14a-40b6-b0e3-6182a8cfc404",<br>
            "fullUrl": "<a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device/17b587c2d01-038ded08-f14a-40b6-b0e3-6182a8cfc404">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device/17b587c2d01-038ded08-f14a-40b6-b0e3-6182a8cfc404</a>",<br>
            "resource": {<br>
                "resourceType": "Device",<br>
                "id": "17b587c2d01-038ded08-f14a-40b6-b0e3-6182a8cfc404",<br>
                "meta": {<br>
                    "versionId": "1",<br>
                    "lastUpdated": "2021-08-18T08:58:58.177514Z",<br>
                    "profile": [<br>
                        "<a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-implantable-device">http://hl7.org/fhir/us/core/StructureDefinition/us-core-implantable-device</a>"<br>
                    ]<br>
                },<br>
                "udiCarrier": [<br>
                    {<br>
                        "deviceIdentifier": "43069338026389",<br>
                        "carrierHRF": "(01)43069338026389(11)000302(17)250317(10)1134(21)842026117977"<br>
                    }<br>
                ],<br>
                "status": "active",<br>
                "distinctIdentifier": "43069338026389",<br>
                "manufactureDate": "2000-03-02T18:33:18-05:00",<br>
                "expirationDate": "2025-03-17T19:33:18-04:00",<br>
                "lotNumber": "1134",<br>
                "serialNumber": "842026117977",<br>
                "deviceName": [<br>
                    {<br>
                        "name": "Implantable defibrillator, device (physical object)",<br>
                        "type": "user-friendly-name"<br>
                    }<br>
                ],<br>
                "type": {<br>
                    "coding": [<br>
                        {<br>
                            "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
                            "code": "72506001",<br>
                            "display": "Implantable defibrillator, device (physical object)"<br>
                        }<br>
                    ],<br>
                    "text": "Implantable defibrillator, device (physical object)"<br>
                },<br>
                "patient": {<br>
                    "reference": "Patient/17b57f46378-a6944791-e6ad-4f0f-8e37-683f47f24fa1"<br>
                }<br>
            },<br>
            "search": {<br>
                "mode": "match",<br>
                "score": 1<br>
            }<br>
        },<br>
        {<br>
            "id": "17b587c5238-61cb7fd9-0596-4672-b199-22cb2329c1ba",<br>
            "fullUrl": "<a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device/17b587c5238-61cb7fd9-0596-4672-b199-22cb2329c1ba">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device/17b587c5238-61cb7fd9-0596-4672-b199-22cb2329c1ba</a>",<br>
            "resource": {<br>
                "resourceType": "Device",<br>
                "id": "17b587c5238-61cb7fd9-0596-4672-b199-22cb2329c1ba",<br>
                "meta": {<br>
                    "versionId": "1",<br>
                    "lastUpdated": "2021-08-18T08:59:07.704421Z",<br>
                    "profile": [<br>
                        "<a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-implantable-device">http://hl7.org/fhir/us/core/StructureDefinition/us-core-implantable-device</a>"<br>
                    ]<br>
                },<br>
                "udiCarrier": [<br>
                    {<br>
                        "deviceIdentifier": "43069338026389",<br>
                        "carrierAIDC": "iVBORw0KGgoAAAANSUhEUgAAAioAAAB2CAIAAABpgS9BAAADHUlEQVR42u3aXY+iMBiAUbrZ//+XuxcmpunXvkABNedczahAReWZdkxbIee8bVtK6f3zS3tLaXTv6/b5nttHtuMZHaW8JXJvu8/4GNp72+NGxhN5jvPnHn8tInubn4fIfiKjHZ35+fth1bM49g4/dpaOfWrOnMk7X829449/ciOfzcjrFX/FV73f4sfdexWdv8fOvB9G17T4FW/+WkfOw8ufDQBuJz8AyA8A8gMA8gOA/ACA/AAgPwAgPwDIDwDIDwDyA4D8AID8ACA/ACA/AMgPAMgPAPIDAPIDgPwAID8AID8AyA8AyA8A8gMA8gOA/ACA/AAgPwDIDwDIDwDyAwDyA4D8AID8ACA/ACA/AMgPAPIDAPIDgPwAgPwAID8AID8AyA8AyA8A8gOA/ACA/AAgPwAgPwDIDwDIDwDyAwDyA4D8ACA/ACA/AMgPAMgPAPIDAPIDgPwAgPwAID8AyA8AyA8A8gMA8gOA/ACA/AAgPwAgPwDIDwDyAwDyA4D8AID8ACA/ACA/AMgPAMgPAPIDgPw4BQDIDwDyAwDyA4D8AID8ACA/ACA/AMgPAMgPAPIDgPwAgPwAID8AID8AfJuUc3YWADD7AUB+AOACf50CrpBSqm65dJn3dbgDhyjHeWaEKS1bx141pAefAsgPT7rzWpZzboO3d5yfc/39wCHBchbfYGXDPmdIYPYDW/dv+fev3eWm93pa+bDycjy/4p9cwhoNafRzdZTJM9o1pPYo5eajExI/evdkPrX6h/zAstgEO9FtUtmeqkDdDYP7PJPJ4Bylu/mufXaLMip39Zj40bttO3nqQH54XnvZ6oZk19XtGy+FB8bcVme0k//uPHh0q3zID7/fpPlS1fK518LN29nY1UOqgn1Pm3UI+eEHtbOfdrXnqTnH1dOshV/svrQQVtu4h2++8UB7tqOrPccuu8GtRnOa6l/xB/6TtHxIVzx3MyHMfvid2ET+pp53qNpq/kWv97Jetc/gd+RGaQxuPj/62iHN5y7Bo1cns/yqoZkQd1wivL34xskT8O0svgFg9gOA2Q8AyA8Av+MfJjJq5w+06kcAAAAASUVORK5CYII="<br>
                    }<br>
                ],<br>
                "status": "active",<br>
                "distinctIdentifier": "43069338026389",<br>
                "manufactureDate": "2000-03-02T18:33:18-05:00",<br>
                "expirationDate": "2025-03-17T19:33:18-04:00",<br>
                "lotNumber": "1134",<br>
                "serialNumber": "842026117977",<br>
                "deviceName": [<br>
                    {<br>
                        "name": "Implantable defibrillator, device (physical object)",<br>
                        "type": "user-friendly-name"<br>
                    }<br>
                ],<br>
                "type": {<br>
                    "coding": [<br>
                        {<br>
                            "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
                            "code": "72506001",<br>
                            "display": "Implantable defibrillator, device (physical object)"<br>
                        }<br>
                    ],<br>
                    "text": "Implantable defibrillator, device (physical object)"<br>
                },<br>
                "patient": {<br>
                    "reference": "Patient/17b57f46378-a6944791-e6ad-4f0f-8e37-683f47f24fa1"<br>
                }<br>
            },<br>
            "search": {<br>
                "mode": "match",<br>
                "score": 1<br>
            }<br>
        },<br>
        {<br>
            "id": "17b5dec7fde-dda0524d-2256-42f0-96d1-9fe252e36d4a",<br>
            "fullUrl": "<a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device/17b5dec7fde-dda0524d-2256-42f0-96d1-9fe252e36d4a">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Device/17b5dec7fde-dda0524d-2256-42f0-96d1-9fe252e36d4a</a>",<br>
            "resource": {<br>
                "resourceType": "Device",<br>
                "id": "17b5dec7fde-dda0524d-2256-42f0-96d1-9fe252e36d4a",<br>
                "meta": {<br>
                    "versionId": "1",<br>
                    "lastUpdated": "2021-08-19T10:19:45.502943Z",<br>
                    "profile": [<br>
                        "<a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-implantable-device">http://hl7.org/fhir/us/core/StructureDefinition/us-core-implantable-device</a>"<br>
                    ]<br>
                },<br>
                "udiCarrier": [<br>
                    {<br>
                        "deviceIdentifier": "43069338026389",<br>
                        "carrierHRF": "(01)43069338026389(11)000302(17)250317(10)1134(21)842026117977"<br>
                    }<br>
                ],<br>
                "status": "active",<br>
                "distinctIdentifier": "43069338026389",<br>
                "manufactureDate": "2000-03-02T18:33:18-05:00",<br>
                "expirationDate": "2025-03-17T19:33:18-04:00",<br>
                "lotNumber": "1134",<br>
                "serialNumber": "842026117977",<br>
                "deviceName": [<br>
                    {<br>
                        "name": "Implantable defibrillator, device (physical object)",<br>
                        "type": "user-friendly-name"<br>
                    }<br>
                ],<br>
                "type": {<br>
                    "coding": [<br>
                        {<br>
                            "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
                            "code": "72506001",<br>
                            "display": "Implantable defibrillator, device (physical object)"<br>
                        }<br>
                    ],<br>
                    "text": "Implantable defibrillator, device (physical object)"<br>
                },<br>
                "patient": {<br>
                    "reference": "Patient/17b5dc09184-54ce1834-2501-4e85-a3fe-e04223da69cf"<br>
                }<br>
            },<br>
            "search": {<br>
                "mode": "match",<br>
                "score": 1<br>
            }<br>
        }<br>
    ]<br>
}    </p>
<div class="codehilite"><pre><span></span><code>   3 - Organization resource details
Request GET https://fhir.secureit.co.in:9443/fhir-server/api/v4/Organization
</code></pre></div>

<p>Response: Please see attachment</p>
<div class="codehilite"><pre><span></span><code>   4 -  Practitioner resource details
Request GET https://fhir.secureit.co.in:9443/fhir-server/api/v4/Practitioner
</code></pre></div>

<p>Response: Please see attachment <a href="/user_uploads/10155/vTtoI4cjpc17ituHzkVLonDN/Responses.txt">Responses.txt</a></p>



<a name="254539557"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254539557" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254539557">(Sep 23 2021 at 14:00)</a>:</h4>
<p>Hi Mahesh, refer to the following snippet, for the Group Export without resource types we default to the list of resources in the Patient Compartment.  If you list device, organization, et cetra on the included resources it'll export it. </p>
<p>if (!ExportType.INVALID.equals(exportType)) {<br>
            if (ExportType.PATIENT.equals(exportType) || ExportType.GROUP.equals(exportType)) {<br>
                if (types != null &amp;&amp; !types.isEmpty()) {<br>
                    export.checkExportPatientResourceTypes(types);<br>
                } else {<br>
                    types = export.addDefaultsForPatientCompartment();<br>
                }<br>
            } else if ((ExportType.SYSTEM.equals(exportType) )<br>
                            &amp;&amp; (types == null || types.isEmpty())) {<br>
                types = export.defaultResourceTypes();<br>
            }</p>



<a name="254539571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254539571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254539571">(Sep 23 2021 at 14:00)</a>:</h4>
<p>Currently our Patient and Group export implementation will only export resources in the Patient compartment.<br>
We do support "customizable compartment definitions" but there's currently no support for "chained" inclusion criteria there.  See <a href="https://github.com/IBM/FHIR/issues/2371">https://github.com/IBM/FHIR/issues/2371</a> for more info.<br>
Feel free to add a comment there or open a separate issue with what you you'd like to see.</p>



<a name="254539576"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254539576" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254539576">(Sep 23 2021 at 14:00)</a>:</h4>
<p>by default, we limit to the patient compartment</p>



<a name="254539579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254539579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254539579">(Sep 23 2021 at 14:00)</a>:</h4>
<p>paul just beat me... :-)</p>



<a name="254539600"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254539600" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254539600">(Sep 23 2021 at 14:01)</a>:</h4>
<p>I had to check the code :)</p>



<a name="254539813"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254539813" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254539813">(Sep 23 2021 at 14:02)</a>:</h4>
<p>So my thinking on this is that we could support these other resource types by implementing 2371 and then our users could customize what is considered "in the Patient compartment" per their own wants/needs and we wouldn't need to update our export logic</p>



<a name="254539861"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/254539861" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#254539861">(Sep 23 2021 at 14:02)</a>:</h4>
<p>however, that is pretty low on our priority list right now (and easier said than done)</p>



<a name="255531121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/255531121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#255531121">(Sep 30 2021 at 07:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191676">Lee Surprenant</span> <a href="#narrow/stream/212434-ibm/topic/Bulk.20Export/near/254539571">said</a>:</p>
<blockquote>
<p>Currently our Patient and Group export implementation will only export resources in the Patient compartment.<br>
We do support "customizable compartment definitions" but there's currently no support for "chained" inclusion criteria there.  See <a href="https://github.com/IBM/FHIR/issues/2371">https://github.com/IBM/FHIR/issues/2371</a> for more info.<br>
Feel free to add a comment there or open a separate issue with what you you'd like to see.</p>
</blockquote>
<p>Hi Lee</p>
<p>We are trying different option for bulk export. We tried Amazon S3 and it worked fine but the issue is that inferno (ONC testing tool) expects security token in bulk export URL. So this option maynot work. We are trying workaround and have two questions</p>
<ol>
<li>If we want to configure HTTPS export  instead of file or S3 , what will be bulk export section configuration. Do you have any sample config file to demonstrate that?</li>
<li>In Liberty (FHIR Server) can we expose any folder to public so that it can be accessed over HTTP. Basically we want to expose one folder under FHIR Server itself over HTTPS (so that security can be taken care of)</li>
</ol>
<p>Mahesh</p>



<a name="255549895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/255549895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#255549895">(Sep 30 2021 at 10:26)</a>:</h4>
<blockquote>
<p>If we want to configure HTTPS export instead of file or S3 , what will be bulk export section configuration. Do you have any sample config file to demonstrate that?</p>
</blockquote>
<p>The "https" provider only supports import at the moment.<br>
However, note that the generated s3 download urls ARE HTTPS.  </p>
<blockquote>
<p>inferno (ONC testing tool) expects security token in bulk export URL</p>
</blockquote>
<p>The S3 feature uses <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ShareObjectPreSignedURL.html">https://docs.aws.amazon.com/AmazonS3/latest/userguide/ShareObjectPreSignedURL.html</a> to create a URL that has the "access token" embedded in the url in the form of Credentials + Signature. Basically the fhir server has read access to the private bucket/object and then temporarilly extends that access to the end user in the form of a (signed) download url with a controllable expiry.</p>
<p>What is it that inferno doesn't think is valid about this?!  If you can be clear about it, I can help you push back on this.</p>



<a name="256699140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/256699140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#256699140">(Oct 08 2021 at 07:23)</a>:</h4>
<p>Hi Lee</p>
<p>BDE-09: Bulk Data Server SHALL restrict bulk data file access with access token</p>
<p>Scenario 1 - When token is provided, we get response after validating the token<br>
Request:<br>
GET   200   <a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/$bulkdata-status?job=O5sfGj3l4ZFOO_G0TdwHvQ">https://fhir.secureit.co.in:9443/fhir-server/api/v4/$bulkdata-status?job=O5sfGj3l4ZFOO_G0TdwHvQ</a></p>
<p>OAuth Token Provided: YES</p>
<p>Response:<br>
{<br>
  "transactionTime": "2021-10-08T06:58:34.668Z",<br>
  "request": "<a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Group/17c5ea3c53d-9ae67467-60d2-4f1d-85f6-6808d680589e/$export">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Group/17c5ea3c53d-9ae67467-60d2-4f1d-85f6-6808d680589e/$export</a>",<br>
  "requiresAccessToken": true,<br>
  "output": [<br>
    {<br>
      "type": "AllergyIntolerance",<br>
      "url": "<a href="https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/AllergyIntolerance_1.ndjson">https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/AllergyIntolerance_1.ndjson</a>",<br>
      "count": 1<br>
    },<br>
    {<br>
      "type": "Group",<br>
      "url": "<a href="https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/Group_1.ndjson">https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/Group_1.ndjson</a>",<br>
      "count": 1<br>
    },<br>
    {<br>
      "type": "Patient",<br>
      "url": "<a href="https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/Patient_1.ndjson">https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/Patient_1.ndjson</a>",<br>
      "count": 1<br>
    }<br>
  ],<br>
  "error": []<br>
}</p>
<p>Scenario 2 - From the above response, Inferno then picks up individual URLs and does a GET as shown below. In one such scenario, it sends no token<br>
and it expects 400 or 401, whereas it receives a 200.</p>
<p>Since we are using AWS bucket, it gives us a direct URL and there is no way it will validate the OAuth token.</p>
<p>Before using AWS, we tried using file as storage provider, but it provided partial path ("url" : "iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/AllergyIntolerance_1.ndjson")<br>
and not the complete URL. If it could provide a complete HTTP/HTTPS path, then this may solve the problem.</p>
<p>Could you please help us with this? <br>
Also, is there a way where S3 URL could be routed through our oAUTH server?</p>
<p>Request:<br>
GET   200   <a href="https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/AllergyIntolerance_1.ndjson">https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/AllergyIntolerance_1.ndjson</a></p>
<p>OAuth Token Provided: NO</p>
<p>Response:<br>
{<br>
  "resourceType": "AllergyIntolerance",<br>
  "id": "17c5ea10448-672d34c4-5131-4d90-a488-fae9151fb8f8",<br>
  "meta": {<br>
    "versionId": "1",<br>
    "lastUpdated": "2021-10-08T06:39:43.178Z",<br>
    "profile": [<br>
      "<a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-allergyintolerance">http://hl7.org/fhir/us/core/StructureDefinition/us-core-allergyintolerance</a>"<br>
    ]<br>
  },<br>
  "clinicalStatus": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical">http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical</a>",<br>
        "code": "inactive"<br>
      }<br>
    ]<br>
  },<br>
  "code": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
        "code": "300916003",<br>
        "display": "Latex allergy"<br>
      }<br>
    ],<br>
    "text": "Latex allergy"<br>
  },<br>
  "patient": {<br>
    "reference": "Patient/17c5e5cabb3-19b86ee6-35be-4157-b4a0-fb9b6ad28341"<br>
  }<br>
}</p>



<a name="257043844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/257043844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#257043844">(Oct 11 2021 at 10:32)</a>:</h4>
<p>Based on the above description and requirement from Inferno, below could be 2 options that could be possible solutions:</p>
<p>1 - Before using AWS bucket, we tried using file as storage provider, but it provided partial path ("URL" : "iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/AllergyIntolerance_1.ndjson")<br>
and not the complete URL. If it could provide a complete HTTP/HTTPS path, then this may solve the problem.</p>
<p>2 - When using AWS bucket we get a complete URL ("URL": "<a href="https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/Patient_1.ndjson">https://1secureit.s3.amazonaws.com/fhir/1secureit/iLUQQ4xsv0xbYoQ-auymO567ndIPa5EsRjR40AtZEz8/Patient_1.ndjson</a>"). From here on Inferno uses this URL to fetch data.<br>
      Instead of this S3 URL, the IBM FHIR server could introduce a proxy URL, and internally it could use this S3 URL to fetch data. Doing this the OAuth server will be used and the token will be validated before fetching the fhir data from AWS S3. <br>
      This behavior can be kept configurable in fhirserverconfig.</p>
<div class="codehilite"><pre><span></span><code>Please let us know your thought
</code></pre></div>



<a name="257055193"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/257055193" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#257055193">(Oct 11 2021 at 12:15)</a>:</h4>
<p>We purposefully keep the FHIR server out of the path for downloading these large files as, currently, those will compete with resources with the threads serving the REST API.<br>
At some point, I'll have a look at the inferno tests, but my first question there is "why does it require token-based auth when the spec allows for either/or?"</p>
<p>I'm not totally opposed to providing an option to proxy the export files, but I do think its better to keep that out of the liberty-based FHIR server app.  Maybe introduce a separate component with the same auth strategy?<br>
I'd definitely encourage you to design/develop something that works for your use case and then share those learnings.</p>



<a name="257056542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/257056542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#257056542">(Oct 11 2021 at 12:26)</a>:</h4>
<p>I did like where you were going with this earlier line of thought:</p>
<blockquote>
<p>is there a way where S3 URL could be routed through our oAUTH server?</p>
</blockquote>
<p>S3 (and IBM Object Storage) provide a lot of options for securing the exported files.  You can find an overview of those at <a href="https://aws.amazon.com/premiumsupport/knowledge-center/secure-s3-resources/">https://aws.amazon.com/premiumsupport/knowledge-center/secure-s3-resources/</a>.<br>
We chose to make presigned URLs against private objects our default, but its definitely possible to disable the presigning from your fhir-server-config and use IAM access policies (which will reject unauthenticated/unauthorized access) instead.</p>



<a name="257056892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/257056892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#257056892">(Oct 11 2021 at 12:30)</a>:</h4>
<p>The challenge there will be that the next version of the bulk export spec will indicate that, when requiresAccessToken==true, the security model for the exported files should be the same as the one for requesting the export (using SMART Backend Services): <br>
<a href="#narrow/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22/near/246161556">https://chat.fhir.org/#narrow/stream/179250-bulk-data/topic/Attachments.20and.20.22additional.20authentication.20credentials.22/near/246161556</a></p>



<a name="257057105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/257057105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#257057105">(Oct 11 2021 at 12:31)</a>:</h4>
<p>So, it probably depends what you're trying to do (just pass some inferno tests or position yourself for future compliance)</p>



<a name="257160668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/257160668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#257160668">(Oct 12 2021 at 07:29)</a>:</h4>
<p>One of the solutions we discussed was around using FILE as a storage provider. Below is an example response after the bulk export is completed:<br>
{<br>
"transactionTime": "2021-09-21T10:53:53.879Z",<br>
"request": "<a href="https://fhir.secureit.co.in:9443/fhir-server/api/v4/Group/17b5e38b010-74858f83-7570-45cb-979b-8d00b694a293/$export">https://fhir.secureit.co.in:9443/fhir-server/api/v4/Group/17b5e38b010-74858f83-7570-45cb-979b-8d00b694a293/$export</a>",<br>
"requiresAccessToken": true,<br>
"output": [{<br>
"type": "Provenance",<br>
"url": "KTwhDhHknT5k7lLtqB8eUQM2e0LuvIgX7NQSLqbH5_A/Provenance_1.ndjson",<br>
"count": 1<br>
}],<br>
"error": []<br>
}</p>
<p>If you see the URL here is the reference URL and not complete. The exported files are located under fhirserver on liberty. If you could provide a complete HTTP/HTTPS URL instead of a reference URL, then this URL will inherit the authentication system configured for the FHIR server which means if the SMART is enabled it will validate the supplied token and proceed accordingly. </p>
<p>If you think this could be a probable solution then this could involve fewer changes. The default behavior could be as is, and having a complete URL in the response could be based on a configuration in fhirserverconfig. Again you are the correct person to judge on how much effort and changes would be involved. This URL can be exposed by doing some configuration in Liberty by publishing the folder. I donot know much about how to expose one additional folder in FHIR where these files will reside.</p>
<p>If we are able to achieve this then we may not need to disturb the current behavior in the S3 storage provider.</p>
<p>As you mentioned, "when requiresAccessToken==true, the security model for the exported files should be the same as the one for requesting the export (using SMART Backend Services)". Could this be one of the approaches to get there?</p>
<p>Please let us know your thoughts.</p>



<a name="257809942"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/257809942" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#257809942">(Oct 16 2021 at 07:19)</a>:</h4>
<p>Hi</p>
<p>Have you got a chance to review suggestion above? Any ideas you can suggest whether this will work or not? Will appreciate your help.</p>
<p>Thanks<br>
Mahesh</p>



<a name="258075667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/258075667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#258075667">(Oct 18 2021 at 18:22)</a>:</h4>
<p>Please open an enhancement for appending a URL to the FILE Export</p>



<a name="258075702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/258075702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#258075702">(Oct 18 2021 at 18:22)</a>:</h4>
<p>We'll look at implementing it as a configuration option</p>



<a name="260089694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260089694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mahesh Dabi <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260089694">(Nov 03 2021 at 04:49)</a>:</h4>
<p>we managed to use S3 and satisfy what is needed by Inferno. </p>
<p>Inferno has one test case related to Bulk Export with respect to a definition in metadata as mentioned below.</p>
<p>BDE-02: Bulk Data Server declares support for 'group-export' operation in CapabilityStatement (<a href="http://hl7.org/fhir/uv/bulkdata/OperationDefinition-group-export.html">http://hl7.org/fhir/uv/bulkdata/OperationDefinition-group-export.html</a>)</p>
<p>Below is a snapshot of IBM FHIR metadata with respect to type:group<br>
{<br>
"type": "Group",<br>
"profile": "<a href="http://hl7.org/fhir/profiles/Group">http://hl7.org/fhir/profiles/Group</a>",<br>
"operation": [{<br>
"name": "export",<br>
"definition": "<a href="http://hl7.org/fhir/uv/bulkdata/OperationDefinition/group-export|1.0.1">http://hl7.org/fhir/uv/bulkdata/OperationDefinition/group-export|1.0.1</a>"<br>
}]<br>
}</p>
<p>Here, the operation name should be "group-export". </p>
<p>Below is a snapshot of the metadata from the FHIR server that Inferno uses:<br>
{<br>
  "type": "Group",<br>
  "operation": [<br>
{<br>
 "extension": [<br>
{<br>
 "url": "<a href="http://hl7.org/fhir/StructureDefinition/capabilitystatement-expectation">http://hl7.org/fhir/StructureDefinition/capabilitystatement-expectation</a>",<br>
 "valueCode": "SHOULD"<br>
}<br>
 ],<br>
 "name": "group-export",<br>
 "definition": "<a href="http://hl7.org/fhir/uv/bulkdata/OperationDefinition/group-export">http://hl7.org/fhir/uv/bulkdata/OperationDefinition/group-export</a>"<br>
}<br>
  ]<br>
}</p>
<p>Please let us know your thoughts.</p>



<a name="260133288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260133288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260133288">(Nov 03 2021 at 13:26)</a>:</h4>
<p>HI Mahesh, you should configure a persistence data store.  You are using the in memory datastore</p>



<a name="260133358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260133358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260133358">(Nov 03 2021 at 13:27)</a>:</h4>
<p><a href="https://github.com/IBM/FHIR/blob/main/fhir-server/liberty-config/configDropins/disabled/postgres/bulkdata.xml">https://github.com/IBM/FHIR/blob/main/fhir-server/liberty-config/configDropins/disabled/postgres/bulkdata.xml</a></p>



<a name="260133394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260133394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260133394">(Nov 03 2021 at 13:27)</a>:</h4>
<p>Here is an example.  Line 43 has the datasource for the bulkdata Server</p>



<a name="260133421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260133421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260133421">(Nov 03 2021 at 13:27)</a>:</h4>
<p>note you also need to support max_prepared_transactions on postgres</p>



<a name="260133455"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260133455" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260133455">(Nov 03 2021 at 13:28)</a>:</h4>
<p>BulkData uses JBatch which is an XA transaction across two datasources.</p>



<a name="260140096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260140096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260140096">(Nov 03 2021 at 14:18)</a>:</h4>
<p>I think Paul's answer was intended for the <code>Delete Job</code> topic.<br>
<span class="user-mention" data-user-id="192632">@Paul Bastide</span> any thoughts on the operation name we're including in our CapabilityStatement?  I think I agree with Mahesh that this should say <code>export</code> and not <code>group-export</code>...</p>



<a name="260140738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260140738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260140738">(Nov 03 2021 at 14:23)</a>:</h4>
<p>Yes. that's right on my answer. <br>
I think that change is OK, I think we hand crafted these quite a while ago</p>



<a name="260140790"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260140790" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260140790">(Nov 03 2021 at 14:24)</a>:</h4>
<p>Hello Lee, IBM FHIR gives "name": "export" in metadata but it should be "name": "group-export"</p>



<a name="260140873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260140873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260140873">(Nov 03 2021 at 14:24)</a>:</h4>
<p>oh, on that i disagree</p>



<a name="260140933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260140933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260140933">(Nov 03 2021 at 14:24)</a>:</h4>
<p>the name in the CapabilityStatement should match that which it is invoked on</p>



<a name="260140952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260140952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260140952">(Nov 03 2021 at 14:25)</a>:</h4>
<p>i think <code>export</code> is right</p>



<a name="260141007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260141007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260141007">(Nov 03 2021 at 14:25)</a>:</h4>
<p>if thats what we have now, then i don't think we need a change</p>



<a name="260144411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260144411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260144411">(Nov 03 2021 at 14:49)</a>:</h4>
<p>I've raised this at <a href="#narrow/stream/179166-implementers/topic/CapStmnt.2Econformance.2Erest.2Eoperation.2Ename.20v.20OpDef.2Ecode">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/CapStmnt.2Econformance.2Erest.2Eoperation.2Ename.20v.20OpDef.2Ecode</a> as I think its a bug in the bulkdata spec...I thought we'd already reported this by maybe not</p>



<a name="260147344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260147344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260147344">(Nov 03 2021 at 15:07)</a>:</h4>
<p>Lee, Sorry I do not see anything in that chat link that you sent.</p>



<a name="260149068"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260149068" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260149068">(Nov 03 2021 at 15:17)</a>:</h4>
<p>sorry, i fixed the title of it and that breaks the link in zulip :-(<br>
try this:  <a href="#narrow/stream/179166-implementers/topic/CapStmnt.2Erest.2Eoperation.2Ename.20v.20OpDef.2Ecode">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/CapStmnt.2Erest.2Eoperation.2Ename.20v.20OpDef.2Ecode</a></p>



<a name="260365920"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260365920" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260365920">(Nov 05 2021 at 04:47)</a>:</h4>
<p>The 'definition' here (IBM FHIR metadata) in the example below (<a href="http://hl7.org/fhir/uv/bulkdata/OperationDefinition/group-export|1.0.1">http://hl7.org/fhir/uv/bulkdata/OperationDefinition/group-export|1.0.1</a>)  contains URL and version, whereas there is another field 'version' that can contain the version <a href="https://www.hl7.org/fhir/operationdefinition.html">https://www.hl7.org/fhir/operationdefinition.html</a> . We can have the version value in its own field instead.</p>
<p>IBM FHIR metadata<br>
{<br>
"type": "Group",<br>
"profile": "<a href="http://hl7.org/fhir/profiles/Group">http://hl7.org/fhir/profiles/Group</a>",<br>
"operation": [{<br>
"name": "export",<br>
"definition": "<a href="http://hl7.org/fhir/uv/bulkdata/OperationDefinition/group-export|1.0.1">http://hl7.org/fhir/uv/bulkdata/OperationDefinition/group-export|1.0.1</a>"<br>
}]<br>
}</p>
<p>Please let us know your thoughts.</p>



<a name="260392869"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/260392869" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#260392869">(Nov 05 2021 at 11:20)</a>:</h4>
<p>URL + "|" + version is correct.</p>



<a name="269095747"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269095747" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269095747">(Jan 24 2022 at 12:07)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> <br>
I hope you are doing well. <br>
This is regarding bulk export. When we do a bulk export all resources like patient, immunization, allergies etc are exported, except the below ones:</p>
<div class="codehilite"><pre><span></span><code>  Device 
  Organization 
  Practitioner
</code></pre></div>

<p>Could you please tell us how to export above resources also?</p>
<p>Thank you,<br>
Sagar</p>



<a name="269131706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269131706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269131706">(Jan 24 2022 at 16:32)</a>:</h4>
<p>HI Sagar, can you grab the joblogs for that particular job? And the messages.log?  If you can share (after checking for any sensitive data), that would help greatly.  If Device, Organization, Practitioner are not included, it seems very strange</p>



<a name="269133173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269133173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269133173">(Jan 24 2022 at 16:42)</a>:</h4>
<p><span class="user-mention" data-user-id="392120">@Sagar Sarvankar</span> which $export operation are you invoking?  If its <code>Patient/$export</code> I think our implementation of that one will only export resources that are in a "patient compartment" as defined at <a href="https://www.hl7.org/fhir/compartmentdefinition-patient.html">https://www.hl7.org/fhir/compartmentdefinition-patient.html</a></p>



<a name="269133465"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269133465" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269133465">(Jan 24 2022 at 16:44)</a>:</h4>
<p>the spec is pretty loose in this regard...it says this:</p>
<blockquote>
<p>For Patient- and Group-level requests requests, the Patient Compartment SHOULD be used as a point of reference for recommended resources to be returned. However, other resources outside of the patient compartment that are helpful in interpreting the patient data (such as Organization and Practitioner) may also be returned.</p>
</blockquote>



<a name="269136373"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269136373" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269136373">(Jan 24 2022 at 17:02)</a>:</h4>
<p><span class="user-mention" data-user-id="191676">@Lee Surprenant</span>  We are using Group export  <a href="https://fhirserver.justtest.in:9443/fhir-server/api/v4/Group/17e8b79a2cf-20d0f360-e1e9-407a-9340-d3843a152897/$export">https://fhirserver.justtest.in:9443/fhir-server/api/v4/Group/17e8b79a2cf-20d0f360-e1e9-407a-9340-d3843a152897/$export</a></p>
<p>Could you please help us configure compartment to retrieve Device, Organization and Practitioner on IBM FHIR?</p>



<a name="269143805"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269143805" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269143805">(Jan 24 2022 at 17:56)</a>:</h4>
<p>Hi Sagar, there is a limitation on the CompartmentDefinition which is static in this case.</p>



<a name="269143835"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269143835" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269143835">(Jan 24 2022 at 17:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code>public void checkExportPatientResourceTypes(List&lt;String&gt; resourceTypes) throws FHIROperationException {
        boolean valid = false;
        try {
            // Also Check to see if the Export is valid for the Compartment.
            List&lt;String&gt; allCompartmentResourceTypes = CompartmentUtil.getCompartmentResourceTypes(&quot;Patient&quot;);
            Set&lt;String&gt; supportedResourceTypes = getSupportedResourceTypes();
            List&lt;String&gt; tmp = resourceTypes.stream()
                                        .filter(item -&gt; allCompartmentResourceTypes.contains(item) &amp;&amp; supportedResourceTypes.contains(item))
                                        .collect(Collectors.toList());
            valid = tmp != null &amp;&amp; !tmp.isEmpty();
        } catch (Exception e) {
            // No Operation intentionally
        }
        if (!valid) {
            throw buildOperationException(&quot;Resource Type outside of the Patient Compartment in Export&quot;, IssueType.INVALID);
        }
    }
</code></pre></div>



<a name="269143880"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269143880" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Bastide <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269143880">(Jan 24 2022 at 17:56)</a>:</h4>
<p>it's checking the GroupExportOperation is only including valid resources. Since the resources are outside the Compartment, they are filtered/invalid.</p>



<a name="269258828"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269258828" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269258828">(Jan 25 2022 at 13:50)</a>:</h4>
<p>Ok, but is there a way in some configuration in IBM FHIR to include the missing resources in the bulk export operation?<br>
There is one case in Inferno where it expects export of Device, Organization and Practitioner in Bulk Export Scenario. <br>
This is the last step in the Inferno tool, and on passing this test case, we will be through with all the test scenarios in the Inferno tool.</p>



<a name="269258932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269258932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269258932">(Jan 25 2022 at 13:51)</a>:</h4>
<p>thats a funny test given how loose the spec is in this regard</p>



<a name="269259040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259040">(Jan 25 2022 at 13:52)</a>:</h4>
<p>we don't support it today</p>



<a name="269259056"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259056" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259056">(Jan 25 2022 at 13:52)</a>:</h4>
<p>nor does the spec require it in my opinion</p>



<a name="269259098"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259098" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259098">(Jan 25 2022 at 13:52)</a>:</h4>
<p>however, it may be useful in real life, so I'd suggest opening an enhancement request for it</p>



<a name="269259158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259158">(Jan 25 2022 at 13:53)</a>:</h4>
<p>of note, we recently did something similar for the <code>$everything</code> operation:  <a href="https://github.com/IBM/FHIR/issues/2337">https://github.com/IBM/FHIR/issues/2337</a></p>



<a name="269259181"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259181" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259181">(Jan 25 2022 at 13:53)</a>:</h4>
<p>so i think it would be very similar to that</p>



<a name="269259297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259297">(Jan 25 2022 at 13:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191676">@Lee Surprenant</span> , may be I do not understand it completely, but Device, Organization and Practitioner should be part of bulk export data like other resources?</p>



<a name="269259386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259386">(Jan 25 2022 at 13:55)</a>:</h4>
<p>why?</p>



<a name="269259424"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259424" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259424">(Jan 25 2022 at 13:55)</a>:</h4>
<p>did you see this above, pulled right from the spec?</p>
<p><span class="user-mention silent" data-user-id="191676">Lee Surprenant</span> <a href="#narrow/stream/212434-ibm/topic/Bulk.20Export/near/269133465">said</a>:</p>
<blockquote>
<p>the spec is pretty loose in this regard...it says this:</p>
<blockquote>
<p>For Patient- and Group-level requests requests, the Patient Compartment SHOULD be used as a point of reference for recommended resources to be returned. However, other resources outside of the patient compartment that are helpful in interpreting the patient data (such as Organization and Practitioner) may also be returned.</p>
</blockquote>
</blockquote>



<a name="269259468"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259468" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259468">(Jan 25 2022 at 13:55)</a>:</h4>
<p>it says they "may" be returned</p>



<a name="269259538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269259538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269259538">(Jan 25 2022 at 13:56)</a>:</h4>
<p>our impl does not return them at the moment</p>



<a name="269269701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269269701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269269701">(Jan 25 2022 at 15:07)</a>:</h4>
<p>Yes, thank you <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> </p>
<p>So, since this is required in our case, is there a way to include this as part of the Bulk Data Export? Like including this in custom compartment or some other way?</p>
<p>I also checked in <a href="https://github.com/IBM/FHIR/issues/2337">https://github.com/IBM/FHIR/issues/2337</a> , there is development happening around $everything. Will that be helpful here?</p>
<p>Please help.</p>
<p>Regards,<br>
Sagar</p>



<a name="269293408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269293408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269293408">(Jan 25 2022 at 17:37)</a>:</h4>
<blockquote>
<p>Will that be helpful here?</p>
</blockquote>
<p>Just as an example of how to implement it (and potentially a source for some shared utilities).   That why above I said "I'd suggest opening an enhancement request for it"</p>



<a name="269360930"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/Bulk%20Export/near/269360930" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Sarvankar <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/Bulk.20Export.html#269360930">(Jan 26 2022 at 04:16)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> , <span class="user-mention" data-user-id="192632">@Paul Bastide</span> </p>
<p>The enhancement request for this requirement is created at <a href="https://github.com/IBM/FHIR/issues/3247">https://github.com/IBM/FHIR/issues/3247</a> <br>
I hope this request will considered in the next release.</p>
<p>Thank you for your support.</p>
<p>Regards,<br>
Sagar</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
