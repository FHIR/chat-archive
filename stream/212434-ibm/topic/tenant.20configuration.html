---
layout: page
title: "FHIR Chat  · tenant configuration · ibm"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/index.html">ibm</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html">tenant configuration</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="236167903"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/tenant%20configuration/near/236167903" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sridhar S <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html#236167903">(Apr 26 2021 at 12:54)</a>:</h4>
<p>i have tenant namely demo1 and demo2 in config folder which will have the schema demo1 and demo2 respectively , in configDropin i tried to add 2 datasources(datasource-demo1.xml and datasource-demo2.xml) whenever is add the 2nd tenant  i get this error <br>
 "FHIRPersistenceDBConnectException: Failure acquiring datasource"</p>



<a name="236179742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/tenant%20configuration/near/236179742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html#236179742">(Apr 26 2021 at 14:07)</a>:</h4>
<p>i'd expect a jndi error if it was unable to find the dropin.  i'd suggest double-checking your connection properties.  and maybe post the full stacktrace if you keep having issues</p>



<a name="236281273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/tenant%20configuration/near/236281273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sridhar S <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html#236281273">(Apr 27 2021 at 04:16)</a>:</h4>
<p>if i have single datasource.xml either demo1 or demo2 it works fine but when i have both files i am getting this issue</p>



<a name="236281281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/tenant%20configuration/near/236281281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sridhar S <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html#236281281">(Apr 27 2021 at 04:16)</a>:</h4>
<p>javax.naming.NameNotFoundException: jdbc/fhir_demo1_default<br>
    at com.ibm.ws.jndi.internal.ContextNode.lookup(ContextNode.java:217)<br>
    at com.ibm.ws.jndi.internal.WSContext.lookup(WSContext.java:308)<br>
    at com.ibm.ws.jndi.WSContextBase.lookup(WSContextBase.java:61)<br>
    at org.apache.aries.jndi.DelegateContext.lookup(DelegateContext.java:149)<br>
    at javax.naming.InitialContext.lookup(InitialContext.java:417)<br>
    at com.ibm.fhir.persistence.jdbc.connection.FHIRDbTenantDatasourceConnectionStrategy.getConnection(FHIRDbTenantDatasourceConnectionStrategy.java:148)<br>
    at com.ibm.fhir.persistence.jdbc.impl.FHIRPersistenceJDBCImpl.openConnection(FHIRPersistenceJDBCImpl.java:1651)<br>
    at com.ibm.fhir.persistence.jdbc.impl.FHIRPersistenceJDBCImpl.search(FHIRPersistenceJDBCImpl.java:634)<br>
    at com.ibm.fhir.server.util.FHIRRestHelper.doSearch(FHIRRestHelper.java:1026)<br>
    at com.ibm.fhir.server.util.FHIRRestHelper.doSearch(FHIRRestHelper.java:960)<br>
    at com.ibm.fhir.server.resources.Search.search(Search.java:71)<br>
    at com.ibm.fhir.server.resources.Search$Proxy$_$$_WeldClientProxy.search(Unknown Source)<br>
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>
    at java.lang.reflect.Method.invoke(Method.java:498)<br>
    at com.ibm.ws.jaxrs20.cdi.component.JaxRsFactoryImplicitBeanCDICustomizer.serviceInvoke(JaxRsFactoryImplicitBeanCDICustomizer.java:342)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsServerFactoryBean.performInvocation(LibertyJaxRsServerFactoryBean.java:641)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.performInvocation(LibertyJaxRsInvoker.java:160)<br>
    at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:101)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:273)<br>
    at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:205)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:444)<br>
    at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:111)<br>
    at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:59)<br>
    at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:96)<br>
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)<br>
    at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:123)<br>
    at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:275)<br>
    at com.ibm.ws.jaxrs20.endpoint.AbstractJaxRsWebEndpoint.invoke(AbstractJaxRsWebEndpoint.java:137)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.handleRequest(IBMRestServlet.java:146)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.doGet(IBMRestServlet.java:112)<br>
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:686)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.service(IBMRestServlet.java:96)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1257)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:745)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:442)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.invokeTarget(WebAppFilterChain.java:182)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:93)<br>
    at com.ibm.fhir.server.filter.rest.FHIRRestServletFilter.doFilter(FHIRRestServletFilter.java:142)<br>
    at javax.servlet.http.HttpFilter.doFilter(HttpFilter.java:127)<br>
    at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:201)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:90)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:1001)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1139)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1010)<br>
    at com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:75)<br>
    at com.ibm.ws.webcontainer40.servlet.CacheServletWrapper40.handleRequest(CacheServletWrapper40.java:83)<br>
    at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:936)<br>
    at com.ibm.ws.webcontainer.osgi.DynamicVirtualHost$2.run(DynamicVirtualHost.java:279)<br>
    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink$TaskWrapper.run(HttpDispatcherLink.java:1141)<br>
    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.wrapHandlerAndExecute(HttpDispatcherLink.java:422)<br>
    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.ready(HttpDispatcherLink.java:381)<br>
    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:565)<br>
    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleNewRequest(HttpInboundLink.java:499)<br>
    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.processRequest(HttpInboundLink.java:359)<br>
    at com.ibm.ws.http.channel.internal.inbound.HttpICLReadCallback.complete(HttpICLReadCallback.java:70)<br>
    at com.ibm.ws.channel.ssl.internal.SSLReadServiceContext$SSLReadCompletedCallback.complete(SSLReadServiceContext.java:1824)<br>
    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.requestComplete(WorkQueueManager.java:504)<br>
    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.attemptIO(WorkQueueManager.java:574)<br>
    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.workerRun(WorkQueueManager.java:958)<br>
    at com.ibm.ws.tcpchannel.internal.WorkQueueManager$Worker.run(WorkQueueManager.java:1047)<br>
    at com.ibm.ws.threading.internal.ExecutorServiceImpl$RunnableWrapper.run(ExecutorServiceImpl.java:239)<br>
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)<br>
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)<br>
    at java.lang.Thread.run(Thread.java:823)</p>
<p>[2021-04-27T04:14:15.982+0000] 00000113 com.ibm.fhir.persistence.jdbc.impl.CacheTransactionSync      I Transaction failed - afterCompletion(status = 4)<br>
[2021-04-27T04:14:15.982+0000] 00000113 com.ibm.fhir.server.resources.FHIRResource                   E Failure acquiring datasource<br>
com.ibm.fhir.persistence.jdbc.exception.FHIRPersistenceDBConnectException: Failure acquiring datasource  [probeId=a-20-0-4-be93ef09-5939-4ea9-85e8-29dd38c318c0]<br>
    at com.ibm.fhir.persistence.jdbc.connection.FHIRDbTenantDatasourceConnectionStrategy.getConnection(FHIRDbTenantDatasourceConnectionStrategy.java:152)<br>
    at com.ibm.fhir.persistence.jdbc.impl.FHIRPersistenceJDBCImpl.openConnection(FHIRPersistenceJDBCImpl.java:1651)<br>
    at com.ibm.fhir.persistence.jdbc.impl.FHIRPersistenceJDBCImpl.search(FHIRPersistenceJDBCImpl.java:634)<br>
    at com.ibm.fhir.server.util.FHIRRestHelper.doSearch(FHIRRestHelper.java:1026)<br>
    at com.ibm.fhir.server.util.FHIRRestHelper.doSearch(FHIRRestHelper.java:960)<br>
    at com.ibm.fhir.server.resources.Search.search(Search.java:71)<br>
    at com.ibm.fhir.server.resources.Search$Proxy$_$$_WeldClientProxy.search(Unknown Source)<br>
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>
    at java.lang.reflect.Method.invoke(Method.java:498)<br>
    at com.ibm.ws.jaxrs20.cdi.component.JaxRsFactoryImplicitBeanCDICustomizer.serviceInvoke(JaxRsFactoryImplicitBeanCDICustomizer.java:342)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsServerFactoryBean.performInvocation(LibertyJaxRsServerFactoryBean.java:641)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.performInvocation(LibertyJaxRsInvoker.java:160)<br>
    at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:101)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:273)<br>
    at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:205)<br>
    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:444)<br>
    at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:111)<br>
    at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:59)<br>
    at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:96)<br>
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)<br>
    at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:123)<br>
    at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:275)<br>
    at com.ibm.ws.jaxrs20.endpoint.AbstractJaxRsWebEndpoint.invoke(AbstractJaxRsWebEndpoint.java:137)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.handleRequest(IBMRestServlet.java:146)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.doGet(IBMRestServlet.java:112)<br>
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:686)<br>
    at com.ibm.websphere.jaxrs.server.IBMRestServlet.service(IBMRestServlet.java:96)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1257)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:745)<br>
    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:442)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.invokeTarget(WebAppFilterChain.java:182)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:93)<br>
    at com.ibm.fhir.server.filter.rest.FHIRRestServletFilter.doFilter(FHIRRestServletFilter.java:142)<br>
    at javax.servlet.http.HttpFilter.doFilter(HttpFilter.java:127)<br>
    at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:201)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:90)<br>
    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:1001)<br>
    at</p>



<a name="236318189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/tenant%20configuration/near/236318189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html#236318189">(Apr 27 2021 at 11:13)</a>:</h4>
<p>OK, this is the error i'd expect if it cannot find the datasource definition for tenant demo1.  And I have a guess about why you're seeing this.<br>
Each datasource element must have a unique id (or no id at all).  If your two datasource definitions have the same id then the latter one will overwrite the former.</p>



<a name="236318360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/tenant%20configuration/near/236318360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html#236318360">(Apr 27 2021 at 11:15)</a>:</h4>
<p>for example, if you had the following dropins:</p>
<div class="codehilite"><pre><span></span><code>&lt;dataSource id=&quot;fhirDefaultDefault&quot; jndiName=&quot;jdbc/fhir_demo1_default&quot;...
</code></pre></div>
<div class="codehilite"><pre><span></span><code>&lt;dataSource id=&quot;fhirDefaultDefault&quot; jndiName=&quot;jdbc/fhir_demo2_default&quot;...
</code></pre></div>
<p>then the latter one would override the former one and the system would be unable to find <code>jdbc/fhir_demo1_default</code></p>



<a name="236318505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/tenant%20configuration/near/236318505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html#236318505">(Apr 27 2021 at 11:16)</a>:</h4>
<p>see <a href="https://openliberty.io/docs/latest/reference/config/server-configuration-overview.html#_configuration_merging">https://openliberty.io/docs/latest/reference/config/server-configuration-overview.html#_configuration_merging</a> for more info on this feature</p>



<a name="236332835"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/212434-ibm/topic/tenant%20configuration/near/236332835" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sridhar S <a href="https://fhir.github.io/chat-archive/stream/212434-ibm/topic/tenant.20configuration.html#236332835">(Apr 27 2021 at 13:09)</a>:</h4>
<p>oh ok , thank you  now i am able to access both tenants</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
