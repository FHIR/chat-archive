---
layout: page
title: "FHIR Chat  · Snapshot generation with sparse differentials · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Snapshot.20generation.20with.20sparse.20differentials.html">Snapshot generation with sparse differentials</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="201025082"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Snapshot%20generation%20with%20sparse%20differentials/near/201025082" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Freiter <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Snapshot.20generation.20with.20sparse.20differentials.html#201025082">(Jun 16 2020 at 14:41)</a>:</h4>
<p><span class="user-mention" data-user-id="215604">@Saul Kravitz</span> and I have come across an issue relating to his <a href="https://github.com/saulakravitz/carin-bb/tree/saul">carin-bb IG</a>, that to me looks like it might be related to the IG Publisher's handling of sparse differentials. When that IG is generated using SUSHI 0.13.2, the IG Publisher quits with the following error:</p>
<div class="codehilite"><pre><span></span><code>java.lang.Exception: Error generating snapshot for CARIN BB ExplanationOfBenefit Inpatient Facility(CARIN-BB-ExplanationOfBenefit-Inpatient-Facility): Unable to generate snapshot for http://hl7.org/fhir/us/carin-bb/StructureDefinition/CARIN-BB-ExplanationOfBenefit-Inpatient-Facility in C:\Users\nfreiter\dev\standardhealth\carin-bb\input\profiles\structuredefinition-CARIN-BB-ExplanationOfBenefit-Inpatient-Facility
        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4224)
        at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3605)
        at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:836)
        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:698)
        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7533)
Caused by: org.hl7.fhir.exceptions.FHIRException: Unable to generate snapshot for http://hl7.org/fhir/us/carin-bb/StructureDefinition/CARIN-BB-ExplanationOfBenefit-Inpatient-Facility in C:\Users\nfreiter\dev\standardhealth\carin-bb\input\profiles\structuredefinition-CARIN-BB-ExplanationOfBenefit-Inpatient-Facility
        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4277)
        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4222)
        ... 4 more
Caused by: java.lang.StringIndexOutOfBoundsException: String index out of range: -25
        at java.lang.String.substring(String.java:1931)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.fixedPathSource(ProfileUtilities.java:2001)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:841)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:894)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1019)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1218)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:865)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:865)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:865)
        at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:536)
        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4275)
        ... 5 more
</code></pre></div>


<p>However, when you generate that IG using SUSHI 0.12.7, no such error appears. The only difference I can find between the StructureDefinition generated by SUSHI 0.13.2, and the StructureDefinition generated by SUSHI 0.12.7 is that the 0.12.7 output contains extra elements in the differential that have not themselves changed, but which have changed children. This was a choice we made in 0.12.7 to make differentials non-sparse. But, in 0.13.2, we rolled back this change to make the differential fully sparse per the guidance given by <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <a href="#narrow/stream/179252-IG-creation/topic/The.20link.20.22XXX.22.20for.20.22coding.22.20cannot.20be.20resolved">here</a>. So in this case, it <em>seems</em> to us like the sparse differential on this profile causes the IG Publisher to crash.</p>



<a name="201044467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Snapshot%20generation%20with%20sparse%20differentials/near/201044467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Snapshot.20generation.20with.20sparse.20differentials.html#201044467">(Jun 16 2020 at 16:57)</a>:</h4>
<p>can you please create a task here: <a href="https://github.com/HL7/fhir-ig-publisher/issues">https://github.com/HL7/fhir-ig-publisher/issues</a> and reference the branch of your repo that demonstrates the problem, and where to find it - thanks</p>



<a name="202346197"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Snapshot%20generation%20with%20sparse%20differentials/near/202346197" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Snapshot.20generation.20with.20sparse.20differentials.html#202346197">(Jun 29 2020 at 17:57)</a>:</h4>
<p>This is a blocker for updating the CI build of carinbb, unless I can force the CI build process to use sushi 0.12.7.... possible?  </p>
<p><a href="https://github.com/HL7/fhir-ig-publisher/issues/111">https://github.com/HL7/fhir-ig-publisher/issues/111</a></p>



<a name="203774432"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Snapshot%20generation%20with%20sparse%20differentials/near/203774432" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Snapshot.20generation.20with.20sparse.20differentials.html#203774432">(Jul 13 2020 at 21:31)</a>:</h4>
<p>Planning question:  Do you anticipate that this issue will be addressed this summer?<br>
<span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="203774829"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Snapshot%20generation%20with%20sparse%20differentials/near/203774829" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Snapshot.20generation.20with.20sparse.20differentials.html#203774829">(Jul 13 2020 at 21:35)</a>:</h4>
<p>yes I do</p>



<a name="204439058"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Snapshot%20generation%20with%20sparse%20differentials/near/204439058" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Snapshot.20generation.20with.20sparse.20differentials.html#204439058">(Jul 20 2020 at 15:44)</a>:</h4>
<p>Fixed in New IGPublisher v1.1.3?   (From release. notes, looks like the answer is no).  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> </p>
<p>thx</p>



<a name="204462928"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Snapshot%20generation%20with%20sparse%20differentials/near/204462928" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Snapshot.20generation.20with.20sparse.20differentials.html#204462928">(Jul 20 2020 at 19:08)</a>:</h4>
<p>no I don't think so. Still on my todo list</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
