---
layout: page
title: "FHIR Chat  · Does R5 backport Extension  work? · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html">Does R5 backport Extension  work?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="260930339"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/260930339" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#260930339">(Nov 10 2021 at 03:02)</a>:</h4>
<p>I tried to add an R5 element  to an R4 element using this backport extension...</p>
<div class="codehilite" data-code-language="yml"><pre><span></span><code># ...
  element:
    - id: DiagnosticReport
      path: DiagnosticReport
      short: US Core Diagnostic Report Profile for Report and Note exchange
      definition: &gt;-
        Clinical Testing and Imaging tests performed on a patient that results in structured or unstructured (narrative) findings specific to the patient.
      alias:
        - Imaging Report
        - Radiology Report
        - Clinical Test Report
      mustSupport: false
#=========== R5 extension for R5 media element ==============
    - id: 'DiagnosticReport.extension:r5media'
      path: DiagnosticReport.extension
      sliceName: r5media
      min: 0
      max: '1'
      type:
        - code: Extension
          profile:
            - 'http://hl7.org/fhir/4.6.0/StructureDefinition/extension-DiagnosticReport.media'
      mustSupport: true
#===============================
#etc
</code></pre></div>
<p>and not working getting this error. and ugly output</p>
<blockquote>
<p>StructureDefinition.snapshot.element[8].type[0].profile[0] error   Canonical URL '<a href="http://hl7.org/fhir/4.6.0/StructureDefinition/extension-DiagnosticReport.media">http://hl7.org/fhir/4.6.0/StructureDefinition/extension-DiagnosticReport.media</a>' does not resolve</p>
</blockquote>
<p><a href="/user_uploads/10155/6Qjgm2CKyrmSkZo0l8QUir1F/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/6Qjgm2CKyrmSkZo0l8QUir1F/image.png" title="image.png"><img src="/user_uploads/10155/6Qjgm2CKyrmSkZo0l8QUir1F/image.png"></a></div>



<a name="260941904"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/260941904" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#260941904">(Nov 10 2021 at 03:37)</a>:</h4>
<p>must be /5.0/ not /4.6.0/</p>



<a name="260949497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/260949497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#260949497">(Nov 10 2021 at 06:06)</a>:</h4>
<p>Using <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.media</code> I get this invalid extension error</p>
<p>Stack Dump (for debugging):                                                      (01:20.0758)<br>
java.lang.Exception: Error generating snapshot for /Users/ehaas/Documents/FHIR/Healthedata1-Sandbox/input/resources/StructureDefinition-uscdiv2-diagnosticreport(us-core-diagnosticreport-note): Unable to generate snapshot for <a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-note">http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-note</a> in /Users/ehaas/Documents/FHIR/Healthedata1-Sandbox/input/resources/StructureDefinition-uscdiv2-diagnosticreport<br>
    at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4692)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3976)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:901)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:753)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8766)<br>
Caused by: org.hl7.fhir.exceptions.FHIRException: Unable to generate snapshot for <a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-note">http://hl7.org/fhir/us/core/StructureDefinition/us-core-diagnosticreport-note</a> in /Users/ehaas/Documents/FHIR/Healthedata1-Sandbox/input/resources/StructureDefinition-uscdiv2-diagnosticreport<br>
    at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4741)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4690)<br>
    ... 4 more<br>
Caused by: org.hl7.fhir.exceptions.FHIRException: Reference to invalid extension <a href="http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.media">http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.media</a><br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1161)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1528)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:653)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4739)<br>
    ... 5 more</p>



<a name="260950202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/260950202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#260950202">(Nov 10 2021 at 06:19)</a>:</h4>
<p>guess I'll have to debug - how can I do that?</p>



<a name="261006165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261006165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261006165">(Nov 10 2021 at 15:31)</a>:</h4>
<p>I'll create a test branch that works this time and let you know.</p>



<a name="261287583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261287583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261287583">(Nov 12 2021 at 17:53)</a>:</h4>
<p>Is there a story for complex element backports? Like a new complex element in R5... what do the (implicit?) backport extensions) look like?</p>



<a name="261294704"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261294704" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261294704">(Nov 12 2021 at 18:46)</a>:</h4>
<p>IIRC, it's basically a complex extension w/ sub-extensions defined inline w/ relative paths.  We had to implement something in SUSHI that basically synthesized these extensions when someone used them.  At the time, the doc lacked a lot of details, but I filed a Jira issue to fill out some of the gaps.  The resolution provides some of the guidance that will be added to the spec: <a href="https://jira.hl7.org/browse/FHIR-31721">https://jira.hl7.org/browse/FHIR-31721</a></p>



<a name="261294795"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261294795" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261294795">(Nov 12 2021 at 18:47)</a>:</h4>
<p>BTW -- we've not yet integrated (into SUSHI) the newer information from the resolution.  So some of what SUSHI does may be out of alignment w/ this new guidance.  But I think that's outside the scope of this particular conversation anyway.</p>



<a name="261516769"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261516769" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261516769">(Nov 15 2021 at 15:54)</a>:</h4>
<p>General question on this - since R5 isn't published yet, what happens to extensions linked this way if the path/type/cardinality/etc. changes?</p>



<a name="261525481"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261525481" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261525481">(Nov 15 2021 at 16:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="261544623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261544623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261544623">(Nov 15 2021 at 19:12)</a>:</h4>
<p>then they have to change</p>



<a name="261553249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261553249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261553249">(Nov 15 2021 at 20:18)</a>:</h4>
<p>How?  If someone publishes an IG with an extension today, it will have a definition.  If the extension is arbitrarily broken in an update to R5, does that mean the IG needs to be updated?  Does the old version stop working?  Does the IG automatically refer to the new version?  If the change is to type/cardinality, don't we now have two definitions on the same URL with different type info, or does the implicit definition include some versioning info I missed?</p>
<p>Sorry if this is a lot, I'm just trying to understand how you can safely link to unpublished content.. so far, my understanding has been that you can't.  I'm trying to figure out if I'm missing something, since it appears that people are doing exactly that.</p>



<a name="261554684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261554684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261554684">(Nov 15 2021 at 20:28)</a>:</h4>
<p>It seems to me that using extensions that reference types from a future version of FHIR should be accompanied by a big fat "use at your own risk" warning.  I think it's a valid question to ask if stable versions of IGs should be allowed to reference unstable versions of FHIR.  In fact, since the backport extension URLs don't specify any minor version components, it's not even necessarily linked to a specific ballot version -- which makes it pretty difficult to reproduce the build.</p>



<a name="261558825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261558825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261558825">(Nov 15 2021 at 21:05)</a>:</h4>
<p>right. it's not entirely use at own risk. if you are publishing a guide that uses an R5 extension in advance of the publication of R5, you can at least let the committee know and expect that they'll keep this in mind doing reconciliation but if they don't... well, validation will start failing once a different extension definition is published (I update the R5 definitions each time I publish a R5 candidate).</p>



<a name="261559983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261559983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261559983">(Nov 15 2021 at 21:13)</a>:</h4>
<p>Right.  Well, I'll say this hasn't changed my mind on the topic - I feel like it's handing users a loaded gun with an extra-heavy barrel and hoping they don't shoot themselves in the foot.</p>
<p>I'd recommend a warning stronger than "use at your own risk".  Something more like "only use this if you are absolutely sure you know what you are doing, and even then you should probably check twice".</p>



<a name="261560362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261560362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261560362">(Nov 15 2021 at 21:16)</a>:</h4>
<p>my point isn't about the strength of the warning, but that it's not entirely user level risk. It's committee/editor risk as well</p>



<a name="261563259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261563259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261563259">(Nov 15 2021 at 21:40)</a>:</h4>
<p>If you're arguing that we shouldn't have the ability to link to unpublished content, you're not going to get an argument from me  =).  In fact, I would happily put forward the argument that this should not be allowed.</p>
<p>For me, the main reason is a whole set of undefined behavior areas that I don't think we can get around.  E.g., if a ballot/publication happens with links to content that isn't stable, which then changes, what's the state of a published IG?  The definition used when it was balloted/published is no longer available, and the extension it points to may or may not even exist.</p>
<p>You will have things like R4 implementations that work one day and are incompatible with ones made the next day - against the same version of the same published document.</p>
<p>I don't think there's a process that avoids that, other than locking down anything that gets referenced (but that invalidates the whole FMM process).</p>



<a name="261565666"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261565666" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261565666">(Nov 15 2021 at 21:59)</a>:</h4>
<p>Isn't that why we have the STU status for IGs? The backport extensions are only allowed in IGs, and IGs can't be normative with backport extensions that are not against a published version. If that is not a current rule, is should be <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span> </p>
<p>This way the capability is useful, and still allows for the flexibility of STU.</p>



<a name="261565888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261565888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261565888">(Nov 15 2021 at 22:00)</a>:</h4>
<p>Sure, but they still break.  Making IG authors define the extension in the IG is an extra step, but ensures that none of these problems happen.</p>



<a name="261568978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261568978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261568978">(Nov 15 2021 at 22:26)</a>:</h4>
<p>STU shouldn't mean that validation will arbitrarily stop working for a published release.  That's a bit more precarious than typical STU.  It might not be a bad idea to highlight the risk in the IG text.  We had talked about the possibility of propagating a copy of the pre-adopted extension into the IG package which would have avoided the validator breaking problem, but Grahame nixed that.</p>



<a name="261571628"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261571628" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261571628">(Nov 15 2021 at 22:47)</a>:</h4>
<p>I'm not particularly fussed about validation so much as actual usage - I don't know how to resolve some of the states.  For a concrete example: if a  IG-A uses an element in R5 that is a <code>0..1</code>, <code>string</code> when it ballots, then the element moves <code>0..*</code>, <code>Backbone</code> in R5 and IG-B ballots, what happens?</p>
<p>First is <em>just</em> in IG-A: the name of the <code>value[x]</code> is wrong, and it is the wrong structure.</p>
<p>But, say these were two related IGs that just happen to have been balloted in different cycles.  Now they have the same extension URL with different, incompatible, definitions.</p>
<p>What is the expectation on using that value in IG-A?  Is it still the single value, even though the 'official' definition for that extension is an array now?  The two IGs were expecting to interoperate, but because of a publication timeline they don't.. does IG-A need to re-publish (noting that it may be months before the next publication window, at the very least missing the next connectathon)?</p>
<p>I'm using that as an example, but at the end of the day I see linking to unpublished content as <em>extremely</em> fragile.  Given the opportunity for problems, wouldn't it be easier to limit it to published content and give guidance on how to define a similar extension, in your IG, for unpublished content?</p>



<a name="261581027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261581027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261581027">(Nov 16 2021 at 00:21)</a>:</h4>
<p>well, in the future, IG QA pages will call out any reference to R5 so that we're more aware of it. but there's no simple solution to this</p>



<a name="261654537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Does%20R5%20backport%20Extension%20%20work%3F/near/261654537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Does.20R5.20backport.20Extension.20.20work.3F.html#261654537">(Nov 16 2021 at 15:09)</a>:</h4>
<p>Or, we could say that with implementer experience this feature was deemed unsafe and have it start throwing errors moving forward.</p>
<p>edit: for clarification, I mean referring to unpublished content</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
