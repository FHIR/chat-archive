---
layout: page
title: "FHIR Chat  · ValueSet/$expand limit on tx.fhir.org · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html">ValueSet/$expand limit on tx.fhir.org</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="219877303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219877303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219877303">(Dec 14 2020 at 17:51)</a>:</h4>
<p>Does anyone know why <code>tx.fhir.org</code> only returns 200 items when trying to find the LOINC codes with <code>LP31412-7</code> as an ancestor? There are 214 codes that are descendants per the flatfiles on <a href="http://loinc.org">loinc.org</a>.</p>
<p>Here's the request in question -- note that <code>_limit</code> has no effect on the number of items in the response as far as I can tell:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>curl -X <span class="s2">"POST"</span> <span class="s2">"http://tx.fhir.org/r4/ValueSet/</span><span class="nv">$expand</span><span class="s2">"</span> <span class="se">\</span>
     -H <span class="s1">'Accept: application/json'</span> <span class="se">\</span>
     -H <span class="s1">'Content-Type: application/fhir+xml;charset=UTF-8'</span> <span class="se">\</span>
     -H <span class="s1">'Accept-Charset: UTF-8'</span> <span class="se">\</span>
     -H <span class="s1">'Accept-Encoding: gzip'</span> <span class="se">\</span>
     -H <span class="s1">'User-Agent: hapi-fhir-tooling-client'</span> <span class="se">\</span>
 -d <span class="s2">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;Parameters xmlns=\"http://hl7.org/fhir\"&gt;&lt;id value=\"exp-params\"/&gt;&lt;parameter&gt;&lt;name value=\"system-version\"/&gt;&lt;valueUri value=\"http://snomed.info/sct|http://snomed.info/sct/731000124108\"/&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\"includeDefinition\"/&gt;&lt;valueBoolean value=\"false\"/&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\"excludeNested\"/&gt;&lt;valueBoolean value=\"false\"/&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\"valueSet\"/&gt;&lt;resource&gt;&lt;ValueSet&gt;&lt;status value=\"active\"/&gt;&lt;compose&gt;&lt;include&gt;&lt;system value=\"http://loinc.org\"/&gt;&lt;filter&gt;&lt;property value=\"ancestor\"/&gt;&lt;op value=\"=\"/&gt;&lt;value value=\"LP31412-7\"/&gt;&lt;/filter&gt;&lt;/include&gt;&lt;/compose&gt;&lt;/ValueSet&gt;&lt;/resource&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\"_limit\"/&gt;&lt;valueString value=\"1000\"/&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\"_incomplete\"/&gt;&lt;valueString value=\"true\"/&gt;&lt;/parameter&gt;&lt;/Parameters&gt;"</span>
</code></pre></div>
<p>(cc <span class="user-mention" data-user-id="191447">@Mark Kramer</span>)</p>



<a name="219878724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219878724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219878724">(Dec 14 2020 at 18:02)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span></p>



<a name="219899943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219899943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219899943">(Dec 14 2020 at 20:49)</a>:</h4>
<p>theres' no built in limit to the server. The server thinks that there's 200 codes in that value set expansion, and returns them to you</p>



<a name="219900249"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219900249" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219900249">(Dec 14 2020 at 20:52)</a>:</h4>
<p>So that does raise a further question - if the server actually isn't returning the full set of concepts that it should in the expansion.</p>



<a name="219900769"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219900769" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219900769">(Dec 14 2020 at 20:56)</a>:</h4>
<p>if you think that the expansion is actually wrong, what's missing?</p>



<a name="219900840"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219900840" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219900840">(Dec 14 2020 at 20:57)</a>:</h4>
<p><span class="user-mention" data-user-id="322501">@Max Masnick</span>?</p>



<a name="219913346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219913346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219913346">(Dec 14 2020 at 22:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Ah, sorry to jump to conclusions. There are 14 codes that  appear in the LOINC hierarchy that don't appear in the <a href="http://tx.fhir.org">tx.fhir.org</a> expansion. Here they are: <a href="/user_uploads/10155/OIf92W0qZIvbHR7UYyAjZmtI/missing_loinc.txt">missing_loinc.txt</a> </p>
<p>I'm not going to claim that these 14 codes should <em>for sure</em> appear in the <a href="http://tx.fhir.org">tx.fhir.org</a> expansion -- there very well may be a good reason they shouldn't. But here they are in case it is indicative of an actual problem. Thanks!</p>



<a name="219914773"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219914773" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219914773">(Dec 14 2020 at 23:00)</a>:</h4>
<p>Is this a difference between loinc versions?</p>



<a name="219935146"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219935146" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219935146">(Dec 15 2020 at 03:52)</a>:</h4>
<p>The LOINC versions should be the same.  The <a href="http://tx.fhir.org">tx.fhir.org</a> server is on 2.68, which is the latest.  When I post the query to <a href="http://tx.fhir.org">tx.fhir.org</a> it returns the parameter "limitedExpansion", so it's obviously not returning everything.  If I post the query to <a href="https://fhir.loinc.org">https://fhir.loinc.org</a> it tells me that 'total' = 500.  The value set definition of the ancestors of LP31412-7 is being interpreted differently by the two servers (looking for ancestors is somewhat unusual, as typically we're looking for descendants - but in this case it may make sense to do that to get what you're wanting in LOINC).  The <a href="http://fhir.loinc.org">fhir.loinc.org</a> server is returning some codes from the Multi-axial hierarchy like:</p>
<div class="codehilite"><pre><span></span><code>      &lt;contains&gt;
         &lt;system value=&quot;http://loinc.org&quot;/&gt;
         &lt;code value=&quot;LP381385-6&quot;/&gt;
         &lt;display value=&quot;Choriogonadotropin.alpha subunit free | Serum or Plasma | Chemistry - non-challenge&quot;/&gt;
      &lt;/contains&gt;
</code></pre></div>
<p>That's perfectly legitimate, but <a href="http://tx.fhir.org">tx.fhir.org</a> apparently isn't doing that (which is also legitimate).  So I think there are apples to oranges comparisons going on here.  And it probably doesn't affect the results, but I also note that the 'system-version' expansion parameter value is for a SNOMED CT version, while we're expanding a value set defined on the LOINC (I assume that system-version is being ignored, but it's hard to be certain).</p>



<a name="219940644"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219940644" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219940644">(Dec 15 2020 at 05:56)</a>:</h4>
<p>yes it's ignored</p>



<a name="219940700"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219940700" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219940700">(Dec 15 2020 at 05:58)</a>:</h4>
<p>limitedExpansion is only saying that a limited expansion would be ok, but we don't actually have a limited expansion in this context</p>



<a name="219974034"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219974034" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kramer <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219974034">(Dec 15 2020 at 12:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> ancestor is correct when you are looking for descendants. It is saying, get me all codes whose ancestor is LP31412-7:<br>
<code>* include codes from system LNC where ancestor = "LP101591-8"</code></p>



<a name="219986597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219986597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219986597">(Dec 15 2020 at 14:31)</a>:</h4>
<p>Re: <code>&lt;name value=\"system-version\"/&gt;&lt;valueUri value=\"http://snomed.info/sct|http://snomed.info/sct/731000124108\"/&gt;</code>, this comes from the IG publisher -- this is exactly the same request the publisher makes to expand the value set, but in <code>curl</code> format.</p>



<a name="219990712"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219990712" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219990712">(Dec 15 2020 at 15:01)</a>:</h4>
<p>The <a href="http://fhir.loinc.org">fhir.loinc.org</a> expansion returns 280 LOINC (and some additional LOINC Part codes), which is 64 <strong>additional</strong> codes than I found when looking at <code>MultiAxialHierarchy.csv</code>. I'm not sure where these additional codes are coming from yet....maybe some of the LP codes are being used recursively to find additional codes that don't show up if you only search the hierarchy for <code>LP31412-7</code>?</p>



<a name="219991277"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219991277" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219991277">(Dec 15 2020 at 15:05)</a>:</h4>
<p>So we have:</p>
<ul>
<li><code>tx.fhir.org</code>: 200 codes (and no LP codes)</li>
<li><code>MultiAxialHierarchy.csv</code>: 14 additional LOINC (so 214 total), and some additional LP codes</li>
<li><code>fhir.loinc.org</code>:  64 additional LOINC (so 280 total),  and some additional LP codes</li>
</ul>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span> I don't think we care about the LP codes for the purposes of expanding the value set for the IG. But we still have different counts of the non-LP codes depending on the source, which I believe should be apples-to-apples.</p>



<a name="219993716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/219993716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#219993716">(Dec 15 2020 at 15:23)</a>:</h4>
<p>Right, to all of the above points.  I was forgetting the details on limitedExpansion.  And I think I might not have ever actually tried to use the LOINC 'ancestor' property before.  Thinking about it more, it's somewhat similar to using a filter op of 'descendent-of', but states it from the opposite end of the relationships (could be a little confusing).  So we're still getting different behavior from the servers in regard to the Multi-axial hierarchy.</p>



<a name="220050031"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/220050031" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#220050031">(Dec 15 2020 at 22:10)</a>:</h4>
<p>I confirm that this is an indexing bug in <a href="http://tx.fhir.org">tx.fhir.org</a></p>



<a name="220322915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/ValueSet/%24expand%20limit%20on%20tx.fhir.org/near/220322915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/ValueSet.2F.24expand.20limit.20on.20tx.2Efhir.2Eorg.html#220322915">(Dec 18 2020 at 00:30)</a>:</h4>
<p>ok is fixed now.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
