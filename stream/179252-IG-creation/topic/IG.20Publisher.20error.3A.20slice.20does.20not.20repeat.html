---
layout: page
title: "FHIR Chat  · IG Publisher error: slice does not repeat · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html">IG Publisher error: slice does not repeat</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153997457"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997457" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997457">(Sep 17 2018 at 21:29)</a>:</h4>
<p>I keep getting this error "Attempt to a slice an element that does not repeat: Observation.effective[x]/Observation.effective[x] ..."<br>
Well, the element clearly repeats but I cannot figure out the proper syntax (obviously) for the case when one of the slices is a primitive.</p>
<p>Here is my structure definition for the Observation.effective[x]</p>
<div class="codehilite"><pre><span></span>    &lt;!-- Effective: The time stamp --&gt;
    &lt;element id=&quot;Observation.effective[x]&quot;&gt;
      &lt;path value=&quot;Observation.effective[x]&quot; /&gt;
      &lt;slicing&gt;
        &lt;discriminator&gt;
          &lt;type value=&quot;type&quot; /&gt;
          &lt;path value=&quot;$this&quot; /&gt;
        &lt;/discriminator&gt;
        &lt;rules value=&quot;open&quot; /&gt;
      &lt;/slicing&gt;
      &lt;definition value=&quot;The time or time-period the observed value is asserted as being true. It is a time period if a Measure-Active-Period (duration) attribute is part of the metric measurement sent by the PHD. Otherwise it is the time stamp sent by the PHD or the time of reception by the PHG if the PHD sent no time stamp.&quot; /&gt;
      &lt;min value=&quot;1&quot; /&gt;
      &lt;type&gt;
        &lt;code value=&quot;dateTime&quot;/&gt;
      &lt;/type&gt;
      &lt;type&gt;
        &lt;code value=&quot;Period&quot;/&gt;
      &lt;/type&gt;
    &lt;/element&gt;
    &lt;!-- Time stamp: Instant --&gt;
    &lt;element id=&quot;Observation.effective[x]:dateTime&quot;&gt;
      &lt;path value=&quot;Observation.effective[x]&quot; /&gt;
      &lt;sliceName value=&quot;dateTime&quot; /&gt;
      &lt;short value=&quot;The time stamp of the measurement&quot; /&gt;
      &lt;definition value=&quot;The time stamp of the measurement when the measurement is taken at an instance in time&quot; /&gt;
      &lt;comment value=&quot;A date and time or period shall always be present but not both.&quot; /&gt;
      &lt;min value=&quot;1&quot; /&gt;
      &lt;type&gt;
        &lt;code value=&quot;dateTime&quot; /&gt;
      &lt;/type&gt;

    &lt;!-- it seems like this should not be here; remove it makes no difference --&gt;
    &lt;/element&gt;
    &lt;element id=&quot;Observation.effective[x]:dateTime.effectiveDateTime&quot;&gt;
      &lt;path value=&quot;Observation.effectiveDateTime&quot; /&gt;
      &lt;min value=&quot;1&quot; /&gt;
    &lt;/element&gt;

    &lt;!-- Time stamp: Period --&gt;
    &lt;element id=&quot;Observation.effective[x].effectivePeriod&quot;&gt;
      &lt;path value=&quot;Observation.effectivePeriod&quot; /&gt;
      &lt;sliceName value=&quot;effectivePeriod&quot; /&gt;
      &lt;short value=&quot;The time period of the measurement&quot; /&gt;
      &lt;definition value=&quot;The time period of the measurement when the measurement has a duration. The duration of the measurement is reported in a Measure-Active-Period attribute. The difference between the end and start fields is the value of the Measure-Active-Period.&quot; /&gt;
      &lt;type&gt;
        &lt;code value=&quot;Period&quot; /&gt;
      &lt;/type&gt;
    &lt;/element&gt;
    &lt;element id=&quot;Observation.effective[x]:effectivePeriod.start&quot;&gt;
      &lt;path value=&quot;Observation.effectivePeriod.start&quot; /&gt;
      &lt;min value=&quot;1&quot; /&gt;
    &lt;/element&gt;
    &lt;element id=&quot;Observation.effective[x]:effectivePeriod.end&quot;&gt;
      &lt;path value=&quot;Observation.effectivePeriod.end&quot; /&gt;
      &lt;definition value=&quot;The end of the period. It will be the value of the Measure-Active-Period plus the start time.&quot; /&gt;
      &lt;min value=&quot;1&quot; /&gt;
    &lt;/element&gt;
</pre></div>


<p>I have tried so many combinations but either IG publisher hangs or I get the above error. (Some of my combinations were just shots in the dark ... signs of desperation.) Anybody see something obviously wrong? I am pretty sure it is the first slice (the primitive) that is causing the problem.</p>



<a name="153997460"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997460" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997460">(Sep 17 2018 at 21:30)</a>:</h4>
<p>It may actually be a bug with the IGPublisher.  Not sure anyone's tried to do that before, though it should be legal.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>, thoughts?</p>



<a name="153997461"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997461" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997461">(Sep 17 2018 at 21:32)</a>:</h4>
<blockquote>
<p>It may actually be a bug with the IGPublisher.  Not sure anyone's tried to do that before, though it should be legal.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>, thoughts?</p>
</blockquote>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  Does my slicing look right? I am concerned about slicing a primitive. Do I have a superfluous element for the effectiveDateTime case?</p>
<p>Just for interest, the slicing is due to the PHD time stamp. The time stamp can be an instant in time (most common) or a Period (such as an exercise session). The latter is very common in fitness PHDs.</p>



<a name="153997466"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997466" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997466">(Sep 17 2018 at 22:18)</a>:</h4>
<p>what repeats?</p>



<a name="153997470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997470">(Sep 17 2018 at 22:53)</a>:</h4>
<blockquote>
<p>what repeats?</p>
</blockquote>
<p>The publisher states that my slice does NOT repeat. But it does ... I have two slices. One for an instant in time, and another for a period of time.</p>



<a name="153997471"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997471" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rick Geimer <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997471">(Sep 17 2018 at 23:17)</a>:</h4>
<p>Maybe I am missing something here, but Observation.effectiveTime[x] has a cardinality of 0..1, so the element itself can't repeat (i.e. you can't have both effectiveDateTime and effectivePeriod  in the same Observation instance). Is that what you are trying to do, or are you trying to accomplish something else with your slices?</p>



<a name="153997472"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997472" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997472">(Sep 17 2018 at 23:19)</a>:</h4>
<blockquote>
<p>Maybe I am missing something here, but Observation.effectiveTime[x] has a cardinality of 0..1, so the element itself can't repeat (i.e. you can't have both an instant in time and a period of time in the same Observation instance). Is that what you are trying to do, or are you trying to accomplish something else with your slices?</p>
</blockquote>
<p><span class="user-mention" data-user-id="191407">@Rick Geimer</span>  It's one or the other, never both. I am not quite sure I have set that up correctly. I may need some conditional but I am unsure of the syntax.</p>
<p>Maybe its something like this in the top level effective[x]</p>
<div class="codehilite"><pre><span></span>      &lt;constraint&gt;
        &lt;key value=&quot;phd-obs-1&quot;/&gt;
        &lt;!-- Some time stamp SHALL be present --&gt;
        &lt;severity value=&quot;error&quot;/&gt;
        &lt;human value=&quot;Either an effectiveDateTime or effectivePeriod shall be present&quot;/&gt;
        &lt;expression value=&quot;effectiveDateTime.exists() or effectivePeriod.exists().exists()&quot;/&gt;
      &lt;/constraint&gt;
</pre></div>


<p>I tried this constraint and the IG publisher no longer gave me that error</p>



<a name="153997480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997480">(Sep 17 2018 at 23:46)</a>:</h4>
<p>It's legitimate to slice non-repeating elements</p>



<a name="153997484"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997484" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997484">(Sep 17 2018 at 23:50)</a>:</h4>
<blockquote>
<p>It's legitimate to slice non-repeating elements</p>
</blockquote>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  Not what I expected but from a comment by Rick I added a constraint that either an effectiveDateTime or an effectivePeriod must exist, (but not both). This stopped the ' no repeat ' error message and the IG Publisher processed my base resource structure definition. Now I am hanging on processing the next resource which 'inherits' the base resource. I am not sure I have done that correctly. I am porting from Forge and the two may reference base resources in different ways.</p>



<a name="153997488"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997488" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997488">(Sep 18 2018 at 00:00)</a>:</h4>
<p>A constraint should make any difference to how the snapshot generator functions...</p>



<a name="153997489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997489">(Sep 18 2018 at 00:00)</a>:</h4>
<blockquote>
<p>It's legitimate to slice non-repeating elements</p>
</blockquote>



<a name="153997490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997490">(Sep 18 2018 at 00:00)</a>:</h4>
<p>no it's not</p>



<a name="153997491"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997491" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997491">(Sep 18 2018 at 00:01)</a>:</h4>
<p>this is docmented here:</p>



<a name="153997492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997492">(Sep 18 2018 at 00:02)</a>:</h4>
<p><a href="http://build.fhir.org/elementdefinition.html#typesx" target="_blank" title="http://build.fhir.org/elementdefinition.html#typesx">http://build.fhir.org/elementdefinition.html#typesx</a></p>



<a name="153997495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997495">(Sep 18 2018 at 00:15)</a>:</h4>
<p>I don't see the prohibition of slicing a single element stated on that page. <br>
However the page refers to <a href="http://build.fhir.org/profiling.html#slicing" target="_blank" title="http://build.fhir.org/profiling.html#slicing">http://build.fhir.org/profiling.html#slicing</a> which includes "... to take an element that may occur more than once (e.g. in a list), and then split the list into a series of sublists, each with different restrictions on the elements in the sublist with associated additional meaning. In FHIR, this operation is known as "Slicing" a list."</p>



<a name="153997496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997496">(Sep 18 2018 at 00:35)</a>:</h4>
<p>This says that you can implicitly slice polymorphic elements by type and don't use the slicing mechanism to do so.  I still thought we supported slicing non-repeating elements.  E.g. allowing you to say that a non-repeating element needs to follow constraint set X or Y</p>



<a name="153997528"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997528" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997528">(Sep 18 2018 at 06:50)</a>:</h4>
<p>I wasn't aware that slicing is apparently only allowed for repeating elements... why would cardinality be a limiting factor?</p>



<a name="153997541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997541">(Sep 18 2018 at 08:33)</a>:</h4>
<blockquote>
<p>I wasn't aware that slicing is apparently only allowed for repeating elements... why would cardinality be a limiting factor?</p>
</blockquote>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span>  You can't slice on a non-repeating element and end up with two entries in a given structure. But I thought you could slice on a choice element. In this case there will be only one choice in the final structure but that choice may be different depending. I tried to do the latter on an Observation.effective[x] element. I know the PoCD IG slices on an Observation.value[x] element with the choice being a valueQuantity or a valueRatio.</p>
<p>I thought this might be done by using &lt;max value="1" /&gt; in the first element. That states there can only be one such entry. In any case putting in the constraint solved the problem. The constraint is also clearer for the implementer because it specifically spells out the condition. In my case there SHALL be an effective[x] and it shall be either a dateTime or a Period but not both.</p>
<p>If I could slice on a non-repeating element I would slice on the Observation.device element and have one entry point to the PHD endpoint and the other entry point to the PHG endpoint. But that I cannot do. So to reference the PHG endpoint I need an extension.</p>



<a name="153997542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997542">(Sep 18 2018 at 08:39)</a>:</h4>
<p>If the current participants in this conversation aren't clear about the rules on this, then that's somewhat concerning.  As Lloyd said and Brian agreed, I understood that you can slice polymorphic (choice) elements by type - I've done that and it will validate.</p>



<a name="153997543"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997543" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997543">(Sep 18 2018 at 08:42)</a>:</h4>
<p>A resource instance is only allowed to specify (at most) a single value for a non-repeating element. However a StructureDefinition can introduce different options, e.g. for a non-repeating choice type element. Technically, I think we could also handle slicing on non-repeating fixed type elements - however I don't think any current tools allow/support that.</p>



<a name="153997544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997544">(Sep 18 2018 at 08:42)</a>:</h4>
<p>e.g. allow slicing on <code>Observation.device</code></p>



<a name="153997545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997545">(Sep 18 2018 at 08:47)</a>:</h4>
<blockquote>
<p>A resource instance is only allowed to specify (at most) a single value for a non-repeating element. However a StructureDefinition can introduce different options, e.g. for a non-repeating choice type element. Technically, I think we could also handle slicing on non-repeating fixed type elements - however I don't think any current tools allow/support that.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span>  I think that's where I made my error in my attempt. I did not properly indicate in my slicing that there was a maximum of only one entry. <span class="user-mention" data-user-id="191407">@Rick Geimer</span>  pointed out that there could only be one entry and from my struct definition he did not interpret it as restricting it to only one entry. So I tried a constraint in the first element and that worked. It amazes me the IG publisher could interpret that. The other possible way would be to put &lt;max value="1" /&gt; in the first element. THat seems more straight forward. I am going to give that a whirl and see if it works. It should.</p>



<a name="153997546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997546">(Sep 18 2018 at 08:49)</a>:</h4>
<blockquote>
<p>If the current participants in this conversation aren't clear about the rules on this, then that's somewhat concerning.  As Lloyd said and Brian agreed, I understood that you can slice polymorphic (choice) elements by type - I've done that and it will validate.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191405">@Rob Hausam</span>  Did you indicate in your slicing that there could only be one entry in the final structure? I think that's where I failed...I did not properly do that. And I am very much of a newbie at writing Structure Definitions by hand so I still have a lot of learning to do.</p>



<a name="153997547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997547">(Sep 18 2018 at 08:51)</a>:</h4>
<p>The cardinality of the slicing introduction element limits the total number of allowed elements. If this equals 0...1, then the sliced element cannot repeat. Cardinality of individual named slices cannot relax this.</p>



<a name="153997548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997548">(Sep 18 2018 at 08:54)</a>:</h4>
<blockquote>
<p>The cardinality of the slicing introduction element limits the total number of allowed elements. If this equals 0...1, then the sliced element cannot repeat. Cardinality of individual named slices cannot relax this.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span>  So are you saying that my structure definition slicing should have worked? (its listed above). I did not put a &lt;max value="1" /&gt; in it because that is required and I placed no constraint. It failed. The constraint made it work. I am going to try the &lt;max &gt; alone now without the constraint.</p>
<p>Results:<br>
&lt;max value="1" /&gt; alone works<br>
&lt;constraint&gt;  alone (where only one or the other slice is allowed) also works<br>
&lt;constraint&gt; and &lt;max&gt; above together also works<br>
neither &lt;max&gt; or &lt;constraint&gt; causes the slice on a non-repeating element to occur.</p>
<p>So I have to specify in my &lt;differential&gt; that the maximum number of effective[x] entries is one even though it is part of the base definition (usually you don't). Do that or put in the restricting constraint.</p>



<a name="153997550"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997550" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997550">(Sep 18 2018 at 09:04)</a>:</h4>
<p>Currently, FHIR only defines slicing on repeated elements and choice type elements. I don't think you are allowed to slice non-repeating fixed type elements. However I think that this is not a <em>technical</em> limitation, i.e. seems feasible to implement.</p>



<a name="153997551"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997551" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997551">(Sep 18 2018 at 09:13)</a>:</h4>
<blockquote>
<p>Currently, FHIR only defines slicing on repeated elements and choice type elements. I don't think you are allowed to slice non-repeating fixed type elements. However I think that this is not a <em>technical</em> limitation, i.e. seems feasible to implement.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span>  okay, that's a slight different issue. I was not having a problem trying to slice a non-repeating element but a choice element. One of the choices was a primitive and that's where I got stuck. I see examples of slicing on choices where both choices are non-primitives but I did not know how to reduce it to a case where one was a primitive. One has fewer options in the primitive case.</p>
<p>In the end there is still something funny going one. If I specify '&lt;max value="1" /&gt; it works. But the base structure definition already does this.</p>



<a name="153997552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997552">(Sep 18 2018 at 09:20)</a>:</h4>
<p>I've used Forge to re-create your slice:</p>
<div class="codehilite"><pre><span></span>&lt;element id=&quot;Observation.effective[x]&quot;&gt;
    &lt;path value=&quot;Observation.effective[x]&quot;/&gt;
    &lt;slicing&gt;
        &lt;discriminator&gt;
            &lt;type value=&quot;type&quot;/&gt;
            &lt;path value=&quot;$this&quot;/&gt;
        &lt;/discriminator&gt;
        &lt;rules value=&quot;open&quot;/&gt;
    &lt;/slicing&gt;
    &lt;min value=&quot;1&quot;/&gt;
&lt;/element&gt;
&lt;element id=&quot;Observation.effective[x]:effectiveDateTime&quot;&gt;
    &lt;path value=&quot;Observation.effective[x]&quot;/&gt;
    &lt;sliceName value=&quot;effectiveDateTime&quot;/&gt;
    &lt;min value=&quot;1&quot;/&gt;
    &lt;type&gt;
        &lt;code value=&quot;dateTime&quot;/&gt;
    &lt;/type&gt;
&lt;/element&gt;
&lt;element id=&quot;Observation.effective[x]:effectivePeriod&quot;&gt;
    &lt;path value=&quot;Observation.effective[x]&quot;/&gt;
    &lt;sliceName value=&quot;effectivePeriod&quot;/&gt;
    &lt;type&gt;
        &lt;code value=&quot;Period&quot;/&gt;
    &lt;/type&gt;
&lt;/element&gt;
&lt;element id=&quot;Observation.effective[x]:effectivePeriod.start&quot;&gt;
    &lt;path value=&quot;Observation.effective[x].start&quot;/&gt;
    &lt;min value=&quot;1&quot;/&gt;
&lt;/element&gt;
&lt;element id=&quot;Observation.effective[x]:effectivePeriod.end&quot;&gt;
    &lt;path value=&quot;Observation.effective[x].end&quot;/&gt;
    &lt;min value=&quot;1&quot;/&gt;
&lt;/element&gt;
</pre></div>



<a name="153997553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997553">(Sep 18 2018 at 09:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span>  That's what I started with (though I had more descriptive elements like &lt;short ...&gt; and &lt;definition ..&gt;). The only major difference is that I also specified the types in the first element</p>
<div class="codehilite"><pre><span></span>      &lt;type&gt;
        &lt;code value=&quot;dateTime&quot;/&gt;
      &lt;/type&gt;
      &lt;type&gt;
        &lt;code value=&quot;Period&quot;/&gt;
      &lt;/type&gt;
</pre></div>


<p>But this gave me the non-repeating error. I need to add (at minimum) a &lt;max value="1" /&gt; element in the first element.</p>



<a name="153997554"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997554" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997554">(Sep 18 2018 at 09:27)</a>:</h4>
<p>Looks like a bug in the IG Publisher. The type information &amp; cardinality seem redundant, because inherited from the base element as-is.</p>



<a name="153997557"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997557" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997557">(Sep 18 2018 at 09:31)</a>:</h4>
<blockquote>
<p>Looks like a bug in the IG Publisher. The type information &amp; cardinality seem redundant, because inherited from the base element as-is.</p>
</blockquote>
<p>That maybe the case. All my profiles were originally created in Forge. They are the profiles submitted in the IG used in the first ballot with the knowledge they would need to be updated to a later version of FHIR. Now I need even a later version of FHIR (with the Device merge) so I am taking all those old profiles and trying to modify them to work in 3.6.0. It has forced me to learn a lot of detail that I was previously spared....and I have a ways to go!</p>



<a name="153997573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997573">(Sep 18 2018 at 11:16)</a>:</h4>
<p>we changed the sway we constrain choices types after evening sessions at WGMs over the last 3 meetings, and confirmed it in cologne.</p>



<a name="153997574"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997574" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997574">(Sep 18 2018 at 11:16)</a>:</h4>
<p>what's the bug?</p>



<a name="153997577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997577">(Sep 18 2018 at 11:19)</a>:</h4>
<blockquote>
<p>what's the bug?</p>
</blockquote>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> If there is a bug it is because I need to specify in my initial slicing on a choice element that there is  &lt;max value="1" /&gt;. That is already defined in the base Observation. Usually you don't have to do that if it is a differential.</p>



<a name="153997578"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997578" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997578">(Sep 18 2018 at 11:20)</a>:</h4>
<p>Indeed, slicing choice types is clearly defined. The behavior reported by Brian seems like an unrelated issue.</p>



<a name="153997579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997579">(Sep 18 2018 at 11:23)</a>:</h4>
<blockquote>
<p>Indeed, slicing choice types is clearly defined. The behavior reported by Brian seems like an unrelated issue.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span>  Not sure if it is unrelated. If I do not do that, I get an error. I don't recall any statement saying I have to specify a max of 1 when slicing a choice (or putting a constraint such that there is only one). Regardless,  I would like to know what is technically correct.</p>



<a name="153997582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997582">(Sep 18 2018 at 11:27)</a>:</h4>
<p>In your case, the cardinality constraint on the slicing intro appears to be redundant (not invalid!). But apparently this constraint needs to be specified explicitly nonetheless, in order to work around an issue in the IG Publisher. Once the issue is fixed, you could remove the redundant constraint.</p>



<a name="153997583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997583">(Sep 18 2018 at 11:28)</a>:</h4>
<p>I wouldn't worry too much about including redundant constraints, as they don't change the meaning of the profile.</p>



<a name="153997617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997617">(Sep 18 2018 at 15:01)</a>:</h4>
<p>We have a shortcut for unrolling polymorphic types that doesn't technically use slicing.  However, there shouldn't be a rule that prohibits slicing non-repeating elements.  For example, I could slice Patient.managingOrganization and say that you can either have a reference + display or identifier + display, but not other combination.</p>



<a name="153997781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997781">(Sep 18 2018 at 20:23)</a>:</h4>
<p>we specifically made that rule - you can't slice non-repeating elements</p>



<a name="153997785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997785">(Sep 18 2018 at 20:25)</a>:</h4>
<p>Why does that rule exist?  Why is it necessary?</p>



<a name="153997786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997786">(Sep 18 2018 at 20:25)</a>:</h4>
<p>it was a long discussion. You were part of it</p>



<a name="153997788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997788">(Sep 18 2018 at 20:29)</a>:</h4>
<p>which is to say, do I have to dig all that up?</p>



<a name="153997796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997796">(Sep 18 2018 at 20:51)</a>:</h4>
<p>I remember the discussion about special processing for polymorphic types.  I don't recall discussion on saying that slicing doesn't make sense for maxOccurs 1 elements or why doing that is technically hard.</p>



<a name="153997815"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153997815" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153997815">(Sep 18 2018 at 21:23)</a>:</h4>
<blockquote>
<p>we specifically made that rule - you can't slice non-repeating elements</p>
</blockquote>
<p>choice elements are often non-repeating and those can be sliced. However, when doing so there is an implicit condition that only one of the slices can ever be instantiated at a time. One can't have two value elements in a single Observation!</p>



<a name="153998358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20error%3A%20slice%20does%20not%20repeat/near/153998358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20error.3A.20slice.20does.20not.20repeat.html#153998358">(Sep 19 2018 at 19:32)</a>:</h4>
<p>I ran into the same problem slicing on a value[x], in this case value[x] could be a dateTime or a Quantity. <strong>Again I was able to solve it by specifying in the element where the slice is defined &lt;max value="1" /&gt;</strong>. I was befuddled for a while because it wasn't working until I noted that I had typed &lt;max value="!" /&gt;. Arrg!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
