---
layout: page
title: "FHIR Chat  · Issue with extension differentials and rendering · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html">Issue with extension differentials and rendering</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="179971385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179971385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179971385">(Nov 05 2019 at 20:07)</a>:</h4>
<p>When updating <a href="https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-race.html" target="_blank" title="https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-race.html">race</a> and <a href="https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-ethnicity.html" target="_blank" title="https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-ethnicity.html">ethnicity</a> extensions in  US Core we discovered a few issues.... Our complex differentials lacked the element ...</p>
<div class="codehilite"><pre><span></span>    &lt;element id=&quot;Extension.value[x]&quot;&gt;
      &lt;path value=&quot;Extension.value[x]&quot;/&gt;
      &lt;min value=&quot;0&quot;/&gt;
      &lt;max value=&quot;0&quot;/&gt;
    &lt;/element&gt;
</pre></div>


<p>... but contain  <code>Extension.extension</code> elements.  </p>
<p>This resulted in:</p>
<ul>
<li>a valid StructureDefinition according to the validator  (yay!)</li>
<li>an error in <a href="https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.html" target="_blank" title="https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.html">US Core Patient</a>  example instance that populate the extension:  <code>The Extension 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-race' definition is for a simple extension, so it must contain a value, not extensions</code>  (dang!)</li>
<li>US Core Patient rendering of an extension with type of an array of every value[x] instead of "(Complex)"  (dang!)  here is a screenshot of this...</li>
</ul>
<p><a href="/user_uploads/10155/POwa_MJU5OHchTHcgdKQV4yh/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<p>Unless there is some irreconcilable technical reason for this,  I think a valid diff should be able to have an Extension.value[x] or <code>Extension.extension</code> element without having to declare a max value="0" for the other element.</p>
<p>*Note source for race and ethnicity are here:   <a href="https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-race.xml" target="_blank" title="https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-race.xml">https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-race.xml</a> and <a href="https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-ethnicity.xml" target="_blank" title="https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-ethnicity.xml">https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-ethnicity.xml</a></p>



<a name="179975292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179975292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179975292">(Nov 05 2019 at 20:43)</a>:</h4>
<blockquote>
<p>I think a valid diff should be able to have an Extension.value[x] or Extension.extension element without having to declare a max value="0" for the other element.</p>
</blockquote>



<a name="179975295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179975295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179975295">(Nov 05 2019 at 20:43)</a>:</h4>
<p>why?</p>



<a name="179975392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179975392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179975392">(Nov 05 2019 at 20:44)</a>:</h4>
<p>Extensions aren't 'special'.  If you want to prohibit an element, you need to be explicit.</p>



<a name="179975978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179975978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179975978">(Nov 05 2019 at 20:50)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>   there is an invariant that says you can't have both so my reasoning if you have a value[x] then you would assume the extension.extension is max = 0 and vice versa in your differential.</p>



<a name="179976132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179976132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179976132">(Nov 05 2019 at 20:51)</a>:</h4>
<p>and besides value[x] and extension are min = 0</p>



<a name="179976291"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179976291" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179976291">(Nov 05 2019 at 20:53)</a>:</h4>
<p>But if I am wrong or missed some key documentation then that's OK too.  But if this is not documented then would be nice to make explicit        ( where to document is the question )</p>



<a name="179976636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179976636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179976636">(Nov 05 2019 at 20:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191401">@Eric Haas</span> it's not really about wrong or right, to me. The code that does the rendering is generic for all structure definitions. It doesn't know anything about extensions, or the implications of the invariant that refer to. And I'm not going to try and infer meaning out of inherited invariants like that while rendering. (sorry). It does mean that that differentials need to be a bit more verbose, but it makes them consistent.</p>



<a name="179976894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179976894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179976894">(Nov 05 2019 at 20:59)</a>:</h4>
<p>as for </p>
<blockquote>
<p>The Extension '<a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-race" target="_blank" title="http://hl7.org/fhir/us/core/StructureDefinition/us-core-race">http://hl7.org/fhir/us/core/StructureDefinition/us-core-race</a>' definition is for a simple extension, so it must contain a value, not extensions</p>
</blockquote>
<p>I could revise that, since it's extension specific logic, but what should that code do when the extension definition allows for both value[x] and extension? How does that code decide what you actually mean? The base extension allows both, and says, choose one. That means you actually have to choose, and you do that by setting the cardinality one of them to 0. All the extension processing logic works that way. So just set it to 0. </p>
<p>As for where this is documented.... I don't know. It's obvious to me. But I'm ok to make it explicit somewhere if you can identify the most logical place</p>



<a name="179977623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179977623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179977623">(Nov 05 2019 at 21:05)</a>:</h4>
<p>Since it was not obvious to me,  I'll assume won't be to others. I'll read through spec and see where is make the most sense to document it and create a tracker...</p>



<a name="179978414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179978414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179978414">(Nov 05 2019 at 21:13)</a>:</h4>
<p>ok. and you're going to fix US-Core?</p>



<a name="179992591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179992591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179992591">(Nov 06 2019 at 00:35)</a>:</h4>
<p>Fixed</p>



<a name="179993463"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Issue%20with%20extension%20differentials%20and%20rendering/near/179993463" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Issue.20with.20extension.20differentials.20and.20rendering.html#179993463">(Nov 06 2019 at 00:52)</a>:</h4>
<p>Ok I’ll release shorlty</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
