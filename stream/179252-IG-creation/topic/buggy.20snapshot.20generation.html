---
layout: page
title: "FHIR Chat  · buggy snapshot generation · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html">buggy snapshot generation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="185310145"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185310145" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185310145">(Jan 10 2020 at 13:38)</a>:</h4>
<p>Snapshots generated by the publisher can result in duplicate element entries when adding invariants. See <a href="https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-appointment.xml.html" target="_blank" title="https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-appointment.xml.html">https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-appointment.xml.html</a> and search for  "&lt;element id="Appointment.extension:legalBasis.value[x]:valueCodeableConcept"&gt;" <span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="185317458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185317458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185317458">(Jan 10 2020 at 15:04)</a>:</h4>
<p>this ends up in     an sdf-16: All element definitions must have unique ids (snapshot ...</p>



<a name="185433203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185433203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185433203">(Jan 12 2020 at 12:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> would you agree? The case is that I've added an invariant on an extension on the sdf. Let me know if you need the source of the IG</p>



<a name="185450668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185450668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185450668">(Jan 12 2020 at 21:21)</a>:</h4>
<p>it shouldn't happen. can I add it as a snapshot generation test?</p>



<a name="185451169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185451169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185451169">(Jan 12 2020 at 21:36)</a>:</h4>
<p>I think so - I'll  send you the raw material</p>



<a name="185451418"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185451418" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185451418">(Jan 12 2020 at 21:44)</a>:</h4>
<p>yes I'll need the extension definition as well</p>



<a name="185451419"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185451419" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185451419">(Jan 12 2020 at 21:44)</a>:</h4>
<p>I would imagine, yes</p>



<a name="185452086"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185452086" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185452086">(Jan 12 2020 at 22:04)</a>:</h4>
<p>you've got mail -</p>



<a name="185488957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185488957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185488957">(Jan 13 2020 at 12:44)</a>:</h4>
<p>so the extension/profile is bizarre. The extension assigns a value set to Extension.valueCodeableConcept.coding. Then, when you use it,  you assign the same value set to Extension.valueCodeableConcept. I think that must be an error, and I don't think that you mean that. Still, I do think that the validator should get this right</p>



<a name="185491592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185491592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185491592">(Jan 13 2020 at 13:17)</a>:</h4>
<p>hmmm .... that makes sense. Now I'm however getting another error with the latest build of the IG:</p>
<div class="codehilite"><pre><span></span>validate res: ConceptMap/oio-bpp-roles-to-careteam-participant-roles             (00:14.0701)
validate res: StructureDefinition/ehealth-activitydefinition                     (00:14.0705)
Publishing Content Failed: Problem processing expression (%resource.kind = #39;.logical#39;. or element.first().path = %resource.type) and element.tail().all(path.startsWith(%resource.snapshot.element.first().path&amp;&#39;.&#39;)) in profile http://hl7.org/fhir/StructureDefinition/StructureDefinition path StructureDefinition.snapshot: Error in ?? at 1, 3: Found # expecting a token name (00:14.0719)
                                                                                 (00:14.0719)
Use -? to get command line help                                                  (00:14.0719)
                                                                                 (00:14.0720)
Stack Dump (for debugging):                                                      (00:14.0720)
org.hl7.fhir.exceptions.FHIRException: Problem processing expression (%resource.kind = #39;.logical#39;. or element.first().path = %resource.type) and element.tail().all(path.startsWith(%resource.snapshot.element.first().path&amp;&#39;.&#39;)) in profile http://hl7.org/fhir/StructureDefinition/StructureDefinition path StructureDefinition.snapshot: Error in ?? at 1, 3: Found # expecting a token name
        at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariant(InstanceValidator.java:4930)
        at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariants(InstanceValidator.java:4915)
        at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariants(InstanceValidator.java:4806)
        at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:4464)
        at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:4376)
        at org.hl7.fhir.r5.validation.InstanceValidator.start(InstanceValidator.java:3287)
        at org.hl7.fhir.r5.validation.InstanceValidator.validateResource(InstanceValidator.java:5047)
        at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:851)
        at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:811)
        at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:4046)
        at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:3259)
        at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3240)
        at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:774)
        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:661)
        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6705)
</pre></div>



<a name="185491681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185491681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185491681">(Jan 13 2020 at 13:18)</a>:</h4>
<p>Latest being <code>FHIR IG Publisher Version 1.0.38-SNAPSHOT (Git# beda1a6eb614). Built 2020-01-11T07:15:31.737+11:00 (65 hours old)</code></p>



<a name="185491892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185491892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185491892">(Jan 13 2020 at 13:22)</a>:</h4>
<p>It seems unrelated to the specific sdf ("ehealth-activitydefinition")</p>



<a name="185529894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185529894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185529894">(Jan 13 2020 at 19:46)</a>:</h4>
<p>what version of FHIR is the IG based on?</p>



<a name="185531072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185531072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185531072">(Jan 13 2020 at 19:57)</a>:</h4>
<p>"version": "3.0.2",</p>



<a name="185531121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185531121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185531121">(Jan 13 2020 at 19:58)</a>:</h4>
<p>from the ig.json</p>



<a name="185532017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185532017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185532017">(Jan 13 2020 at 20:07)</a>:</h4>
<p>hmm. this isn't a generic issue with 3.0.2 guides - i just tested - so I'll have to build yours specifically. can you send me an updated one with this issue?</p>



<a name="185534706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185534706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185534706">(Jan 13 2020 at 20:36)</a>:</h4>
<p>on its way ...</p>



<a name="185537438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185537438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185537438">(Jan 13 2020 at 21:05)</a>:</h4>
<p>that builds fine for me. can you clear your package cache and try again?</p>



<a name="185537699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185537699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185537699">(Jan 13 2020 at 21:08)</a>:</h4>
<p>cant remember the location - where would that be?</p>



<a name="185537827"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185537827" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185537827">(Jan 13 2020 at 21:09)</a>:</h4>
<p>it's stated in one of the first few lines of the IG Publisher output</p>



<a name="185538269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185538269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185538269">(Jan 13 2020 at 21:13)</a>:</h4>
<p>worked like a charm :D - thx</p>



<a name="185538283"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185538283" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185538283">(Jan 13 2020 at 21:13)</a>:</h4>
<p>great</p>



<a name="185538286"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185538286" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185538286">(Jan 13 2020 at 21:13)</a>:</h4>
<p>thought I had already done that ...</p>



<a name="185538379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185538379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185538379">(Jan 13 2020 at 21:14)</a>:</h4>
<p>hmm. well, you won't have to do it again - there's no making changes to past packages anymore</p>



<a name="185538412"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185538412" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185538412">(Jan 13 2020 at 21:15)</a>:</h4>
<p>famous last words ;)</p>



<a name="185686945"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185686945" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185686945">(Jan 15 2020 at 10:51)</a>:</h4>
<p>Hmmmm <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  - I've found that if I put the valueset binding on the extension then the invariant is not inspected during validation. If I move the valueset binding back to the Appointment profile and do the binding there, then the invariant gets inspected</p>



<a name="185690435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185690435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185690435">(Jan 15 2020 at 11:52)</a>:</h4>
<p>Is this out of context? the value set binding on what extension?</p>



<a name="185695295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185695295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185695295">(Jan 15 2020 at 13:06)</a>:</h4>
<blockquote>
<p>so the extension/profile is bizarre. The extension assigns a value set to Extension.valueCodeableConcept.coding. Then, when you use it,  you assign the same value set to Extension.valueCodeableConcept. I think that must be an error, and I don't think that you mean that. Still, I do think that the validator should get this right</p>
</blockquote>



<a name="185705106"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/buggy%20snapshot%20generation/near/185705106" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/buggy.20snapshot.20generation.html#185705106">(Jan 15 2020 at 14:57)</a>:</h4>
<blockquote>
<p>Is this out of context? the value set binding on what extension?</p>
</blockquote>
<p><a href="https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-legalBasis.html" target="_blank" title="https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-legalBasis.html">https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-legalBasis.html</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
