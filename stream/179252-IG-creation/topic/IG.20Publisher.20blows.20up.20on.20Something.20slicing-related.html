---
layout: page
title: "FHIR Chat  · IG Publisher blows up on Something slicing-related · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html">IG Publisher blows up on Something slicing-related</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="197424683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197424683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197424683">(May 13 2020 at 14:58)</a>:</h4>
<p>Something about my slicing causes the IG Publisher to unceremoniously blow up.   If I delete the slicing on supportingInfo, it happily generates appropriate output.   Sushi v0.12.5 is delighted with the input.    You can find the inputs at :    <a href="https://github.com/saulakravitz/carin-bb.git">https://github.com/saulakravitz/carin-bb.git</a>. </p>
<p>Here is the output:<br>
% ./_genonce.sh <br>
Checking internet connection...<br>
Online</p>
<p>FHIR IG Publisher Version 1.0.94-SNAPSHOT (Git# 77c06d8ca14c). Built 2020-05-12T11:55:14.985+10:00 (36 hours old)<br>
Detected Java version: 1.8.0_242 from /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available<br>
Parameters: -ig ig.ini<br>
dir = /Users/skravitz/git/carin-bb/fsh/build, path = /Users/skravitz/.rvm/gems/ruby-2.6.3/bin:/Users/skravitz/.rvm/gems/ruby-2.6.3@global/bin:/Users/skravitz/.rvm/rubies/ruby-2.6.3/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Users/skravitz/.rvm/bin<br>
Run time = Wednesday, May 13, 2020 10:47:23 AM EDT (2020-05-13T10:47:23-04:00)<br>
Package Cache: /Users/skravitz/.fhir/packages                                    (00:00.0122)<br>
Load Template from fhir.base.template#current                                    (00:02.0485)</p>
<p>onLoad.findSpreadsheets:</p>
<p>onLoad.updateIg:<br>
     [xslt] Processing /Users/skravitz/git/carin-bb/fsh/build/template/onLoad-ig-working.xml to /Users/skravitz/git/carin-bb/fsh/build/template/onLoad-ig-updated.xml<br>
     [xslt] Loading stylesheet /Users/skravitz/git/carin-bb/fsh/build/template/scripts/onLoad.xslt</p>
<p>onLoad.extend:</p>
<p>onLoad:<br>
Root directory: /Users/skravitz/git/carin-bb/fsh/build                           (00:09.0848)<br>
Core Package hl7.fhir.r4.core#4.0.1<br>
Terminology Cache is at /Users/skravitz/git/carin-bb/fsh/build/input-cache/txcache. 1 files in cache (00:34.0195)<br>
Connect to Terminology Server at <a href="http://tx.fhir.org">http://tx.fhir.org</a>                              (00:34.0197)<br>
Load Package hl7.fhir.pubpack#0.0.4<br>
Load Package hl7.fhir.xver-extensions#0.0.4<br>
Dependency 'hl7.fhir.us.core' has no id, so can't be referred to in markdown in the IG (00:35.0129)<br>
Initialization complete                                                          (00:38.0462)<br>
Load Content                                                                     (00:38.0464)<br>
Processing Conformance Resources                                                 (00:39.0286)<br>
Publishing Content Failed: null                                                  (00:57.0249)<br>
                                                                                 (00:57.0249)<br>
Use -? to get command line help                                                  (00:57.0249)<br>
                                                                                 (00:57.0249)<br>
Stack Dump (for debugging):                                                      (00:57.0249)<br>
java.lang.NullPointerException<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.commas(ProfileUtilities.java:4255)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.describeSlice(ProfileUtilities.java:4249)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateDescription(ProfileUtilities.java:3829)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateDescription(ProfileUtilities.java:3749)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.genElement(ProfileUtilities.java:3430)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.genElement(ProfileUtilities.java:3492)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateTable(ProfileUtilities.java:3235)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.generate(NarrativeGenerator.java:2604)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.generate(NarrativeGenerator.java:236)<br>
    at org.hl7.fhir.r5.utils.NarrativeGenerator.generate(NarrativeGenerator.java:208)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.generateNarratives(Publisher.java:1014)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3568)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:826)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:688)<br>
    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7310)</p>



<a name="197431480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197431480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197431480">(May 13 2020 at 15:42)</a>:</h4>
<blockquote>
<p>Sushi v0.12.5 is delighted with the input</p>
</blockquote>
<p>Just FYI - SUSHI doesn't validate any of the slicing details (discriminator path, type, etc) -- so SUSHI may be too easily delighted if something isn't quite right there.</p>



<a name="197432079"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197432079" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197432079">(May 13 2020 at 15:45)</a>:</h4>
<p>delectable and delightful...</p>



<a name="197432220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197432220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197432220">(May 13 2020 at 15:46)</a>:</h4>
<blockquote>
<p>If I delete the slicing on supportingInfo</p>
</blockquote>
<p>Which profile is this in?  It wasn't clear from the stack trace.</p>



<a name="197434978"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197434978" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197434978">(May 13 2020 at 16:03)</a>:</h4>
<p>The IG publisher is delighted with the slicing in Coverage, and repulsed by the slicing in each/every EOB profile.</p>



<a name="197436113"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197436113" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197436113">(May 13 2020 at 16:10)</a>:</h4>
<p>Should I be looking at the <code>saul</code> branch?</p>



<a name="197437072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197437072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197437072">(May 13 2020 at 16:16)</a>:</h4>
<p>OK.  This is what I'm seeing:</p>
<div class="codehilite"><pre><span></span><code>* supportingInfo ^slicing.discriminator.path = &quot;value:category.coding.code&quot;
* supportingInfo ^slicing.rules = #open
* supportingInfo ^slicing.ordered = false   // can be omitted, since false is the default
* supportingInfo ^slicing.description = &quot;Slice based on value pattern&quot;
</code></pre></div>


<p>I'm not familiar with the <code>value:...</code> syntax for discriminator paths -- and I see you didn't declare a discriminator type at all.  I think maybe what you really want is:</p>
<div class="codehilite"><pre><span></span><code>* supportingInfo ^slicing.discriminator.type = #value
* supportingInfo ^slicing.discriminator.path = &quot;category.coding.code&quot;
* supportingInfo ^slicing.rules = #open
* supportingInfo ^slicing.ordered = false   // can be omitted, since false is the default
* supportingInfo ^slicing.description = &quot;Slice based on value pattern&quot;
</code></pre></div>


<p><em>(EDIT: Corrected based on <span class="user-mention" data-user-id="215604">@Saul Kravitz</span>'s astute observation below!)</em></p>



<a name="197437364"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197437364" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197437364">(May 13 2020 at 16:19)</a>:</h4>
<p>Ohhhhh... I think I see.  I expect you are just doing what you see in rendered profiles.  For example, the BP profile rendering shows this: <a href="/user_uploads/10155/7gY1CbWSkzW8Qb6E3pO_-FzK/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/7gY1CbWSkzW8Qb6E3pO_-FzK/image.png" title="image.png"><img src="/user_uploads/10155/7gY1CbWSkzW8Qb6E3pO_-FzK/image.png"></a></div>



<a name="197437572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197437572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197437572">(May 13 2020 at 16:20)</a>:</h4>
<p>So that's probably where <code>value:code.coding.code</code> came from.  I get it.  So that style of indicating the discriminator is currently not supported in FSH -- but it's an interesting idea!  For now, however, you need to set the type and path discreetly in two separate rules (as in my example above).</p>



<a name="197438348"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197438348" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197438348">(May 13 2020 at 16:26)</a>:</h4>
<ul>
<li>supportingInfo ^slicing.discriminator.type = #value</li>
</ul>



<a name="197439400"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197439400" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197439400">(May 13 2020 at 16:33)</a>:</h4>
<p>Ha.  You're exactly right!  Thanks for the correction!</p>



<a name="197439450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197439450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197439450">(May 13 2020 at 16:33)</a>:</h4>
<p>I'll correct it above as well.</p>



<a name="197440406"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197440406" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197440406">(May 13 2020 at 16:40)</a>:</h4>
<p>IG Publisher is now happy, so I'm (not un)happy.   Thanks.<br>
Error messages from sushi and IG publisher that eliminate the need for expert consulting support would be GREATLY appreciated.</p>



<a name="197441969"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197441969" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197441969">(May 13 2020 at 16:52)</a>:</h4>
<p>BTW, adding slicing to a FSH spec causes the sushi runtime to go up dramatically in the "info  Converting FSH to FHIR resources..." step.   Dramatically means:  from taking 10s, to taking 2-3 minutes.</p>



<a name="197443099"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197443099" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197443099">(May 13 2020 at 16:59)</a>:</h4>
<p>I hadn't noticed that slicing has that affect in SUSHI.  That's interesting (and a little surprising), but also good to know...</p>



<a name="197452232"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197452232" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197452232">(May 13 2020 at 18:00)</a>:</h4>
<blockquote>
<p>Error messages from sushi and IG publisher that eliminate the need for expert consulting support would be GREATLY appreciated</p>
</blockquote>
<p>of course but that doesn't make it easy. This particular scenario will be more graceful in the future</p>



<a name="197565252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20blows%20up%20on%20Something%20slicing-related/near/197565252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20blows.20up.20on.20Something.20slicing-related.html#197565252">(May 14 2020 at 14:44)</a>:</h4>
<p>&lt;wrong place&gt;</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
