---
layout: page
title: "FHIR Chat  · Unable to determine type · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html">Unable to determine type</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="160799812"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160799812" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160799812">(Mar 14 2019 at 16:51)</a>:</h4>
<p>Hi, I am working on the PDDI CDS IG using the most recent IG publisher I downloaded from HL7. Things seem to build fine on my machine but when I push to github and the code is pushed via webhook to <a href="https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger" target="_blank" title="https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger">https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger</a> I see the following error on <a href="http://build.fhir.org/ig/HL7/PDDI-CDS/build.log" target="_blank" title="http://build.fhir.org/ig/HL7/PDDI-CDS/build.log">http://build.fhir.org/ig/HL7/PDDI-CDS/build.log</a>. I am not sure what it means. Would someone be able to advise me on what to check/fix? Thanks!</p>



<a name="160806303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160806303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160806303">(Mar 14 2019 at 18:07)</a>:</h4>
<p>Just to confirm, you grabbed the publisher from <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">http://build.fhir.org</a> and have downloaded in the last few hours?</p>



<a name="160819952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160819952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160819952">(Mar 14 2019 at 20:38)</a>:</h4>
<blockquote>
<p>Just to confirm, you grabbed the publisher from <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">http://build.fhir.org</a> and have downloaded in the last few hours?</p>
</blockquote>
<p>Yes. Here is the log from my local build with the publisher from <a href="http://build.fhir.org/org.hl7.fhir.igpublisher.jar" target="_blank" title="http://build.fhir.org/org.hl7.fhir.igpublisher.jar">http://build.fhir.org/org.hl7.fhir.igpublisher.jar</a> :  <a href="https://drive.google.com/open?id=1gZcoJnY9-CHhd49JdHFwRvgk-LCLssGn" target="_blank" title="https://drive.google.com/open?id=1gZcoJnY9-CHhd49JdHFwRvgk-LCLssGn">https://drive.google.com/open?id=1gZcoJnY9-CHhd49JdHFwRvgk-LCLssGn</a></p>



<a name="160820723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160820723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160820723">(Mar 14 2019 at 20:46)</a>:</h4>
<p>Not sure why there's a difference.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> ?</p>



<a name="160821121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160821121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160821121">(Mar 14 2019 at 20:51)</a>:</h4>
<p>that part shouldn't be different</p>



<a name="160870482"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160870482" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160870482">(Mar 15 2019 at 12:39)</a>:</h4>
<p>Is there something like a cache that could be making my build work while the remote one fails? Would it be possible for one of you to clone and build the PDDI CDS IG locally to see if you find the same issue as on the remote one?</p>



<a name="160874609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160874609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160874609">(Mar 15 2019 at 13:33)</a>:</h4>
<p>Builds locally for me</p>



<a name="160903679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160903679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160903679">(Mar 15 2019 at 19:01)</a>:</h4>
<p>I get the same outcome as the build server - it fails</p>



<a name="160904539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160904539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160904539">(Mar 15 2019 at 19:12)</a>:</h4>
<p>Is everything committed?</p>



<a name="160911235"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160911235" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160911235">(Mar 15 2019 at 20:35)</a>:</h4>
<p>I thought so but I will do some more testing tomorrow including checking it out on a different machine. Must be something like what Lloyd asks...</p>



<a name="160978379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/160978379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#160978379">(Mar 17 2019 at 02:15)</a>:</h4>
<p>sure enough - did not work on a totally new machine. Error "java.lang.Exception: Unable to determine type for  (long identifier) com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject``` -- I notice that this exception is raised by org.hl7.fhir.r5.formats.JsonParser.parseMedicationAdministration -- the R5 threw me off --- I specify &lt;fhirVersion value="4.0.0"/&gt; in the resources/ig.xml  -- is the publisher looking somewhere else or how can I fix the version to be 4? thanks</p>



<a name="161168892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161168892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161168892">(Mar 19 2019 at 17:00)</a>:</h4>
<p>I tried some more things to get past the error "Unable to determine type"  but am out of ideas. I am trying to follow the docs and info in the thread but am missing something.  The ig.json has an entry "specification": "<a href="http://hl7.org/fhir/R4" target="_blank" title="http://hl7.org/fhir/R4">http://hl7.org/fhir/R4</a>" and the resources/ig.xml has &lt;fhirVersion value="4.0.0"/&gt; yet the error seems to be raised by an R5 parser java class so maybe I don't have the version set up correctly? Please help with any suggestions. Thanks.</p>



<a name="161172718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161172718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161172718">(Mar 19 2019 at 17:35)</a>:</h4>
<p>what happens if you remove the offending example?</p>
<p>medicationadministration-warfarin-nsaid-warfarin-prefetch</p>



<a name="161180449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161180449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161180449">(Mar 19 2019 at 19:03)</a>:</h4>
<p>the R5 thing is not the issue.</p>



<a name="161180462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161180462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161180462">(Mar 19 2019 at 19:03)</a>:</h4>
<p>no maybe -what's the stack look like?</p>



<a name="161180642"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161180642" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161180642">(Mar 19 2019 at 19:05)</a>:</h4>
<p>(deleted)</p>



<a name="161180941"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161180941" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161180941">(Mar 19 2019 at 19:08)</a>:</h4>
<p>This is from the latest build log on the autobuilder:</p>
<div class="codehilite"><pre><span></span>Check Generate /scratch/ig-build-temp-IAJ6LO/repo/temp/tbl_bck01101.png          (20.0159sec)
Check Generate /scratch/ig-build-temp-IAJ6LO/repo/qa/tbl_spacer.png              (20.0160sec)
Check Generate /scratch/ig-build-temp-IAJ6LO/repo/temp/tbl_spacer.png            (20.0160sec)
Initialization complete                                                          (20.0160sec)
Load Content                                                                     (20.0160sec)
Publishing Content Failed: Unable to determine type for  /scratch/ig-build-temp-IAJ6LO/repo/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch: com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject (21.0747sec)
                                                                                 (21.0747sec)
Use -? to get command line help                                                  (21.0747sec)
                                                                                 (21.0747sec)
Stack Dump (for debugging):                                                      (21.0747sec)
java.lang.Exception: Unable to determine type for  /scratch/ig-build-temp-IAJ6LO/repo/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch: com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject
    at org.hl7.fhir.igtools.publisher.Publisher.loadAsElementModel(Publisher.java:2458)
    at org.hl7.fhir.igtools.publisher.Publisher.load(Publisher.java:1842)
    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:610)
    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:554)
    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5103)
Caused by: java.lang.ClassCastException: com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject
    at com.google.gson.JsonObject.getAsJsonObject(JsonObject.java:205)
    at org.hl7.fhir.r5.formats.JsonParser.parseMedicationAdministrationProperties(JsonParser.java:15886)
    at org.hl7.fhir.r5.formats.JsonParser.parseMedicationAdministration(JsonParser.java:15842)
    at org.hl7.fhir.r5.formats.JsonParser.parseResource(JsonParser.java:27554)
    at org.hl7.fhir.r5.formats.JsonParserBase.parse(JsonParserBase.java:113)
    at org.hl7.fhir.r5.formats.ParserBase.parse(ParserBase.java:79)
    at org.hl7.fhir.r5.elementmodel.ObjectConverter.convert(ObjectConverter.java:117)
    at org.hl7.fhir.igtools.publisher.Publisher.loadAsElementModel(Publisher.java:2451)
    ... 4 more
Exception in thread &quot;main&quot; java.lang.NullPointerException
    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5113)
</pre></div>



<a name="161294995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161294995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161294995">(Mar 20 2019 at 21:54)</a>:</h4>
<p>just looking at this again. <span class="user-mention" data-user-id="196276">@Rich Boyce</span> what version of FHIR is this supposed to be based on?</p>



<a name="161390570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161390570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161390570">(Mar 21 2019 at 19:58)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  - we are trying for R4 since its the current official release</p>



<a name="161392501"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161392501" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161392501">(Mar 21 2019 at 20:23)</a>:</h4>
<p>so you need "version" : "4.0.0" in your config.json</p>



<a name="161392510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161392510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161392510">(Mar 21 2019 at 20:23)</a>:</h4>
<p>since you don't, it's being treated as R5, and the model for MedAdmin is different in R5 now</p>



<a name="161397153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161397153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161397153">(Mar 21 2019 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Thank you. That did help. Interestingly, there is still a problem with the MedicationAdministration resource created in our IG that is not obvious to me when I cross-walk it with the R4 spec. Unless I comment out in ig.xml the offending resource, the publisher stops with the following exception:</p>
<div class="codehilite"><pre><span></span>Stack Dump (for debugging):                                                      (12.0882sec)
org.hl7.fhir.exceptions.FHIRException: MedicationAdministration null
        at org.hl7.fhir.igtools.publisher.IGKnowledgeProvider.doReplacements(IGKnowledgeProvider.java:134)
        at org.hl7.fhir.igtools.publisher.Publisher.load(Publisher.java:1868)
        at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:610)
        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:554)
        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5103)
Exception in thread &quot;main&quot; java.lang.NullPointerException
        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5113)
</pre></div>


<p>The bad resource is here: <a href="https://github.com/HL7/PDDI-CDS/blob/master/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch.xml" target="_blank" title="https://github.com/HL7/PDDI-CDS/blob/master/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch.xml">https://github.com/HL7/PDDI-CDS/blob/master/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch.xml</a> </p>
<p>and the reference to it in ig.xml is as follows:</p>
<div class="codehilite"><pre><span></span>   &lt;resource&gt;
      &lt;reference&gt;
        &lt;reference value=&quot;MedicationAdministration/medicationadministration-warfarin-nsaid-warfarin-prefetch&quot; /&gt;
      &lt;/reference&gt;
      &lt;name value=&quot;medicationadministration-warfarin-nsaid-warfarin-prefetch&quot; /&gt;
      &lt;exampleBoolean value=&quot;true&quot; /&gt;
    &lt;/resource&gt;
</pre></div>


<p>The only thing I saw that might trigger an issue was the use of the extension for the effectivePeriod. I tested that by replacing it with the ordinary period below and the publisher was still not happy -- Any ideas?</p>
<div class="codehilite"><pre><span></span>        &lt;start value=&quot;2011-05-23&quot; /&gt;
        &lt;end value=&quot;2011-05-27&quot; /&gt;
</pre></div>



<a name="161399816"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161399816" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161399816">(Mar 21 2019 at 22:08)</a>:</h4>
<p>null error is always a bug in my code even if there's a genuine underlying error. if you commit the version fix Ill have a look</p>



<a name="161401438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161401438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161401438">(Mar 21 2019 at 22:32)</a>:</h4>
<p>Done just now : <a href="https://github.com/HL7/PDDI-CDS" target="_blank" title="https://github.com/HL7/PDDI-CDS">https://github.com/HL7/PDDI-CDS</a></p>



<a name="161404605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161404605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161404605">(Mar 21 2019 at 23:22)</a>:</h4>
<p>ok should be better - try again</p>



<a name="161448636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Unable%20to%20determine%20type/near/161448636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rich Boyce <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Unable.20to.20determine.20type.html#161448636">(Mar 22 2019 at 13:46)</a>:</h4>
<p>That worked! Thank you for your help.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
