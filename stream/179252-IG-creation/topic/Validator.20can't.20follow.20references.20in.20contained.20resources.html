---
layout: page
title: "FHIR Chat  · Validator can&#x27;t follow references in contained resources · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html">Validator can&#x27;t follow references in contained resources</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="224406637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224406637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224406637">(Jan 28 2021 at 22:59)</a>:</h4>
<p>I have a profile on a resource that has contained resources.  Those contained resources reference the containing resource and other contained resources (Organization.contained[1] = HealthcareService, Organization.contained[2] = OrganizationAffiliation, Organization.contained[3] = Organization2.  OrganizationAffiliation references the containing resource and Organization2.  I am using the '#' to refer to the containing resource and "#blah" to refer to other contained resources as it indicates in the specification: <a href="http://hl7.org/fhir/references.html#contained">http://hl7.org/fhir/references.html#contained</a></p>
<p>Unfortunately, it appears that the validator can not resolve those references.  I have a slice that is of type #profile and thus the validator needs to resolve that reference and it complains about it.</p>
<div class="codehilite"><pre><span></span><code>Unable to resolve resource &#39;#&#39;
</code></pre></div>
<p>NOTE: This only occurs if I set the slicing to be of type #profile.  I suppose that it doesn't need to resolve the references otherwise.</p>



<a name="224406685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224406685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224406685">(Jan 28 2021 at 22:59)</a>:</h4>
<p>unfortunately, this is raised as an error and not a warning, so I can't suppress them.</p>



<a name="224409565"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224409565" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224409565">(Jan 28 2021 at 23:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Organization.contained[3] = Organization
</code></pre></div>
<p>I assume you've simplified here, and this isn't a circular reference?</p>



<a name="224409613"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224409613" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224409613">(Jan 28 2021 at 23:31)</a>:</h4>
<p>sorry, yes, it's a different organization that is referenced by the orgAffiliation (I updated my original post to reflect that)</p>



<a name="224409906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224409906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224409906">(Jan 28 2021 at 23:34)</a>:</h4>
<p>Interesting. I wonder if the validator expects only the containing resource to reference contained resources, not contained resources to reference each other? This is on a profile... I wonder what the instance behaviour would be?</p>



<a name="224409992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224409992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224409992">(Jan 28 2021 at 23:35)</a>:</h4>
<p>it's not actually complaining about that - it's complaining that it can't find the containing resource in HealthcareService which only references the containing resource.</p>



<a name="224410105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224410105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224410105">(Jan 28 2021 at 23:36)</a>:</h4>
<p>right. (The second part of my comment still stands.)</p>



<a name="224410183"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224410183" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224410183">(Jan 28 2021 at 23:37)</a>:</h4>
<p>true.  i'm expecting that servers who support contained resources would support this way of referencing them, but I'll certainly have the team test that.</p>



<a name="224410498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224410498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224410498">(Jan 28 2021 at 23:41)</a>:</h4>
<p>Can you simplify the example? You start off saying Org1 contains HCS, OA, Org2; OA references Org1, Org2. But then you say HCS references Org1, and that's where the error comes up. Are OA and Org2 just a distraction from the issue?</p>



<a name="224410535"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224410535" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224410535">(Jan 28 2021 at 23:42)</a>:</h4>
<p>yes, i have a simpler instance that just has Org1 containing HCS which HCS referencing Org1.  And that fails as well.</p>



<a name="224430935"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224430935" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224430935">(Jan 29 2021 at 04:55)</a>:</h4>
<p>In R4, there's an invariant that mandates that all contained resources must <em>directly</em> reference the container or be referenced by the container.  There's no support for container references contained1 which then references contained2.  This is a known issue.  Unfortunately, it's not super obvious how to fix it.  There's no easy way to say "contained resource must reference or be referenced by the container either directly or through some recursive reference path via other contained resources" using FHIRPath (let alone XPath).  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> thoughts on how we can tackle this in R5?</p>
<p>In R4, only solution is have a useless extension that includes a reference to the parent (or from parent to non-directly linked children)</p>



<a name="224432942"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224432942" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224432942">(Jan 29 2021 at 05:41)</a>:</h4>
<p>Okay, that's going to put a crimp in my profiling plans.  I still don't think that is my current issue as I have a Organization resource that has a contained HealthcareService that references the parent and I'm still getting the error in the QA of "unable to reference #".</p>



<a name="224433100"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224433100" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224433100">(Jan 29 2021 at 05:44)</a>:</h4>
<p>because I'm using OrganizationAffilation to just show a link between the parent Organization and the contained Organization, if I'm going to have to define an extension to meet the constraint, I might as well drop the use of the OrganizationAffiliation.</p>



<a name="224498836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224498836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224498836">(Jan 29 2021 at 16:39)</a>:</h4>
<p>unless i'm parsing the fhirpath wrong, as long as somewhere in the resource, other contained resources too, there is the correct #id reference (it doesn't seem to even care if it's self-referential, at least in the invariant) or the contained resource itself has a '#' reference to the containing resource then there isn't a problem. <br>
Lloyd, where in that invariant do you see that the #id reference search doesn't include other contained resources?<br>
for reference I'm looking at dom-3 <a href="https://www.hl7.org/fhir/domainresource.html#invs">https://www.hl7.org/fhir/domainresource.html#invs</a></p>



<a name="224499496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224499496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224499496">(Jan 29 2021 at 16:43)</a>:</h4>
<p>I was going to come back this morning to report that after I made the change above - using an extension and deleting the OrganizationAffiliation, I suddenly get an error on the constraint Lloyd mentioned.  I <em>didn't</em> get that constraint failure before.  So I went from the validator not being able to follow # references to it not being able to do that <em>and</em> the constraint firing. :)</p>
<p>If anyone wants to see the errors, the latest fhir-spl guide has them: <a href="http://build.fhir.org/ig/HL7/fhir-spl/branches/main/qa.html">http://build.fhir.org/ig/HL7/fhir-spl/branches/main/qa.html</a></p>



<a name="224500699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224500699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224500699">(Jan 29 2021 at 16:51)</a>:</h4>
<p>I mean the obvious question is why do you need contained resources (especially this many) but it should work from everything I'm seeing..</p>



<a name="224501222"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224501222" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224501222">(Jan 29 2021 at 16:54)</a>:</h4>
<p>we don't actually have that many contained resources.  We have a parent Organization that identifies two optional Organizations who perform services for it and a set of HealthcareServices that define its services.  We determined that none of the contained resources actually have a lifetime/identity of their own.</p>



<a name="224790596"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224790596" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224790596">(Feb 01 2021 at 21:04)</a>:</h4>
<blockquote>
<p>There's no support for container references contained1 which then references contained2</p>
</blockquote>
<p>I don't think that this is true</p>



<a name="224790766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224790766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224790766">(Feb 01 2021 at 21:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179252-IG-creation/topic/Validator.20can't.20follow.20references.20in.20contained.20resources/near/224790596">said</a>:</p>
<blockquote>
<blockquote>
<p>There's no support for container references contained1 which then references contained2</p>
</blockquote>
<p>I don't think that this is true</p>
</blockquote>
<p>Yeah, I think we determined that since my guide doesn't complain about that constraint.</p>



<a name="224903109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224903109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224903109">(Feb 02 2021 at 17:11)</a>:</h4>
<p>The current invariant allows A to contain B and C where B and C point to each other, but neither have a reference to or from A - which does not meet our objective.</p>



<a name="224943125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224943125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224943125">(Feb 02 2021 at 21:58)</a>:</h4>
<p>to get back to my original concern/problem - it appears that the validator can't resolve the references between contained resources.  I made a simple instance where the contained resource had a reference back to the container via &lt;reference value="#"/&gt; and I got the error "Unable to resolve resource '#'".  So I don't think that the validator in the IG publisher supports those references?</p>



<a name="224944273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224944273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224944273">(Feb 02 2021 at 22:08)</a>:</h4>
<p>how do I reproduce this? I think it should work</p>



<a name="224944295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224944295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224944295">(Feb 02 2021 at 22:08)</a>:</h4>
<p>i checked in my guide (fhir-spl) which has that error.</p>



<a name="224944314"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224944314" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224944314">(Feb 02 2021 at 22:08)</a>:</h4>
<p>If anyone wants to see the errors, the latest fhir-spl guide has them: <a href="http://build.fhir.org/ig/HL7/fhir-spl/branches/main/qa.html">http://build.fhir.org/ig/HL7/fhir-spl/branches/main/qa.html</a></p>



<a name="224944355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/224944355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#224944355">(Feb 02 2021 at 22:09)</a>:</h4>
<p>btw, i'll be glad to be told that the validator is fine and I'm doing something wrong</p>



<a name="225110469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Validator%20can%27t%20follow%20references%20in%20contained%20resources/near/225110469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Validator.20can&#x27;t.20follow.20references.20in.20contained.20resources.html#225110469">(Feb 04 2021 at 01:59)</a>:</h4>
<p>ok fixed next release. It turned out that # was supported, but there was a bug in the implementation of conformsTo()</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
