---
layout: page
title: "FHIR Chat  · IG Publisher HTML generation bug? · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html">IG Publisher HTML generation bug?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="242997396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/242997396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#242997396">(Jun 17 2021 at 10:18)</a>:</h4>
<p>I'm hitting a strange issue where an IG page contents gets "trapped" in a dropdown menu. <a href="http://build.fhir.org/ig/dvci/vaccine-credential-ig/branches/dev/StructureDefinition-vaccination-credential-immunization-dm-definitions.html">Here's a live example</a> and a screenshot: <a href="/user_uploads/10155/9F022JkOUQB8pAmqmjl-DHwJ/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/9F022JkOUQB8pAmqmjl-DHwJ/image.png" title="image.png"><img src="/user_uploads/10155/9F022JkOUQB8pAmqmjl-DHwJ/image.png"></a></div>



<a name="242997475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/242997475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#242997475">(Jun 17 2021 at 10:19)</a>:</h4>
<p>This happens reprodubily when I have a broken link in the page that causes a QA error. (It may happen for other reasons too...I don't think there's a broken link in the page above.)</p>



<a name="242997586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/242997586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#242997586">(Jun 17 2021 at 10:21)</a>:</h4>
<p>Looking at the source for the <strong>generated</strong> HTML page, I see closing tags missing on lines 181-187: <a href="/user_uploads/10155/9JdxL1TjS7fVvd6trEWRsj7e/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/9JdxL1TjS7fVvd6trEWRsj7e/image.png" title="image.png"><img src="/user_uploads/10155/9JdxL1TjS7fVvd6trEWRsj7e/image.png"></a></div>



<a name="242997652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/242997652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#242997652">(Jun 17 2021 at 10:21)</a>:</h4>
<p>But if I look at <code>fragment-pagebegin.html</code> in the custom template used for this IG, the closing tags <em>are</em> there: <a href="/user_uploads/10155/o1TUzA1j-FfWfPJO2kBqhDZa/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/o1TUzA1j-FfWfPJO2kBqhDZa/image.png" title="image.png"><img src="/user_uploads/10155/o1TUzA1j-FfWfPJO2kBqhDZa/image.png"></a></div>



<a name="242997953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/242997953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#242997953">(Jun 17 2021 at 10:25)</a>:</h4>
<p>And again, I can usually resolve this by fixing  a broken link that appears somewhere on the page. And no matter where the broken link appears on the page, I observe the same  behavior.</p>



<a name="242998092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/242998092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#242998092">(Jun 17 2021 at 10:27)</a>:</h4>
<p>This is reproducible locally for me, as well as on the <a href="http://build.fhir.org">build.fhir.org</a> CI build. The repo for the IG is <a href="https://github.com/dvci/vaccine-credential-ig">https://github.com/dvci/vaccine-credential-ig</a>, and if you check out <code>864bf3008a714447c18d1d1245d076ba7fa3d840</code> and build locally you should see the same thing on <code>StructureDefinition-vaccination-credential-immunization-dm-definitions.html</code></p>



<a name="242998346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/242998346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#242998346">(Jun 17 2021 at 10:30)</a>:</h4>
<p>Does anyone have a sense of whether this is an IG Publisher bug, or if there's somthing I could be doing within the IG that could cause this behavior?</p>



<a name="243087500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/243087500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#243087500">(Jun 17 2021 at 21:29)</a>:</h4>
<p>I switched to the nominated commit but couldn't reproduce</p>



<a name="243155060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/243155060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#243155060">(Jun 18 2021 at 12:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I reproduced again, both locally and on <a href="http://build.fhir.org">build.fhir.org</a></p>
<div class="codehilite"><pre><span></span><code>$ git clone git@github.com:dvci/vaccine-credential-ig.git vci-test2
Cloning into &#39;vci-test2&#39;...
remote: Enumerating objects: 2247, done.
remote: Counting objects: 100% (1205/1205), done.
remote: Compressing objects: 100% (458/458), done.
remote: Total 2247 (delta 718), reused 1021 (delta 633), pack-reused 1042
Receiving objects: 100% (2247/2247), 441.68 KiB | 6.05 MiB/s, done.
Resolving deltas: 100% (1439/1439), done.
$ cd vci-test2
$ git checkout 864bf3008a714447c18d1d1245d076ba7fa3d840
$ ./_genonce.sh
Checking internet connection...
Online

FHIR IG Publisher Version 1.1.75 (Git# 3a2ca820510e). Built 2021-06-17T23:27:51.9Z (13 hours old)
Detected Java version: 14.0.2 from /Library/Java/JavaVirtualMachines/jdk-14.0.2.jdk/Contents/Home on Mac OS X/x86_64 (64bit). 12288MB available
...
</code></pre></div>
<p>For <a href="http://build.fhir.org">build.fhir.org</a>, I created a branch where HEAD is <code>864bf3008a</code>: <a href="http://build.fhir.org/ig/dvci/vaccine-credential-ig/branches/2021-06-18-bug-reproduction/StructureDefinition-vaccination-credential-immunization-dm-definitions.html">http://build.fhir.org/ig/dvci/vaccine-credential-ig/branches/2021-06-18-bug-reproduction/StructureDefinition-vaccination-credential-immunization-dm-definitions.html</a> <a href="/user_uploads/10155/Z2BhKtZDHR8u_kKfD7lSxqem/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/Z2BhKtZDHR8u_kKfD7lSxqem/image.png" title="image.png"><img src="/user_uploads/10155/Z2BhKtZDHR8u_kKfD7lSxqem/image.png"></a></div>



<a name="243268803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/243268803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#243268803">(Jun 19 2021 at 20:58)</a>:</h4>
<p>ok. thanks. I could reproduce that. So I can explain what is happening here.</p>



<a name="243268813"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/243268813" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#243268813">(Jun 19 2021 at 20:59)</a>:</h4>
<p>the pages contain invalid html. The tags on lines 166 to 171 are not closed</p>



<a name="243268903"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/243268903" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#243268903">(Jun 19 2021 at 21:01)</a>:</h4>
<p>I use a dom based parser to parse the html, and it's guessing where the tags end, and inserting matching ending tags on line 1705. Any page with a broken link has an anchor tag inserted, and is saved, whereas pages without a broken link are not saved.</p>



<a name="243268976"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/243268976" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#243268976">(Jun 19 2021 at 21:03)</a>:</h4>
<p>the problem is in your menu.xml, which is not valid xml</p>



<a name="243329601"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/IG%20Publisher%20HTML%20generation%20bug%3F/near/243329601" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Max Masnick <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/IG.20Publisher.20HTML.20generation.20bug.3F.html#243329601">(Jun 21 2021 at 00:40)</a>:</h4>
<p>That fixed it, thanks! I should have caught the missing closing tags in menu.xml -- I didn't inspect that closely because I was so thrown by the closing tags stripped from the template, but garbage in garbage out <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
