---
layout: page
title: "FHIR Chat  · How to slice on the value of an extension · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html">How to slice on the value of an extension</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="251803774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/251803774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#251803774">(Sep 02 2021 at 23:56)</a>:</h4>
<p>I have an extension that has a boolean value and I want to slice based on the true/false value.  I've tried a number of different ways of expressing the discriminator and keep getting the following error:</p>
<div class="codehilite"><pre><span></span><code>Slicing cannot be evaluated: Unable to resolve discriminator in definitions: extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value.ofType(boolean) (@char 1)
</code></pre></div>
<p>The extension is on the Claim.careTeam element and the slice is on the careTeam element (if that is important to know).</p>
<p>Can anyone provide the proper expression for this discriminator?  Bonus points if you can explain why:</p>
<div class="codehilite"><pre><span></span><code>extension(&#39;blah&#39;).value
</code></pre></div>
<p>doesn't just work (where blah is the actual url of the extension).</p>



<a name="251908577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/251908577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#251908577">(Sep 03 2021 at 16:38)</a>:</h4>
<p>My guess is that the ofType bit isn't handled.  Can the extension have a value other than boolean?  If not, you can leave that bit off</p>



<a name="251908685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/251908685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#251908685">(Sep 03 2021 at 16:39)</a>:</h4>
<p>If that works, submit a Git issue against the validator for lack of support for ofType</p>



<a name="251921825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/251921825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#251921825">(Sep 03 2021 at 18:15)</a>:</h4>
<p>I did try 'extension('url').value' and 'extension('url').valueBoolean.  They both gave the same error as above.</p>



<a name="251922776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/251922776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#251922776">(Sep 03 2021 at 18:22)</a>:</h4>
<p>valueBoolean wouldn't be expected to work.  You're doing a 'slice by value' and have a fixed value defined for your slices?</p>



<a name="251924554"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/251924554" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#251924554">(Sep 03 2021 at 18:37)</a>:</h4>
<p>yes.  the extension is a valueBoolean and I have one slice for 'true' and one slice for 'false'.</p>



<a name="251924703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/251924703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#251924703">(Sep 03 2021 at 18:38)</a>:</h4>
<div class="codehilite"><pre><span></span><code>      {
        &quot;id&quot;: &quot;Claim.careTeam&quot;,
        &quot;path&quot;: &quot;Claim.careTeam&quot;,
        &quot;slicing&quot;: {
          &quot;discriminator&quot;: [
            {
              &quot;type&quot;: &quot;value&quot;,
              &quot;path&quot;: &quot;extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value&quot;
            }
          ],
          &quot;rules&quot;: &quot;open&quot;,
          &quot;description&quot;: &quot;Slice based on whether the care team member belongs to the overall claim or to an individual claim item.&quot;
        },
        &quot;mustSupport&quot;: true
      },
</code></pre></div>
<div class="codehilite"><pre><span></span><code>      {
        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember&quot;,
        &quot;path&quot;: &quot;Claim.careTeam&quot;,
        &quot;sliceName&quot;: &quot;OverallClaimMember&quot;,
        &quot;min&quot;: 0,
        &quot;max&quot;: &quot;14&quot;
      },
      {
        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope&quot;,
        &quot;path&quot;: &quot;Claim.careTeam.extension&quot;,
        &quot;sliceName&quot;: &quot;careTeamClaimScope&quot;
      },
      {
        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope.valueBoolean&quot;,
        &quot;path&quot;: &quot;Claim.careTeam.extension.valueBoolean&quot;,
        &quot;min&quot;: 0,
        &quot;max&quot;: &quot;1&quot;,
        &quot;patternBoolean&quot;: true
      },
</code></pre></div>



<a name="252021254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/252021254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#252021254">(Sep 04 2021 at 19:35)</a>:</h4>
<p>The id should be ".value:valueBoolean" rather than ".valueBoolean".  Similarly, the path should be ".value", not ".valueBoolean"</p>



<a name="252306531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/252306531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#252306531">(Sep 07 2021 at 13:41)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I've worked with the Sushi team and Chris thinks that the slicing is correct.  This might be a validator problem.  I've checked in the code: <a href="https://github.com/HL7/davinci-pas">https://github.com/HL7/davinci-pas</a>. I'm unsure what to do to move this forward since I want to slice on the boolean value of an extension and the validator appears to not like that slicing discriminator.</p>



<a name="252314107"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/252314107" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#252314107">(Sep 07 2021 at 14:29)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> said:</p>
<blockquote>
<p>The id should be ".value:valueBoolean" rather than ".valueBoolean". Similarly, the path should be ".value", not ".valueBoolean"</p>
</blockquote>
<p>My understanding is that this shortcut syntax (<code>valueBoolean</code>) is allowed in the discriminator -- and we even see it used like this in some core FHIR profiles.  When the IG Publisher processes it, it correctly converts the shortcut paths/ids to their standard variants (id <code>value[x]:valueBoolean</code>, path <code>value[x]</code>) in the snapshot.  I have confirmed this myself.</p>



<a name="252319356"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/252319356" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#252319356">(Sep 07 2021 at 15:00)</a>:</h4>
<p>I know some tools support it.  I'm not clear that it's "allowed".  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>?</p>



<a name="253679928"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253679928" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253679928">(Sep 17 2021 at 02:24)</a>:</h4>
<p><span class="user-mention" data-user-id="192166">@Jean Duteau</span> looking at this, I can improve the error to be more informative, and so I have. Now, I get this error:</p>
<p>Slicing cannot be evaluated: Unable to resolve discriminator extension('http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope').value found in the definitions because the extension <a href="http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope">http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope</a> wasn't found in the profile <a href="http://hl7.org/fhir/us/davinci-pas/StructureDefinition/profile-claim-update">http://hl7.org/fhir/us/davinci-pas/StructureDefinition/profile-claim-update</a></p>



<a name="253687234"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253687234" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253687234">(Sep 17 2021 at 04:17)</a>:</h4>
<p>so profile-claim-update has profile-claim as its parent.  the careTeamClaimScope is found in profile-claim.  profile-claim-update just puts constraints on supportingInfo and item.</p>



<a name="253687447"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253687447" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253687447">(Sep 17 2021 at 04:20)</a>:</h4>
<p>when I look at the snapshot of profile-claim-update, the careTeamClaimScope extension is there:</p>
<div class="codehilite"><pre><span></span><code>      {
        &quot;id&quot;: &quot;Claim.careTeam.extension:careTeamClaimScope&quot;,
        &quot;path&quot;: &quot;Claim.careTeam.extension&quot;,
        &quot;sliceName&quot;: &quot;careTeamClaimScope&quot;,
        &quot;short&quot;: &quot;Extension&quot;,
        &quot;definition&quot;: &quot;A flag that indicates whether the care team applies to the entire claim or a single item.&quot;,
        &quot;min&quot;: 1,
        &quot;max&quot;: &quot;1&quot;,
        &quot;base&quot;: {
          &quot;path&quot;: &quot;Element.extension&quot;,
          &quot;min&quot;: 0,
          &quot;max&quot;: &quot;*&quot;
        },
        &quot;type&quot;: [
          {
            &quot;code&quot;: &quot;Extension&quot;,
            &quot;profile&quot;: [
              &quot;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&quot;
            ]
          }
        ],
</code></pre></div>



<a name="253688022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253688022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253688022">(Sep 17 2021 at 04:28)</a>:</h4>
<p>well, not so fast. here's an even more improved error message once I got to that same point:</p>



<a name="253688023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253688023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253688023">(Sep 17 2021 at 04:28)</a>:</h4>
<p>Slicing cannot be evaluated: Unable to resolve discriminator extension('http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope').value on Claim.careTeam:OverallClaimMember found in the definitions because the extension <a href="http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope">http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope</a> wasn't found in the profile <a href="http://hl7.org/fhir/us/davinci-pas/StructureDefinition/profile-claim-update">http://hl7.org/fhir/us/davinci-pas/StructureDefinition/profile-claim-update</a></p>



<a name="253688229"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253688229" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253688229">(Sep 17 2021 at 04:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>      {
        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember&quot;,
        &quot;extension&quot;: [
          {
            &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-explicit-type-name&quot;,
            &quot;valueString&quot;: &quot;CareTeam&quot;
          }
        ],
        &quot;path&quot;: &quot;Claim.careTeam&quot;,
        &quot;sliceName&quot;: &quot;OverallClaimMember&quot;,
        &quot;short&quot;: &quot;Members of the care team&quot;,
        &quot;definition&quot;: &quot;The members of the team who provided the products and services.&quot;,
        &quot;requirements&quot;: &quot;Common to identify the responsible and supporting practitioners.&quot;,
        &quot;min&quot;: 0,
        &quot;max&quot;: &quot;14&quot;,
        &quot;base&quot;: {
          &quot;path&quot;: &quot;Claim.careTeam&quot;,
          &quot;min&quot;: 0,
          &quot;max&quot;: &quot;*&quot;
        },
        &quot;type&quot;: [
          {
            &quot;code&quot;: &quot;BackboneElement&quot;
          }
        ],
</code></pre></div>



<a name="253688508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253688508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253688508">(Sep 17 2021 at 04:35)</a>:</h4>
<p>right. and then the extension inside it...</p>



<a name="253688517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253688517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253688517">(Sep 17 2021 at 04:35)</a>:</h4>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
        <span class="nt">"id"</span> <span class="p">:</span> <span class="s2">"Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope"</span><span class="p">,</span>
        <span class="nt">"path"</span> <span class="p">:</span> <span class="s2">"Claim.careTeam.extension"</span><span class="p">,</span>
        <span class="nt">"sliceName"</span> <span class="p">:</span> <span class="s2">"careTeamClaimScope"</span><span class="p">,</span>
        <span class="nt">"short"</span> <span class="p">:</span> <span class="s2">"Extension"</span><span class="p">,</span>
        <span class="nt">"definition"</span> <span class="p">:</span> <span class="s2">"An Extension"</span><span class="p">,</span>
        <span class="nt">"min"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">"max"</span> <span class="p">:</span> <span class="s2">"*"</span><span class="p">,</span>
        <span class="nt">"base"</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">"path"</span> <span class="p">:</span> <span class="s2">"Element.extension"</span><span class="p">,</span>
          <span class="nt">"min"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nt">"max"</span> <span class="p">:</span> <span class="s2">"*"</span>
        <span class="p">},</span>
        <span class="nt">"type"</span> <span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">"code"</span> <span class="p">:</span> <span class="s2">"Extension"</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">"constraint"</span> <span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">"key"</span> <span class="p">:</span> <span class="s2">"ele-1"</span><span class="p">,</span>
            <span class="nt">"severity"</span> <span class="p">:</span> <span class="s2">"error"</span><span class="p">,</span>
            <span class="nt">"human"</span> <span class="p">:</span> <span class="s2">"All FHIR elements must have a @value or children"</span><span class="p">,</span>
            <span class="nt">"expression"</span> <span class="p">:</span> <span class="s2">"hasValue() or (children().count() &gt; id.count())"</span><span class="p">,</span>
            <span class="nt">"xpath"</span> <span class="p">:</span> <span class="s2">"@value|f:*|h:div"</span><span class="p">,</span>
            <span class="nt">"source"</span> <span class="p">:</span> <span class="s2">"http://hl7.org/fhir/StructureDefinition/Element"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">"key"</span> <span class="p">:</span> <span class="s2">"ext-1"</span><span class="p">,</span>
            <span class="nt">"severity"</span> <span class="p">:</span> <span class="s2">"error"</span><span class="p">,</span>
            <span class="nt">"human"</span> <span class="p">:</span> <span class="s2">"Must have either extensions or value[x], not both"</span><span class="p">,</span>
            <span class="nt">"expression"</span> <span class="p">:</span> <span class="s2">"extension.exists() != value.exists()"</span><span class="p">,</span>
            <span class="nt">"xpath"</span> <span class="p">:</span> <span class="s2">"exists(f:extension)!=exists(f:*[starts-with(local-name(.), \"value\")])"</span><span class="p">,</span>
            <span class="nt">"source"</span> <span class="p">:</span> <span class="s2">"http://hl7.org/fhir/StructureDefinition/Extension"</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">"isModifier"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nt">"isSummary"</span> <span class="p">:</span> <span class="kc">false</span>
      <span class="p">},</span>
</code></pre></div>



<a name="253688526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253688526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253688526">(Sep 17 2021 at 04:35)</a>:</h4>
<p>no profile, so no match</p>



<a name="253689207"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253689207" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253689207">(Sep 17 2021 at 04:46)</a>:</h4>
<p>so the problem is around how slicing works. I'm pretty what I'm about to say is on record, but I can't find it :-(</p>



<a name="253689248"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253689248" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253689248">(Sep 17 2021 at 04:46)</a>:</h4>
<p>the base slice defines the constraints that apply to all the slices. The validator will test the rules in the base slice first, then match the slices, and then apply the rules in the slice</p>



<a name="253689274"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253689274" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253689274">(Sep 17 2021 at 04:47)</a>:</h4>
<p>but the snapshot generator does not replicate the constraints in the slice into each of the slices. That would be multiple inheritance, and we don't do that</p>



<a name="253689284"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253689284" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253689284">(Sep 17 2021 at 04:47)</a>:</h4>
<p>usually, it doesn't matter, since the validator tests both</p>



<a name="253689357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253689357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253689357">(Sep 17 2021 at 04:48)</a>:</h4>
<p>but you've found a case where it does: you have to manually redeclare the extension constraint in the slice, since the discriminator refers to it</p>



<a name="253690145"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253690145" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253690145">(Sep 17 2021 at 04:59)</a>:</h4>
<p>okay, i understand what that says, but I'm not sure how to accomplish it.</p>



<a name="253691750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253691750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253691750">(Sep 17 2021 at 05:18)</a>:</h4>
<p>profile the extension on the slice the same way you did it on the base</p>



<a name="253693071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253693071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253693071">(Sep 17 2021 at 05:38)</a>:</h4>
<p>okay, had to do some FSH trickery, but I think I did that as I'm getting different errors now.  will look into it...</p>



<a name="253694126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253694126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253694126">(Sep 17 2021 at 05:54)</a>:</h4>
<p>okay, next question that is sort of related:<br>
with the discriminator as</p>
<div class="codehilite"><pre><span></span><code>extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value
</code></pre></div>
<p>I get an error that "...the discriminator XXX does not have fixed value, binding or existence assertions"</p>
<p>When I change it to be ...valueBoolean, I get a different error: "Unable to resolve discriminator in definitions: valueBoolean"</p>



<a name="253695353"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253695353" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253695353">(Sep 17 2021 at 06:12)</a>:</h4>
<p>well, commit that, and I'll have a look.</p>



<a name="253741043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253741043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253741043">(Sep 17 2021 at 13:23)</a>:</h4>
<p>committed.  thank you.</p>



<a name="253890339"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/253890339" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#253890339">(Sep 18 2021 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> whenever you get a chance...</p>



<a name="255126734"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255126734" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255126734">(Sep 27 2021 at 21:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> if you can let me know what I'm doing wrong, I'd like to finish getting this IG ready for publication.  <a href="https://github.com/HL7/davinci-pas">https://github.com/HL7/davinci-pas</a></p>



<a name="255157745"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255157745" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255157745">(Sep 28 2021 at 03:58)</a>:</h4>
<p>your expression is </p>
<p><code>extension('http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope').valueBoolean</code></p>



<a name="255157775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255157775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255157775">(Sep 28 2021 at 03:58)</a>:</h4>
<p>see <a href="https://hl7.org/fhir/fhirpath.html#polymorphism">https://hl7.org/fhir/fhirpath.html#polymorphism</a></p>



<a name="255157812"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255157812" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255157812">(Sep 28 2021 at 03:59)</a>:</h4>
<p>should be </p>
<p><code>extension('http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope').value as Boolean</code></p>



<a name="255159174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255159174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255159174">(Sep 28 2021 at 04:18)</a>:</h4>
<p>okay, I had that at one time but changed it when I was getting the previous error.  running a build to check...</p>



<a name="255159406"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255159406" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255159406">(Sep 28 2021 at 04:22)</a>:</h4>
<p>that still gave me the same error:</p>
<div class="codehilite"><pre><span></span><code>Slicing cannot be evaluated: Could not match discriminator ([extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value as Boolean]) for slice Claim.careTeam:OverallClaimMember in profile http://hl7.org/fhir/us/davinci-pas/StructureDefinition/profile-claim-update - the discriminator [extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value as Boolean] does not have fixed value, binding or existence assertions
</code></pre></div>



<a name="255159471"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255159471" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255159471">(Sep 28 2021 at 04:23)</a>:</h4>
<p>well, it's progress. Commit that and I'll have another look</p>



<a name="255159887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255159887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255159887">(Sep 28 2021 at 04:30)</a>:</h4>
<p>done</p>



<a name="255172887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/255172887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#255172887">(Sep 28 2021 at 07:21)</a>:</h4>
<p>so I don't think that the differential has changed in a meaningful way . The differential in profile <code>http://hl7.org/fhir/us/davinci-pas/StructureDefinition/profile-claim</code> says:</p>
<ul>
<li>Claim.careTeam sliced by the value of the extension <code>http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope</code></li>
<li>Claim.careTeam.extension sliced by URL</li>
<li>one care team claim scope extension which is extension <code>http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope</code></li>
</ul>
<p>Then it defines the first slice:</p>
<ul>
<li>Claim.careTeam:OverallClaimMember</li>
<li>Claim.careTeam:OverallClaimMember.extension - 2..*</li>
<li>Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope - defines the named slice</li>
<li>Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope.valueBoolean - fixes the value to true</li>
</ul>
<p>But... see what I wrote above: </p>
<blockquote>
<p>the snapshot generator does not replicate the constraints in the slice into each of the slices</p>
</blockquote>
<p>so when it goes to process the first slice, nothing ever says that the extension careTeamClaimScope is actually the extension <code>http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope</code></p>



<a name="257451464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/257451464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#257451464">(Oct 13 2021 at 22:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>, thanks for the analysis of this.  I've done some further analysis and posted my findings <a href="#narrow/stream/215610-shorthand/topic/Help.20with.20slicing.20on.20an.20extension.20value/near/255461723">here</a>.</p>
<p>While I provided Jean a work-around, it seems that the right solution is for SUSHI to redeclare extensions in each slice.  Are there any other constraints or ElementDefinition fields that we also should redeclare (i.e. copy) from the base when people create slices of an element?</p>



<a name="257945310"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/257945310" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#257945310">(Oct 17 2021 at 20:15)</a>:</h4>
<p>I think pretty much everything</p>



<a name="258020453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/258020453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#258020453">(Oct 18 2021 at 12:30)</a>:</h4>
<p>OK!  That makes it pretty easy then.  Thanks!</p>



<a name="262366804"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/262366804" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#262366804">(Nov 22 2021 at 19:31)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> -- we're working through the implications of what it means to redeclare "pretty much everything" from a slice base's differential to its individual slices.  Having done some initial implementation, we're seeing a few things we want to ask about:</p>
<ul>
<li>Does it make sense to redeclare the slice base's metadata like <code>short</code>, <code>definition</code>, <code>comment</code>, etc in each slice?</li>
<li>If a choice type is restricted to one type, but a type slice is used to further constrain the element, should the type slice also have the <code>type</code> in its differential?  E.g.:<ul>
<li>Observation.value[x] in the profile has <code>"type": [{ "code": "Quantity" }]</code></li>
<li>If the profile also has an Observation.value[x]:valueQuantity element, should it also have <code>"type": [{ "code": "Quantity" }]</code> in its differential?</li>
</ul>
</li>
<li>If a slice base has constraints on child elements (e.g., <code>Observation.component.code</code> has a contraint), then should the differential introduce <code>Observation.component:SliceA.code</code> just to redeclare that constraint?</li>
</ul>



<a name="262966945"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/262966945" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#262966945">(Nov 29 2021 at 04:50)</a>:</h4>
<blockquote>
<p>Does it make sense to redeclare the slice base's metadata like short, definition, comment, etc in each slice?</p>
</blockquote>
<p>mostly, I think. it's hard to answer that without more context </p>
<blockquote>
<p>If a choice type is restricted to one type, but a type slice is used to further constrain the element, should the type slice also have the type in its differential? E.g.:<br>
Observation.value[x] in the profile has "type": [{ "code": "Quantity" }]<br>
If the profile also has an Observation.value[x]:valueQuantity element, should it also have "type": [{ "code": "Quantity" }] in its differential?</p>
</blockquote>
<p>I think so? Again, hard without context but this us about reprofiling?</p>
<blockquote>
<p>If a slice base has constraints on child elements (e.g., Observation.component.code has a contraint), then should the differential introduce Observation.component:SliceA.code just to redeclare that constraint?</p>
</blockquote>
<p>I think so? Again... hard to answer without context</p>



<a name="263503980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/How%20to%20slice%20on%20the%20value%20of%20an%20extension/near/263503980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/How.20to.20slice.20on.20the.20value.20of.20an.20extension.html#263503980">(Dec 02 2021 at 21:38)</a>:</h4>
<p>Thanks for the responses, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>.  We've decided that for now we will address the immediate problem at hand -- which is that the validator needs extensions redeclared in slices in order to process discriminator paths that use the <code>extension()</code> function.  Since slices <em>conceptually</em> inherit constraints from the base slice, we think its less disruptive now if we only redundantly declare the inherited constraints in cases where we know they cause problems otherwise.  This will be in the next SUSHI release.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
