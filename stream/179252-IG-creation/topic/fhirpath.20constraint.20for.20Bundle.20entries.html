---
layout: page
title: "FHIR Chat  · fhirpath constraint for Bundle entries · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/fhirpath.20constraint.20for.20Bundle.20entries.html">fhirpath constraint for Bundle entries</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="274117176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/fhirpath%20constraint%20for%20Bundle%20entries/near/274117176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niklas Haldorn <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/fhirpath.20constraint.20for.20Bundle.20entries.html#274117176">(Mar 04 2022 at 11:48)</a>:</h4>
<p>Hi all,<br>
I am trying to create a Bundle profile for the requirement, that for every non-provenance resource in the bundle there must be a provenance that references the resource as a target. <br>
I tried to implement this profile with a constraint that iterates over all entries and if the entry is not a provenance it selects the first target reference from all provenances in the bundle and checks if the id of the resource is in this collection. <br>
For the constraint I used the following expression</p>
<div class="codehilite"><pre><span></span><code>entry.all((resource is Provenance) or (resource.resourceType.toString() &amp; &#39;/&#39; &amp; resource.id)
.subsetOf(entry.select((resource as Provenance).target.first().reference)))
</code></pre></div>
<p>However, the expression always fails if the bundle contains a non-provenance resource even if a correct provenance is part of the bundle. <br>
Does anyone know how to change the expression to fulfil the requirement or if there is a better way to enforce the requirement in the bundle?</p>



<a name="274138331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/fhirpath%20constraint%20for%20Bundle%20entries/near/274138331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/fhirpath.20constraint.20for.20Bundle.20entries.html#274138331">(Mar 04 2022 at 14:45)</a>:</h4>
<p>The issue is that your <code>entry.select...</code> bit is executing in the context of <code>entry.all...</code>.  Try <code>%resource.entry.select...</code></p>
<p>Note that your expression presumes that all entries in the Bundle will be referenced using relative references and, in general, that's not a safe assumption.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
