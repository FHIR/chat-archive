---
layout: page
title: "FHIR Chat  · Bad Choice Rendering + JSON mangling · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html">Bad Choice Rendering + JSON mangling</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153947451"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947451" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947451">(Mar 23 2018 at 02:50)</a>:</h4>
<p>In my 3.0.1-based IG, profiles on Observation suffer from a poorly rendered <code>basedOn</code> choice in the <code>Snapshot</code> table. See:</p>
<p><a href="/user_uploads/10155/m1q21Tn4fm4XD2BU1FmQxxTi/bad_choice.png" target="_blank" title="bad_choice.png">bad_choice.png</a> </p>
<p>In the profile.json I send to the IG publisher, the basedOn type looks about right (as best I can tell):</p>
<div class="codehilite"><pre><span></span>&quot;type&quot;: [
          {
            &quot;code&quot;: &quot;Reference&quot;,
            &quot;targetProfile&quot;: &quot;http://hl7.org/fhir/StructureDefinition/CarePlan&quot;
          },
          {
            &quot;code&quot;: &quot;Reference&quot;,
            &quot;targetProfile&quot;: &quot;http://hl7.org/fhir/StructureDefinition/DeviceRequest&quot;
          },
         // etc
],
</pre></div>


<p>But if I download the profile.json from the IG-produced profile page, it looks like the IG publisher lost all my <code>targetProfile</code>s!</p>
<div class="codehilite"><pre><span></span>&quot;type&quot;: [
          {
            &quot;code&quot;: &quot;Reference&quot;
          },
          {
            &quot;code&quot;: &quot;Reference&quot;
          },
          // etc
],
</pre></div>


<p>For an example, see the Snapshot Table here: <a href="http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-oncology-HER2byISH.html" target="_blank" title="http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-oncology-HER2byISH.html">http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-oncology-HER2byISH.html</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/m1q21Tn4fm4XD2BU1FmQxxTi/bad_choice.png" target="_blank" title="bad_choice.png"><img src="/user_uploads/10155/m1q21Tn4fm4XD2BU1FmQxxTi/bad_choice.png"></a></div>



<a name="153947453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947453">(Mar 23 2018 at 02:52)</a>:</h4>
<p>hmm. I thought I had found all those plaecs</p>



<a name="153947454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947454">(Mar 23 2018 at 02:55)</a>:</h4>
<p>code seems to have fallen out; wait for this build and try again</p>



<a name="153947486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947486">(Mar 23 2018 at 12:48)</a>:</h4>
<p>So... I just rebuilt on the auto-build, which I think uses the latest available igpublisher.jar.  Now I see the bars (i.e., <code>|</code>) between each choice item, but it's still not wrapping between any -- so we get a super long horizontal list.  In addition, when I download the JSON, it still looks like the <code>targetProfile</code> is stripped from each object in the <code>type</code>.</p>



<a name="153947487"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947487" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947487">(Mar 23 2018 at 12:50)</a>:</h4>
<p><a href="/user_uploads/10155/RlcBAqr8GnCB3rEeWsQRKJNH/bad_choice_2.png" target="_blank" title="bad_choice_2.png">bad_choice_2.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/RlcBAqr8GnCB3rEeWsQRKJNH/bad_choice_2.png" target="_blank" title="bad_choice_2.png"><img src="/user_uploads/10155/RlcBAqr8GnCB3rEeWsQRKJNH/bad_choice_2.png"></a></div>



<a name="153947488"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947488" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947488">(Mar 23 2018 at 12:50)</a>:</h4>
<p>I also just noticed that there is a trailing <code>|</code> at the end of the list of choices in the HTML rendering...</p>



<a name="153947515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947515">(Mar 23 2018 at 15:19)</a>:</h4>
<p>Looking at the page source, I see that there are no spaces between the links and the bars (<code>|</code>) -- and that there is a missing bar between the first two choices and an extra bar at the end:</p>



<a name="153947516"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947516" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947516">(Mar 23 2018 at 15:19)</a>:</h4>
<div class="codehilite"><pre><span></span>Reference&lt;/a&gt;(&lt;a href=&quot;http://hl7.org/fhir/STU3/careplan.html&quot;&gt;CarePlan&lt;/a&gt;&lt;a href=&quot;http://hl7.org/fhir/STU3/devicerequest.html&quot;&gt;DeviceRequest&lt;/a&gt;|&lt;a href=&quot;http://hl7.org/fhir/STU3/immunizationrecommendation.html&quot;&gt;ImmunizationRecommendation&lt;/a&gt;|&lt;a href=&quot;http://hl7.org/fhir/STU3/medicationrequest.html&quot;&gt;MedicationRequest&lt;/a&gt;|&lt;a href=&quot;http://hl7.org/fhir/STU3/nutritionorder.html&quot;&gt;NutritionOrder&lt;/a&gt;|&lt;a href=&quot;http://hl7.org/fhir/STU3/procedurerequest.html&quot;&gt;ProcedureRequest&lt;/a&gt;|&lt;a href=&quot;http://hl7.org/fhir/STU3/referralrequest.html&quot;&gt;ReferralRequest&lt;/a&gt;|)
</pre></div>



<a name="153947517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947517">(Mar 23 2018 at 15:20)</a>:</h4>
<p>Instead, this needs to be:</p>



<a name="153947518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947518">(Mar 23 2018 at 15:21)</a>:</h4>
<div class="codehilite"><pre><span></span>Reference&lt;/a&gt;(&lt;a href=&quot;http://hl7.org/fhir/STU3/careplan.html&quot;&gt;CarePlan&lt;/a&gt; | &lt;a href=&quot;http://hl7.org/fhir/STU3/devicerequest.html&quot;&gt;DeviceRequest&lt;/a&gt; | &lt;a href=&quot;http://hl7.org/fhir/STU3/immunizationrecommendation.html&quot;&gt;ImmunizationRecommendation&lt;/a&gt; | &lt;a href=&quot;http://hl7.org/fhir/STU3/medicationrequest.html&quot;&gt;MedicationRequest&lt;/a&gt; | &lt;a href=&quot;http://hl7.org/fhir/STU3/nutritionorder.html&quot;&gt;NutritionOrder&lt;/a&gt; | &lt;a href=&quot;http://hl7.org/fhir/STU3/procedurerequest.html&quot;&gt;ProcedureRequest&lt;/a&gt; | &lt;a href=&quot;http://hl7.org/fhir/STU3/referralrequest.html&quot;&gt;ReferralRequest&lt;/a&gt;)
</pre></div>



<a name="153947519"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947519" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947519">(Mar 23 2018 at 15:21)</a>:</h4>
<p>The spaces on each side of the <code>|</code> allow the choice types to wrap -- and I've confirmed that fixes the display issue.</p>



<a name="153947520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947520">(Mar 23 2018 at 15:22)</a>:</h4>
<p>Now as for why the <code>targetProfile</code> is stripped from the exported JSON, I don't know -- nor do I know if it's at all related to this.</p>



<a name="153947558"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947558" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947558">(Mar 23 2018 at 19:24)</a>:</h4>
<p>which json is stripped from?</p>



<a name="153947570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947570">(Mar 23 2018 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> See <code>Observation:oncology-HER2byISH.basedOn</code> element here: <a href="http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-oncology-HER2byISH.json.html" target="_blank" title="http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-oncology-HER2byISH.json.html">http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-oncology-HER2byISH.json.html</a></p>
<p>Now for comparison, look at the JSON structure definition I provided to the IG Publisher in the source: <a href="https://github.com/HL7/us-breastcancer/blob/master/resources/structuredefinition-oncology-HER2byISH.json#L490-L551" target="_blank" title="https://github.com/HL7/us-breastcancer/blob/master/resources/structuredefinition-oncology-HER2byISH.json#L490-L551">https://github.com/HL7/us-breastcancer/blob/master/resources/structuredefinition-oncology-HER2byISH.json#L490-L551</a></p>



<a name="153947575"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947575" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947575">(Mar 23 2018 at 20:14)</a>:</h4>
<p>fixed</p>



<a name="153947612"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/Bad%20Choice%20Rendering%20%2B%20JSON%20mangling/near/153947612" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/Bad.20Choice.20Rendering.20.2B.20JSON.20mangling.html#153947612">(Mar 24 2018 at 05:26)</a>:</h4>
<p>The rendering looks much better.  Thanks, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>!  There still seems to be an issue w/ the JSON / XML output, but it's a different issue now.  I'll make a new thread for that.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
