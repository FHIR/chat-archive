---
layout: page
title: "FHIR Chat  · White html pages for Profile on Observation with ordinal Ext · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/White.20html.20pages.20for.20Profile.20on.20Observation.20with.20ordinal.20Ext.html">White html pages for Profile on Observation with ordinal Ext</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="246703160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/White%20html%20pages%20for%20Profile%20on%20Observation%20with%20ordinal%20Ext/near/246703160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/White.20html.20pages.20for.20Profile.20on.20Observation.20with.20ordinal.20Ext.html#246703160">(Jul 21 2021 at 10:47)</a>:</h4>
<p>Attention: A very long message, I almost hit the zulip limit of 10000 chars ....</p>
<p>We encountered a very strancge issue with an Implementation Guide where we had white web pages appearing instead of the profile description. I tried to track the problem down and started making notes ... I put them here, knowing that zulip will not occupy your<br>
whole screen, if you are interested in tracking down IG Publishing issues i invite you to follow along:</p>
<p>We want to create profiles on an Observations, and the title has an ampersand in it:</p>
<div class="codehilite" data-code-language="XML"><pre><span></span><code>    <span class="nt">&lt;title</span> <span class="na">value=</span><span class="s">"Only ampersand (&amp;amp; named) - working"</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>this works without problems <a href="https://build.fhir.org/ig/ahdis/ch-ig/branches/ampersand/StructureDefinition-TestAmpNamed.html">StructureDefinition-TestAmpNamed</a>.</p>
<p>However if we add a the <a href="https://www.hl7.org/fhir/extension-ordinalvalue-definitions.html">ordinal Value Extension to the Observation</a> the html is invalid and shows in the <a href="https://build.fhir.org/ig/ahdis/ch-ig/branches/ampersand/StructureDefinition-TestExtAmpNamed.html">browser a white page, TestExtAmpNamed</a> </p>
<p>If the title has no ampersand in it, it is <a href="https://build.fhir.org/ig/ahdis/ch-ig/branches/ampersand/StructureDefinition-TestExt.html">working</a>.</p>
<p>The difference between the generated html is:</p>
<p><a href="https://build.fhir.org/ig/ahdis/ch-ig/branches/ampersand/StructureDefinition-TestAmpNamed.html">StructureDefinition-TestAmpNamed</a>: </p>
<div class="codehilite" data-code-language="HTML"><pre><span></span><code>  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">content</span><span class="o">=</span><span class="s">"text/html;charset=utf-8"</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">"Content-Type"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>CH.FHIR.IG.CH-IG\Only ampersand (<span class="err">&amp;</span> named) - working - FHIR v4.0.1<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- snip --&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</code></pre></div>
<p><a href="https://build.fhir.org/ig/ahdis/ch-ig/branches/ampersand/StructureDefinition-TestExtAmpNamed.html">StructureDefinition-TestExtAmpNamed.html</a>: </p>
<div class="codehilite" data-code-language="HTML"><pre><span></span><code>  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">"Content-Type"</span> <span class="na">content</span><span class="o">=</span><span class="s">"text/html;charset=utf-8"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>CH.FHIR.IG.CH-IG\Extension and ampersand (<span class="ni">&amp;amp;</span> named) - not working - FHIR v4.0.1/title<span class="ni">&amp;gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="p">/&gt;</span>
     <span class="c">&lt;!-- 1) difference with escaping &amp;amp; 2) title tag is not closed, 3) head is not closed before content is coming, only at hen den --&gt;</span>


    <span class="c">&lt;!-- end of file&lt;/h2&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/title&gt;&lt;/head&gt;&lt;/html&gt; --&gt;</span>
</code></pre></div>
<p>It looks like the html generation trips over the title in the second case :</p>
<div class="codehilite" data-code-language="XML"><pre><span></span><code>/title<span class="ni">&amp;gt;</span> instead of <span class="nt">&lt;/title&gt;</span>
</code></pre></div>
<p>the pages are generated by the IGPublisher with the help of templates and jekyll:</p>
<p>template/includes/fragment-pagebegin.md has the following content:</p>
<div class="codehilite"><pre><span></span><code>    &lt;meta content=&quot;text/html;charset=utf-8&quot; http-equiv=&quot;Content-Type&quot;/&gt;
    &lt;title&gt;{{site.data.fhir.igId | upcase}}\{{site.data.pages[page.path].title}} - FHIR v{{site.data.fhir.version}}&lt;/title&gt;
</code></pre></div>
<p>so it looks that site.data.pages[page.path].title might be the culprit</p>
<p>this file can be found in temp/pages/_data pages.json: however they look exactly the same, should not give an issue with template.</p>
<div class="codehilite"><pre><span></span><code>&quot;StructureDefinition-TestExtAmpNamed.html&quot;: {
    &quot;title&quot;: &quot;Extension and ampersand (&amp; named) - not working&quot;,
},

&quot;StructureDefinition-TestAmpNamed.html&quot;: {
    &quot;title&quot;: &quot;Only ampersand (&amp; named) - working&quot;,
},
</code></pre></div>

<p>running jekyll directly on the command line indeed shows that the output is correct:</p>
<div class="codehilite"><pre><span></span><code>jekyll build -s temp/pages -d output
</code></pre></div>
<p>now the pages shows in the browser and the title is correct.</p>
<p>but what is different now, is that i have the yellow note:</p>
<div class="codehilite" data-code-language="HTML"><pre><span></span><code><span class="c">&lt;!--ReleaseHeader--&gt;</span><span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">"publish-box"</span><span class="p">&gt;</span>Publish Box goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span><span class="c">&lt;!--EndReleaseHeader--&gt;</span>
</code></pre></div>
<p>for a regular ig build the version is mentioned, in our case:</p>
<div class="codehilite" data-code-language="HTML"><pre><span></span><code><span class="c">&lt;!--ReleaseHeader--&gt;</span><span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">"publish-box"</span><span class="p">&gt;</span>CH IG (R4) - Local Development build (v0.1.0). See the <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"http://fhir.ch/ig/ch-ig/history.html"</span><span class="p">&gt;</span>Directory of published versions<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div>
<p>brings IGPublisher as a suspect after processing in jekyll ...</p>
<p>During the "Checking Output HTML" phase, the files get updated when something has been changed:</p>
<p>in /org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/HTLMLInspector.java L273</p>
<div class="codehilite" data-code-language="Java"><pre><span></span><code>      <span class="k">if</span> <span class="p">(</span><span class="n">lf</span><span class="p">.</span><span class="na">isHasXhtml</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">XhtmlNode</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XhtmlParser</span><span class="p">().</span><span class="na">setMustBeWellFormed</span><span class="p">(</span><span class="n">strict</span><span class="p">).</span><span class="na">parse</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">lf</span><span class="p">.</span><span class="na">filename</span><span class="p">),</span> <span class="kc">null</span><span class="p">);</span>
        <span class="n">referencesValidatorPack</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">checkLinks</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="o">!=</span> <span class="n">NodeChangeType</span><span class="p">.</span><span class="na">NONE</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// returns true if changed</span>
          <span class="n">saveFile</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div>
<p>saveFile is commented out the html displays correctly, so <br>
1) checkLinks returns a change <br>
2) why does saveFile fail?</p>
<p>in checkLinks it triggers the return true with a condition of NodeChangeType.SELF set to true</p>
<div class="codehilite" data-code-language="Java"><pre><span></span><code>    <span class="k">for</span> <span class="p">(</span><span class="n">XhtmlNode</span> <span class="n">c</span> <span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">NodeChangeType</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">checkLinks</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">nuid</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="n">inPre</span> <span class="o">||</span> <span class="s">"pre"</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="na">getName</span><span class="p">()));</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ct</span> <span class="o">==</span> <span class="n">NodeChangeType</span><span class="p">.</span><span class="na">SELF</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">nSelfChanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="n">nchanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ct</span> <span class="o">==</span> <span class="n">NodeChangeType</span><span class="p">.</span><span class="na">CHILD</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">nchanged</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<p>this is caused by checkResolve Link fails which cannot be resolved:</p>
<div class="codehilite" data-code-language="HTML"><pre><span></span><code><span class="p">&lt;</span><span class="nt">td</span> <span class="na">style</span><span class="o">=</span><span class="s">"vertical-align: top; text-align : left; background-color: #F7F7F7; border: 0px #F0F0F0 solid; padding:0px 4px 0px 4px; white-space: nowrap; background-image: url(tbl_bck0004.png)"</span> <span class="na">class</span><span class="o">=</span><span class="s">"hierarchy"</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"tbl_spacer.png"</span> <span class="na">alt</span><span class="o">=</span><span class="s">"."</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-color: inherit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"hierarchy"</span><span class="p">/&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"tbl_blank.png"</span> <span class="na">alt</span><span class="o">=</span><span class="s">"."</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-color: inherit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"hierarchy"</span><span class="p">/&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"tbl_blank.png"</span> <span class="na">alt</span><span class="o">=</span><span class="s">"."</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-color: inherit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"hierarchy"</span><span class="p">/&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"tbl_vjoin_end.png"</span> <span class="na">alt</span><span class="o">=</span><span class="s">"."</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-color: inherit"</span> <span class="na">class</span><span class="o">=</span><span class="s">"hierarchy"</span><span class="p">/&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"icon_slice_item.png"</span> <span class="na">alt</span><span class="o">=</span><span class="s">"."</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-color: #F7F7F7; background-color: inherit"</span> <span class="na">title</span><span class="o">=</span><span class="s">"Slice Item"</span> <span class="na">class</span><span class="o">=</span><span class="s">"hierarchy"</span><span class="p">/&gt;</span> <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"StructureDefinition-TestExtAmpNamed-definitions.html#Observation.valueCodeableConcept.coding.extension:ordinalValue"</span> <span class="na">title</span><span class="o">=</span><span class="s">"Extension URL = http://hl7.org/fhir/StructureDefinition/ordinalValue"</span><span class="p">&gt;</span>ordinalValue<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">name</span><span class="o">=</span><span class="s">"Observation.valueCodeableConcept.coding.extension"</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</code></pre></div>
<p>they are added also in this process added in the qa.html of the IG Publisher (actually could have noticed this here first in qa.html instead of debugging IGPublisher):</p>
<ol>
<li>StructureDefinition-TestExt-definitions.html#/html/body/div/div/div/div/div/table/tr/td/p/a at Line 478, column 371  error   The link 'questionnaire.html' for "Questionnaires" cannot be resolved</li>
<li>StructureDefinition-TestExt.html#/html/body/div/div/div/div/div/div/div/div/div/table/tr/td/a at Line 521, column 809    error   The link 'StructureDefinition-TestExt-definitions.html#Observation.valueCodeableConcept.coding.extension:ordinalValue' for "ordinalValue" cannot be resolved (valid targets: 115 targets)</li>
</ol>
<p>The first url cannot be resolved, because the ordinal Extension has defined in the comment a relative link, see  <a href="http://hl7.org/fhir/extension-ordinalvalue.xml.html">http://hl7.org/fhir/extension-ordinalvalue.xml.html</a>. This relative link<br>
is kept when incorporating it our Observation which includes this extension and can then not be resolved because it is not relative to the FHIR spec. For<br>
Observation.hasMember the link is changed to <code>[QuestionnaireResponse</code>](<a href="http://hl7.org/fhir/R4/questionnaireresponse.html">http://hl7.org/fhir/R4/questionnaireresponse.html</a>), event though in the base spec master format definition it is also <code>[QuestionnaireResponse</code>](questionnaireresponse.html). This looks like the extension comments are not expanded to the fullUrl in the IG Publisher.</p>
<p>The second url cannot be resolved because the fragment  on the differential table is not corresponding to the defined fragment on the detailed description tag, in the detailed description tag there is additional .value. This is occuring in the Differential Table Link by clicking on ordinalValue, but not in the Snapshot view, I think the Differential needs to be fixed. </p>
<p>Differential link/fragment for ordinalValue: StructureDefinition-TestExt.html#Observation.valueCodeableConcept.coding.extension:ordinalValue<br>
Snapshot link/fragment for StructureDefinition-TestExt-definitions.html#Observation.value[x]:valueCodeableConcept.coding.extension:ordinalValue</p>
<p>The not resolving Link triggers the saving of the file, so this function looks like it does not serialize correctly the xhtml when the tile has an ampersand in it, BUT WAIT!!! &amp; not escaped in html, see:</p>
<div class="codehilite" data-code-language="HTML"><pre><span></span><code>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>CH.FHIR.IG.CH-IG\Only ampersand (<span class="err">&amp;</span> named) - working - FHIR v4.0.1<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</code></pre></div>
<p>This is not correct according to <a href="https://www.w3.org/TR/xhtml1/">xhtml in C.12 C.12. Using Ampersands in Attribute Values (and Elsewhere)</a> and <a href="https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references">https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references</a>. So the template needs to be changed to that the title is escaped (&amp; instead of &amp;amp) in the jekyll template, and we are back to the template constructing the html page:</p>
<p>from:<br>
{{site.data.pages[page.path].title</p>
<p>to: <br>
{{site.data.pages[page.path].title | escape_once }}</p>
<p>we are using the [fhir.base.template#current]https://github.com/HL7/ig-template-base which is configured in ig.ini.<br>
forked it to modify</p>
<p>we run the ig publisher</p>
<div class="codehilite"><pre><span></span><code>java -jar /Users/oliveregger/.vscode/extensions/yannick-lagger.vscode-fhir-tools-1.4.1/publisher.jar -ig . -tx n/a
...
Installing fhir.base.template#dev to the package cache
</code></pre></div>
<p>now we change ig.ini to use fhir.base.template#dev instead of fhir.base.template#current and we should have the<br>
pages also reappearing when running IG Publisher, and yes finally, we have it working .... </p>
<p><a href="https://github.com/HL7/ig-template-base/pull/172">Pull Request</a> is here.</p>
<p>For the resolve Links issues I will create two github issues.</p>



<a name="246728727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/White%20html%20pages%20for%20Profile%20on%20Observation%20with%20ordinal%20Ext/near/246728727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/White.20html.20pages.20for.20Profile.20on.20Observation.20with.20ordinal.20Ext.html#246728727">(Jul 21 2021 at 14:39)</a>:</h4>
<p><span class="user-mention" data-user-id="191478">@Oliver Egger</span>, thanks for the thorough job of debugging.  One small correction on your pull request.</p>



<a name="246733550"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/White%20html%20pages%20for%20Profile%20on%20Observation%20with%20ordinal%20Ext/near/246733550" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/White.20html.20pages.20for.20Profile.20on.20Observation.20with.20ordinal.20Ext.html#246733550">(Jul 21 2021 at 15:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> thanks for the review and merge!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
