---
layout: page
title: "FHIR Chat  · QA error on type slicing · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html">QA error on type slicing</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153987500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Karl <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987500">(Aug 16 2018 at 11:02)</a>:</h4>
<p>I'm getting QA errors with type slicing in <a href="https://github.com/devices-on-fhir/PoCD-IG/blob/master/resources/StructureDefinition-NumericObservation.xml" target="_blank" title="https://github.com/devices-on-fhir/PoCD-IG/blob/master/resources/StructureDefinition-NumericObservation.xml">this</a> profile, which restricts Observation.value[x] to valueQuantity or valueRatio and makes constraints on each of them. Here is the relevant part of StructureDefinition.differential:</p>
<div class="codehilite"><pre><span></span>    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.value[x]&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;slicing&gt;</span>
        <span class="nt">&lt;discriminator&gt;</span>
          <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;type&quot;</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;$this&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/discriminator&gt;</span>
        <span class="nt">&lt;rules</span> <span class="na">value=</span><span class="s">&quot;open&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/slicing&gt;</span>
      <span class="nt">&lt;min</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;max</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;type&gt;</span>
        <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">&quot;Quantity&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;type&gt;</span>
        <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">&quot;Ratio&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;condition</span> <span class="na">value=</span><span class="s">&quot;pocd-obs-1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueQuantity&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueQuantity&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;sliceName</span> <span class="na">value=</span><span class="s">&quot;valueQuantity&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;type&gt;</span>
        <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">&quot;Quantity&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueQuantity.value&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueQuantity.value&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;min</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueQuantity.system&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueQuantity.system&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;fixedUri</span> <span class="na">value=</span><span class="s">&quot;http://unitsofmeasure.org&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueRatio&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueRatio&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;sliceName</span> <span class="na">value=</span><span class="s">&quot;valueRatio&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;type&gt;</span>
        <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">&quot;Ratio&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueRatio.numerator&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueRatio.numerator&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueRatio.numerator.value&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueRatio.numerator.value&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;min</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueRatio.numerator.system&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueRatio.numerator.system&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;fixedUri</span> <span class="na">value=</span><span class="s">&quot;http://unitsofmeasure.org&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueRatio.denominator&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueRatio.denominator&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueRatio.denominator.value&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueRatio.denominator.value&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;min</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Observation.value[x]:valueRatio.denominator.system&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Observation.valueRatio.denominator.system&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;fixedUri</span> <span class="na">value=</span><span class="s">&quot;http://unitsofmeasure.org&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
</pre></div>


<p><a href="https://github.com/devices-on-fhir/PoCD-IG/blob/master/examples/HeartRateNumericObservation.xml" target="_blank" title="https://github.com/devices-on-fhir/PoCD-IG/blob/master/examples/HeartRateNumericObservation.xml">This</a> example referencing the profile gets an "Element matches more than one slice" error. What's going wrong here?</p>



<a name="153987503"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987503" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987503">(Aug 16 2018 at 11:03)</a>:</h4>
<p>I don't know. is it committed?</p>



<a name="153987505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Karl <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987505">(Aug 16 2018 at 11:08)</a>:</h4>
<p>It's in the <a href="http://build.fhir.org/ig/devices-on-fhir/PoCD-IG/StructureDefinition-NumericObservation.html" target="_blank" title="http://build.fhir.org/ig/devices-on-fhir/PoCD-IG/StructureDefinition-NumericObservation.html">PoCD Implementation Guide</a>.</p>



<a name="153987507"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987507" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987507">(Aug 16 2018 at 11:10)</a>:</h4>
<p>ok I'll add it to my list</p>



<a name="153987508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Karl <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987508">(Aug 16 2018 at 11:11)</a>:</h4>
<p>Thanks</p>



<a name="153987936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987936">(Aug 17 2018 at 00:28)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> I'm not sure what to do with this one. The goal is to constrain a 0..1 element with a choice of types to a single type, and then constrain it.</p>



<a name="153987939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987939">(Aug 17 2018 at 00:29)</a>:</h4>
<p><a href="http://build.fhir.org/elementdefinition.html#slicing" target="_blank" title="http://build.fhir.org/elementdefinition.html#slicing">http://build.fhir.org/elementdefinition.html#slicing</a> says:<br>
Elements that allow a choice of multiple types can be constrained. In principle, there are two different types of constraints to apply:</p>
<ul>
<li>A constraint that applies to the element as a whole - e.g. as restricting the cardinality, or limiting the choice of types</li>
<li>A constraint that applies to the use of a particular type - e.g. value set binding</li>
</ul>
<p>When constraining elements with multiple types, the following rules apply:</p>
<ul>
<li>Constraints limiting the acceptable list of types must be applied to the original "[x]" element as this is where the list of acceptable types is defined</li>
<li>The inclusion of a type specific path (such as "Patient.deceasedBoolean") SHALL NOT be interpreted as constraining allowed types, but instead, it constrains the use of a particular type</li>
<li>the original element SHALL always be represented in a snapshot; the type specific variants are only represented when needed</li>
</ul>



<a name="153987940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987940">(Aug 17 2018 at 00:31)</a>:</h4>
<p>so I would expect that you'd have this:<br>
Observation.value[x]<br>
   type = Quantity<br>
Observation.valueQuantity<br>
Observation.valueQuantity.system<br>
  fixedUri = <a href="http://unitsofmeasure.org" target="_blank" title="http://unitsofmeasure.org">http://unitsofmeasure.org</a></p>



<a name="153987941"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987941" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987941">(Aug 17 2018 at 00:31)</a>:</h4>
<p>but the snapshot generator doesn't accept this. Where as the validator seems to assume it...</p>



<a name="153987970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987970">(Aug 17 2018 at 00:50)</a>:</h4>
<p>Agree that the snapshot generator should allow/expect this.  Also realize that digging into that particular piece of code at this point in the process is a very scary prospect...</p>



<a name="153987975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/QA%20error%20on%20type%20slicing/near/153987975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/QA.20error.20on.20type.20slicing.html#153987975">(Aug 17 2018 at 00:53)</a>:</h4>
<p>Yes <span class="user-mention" data-user-id="192966">@Stefan Karl</span> we're going to carry this error. We'll fix it after ballot</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
