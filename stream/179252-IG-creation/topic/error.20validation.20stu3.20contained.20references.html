---
layout: page
title: "FHIR Chat  · error validation stu3 contained references · IG creation"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/index.html">IG creation</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html">error validation stu3 contained references</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="244341203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244341203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roeland Luykx <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244341203">(Jun 29 2021 at 20:16)</a>:</h4>
<p>If I make a DocumentManifest with a contained resouce DocumentReference with referenced (also contained - in DocumentManifest) i.e. author and patient, i receive errors with the validator and/or publisher:</p>
<p>Error @ DocumentManifest.contained[0].ofType(DocumentReference).subject (line 16, col25) : ref-1: SHALL have a contained resource if a local reference is provided ( (url: 2; ids: )) [(reference = '#') or reference.startsWith('#').not() or (reference.substring(1).trace('url') in %resource.contained.id.trace('ids'))]<br>
  Error @ DocumentManifest.contained[0].ofType(DocumentReference).author[0] (line 20, col18) : ref-1: SHALL have a contained resource if a local reference is provided ( (url: 3; ids: )) [(reference = '#') or reference.startsWith('#').not() or (reference.substring(1).trace('url') in %resource.contained.id.trace('ids'))]</p>
<p>should the actual version of publisher (1.1.76) handle this also correctly or should an older version of publisher be used for stu3? <a href="/user_uploads/10155/bUTvVWjokmNf5OUMSkJhVIyj/docmanifest.json">docmanifest.json</a></p>



<a name="244344340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244344340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244344340">(Jun 29 2021 at 20:38)</a>:</h4>
<p>STU3 had a bug in one of the invariants that didn't handle certain contained references properly.  This was fixed in R4.  You may need to live with ignoring the error in STU3.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> thoughts?</p>



<a name="244371066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244371066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244371066">(Jun 30 2021 at 02:26)</a>:</h4>
<p>I don't know. is the invariant in error?</p>



<a name="244375959"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244375959" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roeland Luykx <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244375959">(Jun 30 2021 at 04:20)</a>:</h4>
<p>does it have to do with the content.p[x] 1..1 stuff in stu3 in difference to R4 where content is a Reference?<br>
the difference of the definitions in picture (left R4, right stu3)<br>
<a href="/user_uploads/10155/Vtn0TnZC8CmhjrXSQPO6UzX8/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/Vtn0TnZC8CmhjrXSQPO6UzX8/image.png" title="image.png"><img src="/user_uploads/10155/Vtn0TnZC8CmhjrXSQPO6UzX8/image.png"></a></div>



<a name="244423339"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244423339" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244423339">(Jun 30 2021 at 13:29)</a>:</h4>
<p>R4 uses %rootResource.  STU3 only used %resource.</p>



<a name="244424560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244424560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roeland Luykx <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244424560">(Jun 30 2021 at 13:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references/near/244423339">said</a>:</p>
<blockquote>
<p>R4 uses %rootResource.  STU3 only used %resource.</p>
</blockquote>
<p>so it is a definition problem in the STU3 and not in the validator functionality?</p>



<a name="244433428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244433428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244433428">(Jun 30 2021 at 14:39)</a>:</h4>
<p>Correct</p>



<a name="244433517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244433517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244433517">(Jun 30 2021 at 14:39)</a>:</h4>
<p>Though we could theoretically put a patch in the validator to work around the STU3 issue.  (Not sure what the likelihood of getting a technical correction out on STU3 is at this point.)</p>



<a name="244477298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244477298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244477298">(Jun 30 2021 at 19:43)</a>:</h4>
<p>there's a spot in the validator where it corrects some old invariants, so a patch for this could be added to the java code</p>



<a name="244511564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/244511564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#244511564">(Jul 01 2021 at 02:19)</a>:</h4>
<p>Added <a href="https://github.com/hapifhir/org.hl7.fhir.core/issues/552">https://github.com/hapifhir/org.hl7.fhir.core/issues/552</a></p>



<a name="250847297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/250847297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#250847297">(Aug 26 2021 at 22:03)</a>:</h4>
<p><span class="user-mention" data-user-id="195864">@Roeland Luykx</span> please attach the example you were working with that demonstrated this problem to the github task that Lloyd created.</p>



<a name="250886161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/250886161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roeland Luykx <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#250886161">(Aug 27 2021 at 05:44)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> yes, i will attach the example to the issue <a href="https://github.com/hapifhir/org.hl7.fhir.core/issues/552">https://github.com/hapifhir/org.hl7.fhir.core/issues/552</a></p>



<a name="252586351"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179252-IG%20creation/topic/error%20validation%20stu3%20contained%20references/near/252586351" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roeland Luykx <a href="https://fhir.github.io/chat-archive/stream/179252-IG-creation/topic/error.20validation.20stu3.20contained.20references.html#252586351">(Sep 09 2021 at 08:03)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  thanks for the fix. it seems to work now.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
