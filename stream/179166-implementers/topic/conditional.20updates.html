---
layout: page
title: "FHIR Chat  · conditional updates · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html">conditional updates</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153847192"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/153847192" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#153847192">(Sep 13 2016 at 12:41)</a>:</h4>
<p>How much can one specify in a conditional update?<br>
Can I specify a conditional update with a path and if the resource does not exist will the path be maintained?<br>
For example<br>
PUT <a href="https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/Observation?identifier=Observation.identifier.value" target="_blank" title="https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/Observation?identifier=Observation.identifier.value">https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/Observation?identifier=Observation.identifier.value</a><br>
Note that there is no resource at <a href="https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/" target="_blank" title="https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/">https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/</a>. In fact the entire path may not exist.<br>
Will the resource be created such that<br>
GET <a href="https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/Observation?identifier=Observation.identifier.value" target="_blank" title="https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/Observation?identifier=Observation.identifier.value">https://baseURL/PCHA/Patient/patientId_authCode/Device/systemId/Observation?identifier=Observation.identifier.value</a><br>
will return the resource?</p>



<a name="153848231"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/153848231" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#153848231">(Sep 17 2016 at 21:45)</a>:</h4>
<p>I don't think so. The condition's purpose is to determine whether a matching resource already exists on the server, if yes -&gt; update, if no -&gt; create a new one. I don't think that the condition is supposed to have any effects beyond that. It's just a PRE-condition...<br>
I wonder: what's your use case?</p>



<a name="235302893"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/235302893" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonas Toft <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#235302893">(Apr 20 2021 at 07:52)</a>:</h4>
<p>I would like to do an update on a Task resource based on a criteria. From the docs I can see that the resource is created if there is no match on the criteria. <a href="https://www.hl7.org/fhir/http.html#cond-update">https://www.hl7.org/fhir/http.html#cond-update</a>. I want to do the update if the criteria is matched or not do the update at all. Any suggestions?</p>



<a name="235341385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/235341385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#235341385">(Apr 20 2021 at 13:15)</a>:</h4>
<p>In general, you wouldn't want to do an update without querying first - and if you do that, you'll know if it exists or not.</p>



<a name="235341404"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/235341404" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#235341404">(Apr 20 2021 at 13:15)</a>:</h4>
<p>What's your use-case for updating without querying?</p>



<a name="235466442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/235466442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cristi mihailescu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#235466442">(Apr 21 2021 at 07:23)</a>:</h4>
<p>Hi Llloyd,</p>
<p>This is the scenario the I and Jonas have:</p>
<ol>
<li>We're accessing the FHIR Repository from 2 clients</li>
<li>On client 1, we choose a PractitionerRole ( let's say it has the version "1" )</li>
<li>On client 2, we're updating the PractitionerRole data ( it goes to version "2" )</li>
<li>We're updating the Task's owner to the PractitionerRole that we've selected on step 2</li>
</ol>
<p>We are looking for a constraint ( as "conditional update", or by specifying a ifMatch etag inside a bundle transaction (?) ) that can fail the update of the Task if its owner PractitionerRole was changed meanwhile. Without doing an extra query, if possible.</p>



<a name="235541544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/235541544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#235541544">(Apr 21 2021 at 16:33)</a>:</h4>
<p>I don't understand why changing the PractitionerRole should impact updating the Task.  You could have the reference in the Task be version-specific, but if it was, the fact it had been subsequently updated wouldn't interfere with the ability to update a resource that references it.</p>



<a name="235616529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/235616529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cristi mihailescu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#235616529">(Apr 22 2021 at 04:00)</a>:</h4>
<p>We can mark, by a Boolean extension, that the PractitionerRole cannot be assigned to a Task. If this occurs while we are changing Task's owner, it should somehow fail / signal the client - at least this is our scenario.</p>



<a name="235740854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/235740854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#235740854">(Apr 22 2021 at 20:14)</a>:</h4>
<p>My leaning would be to handle that as business rule processing on the server side.  I.e. when you receive the request to update the Task, query at that point whether the Practitioner is 'available'.  Collision detection, as defined with in the FHIR spec, only works on the resource being changed, not on resources being referenced.</p>



<a name="235809534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/235809534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> cristi mihailescu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#235809534">(Apr 23 2021 at 09:07)</a>:</h4>
<p>Thank you for your reply, Lloyd. You've enforced our findings.</p>
<p>We're accessing the FHIR server directly, so a way to do collision detection for the referenced resource could be on the FHIR server, or on a middle layer .</p>



<a name="260703726"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/260703726" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#260703726">(Nov 08 2021 at 19:06)</a>:</h4>
<p>Hello all -- I think it makes sense that only the resource in question is updated conditionally. On the point, though, of "updating without querying" I think it's key to realize that conditional update solves a problem that querying beforehand cannot -- specifically, concurrent access to the resource. Querying first doesn't guarantee that the resource won't change before your next request to write something; conditional update does (or at least it should).</p>



<a name="260703958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/260703958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#260703958">(Nov 08 2021 at 19:08)</a>:</h4>
<p>Does anyone know who's working on the process of formalizing/adopting conditional update as part of the spec? <span class="user-mention" data-user-id="408229">@Daniel Tam</span>  and I are interested on behalf of One Medical Group</p>



<a name="261453109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/261453109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#261453109">(Nov 15 2021 at 03:17)</a>:</h4>
<p>Actually, what most systems that support <code>update</code> do is leverage the <code>If-Match</code> header, as described <a href="https://hl7.org/fhir/R4/http.html#concurrency">here</a>.  That's distinct from conditional updates.</p>



<a name="263920368"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/263920368" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#263920368">(Dec 06 2021 at 20:30)</a>:</h4>
<p>If-Match seems good if you know the ID of an existing the resource, but there are cases where you don't and still want to avoid inserting a logical duplicate</p>



<a name="263920584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/263920584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#263920584">(Dec 06 2021 at 20:32)</a>:</h4>
<p>Could this be satisfied by a conditional update using <code>If-Match: *</code>, if we expanded the functionality of If-Match to support that?</p>



<a name="263926750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/263926750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#263926750">(Dec 06 2021 at 21:25)</a>:</h4>
<p>not sure exactly what <code>If-Match *</code> would be, but basically what's required is "don't insert this if anything matches specified search"</p>



<a name="263926822"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/263926822" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#263926822">(Dec 06 2021 at 21:25)</a>:</h4>
<p>where converting to and update of the found matching resource is OK</p>



<a name="263927171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/263927171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#263927171">(Dec 06 2021 at 21:29)</a>:</h4>
<p>otherwise you're limited to resolving conditions where you know the singular ID of the resource, not logical duplicates that happen to have different IDs you're trying to reconcile ... admittedly this is an border case</p>



<a name="263927247"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/263927247" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#263927247">(Dec 06 2021 at 21:29)</a>:</h4>
<p>however it's something that has come up for us</p>



<a name="263953880"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/263953880" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#263953880">(Dec 07 2021 at 03:14)</a>:</h4>
<p>I'm not really following.  You shouldn't be performing an update unless you've previously queried from that system - which means you'll know both the id and the version.</p>



<a name="264778890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/264778890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#264778890">(Dec 13 2021 at 22:17)</a>:</h4>
<p>What if what I am trying to verify is that nothing matching a search exists</p>



<a name="264778904"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/264778904" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#264778904">(Dec 13 2021 at 22:18)</a>:</h4>
<p>that's the thing</p>



<a name="264779037"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/264779037" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Smith <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#264779037">(Dec 13 2021 at 22:19)</a>:</h4>
<p>I think that is basically the key differentiator / motivation for conditional update</p>



<a name="264783834"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/conditional%20updates/near/264783834" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/conditional.20updates.html#264783834">(Dec 13 2021 at 23:07)</a>:</h4>
<p>Ok.  So you have a copy of the current version of the existing record, and you'll check that the record being updated hasn't changed.  However, you're <em>also</em> wanting to ensure that some other query returns no results before the update proceeds?  If that's correct, can you provide an example of the sort of situation where you'd want to do that?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
