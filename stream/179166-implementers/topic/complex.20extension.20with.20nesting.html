---
layout: page
title: "FHIR Chat  · complex extension with nesting · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html">complex extension with nesting</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153986566"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986566" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sylvia Freeman <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986566">(Aug 14 2018 at 22:13)</a>:</h4>
<p>I am using Forge 18.2 for HL7 FHIR DSTU2 and was wondering how I can create a complex extension that has an int element with 1:* cardinality that will define a care plan cycle, then another int element nested under this care plan cycle element with 1:* cardinality to represent which day of the cycle.  It would be similar to this existing extension (<a href="https://simplifier.net/nccnchemotherapyorde/daysofcycle" target="_blank" title="https://simplifier.net/nccnchemotherapyorde/daysofcycle">https://simplifier.net/nccnchemotherapyorde/daysofcycle</a>) but would allow the definition of the cycle that the day(s) are on such as this: </p>
<ul>
<li>Cycle: 1<ul>
<li>Day: 1</li>
<li>Day: 2</li>
<li>Day: 3</li>
</ul>
</li>
<li>Cycle 2<ul>
<li>Day: 1</li>
</ul>
</li>
</ul>



<a name="153986638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986638">(Aug 15 2018 at 01:15)</a>:</h4>
<p>I was about to ask a similar question!<br>
Mine is about complex extensions that contain complex extensions, and whether or not they can be defined  in a single structure definition.  E.g., <br>
Extension.extension:foo.extension:bar.valueString<br>
Extension.extension:foo.extension:baz.valueBoolean</p>



<a name="153986640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986640">(Aug 15 2018 at 01:28)</a>:</h4>
<p>There are examples of complex extension definitions here: <a href="http://build.fhir.org/extensibility-registry.html" target="_blank" title="http://build.fhir.org/extensibility-registry.html">http://build.fhir.org/extensibility-registry.html</a> (just look for 'complex')</p>



<a name="153986661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986661">(Aug 15 2018 at 02:17)</a>:</h4>
<p>none of those examples have nested complex extensions - I can't find any examples like that, but I also can't find anything that seems to forbid it.  I see a requirement that Extensions that are not children of other extensions must have absolute urls, which would seem to rule out defining extensions as slices on resources (e.g., Observation.extension:internalextension.valueString) since there would be no top-level StructureDefinition url for that extension to refer to, but I'm not sure about nested complex extensions in an Extension profile</p>



<a name="153986662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986662">(Aug 15 2018 at 02:19)</a>:</h4>
<p>(one could imagine a single StructureDefinition that describes an arbitrarily complex extension)</p>



<a name="153986663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986663">(Aug 15 2018 at 02:19)</a>:</h4>
<p>You're wanting a 3-level extension?  That's still fine</p>



<a name="153986664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986664">(Aug 15 2018 at 02:19)</a>:</h4>
<p>(but you're right, we don't have any examples of anything that deep)</p>



<a name="153986665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986665">(Aug 15 2018 at 02:22)</a>:</h4>
<blockquote>
<p>which would seem to rule out defining extensions as slices on resources</p>
</blockquote>
<p>I didn't understand that and the following narrative muddied the water further...</p>



<a name="153986667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986667">(Aug 15 2018 at 02:30)</a>:</h4>
<p>haha fair enough - basically, in a complex extension, we see that we can use slices to define fields on extensions of extension (e.g., for Patient ClinicalTrial extension, specify that Extension.extension:nct.url is fixed at NCT, and it is restricted to being a string by specifying Extension.extension:nct.valueString)</p>



<a name="153986668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986668">(Aug 15 2018 at 02:32)</a>:</h4>
<p>so there I was talking about doing that on resources directly.  So in a profile on Observation, for example, specifying Observation.extension:foo.url = Foo, and Observation.extension:foo.valueBoolean instead of value[x]</p>



<a name="153986669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986669">(Aug 15 2018 at 02:32)</a>:</h4>
<p>which I believe is not valid, because spec requires extensions that are not children of extensions to have urls to full structure definitions</p>



<a name="153986670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986670">(Aug 15 2018 at 02:34)</a>:</h4>
<p>however I was unclear if it was valid to have complex extensions within complex extensions, which Lloyd says I can</p>



<a name="153986672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986672">(Aug 15 2018 at 02:45)</a>:</h4>
<p>I think that the answer is: no, you cannot define extensions in line, they need a separate definition</p>



<a name="153986673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986673">(Aug 15 2018 at 02:45)</a>:</h4>
<p>but you can nest in the definition as far as you want.</p>



<a name="153986674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986674">(Aug 15 2018 at 02:45)</a>:</h4>
<p>cool, that was my interpretation as well.  Thanks!</p>



<a name="153986675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986675">(Aug 15 2018 at 02:59)</a>:</h4>
<p>One more complex extension question while I have you: looking at <a href="http://hl7.org/fhir/extension-patient-clinicaltrial.json.html" target="_blank" title="http://hl7.org/fhir/extension-patient-clinicaltrial.json.html">http://hl7.org/fhir/extension-patient-clinicaltrial.json.html</a> , there's nothing I see, either in snapshot or differential, that constrains Extension.extension (unsliced).  So is it correct to conclude that, in addition to  extensions with the urls described in slices, you can have any other extensions as well on that?</p>



<a name="153986676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986676">(Aug 15 2018 at 03:02)</a>:</h4>
<p>I guess that's what's implied by the slice rules "open" <a href="http://hl7.org/fhir/codesystem-resource-slicing-rules.html" target="_blank" title="http://hl7.org/fhir/codesystem-resource-slicing-rules.html">http://hl7.org/fhir/codesystem-resource-slicing-rules.html</a></p>



<a name="153986677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986677">(Aug 15 2018 at 03:02)</a>:</h4>
<p>Any extensions that aren't defined in the structure definition whose URL you're using will have to be expressed with a full url rather than a local URL, but yes it's possible to have other extensions - whether generic ones like data-absent-reason that can show up anywhere or extensions specifically created to extend your extension.</p>



<a name="153986678"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986678" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986678">(Aug 15 2018 at 03:02)</a>:</h4>
<p>gotcha.  makes sense, thanks!</p>



<a name="153986943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/complex%20extension%20with%20nesting/near/153986943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sylvia Freeman <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/complex.20extension.20with.20nesting.html#153986943">(Aug 15 2018 at 15:08)</a>:</h4>
<p>Thank you all!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
