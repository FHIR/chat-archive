---
layout: page
title: "FHIR Chat  · &quot;distinct&quot; search · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html">&quot;distinct&quot; search</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="174249101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174249101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174249101">(Aug 27 2019 at 17:08)</a>:</h4>
<p>We're seeing the need to do a kind of search for distinct field values.  For example:</p>
<p>1) The distinct observation codes (whose display text matches some string)<br>
2) The distinct observation categories<br>
3) The distinct observation effectiveDateTime values</p>
<p>The functionality would be similar to the "distinct" keyword in SQL, and ideally the solution would be general purpose and apply to any resource and (nearly?) any field.</p>
<p>It would also be nice if the solution could fit into the current search infrastructure, so that the distinct values returned could be further constrained b(e.g. observation codes for a particular patient, or effectiveDateTime values in 2019) using other search parameters.</p>



<a name="174250984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174250984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174250984">(Aug 27 2019 at 17:30)</a>:</h4>
<p>What would a search for distinct observation codes return? Only the first observation that has a matching code?</p>



<a name="174251359"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174251359" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174251359">(Aug 27 2019 at 17:34)</a>:</h4>
<p>like lastN where n = 1? <a href="http://hl7.org/fhir/r4/observation.html#lastn" target="_blank" title="http://hl7.org/fhir/r4/observation.html#lastn">http://hl7.org/fhir/r4/observation.html#lastn</a></p>



<a name="174256157"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174256157" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174256157">(Aug 27 2019 at 18:30)</a>:</h4>
<p>You'd end up with numerous Observations, but only one with a given code.  Most recent vs. not wouldn't much matter.</p>



<a name="174264223"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174264223" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174264223">(Aug 27 2019 at 19:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span> I am not sure what the return format should be.  I think that in order to fit in with the existing search framework, it would makes sense to return a bundle of matching Observations, selected as you stated.  It gets a little messy due to the fact each Observation can have multiple codes.  Depending on how that was handled, I might have to post-process to get the list of unique codes.</p>
<p><span class="user-mention" data-user-id="191356">@Jenni Syed</span> lastN requires that a patient be specified, plus either a code or a category.  My use case for getting distinct observation codes is across patients and categories.  I am hoping, though, that a solution can be found for the more general case of getting the distinct values for any searchable field in a resource and using search-like capabilities of matching on substrings, and maybe other search parameters.</p>



<a name="174264397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174264397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174264397">(Aug 27 2019 at 19:49)</a>:</h4>
<p>What is the use case for that? IE: needing the most recent heart rate across the entire system?</p>



<a name="174267392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174267392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174267392">(Aug 27 2019 at 20:19)</a>:</h4>
<p>We have an "<a href="https://lhcforms.nlm.nih.gov/fhir/obs-viewer.html" target="_blank" title="https://lhcforms.nlm.nih.gov/fhir/obs-viewer.html">Observation viewer</a>" tool (still a work in progress); the idea is mainly to provide an overview or sample of what is in the Observation "table", for selected codes (and eventually some other parameters).  The use case for the distinct code search would be for the lookup that selects the codes of the Observations that will be retrieved.  Currently, this lookup is hitting the full LOINC code list, but we want it to be searching the list of codes actually used.</p>



<a name="174309095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174309095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174309095">(Aug 27 2019 at 20:44)</a>:</h4>
<p>Sounds like an operation more than a search</p>



<a name="174311314"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174311314" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174311314">(Aug 27 2019 at 21:11)</a>:</h4>
<p>The drawback of not putting it in search is that you lose access to (or have to reinvent) all the other search parameters.</p>



<a name="174314032"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174314032" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174314032">(Aug 27 2019 at 22:05)</a>:</h4>
<p>that's not necessarily true. Not if you specify the operation type as a search</p>



<a name="174316478"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174316478" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174316478">(Aug 27 2019 at 22:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I was just looking at OperationDefinition to see where one might do that, but OperationDefinition.type is a boolean that means something else.  Where would one specify that the operation is of type "search"?</p>



<a name="174317084"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174317084" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174317084">(Aug 27 2019 at 22:56)</a>:</h4>
<p>OperationDefinition.kind</p>



<a name="174368471"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174368471" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174368471">(Aug 28 2019 at 14:37)</a>:</h4>
<p>Thanks.  For kind="query", I see that <a href="https://www.hl7.org/fhir/operationdefinition.html#equeries" target="_blank" title="https://www.hl7.org/fhir/operationdefinition.html#equeries">it says</a>, "Named queries always return a bundle containing a set of resources, so all the out parameters must be resources", but that is okay with me.  I would extract the fields that were requested as distinct and ignore the rest of the resource.</p>



<a name="174386598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174386598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174386598">(Aug 28 2019 at 17:58)</a>:</h4>
<p>Do 'search' operations automatically support regular search parameters?  E.g. if I have a 'query' operation on Observation, can I automatically include the patient, code and similar parameters.</p>



<a name="174393950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174393950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174393950">(Aug 28 2019 at 19:29)</a>:</h4>
<p>that's the implication, yes</p>



<a name="174487848"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174487848" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174487848">(Aug 29 2019 at 20:08)</a>:</h4>
<p>Here is a draft of an OperationDefinition (the first I've ever tried to write) for the "$distinct" operation I'm proposing.  It would be great to hear from people implementing FHIR servers about the feasibility of adding this.  We gave some thought to how it might be handled in ElasticSearch, and it seemed possible to us.</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;OperationDefinition&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;distinct&quot;</span><span class="p">,</span>
  <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;distinct&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span>  <span class="s2">&quot;Conducts a search in which the returned resources are constrained to be unique based on the content of the fields specified in &#39;distinctField&#39;.&quot;</span>
  <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="kc">false</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;query&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parameter&quot;</span><span class="p">:</span> <span class="p">[{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;distinctField&quot;</span><span class="p">,</span>
    <span class="nt">&quot;documentation&quot;</span><span class="p">:</span> <span class="s2">&quot;One or more search parameter names whose values will be used to constrain the results of the search.  The combination of the values of the specified fields will be unique in each of the returned resources.&quot;</span>
    <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;max&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;return&quot;</span><span class="p">,</span>
    <span class="nt">&quot;documentation&quot;</span><span class="p">:</span> <span class="s2">&quot;The set of resources that are distinct relative to the fields defined by &#39;distinctField&#39;.&quot;</span>
    <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bundle&quot;</span><span class="p">,</span>
    <span class="nt">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;max&quot;</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">}]</span>
<span class="p">}</span>
</pre></div>



<a name="174492789"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174492789" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174492789">(Aug 29 2019 at 21:07)</a>:</h4>
<p>I don't understand this. if I have more than one match, which one to return? distinct applies to primitives</p>



<a name="174494021"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174494021" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174494021">(Aug 29 2019 at 21:23)</a>:</h4>
<p>This sounds like a problem I would solve using sql-on-fhir.</p>



<a name="174496659"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174496659" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174496659">(Aug 29 2019 at 22:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> The intent is that if there more more than one match per combination of field values, you just pick one of the resources.  The goal is to get the distinct field values (or dinstinct combinations if more than one distinctField is provided).  The rest of the resource is not really of interest in most cases.</p>



<a name="174497575"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174497575" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174497575">(Aug 29 2019 at 22:20)</a>:</h4>
<p>For simplicity, I am extending the concept of distinctness to non-primitive types.  There is a question of whether [1 ,2 ,3] is distinct from [1, 3, 2], but I think it would be simplest to treat them as distinct.</p>



<a name="174497724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174497724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174497724">(Aug 29 2019 at 22:22)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> Is the intent of sql-on-fhir that a FHIR server would provide an API for submitting SQL queries?  I am writing SMART on FHIR client, so the thing I have access to is a FHIR server.</p>



<a name="174497971"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174497971" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174497971">(Aug 29 2019 at 22:27)</a>:</h4>
<p>Details vary. Some servers might provide an API for submitting SQL queries, others might copy the data out to a separate SQL database.</p>
<p>I bring this up because getting widespread adoption of a special-purpose operation might be a much longer process than using more general functionality.</p>



<a name="174498336"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174498336" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174498336">(Aug 29 2019 at 22:33)</a>:</h4>
<p>I was actually going for a general-purpose operation.  But, you are right that full SQL is even more flexible and general.  I  suppose the SQL submission could itself be a FHIR operation.</p>
<p>I think there is a trade off at some point between making things more general purpose and making it more complicated to implement.  Has there been activity toward implementing sql-on-fhir in FHIR servers?</p>



<a name="174501609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174501609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174501609">(Aug 29 2019 at 23:24)</a>:</h4>
<p>Not through a FHIR API. The analytics on FHIR track is really active but in my experience it's clients talking directly to SQL databases. Lots of people in this channel can correct me if I'm wrong though ;-)</p>



<a name="174501706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/174501706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#174501706">(Aug 29 2019 at 23:26)</a>:</h4>
<p>I do think you've moved in analytics, not really search anymore</p>



<a name="175439437"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175439437" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175439437">(Sep 11 2019 at 14:49)</a>:</h4>
<p>Here is a non-search version of an OperationDefinition for the "distinct" operation, which is now constrained to work on Coding or CodeableConcept fields (search fields of type token), but will hopefully seem less weird.  Examples of usage:</p>
<ul>
<li>Observation/$distinctCodings?codingField=category  (distinct category codings)</li>
<li>Observation/$distinctCodings?codingField=code&amp;patient=zero (distinct code codings for patient id “zero”)</li>
<li>MedicationStatement/$distinctCodings?codingField=code&amp;patient=zero (distinct medications taken by patient id “zero”)</li>
</ul>
<div class="codehilite"><pre><span></span>{
  &quot;resourceType&quot;: &quot;OperationDefinition&quot;,
  &quot;name&quot;: &quot;distinctCodings&quot;,
  &quot;code&quot;: &quot;distinctCodings&quot;,
  &quot;descripton&quot;:  &quot;Returns the distinct codings for a search parameter of type token in the specified resource type&quot;,
  &quot;system&quot;: false,
  &quot;type&quot;: true,
  &quot;instance&quot;: false,
  &quot;kind&quot;: &quot;operation&quot;,
  &quot;status&quot;: &quot;draft&quot;,
  &quot;parameter&quot;: [{
    &quot;name&quot;: &quot;codingField&quot;,
    &quot;documentation&quot;: &quot;The name of a search parameter of type token (searching Coding or CodeableConcept)&quot;,
    &quot;use&quot;: &quot;in&quot;,
    &quot;type&quot;: &quot;string&quot;,
    &quot;min&quot;: 1,
    &quot;max&quot;: &quot;*&quot;
  },{
    &quot;name&quot;: &quot;patient&quot;,
    &quot;documentation&quot;: &quot;An optional Patient ID, for use with resources which have an associated patient.  If present the returned Codings will be drawn only from the resource instances associated with the patient.&quot;,
    &quot;use&quot;: &quot;in&quot;,
    &quot;type&quot;: &quot;string&quot;,
    &quot;min&quot;: 0,
    &quot;max&quot;: 1
  },
  {
    &quot;name&quot;: &quot;return&quot;,
    &quot;documentation&quot;: &quot;The set of Codings for field &#39;codingField&#39; that are distinct across instances of the resource, or if &#39;patient&#39; was specified, within the patient&#39;s resource instances&quot;,
    &quot;use&quot;: &quot;out&quot;,
    &quot;type&quot;: &quot;Coding&quot;,
    &quot;min&quot;: 0,
    &quot;max&quot;: &quot;*&quot;
  }]
}
</pre></div>



<a name="175569485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175569485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175569485">(Sep 12 2019 at 20:44)</a>:</h4>
<p>I just realized I missed a parameter value needed for autocompletion on the codes's display strings.  So, the examples would be:</p>
<p>Observation/$distinctCodings?codingField=category&amp;codetext=bact (distinct category codings with a display word starting with "bact")<br>
Observation/$distinctCodings?codingField=code&amp;patient=zero (distinct code codings for patient id “zero”)<br>
MedicationStatement/$distinctCodings?codingField=code&amp;patient=zero (distinct medications taken by </p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;OperationDefinition&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;distinctCodings&quot;</span><span class="p">,</span>
  <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;distinctCodings&quot;</span><span class="p">,</span>
  <span class="nt">&quot;descripton&quot;</span><span class="p">:</span>  <span class="s2">&quot;Returns the distinct codings for a search parameter of type token in the specified resource type where the text of a code matches the codetext parameter.&quot;</span><span class="p">,</span>
  <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;instance&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
  <span class="nt">&quot;parameter&quot;</span><span class="p">:</span> <span class="p">[{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;codingField&quot;</span><span class="p">,</span>
    <span class="nt">&quot;documentation&quot;</span><span class="p">:</span> <span class="s2">&quot;The name of a search parameter of type token (searching Coding or CodeableConcept)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;min&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;max&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
  <span class="p">},{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;patient&quot;</span><span class="p">,</span>
    <span class="nt">&quot;documentation&quot;</span><span class="p">:</span> <span class="s2">&quot;An optional Patient ID, for use with resources which have an associated patient.  If present the returned Codings will be drawn only from the resource instances associated with the patient.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;max&quot;</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;codetext&quot;</span><span class="p">,</span>
    <span class="nt">&quot;documentation&quot;</span><span class="p">:</span> <span class="s2">&quot;This field works just like code:text in regular search.  It limits the returned results to Codings whose display text contains a word that starts with the parameter value.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="nt">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;max&quot;</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;return&quot;</span><span class="p">,</span>
    <span class="nt">&quot;documentation&quot;</span><span class="p">:</span> <span class="s2">&quot;The set of Codings for field &#39;codingField&#39; that are distinct across instances of the resource, or if &#39;patient&#39; was specified, within the patient&#39;s resource instances&quot;</span><span class="p">,</span>
    <span class="nt">&quot;use&quot;</span><span class="p">:</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Coding&quot;</span><span class="p">,</span>
    <span class="nt">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;max&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
  <span class="p">}]</span>
<span class="p">}</span>
</pre></div>



<a name="175569593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175569593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175569593">(Sep 12 2019 at 20:45)</a>:</h4>
<p>It would be really helpful to get feedback (especially from server implementers) as to whether this would be reasonable to implement.</p>



<a name="175570882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175570882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175570882">(Sep 12 2019 at 20:59)</a>:</h4>
<p>It would be way down the list for us - no use cases, plenty of features that are already standard that we'd like to implement first</p>



<a name="175572640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175572640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175572640">(Sep 12 2019 at 21:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span> "no use cases"?  I would not be proposing this if I didn't have one.</p>



<a name="175572965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175572965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175572965">(Sep 12 2019 at 21:25)</a>:</h4>
<p>Sorry - I mean no use cases from our customers</p>



<a name="175576224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175576224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175576224">(Sep 12 2019 at 22:14)</a>:</h4>
<p>Ah-- that makes more sense.</p>



<a name="175761853"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175761853" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175761853">(Sep 15 2019 at 19:10)</a>:</h4>
<p>Another useful thing would be to get the list of unique tags on resource, e.g.:</p>
<p>Observation/$distinctCodings?codingField=_tag</p>



<a name="175766962"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175766962" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175766962">(Sep 15 2019 at 21:29)</a>:</h4>
<p>You can actually do this today specifically for tags, profiles, and security labels via the $meta operation:</p>
<p><a href="http://hapi.fhir.org/baseDstu3/Patient/$meta" target="_blank" title="http://hapi.fhir.org/baseDstu3/Patient/$meta">http://hapi.fhir.org/baseDstu3/Patient/$meta</a></p>



<a name="175791585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175791585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175791585">(Sep 16 2019 at 08:07)</a>:</h4>
<p>You can do it with SQL on FHIR :)</p>



<a name="175791679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175791679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175791679">(Sep 16 2019 at 08:08)</a>:</h4>
<p>In aidbox it would be <code>select distinct(resource-&gt;'code') from observation</code></p>



<a name="175796648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175796648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175796648">(Sep 16 2019 at 09:27)</a>:</h4>
<p>if this devolves to just the codes themselves... we're actually talking about a value set now. And then the value set machinery has everything we need.</p>



<a name="175817593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175817593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> vania manzelli <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175817593">(Sep 16 2019 at 14:33)</a>:</h4>
<p>I'm not sure value sets machinery will help. As far as I understood he is going to implement a kind of synoptic time based patient's vitals dashboard (just like ICU vitals' monitor) and he needs the distinct list of vitals  available for a specific patient. So if you don't go through SQL on FHIR, probably the best option is to define a custom operation. With a "search" the result should be a real resource(s) , with specific id while in this use case the result(s) of a distinct would be an aggregate temp resource  which should not have references to any specific "real" resource.</p>



<a name="175819758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175819758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175819758">(Sep 16 2019 at 14:55)</a>:</h4>
<p>Paul and I actually had a chat about this on Saturday at the connectathon and one of the things we came up with was the notion of some sort of implicit value set that is dynamically maintained as "all of the codes that are used by Observation.code for a given patient", where an expansion parameter might be the patient ID. That felt like an abuse of valuesets, but also seems elegant in a way..</p>
<p>We also talked about whether this is a special case of the <code>$lastn</code> operation, which I still think it might be</p>



<a name="175827023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175827023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175827023">(Sep 16 2019 at 16:11)</a>:</h4>
<p>we already have this in place</p>



<a name="175848796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175848796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175848796">(Sep 16 2019 at 20:23)</a>:</h4>
<p>We have lastn.  But we don't really want the full resources back, just the codes.</p>



<a name="175859860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175859860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175859860">(Sep 16 2019 at 22:45)</a>:</h4>
<p>I don’t see how it’s a lastn that is unless we make it a Swiss army night and add a codes only parameter and distinct. (Set of codes) parameter</p>



<a name="175859871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175859871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175859871">(Sep 16 2019 at 22:45)</a>:</h4>
<p>Knife not night</p>



<a name="175861595"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175861595" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175861595">(Sep 16 2019 at 23:11)</a>:</h4>
<blockquote>
<p>we already have this in place</p>
</blockquote>
<p>The dynamic implicit valueset? or the special case of lastn?</p>



<a name="175862005"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175862005" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175862005">(Sep 16 2019 at 23:20)</a>:</h4>
<p>get url/ValueSet/$expand?context=Observation.code&amp;contextMode=outgoing</p>



<a name="175862062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175862062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175862062">(Sep 16 2019 at 23:20)</a>:</h4>
<p>that query is what Paul is looking for</p>



<a name="175862777"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175862777" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175862777">(Sep 16 2019 at 23:34)</a>:</h4>
<p>i believe Paul's after a patient specific collection of codes though... (Paul, correct me if I'm wrong here of course)</p>



<a name="175862831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175862831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175862831">(Sep 16 2019 at 23:36)</a>:</h4>
<p>yes, the ones used in Observation.code.</p>



<a name="175862886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/175862886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#175862886">(Sep 16 2019 at 23:36)</a>:</h4>
<p>that's what that query is - the codes the system is capable of returning resources for</p>



<a name="176032530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176032530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176032530">(Sep 18 2019 at 18:34)</a>:</h4>
<blockquote>
<p>that's what that query is - the codes the system is capable of returning resources for</p>
</blockquote>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  I'm not sure whether you mean "the codes the system might theoretically return if there were Observations so coded" or "the codes used by Observations that actually exist in the system".   It seems to be the former, but what I need is the latter.</p>
<p><a href="http://test.fhir.org/r4/ValueSet/$expand?context=Observation.code&amp;contextMode=outgoing&amp;count=5&amp;filter=we" target="_blank" title="http://test.fhir.org/r4/ValueSet/$expand?context=Observation.code&amp;contextMode=outgoing&amp;count=5&amp;filter=we">http://test.fhir.org/r4/ValueSet/$expand?context=Observation.code&amp;contextMode=outgoing&amp;count=5&amp;filter=we</a></p>
<p>returns LOINC code 71210-9, but:</p>
<p><a href="http://test.fhir.org/r4/Observation?code=71210-9" target="_blank" title="http://test.fhir.org/r4/Observation?code=71210-9">http://test.fhir.org/r4/Observation?code=71210-9</a></p>
<p>has no results.</p>



<a name="176041645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176041645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176041645">(Sep 18 2019 at 20:12)</a>:</h4>
<p>well, that's a good point. we could add a new contextMode of "existing". I could support that</p>



<a name="176042589"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176042589" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176042589">(Sep 18 2019 at 20:23)</a>:</h4>
<p>Would this work with context=Observation.category and context=Observation.meta.tag?</p>



<a name="176042631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176042631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176042631">(Sep 18 2019 at 20:23)</a>:</h4>
<p>in principle yes. I can make it work</p>



<a name="176043041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176043041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176043041">(Sep 18 2019 at 20:26)</a>:</h4>
<p>Those are the three cases I have currently.  Would the "existing" contextMode be limited to work for exactly those three cases, or if not what would be the permitted values of "context"?</p>



<a name="176043101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176043101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176043101">(Sep 18 2019 at 20:27)</a>:</h4>
<p>context can be any element id - which is a big set that includes the 3 you've named.</p>



<a name="176043121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176043121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176043121">(Sep 18 2019 at 20:28)</a>:</h4>
<p>up to systems which ones that they support</p>



<a name="176043380"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176043380" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176043380">(Sep 18 2019 at 20:30)</a>:</h4>
<blockquote>
<p>up to systems which ones that they support</p>
</blockquote>
<p>Well, I think that was the case with the operation I proposing, so no loss there, I guess.</p>



<a name="176045224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176045224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176045224">(Sep 18 2019 at 20:51)</a>:</h4>
<p>So, that sounds like a solution to me.  <span class="user-mention" data-user-id="191319">@James Agnew</span> ?</p>



<a name="176113394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176113394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176113394">(Sep 19 2019 at 15:53)</a>:</h4>
<p>I think I misunderstood your need- I thought it was about finding these lists <em>for a specific patient</em>. So yeah, this certainly does sound like it's the API you're after. :)</p>
<p>This could be implemented in a horribly inefficient way very easily in HAPI FHIR by doing a group-by count search on the index tables. I don't know that I love the idea of doing that though.</p>
<p>I'll chat with Ian about whether this could be layered into ElasticSearch in a more performant way. I assume it could be.</p>



<a name="176147340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176147340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176147340">(Sep 19 2019 at 22:18)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Should I submit a tracker item yet?  Which group would be the "reviewing working group"?</p>



<a name="176149334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176149334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176149334">(Sep 19 2019 at 22:50)</a>:</h4>
<p>Reasonable to submit a tracker.  Owner would be FHIR-I</p>



<a name="176149818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176149818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176149818">(Sep 19 2019 at 22:59)</a>:</h4>
<p>actually, it would be vocab; they own that operation</p>



<a name="176204370"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176204370" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176204370">(Sep 20 2019 at 15:47)</a>:</h4>
<p>It looks like "contextMode" might have been changed to "contextDirection".  At least, what I find at <a href="https://www.hl7.org/fhir/valueset-operation-expand.html" target="_blank" title="https://www.hl7.org/fhir/valueset-operation-expand.html">https://www.hl7.org/fhir/valueset-operation-expand.html</a> is contextDirection, which is what has "incoming" and "going".</p>



<a name="176204679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176204679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176204679">(Sep 20 2019 at 15:50)</a>:</h4>
<p>oh right. my mistake.</p>



<a name="176204686"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176204686" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176204686">(Sep 20 2019 at 15:50)</a>:</h4>
<p>we'll have to talk about that</p>



<a name="176227926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/176227926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#176227926">(Sep 20 2019 at 20:30)</a>:</h4>
<p><a href="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=24834" target="_blank" title="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=24834">GF#24834</a></p>



<a name="271494419"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271494419" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271494419">(Feb 10 2022 at 21:07)</a>:</h4>
<p>After some rounds of discussion in the Vocabulary work group on this idea of getting a distinct list of Codings stored in fields like Observation.code or category, <span class="user-mention" data-user-id="191405">@Rob Hausam</span> suggested an alternative idea using implicit ValueSets.  The idea is that if you wanted to get a list of distinct Codings stored on a FHIR server in (say) Observation.category, you would pass in to the $expand operation's url parameter an implicit ValueSet URI like:</p>
<div class="codehilite"><pre><span></span><code>[base]/Observation/category?fhir_vs
</code></pre></div>
<p>The format of that is similar to what described for the <a href="http://build.fhir.org/snomedct.html#implicit">SNOMED implicit ValueSets</a>.<br>
A example of a full query, with a filter parameter for looking for matches in display text (and with ? encoded), would be:</p>
<div class="codehilite"><pre><span></span><code>[base]/ValueSet/$expand?url=[base]/Observation/category%3Ffhir_vs&amp;filter=height
</code></pre></div>
<p>Support for such implicit ValueSets would be optional.</p>



<a name="271515131"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271515131" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271515131">(Feb 11 2022 at 00:29)</a>:</h4>
<p>hmm we have something slightly similar to that already</p>



<a name="271515204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271515204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271515204">(Feb 11 2022 at 00:30)</a>:</h4>
<p>which is context</p>



<a name="271515212"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271515212" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271515212">(Feb 11 2022 at 00:30)</a>:</h4>
<p>see <a href="http://hl7.org/fhir/valueset-operation-expand.html">http://hl7.org/fhir/valueset-operation-expand.html</a></p>



<a name="271571955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271571955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Hausam <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271571955">(Feb 11 2022 at 12:59)</a>:</h4>
<p>Yes.  Maybe using a syntax similar to the one suggested for the $expand 'context' parameter would be a good idea.  That might then be something like:</p>
<div class="codehilite"><pre><span></span><code>[base]/http://hl7.org/fhir/StructureDefinition/Observation#Observation.category?fhir_vs
</code></pre></div>
<p>That is definitely more verbose.  And it would be the way to do it if you needed to specify a particular profile rather than the base resource.  You need to do that for 'context', but I'm not sure that would be needed for this implicit value set?  If not, then probably it could just be:</p>
<div class="codehilite"><pre><span></span><code>[base]/Observation.category?fhir_vs
</code></pre></div>
<p>I originally thought that using the '.' in the url might need to be avoided, but I'm not sure why - doing it as <code>Observation.category</code> now seems probably better to me.</p>



<a name="271638762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271638762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig McClendon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271638762">(Feb 11 2022 at 21:22)</a>:</h4>
<p>Does changing the syntax to an $expand operation change the complexity of the problem? </p>
<p>At the end of the day, you want the server to execute the equivalent of a SQL  DISTINCT or GROUP BY query to give you a list of unique values that exist for an attribute in the server. <br>
In pseudo-fhir-sql, you essentially want the server to execute something like: <br>
<em>SELECT code FROM Observation GROUP BY code</em><br>
or<br>
<em>SELECT code FROM Observation where subject = 'Patient/123' GROUP BY code</em><br>
or<br>
<em>SELECT code FROM Observation where code like '945%' and subject = 'Patient/123' GROUP BY code</em></p>
<p>The complexity comes in (in my mind) because FHIR search parameters can be multi-part (token), composite, can refer to multiple FHIR-path elements, etc. So implementing it generically using the existing search parameters would be tricky, depending on the underlying indexing model.</p>
<p>Does the $expand idea change any of this complexity?</p>
<p><em>Edit to add: Most FHIR servers don't index the data in a way that would be amenable to the queries above. They were just to illustrate the functional intent. It would be much more complex against most indexing schemes.</em></p>



<a name="271735160"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271735160" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271735160">(Feb 13 2022 at 08:36)</a>:</h4>
<p>I thought that the context parameter was just to let that provide the details of which valueset (from the binding) and not from the data that exists/used in the property</p>



<a name="271847564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271847564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271847564">(Feb 14 2022 at 16:03)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> That is correct.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  proposed (<a href="#narrow/stream/179166-implementers/topic/.22distinct.22.20search/near/176041645">earlier</a> in this thread, back in 2019) adding a new mode of "existing" to contextDirection, and that was proposed to the Vocabulary work group, which seems to prefer <a href="#narrow/stream/179166-implementers/topic/.22distinct.22.20search/near/271494419">this new idea</a> of using implicit ValueSets instead.</p>
<p><span class="user-mention" data-user-id="193261">@Craig McClendon</span> I don't think the complexity of the server side query should affected by the syntax of the $expand parameters.</p>



<a name="271853512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271853512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig McClendon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271853512">(Feb 14 2022 at 16:44)</a>:</h4>
<p>Using an $expand variant could simplify implementation if it limited the use of the operation to only Coding attributes I suppose. If the intent is that it could apply to other attributes (<a href="http://HumanName.family">HumanName.family</a> or CodeableConcept.text, e.g.) I think a 'distinct' keyword/operation is more intuitive.</p>



<a name="271854337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%22distinct%22%20search/near/271854337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.22distinct.22.20search.html#271854337">(Feb 14 2022 at 16:50)</a>:</h4>
<p>The implicit ValueSets would just be for Codings (in CodeableConcept or otherwise).</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
