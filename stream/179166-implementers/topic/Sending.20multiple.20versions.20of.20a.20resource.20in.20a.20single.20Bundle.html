---
layout: page
title: "FHIR Chat  · Sending multiple versions of a resource in a single Bundle · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html">Sending multiple versions of a resource in a single Bundle</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="159071973"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159071973" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159071973">(Feb 21 2019 at 14:36)</a>:</h4>
<p>I'm looking at the following use case:</p>
<p>A source system with FHIR RESTful API shall export all data of a given scope (at the maximum: all resource instances it contains - ignore file sizes and splitting of data for the moment), including all prior versions of all instances. That, obviously, could easily be achieved using the history interaction.</p>
<p>Now I want to push all data I received from the source to a destination system, using the FHIR RESTful API as well.<br>
My idea would be to transform the history Bundle I received to a transaction Bundle and throw it at the destination.<br>
Nevertheless, there are references in the source data (say: a Condition instance references a Patient instance), so the destination needs to keep track of the original ids during import. So the "Update as create" mechanism ( <a href="http://hl7.org/fhir/http.html#upsert" target="_blank" title="http://hl7.org/fhir/http.html#upsert">http://hl7.org/fhir/http.html#upsert</a> ) would also be necessary (which is defined for R4, but not for STU3). This implies every POST and PUT from the source would become a PUT in the transaction.</p>
<p>If I follow that concept and make up such a transaction Bundle, containing 2 Patient resources with the same id, but meta.versionId being 1 and 2 respectively, I get errors:<br>
HAPI complains with "Transaction bundle contains multiple resources with ID: Patient/myId"<br>
<a href="http://test.fhir.org" target="_blank" title="http://test.fhir.org">test.fhir.org</a> says "Unknown message MSG_Transaction_DUPLICATE_ID (entry 2)".<br>
This of course is true, but seems to kill my idea of how to replay a history to another server.</p>
<p>So, hopefully I overlooked something? Maybe there's also advice from FHIR Bulk Data that I didn't find?</p>



<a name="159072398"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159072398" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159072398">(Feb 21 2019 at 14:41)</a>:</h4>
<p>Don't think there is a way to 'reply the history' to another server. It sort of runs counter the idea of versioning itself: it is managed internally by each server, not controlled / controllable from outside</p>



<a name="159072492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159072492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159072492">(Feb 21 2019 at 14:42)</a>:</h4>
<p>The idea is: if I replay all actions, the destination will build a history that is equivalent to the one in the source system</p>



<a name="159074038"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159074038" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159074038">(Feb 21 2019 at 15:00)</a>:</h4>
<p>only if you also turn-back-time.... lastupdated..  I presume your definition of 'equivalent' is recognizing these kind of differences?</p>



<a name="159074396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159074396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159074396">(Feb 21 2019 at 15:04)</a>:</h4>
<p>Well, lastupdated would be another problem to solve in this context. But for the timestamp I think there would be ways to sufficiently document the original timestamp (in the context of my use case)</p>



<a name="159075659"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159075659" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159075659">(Feb 21 2019 at 15:20)</a>:</h4>
<p>The alternative, as far as I see, would be to simply use a collection (or maybe also transaction) Bundle and define a custom operation</p>



<a name="159075685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159075685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159075685">(Feb 21 2019 at 15:20)</a>:</h4>
<p>as soon as you start adding exceptions, you are not using standards... Yes you could define that lastupdated would be preferred in your use-case</p>



<a name="159076115"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159076115" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159076115">(Feb 21 2019 at 15:25)</a>:</h4>
<p>The goal is to comply to the standard, which is why I'm asking. I thought more of like a "lastUpdatedInSource" extension or similar to handle that, which should be sufficient here.<br>
But the duplicate id issue can't be solved this way.</p>



<a name="159077664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159077664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159077664">(Feb 21 2019 at 15:42)</a>:</h4>
<p>There is no way to "restore" a server that retains history right now.  It's been discussed previously, though I'm not sure if we have a change request to add that yet.  There's no way to do it using the HTTP actions defined so far.</p>



<a name="159077931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159077931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159077931">(Feb 21 2019 at 15:44)</a>:</h4>
<p>Thanks Lloyd, that clarifies it in terms of the original idea.<br>
So best practice for now would be profiling a Bundle (collection or transaction?) with an accompanying custom operation?</p>



<a name="159078181"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159078181" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159078181">(Feb 21 2019 at 15:47)</a>:</h4>
<p>Yes.  An operation that takes a "history" Bundle would work.</p>



<a name="159078329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159078329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159078329">(Feb 21 2019 at 15:48)</a>:</h4>
<p>Right, "history" might be even better - I just wasn't sure whether POSTing a history Bundle would throw an error in the very early stages of validation</p>



<a name="159078693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159078693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159078693">(Feb 21 2019 at 15:52)</a>:</h4>
<p>Operations can consume pretty much anything.  No reason for it to throw an error.</p>



<a name="159079105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159079105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159079105">(Feb 21 2019 at 15:57)</a>:</h4>
<p>Thanks again. That sounds like a way to go.</p>



<a name="159105256"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159105256" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159105256">(Feb 21 2019 at 21:19)</a>:</h4>
<p>it has been discussed but parked for now - it'll come up again in the bulk data import discussion</p>



<a name="159813448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sending%20multiple%20versions%20of%20a%20resource%20in%20a%20single%20Bundle/near/159813448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sending.20multiple.20versions.20of.20a.20resource.20in.20a.20single.20Bundle.html#159813448">(Mar 02 2019 at 20:30)</a>:</h4>
<p>My server implements this through a back door channel, as there is a lot of other information that is not in the resources, specifically around security context data, and some other internal stuff.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
