---
layout: page
title: "FHIR Chat  · Sanitizing narrative · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html">Sanitizing narrative</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="178532256"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178532256" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178532256">(Oct 19 2019 at 06:35)</a>:</h4>
<p>FHIR spec says .narrative.div should be sanitized for html injection.  From users of aidbox we learned this server behaviour is confusing people by modifying original content; different systems want different sanitization rules; we have problems with digital signatures. From design point of view doing sanitization right in place you inject foriegn html is better.  Should i create an issue to discuss removal of this feature :)?</p>



<a name="178541814"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178541814" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178541814">(Oct 19 2019 at 11:24)</a>:</h4>
<p>I think sanitization just means you need to apply the schema rules - no buttons, scripts or other elements that contain active content.  If you're doing signatures, the digital signature algorithm should handle the rest</p>



<a name="178542391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178542391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178542391">(Oct 19 2019 at 11:39)</a>:</h4>
<p>I'm not sure - can you describe the specific changes that are needed and why they are confusing?</p>



<a name="178542394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178542394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178542394">(Oct 19 2019 at 11:39)</a>:</h4>
<p>and which section exactly you are quoting?</p>



<a name="178569754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178569754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178569754">(Oct 20 2019 at 00:33)</a>:</h4>
<p>Could we suggest that there be 2 outcomes here then, a failure or correction. If the save detects active content return validation error rather than stripping it.</p>



<a name="178652106"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178652106" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178652106">(Oct 21 2019 at 12:59)</a>:</h4>
<p>The reason we left it vague is because the things hackers learn change over time. If we said simply "do not allow javascript", which is all we cared about originally, then we would not be recognizing that cyber-security is a risk-mitigation art that changes as the attacks change.</p>



<a name="178652344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178652344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178652344">(Oct 21 2019 at 13:02)</a>:</h4>
<p>However, any sanitization would indeed break a signature that existed on the 'un-sanitized' input. This is predictable. So, one should create a new version of the resource that has been sanitized, create a Provenance indicating the sanitization activity, and in that new Provenance include a new signature with linkage to the previous signature to show that the sanitization activity is verifiability linked to the unsanitized data.</p>



<a name="178652503"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178652503" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178652503">(Oct 21 2019 at 13:04)</a>:</h4>
<blockquote>
<p>Could we suggest that there be 2 outcomes here then, a failure or correction. If the save detects active content return validation error rather than stripping it.</p>
</blockquote>
<p>Good point, the sanitization activity was originally envisioned on an initial Create action; so that was also our simple world back then.</p>



<a name="178655123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178655123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178655123">(Oct 21 2019 at 13:36)</a>:</h4>
<blockquote>
<p>Could we suggest that there be 2 outcomes here then, a failure or correction. If the save detects active content return validation error rather than stripping it.</p>
</blockquote>
<p>A validation error is better than original content modification!</p>



<a name="178659298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178659298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178659298">(Oct 21 2019 at 14:19)</a>:</h4>
<p>and an OperationOutcome can express the reason is due to unsafe content in the text html...</p>



<a name="178659747"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178659747" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178659747">(Oct 21 2019 at 14:23)</a>:</h4>
<p>but if you MUST import,  then you need to make the content safe... which is where I recommended a version with safe content and a Provenance indicating the reason for change with signature linkage to the original signature</p>



<a name="178664313"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178664313" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178664313">(Oct 21 2019 at 15:09)</a>:</h4>
<p>Nicola, I know of the content on sanitizing on the security page... <a href="http://build.fhir.org/security.html#narrative" target="_blank" title="http://build.fhir.org/security.html#narrative">http://build.fhir.org/security.html#narrative</a>  <br>
It is very specific, and would not include further removal of content that is simply not  valid FHIR xhtml.</p>



<a name="178668510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178668510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178668510">(Oct 21 2019 at 15:50)</a>:</h4>
<blockquote>
<p>A validation error is better than original content modification!</p>
</blockquote>
<p>I am not aware of any text in the specification that suggests that content modification is a good or necessary thing</p>



<a name="178668608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178668608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178668608">(Oct 21 2019 at 15:51)</a>:</h4>
<p>That is why I pointed out the only place I know of which is the security narrative page. Which I think implies validation-error... but could be said more blunt if that helps</p>



<a name="178815495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178815495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178815495">(Oct 23 2019 at 01:34)</a>:</h4>
<p>So let's say the content is sanitized and passes validation for the CREATE. What happens when the threat landscape shifts and the (possibly signed) and stored content is no longer safe?</p>



<a name="178881991"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178881991" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178881991">(Oct 23 2019 at 18:26)</a>:</h4>
<p>find those resources with bad narrative, and deal with them. Likely revising them, and keeping a Provenance record to the policy change</p>



<a name="178882094"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178882094" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178882094">(Oct 23 2019 at 18:27)</a>:</h4>
<p>this is not likely to be needed, as the narrative is already highly constrained. but, never say never.</p>



<a name="178903781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178903781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178903781">(Oct 23 2019 at 22:43)</a>:</h4>
<blockquote>
<p>I am not aware of any text in the specification that suggests that content modification is a good or necessary thing</p>
</blockquote>
<p><a href="https://www.hl7.org/fhir/updates.html" target="_blank" title="https://www.hl7.org/fhir/updates.html">https://www.hl7.org/fhir/updates.html</a> ?</p>
<p>In particular <a href="https://www.hl7.org/fhir/updates.html#7.14" target="_blank" title="https://www.hl7.org/fhir/updates.html#7.14">https://www.hl7.org/fhir/updates.html#7.14</a></p>
<blockquote>
<p>Without any other agreement between exchange partners, FHIR systems are not obligated to store and return data as it was received.</p>
</blockquote>
<p>and <a href="https://www.hl7.org/fhir/updates.html#7.14.7" target="_blank" title="https://www.hl7.org/fhir/updates.html#7.14.7">https://www.hl7.org/fhir/updates.html#7.14.7</a></p>
<blockquote>
<p>The SUBSETTED Security Label can be used to flag data that has had information removed.</p>
</blockquote>



<a name="178904657"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Sanitizing%20narrative/near/178904657" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Sanitizing.20narrative.html#178904657">(Oct 23 2019 at 22:56)</a>:</h4>
<p>those suggest that it's a possible thing, and is in general no different to any content in a resource. I don't believe that these provide any reason to think that narrative modification is a good or necessary thing</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
