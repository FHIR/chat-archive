---
layout: page
title: "FHIR Chat  · Downloadable mCODE definitions do not pass validation · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html">Downloadable mCODE definitions do not pass validation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="191135144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191135144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191135144">(Mar 19 2020 at 16:05)</a>:</h4>
<p>I recently downloaded the mCODE JSON definitions from here:<br>
<a href="http://hl7.org/fhir/us/mcode/STU1/definitions.json.zip" target="_blank" title="http://hl7.org/fhir/us/mcode/STU1/definitions.json.zip">http://hl7.org/fhir/us/mcode/STU1/definitions.json.zip</a></p>
<p>And what I found is that much of the generated XHTML content in Narrative text contain template URLs that looks like this:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">\&quot;{{[type]}}-{{[id]}}-definitions.html#Observation\&quot;</span><span class="p">&gt;</span>Observation<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>


<p>This causes validation errors:</p>
<div class="codehilite"><pre><span></span>Unable to add: StructureDefinition-mcode-karnofsky-performance-status.json to the index due to exception: Invalid XHTML content: cvc-datatype-valid.1.2.1: &#39;{{[type]}}-{{[id]}}-definitions.html#Observation&#39; is not a valid value for &#39;anyURI&#39;. [StructureDefinition.text]
</pre></div>


<p>The JSON definitions that are inline on the spec website don't appear to have the same issue. I'm guessing that there is a find/replace step that didn't happen in generating the JSON definition package.</p>
<p>I also tried downloading the full IG site and the definitions.json.zip file contained within that also has the issue.</p>
<p>Is this a tooling problem?</p>
<div class="codehilite"><pre><span></span><span class="n">URI</span> <span class="n">uri</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URI</span><span class="p">(</span><span class="s">&quot;{{[type]}}-{{[id]}}-definitions.html#Observation&quot;</span><span class="p">);</span>
</pre></div>


<p>yields the following exception:</p>
<div class="codehilite"><pre><span></span>java.net.URISyntaxException: Illegal character in path at index 0: {{[type]}}-{{[id]}}-definitions.html#Observation
</pre></div>


<p>It doesn't like the curly braces or the square braces. Escaping them using the proper character entity references seems to alleviate the problem but I think the fix is that these values should be replaced with the actual type and id values that were intended.</p>
<p>The downloadable XML definitions suffer from the same problem.</p>



<a name="191149153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191149153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191149153">(Mar 19 2020 at 17:39)</a>:</h4>
<p>this is not exactly a tooling problem. But I'm not sure what to do about it</p>



<a name="191149927"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191149927" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Halina Labikova <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191149927">(Mar 19 2020 at 17:44)</a>:</h4>
<p><span class="user-mention" data-user-id="192302">@May Terry</span>  <span class="user-mention" data-user-id="191447">@Mark Kramer</span></p>



<a name="191153354"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191153354" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191153354">(Mar 19 2020 at 18:08)</a>:</h4>
<p>I also found an issue with an Id value in the ImplementationGuide resource itself</p>
<div class="codehilite"><pre><span></span>Unable to add: ImplementationGuide-hl7.fhir.us.mcode.json to the index due to exception: Id value: &#39;_str_abstractprofile&#39; contain invalid character &#39;_&#39; [ImplementationGuide.definition.resource[0]]
</pre></div>



<a name="191154734"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191154734" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191154734">(Mar 19 2020 at 18:18)</a>:</h4>
<p>I have created the following ticket to track this issue:<br>
<a href="https://jira.hl7.org/projects/FHIR/issues/FHIR-26611" target="_blank" title="https://jira.hl7.org/projects/FHIR/issues/FHIR-26611">https://jira.hl7.org/projects/FHIR/issues/FHIR-26611</a></p>



<a name="191521064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191521064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191521064">(Mar 23 2020 at 19:02)</a>:</h4>
<p>I just spent some time looking at this - this is not a feature of the current mcode ig, and I con't figure out how it was produced</p>



<a name="191604190"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191604190" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191604190">(Mar 24 2020 at 12:52)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  Is there anything we (mCODE) should be doing to address this problem?</p>



<a name="191614286"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191614286" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191614286">(Mar 24 2020 at 14:09)</a>:</h4>
<p><span class="user-mention" data-user-id="191447">@Mark Kramer</span> <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> at some point during the IG authoring/publication process it seems like there is a find/replace that needs to happen. For our purposes, we ended up post-processing the JSON definitions by replacing instances of the pattern <code>{{[type]}}-{{[id]}}</code> in the XHTML content with the actual type name and id (e.g. <code>StructureDefinition-mcode-cancer-condition-patient</code>) for each artifact. That's our current "workaround".</p>



<a name="191658643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191658643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191658643">(Mar 24 2020 at 19:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191447">@Mark Kramer</span> it doesn't happen in the current version, so no, you don't need to do anything. I'm not sure whether the problem in the past published version is something I need to do anything about. the {{[type]}}-{{[id]}} syntax is something that is processed in templates but I don't think there's any reason for it to be in resources. James, <span class="user-mention" data-user-id="248736">@Mark Iantorno</span> and I spent 20 minutes looking at this and couldn't figure out whether there's a valid reason for this to appear, but I will beef up URL validation</p>



<a name="191661315"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191661315" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191661315">(Mar 24 2020 at 19:31)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> -- would it be worth re-publishing the mCODE package so that people like <span class="user-mention" data-user-id="192334">@John Timm</span> don't have to implement a workaround like he described above?</p>



<a name="191667206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191667206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191667206">(Mar 24 2020 at 20:25)</a>:</h4>
<p>maybe. I'm not sure how to evaluate the 'worth' there - John's already worked around it...</p>



<a name="191667224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/191667224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#191667224">(Mar 24 2020 at 20:25)</a>:</h4>
<p>what I do know is: I don't have time right now :-(</p>



<a name="195972123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/195972123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#195972123">(May 01 2020 at 15:26)</a>:</h4>
<p>FYI <span class="user-mention" data-user-id="191469">@Chris Moesel</span>  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> unfortunately, the examples share the same fate as the definitions.</p>



<a name="196010187"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/196010187" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#196010187">(May 01 2020 at 21:07)</a>:</h4>
<p>I have fixed additional bugs here, so I could issue a technical correction. but I can only do so if the committee requests it and gets internal approval</p>



<a name="196201943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/196201943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#196201943">(May 04 2020 at 16:03)</a>:</h4>
<p><span class="user-mention" data-user-id="191447">@Mark Kramer</span> -- see above.  You may want to start a process to get a technical correction to fix these issues in mCODE.</p>



<a name="196222752"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/196222752" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#196222752">(May 04 2020 at 18:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Which committee?</p>



<a name="196228151"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/196228151" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#196228151">(May 04 2020 at 19:24)</a>:</h4>
<p>mCode itself says CIC owns it, so it would be CIC. Of course, the issue here is a purely publishing one, so they may not really understand. That can be a challenge with the domain committees.</p>



<a name="196228196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Downloadable%20mCODE%20definitions%20do%20not%20pass%20validation/near/196228196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Downloadable.20mCODE.20definitions.20do.20not.20pass.20validation.html#196228196">(May 04 2020 at 19:24)</a>:</h4>
<p>but I don't believe with a process to side-step the owning committee even for purely technical issues.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
