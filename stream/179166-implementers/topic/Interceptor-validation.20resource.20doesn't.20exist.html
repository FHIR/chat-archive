---
layout: page
title: "FHIR Chat  · Interceptor-validation resource doesn&#x27;t exist · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Interceptor-validation.20resource.20doesn&#x27;t.20exist.html">Interceptor-validation resource doesn&#x27;t exist</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="247553890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Interceptor-validation%20resource%20doesn%27t%20exist/near/247553890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jordi Cabré <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Interceptor-validation.20resource.20doesn&#x27;t.20exist.html#247553890">(Jul 29 2021 at 07:53)</a>:</h4>
<p>Currently, we are trying to check if a practitioner already exists using <code>@Interceptor</code> annotation:</p>
<div class="codehilite"><pre><span></span><code>@Interceptor
public class MpiValidationInterceptor {

    private final IFhirResourceDao&lt;Practitioner&gt; myPractitionerDaoR4;

    @Hook(Pointcut.STORAGE_PRESTORAGE_RESOURCE_CREATED)
    public void storagePrestorageResourceCreated(RequestDetails theRequestDetails, IBaseResource theResource) {
        if(theResource instanceof Practitioner) {
            this.validatePractitioner((Practitioner)theResource,getLocaleFromRequest(theRequestDetails));
        }
    }

    private void validatePractitioner(Practitioner practitioner) {
        SearchParameterMap paramMap = new SearchParameterMap();
        //Fill paramMap
        IBundleProvider provider = myPractitionerDaoR4.search(paramMap);
        List&lt;IBaseResource&gt; list = provider.getAllResources();
        for(IBaseResource resource:list) {
            //do validation
        }
    }
}
</code></pre></div>
<p>Nevertheless, we're getting this error message when this code is reached:</p>
<div class="codehilite"><pre><span></span><code>2021-07-29 09:50:30.610 ERROR 12037 --- [nio-8093-exec-1] c.u.f.r.s.i.ExceptionHandlingInterceptor : Failure during REST processing

ca.uhn.fhir.rest.server.exceptions.InternalErrorException: Failed to call access method: ca.uhn.fhir.context.ConfigurationException: Attempt to request all resources from an asynchronous search result.  The SearchParameterMap for this search probably should have been synchronous.
    at ca.uhn.fhir.rest.server.method.BaseMethodBinding.invokeServerMethod(BaseMethodBinding.java:272) ~[hapi-fhir-server-5.4.1.jar:na]
    at ca.uhn.fhir.rest.server.method.BaseOutcomeReturningMethodBinding.invokeServer(BaseOutcomeReturningMethodBinding.java:154) ~[hapi-fhir-server-5.4.1.jar:na]
    at ca.uhn.fhir.rest.server.method.CreateMethodBinding.invokeServer(CreateMethodBinding.java:41) ~[hapi-fhir-server-5.4.1.jar:na]
    at ca.uhn.fhir.rest.server.RestfulServer.handleRequest(RestfulServer.java:1146) ~[hapi-fhir-server-5.4.1.jar:na]
    at ca.uhn.fhir.rest.server.RestfulServer.doPost(RestfulServer.java:417) ~[hapi-fhir-server-5.4.1.jar:na]
    at ca.uhn.fhir.rest.server.RestfulServer.service(RestfulServer.java:1855) ~[hapi-fhir-server-5.4.1.jar:na]
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:733) ~[tomcat-embed-core-9.0.41.jar:4.0.FR]
</code></pre></div>
<p>The outcome is:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
    &quot;text&quot;: {
        &quot;status&quot;: &quot;generated&quot;,
        &quot;div&quot;: &quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\&quot;0\&quot;&gt;&lt;tr&gt;&lt;td style=\&quot;font-weight: bold;\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Failed to call access method: ca.uhn.fhir.context.ConfigurationException: Attempt to request all resources from an asynchronous search result.  The SearchParameterMap for this search probably should have been synchronous.&lt;/pre&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/table&gt;\n\t&lt;/div&gt;&quot;
    },
    &quot;issue&quot;: [
        {
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;Failed to call access method: ca.uhn.fhir.context.ConfigurationException: Attempt to request all resources from an asynchronous search result.  The SearchParameterMap for this search probably should have been synchronous.&quot;
        }
    ]
}
</code></pre></div>
<p>Sometimes, we're also getting this message:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
    &quot;text&quot;: {
        &quot;status&quot;: &quot;generated&quot;,
        &quot;div&quot;: &quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\&quot;0\&quot;&gt;&lt;tr&gt;&lt;td style=\&quot;font-weight: bold;\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Failed to call access method: org.springframework.transaction.IllegalTransactionStateException: Existing transaction found for transaction marked with propagation &#39;never&#39;&lt;/pre&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/table&gt;\n\t&lt;/div&gt;&quot;
    },
    &quot;issue&quot;: [
        {
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;Failed to call access method: org.springframework.transaction.IllegalTransactionStateException: Existing transaction found for transaction marked with propagation &#39;never&#39;&quot;
        }
    ]
}
</code></pre></div>
<p>What are we doing wrong?<br>
Any ideas?</p>



<a name="247581559"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Interceptor-validation%20resource%20doesn%27t%20exist/near/247581559" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Interceptor-validation.20resource.20doesn&#x27;t.20exist.html#247581559">(Jul 29 2021 at 13:17)</a>:</h4>
<p>Suggest raising this on <a class="stream" data-stream-id="179167" href="/#narrow/stream/179167-hapi">#hapi</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
