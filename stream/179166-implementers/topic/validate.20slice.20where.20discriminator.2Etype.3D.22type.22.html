---
layout: page
title: "FHIR Chat  · validate slice where discriminator.type=&quot;type&quot; · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html">validate slice where discriminator.type=&quot;type&quot;</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="211321052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/211321052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#211321052">(Sep 25 2020 at 21:38)</a>:</h4>
<p>I ran into an issue using the Java Validator with a profile on DocumentManifest that defines slicing on the content element where discriminator.type="type". One slice, "pReference", is defined on content that defines two (2) Reference types each with different targetProfile on DocumentReference.</p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;DocumentManifest.content.p[x]:pReference&quot;&gt;
  &lt;path value=&quot;DocumentManifest.content.p[x]&quot; /&gt;
  &lt;sliceName value=&quot;pReference&quot; /&gt;
  &lt;type&gt;
    &lt;code value=&quot;Reference&quot; /&gt;
    &lt;targetProfile value=&quot;http://nictiz.nl/fhir/StructureDefinition/IHE.MHD.Minimal.DocumentReference&quot; /&gt;
  &lt;/type&gt;
  &lt;type&gt;
    &lt;code value=&quot;Reference&quot; /&gt;
    &lt;targetProfile value=&quot;http://hl7.org/fhir/StructureDefinition/DocumentReference&quot; /&gt;
  &lt;/type&gt;
&lt;/element&gt;
</code></pre></div>


<p>The Java Validator returns the following warning against this part of the profile:</p>
<div class="codehilite"><pre><span></span><code>WARNING: Discriminator ($this) is based on type, but slice DocumentManifest.content.p[x] does not declare a type.
</code></pre></div>


<p>Examination of the Java Validator source shows that the slice matching logic for discriminator equal to "type" is restricting the number of types in the slice element to one and only one. When this fails, the above generic warning is thrown.</p>
<p>In a discussion of this logic with <span class="user-mention" data-user-id="192301">@Ardon Toonstra</span> from Firely, Ardon replied that the .NET Validator supports this scenario where the sliced element can have multiple types.</p>
<p>The FHIR specification Profiling page section on Slicing and the "type" discriminator does not seem to clearly define whether a single type or multiple types in the slice are allowed. Looking for guidance.</p>



<a name="211459907"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/211459907" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#211459907">(Sep 28 2020 at 07:34)</a>:</h4>
<p>Thanks Richard. Perhaps good to mention that this concerns FHIR STU3.</p>



<a name="211485795"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/211485795" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#211485795">(Sep 28 2020 at 12:35)</a>:</h4>
<p>Ardon, yes, thank you. Though the current Java validator code contains this logic so, the impact is for all official versions of FHIR - DSTU2, STU3, R4 and R5(CI).</p>



<a name="211561000"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/211561000" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#211561000">(Sep 28 2020 at 22:57)</a>:</h4>
<p>do you have a test case? This looks like one of those things where we just took a short cut</p>



<a name="211562137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/211562137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#211562137">(Sep 28 2020 at 23:09)</a>:</h4>
<p>The example I describe is from the Nictiz MedMij profiles where they have incorporated the IHE MHD profiles. The specific profile is <a href="http://nictiz.nl/fhir/StructureDefinition/IHE.MHD.DocumentManifest">http://nictiz.nl/fhir/StructureDefinition/IHE.MHD.DocumentManifest</a> and currently has this issue with multiple types in the slice element as described above.</p>
<p>Here's the test DocumentManifest resource to validate against the Nicitz MedMij profiles: <a href="/user_uploads/10155/NoPmIiAkxN_0WM4JSk4meObf/pdfa-documentmanifest1.xml">pdfa-documentmanifest1.xml</a></p>
<p>I need to drop offline now for the day. I can work on this tomorrow if you need something else.</p>



<a name="212642732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/212642732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#212642732">(Oct 08 2020 at 02:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191370">@Richard Ettema</span> I've had a look at this. I'm not sure I follow. I validated the instance you provided against the profile you provided:</p>
<div class="codehilite"><pre><span></span><code>*FAILURE*: 1 errors, 0 warnings, 0 notes
  Error @ DocumentManifest.type.coding[0] (line 68, col13) : Invalid System URI: http://loinc.org/
</code></pre></div>


<p>Then I replaced the content reference with an attachment:</p>
<div class="codehilite"><pre><span></span><code>*FAILURE*: 3 errors, 0 warnings, 0 notes
  Error @ DocumentManifest.type.coding[0] (line 68, col13) : Invalid System URI: http://loinc.org/
  Error @ DocumentManifest.content[0].p.ofType(Attachment) (line 85, col18) : This element does not match any known slice  defined in the profile http://nictiz.nl/fhir/StructureDefinition/IHE.MHD.DocumentManifest and slicing is CLOSED: DocumentManifest.content[0].p.ofType(Attachment): Does not match slice &#39;pReference&#39;
  Error @ DocumentManifest.content[0] (line 84, col12) : Profile http://nictiz.nl/fhir/StructureDefinition/IHE.MHD.DocumentManifest, Element &#39;DocumentManifest.content[0].p[x][pReference]&#39;: minimum required = 1, but only found 0
</code></pre></div>



<a name="212642739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/212642739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#212642739">(Oct 08 2020 at 02:53)</a>:</h4>
<p>that looks like the right errors to me. So what's the problem?</p>



<a name="213077080"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/213077080" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#213077080">(Oct 12 2020 at 19:23)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  The validation warning message is from using an earlier version of the validator. I since confirmed the same results you are seeing with the latest validator.</p>
<p>However, that actually brings up a new question - why isn't the latest validator giving the expected warning message that the slice has multiple types?</p>
<p>I'm looking at the InstanceValidator class sliceMatches() method where I would expect the following else if clause to evaluate to true and produce that expected message:</p>
<div class="codehilite"><pre><span></span><code>else if (criteriaElement.getType().size() &gt; 1)
  throw new DefinitionException(context.formatMessage(I18nConstants.DISCRIMINATOR__IS_BASED_ON_TYPE_BUT_SLICE__IN__HAS_MULTIPLE_TYPES_, discriminator, ed.getId(), profile.getUrl(), criteriaElement.typeSummary()));
</code></pre></div>



<a name="213234844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/validate%20slice%20where%20discriminator.type%3D%22type%22/near/213234844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/validate.20slice.20where.20discriminator.2Etype.3D.22type.22.html#213234844">(Oct 14 2020 at 00:38)</a>:</h4>
<p>ah. because in my R5 internal form, the types are collapsed since there's only an actual single type</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
