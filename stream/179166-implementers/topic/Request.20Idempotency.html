---
layout: page
title: "FHIR Chat  · Request Idempotency · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html">Request Idempotency</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="206096882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206096882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lonnie King <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206096882">(Aug 06 2020 at 01:40)</a>:</h4>
<p>I see that the FHIR spec has recommendations for how to handle <a href="http://build.fhir.org/http.html#ccreate">resource idempotency</a> but I'm curious to know if there are any recommendations for handling <strong>HTTP request idempotency</strong>.</p>
<p>My team has some thoughts on how we might do it, but we'd like to follow precedent if there is any. Does anyone here have any experience with this or recommendations?</p>



<a name="206097240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206097240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206097240">(Aug 06 2020 at 01:48)</a>:</h4>
<p>that's a pretty wide open question. can you be more specific?</p>



<a name="206099513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206099513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lonnie King <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206099513">(Aug 06 2020 at 02:40)</a>:</h4>
<p>Sure, happy to spell this out in more details. I'll also include some additional thinking in terms of solutions.</p>
<p><strong>Scenario:</strong> I operate a FHIR server and one of my (external) clients accidentally sends the same HTTP <code>POST</code> request to my server twice.</p>
<p>There are cases where this might affect the patient's clinical outcomes, and I want my application to provide some functionality that will allow a client to uniquely identify a request (or possibly resources within that request) so that I can avoid the accidental creation/duplication of resources. I understand that <code>POST</code> is not, by default, an idempotent operation according the the HTTP spec, but in instances where it could be harmful to a patient's safety I should want to provide some functionality to protect against this.</p>
<p><strong>Using Request Idempotency</strong><br>
Some <a href="https://stripe.com/docs/api/idempotent_requests">banking APIs</a> <a href="https://developer.paypal.com/docs/api-basics/#api-idempotency">handle it</a> <a href="https://developer.squareup.com/docs/working-with-apis/idempotency">this way</a>. Which provides a nice clean way for my application to handle duplicate request identification at the transport layer. I will know immediately if this request has accidentally come to me twice and can respond before I even look at the request body.</p>
<p><strong>Using Resource Idempotency</strong><br>
Another way to approach this might be to allow clients to supply their system's unique identifier as the <code>URI</code> in a <code>Meta</code> for each resource. I could store and check these <code>URI</code>s at creation time for any resource and only create resources that have unique <code>URI</code>s provided.</p>
<p>For a complete solution, I might choose to implement both of these to solve both problems of Resource and Request idempotency.</p>
<p>Would love to get some thoughts and feedback on this. Thanks!</p>



<a name="206101267"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206101267" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206101267">(Aug 06 2020 at 03:25)</a>:</h4>
<p>Have you looked at Conditional Create? (<a href="https://build.fhir.org/http.html#ccreate">https://build.fhir.org/http.html#ccreate</a>)</p>



<a name="206101467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206101467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206101467">(Aug 06 2020 at 03:30)</a>:</h4>
<blockquote>
<p>one of my (external) clients accidentally sends the same HTTP POST request to my server twice</p>
</blockquote>
<p>use a payload header is interesting, but implies that that the problem happens in the stack. I'm interested to know if other people have this problem or how they've solved it</p>



<a name="206101813"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206101813" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lonnie King <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206101813">(Aug 06 2020 at 03:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179166-implementers/topic/Request.20Idempotency/near/206101267">said</a>:</p>
<blockquote>
<p>Have you looked at Conditional Create? (<a href="https://build.fhir.org/http.html#ccreate">https://build.fhir.org/http.html#ccreate</a>)</p>
</blockquote>
<p>Yes, I have looked at this, but I'm not sure how it could solve the problem described in my scenario as the client has no knowledge of the IDs for the resources when it creates the duplicate requests. Maybe there is something I'm missing?</p>



<a name="206101933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206101933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206101933">(Aug 06 2020 at 03:43)</a>:</h4>
<p>You wouldn't use the 'id' - but you might use an 'identifier' or some other element that you know to be unique.</p>



<a name="206102202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206102202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lonnie King <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206102202">(Aug 06 2020 at 03:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179166-implementers/topic/Request.20Idempotency/near/206101933">said</a>:</p>
<blockquote>
<p>You wouldn't use the 'id' - but you might use an 'identifier' or some other element that you know to be unique.</p>
</blockquote>
<p>Oh, yes, I think I understand. That's exactly what I'm suggesting in my description for Using Request Idempotency.</p>
<p>I think you're suggesting that, more concretely,  I use something like <code> If-None-Exist: &lt;requiest-identifier&gt;</code> to identify unique requests coming into the application and respond appropriately. Did I understand you correctly?</p>



<a name="206102215"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206102215" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lonnie King <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206102215">(Aug 06 2020 at 03:51)</a>:</h4>
<p>I'm also very curious to know if anyone has opinions/thoughts on the suggested use of the <code>Meta.uri</code> property as a resource idempotency key.</p>



<a name="206102357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206102357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206102357">(Aug 06 2020 at 03:55)</a>:</h4>
<p>I would suggest <code>If-None-Exist</code> as well.  You need to have some (client side) notion of uniqueness (ie what is a key for the resource being created), and then map that into the _search_ criteria.<br>
I'm not sure what property <code>Meta.uri</code> is? <a href="https://www.hl7.org/fhir/resource.html#Meta">https://www.hl7.org/fhir/resource.html#Meta</a></p>



<a name="206102833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206102833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lonnie King <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206102833">(Aug 06 2020 at 04:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191343">Michael Lawley</span> <a href="#narrow/stream/179166-implementers/topic/Request.20Idempotency/near/206102357">said</a>:</p>
<blockquote>
<p>I would suggest <code>If-None-Exist</code> as well.  You need to have some (client side) notion of uniqueness (ie what is a key for the resource being created), and then map that into the _search_ criteria.<br>
I'm not sure what property <code>Meta.uri</code> is? <a href="https://www.hl7.org/fhir/resource.html#Meta">https://www.hl7.org/fhir/resource.html#Meta</a></p>
</blockquote>
<p>Sorry, I need to correct that. I meant to say the <code>Meta.source</code> property which is of type <code>uri</code>.</p>



<a name="206104584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206104584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206104584">(Aug 06 2020 at 04:49)</a>:</h4>
<p>Meta.source is not expected to be unique across instances.  In fact, that would defeat its purpose which is to act as a quick flag about where a record originated.</p>



<a name="206106639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206106639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206106639">(Aug 06 2020 at 05:36)</a>:</h4>
<p>it might be unique in particular circumstances, and it might meet the requirement, but it feels inherently problematic compared to something more directly linked to a business identifier.</p>



<a name="206106649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Request%20Idempotency/near/206106649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Request.20Idempotency.html#206106649">(Aug 06 2020 at 05:36)</a>:</h4>
<p>but that assumes there is such a thing. I presume our working use case is prescribing a medication?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
