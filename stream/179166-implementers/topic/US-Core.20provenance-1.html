---
layout: page
title: "FHIR Chat  · US-Core provenance-1 · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html">US-Core provenance-1</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="225466824"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225466824" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225466824">(Feb 07 2021 at 14:42)</a>:</h4>
<p>The .NET validator currently rejects all instances conforming to the US Core profile for Provenance as the provenance-1 is always failing. The constraint is defined on Provenance.agent.onBehalfOf, which is therefore the focus of the FHIRPath evaluation. However, the constraint starts with "$this" instead of "%resource". The "agent" child in "$this.agent.who.resolve()" is due to this never found.</p>
<p>Can someone confirm that this is a bug in the constraint?</p>



<a name="225470547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225470547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225470547">(Feb 07 2021 at 16:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191401">@Eric Haas</span>, the fact the invariants (and specifically the expressions) don't actually show up on the profile home page is problematic.</p>
<p>And yes, it's wrong.  $this is only available in the context of a function.  The expression should be using %resource.  Can you raise a tracker item?<br>
Also, we probably need a separate tracker item to figure out why the Java reference implementation didn't catch the issue.</p>



<a name="225507762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225507762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225507762">(Feb 08 2021 at 06:35)</a>:</h4>
<p>That fact the invariant table is half a page long  for the diff view is also problematic.   I don’t want my readers sifting through element definition invariants whuch they don’t need to care about.</p>



<a name="225508035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225508035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225508035">(Feb 08 2021 at 06:43)</a>:</h4>
<p>Fair.</p>



<a name="225515740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225515740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225515740">(Feb 08 2021 at 08:49)</a>:</h4>
<p>Created <a href="https://jira.hl7.org/browse/FHIR-31020">https://jira.hl7.org/browse/FHIR-31020</a><br>
Thanks for the clarification</p>



<a name="225610348"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225610348" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225610348">(Feb 08 2021 at 21:23)</a>:</h4>
<p>A fairly recent version of the HL7 FHIR Validator raises an exception on this: </p>
<blockquote>
<p>org.hl7.fhir.exceptions.FHIRException: Problem processing expression ($this.agent.who.resolve().is Practitioner or Device) implies exists() in profile <a href="http://hl7.org/fhir/us/core/StructureDefinition/us-core-provenance">http://hl7.org/fhir/us/core/StructureDefinition/us-core-provenance</a> path Provenance.agent[0].onBehalfOf: Error in ?? at 1, 2: Found Practitioner expecting a ")"<br>
at org.hl7.fhir.validation.instance.InstanceValidator.checkInvariant(InstanceValidator.java:4833)</p>
</blockquote>



<a name="225610643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225610643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225610643">(Feb 08 2021 at 21:25)</a>:</h4>
<p>Though this is somewhat new, because an older version we are running did not pick up on this issue.</p>



<a name="225620108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225620108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225620108">(Feb 08 2021 at 22:39)</a>:</h4>
<p>want to raise an issue against the validator?</p>



<a name="225621438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/225621438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#225621438">(Feb 08 2021 at 22:52)</a>:</h4>
<p>($this.agent.who.resolve().is Practitioner or Device) implies exists() isn't correct fhirpath right? it should be x.is(y) or 'x is y' not '<a href="http://x.is">x.is</a> y'<br>
note: CI build for us-core provenance-1 should be fine and is <br>
(($this.agent.who.resolve() is Practitioner) or ($this.agent.who.resolve() is Device)) implies exists()</p>



<a name="275542176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/275542176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#275542176">(Mar 16 2022 at 16:53)</a>:</h4>
<p>so <a href="https://jira.hl7.org/browse/FHIR-31020">https://jira.hl7.org/browse/FHIR-31020</a> got closed, but I think this expression is still problematic (for a different reason)</p>



<a name="275542310"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/275542310" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#275542310">(Mar 16 2022 at 16:53)</a>:</h4>
<p>I'll open a new JIRA for it, but thought I'd mention hear as well (in case I got it wrong):</p>
<p>agent is a repeating field and so <code>%resource.agent.who.resolve()</code> is potentially a collection with multiple items.  but <code>is</code> only works over singletons</p>



<a name="275546081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/US-Core%20provenance-1/near/275546081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/US-Core.20provenance-1.html#275546081">(Mar 16 2022 at 17:13)</a>:</h4>
<p><a href="http://jira.hl7.org/browse/FHIR-36328">FHIR-36328</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
