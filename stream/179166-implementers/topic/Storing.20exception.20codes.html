---
layout: page
title: "FHIR Chat  · Storing exception codes · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html">Storing exception codes</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153920403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153920403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Broadbent <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153920403">(Nov 20 2017 at 16:32)</a>:</h4>
<p>Hi there,</p>
<p>I'm not sure which is the best stream to ask this, but I am implementing my own storage mechanism in fhir, and I'm trying to work out the best way to deal with some data my users have questioned me about.</p>
<p>The system I work on reads csv data and transforms it into fhir, such that each observation in the csv becomes one fhir resource.  I've made up an example here which is less convoluted than the actual case I'm trying to fix:</p>
<p>I have a csv file provided which contains identifiers and date of birth for various patients.  In the column for DOB, they occasionally have a code for missing, the problem is that they have multiple classifications for missing (e.g. certificate destroyed, Not given, Unknown).  They would like to keep these orders of missing, rather than just mapping everything to null, as it's more informative to the analysts.  The problem I'm having is that in this case, DOB is a date, whilst the missing values are instances of code/coding/codeableconcept (yet to decide), meaning that I can't store them at Patient.birthDate.  I know I can create an extension for patient which stores this information, but because of the nature of where I read my data, any column of the csv file could contain exception codes like this, therefore any address in the fhir resource could be an exception code.  This would mean that my extension would also need to contain the xpath of the property.</p>
<p>Is there a better approach to this?  My main problem with this approach is that it's a lot of indirection when I come to export the data (the program looks in the resource for the element it wants, if it's null, it then has to look through all extensions until it finds one with a corresponding xpath), I'm pretty worried about the performance of modelling it like this, as a typical data extract for me contains in the region of  millions to billions of resources.</p>



<a name="153920406"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153920406" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Igor Sirkovich <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153920406">(Nov 20 2017 at 16:55)</a>:</h4>
<p><span class="user-mention" data-user-id="192995">@Andrew Broadbent</span>, you might consider using a FHIR Data Absent Reason extension: <a href="http://www.hl7.org/fhir/extension-data-absent-reason.html" target="_blank" title="http://www.hl7.org/fhir/extension-data-absent-reason.html">http://www.hl7.org/fhir/extension-data-absent-reason.html</a></p>



<a name="153920407"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153920407" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Broadbent <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153920407">(Nov 20 2017 at 17:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191393">@Igor Sirkovich</span> Is there any chance you could provide a basic example of its usage?  I'm not really clear on how you relate it to the property which is missing.</p>



<a name="153920408"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153920408" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Igor Sirkovich <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153920408">(Nov 20 2017 at 17:04)</a>:</h4>
<p>If you are using JSON, have a look at <a href="http://www.hl7.org/fhir/json.html#primitive" target="_blank" title="http://www.hl7.org/fhir/json.html#primitive">http://www.hl7.org/fhir/json.html#primitive</a> to see how to handle extensions on the primitive data types (e.g. date)</p>



<a name="153920409"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153920409" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Igor Sirkovich <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153920409">(Nov 20 2017 at 17:06)</a>:</h4>
<p>For example, if you don't know DoB, in JSON, you might have <br>
 "_birthDate": {<br>
   "extension" : [ {<br>
      "url" : "<a href="http://hl7.org/fhir/StructureDefinition/data-absent-reason" target="_blank" title="http://hl7.org/fhir/StructureDefinition/data-absent-reason">http://hl7.org/fhir/StructureDefinition/data-absent-reason</a>",<br>
      "valueCode" : "not-asked"<br>
   }]</p>



<a name="153920410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153920410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Igor Sirkovich <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153920410">(Nov 20 2017 at 17:07)</a>:</h4>
<p>In XML, this would be<br>
 &lt;birthDate&gt;<br>
   &lt;extension url="<a href="http://hl7.org/fhir/ValueSet/data-absent-reason" target="_blank" title="http://hl7.org/fhir/ValueSet/data-absent-reason">http://hl7.org/fhir/ValueSet/data-absent-reason</a>"&gt;<br>
     &lt;valueCode value="not-asked"/&gt;<br>
   &lt;/extension&gt;<br>
 &lt;/birthDate&gt;</p>



<a name="153920411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153920411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Igor Sirkovich <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153920411">(Nov 20 2017 at 17:09)</a>:</h4>
<p>Since the binding to the Value Set (<a href="http://www.hl7.org/fhir/valueset-data-absent-reason.html" target="_blank" title="http://www.hl7.org/fhir/valueset-data-absent-reason.html">http://www.hl7.org/fhir/valueset-data-absent-reason.html</a>) is required, but might not satisfy your requirements, you might need to define your own extension, which would be similar to this standar one, but will bind to your own terminology.</p>



<a name="153920412"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153920412" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Broadbent <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153920412">(Nov 20 2017 at 17:10)</a>:</h4>
<p>Oh!  I did not realise that dates (and other types) could be extended themselves, ok that makes more sense now.</p>



<a name="153921017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153921017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Broadbent <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153921017">(Nov 22 2017 at 13:28)</a>:</h4>
<p>I think this is more of a hapi issue, I've posted a separate discussion in there, but it's worth a try here.</p>
<p>When I upload a resource that contains a birth date like <span class="user-mention" data-user-id="191393">@Igor Sirkovich</span>  suggested to a hapi database, it is accepted, but when I request the resource back, the birth date is missing.  This is the same functionality of when I upload a property with a null value (and no extension).  I'm assuming that hapi trims all properties which have a null value?</p>



<a name="153921018"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153921018" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Broadbent <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153921018">(Nov 22 2017 at 13:29)</a>:</h4>
<p>Not sure if this might be a question for <span class="user-mention" data-user-id="191319">@James Agnew</span></p>



<a name="153921047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153921047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153921047">(Nov 22 2017 at 15:33)</a>:</h4>
<p><span class="user-mention" data-user-id="192995">@Andrew Broadbent</span> This should absolutely work.. I just had a look with the example you emailed me though and I see the same behaviour you do<br>
 One sec, let me try in a unit test</p>



<a name="153921211"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153921211" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153921211">(Nov 23 2017 at 02:09)</a>:</h4>
<p>This has been fixed.</p>



<a name="153921303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153921303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Broadbent <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153921303">(Nov 23 2017 at 14:56)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191319">@James Agnew</span>  Can I just confirm what version it was fixed in?  I'm running 2.6-snapshot of the jpa-example-server.</p>



<a name="153921306"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Storing%20exception%20codes/near/153921306" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Broadbent <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Storing.20exception.20codes.html#153921306">(Nov 23 2017 at 15:34)</a>:</h4>
<p>I've just pulled latest from the hapi-fhir repo.  I'm running 3.0.0, after uploading the following, I get this back:</p>
<p>&lt;Patient xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
    &lt;extension url="<a href="https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight" target="_blank" title="https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight">https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight</a>"&gt;<br>
       &lt;valueDecimal&gt;<br>
          &lt;extension url="<a href="http://www.hl7.org/fhir/extension-data-absent-reason.html" target="_blank" title="http://www.hl7.org/fhir/extension-data-absent-reason.html">http://www.hl7.org/fhir/extension-data-absent-reason.html</a>"&gt;<br>
             &lt;valueCoding&gt;<br>
                &lt;system value="http://hl7.org/fhir/ValueSet/birthweight"/&gt;<br>
                &lt;code value="Underweight"/&gt;<br>
                &lt;userSelected value="false"/&gt;<br>
             &lt;/valueCoding&gt;<br>
          &lt;/extension&gt;<br>
       &lt;/valueDecimal&gt;<br>
    &lt;/extension&gt;<br>
    &lt;identifier&gt;<br>
       &lt;system value="https://purl.org/elab/fhir/network/StructureDefinition/1/EuroPrevallStudySubjects"/&gt;<br>
       &lt;value value="1"/&gt;<br>
    &lt;/identifier&gt;<br>
    &lt;gender value="female"/&gt;<br>
 &lt;/Patient&gt;</p>
<p>{<br>
    "resourceType": "Patient",<br>
    "id": "187",<br>
    "text": {<br>
      "status": "generated",<br>
      "div": "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;table class=\"hapiPropertyTable\"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Identifier&lt;/td&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;"<br>
    },<br>
    "extension": [<br>
      {<br>
        "url": "<a href="https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight" target="_blank" title="https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight">https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight</a>"<br>
      }<br>
    ],<br>
    "identifier": [<br>
      {<br>
        "system": "<a href="https://purl.org/elab/fhir/network/StructureDefinition/1/EuroPrevallStudySubjects" target="_blank" title="https://purl.org/elab/fhir/network/StructureDefinition/1/EuroPrevallStudySubjects">https://purl.org/elab/fhir/network/StructureDefinition/1/EuroPrevallStudySubjects</a>",<br>
        "value": "1"<br>
      }<br>
    ],<br>
    "gender": "female"<br>
  }</p>
<p>It still seems to be missing the actual contents of the extension in 3.0.0?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
