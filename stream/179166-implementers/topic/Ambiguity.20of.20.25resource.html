---
layout: page
title: "FHIR Chat  · Ambiguity of %resource · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Ambiguity.20of.20.25resource.html">Ambiguity of %resource</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="172051605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Ambiguity%20of%20%25resource/near/172051605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Ambiguity.20of.20.25resource.html#172051605">(Jul 30 2019 at 16:07)</a>:</h4>
<p>Typically %resource would refer to the current focus of validation whether we are validating the outermost resource (container) or some contained resource either via DomainResource.contained or some other containment mechanism (e.g. Bundle.entry.resource). A good example of this is obs-7:</p>
<p>value.empty() or component.code.where( (coding.code = %resource.code.coding.code) and (coding.system = %resource.code.coding.system)).empty()</p>
<p>In some cases, though, particularly ref-1, it would appear that %resource should <em>always</em> be considered as the outermost resource:</p>
<p>reference.startsWith('#').not() or (reference.substring(1).trace('url') in %resource.contained.id.trace('ids'))</p>
<p>This is because contained resources should never have contained resources. The only thing that tells us the difference, however, is the 'contained' path that immediately follows %resource. Is there some general guidance on what %resource should mean in these different contexts? Any other thoughts on how to resolve this ambiguity?</p>



<a name="172052329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Ambiguity%20of%20%25resource/near/172052329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Ambiguity.20of.20.25resource.html#172052329">(Jul 30 2019 at 16:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="172054974"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Ambiguity%20of%20%25resource/near/172054974" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Ambiguity.20of.20.25resource.html#172054974">(Jul 30 2019 at 16:51)</a>:</h4>
<p>The <a href="http://hl7.org/fhir/fhirpath.html" target="_blank" title="http://hl7.org/fhir/fhirpath.html">fhirpath</a> page says "The original resource current context is part of. When evaluating a datatype, this would be the resource the element is part of.". When evaluating an invariant, that means %resource will always be the instance of the resource type on which the invariant is defined.</p>



<a name="172056777"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Ambiguity%20of%20%25resource/near/172056777" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Ambiguity.20of.20.25resource.html#172056777">(Jul 30 2019 at 17:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> Mapping that to my example, obs-7 is an invariant on the Observation resource type.The current context may be an Observation that is the root of the tree (outermost) OR it could be some contained observation and the value of %resource should follow that context accordingly. I"m not sure how that maps to the Reference ref-1 case (when reference belongs to a contained resource). If the reference is part of a contained resource and I set %resource to the resource which the reference belongs to, then the constraint would unexpectedly fail.</p>



<a name="172057572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Ambiguity%20of%20%25resource/near/172057572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Ambiguity.20of.20.25resource.html#172057572">(Jul 30 2019 at 17:21)</a>:</h4>
<p>To me, the issue with the quoted section is this sentence:  <code>When evaluating a datatype, this would be the resource the element is part of.</code> </p>
<p>ref-1 is an invariant on Reference data type.  when evaluating this on a reference that is in a resource that is contained in another resource, we want <code>%resource</code> to resolve to the outermost resource, not the contained resource its a part of.  Doesn't that conflict with the fhirpath page?</p>



<a name="172069803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Ambiguity%20of%20%25resource/near/172069803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Ambiguity.20of.20.25resource.html#172069803">(Jul 30 2019 at 19:44)</a>:</h4>
<p>ref-1 looks like it is in error to me. Can you create a task?</p>



<a name="172070429"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Ambiguity%20of%20%25resource/near/172070429" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Timm <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Ambiguity.20of.20.25resource.html#172070429">(Jul 30 2019 at 19:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <br>
<a href="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_id=677&amp;tracker_item_id=23018" target="_blank" title="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_id=677&amp;tracker_item_id=23018">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_id=677&amp;tracker_item_id=23018</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
