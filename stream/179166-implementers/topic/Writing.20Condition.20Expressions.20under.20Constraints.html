---
layout: page
title: "FHIR Chat  · Writing Condition Expressions under Constraints · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html">Writing Condition Expressions under Constraints</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="253798212"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Writing%20Condition%20Expressions%20under%20Constraints/near/253798212" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Krant <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html#253798212">(Sep 17 2021 at 19:50)</a>:</h4>
<p>Is there a documentation / Help I can read through on writing Conditional Expressions to validate the values. For instance::</p>
<p>I have custom Structure Definition based on Observation resource. Using HAPI for the validation. Is there a way to validate the value combination?</p>
<p>Ex:</p>
<div class="codehilite"><pre><span></span><code>   &quot;code&quot;: {
       &quot;coding&quot;: [
            {
               &quot;system&quot;: &quot;http://loinc.org&quot;,
               &quot;code&quot;: &quot;76536-2&quot;,
              &quot;display&quot;: &quot;Mean Arterial Pressure, Cuff&quot;
           }
       ]
    },
</code></pre></div>

<p>When this one is used, the unit of measure from the valueQuantity should have only corresponding values, not anything from the code valueset for unitofmeasure.</p>
<div class="codehilite"><pre><span></span><code>&quot;valueQuantity&quot;: {
  &quot;value&quot;: 90,
  &quot;unit&quot;: &quot;mm Hg&quot;,
  &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,
  &quot;code&quot;: &quot;mm[Hg]&quot;
}
</code></pre></div>

<p>In other words, for Mean Arial Pressure LOINC code, valueQuantity.code should not allow kg, for example.</p>



<a name="253800183"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Writing%20Condition%20Expressions%20under%20Constraints/near/253800183" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html#253800183">(Sep 17 2021 at 20:05)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="441486">@Krant</span>.  I think the key operators you're looking for is <a href="http://hl7.org/fhirpath/#implies">implies</a>.  In other words, "LOINC code X <em>implies</em> quantity unit Y".  See the FHIRPath spec for examples of its use.  If you search the whole spec for the word "implies" then you'll see it is used in several examples.</p>



<a name="253801658"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Writing%20Condition%20Expressions%20under%20Constraints/near/253801658" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html#253801658">(Sep 17 2021 at 20:17)</a>:</h4>
<p>Here's an example using the Observation from your question:</p>
<div class="codehilite"><pre><span></span><code>code.coding.where(code = &#39;76536-2&#39; and system = &#39;http://loinc.org&#39;).exists() implies valueQuantity.where(code = &#39;mm[Hg]&#39; and system = &#39;http://unitsofmeasure.org&#39;).exists()
</code></pre></div>
<p>You can try that out on the <a href="https://hl7.github.io/fhirpath.js/">fhirpath tester</a> with this Observation:</p>
<div class="codehilite" data-code-language="YAML"><pre><span></span><code><span class="nt">resourceType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Observation</span>
<span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ExampleObservation</span>
<span class="nt">status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">final</span>
<span class="nt">code</span><span class="p">:</span>
  <span class="nt">coding</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">code</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">76536-2</span>
      <span class="nt">system</span><span class="p">:</span> <span class="s">'http://loinc.org'</span>
      <span class="nt">display</span><span class="p">:</span> <span class="s">'Mean</span><span class="nv"> </span><span class="s">Arterial</span><span class="nv"> </span><span class="s">Pressure,</span><span class="nv"> </span><span class="s">Cuff'</span>
<span class="nt">valueQuantity</span><span class="p">:</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">90</span>
  <span class="nt">code</span><span class="p">:</span> <span class="s">'mm[Hg]'</span>
  <span class="nt">system</span><span class="p">:</span> <span class="s">'http://unitsofmeasure.org'</span>
  <span class="nt">unit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mm Hg</span>
</code></pre></div>
<p>Play with the code and quantity to see how it affects the result on the right-hand side.</p>



<a name="253801869"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Writing%20Condition%20Expressions%20under%20Constraints/near/253801869" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html#253801869">(Sep 17 2021 at 20:19)</a>:</h4>
<p>For more advanced stuff (like checking for value set inclusion) you can just modify the expressions on the left or right side of <code>implies</code> as appropriate.  Note however that the fhirpath tester linked above does not cover the whole FHIRPath spec, so some FHIRPath expressions won't work there.</p>



<a name="253810256"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Writing%20Condition%20Expressions%20under%20Constraints/near/253810256" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Krant <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html#253810256">(Sep 17 2021 at 21:29)</a>:</h4>
<p>Thank you.. Is this conditional expression should be specified only in snapshot or it can be specified in Differential too?</p>



<a name="253810513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Writing%20Condition%20Expressions%20under%20Constraints/near/253810513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Krant <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html#253810513">(Sep 17 2021 at 21:31)</a>:</h4>
<p>Also, how do I specify multiple AND or OR conditions in the same expression?</p>



<a name="253811626"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Writing%20Condition%20Expressions%20under%20Constraints/near/253811626" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html#253811626">(Sep 17 2021 at 21:43)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="441486">@Krant</span> -- I'd recommend you review the documentation on <a href="http://hl7.org/fhir/R4/profiling.html#snapshot">Differential vs Snapshot</a>, but in short, if you're creating a profile, your changes always go in the differential.  When the profile is processed by the IG Publisher (or whatever tooling you're using) it will generate the snapshot, which will reflect any changes you made in the differential.</p>



<a name="253811940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Writing%20Condition%20Expressions%20under%20Constraints/near/253811940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Writing.20Condition.20Expressions.20under.20Constraints.html#253811940">(Sep 17 2021 at 21:46)</a>:</h4>
<p>As for AND and OR, you use the keywords <code>and</code> and <code>or</code>.  If you need to group logical constructs, you can group them in <code>(</code> <code>)</code>.  For more info on FHIRPath, I'd suggest reading the <a href="http://hl7.org/fhirpath/">FHIRPath spec</a> as well as the <a href="http://hl7.org/fhir/R4/fhirpath.html">section on FHIRPath</a> in the FHIR R4 spec.  Both are fairly easy reads.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
