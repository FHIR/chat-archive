---
layout: page
title: "FHIR Chat  · Search by document patient id · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html">Search by document patient id</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="269320654"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269320654" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269320654">(Jan 25 2022 at 20:40)</a>:</h4>
<p>If I have a system with a patient /Patient/123 and a document bundle /Bundle/456 that is about the same person, am I correct that a search of Bundle?composition.patient.id=Patient/123 won't necessarily work, because the patient inside the bundle doesn't have to correspond to any known patient outside the bundle, and even if it is the same person, it doesn't have to have the same patient id? Searching by Bundle?composition.patient.identifier would be more robust?</p>



<a name="269321512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269321512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269321512">(Jan 25 2022 at 20:47)</a>:</h4>
<p>I'll first note that I don't think <code>Bundle?composition.patient.id=Patient/123</code> is quite a valid search.</p>
<p>You may need <code>Bundle?composition.patient._id=123</code>, which would be brittle if the reference doesn't resolve...  but if instead you write <code>Bundle?composition.patient=Patient/123</code>, I think it should work even if the reference doesn't resolve or is bundle-internal.</p>



<a name="269322269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269322269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269322269">(Jan 25 2022 at 20:53)</a>:</h4>
<p>(That's what I get for trying to compose a search off the top of my head.)</p>
<p>Sorry, can you clarify the distinction you see between your two searches?</p>



<a name="269324072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269324072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269324072">(Jan 25 2022 at 21:05)</a>:</h4>
<p>One uses chaining syntax, chaining into a referenced Patient; the other evaluates the reference itself without chaining into the target of the reference. The <code>.</code> after "patient" indicates chaining into the target.</p>



<a name="269324253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269324253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269324253">(Jan 25 2022 at 21:06)</a>:</h4>
<p>Now, my analysis here is a bit theoretical, based on this spec itself; I'm interested to know if real-world FHIR servers behave differently.</p>



<a name="269326030"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269326030" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269326030">(Jan 25 2022 at 21:19)</a>:</h4>
<p>So, <code>Bundle?composition.patient._id=123</code> looks for bundles with compositions that have a patient reference with a value of 123; and  <code>Bundle?composition.patient =Patient/123</code> look for bundles with compositions that have a patient that references the known-outside-the bundle patient Patient/123? (Did I somehow come up with the exact opposite conclusion from your original statement?)</p>



<a name="269326553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269326553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269326553">(Jan 25 2022 at 21:22)</a>:</h4>
<p>My real focus here is to confirm that the search is entirely inside the bundle (the document bundle must contain the composition, and the composition requires all "primary" resources, such as patient, be included in the bundle as well) and the existence of any patient resource outside the bundle is completely irrelevant to the search.</p>



<a name="269327456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269327456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269327456">(Jan 25 2022 at 21:28)</a>:</h4>
<blockquote>
<p>Elliot Silver15:19 So, Bundle?composition.patient._id=123 looks for bundles with compositions that have a patient reference with a value of 123; and Bundle?composition.patient =Patient/123</p>
</blockquote>
<p>Not quite -- I'm saying</p>
<ul>
<li>
<p><code>Bundle?composition.patient._id=123</code> Looks for a Bundle with a composition in <code>.entry[0]</code> where there's a subject that references a Patient, and where following that link and looking in the target Patient resource (whether the reference resolves to a Bundle-local resource or a resource elsewhere on the server)... you have a patient with an id property of 123. </p>
</li>
<li>
<p><code>Bundle?composition.patient =Patient/123</code> looks  a Bundle with a composition in entry[0] where there's a subject that is a reference to to "Patient/123" (where the reference might fail to resolve altogether, or might resolve to a Bundle-local resource, or a resource elsewhere on the server).</p>
</li>
</ul>



<a name="269327736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269327736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269327736">(Jan 25 2022 at 21:30)</a>:</h4>
<blockquote>
<p>the existence of any patient resource outside the bundle is completely irrelevant to the search</p>
</blockquote>
<p>Well, this is determined by  the <code>Bundle.entry.fullUrl</code> on the Composition entry -- if that <code>fullUrl</code> indicates a Composition "based in" the sever like <code>https://server.example.org/fhir/r4/Composition/123</code>, then any relative reference in the Composition is interpreted as a reference to a resource on the server (see <a href="https://build.fhir.org/bundle.html#references">https://build.fhir.org/bundle.html#references</a>)</p>



<a name="269327909"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269327909" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269327909">(Jan 25 2022 at 21:32)</a>:</h4>
<p>Those reference resolution rules don't set any expectations that are particular to "document"-type Bundles.</p>



<a name="269328009"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328009" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328009">(Jan 25 2022 at 21:33)</a>:</h4>
<blockquote>
<p>A document Bundle (type = "document") consists of a series of entries, the first of which is a Composition. Each entry element SHALL contain a resource.</p>
</blockquote>
<p>I read that as the resource must be in the bundle, not referenced.</p>



<a name="269328129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328129">(Jan 25 2022 at 21:34)</a>:</h4>
<p>I don't think so, though that may be a rule spelled out elsewhere. The language you quoted above  just means no <code>Bundle.entry</code>  <em>is</em> present that lacks a <code>.resource</code> property.</p>



<a name="269328197"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328197" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328197">(Jan 25 2022 at 21:34)</a>:</h4>
<p>Also, <a href="https://build.fhir.org/documents.html#content">https://build.fhir.org/documents.html#content</a>.</p>



<a name="269328223"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328223" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328223">(Jan 25 2022 at 21:35)</a>:</h4>
<p><a href="https://build.fhir.org/documents.html#content">https://build.fhir.org/documents.html#content</a> states: </p>
<blockquote>
<p>Other resources that these referenced resources refer to may also be included in the bundle if the document construction system chooses to do so.</p>
</blockquote>



<a name="269328303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328303">(Jan 25 2022 at 21:35)</a>:</h4>
<p>Yes, after the composition, subject, author, etc. you can do references, but all the "primary" resources are in the bundle.</p>



<a name="269328389"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328389" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328389">(Jan 25 2022 at 21:36)</a>:</h4>
<p>So some referenced resources have to be included, and others don't. But this is not actually relevant to your initial question, because when resources <em>are</em> included, they would have their <code>fullUrl</code> populated in a manner consistent with the reference, right?</p>



<a name="269328506"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328506" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328506">(Jan 25 2022 at 21:37)</a>:</h4>
<p>But fullUrl doesn't come into the search, does it?</p>



<a name="269328512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328512">(Jan 25 2022 at 21:37)</a>:</h4>
<p>Like, you can find the subject in the bundle but that's just a shortcut -- you can <em>also</em> find it on the server, if the <code>Composition.subject</code> looks like <code>{"reference": "Patient/123"}</code>. Now, if the <code>Composition.subject</code> used a <code>urn:uuid</code> or something, it might be possible that that the subject is <em>only</em> available in the bundle.</p>



<a name="269328679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328679">(Jan 25 2022 at 21:38)</a>:</h4>
<p>Or patient/123 might refer to a patient 123 on a different server that has nothing to do with patient 123 on this server.</p>



<a name="269328951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269328951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269328951">(Jan 25 2022 at 21:40)</a>:</h4>
<p>that would <em>only</em> be possible if the <code>Bundle.entry[0].fullUrl</code> reflected this, like "<a href="https://other-server.example.org/Composition/123">https://other-server.example.org/Composition/123</a>", right?</p>



<a name="269329042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269329042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269329042">(Jan 25 2022 at 21:41)</a>:</h4>
<p>And  this is my point about Bundle reference resolution rules: if the server doesn't maintain a copy of the target, chaining will be very hard, but searches that can be evaluated against the <em>reference itself</em> are still easy. And in your example that's all you need.</p>



<a name="269329133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269329133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269329133">(Jan 25 2022 at 21:42)</a>:</h4>
<p>For the sub-case of references to resources that will <em>always</em> be present in the Document bundle, chaining is at least <em>possible</em>, but your use case still doesn't require it, so I would try not to depend on it.</p>



<a name="269329438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269329438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269329438">(Jan 25 2022 at 21:45)</a>:</h4>
<p>If I use Composition/<em>x</em>$document to create a document on one server, save it to disk, and up load it to another server, you're saying fullUrl will point to old-server, and Bundle?composition.patient=Patient/123 won't match because what the server should be doing is trying to match <a href="http://this-server.com/Patient/123">this-server.com/Patient/123</a> against <a href="http://old-server.com/Patient/123">old-server.com/Patient/123</a>?</p>



<a name="269330035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269330035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269330035">(Jan 25 2022 at 21:50)</a>:</h4>
<p>(Anyone else feel like a freshman who's just walked into a grad seminar?)</p>



<a name="269332358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269332358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269332358">(Jan 25 2022 at 22:09)</a>:</h4>
<p>welcome to the wonderful word of resource id resolution in bundles <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="269334082"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269334082" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269334082">(Jan 25 2022 at 22:21)</a>:</h4>
<p>Part of the discussion has to be what happens before the search, i.e. when the bundle is ingested into the server by whatever method, does the reference get rewritten? Would it be accepted at all if it just said Patient/123 and the server didn't have that resource or know how to resolve it?</p>
<p>I would expect the search to match the bundle if the reference was stored as Patient/123, because it's not a search problem at that point.</p>



<a name="269337655"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269337655" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269337655">(Jan 25 2022 at 22:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197072">Paul Church</span> <a href="#narrow/stream/179166-implementers/topic/Search.20by.20document.20patient.20id/near/269334082">said</a>:</p>
<blockquote>
<p>Part of the discussion has to be what happens before the search, i.e. when the bundle is ingested into the server by whatever method, does the reference get rewritten? Would it be accepted at all if it just said Patient/123 and the server didn't have that resource or know how to resolve it?</p>
</blockquote>
<p>Yes, but I don't think that doing a rewrite is required (or implied) in the base spec. As an IG author, if I want it done, do I need to specify something here?</p>



<a name="269341549"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269341549" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269341549">(Jan 25 2022 at 23:33)</a>:</h4>
<p>If you store the exact bytes of a bundle like <a href="https://www.hl7.org/fhir/document-example-dischargesummary.json.html">https://www.hl7.org/fhir/document-example-dischargesummary.json.html</a> in your server ... and then a client retrieves this document and wants to resolve the subject of the Composition as expressed here:</p>
<div class="codehilite"><pre><span></span><code>        &quot;subject&quot;: {
          &quot;reference&quot;: &quot;http://fhir.healthintersections.com.au/open/Patient/d1&quot;,
          &quot;display&quot;: &quot;Eve Everywoman&quot;
        },
</code></pre></div>
<p>... the rules say:</p>
<ol>
<li>Look for a bundle-local resolution -- this will succeed because the relative reference is in the same FHIR base as d1; the <code>fullUrl</code> elements are:</li>
</ol>
<div class="codehilite"><pre><span></span><code>      &quot;fullUrl&quot;: &quot;http://fhir.healthintersections.com.au/open/Composition/180f219f-97a8-486d-99d9-ed631fe4fc57&quot;,
      &quot;fullUrl&quot;: &quot;http://fhir.healthintersections.com.au/open/Patient/d1&quot;,
</code></pre></div>
<ol start="2">
<li>If the local resolution had <em>failed</em>, the client would have to go on to querying the origin server. But (1) succeeded and always will succeed for Document bundles when resolving <code>Composition.subject</code>, so we're OK. </li>
</ol>
<p>Now, when your server is indexing this document, a whole bunch of questions come into play, as Paul notes. Servers <em>could</em> build support for indexing these in-Bundle resources, but frankly if the server is going to store this bundle at <a href="https://newserver.example.org/Bundle/123">https://newserver.example.org/Bundle/123</a>, then it's <em>already</em> rewriting <code>Bundle.id</code>, and it might choose to rewrite all the references as well. I don't think the FHIR API currently has a good way to store a full document <em>byte-for-byte as it originated from the source</em> and also allow search on top, because of this issue with <code>Bundle.id</code> not being globally unique.</p>



<a name="269352467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269352467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269352467">(Jan 26 2022 at 01:45)</a>:</h4>
<p>I don't know much about document-specific concerns but isn't this similar to having an IG require referential integrity? Whatever the server does, it has to avoid ending up with a relative reference (Patient/123 with no fullUrl) that doesn't resolve.</p>



<a name="269357861"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269357861" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269357861">(Jan 26 2022 at 03:25)</a>:</h4>
<p>I don't see any document specific concerns here. For any references that aren't included in the document Bundle, the receiving server might well be stuck without an ability to resolve.  That needn't prevent the receiving server from storing the Document bundle and supporting search on the content it doesn't have.</p>



<a name="269358082"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269358082" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269358082">(Jan 26 2022 at 03:30)</a>:</h4>
<p>Re: documents I'm just saying if you want to store/expose the raw source bytes (to support signature algorithms, hashes, etc) you can do so in a Binary, but clients won't be able to run searches like Elliot is asking about. Or you can store a Bundle at the Bundle endpoint and support search, but you won't be serving the original bytes. You can't have both features without storing the Document twice, as it currently stands.</p>



<a name="269363584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269363584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269363584">(Jan 26 2022 at 04:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197072">Paul Church</span> <a href="#narrow/stream/179166-implementers/topic/Search.20by.20document.20patient.20id/near/269352467">said</a>:</p>
<blockquote>
<p>I don't know much about document-specific concerns but isn't this similar to having an IG require referential integrity? Whatever the server does, it has to avoid ending up with a relative reference (Patient/123 with no fullUrl) that doesn't resolve.</p>
</blockquote>
<p>Even if it isn't technically different, It feels to me qualitatively different. One of the supposed advantages of "documents" is that they are self-contained, however, that means that the contents of the document don't need be related to anything known to the server. I'm trying to understand what that translates to in practice.</p>



<a name="269435889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269435889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Ritz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269435889">(Jan 26 2022 at 16:06)</a>:</h4>
<p>It can differ based on the specific use case, of course, but <em>one</em> of the benefits of a FHIR document bundle (such as an IPS, for example) is that it provides an auditable, nonrepudiable, message exchange of point-in-time context. That said... again with the IPS example... it would be helpful for this exchange to also be able to '<strong>sync</strong>' systems to a common context. <br>
Following along with this idea, a context-syncing pattern could be something like:<br>
<strong>ENCOUNTER BEGINS</strong></p>
<ol>
<li>EMR fetches IPS for Derek from HIE</li>
<li>EMR compares local content with IPS content</li>
<li><strong>IF IPS represents a superset of the content in the EMR</strong> update Derek's record in the EMR with new data from the IPS</li>
</ol>
<p><strong>EXECUTE ENCOUNTER ACTIVITIES</strong></p>
<ol start="4">
<li>update Derek's record in the EMR to reflect encounter data, outcomes, and orders</li>
<li>create an updated IPS for Derek from the EMR content and submit it to HIE (which would leverage it, as in step 3, to update Derek's shared health record)</li>
</ol>
<p><strong>ENCOUNTER ENDS</strong><br>
I think this valuable pattern could be undermined if it is difficult (or potentially patient-unsafe) to do .id resolution between content in the bundle and the FHIR server that this bundle is trying to sync with.</p>



<a name="269462759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269462759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269462759">(Jan 26 2022 at 18:56)</a>:</h4>
<p><span class="user-mention" data-user-id="193307">@Derek Ritz</span> Following up on the IPS context:</p>
<ul>
<li>Patient obtains IPS from local (hospital, PCP, national system, etc) which identifies the patient by local identifiers, and uses a local URL for patient id.</li>
<li>Patient is injured while travelling and goes to foreign hospital where a new patient resource is created in the foreign EMR.</li>
<li>Patient provides foreign healthcare provider with their IPS which gets uploaded to the foreign EMR.</li>
</ul>
<p>Now the question is, does the patient in the IPS get modified to match the foreign patient id? Do we update the patient resource in the EMR to match the content of the patient resource in the IPS? Do we update the patient resource in the IPS to match the patient resource in the EMR? Which changes break the "point-in-time" nature of a document? Is there some level of "tweak" to the content of a document that is accepted without "changing" the document? If we don't change the patient id (and potentially MRN, etc.) how do we later identify this document as belonging to the patient with a given (foreign) id?</p>



<a name="269466245"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269466245" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Ritz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269466245">(Jan 26 2022 at 19:17)</a>:</h4>
<p>So... I'm actually not thinking of cross-border use cases, here. I'm actually just thinking about multiple care delivery sites within the same province, and all connected to the same HIE-based shared health record. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="269467656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269467656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Ritz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269467656">(Jan 26 2022 at 19:27)</a>:</h4>
<p>My sense is that the exchange of a bundle <strong><em>within a single governance framework</em></strong>  should be able to benefit from consistency in .identifier (and potentially, in .id) across a federation of FHIR servers... with the bundle being used as the way to do the syncing.</p>



<a name="269468105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269468105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269468105">(Jan 26 2022 at 19:30)</a>:</h4>
<p>This is part of what I am getting at -- what are the built-in assumptions to using a document bundle? Do we need a common framework for patient id/identity?</p>



<a name="269469802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269469802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269469802">(Jan 26 2022 at 19:41)</a>:</h4>
<p>In the "within a province" scenario, ideally you'd be looking to share the data over a RESTful interface and not creating a plethora of document instances to wade through.</p>



<a name="269471500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269471500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Ritz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269471500">(Jan 26 2022 at 19:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  maybe... there are useful medico-legal implications of the document exchange... and the evidence trail it operationalizes. (also... documents can be signed... and there are times where this is valuable, too).</p>



<a name="269472396"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269472396" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Ritz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269472396">(Jan 26 2022 at 19:59)</a>:</h4>
<p>even within a province</p>



<a name="269473987"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269473987" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Ritz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269473987">(Jan 26 2022 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191380">Elliot Silver</span> <a href="#narrow/stream/179166-implementers/topic/Search.20by.20document.20patient.20id/near/269468105">said</a>:</p>
<blockquote>
<p>This is part of what I am getting at -- what are the built-in assumptions to using a document bundle? Do we need a common framework for patient id/identity?</p>
</blockquote>
<p>I think we will have to expect that master data management of all kinds will be needed. Consistency in patient ids, provider ids, location ids, and even document ids for important things like prescriptions -- will all be the key to successfully being able to operationalize FHIR document exchange within a care delivery network.</p>



<a name="269476393"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269476393" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269476393">(Jan 26 2022 at 20:24)</a>:</h4>
<p>I think a strong focus on</p>
<p>1) ensuring that all (important) related resources are part of a document Bundle and<br>
2) populating <code>Resource.identifier</code> with cross-org-relevant values where possible</p>
<p>is going to be the best "bang for buck" in the <span class="user-mention" data-user-id="193307">@Derek Ritz</span>  use case. Aligning <code>Resource.id</code> across systems should be a non-goal in my opinion.</p>



<a name="269601936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269601936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269601936">(Jan 27 2022 at 16:54)</a>:</h4>
<p>in a pure FHIR world... there would be no Resource.identifier values, as nothing exists outside FHIR... right? So the <a href="http://Resource.id">Resource.id</a> at the source is the unique identifier.</p>



<a name="269602039"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20document%20patient%20id/near/269602039" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20document.20patient.20id.html#269602039">(Jan 27 2022 at 16:55)</a>:</h4>
<p>definitely agree that aligning <a href="http://Resource.id">Resource.id</a> across systems is a non-starter.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
