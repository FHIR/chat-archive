---
layout: page
title: "FHIR Chat  · Realizing reversed chaining with several And-conditions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html">Realizing reversed chaining with several And-conditions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="213746886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Realizing%20reversed%20chaining%20with%20several%20And-conditions/near/213746886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sebastian Lanz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html#213746886">(Oct 19 2020 at 06:20)</a>:</h4>
<p>Good Morning from Germany,<br>
I got familiar with fhir for a student thesis. Its goal is to "translate" data -  generated from a medical data generator - from an existing medical data warehouse (dw) into a local fhir server instance as well as "translating" the dw's query language. While I did the former using a HAPI JPA Server, I checked the RESTful Search options to realize the latter. The original dw's query language main task ist to search for patients according to the onset of a &lt;Condition, Observation, Procedure etc.&gt;. <br>
If I understood correctly from the fhir search docu, this could be achieved with reverse chaining, as given in the docu:<br>
GET [base]/Patient?_has:Observation:patient:code=8302-2 (for loinc body height)<br>
This is fine for all Ressources for which I only want to check the onset. For Observation unfortunately, I would also like to check for the respective value (e.g. height in cm). How could a query of this type be realized?<br>
I would have thought that this is fine: <br>
Patient?_has:Observation:patient:code=8302-2&amp;_has:Observation:patient:value-quantity=180.0|http://unitsofmeasure.org|cm <br>
but in the docu it states that "_has parameter is processed independently of other _has parameters", so it can't be the solution.<br>
I am probably missing something since this simple functionality is surely not too hard to set up.<br>
Any help would be greatly appreciated!<br>
Kind regards,<br>
Sebastian<br>
(hoping to post this in the right forum -&gt; feel free to refer me to a different one if appropriate!)</p>



<a name="213795818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Realizing%20reversed%20chaining%20with%20several%20And-conditions/near/213795818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html#213795818">(Oct 19 2020 at 14:43)</a>:</h4>
<p>You can use the code-value-quantity composite search parameter on Observation, but there's no way to combine reverse-chained parameters to work  except independently.  You'd have to look at _filter</p>



<a name="213888309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Realizing%20reversed%20chaining%20with%20several%20And-conditions/near/213888309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sebastian Lanz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html#213888309">(Oct 20 2020 at 08:29)</a>:</h4>
<p>Yes, it seems _filter is the right solution.<br>
Thank you a lot for your quick reply and have a good day!</p>



<a name="214310799"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Realizing%20reversed%20chaining%20with%20several%20And-conditions/near/214310799" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sebastian Lanz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html#214310799">(Oct 23 2020 at 13:08)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> ,</p>
<p>About the _filter (the docu afaik is not very specific about it's actual capabilities). </p>
<p>Let's say I want to get all Patients with:</p>
<ul>
<li>either: a Condition of code A and of code B </li>
<li>or: an Observation of code C and value = 1</li>
</ul>
<p>Knowing that the request "/Patient?_has:Condition:patient:code=A" gets me all Patients with Condition of code A.<br>
Does the use of the _has parameter in a _filter query as used below get me the requested Patients? If not, how is it done?<br>
/Patient?_filter=(_has:Condition:patient:code=A and _has:Condition:patient:code=B) or ( _has:Observation:patient:code=C and  _has:Observation:patient:code=1)</p>
<p>Cheers,<br>
Sebastian</p>



<a name="214348725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Realizing%20reversed%20chaining%20with%20several%20And-conditions/near/214348725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html#214348725">(Oct 23 2020 at 18:23)</a>:</h4>
<p>The first bit would be fine - because the conditions you're trying to match would be independent  However, for the second, you'd want the same observation - you don't want a match where one Observation has code C and a different Observation has value 1.  Your choices there are either to use the code-value-quantity search criteria to match on both at once, or to say _has:Condition:patient[code=C and value=1]</p>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>, I'm not totally clear whether the latter is legal?</p>



<a name="215071660"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Realizing%20reversed%20chaining%20with%20several%20And-conditions/near/215071660" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sebastian Lanz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html#215071660">(Oct 30 2020 at 09:32)</a>:</h4>
<p>Hey <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> ,<br>
i'm not actually sure if the first bit would be considered independent, since I do want all patients with Condition A and(!) B both, not just Patients with A or Patients with B.<br>
From testing on the <a href="http://test.fhir.org/r4">test.fhir.org/r4</a> server I got the impression that even "and"-ing the _has-parameters in the _filter option just logically Or-s the search criteria -&gt; e.g. in the above example I would just get patients with Contition A or B.<br>
Maybe there exists a server that supports the functionality i am describing.<br>
It does definitely not seem to keen of a requirement to me, at least I would (as a practitioner or else) expect from a Fhir server to be able to process above request (get all patients with condition A and B) - or am I missing something completely?<br>
A comment from <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  maybe would clear this point (mentioned server does seem to be related to him).<br>
Cheers and thanks in advance,<br>
Sebastian</p>



<a name="215118050"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Realizing%20reversed%20chaining%20with%20several%20And-conditions/near/215118050" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html#215118050">(Oct 30 2020 at 16:25)</a>:</h4>
<p>When you use _filter, you can specify filters at different levels, and you can use ands and ors and brackets within those levels.  _filter itself is not widely implemented, unfortunately.</p>



<a name="215375785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Realizing%20reversed%20chaining%20with%20several%20And-conditions/near/215375785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Realizing.20reversed.20chaining.20with.20several.20And-conditions.html#215375785">(Nov 02 2020 at 20:42)</a>:</h4>
<p>I think my server fully implements _filter and I think that you should be able to do what you need. what specific searches are you doing?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
