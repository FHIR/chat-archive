---
layout: page
title: "FHIR Chat  · Bundle - add faceting · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html">Bundle - add faceting</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="176698288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176698288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176698288">(Sep 26 2019 at 21:20)</a>:</h4>
<p>Bundle provides the optional <strong>total</strong> which is helpfull to paginate. </p>
<p>In the same spirit, I d'like to add faceting numbers (such lucene faceting). Say the resource <strong>Patient</strong> has 10 milion entries,<br>
the bundle would have a total=10M . Also It could ship a facet on gender (Male=5M, Female=5M) and also<br>
a facet on year of birth.</p>
<p>The search parameter could be <strong>_facet=gender,deaceasedBoolean</strong>. I wonder what FHIR type could <br>
represent facets with flexibility. I also guess a bundle extension could be okay, with a kind of key/value map<br>
data type.</p>
<p>Any thought ?</p>



<a name="176724017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176724017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176724017">(Sep 27 2019 at 07:21)</a>:</h4>
<p>That could be put into an operation outcome in the bundle with info messages if you really wanted to.</p>



<a name="176734313"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176734313" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176734313">(Sep 27 2019 at 10:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> this makes sense. Do you mean putting the facets as string in the display element of the operationOucome resource in the Bundle resource ?</p>



<a name="176734508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176734508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176734508">(Sep 27 2019 at 10:29)</a>:</h4>
<p>Or info messages in it yes.</p>



<a name="176734720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176734720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176734720">(Sep 27 2019 at 10:32)</a>:</h4>
<p>no way to have a complex type such Map[key -&gt; intValue] instead of string ?</p>



<a name="176745014"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176745014" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176745014">(Sep 27 2019 at 13:23)</a>:</h4>
<p>It should be possible to create an operation that did this, but I don't think it's appropriate to build it into the query mechanism.  It would add a lot of complexity and wouldn't be relevant to paging.  You could submit a change request if you'd like us to define such an operation as part of R5.</p>



<a name="176782470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176782470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176782470">(Sep 27 2019 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  not sure to understand why it wouldn't be relevant to paging. Facet is as static as total</p>



<a name="176801889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176801889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176801889">(Sep 28 2019 at 01:56)</a>:</h4>
<p>Yes, but 'total' lets you know how many times you'll have to page forward to get everything.  The others are just statistics - and there's pretty much an unlimited set of statistics you might want.  For example, you might want males and females, but you might also want males and females by age range or males and females who meet a particular criteria vs. not.  And most often when you're looking for the statistics, you won't actually care to page through the details.  (If you were going to, there'd be no reason to retrieve the statistics in the first place.)</p>



<a name="176801958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176801958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176801958">(Sep 28 2019 at 01:58)</a>:</h4>
<p><span class="user-mention" data-user-id="213944">@natus</span> Note that the above just reflects my personal opinion.  If you feel strongly it should be part of search, feel free to submit a change request for that instead.</p>



<a name="176821346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176821346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176821346">(Sep 28 2019 at 10:52)</a>:</h4>
<p>no one else has expressed interest in the idea yet?</p>



<a name="176827316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176827316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176827316">(Sep 28 2019 at 14:00)</a>:</h4>
<p>I didn't find any mention of facet in the zulip history. </p>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> I admit faceting can be broad, however it might be possible to specifify the kind of facet and level that could be shared exactly how search parameters and _elements are limited in scope</p>



<a name="176827329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176827329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176827329">(Sep 28 2019 at 14:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  I didn't find any mention of facet in the zulip history.</p>
<p>@Lloyd McKenzie I admit faceting can be broad, however it might be possible to specifify the kind of facet and level that could be shared exactly how search parameters and _elements are limited in scope</p>
<p>Any search engine provide those statistics natively and easily</p>



<a name="176828830"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176828830" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176828830">(Sep 28 2019 at 14:46)</a>:</h4>
<blockquote>
<p>Any search engine provide those statistics natively and easily</p>
</blockquote>
<p>Uh....no. In our system (SQL Server based) producing male / female stats would involve some extra non-trivial query - because the query would have to deal with mapping of our internal values to FHIR male / female</p>



<a name="176829165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176829165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176829165">(Sep 28 2019 at 14:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span> sure this may not apply to every implementation</p>



<a name="176830495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176830495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176830495">(Sep 28 2019 at 15:37)</a>:</h4>
<p>The database will typically return a count of total matching records.  To do facet counts, you either need to do sub-queries or iterate through all the data (both of which have a significant impact on performance).  I'm not aware of any database technologies that would provide facet counts 'for free' the way they provide a count of total records.</p>



<a name="176830685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176830685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176830685">(Sep 28 2019 at 15:42)</a>:</h4>
<blockquote>
<p>I'm not aware of any database technologies that would provide facet counts 'for free' the way they provide a count of total records.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> same apply for total matching records: no relational database will know that information without scanning the whole. However, search engine such solr/elastic search provides this for free.</p>



<a name="176836518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176836518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176836518">(Sep 28 2019 at 18:37)</a>:</h4>
<blockquote>
<p>I didn't find any mention of facet in the zulip history</p>
</blockquote>
<p>yes, to my memory no one has brought this up. There's nothing stopping you from doing this in a server, but we generally only standardise something if enogh people express interest in the idea</p>



<a name="176838088"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176838088" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176838088">(Sep 28 2019 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> - the mechanism for doing this on a local basis would be to put extensions in Bundle.meta?</p>



<a name="176838152"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176838152" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176838152">(Sep 28 2019 at 19:26)</a>:</h4>
<p>yes I think so</p>



<a name="176841841"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176841841" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176841841">(Sep 28 2019 at 21:08)</a>:</h4>
<p>so what about the valueType. Is string the best option (with a json in it)?</p>



<a name="176844020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/176844020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#176844020">(Sep 28 2019 at 22:14)</a>:</h4>
<p>Your mechanism should ideally work whether the system asks for results in XML, JSON or RDF.  So I would go with a complex extension that indicates the facet type and value</p>



<a name="181024687"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/181024687" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#181024687">(Nov 18 2019 at 15:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> you mean a bundle extension ? Apprently bundle cannot have extension (from the documentation):</p>
<blockquote>
<p>Although there are no extensions on the Bundle itself, link, entry, and search/request/response can all have extensions</p>
</blockquote>



<a name="181029376"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/181029376" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#181029376">(Nov 18 2019 at 16:14)</a>:</h4>
<p>True, but you can stick them inside Bundle.meta</p>



<a name="181034540"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/181034540" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#181034540">(Nov 18 2019 at 17:06)</a>:</h4>
<p>what about this:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Bundle&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;3ec28c39-cc93-42fa-924e-46dd6ee9c65d&quot;</span><span class="p">,</span>
  <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;facet-encounter-length&quot;</span><span class="p">,</span>
        <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;1 days&quot;</span><span class="p">,</span>
            <span class="nt">&quot;valueInt&quot;</span><span class="p">:</span> <span class="mi">2000</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;2 days&quot;</span><span class="p">,</span>
            <span class="nt">&quot;valueInt&quot;</span><span class="p">:</span> <span class="mi">4000</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="err">...</span>
<span class="p">}</span>
</pre></div>



<a name="181035744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/181035744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#181035744">(Nov 18 2019 at 17:18)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> the general idea is to propose one complex extention per facet, and limit the facet to several FHIR elements.<br>
say patient.age, encounter.type, encounter.length, documentReference.type ...</p>



<a name="181035867"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/181035867" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#181035867">(Nov 18 2019 at 17:20)</a>:</h4>
<p>the sub extention would follow a pattern in order to allow range faceting  such<br>
<code>"[1, 20[":2000</code></p>



<a name="181035879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/181035879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#181035879">(Nov 18 2019 at 17:20)</a>:</h4>
<p>The base URL would have to be a full URL and the child URLs would have to be valid URL syntax (e.g. change the space to %20), but otherwise I think that should work.</p>



<a name="181712136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20-%20add%20faceting/near/181712136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> natus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20-.20add.20faceting.html#181712136">(Nov 23 2019 at 11:33)</a>:</h4>
<p>finally I hve something working with complex extension in the meta of bundles.<br>
The client is able to ask for different kind of facets:</p>
<p>- &amp;facet=gender: returns a histogram of code as complex extension<br>
- &amp;rangeDateFacet=birthdate : returns a histogram of date range as complex extension<br>
- &amp;rangeNumFacet=length: returns an histogram of numeric range as complex extension<br>
- &amp;uniqueFacet=patient,encounter : returns the number of unique patient/encounters that matches the filter as simple extension</p>
<p>This has been implemented with HAPI FHIR and apache solr. Thanks <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> and <span class="user-mention" data-user-id="191319">@James Agnew</span></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
