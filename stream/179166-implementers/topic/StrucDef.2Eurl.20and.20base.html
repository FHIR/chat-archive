---
layout: page
title: "FHIR Chat  · StrucDef.url and base · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html">StrucDef.url and base</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153877786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877786">(Mar 17 2017 at 13:27)</a>:</h4>
<p>Looking at <a href="http://hl7.org/fhir/visionprescription.profile.xml.html" target="_blank" title="http://hl7.org/fhir/visionprescription.profile.xml.html">http://hl7.org/fhir/visionprescription.profile.xml.html</a>:<br>
.<br>
Today for DSTU2 it has canonical URL "<a href="http://hl7.org/fhir/StructureDefinition/VisionPrescription" target="_blank" title="http://hl7.org/fhir/StructureDefinition/VisionPrescription">http://hl7.org/fhir/StructureDefinition/VisionPrescription</a>" and base "<a href="http://hl7.org/fhir/StructureDefinition/DomainResource" target="_blank" title="http://hl7.org/fhir/StructureDefinition/DomainResource">http://hl7.org/fhir/StructureDefinition/DomainResource</a>"<br>
.<br>
This doesn't tell me anything about what version of FHIR we are dealing with. I could look at .fhirVersion ("1.9.0"), but my resolving is hard that way.<br>
.<br>
Would it make sense to assume a strategy where canonicals and baseDefinition include the right permalink? E.g.<br>
.<br>
&lt;url value="http://hl7.org/fhir/DSTU2/StructureDefinition/VisionPrescription"/&gt;<br>
&lt;baseDefinition value="http://hl7.org/fhir/DSTU2/StructureDefinition/DomainResource"/&gt;<br>
.<br>
The same logic would apply to extensions. This way in 2/3 weeks time when STU3 is done I could get a distinct new version of the profile.</p>



<a name="153877796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877796">(Mar 17 2017 at 13:35)</a>:</h4>
<p>STU3 is a few days away</p>



<a name="153877797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877797">(Mar 17 2017 at 13:35)</a>:</h4>
<p>not a few weeks</p>



<a name="153877817"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877817" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877817">(Mar 17 2017 at 14:52)</a>:</h4>
<p>Ok. Doesn't change the question though. Even if it's not going to change what comes out of STU3. We could still look into what to do for STU3 Patch 1 or R4. I have a feeling there's something to solve here, but I'm currently just checking if my hunch is right.<br>
.<br>
For reference: this question came from a rather lengthy/ferocious discussion over at the Netherlands stream. We have a 'big' number of DSTU2 profiles that we will need to convert to STU3 and we are wondering what to do with the canonicals and extension URLs in that conversion.<br>
.<br>
I cannot leave them as is and publish the new versions on Simplifier. I'm afraid it would be a disaster to distinguish what's what. I'm not sure whether to update them when I see that the FHIR Core materials don't. But I mostly wonder whether it is correct that the FHIR Core doesn't update them and how the resolving of artifacts works then.<br>
.<br>
Hence the question.</p>



<a name="153877857"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877857" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877857">(Mar 17 2017 at 19:34)</a>:</h4>
<p>I don't know what the answer is. I agree that there's a problem to think about. If you look at the R2 structure definitions included in R3, they have the urls you are talking about - I made that change. But doing that broken so many things - both practically and conceptually</p>



<a name="153877956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877956">(Mar 18 2017 at 07:24)</a>:</h4>
<p>I'm not sure how to spot R2 profiles in between R3, but I'll take your word for it. If there indeed is a problem then I'm sure for example <span class="user-mention" data-user-id="191319">@James Agnew</span>  must have run into that when he built the R2 &gt; R3 conversion, or <span class="user-mention" data-user-id="191370">@Richard Ettema</span>  must have seen it when he gathers stuff for validation. That's the practical side. What would you say is a/the conceptual problem?<br>
.<br>
I remember a discussion on ValueSet.url for expansions where we landed on the ValueSet.url being a logical identifier rather than an instance type identifier, so that meant that ValueSet.url for intention and expansion can in fact be the same because the logical intention is the same. Supposedly you could look at StructureDefinition.url the same way. <br>
.<br>
I'm not sure about <a href="http://StructureDefinition.id" target="_blank" title="http://StructureDefinition.id">StructureDefinition.id</a> and .baseDefinition. If the .id and .baseDefinition point to objects that can change structure overnight (R2 &gt; R3) then I'm not sure what breaks when overnight happens. Same with extension.url. If my instance claims conformance to a profile on R3, I'd expect every extension to be R3 too. But a given extension may not be part of the (open) R3 profile and only exist in R2 space. Can I reject instances based on mixed versions of definitions?<br>
.<br>
Seems to me that after R3 is out we will get real world feedback on this. Versioning has been V3s weakest point with every Normative Edition being compatible with itself, so I'd love to help avoiding that in FHIR.</p>



<a name="153877980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877980">(Mar 18 2017 at 11:11)</a>:</h4>
<p>I wrote the R2 &lt;--&gt; R3 conversion, so it's me that had the issue. Somewhere, I hack(ed) the URLs. can't remember whether it's as I load, or manually now</p>



<a name="153877982"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877982" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877982">(Mar 18 2017 at 11:14)</a>:</h4>
<p>what I've learnt about versioning is that choices I make seem real clear to me, but they aren't clear to everyone else. And they won't remain clear to me either. and everyone is the in the same boat.</p>



<a name="153877983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877983">(Mar 18 2017 at 11:14)</a>:</h4>
<p>so I think that we should gather feedback and see</p>



<a name="153877984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877984">(Mar 18 2017 at 11:15)</a>:</h4>
<p>I do it while loading the R2 definitions into R3: </p>
<div class="codehilite"><pre>    if (patchUrls) {
      for (BundleEntryComponent be : b.getEntry()) {
        if (be.hasResource() &amp;&amp; be.getResource() instanceof StructureDefinition) {
          StructureDefinition sd = (StructureDefinition) be.getResource();
          sd.setUrl(sd.getUrl().replace(&quot;http://hl7.org/fhir/&quot;, &quot;http://hl7.org/fhir/DSTU2/&quot;));
          sd.addExtension().setUrl(&quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-namespace&quot;).setValue(new UriType(&quot;http://hl7.org/fhir&quot;));
        }
      }
    }
</pre></div>



<a name="153877986"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153877986" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153877986">(Mar 18 2017 at 11:19)</a>:</h4>
<p>Right, so there is some hacking involved for resolving. I'll leave you to finalizing R3 as I'm sure you'll need your time. Let's revisit this with wider implementer input. If that input doesn't come, then it may not be a big enough issue.</p>



<a name="153878561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153878561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marten Smits <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153878561">(Mar 20 2017 at 12:12)</a>:</h4>
<p>For Simplifier we will definetely run into issues here.  Since we currently have uploaded the DSTU2 definitions. When the R3 definitions have the same canonical URL (which they currently have), we will have to do some hacking to make multiversioning happen. It would have our preference that the canonical URL of the resource will change with its FHIR version (since there are a lot of breaking changes).</p>



<a name="153878562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153878562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marten Smits <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153878562">(Mar 20 2017 at 12:19)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  I know this is really late, however would it be an idea to change the base from <code>http://hl7.org/fhir/</code> to   <code>http://hl7.org/fhir/STU3/</code>in the url of the resource definitions, as you did with DSTU2 above?</p>



<a name="153878584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153878584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marc de Graauw <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153878584">(Mar 20 2017 at 14:11)</a>:</h4>
<p>There are several pieces on the internet advocating versioning by media type instead of url. Something like: application/fhir+json.stu3 and application/fhir+json.dstu2 would retrieve the appropriate resources from the canonical url. And application/fhir+json would get either the first or the last. See for instance <a href="https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/" target="_blank" title="https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/">https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/</a> or others. Not sure whether I like this approach, but it is a option to keep url's stable while still having versioning. The main idea is 'the url's identify the resources, not the version of the resources" - which in itself is a reasonable idea.</p>
<p>Oops, same link I posted was already in another thread yesterday which I didn't follow well enough, apologies.</p>



<a name="153878589"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/StrucDef.url%20and%20base/near/153878589" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/StrucDef.2Eurl.20and.20base.html#153878589">(Mar 20 2017 at 14:47)</a>:</h4>
<p>-1 on changing the cannonical URL.   I'm not a huge fan of changing the URL either.  Once we're in normative, neither should matter and it would be good to have implementers get used to that and rely on context (what endpoint is hit, etc.) to differentiate until then.  We should however be changing the business version.  Cannonical URL + business version should get you to an official release.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
