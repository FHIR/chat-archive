---
layout: page
title: "FHIR Chat  · Database Migrations - HAPI · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html">Database Migrations - HAPI</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153904104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Database%20Migrations%20-%20HAPI/near/153904104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Bell <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html#153904104">(Aug 30 2017 at 19:32)</a>:</h4>
<p>I've created a HAPI server using the hapi-fhir-jpaserver-base as a dependency. My project is following closely with the jpaserver-example project that exists in the fhir repo. I've noticed that that project uses the hibernate auto gen mode <code>auto</code>. This is not something I am comfortable using in a production environment due to its adverse results. I can't seem to find any docs or anyone else with a better migration plan for the built in hapi server. Are people really using <code>auto</code> mode in their environments?<br>
Also, after much testing and attempts at generating liquibase logs for an initial database it seems like the project is rather weird with hibernate.<br>
For example, if you run with hibernate.ddl mode <code>create</code>, and then immediately stop and run with mode <code>validate</code> - it will fail to startup. This is very alarming to me personally, as that means hibernate is not validating and or updating properly when there are changes to the schema in the entity models.<br>
Has no one released how they use HAPI in a production environment that needs more stable database migrations? I feel like I am missing something important.</p>



<a name="153904130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Database%20Migrations%20-%20HAPI/near/153904130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html#153904130">(Aug 30 2017 at 22:20)</a>:</h4>
<p>We use flyway for migrations, with jpa/hibernate, but not (yet) in exactly the same context as you describe</p>



<a name="153904132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Database%20Migrations%20-%20HAPI/near/153904132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Bell <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html#153904132">(Aug 30 2017 at 22:59)</a>:</h4>
<p>How did you generate your original initial database? Was it used hibernate create, then take a snapshot/dump of the database? I have been unsuccessful with this approach using liquibase, which is how it would normally be done. It seems to miss some index/foreign key related things.</p>



<a name="153904156"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Database%20Migrations%20-%20HAPI/near/153904156" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html#153904156">(Aug 31 2017 at 06:29)</a>:</h4>
<p>Yeah. We switch it to update to create it, turn on the hibernate sql logging to get the table/constraint definitions (or pull them out of the database itself) to get the migrations, then turn it back to validate mode. (still need to test the migrations on different databases, since the sql often isn't portable)</p>



<a name="153904157"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Database%20Migrations%20-%20HAPI/near/153904157" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html#153904157">(Aug 31 2017 at 06:29)</a>:</h4>
<p>its finicky</p>



<a name="153904158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Database%20Migrations%20-%20HAPI/near/153904158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html#153904158">(Aug 31 2017 at 06:31)</a>:</h4>
<p>i think the initial database schema we pulled out of the database itself, rather than relying on the hibernate ddl logging</p>



<a name="153904237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Database%20Migrations%20-%20HAPI/near/153904237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Bell <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html#153904237">(Aug 31 2017 at 20:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191376">@Jim Steel</span> Did you guys end up just turning ddl auto mode to <code>none</code>? I would of liked to use <code>validate</code> mode, but it seems that doesn't even properly work on it's own (if you use create mode then validate immediately after it fails, seems like a bad thing with the base jpa server and how it uses hibernate)</p>



<a name="153904538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Database%20Migrations%20-%20HAPI/near/153904538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Database.20Migrations.20-.20HAPI.html#153904538">(Sep 06 2017 at 00:04)</a>:</h4>
<p>No, we still use <code>validate</code>. Once again, though, we don't use HAPI's base JPA server, so I can't comment on how it uses hibernate.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
