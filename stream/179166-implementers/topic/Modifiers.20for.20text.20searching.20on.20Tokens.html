---
layout: page
title: "FHIR Chat  · Modifiers for text searching on Tokens · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html">Modifiers for text searching on Tokens</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="243436827"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243436827" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243436827">(Jun 21 2021 at 20:15)</a>:</h4>
<p>There's an inconsistency in the specification around the use of the :text modifier on token searches.</p>
<p>The specification says that the :text modifier "the match does a partial searches on the text portion of a CodeableConcept or the display portion of a Coding"</p>
<p>But it also says: "the search functions as a normal string search"</p>
<p>Those are not the same thing since a normal string search is left match only. (they were, once, so whatever we do counts as at least as a technical correction). And we don't want left match search only in this case. </p>
<p>But what do we want in this case? That's not so obvious, and we didn't quickly come to resolution on the FHIR-I call where we just discussed it. Partly that's because we're not clear on the use case boundaries. For instance, I've only seen the :text modifier used where a human is driving the search interactively - that matches the use of the :text modifier on a normal string search: we've never said exactly how this works, and we say explicitly that we don't specify it, on the grounds that the use case is some human searching speculatively and adapting to the behavior of the system. But is that what we expect for this field?</p>
<p>Given that, we'd like some feedback, in two different ways:</p>
<ul>
<li>if you have implemented :text search on a token search in your server, how did you do it, and why?</li>
<li>what you would you like it to do, and why?</li>
</ul>



<a name="243551949"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243551949" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Venton <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243551949">(Jun 22 2021 at 17:36)</a>:</h4>
<p>As a user I would have no idea if the keyword I was looking for is the 1st word, last word or some other position in any coding system. (What's a coding system?) My expectation would be to return everything that might be what I'm looking for. "Diabetes" Code.coding = "mellitus, Diabetes, Type 2" or "Diabetes, type" or .text = "Suspect Diabetes II". </p>
<p>In FHIR words it would be essentially :contains. Case independent, whitespace squashed, special characters removed, contains. <br>
If I'm not a layperson, an actual clinical organization then it's likely I'd be searching by the code(s).</p>
<p>When it comes time for my requirements around implementing :text, that is what I'll be specifying.</p>



<a name="243562158"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243562158" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243562158">(Jun 22 2021 at 18:50)</a>:</h4>
<p><code>:contains</code> is substring search. When searching "eight", word based search returns like "every eight hour". <code>:contains</code> substring search returns "body weight" also.</p>



<a name="243562213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243562213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243562213">(Jun 22 2021 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="195344">@Paul Lynch</span></p>



<a name="243573203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243573203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Venton <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243573203">(Jun 22 2021 at 20:16)</a>:</h4>
<p>Yes, because if I'm a user (non-clinical) and I'm searching for my "weight" observations. I likely have no way to know that the actual dictionary definition of the observation is "body weight". Returning 0 records is dirty, you didn't specify the right magic word. There are no observations that "start-with" weight. Which is why I say a token param with a text modifier like "code:text" does the same operation that a StringParam:contains does.</p>



<a name="243694023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243694023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243694023">(Jun 23 2021 at 18:32)</a>:</h4>
<p>:contains is definitely an improvement over left-matching, but it has the drawback that it finds the middle of words, as <span class="user-mention" data-user-id="191506">@Yunwei Wang</span>   pointed out.  What users would want is matching on the start of words, not the middle of words.  So, (to borrow Yunwei's example) "weight" should match "body weight" but "eight" should not match "body weight".    However, if :contains behavior were the best that could be done for code:text, I would take it.</p>



<a name="243706870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243706870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243706870">(Jun 23 2021 at 20:19)</a>:</h4>
<p>why would you not want matching on the middle of words? Prefixing is a common practice...</p>



<a name="243714074"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243714074" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243714074">(Jun 23 2021 at 21:16)</a>:</h4>
<p>If you are trying to do autocompletion, and the user types "h", they are expecting to see words beginning with "h", not containing "h".</p>



<a name="243789250"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243789250" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243789250">(Jun 24 2021 at 13:54)</a>:</h4>
<p>I use case I have is that when search <code>cancer lung</code>,  the results includes "lung cancer", "cancer of left lung", and "cancer of right lung". So the search is based on "any concept has both words lung and word cancer ignoring the order"</p>



<a name="243789529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243789529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243789529">(Jun 24 2021 at 13:56)</a>:</h4>
<p>Simple substring :contains could not achieve that.</p>



<a name="243826424"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243826424" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243826424">(Jun 24 2021 at 18:24)</a>:</h4>
<p>Generally, the Google implementation uses three kinds of search - exact, substring, and word-based (i.e. matches entire words, in any order, occurring anywhere in the string, like....google search). Prefix search is pretty uncommon.</p>
<p>Our token:text is word-based. This covers most of the cases people have mentioned, without running into the substring matching problems of "eight" matching "weight" which seems unhelpful. To be really fancy you'd do stemming and synonyms on top of that, so "weight" still matches "weights" (we're not doing that currently).</p>
<p>This is what we think it should do. For that matter, it would be nice if default string search did the same but I suppose that ship has sailed.</p>



<a name="243836666"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243836666" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Venton <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243836666">(Jun 24 2021 at 19:43)</a>:</h4>
<p>If your parameter is specified as a TokenOrList then would you not query by:<br>
token:text=lung,cancer<br>
check the text of the token for lung or cancer? And if your :text modifier executes as a string:contains....<br>
Maybe a TokenAndListParam<br>
token:text=lung&amp;token:text=cancer</p>



<a name="243847444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/243847444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#243847444">(Jun 24 2021 at 21:11)</a>:</h4>
<p>What do you mean "TokenOrList"?</p>



<a name="249763083"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/249763083" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#249763083">(Aug 17 2021 at 18:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197072">Paul Church</span> <a href="#narrow/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens/near/243826424">said</a>:</p>
<blockquote>
<p>Our token:text is word-based. </p>
</blockquote>
<p>I just wanted a note here that Google's "word-based" searching is not the same as word-boundary matching. In our experience with Google's FHIR implementation, searching on code:text only matches on complete words, and won't match prefixes (unless maybe we're missing some configuration option).  To be able to match as the user types, to provide a continually updated list of suggestions, prefix matching at word boundaries is needed.  For example, "w" should match "body weight" (but  "e" should not match it).</p>
<p>I agree the specification's decription of :text is ambiguous enough to allow for Google's interpretation, though.</p>



<a name="249819738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/249819738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#249819738">(Aug 18 2021 at 08:15)</a>:</h4>
<p>Aidbox implemented it as <code>ilike</code> (contains)</p>



<a name="249879092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/249879092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#249879092">(Aug 18 2021 at 16:55)</a>:</h4>
<p>I would expect a full text search here. There are many full text search algorithms like trigrams or distance based like Levenshtein.</p>



<a name="249980775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Modifiers%20for%20text%20searching%20on%20Tokens/near/249980775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Modifiers.20for.20text.20searching.20on.20Tokens.html#249980775">(Aug 19 2021 at 12:48)</a>:</h4>
<p>trigram is ilike optimization :)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
