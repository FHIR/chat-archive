---
layout: page
title: "FHIR Chat  · Batch validation · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html">Batch validation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="244305694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244305694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RB Johnson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244305694">(Jun 29 2021 at 16:05)</a>:</h4>
<p>When parsing a Batch Bundle request how should validation be handled?<br>
I see two ways this could be handled:</p>
<ul>
<li>Validation is run on the whole Batch request to ensure it is valid FHIR and a validation error fails the entire batch.</li>
<li>Validation is run on the Bundle component of the Batch request to ensure it is a valid Batch Bundle and then each request in the Batch is validated independently. A validation error on the Bundle fails the Batch, but validation errors on the included requests only fail that part of the Batch.</li>
</ul>
<p>Is there a consensus on which is correct behavior?</p>



<a name="244307076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244307076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RB Johnson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244307076">(Jun 29 2021 at 16:15)</a>:</h4>
<p>Grahame's and Vonk's test servers and the Azure API for FHIR  fail the entire Batch for a validation error in one of the requests. If this is the consensus among implementers, can it be reflected in the spec?</p>



<a name="244314775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244314775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244314775">(Jun 29 2021 at 17:09)</a>:</h4>
<p>It's up to a server to decide how (and if) it wants to validate.  Some types of errors may prevent parsing of the instance at all.  Depending on parsing strategy, it may be possible to process parts of the batch prior to detecting the bad syntax.  Right now, we assume that the entire thing is parsed before any responses are provided because a conformant (non global fail) response requires a matching number of entries in the response Bundle, and you can't really do that unless you've at least been able to parse the whole thing.  Beyond that, whether you validate everything before you start processing or validate each entry or do a mixture is up to you.</p>



<a name="244319764"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244319764" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244319764">(Jun 29 2021 at 17:45)</a>:</h4>
<p>I agree that failing the entire batch for any validation error is generally the way to go - for one thing, can you really check that there are no inter-dependencies among batch entries if some of them aren't even valid?</p>



<a name="244320539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244320539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244320539">(Jun 29 2021 at 17:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197072">Paul Church</span> <a href="#narrow/stream/179166-implementers/topic/Batch.20validation/near/244319764">said</a>:</p>
<blockquote>
<p>I agree that failing the entire batch for any validation error is generally the way to go - for one thing, can you really check that there are no inter-dependencies among batch entries if some of them aren't even valid?</p>
</blockquote>
<p>The Spec says:</p>
<blockquote>
<p>The actions may be performed independently as a "batch", or as a single atomic "transaction" where the entire set of changes succeed or fail as a single entity</p>
</blockquote>



<a name="244320590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244320590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244320590">(Jun 29 2021 at 17:51)</a>:</h4>
<p>so my expectation would be counter to <span class="user-mention" data-user-id="197072">@Paul Church</span></p>



<a name="244320608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244320608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244320608">(Jun 29 2021 at 17:51)</a>:</h4>
<p>Yes, usually batch bundles are independent events within and transactions are atomic and all fail if one fails.</p>



<a name="244320774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244320774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244320774">(Jun 29 2021 at 17:53)</a>:</h4>
<p>So, you can validate a batch in parallel and fail those (with resulting status) that are invalid and a transaction bundle is validated all at once and then the transactions processed</p>



<a name="244321506"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244321506" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244321506">(Jun 29 2021 at 17:58)</a>:</h4>
<p>As far as I'm concerned, a Bundle is a single resource that either passes or fails validation.</p>
<p>If some contained resource fails validation, its container can't go on as if it was a valid resource. Bundles are no different.</p>



<a name="244321630"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244321630" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244321630">(Jun 29 2021 at 17:59)</a>:</h4>
<p>Batch and Transaction Bundles are envelopes.  The Bundle itself needs to be valid but if the entry resource fails, the rest of the batch entries can still be processed</p>



<a name="244323504"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244323504" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244323504">(Jun 29 2021 at 18:10)</a>:</h4>
<p>Are there any implementations that will process some of the batch entries when some don't validate?</p>



<a name="244323781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244323781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244323781">(Jun 29 2021 at 18:12)</a>:</h4>
<blockquote>
<p>I agree that failing the entire batch for any validation error is generally the way to go - for one thing, can you really check that there are no inter-dependencies among batch entries if some of them aren't even valid?</p>
</blockquote>
<p><a href="http://build.fhir.org/http.html#brules">Batch rules are quite prescriptive</a> and strongly lean towards independent processing of each entry, and not failing the entire batch, but I don't know if they are practical:</p>
<blockquote>
<p>For a batch, there SHALL be no interdependencies between the different entries in the Bundle that cause change on the server. The success or failure of one change SHOULD not alter the success or failure or resulting content of another change. Servers SHOULD validate that this is the case. Note that it is considered that servers execute the batch in the same order as that specified below for transactions, though the order of execution should not matter given the previous rule.</p>
<p>References within a Bundle.entry.resource to another Bundle.entry.resource that is being created within the batch are considered to be non-conformant.</p>
<p>When processing the batch, the HTTP response code is 200 Ok if the batch was processed correctly, regardless of the success of the operations within the Batch. To determine the status of the operations, look inside the returned Bundle. A response code on an entry of other than 2xx (200, 202 etc) indicates that processing the request in the entry failed.</p>
</blockquote>



<a name="244324374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244324374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244324374">(Jun 29 2021 at 18:16)</a>:</h4>
<p>If you want to write A,B and C in a batch bundle to serverX and server will only accept A, but A references B and C I assume for referential integitry reasons you would fails the whole batch bundle.  but what if A,B,C were completely independent of each other?</p>



<a name="244324440"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244324440" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244324440">(Jun 29 2021 at 18:17)</a>:</h4>
<p>References within a Bundle.entry.resource to another Bundle.entry.resource that is being created within the batch are considered to be non-conformant.</p>



<a name="244324474"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244324474" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244324474">(Jun 29 2021 at 18:17)</a>:</h4>
<p>They must be completely independent</p>



<a name="244326863"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Batch%20validation/near/244326863" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Batch.20validation.html#244326863">(Jun 29 2021 at 18:33)</a>:</h4>
<p>the batch itself is a bundle; servers are OK to reject the entire batch if the bundle is not valid</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
