---
layout: page
title: "FHIR Chat  · c# Validationlibrary not threadsafe · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html">c# Validationlibrary not threadsafe</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153864542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon-Vidar Schneider <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864542">(Dec 21 2016 at 08:36)</a>:</h4>
<p>We are using the new c# validation functionality. It seems that the code is not threadsafe. It started when we got some random errors. When running a test running 100000 tasks in parallell we are getting some random errors as well. To improve the performance in our service I have set the Validator object as static. I have attached the output.<a href="/user_uploads/10155/uNv_G5U-gWEuCjccrtBvSTEp/threadrun.xml" target="_blank" title="threadrun.xml">threadrun.xml</a> </p>
<p>It works fine if I put a lock around validator.Validate(someXmlReader), that ofcourse reduces the performance.</p>
<p>The code for setting up the validator looks like this: <br>
 var profilePath = Path.Combine(directoryInfo.FullName) + @"\Definitions";<br>
                    var coreSource = new CachedResolver(ZipSource.CreateValidationSource());<br>
                    var cachedResolver = new CachedResolver(new DirectorySource(profilePath, includeSubdirectories: true));<br>
                    var combinedSource = new MultiResolver(cachedResolver, coreSource);<br>
                    var settings = ValidationSettings.Default;<br>
                    settings.EnableXsdValidation = validateXsd;<br>
                    settings.GenerateSnapshot = true;<br>
                    settings.Trace = showTrace;<br>
                    settings.ResourceResolver = combinedSource;<br>
                    _validator = new Validator(settings);</p>



<a name="153864737"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864737" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864737">(Dec 22 2016 at 04:22)</a>:</h4>
<p>This should probably be moved across to the dotnet thread<br>
<a href="https://chat.fhir.org/#narrow/stream/dotnet" target="_blank" title="https://chat.fhir.org/#narrow/stream/dotnet">https://chat.fhir.org/#narrow/stream/dotnet</a></p>



<a name="153864753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martijn Harthoorn <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864753">(Dec 22 2016 at 12:17)</a>:</h4>
<p><span class="user-mention" data-user-id="192439">@Jon-Vidar Schneider</span> - Thanks for the feedback. We'll make note of it. But beware that the Validator is still an alpha release. There also is a known issue around bi-directional references, which causes a stack overflow.</p>



<a name="153864754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martijn Harthoorn <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864754">(Dec 22 2016 at 12:21)</a>:</h4>
<p>I created an issue of it: <a href="https://github.com/ewoutkramer/fhir-net-api/issues/280" target="_blank" title="https://github.com/ewoutkramer/fhir-net-api/issues/280">https://github.com/ewoutkramer/fhir-net-api/issues/280</a></p>



<a name="153864755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon-Vidar Schneider <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864755">(Dec 22 2016 at 12:28)</a>:</h4>
<p>Thank you. We are also getting some other random errors, even not with this threadissue. We are going to disable the validation on our production enviroment until we get a solution for all these errors. Will create issues for them in github.</p>



<a name="153864787"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864787" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864787">(Dec 22 2016 at 15:23)</a>:</h4>
<p>Please note that the FHIR .NET API validator is still under development and not yet ready for production environments. For example, slicing validation needs some more work, as well as the interaction with the snapshot generator. Also the validator still needs to detect and handle endless recursion (e.g. Organization.partOf =&gt; Organization). Feel free to evaluate/test the code and submit bugs!</p>



<a name="153864789"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864789" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jon-Vidar Schneider <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864789">(Dec 22 2016 at 15:25)</a>:</h4>
<p>We will. We are only using it in the development phase so we don't deliver fhir-services that is not valid according to the customized profiles.</p>



<a name="153864853"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864853" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864853">(Dec 22 2016 at 23:17)</a>:</h4>
<p>You can however use the invariant validation code in there, it is quite good.<br>
All the examples pass through it, and i've been using it on our server for some time now.</p>



<a name="153864854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864854">(Dec 22 2016 at 23:18)</a>:</h4>
<p>There is a unit test that checks this if you want to see how to use it.</p>



<a name="153864855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/c%23%20Validationlibrary%20not%20threadsafe/near/153864855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/c.23.20Validationlibrary.20not.20threadsafe.html#153864855">(Dec 22 2016 at 23:18)</a>:</h4>
<p>(and is in both DSTU2 and STU3)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
