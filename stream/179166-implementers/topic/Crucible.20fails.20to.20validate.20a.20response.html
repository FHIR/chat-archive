---
layout: page
title: "FHIR Chat  · Crucible fails to validate a response · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html">Crucible fails to validate a response</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="160790918"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160790918" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160790918">(Mar 14 2019 at 15:22)</a>:</h4>
<p>Hi, I am trying to understand why crucible thinks that the test <a href="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c8a6caf04ebd0675a000008/history001/HI08" target="_blank" title="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c8a6caf04ebd0675a000008/history001/HI08">https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c8a6caf04ebd0675a000008/history001/HI08</a> did not return a bundle. If I look at the response: <a href="https://projectcrucible.org/servers/5c89107d04ebd024be000000#0-response" target="_blank" title="https://projectcrucible.org/servers/5c89107d04ebd024be000000#0-response">https://projectcrucible.org/servers/5c89107d04ebd024be000000#0-response</a> I see the xml bundle just fine. Any hints?</p>



<a name="160794860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160794860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160794860">(Mar 14 2019 at 15:58)</a>:</h4>
<p><span class="user-mention" data-user-id="191381">@Jason Walonoski</span> ?</p>



<a name="160818424"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160818424" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160818424">(Mar 14 2019 at 20:19)</a>:</h4>
<p><span class="user-mention" data-user-id="192576">@Robert Scanlon</span> Similar issue to this? <a href="#narrow/stream/179204-crucible/topic/Can't.20figure.20out.20why.20test.20fails/near/157278207" title="#narrow/stream/179204-crucible/topic/Can't.20figure.20out.20why.20test.20fails/near/157278207">https://chat.fhir.org/#narrow/stream/179204-crucible/topic/Can't.20figure.20out.20why.20test.20fails/near/157278207</a></p>



<a name="160819854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160819854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160819854">(Mar 14 2019 at 20:36)</a>:</h4>
<p>Hmmm, looking into it now.</p>



<a name="160824526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160824526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160824526">(Mar 14 2019 at 21:31)</a>:</h4>
<p>This appears to be Crucible's fault.  I put in a candidate fix but will be a little while before it gets deployed.  <span class="user-mention" data-user-id="191381">@Jason Walonoski</span> : <a href="https://github.com/fhir-crucible/fhir_client/pull/110" target="_blank" title="https://github.com/fhir-crucible/fhir_client/pull/110">https://github.com/fhir-crucible/fhir_client/pull/110</a></p>



<a name="160856872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160856872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160856872">(Mar 15 2019 at 08:49)</a>:</h4>
<p>Ah perfect. I have no issue with waiting, I am glad it is not an issue in my code :) Thank you!</p>



<a name="160872246"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160872246" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160872246">(Mar 15 2019 at 13:04)</a>:</h4>
<p>No problem, thanks for the report!  One thing I am noticing is that the order of the entries in the bundle don't always appear to be in the right order, but that issue is being masked by this problem.</p>



<a name="160872373"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160872373" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160872373">(Mar 15 2019 at 13:06)</a>:</h4>
<div class="codehilite"><pre><span></span>      PASS hi01_history_for_specific_resource_test:
      PASS hi01.1_history_request_entries_test:
      PASS hi02_full_history_of_a_resource_by_id_with_since_test:
      PASS hi03_individual_history_versions_test:
      PASS hi04_history_for_missing_resource_test:
      **FAIL hi06_all_history_for_resource_with_since_test: Result contains entries in the wrong order.**
      PASS hi08_all_history_whole_system_with_since_test:
      PASS hi09_resource_history_page_forward_test:
      PASS hi10_resource_history_page_backwards_test:
      PASS hi11_first_page_full_history_test:
Execute HistoryTest completed in 19.866114000004018 seconds.
</pre></div>



<a name="160872638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160872638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160872638">(Mar 15 2019 at 13:09)</a>:</h4>
<p>Sometimes it works, sometimes it doesn't, which makes me think that your DB tends to return the data in the right order based on how the data happens to be accessed, but there isn't an explicit sort in there</p>



<a name="160872702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160872702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160872702">(Mar 15 2019 at 13:10)</a>:</h4>
<p>(that is total speculation though)</p>



<a name="160872754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/160872754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#160872754">(Mar 15 2019 at 13:11)</a>:</h4>
<p><span class="user-mention" data-user-id="192576">@Robert Scanlon</span> Yes I also saw that one, but couldn't figure out what the expected order is. I am currently sorting strictly by "creation_timestamp DESC" which should mean that newer entries should show up first (every operation creates a new entry and as such also a new version). Also to get the crucible tests passing I have to truncate my database before the testrun because it otherwise fetches old entries marked as deleted (not yet sure if I implement something against the spec here or of the tests in crucible are having issues here)</p>



<a name="161088883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161088883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161088883">(Mar 18 2019 at 19:34)</a>:</h4>
<p><span class="user-mention" data-user-id="213323">@Florian Apolloner</span> -- We deployed a fix to the issue where the bundle wasn't recognized, so that should be all set.</p>



<a name="161089174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161089174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161089174">(Mar 18 2019 at 19:38)</a>:</h4>
<p>I'm curious about the other issues though.  I assume what is being returned now is that issue you need to truncate your database to pass?</p>



<a name="161102337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161102337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161102337">(Mar 18 2019 at 22:29)</a>:</h4>
<p><span class="user-mention" data-user-id="192576">@Robert Scanlon</span> Yeah, I made a mistake there when removing the 'resource' objects for deleted entries. Fixed that and now I get invalid order again: <a href="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c901b6804ebd01d60000002/history001/HI06" target="_blank" title="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c901b6804ebd01d60000002/history001/HI06">https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c901b6804ebd01d60000002/history001/HI06</a> -- having a hard time figuring out why though :/</p>



<a name="161102480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161102480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161102480">(Mar 18 2019 at 22:31)</a>:</h4>
<p>Ah, I think I failed in incrementing my version ID when recreating a deleted entry.</p>
<p>EDIT:// Nope, something else seems to be going on there. I noticed that crucible does a PUT with a versionId in the test-setup for that test. Is that allowed? I've left the data as it is currently in the broken state, maybe you have an idea.</p>
<p>Do I really need to order by version_id instead of just a time based history?</p>



<a name="161103210"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161103210" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161103210">(Mar 18 2019 at 22:42)</a>:</h4>
<p>ie <a href="https://bap-fhir.herokuapp.com/fhir/STU3/Patient/_history?_since=2019-03-18T22%3A26%3A53Z" target="_blank" title="https://bap-fhir.herokuapp.com/fhir/STU3/Patient/_history?_since=2019-03-18T22%3A26%3A53Z">https://bap-fhir.herokuapp.com/fhir/STU3/Patient/_history?_since=2019-03-18T22%3A26%3A53Z</a> currently returns vids 4,3,2,1,4,3,2,1 (since it returns 2 resources), should that return 4,4,3,3,2,2,1,1 instead?</p>



<a name="161154371"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161154371" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161154371">(Mar 19 2019 at 14:21)</a>:</h4>
<p>Doing a create and an update with a meta.versionId is valid, but the server should ignore them and put in their own values: "If the request body includes a meta, the server SHALL ignore the existing versionId and lastUpdated values. The server SHALL populate the id, meta.versionId and meta.lastUpdated with the new correct values." <a href="http://hl7.org/fhir/stu3/http.html#create" target="_blank" title="http://hl7.org/fhir/stu3/http.html#create">http://hl7.org/fhir/stu3/http.html#create</a></p>



<a name="161154533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161154533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161154533">(Mar 19 2019 at 14:23)</a>:</h4>
<p>Similar language is in there for updates <a href="http://hl7.org/fhir/stu3/http.html#update" target="_blank" title="http://hl7.org/fhir/stu3/http.html#update">http://hl7.org/fhir/stu3/http.html#update</a></p>



<a name="161154677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161154677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161154677">(Mar 19 2019 at 14:24)</a>:</h4>
<p>Now, it appears that Crucible is wrong in that it assumes there is a global incrementing versionId:    <a href="https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/history_test.rb#L307" target="_blank" title="https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/history_test.rb#L307">https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/history_test.rb#L307</a></p>



<a name="161154870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161154870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161154870">(Mar 19 2019 at 14:27)</a>:</h4>
<p>"The version can be globally unique, or scoped by the Logical Id of the resource. Version identifiers are generally either a serially incrementing id scoped by the logical id, or a uuid, though neither of these approaches is required. There is no fixed order for version ids - clients cannot assume that a versionId that comes after another one either numerically or alphabetically represents a later version. The same versionId can never be used for more than one version of the same resource." <a href="http://hl7.org/fhir/stu3/resource.html#metadata" target="_blank" title="http://hl7.org/fhir/stu3/resource.html#metadata">http://hl7.org/fhir/stu3/resource.html#metadata</a></p>



<a name="161155055"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161155055" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161155055">(Mar 19 2019 at 14:29)</a>:</h4>
<p>So i think we need to remove that line, and perhaps add some logic to make sure that versionIds are not reused within a single resource.</p>



<a name="161155469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161155469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161155469">(Mar 19 2019 at 14:33)</a>:</h4>
<p>FYI <span class="user-mention" data-user-id="191381">@Jason Walonoski</span>, let me know if there is something I'm not considering here.  I think this part of the test might have been from an early version of FHIR that did not have concrete guidance on version ids.</p>



<a name="161161823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161161823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161161823">(Mar 19 2019 at 15:41)</a>:</h4>
<p>Yes, it looks like incrementing version ids are not required... which is sad, because it means they are totally opaque and meaningless. We need to change the logic that you linked to.</p>



<a name="161165351"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161165351" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161165351">(Mar 19 2019 at 16:21)</a>:</h4>
<p><span class="user-mention" data-user-id="192576">@Robert Scanlon</span> Ah yes, I have version numbers per resource_id, not something globally unique, even though that would be easily doable. Thank you for your help!</p>



<a name="161169040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161169040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161169040">(Mar 19 2019 at 17:01)</a>:</h4>
<p><span class="user-mention" data-user-id="213323">@Florian Apolloner</span> -- To be clear, version ids don't have to be globally unique, just unique on a per resource basis, according to the spec.  But you can make them globally unique if you'd like (uuids would do that).  We'll update our tests to remove the logic that assumes they are incrementing integers and will update here when that is deployed.  Thanks again!</p>



<a name="161420485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161420485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161420485">(Mar 22 2019 at 04:58)</a>:</h4>
<p><span class="user-mention" data-user-id="213323">@Florian Apolloner</span> -- fixed the issue on our side with requiring incrementing global versioning and now it looks good.  <a href="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c946aeb04ebd0266c000002/history001/HI01" target="_blank" title="https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c946aeb04ebd0266c000002/history001/HI01">https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c946aeb04ebd0266c000002/history001/HI01</a></p>



<a name="161429763"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Crucible%20fails%20to%20validate%20a%20response/near/161429763" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Crucible.20fails.20to.20validate.20a.20response.html#161429763">(Mar 22 2019 at 08:38)</a>:</h4>
<p>Ah lovely. Many thanks!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
