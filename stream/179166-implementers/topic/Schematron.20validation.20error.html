---
layout: page
title: "FHIR Chat  · Schematron validation error · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html">Schematron validation error</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153856466"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153856466" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Royce <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153856466">(Nov 11 2016 at 01:42)</a>:</h4>
<p>Can anyone help me with this?  I'm getting this error when I do schematron validation of my FHIR logical models (<code>StructureDefinitions</code>):</p>
<div class="codehilite"><pre>sdf-7: If the structure describes a base Resource or Type, the URL has to start with &quot;http://hl7.org/fhir/StructureDefinition/&quot; and the tail must match the id
</pre></div>


<p>I looked at the <a href="http://build.fhir.org/structuredefinition-definitions.html#StructureDefinition" target="_blank" title="http://build.fhir.org/structuredefinition-definitions.html#StructureDefinition">StructureDefinition documentation</a> and under sdf-7 the expression includes "...or  (kind = 'logical')..." so I would expect that I wouldn't get this error.  However, I did notice that the XPath expression does not include a phrase equivalent to "...or  (kind = 'logical')...".  So, am I doing something wrong, or is there a bug in the sdf-7 constraint specification?</p>



<a name="153856467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153856467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153856467">(Nov 11 2016 at 01:50)</a>:</h4>
<p>does your url start with '<a href="http://hl7.org/fhir/StructureDefinition/" target="_blank" title="http://hl7.org/fhir/StructureDefinition/">http://hl7.org/fhir/StructureDefinition/</a>'</p>



<a name="153856468"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153856468" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Royce <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153856468">(Nov 11 2016 at 01:54)</a>:</h4>
<p>No.  But these are logical models; it shouldn't have to should it?</p>



<a name="153856469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153856469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Royce <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153856469">(Nov 11 2016 at 01:56)</a>:</h4>
<p>The relevant parts of the XML look like this:</p>
<div class="codehilite"><pre>    &lt;id value=&quot;lm-AdverseReaction&quot;/&gt;
...
    &lt;url value=&quot;http://mct-cidbstg-01:8080/exist/apps/cimm/StructureDefinition/lm-AdverseReaction&quot;/&gt;
...
    &lt;kind value=&quot;logical&quot;/&gt;
    &lt;abstract value=&quot;false&quot;/&gt;
    &lt;type value=&quot;AdverseReaction&quot;/&gt;
    &lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/DomainResource&quot;/&gt;
    &lt;derivation value=&quot;specialization&quot;/&gt;
</pre></div>



<a name="153856470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153856470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Royce <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153856470">(Nov 11 2016 at 02:04)</a>:</h4>
<p>The constraint specification in the <code>StructureDefinition</code> resource looks like this:</p>
<div class="codehilite"><pre>      &lt;constraint&gt;
        &lt;key value=&quot;sdf-7&quot;/&gt;
        &lt;severity value=&quot;error&quot;/&gt;
        &lt;human value=&quot;If the structure describes a base Resource or Type, the URL has to start with &amp;quot;http://hl7.org/fhir/StructureDefinition/&amp;quot; and the tail must match the id&quot;/&gt;
        &lt;expression value=&quot;(derivation = &#39;constraint&#39;) or (kind = &#39;logical&#39;) or (url = &#39;http://hl7.org/fhir/StructureDefinition/&#39;+id)&quot;/&gt;
        &lt;xpath value=&quot;(f:derivation/@value = &#39;constraint&#39;) or f:url/@value=concat(&#39;http://hl7.org/fhir/StructureDefinition/&#39;, f:id/@value)&quot;/&gt;
      &lt;/constraint&gt;
</pre></div>


<p>The logical statements in the <code>expression</code> and <code>xpath</code> (XML) elements are not equivalent (unless kind='logical' =&gt; derivation = 'constraint').</p>



<a name="153856472"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153856472" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153856472">(Nov 11 2016 at 02:05)</a>:</h4>
<p>yes the xpath is wrong. </p>



<a name="153891870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153891870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Uday Chandrupatla <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153891870">(Jun 01 2017 at 00:55)</a>:</h4>
<p>We have noticed when validating e.g. RelatedPerson.xml structureDefinition (profile) file against structureDefinition.sch, the following schematron rules do not seem to check what the error message conveys.</p>
<p>e.g.</p>
<div class="codehilite"><pre><span></span>&lt;sch:assert test=&quot;count(*/f:element)=count(*/f:element/@id)&quot;&gt;sdf-16: All element definitions must have unique ids (snapshot)&lt;/sch:assert&gt; - 
</pre></div>


<p>The error message conveys that the snapshot element must have unique ids however, the test is performing that all the elements in the structureDefinition shall have id's and rather it is not testing the uniqueness of the <a href="http://element.id" target="_blank" title="http://element.id">element.id</a>.<br>
As a suggestion, we have come up with the following two rules which can effectively test both requirements.</p>
<div class="codehilite"><pre><span></span>&lt;sch:assert test=&quot;count(f:snapshot/f:element)=count(f:snapshot/f:element/@id)&quot;&gt;sdf-16: All element definitions must have ids (snapshot)&lt;/sch:assert&gt;
&lt;sch:assert test=&quot;count(f:snapshot/f:element)=count(distinct-values(f:snapshot/f:element/@id))&quot;&gt;sdf-ABC: All element definitions must have unique ids (snapshot)&lt;/sch:assert&gt;
</pre></div>


<p>Similar rules apply to sdf-17 schematron error as well.</p>



<a name="153891871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153891871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153891871">(Jun 01 2017 at 00:58)</a>:</h4>
<p>Hi Uday,</p>



<a name="153891872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153891872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153891872">(Jun 01 2017 at 00:58)</a>:</h4>
<p>Can you raise this as a change request?</p>



<a name="153891873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153891873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Uday Chandrupatla <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153891873">(Jun 01 2017 at 01:00)</a>:</h4>
<p>Thanks for the quick reply Lloyd, we will raise this in G Forge.</p>



<a name="153892258"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153892258" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Uday Chandrupatla <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153892258">(Jun 04 2017 at 23:31)</a>:</h4>
<p>Hi Lloyd, I have requested GForge to register me (uday_adha) to raise change request, but the request has not been approved yet. i will raise the ticket ones i get the access.</p>



<a name="153892259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153892259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153892259">(Jun 04 2017 at 23:51)</a>:</h4>
<p><span class="user-mention" data-user-id="192202">@Uday Chandrupatla</span> Sorry for the delay (and thanks for the poke).  HQ normally monitors more actively.  I've gone in and approved the request.</p>



<a name="153892260"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20validation%20error/near/153892260" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Uday Chandrupatla <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20validation.20error.html#153892260">(Jun 04 2017 at 23:55)</a>:</h4>
<p>Thanks Lloyd.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
