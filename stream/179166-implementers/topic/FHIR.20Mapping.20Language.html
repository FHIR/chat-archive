---
layout: page
title: "FHIR Chat  · FHIR Mapping Language · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html">FHIR Mapping Language</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153876957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153876957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153876957">(Mar 15 2017 at 15:17)</a>:</h4>
<p>Dear all,</p>
<p>I have a question related to managing lists in the FHIR mapping language.</p>
<p>Given the below source structure, </p>
<div class="codehilite"><pre>    TLeft
      a22 : string [0..*]
</pre></div>


<p>how to write a rule such that only the <code>index</code>-th <code>a22</code> is selected?<br>
<code>rule_name: for source.a22 as a where [FHIRPath Boolean condition] make ...</code></p>
<p>I will be grateful for any information you can provide.</p>
<p>With kind regards,<br>
Flavius</p>



<a name="153876960"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153876960" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153876960">(Mar 15 2017 at 15:23)</a>:</h4>
<p>I believe it uses FHIRPath, which means you'd just say source.a22[5] to grab the 6th repetition</p>



<a name="153876963"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153876963" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153876963">(Mar 15 2017 at 15:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> thank you for your prompt reply.</p>
<p>I gather from <a href="http://build.fhir.org/mapping-language.html" target="_blank" title="http://build.fhir.org/mapping-language.html">FHIR Mapping Language</a> that FHIRPath expressions are allowed only in the <code>where</code> and <code>check</code> clauses.<br>
<code>rule_name: for source.a22 as a where [FHIRPath Boolean condition] check [FHIRPath Boolean condition] make ...</code><br>
I've also tried something like<br>
<code>rule_name: for source.a22[5] as a make ...</code>,<br>
but the reference implementation throws the following exception.</p>
<div class="codehilite"><pre><span></span>org.hl7.fhir.dstu3.utils.FHIRLexer$FHIRLexerException: Error at 11, 3: Found &quot;5&quot; expecting &quot;:&quot;
    at org.hl7.fhir.dstu3.utils.FHIRLexer.error(FHIRLexer.java:101)
        ...
</pre></div>



<a name="153877021"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153877021" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153877021">(Mar 15 2017 at 19:05)</a>:</h4>
<p>yes this is not supported right now </p>



<a name="153877022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153877022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153877022">(Mar 15 2017 at 19:06)</a>:</h4>
<p>with the where clause:</p>



<a name="153877023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153877023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153877023">(Mar 15 2017 at 19:06)</a>:</h4>
<p>for source.a as v where v = source.a[22] make....</p>



<a name="153877419"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153877419" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153877419">(Mar 16 2017 at 10:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> thank you for your reply.</p>
<p>Unfortunately, this doesn't seem to work, although no exception is thrown.</p>



<a name="153877422"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153877422" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153877422">(Mar 16 2017 at 11:01)</a>:</h4>
<p>I'll test it when I get a chance</p>



<a name="153881605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153881605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenico <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153881605">(Apr 10 2017 at 15:45)</a>:</h4>
<p>Hi all,<br>
can you explain me what is the Fhir Mapping Language section? How can I use it?</p>



<a name="153881606"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153881606" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153881606">(Apr 10 2017 at 15:51)</a>:</h4>
<p>Start with <a href="http://hl7.org/fhir/structuremap.html" target="_blank" title="http://hl7.org/fhir/structuremap.html">StructureMap</a>.   Essentially it gives you a formal way to convert two arbitrary structure definitions.</p>



<a name="153882039"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153882039" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenico <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153882039">(Apr 12 2017 at 10:37)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  Can you give me an example ( in other words a scenario where  I can use it)?</p>



<a name="153882079"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153882079" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153882079">(Apr 12 2017 at 14:14)</a>:</h4>
<p>We're using it to map between DSTU2 models and STU3 models.  It's also been used to map from logical models to FHIR resources, from v2 models to FHIR resources, etc.</p>



<a name="153882084"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153882084" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenico <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153882084">(Apr 12 2017 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> thank you for your reply. In your opinion if I have my custom model can I use Mapping language to map my model  with STU3 model? </p>



<a name="153882089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153882089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153882089">(Apr 12 2017 at 14:51)</a>:</h4>
<p>I'm not sure my opinion is worth a lot as I haven't used the language yet.  However, it's certainly the intention that you'd be able to do that.</p>



<a name="153884840"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153884840" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153884840">(Apr 15 2017 at 20:28)</a>:</h4>
<p>yes that's the intention</p>



<a name="153887683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887683">(May 06 2017 at 16:07)</a>:</h4>
<p>Consider the source structure</p>
<div class="codehilite"><pre><span></span>    TLeft
      s : [0..1]
        ss1 : string [1..1]
        ss2 : string [1..1]
</pre></div>


<p>and the target structure</p>
<div class="codehilite"><pre><span></span>    TRight
      t : [0..1]
        tt : [1..1]
          ttt1 : string [1..1]
          ttt2 : string [1..1]
</pre></div>


<p>Let's say we want to map <code>ss1</code> to <code>ttt1</code> and <code>ss2</code> to <code>ttt2</code>. This could be done as follows:</p>
<div class="codehilite"><pre><span></span>map &quot;http://hl7.org/fhir/StructureMap/tutorial&quot; = tutorial

uses &quot;http://hl7.org/fhir/StructureDefinition/tutorial-left&quot; as source
uses &quot;http://hl7.org/fhir/StructureDefinition/tutorial-right&quot; as target

group tutorial
  input &quot;source&quot; : TLeft as source
  input &quot;target&quot; : TRight as target

rule_a : for source.s as s make target.t as t then {
  rule_aa : for s make t.tt as tt then {
    rule_aaa1 : for s.ss1 as v make tt.ttt1 = v
    rule_aaa2 : for s.ss2 as v make tt.ttt2 = v
  }
}

endgroup
</pre></div>


<p>Is there a more concise way of writing those nested rules?</p>



<a name="153887684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887684">(May 06 2017 at 16:09)</a>:</h4>
<p>you can do this:</p>
<div class="codehilite"><pre><span></span>rule_a : for source.s as s make target.t as t, t.tt as tt then {
    rule_aaa1 : for s.ss1 as v make tt.ttt1 = v
    rule_aaa2 : for s.ss2 as v make tt.ttt2 = v
}
</pre></div>



<a name="153887685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887685">(May 06 2017 at 16:15)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> It works! Many thanks!</p>



<a name="153887699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887699">(May 06 2017 at 17:58)</a>:</h4>
<p>NP</p>



<a name="153887875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887875">(May 07 2017 at 09:10)</a>:</h4>
<p>If we had a breakfast session or an evening birds of the feather here at the HL7 meeting about the mapping language, would anyone else be interested (e.g. <span class="user-mention" data-user-id="193536">@Flavius Butnariu</span> , <span class="user-mention" data-user-id="191703">@Claude Nanjo</span>, <span class="user-mention" data-user-id="191375">@Alexander Henket</span> ). If you are, it might be Tues/Wed evening, or Wed morning, or Thursday morning. Let me know if you interested and if you are, when you're available. thx</p>



<a name="153887883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887883">(May 07 2017 at 09:23)</a>:</h4>
<p>I would be, free on the time</p>



<a name="153887885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887885">(May 07 2017 at 09:24)</a>:</h4>
<p>Interested. Thurs morning is not possible. Tues/Wed evening are both fine</p>



<a name="153887886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffrey Danford <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887886">(May 07 2017 at 09:25)</a>:</h4>
<p>+1, and your timing is perfect. Either evening looks good for me.</p>



<a name="153887897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887897">(May 07 2017 at 09:56)</a>:</h4>
<p>let me know when you have converged - any time up to Wednesady</p>



<a name="153887904"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887904" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887904">(May 07 2017 at 10:10)</a>:</h4>
<p>+1</p>



<a name="153887905"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153887905" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153887905">(May 07 2017 at 10:10)</a>:</h4>
<p>we'll decide tonight, and I'll let you know here</p>



<a name="153888052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888052">(May 07 2017 at 14:55)</a>:</h4>
<p>Possibly me too.</p>



<a name="153888065"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888065" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888065">(May 07 2017 at 20:58)</a>:</h4>
<p>Wednesday 6pm to 7pm in room 3158</p>



<a name="153888109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888109">(May 08 2017 at 07:26)</a>:</h4>
<p>In which timezone is this meeting taking place?</p>



<a name="153888111"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888111" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888111">(May 08 2017 at 07:27)</a>:</h4>
<p>In FHIR mapping language, is there a way to set <code>value[x]</code> of <code>Observation</code> to a complex type (e.g., <code>Quantity</code>) rather than to a primitive type?</p>
<div class="codehilite"><pre><span></span>group src2tgt
  input src : Src as source
  input tgt : Observation as target

rule_value : for src.value as v, src.unit as u make tgt.value = ... new Quantity(v, u) ...

endgroup
</pre></div>



<a name="153888113"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888113" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888113">(May 08 2017 at 07:31)</a>:</h4>
<p>The meeting will be in Madrid at the HL7 WGM, so GMT+1 I believe</p>



<a name="153888122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888122">(May 08 2017 at 07:44)</a>:</h4>
<p>local to Madrid, where the HL7 meeting is currently being held</p>



<a name="153888124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888124">(May 08 2017 at 07:45)</a>:</h4>
<p>make Create(Quantity) as q, tgt.value = q, q....</p>



<a name="153888157"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888157" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888157">(May 08 2017 at 08:22)</a>:</h4>
<p>Although my rule looks like this</p>
<div class="codehilite"><pre><span></span>rule_value : for src.value as v make create(&quot;Quantity&quot;) as q, tgt.value = q, q.value = v
</pre></div>


<p>the reference implementation throws the following exception</p>
<div class="codehilite"><pre><span></span>org.hl7.fhir.exceptions.FHIRException: Cannot set property value on null - value is not a primitive type (Quantity) or an ElementModel type
    at org.hl7.fhir.dstu3.elementmodel.Element.setProperty(Element.java:297)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.processTarget(StructureMapUtilities.java:1579)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1206)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1210)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1210)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1191)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.transform(StructureMapUtilities.java:1165)
    ...
</pre></div>



<a name="153888163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888163">(May 08 2017 at 08:39)</a>:</h4>
<p>I believe the issue is in method <code>runTransform</code> of class <code>StructureMapUtilities</code>, which returns a <code>Base</code> object that looks like this <a href="/user_uploads/10155/bU8gqUhJiyuT2SCWCXhxgV3J/base.PNG" target="_blank" title="base.PNG">base.PNG</a> <br>
Are there any alternative ways of writing the rule in the FHIR mapping language?</p>
<div class="message_inline_image"><a href="/user_uploads/10155/bU8gqUhJiyuT2SCWCXhxgV3J/base.PNG" target="_blank" title="base.PNG"><img src="/user_uploads/10155/bU8gqUhJiyuT2SCWCXhxgV3J/base.PNG"></a></div>



<a name="153888169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888169">(May 08 2017 at 08:59)</a>:</h4>
<p>oh that is a bug. I think. I'll have to investigate</p>



<a name="153888170"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888170" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888170">(May 08 2017 at 08:59)</a>:</h4>
<p>it's because it's a complex type that contains a value property. dumb programming on my part</p>



<a name="153888181"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888181" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888181">(May 08 2017 at 09:29)</a>:</h4>
<p>From what I gather, the issue is that object <code>Base</code> returned by <code>runTransform</code> is an instance of <code>Type</code>. The aforementioned exception is raised because an instance of <code>Element</code> is expected. However, I see that <code>Type</code> extends <code>Element</code>, which in turn extends <code>Base</code>, so I've assumed that casting <code>Type</code> to <code>Element</code>would do the trick, but that raises another exception.</p>
<div class="codehilite"><pre><span></span>java.lang.ClassCastException: org.hl7.fhir.dstu3.model.Quantity cannot be cast to org.hl7.fhir.dstu3.elementmodel.Element
</pre></div>



<a name="153888194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888194">(May 08 2017 at 10:23)</a>:</h4>
<p>yes you're crossing different heirarchies there. I'll have to investigate this one. But it will take to time to set a test case up, unless you can feed me one</p>



<a name="153888237"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888237" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888237">(May 08 2017 at 11:52)</a>:</h4>
<p><a href="/user_uploads/10155/QvN9wqvvbbbxuQ0atlOvbxVt/structuredefinition-src.xml" target="_blank" title="structuredefinition-src.xml">structuredefinition-src.xml</a><br>
<a href="/user_uploads/10155/M6eNd1WPM4vb940hMikY_o2j/source1.xml" target="_blank" title="source1.xml">source1.xml</a></p>
<p>Let me know if these will do.</p>



<a name="153888243"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888243" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888243">(May 08 2017 at 13:35)</a>:</h4>
<p><a href="/user_uploads/10155/Eqka8uG21u3qubjRS79G4xoo/src2tgt.map" target="_blank" title="src2tgt.map">src2tgt.map</a> </p>



<a name="153888520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888520">(May 08 2017 at 16:32)</a>:</h4>
<p>At the BOF on the mapping language (Madrid Weds evening) I'd like to discuss its relation to FHIR Transform Engine, another mapping approach to data transforms.<br>
At first sight the two look quite dfifferent, but it is possible to convert both ways between the two mapping languages. This gives a possibled synergy, to mix and match approaches.<br>
I've summarised in bullet points in the attached 2 slides:<br>
<a href="/user_uploads/10155/ObBLZFlPSYYJBVNLplhKZLij/FML_FTE.pdf" target="_blank" title="FML_FTE.pdf">FML_FTE.pdf</a> </p>



<a name="153888673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888673">(May 09 2017 at 13:17)</a>:</h4>
<p>Consider the following target structure:</p>
<div class="codehilite"><pre><span></span>Bundle : Resource
  ...
  entry : BackboneElement
    resource : Resource
  ...
</pre></div>


<p>I'm trying to set <code>resource</code> to <code>create("Observation")</code>, but the reference implementation keeps throwing an exception.</p>
<div class="codehilite"><pre><span></span>org.hl7.fhir.exceptions.FHIRException: Cannot set property resource on entry - value is not a primitive type (Observation) or an ElementModel type
    at org.hl7.fhir.dstu3.elementmodel.Element.setProperty(Element.java:300)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.processTarget(StructureMapUtilities.java:1626)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1241)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1245)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1226)
    at org.hl7.fhir.dstu3.utils.StructureMapUtilities.transform(StructureMapUtilities.java:1200)
    ...
</pre></div>


<p>I would appreciate any suggestion.</p>



<a name="153888727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888727">(May 09 2017 at 15:55)</a>:</h4>
<p>put your whole mapping statement in - what you say you're trying to do is right, but the exception indicates you've got something wrong</p>



<a name="153888740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888740">(May 09 2017 at 16:15)</a>:</h4>
<p>Here's my mapping.</p>
<div class="codehilite"><pre><span></span>map &quot;http://hl7.org/fhir/StructureMap/tutorial&quot; = &quot;tutorial&quot;

uses &quot;http://hl7.org/fhir/StructureDefinition/Src&quot; as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; as target

group src2tgt
  input src : Src as source
  input tgt : Bundle as target

  rule_do_something : for src as s make tgt.type = &quot;collection&quot;, tgt.entry as e, e.resource = create(&quot;Observation&quot;) as t then Src2Observation(s, t)

endgroup

group Src2Observation
  input src : Src as source
  input tgt : Device as target 

  rule_do_something : for src.unit make tgt.comment

endgroup
</pre></div>


<p><a href="/user_uploads/2/b9/G3qwi_hfyQBBpCdN26PBHzhG/structuredefinition-src.xml" target="_blank" title="structuredefinition-src.xml">structuredefinition-src.xml</a></p>



<a name="153888747"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888747" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888747">(May 09 2017 at 17:28)</a>:</h4>
<p>why this?</p>



<a name="153888748"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888748" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888748">(May 09 2017 at 17:28)</a>:</h4>
<p>e.resource = create("Observation") as t, e.resource = obs</p>



<a name="153888752"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888752" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888752">(May 09 2017 at 18:11)</a>:</h4>
<p>Rectified the mapping. Nevertheless, the exception still lies with attempting to assign an <code>Observation</code> to <code>resource</code>.</p>



<a name="153888799"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888799" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888799">(May 09 2017 at 18:35)</a>:</h4>
<p>should we put up a paper notice about the Weds Q5 meeting re mapping language? I can do.</p>



<a name="153888806"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888806" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888806">(May 09 2017 at 19:07)</a>:</h4>
<p>sure that would be good thanks</p>



<a name="153888807"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888807" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888807">(May 09 2017 at 19:08)</a>:</h4>
<p>I didn't actually think that fixing that would fix the problem. But one can always live in hope</p>



<a name="153888808"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888808" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888808">(May 09 2017 at 19:09)</a>:</h4>
<p>but your mapping looks good, so it's probably my bug...</p>



<a name="153888809"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888809" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888809">(May 09 2017 at 19:09)</a>:</h4>
<p>i think I'll get to this before we talk mapping tomorrow night</p>



<a name="153888887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888887">(May 10 2017 at 08:48)</a>:</h4>
<p>The BOF on the mapping language is open only to attendees of the HL7 International Conference &amp; Working Group Meeting or also to people in remote locations?</p>



<a name="153888893"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888893" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888893">(May 10 2017 at 08:54)</a>:</h4>
<p>not sure how remote participation would work. </p>



<a name="153888894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888894">(May 10 2017 at 08:54)</a>:</h4>
<p>you have a web camera?</p>



<a name="153888901"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888901" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888901">(May 10 2017 at 09:03)</a>:</h4>
<p>I do. However, I completely understand if this is a meeting in person.</p>



<a name="153888904"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153888904" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153888904">(May 10 2017 at 09:06)</a>:</h4>
<p>well, it's not formally limited or secret or anything. There's just no good infrastructure for remote participation. It's just a bunch of us sitting in a circle in a hotel room. but we could set up a web ex if you understand it won't work very well</p>



<a name="153889104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889104">(May 10 2017 at 16:01)</a>:</h4>
<p>I'm going to be there a little late -  a few minutes</p>



<a name="153889166"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889166" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889166">(May 10 2017 at 17:52)</a>:</h4>
<p>Here are links about datalog: <a href="https://en.wikipedia.org/wiki/Datalog" target="_blank" title="https://en.wikipedia.org/wiki/Datalog">https://en.wikipedia.org/wiki/Datalog</a>, <a href="http://www.csd.uoc.gr/~hy562/1112_spring/instr_material/WhatYouAlwaysWantedtoKnowAboutDatalog_AndNeverDaredtoAsk.pdf" target="_blank" title="http://www.csd.uoc.gr/~hy562/1112_spring/instr_material/WhatYouAlwaysWantedtoKnowAboutDatalog_AndNeverDaredtoAsk.pdf">http://www.csd.uoc.gr/~hy562/1112_spring/instr_material/WhatYouAlwaysWantedtoKnowAboutDatalog_AndNeverDaredtoAsk.pdf</a>, <a href="http://logic.stanford.edu/dataintegration/chapters/chap01.html" target="_blank" title="http://logic.stanford.edu/dataintegration/chapters/chap01.html">http://logic.stanford.edu/dataintegration/chapters/chap01.html</a></p>



<a name="153889188"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889188" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889188">(May 11 2017 at 06:31)</a>:</h4>
<p>how do you <em>map</em> using data log?</p>



<a name="153889195"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889195" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889195">(May 11 2017 at 08:03)</a>:</h4>
<p>Mapping could be represented as deduced facts, i.e. set of queries/rules</p>



<a name="153889688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889688">(May 12 2017 at 11:00)</a>:</h4>
<p>Wednesday 6pm to 7pm in room 3158</p>



<a name="153889818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889818">(May 13 2017 at 10:19)</a>:</h4>
<p>A script in the FHIR mapping language can include concept maps along any number of groups of rules according to the ANTLR grammar of the FHIR mapping language. After this script is parsed, the resulting parse tree conforms to the abstract syntax of the FHIR mapping language, which essentially is the <code>StructureMap</code>resource, right? Now my question is why the <code>StructureMap</code> resource does not seem to relate to or reference the <code>ConceptMap</code> resource?</p>



<a name="153889844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889844">(May 15 2017 at 08:43)</a>:</h4>
<p><span class="user-mention" data-user-id="193818">@robert worden</span> I am interested in exploring the capabilities of the FHIR transform engine, and I wonder whether it is available for download somewhere? Many thanks!</p>



<a name="153889849"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889849" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889849">(May 15 2017 at 09:07)</a>:</h4>
<p><span class="user-mention" data-user-id="193536">@Flavius Butnariu</span> Please give me a week or so, and I can send you the FHIR Transform Engine tools with a couple of sample mapping projects. I'm currently working on the facility to round-trip between FML mappings and FTE mappings - I'd like to get that to a more tidy state.</p>



<a name="153889932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153889932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153889932">(May 15 2017 at 18:19)</a>:</h4>
<p>On the page defining FHIR Mapping Language 'there  is an antlr grammar for the concrete syntax' - but the link is broken. Anybody got it?</p>



<a name="153890006"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153890006" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153890006">(May 16 2017 at 07:04)</a>:</h4>
<p><span class="user-mention" data-user-id="193818">@robert worden</span> I believe this is <a href="/user_uploads/10155/9THcNw5OsBelOxPVfeC3PtuE/mapping.g4" target="_blank" title="mapping.g4">the ANTLR grammar</a> of the FHIR mapping language.</p>



<a name="153890163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153890163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153890163">(May 17 2017 at 06:01)</a>:</h4>
<p>ConceptMaps will be contained resources in  the structuremap resource</p>



<a name="153890200"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153890200" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153890200">(May 17 2017 at 13:51)</a>:</h4>
<p>Is there any reason why a rule can specify for a source/target context at most a child element </p>
<div class="codehilite"><pre><span></span>rule_name : for context.element as s ... 
</pre></div>


<p>but not a grandchild element?</p>
<div class="codehilite"><pre><span></span>rule_name : for context.element.element as s ...
</pre></div>



<a name="153890307"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153890307" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153890307">(May 17 2017 at 19:52)</a>:</h4>
<p>mainly to keep the structure /grammar  simpler for tools that want to do visual editing</p>



<a name="153890729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153890729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153890729">(May 22 2017 at 08:56)</a>:</h4>
<p><span class="user-mention" data-user-id="193818">@robert worden</span> I would like to follow up on my request from last week. I am particularly interested in exploring the possibility of mapping a source to a target using FTE along with its in-between UML model, so I was wondering whether this feature is mature enough to play with it? I will be grateful for any information you can provide.</p>



<a name="153890730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153890730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153890730">(May 22 2017 at 09:08)</a>:</h4>
<p><span class="user-mention" data-user-id="193536">@Flavius Butnariu</span> the feature is mature enough to play with (and to run translation tests); I am now trying to get two things done: (a) get the bridge to FHIR Mapping Language working in both directions, and (b) build a good demo project with a couple of examples. If you can wait a couple of weeks for these, it should make it a lot easier to understand. I could send you the Eclipse plugins before that, but would prefer to complete the package.</p>



<a name="153891042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891042">(May 23 2017 at 23:25)</a>:</h4>
<p>Just getting started with the mapping language and ran into this...</p>
<p>Trying to use a constant for identifier system. like so</p>
<p><code>LogicalModel.UniqueID : for source.UniqueID : string 1..1 as v make  appt.identifier as t,  t.value = v, t.system = 'http://acme.org'</code></p>
<p>add get this....</p>
<p><code>org.hl7.fhir.exceptions.FHIRException: The type string is not compatible with the allowed types for Identifier.system</code></p>



<a name="153891043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891043">(May 24 2017 at 00:03)</a>:</h4>
<p>that's pretty bizarre... </p>



<a name="153891044"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891044" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891044">(May 24 2017 at 00:09)</a>:</h4>
<p>my example or the error?</p>



<a name="153891045"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891045" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891045">(May 24 2017 at 00:09)</a>:</h4>
<p>the error. that should work work </p>



<a name="153891046"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891046" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891046">(May 24 2017 at 00:11)</a>:</h4>
<p>OK I'll reset everything and try again</p>



<a name="153891056"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891056" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891056">(May 24 2017 at 03:15)</a>:</h4>
<p>Still getting above error.  But was able to walk through whole thing on <a href="http://build.fhir.org/ig/Healthedata1/IG-Template/StructureDefinition-LogicalModel.html" target="_blank" title="http://build.fhir.org/ig/Healthedata1/IG-Template/StructureDefinition-LogicalModel.html">my IG-Template</a> anyway.   A bit of a steep learning curve on the syntax but really handy tool  -  thanks again GG.   The profile instance generation had a bit of a hiccup and didn't  populate all the mappings correctly - it missed the "un-nested terms".  </p>



<a name="153891346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891346">(May 26 2017 at 08:18)</a>:</h4>
<p><span class="user-mention" data-user-id="193536">@Flavius Butnariu</span> is the ANTLR grammar for the  mapping language you pointed me to the current version?<br>
e.g the grammar rule for group is just <br>
'group' groupName ('extends' groupName)* (ruleInput)+ (ruleGroup)+ 'endgroup'<br>
where groupName is just IDENTIFIER, so will not parse 'group for types....'</p>



<a name="153891403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891403">(May 26 2017 at 19:39)</a>:</h4>
<p><span class="user-mention" data-user-id="193818">@robert worden</span> the ANTLR grammar was retrieved from <a href="http://gforge.hl7.org/gf/project/fhir/scmsvn/?action=browse&amp;path=%2Ftrunk%2Fbuild%2Fimages%2Fmapping.g4&amp;view=log" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/scmsvn/?action=browse&amp;path=%2Ftrunk%2Fbuild%2Fimages%2Fmapping.g4&amp;view=log">http://gforge.hl7.org/gf/project/fhir/scmsvn/?action=browse&amp;path=%2Ftrunk%2Fbuild%2Fimages%2Fmapping.g4&amp;view=log</a>. Maybe <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> can provide further details on the status of the grammar.</p>



<a name="153891438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891438">(May 28 2017 at 17:14)</a>:</h4>
<p>Worth a separate stream?</p>



<a name="153891513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891513">(May 29 2017 at 17:07)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="193536">@Flavius Butnariu</span> ; <span class="user-mention" data-user-id="191703">@Claude Nanjo</span>  I see you wrote the grammar. Has anyone implemented a parser with exactly this grammar? When I did so with the ANTLR4 eclipse plugin , my java  generated parser has two problems: (a) the rule for 'group' does not recognise 'group for types...', and (b) the rule for structureDefinition is a black hole, consuming all text to the end of the file. Any comments?</p>



<a name="153891521"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891521" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891521">(May 29 2017 at 18:11)</a>:</h4>
<p><span class="user-mention" data-user-id="193536">@Flavius Butnariu</span> <span class="user-mention" data-user-id="191401">@Eric Haas</span> <span class="user-mention" data-user-id="193818">@robert worden</span> I am up to working on the mapping engine - which of the bugs you have are still a problem?</p>



<a name="153891524"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891524" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891524">(May 29 2017 at 18:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I am not using the mapping engine yet, as I cannot find it in the HAPI 2.4 distribution  - so I am probably looking in the wrong place - where is the right place? I have generated a parser for the mapping language from the ANTLR grammar and had the problems noted above.</p>



<a name="153891533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891533">(May 29 2017 at 19:38)</a>:</h4>
<p>The class name is org.hl7.fhir.dstu3.utils.StructureMapUtilities. <span class="user-mention" data-user-id="191319">@James Agnew</span> is selective about which classes from the build get included in HAPI - perhaps this one is not?</p>



<a name="153891594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891594">(May 29 2017 at 21:03)</a>:</h4>
<p>Yes - it's there - thanks. Looking at it now.</p>



<a name="153891629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891629">(May 30 2017 at 07:50)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> one bug that I found was in terms of setting <code>value[x]</code> of Observation to a complex type such as <code>Quantity</code>.</p>
<p><em>Source structure</em></p>
<div class="codehilite"><pre><span></span>    Src
      value : decimal [1..1]
      unit : string [1..1]
</pre></div>


<p><a href="/user_uploads/10155/QvN9wqvvbbbxuQ0atlOvbxVt/structuredefinition-src.xml" target="_blank" title="structuredefinition-src.xml">Source structure definition</a><br>
<a href="/user_uploads/10155/M6eNd1WPM4vb940hMikY_o2j/source1.xml" target="_blank" title="source1.xml">Source instance</a></p>
<div class="codehilite"><pre><span></span>map &quot;http://hl7.org/fhir/StructureMap/tutorial&quot; = &quot;tutorial&quot;

uses &quot;http://hl7.org/fhir/StructureDefinition/Src&quot; as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; as target

group tutorial
  input src : Src as source
  input tgt : Observation as target

  //rule_value : for src.value as v make tgt.value = v // set value[x] of Observation to primitive type decimal
  rule_value : for src.value as v make create(&quot;Quantity&quot;) as q, tgt.value = q, q.value = v

endgroup
</pre></div>



<a name="153891648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891648">(May 30 2017 at 16:04)</a>:</h4>
<p>I discovered this:</p>
<p>Trying to use a constant for identifier system. like so<br>
<code>LogicalModel.UniqueID : for source.UniqueID : string 1..1 as v make  appt.identifier as t,  t.value = v, t.system = 'http://acme.org'</code><br>
add get this....<br>
<code>org.hl7.fhir.exceptions.FHIRException: The type string is not compatible with the allowed types for Identifier.system</code></p>



<a name="153891649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891649">(May 30 2017 at 16:13)</a>:</h4>
<p>Also when flattening the structure here the example data for <code>foo.bar</code> and <code>foo.baz</code> doesn't map over. ( in the ig-publisher tool)</p>
<p>lgoical model:</p>
<p><a href="/user_uploads/10155/ZmIOd4JoHJ2KyGBR7KbfIEed/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a> </p>
<p>mapped to Appt:</p>
<p><a href="/user_uploads/10155/9iNncoz7P9utMOywzWV213sG/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a> </p>
<p>example data ( notice the status an description are missing)</p>
<p><a href="/user_uploads/10155/OZc589FfuhKJkBLU8asFch-h/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/OZc589FfuhKJkBLU8asFch-h/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/OZc589FfuhKJkBLU8asFch-h/pasted_image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/9iNncoz7P9utMOywzWV213sG/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/9iNncoz7P9utMOywzWV213sG/pasted_image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/ZmIOd4JoHJ2KyGBR7KbfIEed/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/ZmIOd4JoHJ2KyGBR7KbfIEed/pasted_image.png"></a></div>



<a name="153891650"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153891650" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153891650">(May 30 2017 at 16:19)</a>:</h4>
<p>Finally when mapping a logical model to a structure, why is the default behavior for any nonmapped element to be constrained to a cardinality of 0..0  (not used)?  I'm not disagreeing with this but just want to understand the rationale.</p>



<a name="153892444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153892444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153892444">(Jun 06 2017 at 12:02)</a>:</h4>
<p>I have a problem with the concrete syntax of the mapping language , and its ANTLR grammar.<br>
In the abstract syntax of the StructureMap resource, one rule can have zero or more target parts.</p>
<p>The case of zero target parts is important, for 'filler' rules which just take a step down through the source structure, through a node which does  not represent anything in the target.  Filler rules are needed, because a rule can only take one step at a time in the source structure.</p>
<p>But in the concrete syntax, a rule must have one or more target parts. The ANTLR grammar enforces this, requiring a  'make' before any 'then'.</p>
<p>So I think the concrete syntax and its grammar need to be changed. I am not a grammar geek. Can anybody help?</p>
<p>(p.s. I note the ANTLR grammar is not used in Grahame's Java mapping engine, so maybe the grammar is not tested ?)</p>



<a name="153892570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153892570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julie Evans <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153892570">(Jun 06 2017 at 22:14)</a>:</h4>
<p><span class="user-mention" data-user-id="193818">@robert worden</span> Status of the "good demo project with a couple of examples"? Is it available for download? Thx.</p>



<a name="153892651"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153892651" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153892651">(Jun 07 2017 at 12:24)</a>:</h4>
<p><span class="user-mention" data-user-id="192947">@Julie Evans</span> not quite ready yet - need to get a demo round trip between FHIR Mappings and FTE mappings, so need to sort the ANTLR Grammar for the mapping language</p>



<a name="153892675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153892675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Julie Evans <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153892675">(Jun 07 2017 at 15:35)</a>:</h4>
<p>Is anyone aware of any simple StructureMap instance examples besides the ActivityDefinition to SupplyRequest published in the FHIR spec?</p>



<a name="153893061"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153893061" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153893061">(Jun 09 2017 at 04:55)</a>:</h4>
<p>there's all the R2/R3 mappings. and there's structure maps here:  </p>



<a name="153893062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153893062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153893062">(Jun 09 2017 at 04:55)</a>:</h4>
<p><a href="http://fhir.hl7.org.au/fhir/rcpa/index.html" target="_blank" title="http://fhir.hl7.org.au/fhir/rcpa/index.html">http://fhir.hl7.org.au/fhir/rcpa/index.html</a></p>



<a name="153896590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153896590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153896590">(Jul 11 2017 at 15:12)</a>:</h4>
<p>What would be the <code>StructureMap</code> equivalent of the following FHIR mapping language rule?</p>
<div class="codehilite"><pre><span></span>rule_a : for src.a as v make tgt.a = v * 100
</pre></div>


<p>A first take on this would be something like</p>
<div class="codehilite"><pre><span></span>&lt;StructureMap xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  ...
  &lt;rule&gt;
    &lt;name value=&quot;rule_a&quot;/&gt;
    &lt;source&gt;
      &lt;context value=&quot;src&quot;/&gt;
      &lt;element value=&quot;a&quot;/&gt;
      &lt;variable value=&quot;v&quot;/&gt;
    &lt;/source&gt;
    &lt;target&gt;
      &lt;context value=&quot;tgt&quot;/&gt;
      &lt;contextType value=&quot;variable&quot;/&gt;
      &lt;element value=&quot;a&quot;/&gt;
      &lt;transform value=&quot;evaluate&quot;/&gt;
      &lt;parameter&gt;
        &lt;valueString value=&quot;v * 100&quot;/&gt;
      &lt;/parameter&gt;
    &lt;/target&gt;
  &lt;/rule&gt;
  ...
&lt;/StructureMap&gt;
</pre></div>


<p>Am i anywhere close?<br>
Moreover, is there any implementation out there that can "execute" StructureMaps?</p>



<a name="153896636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153896636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153896636">(Jul 11 2017 at 20:50)</a>:</h4>
<p>the java build includes org.hl7.fhir.r4.utils.StructureMapUtilities</p>



<a name="153896707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153896707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153896707">(Jul 12 2017 at 07:45)</a>:</h4>
<p>Is the FHIR mapping language powerful enough to capture the logic of doing unit conversion (e.g., between kilograms and pounds)? If you always expect to find measurements in kilograms on the source side, and if you always need to convert them to pounds on the target side, then I expect that this conversion could be expressed (hardcoded) pretty straightforward in the FHIR mapping language. However, what if there can be a wide choice of units on the target side and an equally wide choice of units on the source side? Hardcoding all conversions in the mapping doesn't seem too elegant. Any thoughts on this?</p>



<a name="153896714"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153896714" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153896714">(Jul 12 2017 at 10:22)</a>:</h4>
<p>we should probably add an API operation for this. The underlying semantics are all there if the units are UCUM, but the language doesn't address it</p>



<a name="153897280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153897280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153897280">(Jul 19 2017 at 07:34)</a>:</h4>
<p>Using the step 1 &amp; 2 in the tutorial, I can't get it to output an element with a different name. This:</p>
<div class="codehilite"><pre><span></span>rule_a: for source.a as a make target.b = a
</pre></div>


<p>Complains: </p>
<div class="codehilite"><pre><span></span>java.lang.Error: Cannot set property b on null
    at org.hl7.fhir.r4.elementmodel.Element.setProperty(Element.java:344)
    at org.hl7.fhir.r4.utils.StructureMapUtilities.processTarget(StructureMapUtilities.java:1626)
    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1241)
</pre></div>



<a name="153897281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153897281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153897281">(Jul 19 2017 at 07:35)</a>:</h4>
<p>Am I doing something wrong? Seems valid according to step 2 and everything I've read... though:</p>
<blockquote>
<p>element: The name of a child element that is valid in the context. The created value will be placed into the named element</p>
</blockquote>
<p>Is ambiguous - what is valid defined by?</p>



<a name="153897284"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153897284" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153897284">(Jul 19 2017 at 07:47)</a>:</h4>
<p>Got it - it's defined by the logical model in there. Derp.</p>



<a name="153899157"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153899157" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Flavius Butnariu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153899157">(Jul 28 2017 at 12:35)</a>:</h4>
<p>Given the following rule in the FHIR mapping language,</p>
<div class="codehilite"><pre><span></span>...
input src : Source as source
input tgt : Bundle as target

myRule : for src.element as v make tgt.entry as e, e.resource = create(&quot;Practitioner&quot;) as p, then callAnotherGroup(v, p, tgt)
...
</pre></div>


<p>what would be its StructureMap equivalent? Is it anything close to what follows?</p>
<div class="codehilite"><pre><span></span>        &lt;rule&gt;
            &lt;name value=&quot;myRule&quot;/&gt;
            &lt;source&gt;
                &lt;context value=&quot;src&quot;/&gt;
                &lt;element value=&quot;element&quot;/&gt;
                &lt;variable value=&quot;v&quot;/&gt;
            &lt;/source&gt;
            &lt;target&gt;
                &lt;context value=&quot;tgt&quot;/&gt;
                &lt;contextType value=&quot;variable&quot;/&gt;
                &lt;element value=&quot;entry&quot;/&gt;
                &lt;variable value=&quot;e&quot;/&gt;
            &lt;/target&gt;
            &lt;target&gt;
                &lt;context value=&quot;e&quot;/&gt;
                &lt;contextType value=&quot;variable&quot;/&gt;
                &lt;element value=&quot;resource&quot;/&gt;
                &lt;variable value=&quot;p&quot;/&gt;
                &lt;transform value=&quot;create&quot;/&gt;
                &lt;parameter&gt;
                    &lt;valueString value=&quot;&#39;Practitioner&#39;&quot;/&gt;
                &lt;/parameter&gt;
            &lt;/target&gt;
            &lt;dependent&gt;
                &lt;name value=&quot;callAnotherGroup&quot;/&gt;
                &lt;variable value=&quot;v&quot;/&gt;
                &lt;variable value=&quot;p&quot;/&gt;
                &lt;variable value=&quot;tgt&quot;/&gt;
            &lt;/dependent&gt;
        &lt;/rule&gt;
</pre></div>



<a name="153916385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153916385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153916385">(Oct 27 2017 at 09:13)</a>:</h4>
<p>FHIR mapping language says:</p>
<blockquote>
<p>Rules in a group may be applied in any order; there is no sense of sequentially applying one rule after another.</p>
</blockquote>
<p>Is it implying that it doesn't matter what order the rules are written in, because the output schema will order them correctly? If so it doesn't seem to be the case because switching the order of rules around changed the order used in the output</p>



<a name="153916551"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153916551" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153916551">(Oct 27 2017 at 20:34)</a>:</h4>
<p>it shouldn't do - that's the point of the rule.</p>



<a name="153919322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153919322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153919322">(Nov 13 2017 at 18:59)</a>:</h4>
<p>I have built tools to generate transforms from example source-target pairs. The transforms are delivered in HAPI Java or FHIR Mapping Language. Should save costs; I am looking for examples to calibrate the cost savings. See webex at at <a href="https://youtu.be/uyMTzib_irk" target="_blank" title="https://youtu.be/uyMTzib_irk">https://youtu.be/uyMTzib_irk</a></p>



<a name="153920871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153920871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153920871">(Nov 22 2017 at 01:34)</a>:</h4>
<p>Is there any guidance somewhere on using the StructureMapUtilities to transform from POJOs / non-FHIR objects?  I believe this should be possible given some kind of typing structures?</p>



<a name="153998697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153998697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153998697">(Sep 20 2018 at 17:18)</a>:</h4>
<p>Who going to Baltimore is using FHIR Mapping Language, or interested in doing so? I'd like to meet up, or even a BOF if enough people are interested.</p>



<a name="153998704"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153998704" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rick Geimer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153998704">(Sep 20 2018 at 17:41)</a>:</h4>
<p>Count me in</p>



<a name="153999320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153999320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153999320">(Sep 23 2018 at 10:42)</a>:</h4>
<p>Me too</p>



<a name="153999515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153999515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153999515">(Sep 24 2018 at 18:31)</a>:</h4>
<p>We are using it to define the QDM-&gt;QI-Core mappings in the Clinical Reasoning connectathon track. Still working on getting QDM element definitions so we can run the code, but that's the plan. Definitely interested in the discussion.</p>



<a name="153999525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153999525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robinette Renner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153999525">(Sep 24 2018 at 18:49)</a>:</h4>
<p>I am also interested.</p>



<a name="153999629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/153999629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#153999629">(Sep 24 2018 at 22:30)</a>:</h4>
<p>If Bryn is in so am I :-)  ( seriously I am interested too)</p>



<a name="154002682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/154002682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#154002682">(Sep 30 2018 at 13:06)</a>:</h4>
<p><strong>* Transforming to FHIR </strong>*           Breakout Session , today , 4 pm, Constellation F<br>
Building transforms  -  with FHIR Mapping Language, or in other ways?<br>
How are you doing it ? What are the problems?<br>
Come along and talk about it - or listen</p>



<a name="154003512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/154003512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#154003512">(Sep 30 2018 at 21:22)</a>:</h4>
<p>Transforming to FHIR  breakoutsession : here are the slides I showed <a href="/user_uploads/10155/t9SrUZsBPnlqJBuK_Zjkmju2/Transforming-to-FHIR-and-TBX.pptx" target="_blank" title="Transforming-to-FHIR-and-TBX.pptx">Transforming-to-FHIR-and-TBX.pptx</a></p>



<a name="172629035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/172629035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Kaney <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#172629035">(Aug 06 2019 at 21:15)</a>:</h4>
<p>Is there a more appropriate stream for FHIR Mapping Language questions, or will this one do?</p>



<a name="172630847"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language/near/172630847" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.html#172630847">(Aug 06 2019 at 21:41)</a>:</h4>
<p><a class="stream" data-stream-id="181579" href="/#narrow/stream/181579-mapping-framework">#mapping-framework</a> is where the geeky questions go :)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
