---
layout: page
title: "FHIR Chat  · nested contained · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html">nested contained</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153909729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909729">(Sep 21 2017 at 14:05)</a>:</h4>
<p>Is it possible to have a resource, which has a contained resource which has another contained resource inside?</p>



<a name="153909735"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909735" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffy Mathew Jose <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909735">(Sep 21 2017 at 15:12)</a>:</h4>
<p>No, see <a href="http://hl7.org/fhir/references.html#contained" target="_blank" title="http://hl7.org/fhir/references.html#contained">reference</a></p>



<a name="153909738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909738">(Sep 21 2017 at 15:21)</a>:</h4>
<p>Contained resources SHALL NOT contain additional contained resources.</p>



<a name="153909742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909742">(Sep 21 2017 at 16:19)</a>:</h4>
<p>I'm trying to find previous discussion on this - it may not have been on zulip. will keep looking</p>



<a name="153909743"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909743" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909743">(Sep 21 2017 at 16:19)</a>:</h4>
<p>The way this would work is that primary resource essentially "contains" all of them</p>



<a name="153909744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909744">(Sep 21 2017 at 16:20)</a>:</h4>
<p>the contained resource would then reference the other contained... I thought</p>



<a name="153909754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909754">(Sep 21 2017 at 17:55)</a>:</h4>
<p>What Jenni describes is demonstrated in this example:  <a href="http://build.fhir.org/diagnosticreport-micro1.xml.html" target="_blank" title="http://build.fhir.org/diagnosticreport-micro1.xml.html">http://build.fhir.org/diagnosticreport-micro1.xml.html</a>   several of the contained Observations reference other contained observations.</p>



<a name="153909755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909755">(Sep 21 2017 at 17:56)</a>:</h4>
<p>which are all contained within a single DiagnosticReport resource</p>



<a name="153909892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909892">(Sep 22 2017 at 12:22)</a>:</h4>
<p>ah i see thanks. well the problem is, that the parent resource does not know all details about it's children, and of it's grand children.</p>



<a name="153909893"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909893" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909893">(Sep 22 2017 at 12:23)</a>:</h4>
<p>that's why i was interested in nested contained, but therefore i need a custom resource anyway</p>



<a name="153909902"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909902" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909902">(Sep 22 2017 at 13:14)</a>:</h4>
<p>You can add all resources in a Bundle and use reference at where you need, just like a Composition.</p>



<a name="153909903"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909903" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffy Mathew Jose <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909903">(Sep 22 2017 at 13:20)</a>:</h4>
<p>Parent resource need not know about all contained resources directly.<br>
<span class="user-mention" data-user-id="193288">@Emre Avsar</span> , Can you share your case? Maybe we can reach to some better understanding.</p>



<a name="153909916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909916">(Sep 22 2017 at 13:41)</a>:</h4>
<p>@<strong>J Mathew Jose</strong> yes. here's my case:</p>
<p>I have the following internal domain:</p>
<p>Discussion Topics (will be a RiskAssessment in FHIR) with DiscussionTopicConfigurations (here i wanted to use a Basic reference as contained)<br>
Discussion Topics have a list of Observations to have a base on what this discussion topic is about. and these observations have also  a ObservationConfiguration inside.</p>
<p>when I have something like this now:<br>
DiscussionTopic with a configuration with 3 observations with 1 observation configuration for each, and this has to be converted to fhir domain now.</p>
<p>i wanted to have something like<br>
RiskAssessment with contained DiscussionTopicConfiguration, and a bunch of observations which are also contained and inside these contained observations i would have the contained observationconfiguration.</p>
<p>so it seems i have to create my own RiskAssessment extension with custom fields in it, rather than using contained. correct?</p>



<a name="153909923"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909923" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffy Mathew Jose <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909923">(Sep 22 2017 at 14:15)</a>:</h4>
<p><span class="user-mention" data-user-id="193288">@Emre Avsar</span> <br>
The idea is that the parent resource will have all the contained resources, while the children and grandchildren has reference to them.</p>
<p>So for your case, RiskAssessment will contain DiscussionTopicConfiguration, observations and their observationconfigurations.<br>
RiskAssessment will refer to DiscussionTopicConfiguration and observations, while each observation will have reference to its observationconfigurations respectively</p>
<p>See quoted link for a detailed example</p>
<blockquote>
<p>What Jenni describes is demonstrated in this example:  <a href="http://build.fhir.org/diagnosticreport-micro1.xml.html" target="_blank" title="http://build.fhir.org/diagnosticreport-micro1.xml.html">http://build.fhir.org/diagnosticreport-micro1.xml.html</a>   several of the contained Observations reference other contained observations.</p>
</blockquote>



<a name="153909924"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909924" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909924">(Sep 22 2017 at 14:17)</a>:</h4>
<p>the problem is, that the converter which converts discussion topics to risk assessments does not contain the logic for converting observationconfiguration to a containted element. it only uses another converter to convert. so it has no knowledge of nested elements. that makes things a bit problematic. assume that this discussion topic is now embedded inside a episodeofcare resource, then the episode of care converter must check all nested elements and extract those and put them into it's contained field. this makes life harder. therefore this is not the approach i think which works out for my case. am i wrong?</p>



<a name="153909927"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909927" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909927">(Sep 22 2017 at 14:31)</a>:</h4>
<p>@Emre Avsar Root resource doesn't need to know how to convert all nested children. Each resource only need to convert itself and asks its direct children to convert.</p>



<a name="153909929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909929">(Sep 22 2017 at 14:36)</a>:</h4>
<p>so, each converter does then convert nested elements and put them to contained, and then you have nested contained elements.</p>



<a name="153909935"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909935" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909935">(Sep 22 2017 at 15:22)</a>:</h4>
<p>All contained resources are added in root resource. Only references to children are used inside parent resource.</p>



<a name="153909938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffy Mathew Jose <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909938">(Sep 22 2017 at 15:49)</a>:</h4>
<p>Before adding a resource to your parent container, move all the contained resources to parent container.</p>



<a name="153909955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153909955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153909955">(Sep 22 2017 at 17:34)</a>:</h4>
<p>You may also need to do processing to ensure that the ids of the contained resources remain unique when you move them up to the new containing resource.</p>



<a name="153910165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910165">(Sep 25 2017 at 05:11)</a>:</h4>
<p>that just does not work well. a nested object's container does not now anything about it's parent. this is just bad design, if i go this way. what i could do would be something like a go through all nested objects and move the contained elements to the root in a separate step, but this sounds like a lot of traversing work for nothing.</p>



<a name="153910166"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910166" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910166">(Sep 25 2017 at 05:24)</a>:</h4>
<p>In general, if you have contained resources, it's because they're acting like "properties" of the containing resource anyhow.  The decision to contain a resource is because you don't have enough information for the resource to stand alone.  I don't really understand why the containing resource wouldn't know about the contents of the resources it "owns".  (Remember that containment isn't a packaging mechanism for transport - it's only for use when the contained content is inherently dependent on the containing resource for existence.)</p>



<a name="153910171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910171">(Sep 25 2017 at 06:02)</a>:</h4>
<p>Or rather than creating new resources, I could also go for this <a href="http://hapifhir.io/doc_custom_structures.html#Custom_Datatype_Structure" target="_blank" title="http://hapifhir.io/doc_custom_structures.html#Custom_Datatype_Structure">http://hapifhir.io/doc_custom_structures.html#Custom_Datatype_Structure</a> right?</p>



<a name="153910172"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910172" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910172">(Sep 25 2017 at 06:03)</a>:</h4>
<p>extending a datatype to hold multiple values in it</p>



<a name="153910173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910173">(Sep 25 2017 at 06:20)</a>:</h4>
<p>That would be outside the standard and wouldn't interoperate with anyone with a standard FHIR interface.  If your data is expressible with FHIR resources, you should use those resources.  If your data isn't expressible with FHIR resources, you have a choice of operating outside the standard or using the Basic resource with a bunch of extensions.</p>



<a name="153910174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910174">(Sep 25 2017 at 06:40)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> that was also what i thought. alright. i'll go for custom resources anyway. since i cannot guarantee the contained objects to be in the root only</p>



<a name="153910176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffy Mathew Jose <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910176">(Sep 25 2017 at 06:57)</a>:</h4>
<p>Let me clarify<br>
Say, we have types X-&gt;Y-&gt;Z in your domain which are mapped to A-&gt;B-&gt;C in FHIR. (arrow in direction of containment)<br>
Also, mappings from X&lt;-&gt;A, Y&lt;-&gt;B, Z&lt;-&gt;C are defined except for children(contained resources)</p>
<p>Now when Y is mapped to B, call Z&lt;&gt;C mapper, add C in B.Contained, add reference to C from appropriate property in B.<br>
When X is mapped to A, call Y&lt;&gt;B mapper (defined above), add B in A.Contained, move everything from B.Contained to A.Contained, add reference to B from appropriate property in A.</p>
<blockquote>
<p>You may also need to do processing to ensure that the ids of the contained resources remain unique when you move them up to the new containing resource.</p>
</blockquote>
<p>For your case, before adding observations containing observationconfigurations to RiskAssessment, move everything from observation.Contained to RiskAssessment.Contained</p>



<a name="153910182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910182">(Sep 25 2017 at 07:48)</a>:</h4>
<p><span class="user-mention" data-user-id="193288">@Emre Avsar</span> If you're going with custom resources, why are you using FHIR?  You won't interoperate with anyone, which is sort of the point.  Can you explain why you need contained resources?  And why it's a problem for the logic that deals with containment to "migrate" inner contained resources to the outer containing resource?  It may be a bit more code, but it's not more work than custom resources - and your interface will actually interoperate with other systems.</p>



<a name="153910186"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910186" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910186">(Sep 25 2017 at 08:30)</a>:</h4>
<p>the custom resources will only extend Basic and all the stuff goes into extensions. </p>
<p>This part of the API is just too custom, it's like the 20% where the stuff has to be done custom. If there would be a matching resource, i'd take it. but there isnt.</p>



<a name="153910189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910189">(Sep 25 2017 at 08:34)</a>:</h4>
<p>in my case, it is more like a configuration which needs to be sent to the client, to know which things (for example observations) and how (coding, values etc.) are needed.</p>
<p>I'd love to take something more FHIRy but don't know really what</p>



<a name="153910190"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910190" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Emre Avsar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910190">(Sep 25 2017 at 08:35)</a>:</h4>
<p>the only 'better' solution is the one with traversing all the children, find all the contained elements and put them to the root. and work with all these things, don't forget to put the contained into childs if only a child needs to be passed somewhere in the codebase etc. this sounds like a nightmare, not only more code</p>



<a name="153910436"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/nested%20contained/near/153910436" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/nested.20contained.html#153910436">(Sep 25 2017 at 14:33)</a>:</h4>
<p>Ok.  If you're doing something that's outside the spec, Basic is fine.  I'm a bit confused how that requirement is linked to "contained" resources though.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
