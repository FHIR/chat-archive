---
layout: page
title: "FHIR Chat  · Datatype uri - Encoding of Plus &#x27;+&#x27; · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html">Datatype uri - Encoding of Plus &#x27;+&#x27;</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="264457124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264457124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264457124">(Dec 10 2021 at 14:49)</a>:</h4>
<p>According to <a href="https://www.hl7.org/fhir/datatypes.html#uri">Data Types - uri</a> the uri data type should follow <a href="https://datatracker.ietf.org/doc/html/rfc3986">RFC 3986</a>. In RFC 3986 the plus sign '+' is a <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-2.2">reserved character</a>. According to:</p>
<blockquote>
<p>URI producing applications should percent-encode data octets that correspond to characters in the reserved set unless these characters are specifically allowed by the URI scheme to represent data in that component.  If a reserved character is found in a URI component and no delimiting role is known for that character, then it must be interpreted as representing the data octet corresponding to that character's encoding in US-ASCII.</p>
</blockquote>
<p>the plus sign should be encoded unless it is specifically allowed by the URI scheme. However I can't find a documentation, that the plus sign in allowed in http/https URI's.</p>
<p>The plus sign is especially relevant in dateTime values with timezone offset on FHIR Search queries. We have currently the issue that HAPI interprets the plus sign correctly in search-type requests in batch bundles, but my server, Blaze does not. I use a standard URL decoder which replaces plus signs with spaces. So a dateTime value ends up as say: <code>2021-12-09T00:00:00 01:00</code>. </p>
<p>I can't find a hint in the FHIR documentation that handles such relevant cases. I would either suggest to ass such a hint or specify that the plus sign should be a normal data character for FHIR. But I'm not sure if we should/could specify that.</p>



<a name="264457547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264457547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daniel Venton <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264457547">(Dec 10 2021 at 14:53)</a>:</h4>
<p>What happens when you use standard url encoding of replacing the + with %2B in your parameter?</p>



<a name="264462104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264462104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264462104">(Dec 10 2021 at 15:22)</a>:</h4>
<p>Replacing the Plus with %2B and putting such an URL in the Bundle works. By decoder decodes %2B into +. But I'm not the producer of the Bundle. The Bundle was tested with HAPI and HAPI somehow supports the + in the URL, inside a Bundle. Now I try to collect evidence to either convince the Bundle producer to change the Bundle or to convince me to change my URL decoding.</p>



<a name="264462192"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264462192" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264462192">(Dec 10 2021 at 15:23)</a>:</h4>
<p>For restful interactions (including search), the same SHOULD clause <a href="http://build.fhir.org/http.html#styleguide">is present</a>:</p>
<blockquote>
<p>Implementations constructing URLs using these patterns SHOULD conform to RFC 3986 Section 6 Appendix A  which requires percent-encoding for a number of characters that occasionally appear in the URLs (mainly in search parameters).</p>
</blockquote>



<a name="264462555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264462555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264462555">(Dec 10 2021 at 15:26)</a>:</h4>
<p>I wonder why it is not a SHALL?</p>



<a name="264463641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264463641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264463641">(Dec 10 2021 at 15:34)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="192685">@Vassil Peytchev</span> . I did not notice this at that place in the documentation. Yes it should be obvious to encode certain chars but I think it should be reiterated in the search section, especially on dateTime values. The Plus sign es especially severe, because it will be replaced with another char, the Space char.  Other chars from Appendix A like the Dollar sign will normally not encoded in URL's. So it's not entirely clear what to encode and what not.</p>



<a name="264506916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264506916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264506916">(Dec 10 2021 at 20:56)</a>:</h4>
<blockquote>
<p>why it is not a SHALL?</p>
</blockquote>
<p>from memory - a long time ago now - there's edge cases where everyone violates the spec routinely, and it doesn't matter. And because where it does matter - this is clearly one of those cases - it's pretty straight forward to realise that it does matter.</p>



<a name="264506983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264506983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264506983">(Dec 10 2021 at 20:57)</a>:</h4>
<p>the only wild card here is HAPI is magically backworking it. I don't know how, and I'd be surprised if my server does the same</p>



<a name="264510624"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264510624" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264510624">(Dec 10 2021 at 21:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Your server returns the same error message as mine:</p>
<div class="codehilite"><pre><span></span><code>http://test.fhir.org/r4/Observation?_lastUpdated=lt2021-12-11T11:00:00.000+02:00
</code></pre></div>
<div class="codehilite"><pre><span></span><code>The Date value 2021-12-11T11:00:00.000 02:00 is not in the correct format (Xml Date Format required)
</code></pre></div>



<a name="264510714"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264510714" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264510714">(Dec 10 2021 at 21:26)</a>:</h4>
<p>well, then, you are clearly correct in this case <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="264510734"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264510734" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264510734">(Dec 10 2021 at 21:26)</a>:</h4>
<p>:-)</p>



<a name="264511169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Datatype%20uri%20-%20Encoding%20of%20Plus%20%27%2B%27/near/264511169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Kiel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Datatype.20uri.20-.20Encoding.20of.20Plus.20&#x27;.2B&#x27;.html#264511169">(Dec 10 2021 at 21:30)</a>:</h4>
<p>So should something appended to the specification to clarify the situation? Either the SHALL or something especially in the date search section?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
