---
layout: page
title: "FHIR Chat  · Resource.id and endpoint STU3/R4 · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html">Resource.id and endpoint STU3/R4</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="268678008"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268678008" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268678008">(Jan 20 2022 at 11:26)</a>:</h4>
<p>Suppose an Observation with <code>.id</code> 123 on base <code>example.org/fhir/stu3</code>. Suppose you move to R4 with or without changing the base:</p>
<p>Is it expected that you keep the same <code>Resource.id</code> in R4 as you had in STU3 - I've always assumed yes</p>
<p>What could be valid reasons for assigning a new id, effectively copying the resource?</p>
<ul>
<li>different endpoint?</li>
<li>different version of FHIR?</li>
<li>same version of FHIR but different version of underlying profile?</li>
<li>because you have a FHIR store and optimize retrieval using the right FHIR version/profile this way</li>
<li>none of the above?</li>
</ul>



<a name="268684057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268684057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268684057">(Jan 20 2022 at 12:28)</a>:</h4>
<p>I'd say: Same set of backend data (whether legacy or native FHIR), same id. Patient Smith is patient Smith (with the same id) regardless of what versions/profiles the API supports. That would be the most RESTful way of thinking about ids. However, I expect the spec to be silent on this (and no, I didn't look), thus effectively allowing you to do whatever you want.</p>



<a name="268686939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268686939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rik Smithies <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268686939">(Jan 20 2022 at 12:55)</a>:</h4>
<p>yes I think it depends if you think of it as the same data. If it is not a copy, but a new way to access the same data then the same id makes sense (and the "old" copy is no longer available - same id, different url, would be technically different but confusing). </p>
<p>Side issue: "The logical id is unique within the space of all resources of the same type on the same server. Once assigned by the server, the id is never changed." But what makes it the same resource, and does it matter if it is not?<br>
Is it acceptable to randomly reassign all the ids on a server (say, overnight, when no transactions are in progress). If not, why not? Who has the right to keep my ids?</p>



<a name="268695702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268695702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268695702">(Jan 20 2022 at 14:01)</a>:</h4>
<p>I think the combination of namespace (base URL) and id should consistently identify the same resource.  However, if you change the namespace (base URL), then there isn't any implication that the ID say the same.  So <a href="http://example.org/fhir/stu3/Patient/1234">example.org/fhir/stu3/Patient/1234</a> and <a href="http://example.org/fhir/r4/Patient/1234">example.org/fhir/r4/Patient/1234</a> can be different patients.  However if you start hosting an R4 resource on <a href="http://example.org/fhir/stu3/Patient.1234">example.org/fhir/stu3/Patient.1234</a>, then you'd need to keep the same identity as the previous STU3 resource at that same URL.</p>



<a name="268696191"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268696191" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268696191">(Jan 20 2022 at 14:04)</a>:</h4>
<p>Assigning new IDs in the same namespace can be really dangerous.  It basically makes it look like all the data is "duplicated", which can be bad for  clinical data.  If a client had queried you before the upgrade, and has stored a local copy, then queries you after, and pulls that down into their local copy, then everything is either duplicated, or possibly assigned to the wrong patient.  It would be a giant mess unless every client were super conservative in their processing (which, in my experience, they aren't).</p>



<a name="268697498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268697498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268697498">(Jan 20 2022 at 14:13)</a>:</h4>
<p>I see a lot of support for my ground thought: same information, same id, regardless of technical representation.</p>
<p>I did not necessarily realize that while the server may know that <a href="http://example.org/fhir/stu3/Patient/123">example.org/fhir/stu3/Patient/123</a> and <a href="http://example.org/fhir/r4/Patient/123">example.org/fhir/r4/Patient/123</a> are the same patient, this cannot be assumed or inferred by a client. This imo makes multiple end points per version of FHIR less desirable as it creates virtual copies of data.</p>
<p>I did note the impreciseness in "The logical id is unique within the space of all resources of the same type on the same server. Once assigned by the server, the id is never changed." as it leaves in the middle what defines a server. The only thing that makes sense to me is that 'server' is equal to endpoint</p>



<a name="268701167"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268701167" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268701167">(Jan 20 2022 at 14:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191375">Alexander Henket</span> <a href="#narrow/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4/near/268697498">said</a>:</p>
<blockquote>
<p>This imo makes multiple end points per version of FHIR less desirable as it creates virtual copies of data.</p>
</blockquote>
<p>I'm not sure I agree here.  Since two endpoints are logically different, it isn't really any different than having endpoints for different hospitals.  Several years ago we had a lot of discussion (at a WGM) about how to handle multiple FHIR versions, whether to use HTTP headers, different endpoints, etc.  It was all kinda a wash, but the common practice so far has been multiple endpoints and that is working fine as far as I know.</p>



<a name="268701590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268701590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268701590">(Jan 20 2022 at 14:41)</a>:</h4>
<p>the id should only be seen as a unique identifier at that endpoint for that resource type. It should not be expected that an id on one endpoint is the same thing at another endpoint. This is very important. The .identifier is there to carry identifiers that might cross many endpoints (and business systems).</p>



<a name="268702062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268702062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268702062">(Jan 20 2022 at 14:45)</a>:</h4>
<p>can the same id be used for the same data on two different endponts? Yes, but a client that expects this is WRONG. That client will likely work fine in the initial setting, and totally fail in other settings.</p>



<a name="268745927"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268745927" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268745927">(Jan 20 2022 at 19:37)</a>:</h4>
<p>Different hospitals with different endpoints makes sense, unless they share a common backend. <a href="http://example.org/fhir/stu3/Patient/123">example.org/fhir/stu3/Patient/123</a> and <a href="http://example.org/fhir/r4/Patient/123">example.org/fhir/r4/Patient/123</a> MAY be the same Patient and one may use the Patient.identifier to attest to that. Unless that proves that these are in fact the same Patient, one should assume they are different. I know for a fact that a lot of resources do not have an identifier in our Dutch context so unless you are willing  to venture into other deduplication schemes like code + date, having multiple endpoints almost unavoidably  leads to virtual duplicates of data. Technically there is no issue in multiple endpoints. Functionally/clinically I'm not so sure.</p>
<p>Would the discussion from all those years ago turn out the same today I wonder.</p>



<a name="268752144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268752144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Ritz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268752144">(Jan 20 2022 at 20:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191375">Alexander Henket</span> <a href="#narrow/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4/near/268697498">said</a>:</p>
<blockquote>
<p>I see a lot of support for my ground thought: same information, same id, regardless of technical representation.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span>  -- I like this idea a <strong>lot</strong>. I believe that our lives would be <em>fundamentally</em> simpler if the same exact thing had the same exact id, no matter at which endpoint it was discoverable. Where there is an overarching governance over the health data, this is eminently doable.</p>



<a name="268758579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268758579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268758579">(Jan 20 2022 at 21:13)</a>:</h4>
<p><span class="user-mention" data-user-id="193307">@Derek Ritz</span>  I'm not sure if that is what Alexander meant, but it is not practical to have the same ID across endpoints.  You can have the same <em>business identifier</em> but not the same FHIR ID.  Using these same FHIR ID is impossible in practice, and not nearly as useful as you probably think (because of merges, and identity issues).</p>



<a name="268760330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268760330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268760330">(Jan 20 2022 at 21:26)</a>:</h4>
<p>Resource id is a primary key.  If you have multiple interfaces to the same database, then it's reasonable to surface that same key over each of them.  If you have different databases that aren't explicitly synchronized/replicated, then it's exceptionally unlikely that the keys will be the same.  When you're hitting an interface, you won't know what lies underneath and will thus have to always assume that different url + id == potentially different instance and behave accordingly.</p>



<a name="268781121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/268781121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#268781121">(Jan 21 2022 at 00:55)</a>:</h4>
<p>I think the foundational concept of <code>FHIR base</code> is sufficiently clearly described in the specification:</p>
<blockquote>
<p>The Service Base URL is the address where all of the resources defined by this interface are found. The Service Base URL takes the form of</p>
<p><div class="codehilite"><pre><span></span><code>http{s}://server{/path}
</code></pre></div><br>
</p>
</blockquote>
<p>and further down</p>
<blockquote>
<p>For example: <code>http://myserver.com/Patient/1</code> and <code>https://myserver.com/Patient/1</code> refer to the same underlying object, while <code>http://myserver.com:81/Patient/1</code> is a distinct entity from either of the above. </p>
</blockquote>
<p>The difference of using different ports on the same server is the same as the difference of in the path component on the same server. </p>
<p>The Service Base URL <strong>cannot contain any semantics</strong>, therefore all discussion on implying equivalence between resources with different Service Base URLs would be moot.</p>



<a name="269225636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/269225636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tjerk Drouen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#269225636">(Jan 25 2022 at 08:54)</a>:</h4>
<p><strong>Technical storage challenge</strong><br>
There is a technical challenge for the storage-system when objects change due to model-changes and versioning.<br>
The structureDefinition of the stored object may have changed significantly across profile-meta-versions and/or fhir-versions. </p>
<p><strong>Freedom of assigning logical ids</strong><br>
<a href="https://build.fhir.org/resource.html#id">https://build.fhir.org/resource.html#id</a> states</p>
<blockquote>
<p>Each resource has an id element which contains the  logical id  of the resource assigned by the server responsible for storing it. ... Logical Ids are always opaque, and external systems need not and should not attempt to determine their internal structure.*<br>
IMO: <strong>FHIR Resource Servers are free to create new logical instances if object-storage-requirements call for this</strong></p>
</blockquote>
<p>IMO: The business identifier should be used to indicate the same object across multiple endpoints.<br>
http{s}://{server}{/fhir-version}{/path}?identifier={business identifier}|StructureDefinition.version}<br>
Not the logical id<br>
http{s}://{server}{/fhir-version}{/path}{logical-id}|StructureDefinition.version}</p>
<p><strong>How to indicate a specific version</strong><br>
Based on <a href="https://build.fhir.org/structuredefinition-definitions.html#StructureDefinition.fhirVersion">https://build.fhir.org/structuredefinition-definitions.html#StructureDefinition.fhirVersion</a></p>
<blockquote>
<p>There may be different structure definition instances that have the same identifier but different versions. The version can be appended to the url in a reference to allow a reference to a particular business version of the structure definition with the format [url]|[version].</p>
</blockquote>
<p><strong>Possibility to use logical-id uniquely as joint agreement</strong><br>
An additional constraint should be impsoed if logical-id is to be used as unique key.<br>
See the unless phrase below.<br>
<a href="https://www.hl7.org/fhir/managing.html#distributed">https://www.hl7.org/fhir/managing.html#distributed</a></p>
<blockquote>
<p>... the logical id of the resource is not guaranteed to be unique (unless all resources have a UUID for the logical id, which is allowed but not required). *</p>
</blockquote>



<a name="269298479"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/269298479" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#269298479">(Jan 25 2022 at 18:09)</a>:</h4>
<p>Across endpoints, logical id (i.e. [x].identifier) is the only safe way to decide that something is the "same", and even that isn't necessarily always "safe" - there are lots of situations where the same business identifier might exist on more than one record.  However, if a system exposes a <em>single</em> endpoint and uses HTTP content negotiation to determine the version, then id would be the same regardless of what version you ask for - even if the data is represented quite differently between versions.</p>



<a name="269437942"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/269437942" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Derek Ritz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#269437942">(Jan 26 2022 at 16:18)</a>:</h4>
<p>Where each <a href="http://resource.id">resource.id</a> is a UUID, it would seem that the usefully simplifying expectation that "same information, same id" becomes reasonable... and doable.</p>



<a name="269447542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Resource.id%20and%20endpoint%20STU3/R4/near/269447542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Resource.2Eid.20and.20endpoint.20STU3.2FR4.html#269447542">(Jan 26 2022 at 17:17)</a>:</h4>
<p>Except that id isn't required to be a UUID - and it often isn't (and can't be made to be).  Agree that if the id <em>is</em> a UUID, then it <em>ought</em> to represent the same record.  However, there's no guarantee that it'll be the same information.  The instance on one server might be years - or even decades - out of date.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
