---
layout: page
title: "FHIR Chat  · URL Encoding Question · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html">URL Encoding Question</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153972449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Stauffer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972449">(Jun 28 2018 at 20:08)</a>:</h4>
<p>I have a question about URL encoding special characters in a FHIR request. For example, let's say I'm performing a search on a Condition resource and I want to include Conditions with clinical-status of "active" or "resolved", are these two URLs equivalent? "GET [base]/Condition?clinical-status=active,resolved" and "GET [base]/Condition?clinical-status=active%2Cresolved"? That is, should the %2C be treated the exact same as an un-encoded comma?</p>
<p>Looking at the "escaping" portion of the search spec, it isn't entirely clear to me (<a href="https://www.hl7.org/fhir/search.html#escaping" target="_blank" title="https://www.hl7.org/fhir/search.html#escaping">https://www.hl7.org/fhir/search.html#escaping</a>). The examples there imply the two are equivalent but I am not sure if the examples are normative.</p>



<a name="153972464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972464">(Jun 28 2018 at 22:11)</a>:</h4>
<p>we don't say much about this because HTTP rules apply, and under those rules, the URLs are equivalent</p>



<a name="153972572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Stauffer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972572">(Jun 29 2018 at 14:24)</a>:</h4>
<p>OK, sounds good. Thanks for clarifying.</p>



<a name="153972590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Stauffer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972590">(Jun 29 2018 at 15:24)</a>:</h4>
<p>Actually, hang on a second... We looked into this further and we're not sure that HTTP rules say the URLs are equivalent. Specifically, RFC 3986 section 2.2 (<a href="https://tools.ietf.org/html/rfc3986#section-2.2" target="_blank" title="https://tools.ietf.org/html/rfc3986#section-2.2">https://tools.ietf.org/html/rfc3986#section-2.2</a>) defines the set of reserved characters to include "," and then states:</p>
<p>The purpose of reserved characters is to provide a set of delimiting characters that are distinguishable from other data within a URI. URIs that differ in the replacement of a reserved character with its corresponding percent-encoded octet are not equivalent.  Percent-encoding a reserved character, or decoding a percent-encoded octet that corresponds to a reserved character, will change how the URI is interpreted by most applications.  Thus, characters in the reserved set are protected from normalization and are therefore safe to be used by scheme-specific and producer-specific algorithms for delimiting data subcomponents within a URI.</p>
<p>That sounds like a URL with , is not equivalent to a URL with a percent-encoded version of %2C.</p>



<a name="153972641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972641">(Jun 29 2018 at 19:06)</a>:</h4>
<p>I was too tired... we define that those URLs are equivalent in that section (see last example)</p>



<a name="153972648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Stauffer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972648">(Jun 29 2018 at 20:08)</a>:</h4>
<p>Is that permissible for us (HL7/FHIR) to override the URI RFC?</p>



<a name="153972649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972649">(Jun 29 2018 at 20:32)</a>:</h4>
<p>I don't believe that we override anything; just made some scheme specific use notes</p>



<a name="153972869"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972869" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Stauffer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972869">(Jul 02 2018 at 13:58)</a>:</h4>
<p>It just seems that the URI RFC (3986) is somewhat clear in saying that reserved characters that are percent-encoded are not equivalent to the reserved character itself. Then we're saying "Yes they are equivalent." How is that not overriding the rule in the RFC?</p>



<a name="153972908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153972908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153972908">(Jul 02 2018 at 15:29)</a>:</h4>
<p>um, we're not. We're concerned with the interpretation of escaped characters - they're escaped either way, but we have a second level of escaping</p>



<a name="153974331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153974331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Stauffer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153974331">(Jul 09 2018 at 15:14)</a>:</h4>
<p>Hi Grahame, sorry I'm not quite able to parse what you're saying in that last response. Do we agree that the URI RFC (3986) rule I quoted above means that these URLs are not equivalent (solely according to that RFC, not our FHIR specification)?: "GET [base]/Condition?clinical-status=active,resolved" and "GET [base]/Condition?clinical-status=active%2Cresolved"</p>



<a name="153974332"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153974332" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Stauffer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153974332">(Jul 09 2018 at 15:23)</a>:</h4>
<p>Also, can we be clear on the terminology we're using here and say "percent-encoded" like RFC 3986 uses when we're talking about changing a comma to %2C? "Escaping" as defined in the FHIR specification deals with prepending special characters with the '\' character. I'm not really talking about "escaping" here -- there just happens to be a mention of percent-encoding in that portion of the FHIR spec and I feel like that's causing some confusion here.</p>



<a name="153975578"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153975578" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153975578">(Jul 16 2018 at 20:51)</a>:</h4>
<p><a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17464" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17464">GF#17464</a> - <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> prompt for you</p>



<a name="153975580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153975580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153975580">(Jul 16 2018 at 20:54)</a>:</h4>
<p>it would help me understand what the problem is here better if rfc 3986 defined what 'equivalence' means in that context. I presume that we should not think that they mean that if 2 URIs are not equivalent, they cannot return the same outcome</p>



<a name="153975686"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153975686" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153975686">(Jul 17 2018 at 08:51)</a>:</h4>
<p>I think we are confusing two types of escaping.   One is the encoding described in RFC3986 to turn FHIR search parameters and values into URLs, the other is <em>within</em> the FHIR spec to differentiate between two possible ambiguous values.  Section <a href="https://www.hl7.org/fhir/search.html#escaping" target="_blank" title="https://www.hl7.org/fhir/search.html#escaping">https://www.hl7.org/fhir/search.html#escaping</a> is about the latter:</p>
<ul>
<li><code>GET [base]/Condition?clinical-status=active,resolved</code>  means get me conditions with the <code>clinical-status</code> "active" OR the clinical status "resolved"</li>
<li><code>GET [base]/Condition?clinical-status=active\,resolved</code> means get me conditions with the <code>clinical-status</code> "active,resolved" (so, the status includes a comma as a character - uncommon but possible).</li>
</ul>
<p>For sure, you might still need RFC3986 to get the characters in the resulting FHIR search strings shown above across on a URL, but that's something on the http/interchange level. </p>
<p>To put it differently: even if we would switch from http (and url encoding) to another transport mechanism, we would still need the distinction between search string "clinical-status=active,resolved" and "clinical-status=active\,resolved".</p>



<a name="153976490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153976490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Stauffer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153976490">(Jul 19 2018 at 20:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I agree. :) <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> thanks for the clarification. It would be nice if the FHIR specification explained this more solidly. The way the <a href="https://www.hl7.org/fhir/search.html#escaping" target="_blank" title="https://www.hl7.org/fhir/search.html#escaping">https://www.hl7.org/fhir/search.html#escaping</a> section is right now, this logic is implied instead of spelled out in a clear manner (at least for me so maybe that's my fault).</p>



<a name="153976602"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153976602" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153976602">(Jul 19 2018 at 22:37)</a>:</h4>
<p>ok I updated the task with a pointer to this thread and a note to add more explanation</p>



<a name="153983442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/URL%20Encoding%20Question/near/153983442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/URL.20Encoding.20Question.html#153983442">(Aug 07 2018 at 22:54)</a>:</h4>
<p>ok updated the section in question at <a href="http://build.fhir.org/search.html#escaping" target="_blank" title="http://build.fhir.org/search.html#escaping">build.fhir.org/search.html#escaping</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
