---
layout: page
title: "FHIR Chat  · Profile Validation Questions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html">Profile Validation Questions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153893163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893163">(Jun 09 2017 at 22:05)</a>:</h4>
<p>Hi,</p>
<p>This is a question for the STU3 version of this profile.</p>
<p>The <a href="http://hl7.org/fhir/StructureDefinition/lipidprofile" target="_blank" title="http://hl7.org/fhir/StructureDefinition/lipidprofile">http://hl7.org/fhir/StructureDefinition/lipidprofile</a> profile contains a discriminator for "reference.code" with discriminator type "value".</p>
<p>It references the following profiles:<br>
a. <a href="http://hl7.org/fhir/StructureDefinition/cholesterol" target="_blank" title="http://hl7.org/fhir/StructureDefinition/cholesterol">http://hl7.org/fhir/StructureDefinition/cholesterol</a><br>
b. <a href="http://hl7.org/fhir/StructureDefinition/triglyceride" target="_blank" title="http://hl7.org/fhir/StructureDefinition/triglyceride">http://hl7.org/fhir/StructureDefinition/triglyceride</a><br>
c. <a href="http://hl7.org/fhir/StructureDefinition/hdlcholesterol" target="_blank" title="http://hl7.org/fhir/StructureDefinition/hdlcholesterol">http://hl7.org/fhir/StructureDefinition/hdlcholesterol</a><br>
d. <a href="http://hl7.org/fhir/StructureDefinition/ldlcholesterol" target="_blank" title="http://hl7.org/fhir/StructureDefinition/ldlcholesterol">http://hl7.org/fhir/StructureDefinition/ldlcholesterol</a></p>
<p>My questions are:<br>
1. Profiles (a) and (c) both have .fixed and .binding values. In this scenario, which takes precedence when a conformant validator slices the elements? The spec <a href="http://hl7.org/fhir/STU3/profiling.html#discriminator" target="_blank" title="http://hl7.org/fhir/STU3/profiling.html#discriminator">http://hl7.org/fhir/STU3/profiling.html#discriminator</a> is not very clear to me on the precedence:<br>
"If the type is 'value', then the element definition must use either ElementDefinition.fixed[x] or, if the element has a terminology binding, a required binding with a Value Set that enumerates the list of possible codes in the value set ("extensional definition")."<br>
2. Followup on #1, should a conformant validator validate on both .fixed and .binding if both are present? Or is it just enough to just validate on .fixed?<br>
3. Profile (b) has both .pattern and .binding values. As per my understanding of the profiling rules at <a href="http://hl7.org/fhir/STU3/profiling.html#discriminator" target="_blank" title="http://hl7.org/fhir/STU3/profiling.html#discriminator">http://hl7.org/fhir/STU3/profiling.html#discriminator</a> a conformant validator should slice on .binding. Should a conformant validator still try to validate the given element using .pattern?</p>



<a name="153893170"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893170" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893170">(Jun 09 2017 at 22:29)</a>:</h4>
<p>This is a timely question. I just spent a couple of days getting this profile correct and validating. So check the current build for what it looks like when it's actually working correctly </p>



<a name="153893171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893171">(Jun 09 2017 at 22:30)</a>:</h4>
<p>fixed overrides the binding </p>



<a name="153893172"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893172" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893172">(Jun 09 2017 at 22:30)</a>:</h4>
<p>validator just validates the fixed if it finds it, since fixed must be true irrespective of the binding</p>



<a name="153893173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893173">(Jun 09 2017 at 22:31)</a>:</h4>
<p>pattern also overrides the binding - but oh, it might not. That's nasty. I'll have to think about that</p>



<a name="153893177"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893177" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893177">(Jun 10 2017 at 01:32)</a>:</h4>
<p>.... the fixed value must be a member of bound code set too.    Can the pattern be used as a discriminator too?  I thought not</p>



<a name="153893182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893182">(Jun 10 2017 at 02:01)</a>:</h4>
<p>pattern can be used as a discriminator. It makes real sense for CodeableConcept </p>



<a name="153893248"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893248" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893248">(Jun 12 2017 at 11:57)</a>:</h4>
<p>Thank you for the answers.</p>



<a name="153893410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893410">(Jun 13 2017 at 16:53)</a>:</h4>
<p>Stupid FHIRPath question.... What is the FHIRpath for self  "."?  E.g. if I want to discriminate Identifier on its own pattern what is the (relative) path.</p>



<a name="153893414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893414">(Jun 13 2017 at 16:59)</a>:</h4>
<p>If you're in an iterator (e.g. .where()), use $this</p>



<a name="153893415"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153893415" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153893415">(Jun 13 2017 at 17:00)</a>:</h4>
<p>You can also use  %context to get to the original node passed to the execution engine.</p>



<a name="153894619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153894619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153894619">(Jun 20 2017 at 22:42)</a>:</h4>
<p>I have a question about .fixed[x] validation.</p>
<p>Let's say I have the following fixed[x] value:</p>
<div class="codehilite"><pre><span></span>&lt;fixedString value=&quot;abc&quot;&gt;
  &lt;extension url=&quot;url1&quot;&gt;
    &lt;valueBoolean value=&quot;true&quot;/&gt;
  &lt;/extension&gt;
  &lt;extension url=&quot;url2&quot;&gt;
    &lt;valueBoolean value=&quot;true&quot;/&gt;
  &lt;/extension&gt;
&lt;/fixedString&gt;
</pre></div>


<p>If I understood <a href="http://hl7.org/fhir/STU3/elementdefinition-definitions.html#ElementDefinition.fixed_x_" target="_blank" title="http://hl7.org/fhir/STU3/elementdefinition-definitions.html#ElementDefinition.fixed_x_">http://hl7.org/fhir/STU3/elementdefinition-definitions.html#ElementDefinition.fixed_x_</a> correctly, then the following should fail validation?<br>
1. Because it's missing one of the extensions:</p>
<div class="codehilite"><pre><span></span>&lt;someStringProperty value=&quot;abc&quot;&gt;
  &lt;extension url=&quot;url1&quot;&gt;
    &lt;valueBoolean value=&quot;true&quot;/&gt;
  &lt;/extension&gt;
&lt;/someStringProperty&gt;
</pre></div>


<p>2. Because the extensions are out of order:</p>
<div class="codehilite"><pre><span></span>&lt;someStringProperty value=&quot;abc&quot;&gt;
  &lt;extension url=&quot;url2&quot;&gt;
    &lt;valueBoolean value=&quot;true&quot;/&gt;
  &lt;/extension&gt;
  &lt;extension url=&quot;url1&quot;&gt;
    &lt;valueBoolean value=&quot;true&quot;/&gt;
  &lt;/extension&gt;
&lt;/someStringProperty&gt;
</pre></div>



<a name="153894620"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153894620" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153894620">(Jun 20 2017 at 22:45)</a>:</h4>
<p>Yes, that sounds right.  If you find the validator isn't actually enforcing this (it's entirely possible it isn't), feel free to submit a change request.</p>



<a name="153894830"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153894830" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153894830">(Jun 21 2017 at 19:45)</a>:</h4>
<p>I'm trying to verify this using the validator in <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">build.fhir.org</a> but I'm getting this error:<br>
C:\DevTools\fhirvalidator\latest&gt;java -jar org.hl7.fhir.validator.jar Patient_fixed_exactlyAsFixed.xml<br>
  .. load FHIR from <a href="http://build.fhir.org/" target="_blank" title="http://build.fhir.org/">http://build.fhir.org/</a><br>
  .. connect to tx server @ <a href="http://tx.fhir.org/r3" target="_blank" title="http://tx.fhir.org/r3">http://tx.fhir.org/r3</a><br>
Exception in thread "main" java.lang.Exception: Unable to find definitions at URL '<a href="http://build.fhir.org/igpack.zip" target="_blank" title="http://build.fhir.org/igpack.zip">http://build.fhir.org/igpack.zip</a>': <a href="http://build.fhir.org/igpack.zip" target="_blank" title="http://build.fhir.org/igpack.zip">http://build.fhir.org/igpack.zip</a><br>
        at org.hl7.fhir.r4.validation.ValidationEngine.loadIgFromUrl(ValidationEngine.java:282)<br>
        at org.hl7.fhir.r4.validation.ValidationEngine.loadIgSource(ValidationEngine.java:262)<br>
        at org.hl7.fhir.r4.validation.ValidationEngine.loadDefinitions(ValidationEngine.java:183)<br>
        at org.hl7.fhir.r4.validation.ValidationEngine.&lt;init&gt;(ValidationEngine.java:178)<br>
        at org.hl7.fhir.r4.validation.Validator.main(Validator.java:249)<br>
Caused by: java.io.FileNotFoundException: <a href="http://build.fhir.org/igpack.zip" target="_blank" title="http://build.fhir.org/igpack.zip">http://build.fhir.org/igpack.zip</a><br>
        at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(Unknown Source)<br>
        at sun.net.www.protocol.http.HttpURLConnection.getInputStream(Unknown Source)<br>
        at org.hl7.fhir.r4.validation.ValidationEngine.loadIgFromUrl(ValidationEngine.java:279)<br>
        ... 4 more</p>
<p>And sure enough, the <a href="http://build.fhir.org/igpack.zip" target="_blank" title="http://build.fhir.org/igpack.zip">http://build.fhir.org/igpack.zip</a> link returns 404.</p>



<a name="153894836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153894836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153894836">(Jun 21 2017 at 20:05)</a>:</h4>
<p>I download and run it all locally like so...<br>
<code>java -jar /Users/ehaas/Downloads/validator/org.hl7.fhir.validator.jar ${fs} -defn /Users/ehaas/Downloads/igpack.zip -ig "${path}"/output/validator.pack</code></p>



<a name="153894837"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153894837" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153894837">(Jun 21 2017 at 20:16)</a>:</h4>
<p>I can't download the igpack.zip from <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">build.fhir.org</a> because it's not there.</p>
<p>So I downloaded the STU3 one and it seems it's just similar to definitions.xml.zip but with the <a href="http://version.info" target="_blank" title="http://version.info">version.info</a> file in it.</p>
<p>So...I created a fakeigpack.zip file that is a copy of definitions.xml.zip from <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">build.fhir.org</a> and put in the <a href="http://version.info" target="_blank" title="http://version.info">version.info</a> file from STU3 igpack.zip.</p>
<p>Seems to work, though I'm not sure if it'll affect validator functionality.</p>



<a name="153894842"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153894842" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153894842">(Jun 21 2017 at 20:29)</a>:</h4>
<p>You can also use one of the definitions file here: <a href="http://build.fhir.org/downloads.html" target="_blank" title="http://build.fhir.org/downloads.html">http://build.fhir.org/downloads.html</a>  instead</p>



<a name="153894850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Profile%20Validation%20Questions/near/153894850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Profile.20Validation.20Questions.html#153894850">(Jun 21 2017 at 21:00)</a>:</h4>
<p>Ok, using this fakeigpack.zip, I proceeded to validate the following:<br>
<a href="/user_uploads/10155/5iIFJQRlCuFbRSAC11F7q6yW/PatientProfile_fixedGenderWithExtension.xml" target="_blank" title="PatientProfile_fixedGenderWithExtension.xml">PatientProfile_fixedGenderWithExtension.xml</a> <br>
<a href="/user_uploads/10155/d8SdUCRPsFmNXxYRk3SE9O74/Patient_fixed_exactlyAsFixedProfile.xml" target="_blank" title="Patient_fixed_exactlyAsFixedProfile.xml">Patient_fixed_exactlyAsFixedProfile.xml</a> <br>
PatientProfile_fixedGenderWithExtension.xml is just a copy of the standard Patient profile resource with a &lt;fixedCode&gt; on Patient.gender.<br>
Patient_fixed_exactlyAsFixedProfile.xml is an instance of the Patient resource with a .gender value that matches the values in .fixed.</p>
<p>The validator fails with the following:<br>
C:\DevTools\fhirvalidator\latest&gt;java -jar org.hl7.fhir.validator.jar Patient_fixed_exactlyAsFixedProfile.xml -defn fakeigpack.zip -profile PatientProfile_fixedGenderWithExtension.xml<br>
  .. load FHIR from fakeigpack.zip<br>
  .. connect to tx server @ <a href="http://tx.fhir.org/r3" target="_blank" title="http://tx.fhir.org/r3">http://tx.fhir.org/r3</a><br>
    (v3.0.1-11917)<br>
Fetch Profile from PatientProfile_fixedGenderWithExtension.xml<br>
  .. validate<br>
Exception in thread "main" java.lang.NullPointerException<br>
        at org.hl7.fhir.r4.validation.InstanceValidator.checkFixedValue(InstanceValidator.java:1234)<br>
        at org.hl7.fhir.r4.validation.InstanceValidator.checkPrimitive(InstanceValidator.java:1375)<br>
        at org.hl7.fhir.r4.validation.InstanceValidator.validateElement(InstanceValidator.java:3206)<br>
        at org.hl7.fhir.r4.validation.InstanceValidator.start(InstanceValidator.java:2369)<br>
        at org.hl7.fhir.r4.validation.InstanceValidator.validateResource(InstanceValidator.java:3450)<br>
        at org.hl7.fhir.r4.validation.InstanceValidator.validate(InstanceValidator.java:642)<br>
        at org.hl7.fhir.r4.validation.InstanceValidator.validate(InstanceValidator.java:491)<br>
        at org.hl7.fhir.r4.validation.ValidationEngine.validate(ValidationEngine.java:555)<br>
        at org.hl7.fhir.r4.validation.ValidationEngine.validate(ValidationEngine.java:483)<br>
        at org.hl7.fhir.r4.validation.Validator.main(Validator.java:300)</p>
<p>I also verified this against HAPI FHIR 2.4 and got the same NullPointerException.</p>
<p>The code:</p>
<div class="codehilite"><pre><span></span>        for (Extension e : fixed.getExtension()) {
          Element ex = getExtensionByUrl(extensions, e.getUrl());
          if (rule(errors, IssueType.VALUE, focus.line(), focus.col(), path, ex != null, &quot;Extension count mismatch: unable to find extension: &quot; + e.getUrl())) {
            checkFixedValue(errors, path, ex.getNamedChild(&quot;extension&quot;).getNamedChild(&quot;value&quot;), e.getValue(), &quot;extension.value&quot;, ex.getNamedChild(&quot;extension&quot;));
          }
        }
</pre></div>


<p>I traced this and it seems like the NullPointer happens with this: ex.getNamedChild("extension")</p>
<p>I think it makes sense because 'ex' is already the extension, so there should be no need to call ex.getNamedChild("extension") just to get the actual extension.<br>
Please correct me if I'm wrong.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
