---
layout: page
title: "FHIR Chat  · _contained search syntax · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html">_contained search syntax</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153835618"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835618" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Odd A. S. Dahl <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835618">(Jun 29 2016 at 11:47)</a>:</h4>
<p>There are several sites that describe what contained resources are and when they should be used, but I've yet to find any documentation, containing sufficient examples, on how to structure the query. On <a href="http://HL7.org" target="_blank" title="http://HL7.org">HL7.org</a> they mention a parameter that can be set to "both" to return both contained and non-contained resources, but I have not found any examples of that either. Any help would be appreciated.</p>



<a name="153835622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835622">(Jun 29 2016 at 12:03)</a>:</h4>
<p>You would construct the query according to the search syntax listed on the <a href="http://www.hl7.org/fhir/search.html" target="_blank" title="http://www.hl7.org/fhir/search.html">search page</a> and add _contained as one of the parameters. For example:</p>
<div class="codehilite"><pre>GET Medication?ingredient=Substance/x23&amp;_contained=both
</pre></div>



<a name="153835623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Odd A. S. Dahl <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835623">(Jun 29 2016 at 12:10)</a>:</h4>
<p>Whouldn't searching for a specific entry like x23 defeat the purpouse of contained? The resource we want to have contained in the message do not have a queryable ID outside of the main object it is contained inside.</p>



<a name="153835625"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835625" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835625">(Jun 29 2016 at 12:16)</a>:</h4>
<p>In my example search, I'm searching for all Medication resources that have an ingredient reference to a Substance resource with id x23. So the contained Medication resource still doesn't have its own id.<br>
I could also have searched for Medication resources with a certain code, if that example makes it clearer to you:</p>
<p>GET Medication?code=585007&amp;_contained=both</p>



<a name="153835626"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835626" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835626">(Jun 29 2016 at 12:17)</a>:</h4>
<p>This would return all normal Medication resources, plus all contained Medication resources that have the specified code.</p>



<a name="153835628"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835628" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Odd A. S. Dahl <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835628">(Jun 29 2016 at 12:32)</a>:</h4>
<p>Thanks. Would it be possible to use it in an unspecific search?<br>
Our service return Encounter objects, which contains Location objects that we cannot query direcly, and we want to support either containing or including them. Would it be possible/correct to ask something like "GET Encounter?location&amp;_contained=both"?</p>



<a name="153835632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835632">(Jun 29 2016 at 12:39)</a>:</h4>
<p>I'm not quite sure what you mean by "either containing or including them".<br>
If you search for all Encounters with<br>
   GET [fhirbase]/Encounter<br>
you will get back all Encounter resources. If an Encounter resource contains a Location resource, by definition that Location resource will be returned in the search result in the Encounter.contained part. You will not get back any stand alone Location resources this way.<br>
If you want to retrieve all Location resources, both normal and contained ones, I would perform the search with:<br>
  GET [fhirbase]Location?_contained=both</p>



<a name="153835641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Odd A. S. Dahl <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835641">(Jun 29 2016 at 12:59)</a>:</h4>
<p>We only have an Encounter service, and do not have the data to support a pure Location service. The Location objects that are returned come from the data that we query when somebody search for an FHIR Encounter, so when somebody search for Encounters with id = xyz we get the data for that Encounter (which we map to a FHIR Encounter object) and also the Location data that this encounter contains (which we map to the FHIR Location object).</p>
<p>.</p>
<p>Our thoughts was that they could specify in the parameters if they wanted to include the Location objects (bundle the Encounter and Location objects, with internal references from the Encounter objects to the Location objects), or contain them inside the Encounter objects. The query for include is straight forward, but we couldn't find examples for contained.</p>
<p>.</p>
<p>Since we have no Location service we cannot do a GET [fhirbase]\Location?_contained=both, it is only available from the Encounter query (so we cannot make Location a seperate service).<br>
For Encounter, with all Location data contained (instead of the default which is supplying an URL), would the query look something like this? : GET Encounter?location&amp;_contained=both"?</p>



<a name="153835665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835665">(Jun 29 2016 at 13:54)</a>:</h4>
<p>well, you're the first person to actually explore this. I don't know whether any servers support it </p>



<a name="153835840"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835840" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835840">(Jun 30 2016 at 06:41)</a>:</h4>
<p>Could this perhaps be solved by doing a search with an include?<br>
So something like:</p>
<p>GET [fhirbase]/Encounter?_include=Encounter:location</p>
<p>which would result in a Bundle of Encounters plus the Location objects they reference. Normally those Locations would be stored on the server Location endpoint, but from what you described your server is doing some processing anyway, mapping to the FHIR resources when the request is made.</p>



<a name="153835841"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835841" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835841">(Jun 30 2016 at 06:43)</a>:</h4>
<p>If they're not interested in the Locations, they would just do the search without the _include.</p>



<a name="153835842"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835842" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Odd A. S. Dahl <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835842">(Jun 30 2016 at 06:54)</a>:</h4>
<p>That is correct, we are preprosessing the request from a FHIR query, select the data from a external HL7 v3 web service, then mapping the response back to FHIR.<br>
Since we have both the Encounter and Location objects mapped to internal FHIR objects we can structure the response to support both _include and _contained. It is only a matter of where to put the Location-objects in the FHIR response.<br>
.<br>
So we have the objects and know the mapping to support both methods, but what we lack is the query syntax for contained request. If there is no standard way of doing that query we might go with just supporting include.</p>



<a name="153835844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mirjam Baltus <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835844">(Jun 30 2016 at 07:50)</a>:</h4>
<p>Yes, there's no standard way for clients of saying: give me the Encounter resources and put the Locations in Encounter.contained.<br>
The _contained is for asking: if there are contained resources of the type I'm performing the search on, I would like to do the search on those contained ones as well.</p>



<a name="153835858"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153835858" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Odd A. S. Dahl <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153835858">(Jun 30 2016 at 11:28)</a>:</h4>
<p>Thanks for the feedback! We'll support only _include then, which in retrospect seems to be the most useful of the two options for this scenario anyway.</p>



<a name="153841278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153841278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Ross <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153841278">(Jul 27 2016 at 14:27)</a>:</h4>
<p>This might be the wrong channel for this, but has anyone ever come across a situation where you want to search, say, Observations with <code>code:in</code> a ValueSet that you'd like to send along with your search request as a contained resource?</p>



<a name="153841279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153841279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Ross <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153841279">(Jul 27 2016 at 14:27)</a>:</h4>
<p>basically, you'd be doing a <code>POST</code> instead of a <code>GET</code>, and you'd have something like <code>?code:in=ValueSet/#contained-id</code> along with the contained resource in your request data</p>



<a name="153841281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153841281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrew Ross <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153841281">(Jul 27 2016 at 14:28)</a>:</h4>
<p>is that supported / does anyone do that?</p>



<a name="153841305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_contained%20search%20syntax/near/153841305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_contained.20search.20syntax.html#153841305">(Jul 27 2016 at 18:28)</a>:</h4>
<p>That's a belieable use case, for sure, but it's not supported. Ony my server, I need to index the value set first - and I think that would be fairly normal </p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
