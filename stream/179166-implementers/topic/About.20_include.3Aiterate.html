---
layout: page
title: "FHIR Chat  · About _include:iterate · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html">About _include:iterate</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="181916077"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181916077" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181916077">(Nov 26 2019 at 12:28)</a>:</h4>
<p>Do we really need to use <code>:iterate</code> modifier for chained includes? It just introduces confusion between chaining and the recursive case. From the implementer's point of view, this is two completely different algorithms - chained and recursive one.</p>



<a name="181916213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181916213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181916213">(Nov 26 2019 at 12:30)</a>:</h4>
<p>What to do if iterate missed ? For example: <code>MedicationDispense?_include=MedicationDispense:prescription&amp;_include=MedicationRequest:performer</code> should we ignore include or show error message?</p>



<a name="181916299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181916299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181916299">(Nov 26 2019 at 12:31)</a>:</h4>
<p>How to distinguish between a recursive case and just self-reference without hierarchy?</p>



<a name="181916389"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181916389" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181916389">(Nov 26 2019 at 12:32)</a>:</h4>
<p>I would suggest using something like <code>:recursive</code> instead of ':iterate' or use ':iterate' only for recursive case (not chained).</p>



<a name="181928674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181928674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181928674">(Nov 26 2019 at 14:57)</a>:</h4>
<p>Isn’t this too late to change?</p>



<a name="181928979"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181928979" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181928979">(Nov 26 2019 at 14:59)</a>:</h4>
<p>Did anybody implement this without any problems? <span class="user-mention" data-user-id="191319">@James Agnew</span>  <span class="user-mention" data-user-id="191757">@Christiaan Knaap</span> ?</p>



<a name="181929180"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181929180" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181929180">(Nov 26 2019 at 15:00)</a>:</h4>
<p>We missed this correction and just added in aidbox alias for  iterate=recursive :(</p>



<a name="181930982"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181930982" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181930982">(Nov 26 2019 at 15:18)</a>:</h4>
<p>I do tend to agree the way this works is a bit confusing..</p>
<p>I know HAPI's current behaviour for <span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span> 's example query above wouldn't actually return any performer, since there is no <code>:iterate</code> on the second include so it doesn't apply to subsequent rounds of include loading. You can work around this by specifying <code>_include:iterate=MedicationRequest:performer</code>, which is easy to do but I find it counter-intuitive since you're not really iterating on that include at all. You're just asking for it to be applied to the results of the first include. Re-reading the spec, I think it's safe to say that this is the way it's supposed to work at least.</p>
<p>TBH I'm not sure how this could be improved though. Adding other modifiers seems like it's just layering more confusing stuff on (not to mention the fact that the http page is normative). We could add text perhaps that specifies that <code>_include</code> on a resource type other than the one being searched for will apply to any resources returned by the first round of include loading? I feel like that would be a nightmare to describe, but it would certainly make the example above a bit more intuitive.</p>



<a name="181936615"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181936615" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181936615">(Nov 26 2019 at 16:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> did you implement recursive version of iterate?</p>



<a name="181938101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181938101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181938101">(Nov 26 2019 at 16:22)</a>:</h4>
<p>how do you distinguish is it recursive or not?</p>



<a name="181938151"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181938151" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181938151">(Nov 26 2019 at 16:23)</a>:</h4>
<p>or user has to write :iterate for each iteration?</p>



<a name="181939121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181939121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181939121">(Nov 26 2019 at 16:34)</a>:</h4>
<p><span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span>  i'm not sure i understand your question. We did implement it, and i am, well, reeeeeasonably sure it's implemented to spec.</p>
<p>You have to add <code>:iterate</code> (or <code>:recurse</code> - we also just treat them as synonyms) to each include parameter. I.e. any include without iterate is only applied to the actual search results, and any include with iterate is applied to search results but also to new results pulled in by previous includes. Is that what you mean?</p>



<a name="181950689"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181950689" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181950689">(Nov 26 2019 at 18:41)</a>:</h4>
<p>i mean Initial idea of recursive was for request like Organization?_include:recursive=Organization:part-of make as much iterations as needed to get all chlidren and children of children,.... Did you implement this logic? Or hapi makes only one iteration for part-of?</p>



<a name="181951023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181951023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181951023">(Nov 26 2019 at 18:44)</a>:</h4>
<p>This recursive iterations logic is expensive and makes great diff with just chained includes. So for performance reason it is important to distinguish this two.</p>



<a name="181952721"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181952721" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181952721">(Nov 26 2019 at 19:01)</a>:</h4>
<p>right, important to differentiate, which is why we added iterate. The server doesn't have to keep iterating for ever</p>



<a name="181965877"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/181965877" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#181965877">(Nov 26 2019 at 21:27)</a>:</h4>
<p>do you mean query should be like this: ?_inc:iterate=partof&amp;_inc:iterate=partof to get grandparents?</p>



<a name="182009553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182009553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182009553">(Nov 27 2019 at 11:19)</a>:</h4>
<p>i always assumed that <code>Organization?_include:iterate=Organization:part-of</code> iterates into all children and children of children.<br>
i understood the iterate here <code>MedicationDispense?_include=MedicationDispense:prescription&amp;_include:iterate=MedicationRequest:performer</code> as a for-each</p>



<a name="182012462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182012462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182012462">(Nov 27 2019 at 12:07)</a>:</h4>
<blockquote>
<p>Did anybody implement this without any problems? <span class="user-mention silent" data-user-id="191319">James Agnew</span>  <span class="user-mention silent" data-user-id="191757">Christiaan Knaap</span> ?</p>
</blockquote>
<p>We haven't implemented :iterate yet. And apparently nobody has missed it either.</p>



<a name="182013407"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182013407" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182013407">(Nov 27 2019 at 12:23)</a>:</h4>
<p>We have some clients, who use it :(</p>
<p>Just to demonstrate a real cases :</p>
<div class="codehilite"><pre><span></span>GET /RequestGroup
    ?_id=reqgroup1
    &amp;_include=patient,author
    &amp;_include:iterate=RequestGroup:target:MedicationRequest
    &amp;_include:iterate=MedicationRequest:medication
    &amp;_include:iterate=MedicationRequest:requester:PractitionerRole
    &amp;_include:iterate=MedicationRequest:intended-performer:Organization
    &amp;_include:iterate=PractitionerRole:practitioner
    &amp;_include:iterate=Patient:organization
    &amp;_include:iterate=PractitionerRole:location
    &amp;_revinclude:iterate=AllergyIntolerance:patient
</pre></div>


<p>:)</p>



<a name="182020330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182020330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182020330">(Nov 27 2019 at 13:52)</a>:</h4>
<p>I drafted a tiny proposal for _(rev)include alternative - <code>_with</code> parameter - <a href="https://gist.github.com/niquola/48d106a88dbf93eb17783c0d5c5beb36" target="_blank" title="https://gist.github.com/niquola/48d106a88dbf93eb17783c0d5c5beb36">https://gist.github.com/niquola/48d106a88dbf93eb17783c0d5c5beb36</a> :)</p>



<a name="182023356"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182023356" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182023356">(Nov 27 2019 at 14:27)</a>:</h4>
<blockquote>
<p>i mean Initial idea of recursive was for request like Organization?_include:recursive=Organization:part-of make as much iterations as needed to get all chlidren and children of children,.... Did you implement this logic? Or hapi makes only one iteration for part-of?</p>
</blockquote>
<p>hapi doesn't stop after one Iteration (which i think is the right approach):<br>
<a href="https://fhir.molit.eu/r4/Observation?_id=559&amp;_include:iterate=Observation:has-member" target="_blank" title="https://fhir.molit.eu/r4/Observation?_id=559&amp;_include:iterate=Observation:has-member">https://fhir.molit.eu/r4/Observation?_id=559&amp;_include:iterate=Observation:has-member</a></p>



<a name="182024294"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182024294" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182024294">(Nov 27 2019 at 14:36)</a>:</h4>
<p>Try nested case: Patient?_id=???&amp;_revinclude=Observation:subject&amp;_include:iterate=Observation:has-member</p>



<a name="182027178"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182027178" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182027178">(Nov 27 2019 at 15:05)</a>:</h4>
<p>works and gets parent, child, grandchild:<br>
<a href="https://fhir.molit.eu/r4/Patient?_id=564&amp;_revinclude=Observation:subject&amp;_include:iterate=Observation:has-member" target="_blank" title="https://fhir.molit.eu/r4/Patient?_id=564&amp;_revinclude=Observation:subject&amp;_include:iterate=Observation:has-member">https://fhir.molit.eu/r4/Patient?_id=564&amp;_revinclude=Observation:subject&amp;_include:iterate=Observation:has-member</a></p>



<a name="182032980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182032980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182032980">(Nov 27 2019 at 16:11)</a>:</h4>
<p>Cool! Now how to interpret the following request:</p>
<p><a href="https://fhir.molit.eu/r4/Patient?_id=564&amp;_revinclude=Observation:subject&amp;_include:iterate=Observation:derived-from" target="_blank" title="https://fhir.molit.eu/r4/Patient?_id=564&amp;_revinclude=Observation:subject&amp;_include:iterate=Observation:derived-from">https://fhir.molit.eu/r4/Patient?_id=564&amp;_revinclude=Observation:subject&amp;_include:iterate=Observation:derived-from</a></p>
<p>is it recursive or not?</p>



<a name="182099995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182099995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182099995">(Nov 28 2019 at 11:09)</a>:</h4>
<p>i changed the second include to the correct revinclude, works.....:</p>
<p><a href="https://fhir.molit.eu/r4/Patient?_id=603&amp;_revinclude=Observation:subject&amp;_revinclude:iterate=Observation:derived-from" target="_blank" title="https://fhir.molit.eu/r4/Patient?_id=603&amp;_revinclude=Observation:subject&amp;_revinclude:iterate=Observation:derived-from">https://fhir.molit.eu/r4/Patient?_id=603&amp;_revinclude=Observation:subject&amp;_revinclude:iterate=Observation:derived-from</a></p>



<a name="182158313"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182158313" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182158313">(Nov 29 2019 at 08:13)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  Are we ok with this ambiguity of iterate? I would suggest to get back :recursvie for recursive cases.</p>



<a name="182158413"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182158413" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182158413">(Nov 29 2019 at 08:15)</a>:</h4>
<blockquote>
<p>i changed the second include to the correct revinclude, works.....:</p>
<p><a href="https://fhir.molit.eu/r4/Patient?_id=603&amp;_revinclude=Observation:subject&amp;_revinclude:iterate=Observation:derived-from" target="_blank" title="https://fhir.molit.eu/r4/Patient?_id=603&amp;_revinclude=Observation:subject&amp;_revinclude:iterate=Observation:derived-from">https://fhir.molit.eu/r4/Patient?_id=603&amp;_revinclude=Observation:subject&amp;_revinclude:iterate=Observation:derived-from</a></p>
</blockquote>
<p>the problem is that it can be both recursive and not! And now it is impossible to say this implicitly :(</p>



<a name="182172139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182172139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182172139">(Nov 29 2019 at 12:04)</a>:</h4>
<p>I haven't followed where this is ambiguous?</p>



<a name="182186510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182186510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182186510">(Nov 29 2019 at 15:38)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>    here is the simplest explanation!</p>
<p>How can I include only the first layer of parents <code>Observation:derived-from</code> (i.e. with no recursion) for this example - <code>Patient?_id=603&amp;_revinclude=Observation:subject&amp;_revinclude:iterate=Observation:derived-from</code> ?</p>
<p>Problem with mixed things - is to unmix them :)</p>



<a name="182194123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182194123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182194123">(Nov 29 2019 at 17:42)</a>:</h4>
<p>you can't. It's all or nothing. In the spec</p>



<a name="182235376"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182235376" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182235376">(Nov 30 2019 at 11:23)</a>:</h4>
<p>isn't it unaesthetic   - with  :recursive user will be able to do this and implementation will be simpler ;)</p>



<a name="182249161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182249161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182249161">(Nov 30 2019 at 18:06)</a>:</h4>
<p>umm? :recurse and :iterate are synonyms?</p>



<a name="182325089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182325089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182325089">(Dec 02 2019 at 08:47)</a>:</h4>
<p>Or do not use :iterate for chained includes (it's redundantly)</p>



<a name="182364466"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182364466" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182364466">(Dec 02 2019 at 16:49)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  should I stop? or create an issue?</p>



<a name="182368640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182368640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182368640">(Dec 02 2019 at 17:29)</a>:</h4>
<p>I'm still not sure that I follow the issue. If you want to be able to specify a 'only -once' or a count of iterations to do, I follow that. Otherwise, I'm not sure what the issue is - the committee renamed :recurse to :iterate, and that seems to have caused confusion?</p>



<a name="182496777"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182496777" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182496777">(Dec 03 2019 at 21:17)</a>:</h4>
<p>Committee has extended meaning of :iterate to chained incudes - i.e. mixed up two different things ;(</p>



<a name="182511875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182511875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182511875">(Dec 04 2019 at 00:05)</a>:</h4>
<p>I'm still not seeing the different things</p>



<a name="182525556"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182525556" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182525556">(Dec 04 2019 at 04:54)</a>:</h4>
<p>With chained include you just do one "iteration", for recursive you do as many as possible  - isn't it serious difference?</p>



<a name="182525817"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182525817" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182525817">(Dec 04 2019 at 05:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> what do you think? Is it a problem or not?</p>



<a name="182561334"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182561334" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182561334">(Dec 04 2019 at 14:44)</a>:</h4>
<p>I see the distinction but it only makes a difference in cases of type X referring to type X - for most references there is no recursion possible. It looks like we are only discussing the case where the client wants to follow exactly one level of Observation:derived-from or Patient:link or similar, and is not happy if the server continues into more than one level. But the server already has the discretion to decide how deep to follow the recursion, so does the client really have that level of control? If you could limit to no more than 1 level, why not also limit to no more than 2 levels?</p>



<a name="182574552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182574552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182574552">(Dec 04 2019 at 16:52)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> there are many references, which can refer to the same resource type and/or other - for example, <a href="https://www.hl7.org/fhir/observation-definitions.html#Observation.hasMember" target="_blank" title="https://www.hl7.org/fhir/observation-definitions.html#Observation.hasMember">https://www.hl7.org/fhir/observation-definitions.html#Observation.hasMember</a> - should for example Observation?_include=has-member be recursive for self-references or not?</p>



<a name="182574755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182574755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182574755">(Dec 04 2019 at 16:54)</a>:</h4>
<p>Ability to explicitly specify a limit for recursion is a good idea (we are thinking to introduce it as an extension)</p>



<a name="182634960"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182634960" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182634960">(Dec 05 2019 at 07:40)</a>:</h4>
<p>The use case seems exotic - so an extension would probably be a good idea should someone need it. A lot of things in the query syntax don't meet the "80%" criterium anyway (ok, that doesn't officially apply to query parameters, but it might as well), so I'd rather see stuff removed (as if that's likely to happen..) than added.</p>



<a name="182639603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182639603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182639603">(Dec 05 2019 at 08:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191372">@René Spronk</span>  just to show you "real-world" query:</p>
<div class="codehilite"><pre><span></span>/RequestGroup?
  _include=target&amp;
  _include=patient:Patient
    _include=Patient:organization,
    _revinclude:iterate=AllergyIntolerance:patient:Patient&amp;
    _revinclude=Condition:subject:Patient&amp;
  _include=author:PractitionerRole&amp;
    _include=PractitionerRole:practitioner:Pracitioner&amp;
    _include=PractitionerRole:location&amp;
    _revinclude=Contract:subject:PractitionerRole&amp;
  _include=RequestGroup:target:MedicationRequest&amp;
      _include=MedicationRequest:medication&amp;
      _include=MedicationRequest:requester:PractitionerRole&amp;
      _include=MedicationRequest:intended-performer:Organization&amp;
      _include=MedicationRequest:intended-performer:Organization
</pre></div>



<a name="182640129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182640129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182640129">(Dec 05 2019 at 09:03)</a>:</h4>
<p>That's fine - but having to distinguish between 1 or 2 or unlimited depth in an iterative _include ? That sounds exotic to me.</p>



<a name="182640201"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182640201" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182640201">(Dec 05 2019 at 09:04)</a>:</h4>
<p>That's mostly for performance reason - handling such huge includes efficiently is a challenge.</p>



<a name="182944293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182944293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182944293">(Dec 09 2019 at 10:52)</a>:</h4>
<p>Looks like nobody interested in this inconsistency right now - ok let's wait for more implementers and users will report this problem :)</p>



<a name="182953874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/182953874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#182953874">(Dec 09 2019 at 13:17)</a>:</h4>
<p><span class="user-mention" data-user-id="194833">@Patrik Sundberg</span> have you implemented <code>(rev)include:iterate</code> in google health API?</p>



<a name="183169133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183169133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183169133">(Dec 11 2019 at 15:40)</a>:</h4>
<p>The Google API supports :iterate but limited to a max depth of 2 at the moment. Our interpretation is that all iterates are recursive for self-references. We have performance and pagination concerns about increasing the max depth. I think for your complex include example we would prefer to implement GraphDefinition operations or GraphQL rather than try to make that query performant in the form of a search.</p>



<a name="183170136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183170136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183170136">(Dec 11 2019 at 15:50)</a>:</h4>
<p>Related question about _include - if a Patient?_include=Patient:organization search result contains two Patients that both refer to the same Organization, does that Organization resource appear once or twice in the searchset bundle? If once, how does this interact with pagination?</p>



<a name="183281462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183281462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183281462">(Dec 12 2019 at 17:27)</a>:</h4>
<p>Bumping this question - how do other implementers handle resources from _include that could appear more than once in the results? Do they appear multiple times? Once per page? Only once overall?</p>



<a name="183284024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183284024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183284024">(Dec 12 2019 at 17:58)</a>:</h4>
<p>Once in each page where it is referenced or referencing - the process is compute the page of results, look for all include related to the resources in the page and add them to the page,</p>



<a name="183334631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183334631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183334631">(Dec 13 2019 at 07:27)</a>:</h4>
<p>We decided to iterprer :iterate as recursive only if source and target specified and equal. As well we support old :recurse for explicit recursion.  To be honest,  you don't need :iterate modifier for chained includes - in aidbox they are optional. <a href="https://docs.aidbox.app/basic-concepts/search-1/_include-and-_revinclude" target="_blank" title="https://docs.aidbox.app/basic-concepts/search-1/_include-and-_revinclude">https://docs.aidbox.app/basic-concepts/search-1/_include-and-_revinclude</a></p>



<a name="183334739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183334739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183334739">(Dec 13 2019 at 07:29)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> if we make recursion explicit,  i do not see performance complications to limit depth of includes: each include is just one query.</p>



<a name="183335057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183335057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183335057">(Dec 13 2019 at 07:35)</a>:</h4>
<p>@grahame i worry how this breaking change was introduced  without real feedback from major implementers. Can we organize kinda subscriptions/notifications for fhir server implementers about such changes?</p>



<a name="183335336"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183335336" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183335336">(Dec 13 2019 at 07:42)</a>:</h4>
<p>just little bit (technically open) open and formal process  right after such changes  is appear and before bulk balloting? Something like email with google form and short description  for those who don't participate in wg meetings, but still interested and affected in/by such changes</p>



<a name="183341617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183341617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183341617">(Dec 13 2019 at 09:31)</a>:</h4>
<p>well, we had several rounds of balloting and calls for comments. The process couldn't be more open than it is</p>



<a name="183341671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183341671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183341671">(Dec 13 2019 at 09:32)</a>:</h4>
<p>it's true, though, that I don't find anything in Zulip about this</p>



<a name="183341810"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/About%20_include%3Aiterate/near/183341810" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/About.20_include.3Aiterate.html#183341810">(Dec 13 2019 at 09:34)</a>:</h4>
<p>no, I did: <a href="#narrow/stream/179166-implementers/topic/_include" title="#narrow/stream/179166-implementers/topic/_include">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/_include</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
