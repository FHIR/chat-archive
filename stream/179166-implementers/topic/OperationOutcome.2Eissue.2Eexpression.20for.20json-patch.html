---
layout: page
title: "FHIR Chat  · OperationOutcome.issue.expression for json-patch · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OperationOutcome.2Eissue.2Eexpression.20for.20json-patch.html">OperationOutcome.issue.expression for json-patch</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="216912173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OperationOutcome.issue.expression%20for%20json-patch/near/216912173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dennis Patterson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OperationOutcome.2Eissue.2Eexpression.20for.20json-patch.html#216912173">(Nov 16 2020 at 18:30)</a>:</h4>
<p>In the case that an invalid or unsupported json-patch request body is sent to a server, it presents an interesting challenge for what to populate in the OperationOutcome.issue.expression, since that field is a FHIRPath expression, but the request isn't FHIR (or FHIRPath-based patch).</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code>PATCH &lt;base url&gt;/Resource/123

[
   {
      &quot;path&quot;:&quot;/attribute&quot;,
      &quot;op&quot;:&quot;replace&quot;,
      &quot;value&quot;: &quot;replacementValue&quot;
   }
]
</code></pre></div>
<ul>
<li>Option 1: Interpret the PATCH as a PUT and return the expression in reference to the Resource.  i.e. <code>Resource.attribute</code> could be the expression if that value is invalid.</li>
<li>Option 2: If the need is to point more to an invalid operation, Option 1 may not be possible.  That may be more of a <code>$this[0].op</code>.  The request wasn't FHIR, so I'm curious for thoughts on this.</li>
<li>Option 3: Expressing the FHIRPath as if the original request was a FHIRPatch (Parameters-based) request presents a challenge if you want to point to a particular <code>Parameters.parameter[0].part[?].valueString</code> because part is index-based, but the request wasn't supplied that way.</li>
</ul>
<p>I lean towards Option 1, but recognize that it may not work for all expressions, hence option 2.  Not a fan of option 3.</p>



<a name="216933404"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OperationOutcome.issue.expression%20for%20json-patch/near/216933404" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OperationOutcome.2Eissue.2Eexpression.20for.20json-patch.html#216933404">(Nov 16 2020 at 21:16)</a>:</h4>
<p>I'm not a super fan of any of the options. this is something we didn't think of</p>



<a name="216933488"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OperationOutcome.issue.expression%20for%20json-patch/near/216933488" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OperationOutcome.2Eissue.2Eexpression.20for.20json-patch.html#216933488">(Nov 16 2020 at 21:17)</a>:</h4>
<p>probably the least worst answer is to just write FHIRPath against the json (or xml in the other case) directly per #2</p>



<a name="216937366"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OperationOutcome.issue.expression%20for%20json-patch/near/216937366" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dennis Patterson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OperationOutcome.2Eissue.2Eexpression.20for.20json-patch.html#216937366">(Nov 16 2020 at 21:49)</a>:</h4>
<p>Not being a FHIRPath expert, and in the absence of a FHIR Resource, am I interpreting "$this[0].op" (or $this[0].path or $this[0].value) being the closest to a least worst representation?</p>



<a name="216938397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OperationOutcome.issue.expression%20for%20json-patch/near/216938397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OperationOutcome.2Eissue.2Eexpression.20for.20json-patch.html#216938397">(Nov 16 2020 at 21:58)</a>:</h4>
<p>yes</p>



<a name="217138974"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OperationOutcome.issue.expression%20for%20json-patch/near/217138974" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OperationOutcome.2Eissue.2Eexpression.20for.20json-patch.html#217138974">(Nov 18 2020 at 14:13)</a>:</h4>
<p>And if the location that fails is due to a change of another field (via invariant), but the field itself wasn't changed, Option 1 is the only thing I think you can do.<br>
For me I think Option 1 is the only real option, as you needed to know from the client what the oringinal thing you were patching was to be able to work it out, so if the error comes back as that in the resource, I'm ok with that.<br>
e.g. Invarint on patient that all active fields have a DOB entered, and a patch sets a patient with no DOB to active.</p>



<a name="217189974"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OperationOutcome.issue.expression%20for%20json-patch/near/217189974" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dennis Patterson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OperationOutcome.2Eissue.2Eexpression.20for.20json-patch.html#217189974">(Nov 18 2020 at 20:10)</a>:</h4>
<p>I'm guessing there isn't a one size fits all here.  The OperationOutcome might be able to point to the expression within the patch and say that changing the active indicator is the problem because other invariants are unfulfilled, or it could additionally point directly to the fields like DOB that weren't populated.  If an "update" operation was sent, $this[0].op might be used to point to the invalid operation.</p>
<p>Option 1 allows for Patient.active rather than Option 2's $this[0].value being an expression of the problem.  Option 1 allows somewhat of an intuitive representation of where in the resource the problem exists.  Option 2 is there if you have to point to a specific part of the patch request</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
