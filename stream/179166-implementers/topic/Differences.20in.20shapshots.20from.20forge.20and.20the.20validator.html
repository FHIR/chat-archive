---
layout: page
title: "FHIR Chat  · Differences in shapshots from forge and the validator · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html">Differences in shapshots from forge and the validator</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="201380947"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/201380947" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans van Amstel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#201380947">(Jun 19 2020 at 12:08)</a>:</h4>
<p>I created two snapshots for a STU3 profile that we use one snapshot with the validator 5.0.7 and one with forge 24.2.0.0.<br>
There were quite some differences, see below.</p>
<p>Could someone please help us in understanding this. Are these differences  both correct from a FHIR perspective? </p>
<p><strong>Defining the base resource. The actual HL7 base resource is Observation</strong><br>
Forge:<br>
<code>     &lt;base&gt;
        &lt;path value="Resource" /&gt;
        &lt;min value="0" /&gt;
        &lt;max value="*" /&gt;
      &lt;/base&gt;</code><br>
Validator:<br>
<code>     &lt;base&gt;
        &lt;path value="Observation"/&gt;
        &lt;min value="0"/&gt;
        &lt;max value="*"/&gt;
      &lt;/base&gt;</code></p>
<p><strong>In the snapshot for almost anything related to extension, a slicing element in the forge generated snapshot</strong><br>
Forge:<br>
<code>     &lt;element id="Observation.modifierExtension"&gt;
      &lt;path value="Observation.modifierExtension" /&gt;
      &lt;slicing&gt;
        &lt;discriminator&gt;
          &lt;type value="value" /&gt;
          &lt;path value="url" /&gt;
        &lt;/discriminator&gt;
        &lt;description value="Extensions are always sliced by (at least) url" /&gt;
        &lt;rules value="open" /&gt;
      &lt;/slicing&gt;
      &lt;short value="Extensions that cannot be ignored" /&gt;</code><br>
Validator:<br>
<code>    &lt;element id="Observation.modifierExtension"&gt;
      &lt;path value="Observation.modifierExtension"/&gt;
      &lt;short value="Extensions that cannot be ignored"/&gt;</code></p>
<p><strong>Difference in referencing a valueset, valueSetUri vs valueSetReference</strong><br>
Forge:<br>
<code>      &lt;binding&gt;
        &lt;strength value="required" /&gt;
        &lt;valueSetUri value="http://hl7.org/fhir/ValueSet/ucum-vitals-common" /&gt;
      &lt;/binding&gt;</code><br>
Validator:<br>
<code>       &lt;binding&gt;
        &lt;strength value="required"/&gt;
        &lt;valueSetReference&gt;
          &lt;reference value="http://hl7.org/fhir/ValueSet/ucum-vitals-common"/&gt;
        &lt;/valueSetReference&gt;
      &lt;/binding&gt;</code></p>
<p><strong>valueQuantity vs value[x] in the path</strong><br>
Forge:<br>
<code>    &lt;element id="Observation.value[x]:valueQuantity"&gt;
      &lt;path value="Observation.valueQuantity" /&gt; </code></p>
<p>Validator:<br>
<code>     &lt;element id="Observation.value[x]:valueQuantity"&gt;
      &lt;path value="Observation.value[x]"/&gt; </code></p>
<p><strong> Difference with the differential of the original profile. value[x] rewritten to valueQuantity in the validator generated snapshot in the element id</strong><br>
Original profile differential:<br>
<code>    &lt;element id="Observation.value[x]:valueQuantity.system"&gt;
      &lt;path value="Observation.valueQuantity.system" /&gt;
      &lt;min value="1" /&gt;
      &lt;fixedUri value="http://unitsofmeasure.org" /&gt;
    &lt;/element&gt;</code></p>
<p>Forge:<br>
<code>     &lt;element id="Observation.value[x]:valueQuantity.system"&gt;
      &lt;path value="Observation.valueQuantity.system" /&gt;
      &lt;min value="1" /&gt;
      &lt;fixedUri value="http://unitsofmeasure.org" /&gt;
    &lt;/element&gt; </code></p>
<p>Validator:<br>
<code>     &lt;element id="Observation.valueQuantity:valueQuantity.system"&gt;
      &lt;path value="Observation.valueQuantity.system"/&gt;
      &lt;min value="1"/&gt;
      &lt;fixedUri value="http://unitsofmeasure.org"/&gt;
    &lt;/element&gt; </code></p>



<a name="201404206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/201404206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#201404206">(Jun 19 2020 at 15:19)</a>:</h4>
<p>Ward's already looking.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="201433813"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/201433813" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#201433813">(Jun 19 2020 at 19:57)</a>:</h4>
<ol>
<li>I don't think that the extensions thing matters? I'm not sure which is more correct either </li>
<li>in this particular case, the URL is also the canonical URL, so they both say the same thing though I think the validator is more correct.  Where it would matter would be if the reference was not be a canonical URL </li>
<li>I think the validator is correct</li>
<li>I think the validator is wrong, and it's also surprising. I'll investigate sometime next week</li>
</ol>



<a name="202057673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202057673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans van Amstel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202057673">(Jun 26 2020 at 06:53)</a>:</h4>
<p>Any update? Thanks for the clarification Grahame. On the first issue about defining the base resource I guess the validator is correct?</p>



<a name="202283755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202283755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthijs van der Wielen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202283755">(Jun 29 2020 at 08:32)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="218569">@Hans van Amstel</span> ,<br>
I've looked into point "2" about the valueset referencing, and when I test this Forge is doing this correctly. <br>
In forge there is this option: <a href="/user_uploads/10155/9NsiJ_EMnXrmXOjZgC9Isvgd/image.png">image.png</a> <br>
If this box is unchecked you say that the value set is a reference and it's rendered as in  your provided example. If the box is checked it is rendered the same as the java validator does. This is correct behavior in our opinion.</p>
<div class="message_inline_image"><a href="/user_uploads/10155/9NsiJ_EMnXrmXOjZgC9Isvgd/image.png" title="image.png"><img src="/user_uploads/10155/9NsiJ_EMnXrmXOjZgC9Isvgd/image.png"></a></div>



<a name="202284723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202284723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abel Enthoven <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202284723">(Jun 29 2020 at 08:44)</a>:</h4>
<p>hi <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> on point 3 (path Observation.value[x]): I see why the path would be 'Observation.value[x]'. The upside is that 'Observation.value[x]' is also the path of the slice header, which makes identifying the slices easy. <br>
But it also means that the path 'Observation.valueQuantity.system' is then not visually a sub-path of its parent-path 'Observation.value[x]', which is quite confusing to both tools and users. So I see a downside to either of the solutions from a technical point of view.<br>
I have to say I find the 'Observation.valueQuantity'-solution more attractive since the path-tree is more readable and the x-to-type-replacement happens where it is introduced (slice-header =&gt; slice). No need to read the contents of the slice to determine the root of the child path.<br>
The documentation about id (<a href="https://www.hl7.org/fhir/elementdefinition.html#id">https://www.hl7.org/fhir/elementdefinition.html#id</a>, third bullet) seems to hint at this form of type-sliced paths too.</p>



<a name="202312360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202312360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans van Amstel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202312360">(Jun 29 2020 at 13:58)</a>:</h4>
<p><span class="user-mention" data-user-id="259036">@Matthijs van der Wielen</span>  Thanks for the reply. for me it's hard to judge what is correct and what not as I can not find definitive spec. The difference between the outputs of the HL7 validator and Forge puzzles me the most as the input is the same.</p>



<a name="202314123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202314123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans van Amstel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202314123">(Jun 29 2020 at 14:11)</a>:</h4>
<p>Besides this I also did an experiment with the vitalsigns profile of the hl7 website (<a href="http://hl7.org/fhir/STU3/vitalsigns.profile.xml.html">http://hl7.org/fhir/STU3/vitalsigns.profile.xml.html</a>)  and manually removed the snapshot part. Then I used the Forge(24.2.0.0) and HL7 validator(5.0.7) to recreate this snapshot. I was not able to do so and the difference was quite large.</p>
<p>If someone could help me understand why this differences and where I can find to help me understand what is correct that would really help us.</p>
<p>--- Snapshot difference 1 ---</p>
<p><strong>Profile as is on the hL7 FHIR site:</strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.valueQuantity&quot;&gt;
  &lt;path value=&quot;Observation.valueQuantity&quot;/&gt;
</code></pre></div>


<p><strong>Forge</strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.value[x]:valueQuantity&quot;&gt;
  &lt;path value=&quot;Observation.valueQuantity&quot; /&gt;
</code></pre></div>


<p><strong>Hl7 Validator:</strong></p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.value[x]&quot;&gt;
  &lt;path value=&quot;Observation.value[x]&quot;/&gt;
</code></pre></div>


<p>--- Snapshot difference 2 ---</p>
<p>7x a difference similar to this one<br>
<strong>Profile as is on the hL7 FHIR site: </strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.valueQuantity.id&quot;&gt;
  &lt;path value=&quot;Observation.valueQuantity.id&quot;/&gt;
</code></pre></div>


<p><strong>Forge:</strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.value[x]:valueQuantity.id&quot;&gt;
  &lt;path value=&quot;Observation.valueQuantity.id&quot; /&gt;
</code></pre></div>


<p><strong>HL7 Validator:</strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.value[x]:valueQuantity.id&quot;&gt;
  &lt;path value=&quot;Observation.value[x].id&quot;/&gt;
</code></pre></div>


<p>--- Snapshot difference 3 ---</p>
<p><strong>Profile as is on the hL7 FHIR site </strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.component.valueQuantity&quot;&gt;
  &lt;path value=&quot;Observation.component.valueQuantity&quot;/&gt;
</code></pre></div>


<p><strong>Forge:</strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.component.value[x]:valueQuantity&quot;&gt;
  &lt;path value=&quot;Observation.component.valueQuantity&quot; /&gt;
</code></pre></div>


<p><strong>Hl7 Validator:</strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.component.value[x]&quot;&gt;
  &lt;path value=&quot;Observation.component.value[x]&quot;/&gt;
  &lt;slicing&gt;
    &lt;discriminator&gt;
      &lt;type value=&quot;type&quot;/&gt;
      &lt;path value=&quot;$this&quot;/&gt;
    &lt;/discriminator&gt;
    &lt;ordered value=&quot;false&quot;/&gt;
    &lt;rules value=&quot;closed&quot;/&gt;
  &lt;/slicing&gt;
</code></pre></div>


<p>--- Snapshot difference 4 ---</p>
<p>7x a difference similar to this one<br>
<strong>Profile as is on the hL7 FHIR site </strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.component.valueQuantity.id&quot;&gt;
  &lt;path value=&quot;Observation.component.valueQuantity.id&quot;/&gt;
</code></pre></div>


<p><strong>Forge:</strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.component.value[x]:valueQuantity.id&quot;&gt;
  &lt;path value=&quot;Observation.component.valueQuantity.id&quot; /&gt;
</code></pre></div>


<p><strong>Hl7 Validator:</strong> </p>
<div class="codehilite"><pre><span></span><code>&lt;element id=&quot;Observation.component.value[x]:valueQuantity.id&quot;&gt;
 &lt;path value=&quot;Observation.component.value[x].id&quot;/&gt;
</code></pre></div>


<p>Sorry for again posting a long post <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="202365473"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202365473" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202365473">(Jun 29 2020 at 20:43)</a>:</h4>
<p>STU3 is a long way behind</p>



<a name="202365480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202365480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202365480">(Jun 29 2020 at 20:43)</a>:</h4>
<p>so differences would be expected.</p>



<a name="202365496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202365496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202365496">(Jun 29 2020 at 20:43)</a>:</h4>
<p>R4 should be up to date</p>



<a name="202378652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202378652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hans van Amstel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202378652">(Jun 29 2020 at 23:09)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  Ok I can understand that STU3 is a long way behind. </p>
<p>The problem we face is that we have a FHIR STU3 server that implements what is called the FHIR 3 way on how to define slicing. This is suppose to be: "Observation.component.valueQuantity". The R4 way of slicing is supposed to be "Observation.component.value[x]".  Is this correct?</p>
<p>This is the same with how it is described on the HL7 FHIR STU3 sites (eg:<a href="http://hl7.org/fhir/STU3/vitalsigns.profile.xml.html">http://hl7.org/fhir/STU3/vitalsigns.profile.xml.html</a>) in the snapshot and also on the HL7 FHIR R4 sites( eghttps://www.hl7.org/fhir/vitalsigns.profile.xml.html).</p>
<p>With the validator we are trying to create snapshots for our FHIR STU3 server but because of this difference we are not able to do so.</p>
<p>If this is a correct interpretation (STU3 slicing and the R4 slicing) I would expect when using the the tooling and specifying --version 3 the output to be in accordance to "Observation.component.valueQuantity" .</p>
<p>Or am I missing something?</p>



<a name="202403346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Differences%20in%20shapshots%20from%20forge%20and%20the%20validator/near/202403346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthijs van der Wielen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Differences.20in.20shapshots.20from.20forge.20and.20the.20validator.html#202403346">(Jun 30 2020 at 07:34)</a>:</h4>
<p><span class="user-mention" data-user-id="218569">@Hans van Amstel</span>  The difference between Forge and the java validator is not something I can tell you anything useful about. In STU3 the definition of Binding looks like this: <a href="/user_uploads/10155/QKTBVpjBmmauMkU5il6QvAWH/image.png">image.png</a> <br>
This tells me that the Forge snaphot is correct on the point of the valueset (in STU3). </p>
<div class="message_inline_image"><a href="/user_uploads/10155/QKTBVpjBmmauMkU5il6QvAWH/image.png" title="image.png"><img src="/user_uploads/10155/QKTBVpjBmmauMkU5il6QvAWH/image.png"></a></div><p>For R4 this looks different: <a href="/user_uploads/10155/O8CSxDmgirISiKcD0gBC642X/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/O8CSxDmgirISiKcD0gBC642X/image.png" title="image.png"><img src="/user_uploads/10155/O8CSxDmgirISiKcD0gBC642X/image.png"></a></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
