---
layout: page
title: "FHIR Chat  · revinclude:iterate and versioned references · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html">revinclude:iterate and versioned references</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="236246066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236246066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236246066">(Apr 26 2021 at 21:18)</a>:</h4>
<p>The search spec says that _include SHOULD follow versioned references and provide the specified version. So the searchset may contain entries that are not the current version of the resource.</p>
<p>It's pretty clear what _include:iterate would do from that point - follow outgoing references from that version. But what does _revinclude:iterate do?</p>
<p>If the _include'd result is Patient/123/_history/456, it seems clear we want incoming versioned references to Patient/123/_history/456, if there are any. Should we also find incoming references to Patient/123? They might not be relevant to a past state of the resource.</p>



<a name="236246295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236246295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236246295">(Apr 26 2021 at 21:19)</a>:</h4>
<p>Good question! Any existing behavior from servers we can review as a starting point?</p>



<a name="236246929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236246929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236246929">(Apr 26 2021 at 21:22)</a>:</h4>
<p>Currently the Google implementation doesn't do either. I'm fixing revinclude to at least find the version-specific incoming references so it can catch <a href="http://Provenance.target">Provenance.target</a>.</p>
<p>Not aware of any other examples at the moment.</p>



<a name="236247496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236247496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236247496">(Apr 26 2021 at 21:25)</a>:</h4>
<p>I think I lean toward <em>not</em> finding incoming non-versioned references. It's hard to come up with a use case where that's definitely desirable.</p>



<a name="236247609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236247609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236247609">(Apr 26 2021 at 21:25)</a>:</h4>
<p>The problem is that the version might be current, in which case we should.</p>



<a name="236272143"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236272143" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236272143">(Apr 27 2021 at 01:48)</a>:</h4>
<p>very tricky questions; I've ignored them in my implementation, and I don't even know what would happen</p>



<a name="236317917"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236317917" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236317917">(Apr 27 2021 at 11:10)</a>:</h4>
<p>seems this should be directable, rather than a default unchangeable behavior. Provenance use likely does want version specific followed, as that is an important part of the mechanism that is provenance.  Where else is version specific references used, are they intended to be soft (FYI, this was the version), or hard (this is the instance).</p>



<a name="236341197"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236341197" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236341197">(Apr 27 2021 at 13:58)</a>:</h4>
<p>The issue is that 'search' doesn't allow for multiple versions of a resource in the Bundle, so Provenance with includes is tricky.</p>



<a name="236341637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236341637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236341637">(Apr 27 2021 at 14:00)</a>:</h4>
<p>Doesn't it? What if I have two results for my primary search, each of which has a versioned reference to different versions of the same resource, and I have an _include that follows that reference?</p>



<a name="236342155"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236342155" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236342155">(Apr 27 2021 at 14:03)</a>:</h4>
<p>Only 'history' Bundles are currently allowed to have multiple versions of the same resource.</p>



<a name="236346681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236346681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236346681">(Apr 27 2021 at 14:29)</a>:</h4>
<p>That's an interesting conflict. I think there will be legitimate use cases for _include on versioned references that will collide with that constraint.</p>



<a name="236354399"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236354399" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236354399">(Apr 27 2021 at 15:06)</a>:</h4>
<p>Isn't the idea that Lloyd describing that generally a reference that is versioned is most of the time treated as the resource id (current)? Thus outside of a history bundle, you would always get the current?</p>



<a name="236354631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236354631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236354631">(Apr 27 2021 at 15:07)</a>:</h4>
<p>This is why a _revinclude on Provenance will find all historic Provenance based on the current Observation. And doesn't conflict because each of the Provenance are instances, not revisions.</p>



<a name="236354806"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236354806" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236354806">(Apr 27 2021 at 15:08)</a>:</h4>
<p>What is a use-case, <span class="user-mention" data-user-id="197072">@Paul Church</span> , that you are thinking of where _include really wants version specific targets?</p>



<a name="236357121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236357121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236357121">(Apr 27 2021 at 15:19)</a>:</h4>
<p>This came up in CARIN BB where they want an ExplanationOfBenefit and related resources to be a "point in time" record that aligns with what the patient would have seen on a paper claim. For example, a Practitioner should be represented with the affiliation and address that they had at the time of the claim to avoid confusion, e.g. "wait a minute, I didn't see a doctor at hospital X" if the practitioner has since moved.</p>
<p>One way of accomplishing this is through versioned references (rather than creating a bunch of Practitioner resources for the same individual), so the IG called for that. It was already allowed by the spec as a "should" so it didn't seem like a big deal.</p>



<a name="236357397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236357397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236357397">(Apr 27 2021 at 15:21)</a>:</h4>
<p>that is versioned references... but what about multiple historic versions of the same resource?</p>



<a name="236357465"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236357465" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236357465">(Apr 27 2021 at 15:21)</a>:</h4>
<p>your use-case sounds like a Composition. Often Compositions are a document of an instance in time.</p>



<a name="236357553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236357553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236357553">(Apr 27 2021 at 15:22)</a>:</h4>
<p>If the patient searched for their ExplanationOfBenefit resources with an _include on Practitioner, you can imagine that two claims over time might have references to different versions of the same Practitioner, and those might occur in the same search.</p>



<a name="236357966"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236357966" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236357966">(Apr 27 2021 at 15:24)</a>:</h4>
<p>I think in that case you get the current Practitioner, not the historic (version). Thus you get one Practitioner for each individual practitioner involved. It might be referenced multiple times in the search set.</p>



<a name="236368042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236368042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236368042">(Apr 27 2021 at 16:25)</a>:</h4>
<p>But in this case, it makes sense for the application to show multiple versions of the same Practitioner when displaying the various claims. It would be confusing if sometimes you saw the referenced version and sometimes saw the current version depending on what search results were present.</p>



<a name="236374914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236374914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236374914">(Apr 27 2021 at 17:12)</a>:</h4>
<p>Agreed, Paul's use case is pretty clear; I don't know why we'd intentionally rule this out.</p>



<a name="236379640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/revinclude%3Aiterate%20and%20versioned%20references/near/236379640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/revinclude.3Aiterate.20and.20versioned.20references.html#236379640">(Apr 27 2021 at 17:47)</a>:</h4>
<p>I don't know either.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
