---
layout: page
title: "FHIR Chat  · Relative reference between transaction bundle entries · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html">Relative reference between transaction bundle entries</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="198886697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/198886697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yan Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#198886697">(May 27 2020 at 13:01)</a>:</h4>
<p>Is it recommended to use fullUrl instead of relative url for reference between transaction bundle entries ? The hl7 spec says:</p>
<p>2.36.4 Resource URL &amp; Uniqueness rules in a bundle <br>
Except for transactions and batches, each entry in a Bundle must have a fullUrl which is the identity of the resource in the entry. Note that this is not a versioned reference to the resource, but its identity. Where a resource is not assigned a persistent identity that can be used in the Bundle, a UUID should be used (urn:uuid:...).</p>
<p>For transactions and batches, entries MAY not have fullURLs when the entry.request.method = POST, and the resource has no identity. Note that even in this case, there may still be a fullURL in a transaction on a POST so that relationships between resources can be represented (see Transactions).</p>
<p>And 2.36.4.1 Resolving references in Bundles</p>
<ul>
<li>If the reference is not an absolute reference, convert it to an absolute URL:<ul>
<li>if the reference has the format [type]/[id], and</li>
<li>if the fullUrl for the bundle entry containing the resource is a RESTful one (see the RESTful URL regex)<ul>
<li>extract the [root] from the fullUrl, and append the reference (type/id) to it</li>
<li>then try to resolve within the bundle as for a RESTful URL reference.</li>
<li>If no resolution is possible, then the reference has no defined meaning within this specification</li>
</ul>
</li>
<li>else no resolution is possible and the reference has no defined meaning within this specification</li>
</ul>
</li>
<li>else<ul>
<li>Look for an entry with a fullUrl that matches the URI in the reference</li>
<li>if no match is found, and the URI is a URL that can be resolved (e.g. if an http: URL), try accessing it directly)</li>
</ul>
</li>
</ul>
<p>My interpretation is relative url is allowed for transaction and batch bundle. However when testing with Vonk FHIR endpint, the server is expecting fullUrl to represent relation between bundle entries. For example when posting the following  bundle:</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;resourceType&quot;: &quot;Bundle&quot;,
  &quot;id&quot;: &quot;e0a07c37-8df7-4d75-aa11-3085369e8d36&quot;,
  &quot;type&quot;: &quot;transaction&quot;,
  &quot;entry&quot;: [
    {
      &quot;resource&quot;: {
        &quot;resourceType&quot;: &quot;List&quot;,
        &quot;id&quot;: &quot;xyz&quot;,
        &quot;status&quot;: &quot;current&quot;,
        &quot;mode&quot;: &quot;snapshot&quot;,
        &quot;date&quot;: &quot;2020-05-27T08:55:40-04:00&quot;,
        &quot;entry&quot;: [
          {
            &quot;item&quot;: {
              &quot;reference&quot;: &quot;Patient/abc&quot;,
              &quot;display&quot;: &quot;Betsy Smith-Johnson&quot;
            }
          }
        ]
      },
      &quot;request&quot;: {
        &quot;method&quot;: &quot;POST&quot;,
        &quot;url&quot;: &quot;List&quot;
      }
    },
    {
      &quot;resource&quot;: {
        &quot;resourceType&quot;: &quot;Patient&quot;,
        &quot;id&quot;: &quot;abc&quot;,
        &quot;name&quot;: [
          {
            &quot;family&quot;: &quot;Smith-Johnson&quot;,
            &quot;given&quot;: [
              &quot;Betsy&quot;
            ]
          }
        ]
      },
      &quot;request&quot;: {
        &quot;method&quot;: &quot;POST&quot;,
        &quot;url&quot;: &quot;Patient&quot;
      }
    }
  ]
}
</code></pre></div>


<p>The server won’t update list.entry[0].item.reference  "Patient/abc” (because the server expects fullUrl here) when generates new local id for the Patient resource.</p>
<p>Is it server's responsibility to support relative url reference for transaction/batch bundle? Or is it recommended for the client to use fullUrl for reference ?</p>
<p>Thanks,<br>
Yan</p>



<a name="198895536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/198895536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#198895536">(May 27 2020 at 14:09)</a>:</h4>
<p>Relative URLs should be ok.  However, I don't see fullURLs being declared for your entries - those are mandatory in a transaction</p>



<a name="198908140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/198908140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#198908140">(May 27 2020 at 15:24)</a>:</h4>
<p>Maybe the confusion is here:</p>
<blockquote>
<p>For transactions and batches, entries MAY not have fullURLs when the entry.request.method = POST, and the resource has no identity. Note that even in this case, there may still be a fullURL in a transaction on a POST so that relationships between resources can be represented (see Transactions).</p>
</blockquote>
<p>I am not quite sure how to interpret that...</p>



<a name="198914504"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/198914504" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#198914504">(May 27 2020 at 16:10)</a>:</h4>
<p>My interpretation of that is that anything you're referencing and anything containing a 'local' reference must have a fullUrl.  Without those, the references cannot be resolved.  Agree we could be clearer.  <span class="user-mention" data-user-id="192685">@Vassil Peytchev</span> can you submit a change request?</p>



<a name="198919101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/198919101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#198919101">(May 27 2020 at 16:45)</a>:</h4>
<p>In the case of POST in a transaction, does that mean that the fullURLs must be UUIDs? And if there have to be fullUrls, do references within the transaction have to use the fulUrl?</p>



<a name="198920786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/198920786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#198920786">(May 27 2020 at 16:58)</a>:</h4>
<p>References can use relative URLs even if the baseUrl is a UUID.  The fullUrl could be the URL of the resource on the sending system or another system (if one exists).  Otherwise, yes it should be a UUID.</p>



<a name="199002664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/199002664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#199002664">(May 28 2020 at 09:58)</a>:</h4>
<p>Since you POST the Patient/abc, the id is ignored so I think there is no point in referencing Patient/abc.<br>
IMHO the correct way to reference this Patient from the list is by adding a fullUrl to the entry and reference that from the List.entry.item.reference.</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;resourceType&quot;: &quot;Bundle&quot;,
  &quot;id&quot;: &quot;e0a07c37-8df7-4d75-aa11-3085369e8d36&quot;,
  &quot;type&quot;: &quot;transaction&quot;,
  &quot;entry&quot;: [
    {
            &quot;fullUrl&quot;: &quot;urn:uuid:d2a13b37-6611-48a7-a00a-92670e24665f&quot;,
      &quot;resource&quot;: {
        &quot;resourceType&quot;: &quot;List&quot;,
        &quot;id&quot;: &quot;xyz&quot;,
        &quot;status&quot;: &quot;current&quot;,
        &quot;mode&quot;: &quot;snapshot&quot;,
        &quot;date&quot;: &quot;2020-05-27T08:55:40-04:00&quot;,
        &quot;entry&quot;: [
          {
            &quot;item&quot;: {
              &quot;reference&quot;: &quot;urn:uuid:f4534fe7-5e7a-4ebd-85aa-cc4efd187b13&quot;, //note that the fullUrl of the Patient entry is used.
              &quot;display&quot;: &quot;Betsy Smith-Johnson&quot;
            }
          }
        ]
      },
      &quot;request&quot;: {
        &quot;method&quot;: &quot;POST&quot;,
        &quot;url&quot;: &quot;List&quot;
      }
    },
    {
            &quot;fullUrl&quot;: &quot;urn:uuid:f4534fe7-5e7a-4ebd-85aa-cc4efd187b13&quot;,
      &quot;resource&quot;: {
        &quot;resourceType&quot;: &quot;Patient&quot;,
        &quot;id&quot;: &quot;abc&quot;,
        &quot;name&quot;: [
          {
            &quot;family&quot;: &quot;Smith-Johnson&quot;,
            &quot;given&quot;: [
              &quot;Betsy&quot;
            ]
          }
        ]
      },
      &quot;request&quot;: {
        &quot;method&quot;: &quot;POST&quot;,
        &quot;url&quot;: &quot;Patient&quot;
      }
    }
  ]
}
</code></pre></div>



<a name="199028616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/199028616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#199028616">(May 28 2020 at 14:23)</a>:</h4>
<p><a href="http://jira.hl7.org/browse/FHIR-27742">FHIR#27742</a> - note that the current language strongly supports <span class="user-mention" data-user-id="191757">@Christiaan Knaap</span>'s position.</p>



<a name="199028872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/199028872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#199028872">(May 28 2020 at 14:24)</a>:</h4>
<p>+1, that has been my interpretation as well</p>



<a name="199552567"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relative%20reference%20between%20transaction%20bundle%20entries/near/199552567" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yan Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relative.20reference.20between.20transaction.20bundle.20entries.html#199552567">(Jun 02 2020 at 20:58)</a>:</h4>
<p>Thank you all for the clarification</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
