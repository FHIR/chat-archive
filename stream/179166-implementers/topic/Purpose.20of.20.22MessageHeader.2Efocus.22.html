---
layout: page
title: "FHIR Chat  · Purpose of &quot;MessageHeader.focus&quot; · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html">Purpose of &quot;MessageHeader.focus&quot;</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="159800663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159800663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159800663">(Mar 02 2019 at 14:53)</a>:</h4>
<p>I'm trying to understand the specific intent behind MessageHeader.focus, to prevent myself from using it improperly.</p>
<p>I have a Messaging paradigm for submitting a ServiceRequest. In it, I send a ServiceRequest + a half dozen other related referenced resources like Patient, Practitioner, etc... (the event is called "add-service-request")</p>
<p>Now, it's clear from the event "add-service-request" that the message is primarily focused on the ServiceRequest. None the less, should I be using the MessageHeader.focus to reference the ServiceRequest bundle (and ONLY that resource)?</p>



<a name="159800821"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159800821" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159800821">(Mar 02 2019 at 14:57)</a>:</h4>
<p>Also, in words that are different than what is published on <a href="http://build.fhir.org/messageHeader.html" target="_blank" title="http://build.fhir.org/messageHeader.html">build.fhir.org/messageHeader.html</a>, what is the main purpose of messageHeader.focus (I'm having a hard time understanding exactly from the wording that is there)?</p>



<a name="159803252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159803252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159803252">(Mar 02 2019 at 15:51)</a>:</h4>
<p>Messaging is all about events.  The MessageHeader.focus points to the focus of the event.  Typically there will only be one focus.  However, for some events (e.g. a merge) there can be more than one.  Everything else in the message needs to connect to the focus resource(s) through some pathway of forward and/or backward links.</p>



<a name="159803694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159803694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159803694">(Mar 02 2019 at 16:03)</a>:</h4>
<p>Great thanks, that's pretty clear and leads to my next question:</p>
<p>Let's say I make updates to my ServiceRequest and want to communicate that to others via messages. These updates might be to the ServiceRequest resource, or to an associated appointment, or to the Patient resource, or task etc...</p>
<p>TYPICALLY the workflow is that these resources are updated one at a time (i just added updated the ServiceRequest.status, or I just moved the appointment timeslot, etc...)</p>
<p>I have two architectures in mind for how to deal with sending these update messages out</p>
<p>ARCHITECTURE 1:<br>
- Create a message event for each thing that can happen (e.g., add-appointment, update-appointment, update-service-request, update-status, add-document, etc...). Each of these events is essentially about a single resource in the ServiceRequest.</p>
<p>ARCHITECTURE 2:<br>
- Create just one or two events (just update-service-request and possibly add-to-service-requeset ... or something along those lines) where the messageHeader.focus points to the resource of interest in that particular update. (this is kind of mimicking a more RESTful pub/sub architecture)</p>
<p>Is there a preferred/more common approach to this?</p>



<a name="159811808"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159811808" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159811808">(Mar 02 2019 at 19:45)</a>:</h4>
<p>The most common approach is not to use messaging at all and to use something similar to architecture 1 and just RESTfully create/update/delete resources as needed.  Messaging is, by nature, a custom solution where all the participants need to customize their solutions to work with an agreed set of message events, agreed structures for payloads and agreed sets of responses to received messages.  With REST on the other hand, the possible events (create/read/update/delete), payloads and responses are already pre-defined.  That makes it a more open interface and more useable for alternate purposes.  So if you don't <em>need</em> to use messaging, don't.</p>
<p>However, in some cases, REST won't meet requirements.  REST doesn't provide context about what's happening or why.  For example, a RESTful Encounter update could represent a bed transfer, a change to planned discharge date, an actual discharge, etc.  It might be possible to infer what's going on by comparing previous data to new data, but it's not always obvious and sometimes multiple things will happen at once.  If you have business rules that enforce different access privileges based on specific types of updates, you may need the "event code" that messaging provides.  The other reason for messaging is if the systems involved don't support any query ability to retrieve contextual resources.  For example, if you send a "create Encounter" REST call, the patient, admitting practitioner, reason for admission, etc. will all be references to other resources.  If there's no ability for someone to retrieve those references, then you may need to pass everything together in one package.</p>
<p>In terms of the appropriate boundaries for events, there's no particular rules as it'll be driven by business requirements.  If there are distinct rules, access privileges or responses for "add appointment, update appointment, update status, add document", then they may need to be distinct events.  If you don't have a need to make them separate, then the only benefit would be slightly lighter-weight messages with a cost of considerably more development effort and testing.</p>



<a name="159812838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159812838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159812838">(Mar 02 2019 at 20:13)</a>:</h4>
<p>Thanks, that's extremly helpful. </p>
<p>We initially went with messaging due to routing via HIAL needs, which is no longer a need so we are re-evaluating our approach.</p>
<p>1. Is it ok to have an implementation with mixed paradigms, where some business functions are solved with a restful paradigm and others with Messaging? or is it supposed to be an all or nothing thing into either camp?</p>
<p>2. When it comes to letting other systems know about changes to a resource in a restful paradigm, are subscriptions the way to go?</p>



<a name="159816504"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159816504" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159816504">(Mar 02 2019 at 21:51)</a>:</h4>
<p>1. FHIR was very  much designed to support/enable mixed modes and to ease conversion between the different paradigms.  Use REST where you can, but where the need dictates that a document approach or a messaging approach is going to better fit the use-case, then use those.  The resource instances should end up looking the same regardless.</p>



<a name="159816590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159816590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159816590">(Mar 02 2019 at 21:53)</a>:</h4>
<p>2. Subscriptions and polling are the two primary mechanisms.  Subscriptions means you'll get pushed a notification if something of interest has changed.  With polling, you can do a query of records of interest, filtered by _lastupdated and see if there's anything new.  Which approach makes sense depends on whether the system that needs to be notified is capable of receiving pushes.</p>



<a name="159817492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159817492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159817492">(Mar 02 2019 at 22:15)</a>:</h4>
<p>Perfect, that's incredibly clear and helpful, thanks <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> !</p>



<a name="159872778"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159872778" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> AbdulMalik Shakir <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159872778">(Mar 04 2019 at 00:50)</a>:</h4>
<p>For what its worth we struggled with the same issues with the "proper" use of message header for the Bidirectional Services electronic Referral project (BSeR). We considered the use of three elements in the message header: event, reason, and response. We use the MessageHeader.event to indicate the message type - referral request or referral request feedback. A referral request message is always sent by the referral initiator and a referral request feedback message is always sent by the referral recipient. We use the MessageHeader.reason to identify what triggered the sending of the request or feedback message. We developed a state machine for the referral (aka service request) and used the codes for each state as the value for MessageHeader.reason. We use the same message header structure for acknowledgment messages in which case we use the MessageHeader.response to indicate success, failure, or fatal failure of message receipt. </p>
<p>This approach is not novel, it mimics the message type/message trigger event model of HL7 v2. It works, we implemented for use in the HIMSS Interoperability Showcase along with Chicago Health System ACO, YMCA of America, and the Centers for Disease Control and Prevention. Whether or not this is an acceptable, flawed, or ideal approach is beyond my expertise. However, it is what we did and we describe our approach in our ballot. <a href="http://bit.ly/2tMX3s8" target="_blank" title="http://bit.ly/2tMX3s8">http://bit.ly/2tMX3s8</a>  We will hear what the community thinks of our solution and react to ballot comments in May.</p>



<a name="159872993"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/159872993" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#159872993">(Mar 04 2019 at 00:56)</a>:</h4>
<p>I think that's pretty much the intent</p>



<a name="160104489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/160104489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Hatt <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#160104489">(Mar 06 2019 at 15:20)</a>:</h4>
<p>Polling is an anti-pattern and I recommend RESTful PUT/POST, Messaging, or Subscriptions, especially if you're starting from scratch. In polling, the client is solely responsible for making sure they get all the updates. The other methods offer some form of acknowledgement so that the server knows the ServiceRequest made it downstream.</p>



<a name="160105019"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/160105019" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Hatt <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#160105019">(Mar 06 2019 at 15:26)</a>:</h4>
<p>I think Zapier did some research on their own internal data and found that some crazy high &gt; 95% of polling cycles were wasted. I can't find that blog but they have some notes on polling and deduplication here: <a href="https://zapier.com/developer/documentation/v2/polling/" target="_blank" title="https://zapier.com/developer/documentation/v2/polling/">https://zapier.com/developer/documentation/v2/polling/</a></p>



<a name="160105267"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/160105267" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Hatt <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#160105267">(Mar 06 2019 at 15:28)</a>:</h4>
<p>We poll something like 10 different EHR vendors proprietary APIs so we can turn it into FHIR or whatnot and broadcast stuff out. As soon as the EHRs can support webhooks we convert things as soon as we can because of the consistency guarantees.</p>



<a name="160109253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/160109253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#160109253">(Mar 06 2019 at 16:12)</a>:</h4>
<p>Polling is an anti-pattern in some environments.  Polling can be quite light-weight and can have variable frequency.  The benefit is that it often doesn't require any customization of client or server.  It works "out of the box".  Messaging, on the other hand, generally only works in a closed community where the participants have all been adapted to support a specific message flow.  Certainly if the systems involved can support subscriptions, it makes no sense to use polling.</p>



<a name="190855094"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/190855094" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#190855094">(Mar 17 2020 at 14:30)</a>:</h4>
<p><span class="user-mention" data-user-id="196402">@AbdulMalik Shakir</span> I just clicked the link in your message to see your state pattern for eReferral (<a href="http://bit.ly/2tMX3s8" target="_blank" title="http://bit.ly/2tMX3s8">http://bit.ly/2tMX3s8</a>  ) and it doesn't work anymore. Where might I be able to find it now?</p>



<a name="190873788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Purpose%20of%20%22MessageHeader.focus%22/near/190873788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Purpose.20of.20.22MessageHeader.2Efocus.22.html#190873788">(Mar 17 2020 at 16:25)</a>:</h4>
<p>Maybe it is in the <a href="http://hl7.org/fhir/us/bser/" target="_blank" title="http://hl7.org/fhir/us/bser/">BSeR IG</a>?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
