---
layout: page
title: "FHIR Chat  · Questions about fhirpath spec on collections · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Questions.20about.20fhirpath.20spec.20on.20collections.html">Questions about fhirpath spec on collections</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="183959918"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Questions%20about%20fhirpath%20spec%20on%20collections/near/183959918" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Pombrio <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Questions.20about.20fhirpath.20spec.20on.20collections.html#183959918">(Dec 20 2019 at 18:24)</a>:</h4>
<p>I have some questions about how some methods are supposed to behave on empty collections in fhirpath, where the spec isn't clear.</p>
<p>The Fhirpath spec (NormBallot2) says in section 4.3:</p>
<blockquote>
<p>Finally, FHIRPath supports the notion of functions, which all take a collection of values as input and produce another collection as output and may take parameters. For example:<br>
<code>(name.given | name.family).substring(0,4)</code></p>
</blockquote>
<p>This suggests to me that this example is valid, and that if name.given is "Jane" and name.family is "Smith", then this expression would produce the colleciton {'Jane', 'Smit'}.</p>
<p>However, <code>substring</code> is defined in section 5.6, which says</p>
<blockquote>
<p>The functions in this section [e.g. substring] operate on collections with a single item. If there is more than one item, or an item that is not a String, the evaluation of the expression will end and signal an error to the calling environment.</p>
</blockquote>
<p>If that's correct, then this example should produce an error. What's the intended behavior of .substring? Should it produce a collection in this case, or an error because it was passed a collection of more than a single item?</p>
<p>More interestingly, how about this example?<br>
<code>{}.substring(0, 4)</code><br>
Should it raise an error, or produce an empty collection? The note at the beginning of section 5.6 doesn't say what is supposed to happen with empty collections.</p>
<p>Relatedly, what should this expression produce? Should it raise an error, or produce 'T'?<br>
<code>{1, 2}.iif($this.exists(), 'T', 'F')</code><br>
And likewise?<br>
<code>{}.iif($this.empty(), 'T', 'F')</code><br>
I ask because <code>iif</code> is defined in section 5.5 ("Conversion"), which has the same note about raising an error on collections that have more than a single item.</p>



<a name="183967545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Questions%20about%20fhirpath%20spec%20on%20collections/near/183967545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Questions.20about.20fhirpath.20spec.20on.20collections.html#183967545">(Dec 20 2019 at 19:55)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="183989071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Questions%20about%20fhirpath%20spec%20on%20collections/near/183989071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Questions.20about.20fhirpath.20spec.20on.20collections.html#183989071">(Dec 21 2019 at 01:22)</a>:</h4>
<p>The example in section 4.3 is incorrect, that would produce an error. <a href="http://build.fhir.org/ig/HL7/FHIRPath/#indexofsubstring-string-integer" target="_blank" title="http://build.fhir.org/ig/HL7/FHIRPath/#indexofsubstring-string-integer">Substring</a> expects a singleton, so to invoke it on a collection you would use <code>.select()</code>. If you invoke <code>.substring()</code> on an empty collection, the result is an empty collection. And yes <a href="http://build.fhir.org/ig/HL7/FHIRPath/#iifcriterion-expression-true-result-collection-otherwise-result-collection-collection" target="_blank" title="http://build.fhir.org/ig/HL7/FHIRPath/#iifcriterion-expression-true-result-collection-otherwise-result-collection-collection"><code>.iff()</code></a> is a singleton function as well, so the example <code>{ 1, 2 }.iif(...</code> would throw an error, and the invocation on the empty collection would result in an empty collection. I've submitted a tracker (<a href="http://jira.hl7.org/browse/FHIR-25403" target="_blank" title="http://jira.hl7.org/browse/FHIR-25403">J#25403</a>) to address the example.</p>



<a name="184498798"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Questions%20about%20fhirpath%20spec%20on%20collections/near/184498798" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Pombrio <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Questions.20about.20fhirpath.20spec.20on.20collections.html#184498798">(Dec 30 2019 at 20:34)</a>:</h4>
<p>Thanks Bryn. That fully answers my question (together with the bit in spec that I had missed before that says "If a single-input function operates on an empty collection, the result is an empty collection").</p>
<p>It does make it hard to produce an expression that evaluates to <code>'A'</code> if a collection is empty, or <code>'B'</code> otherwise, which was the motivation behind this question. But I suppose you can say <code>collection.empty().iff($this, 'A', 'B')</code>.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
