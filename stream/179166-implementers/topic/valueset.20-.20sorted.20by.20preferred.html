---
layout: page
title: "FHIR Chat  · valueset - sorted by preferred · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html">valueset - sorted by preferred</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153930673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930673">(Jan 25 2018 at 06:57)</a>:</h4>
<p>How can we provide some "sort by preferred" functionality to a valueset? Is there an attribute in valueSet.include.code.concept that i can use like a "sequenceNumber" to sort on?<br>
Scenario: Physician 1 wants to select an ICD code from a list, using a search or type-ahead box, and the codes displayed should be sorted by any sort order we want, e.g. their "preferred codes" displayed first, not by default ICD  order.</p>



<a name="153930679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930679">(Jan 25 2018 at 10:42)</a>:</h4>
<p>how do you define what a 'preferred code' is?</p>



<a name="153930680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930680">(Jan 25 2018 at 10:43)</a>:</h4>
<p>this would probably be like a "most recent files" thing. When we select a code, it gets +1.</p>



<a name="153930681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930681">(Jan 25 2018 at 10:44)</a>:</h4>
<p>so, the system will know for each code, a score or a sequence number.</p>



<a name="153930682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930682">(Jan 25 2018 at 10:44)</a>:</h4>
<p>for that physician, or for that physician group.</p>



<a name="153930683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930683">(Jan 25 2018 at 10:47)</a>:</h4>
<p>the definition of "preferred codes" can be also provided as reference data by the hospital, <br>
e.g. "for surgeons, when they search for "accident", "CV accident" comes before "car accident", but for GPs, it is the other way around".<br>
What i want to convey is the information that supports this.</p>



<a name="153930684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930684">(Jan 25 2018 at 10:47)</a>:</h4>
<p>i don't see anything, so I could have an extension, say "score"..?<br>
unless there is something already</p>



<a name="153930692"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930692" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert McClure <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930692">(Jan 25 2018 at 13:57)</a>:</h4>
<p>This is yet another example where code system supplement would be used and then applied via an expansion profile. Keep in mind that a code system supplement is simply something that has information about code system concepts, such as "choice frequency" linked to the concept identifier. You can make these very specific so that it is applied for only one value set.</p>



<a name="153930701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930701">(Jan 25 2018 at 14:44)</a>:</h4>
<p>This would definitely be extension territory.  I don't think it would be captured with a code-system suppment because it's valueset-specific.  There'd be no such thing as a "preferred SNOMED code", but there might be a "preferred code from this list of SNOMED diagnoses" and a different "preffered code from this list of SNOMED procedures"</p>



<a name="153930706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert McClure <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930706">(Jan 25 2018 at 15:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> Ok, I guess that makes sense with the focus on one specific value set. But if this was applied for any value set that listed ICD codes, then would a supplement be the choice then?</p>



<a name="153930711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153930711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153930711">(Jan 25 2018 at 16:11)</a>:</h4>
<p>I can't think of a use-case that would be valueset-independent...</p>



<a name="153933151"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153933151" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153933151">(Jan 29 2018 at 23:28)</a>:</h4>
<p>If you're going to explicitly order the codes, then do it in the ValueSet and just use the definition (ie do it all client-side, since this is a UI/UX issue).  Otherwise, you could use a terminology server that returns results from $expand with a filter parameter in "best match" order.<br>
Our terminology server allows you to include an extension to adjust the weights on codes, so for your use case the GP ValueSet would increase the weight for "car accident" and the surgeon's ValueSet would do the same for "CV accident"</p>



<a name="153964855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153964855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Malgorzata Schwab <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153964855">(May 25 2018 at 16:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>   So... what is the conclusion?  Sort is value-set specific, is that a good use case for an extensions? how to go about it?</p>



<a name="153964952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153964952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153964952">(May 25 2018 at 20:09)</a>:</h4>
<p>Define an extension on ValueSet.compose.include.concept that indicates relative popularity and define an operation that allows you to generate an expansion sorted in that order</p>



<a name="153964963"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153964963" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153964963">(May 25 2018 at 20:17)</a>:</h4>
<p>a parameter to the expansion operation, not a new operation</p>



<a name="153965104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153965104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153965104">(May 28 2018 at 10:42)</a>:</h4>
<p>Is there a need for the parameter?  If the ValueSet contains the extension elements, then presumably that's indication enough that they should be used to influence the sort order.  Ontoserver supports such an extension (documented here <a href="http://ontoserver.csiro.au/docs/5.1/api-fhir-extensions.html" target="_blank" title="http://ontoserver.csiro.au/docs/5.1/api-fhir-extensions.html">http://ontoserver.csiro.au/docs/5.1/api-fhir-extensions.html</a>) at the <code>compose.include</code> level</p>



<a name="153965521"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153965521" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert McClure <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153965521">(May 30 2018 at 13:29)</a>:</h4>
<p>Once a sort value is defined for the valueset via an extension, wouldn't we just expect $expand to bring back the sort value as another concept attribute, and the client can use that to order the list?</p>



<a name="153965530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153965530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153965530">(May 30 2018 at 13:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191343">@Michael Lawley</span> That is an interesting extension. Just to clarify, when you say "adjust the ranking ... of codes when performing an $expand with filter", you mean the codes expanded from he include section. Is that right? Because my first thought was that ranking applies to $expand?filter=xxxx operation.</p>



<a name="153965957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153965957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153965957">(May 30 2018 at 22:32)</a>:</h4>
<p><span class="user-mention" data-user-id="191503">@Robert McClure</span> Yes, I think that's a good way to manage it.  However, for large expansions it might be nice if the results could be returned sorted on that field so that 'give me the first n results' was actually useful.</p>



<a name="153965964"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153965964" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153965964">(May 30 2018 at 22:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191506">@Yunwei Wang</span> Yes, after performing the $expand, then applying the <code>filter=xxx</code> to match and rank the codes, we adjust the scores of the codes that were contributed by <strong>that</strong> include.</p>



<a name="153966076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153966076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153966076">(May 31 2018 at 13:51)</a>:</h4>
<p>Can you give me an example how the filter works with scores?<br>
Thanks.</p>



<a name="153968812"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/valueset%20-%20sorted%20by%20preferred/near/153968812" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/valueset.20-.20sorted.20by.20preferred.html#153968812">(Jun 13 2018 at 00:34)</a>:</h4>
<p>Lets assume there are two include criteria (an OR) - one is "all active SNOMED codes" and the other is "all inactive SNOMED codes". Further assume that the first criteria has a boost of 1.5 and the second of 0.5.  Next, assume that there are two codes for 'cataract', one of which is inactive.  Then you do a <code>$expand?filter=catarac</code> (note the substring), both codes get the same raw score (say, 0.875) but because of the weighting the active concept ends up with a score of 1.3125 and the inactive concept gets a score of 0.4375.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
