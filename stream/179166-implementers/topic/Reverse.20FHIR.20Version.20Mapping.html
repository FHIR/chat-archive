---
layout: page
title: "FHIR Chat  · Reverse FHIR Version Mapping · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20FHIR.20Version.20Mapping.html">Reverse FHIR Version Mapping</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="192480220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20FHIR%20Version%20Mapping/near/192480220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Swindale <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20FHIR.20Version.20Mapping.html#192480220">(Apr 01 2020 at 03:37)</a>:</h4>
<p>Howdy <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> . I've tested using org.hl7.fhir.convertors.VersionConvertor_30_40 (<a href="https://github.com/hapifhir/org.hl7.fhir.core" title="https://github.com/hapifhir/org.hl7.fhir.core">https://github.com/hapifhir/org.hl7.fhir.core</a>) to convert some STU3 resources to R4 and from what I've seen so far this seems to match my own original implementation. However, we also have the need to convert back from R4 to STU3 for a number of resources. I can't find anything in the org.hl7.fhir.convertors project that does that. I've also noticed that there are StructureMaps on the HL7 site for this purpose so I'm hoping there may already be an implementation. Is there any intention to incorporate the back conversion into the convertors project? I <em>think</em> I've got something that covers our discrete requirements but would prefer to use an existing library if there's something available.</p>



<a name="192480444"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20FHIR%20Version%20Mapping/near/192480444" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20FHIR.20Version.20Mapping.html#192480444">(Apr 01 2020 at 03:43)</a>:</h4>
<p>VersionConvertor_30_40 mostly has bidirectional converters. what resource types are you interested in?</p>



<a name="192482735"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20FHIR%20Version%20Mapping/near/192482735" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Swindale <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20FHIR.20Version.20Mapping.html#192482735">(Apr 01 2020 at 04:37)</a>:</h4>
<p>oh right. I <del>mustn't</del> didn't have had a good enough look. At the moment, just CodeSystem, ValueSet and ConceptMap. At the moment I've got the following. Obviously, VersionConverter_40_30 doesn't exist, so that'll be the bit I need to work out. Cheers. </p>
<div class="codehilite"><pre><span></span>           <span class="n">IBaseResource</span> <span class="n">sourceResource</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">sourceJsonParser</span><span class="p">.</span><span class="na">parseResource</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
            <span class="n">IBaseResource</span> <span class="n">targetResource</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">sourceResource</span><span class="p">.</span><span class="na">getStructureFhirVersionEnum</span><span class="p">().</span><span class="na">isEquivalentTo</span><span class="p">(</span><span class="n">FhirVersionEnum</span><span class="p">.</span><span class="na">DSTU3</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="n">targetResource</span><span class="p">.</span><span class="na">getStructureFhirVersionEnum</span><span class="p">().</span><span class="na">isEquivalentTo</span><span class="p">(</span><span class="n">FhirVersionEnum</span><span class="p">.</span><span class="na">R4</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">targetResource</span> <span class="o">=</span> <span class="n">VersionConvertor_30_40</span><span class="p">.</span><span class="na">convertResource</span><span class="p">((</span><span class="n">Resource</span><span class="p">)</span> <span class="n">sourceResource</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sourceResource</span><span class="p">.</span><span class="na">getStructureFhirVersionEnum</span><span class="p">().</span><span class="na">isEquivalentTo</span><span class="p">(</span><span class="n">FhirVersionEnum</span><span class="p">.</span><span class="na">R4</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="n">targetResource</span><span class="p">.</span><span class="na">getStructureFhirVersionEnum</span><span class="p">().</span><span class="na">isEquivalentTo</span><span class="p">(</span><span class="n">FhirVersionEnum</span><span class="p">.</span><span class="na">DSTU3</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">targetResource</span> <span class="o">=</span> <span class="n">VersionConvertor_40_30</span><span class="p">.</span><span class="na">convertResource</span><span class="p">((</span><span class="n">Resource</span><span class="p">)</span> <span class="n">sourceResource</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">targetResource</span> <span class="o">=</span> <span class="n">VersionConvertor_30_40</span><span class="p">.</span><span class="na">convertResource</span><span class="p">((</span><span class="n">Resource</span><span class="p">)</span> <span class="n">sourceResource</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="na">targetJsonParser</span><span class="p">.</span><span class="na">encodeResourceToWriter</span><span class="p">(</span><span class="n">targetResource</span><span class="p">,</span> <span class="n">writer</span><span class="p">);</span>
</pre></div>



<a name="192482921"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20FHIR%20Version%20Mapping/near/192482921" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20FHIR.20Version.20Mapping.html#192482921">(Apr 01 2020 at 04:42)</a>:</h4>
<p>no the 30_40 has methods for both ways for those classes.</p>



<a name="192482993"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20FHIR%20Version%20Mapping/near/192482993" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20FHIR.20Version.20Mapping.html#192482993">(Apr 01 2020 at 04:43)</a>:</h4>
<p>e.g. org.hl7.fhir.convertors.conv30_40.CodeSystem30_40 has both</p>
<div class="codehilite"><pre><span></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">r4</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">CodeSystem</span> <span class="nf">convertCodeSystem</span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">dstu3</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">CodeSystem</span> <span class="n">src</span><span class="p">);</span>
</pre></div>


<p>and</p>
<div class="codehilite"><pre><span></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">dstu3</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">CodeSystem</span> <span class="nf">convertCodeSystem</span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">r4</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">CodeSystem</span> <span class="n">src</span><span class="p">)</span> <span class="p">{</span>
</pre></div>



<a name="192483062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20FHIR%20Version%20Mapping/near/192483062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Swindale <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20FHIR.20Version.20Mapping.html#192483062">(Apr 01 2020 at 04:44)</a>:</h4>
<p>wow.... I really should have looked harder. Thanks <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> ! Thats a big help</p>



<a name="192483070"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20FHIR%20Version%20Mapping/near/192483070" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20FHIR.20Version.20Mapping.html#192483070">(Apr 01 2020 at 04:44)</a>:</h4>
<p>and VersionConvertor_30_40 has</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">r4</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">Resource</span> <span class="nf">convertResource</span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">dstu3</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">Resource</span> <span class="n">src</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">nullOk</span><span class="p">);</span>
</pre></div>


<p>and</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">r4</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">Resource</span> <span class="nf">convertResource</span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">hl7</span><span class="p">.</span><span class="na">fhir</span><span class="p">.</span><span class="na">dstu3</span><span class="p">.</span><span class="na">model</span><span class="p">.</span><span class="na">Resource</span> <span class="n">src</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">nullOk</span><span class="p">);</span>
</pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
