---
layout: page
title: "FHIR Chat  · TestScript - assert processing · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html">TestScript - assert processing</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="198160558"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198160558" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198160558">(May 20 2020 at 06:55)</a>:</h4>
<p>The FHIR Testing spec describes that subsequent test asserts are not evaluated when a prior assert within the same test evaluates to a failure. (<a href="https://www.hl7.org/fhir/testing.html#assert">https://www.hl7.org/fhir/testing.html#assert</a>)   Why is that?</p>
<p>From a user perspective, it would be more informative if you would know all the error messages of the subsequent test asserts. This way you can fix those errors as well before you set up the next test round.</p>



<a name="198161556"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198161556" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198161556">(May 20 2020 at 07:09)</a>:</h4>
<p>How do we know if the subsequent assert depends on the previous and can therefore be evaluated?</p>



<a name="198166948"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198166948" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198166948">(May 20 2020 at 08:14)</a>:</h4>
<p>Then that subsequent assert will fail as well, and hopefully, the test platform will be smart enough to give a clear error message?</p>



<a name="198169269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198169269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198169269">(May 20 2020 at 08:42)</a>:</h4>
<p>But I get the point. The next depended asserts may fail with a lot of unrelated error making it look like a total mess for the end user.</p>



<a name="198476992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198476992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198476992">(May 22 2020 at 18:25)</a>:</h4>
<p>I've actually been thinking about this issue for a couple of days now. I believe the easiest approach would be a new assert boolean element that would instruct the test engine to either 1) Stop test processing on assert error or, 2) Continue test processing on assert error. This would give the TestScript author the needed control over a grouping of asserts and their behavior.</p>
<p>Something like this:</p>
<div class="codehilite"><pre><span></span><code>&lt;action&gt;
    &lt;assert&gt;
        &lt;description value=&quot;Confirm that the returned HTTP status is 201(Created).&quot;/&gt;
        &lt;direction value=&quot;response&quot;/&gt;
        &lt;responseCode value=&quot;201&quot;/&gt;
        &lt;stopTestOnError value=&quot;false&quot;/&gt;&lt;!-- [NEW ELEMENT] Allow next assert to evaluate if current assert fails --&gt;
        &lt;warningOnly value=&quot;false&quot;/&gt;
    &lt;/assert&gt;
&lt;/action&gt;
</code></pre></div>


<p>Thoughts?  Comments?</p>



<a name="198477943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198477943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198477943">(May 22 2020 at 18:33)</a>:</h4>
<p>Why not use the severity "error / warning / info" codes?</p>



<a name="198478098"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198478098" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198478098">(May 22 2020 at 18:34)</a>:</h4>
<p>Currently, the test only stops on error.</p>



<a name="198478119"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198478119" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198478119">(May 22 2020 at 18:34)</a>:</h4>
<p>i mean instead of a boolean</p>



<a name="198478135"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198478135" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198478135">(May 22 2020 at 18:35)</a>:</h4>
<p>(not sure if that is what you mean too)</p>



<a name="198478316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198478316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198478316">(May 22 2020 at 18:36)</a>:</h4>
<p>So, the new element would be "stopTest" or "stopTestOn" with a coded value of either "info", "warning" or "error". That would provide a bit more control.</p>



<a name="198478378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198478378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198478378">(May 22 2020 at 18:37)</a>:</h4>
<p>Actually I was thinking of this wrong but I think you just corrected it :)</p>



<a name="198478505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198478505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198478505">(May 22 2020 at 18:38)</a>:</h4>
<p>Yes, if the element means "threshold" - then it would be error or warning, and that would determine if the script stops depending on whether the assertion returns errors or warnings</p>



<a name="198478945"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198478945" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198478945">(May 22 2020 at 18:40)</a>:</h4>
<p>I suppose you could add "fatal" for any exceptions.<br>
I'm hoping to play around with this concept internally over the next couple of weeks. I was thinking the boolean would be easier and still provide the needed functionality. The coded value as a threshold does sound interesting though.</p>



<a name="198479234"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198479234" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jose Costa Teixeira <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198479234">(May 22 2020 at 18:42)</a>:</h4>
<p>cool</p>



<a name="198479797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198479797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198479797">(May 22 2020 at 18:47)</a>:</h4>
<p>Sounds like a good HL7 FHIR JIRA enhancement request. I'll try to get one created next week - long holiday weekend for me coming up.</p>



<a name="198499412"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198499412" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Jordan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198499412">(May 22 2020 at 21:56)</a>:</h4>
<p>I'd support adding a boolean element as it's more deterministic and there may not always be an exact match between response codes sent by an implementation and the requirements of a tester. Certainly, there is a requirement for continued execution of a test script after some failures, a common one might be regex checks on the (computer-friendly) name property of resources.</p>



<a name="198813985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198813985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198813985">(May 26 2020 at 20:00)</a>:</h4>
<p>Great! I think I would support the boolean element more as well based on the arguments given bij Peter Jordan. Either way, I think this is a great addition to the assert definition as we will use it for sure in our TestScripts.</p>



<a name="198838151"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/198838151" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan Dubrov <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#198838151">(May 27 2020 at 00:25)</a>:</h4>
<p>For what it worth, in our TestScript runner we run all assertions after a failed operation. The assumption here being that asserts don't change state of the system. Therefore, subsequent failed asserts fail not because of the previous assert failed, but because of the operation itself. In other words, order of asserts block after an operation _shouldn't matter_, so semantically they are evaluated as a whole.</p>
<p>This allows writing asserts in a block without thinking too hard which one of those is more useful for troubleshooting. For example, if we assert both status code and output, sometimes it could be status code that is more useful, sometimes it would be output. In our runner, you'll get something like "status code is 400 AND your output is OperationOutcome instead of Patient you expected".</p>
<p>I think that adding an explicit flag will make TestScripts even more confusing. Even as they are now, they are not easy to write (we use them extensively for API testing).</p>



<a name="199754125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/199754125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#199754125">(Jun 04 2020 at 14:23)</a>:</h4>
<p><a href="https://jira.hl7.org/browse/FHIR-27772">FHIR-27772</a> created to track this issue.</p>



<a name="212354599"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/212354599" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#212354599">(Oct 05 2020 at 20:47)</a>:</h4>
<p>Picking up this thread again and looking for additional feedback.</p>
<p>Per the FHIR-I WG discussion on this topic, a suggestion is to have assertions be able to point to other assertions that are 'dependencies'.  Expectation is that all assertions would run, but you'd skip assertions that have declared dependencies if one or more of the dependencies had failed.</p>



<a name="212355504"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/212355504" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#212355504">(Oct 05 2020 at 20:55)</a>:</h4>
<p>In order to support this 'dependency' between asserts the current default behavior of a FHIR Test Engine would need to change. Currently, this behavior is to stop test execution on the first failed assert evaluation. The new behavior would then have to be to evaluate all asserts regardless of failure status except where dependencies exist.</p>
<p>Looking for pros and cons of this approach versus the introduction of the 'assert.stopTestOnFail' boolean.</p>



<a name="212359089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/212359089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#212359089">(Oct 05 2020 at 21:27)</a>:</h4>
<p>Primary pro is that when you have different tests with different dependencies you don't either have to run a bunch you know will fail (which causes wasted time/resources) or skip all tests after a failure - when some of them might still succeed.  The cost is that you need to determine dependencies (i.e. what tests have no hope of working if a previous test failed).</p>



<a name="212363539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/TestScript%20-%20assert%20processing/near/212363539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Ettema <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/TestScript.20-.20assert.20processing.html#212363539">(Oct 05 2020 at 22:19)</a>:</h4>
<p>I've come up with two TestScript examples for a test with asserts that follow each idea.</p>
<div class="spoiler-block"><div class="spoiler-header">

<p>TestScript example using stopTestOnFail</p>
</div><div class="spoiler-content" aria-hidden="true">

<p>&lt;test&gt;<br>
  &lt;action&gt;<br>
    &lt;operation&gt;<br>
      &lt;type&gt;<br>
        &lt;system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/&gt;<br>
        &lt;code value="search"/&gt;<br>
      &lt;/type&gt;<br>
      &lt;resource value="AllergyIntolerance"/&gt;<br>
      &lt;accept value="json"/&gt;<br>
      &lt;encodeRequestUrl value="true"/&gt;<br>
      &lt;params value="?identifier=ABC123"/&gt;<br>
    &lt;/operation&gt;<br>
  &lt;/action&gt;<br>
  &lt;action&gt;<br>
    &lt;assert&gt;<br>
      &lt;response value="okay"/&gt;&lt;!-- Verify Response Code is 200(OK) --&gt;<br>
      &lt;stopTestOnFail value="true"/&gt;<br>
      &lt;warningOnly value="false"/&gt;<br>
    &lt;/assert&gt;<br>
  &lt;/action&gt;<br>
  &lt;action&gt;<br>
    &lt;assert&gt;<br>
      &lt;contentType value="json"/&gt;&lt;!-- Verify Content-Type is FHIR JSON --&gt;<br>
      &lt;stopTestOnFail value="true"/&gt;<br>
      &lt;warningOnly value="false"/&gt;<br>
    &lt;/assert&gt;<br>
  &lt;/action&gt;<br>
  &lt;action&gt;<br>
    &lt;assert&gt;<br>
      &lt;resource value="Bundle"/&gt;&lt;!-- Verify Response payload is a Bundle --&gt;<br>
      &lt;stopTestOnFail value="false"/&gt;<br>
      &lt;warningOnly value="false"/&gt;<br>
    &lt;/assert&gt;<br>
  &lt;/action&gt;<br>
  &lt;action&gt;<br>
    &lt;assert&gt;<br>
      &lt;validateProfileId value="bundle-profile"/&gt;&lt;!-- Validate Response payload as a Bundle --&gt;<br>
      &lt;stopTestOnFail value="false"/&gt;<br>
      &lt;warningOnly value="false"/&gt;<br>
    &lt;/assert&gt;<br>
  &lt;/action&gt;<br>
&lt;/test&gt;</p>
</div></div>

<div class="spoiler-block"><div class="spoiler-header">

<p>TestScript example using assert dependencies</p>
</div><div class="spoiler-content" aria-hidden="true">

<p>&lt;test&gt;<br>
  &lt;action&gt;<br>
    &lt;operation&gt;<br>
      &lt;type&gt;<br>
        &lt;system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/&gt;<br>
        &lt;code value="search"/&gt;<br>
      &lt;/type&gt;<br>
      &lt;resource value="AllergyIntolerance"/&gt;<br>
      &lt;accept value="json"/&gt;<br>
      &lt;encodeRequestUrl value="true"/&gt;<br>
      &lt;params value="?identifier=ABC123"/&gt;<br>
    &lt;/operation&gt;<br>
  &lt;/action&gt;<br>
  &lt;action&gt;<br>
    &lt;assert id="searchOk"&gt;<br>
      &lt;response value="okay"/&gt;&lt;!-- Verify Response Code is 200(OK) --&gt;<br>
      &lt;warningOnly value="false"/&gt;<br>
    &lt;/assert&gt;<br>
  &lt;/action&gt;<br>
  &lt;action&gt;<br>
    &lt;assert id="searchContentType"&gt;<br>
      &lt;contentType value="json"/&gt;&lt;!-- Verify Content-Type is FHIR JSON --&gt;<br>
      &lt;dependentOnAssert value="searchOk"/&gt;<br>
      &lt;warningOnly value="false"/&gt;<br>
    &lt;/assert&gt;<br>
  &lt;/action&gt;<br>
  &lt;action&gt;<br>
    &lt;assert&gt;<br>
      &lt;resource value="Bundle"/&gt;&lt;!-- Verify Response payload is a Bundle --&gt;<br>
      &lt;dependentOnAssert value="searchOk"/&gt;<br>
      &lt;warningOnly value="false"/&gt;<br>
    &lt;/assert&gt;<br>
  &lt;/action&gt;<br>
  &lt;action&gt;<br>
    &lt;assert&gt;<br>
      &lt;validateProfileId value="bundle-profile"/&gt;&lt;!-- Validate Response payload as a Bundle --&gt;<br>
      &lt;dependentOnAssert value="searchOk"/&gt;<br>
      &lt;warningOnly value="false"/&gt;<br>
    &lt;/assert&gt;<br>
  &lt;/action&gt;<br>
&lt;/test&gt;</p>
</div></div>

<p><strong>In the first example, the use of the 'stopTestOnFail' boolean is shown.</strong></p>
<p><em>Some Pros</em></p>
<ul>
<li>Each assert explicitly and succinctly controls its own behavior</li>
<li>Ordering of asserts is not affected, i.e. the TestScript author is free to organize the asserts in any order</li>
<li>On the first failed assert where stopTestOnFail=true, all remaining asserts are skipped</li>
</ul>
<p><em>Some Cons</em></p>
<ul>
<li>Each assert must declare the 'stopTestOnFail' boolean, FHIR does not allow default values on boolean elements</li>
</ul>
<p><strong>In the second example, the declaration of assert id values and the use of a new 'dependentOnAssert' element is shown.</strong></p>
<p><em>Some Pros</em></p>
<ul>
<li>Dependency declarations provide additional documentation of related asserts</li>
</ul>
<p><em>Some Cons</em></p>
<ul>
<li>Ordering becomes more restrictive where those failed asserts that must stop the test execution need to be declared first. Relationships between dependent asserts requires more work of the TestScript author.</li>
<li>Asserts that are a dependency must define unique id values. In a lengthy TestScripts with numerous tests this may become cumbersome</li>
<li>The FHIR Test Engine would still need to process all remaining asserts to determine if there are any dependencies</li>
</ul>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
