---
layout: page
title: "FHIR Chat  · Transactions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html">Transactions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153813306"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813306" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813306">(Feb 26 2016 at 14:59)</a>:</h4>
<p>I wrote a post about transactions, as it was a topic of some confusion on the Skype channels a few days ago.... <a href="http://lightmyfhir.org/2016/02/26/fhir-transactions/" target="_blank" title="http://lightmyfhir.org/2016/02/26/fhir-transactions/">http://lightmyfhir.org/2016/02/26/fhir-transactions/</a></p>



<a name="153813307"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813307" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813307">(Feb 26 2016 at 16:13)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191381">@Jason Walonoski</span>!</p>
<p>Where did you get the idea that:<br>
<code>"subject":{"reference":"Patient/9e33a01d-c35f-4920-9179-50d5b8a6f992"},</code><br>
is the way to refer to a patient from an Observation in a bundle?</p>



<a name="153813308"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813308" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813308">(Feb 26 2016 at 16:15)</a>:</h4>
<p>On my reading, it should just be:<br>
<code>"subject":{"reference":"urn:uuid:9e33a01d-c35f-4920-9179-50d5b8a6f992"},</code></p>
<p>(But unless there's an example one way or the other, I'm sure it's just ambiguous.)</p>
<p>On this same topic, Dan Gottlieb and I worked out <a href="https://docs.google.com/document/d/1ubxRmU0rqy5Fb73S9xWSuFUK7ZoyIr_bdh5mJX-U6yk/edit" target="_blank" title="https://docs.google.com/document/d/1ubxRmU0rqy5Fb73S9xWSuFUK7ZoyIr_bdh5mJX-U6yk/edit">these scenarios</a> -- but this involved guesswork too.</p>



<a name="153813314"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813314" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813314">(Feb 26 2016 at 18:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> to be honest, I wasn't sure if the urn:uuid should go in the reference or not.</p>



<a name="153813509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813509">(Feb 29 2016 at 13:36)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  wrote:</p>
<blockquote>
<p>Jason - thanks for the blog post. I don't really like the idea of creating yet another transaction type - specially one that overlaps so much with transaction. But I do think you captured the use case - get a graph of records, push them elsewhere.<br>
so let's say, you get a $everything, and you want to post it to the server, and you can't dictate the ids to the server. So we want the client to do as little as possible and still have the semantics clear, right? And you're concerned that they're not (and Josh really is too).<br>
so really, let's say that the client has to minimally change the batch type to transaction, and populate the request - that has to be done. What we clearly don't want to do is have the client have to touch any of the ids - we want the server to have to do all that<br>
so it seems that the sweetest solution to this is to allow all the ids to be populated in the resources, and avoid the in/out UUID confusion you ran into, and just say, make the request a POST to /base, and the server can infer, from the type and id, that you want it to sort out the ids however it does. And so post to [base] inside a transaction has a special meaning. And then we say, if a client explicitly makes it a PUT to a full id, then either the server honours it or not.<br>
I think those are light changes to the spec, and the implementations, but remove the potential for confusion...?</p>
</blockquote>



<a name="153813510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813510">(Feb 29 2016 at 13:38)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> So, when you say</p>
<blockquote>
<p>make the request a POST to /base</p>
</blockquote>
<p>Are you talking about the transaction POST to /base, or the <code>Bundle.entry.request.method="POST"</code> and <code>Bundle.entry.request.url="[base]"</code>?</p>



<a name="153813511"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813511" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813511">(Feb 29 2016 at 13:39)</a>:</h4>
<p>second</p>



<a name="153813512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813512">(Feb 29 2016 at 13:41)</a>:</h4>
<p>And if they POST to base, then the client is assuming that the server will do things like patient matching and possible record de-duplication?</p>



<a name="153813514"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813514" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813514">(Feb 29 2016 at 13:41)</a>:</h4>
<p>hmm. I'm not sure how far that assumptions should go?</p>



<a name="153813515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813515">(Feb 29 2016 at 13:42)</a>:</h4>
<p>Me either. That is why I was suggesting a new <code>transfer</code> code or new <code>$transfer</code> operation.</p>



<a name="153813517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813517">(Feb 29 2016 at 13:43)</a>:</h4>
<p>I think that's orthogonal. You'd still have to state the assumptions either way </p>



<a name="153813518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813518">(Feb 29 2016 at 13:45)</a>:</h4>
<p>I agree, but a new code or operation makes it very explicit (and hopefully obvious) to both parties. I'm not tied to that proposal though.</p>



<a name="153813520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813520">(Feb 29 2016 at 13:46)</a>:</h4>
<p>well, you might argue that it's less obvious, but I don't think we want to create a whole new operation for it. But it's hard to progress if we can't resolve the assumptions</p>



<a name="153813523"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813523" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813523">(Feb 29 2016 at 13:50)</a>:</h4>
<p>OK. So... here it goes:</p>
<ul>
<li>If the client specifies <code>Bundle.entry.request.method="POST"</code> and <code>Bundle.entry.request.url="[base]"</code> during a transaction, the server assumes this record is a transfer from another system. There may already exist duplicate records on the server. The server determines the outcome of each operation. The server must maintain the graph of resources in the entire transaction, but not the specific IDs given.</li>
<li>If the client specifies other <code>Bundle.entry.request.method &amp;&amp; Bundle.entry.request.url</code> combinations (with or without conditional modifiers), then the client is specifying that it knows exactly what it wants to do with the resource. The server replies normally for each operation.</li>
</ul>



<a name="153813526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813526">(Feb 29 2016 at 13:55)</a>:</h4>
<p>So it's server discretion to decide one what basis something is a duplicate? </p>



<a name="153813527"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813527" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813527">(Feb 29 2016 at 13:56)</a>:</h4>
<p>Well, I don't know, this is my suggestion. I think it makes sense that way though, because the client doesn't know what the server has (and may not have permission to search all the resources to do that either)... it just wants to transfer a patient record.</p>



<a name="153813528"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813528" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813528">(Feb 29 2016 at 13:59)</a>:</h4>
<p>I think it makes sense. But then I'm thinking about transferring a document rather than data. In that case, you don't want the server to have such freedom. But then I think you'd be posting to /binary, not asking the server to treat it as a transaction. The relevant spec is </p>



<a name="153813529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813529">(Feb 29 2016 at 14:00)</a>:</h4>
<p><a href="http://hl7.org/fhir/documents.html#bundle" target="_blank" title="http://hl7.org/fhir/documents.html#bundle">http://hl7.org/fhir/documents.html#bundle</a></p>



<a name="153813530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813530">(Feb 29 2016 at 14:00)</a>:</h4>
<p>and yes: "Ignore the fact that the bundle is a document and process all of the resources that it contains as individual resources. Clients SHOULD not expect that a server that receives a document submitted using this method will be able to reassemble the document exactly"</p>



<a name="153813531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813531">(Feb 29 2016 at 14:00)</a>:</h4>
<p>ok. so I think I agree</p>



<a name="153813534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813534">(Feb 29 2016 at 14:02)</a>:</h4>
<p>So, that requires the client to create a Composition as the first entry... also the <code>Bundle.type="document"</code> rather than transaction.</p>



<a name="153813535"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813535" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813535">(Feb 29 2016 at 14:07)</a>:</h4>
<p>well, that assumes that they already had a document (as opposed to say, an $everything)</p>



<a name="153813541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813541">(Feb 29 2016 at 14:16)</a>:</h4>
<p>OK, so I think we agree on the assumptions (as stated in the bullets). And you want to avoid a new operation. I understand... So, what about a new <code>Bundle.type="transfer"</code> code? Or do you want to continue to use <code>transaction</code> or <code>searchset</code> (the result of the $everything) with the given rules on posting to base?</p>



<a name="153813545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813545">(Feb 29 2016 at 15:09)</a>:</h4>
<p>I think l agree with this proposed behavior, but I don't understand how it's different from the current spec; can someone explain what would actually be changing?</p>



<a name="153813579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813579">(Feb 29 2016 at 16:10)</a>:</h4>
<p>Josh, great question... I was trying to hash that out with Grahame above... I don't think we're there yet.</p>



<a name="153813581"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813581" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813581">(Feb 29 2016 at 16:11)</a>:</h4>
<p>OK, fair enough. Basically saying "client-supplied are preserved for <code>PUT</code>, but the server can assign at will on <code>POST</code>" seems sane to me.</p>



<a name="153813582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813582">(Feb 29 2016 at 16:12)</a>:</h4>
<p>Along with examples for linking resources... and probably some other stuff.</p>



<a name="153813584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813584">(Feb 29 2016 at 16:13)</a>:</h4>
<p>Definitely lots of examples are needed! I'm just trying to make sure we agree about what they should _say_.</p>



<a name="153813585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813585">(Feb 29 2016 at 16:22)</a>:</h4>
<p>Well, we've been talking about having <code>POST</code> to <code>[resourceType]</code> assumes the client wants to make a create, and <code>POST</code> to <code>[base]</code> means this is a transfer -- so it might not be a create (it could be an update) -- and the client doesn't need to generate complicated <code>IfNoneMatch</code> type of conditionals. Leaves it to the server to de-duplicate. Allows the client to say "I want to transfer this patient record, but I don't have the authority to tell you how to do patient matching or access your other records"</p>



<a name="153813589"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813589" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813589">(Feb 29 2016 at 17:16)</a>:</h4>
<blockquote>
<p>"I want to transfer this patient record, but I don't have the authority to tell you how to do patient matching or access your other records"</p>
</blockquote>
<p>My gut feeling says this will turn out to be another kind of bundle in the end, instead of doing this implicitly by changing where we POST to.  The fact that using this kind of POST to base only makes sense in the context of a Bundle (i.e. posting a single resource to the REST endpoint is not meaningful and not even possible currently), suggests this is a kind of bundle, rather than a kind of REST operation.</p>



<a name="153813590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813590">(Feb 29 2016 at 17:18)</a>:</h4>
<p>well, if we changed to a different kind of bundle, what would we do with request? </p>



<a name="153813591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813591">(Feb 29 2016 at 17:19)</a>:</h4>
<p>an alternative is that we deem that this language applies:</p>



<a name="153813592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813592">(Feb 29 2016 at 17:19)</a>:</h4>
<p>file:///C:/work/org.hl7.fhir/build/publish/http.html#other-bundles</p>



<a name="153813598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813598">(Feb 29 2016 at 18:06)</a>:</h4>
<p>One issue with current wording of the #other-bundles link, is that the matching is done on "identity" -- does that mean <code>id</code> or <code>Resource.identifier</code> or the concept of identity?</p>



<a name="153813608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813608">(Feb 29 2016 at 19:07)</a>:</h4>
<p>whoops I used my local link sorry. </p>



<a name="153813825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153813825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153813825">(Mar 01 2016 at 14:53)</a>:</h4>
<p>If I'm following this correctly, this seems to be closely related to identity resolution as would be important in messaging (esp. <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> 's use case).  We're using small contained resources here (basically only an identifier element), but am very interested in this discussion (getting folks to think about the messaging implications).</p>



<a name="153814199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814199">(Mar 07 2016 at 16:54)</a>:</h4>
<p>Technically this is a Batch question, but it make sense to me to include it in the transactions topic...</p>
<p>The specification says this about <a href="http://hl7.org/fhir/DSTU2/http.html#2.1.0.16.1" target="_blank" title="http://hl7.org/fhir/DSTU2/http.html#2.1.0.16.1">Batch processing rules</a>:</p>
<blockquote>
<p>For a batch, there SHALL be no interdependencies between the different entries in the Bundle. The success or failure of one entry SHALL not alter the success or failure or resulting content of another. Servers SHALL validate that this is the case. Note that it is considered that servers execute the batch in the same order as that specified below for transactions, though the order of execution should not matter given the previous rule.</p>
</blockquote>
<p>What is an "interdependency" between entries? An Observation.subject reference to a Patient in the Bundle? I'm trying to create an example to test that servers do "validate that this is the case."</p>



<a name="153814203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814203">(Mar 07 2016 at 17:15)</a>:</h4>
<p>A situation where you're creating a patient and then referencing it with an observation that's defined in the same batch - if the creation of the patient fails or doesn't happen before the observation, then the batch will fail - and that would be a violation of the rule.</p>



<a name="153814211"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814211" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814211">(Mar 07 2016 at 18:50)</a>:</h4>
<p>But if the Patient creation succeeds, the wording suggests it is still a violation of the rule, because it is an interdependency. So, the whole batch should fail, or just the two entries?</p>



<a name="153814223"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814223" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814223">(Mar 07 2016 at 19:16)</a>:</h4>
<p>discretion of the server at the moment</p>



<a name="153814224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814224">(Mar 07 2016 at 19:17)</a>:</h4>
<p>I would say, creating a patient, searching by the newly creatd patient is also a dependency</p>



<a name="153814225"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814225" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814225">(Mar 07 2016 at 19:17)</a>:</h4>
<p>there's some looseness to the definition for a reason</p>



<a name="153814272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814272">(Mar 07 2016 at 21:32)</a>:</h4>
<p>That makes it hard to test.</p>



<a name="153814273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814273">(Mar 07 2016 at 21:33)</a>:</h4>
<p>yes. indeed. we could certainly define something almost useless so it would be easy to test. The question is where the right balance is </p>



<a name="153814274"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814274" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814274">(Mar 07 2016 at 21:34)</a>:</h4>
<p>Well, shouldn't it be a "SHOULD" then, rather than a "SHALL"?</p>



<a name="153814275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814275">(Mar 07 2016 at 21:35)</a>:</h4>
<p>maybe. </p>



<a name="153814276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814276">(Mar 07 2016 at 21:36)</a>:</h4>
<p>OK. I'll submit a change request, and people can vote on it.</p>
<p><a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=9681" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=9681">http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=9681</a></p>



<a name="153814328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Knapp <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814328">(Mar 08 2016 at 05:29)</a>:</h4>
<p>I think the intention is that each entry is actioned in order and the sucess or failure of each is independant, although it is recognised that each is dependant on the overall state of the world at the point of action. So yes if the patient create fails the observation fails but due to the lack of the patient 'in the world' not because of the failure in the batch. For example the failure of a create for any other patient in the batch would not fail the rest of the entries in the batch. The outcome of the each of the entries in the batch is the same as had the entries been applied separately, not in a batch, in the same order as they appear in the batch.</p>



<a name="153814378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814378">(Mar 08 2016 at 12:48)</a>:</h4>
<p>But Paul, there is nothing that says the Observation create has to fail. It makes sense that it fails, and some servers might enforce that Observation.subject references a valid and resolvable Patient, but the spec doesn't mandate that. This is why I submitted a change to SHOULD, because the SHALLs as written are untestable.</p>



<a name="153814453"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814453" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814453">(Mar 08 2016 at 15:37)</a>:</h4>
<p>Whether the Observation create fails or not, it's a dependency, which means it's a non-conformant batch.  It's a static test, not a runtime test.</p>



<a name="153814455"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814455" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814455">(Mar 08 2016 at 15:44)</a>:</h4>
<p>So, are you saying that any static references across Bundle.entry.resource in a batch are non-conformant?</p>



<a name="153814457"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814457" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814457">(Mar 08 2016 at 15:48)</a>:</h4>
<p>Static references to things being created would be non-conformant</p>



<a name="153814458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814458">(Mar 08 2016 at 17:20)</a>:</h4>
<p>I think I need help (like a good + bad example) to understand this point.</p>



<a name="153814477"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814477" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814477">(Mar 08 2016 at 19:01)</a>:</h4>
<p>you can't make a static reference to a thing being created in a batch. THe id pattern we use in a transaction - that would be impossible in a batch. </p>



<a name="153814478"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814478" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814478">(Mar 08 2016 at 19:01)</a>:</h4>
<p>so that would be clearly a fail</p>



<a name="153814480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153814480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153814480">(Mar 08 2016 at 19:02)</a>:</h4>
<p>you can also do sneaky references between resources using server functionality - conditional create followed by conditional update of the same thing. We won't a 'don't do that' on there</p>



<a name="153850695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850695">(Sep 25 2016 at 22:38)</a>:</h4>
<p>Are there any public servers available that support transactions?</p>



<a name="153850696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850696">(Sep 25 2016 at 22:44)</a>:</h4>
<p>mine does</p>



<a name="153850697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850697">(Sep 25 2016 at 22:44)</a>:</h4>
<p>I think the HAPI one does too</p>



<a name="153850698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850698">(Sep 25 2016 at 23:51)</a>:</h4>
<p>Hmm... yours didn't return me a bundle-transaction</p>



<a name="153850699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850699">(Sep 25 2016 at 23:51)</a>:</h4>
<p>So I don't know the IDs of the resources that were created</p>



<a name="153850700"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850700" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850700">(Sep 25 2016 at 23:52)</a>:</h4>
<p>HAPI said "Unable to store a Bundle resource on this server with a Bundle.type value of: transaction" :\</p>



<a name="153850704"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850704" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850704">(Sep 26 2016 at 00:26)</a>:</h4>
<p>what did it return?</p>



<a name="153850706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850706">(Sep 26 2016 at 00:30)</a>:</h4>
<p>Returned me the Bundle as-is, so just like any other resource.</p>



<a name="153850707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850707">(Sep 26 2016 at 00:31)</a>:</h4>
<p>So that made is difficult or impossible to figure out what happened with all my operations</p>



<a name="153850708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850708">(Sep 26 2016 at 00:32)</a>:</h4>
<p>sounds like you're doing something wrong. what are you posting where/</p>



<a name="153850709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850709">(Sep 26 2016 at 00:33)</a>:</h4>
<p>Yeah probably. I'm posting the transaction example (<a href="http://hl7.org/fhir/2016Sep/bundle-transaction.json.html" target="_blank" title="http://hl7.org/fhir/2016Sep/bundle-transaction.json.html">http://hl7.org/fhir/2016Sep/bundle-transaction.json.html</a>) to <a href="http://fhir3.healthintersections.com.au/open/Bundle" target="_blank" title="http://fhir3.healthintersections.com.au/open/Bundle">http://fhir3.healthintersections.com.au/open/Bundle</a></p>



<a name="153850710"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850710" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850710">(Sep 26 2016 at 00:33)</a>:</h4>
<p>Take out the Parameters entry, that part errors</p>



<a name="153850711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850711">(Sep 26 2016 at 00:34)</a>:</h4>
<p>if you post a bundle to /Bundle, it will be stored as is, irrespective of it's bundle type</p>



<a name="153850712"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850712" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850712">(Sep 26 2016 at 00:36)</a>:</h4>
<p>Yep I see. Thanks</p>



<a name="153850876"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153850876" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153850876">(Sep 27 2016 at 12:15)</a>:</h4>
<p>Mine should work too</p>



<a name="153851467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153851467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153851467">(Sep 30 2016 at 21:43)</a>:</h4>
<p>FYI- HAPI only lets you post a bundle with type "document" or "collection" to the <code>[base]/Bundle</code> endpoint. Transactions have to be posted to <code>[base]/</code></p>



<a name="153852680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153852680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153852680">(Oct 12 2016 at 09:42)</a>:</h4>
<p>fhirbase &amp; aidbox does</p>



<a name="153881082"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881082" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881082">(Apr 06 2017 at 10:35)</a>:</h4>
<p>Hi, having trouble understanding a couple of the rules for resource IDs in transaction bundles:</p>
<p>from <a href="https://www.hl7.org/FHIR/bundle.html#references" target="_blank" title="https://www.hl7.org/FHIR/bundle.html#references">https://www.hl7.org/FHIR/bundle.html#references</a>:<br>
"If the fullUrl starts with urn:uuid: or urn:oid:, then append the id to the base URL and try to resolve within the bundle as for a RESTful URL reference"</p>
<p>What specifically do "id" and "base URL" refer to here?  Is there an example of this kind of resolution?</p>
<p>from <a href="http://hl7.org/fhir/http.html#transaction" target="_blank" title="http://hl7.org/fhir/http.html#transaction">http://hl7.org/fhir/http.html#transaction</a>:<br>
"For updates, the server performs a mapping between the fullUrl specified and the local URL the server knows that instance as, if possible. If the server does not have a mapping for the fullUrl, the server ignores the base URL and attempts an update assuming the base is the same as the server base"</p>
<p>Does this mean that the ID in request.url for a PUT request is irrelevant and only the fullUrl matters?  Or should the server enforce that they (and the ID in the resource) match?  And does the same rule apply to DELETE?</p>



<a name="153881109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881109">(Apr 06 2017 at 14:52)</a>:</h4>
<p>The server should check alignment between the entry.fullUrl and the <a href="http://entry.resource.id" target="_blank" title="http://entry.resource.id">entry.resource.id</a>.  Failure to align probably means bad things, but as usual, servers aren't obligated to validate inbound instances.  fullUrl should not be present for transactions and batches (which would be the situation where you'd have a request.url)</p>



<a name="153881110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881110">(Apr 06 2017 at 14:54)</a>:</h4>
<p>Actually, I misread on the last sentence.  I'm actually not sure what the purpose is of having both a fullUrl and a requestUrl, so I'll let someone else respond.</p>



<a name="153881529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881529">(Apr 10 2017 at 02:00)</a>:</h4>
<p>Given a Bundle Batch / Transaction, how does the client who receives the transaction response from the server identify which resource is which. If I was to send in two resources, both Patient resources as POSTs.  One for Patient Bob and one for Patient Jane, were each resource has no Resource ID as the server will assign them, yet each does have a UUID in the FullURL of each entry.<br>
The Transaction response may return that both were committed ‘Created 201’ in the entry.response.status and now I want to obtain from the response the server assigned Resource Ids for each. How do I know which is Bob and which is Jane without inspecting the patient names of course. <br>
I had thought that the entry.FullURL would be returned unchanged and that was my key for reading the Transaction response, yet the examples in the spec do not indicate this, the examples have updated the entry.FullURL to the new location in the server, which feels wrong because the response entry.response.location already conveys this information. Are the examples wrong? Should the entry.FullURL remain unchanged between submission and response of the transaction bundle?<br>
The only other way I see this working is if the transaction response entries are guaranteed to be returned in the same order they were sent. Yet that feel a little bit like crossing my fingers and hoping?</p>



<a name="153881534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881534">(Apr 10 2017 at 03:35)</a>:</h4>
<p>That feels like something that deserves a tracker be created Angus.</p>



<a name="153881537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881537">(Apr 10 2017 at 04:14)</a>:</h4>
<p>Ok I added it to the tracker.</p>



<a name="153881563"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881563" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881563">(Apr 10 2017 at 09:03)</a>:</h4>
<p>they are guaranteed to be returned in the same order<br>
that doesn't seem like an ideal way to match them up though</p>



<a name="153881672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881672">(Apr 10 2017 at 23:44)</a>:</h4>
<p>Yes I think this the intent of the spec. I did more work on this in the past 24hrs and have realized that you cannot use the FullUrl as I was thinking, as a key to each resource in the bundle. If you have GET requests in the transaction bundle then there is not FullUrl and if that GET is a search then the return Transaction response also has no FullUrl as it is a search result bundle in the Transation bundle which also has not FullUrl.  I’m also not sure you can return a FullUrl for a DELETE request.<br>
I have now accepted that it is true that the server, or at least mine, will always return a transaction response bundle that contains entries which are one-to-one with the transaction bundle received. Or else, if an issue occurs whereby the whole transaction cannot be committed then a single OperationOutcome resource is returned stating the issue encountered and referencing the entry by index that the issue was found in (should that be a zero based index or one based. Who knows, Zero based for me).<br>
Perhaps the Transactions page in the spec could have talked to this point. I did find this comment inside the bundle-response XML example in the spec: “one entry for each entry in the transaction, in order, with a response”.  Which is what cemented it for me, yet as a comment in an example, seems an odd place to state such a point.</p>



<a name="153881701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153881701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153881701">(Apr 11 2017 at 09:23)</a>:</h4>
<p>That (well, similar) text is in the spec too: <a href="http://hl7.org/fhir/http.html#transaction-response" target="_blank" title="http://hl7.org/fhir/http.html#transaction-response">http://hl7.org/fhir/http.html#transaction-response</a></p>



<a name="153882028"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/153882028" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#153882028">(Apr 12 2017 at 06:38)</a>:</h4>
<p>Yes correct, it is in the spec. I missed it. Thanks for pointing it out. </p>



<a name="218417229"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218417229" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218417229">(Dec 01 2020 at 12:51)</a>:</h4>
<p>I'm not sure what I'm getting wrong?</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Bundle&quot;,
    &quot;type&quot;: &quot;transaction&quot;,
    &quot;entry&quot;: [
        {
            &quot;resource&quot;: {
                &quot;id&quot;: &quot;20441865&quot;,
                &quot;resourceType&quot;: &quot;Patient&quot;,
                &quot;name&quot;: [
                    {
                        &quot;use&quot;: &quot;official&quot;,
                        &quot;given&quot;: [
                            &quot;80&quot;
                        ],
                        &quot;family&quot;: &quot;80&quot;
                    }
                ]
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        },
        {
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;CareTeam&quot;,
                &quot;subject&quot;: {
                    &quot;reference&quot;: &quot;Patient?_id=20441865&quot;,
                    &quot;type&quot;: &quot;Patient&quot;
                },
                &quot;status&quot;: &quot;active&quot;
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        }
    ]
}
</code></pre></div>
<blockquote>
<p>Except for transactions and batches, each entry in a Bundle must have a fullUrl which is the identity of the resource in the entry. Note that this is not a versioned reference to the resource, but its identity. Where a resource is not assigned a persistent identity that can be used in the Bundle, a UUID should be used (urn:uuid:...).<br>
For transactions and batches, entries MAY not have fullURLs when the entry.request.method = POST, and the resource has no identity. Note that even in this case, there may still be a fullURL in a transaction on a POST so that relationships between resources can be represented (see Transactions).</p>
</blockquote>
<p>From the docs I understand this as, "It's enough to make sure the fake IDs you provide match, and they'll be appropriately referenced". But I get this error, what am I missing?</p>
<div class="codehilite"><pre><span></span><code>Invalid match URL \&quot;Patient?_id=20441865\&quot; - No resources match this search&quot;
</code></pre></div>



<a name="218418276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218418276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218418276">(Dec 01 2020 at 13:01)</a>:</h4>
<p>Hmm I see I think I must use the mentioned ID types, such as UUID, UID etc</p>



<a name="218421628"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218421628" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218421628">(Dec 01 2020 at 13:32)</a>:</h4>
<p>Hmm still doesn't seem to work when using UUID</p>



<a name="218422991"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218422991" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218422991">(Dec 01 2020 at 13:44)</a>:</h4>
<p>This doesn't work,</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Bundle&quot;,
    &quot;type&quot;: &quot;transaction&quot;,
    &quot;entry&quot;: [
        {
            &quot;resource&quot;: {
                &quot;fullUrl&quot;: &quot;urn:uuid:6a2f70be-be02-4dd4-94a3-44f326b9f93f&quot;,
                &quot;resourceType&quot;: &quot;Patient&quot;,
                &quot;name&quot;: [
                    {
                        &quot;use&quot;: &quot;official&quot;,
                        &quot;given&quot;: [
                            &quot;80&quot;
                        ],
                        &quot;family&quot;: &quot;80&quot;
                    }
                ]
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        },
        {
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;CareTeam&quot;,
                &quot;subject&quot;: {
                    &quot;reference&quot;: &quot;Patient?_id=6a2f70be-be02-4dd4-94a3-44f326b9f93f&quot;,
                    &quot;type&quot;: &quot;Patient&quot;
                },
                &quot;status&quot;: &quot;active&quot;
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        }
    ]
}
</code></pre></div>
<p>but this does! What is the difference? As far as I can tell, the UUID seem okay to my untrained eye</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Bundle&quot;,
    &quot;type&quot;: &quot;transaction&quot;,
    &quot;entry&quot;: [
        {
            &quot;resource&quot;: {
                &quot;fullUrl&quot;: &quot;urn:uuid:61ebe359-bfdc-4613-8bf2-c5e300945f0a&quot;,
                &quot;resourceType&quot;: &quot;Patient&quot;,
                &quot;name&quot;: [
                    {
                        &quot;use&quot;: &quot;official&quot;,
                        &quot;given&quot;: [
                            &quot;80&quot;
                        ],
                        &quot;family&quot;: &quot;80&quot;
                    }
                ]
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        },
        {
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;CareTeam&quot;,
                &quot;subject&quot;: {
                    &quot;reference&quot;: &quot;Patient?_id=61ebe359-bfdc-4613-8bf2-c5e300945f0a&quot;,
                    &quot;type&quot;: &quot;Patient&quot;
                },
                &quot;status&quot;: &quot;active&quot;
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        }
    ]
}
</code></pre></div>
<p>Only difference is the ID!</p>
<p><code>6a2f70be-be02-4dd4-94a3-44f326b9f93f</code> -&gt; Doesn't work<br>
<code>61ebe359-bfdc-4613-8bf2-c5e300945f0a</code> -&gt; Works</p>



<a name="218423148"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218423148" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218423148">(Dec 01 2020 at 13:46)</a>:</h4>
<p>Since your transaction is attempting the PATCH an existing resource, you must know and provide the actual resolvable fullUrl of that resource as it exists on the server where the PATCH is supposed to occur. You can't use a UUID in this case.</p>



<a name="218423263"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218423263" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218423263">(Dec 01 2020 at 13:46)</a>:</h4>
<p>Patch? I don't have any PATCH in the last 2 questions I sent</p>



<a name="218423482"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218423482" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218423482">(Dec 01 2020 at 13:48)</a>:</h4>
<p>I got confused with the topic of the discussion. Do you mind editing the title on your first post?</p>



<a name="218423604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218423604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218423604">(Dec 01 2020 at 13:49)</a>:</h4>
<p>Ahh my apologies, I replied to a post that solved my previous question, and posted the next in the same place. Hope that's okay!</p>



<a name="218424529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218424529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218424529">(Dec 01 2020 at 13:57)</a>:</h4>
<p>Back to your first example - have you tried using</p>
<div class="codehilite" data-code-language="jason"><pre><span></span><code>    "subject": {
        "reference": "Patient/20441865",
        "type": "Patient"
    }
</code></pre></div>
<p>the reference in subject is supposed to be in a  <code>/[type]/[id]</code> format. I am pretty sure <code>Patient?_id=20441865</code> is incorrect. And I have no clue why the example with UUID works at all...</p>



<a name="218428920"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218428920" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218428920">(Dec 01 2020 at 14:31)</a>:</h4>
<p><code>fullUrl</code> is not a resource property, it should be one level up</p>



<a name="218429025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218429025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218429025">(Dec 01 2020 at 14:32)</a>:</h4>
<p>The server you are using might be accepting it for whatever reason, but it is definitely wrong</p>



<a name="218435318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218435318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218435318">(Dec 01 2020 at 15:19)</a>:</h4>
<p>Yes! Misplaced the <code>fullUrl</code> field. Fixed it now, still doesn't work. <br>
I replicated the UUID example from the examples <a href="https://www.hl7.org/fhir/bundle-transaction.json.html">here</a>.</p>



<a name="218435531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218435531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218435531">(Dec 01 2020 at 15:21)</a>:</h4>
<p>Now it does! Had to change the reference to <code>Patient/urn:uuid:6a2f70be-be02-4dd4-94a3-44f326b9f93f</code>!</p>



<a name="218436790"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218436790" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218436790">(Dec 01 2020 at 15:30)</a>:</h4>
<p>The reference shouldn't have "Patient/", it should just be the urn.</p>



<a name="218436872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218436872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218436872">(Dec 01 2020 at 15:31)</a>:</h4>
<p>There's an example here: <a href="https://cloud.google.com/healthcare/docs/how-tos/fhir-bundles#resolving_references_to_resources_created_in_a_bundle">https://cloud.google.com/healthcare/docs/how-tos/fhir-bundles#resolving_references_to_resources_created_in_a_bundle</a></p>
<p>This is the google documentation but hopefully our interpretation is the same as others!</p>



<a name="218437149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218437149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218437149">(Dec 01 2020 at 15:33)</a>:</h4>
<p>Using "reference = Patient?_id=xxx" is a conditional reference which is a different thing than bundle fullUrl resolution. It searches for resources that already exist on the server. There was a thread a while ago about whether this search also finds things inside the bundle, I think implementations vary.</p>



<a name="218437555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/218437555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#218437555">(Dec 01 2020 at 15:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197072">Paul Church</span> <a href="#narrow/stream/179166-implementers/topic/Transactions/near/218436790">said</a>:</p>
<blockquote>
<p>The reference shouldn't have "Patient/", it should just be the urn.</p>
</blockquote>
<p>I see, I couldn't find an example on the FHIR documentation, so I assumed I could use <code>Patient/urn:uuid:ID</code>. But now I know, thanks!</p>



<a name="219214781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/219214781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marcin Szewczyk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#219214781">(Dec 08 2020 at 14:49)</a>:</h4>
<p>Question regarding update in bundle transaction and fullUrl mappings. <br>
"For updates, the server performs a mapping between the fullUrl specified and the local URL the server knows that instance as, if possible."<br>
How mapping should be stored on fhir server? as seperate entity? or any metadata?</p>
<p><a href="/user_uploads/10155/rzkzIlk4Axbd8c1QhOP-su9p/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/rzkzIlk4Axbd8c1QhOP-su9p/image.png" title="image.png"><img src="/user_uploads/10155/rzkzIlk4Axbd8c1QhOP-su9p/image.png"></a></div>



<a name="219216886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/219216886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#219216886">(Dec 08 2020 at 15:05)</a>:</h4>
<p>The mapping is not stored, it is used just during the processing of the transaction</p>



<a name="219221089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/219221089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marcin Szewczyk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#219221089">(Dec 08 2020 at 15:37)</a>:</h4>
<p>do not understand, so in which cases server do not know mapping?<br>
"For updates, the server performs a mapping between the fullUrl specified and the local URL the server knows that instance as, if possible."</p>
<p>or example:</p>
<ol>
<li>POST create Patient fullURL=UUID1, identifier=xyz.com/Patient/123 send to <a href="http://abc.com">abc.com</a> FHIR SERVER -&gt; returns <a href="http://abc.com/Patient/987">abc.com/Patient/987</a></li>
<li>PUT Patient fullUrl=xyz.com/Patient/123  send to <a href="http://abc.com">abc.com</a> FHIR server -&gt; is this valid scenario?<br>
or <br>
it should be<br>
PUT Patient fullUrl=abc.com/Patient/987 send do <a href="http://abc.com">abc.com</a> FHIR server</li>
</ol>



<a name="219569209"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/219569209" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marcin Szewczyk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#219569209">(Dec 11 2020 at 06:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="304367">Marcin Szewczyk</span> <a href="#narrow/stream/179166-implementers/topic/transactions/near/219221089">said</a>:</p>
<blockquote>
<p>do not understand, so in which cases server do not know mapping?<br>
"For updates, the server performs a mapping between the fullUrl specified and the local URL the server knows that instance as, if possible."</p>
<p>or example:</p>
<ol>
<li>POST create Patient fullURL=UUID1, identifier=xyz.com/Patient/123 send to <a href="http://abc.com">abc.com</a> FHIR SERVER -&gt; returns <a href="http://abc.com/Patient/987">abc.com/Patient/987</a></li>
<li>PUT Patient fullUrl=xyz.com/Patient/123  send to <a href="http://abc.com">abc.com</a> FHIR server -&gt; is this valid scenario?<br>
or <br>
it should be<br>
PUT Patient fullUrl=abc.com/Patient/987 send do <a href="http://abc.com">abc.com</a> FHIR server</li>
</ol>
</blockquote>
<p>Any ideas about this?<br>
Reading further: <a href="/user_uploads/10155/yJM6JybhjlaEQNR58ixTceX1/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/10155/yJM6JybhjlaEQNR58ixTceX1/image.png" title="image.png"><img src="/user_uploads/10155/yJM6JybhjlaEQNR58ixTceX1/image.png"></a></div><p>There is two suggestions:</p>
<ol>
<li>
<p>Fhir Server should have ability to understand identifier with base from other server.  <br>
just for the sake of simplicity for client/complexity for server...<br>
" This allows the same transaction bundle to be sent to multiple systems without changing the fullUrls for each target."<br>
 in other words: server <a href="http://abc.com">abc.com</a> should understand PUT Bundle transaction with xyz.zom/Patient/123 <br>
am i wrong?</p>
</li>
<li>
<p>on the other hand, fhir server MAY accept foreign fullUrl as their own... under some circumstances<br>
"When processing a batch or transaction, a server MAY choose to honor existing logical ids (e.g. Observation/1234 remains as Observation/1234 on the server), but since this is only safe in controlled circumstances, servers may choose to assign new ids to all submitted resources, irrespective of any claimed logical id in the resource, or fullUrl on entries in the batch/transaction."</p>
</li>
</ol>



<a name="219609214"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/219609214" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#219609214">(Dec 11 2020 at 14:04)</a>:</h4>
<p>The most common approach is to assign whatever identifiers you like and then to go back and update all links to point to the identifiers you've assigned</p>



<a name="219807522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/219807522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marcin Szewczyk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#219807522">(Dec 14 2020 at 07:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179166-implementers/topic/transactions/near/219609214">said</a>:</p>
<blockquote>
<p>The most common approach is to assign whatever identifiers you like and then to go back and update all links to point to the identifiers you've assigned</p>
</blockquote>
<p>That is my way of doing integrations from notFHIR world<br>
But FHIR standard suggests to respect others ids, to enable sending same Bundle to multiple without changing Bundle content - looks like utopia..</p>
<p>I am thinking of doing conditional PUT with identifier parameter - thats way both internal and external id will be supported.<br>
As long as we store both of them on identifier list</p>



<a name="223630510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223630510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223630510">(Jan 22 2021 at 11:42)</a>:</h4>
<blockquote>
<p>References within a Bundle.entry.resource to another Bundle.entry.resource that is being created within the batch are considered to be non-conformant.</p>
</blockquote>
<p>Does this mean that I can't create, say, a <code>Patient</code> resource and a <code>CareTeam</code> at once in which the <code>CareTeam</code> refers to the <code>Patient</code>?</p>



<a name="223632520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223632520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223632520">(Jan 22 2021 at 12:05)</a>:</h4>
<p>I'm creating this <code>POST</code> <code>transaction</code> where I'm trying to do 3 things. Create a <code>Patient</code>, create a <code>CareTeam</code> for that <code>Patient</code>, and then assign a device to that <code>Patient</code>. Here's what I have (POST bundle below). I can't seem to get the device assignment working, the reference on the device retains the <code>urn</code>, instead of resolving to the patient ID, like in the created <code>CareTeam</code> of the request. What am I missing? </p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Bundle&quot;,
    &quot;type&quot;: &quot;transaction&quot;,
    &quot;entry&quot;: [
        {
            &quot;fullUrl&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;Patient&quot;,
                // patient info removed for brevity
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        },
        {
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;CareTeam&quot;,
                &quot;subject&quot;: {
                    &quot;reference&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,
                    &quot;type&quot;: &quot;Patient&quot;
                },
                // removed for brevity
                &quot;status&quot;: &quot;active&quot;
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        },
        {
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;Binary&quot;,
                &quot;contentType&quot;: &quot;application/json-patch+json&quot;,
                &quot;data&quot;: &quot;base64encoded of the document below&quot; // (b)
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;PATCH&quot;,
                &quot;url&quot;: &quot;Device/1835297&quot;
            }
        }
    ]
}
</code></pre></div>
<p><code>PATCH</code> document whose <code>base64()</code> goes above at (b)</p>
<div class="codehilite"><pre><span></span><code>[
    {
        &quot;op&quot;: &quot;test&quot;,
        &quot;path&quot;: &quot;/meta/versionId&quot;,
        &quot;value&quot;: &quot;x&quot;
    },
    {
        &quot;op&quot;: &quot;test&quot;,
        &quot;path&quot;: &quot;/status&quot;,
        &quot;value&quot;: &quot;inactive&quot;
    },
    {
        &quot;op&quot;: &quot;add&quot;,
        &quot;path&quot;: &quot;/patient&quot;,
        &quot;value&quot;: {
            &quot;reference&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,
            &quot;type&quot;: &quot;Patient&quot;
        }
    },
    {
        &quot;op&quot;: &quot;replace&quot;,
        &quot;path&quot;: &quot;/status&quot;,
        &quot;value&quot;: &quot;active&quot;
    }
]
</code></pre></div>
<p>I get this in return </p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Bundle&quot;,
    &quot;type&quot;: &quot;transaction-response&quot;,
    // snip
    &quot;entry&quot;:     [{
        &quot;response&quot;: {
            &quot;status&quot;: &quot;201 Created&quot;,
            &quot;location&quot;: &quot;Patient/1836280/_history/1&quot;,
            &quot;etag&quot;: &quot;1&quot;,
            &quot;lastModified&quot;: &quot;2021-01-22T11:50:57.291+00:00&quot;
        }
    },
    {
        &quot;response&quot;: {
            &quot;status&quot;: &quot;201 Created&quot;,
            &quot;location&quot;: &quot;CareTeam/1836281/_history/1&quot;,
            &quot;etag&quot;: &quot;1&quot;,
            &quot;lastModified&quot;: &quot;2021-01-22T11:50:57.291+00:00&quot;
        }
    }]
}
</code></pre></div>
<p><code>CareTeam</code> has the proper reference like so</p>
<div class="codehilite"><pre><span></span><code>&quot;subject&quot;: {
    &quot;reference&quot;: &quot;Patient/1836280&quot;,  // Works!
    &quot;type&quot;: &quot;Patient&quot;
 }
</code></pre></div>
<p>But the device isn't working</p>
<div class="codehilite"><pre><span></span><code>&quot;patient&quot;: {
    &quot;reference&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,  // should be &#39;Patient/1836280&#39;
    &quot;type&quot;: &quot;Patient&quot;
}
</code></pre></div>



<a name="223634300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223634300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223634300">(Jan 22 2021 at 12:26)</a>:</h4>
<p>You transaction bundle is wrong: the Bundle should contain 3 entries, currently it's just one entry with 3 resources in it. That's not allowed by Bundles. Each entry has 0..1 resource in it.</p>



<a name="223635048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223635048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223635048">(Jan 22 2021 at 12:34)</a>:</h4>
<p>It does, doesn't it, an array of 3 (unless I'm mistaken with the code or the formatting)? </p>
<div class="codehilite"><pre><span></span><code>&quot;entry&quot;: [
        { // patient },
        { // careteam  },
        { // device }
    ]
</code></pre></div>



<a name="223642093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223642093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223642093">(Jan 22 2021 at 13:41)</a>:</h4>
<p>Ah yes (my XML background is to blame here). Nothing wrong with the overall structure of your Transaction. </p>
<p>So the issue is with your JSON patch (which I haven't played with, I've only tested FHIR patch, based of FHIR Path).<br>
If you claim the resource type (of your PATCH) to be Binary, then the server will process it as if it were a Binary (ie a Blob, nothing to do with FHIR resource structures). As such a server won't update your 'reference', it will just patch with the literal string as present in your patch statement. Whether one would desire to have it be done in another way, well, that's a good question.</p>



<a name="223648275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223648275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223648275">(Jan 22 2021 at 14:33)</a>:</h4>
<p>PATCH doesn't really make sense for a Binary because there are very few properties you can manipulate in a Binary - just stuff in meta and the content itself.</p>



<a name="223649182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223649182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223649182">(Jan 22 2021 at 14:41)</a>:</h4>
<p>The attempt is to PATCH a Patient resource, so the Bundle should probably be declaring that as the resource type instead of Binary. The documentation isn't very clear as to what resource type one should specifiy on a PATCH operation.</p>



<a name="223658276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223658276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223658276">(Jan 22 2021 at 15:45)</a>:</h4>
<p>how <em>is</em> a json patch supposed to look in a transaction bundle, putting aside Dexter's problem for now do we have any guidance on that? Is it supposed to be a non-fhir document stuffed inside a bundle? packaged as a Binary like Dexter did? <br>
does this line in the spec "Patch operations may be performed as part of Batch or Transaction Operations using the FHIRPath Patch format. "<br>
imply that only fhirpatch can be used in batch/transactions?</p>



<a name="223673680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223673680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223673680">(Jan 22 2021 at 17:39)</a>:</h4>
<p>There is no support for a json patch in a batch/transaction bundle.</p>



<a name="223854195"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223854195" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223854195">(Jan 25 2021 at 04:27)</a>:</h4>
<p>I see. So the references aren't transformed in a Bundle. How do I PATCH through a transaction in such a case?  Since I'm updating resources, I don't think splitting it into 2 requests will be wise, as it might lead to inconsistencies. </p>
<p>If I may suggest, this <a href="https://www.hl7.org/fhir/http.html#trules">section of the document</a> led me to believe that this would work. What do you suggest I do?</p>



<a name="223854247"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223854247" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223854247">(Jan 25 2021 at 04:28)</a>:</h4>
<p>Also,  apologies for the delay in my response, I need to use my Work PC for logging in.</p>



<a name="223854269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223854269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223854269">(Jan 25 2021 at 04:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="359486">Dexter</span> <a href="#narrow/stream/179166-implementers/topic/Transactions/near/223630510">said</a>:</p>
<blockquote>
<blockquote>
<p>References within a Bundle.entry.resource to another Bundle.entry.resource that is being created within the batch are considered to be non-conformant.</p>
</blockquote>
<p>Does this mean that I can't create, say, a <code>Patient</code> resource and a <code>CareTeam</code> at once in which the <code>CareTeam</code> refers to the <code>Patient</code>?</p>
</blockquote>
<p>Does this mean that technically, HAPI is non-conformant?</p>



<a name="223858022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223858022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223858022">(Jan 25 2021 at 05:53)</a>:</h4>
<p>In a transaction, you have to use FHIRpath-based patch<br>
Nothing prohibits a server from supporting batches where the actions have interdependencies - or otherwise consuming data that's non-conformant.  However, HAPI <em>shouldn't</em> spit out batches that break the rules.</p>



<a name="223858662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223858662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223858662">(Jan 25 2021 at 06:07)</a>:</h4>
<p>Could you clarify what the patch doc would look like, I couldn't find the schema for this. A link to the relevant portion would be great too, thanks!</p>
<blockquote>
<p>Nothing prohibits a server from supporting batches where the actions have interdependencies - or otherwise consuming data that's non-conformant.</p>
</blockquote>
<p>So that means me being able to create a <code>Patient</code> resource and a <code>CareTeam</code> at once in a <code>Transaction</code> where the <code>CareTeam</code> refers to the <code>Patient</code> is something that's supported by HAPI, but NOT the FHIR specification, therefore I shouldn't expect other server implementations to support this, correct?</p>



<a name="223862761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223862761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223862761">(Jan 25 2021 at 07:34)</a>:</h4>
<p>Quite the opposite. All servers that support Bundles have to support this. See <a href="http://build.fhir.org/bundle.html#references">http://build.fhir.org/bundle.html#references</a></p>



<a name="223864305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223864305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223864305">(Jan 25 2021 at 07:57)</a>:</h4>
<p>Um, I'm a little confused in that case, could you please clarify what this means? </p>
<blockquote>
<p>References within a Bundle.entry.resource to another Bundle.entry.resource that is being created within the batch are considered to be non-conformant.</p>
</blockquote>
<p>Also, </p>
<blockquote>
<p>Whether one would desire to have it be done in another way, well, that's a good question.</p>
</blockquote>
<p>Haha yeah I think that's what I'm after right now. I'm looing at FHIRPatch, as Mr. Lloyd suggested, but I don't see a way to send that in a JSON form through JS frontend client.</p>



<a name="223865619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223865619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223865619">(Jan 25 2021 at 08:11)</a>:</h4>
<p>We're talking about a Transaction bundle, right? A Batch is quite a different thing - but you're right in that my statement above I should have spoken about Transactions, not about Bundles in general.</p>



<a name="223865757"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223865757" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223865757">(Jan 25 2021 at 08:13)</a>:</h4>
<p>Yep Transaction, though I should probably read up on the differences b/w bundle and batch.</p>



<a name="223912508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/223912508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#223912508">(Jan 25 2021 at 15:29)</a>:</h4>
<p>You'd be sending a Parameters resource - which can be expressed in XML, JSON or RDF - just as any resource is.</p>



<a name="224138614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224138614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224138614">(Jan 27 2021 at 04:20)</a>:</h4>
<p>I'm not sure how to use that, I couldn't find many examples similar to what I'm trying to do, i.e, have a reference in a binary resource. Could you kindly give me an example? Thanks!</p>



<a name="224150633"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224150633" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224150633">(Jan 27 2021 at 08:12)</a>:</h4>
<p>See <a href="https://www.hl7.org/fhir/fhirpatch.html#format">https://www.hl7.org/fhir/fhirpatch.html#format</a> for an example. There is no use of Binary when using FHIRPath based patch.</p>



<a name="224150895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224150895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224150895">(Jan 27 2021 at 08:15)</a>:</h4>
<p>How do I convert this to a JSON payload? Is that supported? Will references resolve too? Can I put this single <code>fhirpatch</code> as one of the elements of the <code>Bundle Transaction</code>'s <code>entry</code>?</p>



<a name="224152035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224152035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224152035">(Jan 27 2021 at 08:30)</a>:</h4>
<p>All FHIR resources can be expressed as either JSON, or XML, or even some other representation formats. Representation is largely irrelevant (from a standards perspective). You can add a Parameters resource as an entry in a Transaction bundle, and given that this is a FHIR resource like any other FHIR resource, the reference should resolve (admittedly: I've never tested it with a Parameters resource, but I see no reason as to why that shouldn't work).</p>



<a name="224155005"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224155005" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224155005">(Jan 27 2021 at 09:06)</a>:</h4>
<p>Okay, thank you for that! I'll give that a go, but hapi seems to be down right now. I have an issue on the local setup which I posted <a href="#narrow/stream/179167-hapi/topic/v5.2E2.2E0.20Web.20UI.20issue/near/224036996">here</a></p>



<a name="224196203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224196203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224196203">(Jan 27 2021 at 15:20)</a>:</h4>
<p>Be aware that response times may be slower this week because HL7 is having a major virtual conference (and people therefore have less time than usual)</p>



<a name="224286457"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224286457" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224286457">(Jan 28 2021 at 05:39)</a>:</h4>
<p>I understand, thank you for taking the time to respond to my queries! With support from all of you, I'm having a blast learning how to go about FHIR!</p>



<a name="224301801"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224301801" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224301801">(Jan 28 2021 at 09:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191372">René Spronk</span> <a href="#narrow/stream/179166-implementers/topic/Transactions/near/224150633">said</a>:</p>
<blockquote>
<p>See <a href="https://www.hl7.org/fhir/fhirpatch.html#format">https://www.hl7.org/fhir/fhirpatch.html#format</a> for an example. There is no use of Binary when using FHIRPath based patch.</p>
</blockquote>
<p>I think I'm getting the hand of using <code>FHIRPatch</code>. How do I test for a version of a resource before <code>PATCH</code>ing it with <code>FHIRPatch</code>?</p>
<p>I'm trying to use <code>ifMatch</code>, but this doesn't seem to work. What am I missing in this? <br>
(Without <code>ifMatch</code> and <code>Device/id</code> works fine, so I think I understood how to use <code>FHIRPatch</code>)</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Bundle&quot;,
    &quot;type&quot;: &quot;transaction&quot;,
    &quot;entry&quot;: [
        {
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;Parameters&quot;,
                &quot;parameter&quot;: [
                    {
                        &quot;name&quot;: &quot;operation&quot;,
                        &quot;part&quot;: [
                            {
                                &quot;name&quot;: &quot;type&quot;,
                                &quot;valueString&quot;: &quot;add&quot;
                            },
                            {
                                &quot;name&quot;: &quot;path&quot;,
                                &quot;valueString&quot;: &quot;Device&quot;
                            },
                            {
                                &quot;name&quot;: &quot;name&quot;,
                                &quot;valueString&quot;: &quot;patient&quot;
                            },
                            {
                                &quot;name&quot;: &quot;value&quot;,
                                &quot;valueReference&quot;: {
                                    &quot;reference&quot;: &quot;Patient/1714653&quot;,
                                    &quot;type&quot;: &quot;Patient&quot;
                                }
                            }
                        ]
                    }
                ]
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;PATCH&quot;,
                &quot;url&quot;: &quot;Device?_id=1835297&quot;,
                &quot;ifMatch&quot;: &quot;W\&quot;9\&quot;&quot;
                // This works though, when the above 2 lines are replaced with this,
                // so I think I understand FHIRPatch
                // &quot;url&quot;: &quot;Device/1835297&quot;,
            }
        }
    ]
}
</code></pre></div>
<p>I get the error  <code>Invalid match URL[W\"9\"] - URL has no search parameters</code>, which is confosing, since I think <code>Device?_id=1835297</code> is supposed to mean "search for a device with so and so ID"</p>



<a name="224309182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224309182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224309182">(Jan 28 2021 at 10:42)</a>:</h4>
<p>Back to the basics: does the server in question support conditional PATChes ?</p>



<a name="224311697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224311697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224311697">(Jan 28 2021 at 11:09)</a>:</h4>
<p>To query that, must I look under <code>rest.resource</code>?<br>
I don't see <code>Device</code> under this JSON Patch search <code>$.entry[:].resource.rest[:].resource[:].type</code><br>
Am I going about this the right way?</p>



<a name="224431520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224431520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224431520">(Jan 29 2021 at 05:09)</a>:</h4>
<p>What you <em>should</em> see is rest.resource with conditionalUpdate=true and resource.interaction.code = patch</p>



<a name="224436812"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224436812" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224436812">(Jan 29 2021 at 07:04)</a>:</h4>
<p>This is on the public HAPI server at <code>hapi.fhir.org</code>. I don't think <code>PATCH</code> is there, but <code>conditionalUpdate</code> is there, multiple times. I don't see Device in the <code>rest.resource.type</code> though.</p>



<a name="224436842"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224436842" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224436842">(Jan 29 2021 at 07:04)</a>:</h4>
<p>So does this mean conditional patches aren't supported for the Device resource?</p>



<a name="224538985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224538985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224538985">(Jan 29 2021 at 21:54)</a>:</h4>
<p>It could.  Or it could mean the CapabilityStatement isn't complete.  <span class="user-mention" data-user-id="191319">@James Agnew</span> ?</p>



<a name="224687508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224687508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224687508">(Feb 01 2021 at 05:37)</a>:</h4>
<p>Hmm... I'm stuck now. If this isn't supported, how can I achieve <a href="#narrow/stream/179166-implementers/topic/Transactions/near/224301801">this</a>? <br>
From my basic inspection, I didn't see <code>hapi.fhir.org</code>'s conformance statement with <code>PATCH</code>, but I think it does, since it's the de-facto implementation of the spec. What am I missing here? </p>
<p>I recall that conditional patched worked when I was using <code>JSON PATCH</code>. Does this support also translate to <code>FHIRPatch</code>?</p>



<a name="224690150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224690150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224690150">(Feb 01 2021 at 06:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179166-implementers/topic/Transactions/near/223858022">said</a>:</p>
<blockquote>
<p>In a transaction, you have to use FHIRpath-based patch</p>
</blockquote>
<p>I tried this, doesn't work. As an alternative to conditional patch, I first test for the version in a JSON Patch, so if that doesn't match, the transaction should be aborted. I think it's equivalent to using <code>ifMatch</code> in <code>FHIRPatch</code>. Here's what I'm sending </p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Bundle&quot;,
    &quot;type&quot;: &quot;transaction&quot;,
    &quot;entry&quot;: [
        {
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;Binary&quot;,
                &quot;contentType&quot;: &quot;application/json-patch+json&quot;,
                &quot;data&quot;:  &quot;base64( [{ &quot;op&quot;: &quot;test&quot;, &quot;path&quot;: &quot;/meta/versionId&quot;, &quot;value&quot;: &quot;versionId&quot;}] )&quot;
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;PATCH&quot;,
                &quot;url&quot;: &quot;Device/1835297&quot;
            }
        },
        {
            &quot;fullUrl&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;Patient&quot;,
                &quot;name&quot;: [
                    {
                        &quot;use&quot;: &quot;official&quot;,
                        &quot;given&quot;: [
                            &quot;Ben One&quot;
                        ],
                        &quot;family&quot;: &quot;Ben One&quot;
                    }
                ],
                &quot;gender&quot;: &quot;male&quot;,
                &quot;birthDate&quot;: &quot;1987-01-22&quot;,
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;POST&quot;
            }
        },
        {
            &quot;resource&quot;: {
                &quot;resourceType&quot;: &quot;Parameters&quot;,
                &quot;parameter&quot;: [
                    {
                        &quot;name&quot;: &quot;operation&quot;,
                        &quot;part&quot;: [
                            {
                                &quot;name&quot;: &quot;type&quot;,
                                &quot;valueString&quot;: &quot;add&quot;
                            },
                            {
                                &quot;name&quot;: &quot;path&quot;,
                                &quot;valueString&quot;: &quot;Device&quot;
                            },
                            {
                                &quot;name&quot;: &quot;name&quot;,
                                &quot;valueString&quot;: &quot;patient&quot;
                            },
                            {
                                &quot;name&quot;: &quot;value&quot;,
                                &quot;valueReference&quot;: {
                                    &quot;reference&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,
                                    &quot;type&quot;: &quot;Patient&quot;
                                }
                            }
                        ]
                    }
                ]
            },
            &quot;request&quot;: {
                &quot;method&quot;: &quot;PATCH&quot;,
                &quot;url&quot;: &quot;Device/1835297&quot;
            }
        }
    ]
}
</code></pre></div>
<p>This doesn't resolve the <code>urn:uuid:xx</code> either, </p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Device&quot;,
    &quot;id&quot;: &quot;1835297&quot;,
    // ... other data
    &quot;patient&quot;: {
        &quot;reference&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,
        &quot;type&quot;: &quot;Patient&quot;
    }
}
</code></pre></div>
<p>What am I missing here?</p>



<a name="224692863"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224692863" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224692863">(Feb 01 2021 at 07:28)</a>:</h4>
<p>You might try asking on <a class="stream" data-stream-id="179167" href="/#narrow/stream/179167-hapi">#hapi</a> Some of those most familiar with it don't monitor this stream because it's too high-volume</p>



<a name="224692973"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224692973" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224692973">(Feb 01 2021 at 07:30)</a>:</h4>
<p>By the way, none of the available FHIR test servers implements the full spec, so one should never assume any particular server to do so.</p>



<a name="224693788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224693788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224693788">(Feb 01 2021 at 07:46)</a>:</h4>
<p>I see, okay.</p>



<a name="224698187"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/224698187" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#224698187">(Feb 01 2021 at 08:43)</a>:</h4>
<p>Okay, thank you for letting me know! <br>
I've split into 2 topics</p>
<p><a href="#narrow/stream/179167-hapi/topic/HAPI.20Docker.20setup/near/224696698">HAPI Docker setup</a><br>
<a href="#narrow/stream/179167-hapi/topic/Transactions.20and.20Conditional.20PATCH/near/224694590">Transactions</a></p>



<a name="227863211"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/227863211" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sean zitello <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#227863211">(Feb 26 2021 at 00:29)</a>:</h4>
<p>IHE IT-65 ProvideDocBundle The Bundle includes DocumentManifest DocumentReference Binary.  I had assumed that whenever I use "urn:uuid:..." in a 'url' typed element, it would be replaced by the server.  In this case.  the <a href="http://Binary.id">Binary.id</a> / fullUrl and the DocumentReference.content.attachment match in the transsction request.  The attachment value is not replaced however in the response though.  That seems to indicate I need to persist the Binary first, get the id and then reference as FQ in transaction request?  Is this expected behavior.  Am I missing something?  (R4.0)</p>



<a name="227884541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/227884541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#227884541">(Feb 26 2021 at 05:27)</a>:</h4>
<p>The transaction processing rules in the spec clearly say "Servers SHALL replace all matching links in the bundle, whether they are found in the resource ids, resource references, elements of type uri, url, oid, uuid, and &lt;a href="" &amp; &lt;img src="" in the narrative."  So it sounds like your server isn't behaving correctly.  Are you hitting one of the standard reference servers?</p>



<a name="227884560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/227884560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#227884560">(Feb 26 2021 at 05:27)</a>:</h4>
<p>(In this case, DocumentReference.content.attachment is of type 'url', which is covered by the rule.)</p>



<a name="227909805"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/227909805" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dexter <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#227909805">(Feb 26 2021 at 10:41)</a>:</h4>
<p>Yeah I'm hitting the public HAPI server at <code>hapi.fhir.org</code>. Apologies for the delay in response, I asked in the #hapi stream as suggested. I've reported this as a bug (as suggested by Mr René Spronk) on GitHub <a href="https://github.com/hapifhir/hapi-fhir/issues/2353">here</a></p>



<a name="227929186"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/227929186" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> sean zitello <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#227929186">(Feb 26 2021 at 13:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179166-implementers/topic/Transactions/near/227884541">said</a>:</p>
<blockquote>
<p>The transaction processing rules in the spec clearly say "Servers SHALL replace all matching links in the bundle, whether they are found in the resource ids, resource references, elements of type uri, url, oid, uuid, and &lt;a href="" &amp; &lt;img src="" in the narrative."  So it sounds like your server isn't behaving correctly.  Are you hitting one of the standard reference servers?</p>
</blockquote>
<p>HAPI R4 public is good.  I have two other vendor 1 private, 1 public private instance where it fails.</p>



<a name="227936129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transactions/near/227936129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transactions.html#227936129">(Feb 26 2021 at 14:35)</a>:</h4>
<p>Where it fails, you should report a bug to whoever's running that system - and point them at the language I quoted.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
