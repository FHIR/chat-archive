---
layout: page
title: "FHIR Chat  · Transaction operations order · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html">Transaction operations order</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="161184905"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161184905" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161184905">(Mar 19 2019 at 20:01)</a>:</h4>
<p>Operations in transaction bundle have explicit order.   I'm still very curious why do we need to force this rearrangement by HTTP methods - <a href="https://www.hl7.org/fhir/http.html#trules" target="_blank" title="https://www.hl7.org/fhir/http.html#trules">https://www.hl7.org/fhir/http.html#trules</a>? It can just puzzle users. As well for testing, I would like to run  create, read, search and delete  operations in transaction and rollback - why this is impossible?</p>



<a name="161187614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161187614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161187614">(Mar 19 2019 at 20:34)</a>:</h4>
<blockquote>
<p>force this rearrangement by HTTP methods</p>
</blockquote>



<a name="161187682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161187682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161187682">(Mar 19 2019 at 20:34)</a>:</h4>
<p>I'm not sure what that means</p>



<a name="161187694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161187694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161187694">(Mar 19 2019 at 20:35)</a>:</h4>
<p>Generally, we do not say that you cannot implemnent some kind of transaction manager, but we have agreed not to describe that as part of the core standard</p>



<a name="161189678"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161189678" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161189678">(Mar 19 2019 at 21:01)</a>:</h4>
<p>I mean this</p>



<a name="161189752"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161189752" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161189752">(Mar 19 2019 at 21:02)</a>:</h4>
<p>Because of the rules that a transaction is atomic where all actions pass or fail together and the order of the entries doesn't matter, there is a particular order in which to process the actions:</p>
<ul>
<li>Process any DELETE interactions</li>
<li>Process any POST interactions</li>
<li>Process any PUT or PATCH interactions</li>
<li>Process any GET or HEAD interactions</li>
<li>Resolve any conditional references</li>
</ul>
<p>If any resource identities (including resolved identities from conditional update/delete) overlap in steps 1-3, then the transaction SHALL fail.</p>



<a name="161189829"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161189829" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161189829">(Mar 19 2019 at 21:03)</a>:</h4>
<p>Why   <code>the order of the entries doesn't matter</code>?</p>



<a name="161189914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161189914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161189914">(Mar 19 2019 at 21:04)</a>:</h4>
<p>This is a simplified view of a transaction - in my test case - order does matter.</p>



<a name="161189984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161189984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161189984">(Mar 19 2019 at 21:05)</a>:</h4>
<p>In SQL transactions - order matters because next expression can expect previous one.</p>



<a name="161193552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161193552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161193552">(Mar 19 2019 at 21:50)</a>:</h4>
<p>I think at least it should be called out and possibly added element/extension to cap statements</p>



<a name="161224923"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161224923" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161224923">(Mar 20 2019 at 08:20)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span>  <span class="user-mention" data-user-id="191315">@Josh Mandel</span>   <span class="user-mention" data-user-id="191757">@Christiaan Knaap</span>  what is your opinion about this?</p>



<a name="161234253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161234253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161234253">(Mar 20 2019 at 10:49)</a>:</h4>
<p>I think the idea behind the specific order that's described by the spec is that it's the order that makes sense for the fairly common use-case of processing data from external non-FHIR sources (e.g. Hl7v2.x messages) by converting data sources into a transaction bundle that represents the appropriate conversion logic.</p>
<p>Using a transaction in order to provide automatic cleanup for unit tests is a neat idea- why not just specify a custom extension for your server though that forces the transaction to roll back at the end?</p>



<a name="161284438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161284438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161284438">(Mar 20 2019 at 19:48)</a>:</h4>
<p>I understand from this thread that you (<span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span> ) would prefer to have the client put the entries in the transaction in the right order if that matters to him (or is a FHIR client a 'her'?). Is that correct?</p>



<a name="161318402"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161318402" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161318402">(Mar 21 2019 at 05:36)</a>:</h4>
<p>i’m talking about server, to process operations in transaction in original order, which provided in bundle, because sometimes order matters</p>



<a name="161392027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161392027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161392027">(Mar 21 2019 at 20:16)</a>:</h4>
<p><span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span> so not the actual order in the XML or Json, right (as order is not guaranteed pr. spec at least in XML)? You would like to, regardless of the order of the interactions in the serialized XML or Json, to process it in the order as you have outlined (meaning that you would possibly rearrange the elements received to match your suggestion )?</p>



<a name="161417536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161417536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161417536">(Mar 22 2019 at 03:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191427">@Jens Villadsen</span>  can you elaborate on this - <code>as order is not guaranteed pr. spec at least in XML</code>? Entry in bundle is a sequence with guaranteed order both in xml and json?</p>



<a name="161417964"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161417964" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161417964">(Mar 22 2019 at 03:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> can we have an explanatory block in spec about how this rules works and why with examples?  Another small problem is that HTTP method is not very robust - because we can do a search by POST and we do not know semantic of other Custom Operations on FHIR server.</p>



<a name="161420651"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161420651" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161420651">(Mar 22 2019 at 05:03)</a>:</h4>
<p>ok catching up with this... </p>
<ul>
<li>why does order matter?</li>
<li>the key is that you must be able to do forward references in the transaction that are successfully resolved</li>
<li>changing the way transaction works so it's order based has many problems around failing as a group</li>
</ul>



<a name="161420702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161420702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161420702">(Mar 22 2019 at 05:04)</a>:</h4>
<p>I don't really like your use case, btw</p>



<a name="161429139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161429139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161429139">(Mar 22 2019 at 08:27)</a>:</h4>
<p><span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span> I forgot all about sequence <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> <span aria-label="gun" class="emoji emoji-1f52b" role="img" title="gun">:gun:</span></p>



<a name="161472497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161472497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161472497">(Mar 22 2019 at 18:34)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  forward reference resolution probably should be implemented  in different way, because resources can mutually refer each other</p>



<a name="161472677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161472677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161472677">(Mar 22 2019 at 18:37)</a>:</h4>
<p>can you tell more about many problems as a group?</p>



<a name="161472821"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161472821" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161472821">(Mar 22 2019 at 18:39)</a>:</h4>
<p>Why you do not like my example - it’s a good way to test server without side effects</p>



<a name="161484838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161484838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161484838">(Mar 22 2019 at 21:17)</a>:</h4>
<p>because server needs to audit the operation, and there's always side effects. I guess I don't like the idea because for me, most operations operate on structures outside the acid bounds of the transaction</p>



<a name="161484919"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161484919" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161484919">(Mar 22 2019 at 21:18)</a>:</h4>
<blockquote>
<p>resources can mutually refer each other</p>
</blockquote>
<p>that's why transaction is how it is. Not sure what other way would be better.</p>



<a name="161484938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/161484938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#161484938">(Mar 22 2019 at 21:19)</a>:</h4>
<p>and I don't remember all the details about the discussion around transactions. <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> might remember better than I</p>



<a name="191572636"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20operations%20order/near/191572636" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan Dubrov <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20operations.20order.html#191572636">(Mar 24 2020 at 07:13)</a>:</h4>
<p>Specified ordering becomes very problematic when extended operations are taken into account. We are considering adding our own extension on a bundle to use client-specified ordering for running transaction bundles. <br>
For example, one of our operations sometimes we need to run before PUT and sometimes after.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
