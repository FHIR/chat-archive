---
layout: page
title: "FHIR Chat  · Auditing a transaction · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html">Auditing a transaction</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153834869"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153834869" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153834869">(Jun 24 2016 at 20:47)</a>:</h4>
<p>I have a question regarding auditing of a FHIR transaction. Are we supposed to create one AuditEvent for the entire transaction bundle with type/subtype as rest/transaction? Or should we create one AuditEvent for each resource operation within the transaction bundle?</p>



<a name="153834901"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153834901" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153834901">(Jun 25 2016 at 09:11)</a>:</h4>
<p>I do both. But there's no formal policy</p>



<a name="153834930"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153834930" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153834930">(Jun 25 2016 at 20:56)</a>:</h4>
<p>Hi Anand,</p>



<a name="153834931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153834931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153834931">(Jun 25 2016 at 21:00)</a>:</h4>
<p>You can create one audit event that indicates as entities each of the items in transaction. You could create individual audit events for each item in the transaction.  You could even just do one audit event for the transaction, and N simple create/update audit events for the items. Or you could jut do one audit event for the transaction, create a Provenance for anything created/updated, and point the transactional audit evnent at the provenance.  This last part is what confuses the most, as it really indicates the overlap of provenance and auditevent. They are overlapped, but they have different downstream uses. So it is important to look at the downstream use-case, that will tell you which mode is likely most useful.... That said, not knowing the downstream, it is far better to create too many audit events as they are by nature less expected to be permenant and allowed to be analized and purged.</p>



<a name="153835078"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835078" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835078">(Jun 27 2016 at 13:48)</a>:</h4>
<p>The security wg would like to help the community understand proper use of auditEvent and Provenance through some connectathon focus. Today we have the EHR lifecycle that is fine for that specific purpose, but doesn't compel people to come test it. So we are thinking that what we need is some existing connectathon track that does something overall useful but also involved enough to have multiple actors and act upon multiple resources in an overall useful scenario. Security would then have an overlay on this indicating the points where Provenance might be critical, or useful; and where auditEvent might be criticalor useful. -- recognizing that  policy in a specific deployed implementation will actually define what is really required.   This way people can first focus on the primary purpose of the connectathon track, working on the interactions and clinical resource use; and then realize that for a bit more effort they can add support of the security layer...  </p>



<a name="153835079"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835079" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835079">(Jun 27 2016 at 13:50)</a>:</h4>
<p>Unfortunately it seems all connectathon tracks are single resource focused and consist of only a client and a server. So it is hard to show value of audit or provenance; and adding these in without a larger context would look bizarre as the context less scenario would demand all involved create both audit events and provenance events; as there is no context to lend reasonable expectations.</p>



<a name="153835088"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835088" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835088">(Jun 27 2016 at 14:39)</a>:</h4>
<p>+1 for security connectathon track(s)!  I'm concerned that the conformance resources as getting "firm" without enough information protection scrutiny...</p>



<a name="153835096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835096">(Jun 27 2016 at 15:15)</a>:</h4>
<p>Interesting... the Security WG could take a concentrated look at the security impact of the conformance resources... We are approaching an empty CP backlog...</p>



<a name="153835097"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835097" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835097">(Jun 27 2016 at 15:16)</a>:</h4>
<p>That said... my point is that we have had a security track that no one signs up for.. the EHR lifecycle track... So, my proposal is not to have a security track, but rather to have security overlays on other tracks.</p>



<a name="153835132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835132">(Jun 27 2016 at 15:53)</a>:</h4>
<p>My concerns are that the conformance resources are useful in accurately conveying what's happening in a real-world system as information is redacted and/or updated during FHIR service calls.</p>



<a name="153835133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835133">(Jun 27 2016 at 15:55)</a>:</h4>
<p>Many interactions with clients are going to be on resources subsets...will the standard adequately communicate with the client regarding what information is being exchanged? Or will the server simply not send some information forcing the client to guess the meaning of missing data.</p>



<a name="153835134"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835134" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835134">(Jun 27 2016 at 15:56)</a>:</h4>
<p>Or, prior to exchange, will it be possible for the client to determine a configuration based on what data the server will provide? Or will the client just have to start asking for data and then determine what it can do based on what is returned?</p>



<a name="153835135"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835135" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835135">(Jun 27 2016 at 15:57)</a>:</h4>
<p>And now I'm off-topic for this thread....my apologies....</p>



<a name="153835136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835136">(Jun 27 2016 at 16:06)</a>:</h4>
<p>Chris, we need to be careful. What you are asking for would expose the data that the system is protecting: "Here is the data I have on the patient, except for that STD that the patient has asked us to not disclose".</p>



<a name="153835137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835137">(Jun 27 2016 at 16:07)</a>:</h4>
<p>We have mechanisms in FHIR to indicate that you have received ALL the data, or a SUBSET. This primarily so that you know you have a subset and thus an UPDATE would be difficult/impossible... (an operational problem we are kicking down the road, but at least we can detect it).</p>



<a name="153835138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835138">(Jun 27 2016 at 16:07)</a>:</h4>
<p>Absolutely....but making a general statement that "STD Observations will not be included in any request" might be important</p>



<a name="153835139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835139">(Jun 27 2016 at 16:08)</a>:</h4>
<p>Referring to the SUBSETTED tag?</p>



<a name="153835140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835140">(Jun 27 2016 at 16:08)</a>:</h4>
<p>SUBSETTED is used when you have asked for a _summary... as an indication you didn't get it all.</p>



<a name="153835141"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835141" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835141">(Jun 27 2016 at 16:08)</a>:</h4>
<p>REDACT (or other) would be used if it was removed for a Security or Privacy reason</p>



<a name="153835142"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835142" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835142">(Jun 27 2016 at 16:09)</a>:</h4>
<p>but telling you WHY, is wrong.</p>



<a name="153835143"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835143" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835143">(Jun 27 2016 at 16:09)</a>:</h4>
<p>"kicking down the road" is exactly my concern...</p>



<a name="153835144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835144">(Jun 27 2016 at 16:10)</a>:</h4>
<p>My lack of authorization to see birth date shouldn't (necessarily) prevent me from being able to update communication...</p>



<a name="153835145"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835145" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835145">(Jun 27 2016 at 16:10)</a>:</h4>
<p>we have enough problems to solve today... right?     This problem is where a user has less than full access, yet somehow has the rights to UPDATE? I don't understand why that use-case is important.</p>



<a name="153835146"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835146" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835146">(Jun 27 2016 at 16:11)</a>:</h4>
<p>your example is not likely... right?</p>



<a name="153835147"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835147" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835147">(Jun 27 2016 at 16:11)</a>:</h4>
<p>Because we want this standard to be useful in all kinds of environments! Sure it is</p>



<a name="153835148"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835148" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835148">(Jun 27 2016 at 16:11)</a>:</h4>
<p>you have rights to do an UPDATE on a resource, but you don't have rights to READ the whole thing?</p>



<a name="153835149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835149">(Jun 27 2016 at 16:11)</a>:</h4>
<p>how is that even possible?</p>



<a name="153835150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835150">(Jun 27 2016 at 16:12)</a>:</h4>
<p>AND the security layer is independent of the data-model... we are working on the data-model first.</p>



<a name="153835151"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835151" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835151">(Jun 27 2016 at 16:12)</a>:</h4>
<p>Think app market apps....there may be many scenarios where apps will operate only parts of resources</p>



<a name="153835152"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835152" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835152">(Jun 27 2016 at 16:12)</a>:</h4>
<p>not that I want to paint myself into a corner.. which is why early this morning I suggested that this is useful for security to look at.</p>



<a name="153835153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835153">(Jun 27 2016 at 16:14)</a>:</h4>
<p>If apps work on only parts of resources, then we should take that as evidence that the resource is too big. I have argued many times that we need to be careful about making reources that are too big. That a criteria for how big a resource is should be how likely there would be policies that need to subdivide a resource. This should be used as clear evidence that the resource should be split.</p>



<a name="153835154"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835154" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835154">(Jun 27 2016 at 16:14)</a>:</h4>
<p>If we were only working on the data model, I'd be calm.  But we're also very much working on the service model...</p>



<a name="153835195"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835195" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835195">(Jun 27 2016 at 20:57)</a>:</h4>
<p>I have worked on a system where I had the right to enter a data value, but not the view the data I entered</p>



<a name="153835196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835196">(Jun 27 2016 at 20:57)</a>:</h4>
<p>HIV result. </p>



<a name="153835198"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835198" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835198">(Jun 27 2016 at 20:58)</a>:</h4>
<p>I generally agree that the bigger a resource gets. the more likely it is to want to secure part of it, and that when they are too big, this will be a problem. But I don't agree that the correct size is 'when it's so small that no one will want to secure bits of it', so we will have to deal with that problem.</p>



<a name="153835199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835199">(Jun 27 2016 at 20:59)</a>:</h4>
<p>the problem with security at connectathons is time... security would have to be an outcome, not an overhead. (specifically with regard to the connectathon itself)</p>



<a name="153835210"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835210" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835210">(Jun 27 2016 at 21:17)</a>:</h4>
<p>I wonder if it would be feasible to build a reusable HAPI server interceptor that automatically creates an AuditEvent for every incoming request. That would be really neat actually.</p>
<p>Something to try at next connectathon perhaps. :)</p>



<a name="153835218"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835218" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835218">(Jun 27 2016 at 21:31)</a>:</h4>
<p>I already do that internally</p>



<a name="153835326"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835326" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835326">(Jun 28 2016 at 01:30)</a>:</h4>
<p>Same here.</p>



<a name="153835327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835327">(Jun 28 2016 at 01:33)</a>:</h4>
<p>Yeah, your respective servers were the inspiration for this. :)</p>
<p>I'm just wondering if it can be done generically enough to be useful (ie. could it be used on anyone's server if it's built with the HAPI server framework)</p>



<a name="153835352"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835352" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835352">(Jun 28 2016 at 02:20)</a>:</h4>
<p>that sounds like a nice idea</p>



<a name="153835357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835357">(Jun 28 2016 at 02:25)</a>:</h4>
<p>so, this is nice... in that it does record AuditEvents for some security relevant events. However there are many more auditevents that need to be recorded. I would never discourage automation, I just want to keep the pressure on for complete auditevents. So, what events? Access Control decision failues, authentication failures, communication failures, storage failures, boot, system start, service managment, configuration management, and --- execution of services, workflows, algorithms, etc...</p>



<a name="153835358"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835358" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835358">(Jun 28 2016 at 02:28)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I would never say to go too small... They need to be 'just right'... which is a tradeoff between many things. Sorry if I implied that we should make everything micro-resources. Not my intention. All I wanted was recognition that sometimes we should look to breakup a resouce because it is getting too big, too hard to manage. Yes I did propose that a trigger for this evaluation is when security would need to segment a resource, but this is just a trigger for evaluation, it is not a mandate that it must be broken up. I think we need some of these guiding principles.</p>



<a name="153835360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835360">(Jun 28 2016 at 02:30)</a>:</h4>
<p>agree. In fact, that particular rule is written somewhere, I think </p>



<a name="153835911"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835911" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Jafari <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835911">(Jun 30 2016 at 17:53)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> having thought of creating audit events inside security labeling interceptor, I was wondering whether there is a mechanism to create/update resources from within an interceptor without actually establishing a TCP connection to the local server. Something like a special HAPI FHIR client that connects to the data source directly but maintains the HAPI client interface. </p>



<a name="153835957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835957">(Jun 30 2016 at 21:28)</a>:</h4>
<p>sounds dangerous from within an interceptor... locking problems arise easily</p>



<a name="153835965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153835965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Jafari <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153835965">(Jun 30 2016 at 22:27)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I think if one uses the JPA transaction manager those issues are going to be taken care of. </p>



<a name="153836007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836007">(Jul 01 2016 at 03:28)</a>:</h4>
<p>And if the transaction fails and is rolled back, need to be careful that the audit doesn't rollback too.</p>



<a name="153836318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836318">(Jul 04 2016 at 22:21)</a>:</h4>
<p>If you mean within the JPA module you could do this by asking spring for a copy of the <code>IResourceDao&lt;AuditEvent&gt;</code> and wiring that into your interceptor. Then in your interceptor you could use that to write new AuditEvent resources.</p>
<p>Look at the <code>IJpaServerInterceptor</code> interface, which adds some new methods to the interceptor. These methods are called within the scoping transaction so you could get all-or-nothing behaviour when writing an audit event alongside the thing you are actually writing (presumably you'd want this behaviour).</p>



<a name="153836562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836562">(Jul 06 2016 at 04:39)</a>:</h4>
<p>We had done a lot around avoiding this behavior i.e. failure in creating/updating a resource should NOT fail writing the audit event. At the same time failing a resource create/update if the creation of audit event fails is a desirable behavior.</p>



<a name="153836588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836588">(Jul 06 2016 at 13:45)</a>:</h4>
<p>I don't think I agree. We even made statements to this in the core ATNA standards. The loss of an audit event is less important than the loss of medical data. Don't roll back something because you couldn't record the audit event. The audit needs to be as clean and fast as possible. </p>



<a name="153836589"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836589" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836589">(Jul 06 2016 at 13:46)</a>:</h4>
<p>This article is about this concept, although the reason the article was written was different. But the concept is the same. <a href="https://healthcaresecprivacy.blogspot.com/2011/12/atna-syslog-is-good-enough.html" target="_blank" title="https://healthcaresecprivacy.blogspot.com/2011/12/atna-syslog-is-good-enough.html">https://healthcaresecprivacy.blogspot.com/2011/12/atna-syslog-is-good-enough.html</a></p>



<a name="153836591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836591">(Jul 06 2016 at 13:55)</a>:</h4>
<p><span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span> FWIW the interceptor in this case does also let you record a different audit event scoped outside the transaction in the event that the transaction rolls back, via the <code>handleException</code> method. It seems weird to me that someone would want the <em>same</em> audit event recorded for a write transaction, even if that write didn't actually succeed.</p>
<p>The behaviour John is describing would be a bit more work though. Since the write and the audit-write are grouped, either could fail the other. I guess a queueing mechanism of some sort would be needed to separate these.</p>



<a name="153836594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836594">(Jul 06 2016 at 14:15)</a>:</h4>
<p>If the primary write failed, then the auditEvent.outcome should indicate the failure vs success. So it isn't really radically diffeent audit log entry.</p>



<a name="153836614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836614">(Jul 06 2016 at 16:50)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span>  I think I didn't say that right. If a resource CRUD failed, we write a failure audit event. The audit event write (success/failure) is not in the same transaction as the resource. In our case, the resource write is a sub-transaction yielding a operation outcome. The outcome is audited no matter what in the parent transaction. </p>



<a name="153836616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836616">(Jul 06 2016 at 17:00)</a>:</h4>
<p>Well done. I expected so, but wanted to be clear.</p>



<a name="153836617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836617">(Jul 06 2016 at 17:02)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> Isn't it subjective to allow/disallow resource actions without a audit trail? Is there enough consensus that it is OK to allow the resource action even if the audit couldn't be recorded.</p>



<a name="153836618"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836618" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836618">(Jul 06 2016 at 17:04)</a>:</h4>
<p>BTW very informative article, thanks for sharing</p>



<a name="153836621"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836621" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836621">(Jul 06 2016 at 17:15)</a>:</h4>
<p><span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span> correct to note that this is clearly a policy statement; however I would argue that the in healthcare treatment the dominant policy is the one I ascribe. If we were in the Financial market, they would set the policy completely the opposite way; that is if it can't be written into the ledger then it can't happen. The difference is that in Finance the harm of delaying a transaction until the full system is operational is minimal, where in healthcare treatment the delay can cause pain, suffering, and death.    -- as a general-purpose toolkit, you don't know if you are being used for life-critical treatment, or if you are being used for delayable use-cases.</p>



<a name="153836629"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153836629" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153836629">(Jul 06 2016 at 17:23)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> Thank you, I am more convinced than before.</p>



<a name="153843876"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153843876" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohammad Jafari <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153843876">(Aug 13 2016 at 00:45)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191319">@James Agnew</span> . Working on a consent enforcer interceptor for the Baltimore connecrathon, and following your advice above, I am now facing this exception trying to get a Dao for Patient or Consent. Wondering how I can trigger the creation of these beans:</p>
<div class="codehilite"><pre><span></span>No qualifying bean of type [ca.uhn.fhir.jpa.dao.IFhirResourceDao] found for dependency [ca.uhn.fhir.jpa.dao.IFhirResourceDao&lt;org.hl7.fhir.dstu3.model.Patient&gt;]: expected at least 1 bean which qualifies as autowire candidate for this dependency. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}; nested exception is
org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type [ca.uhn.fhir.jpa.dao.IFhirResourceDao] found for dependency [ca.uhn.fhir.jpa.dao.IFhirResourceDao&lt;org.hl7.fhir.dstu3.model.Patient&gt;]: expected at least 1 bean which qualifies as autowire candidate for this dependency. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}
    org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:569)
</pre></div>



<a name="153845231"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Auditing%20a%20transaction/near/153845231" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Auditing.20a.20transaction.html#153845231">(Aug 26 2016 at 11:27)</a>:</h4>
<p>That's very strange. Those should be created automatically.. Does it help if you ask for it by name? <code>myPatientDaoDstu3</code></p>
<p>It gets declared in <code>BaseJavaConfigDstu3.java</code> FWIW</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
