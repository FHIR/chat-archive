---
layout: page
title: "FHIR Chat  · ValueSet $expand implementation help · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html">ValueSet $expand implementation help</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="195604241"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195604241" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Dunnington <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195604241">(Apr 28 2020 at 18:09)</a>:</h4>
<p>Hey all, I'm trying to implement the $expand operation properly. For basic value sets it's straightforward, but I ran into an example that I need your clarification/help with. I have read the latest documentation linked to in some of the other discussion topics, and it's not clarifying this issue.</p>
<p>The standard value set for location types is <a href="http://hl7.org/fhir/ValueSet/v3-ServiceDeliveryLocationRoleType" title="http://hl7.org/fhir/ValueSet/v3-ServiceDeliveryLocationRoleType">http://hl7.org/fhir/ValueSet/v3-ServiceDeliveryLocationRoleType</a>.</p>
<p>The core of that value set is the following compose block:</p>
<div class="codehilite"><pre><span></span><code>      &quot;compose&quot;: {
          &quot;include&quot;: [
            {
              &quot;system&quot;: &quot;http://hl7.org/fhir/v3/RoleCode&quot;,
              &quot;filter&quot;: [
                {
                  &quot;property&quot;: &quot;concept&quot;,
                  &quot;op&quot;: &quot;is-a&quot;,
                  &quot;value&quot;: &quot;_ServiceDeliveryLocationRoleType&quot;
                }
              ]
            }
          ],
          &quot;exclude&quot;: [
            {
              &quot;system&quot;: &quot;http://hl7.org/fhir/v3/RoleCode&quot;,
              &quot;concept&quot;: [
                {
                  &quot;code&quot;: &quot;_ServiceDeliveryLocationRoleType&quot;
                }
              ]
            }
          ]
        }
</code></pre></div>


<p>I'm not clear on how to expand this. _ServiceDeliveryLocationRoleType contains a whole list of child concepts, many of which include their own child concepts, and so on.</p>
<p>So if I process the include rule, and follow the is-a relationship, I would end up with an expansion that had one parent code, _ServiceDeliveryLocationRoleType, and all its descendant concepts.</p>
<p>But then if I then run the exclude rule, wouldn't I end up with an empty expansion (because I just removed the root node of the codes I included)?</p>



<a name="195604588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195604588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195604588">(Apr 28 2020 at 18:11)</a>:</h4>
<p>Removing the root code wouldn't remove any of the descendants</p>



<a name="195604823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195604823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Dunnington <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195604823">(Apr 28 2020 at 18:13)</a>:</h4>
<p>Are you saying that the result of the expansion should be flattened?</p>



<a name="195604915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195604915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195604915">(Apr 28 2020 at 18:14)</a>:</h4>
<p>expansion is flattened.</p>



<a name="195604997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195604997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Dunnington <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195604997">(Apr 28 2020 at 18:15)</a>:</h4>
<p>Does a flattened expansion exclude abstract codes?</p>



<a name="195605274"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195605274" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Dunnington <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195605274">(Apr 28 2020 at 18:17)</a>:</h4>
<p>For example, the _ServiceDeliveryLocationType is abstract, and all of its descendants are also abstract codes...you have to go several layers deep to get to an actual (non-abstract) code.</p>



<a name="195605547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195605547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195605547">(Apr 28 2020 at 18:20)</a>:</h4>
<p>Depends on terminology server. Take a look $expand operation: <a href="http://build.fhir.org/valueset-operation-expand.html" title="http://build.fhir.org/valueset-operation-expand.html">http://build.fhir.org/valueset-operation-expand.html</a></p>



<a name="195605639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195605639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195605639">(Apr 28 2020 at 18:20)</a>:</h4>
<p>The notion of 'abstract' is for a particular use - what's abstract in one use-case (e.g. user-selection) might still be concrete for other use-cases (e.g. decision support)</p>



<a name="195605720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195605720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195605720">(Apr 28 2020 at 18:21)</a>:</h4>
<p>So we don't want to make excluding 'abstract' codes a general rule.  Also, the notion of 'abstract' is conveyed as a property and isn't necessarily handled in a standard way across code systems.</p>



<a name="195607342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195607342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Dunnington <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195607342">(Apr 28 2020 at 18:33)</a>:</h4>
<p>I found the flattening idea confusing because the ValueSet specification allows for child concepts (ValueSet.expand.contains.contains), and doesn't explicitly state that the expansion should be flattened anywhere that I could find. So I couldn't tell, if the ValueSet.expand.contains itself has a contains, what that means. Does that mean sometimes you can expand and not flatten the list? And if so, when is that the case?</p>
<p>And thank you for answering all my questions here :)</p>



<a name="195608544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195608544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195608544">(Apr 28 2020 at 18:42)</a>:</h4>
<p>The ability to represent hierarchy in an expansion is going to be variable.  A value set can constrain out intermediary concepts.  It may also draw from multiple code systems and the relationships needed to determine cross-system relationships might not exist</p>



<a name="195615937"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/195615937" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#195615937">(Apr 28 2020 at 19:44)</a>:</h4>
<p><a href="http://tx.fhir.org" title="http://tx.fhir.org">tx.fhir.org</a> will not do a heirarchical value set when you exclude an codes - the value set is always flat in that case, whether the client asks for it to be flat or not.</p>



<a name="214812041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/214812041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#214812041">(Oct 28 2020 at 09:33)</a>:</h4>
<p>Is there any example to show how to create filters in a code system and use them in relevant valuesets?  I'm wondering how to enable expansion of an intensional valueset with a filter (op="in") for ICD-10.  For example, I want to create an intensional valueset which includes ICD-10 code A00.0 and all its descendants.</p>



<a name="214812454"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/214812454" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#214812454">(Oct 28 2020 at 09:37)</a>:</h4>
<p>Now, I'm still confused although there are separate instructions for creation and usage of filters in CodeSystem and ValueSet, respectively.  Any comprehensive tutorial for the whole process consisting of creation and usage of filters?  Thanks in advance.</p>



<a name="214812718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/214812718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#214812718">(Oct 28 2020 at 09:40)</a>:</h4>
<p><a href="http://filter.codes">filter.codes</a> such as "concept", "code" or "parent" don't work when the filter is used to create valuesets.  BTW, HAPI  FHIR JPA Server is used.</p>



<a name="214813595"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/ValueSet%20%24expand%20implementation%20help/near/214813595" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lin Zhang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/ValueSet.20.24expand.20implementation.20help.html#214813595">(Oct 28 2020 at 09:49)</a>:</h4>
<p>(deleted)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
