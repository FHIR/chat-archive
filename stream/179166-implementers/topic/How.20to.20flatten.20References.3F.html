---
layout: page
title: "FHIR Chat  · How to flatten References? · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html">How to flatten References?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153863006"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863006" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abbie Watson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863006">(Dec 11 2016 at 20:50)</a>:</h4>
<p>Hi, <br>
Got a question about Reference pointers, and how to flatten them when assembling objects.  Let's say I have a Practitioner resource like the following, and I want to resolve the <code>managingOrganization</code> reference.  </p>
<div class="codehilite"><pre>{
  &quot;resourceType&quot; : &quot;Practitioner&quot;,
  &quot;name&quot; : {
    &quot;given&quot; : &quot;Beverly&quot;,
    &quot;family&quot; : &quot;Crusher&quot;
  },
  &quot;practitionerRole&quot; : [{
    &quot;managingOrganization&quot;: {
      &quot;display&quot; : &quot;Starfleet&quot;,
      &quot;reference&quot;: &quot;https://myapp.com/fhir/Organizations/001&quot;
    }
  }]
}
</pre></div>


<p>Is the proper way to resolve the reference and flatten the object to attach the Organization at the reference field?</p>
<div class="codehilite"><pre>{
  &quot;resourceType&quot; : &quot;Practitioner&quot;,
  &quot;name&quot; : {
    &quot;given&quot; : &quot;Beverly&quot;,
    &quot;family&quot; : &quot;Crusher&quot;
  },
  &quot;practitionerRole&quot; : [{
    &quot;managingOrganization&quot;: {
      &quot;display&quot; : &quot;Starfleet&quot;,
      &quot;reference&quot; : {
        &quot;resourceType&quot; : &quot;Organization&quot;,
        &quot;active&quot; : true,
        &quot;name&quot; : &quot;Starfleet&quot;,
        &quot;partOf&quot; : {
          &quot;display&quot; : &quot;Federation of Planets&quot;
        }
      }
    }
  }]
}
</pre></div>


<p>Or should we replace the entire Reference resource?</p>
<div class="codehilite"><pre>{
  &quot;resourceType&quot; : &quot;Practitioner&quot;,
  &quot;name&quot; : {
    &quot;given&quot; : &quot;Beverly&quot;,
    &quot;family&quot; : &quot;Crusher&quot;
  },
  &quot;practitionerRole&quot; : [{
    &quot;managingOrganization&quot;: {
      &quot;resourceType&quot; : &quot;Organization&quot;,
      &quot;active&quot; : true,
      &quot;name&quot; : &quot;Starfleet&quot;,
      &quot;partOf&quot; : {
        &quot;display&quot; : &quot;Federation of Planets&quot;
      }
    }
  }]
}
</pre></div>


<p>My assumption is that it's the former (which is how I've been implementing for the past few months).  But the latter is more concise and coherent, and I'm not ruling out the possibility I've been doing things wrong for awhile now.  Just want to confirm that I'm interpreting the standard correctly.  Are there any discussions or best practices on the best way to handle this kind of object assembly?  I suspect this dovetails into the discussions about JSON-LD and other linked data best practices.</p>



<a name="153863035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863035">(Dec 11 2016 at 21:06)</a>:</h4>
<p>Wouldn't you just use a contained resource here, or is this some next-gen stuff I'm not on top of?</p>



<a name="153863037"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863037" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863037">(Dec 11 2016 at 21:11)</a>:</h4>
<p>looks like a private implementation consideration to me. e.g. the Java reference implementation has an adornment on referece so that you can connect the resource being referred to the reference once you've resolved it, to save you resolving it again</p>



<a name="153863038"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863038" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863038">(Dec 11 2016 at 21:14)</a>:</h4>
<p>Fair enough... can't see the cons for using contained if you're inloning it though, wouldn't that solve some troubles for you</p>



<a name="153863039"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863039" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863039">(Dec 11 2016 at 21:15)</a>:</h4>
<p>using contained screws over anyone you send to. So you should never do it for external consumption</p>



<a name="153863040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abbie Watson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863040">(Dec 11 2016 at 21:39)</a>:</h4>
<p>Mostly this is just about internal implementation.  I should note that we use Mongo and Redis, which are both schemaless datastores, so it's trivial for us to persist a flattened object to memory.  No need to deconstruct or normalize.  Which means that, given our own devices, we would implement interop between our apps where it's permissible to send an entirely flattened and resolved object from one app to the next.  </p>
<p>It's sounding like the standard expects the resources to never be resolved or flattened?  ie. Endpoints should never be implemented with JOIN or $lookup operators?  </p>



<a name="153863041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863041">(Dec 11 2016 at 21:43)</a>:</h4>
<p>so I have no idea what that last sentence means. But the standard is solely concerned with your interface; it says - and will say - nothing about what happens internally. </p>



<a name="153863042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863042">(Dec 11 2016 at 21:43)</a>:</h4>
<p>the nearest we've come to that is some interest in fixing a HADOOP format, so that people can use a HADOOP database as their interface. But this hasn't gone anywhere</p>



<a name="153863043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abbie Watson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863043">(Dec 11 2016 at 21:46)</a>:</h4>
<p>:)<br>
JOIN and $lookup operators are database functions.  From what I'm gathering, it's basically expected that the Practitioner endpoint only returns data from the Practitioner table; and wouldn't go off to an Organization table and $lookup the relevant organization, or JOIN that organization record to the queried practitioner record.  </p>



<a name="153863044"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863044" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863044">(Dec 11 2016 at 21:47)</a>:</h4>
<p>are you talking about _include? </p>



<a name="153863045"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863045" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abbie Watson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863045">(Dec 11 2016 at 21:47)</a>:</h4>
<p>Ah.  Maybe?</p>



<a name="153863046"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863046" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863046">(Dec 11 2016 at 21:49)</a>:</h4>
<p>so you can get asked to include the related records - you appen them to the bundle</p>



<a name="153863047"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863047" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abbie Watson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863047">(Dec 11 2016 at 21:50)</a>:</h4>
<p>Aaaaah.  2.1.1.5.3  Yeah, this is getting close to what I'm interested in figuring out.  </p>



<a name="153863053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abbie Watson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863053">(Dec 11 2016 at 22:11)</a>:</h4>
<p>Okay, so over the wire, we use a Bundle resource.  And we get something like this.  </p>
<div class="codehilite"><pre>{
  &quot;resourceType&quot; : &quot;Bundle&quot;,
  &quot;type&quot; : &quot;searchset&quot;,
  &quot;entry&quot; : [{
    &quot;display&quot; : &quot;Beverly Crusher&quot;,
    &quot;reference&quot; : &quot;https://myapp.com/fhir/Practitioner/12345&quot;
  }, {
    &quot;display&quot; : &quot;Starfleet&quot;,
    &quot;reference&quot; : &quot;https://myapp.com/fhir/Organizations/001&quot;
  }]
}
</pre></div>


<p>But then we're back to the original question.  Is it permissible to resolve the above reference,  and send the following over the wire?</p>
<div class="codehilite"><pre>{
  &quot;resourceType&quot; : &quot;Bundle&quot;,
  &quot;type&quot; : &quot;searchset&quot;,
  &quot;entry&quot; : [{
    &quot;resourceType&quot; : &quot;Practitioner&quot;,
    &quot;name&quot; : {
      &quot;given&quot; : &quot;Beverly&quot;,
      &quot;family&quot; : &quot;Crusher&quot;
    },
    &quot;identifier&quot; : [{
      &quot;use&quot; : &quot;system&quot;,
      &quot;value&quot; : &quot;12345&quot;
    }], 
    &quot;practitionerRole&quot; : [{
      &quot;managingOrganization&quot;: {
        &quot;display&quot; : &quot;Starfleet&quot;,
        &quot;reference&quot;: &quot;https://myapp.com/fhir/Organizations/001&quot;
      }
    }]
  }, {
    &quot;resourceType&quot; : &quot;Organization&quot;,
    &quot;identifier&quot; : [{
      &quot;use&quot; : &quot;system&quot;,
      &quot;value&quot; : &quot;001&quot;
    }],
    &quot;active&quot; : true,
    &quot;name&quot; : &quot;Starfleet&quot;,
    &quot;partOf&quot; : {
      &quot;display&quot; : &quot;Federation of Planets&quot;
    }
  }]
}
</pre></div>


<p>Obviously, I need to dig deeper into the test specs, and do more interop testing with external systems.  Which is what I'm trying to do.  Trying to figure out exactly where to begin with these more complex resources.</p>



<a name="153863220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/How%20to%20flatten%20References%3F/near/153863220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/How.20to.20flatten.20References.3F.html#153863220">(Dec 13 2016 at 14:45)</a>:</h4>
<p>You can try an example on <a href="http://spark.furore.com/fhir/Patient?organization=Organization/1&amp;_include=Patient:organization&amp;_count=1&amp;_format=json" target="_blank" title="http://spark.furore.com/fhir/Patient?organization=Organization/1&amp;_include=Patient:organization&amp;_count=1&amp;_format=json">Spark</a>. It gives you 1 Patient with it's managing organization included.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
