---
layout: page
title: "FHIR Chat  · Nested Bundle · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html">Nested Bundle</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="215455066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215455066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215455066">(Nov 03 2020 at 13:50)</a>:</h4>
<p>We are working on Creating the FHIR Central services for New York State.. Where different RHIOs will be Queried to pull the data for a patient. Single query fan-out to multiple based on the patient existence in multiple RHIOs i.e. single query will have multiple response (bundle) from different sources. We would like to aggregate these responses in one single bundle as it is (nested bundle). It seems FHIR do not support nested bundle. What is recommendation for this use case.</p>



<a name="215455682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215455682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215455682">(Nov 03 2020 at 13:55)</a>:</h4>
<p>Nested bundles is supported. IHE uses that in a few of their implementation guides... Can you point at the place in the FHIR specification where you see a restriction?</p>



<a name="215462947"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215462947" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215462947">(Nov 03 2020 at 14:51)</a>:</h4>
<p>Thank you John !! That's based on my communication with other implementers .. Would you please share IHE implementation link</p>



<a name="215465322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215465322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215465322">(Nov 03 2020 at 15:08)</a>:</h4>
<p>If by query you mean <a href="http://build.fhir.org/search.html">FHIR RESTful search</a> then I think a search result Bundle is not expected to contain other Bundles. If you define a specific operation, however, you can define the result to contain multiple Bundles.</p>



<a name="215466469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215466469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215466469">(Nov 03 2020 at 15:16)</a>:</h4>
<p>FHIR central service is HUB , which can take a query from one if the participant and queries back all other participant. Each participants returns a bundle against the query. Now FHIR central service needs to bundle all these search responses and create a super bundle that means bundle contains the multiple bundles as entries </p>
<p>Bundle <br>
entry<br>
 --0 <br>
     -- bundle<br>
 -- 1 <br>
   -- bundle </p>
<p>Is this possible?</p>



<a name="215466624"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215466624" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215466624">(Nov 03 2020 at 15:17)</a>:</h4>
<p>It depends on what you mean by "query"</p>



<a name="215466637"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215466637" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215466637">(Nov 03 2020 at 15:18)</a>:</h4>
<p>No, a search cannot return bundles, you have to combine the bundle received from the participants</p>



<a name="215466820"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215466820" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215466820">(Nov 03 2020 at 15:19)</a>:</h4>
<p>Yes, that is possible but does not happen automatically.  You'd create the bundle and the receiver of the information would need to customize a handler to debundle the responses.</p>



<a name="215467377"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215467377" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215467377">(Nov 03 2020 at 15:23)</a>:</h4>
<p>That was my understanding ... but the challenge is that .. We are HUB and are not permitted to aggregate the different source data in one bundle .. We have to pass on all the bundles separately in another container. What we have done is created a super bundle where each entry of the super bundle is response from each source.  Just would like to confirm if this aligns with FHIR specification?</p>



<a name="215467416"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215467416" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215467416">(Nov 03 2020 at 15:23)</a>:</h4>
<p>Yes, a Bundle of Bundles is legal syntax</p>



<a name="215467526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215467526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215467526">(Nov 03 2020 at 15:24)</a>:</h4>
<p>Perfect !! Thank you</p>



<a name="215467535"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215467535" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215467535">(Nov 03 2020 at 15:24)</a>:</h4>
<p>No, it is not</p>



<a name="215467709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215467709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215467709">(Nov 03 2020 at 15:25)</a>:</h4>
<p>There is no restriction on the type of resource allowed in a bundle.</p>



<a name="215467727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215467727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215467727">(Nov 03 2020 at 15:25)</a>:</h4>
<p>If you receive a request /Condition?patient=xxxx to get all Conditions for a patient the response MUST be a Bundle of Condtion resources, not a bundle of bundlers</p>



<a name="215467964"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215467964" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215467964">(Nov 03 2020 at 15:27)</a>:</h4>
<p>Yes, that is true. However, in the situation he's describing, he's passing through the request to many endpoints and they each return a response.  THe receiver will need to know that they're receiving a bundle and debundle it prior to processing the query response.</p>



<a name="215468113"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215468113" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215468113">(Nov 03 2020 at 15:28)</a>:</h4>
<p>It's a custom process, absolutly, but you can put bundles in bundles, as long as the receiver knows to expect and can process that</p>



<a name="215468140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215468140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215468140">(Nov 03 2020 at 15:28)</a>:</h4>
<p>The receiver is issuing a FHIR search, the response should match what FHIR specifies- that is a bundle of the resources being searched, not a bundle of bundles</p>



<a name="215468250"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215468250" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215468250">(Nov 03 2020 at 15:29)</a>:</h4>
<p>Absolutely true, as I said, it will require that the receiver of the query response knows this will happen and will need to debundle each individual response prior to processing.</p>



<a name="215468390"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215468390" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215468390">(Nov 03 2020 at 15:30)</a>:</h4>
<p>That would not be a FHIR server any more then</p>



<a name="215468547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215468547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215468547">(Nov 03 2020 at 15:31)</a>:</h4>
<p>Technically, the FHIR server would have a front end process, that handles the debundling.  THe FHIR server would be behind it</p>



<a name="215468819"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215468819" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215468819">(Nov 03 2020 at 15:33)</a>:</h4>
<p>That's my understanding.. behind such use cases..</p>



<a name="215469011"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215469011" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215469011">(Nov 03 2020 at 15:34)</a>:</h4>
<p>Yes, sometimes you need to bend rules to handle use cases.  Really, there should be a FHIR IG that defines a custom operation that outline all of this so that it all can be done in a standard way</p>



<a name="215469260"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215469260" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215469260">(Nov 03 2020 at 15:36)</a>:</h4>
<p>I agree .. we are working on IG for New York state and would like to request FHIR team to advise the right way to discuss this use case... and conclude in standard way</p>



<a name="215470085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215470085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215470085">(Nov 03 2020 at 15:42)</a>:</h4>
<p>Likely you'll need to create a custom operation that, instead of receiving the actual query, you receive a transaction bundle that you push to the RHIOs.  The originator of the query, knows that the response will be a bundle of bundles and will process it appropriately.</p>



<a name="215470300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215470300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215470300">(Nov 03 2020 at 15:43)</a>:</h4>
<p>As I said, it's a very custom process/operation but it is legal to bundle Bundles.</p>



<a name="215470570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215470570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215470570">(Nov 03 2020 at 15:45)</a>:</h4>
<p>You should also look at alternatives. For example, the HUB can provide a service to return the endpoints for a particular search. That way you can let the initiator of the query do the searches and combine the results as they need to.</p>



<a name="215471292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215471292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215471292">(Nov 03 2020 at 15:50)</a>:</h4>
<p>FHIR Central  service is state initiative and we would like to keep all the request and response flowing through central service. Also , would like to keep everyone's response separate in our final response to requestor. In case IHE there will more such scenarios .. where you are querying different FHIR servers but do not want to consolidate the response but would like to pass on as it.   Is there possibility to have one level of nesting for bundle.</p>



<a name="215474026"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215474026" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215474026">(Nov 03 2020 at 16:07)</a>:</h4>
<p>as Dave indicates, you can do this with an $operation. You can define an operation that takes Parameters resource for the query, and returns a bundle of bundles. But, as Vassil points out, this would not be natural for a typical FHIR "RESTful" client, that is going to just do a RESTful GET with parameters.</p>



<a name="215474401"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215474401" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215474401">(Nov 03 2020 at 16:09)</a>:</h4>
<p>so, you have a choice.. a FHIR Operation, which can be defined. Or the hub does more of a federation of configuration endpoints, and let clients do what comes natural. The centeral authority could handle OAuth authorizations, and thus smooth the authorization pathway. This authorization pathway does give it ability to manage and record audit logs (to the granularity of the authorization request)</p>



<a name="215475640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215475640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215475640">(Nov 03 2020 at 16:17)</a>:</h4>
<p>As long as you realize that you are asking clients to do something that is not part of the core specification, you can go that route. You will probably need to consider why clients would find a need to do something custom.</p>



<a name="215475802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215475802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215475802">(Nov 03 2020 at 16:18)</a>:</h4>
<p>We are working as Trusted entities and not going through the OAUTH . We might go that route in future when we open up this as an API. Our Current implementation is within trusted entities (RHIOs) and we would like to keep it </p>
<ol>
<li>All queries going thorough HUB and HUB making call to other RHIOS </li>
<li>HUB also, Aggregate the data and return one response against the query received from requestor.</li>
</ol>
<p>I am writing the scenario and  will post here in some time.. It's bit complicated use case and scenario and Policy adds more complication to it it. That's why we are seeking if it is use case that can be considered for change in bundle definition and allow at-least one level nesting for bundle?</p>



<a name="215475908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215475908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215475908">(Nov 03 2020 at 16:19)</a>:</h4>
<p>It is legal to put bundles in bundles.  YOU'll just need to have a custom operation to deal with it</p>



<a name="215476110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215476110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215476110">(Nov 03 2020 at 16:20)</a>:</h4>
<p>and... what you are doing is NOT "http REST", so not the natural core use of FHIR... not wrong, just not on the beaten path.</p>



<a name="215476313"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215476313" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215476313">(Nov 03 2020 at 16:22)</a>:</h4>
<p>It is  httsp rest service (FHIR central service)..</p>



<a name="215476450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215476450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215476450">(Nov 03 2020 at 16:23)</a>:</h4>
<p>We need our participant to Query Central service to get the patient data across state i.e. from all other RHIOs. we are also using the State MPI to know where all patient exists.</p>



<a name="215476753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215476753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215476753">(Nov 03 2020 at 16:25)</a>:</h4>
<p>I have the architecture diagram that will help you all to see the actual scenario .. but not sure . if I can send here in chat</p>



<a name="215476873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215476873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215476873">(Nov 03 2020 at 16:26)</a>:</h4>
<p>I'm very familiar with the NYeC SHINNY use case.  We can discuss it off-line if you like</p>



<a name="215477285"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215477285" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215477285">(Nov 03 2020 at 16:29)</a>:</h4>
<p>Sure David !! I know we worked together in past under SHINNY</p>



<a name="215477583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215477583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215477583">(Nov 03 2020 at 16:31)</a>:</h4>
<p>Give me a call and we'll work through this</p>



<a name="215489386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215489386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215489386">(Nov 03 2020 at 17:58)</a>:</h4>
<blockquote>
<p>we would like to keep all the request and response flowing through central service. </p>
</blockquote>
<p>You can accomplish this with the central service acting as a proxy, allowing clients to interact in a "normal FHIR REST API fashion " with the different endpoints. The more you can make your implementation look/feel like a regular FHIR server (or a collection of regular FHIR servers) the better, in my opinion.</p>



<a name="215491934"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215491934" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215491934">(Nov 03 2020 at 18:19)</a>:</h4>
<p>Requesting Source does not know where all patient exists in community. FHIR central service (HUB) is integrated with State Wide MPI which is again managed centrally. Also, we would have requirement to create a central service to avoid multiple infrastructure build for the same thing.</p>



<a name="215495719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215495719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215495719">(Nov 03 2020 at 18:51)</a>:</h4>
<p>Was walking through this and I have a question: is the hub going to rewrite all links/urls?</p>
<ul>
<li>within resources themselves</li>
<li>within Bundles (e.g., paging on bundles from the sites)</li>
</ul>
<p>If you're already parsing and changing data, why not consolidate all of the resources into the same bundle too?  Then everything is standard.  If you're not planning on rewriting links, I think there will be problems.</p>



<a name="215498023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215498023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215498023">(Nov 03 2020 at 19:10)</a>:</h4>
<p>no problem for a hub to be a patient identity manager... we are all speaking about the queries for observations, those should go direct to the FHIR Servers that are custodians of that data. The Patient resource that is managed centerally would just have a bunch of <a href="http://Patient.link">Patient.link</a> (see also) that itemize each of these FHIR Servers.</p>



<a name="215498209"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215498209" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215498209">(Nov 03 2020 at 19:12)</a>:</h4>
<p>If the hub insists on being the ONLY endpoint for REST queries, then it will need to do what Gino just mentioned and need to be fiddeling with ALL of the data returned to re-write all references to be hosted at the central hub.... If that is done, then there needs to be Provenance of that fiddeling... and many will question this level of messing with ALL data</p>



<a name="215504892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215504892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215504892">(Nov 03 2020 at 20:16)</a>:</h4>
<p><span class="user-mention" data-user-id="222054">@Gino Canessa</span>  -- We are not re-writing anything.. We are putting each response as it is in a bundle (we call it as super bundle).. For e.g. <br>
If we make call to 5 different sources and receive  5 bundle... HUB response to requestor is going to be super bundle with 5 bundle (response) from sources. I am not sure what problem you are referring to? Why we have to re-write the links?  Our requirement is to keep the responses as it is.</p>



<a name="215505475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215505475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215505475">(Nov 03 2020 at 20:21)</a>:</h4>
<p>At any place in a resource that you a have a <code>Reference</code>, there can potentially be a URL to get that referenced resource. The URL will likely point to the server of the responding system. The requester now has a link they can either not able to access, or they can access without going through the hub.</p>



<a name="215505604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215505604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215505604">(Nov 03 2020 at 20:23)</a>:</h4>
<p>THe FHIR requester would have to know to route follow-up queries through the HUB or the RHIOs would need to use a URL for the references that points to the HUB that the HUB would know to forward to the data source RHIO</p>



<a name="215505933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215505933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215505933">(Nov 03 2020 at 20:26)</a>:</h4>
<p>You would need to re-write the Reference.... else it looks like the Resource is on your hub....    <br>
For example a Observation.subject = "Patient/1234" would be looked for in the bundle, and when not found in the bundle would be looked for at the URL root of the bundle... thus all relative references would appear to be at your HUB.</p>



<a name="215505986"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215505986" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215505986">(Nov 03 2020 at 20:26)</a>:</h4>
<p>and there is no way to assure uniqueness in that case</p>



<a name="215506058"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215506058" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215506058">(Nov 03 2020 at 20:27)</a>:</h4>
<p>even if you replaced all relative URI to full original source URL.. then you end up with the issue Dave is outlining</p>



<a name="215506228"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215506228" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215506228">(Nov 03 2020 at 20:28)</a>:</h4>
<p>which would give a consuming client an impression that they can retrieve (GET) that full original source URL... and if they can do that,  then you have a trust framework that would allow the client to do original http query direct to that endpoint.</p>



<a name="215506634"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215506634" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215506634">(Nov 03 2020 at 20:32)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span>  In our implementation , Client needs to extract the all bundles from super bundle and parse the those bundles .. which are maintained as it is. As an requirement , we are not proposing to include super path in XPATH or FHIRPATH.. we are saying requestor in receipt of response needs to extract the bundles from super bundle and parse each one of them</p>



<a name="215506739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215506739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215506739">(Nov 03 2020 at 20:34)</a>:</h4>
<p>okay, but in the  sub-bundle are resources (e.g. Observations) with reference values (e.g. Observation.patient) that is dereferencable to a fully specified URL.</p>



<a name="215506899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215506899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215506899">(Nov 03 2020 at 20:34)</a>:</h4>
<p>see The fantastic screen cast from <span class="user-mention" data-user-id="191315">@Josh Mandel</span>   <a href="https://youtu.be/ZK0AKB5PqGM">https://youtu.be/ZK0AKB5PqGM</a></p>
<div class="youtube-video message_inline_image"><a data-id="ZK0AKB5PqGM" href="https://youtu.be/ZK0AKB5PqGM"><img src="https://i.ytimg.com/vi/ZK0AKB5PqGM/default.jpg"></a></div>



<a name="215508786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215508786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215508786">(Nov 03 2020 at 20:54)</a>:</h4>
<blockquote>
<p>we are saying requestor in receipt of response needs to extract the bundles from super bundle and parse each one of them</p>
</blockquote>
<p>The question is <em>why</em> do you want to create these special processing rules and obligations? This approach is likely to cause  confusion and development mistakes for clients; what is the problem you're trying to solve here?</p>



<a name="215511697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215511697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215511697">(Nov 03 2020 at 21:22)</a>:</h4>
<p>The key thing to know is that no existing systems will be able to use your interface.  It won't work for SMART on FHIR apps, CDS Hooks services, etc.  It'll be a pure custom interface.  Because the data will be pure FHIR, it won't be as hard for someone to write an adapter to use your interface, but they'll still have to write an adapter.  As well, if you're not touching any of the 'self' links or fullUrls in the bundled search Bundles, then when the recipient of the results tries to hit those URLs - which will point back to the original services, not the hubs, you may have an issue.</p>
<p>The reality is that a hub that can't aggregate the data and finesse differences in identity across the servers behind the scenes isn't necessarily going to provide a lot of value.  It may be worth expending some energy to try to get the "thou shalt not touch the search bundles" requirement revisited, because it's severely limiting the value of the interface you're trying to provide.</p>



<a name="215602817"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nested%20Bundle/near/215602817" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dheeraj Kumar Pal <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nested.20Bundle.html#215602817">(Nov 04 2020 at 16:08)</a>:</h4>
<p>Thank you all for your valuable input ... I am taking this input to share with team .... and will come back with next steps or questions</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
