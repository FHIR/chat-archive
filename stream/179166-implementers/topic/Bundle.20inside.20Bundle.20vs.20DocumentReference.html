---
layout: page
title: "FHIR Chat  · Bundle inside Bundle vs DocumentReference · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html">Bundle inside Bundle vs DocumentReference</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="243210243"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/243210243" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maria Hu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#243210243">(Jun 18 2021 at 21:31)</a>:</h4>
<p>When doing a POST of a document to Azure Cosmos db, I can either Bundle a 'sub-Bundle with resources' or I can embed a 'Bundle with multiple resources' inside <a href="http://DocumentReference.content.attachment.data">DocumentReference.content.attachment.data</a> .  Wondering if one way more proper than the other from FHIR standard perspective?  Please advise, thanks.</p>



<a name="244044534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244044534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244044534">(Jun 27 2021 at 01:52)</a>:</h4>
<p>Can you explain more about what you're doing?  Why would posting a document have sub-Bundles at all?</p>



<a name="244050964"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244050964" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244050964">(Jun 27 2021 at 05:34)</a>:</h4>
<p>Are you using FHIR Documents (a Bundle of type = document) or a normal document?<br>
and in either case you will have a DocumentReference for the document metadata.</p>



<a name="244073011"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244073011" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244073011">(Jun 27 2021 at 16:03)</a>:</h4>
<p>There has been some discussion about this in the IHE space around the MHD and MHDS implementation guides. The <a href="http://attachment.data">attachment.data</a> (or in the case of MHD the attachment.url points at) an object that is described with the mime-type in attachment.contentType. If that contentType is a FHIR type, then the contents pointed to can be seen as a FHIR Resource type. For attachment.url situations this is often a Binary that holds the content. Either way the concept that the attachment has a mime-type and a content enables the source to use a FHIR Document Bundle, or a FHIR Binary with anything.   <br>
So far, MHD/MHDS has been silent on this FHIR Document Bundle use, because it is unclear how that affects persistence as bits (which is important to MHD/MHDS)<br>
A Binary will have a deterministic hash and size... a FHIR Document Bundle might start out with the one and morph as translations and re-encodings happen.<br>
So, needing Trial Implementation experience to uncover the concerns and advantages.... they are not all clear right now.</p>



<a name="244102662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244102662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244102662">(Jun 28 2021 at 05:07)</a>:</h4>
<p>I've been looking at how to merge a variety of document exchanges and I'm leaning towards IHE MHD and the use of FHIR Document as an alternative to a FHIR Binary. <br>
<a href="https://simplifier.net/guide/NHSDigital/document">https://simplifier.net/guide/NHSDigital/document</a></p>



<a name="244134058"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244134058" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244134058">(Jun 28 2021 at 12:04)</a>:</h4>
<p>I think that should work... and I would like to hear how well it does. I have an open issue in MHD looking for experience on this. Please keep me informed on how well it goes.</p>



<a name="244219882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244219882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Maria Hu <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244219882">(Jun 29 2021 at 00:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191404">John Moehrke</span> <a href="#narrow/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference/near/244134058">said</a>:</p>
<blockquote>
<p>I think that should work... and I would like to hear how well it does. I have an open issue in MHD looking for experience on this. Please keep me informed on how well it goes.</p>
</blockquote>
<p>Thanks John.</p>
<p>I tried two different options as follow, wondering which option is best practice:<br>
Option 1:<br>
Bundle (Master)<br>
Entry<br>
Bundle (Sub)<br>
Entry<br>
                                MessageHeader<br>
Patient<br>
                                Practitioner<br>
                                Organization<br>
                                ServiceRequest1<br>
                                Servicerequest2</p>
<p>Option 2:<br>
Bundle<br>
Entry<br>
                MessageHeader<br>
                DocumentReference<br>
<a href="http://Content.attachment.data">Content.attachment.data</a> (encode Patient/Practitioner/Organization/ServiceRequest1/ServiceRequest2)</p>



<a name="244510369"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244510369" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brendan Keeler <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244510369">(Jul 01 2021 at 01:55)</a>:</h4>
<p><a href="/user_uploads/10155/-dqKUoBkO0iMzoNRkV7EjSNI/5f35ku.jpg">5f35ku.jpg</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/-dqKUoBkO0iMzoNRkV7EjSNI/5f35ku.jpg" title="5f35ku.jpg"><img src="/user_uploads/10155/-dqKUoBkO0iMzoNRkV7EjSNI/5f35ku.jpg"></a></div>



<a name="244575252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244575252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244575252">(Jul 01 2021 at 14:29)</a>:</h4>
<p>Option one doesn't make sense... Are you looking for a FHIR message containing a document?</p>



<a name="244575665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/244575665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Pyke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#244575665">(Jul 01 2021 at 14:32)</a>:</h4>
<p>I think we better need to understand your use case and workflow so that the options have more context</p>



<a name="254571149"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254571149" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254571149">(Sep 23 2021 at 17:15)</a>:</h4>
<p>I'm currently working on an document exchange specification that aims to align with MHD. But more often than not, the content will be a FHIR document bundle.<br>
I was thinking thet the "provide document" transaction could be a transaction bundle where the DocumentReference.content.attachement.url resolves within the Bundle to another entry containing the document Bundle. So you get another Bundle instead of a Binary (currently not allowed in MHD).</p>
<p>However, this seems to be quite a redundant approach, because Patient, Practitioner(Author), Organization (Custodian) etc. would be both in the outer and in the inner bundle. I suppose this is by design in order to keep metadata separate from content, but it still feels a bit weird. </p>
<p>Any thoughts on this?</p>



<a name="254573744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254573744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254573744">(Sep 23 2021 at 17:33)</a>:</h4>
<p>Your point about redundancy due to the nested nature.. YES. But the Bundle of type Document requires they be in there. And the FHIR-Document rules are good and appropriate. I am not clear on why this replication is all that troubling. it is just bits</p>



<a name="254575381"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254575381" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254575381">(Sep 23 2021 at 17:45)</a>:</h4>
<p>true <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="254577244"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254577244" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254577244">(Sep 23 2021 at 17:57)</a>:</h4>
<p>But it is correct that MHD doesn't allow this currently. The only compliant way would be to Base64 encode the document Bundle an put it in a Binary, right?</p>



<a name="254579266"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254579266" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254579266">(Sep 23 2021 at 18:09)</a>:</h4>
<p>correct... until we work together to improve the spec...</p>



<a name="254583037"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254583037" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254583037">(Sep 23 2021 at 18:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> you mentioned earlier that you had an open issue for this? Could you share a link, I'd be happy to update it in case we go along with the above mentioned pattern and have collected some experience.</p>



<a name="254583659"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254583659" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254583659">(Sep 23 2021 at 18:40)</a>:</h4>
<p><a href="https://github.com/IHE/ITI.MHD/issues/91">https://github.com/IHE/ITI.MHD/issues/91</a></p>



<a name="254586561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254586561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254586561">(Sep 23 2021 at 18:59)</a>:</h4>
<p>Note that there is a set of open issues asserted in the specification. <br>
<a href="https://profiles.ihe.net/ITI/MHD/a_issues.html">https://profiles.ihe.net/ITI/MHD/a_issues.html</a></p>



<a name="254607760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254607760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254607760">(Sep 23 2021 at 21:22)</a>:</h4>
<p>I added a comment to the issue. We're only at the beginning of defining our use cases, so I might add more in the future...</p>



<a name="254696718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254696718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254696718">(Sep 24 2021 at 12:40)</a>:</h4>
<p>thanks. Note that the consumer side is not burdened by the Binary constraint. A server is free to follow the http negotiate to determine that the consumer would prefer FHIR mime-type, and thus return the Document Bundle. Not clear how many servers will do this, but it is mentioned in MHD and does leverage the explanation in Binary resource. Im not saying it is obvious or clear, but possible.</p>



<a name="254698279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254698279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254698279">(Sep 24 2021 at 12:53)</a>:</h4>
<blockquote>
<p>A server is free to follow the http negotiate to determine that the consumer would prefer FHIR mime-type, and thus return the Document Bundle</p>
</blockquote>
<p>Mhh, no: 'When a read request is made with a FHIR type in the Accept header (e.g. "application/fhir+xml" or "application/fhir+json") the Binary resource is returned in the requested FHIR format. This applies even when the binary data itself has a FHIR mime type'  (from <a href="http://hl7.org/fhir/binary.html#rest">http://hl7.org/fhir/binary.html#rest</a>)</p>



<a name="254702601"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254702601" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254702601">(Sep 24 2021 at 13:22)</a>:</h4>
<p>odd that FHIR explicitly enables easier Binary for all other mime types, and makes fhir mime type harder...</p>



<a name="254702730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/254702730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#254702730">(Sep 24 2021 at 13:23)</a>:</h4>
<p>well, more reason to get MHD (and thus the attachment datatype, url element) to better handle FHIR Documents.</p>



<a name="255605224"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/255605224" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#255605224">(Sep 30 2021 at 16:36)</a>:</h4>
<p>I don't understand why a FHIR server would persist FHIR data as Binary...? I mean, even if it's necessary to Base64 encode the document Bundle for the transaction, I would expect the server to decode it when processing hte transaction and simply store the Bundle. Why would it want to maintain the encoding...?</p>



<a name="255611327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/255611327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#255611327">(Sep 30 2021 at 17:12)</a>:</h4>
<p>The issue is that if the instance contains elements (e.g. extensions) the system doesn't know how to persist and would normally throw away, then you'd break the signature.  Also, some systems may introduce elements (e.g. code translations, alternate display values, etc.) when re-serializing.  By storing a binary copy, you hold onto everything and maintain signature validity even if you then also store the resource normally in a way that modifies the content.</p>



<a name="255633696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Bundle%20inside%20Bundle%20vs%20DocumentReference/near/255633696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Bundle.20inside.20Bundle.20vs.20DocumentReference.html#255633696">(Sep 30 2021 at 19:30)</a>:</h4>
<p>I am expecting that a server would store the Binary as a binary, but I am not presuming that the server would be forbidden from returning the result to a client that asks for a specific mime-type encoding that the server can fulfill.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
