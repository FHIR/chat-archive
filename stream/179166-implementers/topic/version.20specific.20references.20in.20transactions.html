---
layout: page
title: "FHIR Chat  · version specific references in transactions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html">version specific references in transactions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153916894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153916894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153916894">(Oct 31 2017 at 05:47)</a>:</h4>
<p>Can a transaction create two resources with one having a version-specific reference to the other (eg Provenance)?</p>



<a name="153916900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153916900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153916900">(Oct 31 2017 at 07:21)</a>:</h4>
<p>Actually I don't really understand how version-specific references work for PUTs in transactions either, do you need to assign a local version ID to the resource being referenced?</p>



<a name="153916958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153916958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153916958">(Oct 31 2017 at 14:56)</a>:</h4>
<p>Yes, you'd assign a local version id and make the reference version-specific.  When processing the transaction, your version would be replaced with the server's version.</p>



<a name="153917902"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153917902" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153917902">(Nov 07 2017 at 01:19)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> , can you clarify what that would look like? If I have a bundle with a two new resources: a Patient, and an Observation. I want Observation.subject to point to the Patient version submitted (I know, not likely in the real world). Would Observation.subject be &lt;guid&gt;/xyz? And the Patient (with that guid) in the Bundle would be defined as having version xyz? Do we expect both the guid and the version are replaced in the reference when the resources are created? (We can't keep the version since we don't know how the server assigns version numbers.)</p>



<a name="153917905"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153917905" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153917905">(Nov 07 2017 at 03:50)</a>:</h4>
<p>It would be &lt;guid&gt;/_version/xyz, but otherwise yes.</p>



<a name="153917906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153917906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153917906">(Nov 07 2017 at 05:06)</a>:</h4>
<p>Can you point me to where we say version numbers can be replaced on a PUT? I can't seem to find it.</p>



<a name="153917912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153917912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153917912">(Nov 07 2017 at 07:04)</a>:</h4>
<p>Not very explicit but mentioned in the paragraph about updating references here: <a href="https://www.hl7.org/fhir/http.html#2.21.0.17.2" target="_blank" title="https://www.hl7.org/fhir/http.html#2.21.0.17.2">https://www.hl7.org/fhir/http.html#2.21.0.17.2</a></p>



<a name="153917913"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153917913" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153917913">(Nov 07 2017 at 07:05)</a>:</h4>
<p>Resolving versioned references is also covered here: <a href="https://www.hl7.org/fhir/bundle.html#references" target="_blank" title="https://www.hl7.org/fhir/bundle.html#references">https://www.hl7.org/fhir/bundle.html#references</a></p>



<a name="153918101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153918101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153918101">(Nov 07 2017 at 23:07)</a>:</h4>
<p>So, <a href="https://www.hl7.org/fhir/bundle.html#references" target="_blank" title="https://www.hl7.org/fhir/bundle.html#references">Resolving references in Bundles</a> says:</p>
<div class="codehilite"><pre><span></span>If the reference is version specific (either relative or absolute), then remove the version from the URL before matching fullUrl, and then match the version based on Resource.meta.versionId.
</pre></div>


<p>And <a href="https://www.hl7.org/fhir/http.html#2.21.0.17.2" target="_blank" title="https://www.hl7.org/fhir/http.html#2.21.0.17.2">Transaction Processing Rules</a> says:</p>
<div class="codehilite"><pre><span></span>If the server assigns a new id to any resource in the bundle as part of the processing rules above, it SHALL also update any references to that resource in the same bundle as they are processed. References to resources that are not part of the bundle are left untouched. Version-specific references should remain as version-specific references after the references have been updated.
</pre></div>


<p>Is a "versionId" an "id"? I don't think either make clear that the version number can be updated (and will be kept in sync across resources in the bundle.</p>



<a name="153918107"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153918107" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153918107">(Nov 07 2017 at 23:14)</a>:</h4>
<p><a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14138" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14138">GF#14138</a></p>



<a name="153918820"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153918820" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153918820">(Nov 10 2017 at 09:44)</a>:</h4>
<p>I'm not sure I like bundle processing choosing to replace the versioned references included.<br>
How could I upload a resource that was referring to an older version of a resource in the history?</p>



<a name="153918844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153918844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153918844">(Nov 10 2017 at 12:15)</a>:</h4>
<p>It'd be hard unless you had a corresponding version in your local store and maintained a map of version ids</p>



<a name="153918906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/version%20specific%20references%20in%20transactions/near/153918906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Elliot Silver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/version.20specific.20references.20in.20transactions.html#153918906">(Nov 10 2017 at 17:27)</a>:</h4>
<p>Wouldn't updating history only apply when both the referring resource, and the referred resource are new and in the same bundle? <br>
...Actually no, we would need to cover new/updated resource makes reference to new/updated resource. That complicates it a little -- I was thinking that if a resource has a uuid id we could treat the version as replaceable, but if the resource already exists, we can't do that. So, the issue comes down to how to make a reference to a specific-version of a resource, when we don't know the version yet. Can we define a special version, e.g. "0" or "*", that indicates the server should replace?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
