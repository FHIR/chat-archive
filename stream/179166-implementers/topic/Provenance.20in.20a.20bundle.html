---
layout: page
title: "FHIR Chat  · Provenance in a bundle · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html">Provenance in a bundle</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="170922132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/170922132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#170922132">(Jul 15 2019 at 19:09)</a>:</h4>
<p>If you are updating a resource using a transaction containing the updated resource and a provenance resource that refers to it, how can you ensure that Provenance.target will refer to the newly updated version on the server?</p>



<a name="170928066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/170928066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#170928066">(Jul 15 2019 at 20:19)</a>:</h4>
<p>Good question.  In a transaction, you can have the id resolve to a newly created id, but we haven't talked about how to have a reference resolve to a specific version...</p>



<a name="185715506"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/185715506" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenico Corapi <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#185715506">(Jan 15 2020 at 16:34)</a>:</h4>
<p>I'm having thee same problem <span class="user-mention" data-user-id="191321">@David Hay</span>  mentioned here. Just looking for more context, does anyone have a workaround or is it something that could be added to the standard?</p>



<a name="185716846"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/185716846" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#185716846">(Jan 15 2020 at 16:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="185880333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/185880333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#185880333">(Jan 17 2020 at 01:40)</a>:</h4>
<p>have you looked at the X-Provenance header?</p>



<a name="185944035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/185944035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenico Corapi <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#185944035">(Jan 17 2020 at 18:36)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I missed that. It looks like the the docs are not prescriptive on how target is populated so it could be a good place to enforce some implementation specific behaviour and link to a specific version.</p>



<a name="186128762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186128762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186128762">(Jan 20 2020 at 19:48)</a>:</h4>
<p>I looked at the documenation for Provenance <a href="https://www.hl7.org/fhir/provenance.html" target="_blank" title="https://www.hl7.org/fhir/provenance.html">https://www.hl7.org/fhir/provenance.html</a>. <br>
=================<br>
"For new resources that need to have a corresponding Provenance resource, the version-specific reference is often not knowable until after the target resource has been updated. This can create an integrity problem for the system - what if the Provenance resource cannot be created after the target resource has been updated? To avoid any such integrity problems, the target resource and the Provenance resources should be submitted as a pair using a transaction.<br>
6.3.4.2.1 HTTP Header</p>
<p>The custom header X-Provenance to provide a provenance resource when performing PUT or POST operations using the RESTful interface:</p>
<p>POST [base]/Observation<br>
Content-Type: application/fhir+?<br>
X-Provenance: { "resourceType": "Provenance", "location": { "reference": "Location/1" }," agent" ... } "<br>
======================</p>
<p>I also looked at the examples but didn't see an example for the above usecase. <br>
I wanted to do this in atomic way i.e.<br>
 transaction bundle contains the following:<br>
 /resource 1  <br>
/resource 2 <br>
/provenance<br>
I am not sure how should I use this X-Provenance?. Should I pass this when I post my transaction /bundle ?</p>
<p>Can you please kindly share me full "transaction bundle" example or point me to a link ?. </p>
<p>thanks for your help</p>



<a name="186181497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186181497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenico Corapi <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186181497">(Jan 21 2020 at 13:21)</a>:</h4>
<p><span class="user-mention" data-user-id="257980">@Nath</span> the idea of the X-Provenance header is to have a provenance object that specifies everything except the targets. The server should create a transaction that adds references to the specific version of resource 1 and resource 2 being created in the same transaction.</p>
<p>Another way to see it is as if your provenance header was added to a new bundle request, where the target is populated with references to Resource/id/_history/newversion for both resources. Unfortunately there is no way for you to know newversion in advance and dynamic references in a bundle/transaction do not support versions. So you'll have to implement ad hoc behaviour for the performance header. </p>
<p>Just realised the  explanation is a bit convoluted, let me know if that's not clear, I can give it another go :)</p>



<a name="186193918"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186193918" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186193918">(Jan 21 2020 at 15:31)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="220674">@Domenico Corapi</span>. Let me read and digest this and ask if I have further questions. appreciate your help. thanks.</p>



<a name="186413180"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186413180" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Larry Shields <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186413180">(Jan 23 2020 at 17:30)</a>:</h4>
<p>I was dealing with something similar and one way I worked around this was utilizing the Transaction Response bundle from the Post of the Transaction Bundle to construct the Provenance Record then submit this in a transaction.  It does essentially double your  HTTP Calls to the server but would give you the version specific URLs for the Targets. </p>
<p>The issue I did run into with implementing this behavior in the HAPI FHIR Server was that the JSON/XML Parsers remove the versions from the References in Provenance Target so I lose them anyway.</p>



<a name="186507900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186507900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186507900">(Jan 24 2020 at 16:34)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="220674">@Domenico Corapi</span> . <br>
I went thru' the specs for Provenance and I understand the limitation of provenance.target cannot have /resource/id/_history/&lt;newversion&gt;. So, I have to pass X-Provenance in the header. <br>
My question is how to implement this:</p>
<p>I wanted to do this in atomic way i.e.<br>
transaction bundle contains the following:<br>
/resource 1<br>
/resource 2<br>
/provenance </p>
<p>after the bundle is posted to the server, I want the /provenance to have the versioned resources(i.e. /resource/1/_history/&lt;newversion&gt;, /resource/2/_history/&lt;newversion&gt;) in the target. </p>
<p>So, my question is this:</p>
<ol>
<li>what should I pass in X-Provenance ?. (Please note that I am posting the /bundle)</li>
</ol>
<p>Could you please kindly explain this ?</p>



<a name="186508308"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186508308" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186508308">(Jan 24 2020 at 16:38)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="200218">@Larry Shields</span> . So, you had 2 transactions?. 1. create the resources with a txn bundle and get the txn response in a txn. 2. create another txn and using the values from response bundle construct /provenace ?. So, in this case, the creation of resources and proveance are not in the same txn right ?</p>



<a name="186508986"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186508986" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Larry Shields <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186508986">(Jan 24 2020 at 16:44)</a>:</h4>
<p><span class="user-mention" data-user-id="257980">@Nath</span> <br>
Yes that's correct.  I had two separate transactions.  One that contained the resources and then a second one that contained the Provenance resource with the version specific references in the Target.</p>



<a name="186514679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186514679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186514679">(Jan 24 2020 at 17:38)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="200218">@Larry Shields</span> for clarifying. In my case, trying to them in a single txn. thanks.</p>



<a name="186534057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186534057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186534057">(Jan 24 2020 at 21:07)</a>:</h4>
<p>reading the spec again to understand how to pass X-Provenance. Is it I just need to pass <br>
X-Provenance : {resourceType: "provenance", agent : {...other related fields of provenance .. } }  ?</p>
<p>Also, I saw this thread <a href="#narrow/stream/179166-implementers/topic/x-provenance.20header" title="#narrow/stream/179166-implementers/topic/x-provenance.20header">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/x-provenance.20header</a> and it says the workaround "And if you don't like it.. then don't use it.. the alternative is to do all Create using a Batch/Transaction with the Bundle holding the resource you want to create and the Provenance. This x-provenance header is just an alternative to the same thing.".  </p>
<p>So, this workaround does not work for versioned resources right ?.</p>



<a name="186557298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186557298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186557298">(Jan 25 2020 at 04:47)</a>:</h4>
<p>I tried passing X-Provenance in header of the transaction-bundle. It didn't create Provenance resource. I was not sure which release this header was added . I was using R4.0.0 and upgraded to 4.0.1 but still not working. I manually created /provenance resource and that worked but not thru' X-Provenance. </p>
<p>Can someone point me to an example how to pass would be of great help. thanks.<br>
<span class="user-mention" data-user-id="220674">@Domenico Corapi</span></p>



<a name="186772029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186772029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Domenico Corapi <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186772029">(Jan 28 2020 at 11:02)</a>:</h4>
<p><span class="user-mention" data-user-id="257980">@Nath</span> , what server are you using? If you use HAPI, there's no support for the header I believe (it's in the standard, just not supported by the implementation). You will have to build a custom interceptor that handles it.</p>



<a name="186790430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20in%20a%20bundle/near/186790430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nath <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20in.20a.20bundle.html#186790430">(Jan 28 2020 at 15:01)</a>:</h4>
<p><span class="user-mention" data-user-id="220674">@Domenico Corapi</span> thanks.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
