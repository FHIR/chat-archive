---
layout: page
title: "FHIR Chat  · Hapi Fhir Composite Search Questions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html">Hapi Fhir Composite Search Questions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="154023754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Hapi%20Fhir%20Composite%20Search%20Questions/near/154023754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Severin Kohler <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html#154023754">(Dec 07 2018 at 15:35)</a>:</h4>
<p>Hi all - I'm currently playing around with the FHIR Search.<br>
At the moment I'm trying some composite searches on our HAPI test server and recognised some things I don't understand.<br>
First of all I deployed the example from the FHIR website for blood pressure on our Hapi (<a href="https://www.hl7.org/fhir/observation-example-bloodpressure.json.html" target="_blank" title="https://www.hl7.org/fhir/observation-example-bloodpressure.json.html">https://www.hl7.org/fhir/observation-example-bloodpressure.json.html</a>) with all the necessary values and references (the jsons i deployed are listed below, I just copied them from the official test server or from the fhir website and modified some values a little bit)</p>
<p>1. When I'm doing a composite search like : Observation?component-code-value-quantity=8480-6$lt70, my Patient is also displayed even when the systolic blood pressure (99) isn't lower than 70.<br>
I recongised that the diastolic blood pressure is 60 and if I enter a value below 60 no patient is displayed.<br>
I guess its just searching for "some" valueQuantity.</p>
<p>So the search doesn't really connect the code with the value ? <br>
Is this a bug within the Hapi Server, are the composite searches not fully implemented yet?<br>
Or did I made some mistake/misunderstood something ? </p>
<p>2. If I'm trying to connect multiple Parameters for a patient like:<br>
a) /Patient?_has:Observation:subject:component-code=8480-6&amp;_has:Observation:subject:value-quantity=lt90 (works but same problem like in 1 )<br>
or <br>
b) /Patient?_has:Observation:subject:component-code-value-quantity=8480-6$lt90 (does display an error)<br>
Why is b) not working (wrong syntax/not implemented) ?<br>
Also i don't think a) is connecting the systolic code and the value at all, even if the search in 1. would work.</p>
<p>3. How would a search for female patients with blood pressure (sys) &gt;90 and Body Temperature &gt;37.0 look like?</p>
<p>Regards,<br>
Severin Kohler</p>
<p>-----------------------------Here are the Resources, Observations etc. i deployed on my HAPI---------------------------------<br>
---------------------Patient 1------------------------<br>
{<br>
 "resourceType": "Patient",<br>
  "id": "5",<br>
  "active": true,<br>
  "gender": "female",<br>
  "birthDate": "1976-07-01",<br>
  "deceasedBoolean": false,<br>
    "name": [<br>
    {<br>
      "family": "of Alexandria",<br>
      "given": [<br>
        "Aedesia"<br>
      ]<br>
    }<br>
  ]<br>
}</p>
<p>-----------PRACTITIONER----------------------<br>
{<br>
  "resourceType": "Practitioner",<br>
  "id": "22291",<br>
  "meta": {<br>
    "versionId": "1",<br>
    "lastUpdated": "2018-10-01T06:18:35.977+00:00"<br>
  },<br>
  "identifier": [<br>
    {<br>
      "system": "<a href="http://clinfhir.com/fhir/NamingSystem/practitioner" target="_blank" title="http://clinfhir.com/fhir/NamingSystem/practitioner">http://clinfhir.com/fhir/NamingSystem/practitioner</a>",<br>
      "value": "NM7uqTm65gZHKEzsqLQ9nT2y2662"<br>
    }<br>
  ],<br>
  "name": [<br>
    {<br>
      "family": "DOCTOR",<br>
      "given": [<br>
        "REFERRING"<br>
      ]<br>
    }<br>
  ]<br>
}</p>
<p>-----------Observation Blood Pressure --------------------<br>
{<br>
  "resourceType": "Observation",<br>
  "id": "blood-pressure",<br>
  "meta": {<br>
    "profile": [<br>
      "<a href="http://hl7.org/fhir/StructureDefinition/vitalsigns" target="_blank" title="http://hl7.org/fhir/StructureDefinition/vitalsigns">http://hl7.org/fhir/StructureDefinition/vitalsigns</a>"<br>
    ]<br>
  },<br>
  "text": {<br>
    "status": "generated",<br>
    "div": "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative with Details&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;id&lt;/b&gt;: blood-pressure&lt;/p&gt;&lt;p&gt;&lt;b&gt;meta&lt;/b&gt;: &lt;/p&gt;&lt;p&gt;&lt;b&gt;identifier&lt;/b&gt;: urn:uuid:187e0c12-8dd2-67e2-99b2-bf273c878281&lt;/p&gt;&lt;p&gt;&lt;b&gt;basedOn&lt;/b&gt;: &lt;/p&gt;&lt;p&gt;&lt;b&gt;status&lt;/b&gt;: final&lt;/p&gt;&lt;p&gt;&lt;b&gt;category&lt;/b&gt;: Vital Signs &lt;span&gt;(Details : {http://hl7.org/fhir/observation-category code 'vital-signs' = 'Vital Signs', given as 'Vital Signs'})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;code&lt;/b&gt;: Blood pressure systolic &amp; diastolic &lt;span&gt;(Details : {LOINC code '85354-9' = 'lood pressure panel with all children optional', given as 'Bood pressure panel with all children optional'})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;subject&lt;/b&gt;: &lt;a&gt;Patient/example&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;effective&lt;/b&gt;: 17/09/2012&lt;/p&gt;&lt;p&gt;&lt;b&gt;performer&lt;/b&gt;: &lt;a&gt;Practitioner/example&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;interpretation&lt;/b&gt;: Below low normal &lt;span&gt;(Details : {http://hl7.org/fhir/v2/0078 code 'L' = 'Low', given as 'low'})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;bodySite&lt;/b&gt;: Right arm &lt;span&gt;(Details : {SNOMED CT code '368209003' = 'Right upper arm', given as 'Right arm'})&lt;/span&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;b&gt;component&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;code&lt;/b&gt;: Systolic blood pressure &lt;span&gt;(Details : {LOINC code '8480-6' = 'Systolic blood pressure', given as 'Systolic blood pressure'}; {SNOMED CT code '271649006' = 'Systolic blood pressure', given as 'Systolic blood pressure'}; {http://acme.org/devices/clinical-codes code 'bp-s' = 'bp-s', given as 'Systolic Blood pressure'})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;value&lt;/b&gt;: 107 mmHg&lt;span&gt; (Details: UCUM code mm[Hg] = 'mmHg')&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;interpretation&lt;/b&gt;: Normal &lt;span&gt;(Details : {http://hl7.org/fhir/v2/0078 code 'N' = 'Normal', given as 'normal'})&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;&lt;b&gt;component&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;code&lt;/b&gt;: Diastolic blood pressure &lt;span&gt;(Details : {LOINC code '8462-4' = 'Diastolic blood pressure', given as 'Diastolic blood pressure'})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;value&lt;/b&gt;: 60 mmHg&lt;span&gt; (Details: UCUM code mm[Hg] = 'mmHg')&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;interpretation&lt;/b&gt;: Below low normal &lt;span&gt;(Details : {http://hl7.org/fhir/v2/0078 code 'L' = 'Low', given as 'low'})&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;/div&gt;"<br>
  },<br>
  "identifier": [<br>
    {<br>
      "system": "urn:ietf:rfc:3986",<br>
      "value": "urn:uuid:187e0c12-8dd2-67e2-99b2-bf273c878281"<br>
    }<br>
  ],<br>
  "basedOn": [<br>
    {<br>
      "identifier": {<br>
        "system": "<a href="https://acme.org/identifiers" target="_blank" title="https://acme.org/identifiers">https://acme.org/identifiers</a>",<br>
        "value": "1234"<br>
      }<br>
    }<br>
  ],<br>
  "status": "final",<br>
  "category": [<br>
    {<br>
      "coding": [<br>
        {<br>
          "system": "<a href="http://hl7.org/fhir/observation-category" target="_blank" title="http://hl7.org/fhir/observation-category">http://hl7.org/fhir/observation-category</a>",<br>
          "code": "vital-signs",<br>
          "display": "Vital Signs"<br>
        }<br>
      ]<br>
    }<br>
  ],<br>
  "code": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://loinc.org" target="_blank" title="http://loinc.org">http://loinc.org</a>",<br>
        "code": "85354-9",<br>
        "display": "Bood pressure panel with all children optional"<br>
      }<br>
    ],<br>
    "text": "Blood pressure systolic &amp; diastolic"<br>
  },<br>
  "subject": {<br>
    "reference": "Patient/5"<br>
  },<br>
  "effectiveDateTime": "2012-09-17",<br>
  "performer": [<br>
    {<br>
      "reference": "Practitioner/3"<br>
    }<br>
  ],<br>
  "interpretation": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://hl7.org/fhir/v2/0078" target="_blank" title="http://hl7.org/fhir/v2/0078">http://hl7.org/fhir/v2/0078</a>",<br>
        "code": "L",<br>
        "display": "low"<br>
      }<br>
    ],<br>
    "text": "Below low normal"<br>
  },<br>
  "bodySite": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://snomed.info/sct" target="_blank" title="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
        "code": "368209003",<br>
        "display": "Right arm"<br>
      }<br>
    ]<br>
  },<br>
  "component": [<br>
    {<br>
      "code": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://loinc.org" target="_blank" title="http://loinc.org">http://loinc.org</a>",<br>
            "code": "8480-6",<br>
            "display": "Systolic blood pressure"<br>
          },<br>
          {<br>
            "system": "<a href="http://snomed.info/sct" target="_blank" title="http://snomed.info/sct">http://snomed.info/sct</a>",<br>
            "code": "271649006",<br>
            "display": "Systolic blood pressure"<br>
          },<br>
          {<br>
            "system": "<a href="http://acme.org/devices/clinical-codes" target="_blank" title="http://acme.org/devices/clinical-codes">http://acme.org/devices/clinical-codes</a>",<br>
            "code": "bp-s",<br>
            "display": "Systolic Blood pressure"<br>
          }<br>
        ]<br>
      },<br>
      "valueQuantity": {<br>
        "value": 99,<br>
        "unit": "mmHg",<br>
        "system": "<a href="http://unitsofmeasure.org" target="_blank" title="http://unitsofmeasure.org">http://unitsofmeasure.org</a>",<br>
        "code": "mm[Hg]"<br>
      },<br>
      "interpretation": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://hl7.org/fhir/v2/0078" target="_blank" title="http://hl7.org/fhir/v2/0078">http://hl7.org/fhir/v2/0078</a>",<br>
            "code": "N",<br>
            "display": "normal"<br>
          }<br>
        ],<br>
        "text": "Normal"<br>
      }<br>
    },<br>
    {<br>
      "code": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://loinc.org" target="_blank" title="http://loinc.org">http://loinc.org</a>",<br>
            "code": "8462-4",<br>
            "display": "Diastolic blood pressure"<br>
          }<br>
        ]<br>
      },<br>
      "valueQuantity": {<br>
        "value": 60,<br>
        "unit": "mmHg",<br>
        "system": "<a href="http://unitsofmeasure.org" target="_blank" title="http://unitsofmeasure.org">http://unitsofmeasure.org</a>",<br>
        "code": "mm[Hg]"<br>
      },<br>
      "interpretation": {<br>
        "coding": [<br>
          {<br>
            "system": "<a href="http://hl7.org/fhir/v2/0078" target="_blank" title="http://hl7.org/fhir/v2/0078">http://hl7.org/fhir/v2/0078</a>",<br>
            "code": "L",<br>
            "display": "low"<br>
          }<br>
        ],<br>
        "text": "Below low normal"<br>
      }<br>
    }<br>
  ]<br>
}</p>
<p>---------------------Observation Body Temperature------------------------------</p>
<p>{<br>
  "resourceType": "Observation",<br>
  "id": "body-temperature",<br>
  "meta": {<br>
    "profile": [<br>
      "<a href="http://hl7.org/fhir/StructureDefinition/vitalsigns" target="_blank" title="http://hl7.org/fhir/StructureDefinition/vitalsigns">http://hl7.org/fhir/StructureDefinition/vitalsigns</a>"<br>
    ]<br>
  },<br>
  "text": {<br>
    "status": "generated",<br>
    "div": "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;p&gt;&lt;b&gt;Generated Narrative with Details&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;id&lt;/b&gt;: body-temperature&lt;/p&gt;&lt;p&gt;&lt;b&gt;meta&lt;/b&gt;: &lt;/p&gt;&lt;p&gt;&lt;b&gt;status&lt;/b&gt;: final&lt;/p&gt;&lt;p&gt;&lt;b&gt;category&lt;/b&gt;: Vital Signs &lt;span&gt;(Details : {http://hl7.org/fhir/observation-category code 'vital-signs' = 'Vital Signs', given as 'Vital Signs'})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;code&lt;/b&gt;: Body temperature &lt;span&gt;(Details : {LOINC code '8310-5' = 'Body temperature', given as 'Body temperature'})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;subject&lt;/b&gt;: &lt;a&gt;Patient/example&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;effective&lt;/b&gt;: 02/07/1999&lt;/p&gt;&lt;p&gt;&lt;b&gt;value&lt;/b&gt;: 36.5 C&lt;span&gt; (Details: UCUM code Cel = 'Cel')&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;"<br>
  },<br>
  "status": "final",<br>
  "category": [<br>
    {<br>
      "coding": [<br>
        {<br>
          "system": "<a href="http://hl7.org/fhir/observation-category" target="_blank" title="http://hl7.org/fhir/observation-category">http://hl7.org/fhir/observation-category</a>",<br>
          "code": "vital-signs",<br>
          "display": "Vital Signs"<br>
        }<br>
      ],<br>
      "text": "Vital Signs"<br>
    }<br>
  ],<br>
  "code": {<br>
    "coding": [<br>
      {<br>
        "system": "<a href="http://loinc.org" target="_blank" title="http://loinc.org">http://loinc.org</a>",<br>
        "code": "8310-5",<br>
        "display": "Body temperature"<br>
      }<br>
    ],<br>
    "text": "Body temperature"<br>
  },<br>
  "subject": {<br>
    "reference": "Patient/5"<br>
  },<br>
  "effectiveDateTime": "1999-07-02",<br>
  "valueQuantity": {<br>
    "value": 37.2,<br>
    "unit": "C",<br>
    "system": "<a href="http://unitsofmeasure.org" target="_blank" title="http://unitsofmeasure.org">http://unitsofmeasure.org</a>",<br>
    "code": "Cel"<br>
  }<br>
}</p>



<a name="154024296"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Hapi%20Fhir%20Composite%20Search%20Questions/near/154024296" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html#154024296">(Dec 10 2018 at 23:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> ?</p>



<a name="154024382"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Hapi%20Fhir%20Composite%20Search%20Questions/near/154024382" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html#154024382">(Dec 11 2018 at 10:31)</a>:</h4>
<p>This composite search issue is a known issue in HAPI FHIR. Unfortunately it's a hard one to fix..</p>



<a name="154024571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Hapi%20Fhir%20Composite%20Search%20Questions/near/154024571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html#154024571">(Dec 11 2018 at 20:24)</a>:</h4>
<p>Just to make sure I understand the composite parameter examples in the spec at 2.21.1.4.15 - is example #1 in this thread valid without specifying the system, or should it be "Observation?component-code-value-quantity=http://loinc.org|8480-6$lt70"? Based on the token definition I guess both should work.</p>



<a name="154025621"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Hapi%20Fhir%20Composite%20Search%20Questions/near/154025621" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Severin Kohler <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html#154025621">(Dec 14 2018 at 10:14)</a>:</h4>
<p><span class="user-mention" data-user-id="194952">@Julian Sass</span></p>



<a name="154025622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Hapi%20Fhir%20Composite%20Search%20Questions/near/154025622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Severin Kohler <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html#154025622">(Dec 14 2018 at 10:25)</a>:</h4>
<blockquote>
<p>This composite search issue is a known issue in HAPI FHIR. Unfortunately it's a hard one to fix..</p>
</blockquote>
<p>okay so i just try it on a vonk then</p>



<a name="154025623"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Hapi%20Fhir%20Composite%20Search%20Questions/near/154025623" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Severin Kohler <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html#154025623">(Dec 14 2018 at 10:54)</a>:</h4>
<p><span class="user-mention" data-user-id="196447">@Andrea Essenwanger</span></p>



<a name="154025703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Hapi%20Fhir%20Composite%20Search%20Questions/near/154025703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Hapi.20Fhir.20Composite.20Search.20Questions.html#154025703">(Dec 14 2018 at 20:31)</a>:</h4>
<p>Hi Severin!</p>
<p>Unfortunately, there is currently also a known bug in Vonk related to composite parameters.<br>
Instead of searching on "component-code-value-quantity" it will try to search on "component-value-quantity".<br>
So search request 1) does not work.</p>
<p>2a) This search query is not working because "lt90" is not a valid value for "value-quantity". In a quantity, only the prefix is optional.<br>
You have to supply the system and unit. {{BASE_URL}}/Observation?value-quantity=lt70|http://unitsofmeasure.org|mm[Hg] should work fine.<br>
A combination with _has is valid, however, it needs to be noted that both _has parts are applied independently. So, the server forms a union of both result sets not an intersection. If you need to have a logical AND, have a look at _filter, though, this is not widely implemented.</p>
<p>2b) Should work if you provide all mandatory parts, provided 1) get's fixed.</p>
<p>3) A combination of _filter and _type should work. However, I guess at the moment there is not a single server capable of handling this.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
