---
layout: page
title: "FHIR Chat  · Provenance with target = Bundle · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html">Provenance with target = Bundle</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="205973883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/205973883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#205973883">(Aug 04 2020 at 23:39)</a>:</h4>
<p>Just to make sure I understand how to transact a  bundle with a  provenance  referencing it as a target ? -Use  X-provenance or as transaction?</p>



<a name="205974761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/205974761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#205974761">(Aug 04 2020 at 23:51)</a>:</h4>
<p>Latter.  I don't think something in the Bundle can reference the Bundle.</p>



<a name="205979719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/205979719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#205979719">(Aug 05 2020 at 01:31)</a>:</h4>
<p>The X-Provenance header could certainly be used on any POST/PUT to indicate the Provenance of the content of the POST/PUT. It is an X header, so does require that the server understands.</p>



<a name="205979723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/205979723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#205979723">(Aug 05 2020 at 01:31)</a>:</h4>
<p>what is the use-case you are trying to satisfy with a Provnance of a bundle?</p>



<a name="205985204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/205985204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#205985204">(Aug 05 2020 at 03:29)</a>:</h4>
<p>Forwarding a Message using $process-message.  The Message bundle has been modified by an intermediary.  Part of Notifications tracker and resolution.   Scenario is Sent to intermediary - based on business rules and user agreements the Recipient is not forward some content  ( in my example Coverage) so the intermediary forward the message less the Coverage.  Hence the bundle has been modified .  Prov on MessageHeader since that is updated and Prov on Bundle.  A transaction would consist of the Message with POST to operation endpoint and Prov with POST. </p>
<p>So I am guessing both as well...</p>



<a name="205992967"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/205992967" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#205992967">(Aug 05 2020 at 06:47)</a>:</h4>
<p>If the message has been modified, it's a new message, with a new id, and should show the intermediary as the sender. Provenance (contained within the message bundle) could indicate what the original sender was.</p>



<a name="206028924"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206028924" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206028924">(Aug 05 2020 at 14:32)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191372">@René Spronk</span> That helps me with my use case.  But  in general if the  the Provenance  target is the Bundle  can't point to the Bundle in the Bundle.   Hence a Transaction or X-prov header <em>Outside</em> of it.</p>



<a name="206042099"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206042099" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206042099">(Aug 05 2020 at 16:09)</a>:</h4>
<p>How do you plan to use a transaction? A transaction bundle with a message bundle inside it? While you can invoke operations from a transaction bundle, can you invoke "$process-message"?</p>



<a name="206060724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206060724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206060724">(Aug 05 2020 at 18:31)</a>:</h4>
<blockquote>
<p>While you can invoke operations from a transaction bundle, can you invoke "$process-message"?</p>
</blockquote>
<p>I assumed is possible.  iI there a reason why you cannot? Is it explicitly prohibited.</p>



<a name="206110839"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206110839" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206110839">(Aug 06 2020 at 07:13)</a>:</h4>
<p><span class="user-mention" data-user-id="191401">@Eric Haas</span> Sure, but the provenance could reference the MessageHeader resource. "This message is a transformed message as received from original source X"</p>



<a name="206150228"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206150228" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206150228">(Aug 06 2020 at 14:42)</a>:</h4>
<p>Pointing to the MessageHeader isn't really the same thing as pointing to the Bundle</p>



<a name="206158594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206158594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206158594">(Aug 06 2020 at 15:40)</a>:</h4>
<p>I expected that if a bundle needed to be persisted, that would be an exceptional case. One where one would capture the persisted Bundle in a Binary and create a DocumentReference to capture the metadata about that Binary(Bundle)</p>



<a name="206158719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206158719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206158719">(Aug 06 2020 at 15:41)</a>:</h4>
<p>This would give you an id and means of discovery</p>



<a name="206182478"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206182478" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206182478">(Aug 06 2020 at 18:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191372">@René Spronk</span>  Thanks again - that is much more practical solution and avoids the issue and extra burden of receivers having to suppor transactions and x-prov.</p>



<a name="206182716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206182716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206182716">(Aug 06 2020 at 18:59)</a>:</h4>
<p>But it doesn't actually say what you want to say...  A Provenance pointing at the MessageHeader says the <em>header</em> has changed.  It doesn't say anything at all about the other resources.  (Though I guess you could have the Provenance point at ALL of the resources in the Bundle.  That would cover everything except the elements that appears only on the Bundle...)</p>



<a name="206266652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206266652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206266652">(Aug 07 2020 at 14:54)</a>:</h4>
<p>Depends on the level of tracing one requires. If it's only "this message is modified version of a message originally by system X" then having a provenance associated with the MessageHeader suffices.  The use case (as I recall) was for the intermediary to remove some financial resources from the message.</p>



<a name="206271460"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206271460" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206271460">(Aug 07 2020 at 15:31)</a>:</h4>
<p>Provenance tied to Messageheader doesn't tell you that the message was modified, only that the MessageHeader was modified.</p>



<a name="206282947"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206282947" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206282947">(Aug 07 2020 at 17:05)</a>:</h4>
<p>Just to make sure I understand how this latest suggestion is supposed to work:</p>
<ol>
<li>A message bundle is sent from source to intermediary</li>
<li>Intermediary removes one or more entries from the original bundle, and creates a new message bundle (new <code>Bundle.id</code> and new <code>MessageHeader.id</code>)</li>
<li>The new message bundle contains an extra Provenance resource pointing to either MessageHeader (René) or to MessageHeader and all other entries in the new message (Lloyd).</li>
</ol>
<p>Is that right? Will the provenance resource have enough useful information?</p>



<a name="206283246"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206283246" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206283246">(Aug 07 2020 at 17:08)</a>:</h4>
<p>If the Provenance is about stuff that's been stripped from the message, there's no way to express that in a Provenance that just points to resources in the Bundle.   To cover that, the Provenance would <em>have</em> to point to the Bundle - which means that it would have to be in the header, given that you can't point to a Bundle from something inside it - at least not right now.</p>



<a name="206285041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206285041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206285041">(Aug 07 2020 at 17:24)</a>:</h4>
<p>the Provenance can point (.entity) at elements removed (.entity.role = removal)</p>



<a name="206285137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206285137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206285137">(Aug 07 2020 at 17:25)</a>:</h4>
<p>the Provenance.target is the output of the activity, the .entity is the input to that activity. the .entity.role is how that input was used in the activity</p>



<a name="206285307"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206285307" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206285307">(Aug 07 2020 at 17:27)</a>:</h4>
<p>Very exhaustive detail can be recorded in Provenance. not clear to me why one would want to record this exhaustive detail, but we did design Provenance to be able to do it.</p>



<a name="206287267"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206287267" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206287267">(Aug 07 2020 at 17:42)</a>:</h4>
<p>Provenance.entity.what is Reference(Any). If the removal of entries needs to be recorded, then it seems to me that an identifier would be required in this case, as there is no URL to point to resources in the original message. Will all removed resources have a identifier? Or do you have to require that the entry.fullURL is resolvable, in which case you can use a reference?</p>
<p>Based on the above, it seems to me that recording what was removed is way too involved and likely not necessary. Which leaves the other interpretation that the "new message" needs to indicate that a) it was changed from the original, and b) the original was authored by Z</p>
<p>Does that sound right?</p>



<a name="206290309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206290309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206290309">(Aug 07 2020 at 18:03)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> How can Provenance point at entities that have no identify outside the message they've now been removed from?</p>



<a name="206290381"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206290381" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206290381">(Aug 07 2020 at 18:03)</a>:</h4>
<p>Can multiple provenances be sent in the header?</p>



<a name="206297379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206297379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206297379">(Aug 07 2020 at 19:05)</a>:</h4>
<p>if no  id or identity is known, it can always be recorded as .entity.what.display -- okay, not a very satisfying answer. but I am not clear on what is trying to be accomplished.   Provenance is not a journaling-database. If there is a need for a GIT like change tracking, then use GIT.</p>



<a name="206760906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20with%20target%20%3D%20Bundle/near/206760906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20with.20target.20.3D.20Bundle.html#206760906">(Aug 12 2020 at 22:37)</a>:</h4>
<p>So I've done a simulation here that forwards a message based on  this discussion and guidance from US Core.  Thanks for the feedback:</p>
<p><a href="http://ehaas.pythonanywhere.com/">http://ehaas.pythonanywhere.com/</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
