---
layout: page
title: "FHIR Chat  · FHIR Mapping Language - FHIRPath expressions for source? · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.20-.20FHIRPath.20expressions.20for.20source.3F.html">FHIR Mapping Language - FHIRPath expressions for source?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="155293387"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language%20-%20FHIRPath%20expressions%20for%20source%3F/near/155293387" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.20-.20FHIRPath.20expressions.20for.20source.3F.html#155293387">(Jan 16 2019 at 22:18)</a>:</h4>
<p>During the FHIR SDC Connectathon track I tried to extract information from a QuestionnaireResponses to a Patient. QuestonnaireResponse has the answerValues in different (potential) nested items which can be referenced by linkId as one approach. </p>
<p>To create one HumanName datatype with family and given of the patient I constructed a rule that two source variables are created and the target is the HumanName (otherwise I get two HumanName elements):</p>
<div class="codehilite"><pre><span></span>group item(source src, target tgt: Patient) {
  src.item as itemFirstName where linkId.value in (&#39;patient.firstname&#39;),
  src.item as itemLastName where linkId.value in (&#39;patient.lastname&#39;) -&gt; tgt.name = create(&#39;HumanName&#39;) as hn then setName(itemFirstName, itemLastName, hn) &quot;Setting Names&quot;;
}
</pre></div>


<p>To execute the rules I grouped over the items</p>
<div class="codehilite"><pre><span></span>group QuestionnaireResponse(source src : QuestionnaireResponse, target tgt : Patient) {
  src.item as item -&gt; tgt as patient then item(item, patient);
}
</pre></div>


<p>However this approach works only when all items are on the same level, if the answers are in different nested item levels this does not work. The only solution I came up with is to introduce a FHIRPath rule on the source element like this (not specified in the <a href="https://www.hl7.org/fhir/mapping-language.html" target="_blank" title="https://www.hl7.org/fhir/mapping-language.html">FHIR Mapping language</a>):</p>
<div class="codehilite"><pre><span></span>group QuestionnaireResponse(source src : QuestionnaireResponse, target tgt : Patient) {
  (src.descendants().select(item.where(linkId.value in (&#39;patient.firstname&#39;)))) as itemFirstName,
  (src.descendants().select(item.where(linkId.value in (&#39;patient.lastname&#39;)))) as itemLastName -&gt; tgt.name = create(&#39;HumanName&#39;) as hn then setName(itemFirstName, itemLastName, hn) &quot;Setting Names&quot;;
}
</pre></div>


<ul>
<li>is there a more elegant approach to map nested QuestionaireResponse items to FHIR resources?</li>
<li>would introducing of a FHIRPath expression in the FHIR Mapping language conflict with the general FHIR Mapping language approach?</li>
</ul>
<p>any feedback, samples more than welcome, will show up at 6pm ...<br>
<a href="/user_uploads/10155/W9sByRm5hONXNFyT3duW8bOs/qr2pat9.map" target="_blank" title="qr2pat9.map">qr2pat9.map</a> <a href="/user_uploads/10155/H34qkkduIgocuvKGZFvUIi1B/qr.json" target="_blank" title="qr.json">qr.json</a></p>



<a name="155294803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language%20-%20FHIRPath%20expressions%20for%20source%3F/near/155294803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.20-.20FHIRPath.20expressions.20for.20source.3F.html#155294803">(Jan 16 2019 at 22:39)</a>:</h4>
<p>this is what we'll discuss at 6pm tonight</p>



<a name="155300139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language%20-%20FHIRPath%20expressions%20for%20source%3F/near/155300139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.20-.20FHIRPath.20expressions.20for.20source.3F.html#155300139">(Jan 17 2019 at 00:19)</a>:</h4>
<p>here is what I think the map is:</p>



<a name="155300142"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20Mapping%20Language%20-%20FHIRPath%20expressions%20for%20source%3F/near/155300142" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20Mapping.20Language.20-.20FHIRPath.20expressions.20for.20source.3F.html#155300142">(Jan 17 2019 at 00:19)</a>:</h4>
<div class="codehilite"><pre><span></span>map &quot;http://ahdis.ch/fhir/mappingtutorial/qr2pat9&quot; = &quot;mapping tutorial questionnairetopat&quot;

uses &quot;http://hl7.org/fhir/StructureDefinition/QuestionnaireResponse&quot; alias QuestionnaireResponse as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Patient&quot; alias Patient as target

group entry(source src : QuestionnaireResponse, target tgt : Patient) {
  src.item as i then qri1(i, tgt);
}

group gri1(source src, target tgt) {
  src.item as i then qrgg1(i, tgt);
  src.item as ln where item.linkId = &#39;patient.lastname&#39; -&gt; tgt.name as t share then familyName(ln, t);
  src.item as ln where item.linkId = &#39;patient.firstname&#39; -&gt; tgt.name as t share then firstName(ln, t);
}

group familyName(source src, target tgt) {
  src.answer as a familyName2(a, tgt);
}

group familyName2(source src, target tgt) {
  src.valueString -&gt; tgt.family;
}

group firstName(source src, target tgt) {
  src.answer as a then firstName2(a, tgt);
}

group firstName2(source src, target tgt) {
  src.valueString -&gt; tgt.given;
}
</pre></div>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
