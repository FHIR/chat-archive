---
layout: page
title: "FHIR Chat  · why does this $validate fail? · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html">why does this $validate fail?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="197167786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197167786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197167786">(May 11 2020 at 16:06)</a>:</h4>
<p>Hi,<br>
I've been trying to find out why I'm getting a validation error when validating the following resource:</p>
<div class="codehilite"><pre><span></span><code>curl -X POST \
  &#39;http://hapi.fhir.org/baseDstu3/Patient/$validate&#39; \
  -H &#39;Cache-Control: no-cache&#39; \
  -H &#39;Content-Type: application/json&#39; \
  -d &#39;{
    &quot;resourceType&quot;: &quot;Patient&quot;,
    &quot;meta&quot;: {
        &quot;profile&quot;: [
            &quot;http://fhir.nl/fhir/StructureDefinition/nl-core-patient&quot;
        ]
    },
    &quot;address&quot;: [
        {
            &quot;_use&quot;: {
                &quot;extension&quot;: [
                    {
                        &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/iso21090-AD-use&quot;,
                        &quot;valueCode&quot;: &quot;PHYS&quot;
                    }
                ]
            }
        }
    ]
}&#39;
</code></pre></div>


<p>It produces the error:</p>
<div class="codehilite"><pre><span></span><code>{
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;The extension http://hl7.org/fhir/StructureDefinition/iso21090-AD-use is not allowed to be used at this point (allowed = e:Address; this element is [[Patient.address.use, Address.use, code])&quot;,
            &quot;location&quot;: [
                &quot;Patient.address[0].use&quot;,
                &quot;Line 11, Col 31&quot;
            ]
}
</code></pre></div>


<p>The profile that is used can be found here: <a href="https://simplifier.net/NictizSTU3-Zib2017/nl-core-patient/~overview">https://simplifier.net/NictizSTU3-Zib2017/nl-core-patient/~overview</a><br>
As far as I can tell, the extension should be applied to <strong>address.use</strong>. What am I missing here?</p>



<a name="197186803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197186803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197186803">(May 11 2020 at 18:39)</a>:</h4>
<p>Looking at the source for that extension: <a href="http://hl7.org/fhir/extension-iso21090-ad-use.json.html">http://hl7.org/fhir/extension-iso21090-ad-use.json.html</a></p>
<p>It looks like the context is just <code>"address"</code>, not <code>"address.use"</code>. So presumably you need to move it up one level.</p>



<a name="197209019"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197209019" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197209019">(May 11 2020 at 21:50)</a>:</h4>
<ul>
<li>Plus 5 bonus points for providing a short, complete, executable example with your question, and for stating your expectations vs observed behavior :)</li>
</ul>



<a name="197237633"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197237633" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197237633">(May 12 2020 at 06:27)</a>:</h4>
<p>Thanks guys! I'll try moving it to the address element instead. <br>
Does this mean that they documented it wrongly at <a href="https://simplifier.net/NictizSTU3-Zib2017/nl-core-address">https://simplifier.net/NictizSTU3-Zib2017/nl-core-address</a> ? When you look at the field list there, the extension is shown within the extensions of the "use" field.</p>



<a name="197240419"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197240419" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197240419">(May 12 2020 at 07:18)</a>:</h4>
<p>I'm not sure why this is so confusing to me, but i'm running into a similar issue while trying to validate an extension on address.country:</p>
<div class="codehilite"><pre><span></span><code>curl -X POST \
  &#39;http://hapi.fhir.org/baseDstu3/Patient/$validate&#39; \
  -H &#39;Cache-Control: no-cache&#39; \
  -H &#39;Content-Type: application/json&#39; \
  -d &#39;{
    &quot;resourceType&quot;: &quot;Patient&quot;,
    &quot;meta&quot;: {
        &quot;profile&quot;: [
            &quot;http://fhir.nl/fhir/StructureDefinition/nl-core-patient&quot;
        ]
    },
    &quot;address&quot;: [
        {
            &quot;_country&quot;: {
                &quot;extension&quot;: [
                    {
                        &quot;url&quot;: &quot;http://nictiz.nl/fhir/StructureDefinition/code-specification&quot;,
                        &quot;valueCodeableConcept&quot;: {
                            &quot;coding&quot;: [
                                {
                                    &quot;code&quot;: &quot;NL&quot;,
                                    &quot;system&quot;: &quot;urn:iso:std:iso:3166&quot;
                                }
                            ]
                        }
                    }
                ]
            }
        }
    ]
}&#39;
</code></pre></div>


<p>this produces the errors:</p>
<div class="codehilite"><pre><span></span><code> &quot;issue&quot;: [
        {
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;The extension http://nictiz.nl/fhir/StructureDefinition/code-specification is not allowed to be used at this point (allowed = e:CodeableConcept, e:code, e:Coding; this element is [[Patient.address.country, Address.country, string])&quot;,
            &quot;location&quot;: [
                &quot;Patient.address[0].country&quot;,
                &quot;Line 12, Col 31&quot;
            ]
        },
        {
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;Profile http://fhir.nl/fhir/StructureDefinition/nl-core-address, Element matches more than one slice - LandGBACodelijst, LandISOCodelijst&quot;,
            &quot;location&quot;: [
                &quot;Patient.address[0].country.extension[0]&quot;,
                &quot;Line 13, Col 22&quot;
            ]
        },
        {
            &quot;severity&quot;: &quot;warning&quot;,
            &quot;code&quot;: &quot;processing&quot;,
            &quot;diagnostics&quot;: &quot;None of the codes provided are in the value set http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.20.5.1--20171231000000 (http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.20.5.1--20171231000000, and a code should come from this value set unless it has no suitable code) (codes = urn:iso:std:iso:3166#NL)&quot;,
            &quot;location&quot;: [
                &quot;Patient.address[0].country.extension[0].value.ofType(CodeableConcept)&quot;,
                &quot;Line 16, Col 40&quot;
            ]
        }
    ]
</code></pre></div>


<p>The profile used is this: <a href="https://simplifier.net/NictizSTU3-Zib2017/nl-core-patient/~overview">https://simplifier.net/NictizSTU3-Zib2017/nl-core-patient/~overview</a></p>
<p>I looked at the context of the extension (<a href="https://simplifier.net/NictizSTU3-Zib2017/Zibextensioncodespecification/~json">https://simplifier.net/NictizSTU3-Zib2017/Zibextensioncodespecification/~json</a>) and one of the options is "Address.country", which I think I am using, so I don't expect to get the first error.</p>
<p>The second error seems to be about country having 2 extensions with the same URL in the profile. What should I do to distinguish which one I am using?</p>



<a name="197269538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197269538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197269538">(May 12 2020 at 12:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span>  any idea?</p>



<a name="197270675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197270675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197270675">(May 12 2020 at 12:56)</a>:</h4>
<blockquote>
<p>Does this mean that they documented it wrongly</p>
</blockquote>
<p>looks like it to me, yes</p>



<a name="197270755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197270755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197270755">(May 12 2020 at 12:57)</a>:</h4>
<blockquote>
<p>The extension <a href="http://nictiz.nl/fhir/StructureDefinition/code-specification">http://nictiz.nl/fhir/StructureDefinition/code-specification</a> is not allowed to be used at this point (allowed = e:CodeableConcept, e:code, e:Coding; this element is [[Patient.address.country, Address.country, string])</p>
</blockquote>
<p>looks like a bug to me.</p>



<a name="197272813"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197272813" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197272813">(May 12 2020 at 13:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> you mean a bug in how that HAPI server handles the validation?</p>



<a name="197272957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197272957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197272957">(May 12 2020 at 13:13)</a>:</h4>
<p>a bug in the validator, yes. I've added a test case taken from your post to the validator test cases ,but I can't run the test cases right now. Working on it</p>



<a name="197274125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197274125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197274125">(May 12 2020 at 13:22)</a>:</h4>
<p>ok thanks!</p>



<a name="197350736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197350736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197350736">(May 12 2020 at 22:55)</a>:</h4>
<p>ok back to this. Here's quoting from the NL profile:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension&quot;</span><span class="p">,</span>
                <span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension&quot;</span><span class="p">,</span>
                <span class="nt">&quot;slicing&quot;</span><span class="p">:{</span>
                    <span class="nt">&quot;discriminator&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;url&quot;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;value.coding.system&quot;</span>
                        <span class="p">}</span>
                    <span class="p">],</span>
                    <span class="nt">&quot;rules&quot;</span><span class="p">:</span><span class="s2">&quot;open&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="err">,</span>
</code></pre></div>


<p>ok, so the extension is sliced by url and code system.</p>
<p>then 2 slices:</p>
<div class="codehilite"><pre><span></span><code>            <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension:LandGBACodelijst&quot;</span><span class="p">,</span>
                <span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension&quot;</span><span class="p">,</span>
                <span class="nt">&quot;sliceName&quot;</span><span class="p">:</span><span class="s2">&quot;LandGBACodelijst&quot;</span><span class="p">,</span>
                <span class="nt">&quot;short&quot;</span><span class="p">:</span><span class="s2">&quot;LandGBACode&quot;</span><span class="p">,</span>
                <span class="nt">&quot;max&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;profile&quot;</span><span class="p">:</span><span class="s2">&quot;http://nictiz.nl/fhir/StructureDefinition/code-specification&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span><span class="err">,</span>
            <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension:LandGBACodelijst.valueCodeableConcept:valueCodeableConcept&quot;</span><span class="p">,</span>
                <span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension.valueCodeableConcept&quot;</span><span class="p">,</span>
                <span class="nt">&quot;sliceName&quot;</span><span class="p">:</span><span class="s2">&quot;valueCodeableConcept&quot;</span><span class="p">,</span>
                <span class="nt">&quot;binding&quot;</span><span class="p">:{</span>
                    <span class="nt">&quot;strength&quot;</span><span class="p">:</span><span class="s2">&quot;extensible&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;LandGBACodelijst&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;valueSetReference&quot;</span><span class="p">:{</span>
                        <span class="nt">&quot;reference&quot;</span><span class="p">:</span><span class="s2">&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.20.5.1--20171231000000&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;display&quot;</span><span class="p">:</span><span class="s2">&quot;LandGBACodelijst&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="err">,</span>
            <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension:LandISOCodelijst&quot;</span><span class="p">,</span>
                <span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension&quot;</span><span class="p">,</span>
                <span class="nt">&quot;sliceName&quot;</span><span class="p">:</span><span class="s2">&quot;LandISOCodelijst&quot;</span><span class="p">,</span>
                <span class="nt">&quot;short&quot;</span><span class="p">:</span><span class="s2">&quot;LandISOCode&quot;</span><span class="p">,</span>
                <span class="nt">&quot;max&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;profile&quot;</span><span class="p">:</span><span class="s2">&quot;http://nictiz.nl/fhir/StructureDefinition/code-specification&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span><span class="err">,</span>
            <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension:LandISOCodelijst.valueCodeableConcept:valueCodeableConcept&quot;</span><span class="p">,</span>
                <span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;Address.country.extension.valueCodeableConcept&quot;</span><span class="p">,</span>
                <span class="nt">&quot;sliceName&quot;</span><span class="p">:</span><span class="s2">&quot;valueCodeableConcept&quot;</span><span class="p">,</span>
                <span class="nt">&quot;binding&quot;</span><span class="p">:{</span>
                    <span class="nt">&quot;strength&quot;</span><span class="p">:</span><span class="s2">&quot;extensible&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;LandISOCodelijst&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;valueSetReference&quot;</span><span class="p">:{</span>
                        <span class="nt">&quot;reference&quot;</span><span class="p">:</span><span class="s2">&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.20.5.2--20171231000000&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;display&quot;</span><span class="p">:</span><span class="s2">&quot;LandISOCodelijst&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
</code></pre></div>



<a name="197350811"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197350811" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197350811">(May 12 2020 at 22:56)</a>:</h4>
<p>The validator doesn't know what to do with this - no value is provided for the identified fixed value element <code>value.coding.system</code>, so it can't differentiate the extension between the 2 slices.</p>



<a name="197350824"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197350824" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197350824">(May 12 2020 at 22:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span> fyi</p>



<a name="197370515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197370515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197370515">(May 13 2020 at 05:32)</a>:</h4>
<p>Job reached out yesterday directly too. Didn’t know this was on zulip as well. <span class="user-mention" data-user-id="192301">@Ardon Toonstra</span> created a ticket and we will fix the country extension slicing. We are bitten by lots of places where we needed slicing by valueset over the years and found a wrong way how to. This is one of first we ever made in HL7 NL</p>



<a name="197378661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197378661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197378661">(May 13 2020 at 07:55)</a>:</h4>
<p><span class="user-mention" data-user-id="294094">@Job Schipper</span> just in case you want to test the proposed update to the profile: <a href="https://bits.nictiz.nl/browse/MM-1155">https://bits.nictiz.nl/browse/MM-1155</a></p>
<p>I've attached the update profile-to-be. FHIR IG Publisher Version 1.0.94-SNAPSHOT validates using this updated profile.</p>



<a name="197378962"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197378962" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197378962">(May 13 2020 at 07:59)</a>:</h4>
<p>At this point it is not certain yet if it makes the May 2020 updates. Deadline officially already passed. In that case it will make the next update (September/October latest)</p>



<a name="197381987"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197381987" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197381987">(May 13 2020 at 08:32)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I've been testing this a bit further. Seems we don't need the explicit patternCodeableConcept. Just the pattern slice definition will do. <br>
However I'm getting unexpected feedback in qa when the extension/@url matches but the value.coding.system does not. Because of of the pattern I would have expected something on having 'element does not match any known slice', but instead I get 'code system uri is unknown'. Is my expectation wrong or does the validator need an update here?</p>
<div class="codehilite"><pre><span></span><code><span class="c">&lt;!-- definition --&gt;</span>
<span class="nt">&lt;element</span> <span class="na">id=</span><span class="s">&quot;Address.country.extension&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;Address.country.extension&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;slicing&gt;</span>
    <span class="nt">&lt;discriminator&gt;</span>
      <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;value&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;url&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/discriminator&gt;</span>
    <span class="nt">&lt;discriminator&gt;</span>
      <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">&quot;pattern&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;path</span> <span class="na">value=</span><span class="s">&quot;$this.value&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/discriminator&gt;</span>
    <span class="nt">&lt;rules</span> <span class="na">value=</span><span class="s">&quot;open&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/slicing&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="c">&lt;!-- Undefined extension slice, the url matches, but the system does</span>
<span class="c">not match any defined value set --&gt;</span>
<span class="nt">&lt;extension</span> <span class="na">url=</span><span class="s">&quot;http://nictiz.nl/fhir/StructureDefinition/code-specification&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;valueCodeableConcept&gt;</span>
    <span class="nt">&lt;coding&gt;</span>
      <span class="nt">&lt;system</span> <span class="na">value=</span><span class="s">&quot;urn:oid:2.16.840.1.113883.2.4.4.16.35&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">&quot;6030&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;display</span> <span class="na">value=</span><span class="s">&quot;Nederland&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/coding&gt;</span>
  <span class="nt">&lt;/valueCodeableConcept&gt;</span>
<span class="nt">&lt;/extension&gt;</span>
</code></pre></div>



<a name="197382389"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197382389" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197382389">(May 13 2020 at 08:37)</a>:</h4>
<p>is the code system actually known? That would be entirely separate to the slicing</p>



<a name="197383571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197383571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197383571">(May 13 2020 at 08:51)</a>:</h4>
<p>The code system as stated in the instance is unknown to the IG Publisher. My intention was to test slice recognition, but indeed flagging if a detected code system exists is a secondary issue</p>



<a name="197383598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197383598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197383598">(May 13 2020 at 08:51)</a>:</h4>
<p>so then I'm not sure what the issue is</p>



<a name="197383727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197383727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197383727">(May 13 2020 at 08:53)</a>:</h4>
<ul>
<li>The instance contains a fragment that does not match any of the defined slices -- this is not flagged in qa. I'm thinking it should have been</li>
<li>The code system urn:oid:2.16.840.1.113883.2.4.4.16.35 is unknown -- this is flagged in qa</li>
</ul>



<a name="197383954"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197383954" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197383954">(May 13 2020 at 08:55)</a>:</h4>
<p>If I add an extension with a different url, it is flagged as unmatched slice. This fragment matches url, but not code system. It should still produce an 'unmatched' error in my mind</p>



<a name="197383999"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197383999" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197383999">(May 13 2020 at 08:55)</a>:</h4>
<p>well, I'll have to debug - can you send me a whole example + profile?</p>



<a name="197384071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197384071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197384071">(May 13 2020 at 08:56)</a>:</h4>
<p>Sure... will take me a few moments... I'll DM you the zip</p>



<a name="197529992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197529992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197529992">(May 14 2020 at 09:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span>  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  thanks for looking into this! We will try out the profile-to-be in the meantime until the change gets released.</p>



<a name="197530409"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197530409" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197530409">(May 14 2020 at 09:44)</a>:</h4>
<p>The current profile-to-be assumes 2 code-specification extension each with its own valueset binding (ISO or GBA). Grahame made me aware that 1 code-specification extension with 1 or 2 codings would suit the situation better. The slicing required for that, currently leads to validator issues and I've asked Grahame for help to investigate. This may lead to another update in the profile-to-be. Since the expectation is that you have ISO xor GBA not both at the same time, you would not have 2 code-specification extensions anyway.</p>



<a name="197531374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197531374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197531374">(May 14 2020 at 09:54)</a>:</h4>
<p>should i keep following <a href="https://bits.nictiz.nl/browse/MM-1155">https://bits.nictiz.nl/browse/MM-1155</a> for these changes?</p>



<a name="197603445"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197603445" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197603445">(May 14 2020 at 19:08)</a>:</h4>
<p>If I need to update the profile, then yes, that ticket is updated. For now we have a profile that works, so for the short term I'm putting my money on that one.</p>



<a name="197658342"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197658342" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197658342">(May 15 2020 at 07:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span> Ok we'll have a try with that one. Talking about versioning, when i reference a Nictiz profile by it's URI, it does not seem to contain a version number (i.e. "<a href="http://fhir.nl/fhir/StructureDefinition/nl-core-patient">http://fhir.nl/fhir/StructureDefinition/nl-core-patient</a>"). Let's say  that I have some patients that were made a while ago that reference the profile nl-core-patient, and they were made back when we had version 1.3 of that profile. Now when i load the latest nl-core-patient profile on the server, all my existing patient resources now all of a sudden point to the updated version of "nl-core-patient", and because of this they probably are not valid anymore. Do you have a suggestion on how we could best handle this? Wouldn't it make sense to add a version number to the profile URI so that we can have older resources referencing the older version, and newer resources referencing the newer version?</p>



<a name="197658430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197658430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Job Schipper <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197658430">(May 15 2020 at 08:00)</a>:</h4>
<p>I could also imagine this leading to problems when I receive a Patient resource from a 3rd party, that references "nl-core-patient", but I don't know what version of "nl-core-patient" they are using</p>



<a name="197666230"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197666230" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197666230">(May 15 2020 at 09:20)</a>:</h4>
<p>There are many discussions on versions in the canonical or not. We've settled years ago for what I think still is the consensus which <em>not</em> to have the major version in the canonical. The second part is that all data is assumed to be valid against the same package. If you persist FHIR resources as-is, this requires you to map the persisted FHIR resource against the expected FHIR resource. This is in no way different from when you would have persisted in a SQL DB</p>



<a name="197866366"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197866366" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197866366">(May 17 2020 at 20:01)</a>:</h4>
<p>working further on this - you cannot use extensible bindings to differentiate slices</p>



<a name="197866825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/why%20does%20this%20%24validate%20fail%3F/near/197866825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/why.20does.20this.20.24validate.20fail.3F.html#197866825">(May 17 2020 at 20:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span> that's why the validator wasn't behaving as expected. I'll have to review the code - there should be some kind of message, but once the code systems are defined and the bindings are required, then it all works as expected</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
