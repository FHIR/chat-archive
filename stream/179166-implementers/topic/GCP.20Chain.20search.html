---
layout: page
title: "FHIR Chat  · GCP Chain search · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html">GCP Chain search</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="205473327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/205473327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#205473327">(Jul 30 2020 at 12:44)</a>:</h4>
<p>Hello,<br>
I wanna search Encounter base on Patient Birthdate with GCP healthcare api.<br>
Query be like: <code>&lt;Base Path&gt;Encounter?patient.active=false&amp;patient.birthdate=2020-01-01</code><br>
Expect: 6 data in response<br>
Actual: </p>
<div class="codehilite"><pre><span></span><code>{
  &quot;issue&quot;: [
    {
      &quot;code&quot;: &quot;no-store&quot;,
      &quot;details&quot;: {
        &quot;text&quot;: &quot;storage_error&quot;
      },
      &quot;severity&quot;: &quot;error&quot;
    }
  ],
  &quot;resourceType&quot;: &quot;OperationOutcome&quot;
}
</code></pre></div>


<p>After that, i try to remove param <code>patient.active=false</code> on search <br>
Query be like: <code>&lt;Base Path&gt;Encounter?patient.birthdate=2020-01-01</code><br>
Expect: 6 data<br>
Actual: 6 data</p>



<a name="205489397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/205489397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#205489397">(Jul 30 2020 at 14:59)</a>:</h4>
<p>With what server?  The OperationOutcome is certainly a little light on detail...</p>



<a name="205506029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/205506029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#205506029">(Jul 30 2020 at 17:16)</a>:</h4>
<p>(GCP = Google Cloud Platform)</p>
<p>I'm unable to reproduce this error, the same chained query works for me. The generic storage_error usually indicates an internal error in the storage layer so there are a variety of possible causes. I'll have to investigate further - I would expect this query to succeed.</p>



<a name="205545240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/205545240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#205545240">(Jul 30 2020 at 23:45)</a>:</h4>
<p>Seem like the error relate to relationship.<br>
I try with another birthdate which return only 1, 2 result and the query work like a charm.</p>



<a name="205545459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/205545459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#205545459">(Jul 30 2020 at 23:49)</a>:</h4>
<p>For example:</p>
<p>Query be like: <code>&lt;Base Path&gt;Encounter?patient.active=false&amp;patient.birthdate=2020-02-01</code><br>
Expect: 2 data as response<br>
Actual: 2 data</p>
<p>I was try search PractitionerRole base on  <a href="http://Practitioner.name">Practitioner.name</a> and <a href="http://Organization.name">Organization.name</a>. If response result is bigger than 7. Same error will return</p>



<a name="205620992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/205620992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#205620992">(Jul 31 2020 at 17:55)</a>:</h4>
<p>Thanks for the detailed report. I have identified a bug triggered by having two chained search clauses in a query, where both clauses are chaining on the same search parameter (patient, in this case). I'm working on a fix.</p>



<a name="205670401"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/205670401" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#205670401">(Aug 01 2020 at 07:56)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> <br>
Thank you so much,<br>
I have one more problem with chain search in here<br>
I try to write a query to get all Encounter where have <code>participant:PractitionerRole._id= {Id1}</code><br>
Query will like:<br>
<code> Encounter?participant:PractitionerRole._id=001</code><br>
Data base will like:</p>
<p>Encounter 1: include <code>PractitionerRole id = 001</code><br>
Encounter 2: include <code>PractitionerId = 001</code></p>
<p>Expect: GCP return Encounter 1</p>
<p>Actual: GCP return both Encounter 1 &amp; 2</p>
<p>I was try to add header "Prefer: handling=strict " and no error with query above.<br>
Seem like server ignore ResourceType in <code>participant:PractitionerRole._id</code> and only care about <code>participant._id</code>. So, result is incorrect</p>



<a name="205923480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/205923480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#205923480">(Aug 04 2020 at 15:42)</a>:</h4>
<p>I'll take a look at that as well. There is a known issue where a resource with references to A/001 and B/002 will incorrectly match searches for A/002 or B/001 but your example might not be the same case. We do check the type on a typed chain query so if the IDs are unique I expect it to work.</p>



<a name="206977037"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/206977037" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#206977037">(Aug 14 2020 at 20:18)</a>:</h4>
<p><span class="user-mention" data-user-id="279912">@Hue Nguyen</span> I tested this out and confirmed that it is the known issue that I thought it was.</p>
<p>You will only encounter this issue in the case where the Encounter contains multiple participant references, one of which is Practitioner/001 and another is PractitionerRole/&lt;any ID&gt;. This resource will incorrectly match PractitionerRole/001. In general, typed chained search is filtered by resource type. The issue is specific to references that have multiple values of different resource types.</p>
<p>We recommend keeping resource IDs unique where possible as the easiest workaround.</p>



<a name="207150619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/207150619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#207150619">(Aug 17 2020 at 14:30)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> Sorry for late response.<br>
Thank you for your supporting</p>



<a name="208516038"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/208516038" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#208516038">(Aug 31 2020 at 02:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197072">Paul Church</span> <a href="#narrow/stream/179166-implementers/topic/GCP.20Chain.20search/near/205620992">said</a>:</p>
<blockquote>
<p>Thanks for the detailed report. I have identified a bug triggered by having two chained search clauses in a query, where both clauses are chaining on the same search parameter (patient, in this case). I'm working on a fix.</p>
</blockquote>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> How's this going?<br>
Do you know when will it done <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="208609958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/208609958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#208609958">(Aug 31 2020 at 20:17)</a>:</h4>
<p><span class="user-mention" data-user-id="279912">@Hue Nguyen</span> The fix is rolled out to some regions already, it should be live in all regions in about 2 more days.</p>



<a name="208626742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20Chain%20search/near/208626742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20Chain.20search.html#208626742">(Aug 31 2020 at 23:07)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> I see, thank you so much</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
