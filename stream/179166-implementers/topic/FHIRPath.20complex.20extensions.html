---
layout: page
title: "FHIR Chat  · FHIRPath complex extensions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html">FHIRPath complex extensions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="243374362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243374362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243374362">(Jun 21 2021 at 12:26)</a>:</h4>
<p>Should FHIRPath work on complex extensions?</p>
<p>Have this extension <a href="https://simplifier.net/ukdigitalmedicine/extension-dm-controlleddrug">https://simplifier.net/ukdigitalmedicine/extension-dm-controlleddrug</a> used by MedicationRequest.<br>
believe the expression would be in the profile not the extension.</p>
<p>What I want to say is:<br>
is schedule is A or B then controlledDrugs words must not be null.</p>
<p>Something like this </p>
<p>((extension.where(url = 'https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug')).extension.where(url='quantityWords').exists())</p>
<p>This bit works but not having much luck checking for codes.</p>



<a name="243378530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243378530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243378530">(Jun 21 2021 at 13:05)</a>:</h4>
<p>checking for codes?</p>



<a name="243383140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243383140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243383140">(Jun 21 2021 at 13:39)</a>:</h4>
<p>Yes something like <br>
((extension.where(url = 'https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug')).extension.where(url='schedule').<strong>valueCoding.code='CD2')</strong></p>



<a name="243384481"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243384481" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243384481">(Jun 21 2021 at 13:49)</a>:</h4>
<p>don't you need a where at the end? What are you trying to achieve?</p>



<a name="243389516"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243389516" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243389516">(Jun 21 2021 at 14:23)</a>:</h4>
<p>To check the code is equal to CD2 &lt;- not working<br>
and then check another extension is present &lt;- works</p>
<p>Have tried a few combinations with where at the end but they always come back as true (in fhirpath tester)</p>



<a name="243389926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243389926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243389926">(Jun 21 2021 at 14:26)</a>:</h4>
<p>E.g. this always comes back as true </p>
<p>((extension.where(url = 'https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug')).extension.where(url='schedule')).valueCoding.where(code='CD2')</p>



<a name="243390136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243390136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243390136">(Jun 21 2021 at 14:27)</a>:</h4>
<div class="codehilite" data-code-language="XML"><pre><span></span><code>  <span class="nt">&lt;extension</span> <span class="na">url=</span><span class="s">"https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;extension</span> <span class="na">url=</span><span class="s">"schedule"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;valueCoding&gt;</span>
        <span class="nt">&lt;system</span> <span class="na">value=</span><span class="s">"https://fhir.nhs.uk/CodeSystem/medicationrequest-controlled-drug"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;code</span> <span class="na">value=</span><span class="s">"CD2 not true"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;display</span> <span class="na">value=</span><span class="s">"Schedule 2"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/valueCoding&gt;</span>
    <span class="nt">&lt;/extension&gt;</span>
  <span class="nt">&lt;/extension&gt;</span>
</code></pre></div>



<a name="243450503"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243450503" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243450503">(Jun 21 2021 at 22:18)</a>:</h4>
<p>Shouldn't that be <code>value.code</code>, not <code>valueCoding.code</code></p>



<a name="243481545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243481545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243481545">(Jun 22 2021 at 07:41)</a>:</h4>
<p>Ah ha..... all is now clear. Many thanks</p>



<a name="243488831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243488831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243488831">(Jun 22 2021 at 09:02)</a>:</h4>
<p>Validated fine also.... noticed a difference in behavior between fhirpath tester and FHIR Validation<br>
fhirPath evaluates <br>
expr1 or or expr2<br>
but for fhir validation (hapi)  this needs to be changed to <br>
(expr1 or or expr2)<br>
opening and closing brackets.</p>



<a name="243496510"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243496510" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243496510">(Jun 22 2021 at 10:24)</a>:</h4>
<p>that doesn't make sense</p>



<a name="243497616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243497616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243497616">(Jun 22 2021 at 10:38)</a>:</h4>
<p>which one my comment or fhirtester?</p>



<a name="243497638"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243497638" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243497638">(Jun 22 2021 at 10:38)</a>:</h4>
<p>that you need the brackets</p>



<a name="243497706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243497706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243497706">(Jun 22 2021 at 10:39)</a>:</h4>
<p>ah ok</p>



<a name="243610627"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243610627" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243610627">(Jun 23 2021 at 06:14)</a>:</h4>
<p>Also note that there is a shortcut syntax for extensions so </p>
<div class="codehilite"><pre><span></span><code>extension.where(url=&#39;schedule&#39;)
</code></pre></div>
<p>can be written as </p>
<div class="codehilite"><pre><span></span><code>extension(&#39;schedule&#39;)
</code></pre></div>



<a name="243772792"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243772792" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243772792">(Jun 24 2021 at 11:47)</a>:</h4>
<p>Does hapi use same fhirpath library. I seem to be having problems on extensions.</p>



<a name="243773559"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243773559" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243773559">(Jun 24 2021 at 11:55)</a>:</h4>
<p>same as what?</p>



<a name="243774096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243774096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243774096">(Jun 24 2021 at 12:00)</a>:</h4>
<p>Same as the one used in FHIRPath Tester.</p>
<p>Presuming its different as extensions test ok in but fail in HAPI</p>



<a name="243774329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243774329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243774329">(Jun 24 2021 at 12:02)</a>:</h4>
<p>I don't know what the FHIR Path tester is, but the HAPI one is the one used in the validator. What expression doesn't work? Add it to the FHIRPath test cases at <a href="https://github.com/FHIR/fhir-test-cases/blob/master/r5/fhirpath/tests-fhir-r5.xml">https://github.com/FHIR/fhir-test-cases/blob/master/r5/fhirpath/tests-fhir-r5.xml</a></p>



<a name="243775551"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243775551" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243775551">(Jun 24 2021 at 12:12)</a>:</h4>
<p>argh! Spotted an error - deleted</p>



<a name="243817819"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243817819" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243817819">(Jun 24 2021 at 17:17)</a>:</h4>
<p>Many thanks. <br>
The test scripts were very useful. <br>
Problem was with the FHIRPathTester behaving differently to hapi. </p>
<p>if an extension dosen't exist FHIRTester would true  for this expression</p>
<p>(extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').value.reference.exists() or extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').value.system.exists())</p>
<p>hapi would return false. Solution was to add check for existence</p>
<p>or extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').exists().not() </p>
<p>hapi version seems to make more sense.</p>



<a name="243867252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243867252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243867252">(Jun 25 2021 at 01:43)</a>:</h4>
<p>As an extract, or as a validate? FhirPathTester does both ways.</p>



<a name="243867311"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243867311" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243867311">(Jun 25 2021 at 01:44)</a>:</h4>
<p>I put that expression into fptester here and it returns false - interesting.</p>



<a name="243872743"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243872743" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243872743">(Jun 25 2021 at 03:43)</a>:</h4>
<p>Is the latest version on windows store? It was a couple of years old.</p>



<a name="243872898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243872898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243872898">(Jun 25 2021 at 03:47)</a>:</h4>
<p>Yes the one on the windows store is current.<br>
(as at 4.0.0 - don't think I updated it for 4.0.1 as yet)</p>



<a name="243872955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20complex%20extensions/near/243872955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20complex.20extensions.html#243872955">(Jun 25 2021 at 03:48)</a>:</h4>
<p>(But is on my list of things to do - need a local build of the fhir client, not the nuget ones due to an appstore limitation on reflection/emit - or at least did for the 1.4 libs)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
