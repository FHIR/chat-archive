---
layout: page
title: "FHIR Chat  · HL7 v2 formatted text · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html">HL7 v2 formatted text</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153841409"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841409" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841409">(Jul 28 2016 at 01:45)</a>:</h4>
<p>Suppose I have an HL7 v2 message with formatted text as the value. What is the best way to represent that in the value[x] element of an Observation? Markdown would seem the best option, but it isn't a supported datatype. We could use a string and put markdown in there, but the end user won't know that's markdown (unless we use an extension to indicate this of course)...</p>



<a name="153841411"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841411" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841411">(Jul 28 2016 at 01:49)</a>:</h4>
<p>Of maybe the unformatted data in the value, and formatted as markdown in the extension?</p>



<a name="153841423"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841423" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841423">(Jul 28 2016 at 02:46)</a>:</h4>
<p>Have you considered ValueAttachment?</p>



<a name="153841427"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841427" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841427">(Jul 28 2016 at 02:53)</a>:</h4>
<p>How does that value over string? Or are you thinking that the markdown/html whatever is b64 encoded with an appropriate mime type?</p>



<a name="153841430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Royce <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841430">(Jul 28 2016 at 03:03)</a>:</h4>
<p>One of the advantages of Markdown is that the bare text is very readable as is.  I'm not sure if this would be frowned upon, but you could put the Markdown text in the string and people "in the know" would decode it while others would get the bare text.  As I said, though, that might be considered bad form because of it's esoteric nature.</p>



<a name="153841431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Royce <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841431">(Jul 28 2016 at 03:05)</a>:</h4>
<p>Or are you saying no-one would be "in the know"?</p>



<a name="153841436"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841436" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Royce <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841436">(Jul 28 2016 at 03:35)</a>:</h4>
<p>In which case my suggestion is a bad idea and you <strong>SHOULD</strong> just ignore me! <img alt=":wink:" class="emoji" src="static/third/gemoji/images/emoji/wink.png" title=":wink:"> </p>



<a name="153841450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841450">(Jul 28 2016 at 07:49)</a>:</h4>
<p>That was where we started :)  I'll likely propose that markdown is a valid observation.value datatype, but - as you say - the MD is quite readable, even as plain text...</p>



<a name="153841495"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841495" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841495">(Jul 28 2016 at 16:29)</a>:</h4>
<p>after looking at section 2.7.7 in the V2 spec ver 2.8.2 re FT formatiing.  I don't see why you would need to use markdown here.  if you want to reproduce it exactly as in the V2 message it will be text.   If you want to have it all pretty and formatted at the end I'm still partial to valueAttachment so you can identify the Markup  (html, markdown flavor)  </p>



<a name="153841581"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841581" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Butler <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841581">(Jul 28 2016 at 21:48)</a>:</h4>
<p>I feel a bit queasy about base64-encoding something which is *pretty much* human-readable text. One of the reasons for suggesting Markdown is that if a client can't interpret the markup it can still show the user something useful, the remaining problem being there's no way to tell clients that Markdown is what is there. If we present it as some kind of binary then a client is more likely to reject it outright imho.</p>



<a name="153841585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153841585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeffrey Chen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153841585">(Jul 28 2016 at 22:31)</a>:</h4>
<p>I think it because HL7 v2 OBX  has multipe types of text value. So, you have to provide additional information to that. In that case, ValueAttachment is the only place to hold those information.</p>



<a name="153843914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153843914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153843914">(Aug 15 2016 at 10:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191321">@David Hay</span> What did you end up doing? I am currently facing the same issue: It mostly boils down to the question of what to do with the "\.br\" in OBX.#5. I have hardly ever seen systems using more sophisticated markup that that...</p>



<a name="153843916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153843916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153843916">(Aug 15 2016 at 10:37)</a>:</h4>
<p>oh wait. CR LF are allowed in datatype string! duh.</p>



<a name="153843965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153843965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153843965">(Aug 15 2016 at 23:06)</a>:</h4>
<p>From our notes:</p>
<p>Textual laboratory results might enter the system in an OBX message with a value of type FT (Formatted Text), an HL7v2-specific markup language. We currently expose this in FHIR as an Observation with a string value, where the string is the raw FT text complete with formatting. This isn't very useful for clients who don't know how to interpret FT formatting (which is a vague legacy standard used only in v2 messaging); and even clients which do will have trouble, because there's no standard way to indicate that a string Observation contains formatting instructions.<br>
After consulting the FHIR community, we have determined that the only way to represent formatted text is by using an attachment value, with the original FT text base64-encoded and the media type set to tell the consuming application what formatting is in the value. It's a bit clumsy to base64-encode what is essentially plain text, but it's the mechanism available, so we will use it.<br>
Our approach will be:<br>
An FT-type result from an OBX will be mapped to an Observation with an attachment value<br>
The original formatted text will be presented base64-encoded in attachment.data<br>
attachment.contentType will be set to "text/x-hl7-ft" (ref)<br>
attachment.title will be set to a string generated by a best-effort attempt at formatting the FT text, for display by clients which can't interpret FT text<br>
see this blog (<a href="http://www.healthintersections.com.au/?page_id=441" target="_blank" title="http://www.healthintersections.com.au/?page_id=441">http://www.healthintersections.com.au/?page_id=441</a> ) for some guidelines <br>
the 'h' and 'n' directives for highlighting should be ignored, and highlighted text presented as plain text</p>



<a name="153844007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153844007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153844007">(Aug 16 2016 at 07:47)</a>:</h4>
<p>My solution turned out to be the following: <br>
*Replace all FT formatting with appropriate html tags and place formatted text into Observation.text<br>
*Replace /.br/ with CR LF and remove all other formatting and place unformatted text in Observation.valueString <br>
Sidenote: the sending system only used linebreak and bold as formatting tags. But I guess for Observations with a more excessive use of formatting, your solution is better.</p>



<a name="153844008"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153844008" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153844008">(Aug 16 2016 at 07:59)</a>:</h4>
<p>does this help? <a href="http://www.healthintersections.com.au/?page_id=441" target="_blank" title="http://www.healthintersections.com.au/?page_id=441">http://www.healthintersections.com.au/?page_id=441</a></p>



<a name="153844048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153844048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Butler <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153844048">(Aug 17 2016 at 21:06)</a>:</h4>
<p>We didn't want to simply drop the Observation value into the narrative because we're not otherwise populating it right now, <a href="https://www.hl7.org/fhir/narrative.html#Narrative" target="_blank" title="https://www.hl7.org/fhir/narrative.html#Narrative">and</a>:</p>
<blockquote>
<p>If narrative is present, it SHALL reflect all content needed for a human to understand the essential clinical and business information otherwise encoded within the resource<br>
and the value doesn't have some pretty essential context, like for instance the test that is being performed. If you are already generating narrative which includes all the important extra stuff, then it makes sense to HTML-ify the value there as well.</p>
</blockquote>



<a name="153844049"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/HL7%20v2%20formatted%20text/near/153844049" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Butler <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/HL7.20v2.20formatted.20text.html#153844049">(Aug 17 2016 at 21:06)</a>:</h4>
<p>Gah formatting fail</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
