---
layout: page
title: "FHIR Chat  · Schematron issue in R4 · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html">Schematron issue in R4</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="182378298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182378298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182378298">(Dec 02 2019 at 19:08)</a>:</h4>
<p>I downloaded the <a href="http://hl7.org/fhir/R4/fhir-all-xsd.zip" target="_blank" title="http://hl7.org/fhir/R4/fhir-all-xsd.zip">R4 schemas/schematrons</a> today. I found a number of technical errors that seem to stem from fhirPath conversions. Shouldn't these be fixed? I've added the existing Jira tracker items to them for as far as I could find them.</p>
<ul>
<li><a href="https://jira.hl7.org/browse/FHIR-13187" target="_blank" title="https://jira.hl7.org/browse/FHIR-13187">dom-3</a> says <ul>
<li>&lt;sch:assert test="not(exists(for $id in f:contained/<em>/f:id/@value return <strong>$contained</strong>[not(parent::</em>/descendant::f:reference/@value=concat('#', <strong>$contained</strong>/*/id/@value) or descendant::f:reference[@value='#'])]))"&gt; but should be</li>
<li>&lt;sch:assert test="not(exists(for $id in f:contained/<em>/f:id/@value return $id[not(parent::</em>/descendant::f:reference/@value=concat('#', $id/*/id/@value) or descendant::f:reference[@value='#'])]))"&gt;</li>
</ul>
</li>
<li>ppc-2, ppc-3, ppc4, ppc-5 have one closing ) too many, e.g<ul>
<li>&lt;sch:assert test="exists(f:patient) or not(exists(f:scope/f:coding[f:system/@value='something' and f:code/@value='adr'])))"&gt;ppc-4 should be</li>
<li>&lt;sch:assert test="exists(f:patient) or not(exists(f:scope/f:coding[f:system/@value='something' and f:code/@value='adr']))"&gt;ppc-4</li>
</ul>
</li>
<li><a href="https://jira.hl7.org/browse/FHIR-25088" target="_blank" title="https://jira.hl7.org/browse/FHIR-25088">trd-3</a> says<ul>
<li>&lt;sch:assert test="((not(f:type/@value = 'named-event')) or name.exists()) and (not(f:type/@value = 'periodic') or timing.exists()) and (not(starts-with(f:type/@value, 'data-')) or data.exists())"&gt; but should be</li>
<li>&lt;sch:assert test="(not(f:type/@value = 'named-event') or exists(f:data)) and (not(f:type/@value = 'periodic') or exists(f:timing)) and (not(f:type[starts-with(@value, 'data-')]) or exists(f:data))"&gt; </li>
</ul>
</li>
<li><a href="https://jira.hl7.org/browse/FHIR-19968" target="_blank" title="https://jira.hl7.org/browse/FHIR-19968">eld-19</a> says<ul>
<li>&lt;sch:assert test="matches(path/@value, '[^\s\.,:;\'&amp;amp;quot;\/|?!@#$%&amp;amp;amp;*()\[\]{}]{1,64}(\.[^\s\.,:;\'&amp;amp;quot;\/|?!@#$%&amp;amp;amp;*()\[\]{}]{1,64}(\[x\])?(\:[^\s\.]+)?)*')"&gt; but should be</li>
<li>&lt;sch:assert test="matches(path/@value, '[^\s\.,:;''&amp;quot;\/|?!@#$%&amp;amp;*()\[\]{}]{1,64}(\.[^\s\.,:;''&amp;quot;\/|?!@#$%&amp;amp;*()\[\]{}]{1,64}(\[x\])?(\:[^\s\.]+)?)*')"&gt;</li>
</ul>
</li>
<li><a href="https://jira.hl7.org/browse/FHIR-17904" target="_blank" title="https://jira.hl7.org/browse/FHIR-17904">inv-1</a> says<ul>
<li>&lt;sch:assert test="(exists(f:resource) or exists(f:part) or exists(f:<em>[starts-with(local-name(.), 'value')])) and not(exists(f:</em>[starts-with(local-name(.), 'value')])) and exists(f:resource))) and not(exists(f:*[starts-with(local-name(.), 'value')])) and exists(f:part))) and not(exists(f:part) and exists(f:resource))"&gt; but should be</li>
<li>&lt;sch:assert test="count(f:part | f:*[starts-with(local-name(), 'value')] | f:resource) = 1"&gt;</li>
</ul>
</li>
</ul>



<a name="182380571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182380571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182380571">(Dec 02 2019 at 19:32)</a>:</h4>
<p>This raises several issues for me:</p>
<ul>
<li>Why only now are issues like this being raised? What is the minimum testing approach we should have?</li>
</ul>
<p>hmm. I was going to say that they are tested during the build, but that bit is currently turned off</p>
<ul>
<li>I really really don't want to do another technical correction. The last one took about 8 weeks of work to do - another one would be smaller, but I don't know how much smaller. We're still dealing with the last one. is there an alternative way to deal with this than another technical correction?</li>
</ul>



<a name="182381015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182381015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182381015">(Dec 02 2019 at 19:36)</a>:</h4>
<p>The schematrons seem to be present in just the zips for download? If so, could you just update that? Fixing the downloads for R4 does not fix any inherent fhirPath to xpath conversions yet though.</p>
<p>It seems most people are on the JSON train so maybe (combined with validation being switched off apparently) that's why it went unnoticed?</p>



<a name="182381171"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182381171" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182381171">(Dec 02 2019 at 19:38)</a>:</h4>
<p>The schematron errors could have been caught by any tool that can either process them directly or after conversion to xslt. I noticed by running the validate option in oXygen on the folder.</p>



<a name="182381210"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182381210" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182381210">(Dec 02 2019 at 19:39)</a>:</h4>
<p>I don't think we're allowed to just fix stuff like that. I'd have to update all the structure definitions, and the package. I guess we just make the download available beside the spec,until we have other reasons for a technical correction? Subject for FMG...</p>



<a name="182381452"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182381452" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182381452">(Dec 02 2019 at 19:41)</a>:</h4>
<p>Do the SDs have the schematron too? In any case it looks like all but the ppc things actually have approved issues that promise to fix them. I understand that fixing this comes with a cost.  I'm sorry to be the messenger. I hope that FMG can find a low impact solution.</p>



<a name="182399622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182399622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182399622">(Dec 02 2019 at 23:13)</a>:</h4>
<p>We could take the approach that HL7 often does for other specs, which is to publish an Erratum.  We could link to that from the home page of the spec and the erratum would list known errors and the corrections.  (In this case, a link to a corrected zip of schematrons.)</p>



<a name="182400825"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182400825" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182400825">(Dec 02 2019 at 23:31)</a>:</h4>
<p>that wouldn't be a technical correction?</p>



<a name="182401929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182401929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182401929">(Dec 02 2019 at 23:48)</a>:</h4>
<p>Adding a pointer to an erratum?  I don't think so.  Can check with Austin or <span class="user-mention" data-user-id="191808">@Wayne Kubick</span></p>



<a name="182464965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182464965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Wayne Kubick <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182464965">(Dec 03 2019 at 16:14)</a>:</h4>
<p>I don't believe there's any real difference between a technical correction and an erratum, the former follow the same GOM process as for errata.  If I understand Lloyd's suggestion, we could just post an announcement of discovered errors with the schematrons with a link to the corrected zip file without changing the actual core spec.  That seems like a reasonable approach to ensure that implementers are getting the correct information without modifying the spec directly.</p>



<a name="182475874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Schematron%20issue%20in%20R4/near/182475874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Schematron.20issue.20in.20R4.html#182475874">(Dec 03 2019 at 17:48)</a>:</h4>
<p>Could we make a change to the home page that points to the erratum location?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
