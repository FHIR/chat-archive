---
layout: page
title: "FHIR Chat  · Compartment search behaviour · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html">Compartment search behaviour</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="189100245"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189100245" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonny Rylands <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189100245">(Feb 26 2020 at 10:05)</a>:</h4>
<div class="codehilite"><pre><span></span>GET [base]/Patient/333/Condition
GET [base]/Condition?patient=333
</pre></div>


<p>Where patient 333 is not found on the FHIR server, the two requests above will return an empty bundle, as per  <a href="https://www.hl7.org/fhir/compartmentdefinition.html#use" target="_blank" title="https://www.hl7.org/fhir/compartmentdefinition.html#use">https://www.hl7.org/fhir/compartmentdefinition.html#use</a>.</p>
<p>I have two questions regarding this:</p>
<p>1.The first request's behaviour (the compartment based search) seems unintuitive since requesting a root of the compartment based search URL would return a 404 if patient 333 was not found.</p>
<p>I.e. "intuitively" i would expect these two requests to behave in the same way if patient 333 was not found:</p>
<div class="codehilite"><pre><span></span>GET [base]/Patient/333
GET [base]/Patient/333/Condition
</pre></div>


<p>Is there something I'm missing as to why the compartment based search returns an empty bundle when the patient is not found?</p>
<ol start="2">
<li>The specification goes on to say:</li>
</ol>
<blockquote>
<p>Some systems will include an operation outcome warning that there is no matching patient.</p>
</blockquote>
<p>Does this mean an OperationOutcome  resource return within the (empty) Bundle response?</p>



<a name="189108964"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189108964" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189108964">(Feb 26 2020 at 12:20)</a>:</h4>
<p>You cannot expect the same service is hosting both Patient and Condition</p>



<a name="189109013"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189109013" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189109013">(Feb 26 2020 at 12:21)</a>:</h4>
<p>If Condition and Patient is hosted on two different FHIR servers, you cannot traverse both resources on both servers</p>



<a name="189109138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189109138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189109138">(Feb 26 2020 at 12:22)</a>:</h4>
<p>you can however assume that (given some assumptions regarding referential integrity) that the server hosting Condition is able to find Conditions which have a reference to Patient</p>



<a name="189130393"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189130393" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189130393">(Feb 26 2020 at 16:27)</a>:</h4>
<p>Under the covers, the first URL is treated just like the second.  It's still a search, even though the URL isn't structured like one.</p>



<a name="189140012"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189140012" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189140012">(Feb 26 2020 at 18:03)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> is that required by the spec?</p>



<a name="189140114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189140114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189140114">(Feb 26 2020 at 18:04)</a>:</h4>
<p>Because im pretty sure that wont hold in a sharded microservice setup</p>



<a name="189140433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189140433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189140433">(Feb 26 2020 at 18:07)</a>:</h4>
<p>The spec is pretty clear: <code>The outcome of a compartment search is the same as the equivalent normal search. For example, both these searches return the same outcome if there is no patient 333:
  GET [base]/Patient/333/Condition
  GET [base]/Condition?patient=333</code></p>



<a name="189196337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189196337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189196337">(Feb 27 2020 at 08:58)</a>:</h4>
<p>While it may be 'semantically  equivalent', it is not 'syntactically equivalent' - a server only hosting the Patient resource would probably fail on <code>GET [base]/Patient/333/Condition</code> if it doesn't host the Condition resource - whereas a server hosting the Condition resource with stored references to patient resources would probably support <code>GET [base]/Condition?patient=333</code></p>



<a name="189201120"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189201120" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189201120">(Feb 27 2020 at 10:14)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span>  <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> FYI - in that case the HAPI implementation does not comply with compartments search.<br>
while <br>
<code>http://hapi.fhir.org/baseDstu3/Patient/2684442/Appointment</code>does not work, <br>
<code>http://hapi.fhir.org/baseDstu3/Appointment?patient=Patient/2684442</code> does work</p>



<a name="189202597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189202597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189202597">(Feb 27 2020 at 10:39)</a>:</h4>
<p>Yup, that first syntax isn't currently supported in HAPI, although it is valid FHIR.</p>



<a name="189257000"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189257000" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonny Rylands <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189257000">(Feb 27 2020 at 21:06)</a>:</h4>
<p>OK thanks all for your responses.</p>



<a name="189261702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189261702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189261702">(Feb 27 2020 at 21:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179166-implementers/topic/Compartment.20search.20behaviour/near/189140433" title="#narrow/stream/179166-implementers/topic/Compartment.20search.20behaviour/near/189140433">said</a>:</p>
<blockquote>
<p>The spec is pretty clear: <code>The outcome of a compartment search is the same as the equivalent normal search. For example, both these searches return the same outcome if there is no patient 333:
  GET [base]/Patient/333/Condition
  GET [base]/Condition?patient=333</code></p>
</blockquote>
<p>What constitutes a <code>normal search</code>? Is that defined anywhere? If not, I would avoid such term as <code>normal</code></p>



<a name="189267266"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189267266" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189267266">(Feb 27 2020 at 23:06)</a>:</h4>
<p>I just meant one not using the compartment syntax</p>



<a name="189297300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/189297300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jens Villadsen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#189297300">(Feb 28 2020 at 10:07)</a>:</h4>
<p>Still - the term <code>normal</code>is ambiguous and context dependent.</p>



<a name="215103143"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/215103143" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dag Roppe <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#215103143">(Oct 30 2020 at 14:41)</a>:</h4>
<p>Question on compartment searches.  Can I search across all resources in a defined compartment with search parameters valid for all resources?<br>
Like GET [base]/Patient/[id]?parameter(s)  Is this Valid?   I didn't see anything in the spec that would make it invalid.<br>
So a search like this might be useful:  Get [base]/Patient/[id]?_lastUpdated=ge2020-10-30 <br>
To get all patient related resources updated recently.</p>



<a name="215110582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20behaviour/near/215110582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20behaviour.html#215110582">(Oct 30 2020 at 15:33)</a>:</h4>
<p>We haven't defined that that's allowed, though we haven't prohibited it either.  If it's functionality you'd like be explicitly supported, you could submit a change request</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
