---
layout: page
title: "FHIR Chat  · Restrict References to specific Profile · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html">Restrict References to specific Profile</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="207401323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Restrict%20References%20to%20specific%20Profile/near/207401323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergej Reiser <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html#207401323">(Aug 19 2020 at 12:37)</a>:</h4>
<p>Hi all,</p>
<p>i created two custom Profiles:</p>
<ul>
<li>MyCareTeam</li>
<li>MyPatient</li>
</ul>
<p>My goal is to restrict MyCareTeam.subject, so that only resources conforming to the MyPatient profile can be referenced inside the CareTeam resource. </p>
<p>I thought i will be able to achieve it by just removing the default target Profile and add my custom one. <a href="/user_uploads/10155/4P83x1XWRD8ThHn9r3RY9l1U/forge.png">forge.png</a><br>
But testing it on a HAPI 5.1.0 Server with validation enabled, i am still able to reference Patient-Resources that don't conform to the MyPatient Profile. </p>
<p><strong>Update:</strong><br>
I uploaded my StructureDefinitions to <a href="http://hapi.fhir.org/baseR4">http://hapi.fhir.org/baseR4</a>:</p>
<ul>
<li><a href="http://www.google.com/url?q=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FStructureDefinition%2F1437751%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHd1iqqlibbiicd2XvhicUZqINDaw">MyPatient</a> : needs to have a <strong>gender</strong> (by changing cardinality to 1..1)</li>
<li><a href="http://www.google.com/url?q=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FStructureDefinition%2F1437752%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHJotvWpIa4w63QAthkeIO3B3tc4Q">MyCareTeam</a> : only allows MyPatient-References in <strong>subject</strong> (by removing the default target Profiles and adding the cannonical URL for MyPatient)</li>
</ul>
<p>Than i uploaded 2 resources of Patient and 2 resources of CareTeam:</p>
<ul>
<li><a href="http://www.google.com/url?q=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FPatient%2F1438246&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFw_KPiDkNmYzrGQC5D9qJO4iOpNA">Patient conforming to MyPatient profile</a></li>
<li><a href="http://www.google.com/url?q=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FPatient%2F1438247&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHiU041m6dvaNW5gNWPGI8EJb7WGg">Patient not conforming to MyPatient profile</a></li>
<li><a href="http://www.google.com/url?q=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FCareTeam%2F1438248&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGwka671TBF4rogDbPGZmZdR3_syw">CareTeam containing conforming Patient</a> (<a href="http://www.google.com/url?q=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FCareTeam%2F1438248%2F%24validate&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHkMpmJRH3TypmcSXGqOmWOXqrXLg">$validate</a>)</li>
<li><a href="http://www.google.com/url?q=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FCareTeam%2F1438249&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHigYdAuVRj1hL-5lKvEfCitJyAvA">CareTeam containing non conforming Patient </a>(<a href="http://www.google.com/url?q=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FCareTeam%2F1438249%2F%24validate&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEz0StxUHGvxnS4gaCAeQ__KjxOig">$validate</a>)</li>
</ul>
<p>Now when calling the <strong>$validate</strong> operation on the CareTeam resources, i would expect the first one to not contain any errors and the second one to contain one error, since the referenced Patient resource does not conform to the MyPatient profile.<br>
To my surprise both CareTeam resources don't have any errors.</p>
<p>Than i tried another approch and added the following constraint to the StructureDefinition of MyCareTeam:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;constraint&gt;</span>
    <span class="nt">&lt;key</span> <span class="na">value=</span><span class="s">&quot;req-01&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;requirements</span> <span class="na">value=</span><span class="s">&quot;Subject is not conforming&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;severity</span> <span class="na">value=</span><span class="s">&quot;warning&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;human</span> <span class="na">value=</span><span class="s">&quot;Subject is not conforming&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;expression</span> <span class="na">value=</span><span class="s">&quot;subject.reference.resolve().conformsTo(&#39;http://example.org/fhir/StructureDefinition/MyPatient&#39;)&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/constraint&gt;</span>
</code></pre></div>


<p>Now i am expecting to see a warning when validating the second CareTeam resource. But both CareTeam resources contain the warning! It seems like either the resolve() or the conformsTo() method is not working with the FHIRPath expression.</p>



<a name="207522601"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Restrict%20References%20to%20specific%20Profile/near/207522601" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthijs van der Wielen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html#207522601">(Aug 20 2020 at 13:35)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="260796">@Sergej Reiser</span> ,</p>
<p>I have taken the liberty off adding your MyPatient and the two examples to a Simplifier project I created. Please have a look: <a href="https://simplifier.net/zullipchat">https://simplifier.net/zullipchat</a> . And please try the validation there as well. You will see that the validation goes as you expected. </p>
<p>I've taken a look at you examples and in the conforming example it had</p>
<ul>
<li>"profile": [ "<a href="http://example.org/fhir/StructureDefinition/MyPatient">http://example.org/fhir/StructureDefinition/MyPatient</a>" ]*</li>
</ul>
<p>in the meta data, but this was missing in the non-conforming example you created.</p>
<p>All I did was add that line to the meta in the non-conforming example and it works as intended. </p>
<p>Would this solve your issue in the HAPI setting as well?</p>
<p>Kind regards,<br>
Matthijs</p>



<a name="207526882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Restrict%20References%20to%20specific%20Profile/near/207526882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergej Reiser <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html#207526882">(Aug 20 2020 at 14:17)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="259036">@Matthijs van der Wielen</span> ,</p>
<p>thanks for your reply and effort, but that's not actually my issue. I guess my phrasing was confusing.<br>
I omitted the "profile" attribute for the non confoming Patient on purpose. I want one Patient-Resource which conforms to the MyPatient profile and onther one which doesn't. There's not an issue with that and it works just fine with HAPI.</p>
<p>But now, when i create a CareTeam-Resource, which references the non conforming Patient, i expect it to be invalid if the CareTeam-Resource is equipped with</p>
<ul>
<li>"profile": ["<a href="http://example.org/fhir/StructureDefinition/MyCareTeam">http://example.org/fhir/StructureDefinition/MyCareTeam</a>" ]</li>
</ul>
<p>So this resource should be invalid:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;CareTeam&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;1438249&quot;</span><span class="p">,</span>
  <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;profile&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;http://example.org/fhir/StructureDefinition/MyCareTeam&quot;</span> <span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">&quot;subject&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;reference&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/1438247&quot;</span><span class="p">,</span>
    <span class="nt">&quot;display&quot;</span><span class="p">:</span> <span class="s2">&quot;This patient is not conforming to the MyPatient profile&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<a name="207608532"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Restrict%20References%20to%20specific%20Profile/near/207608532" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthijs van der Wielen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html#207608532">(Aug 21 2020 at 07:59)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="260796">@Sergej Reiser</span> ,<br>
Apologies for my misunderstanding. I will take a look at your clarification.</p>



<a name="207792983"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Restrict%20References%20to%20specific%20Profile/near/207792983" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html#207792983">(Aug 23 2020 at 21:50)</a>:</h4>
<p>If you don't yet have an answer <span class="user-mention" data-user-id="260796">@Sergej Reiser</span>, I'd suggest raising this on <a class="stream" data-stream-id="179167" href="/#narrow/stream/179167-hapi">#hapi</a></p>



<a name="207826376"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Restrict%20References%20to%20specific%20Profile/near/207826376" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergej Reiser <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html#207826376">(Aug 24 2020 at 10:07)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> <br>
I dont have an answer yet, but im also not sure if my expectations are correct. Am i misinterpreting the FHIR specification for <a href="https://www.hl7.org/fhir/elementdefinition-definitions.html#ElementDefinition.type.targetProfile">targetProfile </a>somehow?</p>



<a name="207850804"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Restrict%20References%20to%20specific%20Profile/near/207850804" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html#207850804">(Aug 24 2020 at 14:37)</a>:</h4>
<p>I think your expectations are correct</p>



<a name="209505569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Restrict%20References%20to%20specific%20Profile/near/209505569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sergej Reiser <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Restrict.20References.20to.20specific.20Profile.html#209505569">(Sep 09 2020 at 12:48)</a>:</h4>
<p><strong>Update:</strong> I asked the same Question on <a href="https://groups.google.com/forum/#!topic/hapi-fhir/owvoIdbKwRo">Google Groups</a> where i  received a reply from <span class="user-mention" data-user-id="191319">@James Agnew</span> . </p>
<p>To summarize: HAPI <strong>does</strong> support validation for TargetProfiles, but it's not enabled by default and it also wasn't enabled on <a href="http://hapi.fhir.org">hapi.fhir.org</a>. James commited a configuration update to enable validation for TargetProfiles on <a href="http://hapi.fhir.org">hapi.fhir.org</a>.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
