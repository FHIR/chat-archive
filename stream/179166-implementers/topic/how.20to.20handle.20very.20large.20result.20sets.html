---
layout: page
title: "FHIR Chat  · how to handle very large result sets · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html">how to handle very large result sets</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153821716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Scholz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821716">(Apr 14 2016 at 11:25)</a>:</h4>
<p>It's a question which poped up during the current IHE Connectathon:</p>
<p>When performing a search request which results in a very large result set (this time it was AuditEvent with more than 40k results) without a  _count option, we ran out of resources or the request did take too long so that a timeout occured on client side.</p>



<a name="153821718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Scholz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821718">(Apr 14 2016 at 11:25)</a>:</h4>
<p>....<br>
is it possible to limit the size of the result set without paging mode ?</p>



<a name="153821725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821725">(Apr 14 2016 at 12:04)</a>:</h4>
<p>why wouldn't paging mode work? </p>



<a name="153821729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Scholz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821729">(Apr 14 2016 at 12:30)</a>:</h4>
<p>3 reasons:<br>
1st - client did not request paging<br>
2nd  - I do paging by producing snaphots, which means before producing a single result page I have to do the full search to populate all search pages<br>
3rd - to support correct links and bundle.total I would have to produce the complete result set (at least if I want to provide the "last" link and the result.total property)</p>



<a name="153821731"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821731" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821731">(Apr 14 2016 at 12:34)</a>:</h4>
<p>have you seen the error 'too costly'? that's the first line of defense here</p>



<a name="153821736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Scholz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821736">(Apr 14 2016 at 12:40)</a>:</h4>
<p>thanks for the hint, that looks good.</p>
<p>the other solution might be the error "incomplete", if it is allowed add the partial results in the bundle in addition to an entry of operation outcome</p>



<a name="153821802"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821802" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821802">(Apr 14 2016 at 14:41)</a>:</h4>
<p>The server is also allowed to provide its own default page size even if the client doesn't request one. I think no matter what this is a sensible thing to do.</p>



<a name="153821803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821803">(Apr 14 2016 at 14:42)</a>:</h4>
<p>IMO you should also enforce an upper limit on <code>_count</code> in the server and ignore (or reduce) client <code>_count</code> requests bigger than that in order to prevent DOS attacks</p>



<a name="153821809"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821809" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Scholz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821809">(Apr 14 2016 at 15:06)</a>:</h4>
<p>the default pagesize is quite ok, but that does only limit the amount of results on one page,<br>
As figured out earlier, the problem arises from long lasting queries, to populate all pages as I'm doing snapshots and provide links with relation="last" as well as a total property of the Bundle resource to represent the total number of results </p>
<p>So Grahame's info about an OperationOutcome resource and either the "too costly" or the "incomplete" error will be perfect for my.</p>
<p>Either I will return an error with an OperationOutcome of "too costly" or what I prefer return a Bundle containing a limited resultset containing an entry of type OperartionOutcome with the "incomplete" error as the first entry, followed by the partial result (possibly paged too)</p>



<a name="153821810"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821810" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821810">(Apr 14 2016 at 15:07)</a>:</h4>
<p>Ahhhh I get it. Yeah, that's a separate issue.</p>



<a name="153821875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821875">(Apr 15 2016 at 04:49)</a>:</h4>
<p>+1 for servers doing a default _count, and capping the size for the reasons already provided.</p>



<a name="153821876"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821876" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821876">(Apr 15 2016 at 05:06)</a>:</h4>
<p>Our implementation doesn't need to save snapshots as we just page through the index from a defined point (when the search started)<br>
This works as no data is changed going back in time, as all changes are new versions (including deletes)</p>



<a name="153821877"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/how%20to%20handle%20very%20large%20result%20sets/near/153821877" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/how.20to.20handle.20very.20large.20result.20sets.html#153821877">(Apr 15 2016 at 05:08)</a>:</h4>
<p>The back next links encode this info</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
