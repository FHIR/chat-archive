---
layout: page
title: "FHIR Chat  · OAuth State Parameter · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html">OAuth State Parameter</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="176111500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176111500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shahzeb Jadoon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176111500">(Sep 19 2019 at 15:35)</a>:</h4>
<p>Hello Everyone,</p>
<p>State(a random string for CSRF) in OAuth2 must be unique per user request/session?<br>
If it is per session I'm using web API whose definition said it should be stateless(Server has no clue about client state) then how can i achieve that?</p>



<a name="176112179"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176112179" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176112179">(Sep 19 2019 at 15:42)</a>:</h4>
<p>The state token I'm aware of is per session as part of getting the auth code.<br>
1. You pass a state token to the EHR when you <a href="http://www.hl7.org/fhir/smart-app-launch/#step-1-app-asks-for-authorization" target="_blank" title="http://www.hl7.org/fhir/smart-app-launch/#step-1-app-asks-for-authorization">request an auth code</a>.<br>
2. The EHR <a href="http://www.hl7.org/fhir/smart-app-launch/#step-2-ehr-evaluates-authorization-request-asking-for-end-user-input" target="_blank" title="http://www.hl7.org/fhir/smart-app-launch/#step-2-ehr-evaluates-authorization-request-asking-for-end-user-input">returns your state token with your auth code</a><br>
How does that mismatch with the API you're using?</p>



<a name="176122771"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176122771" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shahzeb Jadoon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176122771">(Sep 19 2019 at 17:36)</a>:</h4>
<p><strong>Michael Donnelly</strong> question is not about mismatching . <br>
Question 1: When an app causes the browser  to navigate the browser to the EHR’s authorization URL, state already present there. But if same user send again a request in this case state will be change or same? <br>
Question 2: And if a user refresh authorization URL then state will be same or change?</p>



<a name="176123220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176123220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176123220">(Sep 19 2019 at 17:41)</a>:</h4>
<p>The requesting app sets the state when it begins any given OAuth interaction -- so it (the app) is in charge of determining whether it's the same or different. But from a security perspective, a best practice is for the app to make these <code>state</code> values unguessable and unique.</p>



<a name="176127656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176127656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176127656">(Sep 19 2019 at 18:24)</a>:</h4>
<p>When you say "request" are you only talking about the request to the authorization URL?</p>



<a name="176130681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176130681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176130681">(Sep 19 2019 at 18:58)</a>:</h4>
<p>That's right.</p>



<a name="176134300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176134300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176134300">(Sep 19 2019 at 19:40)</a>:</h4>
<p>Heh.  I know you are; I'm asking <span class="user-mention" data-user-id="240477">@Shahzeb Jadoon</span></p>



<a name="176186085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176186085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shahzeb Jadoon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176186085">(Sep 20 2019 at 12:02)</a>:</h4>
<p>Yes <strong>Michael Donnelly</strong>.</p>



<a name="176186824"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176186824" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shahzeb Jadoon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176186824">(Sep 20 2019 at 12:14)</a>:</h4>
<p>I am confused, when a user get authorization code on behalf of state. If a request comes from same state again, should we allow that user as new login or reject the request ?</p>



<a name="176192597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176192597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176192597">(Sep 20 2019 at 13:31)</a>:</h4>
<p>Enforcing unique states is not the responsibility of a server --</p>



<a name="176192650"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176192650" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176192650">(Sep 20 2019 at 13:31)</a>:</h4>
<p>It is a best practice for the client developer. A server just passes the client-supplied states through the interaction, from the authorized step through the redirect.</p>



<a name="176193264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176193264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ali Haider <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176193264">(Sep 20 2019 at 13:38)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span>  <br>
I think he may be asking that, he should maintain that particular state or every request will have unique State parameter. If yes then how will he know to which request he will send response.</p>



<a name="176194144"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176194144" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176194144">(Sep 20 2019 at 13:48)</a>:</h4>
<p><del>Basically the requirement is that the server will mint an authorization code that it associates with the request's <code>state</code> value, so that it can return the <code>state</code> in the final access token response. You could accomplish that in a stateless (for the server!) way by creating the authorization code as an encrypted and authenticated blob that internally includes this state value. But one of the requirements for the server is to reject token requests with authorization codes that a client attempts to use more than once-- so you at least need to keep a cache of recently used authorization codes with a time-to-live that is greater than your authorization code usage window</del></p>
<p>(I was answering without enough sleep; please ignore ;-))</p>



<a name="176198753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176198753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176198753">(Sep 20 2019 at 14:42)</a>:</h4>
<blockquote>
<p>I am confused, when a user get authorization code on behalf of state. If a request comes from same state again, should we allow that user as new login or reject the request ?</p>
</blockquote>
<p>A server need not persist the state beyond that single interaction.  The only thing the server needs to do with the state is return it with the auth code.  It never looks at it, thinks about it, or retains it beyond that.</p>



<a name="176198785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176198785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176198785">(Sep 20 2019 at 14:42)</a>:</h4>
<p>It would be insecure for a client to reuse a state token, but the server doesn't enforce that.</p>



<a name="176260640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/OAuth%20State%20Parameter/near/176260640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shahzeb Jadoon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/OAuth.20State.20Parameter.html#176260640">(Sep 21 2019 at 11:15)</a>:</h4>
<p><strong>Josh Mandel</strong> what you meant by that ? Have you got enough sleep now <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span> ?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
