---
layout: page
title: "FHIR Chat  · differentials · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html">differentials</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153999271"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999271" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999271">(Sep 22 2018 at 16:33)</a>:</h4>
<p>Couple questions about differentials and array elements:<br>
 If a base ElementDefinition has elements [A, B, C], and profiled ElementDefinition has [A, modifiedB, C], should the differential include [A, modifiedB, C], or just [modifiedB]?  If just [modifiedB], is there a algorithm to finding which element in the snapshot list it corresponds to (e.g., first field with primitive type "id"?</p>
<p>second, I noticed some things we "let slide" in the differential - e.g., constraints on a base definition are copied over to the profile, with the additional "source" field listing the base that they came from, but we don't seem to bother to put that in the differential, presumably because it's implied/derivable/not interesting.  are there machine-friendly rules for that?  Another example: "base" field - which again is an obvious diff due to the profile-base relationship.</p>



<a name="153999272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999272">(Sep 22 2018 at 16:36)</a>:</h4>
<p>(concrete example of point 2: <a href="http://hl7.org/fhir/extension-minvalue.json.html" target="_blank" title="http://hl7.org/fhir/extension-minvalue.json.html">http://hl7.org/fhir/extension-minvalue.json.html</a> . The second "constraint" on "Extension" ElementDefinition lists "Extension" as the source of the constraint, which is technically speaking a diff from the same constraint on the base Extension, but this does not show up in the differential)</p>



<a name="153999280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999280">(Sep 22 2018 at 18:58)</a>:</h4>
<p>Differential only needs to include the elements that have changed.  However, some of the tools depend on the whole hierarchy to <em>reach</em> the elements also be included.  So, for example, if you wanted to have a differential that asserted a constraint on <a href="http://Patient.contact.name" target="_blank" title="http://Patient.contact.name">Patient.contact.name</a>, you'd have to first include the element for Patient and for Patient.contact.  (Though you wouldn't need to say anything about them other than "an element with this path exists".) </p>
<p>There is indeed an "algorithm" for matching elements in a differential to the base and calculating what the snapshot is.  But calling it an "algorithm" is a bit misleading.  There's over 1000 lines of really complex (and somewhat evil) code in the Java reference implementation and a similar amount in the other reference implementations that do it.</p>



<a name="153999283"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999283" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999283">(Sep 22 2018 at 19:21)</a>:</h4>
<p>interesting, thanks.  How about the repeated elements?</p>



<a name="153999287"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999287" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999287">(Sep 22 2018 at 20:02)</a>:</h4>
<p>I'm not understanding the question</p>



<a name="153999289"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999289" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999289">(Sep 22 2018 at 20:14)</a>:</h4>
<p>let's say the base definition has a field <br>
[ {id: "A", field: "bar"},  {id: "B", field: "bar"}, {id: "C",  field: "baz"} ],<br>
 and the profile has, for the same field <br>
[ {id: "A", field: "bar"},  {id: "B", field: "barModified"}, {id: "C",  field: "baz"} ]</p>



<a name="153999290"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999290" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999290">(Sep 22 2018 at 20:15)</a>:</h4>
<p>would the differential just list <br>
[{id: "B", field: "barModified"}]<br>
or<br>
[ {id: "A", field: "bar"}, {id: "B", field: "barModified"}, {id: "C", field: "baz"} ]</p>



<a name="153999291"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999291" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999291">(Sep 22 2018 at 20:16)</a>:</h4>
<p>Well, what you'd actually have is:<br>
ids of A, A.A, A.B and A.C<br>
The differential would have A and A.Bmodified</p>



<a name="153999292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999292">(Sep 22 2018 at 20:19)</a>:</h4>
<p>so, <br>
[ {id: "A"}, {id: "B", field: "barModified"}, {id: "C"} ]<br>
?</p>



<a name="153999293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999293">(Sep 22 2018 at 20:27)</a>:</h4>
<p>I'm not sure what "field" is.  You're going to have a dot-separated path.  And you have to have an element for the "root" as well as for the element that was modified.</p>



<a name="153999294"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999294" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999294">(Sep 22 2018 at 20:28)</a>:</h4>
<p>So if we take a real example of the Patient resource and you've modified <a href="http://Patient.name" target="_blank" title="http://Patient.name">Patient.name</a> (e.g. made minOccurs=1), then you'd have one element with path "Patient" and another with element "<a href="http://Patient.name" target="_blank" title="http://Patient.name">Patient.name</a>".  You wouldn't bother including Patient.identifier, Patient.gender, <a href="http://Patient.id" target="_blank" title="http://Patient.id">Patient.id</a>, etc.</p>



<a name="153999295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999295">(Sep 22 2018 at 20:31)</a>:</h4>
<p>I'm tlaking about on the ElementDefinition itself.  So, say e.g., you can have 3 constraints on the base definition.  On my profile, I have the same three constraints, but I've changed the severity of the middle one</p>



<a name="153999296"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999296" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999296">(Sep 22 2018 at 20:32)</a>:</h4>
<p>so for the differential for that element definition, we'll need a field for constraints</p>



<a name="153999297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999297">(Sep 22 2018 at 20:32)</a>:</h4>
<p>in this case the array above is of constraints, and field is severity</p>



<a name="153999298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999298">(Sep 22 2018 at 20:41)</a>:</h4>
<p>Ah.  To be honest, I don't know what the tooling will do there.  I don't know that we've had anyone who's ever tried to change the severity of a constraint (as opposed to just adding a new one).  In principle, you should only have to list the changed one and specify the same "key".  Whether that'll work or not, you'll need to test.  (And if it doesn't work, submit a change request.)</p>



<a name="153999299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999299">(Sep 22 2018 at 20:58)</a>:</h4>
<p>fair enough, thanks.  I'm not sure what you mean by "work" though - I'm writing my own tooling here and am curious what the correct behavior would be.</p>



<a name="153999300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999300">(Sep 22 2018 at 21:01)</a>:</h4>
<p>The intention is that if the key is the same, it's recognized as the same constraint.  "Work" = work with the existing reference implementations that perform snapshot generation.  I don't think we have a test-case that covers this scenario.</p>



<a name="153999301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999301">(Sep 22 2018 at 21:03)</a>:</h4>
<p>If you're creating your own tooling to determine a snapshot based on a differential, my first recommendation is "don't" - we've spent many hundreds of person-hours on the software in the reference implementations trying to cover most of the edge cases.  If you do really want to build your own, then at least look at the test cases included as part of the Java reference implementation.</p>



<a name="153999302"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999302" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick George <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999302">(Sep 22 2018 at 21:07)</a>:</h4>
<p>heh that's fair - it's a bit of a strange use case though, I'm not sure existing implementations will cover what we're trying to do.  Thanks a lot for your help!</p>



<a name="153999352"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999352" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> robert worden <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999352">(Sep 23 2018 at 20:15)</a>:</h4>
<p>has anyone tried to write down a mathematical spec of what a differential means, i.e  how it defines  snapshot? It's a shame to have such an important part of FHIR defined by test cases and ugly code.</p>



<a name="153999355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999355">(Sep 23 2018 at 20:37)</a>:</h4>
<p>The gist of how it works is defined on the profiling page.   No clue how you'd describe slicing, default slices, re-slicing, etc. mathematically...</p>



<a name="153999414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999414">(Sep 24 2018 at 11:25)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="193818">@robert worden</span>, I agree. Fortunately, <span class="user-mention" data-user-id="191351">@Chris Grenz</span> has made a serious effort trying to describe the rules for generating a snapshot:<br>
<a href="https://github.com/chrisgrenz/FHIR-Primer/wiki/Snapshots-Determining-Refines" target="_blank" title="https://github.com/chrisgrenz/FHIR-Primer/wiki/Snapshots-Determining-Refines">https://github.com/chrisgrenz/FHIR-Primer/wiki/Snapshots-Determining-Refines</a></p>



<a name="153999416"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/differentials/near/153999416" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/differentials.html#153999416">(Sep 24 2018 at 11:34)</a>:</h4>
<p>FYI The implementation of the snapshot generator in the .NET API generates and handles sparse differentials. Unconstrained elements can be safely omitted from the differential, as defined by the FHIR spec. The .NET logic is smart enough to deal with orphaned elements in the sparse diff representation. However as Lloyd mentions, the open source publication tooling does not (yet) handle orphaned elements.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
