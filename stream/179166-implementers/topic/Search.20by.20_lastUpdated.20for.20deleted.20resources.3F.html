---
layout: page
title: "FHIR Chat  · Search by _lastUpdated for deleted resources? · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html">Search by _lastUpdated for deleted resources?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="160873671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160873671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160873671">(Mar 15 2019 at 13:22)</a>:</h4>
<p>If I do a search for resources by a _lastUpdated date range, would i expect to get back any information about resources that were DELETED in that date range? If so, what kind of data would I expect to indicate it was deleted?</p>



<a name="160874126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160874126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160874126">(Mar 15 2019 at 13:27)</a>:</h4>
<p>First you need to understand that the effect of a DELETE operation is very policy dependent. Especially in databases that are supporting Treatment. Often times a need to stop-using is supported by setting the resource status element to entered-in-error.  Sometimes a Delete does leave behind history, which might work as you are thinking; but it is possible a real-delete will also remove all history. There is a possibility that when the resource was deleted, that a Provenance record of that delete was recorded leaving only a Provenance resource behind.</p>



<a name="160874909"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160874909" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160874909">(Mar 15 2019 at 13:37)</a>:</h4>
<p>It probably depends on your requirements, but when one were to stick to the spec as it is written (<a href="http://hl7.org/fhir/http.html#delete" target="_blank" title="http://hl7.org/fhir/http.html#delete">http://hl7.org/fhir/http.html#delete</a>) I'd say the resource shouldn't show up in search results (to quote: "... and that the resource is no longer found through search interactions.").  But that is just me playing with FHIR since two days or so…</p>



<a name="160875042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160875042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160875042">(Mar 15 2019 at 13:39)</a>:</h4>
<p>Interesting, ok. In the case I'm looking at, it would be for deleting a HealthcareService (a more significant delete then just setting as not active). </p>
<p>I have the choice to decide how it's implemented, it sounds like two options you mention are a history search or a provenance search. We don't CURRENTLY have a provenance resource set up for our records, but this may be a reason to add it. </p>
<p>Where would i look for how to implement with a _history search, I can't quite pinpoint how to identify with that method that the resource was DELETED.</p>
<p>Would publishing a HealthcareService via a subscrition make it clear if a resource was deleted?</p>



<a name="160875533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160875533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160875533">(Mar 15 2019 at 13:45)</a>:</h4>
<blockquote>
<p>Where would i look for how to implement with a _history search, I can't quite pinpoint how to identify with that method that the resource was DELETED.</p>
</blockquote>
<p>Ok, so _history works as follows (to the best of my understanding): Assume you have a resource with the following operations: POST, PUT, PUT, DELETE (so creation, two updates, and a delete). The history would look like this:</p>
<div class="codehilite"><pre><span></span>  <span class="nt">&lt;entry&gt;</span>
    <span class="nt">&lt;resource&gt;</span>
      <span class="nt">&lt;Patient&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">value=</span><span class="s">&quot;23424&quot;</span><span class="nt">/&gt;</span>
         <span class="c">&lt;!-- IMPORTANT: no extra data here (aside from metadata), since this record is deleted --&gt;</span>
      <span class="nt">&lt;/Patient&gt;</span>
    <span class="nt">&lt;/resource&gt;</span>
    <span class="nt">&lt;request&gt;</span>
      <span class="c">&lt;!-- DELETE: this was a delete --&gt;</span>
      <span class="nt">&lt;method</span> <span class="na">value=</span><span class="s">&quot;DELETE&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/request&gt;</span>
  <span class="nt">&lt;/entry&gt;</span>
 <span class="c">&lt;!-- another &lt;entry&gt; here like the following for the second update --&gt;</span>
  <span class="nt">&lt;entry&gt;</span>
    <span class="nt">&lt;resource&gt;</span>
      <span class="nt">&lt;Patient&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">value=</span><span class="s">&quot;23424&quot;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- other data submitted here for the update --&gt;</span>
      <span class="nt">&lt;/Patient&gt;</span>
    <span class="nt">&lt;/resource&gt;</span>
    <span class="nt">&lt;request&gt;</span>
      <span class="c">&lt;!-- PUT: this was the first update  --&gt;</span>
      <span class="nt">&lt;method</span> <span class="na">value=</span><span class="s">&quot;PUT&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/request&gt;</span>
  <span class="nt">&lt;/entry&gt;</span>
  <span class="nt">&lt;entry&gt;</span>
    <span class="nt">&lt;resource&gt;</span>
      <span class="nt">&lt;Patient&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">value=</span><span class="s">&quot;23424&quot;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- other data submitted here --&gt;</span>
      <span class="nt">&lt;/Patient&gt;</span>
    <span class="nt">&lt;/resource&gt;</span>
    <span class="nt">&lt;request&gt;</span>
      <span class="c">&lt;!-- POST: this was a create --&gt;</span>
      <span class="nt">&lt;method</span> <span class="na">value=</span><span class="s">&quot;POST&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/request&gt;</span>
  <span class="nt">&lt;/entry&gt;</span>
</pre></div>


<p>If you now where to limit the history to one entry it should have "DELETE" as method set. One other option would be a simple GET towards the resource which should return http status code 410 if the resource is deleted and the system supports that.</p>



<a name="160875688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160875688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160875688">(Mar 15 2019 at 13:46)</a>:</h4>
<blockquote>
<p>Would publishing a HealthcareService via a subscrition make it clear if a resource was deleted?</p>
</blockquote>
<p>This strongly depends on the type of the subscription. <a href="http://hl7.org/fhir/STU3/subscription.html" target="_blank" title="http://hl7.org/fhir/STU3/subscription.html">http://hl7.org/fhir/STU3/subscription.html</a> cleary says "Note that the search criteria are applied to the new value of the resource. The consequence of this is that there is no notification when a resource is deleted, or when a resource is updated so that it no longer meets the criteria. ". As far as I understand this sentence, this would mean that you would only get a subscription notify if your search params would filter for just the resource type (!!) or only the id (or other values in metadata). Everything else like identifier etc is imo gone on a deleted resource.</p>



<a name="160876854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160876854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160876854">(Mar 15 2019 at 14:00)</a>:</h4>
<p>Thinking about it I was trying to remember why I did show the deleted resource with an id in the first history entry. I think this came to me as a result of <a href="http://hl7.org/fhir/STU3/http.html#vread" target="_blank" title="http://hl7.org/fhir/STU3/http.html#vread">http://hl7.org/fhir/STU3/http.html#vread</a> which says that servers SHALL return an id there. So for "convenience" reasons I've kept the same scheme for the entries in _history</p>



<a name="160902006"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160902006" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160902006">(Mar 15 2019 at 18:42)</a>:</h4>
<p>a deleted resource is deleted. <span class="user-mention" data-user-id="191404">@John Moehrke</span> is a misleading to say that the efect is policy dependent. If a resource is deleted, the server has to act like it's deleted, if it accepts the DELETE operation. OTOH, Whether a history is available depends on server capabilities (and then policy)</p>



<a name="160902202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160902202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160902202">(Mar 15 2019 at 18:44)</a>:</h4>
<p>once a resource is deleted, it's considered gone except for _history - so search and subscription don't help. Hence for this reason, you need _history for this one</p>



<a name="160902391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160902391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160902391">(Mar 15 2019 at 18:46)</a>:</h4>
<p>I don't disagree, just want to start from the fact level that delete is often verbally said in ways that are not technically true. A technical DELETE is a RESTful DELETE. In that case, it is gone... If you knew the _id value, then one can search on Provenance for Provenance.target that hold that _id value; and look for Provenance.activity=DELETE --  <a href="http://build.fhir.org/provenance.html#removal" target="_blank" title="http://build.fhir.org/provenance.html#removal">http://build.fhir.org/provenance.html#removal</a></p>



<a name="160902464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160902464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160902464">(Mar 15 2019 at 18:47)</a>:</h4>
<blockquote>
<p>once a resource is deleted, it's considered gone except for _history - so search and subscription don't help. Hence for this reason, you need _history for this one</p>
</blockquote>
<p>what does the last version in the history look like to indicate that the histoirical line is ended (DELETE) vs active?</p>



<a name="160903309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160903309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160903309">(Mar 15 2019 at 18:57)</a>:</h4>
<p>Bundle.entry.request.method = DELETE. Bundle.entry.response not present</p>



<a name="160903751"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160903751" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160903751">(Mar 15 2019 at 19:02)</a>:</h4>
<blockquote>
<p>Bundle.entry.request.method = DELETE. Bundle.entry.response not present</p>
</blockquote>
<p>That seems to be in contrast with what implementations do. For instance the demo server at <a href="http://hapi.fhir.org/" target="_blank" title="http://hapi.fhir.org/">http://hapi.fhir.org/</a> will return:</p>
<div class="codehilite"><pre><span></span>      <span class="s2">&quot;fullUrl&quot;</span><span class="err">:</span> <span class="s2">&quot;http://hapi.fhir.org/baseDstu3/Patient/1427169&quot;</span><span class="err">,</span>
      <span class="s2">&quot;resource&quot;</span><span class="err">:</span> <span class="p">{</span>
        <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient&quot;</span><span class="p">,</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;1427169&quot;</span><span class="p">,</span>
        <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;versionId&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
          <span class="nt">&quot;lastUpdated&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-03-15T16:15:54.229+00:00&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;generated&quot;</span><span class="p">,</span>
          <span class="nt">&quot;div&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;&lt;table class=\&quot;hapiPropertyTable\&quot;&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span><span class="err">,</span>
      <span class="s2">&quot;request&quot;</span><span class="err">:</span> <span class="p">{</span>
        <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hapi.fhir.org/baseDstu3/Patient/1427169/_history/2&quot;</span>
      <span class="p">}</span>
</pre></div>


<p>Is this wrong? I am asking because I have implemented something similar which currently causes a few issues with conformance tests at touchstone.</p>



<a name="160904100"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160904100" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160904100">(Mar 15 2019 at 19:06)</a>:</h4>
<p>yes I think that's wrong. <span class="user-mention" data-user-id="191319">@James Agnew</span>. The relevant piece of standard is <a href="http://hl7.org/fhir/http.html#history" target="_blank" title="http://hl7.org/fhir/http.html#history">http://hl7.org/fhir/http.html#history</a></p>



<a name="160904413"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160904413" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160904413">(Mar 15 2019 at 19:10)</a>:</h4>
<p>Just to clarify, did you mean Bundle.entry.resource not present? In the given example, Bundle.entry.response is actually empty.</p>



<a name="160904425"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160904425" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160904425">(Mar 15 2019 at 19:10)</a>:</h4>
<p>Mhm, then in my opinion (not that it is worth much, I literally started with FHIR this week), it would be great if the standard could mention that. I personally implemented it like this because <a href="http://hl7.org/fhir/http.html#vread" target="_blank" title="http://hl7.org/fhir/http.html#vread">http://hl7.org/fhir/http.html#vread</a> returns resources even for deleted elements (at least as far as I understand it: "The returned resource SHALL have an id element with a value that is the [id], and a meta.versionId element with a value of [vid]."). <br>
While <em>_history</em> is not exactly the same as <em>vread</em> it seemed to make sense consistency wise.</p>



<a name="160904486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160904486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160904486">(Mar 15 2019 at 19:11)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> Yes, in my implementation and examples I did put them as empty because that is how I understood the spec.</p>



<a name="160904650"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160904650" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160904650">(Mar 15 2019 at 19:14)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> yes I did mean Bundle.entry.resource is not present. typo - thanks for picking it up</p>



<a name="160904806"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160904806" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160904806">(Mar 15 2019 at 19:15)</a>:</h4>
<p>there is no resource to return for a vread on a deleted resource. What does <a href="http://test.fhir.org" target="_blank" title="http://test.fhir.org">test.fhir.org</a> return on that case?</p>



<a name="160905127"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160905127" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160905127">(Mar 15 2019 at 19:19)</a>:</h4>
<p>Google Cloud does the same thing that HAPI is doing here (resource populated, response empty), primarily because inside the implementation we want the deleted stub to have a resource entry so we can filter the history uniformly on meta.lastUpdated and with any access control looking at meta.security. But that doesn't prevent us from rewriting the history bundle if necessary to conform.</p>



<a name="160905302"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160905302" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160905302">(Mar 15 2019 at 19:21)</a>:</h4>
<p>I notice that <a href="http://hl7.org/fhir/STU3/http.html#history" target="_blank" title="http://hl7.org/fhir/STU3/http.html#history">http://hl7.org/fhir/STU3/http.html#history</a> does not have the history example for a deleted resource, and that was the spec we were initially working from.</p>



<a name="160905438"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160905438" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160905438">(Mar 15 2019 at 19:23)</a>:</h4>
<blockquote>
<p>there is no resource to return for a vread on a deleted resource. What does <a href="http://test.fhir.org" target="_blank" title="http://test.fhir.org">test.fhir.org</a> return on that case?</p>
</blockquote>
<p><a href="http://test.fhir.org/r3/Account/1/_history?_format=json" target="_blank" title="http://test.fhir.org/r3/Account/1/_history?_format=json">http://test.fhir.org/r3/Account/1/_history?_format=json</a></p>
<p>it returns no resource on deleted entries. That said, it records double deletes -- that is interesting :D</p>



<a name="160907385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160907385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160907385">(Mar 15 2019 at 19:44)</a>:</h4>
<p>that's a bug. as is this: <a href="http://test.fhir.org/r3/Account/1/_history/2" target="_blank" title="http://test.fhir.org/r3/Account/1/_history/2">http://test.fhir.org/r3/Account/1/_history/2</a></p>



<a name="160907418"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/160907418" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#160907418">(Mar 15 2019 at 19:45)</a>:</h4>
<p>Oh and it also errors out with a server error on a <em>vread</em> for a deleted <em>vid</em>:<br>
<a href="http://test.fhir.org/r3/Account/1/_history/3?_format=json" target="_blank" title="http://test.fhir.org/r3/Account/1/_history/3?_format=json">http://test.fhir.org/r3/Account/1/_history/3?_format=json</a></p>
<p>-- from the looks of it it ries to parse the none existant resource :)</p>
<div class="codehilite"><pre><span></span><span class="p">{</span><span class="nt">&quot;resourceType&quot;</span> <span class="p">:</span> <span class="s2">&quot;OperationOutcome&quot;</span><span class="p">,</span><span class="nt">&quot;text&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="nt">&quot;status&quot;</span> <span class="p">:</span> <span class="s2">&quot;generated&quot;</span><span class="p">,</span><span class="nt">&quot;div&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;&lt;p&gt;Error parsing JSON source: Unexpected content at start of JSON: Eof at Line 0 (path=[])&lt;/p&gt;&lt;/div&gt;&quot;</span><span class="p">},</span><span class="nt">&quot;issue&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="nt">&quot;severity&quot;</span> <span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="nt">&quot;details&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="nt">&quot;text&quot;</span> <span class="p">:</span> <span class="s2">&quot;Error parsing JSON source: Unexpected content at start of JSON: Eof at Line 0 (path=[])&quot;</span><span class="p">},</span><span class="nt">&quot;diagnostics&quot;</span> <span class="p">:</span> <span class="s2">&quot;(000000000047358B){FHIRServer.exe} [000000000087458B] Unknown function at TMethodImplementationIntercept + $3CF9BB\r\n(00000000040B0592){FHIRServer.exe} [00000000044B1592] Unknown function at TMethodImplementationIntercept + $400C9C2\r\n(00000000040B2440){FHIRServer.exe} [00000000044B3440] Unknown function at TMethodImplementationIntercept + $400E870\r\n(0000000000049157){FHIRServer.exe} [000000000044A157] Unknown function at __dbk_fcall_wrapper + $2C0F7\r\n(0000000000049A5B){FHIRServer.exe} [000000000044AA5B] Unknown function at __dbk_fcall_wrapper + $2C9FB\r\n(0000000000011576){FHIRServer.exe} [0000000000412576]\r\n(00000000000115C1){FHIRServer.exe} [00000000004125C1]\r\n(000000000047358B){FHIRServer.exe} [000000000087458B] Unknown function at ){KERNEL32.DLL} [00007FFB68DF84D4] BaseThreadInitThunk + $14\r\n(000000000006D851){ntdll.dll   } [00007FFB6B56E851] RtlUserThreadStart + $21\r\n&quot;</span><span class="p">}]}</span>
</pre></div>



<a name="161104991"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161104991" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Berezny <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161104991">(Mar 18 2019 at 23:11)</a>:</h4>
<p>The HAPI method seems useful to me, but it sounds like... it's implemented incorrectly? If I read this thread correctly, it looks like deleted resources should be treated like they were never there (with the exception of _history), and then that doing a search for Provenence resources, looking for deleted HealthcareServices would be the truest way to identify that a Healthcare Service has been deleted?</p>



<a name="161105630"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161105630" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161105630">(Mar 18 2019 at 23:20)</a>:</h4>
<p>yes to the first part</p>



<a name="161105639"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161105639" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161105639">(Mar 18 2019 at 23:20)</a>:</h4>
<p>there's no true way to identify a healthcare server that has been deleted except by monitoring the history</p>



<a name="161110660"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161110660" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161110660">(Mar 19 2019 at 00:53)</a>:</h4>
<p>More typically they will be marked as inactive...</p>



<a name="161126995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161126995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161126995">(Mar 19 2019 at 07:25)</a>:</h4>
<blockquote>
<p>there's no true way to identify a healthcare server that has been deleted except by monitoring the history</p>
</blockquote>
<p>I've seearched the <a class="stream" data-stream-id="179229" href="/#narrow/stream/179229-subscriptions">#subscriptions</a> stream but couldn't really find a reasoning for this. Any hints on why it is like this?</p>



<a name="161128745"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161128745" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161128745">(Mar 19 2019 at 08:00)</a>:</h4>
<p>because the subscription works on search, and search doesn't work on deleted resources.</p>



<a name="161128786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161128786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161128786">(Mar 19 2019 at 08:01)</a>:</h4>
<p><a href="#narrow/stream/179229-subscriptions/topic/Detecting.20data.20that.20no.20longer.20qualifies" title="#narrow/stream/179229-subscriptions/topic/Detecting.20data.20that.20no.20longer.20qualifies">https://chat.fhir.org/#narrow/stream/179229-subscriptions/topic/Detecting.20data.20that.20no.20longer.20qualifies</a></p>



<a name="161130078"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161130078" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161130078">(Mar 19 2019 at 08:23)</a>:</h4>
<p>Ok, it seems my english is not good enough to bring the point over, so I will try again. I do understand that subscriptions are based on searches and as such cannot show anything which no longer matches after an update/delete. What I was wondering is mainly <em>why</em> this was implemented/written like this. I'd imagine that systems would like to know about deletes hence this seems like an oversight to me prompting my question about the reasoning behind it.</p>
<p>Also technically speaking a deleted patient is still a patient, as such couldn't a subscription for resource_type = Patient still list it? Or is the assumption really that a deletion removes everything (which is obviously not the case since the history for that resource and id is still there).</p>
<p>Sorry if my questions appear to be annoying, I am trying to grasp the concepts and ideas to give me a better understanding.</p>



<a name="161136046"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161136046" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161136046">(Mar 19 2019 at 10:04)</a>:</h4>
<p>Josh proposed it that way for simplicity when he first proposed. The problem with deleted resources was the <em>first</em> thing I said to him about it, but any other approach is significantly more complicated, so we stuck with that proposal. We've discussed a more complex way that gives way more control, but feedback from implementers hasn't been enough to push it over the line</p>



<a name="161142398"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161142398" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Florian Apolloner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161142398">(Mar 19 2019 at 11:46)</a>:</h4>
<p>Ah okay, thanks!</p>



<a name="161626126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Search%20by%20_lastUpdated%20for%20deleted%20resources%3F/near/161626126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F.html#161626126">(Mar 25 2019 at 09:22)</a>:</h4>
<p>FYI- The way HAPI shows that empty patient in a DELETE entry when browsing history was an artifact of the way history works internally in the library. It's a bug that's existed almost since the first version of HAPI somehow.</p>
<p>JUst committed a fix: <a href="http://hapi.fhir.org/baseDstu3/Patient/1694175/_history" target="_blank" title="http://hapi.fhir.org/baseDstu3/Patient/1694175/_history">http://hapi.fhir.org/baseDstu3/Patient/1694175/_history</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
