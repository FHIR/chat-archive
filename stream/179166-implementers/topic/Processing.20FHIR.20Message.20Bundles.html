---
layout: page
title: "FHIR Chat  · Processing FHIR Message Bundles · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html">Processing FHIR Message Bundles</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="154026900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/154026900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dave Barnet <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#154026900">(Dec 21 2018 at 10:20)</a>:</h4>
<p>I have created a specification for messaging child health data around our healthcare system. The specification tells an implementer how to format a message bundle, and how to send it to a recipient. I think I'm OK explaining how to format the message bundle (creating the resources and reference links etc.). What I'm less sure about is explaining how a recipient might process the message bundle - given that the references will point in directions in accordance to the FHIR spec (an Encounter can reference (point to) a HealthcareService, but Observations, Procedures etc. all point back to the Encounter. Does anyone have some clear literature on how a novice to FHIR might go about writing code to process a FHIR message bundle?Processing FHIR Message Bundle</p>



<a name="154026912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/154026912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#154026912">(Dec 21 2018 at 13:46)</a>:</h4>
<p><a href="http://build.fhir.org/documentation.html" target="_blank" title="http://build.fhir.org/documentation.html">http://build.fhir.org/documentation.html</a></p>



<a name="154026951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/154026951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Craig McClendon <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#154026951">(Dec 21 2018 at 16:43)</a>:</h4>
<p>The Bundle resource definition page is the place to start. There is a section there on resolving references in a Bundle, which is a key part of processing them.  <a href="http://build.fhir.org/bundle.html#references" target="_blank" title="http://build.fhir.org/bundle.html#references">http://build.fhir.org/bundle.html#references</a>   -  It can be tricky depending on what you are doing. If the processing system is assigning it's own resource IDs you have to work out the dependency order in the bundle so you persist the resources in the correct order so you can update the references properly.</p>



<a name="155284578"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155284578" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Tarar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155284578">(Jan 16 2019 at 20:19)</a>:</h4>
<p>I have been trying to process a MessageBundle by reading it after it has been posted on a HAPI server.</p>
<p>But the reference resolution is not happning for "Practitioner/598af951-66e4-4910-a964-7e41533b183c" in the Bundle.</p>
<p>Below is the paste link to the bundle.</p>
<p><a href="https://pastebin.com/xrAZJCMV" target="_blank" title="https://pastebin.com/xrAZJCMV">https://pastebin.com/xrAZJCMV</a></p>
<p>I have tried validating it against the validate operation on HAPI Server 3.5.0</p>
<p>Also I have the fhir validator jar results below.</p>
<div class="codehilite"><pre><span></span>rguments: ./instances/Referral-A.xml -version 3.0
  .. connect to tx server @ http://tx.fhir.org
  .. definitions from hl7.fhir.core#3.0.1
    (v3.0.1-null)
  .. validate [./instances/Referral-A.xml]
Terminology server: Check for supported code systems for https://www.hl7.org/fhir/valueset-message-events.html
Exception in thread &quot;main&quot; java.lang.Error: Not done yet - resolve Practitioner/598af951-66e4-4910-a964-7e41533b183c locally
    at org.hl7.fhir.r4.validation.InstanceValidator$ValidatorHostServices.resolveReference(InstanceValidator.java:198)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.funcResolve(FHIRPathEngine.java:3058)
    at org.hl7.fhir.r4.utils.FHIRPathEngine.evaluateFunction(FHIRPathEngine.java:2520)
</pre></div>


<p>Any ideas ? <span class="user-mention" data-user-id="191450">@Simone Heckmann</span></p>



<a name="155294926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155294926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155294926">(Jan 16 2019 at 22:41)</a>:</h4>
<p>I think your syntax needs to be <br>
&lt;reference value="urn:uuid:ffa2bf53-ee09-43a1-b11a-73ed0f1cd73b"/&gt;<br>
 instead of <br>
&lt;reference value="PractitionerRole/ffa2bf53-ee09-43a1-b11a-73ed0f1cd73b"/&gt;</p>



<a name="155295017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295017">(Jan 16 2019 at 22:42)</a>:</h4>
<p>Both syntaxes should work.  In looking at the instance, everything seems like it should work.  Double-check that you're using the most recent validator from <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">http://build.fhir.org</a>.  If you are, then please submit a change request and attach your instance and point to this zulip thread.</p>



<a name="155295230"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295230" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rick Geimer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295230">(Jan 16 2019 at 22:46)</a>:</h4>
<p>I think Simone is correct. The reference is Practitioner/598af951-66e4-4910-a964-7e41533b183c</p>
<p>But the entry has this:</p>
<p>&lt;fullUrl value="urn:uuid:598af951-66e4-4910-a964-7e41533b183c"/&gt;</p>



<a name="155295235"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295235" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295235">(Jan 16 2019 at 22:46)</a>:</h4>
<p>it should look like this:<br>
<a href="/user_uploads/10155/QryX-VuZ0E-QvCLiWTSb0oED/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/QryX-VuZ0E-QvCLiWTSb0oED/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/QryX-VuZ0E-QvCLiWTSb0oED/pasted_image.png"></a></div>



<a name="155295292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rick Geimer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295292">(Jan 16 2019 at 22:47)</a>:</h4>
<p>Reference needs to become urn:uuid:598af951-66e4-4910-a964-7e41533b183c, or the fullUrl needs to become "<a href="http://SOME-FHIR-ENDPOINT/Practitioner/598af951-66e4-4910-a964-7e41533b183c" target="_blank" title="http://SOME-FHIR-ENDPOINT/Practitioner/598af951-66e4-4910-a964-7e41533b183c">http://SOME-FHIR-ENDPOINT/Practitioner/598af951-66e4-4910-a964-7e41533b183c</a></p>



<a name="155295480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295480">(Jan 16 2019 at 22:50)</a>:</h4>
<p>If the format is Practitoner/x, that means you're doing a local reference - which means you take the base URL of the referencing resource and use it as the base for the referenced URL.  The base of the referencing resource is urn:uuid:, so the two expressions should be equivalent.  If changing the reference style works, that's fine, but it's still a bug if the validator doesn't support both.  I'm pretty sure it used to...</p>



<a name="155295632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295632">(Jan 16 2019 at 22:52)</a>:</h4>
<p>Quote from <a href="http://hl7.org/implement/standards/fhir/bundle.html#reference" target="_blank" title="http://hl7.org/implement/standards/fhir/bundle.html#reference">http://hl7.org/implement/standards/fhir/bundle.html#reference</a></p>
<blockquote>
<p>How to resolve a reference in a Bundle:</p>
<p>If the reference is not an absolute reference, convert it to an absolute URL:<br>
if the reference has the format [type]/[id], and<br>
if the fullUrl for the bundle entry containing the resource is a RESTful one (see the RESTful URL regex)<br>
extract the [root] from the fullUrl, and append the reference (type/id) to it<br>
then try to resolve within the bundle as for a RESTful URL reference.<br>
If no resolution is possible, then the reference has no defined meaning within this specification<br>
else no resolution is possible and the reference has no defined meaning within this specification<br>
else<br>
Look for an entry with a fullUrl that matches the URI in the reference<br>
if no match is found, and the URI is a URL that can be resolved (e.g. if an http: URL), try accessing it directly)</p>
</blockquote>



<a name="155295716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295716">(Jan 16 2019 at 22:54)</a>:</h4>
<p>Since the condition "if the reference has the format [type]/[id] <em>and</em> if the fullUrl for the bundle entry containing the resource is a RESTful one"  is a "no" because "urn:uuid" doesn't match the RESTFul pattern, we're in the "else" branch:<br>
"Look for an entry with a fullUrl that <em>matches</em> the URI in the reference"</p>



<a name="155295726"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295726" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295726">(Jan 16 2019 at 22:54)</a>:</h4>
<p>I read that as "matches exactly"...</p>



<a name="155295869"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155295869" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155295869">(Jan 16 2019 at 22:57)</a>:</h4>
<p>Though the spec could be a bit more verbose about this :)</p>



<a name="155296017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155296017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rick Geimer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155296017">(Jan 16 2019 at 22:59)</a>:</h4>
<p>Think of the reverse. Let say I have this reference:<br>
&lt;reference value="urn:uuid:598af951-66e4-4910-a964-7e41533b183c"/&gt;</p>
<p>And two fullUrls with the following:</p>
<p>&lt;fullUrl value="http://SOME-FHIR-ENDPOINT/Practitioner/598af951-66e4-4910-a964-7e41533b183c"/&gt;<br>
&lt;fullUrl value="http://SOME-FHIR-ENDPOINT/Encounter/598af951-66e4-4910-a964-7e41533b183c"/&gt;</p>
<p>These are both valid, but which does the reference resolve too? You can't mix the urn format with the RESTful</p>



<a name="155296174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155296174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Simone Heckmann <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155296174">(Jan 16 2019 at 23:01)</a>:</h4>
<p>I think this is not the point of <strong>uu</strong>ids :D</p>



<a name="155341828"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155341828" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Tarar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155341828">(Jan 17 2019 at 15:06)</a>:</h4>
<p>I am going to give what <span class="user-mention" data-user-id="191450">@Simone Heckmann</span> suggested and will report back.<br>
<span class="user-mention" data-user-id="191813">@ArunSrinivasan</span> <span class="user-mention" data-user-id="196402">@AbdulMalik Shakir</span> <span class="user-mention" data-user-id="195048">@John Loonsk</span> <span class="user-mention" data-user-id="194273">@Marcelo caldas</span></p>



<a name="155345222"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155345222" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Tarar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155345222">(Jan 17 2019 at 15:45)</a>:</h4>
<p>Following are my observations.<br>
1. The urn:uuid in references passes $validate operation on the Bundle on HAPI 3.5.0 Server (SUCCESS)<br>
2. It passes the HAPI Client 3.6.0 to parse and resolve references for processing (SUCCESS)<br>
3. It fails the Hl7 Validation jar validation from the latest build on <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">build.fhir.org</a> (see results below) (ERROR)</p>
<p>Here is the latest paste with urn:uuid in references.<br>
<a href="https://pastebin.com/JH2QEs6z" target="_blank" title="https://pastebin.com/JH2QEs6z">https://pastebin.com/JH2QEs6z</a></p>
<div class="codehilite"><pre><span></span>Arguments: ./instances/Referral-A.xml -version 3.0
  .. connect to tx server @ http://tx.fhir.org
  .. definitions from hl7.fhir.core#3.0.1
    (v3.0.1-null)
  .. validate [./instances/Referral-A.xml]
Terminology server: Check for supported code systems for https://www.hl7.org/fhir/valueset-message-events.html
Exception in thread &quot;main&quot; java.lang.Error: Not done yet - resolve urn:uuid:598af951-66e4-4910-a964-7e41533b183c locally
    at org.hl7.fhir.r4.validation.InstanceValidator$ValidatorHostServices.resolveReference(InstanceValidator.java:198)
</pre></div>


<p>1 and 2 above are what I need right now to do what I am doing for HIMSS Interp Showcase. But I will post my notes with this sample as <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  suggested .</p>



<a name="155348001"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155348001" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155348001">(Jan 17 2019 at 16:18)</a>:</h4>
<p>Are you using the current validator from <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">build.fhir.org</a>?</p>



<a name="155357389"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155357389" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Tarar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155357389">(Jan 17 2019 at 18:34)</a>:</h4>
<p>I am using the one from here <a href="http://build.fhir.org/validator.zip" target="_blank" title="http://build.fhir.org/validator.zip">http://build.fhir.org/validator.zip</a></p>



<a name="155359097"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Processing%20FHIR%20Message%20Bundles/near/155359097" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Processing.20FHIR.20Message.20Bundles.html#155359097">(Jan 17 2019 at 18:56)</a>:</h4>
<p>Please submit a tracker item</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
