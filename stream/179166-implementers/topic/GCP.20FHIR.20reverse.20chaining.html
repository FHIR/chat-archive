---
layout: page
title: "FHIR Chat  · GCP FHIR reverse chaining · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20FHIR.20reverse.20chaining.html">GCP FHIR reverse chaining</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="228549298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20FHIR%20reverse%20chaining/near/228549298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20FHIR.20reverse.20chaining.html#228549298">(Mar 03 2021 at 07:40)</a>:</h4>
<p>Hi all,<br>
I'm working with GCP FHIR API and got some problems with reverse chaining.<br>
I try to get resource ServiceRequest which has a relationship with Observation via <code>Observation.basedOn</code> field. <br>
The query will like:</p>
<div class="codehilite"><pre><span></span><code>POST &lt;based URL&gt;/ServiceRequest/_search?_has:Observation:based-on:status=final
</code></pre></div>
<p>My total Observation resource: 161 records. But Observation resources which have field <code>based-on = ServiceRequest/{id}</code> is only 5.<br>
That means if I search from ServiceRequest and reverse chaining to Observation, I'll get correct Observation data (5 records) without errors message.</p>
<p>Expect-result: 5 records</p>
<p>Actual result: error message:</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;issue&quot;: [
        {
            &quot;code&quot;: &quot;value&quot;,
            &quot;details&quot;: {
                &quot;text&quot;: &quot;invalid_query&quot;
            },
            &quot;diagnostics&quot;: &quot;_has search failed: inner query on resource type &#39;Observation&#39;, search parameter &#39;status&#39; returned too many results to expand (&gt;100)&quot;,
            &quot;severity&quot;: &quot;error&quot;
        }
    ],
    &quot;resourceType&quot;: &quot;OperationOutcome&quot;
}
</code></pre></div>



<a name="228554616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20FHIR%20reverse%20chaining/near/228554616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20FHIR.20reverse.20chaining.html#228554616">(Mar 03 2021 at 08:33)</a>:</h4>
<p>My image about the above query like this: <br>
Fetch resource ServiceRequest that have an Observation where observation has a relationship with ServiceRequest (via based-on)[1] and have status=final [2].  [1] and [2] are <code>AND condition</code>, that means result is 5.</p>
<p>But seem like [1] and [2] are not <code>AND condition</code>, I think [2] is applied first and  [1] is applied into [2] result. So, errors happen.</p>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> do you have any idea about this problem?</p>



<a name="228679897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20FHIR%20reverse%20chaining/near/228679897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20FHIR.20reverse.20chaining.html#228679897">(Mar 03 2021 at 22:25)</a>:</h4>
<p>This is expected - the core limitation in our chain/reverse-chain implementation is that the inner query return &lt;100 results. In this case the inner query is Observation?status=final which I assume has 161 results in this case.</p>



<a name="228737542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20FHIR%20reverse%20chaining/near/228737542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20FHIR.20reverse.20chaining.html#228737542">(Mar 04 2021 at 09:01)</a>:</h4>
<p><span class="user-mention" data-user-id="197072">@Paul Church</span> </p>
<blockquote>
<p>My image about the above query like this:<br>
Fetch resource ServiceRequest that have an Observation where observation has a relationship with ServiceRequest (via based-on)[1] and have status=final [2]. [1] and [2] are AND condition, that means the result is 5.</p>
</blockquote>
<p>Is this correct imagination?</p>



<a name="228827867"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20FHIR%20reverse%20chaining/near/228827867" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20FHIR.20reverse.20chaining.html#228827867">(Mar 04 2021 at 18:45)</a>:</h4>
<p>No, this is more like a join than an AND condition. It selects on status=final and then joins that result set against ServiceRequests using based-on.</p>



<a name="228885594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20FHIR%20reverse%20chaining/near/228885594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20FHIR.20reverse.20chaining.html#228885594">(Mar 05 2021 at 02:12)</a>:</h4>
<p>I see, Do you have any idea for me how to handle it? I asked the supporter of GCP, but they give me the solution is using BigQuery, but our customer doesn't want to use Bigquery.</p>



<a name="228885864"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/GCP%20FHIR%20reverse%20chaining/near/228885864" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hue Nguyen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/GCP.20FHIR.20reverse.20chaining.html#228885864">(Mar 05 2021 at 02:14)</a>:</h4>
<p>I try add more condition into query</p>
<blockquote>
<p>POST &lt;based URL&gt;/ServiceRequest/_search?_has:Observation:based-on:status=final&amp;_has:Observation:based-on:code=implement</p>
</blockquote>
<p>But same error cause it's not  AND condition. I wonder that can we do something like a composite field?</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
