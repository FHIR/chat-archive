---
layout: page
title: "FHIR Chat  · JSON decimals · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html">JSON decimals</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="166957879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/166957879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#166957879">(May 31 2019 at 00:34)</a>:</h4>
<p>I don't know if anyone wants to add anything here: <a href="http://community.fhir.org/t/why-did-you-break-the-international-json-standard/1367/6" target="_blank" title="http://community.fhir.org/t/why-did-you-break-the-international-json-standard/1367/6">http://community.fhir.org/t/why-did-you-break-the-international-json-standard/1367/6</a></p>



<a name="167026586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167026586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167026586">(May 31 2019 at 19:31)</a>:</h4>
<p>I know we had to modify our JSON lib to handle this. It wasn't as simple as one would hope, and it is a place I worry many developers will miss</p>



<a name="167027418"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167027418" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167027418">(May 31 2019 at 19:41)</a>:</h4>
<p>well, it certainly should be on the safety page, and isn't</p>



<a name="167027529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167027529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167027529">(May 31 2019 at 19:42)</a>:</h4>
<p>To be honest, I routinely ignore this rule in FHIR, because I'm not going to write my own JSON library anymore than I'm going to write my own XML or HTTP libraries. And I don't expect anyone else to either.</p>



<a name="167027608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167027608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167027608">(May 31 2019 at 19:43)</a>:</h4>
<p>i don't see why you need to write your own json library.</p>



<a name="167027647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167027647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167027647">(May 31 2019 at 19:43)</a>:</h4>
<p><a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22649" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22649">GF#22649</a></p>



<a name="167027944"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167027944" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167027944">(May 31 2019 at 19:46)</a>:</h4>
<p>most of the discussion on this precedes our use of Zulip but I found these: </p>
<ul>
<li><a href="#narrow/stream/179166-implementers/topic/JSON.20Format.20for.20Primitives.20.26.20extensions" title="#narrow/stream/179166-implementers/topic/JSON.20Format.20for.20Primitives.20.26.20extensions">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/JSON.20Format.20for.20Primitives.20.26.20extensions</a></li>
<li><a href="#narrow/stream/179166-implementers/topic/Quantity.2Evalue.20precision" title="#narrow/stream/179166-implementers/topic/Quantity.2Evalue.20precision">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Quantity.2Evalue.20precision</a></li>
</ul>



<a name="167028108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167028108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167028108">(May 31 2019 at 19:48)</a>:</h4>
<p>the discussion we had, from memory, we passionate and detailed - should we use string, or number. Those of us with laboratory backgrounds preferred string - some quite strongly - but the app developers strongly preferred number, and felt that it would be very unsafe to use string</p>



<a name="167028174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167028174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167028174">(May 31 2019 at 19:49)</a>:</h4>
<p>I recall that when we looked at this, there was far less general acceptance in the wider community that strings would be used when precision mattered. And I still don't see any strong statement about this in any of the JSON specifications</p>



<a name="167028790"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167028790" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167028790">(May 31 2019 at 19:56)</a>:</h4>
<blockquote>
<p>i don't see why you need to write your own json library.</p>
</blockquote>
<p>Well, I suppose you don't <em>need</em> to write your own JSON library -- but if you deserialize/inflate FHIR objects (in the programming language of your choice) from the raw JSON, and you want to use native floats/decimals/BigDecimal/Number/whatever, and then you want to round-trip this back into JSON, you <em>need</em> to do something to make sure the original value and the new value are identical.</p>



<a name="167029131"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167029131" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167029131">(May 31 2019 at 20:00)</a>:</h4>
<p>In most libraries I've used (eg: Java and Ruby) BigDecimal by default serialized to and from String</p>



<a name="167029215"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167029215" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167029215">(May 31 2019 at 20:02)</a>:</h4>
<p>And that's essentially the equivalent of what FHIR is specifying</p>



<a name="167029611"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167029611" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167029611">(May 31 2019 at 20:06)</a>:</h4>
<p>right. not all. but most do have some way to preserve precision.</p>



<a name="167029618"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167029618" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167029618">(May 31 2019 at 20:06)</a>:</h4>
<p>There was (not sure it it still exists) an example observation in the spec with a valueQuantity that looked like this:</p>
<div class="codehilite"><pre><span></span><span class="s2">&quot;valueQuantity&quot;</span><span class="err">:</span> <span class="p">{</span>
  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mf">-1.0e+245</span><span class="p">,</span>
  <span class="nt">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;g&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Ruby does not handle that well.</p>



<a name="167029660"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167029660" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167029660">(May 31 2019 at 20:06)</a>:</h4>
<p>what does it do?</p>



<a name="167029739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167029739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167029739">(May 31 2019 at 20:08)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  I mean into JSON String and from JSON String. We had to monkey patch ruby to try to parse from and to JSON Number</p>



<a name="167029787"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167029787" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167029787">(May 31 2019 at 20:08)</a>:</h4>
<p>On a roundtrip it failed to produce the same number -- it overflowed, I believe, but I don't recall the specifics.</p>



<a name="167029848"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167029848" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167029848">(May 31 2019 at 20:09)</a>:</h4>
<p>I haven't had the pleasure of dealing with that Observation example b/c we currently only send Observation out, don't write</p>



<a name="167030001"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167030001" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167030001">(May 31 2019 at 20:11)</a>:</h4>
<p>and I guess technically it's Rails we monkey patched</p>



<a name="167030015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167030015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167030015">(May 31 2019 at 20:11)</a>:</h4>
<p>:)</p>



<a name="167034010"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167034010" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167034010">(May 31 2019 at 20:59)</a>:</h4>
<p>I think I commented on this before.   Regardless of HOW we specify numeric quantities in FHIR (JSON, XML or Turtle RDF?) the concern I raised (before) is that there should be a way of specifying the precision expected in a particular use case.   In the example of a particular binding to a specific lab measurement, for example, as a developer (and more importantly the clinicians guiding the developers) should be able to say what the expected precision of the lab measurement should be.    This is because the measurement is typically communicated with a certain expected precision (and unit of measure -- these are obviously tied together) and the FHIR 'communication channel' shouldn't alter this precision simply because its transport mechanism (e.g. JSON) can't do the job!    I think I even pointed to how they do this in OpenEHR where they recognize the importance of precision and unit of measure in their model.    Yes, their DV_QUANTIFIED Class:  <a href="https://specifications.openehr.org/releases/RM/latest/data_types.html#_dv_quantified_class" target="_blank" title="https://specifications.openehr.org/releases/RM/latest/data_types.html#_dv_quantified_class">https://specifications.openehr.org/releases/RM/latest/data_types.html#_dv_quantified_class</a></p>



<a name="167054700"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167054700" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167054700">(Jun 01 2019 at 04:40)</a>:</h4>
<p>This is one of the major issues I ran into with making my own FHIR server as well. PostgreSQL's JSON support was stripping off the precision. Only solution would be to migrate things between string and numbers. So I agree that it's a problem.</p>



<a name="167054922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167054922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167054922">(Jun 01 2019 at 04:47)</a>:</h4>
<p><span class="user-mention" data-user-id="194183">@John Silva</span> that discussion lead to this: <a href="http://hl7.org/fhir/extension-quantity-precision.html" target="_blank" title="http://hl7.org/fhir/extension-quantity-precision.html">http://hl7.org/fhir/extension-quantity-precision.html</a></p>



<a name="167070137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167070137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167070137">(Jun 01 2019 at 12:15)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  - OK, but an extension again -- not a core functionality?  (maybe in R5?)   Precision is SO important in healthcare (and folks in OpenEMR recognized this that it's part of their base modeling) that it seems like it shouldn't be an 'afterthought' in an extension.   Also, as this is tightly coupled to units of measure, there needs to be a FHIR base data type that pulls these two togehter (like DV_Quantity) it seems to me (IMHO).   Also, as this discussion points out about the inherent problems with the 'transports' (if you can call JSON data representation a 'transport') then it seems like this needs to be addressed at the core.</p>



<a name="167076800"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167076800" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Southworth <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167076800">(Jun 01 2019 at 15:26)</a>:</h4>
<p>Moving comments into this forum:</p>
<p>I’ve been building a FHIR library that uses the provided XSDs as a code generation source.</p>
<p>The biggest issues I’ve encountered thus far:</p>
<p>1) I’ve had to create a special data structure to facilitate Decimal encoding – and fork the standard JSON decoder to handle decimal types.</p>
<p>2) (off-topic) There’s no version number in FHIR resources (as there was in HL7). Our integration system will be handling multiple versions of FHIR concurrently due to thousands of existing vendor connections.</p>
<p>Technically, I have it working on my end.</p>
<p>My concerns are mostly that deviations from widely used standards could</p>
<p>1) result in medical errors if someone writes an ad-hoc REST JSON in the browser or another stack and loses precision for a field in which it matters.</p>
<p>2) means that highly optimized, secure and trusted standard libraries (like JSON.parse) have to be avoided or reimplemented in many technology stacks attempting to work in this space. </p>
<p>Besides a simple string substitution, the float could be provided with an accompanying precision integer – but, at this point, that seems like a much larger change.</p>
<p>Every developer with a browser hitting the XML service already receives all numbers as strings. Anyone mapping the data with a library against the spec would have something that could auto-convert them from string to a numeric value with an associated precision without abandoning standard encoders/decoders for the JSON spec.</p>



<a name="167092781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167092781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167092781">(Jun 01 2019 at 22:35)</a>:</h4>
<p>versioning = sounds like you haven't read the page on versions.</p>



<a name="167092829"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167092829" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167092829">(Jun 01 2019 at 22:36)</a>:</h4>
<p>I'm not aware of any case where losing precision leads to actual wrong results, only to human concern</p>



<a name="167092892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167092892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167092892">(Jun 01 2019 at 22:38)</a>:</h4>
<p><span class="user-mention" data-user-id="194183">@John Silva</span> it's not an after-thought as an extension. We say that the precision is in the string representation, and as far as we can figure out, the few cases where this is not the case are extremely edge case. </p>
<blockquote>
<p>there needs to be a FHIR base data type that pulls these two together</p>
</blockquote>
<p>You mean, like Quantity?</p>



<a name="167092981"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167092981" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167092981">(Jun 01 2019 at 22:41)</a>:</h4>
<p>I believe that I opposed the original decision to use number not string in JSON, but I was overruled on the basis that I didn't really understand JSON ("too much XML indoctrination"). I can't find the original records though. (problematic, but before we won the battle about where to keep records)</p>



<a name="167093162"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167093162" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167093162">(Jun 01 2019 at 22:46)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> <span class="user-mention" data-user-id="191315">@Josh Mandel</span> <span class="user-mention" data-user-id="191328">@Ewout Kramer</span>  I should be able to find records of this in either gForge or the wiki, but I can't. Thoughts on where I should look?</p>



<a name="167094297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167094297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167094297">(Jun 01 2019 at 23:19)</a>:</h4>
<p>Yes, Quantity has units but it doesn't have precision 'built in'.   This statement about the value is very vague:  <br>
  "Numerical value (with implicit precision)"<br>
What does "implicit precision" mean?   Doesn't seem very spec-like (or precise, pun intended  ;-) ).</p>
<p>Here's an example of why precision (and units) matter.   If you tell me your EMR stores weight in Kg and you (as a clinician) are in a Neonatal unit, the precision better have enough decimal places to property represent the neonate's weight since it is critically important for tiny neonates.</p>



<a name="167094900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167094900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167094900">(Jun 01 2019 at 23:39)</a>:</h4>
<p>Other possibility would be the old Skype discussion - but I don't have access to that.</p>
<p>Implicit precision = the numeric expression conveys the precision.  I.e. 3.0 has a precision of 2.  3.00 has a precision of 3. 3.00e2 has a precision of 3.  The only time you need the extension is if you want to send "300" and want to indicate that it has a precision of 2 or 3 instead of 1. (and 3e2 and 3.0e2 isn't an acceptable representation).</p>



<a name="167094954"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167094954" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167094954">(Jun 01 2019 at 23:40)</a>:</h4>
<p>Was there a blog about it?</p>



<a name="167095435"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167095435" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167095435">(Jun 01 2019 at 23:57)</a>:</h4>
<p>OK, but the problem is that JSON would 'loose' the .0 (when sent as a JSON number).   It seems like the precision should be more declarative rather than a 'random side effect' of what happens to be sent.</p>



<a name="167097398"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167097398" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167097398">(Jun 02 2019 at 01:00)</a>:</h4>
<p>There's a bit of <a href="https://web.archive.org/web/20160601114047/https://chats.fhir.me/feeds/skype/implementers.html#2016-01-07%2016:20:54Z" target="_blank" title="https://web.archive.org/web/20160601114047/https://chats.fhir.me/feeds/skype/implementers.html#2016-01-07%2016:20:54Z">discussion here</a></p>



<a name="167097400"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167097400" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167097400">(Jun 02 2019 at 01:00)</a>:</h4>
<blockquote>
<p>2016-01-07 15:35:01Z Josh Mandel: @James: Indeed, this is a JSON implication that comes with our decision to use JSON numbers rather than strings.</p>
</blockquote>



<a name="167097412"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167097412" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167097412">(Jun 02 2019 at 01:01)</a>:</h4>
<blockquote>
<p>2016-01-07 15:29:45Z Keith W. Boone: @James and others: JSON should be JSON. IEEE Format for numbers should be fine so long accuracy is not impacted. We use JSON and XML to support developers familiar with those formats, not to make JSON and XML consistent.</p>
</blockquote>



<a name="167097415"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167097415" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167097415">(Jun 02 2019 at 01:01)</a>:</h4>
<blockquote>
<p>2016-01-07 15:29:27Z Josh Mandel: You mean having not having your serializer spit it out in exponential notation? That seems fine. But client code should be ready to deal with (parse) either format.</p>
</blockquote>
<p>(etc. This was the discussion I remember.)</p>



<a name="167109121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167109121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167109121">(Jun 02 2019 at 07:04)</a>:</h4>
<p>I remember more discussion... but I cannot find it.</p>



<a name="167109138"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167109138" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167109138">(Jun 02 2019 at 07:05)</a>:</h4>
<p><span class="user-mention" data-user-id="194183">@John Silva</span> I think that it's clear but I wrote those words, so I don't mind making it clearer in a future version.</p>



<a name="167109199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167109199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167109199">(Jun 02 2019 at 07:06)</a>:</h4>
<p>this discussion is a little frustrating for me - we waited to 6 years to take something normative so that stuff like this didn't emerge. I'm hearing that this is a practical problem, a problem in theory, and that no one is really defending the status quo.</p>



<a name="167109278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167109278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167109278">(Jun 02 2019 at 07:09)</a>:</h4>
<p>I believe that our options are:<br>
- add more documentation about the current situation <br>
- add a precision indicator in the json format and .. encourage... people to use it (we did put a precision indicator in the protobuf format for this purpose, since that has no string representation at all) </p>
<p>If we have other options, they haven't occurred to me. I believe that changing to use string instead (or as well as) number is not an option for procedural reasons</p>



<a name="167122529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167122529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167122529">(Jun 02 2019 at 13:30)</a>:</h4>
<blockquote>
<p>OK, but the problem is that JSON would 'loose' the .0 (when sent as a JSON number).   It seems like the precision should be more declarative rather than a 'random side effect' of what happens to be sent.</p>
</blockquote>
<p>In theory I can say "this depends on your json serializer and parser; a proper implementation might preserve and interpret this distinction"— though that doesn't help in practice</p>



<a name="167163332"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167163332" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167163332">(Jun 03 2019 at 07:41)</a>:</h4>
<p>actually, strictly, having spent more time with the specs, though it's not very well stated, a proper implementation would not</p>



<a name="167173262"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173262" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173262">(Jun 03 2019 at 10:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  - "a proper implementation will not" -- do you mean a proper JSON serializer would NOT preserve precision?   I know our experience is that neither the Microsoft .NET JSON serializer nor the Newtonsoft JSON serializer preserve JSON numeric precision with the x.0 like values.   I think Javascript serializers do not preserve it either.   (Does anyone have experience with  Java JSON serializers?)     Regardless, the 'on the wire' or 'in the datastore' representation of numbers needs to have a way to specify intended precision, that just seems to be an important part of how numeric values are communicated in healthcare.</p>



<a name="167173685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173685">(Jun 03 2019 at 10:06)</a>:</h4>
<p>it depends on how you read the json spec. The json spec says: </p>
<blockquote>
<p>JavaScript Object Notation (JSON) is a lightweight, text-based, language-independent data interchange format.  It was derived from the ECMAScript Programming Language Standard</p>
</blockquote>



<a name="167173690"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173690" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173690">(Jun 03 2019 at 10:06)</a>:</h4>
<p>how derived is it?</p>



<a name="167173691"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173691" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173691">(Jun 03 2019 at 10:06)</a>:</h4>
<p>the original spec said:</p>



<a name="167173729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173729">(Jun 03 2019 at 10:07)</a>:</h4>
<blockquote>
<p>A number is very much like a C or Java number,</p>
</blockquote>



<a name="167173733"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173733" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173733">(Jun 03 2019 at 10:07)</a>:</h4>
<p>the current spec says: </p>
<blockquote>
<p>This specification allows implementations to set limits on the range and precision of numbers accepted</p>
</blockquote>



<a name="167173805"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173805" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173805">(Jun 03 2019 at 10:08)</a>:</h4>
<p>if you assume - which people seem to do but isn't actually specified that <code>number</code> refers to the number type defined in ECMAScript - then that is very fully specified to be an 8 byte floating number that ignores precision.</p>



<a name="167173813"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173813" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173813">(Jun 03 2019 at 10:08)</a>:</h4>
<p>bu no such statement is made concerning json. it depends on how much you think 'derived' means</p>



<a name="167173971"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173971" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173971">(Jun 03 2019 at 10:10)</a>:</h4>
<p>json schema doesn't further clarify the issue</p>



<a name="167173990"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167173990" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167173990">(Jun 03 2019 at 10:10)</a>:</h4>
<p>OK, 'set limits on' -- I suppose even that doesn't mean that it preserves precision, just that an implementation can say HOW many digits (max) of precision it will support.   The practical limitation for now seems to be that actual implementations 'out there' do not preserve precision (maybe or because of this vagueness in the spec or 'just because' JavaScript is really a typeless language and that's what JSON is based on.</p>



<a name="167174088"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167174088" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167174088">(Jun 03 2019 at 10:12)</a>:</h4>
<p>right. many don't. It's hard for me to understand why this is only an issue now. Personally, I use my own JSON parsers for the simple reason that I want line numbers in the validator error messages</p>



<a name="167174100"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167174100" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167174100">(Jun 03 2019 at 10:12)</a>:</h4>
<p>and for some strange reason, there's no way to do that with the normal parsers. and it never occurred to me to lose precision (I guess I've been in healthcare too long)</p>



<a name="167181676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167181676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167181676">(Jun 03 2019 at 12:02)</a>:</h4>
<p>I just did a search for "json serialization preserve precision" and it's interesting to see how many problems people have with this, from some implementations 'adding an extra .0' and more.    One useful piece of info was this page on <a href="http://JSON.org" target="_blank" title="http://JSON.org">JSON.org</a> which lists (~&gt; 50) JSON implementations in  many different languages.  <a href="http://www.json.org/" target="_blank" title="http://www.json.org/">http://www.json.org/</a>  (who knows what variances exist in all these different implementations, especially related to precision)</p>



<a name="167198182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167198182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167198182">(Jun 03 2019 at 14:57)</a>:</h4>
<p>Hi Grahame, re: why is this an issue now: I think part of the issue is that as FHIR becomes more popular, more people are using it in different ways.<br>
Calling JSON.parse('{"val":3.10}') in the major browsers or Node converts the value to a float and loses the precision (3.1).<br>
In the cases of someone developing in those environments, it is far more likely to use the built-in JSON support then to add a dependency for external code to parse JSON (which can be fair bit of work to find, since the environments include built-in support).  In these scenarios, the system will work and the developer may never know an issue occurred.<br>
I would say that at the least making a warning page would be useful, so that people new to FHIR do not unintentionally cause incidents.</p>



<a name="167200194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167200194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167200194">(Jun 03 2019 at 15:19)</a>:</h4>
<p>I had to tweak (rather than hack) the Newtonsoft Json library for .NET to make it retain precision, but it is doable.  It is using the .NET Decimal class which retains the precision - so 3.0000 remains 3.0000.  Unfortunately, .NET's decimal will NOT support anything bigger than approx 8x10^28, so as <span class="user-mention" data-user-id="191381">@Jason Walonoski</span> points out I am no longer able to parse all examples in the spec, as there's now an example with 10^245 as a value.   Could do that using double, but then precision is not retained.    So, I decided to stick with decimal, and remove the example from my unit-tests.</p>



<a name="167206727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167206727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167206727">(Jun 03 2019 at 16:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span> Knowing that, I would be curious:<br>
-Does that feel like a reasonable amount of work for a new developer that wants to use FHIR?<br>
-As you continued to update, are the changes maintainable for newer releases of Newtonsoft?</p>



<a name="167207293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167207293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167207293">(Jun 03 2019 at 16:30)</a>:</h4>
<p>In general, I wouldn't expect much adoption/support for datatype formats that are not widely supported by popular programming languages and databases, such as enhanced precision or large exponents. Also, I wouldn't recommend anyone to implement their own numeric/datetime storage &amp; operations; way too tricky.</p>



<a name="167220872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167220872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167220872">(Jun 03 2019 at 19:05)</a>:</h4>
<blockquote>
<p>I wouldn't expect much adoption/support for datatype formats that are not widely supported</p>
</blockquote>
<p>Does this push you to conclude we should be using strings for numbers <span class="user-mention" data-user-id="191336">@Michel Rutten</span> ?</p>



<a name="167223988"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167223988" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167223988">(Jun 03 2019 at 19:41)</a>:</h4>
<p>No, actually the opposite - apologies for bad wording.</p>



<a name="167231614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167231614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167231614">(Jun 03 2019 at 21:00)</a>:</h4>
<p>Well <span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span> has been pushing for a <code>fhir+json2</code> mime type for a while :) This would be one more feature to get right.</p>



<a name="167232077"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167232077" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167232077">(Jun 03 2019 at 21:05)</a>:</h4>
<p>"-Does that feel like a reasonable amount of work for a new developer that wants to use FHIR?"</p>
<p>Well, if you use the .NET FHIR API, this is handled for you - if you are writing your own - I think it's now just a simple setting: <a href="https://www.newtonsoft.com/json/help/html/P_Newtonsoft_Json_JsonSerializerSettings_FloatParseHandling.htm" target="_blank" title="https://www.newtonsoft.com/json/help/html/P_Newtonsoft_Json_JsonSerializerSettings_FloatParseHandling.htm">https://www.newtonsoft.com/json/help/html/P_Newtonsoft_Json_JsonSerializerSettings_FloatParseHandling.htm</a></p>
<p>But the <em>default</em> is double, so you'd still have to take care.</p>



<a name="167232371"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167232371" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167232371">(Jun 03 2019 at 21:09)</a>:</h4>
<p>And anyone using standards database support for JSON, etc, might not even be able to control this behavior. What does FHIRBase do here btw <span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span> ?</p>



<a name="167235238"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167235238" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167235238">(Jun 03 2019 at 21:49)</a>:</h4>
<p>Looks like PostgreSQL JSONB preserve  presicion - <code>select ('{"a": 3.00000000}'::jsonb)-&gt;&gt;'a'</code> =&gt; 3.00000000</p>



<a name="167235397"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167235397" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167235397">(Jun 03 2019 at 21:51)</a>:</h4>
<p>Internally in jsonb numbers are represented as numeric type - <a href="https://www.postgresql.org/docs/current/datatype-numeric.html" target="_blank" title="https://www.postgresql.org/docs/current/datatype-numeric.html">https://www.postgresql.org/docs/current/datatype-numeric.html</a></p>



<a name="167235649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167235649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167235649">(Jun 03 2019 at 21:54)</a>:</h4>
<p>In clojure cheshire library we can force bigdecimals.</p>



<a name="167242738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167242738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167242738">(Jun 03 2019 at 23:42)</a>:</h4>
<p>I've been going over this with <span class="user-mention" data-user-id="191315">@Josh Mandel</span>  and we thought we should loop back out with the larger group.<br>
Background: right now the FHIR decimal has no limits on either precision or range (see <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22655" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22655">GF#22655</a>).  The serialization behavior is defined as a union of xs:double and xs:decimal from XML (and listed to be applied to JSON).  Otherwise, the value can be an arbitrarily long list of numbers.  For reference, the xs:decmial is only guaranteed to have 18 digits of precision, and float is standard IEEE 64-bit float.<br>
The Firely API appears to just use the C# decimal (range ±1.0 x 10^28 to ±7.9228 x 10^28, 28-29 significant digits).  Attempting to parse an observation with a value in range for double but not decimal (e.g., 1E31) causes a parsing failure (<span class="user-mention" data-user-id="191328">@Ewout Kramer</span> is this correct?).<br>
In HAPI, decimals are converted to BigDecimal, so it does support arbitrary precision and range.<br>
Additionally, the spec says that decimals may be represented as floats with precision, which would cause rounding errors in many cases (e.g., irrational numbers).  In the cases of required precision, this should be unacceptable.<br>
From what we can tell, the spec indicates that systems must be able to perform calculations with arbitrarily large/small and precise numbers, but could also cap serialization to 18 significant digits.<br>
With that in mind, what are the use cases that we are trying to solve?  What is the intention for required precision and range with this type that would be clinically useful?</p>



<a name="167246300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167246300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167246300">(Jun 04 2019 at 00:51)</a>:</h4>
<p>geolocation is actually the primary use case for very precise decimals. I've not seen observations that are reported to more than 4 significant digits even if the measurements are much more precise, since biological processes rarely justify that - e.g. even your weight and height are constantly changing in the 3rd significant place</p>



<a name="167246308"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167246308" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167246308">(Jun 04 2019 at 00:51)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span> can you find that example? I had a look earlier in this thread and couldn't find it</p>



<a name="167246360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167246360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167246360">(Jun 04 2019 at 00:52)</a>:</h4>
<p>I did add some ludicrous values to check my implementations - but I didn't mean for them to slip out into the real world</p>



<a name="167246893"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167246893" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167246893">(Jun 04 2019 at 01:04)</a>:</h4>
<p>I've asked Tim Bray for comment. I'll report back if he says something interesting / useful</p>



<a name="167273489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167273489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kenneth Myhra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167273489">(Jun 04 2019 at 09:16)</a>:</h4>
<p>observation-decimal is the one with 10^245 as a value, it's still in the example downloads</p>



<a name="167282153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167282153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167282153">(Jun 04 2019 at 11:21)</a>:</h4>
<p>Ok thanks. I’ll fix that</p>



<a name="167293537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167293537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167293537">(Jun 04 2019 at 13:36)</a>:</h4>
<blockquote>
<p>Ok thanks. I'll fix that</p>
</blockquote>
<p>How? Just removing it isn't really a fix -- in my opinion -- if it is actually a valid example. Removing it would just mask the issue.</p>



<a name="167293597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167293597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167293597">(Jun 04 2019 at 13:36)</a>:</h4>
<p>it's not really valid. It was just an edge case I added for testing implementations. I've removed it to 1e-24 instead of 1e-245</p>



<a name="167311954"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167311954" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167311954">(Jun 04 2019 at 16:32)</a>:</h4>
<p>What do you mean by "not really valid"? Picking something like e-24 (which is in the decimal range for c# I think?) means we're not testing ability to handle doubles.</p>



<a name="167312468"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167312468" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167312468">(Jun 04 2019 at 16:38)</a>:</h4>
<p>I think he means "for which we have a valid use-case" - i.e. a number that could be expected - even in an edge case - to appear in a real healthcare resource.</p>



<a name="167312549"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167312549" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167312549">(Jun 04 2019 at 16:39)</a>:</h4>
<p>e-24 is on the molar mass scale, so is theoretically possible.  10^245 is well beyond the countable atoms in the known universe - so not a number we could expect to see a healthcare application sharing.</p>



<a name="167315150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167315150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167315150">(Jun 04 2019 at 17:08)</a>:</h4>
<p>Okay --and I'd say  if we want to limit our spec, we should limit the spec (in addition to the tests/examples).</p>



<a name="167321730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167321730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167321730">(Jun 04 2019 at 18:16)</a>:</h4>
<p>If we can limit the precision (10 digits would allow CT-slices to be individually geo-tagged by lat/lon) and the range based on values expected in a clinical setting (e.g., the 10^24 from above), then we have a type definition we can hold everyone to.</p>
<p>In Java and C#/.Net, having unquoted precision works well (having addressed concerns about blowing up parsers with doubles vs decimals).</p>
<p>Looking at JavaScript, JSON support has been part of the language since 2009 so external parsing libraries have begun to rot.  Dusting one off, I was able to modify it to parse numbers as strings (or decimals, bigdecimals, etc.) and keep precision.  This modified parser results in the expected behavior, but I'm not sure how realistic it is to expect in a production setting (forked and modified ~10 year old unmaintained code).</p>
<p>Looking at Python, JSON has been built-in since 2.6 (also 2009).  The only library with code I found in a quick search was simplejson - which is external version of the internal library used in Python.  It is more complex to modify, but I assume it is doable.  Otherwise, the behavior is the same - decimals are automatically rounded.</p>
<p>I was going to check Swift, but don't have access to a box with it right now.</p>
<p>I would guess that the question then becomes (after defining precision and range), what to do about the JSON format issue.  Knowing that the built-in support in two languages I've already tested fail to maintain precision is worrying.</p>



<a name="167323803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167323803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167323803">(Jun 04 2019 at 18:35)</a>:</h4>
<blockquote>
<p>what to do about the JSON format issue.</p>
</blockquote>
<p>Nothing. It is normative. Cannot and should not be changed.</p>



<a name="167326780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167326780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167326780">(Jun 04 2019 at 19:10)</a>:</h4>
<blockquote>
<p>Nothing. It is normative. Cannot and should not be changed.</p>
</blockquote>
<p>I have to disagree about doing "nothing".</p>
<p>Action items such as adding information/warnings to the "Getting Started" or "FHIR Overview - Developers" are relatively painless and could prevent issues in patient care/safety.  These items could fall under safety recommendations or best practices for popular languages.</p>
<p>Packages provided by the FHIR group (e.g., <a href="https://github.com/FHIR/fhir.js" target="_blank" title="https://github.com/FHIR/fhir.js">https://github.com/FHIR/fhir.js</a> ) should probably be updated to ensure safe handling of data.</p>
<p>These are potential items I thought of in a few minutes [edit], I feel like it would be beneficial to give this some thought.</p>



<a name="167334450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167334450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167334450">(Jun 04 2019 at 20:49)</a>:</h4>
<blockquote>
<blockquote>
<p>what to do about the JSON format issue.</p>
</blockquote>
<p>Nothing. It is normative. Cannot and should not be changed.</p>
</blockquote>
<p>but we can create another one! without breaking existing format</p>



<a name="167334531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167334531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167334531">(Jun 04 2019 at 20:50)</a>:</h4>
<p>And let the future decide, which is more viable</p>



<a name="167336486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167336486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167336486">(Jun 04 2019 at 21:14)</a>:</h4>
<p>FYI, earlier I posted this link to <a href="http://www.json.org/" target="_blank" title="http://www.json.org/">http://www.json.org/</a> that has many (seems like &gt; 50) languages, more than most have even heard of ;-)  -- 8th, OCaml, Pike, etc.   This webpage lists the many different JSON serializers that are 'out there'; wonder how they handle precision (or not)?</p>



<a name="167348206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167348206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167348206">(Jun 05 2019 at 00:55)</a>:</h4>
<p>Hi John, I did see that post the other day.</p>
<p>I've been going back and forth on this internally for some time now.  On the one hand, as long as we communicate the behavior to someone using an obscure language, they should be able to handle it (a danger of using an obscure or new language).  On the other hand, any language adding JSON support is likely going to do so in the ECMA standard way - which we are not.  Swift 4, for example (which I checked this evening) also loses precision on parse.</p>
<p>If we agree that the precision is clinically relevant and the default behavior causes loss of precision, it is quite likely that an incident will occur.  I am particularly concerned about JavaScript in that it is very widely used, has a low technical bar to entry, and uses "standard" JSON internally.</p>
<p>I would like to determine what steps are needed to mitigate or eliminate that before an incident occurs.</p>



<a name="167359459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167359459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167359459">(Jun 05 2019 at 05:28)</a>:</h4>
<p>Comment from Tim Bray:</p>
<blockquote>
<p>Well, I understand the problem, but you're not going to get much help from JSON.  The spec language in <a href="https://tools.ietf.org/html/rfc8259#section-6" target="_blank" title="https://tools.ietf.org/html/rfc8259#section-6">https://tools.ietf.org/html/rfc8259#section-6</a> just talks about "numbers" and points out that trying to interchange anything not representable as an IEEE double is dangerous.  There are many improvements that could be made to JSON, including timestamps and smarter numeric types, but they're not going to happen because JSON is in such universal use that everyone is terrified of any changes whatsoever no matter how small.</p>
<p>So, if you have a numeric quantity in a JSON text, for example your Potassium in serum, you're going to have to find another place to express that semantic for consumption by software.  It's an interesting problem; suppose I wanted to do some fairly large-scale arithmetic on a bunch of Potassium numbers, e.g. statistics.  I assume the proper way to do that would be with normal double-precision floating-point to avoid all the nasty error-accumulation scenarios that can happen if you don't, and then you'd present the result with one digit past the decimal point.  So I guess I'm agreeing that this is a <em>presentational</em> requirement, not an arithmetical one. </p>
<p>Anyhow, I suppose that it's up to the FHIR specs to say "This quantity must always be presented for human consumption thus and so."  I think that, to be safe, you'd also want to express the fact that for purposes of arithmetic, it's a floating-point quantity and should be handled with that in mind.  It would be nice if JSON had a way to express that portably, but it doesn't.</p>
<p>Good luck!</p>
</blockquote>



<a name="167359475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167359475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167359475">(Jun 05 2019 at 05:29)</a>:</h4>
<p>... which is pretty much what we do....</p>



<a name="167374496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167374496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167374496">(Jun 05 2019 at 10:10)</a>:</h4>
<p>TIm's comment, "you're going to have to find another place to express that semantic for consumption by software." is what I've been suggesting.  If we need to convey the semantic of precision, the it has to be declarative in FHIR (i.e. in the datatypes) and not dependent on the (JSON or other) transport or encoding.    I also like his point about, "nasty error-accumulation scenarios", that is one of the main issues with maintaining the proper precision in measurements and calculations based on those measurement --- error accumulation.   Of course FHIR's job is not a 'calculation engine' but it needs to have a mechanism so that consumers of the data do not loose precision because of the FHIR store.</p>
<p>(I like this Wikipedia article about accuracy and precision that points out the problems of maintaining and computing with attention to precision: <a href="https://en.wikipedia.org/wiki/Accuracy_and_precision" target="_blank" title="https://en.wikipedia.org/wiki/Accuracy_and_precision">https://en.wikipedia.org/wiki/Accuracy_and_precision</a> )</p>



<a name="167374720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167374720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167374720">(Jun 05 2019 at 10:15)</a>:</h4>
<p>we don't agree that it needs to be in the datatypes. The fraction of cases where precision is different to the string representation is very small, and all the cases we found were edge cases. We can add precision elements for formats that don't support string representation of decimals - which may or may not include JSON  (but does definitely include protobuf).</p>



<a name="167374780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167374780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167374780">(Jun 05 2019 at 10:16)</a>:</h4>
<p>I don't know how doing anything about this in JSON will play out</p>



<a name="167375087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167375087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167375087">(Jun 05 2019 at 10:22)</a>:</h4>
<p>OK, not in datatypes (though I'm not comfortable with that, I suppose it's too late to do anything about it.)</p>
<p>A somewhat related question, when someone profiles an observation for a particular use case, e.g. a vital sign with a specific LOINC code,  does that also imply a specific unit of measure and therefore a certain precision?   If not, (LOINC code doesn't imply UofM) then different UofMs can cause problems with precision loss, e.g. Kg vs gram or mg vs ng, etc.</p>



<a name="167384779"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167384779" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167384779">(Jun 05 2019 at 12:51)</a>:</h4>
<p>Well, one difference is that Tim says </p>
<blockquote>
<p>to be safe, you'd also want to express the fact that for purposes of arithmetic, it's a floating-point quantity and should be handled with that in mind.</p>
</blockquote>
<p>Whereas our specifications seems to say that you should treat it as an arbitrary precision decimal value. (Or do people disagree with this characterization?)</p>



<a name="167400595"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167400595" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167400595">(Jun 05 2019 at 15:31)</a>:</h4>
<p>Given that we're almost a week into this thread, I would like to ask which way people are leaning on the various items in it.  I am trying to list everything that looks actionable so each item can either be moved forward or left for dead.</p>
<p>This is <em>not</em> formal.  I just feel there has been enough discussion that I would either like to start on proposals or move on.  At the same time, this thread is too long for me to determine what people feel is worthwhile and thought this could give a quick measure.<br>
Thanks!</p>



<a name="167400608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167400608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167400608">(Jun 05 2019 at 15:31)</a>:</h4>
<p>/poll Should there be additional language for developers to be aware of the JSON decimal encoding behavior (e.g., "Getting Started", "FHIR Overview - Developers", Best Practices, etc.)<br>
Yes<br>
No</p>



<a name="167400619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167400619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167400619">(Jun 05 2019 at 15:31)</a>:</h4>
<p>/poll Should there be clarifying language added to the decimal datatype for explicit precision and range requirements<br>
Yes<br>
No</p>



<a name="167400632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167400632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167400632">(Jun 05 2019 at 15:31)</a>:</h4>
<p>/poll Should reference implementations be updated to retain precision by default on platforms where it is currently lost (e.g., fhir.js)<br>
Yes<br>
No</p>



<a name="167400643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167400643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167400643">(Jun 05 2019 at 15:31)</a>:</h4>
<p>/poll Should there be a new extension to provide precision information generally for decimals<br>
Yes<br>
No</p>



<a name="167400654"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167400654" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167400654">(Jun 05 2019 at 15:31)</a>:</h4>
<p>/poll Nuclear options<br>
I see no action items for anything in this thread<br>
I'd like to change the normative JSON encoding<br>
I'd like to add a new JSON serialization model</p>



<a name="167403325"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167403325" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167403325">(Jun 05 2019 at 15:58)</a>:</h4>
<blockquote>
<p>Should reference implementations be updated </p>
</blockquote>
<p>What happens to reference implementation cannot really be decided here - it is up to their maintainers. If someone feels that they need changes the way to go is open issues in their repos (or - even better - pull requests)</p>



<a name="167407881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167407881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167407881">(Jun 05 2019 at 16:50)</a>:</h4>
<p>That's fair, but lots of those maintainers are here listening and answering questions, so the straw poll is still helpful; and they'll be interested in what "best practice" advice we provide in the spec.</p>



<a name="167546254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167546254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167546254">(Jun 07 2019 at 04:33)</a>:</h4>
<p>I added <code>We should consider adding a new property in json for precision</code></p>



<a name="167546279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167546279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167546279">(Jun 07 2019 at 04:34)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> I disagree with your characterisation. The specification makes clear that we have a <em>presentation</em> issue, not an issue with the value itself</p>



<a name="167563580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167563580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167563580">(Jun 07 2019 at 09:59)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  - by "adding a new property in json for precision" do you mean to the datatype (Quantity) definition so that it works for both JSON and XML (and any other representation like Turtle RDF)?   If so, I'm all for it!  (it could look like DV_QUANTITY that OpenEHR defines)</p>
<p>Also, I'm not sure about the presentation vs value issue -- FHIR is not about UIs so I'm not sure how this is a presentation issue.  To me it feels like more of a transport issue (thinking of JSON in FHIR as a transport mechanism) or storage mechanism but since FHIR doesn't prescribe FHIR server persistence mechanisms I suppose it can't be that.  (though many implementations that use noSQL approaches end up storing 'raw JSON' in which case any intended precision is lost or at least not specific -- i.e. by itself how do I know that 10  is supposed to be 10.0 if I'm doing calcs based on JSON stored numbers?)</p>



<a name="167564037"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167564037" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167564037">(Jun 07 2019 at 10:07)</a>:</h4>
<p>there's no reason to add it to XML and I would be very opposed to that. Nor to RDF. We already added it to ProtoBuf, since that uses raw decimals with no string format. So we could add it to JSON though we could not make it mandatory</p>



<a name="167583831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167583831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167583831">(Jun 07 2019 at 14:55)</a>:</h4>
<p>Can you explain / show an example of what you mean <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> re: json property? And agreed with <span class="user-mention" data-user-id="194183">@John Silva</span>  this isn't a presentation issue, only -- it seems like an issue that could cause errors to accumulate (or at least propagate incorrectly) in automated calculations, if numbers aren't handled properly</p>



<a name="167588785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167588785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167588785">(Jun 07 2019 at 15:54)</a>:</h4>
<blockquote>
<p>I added <code>We should consider adding a new property in json for precision</code></p>
</blockquote>
<p>If I understand, I think it would go a long way towards resolving this.  Are you suggesting that:</p>
<div class="codehilite"><pre><span></span>{ &quot;val&quot; : .100, &quot;another&quot; : 1.0 }
</pre></div>


<p>could be serialized to something like:</p>
<div class="codehilite"><pre><span></span>{ &quot;val&quot; : .100, &quot;val_precision&quot; : 3, &quot;another&quot; : 1.0, &quot;another_precision&quot; : 2 }
</pre></div>


<p>The "_precision" field (or whatever was agreed to) would be a field optionally generated during serialization.</p>
<p>It would then be on the client to either parse the original value exactly or use the additional precision information to reconstruct it.</p>
<p>Is that correct?</p>



<a name="167590175"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167590175" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167590175">(Jun 07 2019 at 16:10)</a>:</h4>
<p>I'm not sure that would solve the problem... Off-the-shelf JSON parsers wouldn't know anything about that convention, so they'd still process the field as a regular <code>Number</code>.  I think you'd need dual fields -- one w/ the normal number (for backwards compatibility) and one with the number as a string (to retain precision).  This could be accomplished today via extensions, but perhaps Grahame was thinking of a more streamlined special-case approach.</p>



<a name="167590320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167590320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167590320">(Jun 07 2019 at 16:12)</a>:</h4>
<p>Or perhaps I missed your point.  Now that I look at it again, I suppose that the client could still use an off-the-shelf parser and then use the extra precision information to round the <code>Number</code> appropriately using a non-float representation -- which would hopefully take care of any floating point issues.</p>



<a name="167602691"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167602691" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167602691">(Jun 07 2019 at 18:46)</a>:</h4>
<blockquote>
<p>'raw JSON' in which case any intended precision is lost or at least not specific</p>
</blockquote>
<p>This is not true - if I create an observation with value 3.500 (that specifies the precision) and serialize that using the .NET library I get: <code>{"resourceType":"Observation","valueQuantity":{"value":3.500}}</code> - and if I parse that I get back 3.500 as a fixed point decimal - so JSON can express the precision just fine - the issue is with the parsers (or the underlying languages not supporting fixed point decimals)</p>



<a name="167602758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167602758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167602758">(Jun 07 2019 at 18:47)</a>:</h4>
<p>(and a <code>_precision</code> field is pointless)</p>



<a name="167603740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167603740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167603740">(Jun 07 2019 at 18:58)</a>:</h4>
<p>well, the issue is that JSON is imprecise, so that behavior depends on the libraries choice - they are not wrong to choose that. </p>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> yes that use of precision is what I had in mind based on the example Gino gave. An alternative would be:</p>



<a name="167603873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167603873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167603873">(Jun 07 2019 at 19:00)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="p">{</span> <span class="nt">&quot;val&quot;</span> <span class="p">:</span> <span class="mf">0.100</span><span class="p">,</span> <span class="nt">&quot;val_formatted&quot;</span> <span class="p">:</span> <span class="s2">&quot;0.100&quot;</span><span class="p">,</span>
  <span class="nt">&quot;another&quot;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nt">&quot;another_formatted&quot;</span> <span class="p">:</span> <span class="s2">&quot;1.0&quot;</span> <span class="p">}</span>
</pre></div>


<p>or</p>
<div class="codehilite"><pre><span></span><span class="p">{</span> <span class="nt">&quot;val&quot;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="nt">&quot;val_formatted&quot;</span> <span class="p">:</span> <span class="s2">&quot;0.100&quot;</span><span class="p">,</span>
  <span class="nt">&quot;another&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&quot;another_formatted&quot;</span> <span class="p">:</span> <span class="s2">&quot;1.0&quot;</span> <span class="p">}</span>
</pre></div>



<a name="167603915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167603915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167603915">(Jun 07 2019 at 19:00)</a>:</h4>
<p>I'm not sure which I prefer. we could define it, but we couldn't make it mandatory</p>



<a name="167607820"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167607820" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167607820">(Jun 07 2019 at 19:46)</a>:</h4>
<blockquote>
<p>or</p>
<div class="codehilite"><pre><span></span><span class="p">{</span> <span class="nt">&quot;val&quot;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="nt">&quot;val_formatted&quot;</span> <span class="p">:</span> <span class="s2">&quot;0.100&quot;</span><span class="p">,</span>
  <span class="nt">&quot;another&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&quot;another_formatted&quot;</span> <span class="p">:</span> <span class="s2">&quot;1.0&quot;</span> <span class="p">}</span>
</pre></div>


</blockquote>
<p>That one would work well for JavaScript, which does not keep track of trailing zeros.</p>



<a name="167608847"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167608847" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167608847">(Jun 07 2019 at 19:59)</a>:</h4>
<p>If JSON parser supports precision, let's provide it as well  <code>{"val": 0.100, "val_formated": "0.100"}</code>; Puting all these attributes on the same level again create similar problems as primitive extensions and choice types :(  Another representation hack can be "val": [0.1, "0.1000"], but probably to solve all of these problems it should be like this <code>{"attr": {"value": ....., extensions, presicion}}</code></p>



<a name="167610420"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167610420" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167610420">(Jun 07 2019 at 20:17)</a>:</h4>
<p>We can't break the existing JSON syntax.  Whatever we do has to remain valid against that.  Introducing a new JSON syntax would effectively mean everyone would need to support both, so that's not really on the table.</p>



<a name="167612622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167612622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167612622">(Jun 07 2019 at 20:47)</a>:</h4>
<p>From the perspective of processing or generating a FHIR resource, I don't see much difference between having to handle new versions of FHIR (handling differences between STU3 and R4) and handling a new version of the JSON format.  I don't see why an "R6" couldn't introduce changes to the JSON format to handle this and other problems.  It would just a part of the pain updating to R6.</p>



<a name="167612631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167612631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167612631">(Jun 07 2019 at 20:47)</a>:</h4>
<p>Or to be more consistent w/ the current FHIR/JSON serialization approach:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span> <span class="nt">&quot;val&quot;</span> <span class="p">:</span> <span class="mf">0.100</span><span class="p">,</span> <span class="nt">&quot;_val&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;formatted&quot;</span> <span class="p">:</span> <span class="s2">&quot;0.100&quot;</span> <span class="p">},</span>
  <span class="nt">&quot;another&quot;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nt">&quot;_another&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;formatted&quot;</span> <span class="p">:</span> <span class="s2">&quot;1.0&quot;</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>


<p>This would probably be less impact on implementors since they already need to check for the existence of <code>"_val"</code> anyway to support ids and extensions.</p>



<a name="167612767"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167612767" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167612767">(Jun 07 2019 at 20:49)</a>:</h4>
<p>I think we can't change the JSON syntax in R6 (or R-anything) because the JSON serialization is now <em>normative</em>.  Breaking changes are off the table.  We can only do additive non-breaking changes.</p>



<a name="167621721"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167621721" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167621721">(Jun 07 2019 at 23:19)</a>:</h4>
<p><span class="user-mention" data-user-id="195344">@Paul Lynch</span> The difference is that in R4 we moved certain things to normative.  While there will indeed be pain in moving from R4 to R5 for all of the things that <em>aren't</em> normative, the whole point of normative is that at that point (for those things) the pain stops.  (The eventual objective being that the pain stops for everything.)</p>



<a name="167764331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167764331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167764331">(Jun 10 2019 at 14:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> That is a helpful explanation.  However, if issues begin to pile up with something called "normative", there must be some point where it is better to the fix the problems than to preserve stability.  (Perhaps we haven't reach that point yet.)</p>



<a name="167770875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/167770875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#167770875">(Jun 10 2019 at 15:53)</a>:</h4>
<p>It would have to be badly broken indeed for the entire community to agree to the transition.  It's not something we have plans to do and certainly not something we'd entertain lightly.  Our general expectation is that once something is normative, any issues get worked around with changes that align with FHIR's interversion compatibility rules and/or extensions.</p>



<a name="237487303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/237487303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mona O <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#237487303">(May 05 2021 at 12:36)</a>:</h4>
<p>For Money.value the description states with implicit precision does that mean precision is implied based on currency code? For monetary amounts is it required to include trailing zeros?  Looking at various examples within FHIR there doesn't seem to be a consistency.  Are these considered all valid based on currency code of "USD" : 15, 15.0, 15.5?  Or should they be reflected as 15.00, 15.50?</p>



<a name="237519506"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/237519506" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#237519506">(May 05 2021 at 15:53)</a>:</h4>
<p>Hmm.  I think money generally has an implicit precision of 2 decimal places.  I.e. If you say $15, that <em>most</em> of the time, $15.01 would be wrong.  (Though there are contexts where rounding happens and $15 actually represents $14.98 or $15.23.)  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>, do you think we need any special guidance around precision when it comes to monetary amounts?</p>



<a name="237558627"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/237558627" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#237558627">(May 05 2021 at 20:17)</a>:</h4>
<p>I don't think we want to say anything about it, honestly.</p>



<a name="237559877"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/237559877" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Silva <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#237559877">(May 05 2021 at 20:27)</a>:</h4>
<p>Hopefully YOUR bank doesn't use only 2 digits of precision (and keep any fractional difference) <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span><br>
(many financial transactions of course use multiplication and division which can introduce imprecision and round-off -- yeh, probably always in the favor of the financial institution! )</p>



<a name="237567289"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/237567289" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Daryl Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#237567289">(May 05 2021 at 21:10)</a>:</h4>
<p>From what I know, most err on the side of the customer as they can get in big legal trouble and fractions of a penny is much cheaper then the legal fees, but that's getting off topic</p>



<a name="237569191"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/JSON%20decimals/near/237569191" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/JSON.20decimals.html#237569191">(May 05 2021 at 21:17)</a>:</h4>
<p>right. it's a complicated area, but at least in interop, there's no transferring fractions of a cent. However: the less we can say about this, the less we can get in trouble for what we say</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
