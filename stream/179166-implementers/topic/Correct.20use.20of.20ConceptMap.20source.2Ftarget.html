---
layout: page
title: "FHIR Chat  · Correct use of ConceptMap source/target · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html">Correct use of ConceptMap source/target</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="262307164"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/262307164" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niek van Galen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#262307164">(Nov 22 2021 at 11:31)</a>:</h4>
<p>In the Dutch realm, we use ConceptMap resources to map codes from one ValueSet to the other. Mostly used on elements where the FHIR core ValueSet has a required binding but our information models (after this: zib) use a different (or broader) set of (required) concepts. </p>
<p>Our current ConceptMaps all define the zib ValueSet as <code>.source</code> and the FHIR core ValueSet as <code>.target</code>. A way of looking at this is from the perspective of a system that translates from data entered by a user in zib format and exchanged in FHIR format. We also make use of the <a href="http://hl7.org/fhir/StructureDefinition/concept-bidirectional">concept-bidirectional</a> extension to indicate that the mappings can be reversed, or not.</p>
<p>On elements/ValueSets where ConceptMaps apply, we add the <a href="https://www.hl7.org/fhir/extension-11179-permitted-value-conceptmap.html">permitted-value-conceptmap</a> extension which states: </p>
<blockquote>
<p>The source for the concept map is the value set the extension appears on. The target is the permitted-value-valueset.</p>
</blockquote>
<p>This indicates that the way we design our ConceptMaps now is "the wrong way around". However, this is based on just the comment in the extension. The <a href="https://www.hl7.org/fhir/conceptmap.html">ConceptMap resource</a> makes no specific statements on source and target. </p>
<p>Before we  make the effort of converting all of our ConceptMaps: can someone help us out? We would like to know if there is consensus or any best practices on the use of ConceptMaps for use cases like ours?</p>



<a name="262335977"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/262335977" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#262335977">(Nov 22 2021 at 15:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="262417306"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/262417306" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#262417306">(Nov 23 2021 at 06:21)</a>:</h4>
<p>you know, I'm not sure of the answer to this. I don't recall the discussion around making the definition of permitted-value-conceptmap so directional (and in a way that doesn't really feel right to me either). I expect that I defined it, and early, though it's possible that <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> did. Though since he tagged me... probably it wasn't him.</p>



<a name="262417500"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/262417500" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#262417500">(Nov 23 2021 at 06:25)</a>:</h4>
<p>but also , the 11179 definition of permitted value isn't quite what you're doing. So I wonder whether you should do what you suggest. </p>
<p>Anyway, here's the options I think you have </p>
<ol>
<li>ask HL7 to change the definition of the extension (might not be possible - constrained by 11179)</li>
<li>ask HL7 to define an alternative extension that isn't encumbered by 11179-ness</li>
<li>define your own extension</li>
<li>flip your concept maps over </li>
<li>do what I did in this <a href="https://github.com/HealthIntersections/australian-fhir-support/blob/main/fhir/ConceptMap/covid-cvx-air-mapping.json">value set</a>, and have it both ways rather than using the bi-directional extension. </li>
</ol>
<p>Honestly, I prefer 5. It means that if suddenly you run into a screwy mapping which isn't quite the same both ways, you don't need to restructure. Sure, it's more verbose (less than I thought at first because you also drop the extension URL), but it's also computationally simpler. Are you concept maps so big that the increase in size matters that much?</p>



<a name="262417569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/262417569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#262417569">(Nov 23 2021 at 06:26)</a>:</h4>
<p>though you could do 1|2|3 as well as 5 too</p>



<a name="262448984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/262448984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niek van Galen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#262448984">(Nov 23 2021 at 12:32)</a>:</h4>
<p>Doing option 5 does make a lot of sense, the increase in size won't matter imho. Thanks <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>, I'll discuss this with the Nictiz team.</p>



<a name="262464516"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/262464516" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#262464516">(Nov 23 2021 at 14:42)</a>:</h4>
<p>If you're not doing 11179, you shouldn't be using permitted-value-conceptmap.  It's about converting between "what you share" and "what you store" - which I don't think is what you're doing.</p>



<a name="269114054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/269114054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niek van Galen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#269114054">(Jan 24 2022 at 14:37)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> a (delayed) question regarding option 5:<br>
The <a href="https://github.com/HealthIntersections/australian-fhir-support/blob/main/fhir/ConceptMap/covid-cvx-air-mapping.json">ConceptMap you mention</a> does not contain a source[x] and target[x]. However, the definition of source[x] states: "If there is no source or target value set, there is no specified context for the map (not recommended)."</p>
<p>I can imagine that source[x] and target[x] are absent because the mapping is bidirectional thus it's hard to point either a source or a target because they can be both, however it would in my opinion be preferable to reference the ValueSets the ConceptMap is designed for. What's your opinion on that?</p>
<p>Also created an example of a bidirectional ConceptMap where source[x] and target[x] ValueSets are not included anymore (which feels a bit odd imho): <a href="https://github.com/Nictiz/Nictiz-R4-zib2020/blob/195/resources/zib/terminology/conceptmap-GeslachtCodelijst-to-AdministrativeGender.xml">https://github.com/Nictiz/Nictiz-R4-zib2020/blob/195/resources/zib/terminology/conceptmap-GeslachtCodelijst-to-AdministrativeGender.xml</a></p>



<a name="271040814"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/271040814" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#271040814">(Feb 07 2022 at 20:58)</a>:</h4>
<p><span class="user-mention" data-user-id="198646">@Niek van Galen</span> a (delayed) answer:</p>
<p>That's a reasonable question and I don't really know the answer. But I think we could assume that the source and target are implicitly reversible if the map contains both directions. I don't really like that answer a lot, but I don't have a better one</p>



<a name="271097031"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/271097031" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niek van Galen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#271097031">(Feb 08 2022 at 08:52)</a>:</h4>
<p>Sounds like a possible outcome, which we might want to document on the <code>purpose</code> element of the ConceptMap. Can you take this in consideration for the improvement of the ConceptMap resource?</p>



<a name="271106305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/271106305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#271106305">(Feb 08 2022 at 10:16)</a>:</h4>
<p>yes we can but it would be great if you create the task for that and reference this dsicussion</p>



<a name="271707682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Correct%20use%20of%20ConceptMap%20source/target/near/271707682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niek van Galen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Correct.20use.20of.20ConceptMap.20source.2Ftarget.html#271707682">(Feb 12 2022 at 20:15)</a>:</h4>
<p>Task is created: <a href="https://jira.hl7.org/browse/FHIR-36020">https://jira.hl7.org/browse/FHIR-36020</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
