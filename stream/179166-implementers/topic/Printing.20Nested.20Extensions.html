---
layout: page
title: "FHIR Chat  · Printing Nested Extensions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html">Printing Nested Extensions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="168530716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168530716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tia Cummings <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168530716">(Jun 19 2019 at 18:06)</a>:</h4>
<p>We're trying to implement nested extensions:</p>
<div class="codehilite"><pre><span></span>   Extension pop = new Extension().setUrl(StringValues.MEMBER_POPULATIONS.getValue()).setValue(new IntegerType(index));
    if (StringUtils.isNotBlank(memberPopulation.getPopulationId())) {
        pop.addExtension(StringValues.POPULATION_ID.getValue(), new StringType(memberPopulation.getPopulationId()));
    }
    if (StringUtils.isNotBlank(memberPopulation.getPopulationRuleName())) {
        pop.addExtension(StringValues.POPULATION_RULE_NAME.getValue(), new StringType(memberPopulation.getPopulationRuleName()));
    }

    if (null != memberPopulation.getStartDate() || null != memberPopulation.getEndDate()) {
        pop.addExtension(StringValues.DATES.getValue(), new Period().setStart(null != memberPopulation.getStartDate() ? memberPopulation.getStartDate().getTime() : null)
                .setEnd(null != memberPopulation.getEndDate() ? memberPopulation.getEndDate().getTime() : null));
    }
    if (null != memberPopulation.getMemberPopAssociationDateTime()) {
        pop.addExtension(StringValues.MEMBER_POP_ASSOCIATION_DATE_TIME.getValue(), new DateTimeType(memberPopulation.getMemberPopAssociationDateTime()));
    }
    patient.addExtension(pop);
</pre></div>


<p>But our FhirServer and our JsonParser doesn't print out the nested extensions. It only prints out the parent extension.</p>
<p>Any insights on this? Maybe there is a setting that needs to be turned on.</p>



<a name="168544119"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168544119" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168544119">(Jun 19 2019 at 20:45)</a>:</h4>
<p>What library are you using?</p>



<a name="168590165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168590165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tia Cummings <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168590165">(Jun 20 2019 at 12:23)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> we're using hapi fhir dependencies for R4 in java</p>



<a name="168590590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168590590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168590590">(Jun 20 2019 at 12:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> ?</p>



<a name="168600463"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168600463" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168600463">(Jun 20 2019 at 14:28)</a>:</h4>
<p>That code looks correct. Are you sure that all of the if statements are actually hitting, and the nested extensions are being correct?</p>
<p>If so, can you try posting a code snipped using constants (e.g. <code>"foo"</code>) instead of externally defined variables that isn't behaving the way you expect?</p>



<a name="168601434"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168601434" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tia Cummings <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168601434">(Jun 20 2019 at 14:39)</a>:</h4>
<p>Yes, all of those if statements are being hit. When I run the code in debug mode, I can see that the parent extension has 4 extensions</p>



<a name="168868625"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168868625" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tia Cummings <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168868625">(Jun 24 2019 at 17:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> ???</p>



<a name="168882573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168882573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168882573">(Jun 24 2019 at 20:29)</a>:</h4>
<p><span class="user-mention" data-user-id="196682">@Tia Cummings</span>  OK- Can you try posting a code snippet using constants (e.g. "foo") instead of externally defined variables that isn't behaving the way you expect?</p>
<p>The code snippet you provided isn't something that could be run easily but you because it relies on variables from your application (e.g. "memberpopulation"). If you replace all of these with constants (e.g. <code>"foo"</code>) I might be able to help.</p>



<a name="168883348"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168883348" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tia Cummings <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168883348">(Jun 24 2019 at 20:40)</a>:</h4>
<p>Extension pop = new Extension().setUrl("memberPopulations").setValue(new IntegerType(1));<br>
       if (StringUtils.isNotBlank("population id")) {<br>
           pop.addExtension("populationId", new StringType("population id"));<br>
      }<br>
       if (StringUtils.isNotBlank("population rule name)) {<br>
           pop.addExtension("populationRuleName", new StringType("population rule name));<br>
      }<br>
       patient.addExtension(pop);</p>



<a name="168883755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168883755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168883755">(Jun 24 2019 at 20:46)</a>:</h4>
<p><span class="user-mention" data-user-id="196682">@Tia Cummings</span>  Ahh I see it: The issue is that you're setting both a value and child extensions your your root extension (<code>pop</code>). You can't have both according to FHIR's rules, so the value takes presedence in HAPI's encoding rules. We should probably emit a warning in that case...</p>



<a name="168933208"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Printing%20Nested%20Extensions/near/168933208" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tia Cummings <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Printing.20Nested.20Extensions.html#168933208">(Jun 25 2019 at 12:27)</a>:</h4>
<p>Oooohh. That's actually better. Thanks, I'll try that</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
