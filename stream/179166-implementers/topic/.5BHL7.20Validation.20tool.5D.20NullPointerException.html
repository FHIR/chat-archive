---
layout: page
title: "FHIR Chat  · [HL7 Validation tool] NullPointerException · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html">[HL7 Validation tool] NullPointerException</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="222723781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%5BHL7%20Validation%20tool%5D%20NullPointerException/near/222723781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Simons <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html#222723781">(Jan 14 2021 at 14:28)</a>:</h4>
<p>Getting a NullPointerException upon Snapshot generation with the HL7Validation tool 5.1.16 (using FHIR R4 profiles on top of Observation)</p>
<p>BASEDEFINITION HAS:<br>
   &lt;element id="Observation.value[x]:valueQuantity.code"&gt;<br>
      &lt;path value="Observation.value[x].code" /&gt;<br>
      &lt;binding&gt;<br>
        &lt;strength value="required" /&gt;<br>
        &lt;valueSet value="<a href="http://hl7.org/fhir/ValueSet/ucum-vitals-common">http://hl7.org/fhir/ValueSet/ucum-vitals-common</a>" /&gt;<br>
      &lt;/binding&gt;<br>
    &lt;/element&gt;</p>
<p>THIS WORKS on the derived profile:<br>
    &lt;element id="Observation.value[x]:valueQuantity.code"&gt;<br>
      &lt;path value="Observation.value[x].code" /&gt;<br>
      &lt;fixedCode value="Cel" /&gt;<br>
    &lt;/element&gt;</p>
<p>REPLACING BY THIS THROWS NULLPOINTEREXCEPTION on the Derived profile<br>
    &lt;element id="Observation.value[x]:valueQuantity.code"&gt;<br>
      &lt;path value="Observation.value[x].code" /&gt;<br>
      &lt;binding&gt;<br>
        &lt;strength value="required" /&gt;<br>
        &lt;valueSet value="<a href="http://hl7.org/fhir/ValueSet/ucum-bodytemp">http://hl7.org/fhir/ValueSet/ucum-bodytemp</a>" /&gt;<br>
      &lt;/binding&gt;<br>
    &lt;/element&gt;</p>
<p>We're at loss... since the profiles do validate and work fine in Simplifier and IG Publisher snapshot generation. A bug?</p>
<p>I can supply the full profiles.</p>
<p>FHIR Validation tool Version 5.1.16 (Git# ea0b4c0c1c10). Built 2020-10-01T04:39:09.65Z (105 days old)<br>
  Java:   15 from /usr/java/openjdk-15 on amd64 (64bit). 4012MB available<br>
  Paths:  Current = /usr/data/npmpackage/package, Package Cache = /root/.fhir/packages<br>
  Params: ./BodyTemperatureVitalSign.structuredefinition.xml -ig /usr/data/npmpackage/package -tx n/a -version 4.0 -snapshot -output /usr/data/npmpackage/package_snapshots/./BodyTemperatureVitalSign.structuredefinition.xml<br>
Loading<br>
  Load FHIR v4.0 from hl7.fhir.r4.core#4.0.1 - 4575 resources (00:05.0209)<br>
  Terminology server null - Version n/a: No Terminology Server (00:00.0000)<br>
  Load /usr/data/npmpackage/package - 179 resources (00:00.0348)<br>
  Get set...  go (00:00.0765)<br>
Exception in thread "main" java.lang.NullPointerException: Cannot invoke "java.util.List.add(Object)" because "this.messages" is null<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.updateFromDefinition(ProfileUtilities.java:2717)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1088)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1521)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:985)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:985)<br>
    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:572)<br>
    at org.hl7.fhir.validation.ValidationEngine.snapshot(ValidationEngine.java:1597)<br>
    at org.hl7.fhir.validation.cli.services.ValidationService.generateSnapshot(ValidationService.java:119)<br>
    at org.hl7.fhir.validation.Validator.main(Validator.java:198)</p>



<a name="222724223"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%5BHL7%20Validation%20tool%5D%20NullPointerException/near/222724223" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html#222724223">(Jan 14 2021 at 14:31)</a>:</h4>
<p>as questions about the IG publisher on the <a class="stream" data-stream-id="179252" href="/#narrow/stream/179252-IG-creation">#IG creation</a> stream will get best results</p>



<a name="222724544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%5BHL7%20Validation%20tool%5D%20NullPointerException/near/222724544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html#222724544">(Jan 14 2021 at 14:34)</a>:</h4>
<p>so you are trying to constrain the UCUM codes to just the body temperature ones?   Have you tried changing your vocabulary url root to <a href="http://terminology.hl7.org">http://terminology.hl7.org</a>?</p>



<a name="222725093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%5BHL7%20Validation%20tool%5D%20NullPointerException/near/222725093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Simons <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html#222725093">(Jan 14 2021 at 14:37)</a>:</h4>
<p>thanks <span class="user-mention" data-user-id="191404">@John Moehrke</span></p>
<p>yes indeed, the derived profile for BodyTemperatureVitalSign.structuredefinition constrains the VitalSign.structuredefinition further down.</p>
<p>Note that if I copy the &lt;valueSet value="<a href="http://hl7.org/fhir/ValueSet/ucum-bodytemp">http://hl7.org/fhir/ValueSet/ucum-bodytemp</a>" /&gt; to the baseDefinition (parent), it resolves just fine.</p>
<p>Seems to relate to the overwriting of the parent valueSet binding with a (narrower, subset) valueSet binding - and more a bug than a profiling error (to me :))</p>
<p>where would I make that change on url root to <a href="http://terminology.hl7.org">http://terminology.hl7.org</a>? ? (in what tool, specifically) did you mean via hl7validator -tx ?</p>
<p>PS: this is rather about profiling and HL7Validation tool - should I use <a class="stream" data-stream-id="179239" href="/#narrow/stream/179239-tooling">#tooling</a> ?</p>



<a name="222771891"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%5BHL7%20Validation%20tool%5D%20NullPointerException/near/222771891" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html#222771891">(Jan 14 2021 at 19:41)</a>:</h4>
<p><a class="stream" data-stream-id="179239" href="/#narrow/stream/179239-tooling">#tooling</a> is legit, but <a class="stream" data-stream-id="179252" href="/#narrow/stream/179252-IG-creation">#IG creation</a> is most active for validator issues (because that's where a <em>whole</em> lot of them manifest :)</p>



<a name="222848053"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%5BHL7%20Validation%20tool%5D%20NullPointerException/near/222848053" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Simons <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html#222848053">(Jan 15 2021 at 11:55)</a>:</h4>
<p>oh wow... looks like the culprit is indeed due to our validation not including a terminology server access  -- removing -tx n/a - which we had done for reliability of our build pipeline - resolves the above issue apparently!  </p>
<p>still not good that this throws a nullpointerexception - rather than an error message <br>
there's a lot of uncaught  this.messages.add() calls that do not filter on (this.messages != null) in the code, at a glance.</p>
<p>thanks for thinking along!</p>



<a name="222911871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%5BHL7%20Validation%20tool%5D%20NullPointerException/near/222911871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html#222911871">(Jan 15 2021 at 19:28)</a>:</h4>
<p>I agree that NPEs shouldn't happen. How do I reproduce this?</p>



<a name="223151041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%5BHL7%20Validation%20tool%5D%20NullPointerException/near/223151041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Simons <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException.html#223151041">(Jan 18 2021 at 18:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException/near/222911871">said</a>:</p>
<blockquote>
<p>I agree that NPEs shouldn't happen. How do I reproduce this?</p>
</blockquote>
<p>Thanks <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> will send you a set of profiles soon - peeling it out of our buld pipeline now.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
