---
layout: page
title: "FHIR Chat  · Relational Data representation &amp; aggregation · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html">Relational Data representation &amp; aggregation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="181049703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181049703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181049703">(Nov 18 2019 at 19:52)</a>:</h4>
<p>If I store Observation like vitals in a relational database i.e. a <strong>Vitals</strong> table with columns <br>
like <em>systolic</em>, <em>diastolic</em>, <em>o2_saturation</em>, <em>head_circumference</em>, <em>respiratory_rate</em> etc with <br>
timestamps columns (<em>created_at</em>, <em>updated_at</em>) and foreign keys (<em>patient_id</em>, <em>hospital_id</em>)</p>
<p>And I receive one <strong>Observation</strong> resource per vital sign i.e. one reading (systolic only) <br>
in one Observation resource and one reading (oxygen saturation only) in another Observation and so on.</p>
<p>Then I am storing possibly one attribute per record say systolic in one record, <br>
diastolic in another record, respiratory_rate in another record and <br>
oxygen saturation in another record. So I will have total of 4 records. Like this</p>
<table>
<thead>
<tr>
<th>Diastolic</th>
<th align="center">Systolic</th>
<th align="right">O2_Saturation</th>
<th align="right">Respiratory_Rate</th>
<th align="right">Created_At</th>
</tr>
</thead>
<tbody>
<tr>
<td>90</td>
<td align="center"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right">2019-11-18 17:56:25.210201</td>
</tr>
<tr>
<td></td>
<td align="center">132</td>
<td align="right"></td>
<td align="right"></td>
<td align="right">2019-11-18 17:56:55.220904</td>
</tr>
<tr>
<td></td>
<td align="center"></td>
<td align="right"></td>
<td align="right">39</td>
<td align="right">2019-11-18 17:57:05.230107</td>
</tr>
<tr>
<td></td>
<td align="center"></td>
<td align="right">71</td>
<td align="right"></td>
<td align="right">2019-11-18 17:58:45.240203</td>
</tr>
</tbody>
</table>
<p>What is the best way then to aggregate these 4 records in to "1 record" showing <br>
latest vitals, like this</p>
<table>
<thead>
<tr>
<th>Diastolic</th>
<th align="center">Systolic</th>
<th align="right">O2_Saturation</th>
<th align="right">Respiratory_Rate</th>
<th align="right">Created_At</th>
</tr>
</thead>
<tbody>
<tr>
<td>90</td>
<td align="center">132</td>
<td align="right">71</td>
<td align="right">39</td>
<td align="right">2019-11-18 17:58:45.240203</td>
</tr>
</tbody>
</table>



<a name="181049719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181049719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181049719">(Nov 18 2019 at 19:52)</a>:</h4>
<p>The above ^ is obviously simplified for purposes of asking this question, but in real world there will be more columns and bigger spread of these fragments of data that would need aggregation.</p>



<a name="181049818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181049818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181049818">(Nov 18 2019 at 19:54)</a>:</h4>
<p>Or is there a better way to store and retrieve data in Observation resource</p>



<a name="181049823"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181049823" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181049823">(Nov 18 2019 at 19:54)</a>:</h4>
<p>well, that depends. why are you aggregating, and what are you doing about the differing time stamps (and other metadata?)</p>



<a name="181049883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181049883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181049883">(Nov 18 2019 at 19:55)</a>:</h4>
<blockquote>
<p>well, that depends. why are you aggregating, and what are you doing about the differing time stamps (and other metadata?)</p>
</blockquote>
<p>I am aggregating the data because the end user (clinicians) want to view the latest Vitals</p>



<a name="181049911"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181049911" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181049911">(Nov 18 2019 at 19:55)</a>:</h4>
<p>The different timestamps per field/column is another concern to represent in the view</p>



<a name="181050041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181050041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181050041">(Nov 18 2019 at 19:57)</a>:</h4>
<p>it seems to me to be bad data base management to collapse these things into a sparsely populated or loosely tracked table with time uncertainties. I'd have a single table with code/value... mostly that's what we all do (but by no means all of us)</p>



<a name="181050549"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181050549" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181050549">(Nov 18 2019 at 20:02)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  You are right about bad schema here. So in your opinion it will be better to represent Vitals table as </p>
<table>
<thead>
<tr>
<th>Code</th>
<th align="center">Value</th>
<th align="right">Created_At</th>
</tr>
</thead>
<tbody>
<tr>
<td>8383-53</td>
<td align="center">132</td>
<td align="right">2019-11-18 17:58:45.240203</td>
</tr>
<tr>
<td>8112-21</td>
<td align="center">90</td>
<td align="right">2019-11-18 17:56:45.240203</td>
</tr>
</tbody>
</table>



<a name="181051321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181051321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181051321">(Nov 18 2019 at 20:12)</a>:</h4>
<blockquote>
<p>I'd have a single table with code/value... mostly that's what we all do (but by no means all of us)</p>
</blockquote>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> How would you convert these code/value columns into humanly understandable format like</p>
<table>
<thead>
<tr>
<th>Diastolic</th>
<th align="center">Systolic</th>
<th align="right">O2_Saturation</th>
<th align="right">Respiratory_Rate</th>
</tr>
</thead>
<tbody>
<tr>
<td>90</td>
<td align="center">132</td>
<td align="right">71</td>
<td align="right">39</td>
</tr>
</tbody>
</table>



<a name="181051357"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181051357" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181051357">(Nov 18 2019 at 20:12)</a>:</h4>
<p>Any pointers will be much appreciated</p>



<a name="181051497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181051497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181051497">(Nov 18 2019 at 20:14)</a>:</h4>
<p>code/value table with a important fields code, date/time, value, units</p>



<a name="181051997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181051997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181051997">(Nov 18 2019 at 20:21)</a>:</h4>
<p>Yes I agree units and date/time are important too</p>
<p>Though I am having hard time imagining  an simple transposition of these records into a different Object representation like</p>
<table>
<thead>
<tr>
<th>Diastolic</th>
<th align="center">Systolic</th>
<th align="right">O2_Saturation</th>
<th align="right">Respiratory_Rate</th>
</tr>
</thead>
<tbody>
<tr>
<td>90</td>
<td align="center">132</td>
<td align="right">71</td>
<td align="right">39</td>
</tr>
</tbody>
</table>
<p>The Object boundary being represented by the last attribute which in real world may be the 10th or 15th attribute to fill all those attributes at least 15 records will be read</p>



<a name="181052080"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181052080" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181052080">(Nov 18 2019 at 20:22)</a>:</h4>
<p>right.</p>



<a name="181060798"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181060798" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181060798">(Nov 18 2019 at 21:55)</a>:</h4>
<p>Most systems just grab the most recent values for each and display them or group them based on time proximity over time.  The data transmission layers and storage layers pretty much all do one record per measurement and displays such as yours are pretty common.  FHIR <em>does</em> allow 'grouping' Observations that can link a bunch of vitals (or other Observations) that were conducted more or less at the same time, so that could form a foundation for what you're trying to do - but the end result would be yet one more Observation type in the collection of Observations you bring back.  (It would however make it easier to figure out what to group together - provided the source system does the grouping for you.)</p>



<a name="181061467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181061467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181061467">(Nov 18 2019 at 22:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> Thanks. Is there any reference that I can read up on "grouping" Observations? Also, are other resources groupable too?</p>
<p>Grouping by time proximity is a hit or a miss, depending on length of time. If the length of time is big then too many records are read. If length of time is too small than query has to be retried with a larger time interval. Seems like a common pattern to me, but is there any kind of utility built around this pattern.</p>



<a name="181061576"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181061576" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181061576">(Nov 18 2019 at 22:06)</a>:</h4>
<p>Observation has a hasMember relationship.  A few other resources have an equivalent mechanism (e.g. Encounter.partOf).  There's a brief discussion here: <a href="http://hl7.org/fhir/observation.html#obsgrouping" target="_blank" title="http://hl7.org/fhir/observation.html#obsgrouping">http://hl7.org/fhir/observation.html#obsgrouping</a></p>



<a name="181064842"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181064842" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181064842">(Nov 18 2019 at 22:50)</a>:</h4>
<p>The observation you'd want to group would typically have the same <code>effective[x]</code> - so group by the corresponding column</p>



<a name="181065404"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181065404" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181065404">(Nov 18 2019 at 22:59)</a>:</h4>
<p>The challenge is that they often won't have <em>exactly</em> the same effective[x].  So some logic is needed to realize that if there were three done only a couple of minutes apart, you probably want either the latest or the average.  Whereas if they were further apart, they might deserve a separate row.</p>



<a name="181139534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181139534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181139534">(Nov 19 2019 at 18:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> You captured it right but that's not the only challenge. For me (and I am sure for many) the challenge is what range of time to use to query the latest values e.g. last 1 or 2 hours or more ??? coz longer the patient's stay in hospital longer can be range for certain observations. As an example in Vital-Signs category body height and weight may not be observed more than once for total length of patient's stay, but heart rate / blood pressure may be observed every minute. So to fetch the latest Vitals comprising of attributes measured at different times (hours or days apart) e.g. body weight and say blood pressure .... there isn't a generic SQL query one can write.</p>



<a name="181139654"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181139654" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181139654">(Nov 19 2019 at 18:24)</a>:</h4>
<p>Further complexity in SQL query arises when you want to limit the number of rows fetched, say the limit is 1 then (using the above use case) the Vitals record fetched will only have blood pressure and heart rate readings but not height and body weight readings.</p>



<a name="181140020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181140020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181140020">(Nov 19 2019 at 18:28)</a>:</h4>
<p>Take a look at the $lastn operation</p>



<a name="181140043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181140043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181140043">(Nov 19 2019 at 18:28)</a>:</h4>
<p>It let's you grab the most recent "N" measurements of all of the specified observation types</p>



<a name="181140675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181140675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181140675">(Nov 19 2019 at 18:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> Please correct me if I am wrong but Isn't <code>$lastn</code> operation FHIR server implementation dependent?  plus I don't have FHIR server of any kind my application receives FHIR resources (from Mirth HL7v2.3 messages transformed to FHIR) and stores the original JSON blob plus stores all codes and values in relational database as below (table structure simplified here)</p>
<table>
<thead>
<tr>
<th>Code</th>
<th align="center">Value</th>
<th align="right">Created_At</th>
</tr>
</thead>
<tbody>
<tr>
<td>8383-53</td>
<td align="center">132</td>
<td align="right">2019-11-18 17:58:45.240203</td>
</tr>
<tr>
<td>8112-21</td>
<td align="center">90</td>
<td align="right">2019-11-18 17:51:45.240203</td>
</tr>
</tbody>
</table>
<p>So the question is really how to implement <code>$lastn</code> in absence of FHIR server in SQL queries.</p>



<a name="181141042"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181141042" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181141042">(Nov 19 2019 at 18:38)</a>:</h4>
<p>You may need separate searches for each code.  Not sure if there's a better way to write the SQL.</p>



<a name="181141246"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181141246" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181141246">(Nov 19 2019 at 18:41)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  Ok. How does FHIR spec implementation guide suggest <code>$lastn</code> be implemented if not in SQL then what's the assumed data/storage model?</p>



<a name="181143482"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181143482" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181143482">(Nov 19 2019 at 19:03)</a>:</h4>
<p>How is up to the implementer.  FHIR doesn't define what the persistence model is, nor the optimum way of using different query approaches.</p>



<a name="181144073"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181144073" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> dsh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181144073">(Nov 19 2019 at 19:09)</a>:</h4>
<p>Right. But this seems to be a very common problem and query pattern and I am wondering if an optimized solution like stored procedure or database built in function/extension already exsits</p>



<a name="181146303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181146303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181146303">(Nov 19 2019 at 19:32)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="181179814"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181179814" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181179814">(Nov 20 2019 at 04:52)</a>:</h4>
<p>I don't know how to answer that because I implemented $lastN using an SQL server.</p>



<a name="181184608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181184608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181184608">(Nov 20 2019 at 07:11)</a>:</h4>
<p>What I did was query of observations by  codes and  data range. The date range would depend on scenario. Results are sorted in date order.<br>
So a client would take the first one.</p>
<p>Like Lloyd mentioned you can group observations by encounter. So if I had received the observations by hl7v2, they would all point to same encounter (one for each v2 message)</p>



<a name="181184758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Relational%20Data%20representation%20%26%20aggregation/near/181184758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Relational.20Data.20representation.20.26.20aggregation.html#181184758">(Nov 20 2019 at 07:15)</a>:</h4>
<p>You can see the gist of this in this diagram <a href="https://project-wildfyre.github.io/conformance/graph/4" target="_blank" title="https://project-wildfyre.github.io/conformance/graph/4">https://project-wildfyre.github.io/conformance/graph/4</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
