---
layout: page
title: "FHIR Chat  · Definition of $lastn · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html">Definition of $lastn</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="189505833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/189505833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niek van Galen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#189505833">(Mar 02 2020 at 16:09)</a>:</h4>
<p>Looking at the Last N Observations Query I am confused about the definition of 'last'. In clinical context, it seems logical to think of <em>last</em> being the <em>latest</em> observation e.g. last measured blood pressure.</p>
<p>However, reading the <a href="https://hl7.org/fhir/STU3/operation-observation-lastn.html" target="_blank" title="https://hl7.org/fhir/STU3/operation-observation-lastn.html">STU3 specification</a> this is not mentioned anywhere where I would expect to see something like <em>'sorted from most recent to the oldest <strong>using the effective[x] element</strong>'</em>. For instance, one could also think of using the <em>meta.lastUpdated</em> element to determine the latest observation.<br>
The vague sentence <em>'they are passed to a server algorithm of some kind that uses them to determine the most appropriate matches'</em> also kind of worries me: how should this work?</p>
<p>In <a href="https://hl7.org/fhir/operation-observation-lastn.html" target="_blank" title="https://hl7.org/fhir/operation-observation-lastn.html">R4</a> this seems to be a bit more clear because the phrase 'effective times' is mentioned. But still: a bit vague.</p>
<p>Can someone explain further and clarify this?</p>



<a name="189508075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/189508075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#189508075">(Mar 02 2020 at 16:28)</a>:</h4>
<p>It is indeed expected to be the "most recent".  We should probably also exclude 'predicted' values (those where the effective time falls after the time of the Observation).  Feel free to submit a change request for us to further clarify in R5.</p>



<a name="189514844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/189514844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#189514844">(Mar 02 2020 at 17:33)</a>:</h4>
<p>Just to be sure: "most recent" as in clinically based on effective time? Or based on a _lastUpdated thing? We expect the first.</p>



<a name="189519473"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/189519473" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#189519473">(Mar 02 2020 at 18:18)</a>:</h4>
<p>Should be based on effective time I think</p>



<a name="189525630"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/189525630" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#189525630">(Mar 02 2020 at 19:18)</a>:</h4>
<p>Done: <a href="http://jira.hl7.org/browse/FHIR-26428" target="_blank" title="http://jira.hl7.org/browse/FHIR-26428">J#26428</a></p>



<a name="207377720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207377720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207377720">(Aug 19 2020 at 07:28)</a>:</h4>
<p>We went forward with the $Lastn operation based on effective[x] but run into difficulties. </p>
<p>In FHIR-26428 <span class="user-mention" data-user-id="191401">@Eric Haas</span>  commented, the $Lastn definition needs to clarify how it should work with ( period vs datatime vs timing). This is exactly where we run into problems with our implementation.</p>
<p>What would be the correct behaviour of a $lasnt operation with max = 1 when there is/are:</p>
<ol>
<li>only 1 observation without an effective[x] --&gt; return it or not?</li>
<li>multiple Observation have no effective[x] --&gt; return them all or none? </li>
<li>multiple Observation, some with an effective[x] and some without. --&gt; return only the latest with an effective[x]? </li>
<li>multiple Observations with an effectivePeriod. Some have a period.start and no period.end. Do they need to be returned over a 'closed' period?</li>
</ol>



<a name="207491464"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207491464" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Niek van Galen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207491464">(Aug 20 2020 at 06:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> can you shed some light on this?</p>



<a name="207543513"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207543513" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207543513">(Aug 20 2020 at 16:31)</a>:</h4>
<blockquote>
<p>What would be the correct behaviour of a $lasnt operation with max = 1 when there is/are:</p>
</blockquote>
<p>taking these one at time...</p>
<p>how often is an operation dateless?  That IMO is not very useful</p>
<blockquote>
<p>only 1 observation without an effective[x] --&gt; return it or not?</p>
</blockquote>
<p>not -  since this is a time based operation. </p>
<blockquote>
<p>multiple Observation have no effective[x] --&gt; return them all or none?</p>
</blockquote>
<p>none </p>
<blockquote>
<p>multiple Observation, some with an effective[x] and some without. --&gt; return only the latest with an effective[x]?</p>
</blockquote>
<p>Yes</p>
<blockquote>
<p>multiple Observations with an effectivePeriod. Some have a period.start and no period.end. Do they need to be returned over a 'closed' period?</p>
</blockquote>
<p>Yes</p>
<p>added a comment to document all this.</p>



<a name="207555190"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207555190" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207555190">(Aug 20 2020 at 18:10)</a>:</h4>
<blockquote>
<p>multiple Observations with an effectivePeriod. Some have a period.start and no period.end. Do they need to be returned over a 'closed' period?</p>
</blockquote>
<p>Eric, what are you interpreting this as? resources without a period.end should not be returned as if they had no effective[x] at all? or some other reading into the 'closed' period that I'm not getting?</p>



<a name="207555733"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207555733" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207555733">(Aug 20 2020 at 18:15)</a>:</h4>
<p>no period end means is current  so that would be the most recent - right?   Could always add some new parameters  to the operation to interpret it differently ... lets ping the lastn expert  <span class="user-mention" data-user-id="191356">@Jenni Syed</span></p>



<a name="207555868"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207555868" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207555868">(Aug 20 2020 at 18:16)</a>:</h4>
<p>ah, that makes a lot more sense, thanks</p>



<a name="207563294"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207563294" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207563294">(Aug 20 2020 at 19:21)</a>:</h4>
<p>I think it would likely go by the "begin" to compare, but also can confirm if we have this scenario in our internal system or not today. I can see the argument for "it didn't complete yet, so it's more recent" but the "it didn't complete yet" part is worrisome for "most recent"</p>



<a name="207794648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207794648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207794648">(Aug 23 2020 at 22:40)</a>:</h4>
<p>No period end only really makes sense for a predictive observation - one where the observer is asserting that the value is expected to hold 'forever'.</p>



<a name="207850544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207850544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207850544">(Aug 24 2020 at 14:35)</a>:</h4>
<p>so if a resource has effective[DateTime or Instant] compare by that value, else if it has effectivePeriod.end compare by that value, else if it has effectivePeriod.start compare by that value. And any resources without an effective value are ignored for the purposes of $lastn, correct?</p>
<p>Also I don't think Ardon needs it but how would effectiveTiming be handled? just the most recent of the timing.events?</p>



<a name="207868508"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/207868508" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#207868508">(Aug 24 2020 at 17:06)</a>:</h4>
<p>for timing follow this <a href="http://build.fhir.org/search.html#date">guidance</a>:</p>
<blockquote>
<p>Timing the specified scheduling details are ignored and only the outer limits matter. For instance, a schedule that specifies every second day between 31-Jan 2013 and 24-Mar 2013 includes 1-Feb 2013, even though that is on an odd day that is not specified by the period. This is to keep the server load processing queries reasonable.</p>
</blockquote>



<a name="208089350"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/208089350" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#208089350">(Aug 26 2020 at 13:19)</a>:</h4>
<p>Thanks all for the input. I agree with the 4 answers that <span class="user-mention" data-user-id="191401">@Eric Haas</span>  gave and I believe <span class="user-mention" data-user-id="237342">@ryan moehrke</span>  summarizes it quite well. So first DateTime or Instant, then Period.end and lastly by Period.start. Can we get this documented/clarified in the FHIR spec?</p>
<p>To check my understanding: theoretical speaking if you have Observations grouped by one code, with some having an effectivePeriod that is ongoing while others have a effectiveDateTime: the Observation with the latest effectivePeriod.start and no end date should be returned over a Observation with a more recent effectiveDateTime. Correct?</p>



<a name="208089615"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/208089615" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#208089615">(Aug 26 2020 at 13:22)</a>:</h4>
<p>I now see that Eric has made a comment in the FHIR-26428 ticket, hopefully, that will suffice :)</p>



<a name="208117717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Definition%20of%20%24lastn/near/208117717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Definition.20of.20.24lastn.html#208117717">(Aug 26 2020 at 16:51)</a>:</h4>
<p>It will be as part of the above mentioned tracker</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
