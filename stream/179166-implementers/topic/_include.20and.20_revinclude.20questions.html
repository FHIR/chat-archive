---
layout: page
title: "FHIR Chat  · _include and _revinclude questions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html">_include and _revinclude questions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153946257"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153946257" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153946257">(Mar 19 2018 at 19:08)</a>:</h4>
<p>Hi,</p>
<p>Do _include and _revinclude support chaining? It doesn't appear to be obvious from <a href="http://build.fhir.org/search.html#include" target="_blank" title="http://build.fhir.org/search.html#include">http://build.fhir.org/search.html#include</a>.</p>
<p>Basically, I want to do the following things:<br>
1.<br>
Model: There is a reference link from Condition-&gt;Encounter-&gt;Patient-&gt;Organization<br>
Goal: Get all Condition and include Encounter and Patient (but not Organization)<br>
_include query sample:</p>
<blockquote>
<p>Condition?_include=Condition:context:Encounter:_include:Encounter:subject:Patient</p>
</blockquote>
<p>2.<br>
Model: There is a reference link Medication&lt;-MedicationRequest&lt;-DiagnosticReport<br>
Goal: Get all Medication as well as all the MedicationRequest pointing to those, as well as the DiagnosticReport pointing to the MedicationRequest<br>
_revinclude query sample:</p>
<blockquote>
<p>Medication?_revinclude=MedicationRequest:medication:Medication:_revinclude:DiagnosticReport:basedOn:MedicationRequest</p>
</blockquote>
<p>Or is there a better way to achieve this (that is achievable via a single FHIR API call)?</p>



<a name="153946308"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153946308" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153946308">(Mar 20 2018 at 01:14)</a>:</h4>
<p>To be clear, the query samples are just made up. I don't know whether they're valid (conformant with FHIR) or not.</p>



<a name="153947109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lilian Minne <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947109">(Mar 22 2018 at 08:37)</a>:</h4>
<p>Hi Michael,</p>
<p>You would probably need to use a filter: <a href="https://www.hl7.org/fhir/search.html#_filter" target="_blank" title="https://www.hl7.org/fhir/search.html#_filter">https://www.hl7.org/fhir/search.html#_filter</a> or a compartment search. <br>
In the last case it would be something like this: Condition/?_type=Condition,Encounter,Patient&amp;params<br>
Although I'm not sure if it would return Patient resources if there's no direct link between Condition and Patient</p>
<p><span class="user-mention" data-user-id="191757">@Christiaan Knaap</span> ?</p>



<a name="153947205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947205">(Mar 22 2018 at 14:21)</a>:</h4>
<p>The syntax would be like:<br>
/Condition?_include=Condition:context:Encounter&amp;_include:recurse=Encounter:subject:Patient<br>
If you try this on <a href="http://test.fhir.org" target="_blank" title="http://test.fhir.org">test.fhir.org</a>, you get a SQL exception, but if you omit the target type modifiers you can see it working:<br>
/Condition?_include=Condition:context&amp;_include:recurse=Encounter:subject<br>
On HAPI (<a href="http://fhirtest.uhn.ca/baseDstu3" target="_blank" title="http://fhirtest.uhn.ca/baseDstu3">http://fhirtest.uhn.ca/baseDstu3</a>) it also works with the type modifiers.</p>



<a name="153947277"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947277" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947277">(Mar 22 2018 at 17:48)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191757">@Christiaan Knaap</span> this seems to be what I'm looking for, and highlights my misunderstanding with 'recurse' modifier.</p>
<p>Could I infer then that the following would work as well?<br>
Model: links are Patient&lt;-MedicationRequest-&gt;Medication<br>
Goal: Get the medications associated with a patient<br>
Query: Patient?_revinclude=MedicationRequest:subject:Patient&amp;_include:recurse=MedicationRequest:medication:Medication</p>



<a name="153947295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947295">(Mar 22 2018 at 18:21)</a>:</h4>
<p>Just tried this out against HAPI and it works. Cool! :)</p>



<a name="153947299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947299">(Mar 22 2018 at 19:02)</a>:</h4>
<p>Related to this, is there guidance on how to process multiple _include and _revinclude in a single query?</p>
<p>For example, these two queries return the same thing in HAPI (i.e. it includes Patient, MedicationRequest and Medication):</p>
<blockquote>
<p>Patient?_id=mymymytestpat&amp;_include=MedicationRequest:medication:Medication&amp;_revinclude=MedicationRequest:subject:Patient<br>
Patient?_id=mymymytestpat&amp;_revinclude=MedicationRequest:subject:Patient&amp;_include=MedicationRequest:medication:Medication</p>
</blockquote>
<p>Notice I reversed the order of _include and _revinclude in the two queries.</p>
<p>So it looks like HAPI executes _revinclude first before _include (have to check the code to be sure). Is this order of execution based on the FHIR spec? I couldn't tell from reading <a href="http://build.fhir.org/search.html#include" target="_blank" title="http://build.fhir.org/search.html#include">http://build.fhir.org/search.html#include</a>.</p>



<a name="153947323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947323">(Mar 22 2018 at 19:31)</a>:</h4>
<p>there's no comment on that - why would it matter?</p>



<a name="153947327"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947327" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947327">(Mar 22 2018 at 19:44)</a>:</h4>
<p>If the implementation executed _include first, it wouldn't find any MedicationRequest to do the include from. Then it executes the _revinclude, which just then includes the MedicationRequest.</p>
<p>At this point, since the _include has already been executed and is not marked 'recurse', then the final bundle would just contain the Patient and MedicationRequest. The Medication resource would not be included.</p>



<a name="153947331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947331">(Mar 22 2018 at 19:49)</a>:</h4>
<p>hmm</p>



<a name="153947489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947489">(Mar 23 2018 at 13:28)</a>:</h4>
<p>Is it necessary that we document all decisions that a system design must consider? Seems we should leave something to the system design engineers...   I could see a general warning section in the query section about interaction of query parameters that might need special handling, and should be avoided by clients... with a listing of 'some' of these issues we know about, but then to express that not all are listed.</p>



<a name="153947490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947490">(Mar 23 2018 at 13:29)</a>:</h4>
<p>_include and _revinclude are very dangerous in many was, yet so very essential in other ways. We have some comments regarding the potential security/privacy issues.</p>



<a name="153947503"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947503" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947503">(Mar 23 2018 at 14:39)</a>:</h4>
<p>Hmm, for _include and _revinclude, some general guidelines when there's multiple instances of these should be reasonable. Something like:</p>
<blockquote>
<p>1. Execute all _include first. If an _include didn't include anything, try to execute them a second time later (let's call this list 2nd_include)<br>
2. Execute all _revinclude next. If a _revinclude didn't include anything, try to execute them a second time later (let's call this list 2nd_revinclude)<br>
3. Execute all of 2nd_include<br>
4. Execute all of 2nd_revinclude<br>
5. Execute all _include that are marked as 'recurse'<br>
6. Execute all _revinclude that are marked as 'recurse'<br>
7. Repeat 5 and 6 until there are no more newly added resources</p>
</blockquote>
<p>I think this should achieve what HAPI does currently, assuming that's the correct behavior.</p>
<p>I've not thought about the security/privacy issues surrounding these. The only issue I see with using 'recurse'  is that it could potentially bring in lots of records (as mentioned in the spec). If there's some way to control the recursiveness (via additional params in the REST API call) and not leave it to servers to decided it (server's discretion as mentioned in the spec), then I think that would increase interoperability.</p>



<a name="153947563"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/_include%20and%20_revinclude%20questions/near/153947563" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/_include.20and.20_revinclude.20questions.html#153947563">(Mar 23 2018 at 19:32)</a>:</h4>
<p>graphql offers a better way to manage this. I don't know that we want to go as far as that about - particularly the repeated cycles</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
