---
layout: page
title: "FHIR Chat  · Transaction conditional create OR update · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html">Transaction conditional create OR update</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153993056"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993056" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993056">(Sep 04 2018 at 17:45)</a>:</h4>
<p>How do you tell a transaction to do a conditional create OR update?</p>



<a name="153993057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993057">(Sep 04 2018 at 17:45)</a>:</h4>
<p>i.e. if the resource doesn't exist with the criteria, create it. if the resource <em>does</em> exist with the criteria, update it instead</p>



<a name="153993059"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993059" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993059">(Sep 04 2018 at 17:49)</a>:</h4>
<p>You'd list the resource twice.  We should probably make explicit that failure to meet conditional create/update requirements doesn't get treated as a failure within a transaction.</p>



<a name="153993060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993060">(Sep 04 2018 at 17:50)</a>:</h4>
<p>so, one entry in the transaction with POST (conditional create), and another entry with PUT (conditional update)</p>



<a name="153993063"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993063" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993063">(Sep 04 2018 at 17:51)</a>:</h4>
<p>What you describe, is actually a conditional update:</p>
<p>"<br>
No matches: The server performs a create interaction<br>
One Match: The server performs the update against the matching resource<br>
"</p>



<a name="153993064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993064">(Sep 04 2018 at 17:51)</a>:</h4>
<p>that works.. but makes for a VERY large bundle if doing this to many resources</p>



<a name="153993065"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993065" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993065">(Sep 04 2018 at 17:51)</a>:</h4>
<p><a href="https://www.hl7.org/fhir/http.html#cond-update" target="_blank" title="https://www.hl7.org/fhir/http.html#cond-update">https://www.hl7.org/fhir/http.html#cond-update</a></p>



<a name="153993066"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993066" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993066">(Sep 04 2018 at 17:52)</a>:</h4>
<p>No need to have it twice, if I read you correct</p>



<a name="153993067"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993067" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993067">(Sep 04 2018 at 17:52)</a>:</h4>
<p><span class="user-mention" data-user-id="191436">@Stefan Lang</span> That's only true if you want the client to assign the id on a create.  I was assuming <span class="user-mention" data-user-id="191505">@Sean McIlvenna</span> wanted server-assigned create ids.</p>



<a name="153993068"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993068" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993068">(Sep 04 2018 at 17:52)</a>:</h4>
<p>ok, <span class="user-mention" data-user-id="191436">@Stefan Lang</span> , I'll give that a shot</p>



<a name="153993069"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993069" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993069">(Sep 04 2018 at 17:52)</a>:</h4>
<p>thx</p>



<a name="153993071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993071">(Sep 04 2018 at 17:55)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> Where is that stated? isn't a create a create and as such should ignore any id sent from the client?</p>



<a name="153993086"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993086" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993086">(Sep 04 2018 at 18:02)</a>:</h4>
<p><a href="https://build.fhir.org/http.html#cond-update" target="_blank" title="https://build.fhir.org/http.html#cond-update">https://build.fhir.org/http.html#cond-update</a> explicitely says:<br>
"The resource MAY contain an id element, but does not need to (this is one of the few cases where a resource exists without an id element). If an id is provided, the server SHALL ignore it - see documentation for the update interaction. "</p>



<a name="153993096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993096">(Sep 04 2018 at 18:13)</a>:</h4>
<p>That section says: "No matches: The server treats the interaction as an Update as Create interaction (or rejects it, if it does not support Update as Create)".  Update as Create means client-assigned id.  The part about not having an id is presumably because the id is conveyed in the URL.</p>



<a name="153993098"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993098" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993098">(Sep 04 2018 at 18:19)</a>:</h4>
<p>So... not sure how I would do a conditional update without an ID, though</p>



<a name="153993099"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993099" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993099">(Sep 04 2018 at 18:20)</a>:</h4>
<p>for example, if I have a CapabilityStatement that does NOT have an ID, but I want to conditionally create/update the resource on the FHIR server based on the CapabilityStatement.url...</p>



<a name="153993100"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993100" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993100">(Sep 04 2018 at 18:20)</a>:</h4>
<p>what would I put for the METHOD/URL of the request?</p>



<a name="153993102"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993102" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993102">(Sep 04 2018 at 18:21)</a>:</h4>
<p>I couldn't use "PUT" because PUT would require a URL like .../CapabilityStatement/&lt;id&gt;</p>



<a name="153993103"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993103" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993103">(Sep 04 2018 at 18:21)</a>:</h4>
<p>I would have to use POST with .../CapabilityStatement as the url</p>



<a name="153993104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993104">(Sep 04 2018 at 18:21)</a>:</h4>
<p>Right, the "No matches" definition has changed between STU3 and current build.<br>
The new definition looks rather inconsistent to me, since at the the top it states "without id", but "Update as Create" talks about ids</p>



<a name="153993105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993105">(Sep 04 2018 at 18:21)</a>:</h4>
<p>I think...</p>



<a name="153993106"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993106" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993106">(Sep 04 2018 at 18:21)</a>:</h4>
<p>would be great to have a set of bullets in guidance for various scenarios, and what to do...</p>



<a name="153993107"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993107" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993107">(Sep 04 2018 at 18:22)</a>:</h4>
<p>ultimately I'm just trying to setup "import" for end-users... I don't know if the resource already exists on the server, and I don't know if the user is sending a resource with an id or not</p>



<a name="153993108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993108">(Sep 04 2018 at 18:23)</a>:</h4>
<p>but I know that for some resources, I can use .url as a canonical id to find out if it exists already</p>



<a name="153993109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993109">(Sep 04 2018 at 18:24)</a>:</h4>
<p><span class="user-mention" data-user-id="191505">@Sean McIlvenna</span> a conditional update means "without id, but with search criteria". But I admit the new definition leaves me a bit confused</p>



<a name="153993117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993117">(Sep 04 2018 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> If the client would not send an id (whereever), this should still work a a regular create, right?</p>



<a name="153993121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993121">(Sep 04 2018 at 19:07)</a>:</h4>
<p>yah... I'm now completely confused as-to how I should construct this "create or update" transaction for multiple resources</p>



<a name="153993122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993122">(Sep 04 2018 at 19:07)</a>:</h4>
<p>I'm not clear on that.  <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> <span class="user-mention" data-user-id="191315">@Josh Mandel</span> ?</p>



<a name="153993140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993140">(Sep 04 2018 at 19:29)</a>:</h4>
<p>How else would one perform a "STU3 way" of conditional update?</p>



<a name="153993189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993189">(Sep 04 2018 at 21:04)</a>:</h4>
<p>I.e. the original primary use case:<br>
- I don't know the id and not even, whether that resource exists<br>
- but I have enough information to define criteria that hopefully represent a unique key<br>
- and I don't care about the id that resource already has or will get</p>



<a name="153993233"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993233" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993233">(Sep 04 2018 at 22:00)</a>:</h4>
<blockquote>
<p>I'm now completely confused as-to how I should construct this "create or update" transaction for multiple resources</p>
</blockquote>
<p>I'm not sure about this. Is 'multiple resources' important somehow?</p>



<a name="153993267"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993267" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993267">(Sep 04 2018 at 23:24)</a>:</h4>
<p>Yes... goes back to my attempts to load all us-core resources on FHIR servers.</p>



<a name="153993270"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993270" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean McIlvenna <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993270">(Sep 04 2018 at 23:24)</a>:</h4>
<p><a href="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17720" target="_blank" title="https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17720">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17720</a></p>



<a name="153993484"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993484" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993484">(Sep 05 2018 at 14:57)</a>:</h4>
<p>Is there not a special case where the Resource you are POSTing has a business identifier ? Where in the case where the server has a Resource with that business identifier, it will do an UPDATE of that. But otherwise will do a CREATE? is the business identifier usable this way, or only the id?</p>



<a name="153993485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993485">(Sep 05 2018 at 15:05)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> That's conditional update as defined in STU3.<br>
You can use a business identifier or basically any search criteria that would lead to 0..1 matches and do a create or update accordingly.</p>



<a name="153993486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993486">(Sep 05 2018 at 15:10)</a>:</h4>
<p>I think the open question here is: does the definition in the current build still allow that? And if not, should that definition be changed to allow it again?</p>



<a name="153993488"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993488" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993488">(Sep 05 2018 at 15:16)</a>:</h4>
<p>I think the only ambiguous part of the current spec is here:<br>
<a href="http://build.fhir.org/http.html#cond-update" target="_blank" title="http://build.fhir.org/http.html#cond-update">http://build.fhir.org/http.html#cond-update</a></p>
<blockquote>
<p>The resource MAY contain an id element, but does not need to (this is one of the few cases where a resource exists without an id element). If an id is provided, the server SHALL ignore it - see documentation for the update interaction.</p>
</blockquote>
<p>This contradicts the "Update as Create": <a href="http://build.fhir.org/http.html#upsert" target="_blank" title="http://build.fhir.org/http.html#upsert">http://build.fhir.org/http.html#upsert</a></p>



<a name="153993490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993490">(Sep 05 2018 at 15:17)</a>:</h4>
<p>upsert is useful with traditional PUT or conditional Updates</p>



<a name="153993491"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993491" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993491">(Sep 05 2018 at 15:18)</a>:</h4>
<p>True.<br>
Plus: in STU3 "No match" meant: create. In current build, if the server does not support "Update as create", it must throw an error.<br>
Basic UPSERT is gone.</p>



<a name="153993492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993492">(Sep 05 2018 at 15:24)</a>:</h4>
<p>Maybe we should distinguish between </p>
<ul>
<li>"NO MATCH - no ID provided" -&gt; Create</li>
<li>"NO MATCH - ID provided -&gt; Update as Create (if the server supports it)</li>
</ul>



<a name="153993493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153993493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153993493">(Sep 05 2018 at 15:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span> That's exactly what I think.<br>
"Update <strong>or</strong> Create" (aka "Conditional Update" or "UPSERT") is not compatible with "Update <strong>as</strong> Create" otherwise</p>



<a name="153995649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153995649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eugene Lubarsky <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153995649">(Sep 11 2018 at 02:02)</a>:</h4>
<p>It would be great to clarify this. The current wording has come from <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=16549" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=16549">GF#16549</a> (<a href="https://github.com/HL7/fhir/commit/098f965b5694f683ba3d593564f698c031777ef2" target="_blank" title="https://github.com/HL7/fhir/commit/098f965b5694f683ba3d593564f698c031777ef2">https://github.com/HL7/fhir/commit/098f965b5694f683ba3d593564f698c031777ef2</a>) which doesn't seem to intend to disallow upserts with server-assigned IDs (which would be an issue for me and I suspect many others). The current trunk text for conditional updates even says "The resource MAY contain an id...If an id is provided, the server SHALL ignore it" and there is no id in the URL.</p>



<a name="153996531"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996531" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996531">(Sep 13 2018 at 09:01)</a>:</h4>
<p>Interestingly I managed to implement the bundle transaction processing to behave as suggested here from reading the STU3 spec. At least I just tested and it seems to do as your require. Here is a simple Transaction Bundle example with a Patient and Observation resource where the Patient gets added with the supplied Resource ID as it is a PUT and the Observation is created with a server assigned id as it is a POST. If you POST the same transaction bundle again only the Observation is created and the patient will be updated. I think that is what you're looking for.  <br>
<code>GET: https://stu3.test.pyrohealth.net/fhir/Bundle/transactionExampleUpdateOrCreate2</code> <br>
You can change the identifiers in that example and POST that transaction bundle to <code>https://stu3.test.pyrohealth.net/fhir</code>  to test again.<br>
The  server always treats any PUT as a conditional Create or Update as defined here in the spec: <a href="http://hl7.org/fhir/http.html#update" target="_blank" title="http://hl7.org/fhir/http.html#update">http://hl7.org/fhir/http.html#update</a><br>
Or am I missing something?</p>



<a name="153996535"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996535" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996535">(Sep 13 2018 at 09:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span> Right, that's the behavior when you know the id.<br>
For what is described under "conditional update" (without id, but with search parameter(s)), I would hope for the same behavior. Which happens to be the case in STU3, but not in current build.<br>
Current build refers to ids in that case (section "Update as create"), but usually, when you update by search, you don't have an id</p>



<a name="153996536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996536">(Sep 13 2018 at 09:30)</a>:</h4>
<p>I would like to open a tracker item on that, with the proposed solution of changing <a href="http://build.fhir.org/http.html#cond-update" target="_blank" title="http://build.fhir.org/http.html#cond-update">http://build.fhir.org/http.html#cond-update</a> to contain the text <span class="user-mention" data-user-id="191451">@Patrick Werner</span> wrote above:</p>
<div class="codehilite"><pre><span></span>&quot;NO MATCH - no ID provided&quot; -&gt; Create
&quot;NO MATCH - ID provided -&gt; Update as Create (if the server supports it)
</pre></div>



<a name="153996537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996537">(Sep 13 2018 at 09:31)</a>:</h4>
<p>Any objections (or affirmations) on that?</p>



<a name="153996538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996538">(Sep 13 2018 at 09:38)</a>:</h4>
<p>So you mean like this one:<br>
<code>GET: https://stu3.test.pyrohealth.net/fhir/Bundle/transactionExampleUpdateOrCreate4</code><br>
Now I am not assiging the Id for Patient the server is, but it first searches for the correct Patient resource based on a search parameter and business identifier?</p>



<a name="153996539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996539">(Sep 13 2018 at 09:39)</a>:</h4>
<p>Are sorry so something changed between STU3 and R4. That will  be what  I'm not aware of.</p>



<a name="153996540"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996540" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996540">(Sep 13 2018 at 09:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span>  Are you sure about the statement "The server always treats any PUT as a conditional Create or Update? A conditional Create uses a POST and is different from a Conditional Update. A Conditional create does not update if ONE resource is found that matches the criteria (it just returns doing nothing) and if none are found it does a create. That's my understanding.</p>



<a name="153996541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996541">(Sep 13 2018 at 09:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span> exactly.<br>
And I assume(d) that "conditional Create or Update" was meant to mean "UPSERT"</p>



<a name="153996542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996542">(Sep 13 2018 at 09:44)</a>:</h4>
<blockquote>
<p>Any objections (or affirmations) on that?</p>
</blockquote>
<p><span class="user-mention" data-user-id="191436">@Stefan Lang</span>  I would say no to the second line. A conditional update is a PUT and that is where the uploader can specify the logical id. So if the resource is not found and a conditional update is done (with a logicial id) the resource is created using the logical id specified by the uploader. In a create you do not specify a logical id (unless a temporary id in a transaction bundle)</p>



<a name="153996544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996544">(Sep 13 2018 at 09:48)</a>:</h4>
<p>So that would basically mean returning to the way it is specified in STU3...</p>
<p>I think, the "Create as Update" was added for the reason to allow the client to specify the id in certain well defined use cases. And if that is allowed for the basic update, it should also be allowed for conditional update</p>



<a name="153996545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996545">(Sep 13 2018 at 09:49)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span> exactly.<br>
And I assume(d) that "conditional Create or Update" was meant to mean "UPSERT"</p>
</blockquote>
<p><span class="user-mention" data-user-id="191436">@Stefan Lang</span>  My understanding of a Conditional Create (which I use extensively in PHD uploads in transaction bundles) is that if one and only one resource is found matching your selection criteria,  nothing happens. No change to the existing resource is made and the server responds with 200 OK for that resource. If NO resources are found a CREATE is done with the server specifying the logical iD (the uploader is not allowed to specify a logical id). If more than one resource is found matching your criteria a 4xx error is returned.</p>



<a name="153996546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996546">(Sep 13 2018 at 09:49)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span>  Are you sure about the statement "The server always treats any PUT as a conditional Create or Update? A conditional Create uses a POST and is different from a Conditional Update. A Conditional create does not update if ONE resource is found that matches the criteria (it just returns doing nothing) and if none are found it does a create. That's my understanding.</p>
</blockquote>
<p>Sorry, I was misusing terminology, all I meant to say is that a PUT will update if it finds a  resource with the given id or it will create the resource with the Id provided if not found. As per this sentence from the spec: "The update interaction creates a new current version for an existing resource or creates an initial version if no resource already exists for the given id." I should not have said 'Conditional Create' as that is somthing else as you point out.</p>



<a name="153996548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996548">(Sep 13 2018 at 09:50)</a>:</h4>
<p><span class="user-mention" data-user-id="192228">@Brian Reinhold</span> completely agreed. We are talking "conditional update" here, not "conditional create". As Angus just clarified</p>



<a name="153996550"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996550" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996550">(Sep 13 2018 at 09:56)</a>:</h4>
<blockquote>
<p>So that would basically mean returning to the way it is specified in STU3...</p>
<p>I think, the "Create as Update" was added for the reason to allow the client to specify the id in certain well defined use cases. And if that is allowed for the basic update, it should also be allowed for conditional update</p>
</blockquote>
<p>Isnt that what conditional update already does? When I did conditional updates, I specified the logical id (I assumed I had to but maybe that was a false assumption). In any case, I wanted to specify the logicial id because I needed that logical id in subsequent uploads in a streaming situation and I (1) did not want to wait for a server response to get it or (2) was queuing data for a third-party sender that knew nothing of FHIR.</p>
<p>The conditional update then created the resource with my logical id if the resource was not found. If it was found, the resource was updated. Does the 'create as update' apply to something other than the conditional update? To me it seems the conditional update DOES do a create as update...and always has (at least the last time I used it which was a long time ago!)</p>



<a name="153996553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996553">(Sep 13 2018 at 10:00)</a>:</h4>
<p>I agree although I think you mean normal Update not Conditional Update, im reading R4 and like you I see no differance between these two statments :</p>
<p>Update: "The update interaction creates a new current version for an existing resource or creates an initial version if no resource already exists for the given id. "<br>
AND<br>
Update as Create: "Servers MAY choose to allow clients to PUT a resource to a location that does not yet exist on the server - effectively, allowing the client to define the id of the resource. "</p>



<a name="153996555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996555">(Sep 13 2018 at 10:03)</a>:</h4>
<p>I'm specifically talking about conditional update.</p>
<p>The spec there currently just says: "No matches: The server treats the interaction as an Update as Create interaction (or rejects it, if it does not support Update as Create)".<br>
And "Update as Create" is an optional thing here and it's about <a href="http://Resource.id" target="_blank" title="http://Resource.id">Resource.id</a>. Which leaves you with "reject the create, when you don't support "Update as Create". Meaning: update, if it exists, throw it away if not.<br>
So this is just the keep the "old" behavior</p>



<a name="153996556"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996556" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996556">(Sep 13 2018 at 10:04)</a>:</h4>
<blockquote>
<p>I agree although I think you mean normal Update not Conditional Update, im reading R4 and like you I see no differance between these two statments :</p>
<p>Update: "The update interaction creates a new current version for an existing resource or creates an initial version if no resource already exists for the given id. "<br>
AND<br>
Update as Create: "Servers MAY choose to allow clients to PUT a resource to a location that does not yet exist on the server - effectively, allowing the client to define the id of the resource. "</p>
</blockquote>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span>  Maybe the create as update means something I would REALLY like to have had: If the resource <em>is</em> found <strong>NO</strong> update is done. The resource is left alone!  If the resource is not found, it is created with my logical id. THAT would have been a dream solution for me but in STU3 such an option does not exist. If that exists now, it will be a great addition because I could really use it!!!</p>



<a name="153996557"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996557" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996557">(Sep 13 2018 at 10:07)</a>:</h4>
<p><span class="user-mention" data-user-id="192228">@Brian Reinhold</span> I agree with that. I just want to be able to <em>also</em> have the STU3 variant in the context of conditional update.</p>



<a name="153996558"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996558" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996558">(Sep 13 2018 at 10:12)</a>:</h4>
<p>Is that dream not  'if-none-exsists: _id =123' function on a create</p>



<a name="153996560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996560">(Sep 13 2018 at 10:15)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="192228">@Brian Reinhold</span> I agree with that. I just want to be able to <em>also</em> have the STU3 variant in the context of conditional update.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191436">@Stefan Lang</span>  Shake some of the cobwebs out of my mind; its been many years since I did the conditional update. But as I recall in the STU3/DSTU2 version the difference between a conditional update and update is that in the conditional case your match was based on something else other than the logical id. </p>
<blockquote>
<p>Is that dream not  'if-none-exsists: _id =123' function on a create</p>
</blockquote>
<p>YES!!!</p>
<p>Right now a conditional create does not allow the specification of a logical id when the resource is created. I want a situation where I can specify the logical id (because I need it in other resources and I don't want to wait or can't wait for a server to respond and give it to me) and have the server create the resource with that logical id if it does not exist BUT if it does exist LEAVE IT ALONE ... no update, not even of the internal metadata.</p>



<a name="153996561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996561">(Sep 13 2018 at 10:18)</a>:</h4>
<p>Sounds like a  'if-none-exist: _id =123' yet on a PUT update rather than a POST create.  So that is still a dream</p>



<a name="153996562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996562">(Sep 13 2018 at 10:19)</a>:</h4>
<p><span class="user-mention" data-user-id="192228">@Brian Reinhold</span> exactly. Which is why the current description of "Update as Create" (client defined id) is fine in the context of a basic Update (I have an id there), but not for Conditional Update (I explicitely have no id there)...</p>



<a name="153996563"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996563" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996563">(Sep 13 2018 at 10:21)</a>:</h4>
<p>Anyway, a Conditional Update with "Update as Create" would still allow the client to define an id for a resouce that not yet exists.<br>
But as described now, having no id will just lead to the resource being discarded instead. Which I consider bad.</p>



<a name="153996564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996564">(Sep 13 2018 at 10:22)</a>:</h4>
<p>... because not knowing the id is the whole reason for Conditional Update ...</p>



<a name="153996565"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996565" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996565">(Sep 13 2018 at 10:24)</a>:</h4>
<blockquote>
<p>I agree although I think you mean normal Update not Conditional Update, im reading R4 and like you I see no differance between these two statments :</p>
<p>Update: "The update interaction creates a new current version for an existing resource or creates an initial version if no resource already exists for the given id. "<br>
AND<br>
Update as Create: "Servers MAY choose to allow clients to PUT a resource to a location that does not yet exist on the server - effectively, allowing the client to define the id of the resource. "</p>
</blockquote>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span>  Correct me if I am wrong (its been years) but the DSTU2/STU3 conditional update vs update was to allow the update to be done based upon something other than the logical id. You may not know the logical id and you want to make sure the resource has not already been created. If it hasn't been created, it gets created with the logical id you specify (didn't you HAVE to specify a logical id in an update?)  <br>
If it exists, the resource gets (unfortunately for me) updated. I do not know if the logical id you specified gets updated too but I doubt it. If multiple resources are found, error! Make better selection criteria.</p>
<p>A normal update is all based upon the logical id and it is found and updated or not found and created with you logical id</p>



<a name="153996566"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996566" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996566">(Sep 13 2018 at 10:32)</a>:</h4>
<p>Update as Create: "Servers MAY choose to allow clients to PUT a resource to a location that does not yet exist on the server - effectively, allowing the client to define the id of the resource. "</p>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span>  Update as create difference I am assuming is that NO update gets done if the resource exists...at least I hope so. That is an option that does not currently exist. Maybe a better wording is Create as Update (I specify the logical id). If the resource does not exist, create with my logical id and do nothing if the resource exists.</p>



<a name="153996567"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996567" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996567">(Sep 13 2018 at 10:34)</a>:</h4>
<p><span class="user-mention" data-user-id="192228">@Brian Reinhold</span> that#s about the "One Match" part then. For Conditional Update:<br>
"One Match: The server performs the update against the matching resource"</p>



<a name="153996568"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996568" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996568">(Sep 13 2018 at 10:35)</a>:</h4>
<p>I think it was not ever made clear, if you do a Conditional Update where you provide a search parameter and that search parameter returns one resource, then an update is done on it. Yet if it returned no resource a create is done, yet it never talked about whether that resource MUST have a resource Id in it or not. I know my server, if you do give a resource id, in the resource on a conditional update,  I check it matches the found resource id from the search and fail the update if it does not match . Yet if you provide no resource id in the resource then I just perform the update on the found resource. And furthermore, if not resource is found I do the create with your Resource id in the resource or if none I assign a server resource id and create.</p>



<a name="153996569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996569">(Sep 13 2018 at 10:36)</a>:</h4>
<p>But that would be a Conditional Create as stated above?</p>



<a name="153996571"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996571" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996571">(Sep 13 2018 at 10:39)</a>:</h4>
<p>Before completely moving away from the original issue, I just created a tracker on that: <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17906" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17906">GF#17906</a></p>



<a name="153996572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996572">(Sep 13 2018 at 10:39)</a>:</h4>
<p>Well, Conditional Create and Conditional Update are similar but they have differences. <br>
CReate: One Match: The server ignores the post and returns 200 OK<br>
Update : One Match: The server performs the update against the matching resource</p>



<a name="153996573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996573">(Sep 13 2018 at 10:40)</a>:</h4>
<p>And Create never lets the user define the resource id</p>



<a name="153996574"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996574" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996574">(Sep 13 2018 at 10:43)</a>:</h4>
<p>If defining the id is considered necessary on the "Create but not Update" case, this may indeed be another issue</p>



<a name="153996575"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996575" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996575">(Sep 13 2018 at 10:43)</a>:</h4>
<blockquote>
<p>I think it was not ever made clear, if you do a Conditional Update where you provide a search parameter and that search parameter returns one resource, then an update is done on it. Yet if it returned no resource a create is done, yet it never talked about whether that resource MUST have a resource Id in it or not. I know my server, if you do give a resource id, in the resource on a conditional update,  I check it matches the found resource id from the search and fail the update if it does not match . Yet if you provide no resource id in the resource then I just perform the update on the found resource. And furthermore, if not resource is found I do the create with your Resource id in the resource or if none I assign a server resource id and create.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span>  Are you implementing a server? I am impressed! All power to you!</p>
<p>Here are my understandings of the creates, updates, and conditional variants (versions 2 and 3, I have not looked at 4)<br>
create: cant specify a logical id. The resource is always created and the server gives it the logical id<br>
conditional create: can't specify a logical id. Resource is created if no resource is found matching criteria<br>
                                       ONE Match: server returns doing nothing. Resource is left alone and remains as is.<br>
                                       Multiple matches: Error. Your selection criteria stink<br>
update: client specifies the logical id. Server creates resource with logical id if not found. Updates resource if found<br>
conditional update: client specifies logical id but resource is searched for based on other criteria. No match, create with specified logical id<br>
                                      ONE match: update the resource (if the logical ids are different, I am assuming the new one is ignored)<br>
                                     Multiple matches: your criteria stink. Error</p>
<p>Digging into the dust of 3.0.1 here is where an update is required to have a client specified logical id:</p>
<p>The request body SHALL be a Resource with an id element that has an identical value to the [id] in the URL. If no id element is provided, or the value is wrong, the server SHALL respond with an HTTP 400 error code, and SHOULD provide an OperationOutcome identifying the issue.</p>



<a name="153996576"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996576" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996576">(Sep 13 2018 at 10:48)</a>:</h4>
<p>Conditional Update is to my understanding not about the client specifying a logical id in STU3. The "client specifies id" is "Update as Create" as explicitely referred to in R4. And it is an optional functionality on the server. Plus: if the server does not support that functionality, the resource will be rejected in the "No matches" case. Which I still consider bad ;-)</p>



<a name="153996577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996577">(Sep 13 2018 at 10:51)</a>:</h4>
<p>If it is optional then why does the normal update say "he update interaction creates a new current version for an existing resource or creates an initial version if no resource already exists for the given id", I still see no differance between normal update and this new ' Update as Create'</p>



<a name="153996578"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996578" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996578">(Sep 13 2018 at 10:51)</a>:</h4>
<blockquote>
<p>The request body SHALL be a Resource with an id element that has an identical value to the [id] in the URL. If no id element is provided, or the value is wrong, the server SHALL respond with an HTTP 400 error code, and SHOULD provide an OperationOutcome identifying the issue.</p>
</blockquote>
<p>Yes. But that's for update, not for conditional update:<br>
STU3: "When the server processes this update, it performs a search using its standard search facilities for the resource type, with the goal of resolving a single logical id for this request" - so the server <em>finds</em> the id, the client doesn't provide it</p>



<a name="153996579"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996579" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996579">(Sep 13 2018 at 10:53)</a>:</h4>
<p>"Update as Create" simply clarifies what has to happen in the "No matches" case when a client provides an id</p>



<a name="153996580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996580">(Sep 13 2018 at 10:53)</a>:</h4>
<p>Agree, so are we saying that if they do provide the id in the resource on a conditonal Update then that is an error?</p>



<a name="153996581"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996581" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996581">(Sep 13 2018 at 10:55)</a>:</h4>
<p>That would disallow a client to specify the id on Conditional Update.<br>
So my proposal for <strong>Conditional Update</strong> is:</p>
<ul>
<li>No matches, no id provided: The server creates the resource.</li>
<li>No matches, id provided:  The server treats the interaction as an Update as Create interaction (or rejects it, if it does not support Update as Create)"</li>
</ul>



<a name="153996582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996582">(Sep 13 2018 at 10:55)</a>:</h4>
<blockquote>
<p>"Update as Create" simply clarifies what has to happen in the "No matches" case when a client provides an id</p>
</blockquote>
<p>OK I can accept that, good point</p>



<a name="153996583"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996583" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996583">(Sep 13 2018 at 10:58)</a>:</h4>
<blockquote>
<p>That would disallow a client to specify the id on Conditional Update.<br>
So my proposal for <strong>Conditional Update</strong> is:</p>
<ul>
<li>No matches, no id provided: The server creates the resource.</li>
<li>No matches, id provided:  The server treats the interaction as an Update as Create interaction (or rejects it, if it does not support Update as Create)"</li>
</ul>
</blockquote>
<p>I'm on board with all this wiht an extra that I do:<br>
One Match and match resource id not equal to provided resource id, reject</p>



<a name="153996584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996584">(Sep 13 2018 at 11:00)</a>:</h4>
<p>Good point. Maybe add a comment to the tracker? <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17906" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17906">GF#17906</a></p>



<a name="153996585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996585">(Sep 13 2018 at 11:00)</a>:</h4>
<blockquote>
<blockquote>
<p>"Update as Create" simply clarifies what has to happen in the "No matches" case when a client provides an id</p>
</blockquote>
<p>OK I can accept that, good point</p>
</blockquote>
<p><span class="user-mention" data-user-id="191436">@Stefan Lang</span>  agreed. The conditional update was a little vague about the creation. The HAPI FHIR server happened to take my logical id when it created the resource. So its conditional update was like the update except it did a search for the resource based upon selection criteria. Since the way id did it (the logical id was actually created from the selection criteria) there would never be a conflict. In other words, if I had already created the resource it would have the same logical id I would have in my conditional update attempt. Would have been interesting to see what would have happened if I put in a logical id that was different.</p>



<a name="153996586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996586">(Sep 13 2018 at 11:01)</a>:</h4>
<p>So that is :<br>
One Match: no resource id provided, create ands assign new id<br>
One Match resource id provided and it matches the found resource ,update that resourece<br>
One Match resource id provided does not match resource found , reject update<br>
And, everthing you wrote.</p>



<a name="153996587"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996587" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996587">(Sep 13 2018 at 11:03)</a>:</h4>
<blockquote>
<p>Good point. Maybe add a comment to the tracker? <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17906" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17906">GF#17906</a></p>
</blockquote>
<p>Is there a situation in R4 (I have not checked) where one can have the resource created if it does NOT match the selection criteria with the specified logical id AND if one match is found THE RESOURCE IS LEFT ALONE??? NO update!!!</p>



<a name="153996588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996588">(Sep 13 2018 at 11:04)</a>:</h4>
<p>Got run, feel free to play around with  this on my server here, woudl love the testing : <br>
<a href="https://pyrohealth.net/" target="_blank" title="https://pyrohealth.net/">https://pyrohealth.net/</a><br>
FHIR Endpoint: <a href="https://stu3.test.pyrohealth.net/fhir" target="_blank" title="https://stu3.test.pyrohealth.net/fhir">https://stu3.test.pyrohealth.net/fhir</a></p>



<a name="153996589"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996589" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996589">(Sep 13 2018 at 11:08)</a>:</h4>
<blockquote>
<p>Got run, feel free to play around with  this on my server here, woudl love the testing : <br>
<a href="https://pyrohealth.net/" target="_blank" title="https://pyrohealth.net/">https://pyrohealth.net/</a><br>
FHIR Endpoint: <a href="https://stu3.test.pyrohealth.net/fhir" target="_blank" title="https://stu3.test.pyrohealth.net/fhir">https://stu3.test.pyrohealth.net/fhir</a></p>
</blockquote>
<p><span class="user-mention" data-user-id="191391">@Angus Millar</span>  Do you have a server supporting R4 3.6.0? Does it support the new Device resource and transaction bundle?</p>



<a name="153996590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996590">(Sep 13 2018 at 11:08)</a>:</h4>
<p>Working on R4 now. So no not yet.</p>



<a name="153996591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996591">(Sep 13 2018 at 11:09)</a>:</h4>
<blockquote>
<p>Working on R4 now. So no not yet.</p>
</blockquote>
<p>So what version is it? 3.1.0, 3.20?</p>



<a name="153996592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Angus Millar <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996592">(Sep 13 2018 at 11:10)</a>:</h4>
<p>STU V3.0.1</p>



<a name="153996593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996593">(Sep 13 2018 at 11:14)</a>:</h4>
<p><span class="user-mention" data-user-id="192228">@Brian Reinhold</span> <br>
I'm not aware of such a situation being allowed. Might require another header param for Conditional Create?</p>



<a name="153996596"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996596" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996596">(Sep 13 2018 at 11:23)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="192228">@Brian Reinhold</span> <br>
I'm not aware of such a situation being allowed. Might require another header param for Conditional Create?</p>
</blockquote>
<p>It might be easier just to make the decision upon whether the logical id is present. If the resource is not found with the given selection criteria, the resource is created. If the logical id is specified, that logical id is used (if the server already uses that logical id an error is returned. The client needs to be smarter about specifying the logical id). If not, the server creates it. The important thing is if the resource is found, do nothing!</p>
<p>Many clients are in a situation where they cannot wait for a server response to get a logical id but need that logical id for upcoming resources. For example, handling streaming data from an ECG. Each Observation references the patient and device via logical id. In some cases Observation A is referenced by Observation B sent at a later time.</p>



<a name="153996598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996598">(Sep 13 2018 at 11:27)</a>:</h4>
<p>That's probably the original intention of "Update as Create" - except that you don't want to update</p>



<a name="153996603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996603">(Sep 13 2018 at 11:27)</a>:</h4>
<blockquote>
<p>That's probably the original intention of "Update as Create" - except that you don't want to update</p>
</blockquote>
<p>Right!</p>



<a name="153996607"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996607" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996607">(Sep 13 2018 at 11:31)</a>:</h4>
<p>But basically ... if you ensure that the client created id doesn't already exist on the server, you get what you want.<br>
As stated in <a href="http://build.fhir.org/http.html#upsert" target="_blank" title="http://build.fhir.org/http.html#upsert">http://build.fhir.org/http.html#upsert</a> :</p>
<p>"Alternatively, clients may be sharing an agreed identification model (e.g. key server, scoped identifiers, or UUIDs) where clashes do not arise. Note that this use of update has security implications. "</p>



<a name="153996608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996608">(Sep 13 2018 at 11:32)</a>:</h4>
<p>In this case, Conditional update WITH Update as Create would do what you want</p>



<a name="153996611"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996611" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996611">(Sep 13 2018 at 11:34)</a>:</h4>
<p>Somebody should draw a diagram on that whole thing ...</p>



<a name="153996919"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996919" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996919">(Sep 14 2018 at 08:33)</a>:</h4>
<p>something like this?: <a href="user_uploads/10155/fkQZy2tVEMfLg13nWIgXhXNi/conditional_update.png" target="_blank" title="user_uploads/10155/fkQZy2tVEMfLg13nWIgXhXNi/conditional_update.png">conditional_update.png</a> <br>
(fixed version)</p>
<div class="message_inline_image"><a href="user_uploads/10155/fkQZy2tVEMfLg13nWIgXhXNi/conditional_update.png" target="_blank" title="conditional_update.png"><img src="user_uploads/10155/fkQZy2tVEMfLg13nWIgXhXNi/conditional_update.png"></a></div>



<a name="153996921"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996921" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996921">(Sep 14 2018 at 08:42)</a>:</h4>
<blockquote>
<p>something like this?: <a href="/user_uploads/10155/e8gMs-9sRRRkVLZH4cGgNOuh/conditional_update.png" target="_blank" title="conditional_update.png">conditional_update.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/e8gMs-9sRRRkVLZH4cGgNOuh/conditional_update.png" target="_blank" title="conditional_update.png"><img src="/user_uploads/10155/e8gMs-9sRRRkVLZH4cGgNOuh/conditional_update.png"></a></div></blockquote>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span>  if the condition matches only once on a conditional create you do nothing. That's the point. Why are you creating a resource when the condition matches?</p>
<p>I would like a situation where if the condition matches one does nothing BUT if the resource is not found it is created with my provided id. As far as I know that option does not exist. For many clients, especially on small resource-limited platforms, handling a server response to get ids that are needed in resources being concurrently generated is complicated, one needs queuing and thus memory resources. An example of such a situation is sending streaming pulse oximeter data from a home environment.</p>



<a name="153996922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996922">(Sep 14 2018 at 08:46)</a>:</h4>
<p>You are talking about Conditional Creates, this is about Conditional Updates</p>



<a name="153996923"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996923" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996923">(Sep 14 2018 at 08:47)</a>:</h4>
<p>What you are searching already exists: <a href="https://www.hl7.org/fhir/http.html#ccreate" target="_blank" title="https://www.hl7.org/fhir/http.html#ccreate">https://www.hl7.org/fhir/http.html#ccreate</a></p>



<a name="153996924"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996924" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996924">(Sep 14 2018 at 08:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191436">@Stefan Lang</span> or take this one if you prefer DMN over BPMN <a href="/user_uploads/10155/biHpwrY9KjCttAjtG9GPsQey/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png">conditional_update_DMN.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/biHpwrY9KjCttAjtG9GPsQey/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png"><img src="/user_uploads/10155/biHpwrY9KjCttAjtG9GPsQey/conditional_update_DMN.png"></a></div>



<a name="153996925"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996925" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996925">(Sep 14 2018 at 08:49)</a>:</h4>
<blockquote>
<p>What you are searching already exists: <a href="https://www.hl7.org/fhir/http.html#ccreate" target="_blank" title="https://www.hl7.org/fhir/http.html#ccreate">https://www.hl7.org/fhir/http.html#ccreate</a></p>
</blockquote>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span>  I see. You have 'conditional POST'. If you are talking about conditional updates use 'conditional PUT'. The POST makes it a conditional create.</p>



<a name="153996926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996926">(Sep 14 2018 at 08:49)</a>:</h4>
<p>omg, thx :-) fixed it above</p>



<a name="153996927"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996927" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996927">(Sep 14 2018 at 08:54)</a>:</h4>
<blockquote>
<p>omg, thx :-)</p>
</blockquote>
<p>Given that, I am still a little confused about the what you do when a single match is found and a logical id provided. In that case you create a new resource in spite of the fact a resource already exists with the condition specified. Why does this happen and not just an update? I would expect the logical id is provided for the case where a resource is not found and one is made using that logical id.</p>



<a name="153996928"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996928" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996928">(Sep 14 2018 at 08:57)</a>:</h4>
<p>you are right, i did my diagram based on the GF Tracker item, which includes these from you:<br>
Copy &amp; paste additional proposal by Angus Millar:</p>
<p>One Match: no resource id provided, create ands assign new id<br>
One Match resource id provided and it matches the found resource ,update that resourece<br>
One Match resource id provided does not match resource found , reject update</p>



<a name="153996929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996929">(Sep 14 2018 at 08:58)</a>:</h4>
<p>but you are right</p>



<a name="153996930"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996930" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996930">(Sep 14 2018 at 08:58)</a>:</h4>
<p>One Match should only have two results: <br>
- Update<br>
- REJECT</p>



<a name="153996931"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996931" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996931">(Sep 14 2018 at 09:01)</a>:</h4>
<blockquote>
<p>you are right, i did my diagram based on the GF Tracker item, which includes these from you:<br>
Copy &amp; paste additional proposal by Angus Millar:</p>
<p>One Match: no resource id provided, create ands assign new id<br>
One Match resource id provided and it matches the found resource ,update that resourece<br>
One Match resource id provided does not match resource found , reject update</p>
</blockquote>
<p>The 'One Match: no resource id provided, create ands assign new id' makes no sense to me. The idea that you found a match indicates that the resource you are looking for exists and is the only one that exists with your criteria. If you want to make a new resource, just do it why go through all the matching logic? With that statement the result is the same whether there is a match or not. Well, if there are multiple matches then there is a reject.</p>



<a name="153996932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996932">(Sep 14 2018 at 09:02)</a>:</h4>
<p>Right, no create should happen when one match is found</p>



<a name="153996933"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996933" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996933">(Sep 14 2018 at 09:02)</a>:</h4>
<p>Yes</p>



<a name="153996934"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996934" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996934">(Sep 14 2018 at 09:03)</a>:</h4>
<p>alright here you go (again) <a href="/user_uploads/10155/lHOyGl_Yz42luJdlLfv4JQvy/conditional_update.png" target="_blank" title="conditional_update.png">conditional_update.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/lHOyGl_Yz42luJdlLfv4JQvy/conditional_update.png" target="_blank" title="conditional_update.png"><img src="/user_uploads/10155/lHOyGl_Yz42luJdlLfv4JQvy/conditional_update.png"></a></div>



<a name="153996935"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996935" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996935">(Sep 14 2018 at 09:05)</a>:</h4>
<p><a href="/user_uploads/10155/hMidoFcRBu0jiCrT8NU7T5ck/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png">conditional_update_DMN.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/hMidoFcRBu0jiCrT8NU7T5ck/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png"><img src="/user_uploads/10155/hMidoFcRBu0jiCrT8NU7T5ck/conditional_update_DMN.png"></a></div>



<a name="153996936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996936">(Sep 14 2018 at 09:07)</a>:</h4>
<p>I think in the diagram this should be "<strong>No resource id provided or</strong> resource id and found-resource-ID are matching"</p>



<a name="153996937"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996937" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996937">(Sep 14 2018 at 09:10)</a>:</h4>
<p>DMN:<br>
rows 2 and 3 need "false" in the "multiple matches" column<br>
and a row "3a" is needed: true/false/false/-/UPDATE</p>



<a name="153996938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996938">(Sep 14 2018 at 09:17)</a>:</h4>
<blockquote>
<p><a href="/user_uploads/10155/hMidoFcRBu0jiCrT8NU7T5ck/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png">conditional_update_DMN.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/hMidoFcRBu0jiCrT8NU7T5ck/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png"><img src="/user_uploads/10155/hMidoFcRBu0jiCrT8NU7T5ck/conditional_update_DMN.png"></a></div></blockquote>
<p>On a conditional update my understanding is this<br>
1. A condition is specified<br>
2. IF one and only one resource is found, it is updated (otherwise error). Any provided logical id by the client is ignored. - 'the conditional part of the update'<br>
3. If no matches are found, the resource is created with the logical id provided by the client - classic update transaction<br>
4. The new thing is (as I understand it) if the logical id is not provided, the resource is created where the server generates the logical id.</p>
<p>Step 4 was added as a clarification because in the classic update, it is clear that one had to specify a logical id. In the conditional update, that statement was not explicitly made. So now we have the option to specify or not specify a logical id. It also satisfies a different use case; one where the client does not know the logical id. I had a use case where I knew what the logical would be if the resource had been created but what I didn't know was if it was already created. So I wanted to check for existence first (without doing a GET). If it didnt exist I wanted to create it with my id. But if it did exist, I wanted to do nothing but using the conditional update would cause the existing resource to be updated (even though the content of the resource was identical).</p>



<a name="153996939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996939">(Sep 14 2018 at 09:19)</a>:</h4>
<p>Step 3 actually is "Update as Create".<br>
Step 4 is the STU3 behavior for conditional update with no matches</p>



<a name="153996940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996940">(Sep 14 2018 at 09:24)</a>:</h4>
<blockquote>
<p>Step 3 actually is "Update as Create".<br>
Step 4 is the STU3 behavior for conditional update with no matches</p>
</blockquote>
<p><span class="user-mention" data-user-id="191436">@Stefan Lang</span> I think you have it backwards. In a create transaction you are not allowed to specify a logical id. In an update transaction, you are required to specify a logical id. When I did a conditional update on a HAPI FHIR server, I always specified the logical id and it would generate the resource if it did not exist with my logical id. I never tried doing a conditional update without specifying a logical id.<br>
In a conditional create I am not allowed to specify a logical id (unless it is a temporary id in a bundle but that's a different story).</p>



<a name="153996943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996943">(Sep 14 2018 at 09:26)</a>:</h4>
<p>AFAIK the whole use of conditional update is not knowing the id</p>



<a name="153996945"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996945" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996945">(Sep 14 2018 at 09:28)</a>:</h4>
<blockquote>
<p>Step 3 actually is "Update as Create".<br>
Step 4 is the STU3 behavior for conditional update with no matches</p>
</blockquote>
<p>Rule 3 is Update: i have a matching Condition, and a matching provided ID -&gt; UPDATE</p>



<a name="153996946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996946">(Sep 14 2018 at 09:29)</a>:</h4>
<p>and RULE4 is the same as in STU3</p>



<a name="153996947"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996947" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996947">(Sep 14 2018 at 09:30)</a>:</h4>
<p>Brian's Step 3 says "If no matches are found" =&gt; create ;-)</p>



<a name="153996948"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996948" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996948">(Sep 14 2018 at 09:31)</a>:</h4>
<p>i agree, but you could do a condUpdate with a search criteria despite the fact that you know the ID. (Maybe making shure this resource only exists once on the server)</p>



<a name="153996950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996950">(Sep 14 2018 at 09:31)</a>:</h4>
<blockquote>
<p>AFAIK the whole use of conditional update is not knowing the id</p>
</blockquote>
<p>I had a slightly different use case; I knew what the logical id would be (it was specified by a standard). What I didn't know was if the resource had already been created.</p>
<p>But not knowing the logical id is fine, too. Thus you provide the condition. This does not prevent you from specifying the logical id in case the resource needs to be generated. What was not clear in STU3 version was if you are doing a conditional update, do you still have to specify a logical id for the case where the resource is not found. In a classic update, the spec says you have to provide a logical ID. What R4 is doing is saying in a conditional update, you can either specify the logical id or not. If you don't, a no-match case is handled like a create and not an update.</p>



<a name="153996953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996953">(Sep 14 2018 at 09:34)</a>:</h4>
<blockquote>
<p>DMN:<br>
rows 2 and 3 need "false" in the "multiple matches" column</p>
</blockquote>
<p>actually it doesn't (Rule1 already handles all multiple matches) but i added it for clarification. <a href="/user_uploads/10155/lVChESLhRbxATyb_xjXWvouU/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png">conditional_update_DMN.png</a> <a href="/user_uploads/10155/nPzHCoe1b85JpjWfSP0GqK8_/conditional_update.png" target="_blank" title="conditional_update.png">conditional_update.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/lVChESLhRbxATyb_xjXWvouU/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png"><img src="/user_uploads/10155/lVChESLhRbxATyb_xjXWvouU/conditional_update_DMN.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/nPzHCoe1b85JpjWfSP0GqK8_/conditional_update.png" target="_blank" title="conditional_update.png"><img src="/user_uploads/10155/nPzHCoe1b85JpjWfSP0GqK8_/conditional_update.png"></a></div>



<a name="153996956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996956">(Sep 14 2018 at 09:35)</a>:</h4>
<div class="codehilite"><pre><span></span>rows 2 and 3 need &quot;false&quot; in the &quot;multiple matches&quot; column
</pre></div>


<p>actually it doesn't (Rule1 already handles all multiple matches) but i added it for clarification. </p>
<p>Right, but thanks anyway ;-)</p>



<a name="153996957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Lang <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996957">(Sep 14 2018 at 09:37)</a>:</h4>
<p>I agree on both table and diagram</p>



<a name="153996963"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996963" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996963">(Sep 14 2018 at 09:42)</a>:</h4>
<blockquote>
<p>and RULE4 is the same as in STU3</p>
</blockquote>
<p>Not quite. This is where STU3 was vague. It wasn't clear what would happen if the resource was found and no logical id was provided. Given that the classic update required it, does this mean an error? I think R4 is trying to clarify this situation by saying ok, we allow both. Existing id will do an update and no id will do a create.</p>
<p>What probably happened was some  servers, after finding no match, handed the transaction to its 'update' method. That would cause an error if no id were provided. Now it needs to check for an id. If found, use the update method. If not, use the create method. Probably not too much extra work.</p>



<a name="153996970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996970">(Sep 14 2018 at 09:50)</a>:</h4>
<blockquote>
<blockquote>
<p>DMN:<br>
rows 2 and 3 need "false" in the "multiple matches" column</p>
</blockquote>
<p>actually it doesn't (Rule1 already handles all multiple matches) but i added it for clarification. <a href="/user_uploads/10155/lVChESLhRbxATyb_xjXWvouU/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png">conditional_update_DMN.png</a> <a href="/user_uploads/10155/nPzHCoe1b85JpjWfSP0GqK8_/conditional_update.png" target="_blank" title="conditional_update.png">conditional_update.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/lVChESLhRbxATyb_xjXWvouU/conditional_update_DMN.png" target="_blank" title="conditional_update_DMN.png"><img src="/user_uploads/10155/lVChESLhRbxATyb_xjXWvouU/conditional_update_DMN.png"></a></div><div class="message_inline_image"><a href="/user_uploads/10155/nPzHCoe1b85JpjWfSP0GqK8_/conditional_update.png" target="_blank" title="conditional_update.png"><img src="/user_uploads/10155/nPzHCoe1b85JpjWfSP0GqK8_/conditional_update.png"></a></div></blockquote>
<p><span class="user-mention" data-user-id="191451">@Patrick Werner</span>  I don't know what should happen if the resource is found and the logical id is specified but does not match the logical id of the found resource. Should that be an error? Say I don't know the logical id but  want to generate (I use generate instead of create to avoid confusion) the resource if it is not found WITH this logical id. If the resource is found with my conditions but it does not have my specified logical id, is that an error? I don't know. I would (personally) prefer that the specified logical id be looked at only if a resource is being generated. If it already exists, ignore it.</p>



<a name="153996972"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996972" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Patrick Werner <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996972">(Sep 14 2018 at 10:00)</a>:</h4>
<p>i disagree, if i provide an id in a conditional update (which is already an edge case) it should behave similar to a regular update.</p>
<p>UPDATE:</p>
<blockquote>
<p>The request body SHALL be a Resource with an id element that has an identical value to the [id] in the URL. If no id element is provided, or the id disagrees with the id in the URL, the server SHALL respond with an HTTP 400 error code, and SHOULD provide an OperationOutcome identifying the issue.</p>
</blockquote>



<a name="153996974"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/153996974" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Reinhold <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#153996974">(Sep 14 2018 at 10:35)</a>:</h4>
<blockquote>
<p>i disagree, if i provide an id in a conditional update (which is already an edge case) it should behave similar to a regular update.</p>
<p>UPDATE:</p>
<blockquote>
<p>The request body SHALL be a Resource with an id element that has an identical value to the [id] in the URL. If no id element is provided, or the id disagrees with the id in the URL, the server SHALL respond with an HTTP 400 error code, and SHOULD provide an OperationOutcome identifying the issue.</p>
</blockquote>
</blockquote>
<p>But as Stefan says, isn't the conditional update for when you don't know the logical id? The conditional is a different use case. A classic update is designed to update a resource that you know exists and know its id and if it doesnt exist you want to generate it with a specific id.</p>
<p>Conditional is different. You could do a GET based upon your search conditions (if you dont know the id) to see if the resource exists and then update it if it doesnt (specifying the id). But that involves two transactions and permission to obtain PHI from the server. The conditional is attempting to allow you to accomplish all that in one transaction without the need for permissions to extract data from the server.</p>



<a name="161687547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/161687547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#161687547">(Mar 25 2019 at 21:07)</a>:</h4>
<p>The proposed resolution pointed to in this discussion was adopted in R4, but recently, <span class="user-mention" data-user-id="191315">@Josh Mandel</span> raised a valid question on <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20390" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20390">GF#20390</a>.  The discussion above (which is now part of the R4 spec) uses the phrase "id provided" and "the logical id" pretty informally.  In the case of a conditional PUT, the FHIR REST URL does <em>not</em> have an id (as it would for a normal PUT), so where exactly does this "provided id" live?  In <a href="http://Resource.id" target="_blank" title="http://Resource.id">Resource.id</a>?  Or in the _id search parameter?   </p>
<p>It's conceivable that you'd have search criteria without an _id, but want to conditionally create a resource with a given <a href="http://Resource.id" target="_blank" title="http://Resource.id">Resource.id</a>.  Yet the last sentence in the text on conditional updates says: "If an id is provided, the server SHALL ignore it" - so this suggests we cannot use <a href="http://Resource.id" target="_blank" title="http://Resource.id">Resource.id</a></p>
<p>Anyway, I suspect this refers to <a href="http://Resource.id" target="_blank" title="http://Resource.id">Resource.id</a>, and we should remove the last sentence of that paragraph, but in a FHIR-I discussion with some implementers on the call, we could not reach a final conclusion, and we all had our own differing interpretation of the current R4 text.</p>
<p>What to do about it?</p>



<a name="161752948"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/161752948" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kenneth Myhra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#161752948">(Mar 26 2019 at 11:45)</a>:</h4>
<p>The introduction of id provided introduces IMO a subtle second criteria (<a href="http://Resource.id" target="_blank" title="http://Resource.id">Resource.id</a>).<br>
If you have a <a href="http://Resource.id" target="_blank" title="http://Resource.id">Resource.id</a> and your intention is to update an existing or create a new resource by id provided, shouldn't you then just use Update as create?<br>
While if I want to do a Conditional update I explicitly define my search parameters on the query string and if I accidentally forget to remove <a href="http://Resource.id" target="_blank" title="http://Resource.id">Resource.id</a> the server disregards the id and creates a new resource if no matches.</p>



<a name="161794174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Transaction%20conditional%20create%20OR%20update/near/161794174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kenneth Myhra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Transaction.20conditional.20create.20OR.20update.html#161794174">(Mar 26 2019 at 19:17)</a>:</h4>
<p>Disregard my comment above, I think I can see the use-case for this and therefore agree with Ewout's conclusion to remove the paragraph stating: "If an id is provided, the server SHALL ignore it". Also misinterpreted the "Update as create" thinking it meant it would update that resource if it is was found, rather it is a Create operation and will only create the resource using the provided id if not found.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
