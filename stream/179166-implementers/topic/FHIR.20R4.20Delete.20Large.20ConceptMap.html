---
layout: page
title: "FHIR Chat  · FHIR R4 Delete Large ConceptMap · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20R4.20Delete.20Large.20ConceptMap.html">FHIR R4 Delete Large ConceptMap</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="244439750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20R4%20Delete%20Large%20ConceptMap/near/244439750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Surendra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20R4.20Delete.20Large.20ConceptMap.html#244439750">(Jun 30 2021 at 15:16)</a>:</h4>
<p>Hi All, I am new to this portal and do not exactly know the question template so please bear with me.</p>
<p><strong>Preface</strong>: We are using hapi fhir r4 5.1 version and the FHIR client update method to update a resource or create a resource (if the resource doesn't already exist).</p>
<p><strong>Problem</strong>: We have a large ConcepMap containing thousands of mapping. When an existing ConceptMap is upserted, it takes around 25 minutes to perform the operation. More importantly and <em>surprisingly</em>, the delete operation in the upsert is taking 20min (<strong>~67%</strong> time).<br>
Is there a way to optimize it?</p>
<p>We are using elastic search with FHIR.</p>
<p>Thanks.</p>



<a name="244445251"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20R4%20Delete%20Large%20ConceptMap/near/244445251" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20R4.20Delete.20Large.20ConceptMap.html#244445251">(Jun 30 2021 at 15:51)</a>:</h4>
<p>What FHIR server are you using?  That certainly sounds like a database design/indexing issue.  (If the problem was just transmission time, you could look at using PATCH for a pure update, but for upsert, that wouldn't work.)</p>



<a name="244445745"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20R4%20Delete%20Large%20ConceptMap/near/244445745" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Surendra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20R4.20Delete.20Large.20ConceptMap.html#244445745">(Jun 30 2021 at 15:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> We are using hapi-fhir-jpa-server. Database design/indexing is provided by hapi-fhir itself.</p>
<p>using IGenericClient to perform the operation like this</p>
<div class="codehilite"><pre><span></span><code>fhiClient.update().resource(&lt;RESOURCE&gt;).execute()
</code></pre></div>



<a name="244446632"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20R4%20Delete%20Large%20ConceptMap/near/244446632" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Surendra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20R4.20Delete.20Large.20ConceptMap.html#244446632">(Jun 30 2021 at 15:59)</a>:</h4>
<p>Here is the code which takes this 66% of the time to delete the existing resource before creating a new</p>
<p><a href="https://github.com/hapifhir/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermConceptMappingSvcImpl.java#L583-L598">https://github.com/hapifhir/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermConceptMappingSvcImpl.java#L583-L598</a></p>



<a name="244467569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20R4%20Delete%20Large%20ConceptMap/near/244467569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20R4.20Delete.20Large.20ConceptMap.html#244467569">(Jun 30 2021 at 18:25)</a>:</h4>
<p>You may be best raising this on the <a class="stream" data-stream-id="179167" href="/#narrow/stream/179167-hapi">#hapi</a> stream</p>



<a name="244469442"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIR%20R4%20Delete%20Large%20ConceptMap/near/244469442" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIR.20R4.20Delete.20Large.20ConceptMap.html#244469442">(Jun 30 2021 at 18:38)</a>:</h4>
<p>This is definitely a known limitation that we'd like to address. Most of our perf work has been done to the lookup of codes/valuesets/concept mappings since that is more critical to be fast, but some of the write operations are quite unoptimized.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
