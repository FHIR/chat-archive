---
layout: page
title: "FHIR Chat  · constraining a bundle to a profiled composition · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/constraining.20a.20bundle.20to.20a.20profiled.20composition.html">constraining a bundle to a profiled composition</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153870772"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/constraining%20a%20bundle%20to%20a%20profiled%20composition/near/153870772" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/constraining.20a.20bundle.20to.20a.20profiled.20composition.html#153870772">(Feb 08 2017 at 21:31)</a>:</h4>
<p>i would like to constrain a bundle to a specific profiled composition.  i'm not successful with my structuredefinition, the validator doesn't raise an error if i don't put the profile on the composition. does anybody know an example for STU3 how a slice for a bundle  would work? I tried it the following way:</p>
<div class="codehilite"><pre>    &lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; /&gt;
    &lt;derivation value=&quot;constraint&quot; /&gt;
    &lt;differential&gt;
        &lt;element id=&quot;Bundle&quot;&gt;
            &lt;path value=&quot;Bundle&quot; /&gt;
            &lt;base&gt;
                &lt;path value=&quot;Bundle&quot; /&gt;
                &lt;min value=&quot;1&quot; /&gt;
                &lt;max value=&quot;1&quot; /&gt;
            &lt;/base&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.type&quot;&gt;
            &lt;path value=&quot;Bundle.type&quot; /&gt;
            &lt;fixedCode value=&quot;document&quot; /&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.entry&quot;&gt;
            &lt;path value=&quot;Bundle.entry&quot;/&gt;
            &lt;slicing&gt;
                &lt;discriminator value=&quot;resource&quot;/&gt;
                &lt;ordered value=&quot;true&quot;/&gt;
                &lt;rules value=&quot;open&quot;/&gt;
            &lt;/slicing&gt;
            &lt;min value=&quot;1&quot;/&gt;
            &lt;max value=&quot;*&quot;/&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.entry.resource:Composition&quot;&gt;
            &lt;path value=&quot;Bundle.entry.resource&quot;/&gt;
            &lt;type&gt;
                &lt;code value=&quot;Composition&quot;/&gt;
                &lt;profile value=&quot;http://snip&quot;/&gt;
            &lt;/type&gt;
        &lt;/element&gt;
    &lt;/differential&gt;
</pre></div>


<p>Any hints or link to a sample highly appreciated.</p>



<a name="153870785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/constraining%20a%20bundle%20to%20a%20profiled%20composition/near/153870785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/constraining.20a.20bundle.20to.20a.20profiled.20composition.html#153870785">(Feb 08 2017 at 23:49)</a>:</h4>
<p>Well, you've defined slicing but haven't actually declared your slice - you need to have an additional element with path "Bundle.entry" with a slice name that then has the child element.  As well, your slice discriminator is just a path - which means you're slicing by fixed value, value set or existence.  I think you probably want the discriminator to be resource.@type.</p>



<a name="153870786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/constraining%20a%20bundle%20to%20a%20profiled%20composition/near/153870786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/constraining.20a.20bundle.20to.20a.20profiled.20composition.html#153870786">(Feb 08 2017 at 23:49)</a>:</h4>
<p>Even if you fix this, it may not work - not sure if the validator supports slicing elements of type Resource as that requires somewhat special behavior.</p>



<a name="153870926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/constraining%20a%20bundle%20to%20a%20profiled%20composition/near/153870926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/constraining.20a.20bundle.20to.20a.20profiled.20composition.html#153870926">(Feb 09 2017 at 21:51)</a>:</h4>
<p>Thanks for your input <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>. I adjusted it to your recommendations and have not the following:</p>
<div class="codehilite"><pre><span></span>    &lt;differential&gt;
        &lt;element id=&quot;Bundle&quot;&gt;
            &lt;path value=&quot;Bundle&quot; /&gt;
            &lt;min value=&quot;1&quot; /&gt;
            &lt;max value=&quot;1&quot; /&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.type&quot;&gt;
            &lt;path value=&quot;Bundle.type&quot; /&gt;
            &lt;fixedCode value=&quot;document&quot; /&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.entry&quot;&gt;
            &lt;path value=&quot;Bundle.entry&quot; /&gt;
            &lt;slicing&gt;
                &lt;discriminator value=&quot;resource.@type&quot; /&gt;
                &lt;ordered value=&quot;true&quot; /&gt;
                &lt;rules value=&quot;openAtEnd&quot; /&gt;
            &lt;/slicing&gt;
            &lt;min value=&quot;1&quot; /&gt;
            &lt;max value=&quot;*&quot; /&gt;
        &lt;/element&gt;
        &lt;!-- first slice --&gt;
        &lt;element id=&quot;Bundle.entry:Composition&quot;&gt;
            &lt;path value=&quot;Bundle.entry&quot; /&gt;
&lt;!--            &lt;sliceName value=&quot;Composition&quot; /&gt; IG Publisher does not like the slicename --&gt;
            &lt;min value=&quot;1&quot; /&gt;
            &lt;max value=&quot;1&quot; /&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.entry.resource:Composition&quot;&gt;
            &lt;path value=&quot;Bundle.entry.resource&quot; /&gt;
&lt;!--            &lt;sliceName value=&quot;Composition&quot; /&gt; --&gt;
            &lt;min value=&quot;1&quot; /&gt;
            &lt;max value=&quot;1&quot; /&gt;
            &lt;type&gt;
                &lt;code value=&quot;Composition&quot; /&gt;
                &lt;profile value=&quot;http://snip&quot;/&gt;
            &lt;/type&gt;
        &lt;/element&gt;
</pre></div>


<p>validating with discriminator resource.@type works. when i enter another type an error is thrown. the profile is somehow honored, but I don't think the composition is then directly validated against the profile (i can change the composition content with errors and don't get a validation error afterwards).</p>
<p>the ig publisher does not like the xml sample file which works with the validator (Unable to find discriminator definition for Bundle.entry.resource.@type in resource.@type at Bundle.entry[1]), there seems to be a difference between validator and ig publisher which i have to find out.</p>
<p>if i have put discriminator with resource.@profile the validator throws an error (Validating against slices with discriminators based on profiles is not yet supported by the FHIRPath engine: resource.@profile).</p>
<p>So I think I'm on a good path, I will try to figure out whats the difference between validating from ig publisher/validator and if successful send in a patch, thanks one more time for guiding me to the right direction.</p>



<a name="153870950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/constraining%20a%20bundle%20to%20a%20profiled%20composition/near/153870950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/constraining.20a.20bundle.20to.20a.20profiled.20composition.html#153870950">(Feb 10 2017 at 01:09)</a>:</h4>
<p>Not sure why it's yelling about slice name on your Bundle.entry.  Don't need one on Bundle.entry.resource</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
