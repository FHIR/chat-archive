---
layout: page
title: "FHIR Chat  · Overly zealous validation rules? · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Overly.20zealous.20validation.20rules.3F.html">Overly zealous validation rules?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="165865428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Overly%20zealous%20validation%20rules%3F/near/165865428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Overly.20zealous.20validation.20rules.3F.html#165865428">(May 17 2019 at 01:50)</a>:</h4>
<p>The InstanceValidator imposes the following rules on the default "all codes in the system" ValueSet of a CodeSystem:</p>
<div class="codehilite"><pre><span></span><span class="n">vs</span><span class="o">.</span><span class="na">hasCompose</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vs</span><span class="o">.</span><span class="na">hasExpansion</span><span class="o">(),</span> <span class="s">&quot;CodeSystem &quot;</span><span class="o">+</span><span class="n">url</span><span class="o">+</span><span class="s">&quot; has a &#39;all system&#39; value set of &quot;</span><span class="o">+</span><span class="n">vsu</span><span class="o">+</span><span class="s">&quot;, but it is an expansion&quot;</span>
</pre></div>


<p>Why is no expansion allowed?  We stumbled across this because we include the <code>valueset-unclosed</code> extension by default, and this extension goes on the expansion element.</p>
<div class="codehilite"><pre><span></span><span class="n">vs</span><span class="o">.</span><span class="na">getCompose</span><span class="o">().</span><span class="na">getInclude</span><span class="o">().</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">,</span> <span class="s">&quot;CodeSystem &quot;</span><span class="o">+</span><span class="n">url</span><span class="o">+</span><span class="s">&quot; has a &#39;all system&#39; value set of &quot;</span><span class="o">+</span><span class="n">vsu</span><span class="o">+</span><span class="s">&quot;, but doesn&#39;t have a single include&quot;</span>
</pre></div>


<p>This might be a problem in case the CodeSystem is some kind of composite as is commonly seen with OWL-based terminologies.  Granted a canonical "all codes" ValueSet definition should only require a single include that specifies the system URI (and possibly the version as well), but there may be other semantically equivalent definitions that convey useful information to a person.</p>
<div class="codehilite"><pre><span></span><span class="n">vs</span><span class="o">.</span><span class="na">getCompose</span><span class="o">().</span><span class="na">getInclude</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getSystem</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">url</span><span class="o">),</span> <span class="s">&quot;CodeSystem &quot;</span><span class="o">+</span><span class="n">url</span><span class="o">+</span><span class="s">&quot; has a &#39;all system&#39; value set of &quot;</span><span class="o">+</span><span class="n">vsu</span><span class="o">+</span><span class="s">&quot;, but doesn&#39;t have a matching system (&quot;</span><span class="o">+</span><span class="n">vs</span><span class="o">.</span><span class="na">getCompose</span><span class="o">().</span><span class="na">getInclude</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getSystem</span><span class="o">()+</span><span class="s">&quot;)&quot;</span>
</pre></div>


<p>See point above.</p>
<div class="codehilite"><pre><span></span><span class="o">!</span><span class="n">vs</span><span class="o">.</span><span class="na">getCompose</span><span class="o">().</span><span class="na">getInclude</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">hasValueSet</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vs</span><span class="o">.</span><span class="na">getCompose</span><span class="o">().</span><span class="na">getInclude</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">hasConcept</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vs</span><span class="o">.</span><span class="na">getCompose</span><span class="o">().</span><span class="na">getInclude</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">hasFilter</span><span class="o">(),</span> <span class="s">&quot;CodeSystem &quot;</span><span class="o">+</span><span class="n">url</span><span class="o">+</span><span class="s">&quot; has a &#39;all system&#39; value set of &quot;</span><span class="o">+</span><span class="n">vsu</span><span class="o">+</span><span class="s">&quot;, but the include has extra details&quot;</span>
</pre></div>


<p>Again, we ran into this because we included an explicit filter condition with the SNOMED ECL expression "*".  Why should validation exclude this possibility?</p>



<a name="165865525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Overly%20zealous%20validation%20rules%3F/near/165865525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Overly.20zealous.20validation.20rules.3F.html#165865525">(May 17 2019 at 01:53)</a>:</h4>
<p>what I was thinking is that any enumeration in an expansion is problematic from a version control perspective</p>



<a name="165865529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Overly%20zealous%20validation%20rules%3F/near/165865529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Overly.20zealous.20validation.20rules.3F.html#165865529">(May 17 2019 at 01:53)</a>:</h4>
<p>but I accept that this is a policy thing not a base conformance issue</p>



<a name="165865576"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Overly%20zealous%20validation%20rules%3F/near/165865576" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Overly.20zealous.20validation.20rules.3F.html#165865576">(May 17 2019 at 01:54)</a>:</h4>
<p>also I didn't know how to validate an expansion in this context</p>



<a name="165865602"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Overly%20zealous%20validation%20rules%3F/near/165865602" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Lawley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Overly.20zealous.20validation.20rules.3F.html#165865602">(May 17 2019 at 01:55)</a>:</h4>
<p>Agreed.  However the ValueSet itself may be version-specific (and ours is in this case)</p>



<a name="165865670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Overly%20zealous%20validation%20rules%3F/near/165865670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Overly.20zealous.20validation.20rules.3F.html#165865670">(May 17 2019 at 01:56)</a>:</h4>
<p>make an issue report (<a href="https://github.com/hapifhir/org.hl7.fhir.core/issues" target="_blank" title="https://github.com/hapifhir/org.hl7.fhir.core/issues">https://github.com/hapifhir/org.hl7.fhir.core/issues</a>) and I'll get to it</p>



<a name="165865675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Overly%20zealous%20validation%20rules%3F/near/165865675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Overly.20zealous.20validation.20rules.3F.html#165865675">(May 17 2019 at 01:56)</a>:</h4>
<p>(or better, make an issue report + a PR)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
