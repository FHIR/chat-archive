---
layout: page
title: "FHIR Chat  · Using custom maps to convert from STU3 to R4 · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Using.20custom.20maps.20to.20convert.20from.20STU3.20to.20R4.html">Using custom maps to convert from STU3 to R4</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="200121153"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Using%20custom%20maps%20to%20convert%20from%20STU3%20to%20R4/near/200121153" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Debashish Ghosh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Using.20custom.20maps.20to.20convert.20from.20STU3.20to.20R4.html#200121153">(Jun 08 2020 at 16:13)</a>:</h4>
<p>Hi,<br>
    I am currently exploring the Validator tool ( <a href="https://github.com/hapifhir/org.hl7.fhir.core">https://github.com/hapifhir/org.hl7.fhir.core</a>)  to convert from one Fhir version to another . The default maps provided (<a href="https://github.com/FHIR/packages/tree/master/interversion/r4/R3toR4">https://github.com/FHIR/packages/tree/master/interversion/r4/R3toR4</a>) suffices for most of the cases .<br>
But in future if we want to add some extensions we would want to be able to use the updated .map version for that resource to accomodate that . For example I am using the following comandline arguments for the Validator Tool to use my local custom map for Resource Condition .<br>
c:\fhirmessages\fhir_condition_epic_stu3_searched.json -version 3.0 -to-version 4.0 -output c:\fhirmessages\fhir_condition_epic_r4_searched_output.json -do-native -ig C:\fhirmessages\maps_new</p>
<p>The last argument -ig refers to the directory from where it should load my updated Condtions.map. <br>
But while running it keeps giving the following error :</p>
<ul>
<li>.. load IG from C:\fhirmessages\maps_new</li>
<li>load file: Condition.txt - ignored due to error:  (null - NPE)</li>
</ul>
<p>Am I missing something here . Has anybody used this tool to do conversion using you custom maps ?</p>
<p>Any help on this is greatly appreciated !</p>
<p>Thanks</p>



<a name="200121362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Using%20custom%20maps%20to%20convert%20from%20STU3%20to%20R4/near/200121362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Using.20custom.20maps.20to.20convert.20from.20STU3.20to.20R4.html#200121362">(Jun 08 2020 at 16:15)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="200140337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Using%20custom%20maps%20to%20convert%20from%20STU3%20to%20R4/near/200140337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Using.20custom.20maps.20to.20convert.20from.20STU3.20to.20R4.html#200140337">(Jun 08 2020 at 18:49)</a>:</h4>
<p>you pointed it to a directory to load content from. It's just telling you that it found a file in there that it couldn't read as loadable content. In this case, it looks like it shouldn't be loaded, so that's fine</p>



<a name="200145641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Using%20custom%20maps%20to%20convert%20from%20STU3%20to%20R4/near/200145641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Debashish Ghosh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Using.20custom.20maps.20to.20convert.20from.20STU3.20to.20R4.html#200145641">(Jun 08 2020 at 19:36)</a>:</h4>
<p>Thanks for your reply . So I am trying to do a conversion from STU3 to R4 and following the documentation <a href="https://wiki.hl7.org/Using_the_FHIR_Validator_to_transform_content#R3_.2F_R4_conversions">https://wiki.hl7.org/Using_the_FHIR_Validator_to_transform_content#R3_.2F_R4_conversions</a> .</p>
<p>Based on the documentation I provided the following arguments to the tool :<br>
c:\fhirmessages\fhir_condition_epic_stu3_searched.json -transform <a href="http://hl7.org/fhir/StructureMap/Condition3to4">http://hl7.org/fhir/StructureMap/Condition3to4</a> -ig C:\fhirmessages\maps_new\interversion\r4\R3toR4 -output c:\fhirmessages\fhir_condition_epic_r4_searched_output.json -log c:\fhirmessages\log\logs.txt</p>
<p>I changed the Conditions.map file in C:\fhirmessages\maps_new\interversion\r4\R3toR4 and also copied all other files in this directory from <a href="https://github.com/FHIR/packages">https://github.com/FHIR/packages</a> . <br>
It keeps giving me the following error :</p>
<ul>
<li>
<p>.. load IG from C:\fhirmessages\maps_new\interversion\r4\R3toR4<br>
   ..Detect format for C:\fhirmessages\maps_new\interversion\r4\R3toR4\AdverseEvent.map.bak<br>
[Fatal Error] :1:1: Content is not allowed in prolog.</p>
</li>
<li>
<p>load file: ConceptMaps.txt - ignored due to error: Error in ConceptMaps.txt at 8, 6: Unknown relationship token '='<br>
Start Transform <a href="http://hl7.org/fhir/StructureMap/Condition3to4">http://hl7.org/fhir/StructureMap/Condition3to4</a><br>
Group : Condition; vars = source variables [src: (Bundle)], target variables [tgt: (Condition)], shared variables []<br>
Exception in thread "main" java.lang.Error: duplicate<br>
    at org.hl7.fhir.r5.utils.StructureMapUtilities.findMatchingMaps(StructureMapUtilities.java:1534)<br>
    at org.hl7.fhir.r5.utils.StructureMapUtilities.resolveGroupReference(StructureMapUtilities.java:1671)<br>
    at org.hl7.fhir.r5.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1402)<br>
    at org.hl7.fhir.r5.utils.StructureMapUtilities.transform(StructureMapUtilities.java:1369)<br>
    at org.hl7.fhir.validation.ValidationEngine.transform(ValidationEngine.java:1215)<br>
    at org.hl7.fhir.validation.ValidationEngine.transform(ValidationEngine.java:1202)<br>
    at org.hl7.fhir.validation.cli.services.ValidationService.transform(ValidationService.java:138)<br>
    at org.hl7.fhir.validation.Validator.main(Validator.java:180)</p>
</li>
</ul>
<p>I just want to change some mapping in the resource Condition and see how easy it is to update the mappings .<br>
Is there a trick I am missing out here to get this working ?</p>
<p>Thanks!</p>



<a name="200158445"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Using%20custom%20maps%20to%20convert%20from%20STU3%20to%20R4/near/200158445" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Using.20custom.20maps.20to.20convert.20from.20STU3.20to.20R4.html#200158445">(Jun 08 2020 at 21:29)</a>:</h4>
<p>well, it looks like you have a syntax error in tour revised mapping</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
