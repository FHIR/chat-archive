---
layout: page
title: "FHIR Chat  · Extension on closed slice · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html">Extension on closed slice</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="231755110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/231755110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kleop <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#231755110">(Mar 25 2021 at 06:56)</a>:</h4>
<p>Hey,<br>
a beginner question:<br>
I have a profile which is derived from a profile in which the identifer is sliced an closed:<br>
baseprofile:<br>
        &lt;element id="Patient.identifier"&gt;<br>
            &lt;path value="Patient.identifier" /&gt;<br>
            &lt;slicing&gt;<br>
                &lt;discriminator&gt;<br>
                    &lt;type value="value" /&gt;<br>
                    &lt;path value="type.coding.code" /&gt;<br>
                &lt;/discriminator&gt;<br>
                &lt;rules value="closed" /&gt;<br>
            &lt;/slicing&gt;<br>
        &lt;/element&gt;</p>
<p>I would like to add an extension to the identifier in the derived profile:</p>
<p>&lt;element id="Patient.identifier"&gt;<br>
  &lt;path value="Patient.identifier" /&gt; <br>
  &lt;min value="1" /&gt; <br>
  &lt;max value="1" /&gt; <br>
  &lt;mustSupport value="true" /&gt; <br>
  &lt;/element&gt;</p>
<ul>
<li>
<p>&lt;element id="Patient.identifier.extension"&gt;<br>
  &lt;path value="Patient.identifier.extension" /&gt; </p>
</li>
<li>
<p>&lt;slicing&gt;</p>
</li>
<li>
<p>&lt;discriminator&gt;<br>
  &lt;type value="value" /&gt; <br>
  &lt;path value="url" /&gt; <br>
  &lt;/discriminator&gt;<br>
  &lt;rules value="closed" /&gt; <br>
  &lt;/slicing&gt;<br>
  &lt;/element&gt;</p>
</li>
<li>
<p>&lt;element id="Patient.identifier.extension:test"&gt;<br>
  &lt;path value="Patient.identifier.extension" /&gt; <br>
  &lt;sliceName value="test" /&gt; <br>
  &lt;max value="1" /&gt; </p>
</li>
<li>
<p>&lt;type&gt;<br>
  &lt;code value="Extension" /&gt; <br>
  &lt;profile value="<a href="https://test/StructureDefinition/test">https://test/StructureDefinition/test</a>" /&gt; <br>
  &lt;/type&gt;<br>
  &lt;mustSupport value="true" /&gt; <br>
  &lt;/element&gt;</p>
</li>
<li>
<p>&lt;element id="Patient.identifier.extension:test.value[x]"&gt;<br>
  &lt;path value="Patient.identifier.extension.value[x]" /&gt; <br>
  &lt;mustSupport value="true" /&gt; <br>
  &lt;/element&gt;</p>
</li>
<li>
<p>&lt;element id="Patient.identifier.extension:test.value[x]:valueInteger"&gt;<br>
  &lt;path value="Patient.identifier.extension.value[x]" /&gt; <br>
  &lt;sliceName value="valueInteger" /&gt; <br>
  &lt;mustSupport value="true" /&gt; <br>
  &lt;/element&gt;</p>
</li>
</ul>
<p>Is this valid? And why not? <strong>since the validator returned an error</strong></p>
<p>thanks Mark</p>



<a name="231797895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/231797895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#231797895">(Mar 25 2021 at 13:15)</a>:</h4>
<p>What error are you getting?</p>
<p>Also, both constraining cardinality on identifier as well as closed slicing are things to be very cautious about as they tend to inhibit interoperability.  It's rare there's a good reason to stop a system from exposing whatever identifiers it has - you can always ignore the ones you don't care about.</p>



<a name="231840095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/231840095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kleop <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#231840095">(Mar 25 2021 at 17:11)</a>:</h4>
<p>I know this could be tricky, but this is a special use-case in which only a few identifiers are allowed. </p>
<p>But why is it forbidden to add an extension to an closed slice? the slices are independent from the usage of extensions, in my opinion. Or not?</p>
<p>The HL7 Validator returned (Translation from german):<br>
 This element does not fit to a known slice in profile XXX and the slicing is closed</p>



<a name="231840909"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/231840909" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#231840909">(Mar 25 2021 at 17:15)</a>:</h4>
<p>That sounds like a validation issue with the instance, not the profile?</p>



<a name="231840997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/231840997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#231840997">(Mar 25 2021 at 17:16)</a>:</h4>
<p>You may need to share the full profile and the full instance</p>



<a name="231920115"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/231920115" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kleop <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#231920115">(Mar 26 2021 at 06:18)</a>:</h4>
<p><a href="/user_uploads/10155/zn55z-4ioU9dsootak9G_1QR/test.zip">test.zip</a> <br>
here is a test zip:<br>
example is the example<br>
folder -ig inherits the necessary profiles<br>
folder basis 09.13 is necessary also</p>
<p>Thanks</p>



<a name="231960648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/231960648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#231960648">(Mar 26 2021 at 13:08)</a>:</h4>
<p>Your base profile says you're discriminating by type.coding.code and slicing is closed - but your instance doesn't declare type.coding.code.  Having an extension doesn't waive the constraints of the base profile - you still have to have a value that's valid against the base - which means declaring one of the specified type.coding.code values.</p>
<p>As an aside, you should <em>never</em> slice only by coding.code.  Code and system go together and looking at only the code and not the system isn't safe.  (Best practice is to actually slice by 'pattern' on the whole CodeableConcept and in your pattern declare a system and a code.)</p>



<a name="232027032"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/232027032" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kleop <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#232027032">(Mar 26 2021 at 20:26)</a>:</h4>
<p>Okay the way of defining this slicing rule could be optimized, but it would be valid to set every sclice to 0..0 and rule ele-1 would be satisfied since the Extension was integrated. I couldn't understand why this is faulty and got this error? The profile prohibits the slices and the example has not any.</p>



<a name="232029394"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/232029394" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#232029394">(Mar 26 2021 at 20:47)</a>:</h4>
<p>test2 defines closed slicing on identifier.  That means <em>every</em> identifier in the instance MUST match one of the slices defined in the test2 profile.  By constraining out all of the declared profiles, you've essentially said "you can't have an identifier here" because the closed slicing in the base says "all identifiers must match one of these slices" and the child profile says "no identifier can match any of the slices defined in the parent"</p>



<a name="232029467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/232029467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#232029467">(Mar 26 2021 at 20:48)</a>:</h4>
<p>This is one of the reasons why closed slicing should be used with great caution - it's saying "there can be no exceptions" - and in healthcare, there's almost always a need for exceptions...</p>



<a name="232066588"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Extension%20on%20closed%20slice/near/232066588" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kleop <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Extension.20on.20closed.20slice.html#232066588">(Mar 27 2021 at 05:46)</a>:</h4>
<p>Okay i think i got it now... Thanks for the detailed explanation</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
