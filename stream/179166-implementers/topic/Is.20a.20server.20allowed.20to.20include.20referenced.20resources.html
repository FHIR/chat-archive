---
layout: page
title: "FHIR Chat  · Is a server allowed to include referenced resources · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html">Is a server allowed to include referenced resources</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="255383469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255383469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255383469">(Sep 29 2021 at 11:40)</a>:</h4>
<p>Is a server allowed to add referenced resources in the returned searchset Bundle (with a <code>.entry.search.mode</code> = include) <strong>without</strong> the client actually using the _include parameter in the request?</p>



<a name="255396095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255396095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255396095">(Sep 29 2021 at 13:14)</a>:</h4>
<p>I don't believe we forbid this, but it's the kind of behavior that can lead to brittle clients</p>



<a name="255396143"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255396143" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255396143">(Sep 29 2021 at 13:14)</a>:</h4>
<p>(they'll start making assumptions that work in one environment and will fail elsewhere.)</p>



<a name="255397130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255397130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Moesel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255397130">(Sep 29 2021 at 13:20)</a>:</h4>
<p>I'd also be concerned about unsuspecting clients misinterpreting the results.  While it is good practice to check the <code>entry.search.mode</code>, I'm willing to bet there are clients that don't (or only do if they've specifically requested <code>_include</code>).  It would probably be bad (in some cases) for clients to treat unexpected <code>include</code> resources like <code>match</code> resources.</p>



<a name="255397698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255397698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255397698">(Sep 29 2021 at 13:24)</a>:</h4>
<p>To give more insight into our use case in the Nederlands (MedMij): we have a mixed environment of servers that are truly restful and ones that are based on facades and do not have an endpoint for everything. We state that all references should be resolvable. Servers can choose to support this by either allowing a read or include the referenced resource straight away in the Bundle. In this case, you would have them as contained resources or as included entries in the Bundle. The latter seems a better solution. Do you agree?</p>



<a name="255398939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255398939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255398939">(Sep 29 2021 at 13:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191469">@Chris Moesel</span> that's a really good point. In theory defensive clients would be consistent in checking bundle self links and entry modes before processing results; in practice I expect these checks happen ~never. (Are there other checks a client should do here? Was discussing with <span class="user-mention" data-user-id="222054">@Gino Canessa</span> that this would be a good subject for a tutorial video or blog.)</p>



<a name="255461605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255461605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255461605">(Sep 29 2021 at 19:42)</a>:</h4>
<blockquote>
<p>would be consistent in checking bundle self links and entry modes before processing results</p>
</blockquote>
<p>Our clients definitely do _not_ do that when processing generic search result - it expects that references are resolvable via REST call, not in the bundle</p>



<a name="255472897"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255472897" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vassil Peytchev <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255472897">(Sep 29 2021 at 20:56)</a>:</h4>
<p>Would the use case for the Netherlands be better served by requiring unresolvable-via-REST references to use identifiers?</p>



<a name="255503202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255503202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255503202">(Sep 30 2021 at 01:34)</a>:</h4>
<p>You'd still have the problem of returning them as Bundle.entry[] elements right alongside the "match" results, right?</p>



<a name="255505607"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255505607" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255505607">(Sep 30 2021 at 02:06)</a>:</h4>
<p>well, we can't mandate that systems aren't brittle. You can return included resources now, since we didn't say that you can't. I'd just document the issue clearly in the IG</p>



<a name="255505959"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255505959" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255505959">(Sep 30 2021 at 02:11)</a>:</h4>
<p>It might be worthwhile making that possibility explicit in the spec - change request <span class="user-mention" data-user-id="192301">@Ardon Toonstra</span> ?</p>



<a name="255513133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255513133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255513133">(Sep 30 2021 at 03:51)</a>:</h4>
<p>We can't mandate that clients aren't brittle, but it might still be good for us here in the chat to encourage patterns (especially for high profile national implementations with careful design) where clients opt in to this kind of inclusion.</p>



<a name="255523259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255523259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255523259">(Sep 30 2021 at 06:15)</a>:</h4>
<p>Patient safety concerns may also lead a server to include resources that a client perhaps wasn't expecting. "You can't safely interpret this without also looking at these other things. Ignore the other things at your peril".</p>



<a name="255538005"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255538005" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255538005">(Sep 30 2021 at 08:47)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span> ,</p>
<blockquote>
<p>Our clients definitely do _not_ do that when processing generic search result - it expects that references are resolvable via REST call, not in the bundle</p>
</blockquote>
<p>The <a href="https://hl7.org/FHIR/bundle.html#references">Bundle section about resolving references</a> states:<br>
"<em>Applications reading a Bundle should always look for a resource by its identity in the bundle first before trying to access it by its URL externally.</em>"</p>



<a name="255538305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255538305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ardon Toonstra <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255538305">(Sep 30 2021 at 08:49)</a>:</h4>
<blockquote>
<p>I'd just document the issue clearly in the IG</p>
</blockquote>
<p>You are right, I think we can improve our IG regarding this (made a ticket). I also made a ticket per Lloyds request: <a href="https://jira.hl7.org/browse/FHIR-34042">https://jira.hl7.org/browse/FHIR-34042</a></p>



<a name="255573499"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255573499" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255573499">(Sep 30 2021 at 13:28)</a>:</h4>
<p>We do that for _transaction_ bundles, but not for search results one, if there are no requested includes seem pointless (and actually _is_ pointless on all servers we connect to now).</p>



<a name="255578856"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255578856" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255578856">(Sep 30 2021 at 14:01)</a>:</h4>
<p>Sending stuff that's not expected only helps with patient safety if the receiver can and will consume and do useful things with them - which strikes me as very unlikely.</p>



<a name="255579671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255579671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255579671">(Sep 30 2021 at 14:06)</a>:</h4>
<p>seems it might be useful to define a query parameter, similar to _include and _revInclude, that a client can declare their interest.     I fully understand and agree that clients should expect extra stuff, but if you are not aware why that extra stuff is there then it is hard for me to expect clients will do the right thing. Where a query parameter is an indicator that the client is aware of this 'kind' of extra stuff and will use it appropriately.</p>



<a name="255580460"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Is%20a%20server%20allowed%20to%20include%20referenced%20resources/near/255580460" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Is.20a.20server.20allowed.20to.20include.20referenced.20resources.html#255580460">(Sep 30 2021 at 14:10)</a>:</h4>
<p>How could you pre-plan to use something appropriately?  If you're going to build the capability to consume and do something useful with data, I can't think of any reason why you wouldn't then always ask for it.  Building the capacity to consume the data but not ask for it seems like a super-odd design choice.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
