---
layout: page
title: "FHIR Chat  · Reverse Chaining Question (Plan-Net) · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html">Reverse Chaining Question (Plan-Net)</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="217937857"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/217937857" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#217937857">(Nov 25 2020 at 20:52)</a>:</h4>
<p>There are three profiles:   Network (a profile of Organization), OrganizatonAffiliation, and Location.</p>
<p>Network  <br>
^<br>
| 0..*<br>
|<br>
OrganizationAffiliation (role = pharmacy)<br>
| 0..*<br>
|<br>
v<br>
Location (type=pharmacy, address.postCode=20854)<br>
id = N                                                                                                  </p>
<p>I'm trying to construct a search for all pharmacy locations that are part of network N  in zipcode 20854 using reverse chaining.</p>
<p>The challenge:   The query uses two reverse chaining (_has) relationships:<br>
   1) OrganizationAffiliation:location:network = N.    The Organization affiliation that refers to Location using its location search parameter refers to Network N.<br>
   2) OrganizationAffiliation:location:role = pharmacy.  The OrganizationAffiliation that refers to location has its role = pharmacy.</p>
<p>My read of the terse documentation on reverse chaining is that the two _has relationships are independent.<br>
So, it is possible that there could be two OrganizationAffiliation instances, one with role=pharmacy and network=M (not N), and one with role=provider and network=N, and the location would be included.   </p>
<p>Two questions:<br>
   1) <strong>is that understanding correct?</strong><br>
   2) <strong>Is there any way to place two requirements on a single OrganizationAffiliation instance in one query using reverse chaining?</strong></p>



<a name="217940111"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/217940111" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#217940111">(Nov 25 2020 at 21:13)</a>:</h4>
<p>I doubt many (any?) servers will implement reverse chaining, maybe you are better off doing multiple searches</p>



<a name="217943555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/217943555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#217943555">(Nov 25 2020 at 21:50)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span>  it is required by Plan-Net, and supported by the servers that have attended the connectathons (HAPI, IBM, etc).  Your point is well taken, but I'd like to have a correct recommendation for implementers built into our RI, and currently I'm not sure that is the case.</p>



<a name="217944055"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/217944055" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#217944055">(Nov 25 2020 at 21:57)</a>:</h4>
<p>That understanding is correct, you can't do this in one query. At best you can do <code>OrganizationAffiliation?network=N&amp;role=pharmacy</code> to get the intermediate list of IDs, and then <code>Location?_has:OrganizationAffiliation:location:_id=[intermediate list of IDs]</code></p>



<a name="217945655"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/217945655" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#217945655">(Nov 25 2020 at 22:14)</a>:</h4>
<p>I stand corrected!</p>



<a name="218306509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218306509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218306509">(Nov 30 2020 at 16:03)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  -- the inability to do this type of join will result in a much less efficient implementation of this query.   By inefficient, I mean the client code will be much more complicated, AND significantly more data will be requested from the server.   </p>
<p>Is this a bug or a feature of the FHIR API?</p>



<a name="218327129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218327129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218327129">(Nov 30 2020 at 18:40)</a>:</h4>
<p>It's a feature.  The more complexity we add to RESTful search, the less likely implementers are to support it.  I believe _filter could work for your use-case, but it's not widely implemented</p>



<a name="218340355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218340355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218340355">(Nov 30 2020 at 20:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  -- so you are suggesting that the _filter include all of the constraints on the OrganizationAffiliation, thus ensuring they are all satisfied on a single instance?   thx</p>



<a name="218341052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218341052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218341052">(Nov 30 2020 at 20:27)</a>:</h4>
<p>Filter gives you the power of brackets.  You can also have sub-filters on particular nodes.  I'm not an expert with the syntax though.  (And I'm not sure if <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>'s reference implementation of _filter has full _reverseInclude support.)</p>



<a name="218512246"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218512246" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218512246">(Dec 02 2020 at 03:41)</a>:</h4>
<p>_filter generally hasn't been implemented on the grounds that it's needless complexity and load on the server. The counter argument that it's lack is more of a load on the server hasn't really sunk in yet. </p>
<p>At least HAPI now supports it. But in your context, will your users support it?</p>



<a name="218632484"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218632484" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218632484">(Dec 02 2020 at 22:58)</a>:</h4>
<p>Agreed that _filter is a hail-mary pass.<br>
I'm not even sure that it CAN work for this query.   For example, is this well-formed?</p>
<p>https://davinci-plan-net-ri.logicahealth.org/fhir/Location?_has:OrganizationAffiliation:location:_filter=(network re Organization/plannet-network-HPID010000 and role=pharmacy)</p>
<p>HAPI is not happy with this.   "Unknown parameter name: OrganizationAffiliation:_filter""</p>



<a name="218632794"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218632794" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218632794">(Dec 02 2020 at 23:01)</a>:</h4>
<p>I don't think that's the way _filter works, it is <code>../Location?_filter=( complex expression )</code></p>



<a name="218637762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218637762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218637762">(Dec 02 2020 at 23:57)</a>:</h4>
<p>I think you'd have to do this: OrganizationAffiliation?_filter=(role=pharmacy and location[type=pharmacy and address.postalCode=20854])&amp;_include=OrganizationAffiliation.organization</p>



<a name="218883280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218883280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218883280">(Dec 04 2020 at 19:55)</a>:</h4>
<p>First of all, thanks for continuing the discussion.<br>
Two issues:<br>
  1) the location[fielda eq valueb and fieldb eq valueb] makes HAPI sad.   But that type of syntax to apply the location constraints to a single location would be necessary to avoid the same problem stated above.<br>
2) you've flipped the search to be on OrgAffiliation, and including locations, but this would be casting a much wider net than applying the filter on Locations that satisfy the geographic constraint AND the OrganizationAffiliation (network, type, specialty) constraint.   Many of the returned locations wouldn't meet the geographic constraint.</p>
<p>I think it is more efficient to perform the original query:<br>
<code>https://davinci-plan-net-ri.logicahealth.org/fhir/Location?_has:OrganizationAffiliation:location:network=Organization/plannet-network-HPID010000&amp;_has:OrganizationAffiliation:location:role=pharmacy&amp;_revinclude=OrganizationAffiliation:location&amp;address-postalcode:contains=06040,06074,06043,06118,06041</code></p>
<p>And then do some client side filtering of the locations to eliminate those locations for whom an appropriate OrganizationAffilation that satisfies the network and type constraint can't be found.</p>



<a name="218934794"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Reverse%20Chaining%20Question%20%28Plan-Net%29/near/218934794" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> René Spronk <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Reverse.20Chaining.20Question.20(Plan-Net).html#218934794">(Dec 05 2020 at 13:15)</a>:</h4>
<p>_(rev)include doesn't allow for any conditions .. (address-postal:contains..). Only _has supports such a feature.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
