---
layout: page
title: "FHIR Chat  · Compartment search specifications · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html">Compartment search specifications</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153969325"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969325" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969325">(Jun 14 2018 at 01:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191757">@Christiaan Knaap</span> in regard to <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=15906" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=15906">GF#15906</a> - you know, from the compartment definition, that patient is a Patient, so the fact that target.patient and target.subject may target more than patients is ok - they ust  don't count. No?</p>



<a name="153969591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969591">(Jun 14 2018 at 11:15)</a>:</h4>
<p>No. Let's take the first link, target.patient:<br>
The link is from Provenance -&gt; target (Any resource) -&gt; patient.<br>
So this implies an extra search argument of /Provenance?target.patient=&lt;the patient in the compartment&gt;.<br>
But most of the allowed resourcetypes for Provenace.target do not have a patient search parameter. <br>
I might be able to infer which of the resourcetypes would be in scope for this (probably the other types listed in the CompartmentDefinition linked through a patient parameter), but that leads to 2 problems:<br>
1. You may run into "Servers SHOULD reject a search where the logical id refers to more than one matching resource across different types." <a href="http://build.fhir.org/search.html#chaining" target="_blank" title="http://build.fhir.org/search.html#chaining">Chained Parameters</a>. This happens to be ok on Vonk because we use GUIDs, but that is not always the case.<br>
2. Different resourcetypes may have different searchparameters, incidentally with the same name:<br>
- Observation.patient, where the searchparameter is clinical-patient;<br>
- MedicationRequest.patient, where the searchparameter is medications-patient.<br>
I'm not sure whether that is allowed. At least it is unclear.</p>
<p>For target.subject the same problems arise.</p>



<a name="153969957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969957">(Jun 14 2018 at 19:23)</a>:</h4>
<p>Is it reasonable to expect that Provenance exists within the patient compartment? Seems the usecases for Provenance start with the other object (source or target), and desire to learn more (aka Provenance).  Provenance must be useable when the other resource is not patient specific, or is patient specific but not directly (Binary). Thus should we not just remove Provenance from the patient compartment?</p>



<a name="153969958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969958">(Jun 14 2018 at 19:30)</a>:</h4>
<p>Provenance can live in multiple compartments simultaneously.  It doesn't mean you can't search it outside of any compartment.  Lots of compartment-specific resources won't always live in all compartments they're associated with.  For example, an Observation made about a Location won't be in the Patient compartment, but the resource type is still associatable with that compartment.  All the compartment link does is allow you to search using that compartment if the necessary relationship exists.</p>



<a name="153969960"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969960" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969960">(Jun 14 2018 at 19:34)</a>:</h4>
<p>Lloyd, I recognize that. I am just wondering what the use-case is for having Provenance be in the compartments? If declaring that Provenance is not in any compartment simplifies things, then why not do that? I am also fine with Provenance being in compartments. Are we doing similar gymnastics for AuditEvent? I see really good reason for AuditEvent to be declared as not to be included in compartments given the sensitive nature of ALL the auditEvents relative to those useful to a common user (signal to noise problem, as well as privacy/security issues).</p>



<a name="153969965"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969965" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969965">(Jun 14 2018 at 19:59)</a>:</h4>
<p>Provenance is intended to be user-facing and needs to be subject to the same compartment-specific access controls as clinical resources.</p>



<a name="153969966"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969966" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969966">(Jun 14 2018 at 20:00)</a>:</h4>
<p>I think audit events are outside compartments because they're expected to be highly sensitive and highly restricted.  Though that doesn't mean we couldn't put them in the compartments too I guess</p>



<a name="153969980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969980">(Jun 14 2018 at 20:31)</a>:</h4>
<p>AuditEvent is in the patient compartment, as is Provenance. Mixing access control issues into the syntax consideration is weird, to me</p>



<a name="153969981"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969981" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969981">(Jun 14 2018 at 20:34)</a>:</h4>
<p>back to <span class="user-mention" data-user-id="191757">@Christiaan Knaap</span>'s point: I think #1 is an issue. Doesn't arise for me because I resolve the index late.</p>



<a name="153969982"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153969982" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153969982">(Jun 14 2018 at 20:35)</a>:</h4>
<p>I'll have to review the way this is generated into CompartmentDefinition</p>



<a name="153975560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153975560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153975560">(Jul 16 2018 at 20:07)</a>:</h4>
<p>FHIR-I wants this conversation to continue: <span class="user-mention" data-user-id="191319">@James Agnew</span> <span class="user-mention" data-user-id="191351">@Chris Grenz</span></p>



<a name="153975773"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153975773" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153975773">(Jul 17 2018 at 14:04)</a>:</h4>
<p>I've always thought there's some tension/inconsistencies in how compartments are described.  The combination of</p>
<blockquote>
<p>The following resources are never in this compartment:</p>
</blockquote>
<p>on the compartment definition page (e.g. <a href="http://hl7.org/fhir/compartmentdefinition-patient.html" target="_blank" title="http://hl7.org/fhir/compartmentdefinition-patient.html">http://hl7.org/fhir/compartmentdefinition-patient.html</a>) with the verbiage in the last paragraph <a href="http://hl7.org/fhir/compartmentdefinition.html#use" target="_blank" title="http://hl7.org/fhir/compartmentdefinition.html#use">here</a>, especially</p>
<blockquote>
<p>Servers will need to make arrangements to make these resources available to the clients that are limited to particular compartments.</p>
</blockquote>
<p>means that the definition of the compartment is admittedly (and intentionally?) inadequate.  I would expect the test of the breadth of a compartment to be the $everything call on that compartment:  <code>[base]/Patient/123/$everything</code> should logically return all the contents of the compartment.  And if it's part of $everything, it's "in" the compartment, no?</p>
<p>While the meaning of "in" might be semantics, the technical definition leaves "making arrangements" an area of inconsistency.</p>



<a name="153975774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153975774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153975774">(Jul 17 2018 at 14:08)</a>:</h4>
<p>To this specific issue, I agree with <span class="user-mention" data-user-id="191757">@Christiaan Knaap</span> that the spec wording is a problem. Personally, I'd relax the chained search wording and put the error mode under the control of the prefer header directive.  A strict query would fail on this type of chaining, a lenient would simply ignore it when searching resources that don't have the parameter.</p>



<a name="153975853"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153975853" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153975853">(Jul 17 2018 at 21:24)</a>:</h4>
<p>server can decide to include things in $everything that are referenced from the compartment, but not part of it.</p>



<a name="153975854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153975854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153975854">(Jul 17 2018 at 21:25)</a>:</h4>
<p>we discussed saying that the server had to return absolutely everything in the patient compartment as part of $everything, but backed away from that. but in principle, it should be</p>



<a name="153975855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153975855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153975855">(Jul 17 2018 at 21:26)</a>:</h4>
<p>But I'm not sure how this makes them inconsistent</p>



<a name="153975856"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153975856" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153975856">(Jul 17 2018 at 21:26)</a>:</h4>
<p>this is orthogonal to the question though</p>



<a name="153976064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Compartment%20search%20specifications/near/153976064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Grenz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Compartment.20search.20specifications.html#153976064">(Jul 18 2018 at 14:23)</a>:</h4>
<p>I'm not sure it's orthogonal as it goes to what's "in" the compartment, the technical definition of that set, and ultimately, the use case of a compartment.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
