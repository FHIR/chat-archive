---
layout: page
title: "FHIR Chat  · Subscription to Bundle · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html">Subscription to Bundle</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="178287661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178287661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178287661">(Oct 16 2019 at 13:22)</a>:</h4>
<p>Hi,</p>
<p>Can anyone recommend how I should specify a subscription request for new Bundles, matching specific criteria?</p>
<p>For example, I would like to specify a subscription request for new Bundles which contain a Patient which has a managingOrganization reference to a specific Organisation resource</p>
<p>I have found an example of this kind of subscription request , <a href="https://developer.nhs.uk/apis/ems-beta/explore_create_subscription.html#criteria-examples" target="_blank" title="https://developer.nhs.uk/apis/ems-beta/explore_create_subscription.html#criteria-examples">https://developer.nhs.uk/apis/ems-beta/explore_create_subscription.html#criteria-examples</a></p>
<p>However, although it isn't totally clear, this appears to use a search parameter extension <a href="https://fhir.nhs.uk/STU3/SearchParameter/EMS-SubscriptionRuleType-1" target="_blank" title="https://fhir.nhs.uk/STU3/SearchParameter/EMS-SubscriptionRuleType-1">https://fhir.nhs.uk/STU3/SearchParameter/EMS-SubscriptionRuleType-1</a></p>
<p>Many thanks</p>



<a name="178287936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178287936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178287936">(Oct 16 2019 at 13:25)</a>:</h4>
<p>My original instinct was to specify a subscription to new Patient resources which met my criteria, but I can't see an obvious way of then retrieving the original message Bundle which contains that Patient resource.</p>



<a name="178288592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178288592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178288592">(Oct 16 2019 at 13:32)</a>:</h4>
<p>Bundles can exist for a variety of reasons.  They're generally only persisted if they're FHIR documents - is that your use-case?</p>



<a name="178288950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178288950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178288950">(Oct 16 2019 at 13:36)</a>:</h4>
<p>I want to be able to access a message Bundle, as identified by search criteria which apply to one of the resources within it.</p>
<p>I MAY have answered my own question - the _containedType parameter appears to enable this <a href="https://www.hl7.org/fhir/search.html#containedType" target="_blank" title="https://www.hl7.org/fhir/search.html#containedType">https://www.hl7.org/fhir/search.html#containedType</a></p>
<p>However, if the message Bundle is not persisted, then I guess that would not work?</p>



<a name="178290008"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178290008" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178290008">(Oct 16 2019 at 13:46)</a>:</h4>
<p>Typically messages aren't stored if submitted for processing.  Are you just storing undirected messages and then having systems query to retrieve them?  The challenge if your Bundle is a message is that the Patient isn't at a pre-determined location.  It depends on what the focus for the message is.  That makes it hard to search on.  Unfortunately the _contained and _containedType aren't going to do what you want.  They work on 'contained' resources which is not the same as Bundle entries.  You could define a new search parameter that would let you look at any entry in the Bundle (rather than just the root MessageHeader or Composition which is all that's supported by standard search parameters).  However, you'd need to customize your server to support it.</p>



<a name="178290750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178290750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178290750">(Oct 16 2019 at 13:52)</a>:</h4>
<p>Thanks.   So, it sounds like I would need to use documents not messages.   I am still not clear how I access the containing document Bundle though.    Feels like I am missing something obvious here, I would assume this is a pretty normal thing to do....? </p>
<p>Basically the use-case is:<br>
- FHIR server receiving Bundles of resources<br>
-  My system subscribes to receive notifications of new bundles/resources, and is then able to retrieve the whole bundle.</p>



<a name="178291407"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178291407" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178291407">(Oct 16 2019 at 13:59)</a>:</h4>
<p>Why is the data coming in as a Bundle at all?</p>



<a name="178291490"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178291490" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178291490">(Oct 16 2019 at 14:00)</a>:</h4>
<p>If you use Document, you can access the Patient filtering on Bundle?composition.subject</p>



<a name="178291578"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178291578" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178291578">(Oct 16 2019 at 14:01)</a>:</h4>
<p>Sorry, my mistake, what I am dealing with would be a transaction Bundle, not a message or a document.</p>



<a name="178297681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178297681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178297681">(Oct 16 2019 at 15:01)</a>:</h4>
<p>The reason the data is coming in as a Bundle, is that it is a package of data required to trigger an event, which includes mandatory elements over multiple resource-types.   It's really a message at this stage in the workflow, which will be submitted as a Bundles of resources in a FHIR POST. </p>
<p>Depending on the outcome of the event,  at a later stage of the workflow, the amount of information received on the patient would then be expanded, in one or more subsequent PUT/POST operations.</p>



<a name="178297832"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178297832" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178297832">(Oct 16 2019 at 15:03)</a>:</h4>
<p>My understanding now is:</p>
<p>- In FHIR it is not possible to re-create or reference a non-document Bundle after it has been unpacked by the FHIR service.  </p>
<p>- If a client solution wants to subscribe to notifications about a new multi-resource batch/transaction, it needs to subscribe to a specific resource-type within that, and then resolve the references between the previously-Bundled resources, to access them all.</p>



<a name="178298275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178298275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178298275">(Oct 16 2019 at 15:07)</a>:</h4>
<p>I think I am reassured that I am not missing some important feature of post-request, intra-Bundle referencing! </p>
<p>I remain slightly mystified about how the NHS solution works though, <a href="https://developer.nhs.uk/apis/ems-beta/explore_create_subscription.html" target="_blank" title="https://developer.nhs.uk/apis/ems-beta/explore_create_subscription.html">https://developer.nhs.uk/apis/ems-beta/explore_create_subscription.html</a></p>



<a name="178299189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178299189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178299189">(Oct 16 2019 at 15:17)</a>:</h4>
<p>I wouldn't necessarily say "it's not possible", but it would certainly be a-typical for a system that had received a transaction Bundle and executed the transaction to subsequently make the Bundle available for retrieval via search.</p>



<a name="178299253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178299253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178299253">(Oct 16 2019 at 15:18)</a>:</h4>
<p>Looks like the NHS solution is subscribing to Message bundles. Those could be either persisted on the server, or executed through $process-message. If they're just persisting bundles, then this is a normal subscription pattern.</p>
<p>There was some discussion in subscriptions of subscribing to operations, i.e. "notify when operation $foo is executed" that could in theory apply to executing a transaction bundle. I don't think that particular idea has come up though.</p>



<a name="178299264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178299264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178299264">(Oct 16 2019 at 15:18)</a>:</h4>
<p>For subscriptions, systems generally care about data that's been created or changed regardless of how the change was originated (transaction, batch or direct REST operation</p>



<a name="178299347"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178299347" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178299347">(Oct 16 2019 at 15:19)</a>:</h4>
<p>The revised subscription model will indeed support subscribing to particular types of events focused on a resource/class of resources rather than just subscribing to updates to a resource that matches a particular query</p>



<a name="178299509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178299509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178299509">(Oct 16 2019 at 15:21)</a>:</h4>
<p>Subscribing to transaction Bundles wouldn't be terribly efficient and could pose privacy/access control issues too.  A given transaction could theoretically contain data relating to thousands of patients.  If you had to query the whole Bundle to see data on a single patient of interest, that could be problematic</p>



<a name="178300091"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178300091" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178300091">(Oct 16 2019 at 15:27)</a>:</h4>
<p>Yes, its only the use-case of a multi-resource transaction relating to a single patient that I am concerned with at the moment.   If it were possible to define that as an event type, and subscribe to that, that would simplify what I am currently trying to specify.</p>



<a name="178300350"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178300350" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178300350">(Oct 16 2019 at 15:30)</a>:</h4>
<p>Just to throw out an alternative idea, could you accomplish roughly the same thing by subscribing to patient changes and using "Patient/$everything?_since=[last event the client heard about]" to figure out the full set of resources that changed?</p>



<a name="178467648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178467648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178467648">(Oct 18 2019 at 12:18)</a>:</h4>
<p>Thanks.  Yes, I think this would be the pragmatic solution.  Only slight concern would be theoretical possibility of getting two co-incident requests mixed/merged.</p>



<a name="178467888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Subscription%20to%20Bundle/near/178467888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Martin Morrey <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Subscription.20to.20Bundle.html#178467888">(Oct 18 2019 at 12:22)</a>:</h4>
<p>Also the added complexity of stored date-time of most-recent previous event on the client, although I guess there could be ways round this using _history</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
