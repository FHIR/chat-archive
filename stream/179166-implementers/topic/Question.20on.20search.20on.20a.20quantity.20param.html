---
layout: page
title: "FHIR Chat  · Question on search on a quantity param · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html">Question on search on a quantity param</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153897078"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897078" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897078">(Jul 17 2017 at 14:28)</a>:</h4>
<p>Hi,</p>
<p>I'm a bit confused about the examples and their corresponding descriptions in <a href="http://hl7.org/fhir/STU3/search.html#quantity" target="_blank" title="http://hl7.org/fhir/STU3/search.html#quantity">http://hl7.org/fhir/STU3/search.html#quantity</a>:</p>
<p>Example1: GET [base]/Observation?value=5.4|http://unitsofmeasure.org|mg<br>
Example1 Description: Search for all the observations with a value of 5.4 mg where mg is understood as a UCUM unit (system/code)</p>
<p>Example2: GET [base]/Observation?value=5.4||mg<br>
Example2 Description: Search for all the observations with a value of 5.4 mg where the unit - either the code or the stated human unit (unit) are "mg"</p>
<p>My understanding of Example1 is that when the 'system' part is provided in the search url, the the FHIR server will only use Quantity.code and not use Quantity.unit. However when 'system' is not provided then the FHIR server will also use Quantity.unit along with Quantity.code.</p>
<p>Is this the correct interpretation? Or should all searches use both Quantity.unit and Quantity.code regardless of the 'system' part present?</p>



<a name="153897089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897089">(Jul 17 2017 at 15:28)</a>:</h4>
<p>"My understanding of Example1 is that when the 'system' part is provided in the search url, the the FHIR server will only use Quantity.code and not use Quantity.unit. However when 'system' is not provided then the FHIR server will also use Quantity.unit along with Quantity.code."</p>
<p>Yes that is how I interpret it as well.  But it is not explicit.  Can you submit a tracker to clarify the syntax?</p>



<a name="153897090"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897090" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897090">(Jul 17 2017 at 15:29)</a>:</h4>
<p>Yes.  I'm not sure whether the intention is to diverge from how token works or not.  We definitely need to make that clear, so please raise a tracker</p>



<a name="153897115"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897115" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897115">(Jul 17 2017 at 17:53)</a>:</h4>
<p>Thanks. I reported <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13646" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13646">GF#13646</a>.</p>



<a name="153897132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897132">(Jul 17 2017 at 20:12)</a>:</h4>
<p>Some more questions I have regarding this topic:</p>
<p>The description for <a href="http://hl7.org/fhir/STU3/datatypes.html#Quantity" target="_blank" title="http://hl7.org/fhir/STU3/datatypes.html#Quantity">http://hl7.org/fhir/STU3/datatypes.html#Quantity</a> says: "If the unit can be coded in UCUM and a code is provided, it SHOULD be a UCUM code". Why is it not a 'SHALL' given that the system clearly indicates the UCUM namespace?</p>
<p>And it isn't clear to me whether case-sensitive or case-insensitive comparison should be done on Quantity.unit or Quantity.code for FHIR servers that don't have a sophisticated UCUM engine or the cases where 'system' is not provided. I'm assuming case-insensitive comparison is done if it is intended to be similar to the token param type?</p>



<a name="153897168"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897168" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897168">(Jul 18 2017 at 02:46)</a>:</h4>
<p>Quantity doesn't require that the code system be UCUM - it's allowed to use alternate code systems, but we prefer to use UCUM.  UCUM is case-sensitive.</p>



<a name="153897169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897169">(Jul 18 2017 at 02:47)</a>:</h4>
<p>The token param type is also case sensitive unless the underlying code system indicates explicitly that codes should be handled in a case-insensitive manner.</p>



<a name="153897203"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897203" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897203">(Jul 18 2017 at 12:21)</a>:</h4>
<p>"Quantity doesn't require that the code system be UCUM - it's allowed to use alternate code systems, but we prefer to use UCUM. UCUM is case-sensitive."</p>
<p>A bit confused here especially your last sentence because <a href="http://unitsofmeasure.org/ucum.html" target="_blank" title="http://unitsofmeasure.org/ucum.html">http://unitsofmeasure.org/ucum.html</a> section 2.1 contains notes about case sensitive and case insensitive symbols. However, I did some more digging in the FHIR spec and came across this: <a href="http://hl7.org/fhir/STU3/ucum.html" target="_blank" title="http://hl7.org/fhir/STU3/ucum.html">http://hl7.org/fhir/STU3/ucum.html</a> with the note that the code is a "   Valid expressions using the case sensitive symbols".</p>
<p>So do you actually mean that even though UCUM allows for case insensitive symbols, the FHIR spec only uses the case sensitive symbols hence FHIR servers should only do case sensitive comparison for UCUM codes?</p>



<a name="153897204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897204">(Jul 18 2017 at 12:35)</a>:</h4>
<p>"The token param type is also case sensitive unless the underlying code system indicates explicitly that codes should be handled in a case-insensitive manner."</p>
<p>I'm looking at these in the FHIR spec: <a href="http://hl7.org/fhir/STU3/search.html#token" target="_blank" title="http://hl7.org/fhir/STU3/search.html#token">http://hl7.org/fhir/STU3/search.html#token</a> and <a href="http://build.fhir.org/search.html#token" target="_blank" title="http://build.fhir.org/search.html#token">http://build.fhir.org/search.html#token</a>.</p>
<p>As per my interpretation, the first sentence of the first paragraph supports what you say regarding exact matches. But the first sentence of the second paragraph threw me off. From the spec:</p>
<p>"For tokens, matches are literal (e.g. not based on subsumption or other code system features), but not case sensitive."</p>
<p>The ending phrase of that sentence lead me to believe that token searches are case insensitive e.g. a search for Patient?identifier=someurl|someval will match [SOMEURL/sOmeVAL].</p>



<a name="153897213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897213">(Jul 18 2017 at 13:40)</a>:</h4>
<p>Yup, that wording isn't consistent and is potentially problematic.  Can you submit a change request?</p>



<a name="153897219"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897219" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897219">(Jul 18 2017 at 14:00)</a>:</h4>
<p>Which one are you referring to? The wording on token or the wording on UCUM?</p>



<a name="153897225"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897225" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897225">(Jul 18 2017 at 14:36)</a>:</h4>
<p>The wording on token.  If you're using UCUM with FHIR, you're required to use the case-sensitive version</p>



<a name="153897231"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897231" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Calderero <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897231">(Jul 18 2017 at 15:36)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span> I filed <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13655" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13655">GF#13655</a>.</p>



<a name="153897239"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153897239" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153897239">(Jul 18 2017 at 16:42)</a>:</h4>
<p>I am now confused what needs to be clarified.... As I understand it the token search is case insentive but the code system determines whether the codes need to be case sensitive.  they are two different things.</p>
<p>I can search UCUM using <code>mg/l</code>  which will match<code>mg/L</code>   </p>
<p>On the other hand <code>mg/l</code>  will fail validation as a UCUM code in <code>quantity.code</code> and  <code>mg/L</code> will pass</p>



<a name="153898831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153898831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jorge de la Garza <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153898831">(Jul 27 2017 at 17:56)</a>:</h4>
<p>Hi, I have a question about how a quantity search is supposed to work when the target value has a comparator (&lt;, &lt;=, &gt;, &gt;=) and the search value has a prefix (gt, ge, lt, le, etc.).  (All of this assumes the units either match or can be converted to match.)  So my interpretation of the spec is that when a quantity value has a comparator, for search purposes it is a range with either an upper bound or a lower bound, but not both.  So if an Observation.valueQuantity has comparator="&gt;" and value="180", for search purposes that is a range from 180 to infinity.  The "range" interpretation of the "gt" search prefix is: "the range above the search value intersects (i.e. overlaps) with the range of the target value".  So it seems that <em>any</em> search of the form "/Observation?value-quantity=gt[value]" will select this resource, because no matter where "[value]" lies in relation to 180, the range "[value] to infinity" always intersects "180 to infinity".  Am I understanding all that correctly?</p>



<a name="153898853"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Question%20on%20search%20on%20a%20quantity%20param/near/153898853" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Question.20on.20search.20on.20a.20quantity.20param.html#153898853">(Jul 27 2017 at 20:41)</a>:</h4>
<p>I think so</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
