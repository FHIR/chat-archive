---
layout: page
title: "FHIR Chat  · Provenance - understanding what happened · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html">Provenance - understanding what happened</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="248325220"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248325220" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248325220">(Aug 04 2021 at 08:55)</a>:</h4>
<p>We are looking at creating Provenance instances for resource we ingest into our system, mainly to document when and from where they were imported. After reviewing Provenance, it seemed <code>activity</code> was the key element for indicating <em>what</em> actually happened (creation, update, signing...). So a mapping like this seemed appropriate for us</p>
<ul>
<li><code>activity</code>: "CREATE" (from <code>http://terminology.hl7.org/CodeSystem/v3-DataOperation</code>)</li>
<li><code>agent.type</code> = "performer" (from <code>http://terminology.hl7.org/CodeSystem/provenance-participant-type</code>)</li>
<li><code>agent.who</code> = Reference to the (customer-specific) system doing the ingestion</li>
</ul>
<p>But then I noticed that the  <a href="http://hl7.org/fhir/R4/provenance-example.json.html">simplest Provenance example in the spec</a> does not use <code>activity</code>, and that the <a href="http://hl7.org/fhir/us/core/StructureDefinition-us-core-provenance.html">US Core IG Provenance profile</a> does not declare <code>activity</code> must-support (and does not use it in <a href="http://hl7.org/fhir/us/core/Bundle-c887e62f-6166-419f-8268-b5ecd6c7b901.json.html">this official example</a>). Hence the following questions:</p>
<ol>
<li>How is one supposed to understand what happened with the target resource if <code>activity</code> is not used (as in the two examples linked above)? E.g. should it be inferred from <code>agent.type</code> (if present) or does it implicitly default to resource creation? I am thinking particularly of scenarios in which one cannot reference specific versions of the target resource (not possible on our system), so that provenance instances for creation and update would have exactly the same target.</li>
<li>Following on that, is the usage of <code>activity</code> and <code>agent</code> I suggested above appropriate for our case?</li>
</ol>



<a name="248341527"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248341527" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vivian Neilley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248341527">(Aug 04 2021 at 12:14)</a>:</h4>
<p>We interestingly use agent.who as the reference to the document it came from, not necessarily the source system. Would be interesting to see how others are implementing (<a href="https://github.com/GoogleCloudPlatform/healthcare-data-harmonization/blob/master/mapping_configs/hl7v2_fhir_r4/projector_library/datatypes.wstl">https://github.com/GoogleCloudPlatform/healthcare-data-harmonization/blob/master/mapping_configs/hl7v2_fhir_r4/projector_library/datatypes.wstl</a>)</p>



<a name="248341981"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248341981" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248341981">(Aug 04 2021 at 12:20)</a>:</h4>
<p>Noted. The security wg is addressing some fantastic Change Requests from the last ballot. The issues you are pointing at are clearly within this set of questions. The use of the Change Request system is very important to improving the specification.</p>



<a name="248342243"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248342243" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248342243">(Aug 04 2021 at 12:23)</a>:</h4>
<p>The vocabulary binding to .activity is going to radically change. It should be only recommending event type codes, and the .activity is intended to hold a code that expresses the type of event that caused the change. The current vocabulary has a large number of inappropriate codes.</p>



<a name="248343853"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248343853" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248343853">(Aug 04 2021 at 12:39)</a>:</h4>
<p><span class="user-mention" data-user-id="194703">@Morten Ernebjerg</span> seems you are describing an activity of importing data. so you would want an .activity that says importing.  -- There does not seem to me to be a good code in the valueSet given (as I said above, this is known to be a useless valueset).<br>
I don't think that you would be doing a "CREATE" as you are importing, not creating.<br>
We should find a good code for Import. In IHE I used <code>http://hl7.org/fhir/w3c-provenance-activity-type#Derivation</code>    I am not sure that is the right code to use either.</p>



<a name="248344183"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248344183" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248344183">(Aug 04 2021 at 12:42)</a>:</h4>
<p>so you can see why few have used .activity... it is indeed poorly defined.</p>



<a name="248344654"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248344654" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248344654">(Aug 04 2021 at 12:47)</a>:</h4>
<p>as to the question (1)... I am not sure I fully understand your question.  If the question is about the .target and how to handle when version specific targets are not supported? This is not something we address. If you have creation times, you can correlate creation times with the provenance recorded with that time, and thus all other provenance are updates in the order of time. You can even just sort the provenance by time and the oldest one is most likely a create. Time is the best key you have if you don't have a versioning FHIR server.</p>



<a name="248345025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248345025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248345025">(Aug 04 2021 at 12:51)</a>:</h4>
<p>the agent.type would differentiate multiple agents from each other. So you might have an agent for the source that sent you the data, and one for the system doing the import.<br>
Again, this vocabulary is poor, and we are working on it.  Would be good to get feedback on the kinds of things you want to say about agents.</p>



<a name="248345146"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248345146" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248345146">(Aug 04 2021 at 12:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="311758">Vivian Neilley</span> <a href="#narrow/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened/near/248341527">said</a>:</p>
<blockquote>
<p>We interestingly use agent.who as the reference to the document it came from, not necessarily the source system. Would be interesting to see how others are implementing (<a href="https://github.com/GoogleCloudPlatform/healthcare-data-harmonization/blob/master/mapping_configs/hl7v2_fhir_r4/projector_library/datatypes.wstl">https://github.com/GoogleCloudPlatform/healthcare-data-harmonization/blob/master/mapping_configs/hl7v2_fhir_r4/projector_library/datatypes.wstl</a>)</p>
</blockquote>
<p>This is wrong. the reference document would go in an .entity. A document can't be an .agent.</p>



<a name="248345385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248345385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248345385">(Aug 04 2021 at 12:55)</a>:</h4>
<p>I thank you both for bringing these forward. It is inspiring me to make R5 better. I might also work on an informal IG on Provenance similar to what I have done for Basic Audit <a href="http://build.fhir.org/ig/JohnMoehrke/BasicAudit/branches/main/index.html">http://build.fhir.org/ig/JohnMoehrke/BasicAudit/branches/main/index.html</a></p>



<a name="248350259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248350259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248350259">(Aug 04 2021 at 13:34)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191404">@John Moehrke</span>, thanks for all the feedback and for picking up all these themes! There are several interesting issues here so I will try to separate them a bit:</p>
<p><strong>Value sets bound to <code>activity</code> and other elements</strong><br>
You hit the nail on that one, I was indeed very confused about them and what would be an appropriate choice for a given case <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> (e.g. having things like "analyte" or "origin" as possible codes for an <em>activity</em>). Great you are working on those! </p>
<p><strong>Appropriate code for activity in our case</strong><br>
This was indeed smt. I was unsure about, not only because of the bound value set.  I think my key confusion is whether the Provenance is talking about (1) the data itself, independent of the specific technical incarnation, or (2) the specific technical artefact I am creating on my system. If it's talking about (2), then "CREATE" seems appropriate since I am indeed creating a new artefact on my system (the one I point to in <code>target</code>). If it's talking about (1), then "CREATE" is clearly not the full story since the activity that actually happened was that data flowing in from one system was piped into a new artefact on my system But I would certainly be happy with a code saying "importing", only , as you say, there is no obvious candidate.</p>
<p><strong>Interpreting Provenance without explicit activity</strong><br>
What I meant by my question (1) was this: If I am given a Provenance resource with only <code>target</code> = A and <code>agent</code> = B (and <code>recorded</code> = T), it seems all I know is "Agent B did <em>something</em> to resource A and recorded it at time T". Even if I can time order different Provenances instances, this seems quite vague . E.g. there would be no way to distinguish updating, reviewing, signing, adding a security label etc. I suppose I'm simply struggling to understand what useful information I can extract from this. A more concrete way of asking this would be this: Suppose I have a UI and the users can click on a resource to see a brief summary of its provenance in a pop-up (this is essentially our use case). If I have an "activity-less Provenances", what could I display to users (that would bring them value) in that pop-up?</p>
<p><strong>What I would like to say about agents in our current use case</strong><br>
In our case, we basically want to say that a particular instance of our ingestion pipeline (so basically a Device) moved this piece of data onto to our system from somewhere else (we will typically not know what that "somewhere else" is). So it is a non-human actor that blindly passes the data on without looking into or modifying it. For <code>agent.type</code>, I had a hard time finding a good code to communicate that the ingestion system is just piping the data into a different system without modifying it. Most of the existing codes other than the very generic "performer" seem to indicate more active involvement than in my case - in general, the value set seems mainly targeted at human actors. I see that the US Core Provenance profile add the participation type code "transmitter, which is a good match for our use case, so that seems like a very sensible addition.</p>



<a name="248351006"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248351006" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248351006">(Aug 04 2021 at 13:40)</a>:</h4>
<p>BTW just let me know if you need Jira issue for smt. specific.</p>



<a name="248354221"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248354221" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vivian Neilley <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248354221">(Aug 04 2021 at 14:06)</a>:</h4>
<p>Agreed. Activity depends on reconciliation of the data - which is handling fhir to fhir after initial mapping - thus - activity wouldn't be as relevant (it would always create, then be reconciled).</p>



<a name="248374557"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248374557" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248374557">(Aug 04 2021 at 16:36)</a>:</h4>
<p>so the current plan for the activity valueset is to change to Example binding, and include just a handful of codes. So would love to hear of codes being used as those would be good handful. -- <a href="https://jira.hl7.org/browse/FHIR-33020">https://jira.hl7.org/browse/FHIR-33020</a></p>



<a name="248374675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248374675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248374675">(Aug 04 2021 at 16:37)</a>:</h4>
<p>more specifically on Provenance.activity - <a href="https://jira.hl7.org/browse/FHIR-32517">https://jira.hl7.org/browse/FHIR-32517</a></p>



<a name="248374882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248374882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248374882">(Aug 04 2021 at 16:38)</a>:</h4>
<p>I think you might be looking to .activity when you should be looking for .reason... but the current model does not make this clear. There is big changes coming to .reason -- <a href="https://jira.hl7.org/browse/FHIR-32354">https://jira.hl7.org/browse/FHIR-32354</a></p>



<a name="248375320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248375320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248375320">(Aug 04 2021 at 16:42)</a>:</h4>
<p>I agree with your assessment that the Provenance is more about the activity than the RESTful action. Although recording the RESTful action is sometimes all that can be done, and is not uncommon for a FHIR Server to be able to automatically do. Thus an initial instance of some target resource might have a simple Provenance, as recorded by the FHIR Server, and a more comprehensive Provenance as recorded by the session level application/service that knows more. Might even have others.</p>



<a name="248375674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248375674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248375674">(Aug 04 2021 at 16:45)</a>:</h4>
<p>We do have a request for clarity for systems that are just transforming - <a href="https://jira.hl7.org/browse/FHIR-26313">https://jira.hl7.org/browse/FHIR-26313</a></p>



<a name="248375988"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248375988" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248375988">(Aug 04 2021 at 16:47)</a>:</h4>
<p>Security workgroup meets on Mondays - Here is the agenda/minutes from this week with the details on how to participate.<br>
<a href="https://confluence.hl7.org/display/SEC/2021-08-02+FHIR-Security+Meeting+Agenda">https://confluence.hl7.org/display/SEC/2021-08-02+FHIR-Security+Meeting+Agenda</a></p>



<a name="248581604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248581604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248581604">(Aug 06 2021 at 07:56)</a>:</h4>
<p>Thanks for the JIRA links <span class="user-mention" data-user-id="191404">@John Moehrke</span> - reviewing the issues I realized that "assembler" is probably the more appropriate <code>agent.type</code> for us.</p>
<blockquote>
<p>so the current plan for the activity valueset is to change to Example binding, and include just a handful of codes. So would love to hear of codes being used as those would be good handful. -- <a href="https://jira.hl7.org/browse/FHIR-33020">https://jira.hl7.org/browse/FHIR-33020</a></p>
</blockquote>
<p>I just saw the  activity codes from <a href="http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle">http://terminology.hl7.org/CodeSystem/iso-21089-lifecycle</a> (part of the bound VS in the latest build).  On a quick review, these look like a very useful selection for our world (if they are free to use, cf. <a href="#narrow/stream/179202-terminology/topic/Term.20of.20use.20for.20core.20CS.20with.20ISO.2021089.20Lifecycle.20Event.20codes">this thread</a>)..  One curious thing about that code system, though, is that it is does not contain an obvious code for a plain create ("originate" seems close, but the definition sounds more convoluted).</p>



<a name="248600929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Provenance%20-%20understanding%20what%20happened/near/248600929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Provenance.20-.20understanding.20what.20happened.html#248600929">(Aug 06 2021 at 11:53)</a>:</h4>
<p>almost all valuesets in Provenance will be moving to example and just have a handful of useful codes.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
