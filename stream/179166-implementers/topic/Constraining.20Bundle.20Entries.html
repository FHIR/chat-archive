---
layout: page
title: "FHIR Chat  · Constraining Bundle Entries · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html">Constraining Bundle Entries</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153873018"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873018" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873018">(Feb 22 2017 at 07:59)</a>:</h4>
<p>We have a use case where we need to constrain the entries in a Bundle. What is the correct way to achieve this?</p>
<p>1) How would you constrain the first entry to be a  "MessageHeader" resource?<br>
2) How would you constrain the first entry to be a "MessageHeader" with Profiles "xxxxx"?</p>
<p>FHIR stipulates that certain Bundle types have constraints, looking for a way to describe these in a StructureDefinition.</p>
<p>A "FHIR Document" Bundle states the first entry is a Composition<br>
A "FHIR Message" Bundle states the first entry is a MessageHeader</p>



<a name="153873021"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873021" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873021">(Feb 22 2017 at 09:26)</a>:</h4>
<p>I've done it using invariants.  In principle you can do it with slicing, but the validator used to have trouble slicing through Resource (as opposed to Reference)</p>



<a name="153873022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873022">(Feb 22 2017 at 09:27)</a>:</h4>
<p>In terms of profiles, at the moment with FHIRPath the best you can do is force a given profile to be declared (and then rely on the validator to validate against that profile).  There isn't yet a mechanism in FHIRPath to assert that a given element must be valid against a specified profile, though a request has been made to add such a feature.</p>



<a name="153873024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873024">(Feb 22 2017 at 10:32)</a>:</h4>
<p>I have currently set it up with slicing the following way for a fhir document enforing a composition and it works with the validator:</p>
<div class="codehilite"><pre>&lt;differential&gt;
        &lt;element id=&quot;Bundle&quot;&gt;
            &lt;path value=&quot;Bundle&quot; /&gt;
            &lt;min value=&quot;1&quot; /&gt;
            &lt;max value=&quot;1&quot; /&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.type&quot;&gt;
            &lt;path value=&quot;Bundle.type&quot; /&gt;
            &lt;fixedCode value=&quot;document&quot; /&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.entry&quot;&gt;
            &lt;path value=&quot;Bundle.entry&quot; /&gt;
            &lt;slicing&gt;
                &lt;discriminator&gt;
                    &lt;type value=&quot;type&quot; /&gt;
                    &lt;path value=&quot;resource.type&quot; /&gt;
                &lt;/discriminator&gt;
                &lt;ordered value=&quot;true&quot; /&gt;
                &lt;rules value=&quot;openAtEnd&quot; /&gt;
            &lt;/slicing&gt;
            &lt;min value=&quot;1&quot; /&gt;
            &lt;max value=&quot;*&quot; /&gt;
        &lt;/element&gt;
        &lt;element id=&quot;Bundle.entry.resource:Composition&quot;&gt;
            &lt;path value=&quot;Bundle.entry.resource&quot; /&gt; 
          &lt;sliceName value=&quot;Composition&quot; /&gt;
            &lt;min value=&quot;1&quot; /&gt;
            &lt;max value=&quot;1&quot; /&gt;
            &lt;type&gt;
                &lt;code value=&quot;Composition&quot; /&gt;
                &lt;profile value=&quot;snip&quot;/&gt; 
            &lt;/type&gt;
        &lt;/element&gt;
    &lt;/differential&gt;
</pre></div>



<a name="153873025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Kavanagh <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873025">(Feb 22 2017 at 10:39)</a>:</h4>
<p><span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span>  That's what I feared... For DSTU2 the base resources dont have FHIRPath so will need to see what can be achieved in that area looks like we will have to inject a little non standard validation.</p>
<p>As for using the "validator" then shaping things to work around that seems strange especially considering that will not be a choice that many people make.</p>
<p><span class="user-mention" data-user-id="191478">@Oliver Egger</span> Your suggestions gets us half way to where we need to be and looks like an approach we'll explore - thank you.</p>
<p>As for the complete requirements then I guess it's something that FHIR just does not support at this point in time.</p>



<a name="153873026"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873026" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kevin Mayfield <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873026">(Feb 22 2017 at 10:39)</a>:</h4>
<p>I've done similar to Oliver but this was for display purposes (using Endeavour/InterOpen's profile generator). [Document Bundle <a href="http://test-rr8.trust.leedsth.nhs.uk:8080/web/fhir/Bundle.Document.html" target="_blank" title="http://test-rr8.trust.leedsth.nhs.uk:8080/web/fhir/Bundle.Document.html">http://test-rr8.trust.leedsth.nhs.uk:8080/web/fhir/Bundle.Document.html</a>  - N3 connection is required]</p>



<a name="153873029"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873029" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873029">(Feb 22 2017 at 11:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191362">@Richard Kavanagh</span> my  example is also R3, for DSTU2 it would be</p>
<div class="codehilite"><pre><span></span>&lt;slicing&gt;
                &lt;discriminator value=&quot;resource.@type&quot; /&gt;
                &lt;ordered value=&quot;true&quot; /&gt;
                &lt;rules value=&quot;openAtEnd&quot; /&gt;
            &lt;/slicing&gt;
</pre></div>



<a name="153873048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873048">(Feb 22 2017 at 14:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191362">@Richard Kavanagh</span> It's fully enforceable with xpath too.  If you intend to use the validator and don't have time/ability to enhance it, then its limitations are relevant (it was for my project).  Perfectly fine for it not to be relevant to you :)</p>



<a name="153873275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873275">(Feb 24 2017 at 19:04)</a>:</h4>
<p>I think that FHIRPath is available in R2 in the C# code. It certainly is in java</p>



<a name="153873278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873278">(Feb 24 2017 at 19:04)</a>:</h4>
<p>forcing an element to conform to a slice in a FHIRPath invariant:</p>



<a name="153873280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873280">(Feb 24 2017 at 19:06)</a>:</h4>
<div class="codehilite"><pre>[some path].conformsTo(&quot;http://hl7.org/fhir/StructureDefinition/integer&quot;)
</pre></div>



<a name="153873281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873281">(Feb 24 2017 at 19:06)</a>:</h4>
<p>though a profile URL would be appropriate, not a base type</p>



<a name="153873316"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873316" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873316">(Feb 24 2017 at 20:14)</a>:</h4>
<p>conformsTo is new and not yet supported by the Java code, correct?</p>



<a name="153873317"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873317" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873317">(Feb 24 2017 at 20:15)</a>:</h4>
<p>it's not new. but agree it's not implemented in the code yet</p>



<a name="153873318"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873318" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873318">(Feb 24 2017 at 20:15)</a>:</h4>
<p>not sure about using it in the validator either - could easily get circular</p>



<a name="153873321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873321">(Feb 24 2017 at 20:18)</a>:</h4>
<p>Not sure about "easily" but it's within the realm of theoreticaly possibility</p>



<a name="153873471"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873471" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873471">(Feb 26 2017 at 00:51)</a>:</h4>
<p>Yes, can confirm that the fhirpath expressions are in the c# code also.</p>



<a name="153873472"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20Bundle%20Entries/near/153873472" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20Bundle.20Entries.html#153873472">(Feb 26 2017 at 00:51)</a>:</h4>
<p>Both in the invariant definitions and also the search parameter expressions.<br>
(there was a standard extension added to hold them)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
