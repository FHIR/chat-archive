---
layout: page
title: "FHIR Chat  · Change to decimal format · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html">Change to decimal format</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153967837"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153967837" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153967837">(Jun 07 2018 at 11:58)</a>:</h4>
<p><a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=16874" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=16874">GF#16874</a> - we are going to allow the exponential form for decimals. For those of you who use the java reference implementation directly (as opposed to using HAPI), I am replacing the gson with my own JSON parser, since Gson doesn't preserve the number presentation properly in the corner cases. <span class="user-mention" data-user-id="191319">@James Agnew</span> you will need to pay careful attention to this in HAPI)</p>



<a name="153967890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153967890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153967890">(Jun 07 2018 at 20:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> I am also making a change to DecimalType: </p>
<div class="codehilite"><pre><span></span>    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">encode</span><span class="o">(</span><span class="n">BigDecimal</span> <span class="n">theValue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">getValue</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>



<a name="153967891"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153967891" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153967891">(Jun 07 2018 at 20:22)</a>:</h4>
<p>instead of </p>
<div class="codehilite"><pre><span></span>    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">encode</span><span class="o">(</span><span class="n">BigDecimal</span> <span class="n">theValue</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">getValue</span><span class="o">().</span><span class="na">toPlainString</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>



<a name="153967940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153967940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153967940">(Jun 08 2018 at 00:46)</a>:</h4>
<p>ok I have committed the changes. <span class="user-mention" data-user-id="191319">@James Agnew</span> <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> <span class="user-mention" data-user-id="191328">@Ewout Kramer</span> <span class="user-mention" data-user-id="191339">@Pascal Pfiffner</span> <span class="user-mention" data-user-id="191401">@Eric Haas</span> <span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span> + anyone else maintaining reference implementations etc, I found this a fairly long piece of string. It's fairly simple in concept:</p>
<blockquote>
<p>decimal now allows exponential form as well as normal form e.g. 1.023e+3 is now valid where it wasn't</p>
</blockquote>
<p>But it has a long tail:</p>
<ul>
<li>this will also apply to searching as well (e.g. search parameters that are numbers)</li>
<li>the scale allowed is that allowed in the xsd schema for double. This is very large... </li>
<li>special values like NaN and +INF and -INF are not allowed (no json form, not request, we have different ways of handling these)</li>
<li>we still say that the presentation form must be maintained so e.g. 1.023e+3 should not be replaced by 1023. I had to do quite some work in the infrastructure to get this right. I think that reference implementations should get this right</li>
<li>the schema type for decimal has changed to a union of decimal and double - this might be problematic for xml generators</li>
<li>there's an example observation (observation-decimal.xml) that explores some of these issues. It's intended to support round -trip testing</li>
</ul>



<a name="153967994"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153967994" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153967994">(Jun 08 2018 at 04:27)</a>:</h4>
<p>searching those ridiculous numbers in observation-decimal is fun. For me, once the number gets into imaginary number status (&gt; 1e20 or closer to 0 than 1e-30) then I mash them all together into a special value and everything matches everything. I don't think we should make hard rules about functional behaviour at these limits</p>



<a name="153967995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153967995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153967995">(Jun 08 2018 at 04:29)</a>:</h4>
<p>btw, both those numbers are configurable; it people start challenging those numbers, I'll up them, and all that will happen is my database indexes will get bigger...</p>



<a name="153968255"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153968255" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153968255">(Jun 11 2018 at 06:29)</a>:</h4>
<p>Do you intend to menion those limits in the conformance statement?</p>



<a name="153968264"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153968264" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153968264">(Jun 11 2018 at 07:42)</a>:</h4>
<p>no</p>



<a name="153968711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153968711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153968711">(Jun 12 2018 at 14:04)</a>:</h4>
<p>"we still say that the presentation form must be maintained so e.g. 1.023e+3 should not be replaced by 1023. I had to do quite some work in the infrastructure to get this right. I think that reference implementations should get this right"</p>
<p>Mmmm...I have to check whether I can make the .NET Json parser do that.</p>



<a name="153968713"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Change%20to%20decimal%20format/near/153968713" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Change.20to.20decimal.20format.html#153968713">(Jun 12 2018 at 14:07)</a>:</h4>
<p>That seems to be doable. ok.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
