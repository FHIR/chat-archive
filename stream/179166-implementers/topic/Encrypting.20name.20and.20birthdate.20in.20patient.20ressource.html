---
layout: page
title: "FHIR Chat  · Encrypting name and birthdate in patient ressource · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html">Encrypting name and birthdate in patient ressource</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="161664023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161664023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Pawletta <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161664023">(Mar 25 2019 at 17:01)</a>:</h4>
<p>Hi,<br>
we need to encrypt the patient's name and birthdate before we store it. So we would like to store a patient like this (other fields that don't need to be encrypted were neglected now):</p>
<p>&lt;Patient xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
   ..... <br>
   &lt;name&gt;<br>
        &lt;family&gt;<br>
            &lt;extension url="<a href="http://fhir.de/StructureDefinition/encrypted" target="_blank" title="http://fhir.de/StructureDefinition/encrypted">http://fhir.de/StructureDefinition/encrypted</a>"&gt;<br>
                &lt;valueString value="hffsklghskh" /&gt;<br>
            &lt;/extension&gt;<br>
        &lt;/family&gt;<br>
        &lt;given&gt;<br>
            &lt;extension url="<a href="http://fhir.de/StructureDefinition/encrypted" target="_blank" title="http://fhir.de/StructureDefinition/encrypted">http://fhir.de/StructureDefinition/encrypted</a>"&gt;<br>
                &lt;valueString value="fsdkfhsjkd" /&gt;<br>
            &lt;/extension&gt;<br>
        &lt;/given&gt;<br>
    &lt;/name&gt;<br>
    &lt;birthDate&gt;<br>
     &lt;extension url="<a href="http://fhir.de/StructureDefinition/encrypted" target="_blank" title="http://fhir.de/StructureDefinition/encrypted">http://fhir.de/StructureDefinition/encrypted</a>"&gt;<br>
                &lt;valueString value="jksdfgsdhkgfsj" /&gt;<br>
            &lt;/extension&gt;<br>
   &lt;/birthDate&gt;<br>
&lt;/Patient&gt;</p>
<p>However, our Vonk-Server does not allow this Ressource, because it expects a value for the fields "given" and "family". The "birthDate" field however is accepted without a value. I could set the value of "given" and "family" to ENCRYPTED but I would just like to leave it empty.</p>
<p>Are there no null values for "given" and  "family"? Or is there a better "FHIR"-way to solve this?</p>



<a name="161664748"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161664748" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161664748">(Mar 25 2019 at 17:09)</a>:</h4>
<p>For internal persistence, you can store data however you like.  In most systems, it won't look like FHIR at all.  All that matters is that when you <em>exchange</em> the data, it's valid FHIR and is as correct as it can be.  I.e. when exchanging, the birth date and name need to be the real (unencrypted) birth date and name.  If encryption is needed during transport it happens at the channel level or applies to the resource as a whole.</p>



<a name="161664845"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161664845" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161664845">(Mar 25 2019 at 17:10)</a>:</h4>
<p>If you're using a FHIR persistence layer and you need to add encryption, you'll have to customize the persistence layer to achieve that.</p>



<a name="161665414"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161665414" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Pawletta <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161665414">(Mar 25 2019 at 17:16)</a>:</h4>
<p>Hm, in our case some of the fields like "given", "family" and "birthDate" come encrypted from the client and we are only allowed to store the encrypted fields. Other fields are not encrypted and should be stored un-encrpyted.</p>



<a name="161665844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161665844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161665844">(Mar 25 2019 at 17:21)</a>:</h4>
<blockquote>
<p>our Vonk-Server does not allow this Ressource, because it expects a value for the fields "given" and "family".</p>
</blockquote>
<p>Looks like a bug in Vonk to me - that resource is valid</p>



<a name="161681898"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161681898" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161681898">(Mar 25 2019 at 20:01)</a>:</h4>
<p><span class="user-mention" data-user-id="191757">@Christiaan Knaap</span></p>



<a name="161755856"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161755856" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161755856">(Mar 26 2019 at 12:25)</a>:</h4>
<p><span class="user-mention" data-user-id="214893">@Paul Pawletta</span> : This resource is accepted at <a href="http://vonk.fire.ly" target="_blank" title="http://vonk.fire.ly">vonk.fire.ly</a> (currently version 2.0.0-beta) and also on version 1.0.0 (tested both because of considerable changes in 2.0). So maybe the problem is in the prevalidation (validation upon create / update), but to test that I would also need the StructureDefinition for the extension. And since I could not find it on Simplifier - could you provide it?</p>



<a name="161757860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161757860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Pawletta <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161757860">(Mar 26 2019 at 12:49)</a>:</h4>
<p><span class="user-mention" data-user-id="191757">@Christiaan Knaap</span> <a href="/user_uploads/10155/c5c52VMxOoByGkOYu8-oZavL/encrypted.json" target="_blank" title="encrypted.json">encrypted.json</a></p>
<p>We see the following error stacktrace</p>
<p>System.ArgumentNullException: String reference not set to an instance of a String.<br>
Parameter name: s<br>
   at System.Text.Encoding.GetBytes(String s)<br>
   at Vonk.Core.Support.StringExtensions.GetMd5Hash(String input)<br>
   at Vonk.Repository.EntityFramework.Db.EfStringComponent.set_Value(String value)<br>
   at Vonk.Repository.EntityFramework.Db.EfEntryBuilder.AddStringComponent(String name, String value)<br>
   at Vonk.Core.Repository.EntryIndexer<code>1.AddHumanNameComponent(String name, IElementNavigator nav)
   at Vonk.Core.Repository.EntryIndexer</code>1.AddComponentsForParameter(VonkSearchParameter searchParameter, IElementNavigator root)<br>
   at Vonk.Core.Repository.EntryIndexer<code>1.AddComponentsForParameters(IEnumerable</code>1 searchParameters)<br>
   at Vonk.Core.Repository.EntryIndexer<code>1.InternalIndexForParameters(IEnumerable</code>1 parameters)<br>
   at Vonk.Repository.EntityFramework.Change.EfChangeRepository.InsertEntry(IResource input)<br>
   at Vonk.Repository.Sql.SqlChangeRepository.InsertEntry(IResource input)<br>
   at Vonk.Repository.Generic.GenericChangeRepository.Create(IResource input)<br>
Vonk.Core.Operations.Crud.CreateService:Error: Error encountered when creating resource 'Patient/cef015dc-a055-447f-b0a3-e5466282f7da/_history/63d5dc2c-7fcd-4c75-9cd7-56a64ae60072'</p>



<a name="161759884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161759884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161759884">(Mar 26 2019 at 13:12)</a>:</h4>
<p>on a Security/Privacy front.. I hope no one is thinking that this kind of encrypting of the name is protecting privacy or adding any security. This kind of a system is bad security. An adversary can easily identify the encrypted blobs as being equal to an unencrypted text. The prime mistake here is to encrypt element-by-element, leaving the length, and not adding random strings to get better entropy.   Serious re-identification risk exists.</p>



<a name="161766434"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161766434" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christiaan Knaap <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161766434">(Mar 26 2019 at 14:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191404">@John Moehrke</span> : don't worry, nothing of that kind. MD5 is not for encryption, we know that much. Or did you mean the solution with encrypted extensions by Paul?<br>
<span class="user-mention" data-user-id="214893">@Paul Pawletta</span> : Confirmed, consider it fixed in the next release.</p>



<a name="161766826"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161766826" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Pawletta <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161766826">(Mar 26 2019 at 14:30)</a>:</h4>
<p><span class="user-mention" data-user-id="191757">@Christiaan Knaap</span>  great. Thank you!</p>



<a name="161772194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161772194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161772194">(Mar 26 2019 at 15:22)</a>:</h4>
<p>I am concerned about the use of encryption that I see in Paul's initial message.</p>



<a name="161801881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161801881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161801881">(Mar 26 2019 at 20:55)</a>:</h4>
<p>y it probably doesn't make much sense but there's lots out there that doesn't and Paul's comments make clear that this is one of the previously made decisions that you live with</p>



<a name="161856663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Encrypting%20name%20and%20birthdate%20in%20patient%20ressource/near/161856663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Encrypting.20name.20and.20birthdate.20in.20patient.20ressource.html#161856663">(Mar 27 2019 at 13:04)</a>:</h4>
<p>I live with lots of past bad decisions... I thus want everyone else reading this thread to understand that Paul is living with this bad decision. Thus they should not think it is an approved good practice.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
