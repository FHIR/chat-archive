---
layout: page
title: "FHIR Chat  · Combine chaining and reverse chaining in a search · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html">Combine chaining and reverse chaining in a search</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="263151702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263151702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abel Enthoven <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263151702">(Nov 30 2021 at 14:24)</a>:</h4>
<p>I would like to get all Observations belonging to Patients who are members of a Group. My initial thought was to use a combination of chaining and reverse chaining, like GET /Observation?subject:Patient:_has:Group:member:identifier=X. The server does not accept this, but should it be a valid query? If not, what would be a way to achive this?</p>



<a name="263152087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263152087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263152087">(Nov 30 2021 at 14:26)</a>:</h4>
<p>It may well be a valid query.  That doesn't necessarily mean a server will support it.  You need to look at the server's CapabilityStatement to understand what includes and revIncludes it can handle.</p>



<a name="263152680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263152680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abel Enthoven <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263152680">(Nov 30 2021 at 14:30)</a>:</h4>
<p>Sorry, let me offer some context. To get what I described I could indeed start from /Patient and simply include the observations, using _has as a group filter. I would, however, like to use the above query (so with 'Observation' as the root) to construct a SMART v2 scope, like: system/Observation.rs?subject:Patient:_has:Group:member:identifier=X</p>



<a name="263153221"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263153221" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263153221">(Nov 30 2021 at 14:34)</a>:</h4>
<p>the SMART v2 scopes are just requests for an authorization token. Theory is that if you get that authorization scope, then you could ask for everything at the FHIR endpoint and the server would filter out everything that you are NOT authorized... This theory will run up against reality quickly. This is not likely to be supported by the authorization server or the resource server, as it is both a very complex authorization scope, and an unusual use of complex authorization scopes to result in a stateful search.  <br>
Theory - Yes.<br>
Reality - Nope!</p>



<a name="263155616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263155616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263155616">(Nov 30 2021 at 14:51)</a>:</h4>
<p><code>GET /Observation?subject:Patient._has:Group:member:identifier=X</code> should be the correct syntax. The chained parameter needs to be separated with a ".".</p>



<a name="263156276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263156276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263156276">(Nov 30 2021 at 14:55)</a>:</h4>
<p>I think SMART v2 enabled a new category of issues here. If your resource server does not know anything about users / systems and what they are allowed to access (i.e. most FHIR-native reference implementations), it becomes tempting to move this complexity by trying to express more complex scopes.</p>



<a name="263156918"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263156918" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263156918">(Nov 30 2021 at 15:00)</a>:</h4>
<p>An authorization server needs to be smart enough to not issue tokens that the resource server can't enforce.</p>



<a name="263158997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263158997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263158997">(Nov 30 2021 at 15:15)</a>:</h4>
<p>Some implementation tend to enforce only a patient level scope in combination with a patient claim in the token. If you have a user-level scope you could still enforce the Observation query listed above, but it wouldn't know what Observations belong to the user. That's why a simple scope might not be enough. </p>
<p>I fully agree that the resource server should filter it out.</p>



<a name="263159151"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263159151" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263159151">(Nov 30 2021 at 15:16)</a>:</h4>
<p>In the case above I could only imagine that the Group resource replaces the concept of "What is the user allowed to see".</p>



<a name="263159235"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263159235" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Zautke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263159235">(Nov 30 2021 at 15:17)</a>:</h4>
<p>My point was just that this type of request is now only possible due to the new token syntax.</p>



<a name="263160295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263160295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263160295">(Nov 30 2021 at 15:24)</a>:</h4>
<p>Agree with the point here that just because the syntax of the scope language allows, it does not mean anyone should expect every expression to work in real life. I expect a few hardcoded expressions to be supported in the context of US core, for example, to allow for access to vital signs versus lab results.</p>



<a name="263178020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Combine%20chaining%20and%20reverse%20chaining%20in%20a%20search/near/263178020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abel Enthoven <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Combine.20chaining.20and.20reverse.20chaining.20in.20a.20search.html#263178020">(Nov 30 2021 at 17:20)</a>:</h4>
<p>Thanks for all your answers! And I agree with you guys that it is not to be expected that a server could apply these scopes. As <span class="user-mention" data-user-id="193430">@Alexander Zautke</span> mentions, it is indeed a reference implementation I'm dealing with, which can not enforce user level scopes. Currently I know of no other way to restrict a user's access than by including narrow scopes in the token or by creating a server plugin of some kind</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
