---
layout: page
title: "FHIR Chat  · Slicing on pattern/fixed · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Slicing.20on.20pattern.2Ffixed.html">Slicing on pattern/fixed</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="204453287"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Slicing%20on%20pattern/fixed/near/204453287" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nik Klassen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Slicing.20on.20pattern.2Ffixed.html#204453287">(Jul 20 2020 at 17:49)</a>:</h4>
<p>I'm working on implementing validation against StructureDefinitions. One thing I'm finding confusing is how cardinality affects the evaluation of  pattern/fixed constraints. Looking at the <a href="https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator">Java FHIR validator</a>. It seems that for non-slices: min: 0 and fixed fails on an empty field; min: 0 and pattern does not fail on an empty field. It seems like they should both fail, but the slicing case is more confusing. An empty slice doesn't fail for pattern or fixed on an empty field. This makes sense intuitively, if a slice is allowed to be empty then we shouldn't check the pattern rules. But we do check them if it's not a slice, which makes actually implementing these rules confusing. So the question is why does it pass when the slice is empty? Is it because we don't run any rules on an empty slice? Or is it something more specialized, like we should not recheck the discriminator rule specifically? If there was a binding in addition to the pattern/fixed does that get run? I think the easiest way to implement this is "when evaluating slice rules, if the slice is empty don't check any of the other rules in the slice definition", but I want to make sure I'm not missing an edge case</p>



<a name="204456261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Slicing%20on%20pattern/fixed/near/204456261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Slicing.20on.20pattern.2Ffixed.html#204456261">(Jul 20 2020 at 18:13)</a>:</h4>
<p>My (non-authoritative) interpretation:</p>
<p>Non-Sliced:</p>
<ul>
<li>pattern is a check against a present value; since <code>min: 0</code> means the field is optional, the pattern isn't tested and a missing value passes.</li>
<li>fixed is a check that the exact value is present - even though the value is optional, the required value isn't present and it fails.</li>
</ul>
<p>Slicing is more complicated, because slicing =).</p>
<ul>
<li>If the slice is required and <code>slicing.rules = closed</code> (assuming the correct value is present somewhere else), it should fail (invalid value).</li>
<li>If the slice is required and not present (regardless of open/closed), it should fail (required slice not found).</li>
<li>If the slice is defined but not required, it should pass.</li>
</ul>



<a name="204461819"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Slicing%20on%20pattern/fixed/near/204461819" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nik Klassen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Slicing.20on.20pattern.2Ffixed.html#204461819">(Jul 20 2020 at 19:01)</a>:</h4>
<p>Everything here matches my understanding, except the first point. The spec says  "pattern[x]: Specifies a value that the value in the instance SHALL follow - that is, any value in the pattern must be found in the instance." <em>the value in the instance</em> says to me that there must be an instance to check against.</p>



<a name="204473253"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Slicing%20on%20pattern/fixed/near/204473253" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Slicing.20on.20pattern.2Ffixed.html#204473253">(Jul 20 2020 at 20:38)</a>:</h4>
<blockquote>
<p>It seems that for non-slices: min: 0 and fixed fails on an empty field; min: 0 and pattern does not fail on an empty field</p>
</blockquote>
<p>That's certainly surprising to me</p>



<a name="204473261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Slicing%20on%20pattern/fixed/near/204473261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Slicing.20on.20pattern.2Ffixed.html#204473261">(Jul 20 2020 at 20:38)</a>:</h4>
<p>do you have your test cases?</p>



<a name="204579335"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Slicing%20on%20pattern/fixed/near/204579335" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nik Klassen <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Slicing.20on.20pattern.2Ffixed.html#204579335">(Jul 21 2020 at 17:45)</a>:</h4>
<p>I used the ElementDefinition</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;path&quot;: &quot;Patient.identifier&quot;,
  &quot;id&quot;: &quot;Patient.identifier&quot;,
  &quot;min&quot;: 0,
  &quot;max&quot;: &quot;*&quot;,
  &quot;base&quot;: {
    &quot;min&quot;: 0,
    &quot;max&quot;: &quot;*&quot;
  },
  &quot;patternIdentifier&quot;: {
    &quot;use&quot;: &quot;usual&quot;
  }
}
</code></pre></div>


<p>with an empty Patient. It may be that using a StructureDefinition this minimal isn't expected to work. <a href="/user_uploads/10155/caFofv-aKCkEtxwF3UBbs6zR/sd.json">sd.json</a> <a href="/user_uploads/10155/3rVak-sng2eotdg5sf983rac/patient.json">patient.json</a></p>



<a name="204613456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Slicing%20on%20pattern/fixed/near/204613456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Slicing.20on.20pattern.2Ffixed.html#204613456">(Jul 21 2020 at 23:08)</a>:</h4>
<p>I moved this discussion to <a href="#narrow/stream/179177-conformance/topic/fixed.2Fpattern.20on.20min.20.3D.200">https://chat.fhir.org/#narrow/stream/179177-conformance/topic/fixed.2Fpattern.20on.20min.20.3D.200</a> for ease of focus</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
