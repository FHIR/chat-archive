---
layout: page
title: "FHIR Chat  · Validation of codes fails after terminology server downtime · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html">Validation of codes fails after terminology server downtime</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153975992"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153975992" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153975992">(Jul 18 2018 at 07:01)</a>:</h4>
<p>Last week, the terminology server used by default by the Java JAR validator (<a href="http://tx.fhir.org/r3" target="_blank" title="http://tx.fhir.org/r3">tx.fhir.org/r3</a>) was down for several days, causing validation errors. Now it's back up again, but I am seeing validation errors when validating codes in resources that had no errors before. All the errors have the same form, e.g.:</p>
<p><code>Error @ Observation.code.coding (line 8, col17) : Error null validating Coding</code></p>
<p>As far as I can tell, I get this for every field containing a code with a coding system. I am using a validator JAR downloaded today. </p>
<p>Was there a deliberate change in the way codes are handled or is it a bug?</p>



<a name="153975995"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153975995" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153975995">(Jul 18 2018 at 07:07)</a>:</h4>
<p>bug</p>



<a name="153975996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153975996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153975996">(Jul 18 2018 at 07:08)</a>:</h4>
<p>things are changing too quickly.... my aim is to have all the substantiative changes made and things stable by the end of next week</p>



<a name="153976003"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153976003" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153976003">(Jul 18 2018 at 08:06)</a>:</h4>
<p>OK, thanks for the update!</p>



<a name="153990730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990730">(Aug 24 2018 at 08:29)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Reviving this thread as I came across what seems to be a related problem. The validator now appears to break completely with the default terminology server.:</p>
<div class="codehilite"><pre><span></span>java -jar org.hl7.fhir.validator.jar -defn http://hl7.org/fhir patient-example.xml
  .. load FHIR from http://hl7.org/fhir
  .. connect to tx server @ http://tx.fhir.org/r3
Exception in thread &quot;main&quot; org.hl7.fhir.dstu3.utils.client.EFhirClientException: Error parsing response message
        at org.hl7.fhir.dstu3.utils.client.ClientUtils.unmarshalReference(ClientUtils.java:284)
        at org.hl7.fhir.dstu3.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:179)
        at org.hl7.fhir.dstu3.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:161)
        at org.hl7.fhir.dstu3.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:152)
        at org.hl7.fhir.dstu3.utils.client.ClientUtils.issueGetResourceRequest(ClientUtils.java:99)
        at org.hl7.fhir.dstu3.utils.client.FHIRToolingClient.getCapabilitiesStatementQuick(FHIRToolingClient.java:169)
        at org.hl7.fhir.dstu3.context.SimpleWorkerContext.connectToTSServer(SimpleWorkerContext.java:161)
        at org.hl7.fhir.dstu3.validation.ValidationEngine.connectToTSServer(ValidationEngine.java:316)
        at org.hl7.fhir.dstu3.validation.ValidationEngine.&lt;init&gt;(ValidationEngine.java:169)
        at org.hl7.fhir.dstu3.validation.Validator.main(Validator.java:214)
Caused by: org.hl7.fhir.exceptions.FHIRFormatError: only whitespace content allowed before start tag and not D (position: START_DOCUMENT seen D... @1:1)
        at org.hl7.fhir.dstu3.formats.XmlParserBase.parse(XmlParserBase.java:90)
        at org.hl7.fhir.dstu3.utils.client.ClientUtils.unmarshalReference(ClientUtils.java:277)
        ... 9 more
Caused by: org.xmlpull.v1.XmlPullParserException: only whitespace content allowed before start tag and not D (position: START_DOCUMENT seen D... @1:1)
        at org.xmlpull.mxp1.MXParser.parseProlog(MXParser.java:1519)
        at org.xmlpull.mxp1.MXParser.nextImpl(MXParser.java:1395)
        at org.xmlpull.mxp1.MXParser.next(MXParser.java:1093)
        at org.hl7.fhir.dstu3.formats.XmlParserBase.next(XmlParserBase.java:192)
        at org.hl7.fhir.dstu3.formats.XmlParserBase.loadXml(XmlParserBase.java:182)
        at org.hl7.fhir.dstu3.formats.XmlParserBase.parse(XmlParserBase.java:87)
</pre></div>


<p>If I explicitly switch off the terminology server (i.e. add <code>-tx n/a</code>), it works fine. However, if I do not set the <code>-defn</code> option, I get another error with or without terminology server (same error in both cases):</p>
<div class="codehilite"><pre><span></span>java -jar org.hl7.fhir.validator.jar patient-example.xml -tx n/a
  .. load FHIR from http://build.fhir.org/
  .. connect to tx server @ null
Exception in thread &quot;main&quot; java.lang.ClassCastException: com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject
        at com.google.gson.JsonObject.getAsJsonObject(JsonObject.java:182)
        at org.hl7.fhir.dstu3.formats.JsonParser.parseCodeSystemProperties(JsonParser.java:5018)
        at org.hl7.fhir.dstu3.formats.JsonParser.parseCodeSystem(JsonParser.java:5007)
        at org.hl7.fhir.dstu3.formats.JsonParser.parseResource(JsonParser.java:19571)
        at org.hl7.fhir.dstu3.formats.JsonParser.parseBundleBundleEntryComponentProperties(JsonParser.java:2754)
        at org.hl7.fhir.dstu3.formats.JsonParser.parseBundleBundleEntryComponent(JsonParser.java:2737)
        at org.hl7.fhir.dstu3.formats.JsonParser.parseBundleProperties(JsonParser.java:2710)
        at org.hl7.fhir.dstu3.formats.JsonParser.parseBundle(JsonParser.java:2685)
        at org.hl7.fhir.dstu3.formats.JsonParser.parseResource(JsonParser.java:19555)
        at org.hl7.fhir.dstu3.formats.JsonParserBase.parse(JsonParserBase.java:90)
        at org.hl7.fhir.dstu3.context.SimpleWorkerContext.loadFromFileJson(SimpleWorkerContext.java:199)
        at org.hl7.fhir.dstu3.context.SimpleWorkerContext.loadDefinitionItem(SimpleWorkerContext.java:151)
        at org.hl7.fhir.dstu3.context.SimpleWorkerContext.fromDefinitions(SimpleWorkerContext.java:142)
        at org.hl7.fhir.dstu3.validation.ValidationEngine.loadDefinitions(ValidationEngine.java:174)
        at org.hl7.fhir.dstu3.validation.ValidationEngine.&lt;init&gt;(ValidationEngine.java:168)
        at org.hl7.fhir.dstu3.validation.Validator.main(Validator.java:214)
</pre></div>


<p>I'm using a validator I just downloaded.</p>



<a name="153990761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990761">(Aug 24 2018 at 15:09)</a>:</h4>
<p>Just for clarification, it's the validator you downloaded from <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">http://build.fhir.org</a>?</p>



<a name="153990915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990915">(Aug 26 2018 at 21:58)</a>:</h4>
<p>I don't think it is</p>



<a name="153990960"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990960" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990960">(Aug 27 2018 at 10:35)</a>:</h4>
<p>Indeed, I was using the STU 3 validator downloaded from</p>
<p><a href="https://www.hl7.org/fhir/downloads.html" target="_blank" title="https://www.hl7.org/fhir/downloads.html">https://www.hl7.org/fhir/downloads.html</a></p>
<p>I tested again with the validator from <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">build.fhir.org</a> but three I also run into errors (despite trying out different combinations of <code>-defn</code> and <code>-tx</code>). I see two errors reported, depending on the options passed:</p>
<div class="codehilite"><pre><span></span>java -jar org.hl7.fhir.validator.jar patient-example.xml
  .. connect to tx server @ http://tx.fhir.org/r4
Exception in thread &quot;main&quot; org.hl7.fhir.exceptions.FHIRException: Unable to resolve the package &#39;hl7.fhir.core-3.5.0&#39;
        at org.hl7.fhir.utilities.cache.PackageCacheManager.resolvePackage(PackageCacheManager.java:491)
        at org.hl7.fhir.r4.validation.ValidationEngine.resolvePackage(ValidationEngine.java:541)
        at org.hl7.fhir.r4.validation.ValidationEngine.fetchByPackage(ValidationEngine.java:530)
        at org.hl7.fhir.r4.validation.ValidationEngine.loadIgSource(ValidationEngine.java:390)
        at org.hl7.fhir.r4.validation.ValidationEngine.loadDefinitions(ValidationEngine.java:298)
        at org.hl7.fhir.r4.validation.ValidationEngine.loadInitialDefinitions(ValidationEngine.java:263)
        at org.hl7.fhir.r4.validation.ValidationEngine.&lt;init&gt;(ValidationEngine.java:288)
        at org.hl7.fhir.r4.validation.Validator.main(Validator.java:337)
</pre></div>


<p>and</p>
<div class="codehilite"><pre><span></span>java -jar org.hl7.fhir.validator.jar -defn http://hl7.org/fhir patient-example.xml
  .. connect to tx server @ http://tx.fhir.org/r4
   ... Using version 3.0.1
-tx cache miss: Connect to http://tx.fhir.org/r4
    (v3.0.1-null)
  .. validate [patient-example.xml]
Exception in thread &quot;main&quot; org.hl7.fhir.exceptions.FHIRException: Unable to resolve the package &#39;patient-example.xml&#39;
        at org.hl7.fhir.utilities.cache.PackageCacheManager.resolvePackage(PackageCacheManager.java:491)
        at org.hl7.fhir.r4.validation.ValidationEngine.resolvePackage(ValidationEngine.java:541)
        at org.hl7.fhir.r4.validation.ValidationEngine.fetchByPackage(ValidationEngine.java:530)
        at org.hl7.fhir.r4.validation.ValidationEngine.loadIgSource(ValidationEngine.java:390)
        at org.hl7.fhir.r4.validation.ValidationEngine.loadContent(ValidationEngine.java:720)
        at org.hl7.fhir.r4.validation.ValidationEngine.validate(ValidationEngine.java:750)
        at org.hl7.fhir.r4.validation.Validator.main(Validator.java:395)
</pre></div>


<p>(this is what I see after the specs were already fetched and cached - failed be fore caching, too, though)</p>



<a name="153990967"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990967" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990967">(Aug 27 2018 at 11:04)</a>:</h4>
<p>have you followed the instructions here: <a href="http://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator" target="_blank" title="http://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator">http://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator</a></p>



<a name="153990969"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990969" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990969">(Aug 27 2018 at 11:30)</a>:</h4>
<p>I thought I had - but after following your hint, I realized that I had simply forgotten "./" in the path to the file to validate (didn't know the <code>-version</code> parameter, either)...   So now the following runs through fine on the <a href="http://build.fhir.org" target="_blank" title="http://build.fhir.org">build.fhir.org</a> validator -  thanks!</p>
<div class="codehilite"><pre><span></span>java -jar org.hl7.fhir.validator.jar ./patient-example.xml -version 3.0.1
</pre></div>


<p>So I will just use that now. (The validator downloaded from the STU 3 page still seems to give an error with this command, however.)</p>



<a name="153990970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990970">(Aug 27 2018 at 11:30)</a>:</h4>
<p>I don't understand why ./ makes any difference</p>



<a name="153990976"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990976" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990976">(Aug 27 2018 at 12:08)</a>:</h4>
<p>My apologies if I am confusing things here - I just noticed that if the file to validate is in the same directory as the validator itself, then giving the file path as simply "example-patient.xml" causes an error while "./example-patient.xml" works (when running the validator from the directory).</p>



<a name="153990980"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990980" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990980">(Aug 27 2018 at 12:11)</a>:</h4>
<p>.. that's... weird. Doesn't happen on windows. I'll have to debug on OSX...</p>



<a name="153990982"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990982" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990982">(Aug 27 2018 at 12:17)</a>:</h4>
<p>I'm seeing it on Window 10,. I tested on three different shells now (normal CMD, Git CMD and PowerShell): All of them work with "./" or ".\" prefixed to the filename, but none work without such a prefix.</p>



<a name="153990984"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990984" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990984">(Aug 27 2018 at 12:20)</a>:</h4>
<p>what directory are you in? I never use ./ on windows 10</p>



<a name="153990986"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153990986" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153990986">(Aug 27 2018 at 12:25)</a>:</h4>
<p>In the directory containing both the validator and the file I want to validate.</p>



<a name="153991240"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20of%20codes%20fails%20after%20terminology%20server%20downtime/near/153991240" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Morten Ernebjerg <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20of.20codes.20fails.20after.20terminology.20server.20downtime.html#153991240">(Aug 28 2018 at 14:01)</a>:</h4>
<p>BTW: I seemed to see another validator problem, but since I am pretty sure it has nothing to do with terminology servers, I decided to put it in a separate thread to have a more fitting title: <a href="#narrow/stream/4-implementers/subject/Validator.20-.20trouble.20loading.20custom.20profiles" title="#narrow/stream/4-implementers/subject/Validator.20-.20trouble.20loading.20custom.20profiles">https://chat.fhir.org/#narrow/stream/4-implementers/subject/Validator.20-.20trouble.20loading.20custom.20profiles</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
