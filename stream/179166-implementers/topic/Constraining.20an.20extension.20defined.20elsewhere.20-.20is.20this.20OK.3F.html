---
layout: page
title: "FHIR Chat  · Constraining an extension defined elsewhere - is this OK? · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20an.20extension.20defined.20elsewhere.20-.20is.20this.20OK.3F.html">Constraining an extension defined elsewhere - is this OK?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="157744410"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20an%20extension%20defined%20elsewhere%20-%20is%20this%20OK%3F/near/157744410" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Eastwood <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20an.20extension.20defined.20elsewhere.20-.20is.20this.20OK.3F.html#157744410">(Feb 07 2019 at 01:37)</a>:</h4>
<p>Hello, I am attempting to derive a profile from an existing profile of Condition, as found in the HL7 Australia IG: <a href="http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-au-condition.html" target="_blank" title="http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-au-condition.html">AU Condition</a>. Note that this AU Condition profile includes <a href="http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-recorder.html" target="_blank" title="http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-recorder.html">an extension</a> to add the capability to represent the recorder of the condition data (with references to 3 STU3 participant resources); as the <a href="http://build.fhir.org/condition-definitions.html#Condition.recorder" target="_blank" title="http://build.fhir.org/condition-definitions.html#Condition.recorder">R4 Condition counterpart</a> does.</p>
<p>So, in my derived profile from the above I am adding a number of constraints such as adding must support etc, however the constraint of interest here regards the recorder extension. What I am trying to do is swap out the reference to the STU3 participants with more constrained versions that we have defined in a non-public IG.</p>
<p>In order to do this I have added the following into the condition profile structure definition:</p>
<div class="codehilite"><pre><span></span>&lt;element id=&quot;Condition.extension:recorder.valueReference:valueReference&quot;&gt;
      &lt;path value=&quot;Condition.extension.value[x]&quot;/&gt;
      &lt;sliceName value=&quot;valueReference&quot;/&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot;/&gt;
        &lt;targetProfile value=&quot;http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/patient-dh-base-1&quot;/&gt;
      &lt;/type&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot;/&gt;
        &lt;targetProfile value=&quot;http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/practitioner-dh-base-1&quot;/&gt;
      &lt;/type&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot;/&gt;
        &lt;targetProfile value=&quot;http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/relatedperson-dh-base-1&quot;/&gt;
      &lt;/type&gt;
&lt;/element&gt;
</pre></div>


<p>The IG builds without error or warnings however this appears in the generated differential table - ie the original recorder STU3 references as well as our local constrained variations:<br>
<a href="/user_uploads/10155/Vm2HWT5rnhplp-YW1JlY-26K/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/Vm2HWT5rnhplp-YW1JlY-26K/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/10155/Vm2HWT5rnhplp-YW1JlY-26K/pasted_image.png"></a></div><p>That may be OK, but the generated structuredefinition file reverts the extension's references to the STU3 like so (and is also rendered as such on the snapshot tab) :</p>
<div class="codehilite"><pre><span></span>&lt;element id=&quot;Condition.extension:recorder.valueReference:valueReference&quot;&gt;
      &lt;path value=&quot;Condition.extension.valueReference&quot;/&gt;
      &lt;sliceName value=&quot;valueReference&quot;/&gt;
      &lt;short value=&quot;Who recorded the record&quot;/&gt;
      &lt;definition
                  value=&quot;Value of extension - may be a resource or one of a constrained set of the data types (see Extensibility in the spec for list).&quot;/&gt;
      &lt;min value=&quot;1&quot;/&gt;
      &lt;max value=&quot;1&quot;/&gt;
      &lt;base&gt;
        &lt;path value=&quot;Extension.value[x]&quot;/&gt;
        &lt;min value=&quot;0&quot;/&gt;
        &lt;max value=&quot;1&quot;/&gt;
      &lt;/base&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot;/&gt;
        &lt;targetProfile value=&quot;http://hl7.org/fhir/StructureDefinition/Patient&quot;/&gt;
      &lt;/type&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot;/&gt;
        &lt;targetProfile
                       value=&quot;http://hl7.org/fhir/StructureDefinition/Practitioner&quot;/&gt;
      &lt;/type&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot;/&gt;
        &lt;targetProfile
                       value=&quot;http://hl7.org/fhir/StructureDefinition/RelatedPerson&quot;/&gt;
      &lt;/type&gt;
&lt;/element&gt;
</pre></div>


<p>My first question therefore is - is this form of constraint acceptable; or should I be considering another approach, like creating a new extension maybe or adding invariants?<br>
And if it is acceptable, how to make it work (so that the snapshot contains the desired references to my constrained variants?</p>
<p>Thank you!</p>



<a name="157744560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Constraining%20an%20extension%20defined%20elsewhere%20-%20is%20this%20OK%3F/near/157744560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rob Eastwood <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Constraining.20an.20extension.20defined.20elsewhere.20-.20is.20this.20OK.3F.html#157744560">(Feb 07 2019 at 01:40)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="191368">@Brett Esler</span> and <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> - this is the query that I chatted with you a couple of days ago - FYI.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
