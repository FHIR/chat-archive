---
layout: page
title: "FHIR Chat  · Validation Questions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html">Validation Questions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="214119456"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214119456" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raghav Rajagopalan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214119456">(Oct 21 2020 at 21:52)</a>:</h4>
<p>Hi y'all, I'm new to FHIR and am currently looking into using the FHIR validator in a process. My issue is that running (what I think is) the same validation using the ValidationEngine vs using the command line jar gives me two different results.</p>
<p>For context, I want to validate: </p>
<ul>
<li>this resource - <a href="https://www.hl7.org/fhir/us/core/Patient-example.html">https://www.hl7.org/fhir/us/core/Patient-example.html</a>  (downloaded as an XML file)</li>
<li>against - <a href="https://www.hl7.org/fhir/us/core/index.html">https://www.hl7.org/fhir/us/core/index.html</a> </li>
</ul>
<p>I'm using the ValidationEngine like so (validating against r4 base spec, so want to use that as an IG):</p>
<div class="codehilite"><pre><span></span><code>           ValidationEngine validator = null;
           try {
               validator = new ValidationEngine(&quot;hl7.fhir.r4.core&quot;);
               validator.connectToTSServer(&quot;http://tx.fhir.org&quot;, null, FhirPublication.fromCode(&quot;4.0&quot;));
               validator.loadIg(&quot;hl7.fhir.r4.core&quot;, true);
               OperationOutcome o = validator.validate(Manager.FhirFormat.XML, this.getClass().getClassLoader().getResourceAsStream(&quot;fhir-us-core/patient/validResource.xml&quot;), null);
               List&lt;OperationOutcome.OperationOutcomeIssueComponent&gt; issues = o.getIssue();
               issues.forEach((issue) -&gt; {
                   if (issue.getSeverity() == OperationOutcome.IssueSeverity.ERROR || issue.getSeverity() == OperationOutcome.IssueSeverity.FATAL) {
                         System.out.println(issue.getDetails().getText());
                   }
               });
           } catch (IOException | URISyntaxException | EOperationOutcome e) {
               e.printStackTrace();
           }

           ....
</code></pre></div>


<p>This is an error that gets outputted: "URL value '<a href="http://hospital.smarthealthit.org">http://hospital.smarthealthit.org</a>' does not resolve "   </p>
<p>However it seems to work, with an Informational "ALL OK" message when I run the following in my terminal: java -jar /path/to/validator_cli.jar path/to/valid/patientResource.xml -version 4.0 -ig <a href="http://hl7.org/fhir/us/core/">http://hl7.org/fhir/us/core/</a></p>



<a name="214127377"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214127377" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ryan moehrke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214127377">(Oct 21 2020 at 23:28)</a>:</h4>
<p>this may not be your root issue here but I notice that your terminal command points to the -ig <a href="http://hl7.org/fhir/us/core/">http://hl7.org/fhir/us/core/</a> but your code uses validator.loadIg("hl7.fhir.r4.core", true); <br>
If I'm reading this right you are validating against US Core in the terminal but against base FHIR core in the code block. I'm not sure what the package name for us-core is but I'd try using that first.</p>
<p>and the next question I'd ask if that doesn't work is, what level of error are you seeing in the operationoutcome? is it an error, warning, or informational. I'm not sure but what might be happening is some of the low-severity warning/informationals may be hidden from the terminal call without a specific flag set</p>



<a name="214128363"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214128363" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raghav Rajagopalan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214128363">(Oct 21 2020 at 23:43)</a>:</h4>
<p>Thanks for your response!</p>
<p>Sorry the IG I put in the code block was a typo - I did mean to use "<a href="http://hl7.org/fhir/us/core/">http://hl7.org/fhir/us/core/</a>" in both places, and when I do that the level of error for the message is either Fatal or Error - whereas the running it in the CLI has no errors or warning level messages.</p>



<a name="214132204"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214132204" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214132204">(Oct 22 2020 at 00:41)</a>:</h4>
<p>it looks to me like you should investigate the validator settings - for instance, validation options relating to unknown references</p>



<a name="214231355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214231355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raghav Rajagopalan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214231355">(Oct 22 2020 at 18:49)</a>:</h4>
<p>Hmm not sure how to allow it to not worry about URLs it can't resolve without changing the resource file itself.</p>
<p>For reference, the resolveURL code in <a href="https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/ValidationEngine.java#L1763">https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/ValidationEngine.java#L1763</a> seems to consider URLs that don't begin with "http://" or "https://" as valid . </p>
<p>If it helps, the URL that fails doesn't seem to point to anything now (<a href="http://hospital.smarthealthit.org">http://hospital.smarthealthit.org</a>), so that could be an issue with the example patient resource.</p>



<a name="214247275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214247275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214247275">(Oct 22 2020 at 20:57)</a>:</h4>
<p>have you implemented IValidatorResourceFetcher ?</p>



<a name="214249939"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214249939" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raghav Rajagopalan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214249939">(Oct 22 2020 at 21:23)</a>:</h4>
<p>No, ValidationEngine implements it, and since the CLI was calling it under the hood I was assuming I was doing something wrong there. Can definitely implement it and be less strict when resolving URLs if that's the best course.</p>
<p>Would using ValidationEngine the same way the CLI does via ValidationService (like <a href="https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/ValidatorCli.java#L159">https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/ValidatorCli.java#L159</a>) be a better way to go about that.</p>
<p>Are there usage examples or documentation surrounding ValidationEngine besides the comments in the file?</p>



<a name="214259661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214259661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214259661">(Oct 22 2020 at 23:29)</a>:</h4>
<p>no the code and comments are what you have.</p>



<a name="214328951"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Validation%20Questions/near/214328951" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Raghav Rajagopalan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Validation.20Questions.html#214328951">(Oct 23 2020 at 15:37)</a>:</h4>
<p>I think I may have figured it out! - If InstanceValidator cannot resolve the URL, it tries using a fetcher's (if non null)  resolveURL. By default, the fetcher is null. ValidationService initializes a fetcher (StandAloneValidatorFetcher) and that fetcher is able to resolve the URL. </p>
<p>When using ValidationEngine and setting the fetcher to the StandAloneValidatorFetcher, the URL is able to be resolved.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
