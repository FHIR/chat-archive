---
layout: page
title: "FHIR Chat  · FHIRPath · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html">FHIRPath</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153810682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Admin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810682">(Nov 20 2015 at 09:44)</a>:</h4>
<p>JS implementation coming along.</p>



<a name="153810684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810684">(Nov 20 2015 at 10:12)</a>:</h4>
<p>Whoa, hey Grahame!</p>



<a name="153810690"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810690" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810690">(Nov 20 2015 at 11:23)</a>:</h4>
<p>Demo was updated - <a href="http://niquola.github.io/fhirpath-demo/#/" target="_blank" title="http://niquola.github.io/fhirpath-demo/#/">http://niquola.github.io/fhirpath-demo/#/</a></p>



<a name="153810695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810695">(Nov 20 2015 at 11:29)</a>:</h4>
<p>Here is syntax of jsquery from postgresql guys - <a href="https://github.com/postgrespro/jsquery" target="_blank" title="https://github.com/postgrespro/jsquery">https://github.com/postgrespro/jsquery</a></p>



<a name="153810696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810696">(Nov 20 2015 at 11:29)</a>:</h4>
<p>Oh yeah, I forgot about that. The symbols are pretty cryptic at first look ;-)</p>



<a name="153810697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810697">(Nov 20 2015 at 11:32)</a>:</h4>
<p>(deleted)</p>



<a name="153810699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810699">(Nov 20 2015 at 11:45)</a>:</h4>
<p>hi</p>



<a name="153810700"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810700" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810700">(Nov 20 2015 at 11:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I don't understand when you managed to sign up and join. I was in the room with you the whole time.</p>



<a name="153810702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810702">(Nov 20 2015 at 12:37)</a>:</h4>
<p>I still don't understand `.distinct(path,path). Can you help with an example, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> </p>



<a name="153810703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810703">(Nov 20 2015 at 12:40)</a>:</h4>
<p>ok, so there's a rule: if you say that an element has more than one type, then the different types must have a different code, or if you have more than one type with the same code, they have to have different profiles </p>



<a name="153810704"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810704" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810704">(Nov 20 2015 at 12:41)</a>:</h4>
<p>e,g. you couldn't say element value[x] choice of boolean | boolean</p>



<a name="153810705"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810705" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810705">(Nov 20 2015 at 12:41)</a>:</h4>
<p>but you might say element value[x] : choice of Reference(Patient) | Reference(Person)</p>



<a name="153810706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810706">(Nov 20 2015 at 12:42)</a>:</h4>
<p>hence, invariant on ElementDefinition:</p>
<p>type.distinct(code,profile)</p>



<a name="153810707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810707">(Nov 20 2015 at 12:44)</a>:</h4>
<p>So that's the use case. Now help me understand how it applies, as a rule, to data. Each of the two <code>path</code> arguments to <code>distinct()</code> returns a collection. How do I decide, based on those two collections, whether <code>distinct()</code> returns <code>[true]</code> or <code>[false]</code> ?</p>



<a name="153810708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810708">(Nov 20 2015 at 12:45)</a>:</h4>
<p>Also, @<strong>nicola</strong> and I would love to demo our JS FHIRPath implementation in the demo session, if we can?</p>



<a name="153810709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810709">(Nov 20 2015 at 12:46)</a>:</h4>
<p>Sounds like a good to me, but Ewout controls things</p>



<a name="153810710"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810710" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810710">(Nov 20 2015 at 12:46)</a>:</h4>
<p>my rule for distinct: if all the collections are equal, they are not distinct</p>



<a name="153810711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810711">(Nov 20 2015 at 12:47)</a>:</h4>
<p>collections are equal if they are the same length, and if all the items in order equal each other </p>



<a name="153810712"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810712" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810712">(Nov 20 2015 at 12:47)</a>:</h4>
<p>OK. So why can't <code>distinct()</code> be replaced with <code>!=</code> calls?</p>



<a name="153810713"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810713" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810713">(Nov 20 2015 at 12:47)</a>:</h4>
<p>clearly, there's an order problem there</p>



<a name="153810714"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810714" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810714">(Nov 20 2015 at 12:47)</a>:</h4>
<p>(Also, @<strong>nicola</strong> says we're already on the list. Shows you what I know.)</p>



<a name="153810715"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810715" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810715">(Nov 20 2015 at 12:47)</a>:</h4>
<p>huh? how would that work? </p>



<a name="153810716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810716">(Nov 20 2015 at 12:47)</a>:</h4>
<p>Order problefm?</p>



<a name="153810717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810717">(Nov 20 2015 at 12:48)</a>:</h4>
<p>for that use cases above, order doesn't matter - they can't differ only in order </p>



<a name="153810718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810718">(Nov 20 2015 at 12:48)</a>:</h4>
<p>So... sort then do a comparison, is the basic idea? We'll need to specify that.</p>



<a name="153810719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810719">(Nov 20 2015 at 12:48)</a>:</h4>
<p>we don't have sort. I don't know how to sort some of those things</p>



<a name="153810720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810720">(Nov 20 2015 at 12:48)</a>:</h4>
<p>distinct is overlapping 'SQL distinct', so someone would think that distinct is a filter</p>



<a name="153810721"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810721" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810721">(Nov 20 2015 at 12:49)</a>:</h4>
<p>well, I'm open to name questions</p>



<a name="153810722"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810722" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810722">(Nov 20 2015 at 12:49)</a>:</h4>
<p>I'd say say for <code>=</code>, to do something like:</p>
<div class="codehilite"><pre>ElementDefinition.type.where(code = profile).empty()
</pre></div>



<a name="153810723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810723">(Nov 20 2015 at 12:49)</a>:</h4>
<p>intersect?</p>



<a name="153810724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810724">(Nov 20 2015 at 12:49)</a>:</h4>
<p>that's a total different rule</p>



<a name="153810725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810725">(Nov 20 2015 at 12:49)</a>:</h4>
<p>OK, then I'm still not getting it.</p>



<a name="153810726"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810726" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810726">(Nov 20 2015 at 12:50)</a>:</h4>
<p>Intersect and union are nice terms that people understand</p>



<a name="153810727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810727">(Nov 20 2015 at 12:50)</a>:</h4>
<p>you rule says that for the types, none of them can exist where the type.code = type.profile</p>



<a name="153810728"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810728" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810728">(Nov 20 2015 at 12:51)</a>:</h4>
<p>my rule is different to that - all the types must be different from each other, in that they must have different types</p>



<a name="153810729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810729">(Nov 20 2015 at 12:51)</a>:</h4>
<p>I could try something like this: </p>



<a name="153810730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810730">(Nov 20 2015 at 12:52)</a>:</h4>
<p>Hmm. I guess I need a passing/failing example to understand what you mean.</p>



<a name="153810731"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810731" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810731">(Nov 20 2015 at 12:52)</a>:</h4>
<p>pass:<br>
  Element xxx.value[x]<br>
    type : boolean<br>
   type : integer</p>



<a name="153810732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810732">(Nov 20 2015 at 12:52)</a>:</h4>
<p>fail:</p>



<a name="153810733"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810733" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810733">(Nov 20 2015 at 12:52)</a>:</h4>
<p>Element xxx.value[x]<br>
  type: boolean<br>
  type: boolean</p>



<a name="153810734"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810734" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810734">(Nov 20 2015 at 12:52)</a>:</h4>
<p>pass:</p>



<a name="153810735"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810735" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810735">(Nov 20 2015 at 12:53)</a>:</h4>
<p>Where does the word "profile" appear in those? (The second argument to <code>distinct(type, profile)</code> in your example path)?</p>



<a name="153810736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810736">(Nov 20 2015 at 12:53)</a>:</h4>
<p>Element xxx.value[x] <br>
  type : Reference, profile = Patient<br>
  type: Reference, profile = Person</p>



<a name="153810737"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810737" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810737">(Nov 20 2015 at 12:53)</a>:</h4>
<p>fil:</p>



<a name="153810738"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810738" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810738">(Nov 20 2015 at 12:53)</a>:</h4>
<p>fail:</p>



<a name="153810739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810739">(Nov 20 2015 at 12:53)</a>:</h4>
<p>Element xxx.value[x] <br>
  type : Reference, profile = Patient<br>
  type: Reference, profile = Patient</p>



<a name="153810740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810740">(Nov 20 2015 at 12:54)</a>:</h4>
<p>Um. I'm just not getting what this operation does. </p>



<a name="153810741"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810741" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810741">(Nov 20 2015 at 12:54)</a>:</h4>
<p>.type() function?</p>



<a name="153810742"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810742" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810742">(Nov 20 2015 at 12:55)</a>:</h4>
<p>No, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> is talking about a simple json property of <code>ElementDefinition</code> whose name just happens to be <code>type</code>. </p>



<a name="153810743"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810743" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810743">(Nov 20 2015 at 12:55)</a>:</h4>
<p>it says that none of the items in the collection can have the same values for set of nominated expressions as any other item in the collection</p>



<a name="153810744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810744">(Nov 20 2015 at 12:56)</a>:</h4>
<p>What does it means to "have.... values for [a]... set of... expressions"?</p>



<a name="153810745"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810745" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810745">(Nov 20 2015 at 12:56)</a>:</h4>
<p>here's my implementation: (in pascal):</p>



<a name="153810746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810746">(Nov 20 2015 at 12:56)</a>:</h4>
<p>Great ;-)</p>



<a name="153810747"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810747" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810747">(Nov 20 2015 at 12:56)</a>:</h4>
<p>var<br>
  table : array of array of TFHIRBaseList;<br>
  i, j : integer;<br>
  base : TFHIRBase;<br>
  distinct : boolean;<br>
begin<br>
  distinct := Context.Count &lt;= 1;<br>
  try<br>
    SetLength(table, context.Count);<br>
    for i := 0 to context.Count - 1 do<br>
    begin<br>
      SetLength(table[i], exp.Parameters.Count);<br>
      base := context[i];<br>
      for j := 0 to exp.Parameters.Count - 1 do<br>
        table[i][j] := evaluate(base, exp.Parameters[j]);<br>
    end;<br>
    for i := 0 to context.Count - 1 do<br>
      for j := i+1 to context.Count - 1 do<br>
        if areDistinct(table[i], table[j]) then<br>
        begin<br>
          distinct := true;<br>
          break;<br>
        end;<br>
  finally<br>
    for i := 0 to context.Count - 1 do<br>
      for j := 0 to exp.Parameters.Count - 1 do<br>
        table[i][j].Free;<br>
  end;<br>
  result := TFHIRBaseList.Create;<br>
  result.Add(TFhirBoolean.Create(distinct));</p>



<a name="153810748"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810748" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810748">(Nov 20 2015 at 12:56)</a>:</h4>
<p>lose the indent... ouch</p>



<a name="153810749"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810749" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810749">(Nov 20 2015 at 12:56)</a>:</h4>
<p>Add ``` before/after your code block for code fomatting</p>



<a name="153810750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810750">(Nov 20 2015 at 12:57)</a>:</h4>
<p>...<br>
function TFHIRPathEvaluator.funcDistinct(resource : TFHIRResource; originalContext, context: TFHIRBaseList; exp: TFHIRPathExpression): TFHIRBaseList;<br>
var<br>
  table : array of array of TFHIRBaseList;<br>
  i, j : integer;<br>
  base : TFHIRBase;<br>
  distinct : boolean;<br>
begin<br>
  distinct := Context.Count &lt;= 1;<br>
  try<br>
    SetLength(table, context.Count);<br>
    for i := 0 to context.Count - 1 do<br>
    begin<br>
      SetLength(table[i], exp.Parameters.Count);<br>
      base := context[i];<br>
      for j := 0 to exp.Parameters.Count - 1 do<br>
        table[i][j] := evaluate(base, exp.Parameters[j]);<br>
    end;<br>
    for i := 0 to context.Count - 1 do<br>
      for j := i+1 to context.Count - 1 do<br>
        if areDistinct(table[i], table[j]) then<br>
        begin<br>
          distinct := true;<br>
          break;<br>
        end;<br>
  finally<br>
    for i := 0 to context.Count - 1 do<br>
      for j := 0 to exp.Parameters.Count - 1 do<br>
        table[i][j].Free;<br>
  end;<br>
  result := TFHIRBaseList.Create;<br>
  result.Add(TFhirBoolean.Create(distinct));<br>
end;<br>
...</p>



<a name="153810751"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810751" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810751">(Nov 20 2015 at 12:57)</a>:</h4>
<p>And do ```pascal at the beginning for syntax highlighting</p>



<a name="153810752"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810752" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810752">(Nov 20 2015 at 12:57)</a>:</h4>
<div class="codehilite"><pre><span class="k">function</span> <span class="nc">TFHIRPathEvaluator</span><span class="o">.</span><span class="nf">funcDistinct</span><span class="p">(</span><span class="n">resource</span> <span class="o">:</span> <span class="n">TFHIRResource</span><span class="o">;</span> <span class="n">originalContext</span><span class="o">,</span> <span class="n">context</span><span class="o">:</span> <span class="n">TFHIRBaseList</span><span class="o">;</span> <span class="nb">exp</span><span class="o">:</span> <span class="n">TFHIRPathExpression</span><span class="p">)</span><span class="o">:</span> <span class="n">TFHIRBaseList</span><span class="o">;</span>
<span class="k">var</span> <span class="n">table</span> <span class="o">:</span> <span class="k">array</span> <span class="k">of</span> <span class="k">array</span> <span class="k">of</span> <span class="n">TFHIRBaseList</span><span class="o">;</span>
<span class="n">i</span><span class="o">,</span> <span class="n">j</span> <span class="o">:</span> <span class="kt">integer</span><span class="o">;</span>
<span class="n">base</span> <span class="o">:</span> <span class="n">TFHIRBase</span><span class="o">;</span>
</pre></div>



<a name="153810753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810753">(Nov 20 2015 at 12:58)</a>:</h4>
<p>do what? </p>



<a name="153810754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810754">(Nov 20 2015 at 12:58)</a>:</h4>
<div class="codehilite"><pre>    ```pascal
   some
   code
   here
   ```
</pre></div>



<a name="153810755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810755">(Nov 20 2015 at 12:58)</a>:</h4>
<div class="codehilite"><pre><span class="k">function</span> <span class="nc">TFHIRPathEvaluator</span><span class="o">.</span><span class="nf">funcDistinct</span><span class="p">(</span><span class="n">resource</span> <span class="o">:</span> <span class="n">TFHIRResource</span><span class="o">;</span> <span class="n">originalContext</span><span class="o">,</span> <span class="n">context</span><span class="o">:</span> <span class="n">TFHIRBaseList</span><span class="o">;</span> <span class="nb">exp</span><span class="o">:</span> <span class="n">TFHIRPathExpression</span><span class="p">)</span><span class="o">:</span> <span class="n">TFHIRBaseList</span><span class="o">;</span>
<span class="k">var</span>
  <span class="n">table</span> <span class="o">:</span> <span class="k">array</span> <span class="k">of</span> <span class="k">array</span> <span class="k">of</span> <span class="n">TFHIRBaseList</span><span class="o">;</span>
  <span class="n">i</span><span class="o">,</span> <span class="n">j</span> <span class="o">:</span> <span class="kt">integer</span><span class="o">;</span>
  <span class="n">base</span> <span class="o">:</span> <span class="n">TFHIRBase</span><span class="o">;</span>
  <span class="n">distinct</span> <span class="o">:</span> <span class="kt">boolean</span><span class="o">;</span>
<span class="k">begin</span>
  <span class="n">distinct</span> <span class="o">:=</span> <span class="n">Context</span><span class="o">.</span><span class="n">Count</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="k">try</span>
    <span class="nb">SetLength</span><span class="p">(</span><span class="n">table</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span><span class="p">)</span><span class="o">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
    <span class="k">begin</span>
      <span class="nb">SetLength</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">,</span> <span class="nb">exp</span><span class="o">.</span><span class="n">Parameters</span><span class="o">.</span><span class="n">Count</span><span class="p">)</span><span class="o">;</span>
      <span class="n">base</span> <span class="o">:=</span> <span class="n">context</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">;</span>
      <span class="k">for</span> <span class="n">j</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nb">exp</span><span class="o">.</span><span class="n">Parameters</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">:=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">base</span><span class="o">,</span> <span class="nb">exp</span><span class="o">.</span><span class="n">Parameters</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">;</span>
    <span class="k">end</span><span class="o">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
      <span class="k">for</span> <span class="n">j</span> <span class="o">:=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">to</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="k">if</span> <span class="n">areDistinct</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">,</span> <span class="n">table</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">then</span>
        <span class="k">begin</span>
          <span class="n">distinct</span> <span class="o">:=</span> <span class="k">true</span><span class="o">;</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="k">end</span><span class="o">;</span>
  <span class="k">finally</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
      <span class="k">for</span> <span class="n">j</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nb">exp</span><span class="o">.</span><span class="n">Parameters</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">Free</span><span class="o">;</span>
  <span class="k">end</span><span class="o">;</span>
  <span class="bp">result</span> <span class="o">:=</span> <span class="n">TFHIRBaseList</span><span class="o">.</span><span class="n">Create</span><span class="o">;</span>
  <span class="bp">result</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">TFhirBoolean</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">distinct</span><span class="p">))</span><span class="o">;</span>
<span class="k">end</span><span class="o">;</span>
</pre></div>



<a name="153810756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810756">(Nov 20 2015 at 12:58)</a>:</h4>
<p>Backticks</p>



<a name="153810757"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810757" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810757">(Nov 20 2015 at 12:58)</a>:</h4>
<p>You can edit your last message :-)</p>



<a name="153810758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810758">(Nov 20 2015 at 12:59)</a>:</h4>
<p>great. and also this: </p>



<a name="153810759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810759">(Nov 20 2015 at 12:59)</a>:</h4>
<div class="codehilite"><pre><span class="k">function</span> <span class="nc">TFHIRPathEvaluator</span><span class="o">.</span><span class="nf">areDistinct</span><span class="p">(</span><span class="n">a1</span><span class="o">,</span> <span class="n">a2</span> <span class="o">:</span> <span class="k">array</span> <span class="k">of</span> <span class="n">TFHIRBaseList</span><span class="p">)</span> <span class="o">:</span> <span class="kt">boolean</span><span class="o">;</span>
<span class="k">var</span>
  <span class="n">i</span> <span class="o">:</span> <span class="kt">integer</span><span class="o">;</span>
  <span class="n">res</span> <span class="o">:</span> <span class="n">TFHIRBaseList</span><span class="o">;</span>
<span class="k">begin</span>
  <span class="bp">result</span> <span class="o">:=</span> <span class="k">false</span><span class="o">;</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nb">length</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
  <span class="k">begin</span>
    <span class="n">res</span> <span class="o">:=</span> <span class="n">opEquals</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">,</span> <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">;</span>
    <span class="k">try</span>
      <span class="k">if</span> <span class="k">not</span> <span class="n">convertToBoolean</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">begin</span>
        <span class="bp">result</span> <span class="o">:=</span> <span class="k">true</span><span class="o">;</span>
        <span class="k">exit</span><span class="o">;</span>
      <span class="k">end</span><span class="o">;</span>
    <span class="k">finally</span>
      <span class="n">res</span><span class="o">.</span><span class="n">Free</span><span class="o">;</span>
    <span class="k">end</span><span class="o">;</span>
  <span class="k">end</span><span class="o">;</span>
<span class="k">end</span><span class="o">;</span>
</pre></div>



<a name="153810760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810760">(Nov 20 2015 at 13:00)</a>:</h4>
<p>does this help?</p>



<a name="153810761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810761">(Nov 20 2015 at 13:03)</a>:</h4>
<p>That helps a ton, in that the code is totally unambiguous :-) (Even if I don't really read Pascal.)</p>



<a name="153810762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810762">(Nov 20 2015 at 13:04)</a>:</h4>
<p>Also, you gotta admit the fact that <code>pygments</code> handles syntax highlighting for pascal is pretty cool.</p>



<a name="153810763"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810763" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810763">(Nov 20 2015 at 13:04)</a>:</h4>
<p>yeah, I figured that piece of pascal wasn't too pascal specific </p>



<a name="153810764"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810764" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810764">(Nov 20 2015 at 13:04)</a>:</h4>
<p>yes, the syntax highlighting is sensational</p>



<a name="153810769"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810769" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810769">(Nov 20 2015 at 13:07)</a>:</h4>
<p>(And a feature not supported by Slack ;-))</p>



<a name="153810770"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810770" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810770">(Nov 20 2015 at 13:08)</a>:</h4>
<p>BTW, @<strong>nicola</strong>'s demo that we'll show is at <a href="https://niquola.github.io/fhirpath-demo" target="_blank" title="https://niquola.github.io/fhirpath-demo">https://niquola.github.io/fhirpath-demo</a></p>



<a name="153810782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810782">(Nov 20 2015 at 13:22)</a>:</h4>
<div class="codehilite"><pre>
</pre></div>



<a name="153810783"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810783" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Agnew <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810783">(Nov 20 2015 at 13:22)</a>:</h4>
<p>oops</p>



<a name="153810838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Email Gateway <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810838">(Nov 20 2015 at 15:01)</a>:</h4>
<p>Just testing e-mail integration with updated cron job.</p>



<a name="153810850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810850">(Nov 20 2015 at 23:41)</a>:</h4>
<p>Published an npm package <a href="https://www.npmjs.com/package/fhirpath.js" target="_blank" title="https://www.npmjs.com/package/fhirpath.js">fhirpath.js</a>  — and a set of <a href="https://github.com/jmandel/fhirpath.js/blob/master/test-case-dump.json" target="_blank" title="https://github.com/jmandel/fhirpath.js/blob/master/test-case-dump.json">test cases</a></p>



<a name="153810852"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810852" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810852">(Nov 21 2015 at 00:22)</a>:</h4>
<ul>
<li>Added support for <code>$context</code>.</li>
<li>And support for custom lookup constants</li>
</ul>



<a name="153810879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153810879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153810879">(Nov 21 2015 at 13:27)</a>:</h4>
<p>need to be specific in the spec that you can't use the characters #13, #10 and #9 in a string literal </p>



<a name="153811108"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811108" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811108">(Nov 24 2015 at 03:02)</a>:</h4>
<p>Josh, are you going to implement FHIR path in XML as well as JSON? </p>



<a name="153811109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811109">(Nov 24 2015 at 03:02)</a>:</h4>
<p>Wasn't planning to; I'd say just convert the XML to JSON first if you want to use <code>fhirpath.js.</code></p>



<a name="153811110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811110">(Nov 24 2015 at 03:02)</a>:</h4>
<p>if you are, there's a gotcha in XML like there is in JSON - the way resources are included at DomainResource.contained and Bundle.entry</p>



<a name="153811111"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811111" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811111">(Nov 24 2015 at 03:03)</a>:</h4>
<p>then you don't need to worry about ti </p>



<a name="153811112"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811112" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811112">(Nov 24 2015 at 03:03)</a>:</h4>
<p>what's the gotcha there? (I do want to understand it, at least :-))</p>



<a name="153811113"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811113" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811113">(Nov 24 2015 at 03:04)</a>:</h4>
<p>well, we have </p>
<div class="codehilite"><pre>  <span class="nt">&lt;contained&gt;</span>
   <span class="err">&lt;</span>[resource]&gt;
   <span class="err">&lt;</span>/resource]&gt;   
 <span class="nt">&lt;/contained&gt;</span>
</pre></div>



<a name="153811114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811114">(Nov 24 2015 at 03:04)</a>:</h4>
<p>The inner element is XML only, and not included in the path statement</p>



<a name="153811115"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811115" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811115">(Nov 24 2015 at 03:19)</a>:</h4>
<p>Sorry, you're saying that in the following:</p>
<div class="codehilite"><pre><span class="nt">&lt;Patient&gt;</span>
  <span class="nt">&lt;contained&gt;</span>
    <span class="nt">&lt;Practitioner&gt;</span>
      <span class="nt">&lt;name&gt;&lt;text&gt;</span>John<span class="nt">&lt;/text&gt;&lt;/name&gt;</span>
    <span class="nt">&lt;/Practitioner&gt;</span>
  <span class="nt">&lt;/contained&gt;</span>
<span class="nt">&lt;/Patient&gt;</span>
</pre></div>


<p>to get "John", I'd evaluate <code>Patient.contained.name</code> instead of <code>Patient.contained.Practitioner.name</code> ?</p>



<a name="153811116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811116">(Nov 24 2015 at 03:20)</a>:</h4>
<p>yes, that's right. </p>



<a name="153811117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811117">(Nov 24 2015 at 03:20)</a>:</h4>
<p>the path needs to be the same for json and xml </p>



<a name="153811118"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811118" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811118">(Nov 24 2015 at 03:22)</a>:</h4>
<p>Agreed on that point, but I'd kind of think that this query is supposed to work with or without the word Practitioner.</p>



<a name="153811119"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811119" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811119">(Nov 24 2015 at 03:22)</a>:</h4>
<p>hah. You might have missed our earlier discussion on that</p>



<a name="153811120"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811120" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811120">(Nov 24 2015 at 03:23)</a>:</h4>
<p>We currently allow Type.path only at the entry point, where it stands as a type filter. We allow that because we do this on 90+% of the paths that we have </p>



<a name="153811121"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811121" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811121">(Nov 24 2015 at 03:23)</a>:</h4>
<p>Sounds like I did. Skype, or here? Was there a short conclusion?</p>



<a name="153811122"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811122" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811122">(Nov 24 2015 at 03:23)</a>:</h4>
<p>Yeah, OK. But it's not really *doing* anything, is what you're saying.</p>



<a name="153811123"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811123" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811123">(Nov 24 2015 at 03:23)</a>:</h4>
<p>I argued that we should allow this internally in the path as well, so you could have Observation.value[x].CodeableConcept.coding </p>



<a name="153811124"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811124" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811124">(Nov 24 2015 at 03:24)</a>:</h4>
<p>but James (mainly) argued back say that was counter-intuitive and also that we already have Observation.valueCodeableConcept </p>



<a name="153811125"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811125" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811125">(Nov 24 2015 at 03:24)</a>:</h4>
<p>Ha, argh. That's even worse than I imagined; at least the resource types manifest explicitly in JSON (unlike data element ntypes)</p>



<a name="153811126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811126">(Nov 24 2015 at 03:24)</a>:</h4>
<p>and even then this path is not the same as that other path </p>



<a name="153811127"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811127" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811127">(Nov 24 2015 at 03:25)</a>:</h4>
<p>so I ended up agreeing with James, and we only allow Type. at the entry point</p>



<a name="153811128"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811128" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811128">(Nov 24 2015 at 03:25)</a>:</h4>
<p>and so  <code>Patient.contained.Practitioner.name</code> is not valid</p>



<a name="153811129"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811129" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811129">(Nov 24 2015 at 03:26)</a>:</h4>
<p>Well, there was a potential middle ground (that Type is allowed at any resource entry point, rather than just the top-level resource entry point).</p>



<a name="153811130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811130">(Nov 24 2015 at 03:26)</a>:</h4>
<p>we didn't discuss that </p>



<a name="153811131"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811131" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811131">(Nov 24 2015 at 03:26)</a>:</h4>
<p>I have no strong feeling except that Observation.value[x].CodeableConcept is an abomination :-)</p>



<a name="153811132"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811132" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811132">(Nov 24 2015 at 03:27)</a>:</h4>
<p>James may have an opinion on the middle ground </p>



<a name="153811133"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811133" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811133">(Nov 24 2015 at 03:27)</a>:</h4>
<p>or others....</p>



<a name="153811134"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811134" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811134">(Nov 24 2015 at 03:27)</a>:</h4>
<p><span class="user-mention" data-user-id="191319">@James Agnew</span> - just seeing how tagging works</p>



<a name="153811135"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811135" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811135">(Nov 24 2015 at 03:28)</a>:</h4>
<p>even given the middle ground, it would still be a special case gotcha</p>



<a name="153811136"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811136" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811136">(Nov 24 2015 at 03:29)</a>:</h4>
<p>but it's good that you only mild feelings about Observation.value[x].CodeableConcept ;-)</p>



<a name="153811206"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811206" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811206">(Nov 25 2015 at 23:49)</a>:</h4>
<p>so Josh, my implementation of distinct was wrong. here's the debugged version:</p>



<a name="153811207"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811207" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811207">(Nov 25 2015 at 23:49)</a>:</h4>
<div class="codehilite"><pre>
</pre></div>



<a name="153811208"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811208" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811208">(Nov 25 2015 at 23:50)</a>:</h4>
<div class="codehilite"><pre><span class="k">function</span> <span class="nc">TFHIRPathEvaluator</span><span class="o">.</span><span class="nf">areDistinct</span><span class="p">(</span><span class="n">a1</span><span class="o">,</span> <span class="n">a2</span> <span class="o">:</span> <span class="k">array</span> <span class="k">of</span> <span class="n">TFHIRBaseList</span><span class="p">)</span> <span class="o">:</span> <span class="kt">boolean</span><span class="o">;</span>
<span class="k">var</span>
  <span class="n">i</span> <span class="o">:</span> <span class="kt">integer</span><span class="o">;</span>
  <span class="n">res</span> <span class="o">:</span> <span class="n">TFHIRBaseList</span><span class="o">;</span>
<span class="k">begin</span>
  <span class="bp">result</span> <span class="o">:=</span> <span class="k">false</span><span class="o">;</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nb">length</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
  <span class="k">begin</span>
    <span class="n">res</span> <span class="o">:=</span> <span class="n">opEquals</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">,</span> <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">;</span>
    <span class="k">try</span>
      <span class="k">if</span> <span class="k">not</span> <span class="n">convertToBoolean</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">begin</span>
        <span class="bp">result</span> <span class="o">:=</span> <span class="k">true</span><span class="o">;</span>
        <span class="k">exit</span><span class="o">;</span>
      <span class="k">end</span><span class="o">;</span>
    <span class="k">finally</span>
      <span class="n">res</span><span class="o">.</span><span class="n">Free</span><span class="o">;</span>
    <span class="k">end</span><span class="o">;</span>
  <span class="k">end</span><span class="o">;</span>
<span class="k">end</span><span class="o">;</span>

<span class="k">function</span> <span class="nc">TFHIRPathEvaluator</span><span class="o">.</span><span class="nf">funcDistinct</span><span class="p">(</span><span class="n">ctxt</span> <span class="o">:</span> <span class="n">TFHIRPathExecutionContext</span><span class="o">;</span> <span class="n">context</span><span class="o">:</span> <span class="n">TFHIRBaseList</span><span class="o">;</span> <span class="nb">exp</span><span class="o">:</span> <span class="n">TFHIRExpressionNode</span><span class="p">)</span><span class="o">:</span> <span class="n">TFHIRBaseList</span><span class="o">;</span>
<span class="k">var</span>
  <span class="n">table</span> <span class="o">:</span> <span class="k">array</span> <span class="k">of</span> <span class="k">array</span> <span class="k">of</span> <span class="n">TFHIRBaseList</span><span class="o">;</span>
  <span class="n">i</span><span class="o">,</span> <span class="n">j</span> <span class="o">:</span> <span class="kt">integer</span><span class="o">;</span>
  <span class="n">base</span> <span class="o">:</span> <span class="n">TFHIRBase</span><span class="o">;</span>
  <span class="n">distinct</span> <span class="o">:</span> <span class="kt">boolean</span><span class="o">;</span>
<span class="k">begin</span>
  <span class="n">distinct</span> <span class="o">:=</span> <span class="n">Context</span><span class="o">.</span><span class="n">Count</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="k">try</span>
    <span class="nb">SetLength</span><span class="p">(</span><span class="n">table</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span><span class="p">)</span><span class="o">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
    <span class="k">begin</span>
      <span class="nb">SetLength</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">,</span> <span class="nb">exp</span><span class="o">.</span><span class="n">Parameters</span><span class="o">.</span><span class="n">Count</span><span class="p">)</span><span class="o">;</span>
      <span class="n">base</span> <span class="o">:=</span> <span class="n">context</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">;</span>
      <span class="k">for</span> <span class="n">j</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nb">exp</span><span class="o">.</span><span class="n">Parameters</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">:=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">ctxt</span><span class="o">,</span> <span class="n">base</span><span class="o">,</span> <span class="nb">exp</span><span class="o">.</span><span class="n">Parameters</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">;</span>
    <span class="k">end</span><span class="o">;</span>
    <span class="n">distinct</span> <span class="o">:=</span> <span class="k">true</span><span class="o">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
      <span class="k">for</span> <span class="n">j</span> <span class="o">:=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">to</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="k">if</span> <span class="k">not</span> <span class="n">areDistinct</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">,</span> <span class="n">table</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">then</span>
        <span class="k">begin</span>
          <span class="n">distinct</span> <span class="o">:=</span> <span class="k">false</span><span class="o">;</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="k">end</span><span class="o">;</span>
  <span class="k">finally</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">context</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
      <span class="k">for</span> <span class="n">j</span> <span class="o">:=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nb">exp</span><span class="o">.</span><span class="n">Parameters</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">Free</span><span class="o">;</span>
  <span class="k">end</span><span class="o">;</span>
  <span class="bp">result</span> <span class="o">:=</span> <span class="n">TFHIRBaseList</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">TFhirBoolean</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">distinct</span><span class="p">))</span><span class="o">;</span>
<span class="k">end</span><span class="o">;</span>
</pre></div>



<a name="153811212"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811212" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811212">(Nov 26 2015 at 05:45)</a>:</h4>
<p>Can you clarify what the error was, and whether <a href="http://niquola.github.io/fhirpath-demo/#/" target="_blank" title="http://niquola.github.io/fhirpath-demo/#/">niquola.github.io/fhirpath-demo/#/</a> is susceptible?</p>



<a name="153811213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811213">(Nov 26 2015 at 06:39)</a>:</h4>
<p>The error was that I returned true if any of them were differentiable, not all of them </p>



<a name="153811214"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811214" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811214">(Nov 26 2015 at 06:39)</a>:</h4>
<p>looks like your implementation is right to me </p>



<a name="153811218"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811218" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811218">(Nov 26 2015 at 12:12)</a>:</h4>
<p>Gotcha - thanks!</p>



<a name="153811271"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811271" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811271">(Nov 28 2015 at 04:53)</a>:</h4>
<p>Is it worth translating FHIR path expressions to Javascript equivalents?</p>



<a name="153811272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811272">(Nov 28 2015 at 13:41)</a>:</h4>
<p>Can you give an example of what you mean? I mean, for a vaguely complicated one? Is the idea that you want to return something human-readable, or something  <code>eval</code>-able? If the latter, why not just return the whole library in a self-evaluating function, with the input already bound?</p>



<a name="153811273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811273">(Nov 28 2015 at 14:14)</a>:</h4>
<p>i think I mean the second - just generate a javascript function that returns the output if the query</p>



<a name="153811274"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811274" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811274">(Nov 28 2015 at 14:15)</a>:</h4>
<p>OK -- and the function could be huge? What would you do with said function (i.e. why would you use it instead of just calling the fhirpath evaluator)?</p>



<a name="153811275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811275">(Nov 28 2015 at 14:15)</a>:</h4>
<p>well, it could be several sub-functions, and a small library too. </p>



<a name="153811276"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811276" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811276">(Nov 28 2015 at 14:16)</a>:</h4>
<p>A pattern for this in JS would be just:</p>
<div class="codehilite"><pre><span class="kd">function</span> <span class="nx">withExpression</span><span class="p">(</span><span class="nx">expr</span><span class="p">){</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">fhirpath</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">target</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>(Note:  this may reverse the order of args from what my actual library expects.)</p>



<a name="153811277"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811277" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811277">(Nov 28 2015 at 14:16)</a>:</h4>
<p>and your second question is the on I am asking myself - is it better?</p>



<a name="153811278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811278">(Nov 28 2015 at 14:16)</a>:</h4>
<p>So you can pre-bind the expression and get a function you can run against any target.</p>



<a name="153811279"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811279" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811279">(Nov 28 2015 at 14:17)</a>:</h4>
<p>well, not against any target,  I think. I would have to generate for specific target  - e.g. a function might look different run against a patient instead of a practitioner</p>



<a name="153811280"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811280" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811280">(Nov 28 2015 at 14:17)</a>:</h4>
<p>By "target" I meant a specific resource (i.e. not "Patient", but a specific patient resource)</p>



<a name="153811281"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811281" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811281">(Nov 28 2015 at 14:17)</a>:</h4>
<p>sure. that would be the idea. </p>



<a name="153811282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811282">(Nov 28 2015 at 14:17)</a>:</h4>
<p>Currently the evaluator takes a path and a target as inputs.</p>



<a name="153811283"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811283" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811283">(Nov 28 2015 at 14:18)</a>:</h4>
<p>I think you're saying you want a function that just takes a target, and has the path baked-in.</p>



<a name="153811284"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811284" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811284">(Nov 28 2015 at 14:18)</a>:</h4>
<p>but if you have a javascript evaulator, is pre-generating code instead better for some kind of conditions? </p>



<a name="153811285"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811285" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811285">(Nov 28 2015 at 14:18)</a>:</h4>
<p>The snippet above shows you how to do this.</p>



<a name="153811286"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811286" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811286">(Nov 28 2015 at 14:18)</a>:</h4>
<p>I mean, really optimized code maybe. But it sounds like you're trying to solve a performance problem.</p>



<a name="153811287"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811287" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811287">(Nov 28 2015 at 14:19)</a>:</h4>
<p>There are lots of thing we could do to just make the evlauator faster.</p>



<a name="153811288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811288">(Nov 28 2015 at 14:19)</a>:</h4>
<p>(Like starting from a bunch of hard test cases and profiling it, for a start.)</p>



<a name="153811289"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811289" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811289">(Nov 28 2015 at 14:19)</a>:</h4>
<p>if really optimised code is the only reason that would be better, it wouldn't be worth doing</p>



<a name="153811290"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811290" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811290">(Nov 28 2015 at 14:20)</a>:</h4>
<p>I had planned to do it prior to you writing the evaluator, but now I'm thinking it would be a waste of time</p>



<a name="153811291"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811291" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811291">(Nov 28 2015 at 14:29)</a>:</h4>
<p>Fair enough -- sounds like, effectively, a different style for writing an evaluator.</p>



<a name="153811292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811292">(Nov 28 2015 at 21:31)</a>:</h4>
<p>do we need to be explicit that '=' is not pointer based but property based?</p>



<a name="153811293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811293">(Nov 28 2015 at 21:47)</a>:</h4>
<p>but are these different: </p>
<p>&lt;code id="1"&gt;<br>
  &lt;system value="http://loinc.org"/&gt;<br>
  &lt;code value="23"/&gt;<br>
&lt;/code&gt;</p>
<p>&lt;code id="2"&gt;<br>
  &lt;system value="http://loinc.org"/&gt;<br>
  &lt;code value="23"/&gt;<br>
&lt;/code&gt;</p>



<a name="153811294"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811294" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811294">(Nov 28 2015 at 21:47)</a>:</h4>
<p>?</p>



<a name="153811295"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811295" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811295">(Nov 28 2015 at 22:05)</a>:</h4>
<p>I'd like to say they're the same. Otherwise the language is going to get heavy/hard-to-use for dealing with special cases.</p>



<a name="153811296"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811296" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811296">(Nov 29 2015 at 00:14)</a>:</h4>
<p>I'd like them to be the same, but on what grounds do you exempt things from the equality test? I guess, tad things that are format specific, and not described in the logical model. I'll update the documentation accordingly </p>



<a name="153811297"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811297" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811297">(Nov 29 2015 at 00:17)</a>:</h4>
<p>Except that id is described explicitly </p>



<a name="153811298"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811298" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811298">(Nov 29 2015 at 00:39)</a>:</h4>
<p>And what about resources? Are 2 resources with the same content and different ids equal? I think not</p>



<a name="153811299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811299">(Nov 29 2015 at 11:04)</a>:</h4>
<p>I'm just finishing off my Fhir path implementation - been working on it all week. I've been fixing my implementation, the Fhir path statements, the invariants, and the example resources</p>



<a name="153811300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811300">(Nov 29 2015 at 11:06)</a>:</h4>
<p>What would be really really nice would be to able to indicate in the Fhir path expression a particular test to inject into the error message</p>



<a name="153811301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811301">(Nov 29 2015 at 11:06)</a>:</h4>
<p>It's kind of hard to describe, and it wouldn't always be possible, but sometimes it would save such a lot of debugging - and I can debug. Lots of people wouldn't be</p>



<a name="153811302"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811302" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811302">(Nov 29 2015 at 11:07)</a>:</h4>
<p>Maybe a .log()? Or appending ^ to an operation?</p>



<a name="153811303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811303">(Nov 29 2015 at 11:08)</a>:</h4>
<p>I'm down to 135 errors...</p>



<a name="153811321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811321">(Nov 30 2015 at 15:25)</a>:</h4>
<blockquote>
<p>Is it worth translating FHIR path expressions to Javascript equivalents?</p>
</blockquote>
<p>I am doing this in the .NET implementation.  But there, I'd need to find a plausible name for the "." operation --&gt; moving to a child. So, "Patient.name.where().count()" would now turn into   context.Children("name").Where(p=&gt;p.some condition).Count()</p>



<a name="153811322"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811322" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811322">(Nov 30 2015 at 15:26)</a>:</h4>
<blockquote>
<p>So you can pre-bind the expression and get a function you can run against any target.</p>
</blockquote>
<p>And the .NET parses a FhirPath expression and turns it into a function that you can use to run that expression against an instance. So, in fact you'd get a pre-compiled evaluator based on that expression.  Under the hood, it dynamically creates a function that does the calls as I showed above.</p>



<a name="153811329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811329">(Dec 01 2015 at 03:03)</a>:</h4>
<p>well, is that based on raw JSON, or on yhe .net object model? </p>



<a name="153811331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811331">(Dec 01 2015 at 08:21)</a>:</h4>
<p>It's built on top of an abstract model representing "FHIR data", which is mostly nested dictionaries, except that elements may repeat</p>



<a name="153811333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811333">(Dec 01 2015 at 12:25)</a>:</h4>
<p>so you can run javascript against that? is this using the dotnet javascript infrastructure? why not just generate C#?</p>



<a name="153811422"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811422" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811422">(Dec 03 2015 at 19:22)</a>:</h4>
<p>Sorry, missed this reply!  No, it's all .NET based, so there's a .NET parser for FhirPath which produces a dynamically created function that is the parser, which you can repeatedly call without having to parse again.  But it runs against an abstract model of nested dictionaries, not against json or xml per se.</p>



<a name="153811642"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811642" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811642">(Dec 22 2015 at 10:46)</a>:</h4>
<p>If I do  Patient.name.substring(2,4)  (instead of Patient.name.text.substring()), what will your FhirPath evaluators do?</p>



<a name="153811643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811643">(Dec 22 2015 at 10:49)</a>:</h4>
<p>And, presuming my names look like integers, will Patient.name.text.asInteger() produce an array or integers?  What if one of my names is not parseable as an integer?</p>



<a name="153811644"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811644" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811644">(Dec 22 2015 at 10:54)</a>:</h4>
<p>"This means that Patient.telecom.system = 'phone' will return an empty collection if there is more than one telecom with a use". Since the "==" operator returns a boolean, I assume it is supposed to say "it returns False if there is more than one telecom with a use" ?</p>



<a name="153811645"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811645" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811645">(Dec 22 2015 at 10:58)</a>:</h4>
<p>Or do the operations return a collection?  E.g. the "==" returns a collection with { True } as the single element?  In which case this is valid:<br>
(Patient.name.use == 'official').count() ?</p>



<a name="153811646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811646">(Dec 22 2015 at 10:59)</a>:</h4>
<p>Patient.name.substring(2,4) would be an empty collection </p>



<a name="153811647"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811647" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811647">(Dec 22 2015 at 11:00)</a>:</h4>
<p>"* this and the other 3 order related operations can only be used for strings, codes, integers, and decimals"  I don't think "code" is a type in FhirPath....It also means the comparison operations cannot be used on dates?</p>



<a name="153811648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811648">(Dec 22 2015 at 11:01)</a>:</h4>
<p>we could remove code from that list - I wrote that before I sorted out the base types </p>



<a name="153811649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811649">(Dec 22 2015 at 11:01)</a>:</h4>
<p>I avoided oprations on dates, since they're so tricky. A yagni thing...</p>



<a name="153811650"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811650" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811650">(Dec 22 2015 at 11:02)</a>:</h4>
<p>asInteger for me only returns an integer on a single string. else it will be an empty collection</p>



<a name="153811651"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811651" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811651">(Dec 22 2015 at 11:03)</a>:</h4>
<p>yes Patient.telecom.system = 'phone'  should be false not empty collection </p>



<a name="153811652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811652">(Dec 22 2015 at 11:03)</a>:</h4>
<p>I have operations returning a collection with a single value. it's usually a boolean </p>



<a name="153811653"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811653" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811653">(Dec 22 2015 at 11:03)</a>:</h4>
<p>case op of<br>
    poEquals: result := TAdvStringSet.Create('boolean');<br>
    poEquivalent: result := TAdvStringSet.Create('boolean');<br>
    poNotEquals: result := TAdvStringSet.Create('boolean');<br>
    poNotEquivalent: result := TAdvStringSet.Create('boolean');<br>
    poLessThen: result := TAdvStringSet.Create('boolean');<br>
    poGreater: result := TAdvStringSet.Create('boolean');<br>
    poLessOrEqual: result := TAdvStringSet.Create('boolean');<br>
    poGreaterOrEqual: result := TAdvStringSet.Create('boolean');<br>
    poIn: result := TAdvStringSet.Create('boolean');<br>
    poPlus: result := TAdvStringSet.Create('string');<br>
    poMinus: result := TAdvStringSet.Create('string');<br>
    poConcatenate: result := TAdvStringSet.Create('boolean');<br>
    poOr: result := TAdvStringSet.Create('boolean');<br>
    poAnd: result := TAdvStringSet.Create('boolean');<br>
    poXor: result := TAdvStringSet.Create('boolean');<br>
    poImplies: result := TAdvStringSet.Create('boolean');<br>
    poUnion: result := TAdvStringSet.Create(left, right);<br>
  else<br>
    raise Exception.Create('not done yet');<br>
  end;</p>



<a name="153811654"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811654" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811654">(Dec 22 2015 at 11:06)</a>:</h4>
<p>technically this is valid : (Patient.name.use == 'official').count() ? - return value will be always be one </p>



<a name="153811655"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811655" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811655">(Dec 22 2015 at 11:07)</a>:</h4>
<p>What I find confusing is that we use the term "collection" in the FhirPath spec.  Json has a collection, but Xml does not. And we have not described a "logical" FHIR model so far.  So, since every operation returns "a collection of Elements of various types", saying that the behaviour for "==" depends on the fact that something is a "collection" ("comparison is order dependent") does not sound right.  I think the text should say: "If == operates on collections with more than one element, order is significant" ?</p>



<a name="153811656"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811656" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811656">(Dec 22 2015 at 11:07)</a>:</h4>
<p>I am assuming "a collection" means "a list of elements matching the expression so far"</p>



<a name="153811657"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811657" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811657">(Dec 22 2015 at 11:08)</a>:</h4>
<p>xml has a logical collection </p>



<a name="153811658"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811658" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811658">(Dec 22 2015 at 11:08)</a>:</h4>
<p>and your assumption is correct </p>



<a name="153811659"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811659" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811659">(Dec 22 2015 at 11:08)</a>:</h4>
<p>Sure, but <a href="http://Patient.name" target="_blank" title="http://Patient.name">Patient.name</a> returns "a collection of name elements", not a single name which is a collection!</p>



<a name="153811660"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811660" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811660">(Dec 22 2015 at 11:09)</a>:</h4>
<blockquote>
<p>and your assumption is correct<br>
Great.</p>
</blockquote>
<p>So, maybe I should go through the spec for FhirPath and make sure that everywhere we say "collection" we mean the resultset, and not "a repeating element" ?</p>



<a name="153811661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811661">(Dec 22 2015 at 11:13)</a>:</h4>
<p>well, umm, ok. I guess I don't find any confusion here, so it seems like a backwards step to me </p>



<a name="153811662"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811662" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811662">(Dec 22 2015 at 11:14)</a>:</h4>
<p>because I don't know what this means: "a collection of name elements", not a single name which is a collection!</p>



<a name="153811663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811663">(Dec 22 2015 at 11:15)</a>:</h4>
<p>I also have the feeling the spec makes a subtle distinction between selecting something that originates in an Element, and something that does not.  E.g. If I'd execute   myPatient.Evaluate("<a href="http://Patient.name" target="_blank" title="http://Patient.name">Patient.name</a>"), I would get back a collection of Elements, which trace back to the original elements in the POCO "myPatient". But if I do, e.g. substring() on a collection, I'd get a set of strings that have no origin in the original data, so cannot be used to select elements from the POCO.   Is FhirPath supposed to make this possible?</p>



<a name="153811664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811664">(Dec 22 2015 at 11:21)</a>:</h4>
<blockquote>
<p>"All elements in a collection will always have a FHIR type" </p>
</blockquote>
<p>Are we saying FhirPath is always evaluated against a typed model? Is that really necessary?  This means we need the full StructureDefinition parser machinery to evaluate FhirPath?  Or always evaluate it against an in-memory POCO that has type information? I think we should not do that! </p>



<a name="153811665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811665">(Dec 22 2015 at 11:21)</a>:</h4>
<p>I don't understand either of these either </p>



<a name="153811666"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811666" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811666">(Dec 22 2015 at 11:22)</a>:</h4>
<p>the execution operates against an object model, and the outcomes are always objects </p>



<a name="153811667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811667">(Dec 22 2015 at 11:22)</a>:</h4>
<p>some queries will return you objects that are also in the original object graph, and some will return new objects. I care about this when presenting outcomes, for instance, but it makes no difference to the evaluation engine</p>



<a name="153811668"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811668" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811668">(Dec 22 2015 at 11:23)</a>:</h4>
<p>Why would that be?  You mean high-performance evaluators need to read all instance data into an object model first? </p>



<a name="153811669"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811669" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811669">(Dec 22 2015 at 11:23)</a>:</h4>
<p>again, I don't know what you mean</p>



<a name="153811670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811670">(Dec 22 2015 at 11:24)</a>:</h4>
<p>you do need some type information to execute properly, yes</p>



<a name="153811671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811671">(Dec 22 2015 at 11:24)</a>:</h4>
<p>I am not building the .NET FhirPath evaluator against the .NET POCO model, since why would you read data into a POCO if you just want to validate it against FhirPath rules?</p>



<a name="153811672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811672">(Dec 22 2015 at 11:24)</a>:</h4>
<p>And also, doing reflection on a POCO is slow.</p>



<a name="153811673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811673">(Dec 22 2015 at 11:24)</a>:</h4>
<p>I think you're doing it wrong. I'll tell you why</p>



<a name="153811674"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811674" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811674">(Dec 22 2015 at 11:25)</a>:</h4>
<p>your users will mostly use FHIRPath against POCO models. </p>



<a name="153811675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811675">(Dec 22 2015 at 11:25)</a>:</h4>
<p>it's only validation where you think ohterwise, and that's a special case that's not the general case </p>



<a name="153811676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811676">(Dec 22 2015 at 11:25)</a>:</h4>
<p>here's how my engines work: </p>



<a name="153811677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811677">(Dec 22 2015 at 11:25)</a>:</h4>
<p>- they don't know anything about FHIR types. They operate on collections of FHIR base</p>



<a name="153811678"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811678" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811678">(Dec 22 2015 at 11:25)</a>:</h4>
<p>Base object</p>



<a name="153811679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811679">(Dec 22 2015 at 11:26)</a>:</h4>
<p>which comes fom the POCO</p>



<a name="153811680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811680">(Dec 22 2015 at 11:26)</a>:</h4>
<p>POJO for me</p>



<a name="153811681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811681">(Dec 22 2015 at 11:26)</a>:</h4>
<p>I have a method for asking the base object for the value of a property</p>



<a name="153811682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811682">(Dec 22 2015 at 11:27)</a>:</h4>
<p>there's two instantiations of that - one that uses the built in POJO property accessor, and one that users the validation framework</p>



<a name="153811683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811683">(Dec 22 2015 at 11:27)</a>:</h4>
<p>if reflection is slow, generate something faster. </p>



<a name="153811684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811684">(Dec 22 2015 at 11:27)</a>:</h4>
<p>that's not magic, and that's what I do for pascal and java - has heaps of uses, being able to iterate the properties</p>



<a name="153811685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811685">(Dec 22 2015 at 11:28)</a>:</h4>
<p>there's also a method for asking a base type what the type of a property is, but you only need that if you want to check type safety</p>



<a name="153811686"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811686" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811686">(Dec 22 2015 at 11:29)</a>:</h4>
<p>I don't think we should let the design of FhirPath be influenced on how WE or you generate stuff.  Unless we REALLY REALLY need typed information in FhirPath we should avoid it.  Where do we need type info in FhirPath?</p>



<a name="153811687"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811687" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811687">(Dec 22 2015 at 11:29)</a>:</h4>
<p>the design of it is not influenced by how you generate stuff. </p>



<a name="153811688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811688">(Dec 22 2015 at 11:30)</a>:</h4>
<p>here's where I use the type information </p>



<a name="153811689"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811689" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811689">(Dec 22 2015 at 11:31)</a>:</h4>
<p>Well, yes, you are assuming you have type information around in a efficent way.  Which I *might* include in my implementation if necessary, but it comes at a cost.</p>



<a name="153811690"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811690" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811690">(Dec 22 2015 at 11:31)</a>:</h4>
<p>we say that if the context is Observation, you can do either code.xx or Observation.code.xx</p>



<a name="153811691"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811691" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811691">(Dec 22 2015 at 11:32)</a>:</h4>
<p>I need type information here to allow me to safely ignore the Observation. bit</p>



<a name="153811692"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811692" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811692">(Dec 22 2015 at 11:32)</a>:</h4>
<p>I need type information when checking type safety, but you don't need to do that</p>



<a name="153811693"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811693" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811693">(Dec 22 2015 at 11:33)</a>:</h4>
<p>I need to be able to list all the children or descendents of an object. I use property iterators to do that. that may or may not be type information, depending on your context</p>



<a name="153811694"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811694" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811694">(Dec 22 2015 at 11:33)</a>:</h4>
<p>or I get a property by name. however that happens; that's an interface for me</p>



<a name="153811695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811695">(Dec 22 2015 at 11:38)</a>:</h4>
<p>So, if that's the list, having a type around is optional. Which is fine, it matches my usecase. In fact, I now parse xml/json data to a tree-representation. I can "parse" POCO's to the same tree-representation.  Then, I can "annotate" this tree with type information from a StructureDefinition  (when it was parsed from a POCO, I don't need to do this -&gt; the information is present in the POCO model).  So, my tree (on which the FhirPath executes) *may* have type information to give better validation or warnings.  In any case, I don't think that so far we should require having types in FhirPath.</p>



<a name="153811696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811696">(Dec 22 2015 at 11:40)</a>:</h4>
<p>I got into this when reading about "datetime", which is sometimes mentioned as a type and sometimes it is not.  The constant &lt;2015&gt; in a FhirPath expression can currently be both an integer and a datetime I guess, which is what triggered this. Certainly after reading: "The evaluation engine will automatically elevate constants to the right FHIR type.".....  I am saying we should not put this in the spec.</p>



<a name="153811697"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811697" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811697">(Dec 22 2015 at 11:41)</a>:</h4>
<p>(Xpath1 worked perfectly without typed information, and we won't try to go where xpath2 went...)</p>



<a name="153811698"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811698" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811698">(Dec 22 2015 at 11:41)</a>:</h4>
<p>I don't see how we can not put it in the spec, and xpath certainly does have types at the primitive level</p>



<a name="153811699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811699">(Dec 22 2015 at 11:42)</a>:</h4>
<p>where's the spec again? </p>



<a name="153811700"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811700" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811700">(Dec 22 2015 at 11:43)</a>:</h4>
<p>there's no date type </p>



<a name="153811701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811701">(Dec 22 2015 at 11:43)</a>:</h4>
<p>I don't see how those base types are ambiguous or problematic</p>



<a name="153811702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811702">(Dec 22 2015 at 11:46)</a>:</h4>
<p>there's one other place I need type information - I need to know whether the object is a primitive or not, and which of the base data types it maps to</p>



<a name="153811703"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811703" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811703">(Dec 22 2015 at 11:46)</a>:</h4>
<p>that's fine on the JSON implementation, but needs type information on xml...</p>



<a name="153811704"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811704" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811704">(Dec 22 2015 at 11:47)</a>:</h4>
<blockquote>
<p>There are only 5 basic types in FHIRPath: boolean, string, integer, decimal, and datetime</p>
</blockquote>



<a name="153811705"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811705" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811705">(Dec 22 2015 at 11:47)</a>:</h4>
<blockquote>
<p>xpath certainly does have types at the primitive level</p>
</blockquote>
<p>Sure, and we can keep that, since I can derive that (just like xpath) from the notation of the constants in an expression</p>



<a name="153811706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811706">(Dec 22 2015 at 11:48)</a>:</h4>
<p>And "datetime" can just be a year so, you can have confusion between a datetime just being the year and an int..</p>



<a name="153811707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811707">(Dec 22 2015 at 11:49)</a>:</h4>
<p>hm I read the wrong list. ok, there is ambiguity with regard to a year only. Its' going to be an integer. tough </p>



<a name="153811708"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811708" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811708">(Dec 22 2015 at 12:00)</a>:</h4>
<p>Maybe we should have an explicit syntax for datetime, e.g. #2015#</p>



<a name="153811709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811709">(Dec 22 2015 at 12:01)</a>:</h4>
<p>Anyway, I am updating the document to reflect some of our discussion....(not the requirements on typeinfo, though ;-)</p>



<a name="153811710"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811710" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811710">(Dec 22 2015 at 12:04)</a>:</h4>
<p>well, we don't even say whether date time is a string or not </p>



<a name="153811711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811711">(Dec 22 2015 at 12:04)</a>:</h4>
<blockquote>
<p>if the right collection is a URI, and it refers to a value set, value set membership testing will be performed</p>
</blockquote>
<p>I think we'd better define an explicit operation for this, instead of overloading the IN operation...</p>



<a name="153811712"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811712" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811712">(Dec 22 2015 at 12:04)</a>:</h4>
<p>No, we don't say that. We do say all primitives have a string representation.</p>



<a name="153811713"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811713" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811713">(Dec 22 2015 at 12:05)</a>:</h4>
<p>E.g. the length() operation is dependent on this</p>



<a name="153811714"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811714" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811714">(Dec 22 2015 at 12:05)</a>:</h4>
<p>yes it's in those that I need to know whether there's a primitive to evaluate on </p>



<a name="153811715"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811715" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811715">(Dec 22 2015 at 12:09)</a>:</h4>
<p>I have updated some of the text of the FhirPath spec to be more elaborate about where we return collections and what asInteger and substring() do when they are executed on a collection with multiple values.</p>



<a name="153811716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811716">(Dec 22 2015 at 12:11)</a>:</h4>
<p>I wonder whether Josh/Nikolai have type information...I think they are parsing the json, so they recognize the basic json types, no more...</p>



<a name="153811717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811717">(Dec 22 2015 at 12:11)</a>:</h4>
<p>right, They probably haven't run into the date issue. which I haven't either, actually </p>



<a name="153811718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811718">(Dec 22 2015 at 12:12)</a>:</h4>
<p>and they would need special logic for the Observation. thing</p>



<a name="153811719"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811719" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811719">(Dec 22 2015 at 12:14)</a>:</h4>
<p>Ah! The fun of actually implementing what we've written....as usual that's when things come up...</p>



<a name="153811720"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811720" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811720">(Dec 22 2015 at 12:16)</a>:</h4>
<p>well, I'll spend some time tomorrow looking into the date question</p>



<a name="153811735"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811735" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811735">(Dec 23 2015 at 11:55)</a>:</h4>
<p>What's the desired behaviour for Patient.name.use.something?  An empty set, or an error that "use" does not have children to select?</p>



<a name="153811736"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811736" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811736">(Dec 23 2015 at 12:10)</a>:</h4>
<p>empty set</p>



<a name="153811737"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811737" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811737">(Dec 23 2015 at 12:11)</a>:</h4>
<p>I will make a compile error</p>



<a name="153811833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811833">(Jan 04 2016 at 14:21)</a>:</h4>
<p>What's the behaviour of your fhirpath evaluator when you try to "+" collections with &gt; 1 element or incompatible types?</p>



<a name="153811835"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811835" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811835">(Jan 05 2016 at 15:59)</a>:</h4>
<p>... empty collection?</p>



<a name="153811836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811836">(Jan 05 2016 at 19:53)</a>:</h4>
<p>yes, empty collection</p>



<a name="153811854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811854">(Jan 06 2016 at 07:44)</a>:</h4>
<p>Our grammar only has a notation for "decimal", but our type system distinguishes intergers and decimals. So does the evaluation of .valueQuantity.value = 4 (comparing decimal and integer?) differ from .valueQuantity.value = 4.0? Are both regarded as comparisons between decimals?  And for .multipleBirthInteger = 4 and 4.0?  Are you using the type of the (Typed) element to cast the constant to the right type?</p>



<a name="153811855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811855">(Jan 06 2016 at 07:49)</a>:</h4>
<p>What's the difference between "aadf" + "qewr" and "aadf" &amp; "qewr" ?</p>



<a name="153811856"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811856" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811856">(Jan 06 2016 at 09:01)</a>:</h4>
<p>there's no difference, but it might ne redudant. I added + and &amp; before we really had control over primitives</p>



<a name="153811857"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811857" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811857">(Jan 06 2016 at 09:01)</a>:</h4>
<p>so maybe it isn't needed now? </p>



<a name="153811858"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811858" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811858">(Jan 06 2016 at 09:01)</a>:</h4>
<p>decimal and integer - I don't think the difference matters anywhere?</p>



<a name="153811859"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811859" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811859">(Jan 06 2016 at 09:02)</a>:</h4>
<p>Well, we explicitly mention the two as separate types in FhirPath, so if it doesn't matter, should we remove "integer" as a separate type and just have "decimal" ?</p>



<a name="153811860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811860">(Jan 06 2016 at 09:03)</a>:</h4>
<p>Or does that introduce problems with the comparison operators?</p>



<a name="153811861"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811861" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811861">(Jan 06 2016 at 09:03)</a>:</h4>
<p>it might. </p>



<a name="153811862"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811862" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811862">(Jan 06 2016 at 09:03)</a>:</h4>
<p>integers are decimals with fixed precision </p>



<a name="153811863"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811863" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811863">(Jan 06 2016 at 09:03)</a>:</h4>
<p>I'm busy today and tomorrow. I'll review this on the plane - is that ok?</p>



<a name="153811864"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811864" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811864">(Jan 06 2016 at 09:04)</a>:</h4>
<p>tomorrow is a big day - oldest daughter's 18th birthday </p>



<a name="153811865"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811865" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811865">(Jan 06 2016 at 09:04)</a>:</h4>
<p>Of course. No hurry.</p>



<a name="153811866"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811866" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811866">(Jan 06 2016 at 09:04)</a>:</h4>
<p>So, I take it you are on a plane back home ;-)</p>



<a name="153811867"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811867" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811867">(Jan 06 2016 at 09:04)</a>:</h4>
<p>a few formalities to go through </p>



<a name="153811868"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811868" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811868">(Jan 06 2016 at 09:04)</a>:</h4>
<p>dirvers license!</p>



<a name="153811869"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811869" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811869">(Jan 06 2016 at 09:05)</a>:</h4>
<p>no, I'm home, been home for a few weeks</p>



<a name="153811870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811870">(Jan 06 2016 at 09:05)</a>:</h4>
<p>leave in 36 hrs</p>



<a name="153811871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811871">(Jan 06 2016 at 09:05)</a>:</h4>
<p>That's ok. I have a few more suggestions to talk through now I have almost fully implemented fhirpath on .net...</p>



<a name="153811872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811872">(Jan 06 2016 at 09:06)</a>:</h4>
<p>ok</p>



<a name="153811873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811873">(Jan 06 2016 at 09:43)</a>:</h4>
<p>Our grammar currently also allows 4 &gt; 5 &lt;= 6.  I think that's an oversight...</p>



<a name="153811874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811874">(Jan 06 2016 at 10:58)</a>:</h4>
<p>how does it allow that?</p>



<a name="153811875"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811875" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811875">(Jan 06 2016 at 11:34)</a>:</h4>
<p>expression  = term (righthand)*<br>
righthand   = op term | "." function</p>
<p>term op term op term op term, where op also includes = etc.</p>



<a name="153811877"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811877" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811877">(Jan 06 2016 at 18:44)</a>:</h4>
<p>yes I suppose it does. Is it a problem that you can string together some non-sensical operations? we'll complicate the grammar immensiely if we try to make it explicit which operations are allowed in sequence or not</p>



<a name="153811878"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811878" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811878">(Jan 06 2016 at 19:29)</a>:</h4>
<p>ACtually, no.  It's just that the expression turns into a boolean, like  5 &gt; 6 = true != false (left associative)</p>



<a name="153811879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811879">(Jan 06 2016 at 19:29)</a>:</h4>
<p>yes there's lots of valid uses</p>



<a name="153811880"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811880" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811880">(Jan 06 2016 at 20:58)</a>:</h4>
<p>What about  Patient.identifier.where(use = 'official') = Patient.identifier.skip(1) ? </p>



<a name="153811881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811881">(Jan 06 2016 at 20:59)</a>:</h4>
<p>Can you 'restart' the context to Patient like this?  Or you'd need $parent?</p>



<a name="153811882"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811882" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811882">(Jan 06 2016 at 21:01)</a>:</h4>
<p>Well, it works in my parser and looks logical.</p>



<a name="153811883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811883">(Jan 06 2016 at 21:53)</a>:</h4>
<p>that's ok. "Patient." is a null thing that is allowed to appear at the start of an expression at the root context</p>



<a name="153811884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811884">(Jan 06 2016 at 21:53)</a>:</h4>
<p>all expressionsi in an operation have the same context. </p>



<a name="153811885"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811885" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811885">(Jan 06 2016 at 21:53)</a>:</h4>
<p>so that's not restarting the context</p>



<a name="153811886"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811886" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811886">(Jan 06 2016 at 22:10)</a>:</h4>
<p>sorry, all expressions in a set linked by operators</p>



<a name="153811889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811889">(Jan 07 2016 at 09:43)</a>:</h4>
<p>No, you're right, thwo whole expression runs in the same context. My code was smarter than my brain at that time.</p>



<a name="153811891"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811891" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811891">(Jan 07 2016 at 13:45)</a>:</h4>
<p>I think we should rename the $parent axis to $parents, since -using the | operator for example- you could combine nodes from different part of a tree, so you can have multiple different parents...</p>



<a name="153811892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811892">(Jan 07 2016 at 13:47)</a>:</h4>
<p>It's also true, that when you have combined trees with  |  ** can result in duplicate nodes...</p>



<a name="153811896"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153811896" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153811896">(Jan 07 2016 at 15:21)</a>:</h4>
<p>Yeah. The | operator can also cause you to have a focus with both "values (primitive elements)" and "elements", which makes the interpretation of asInteger() a bit ambiguous. Contains a "single value" is different from contains a single element...</p>



<a name="153812343"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812343" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812343">(Jan 14 2016 at 21:16)</a>:</h4>
<p>[13-1-2016 20:29:31] <strong>* Ewout Kramer added Bryn Rhodes, Grahame Grieve </strong>*<br>
[13-1-2016 20:29:44] Ewout Kramer: Hi Bryn. Reading through the thread, but not quite finished it.  I am thinking of changing the way we handle choice elements ([x])...</p>
<p>What if this:<br>
      Observation.value[x]   was turned into a normal   Observation.value</p>
<p>and</p>
<p>Observation.valueBoolean turned into</p>
<p>Observation.value.of(boolean)    </p>
<p>So we get a "type" filter, which would probably be useful in other circumstances as well<br>
[13-1-2016 20:30:11] Grahame Grieve: busy, but I will think about that<br>
[13-1-2016 20:30:25] Grahame Grieve: but I don't like losing the .valueBoolean for all sorts of reasons<br>
[13-1-2016 20:30:55] Grahame Grieve: don't mind losing the [x] quite so much but I think it increases complexity for some implementations<br>
[13-1-2016 20:32:39] Ewout Kramer: The valueBoolean is a very FHIR specific way of type filtering, that feels natural only if you have seen FHIR instances, so if we use FhirPath (or ????Path) outside FHIR, this will look alien to people.<br>
[13-1-2016 20:42:28] Grahame Grieve: yes. I agree to that. but it sounds like we can have our cake and eat it too then<br>
[13-1-2016 20:43:00] Grahame Grieve: because if you are applying FHIRPath in the context where you have a type attribute instead of a pre-coordinated name, then .valueBoolean would be weird<br>
[13-1-2016 20:43:20 | Edited 20:43:25] Grahame Grieve: so we could say that the base is .value.type(boolean) and in FHIR, you can do .valueBoolean<br>
[13-1-2016 21:19:38] Ewout Kramer: "However, this seems to be ambiguous in the grammar with the multiplication operator"</p>
<p>It's not really ambiguous because the multiplication requires a second operand, so either the bla* expression is followed by nothing (=path expression) or it's follow by another path (bla*bla =&gt; multiplication) or followed by an invocation (=&gt; path expression).   So my parser does indeed support Resource.element**4<br>
[13-1-2016 21:20:29 | Edited 21:21:00] Ewout Kramer: But yes, my parser framework has unlimited lookahead ;)<br>
[13-1-2016 21:21:18] Ewout Kramer: It requires some lookahead to disambiguate, agreed<br>
[13-1-2016 21:34:31] Ewout Kramer: "A.B + A.C If either of B or C are actually lists, then under CQL, this would be a compile-time error, but under FHIRPath, it would be allowed"</p>
<p>We could disallow this is FhirPath, and define the + - / * etc operators to work on single values / lists with one element. The compiler can statically check that.  </p>
<p>To allow adding in circumstances where the user is sure there can be only a single value (because the criteria expressed limit the possibilities to only one value), he/she could indicate that explicitly:</p>
<p>A.B.single() + A.C.single()</p>
<p>This would conceptually "cast" an array of one value to a "single" value and then allow addition. The single() function would throw at runtime when there's &gt; 1 one value in A.B. If the user does not care, he/she could do A.B.first() + A.C.first().</p>
<p>This has the advantage of enabling static type checking (i.e. adding elements with cardinality 0..1 would still look natural as A+B), keeps the normal path navigation simple A.B.C (no addition of [] necessary), and is very explicit in rare(?) circumstances where a collection would need to be added.<br>
[13-1-2016 21:34:34] Grahame Grieve: I don't much like the look ahead part<br>
[13-1-2016 21:35:04] Ewout Kramer: I agree. It requires a strong parser framework<br>
[13-1-2016 21:36:15 | Edited 21:36:32] Ewout Kramer: Maybe we should use  Bla.[name] STAR. This would also enable more complex repeats like Questionnaire.[group.question] STAR <br>
[13-1-2016 21:36:55] Ewout Kramer: Where STAR=*.  Skype is turning my asterix into bold....<br>
[13-1-2016 21:47:44] Ewout Kramer: I've checked the current fhirpath expressions for the use of "+", they are used on constructs that can statically be determined to be single values, so no change would be necessary to the current statements.<br>
[13-1-2016 22:01:57 | Edited 22:02:24] Ewout Kramer: "FHIRPath defines contexts using a "$" <br>
you might find that you don't need some of them, but a couple are kind of handy in an expression - particular $context <br>
Yeah, they are definitely useful, I’m just saying they are parameters, <br>
I picked $context because that's the one that's not a parameter - it arises inline." </p>
<p>In my implementation $context and $resource are indeed treated exactly the same as constant values, in this case passed as parameters into the execution engine.</p>
<p>$parent and $focus are not constant, but we could change $parent to a function application .parents().</p>
<p>$focus is the "variable" in the sense of a lambda expression, e.g.   where(x =&gt; x&gt;1) in C#, or \x -&gt;x&gt;1 in Haskell for example.  Rather than introducing a syntax like this, we could keep treating $focus as the exception (the only non-constant looking like a constant), or replace it by '_', as used in Scala:</p>
<p>(1|2|3|4|5).where( _ &gt; 3)<br>
[13-1-2016 22:05:54] Ewout Kramer: Then, I don't think there is a difference between $xxxx or %xxxxx  anymore and they can be merged to mean "constant value".   (although stuff like %vs-xxxxx act more like a function with a single param)<br>
[13-1-2016 22:09:12 | Edited 22:09:22] Ewout Kramer: "A.. <br>
The second invocation of * would have no type information, it would have to be a run-time invocation. </p>
<p>(...)</p>
<p>That is what I was thinking, define a "dynamic" type that would push it to run-time, similar to the way XPath or C# support dynamic types. "</p>
<p>I like that idea, in fact, my compiler currently does not do static typechecking and treats everything exactly like a "dynamic".</p>
<p>So, paths like '*' and '**', and also Observation.value would evaluate to a dynamic.  Disadvantage is that it is not immediately clear in an expression like Observation.value.unit that halfway, we have switched to a dynamic type.<br>
[13-1-2016 22:12:53 | Edited 22:12:57] Ewout Kramer: I did not find any examples where missing 3VL for booleans is a problem?<br>
[13-1-2016 22:14:49 | Edited 22:15:02] Ewout Kramer: But I think we should not do null propagation, except for '+' on strings, where null would be the empty string.  Again, I did not find occurrences for '+' in the current fhirpath invariants that use the effect of null propagation.<br>
[13-1-2016 22:16:11] Ewout Kramer: I think that was all. Phew!<br>
[13-1-2016 22:19:38] Grahame Grieve: "The single() function would throw at runtime" - as currently specified, there is no exceptions, just null outcomes.<br>
[13-1-2016 22:20:24] Ewout Kramer: Yes, and I don't like that at all. It requires null propagation from that moment on and results in unexpected behaviour<br>
[13-1-2016 22:20:34] Grahame Grieve: [woensdag 13 januari 2016 21:36] Ewout Kramer: </p>
<p>&lt;&lt;&lt; A.B.single() + A.C.single()why tax the user like this? if the user knows this is ok, why make them say it's ok?<br>
[13-1-2016 22:20:56] Grahame Grieve: Bla.[name]* - isn't this a problem for use of []?<br>
[13-1-2016 22:21:00] Ewout Kramer: Because it harldy ever happens (0 occurences in the current invariants), and when it does, it's very explicit for the reader.<br>
[13-1-2016 22:21:25 | Edited 22:21:30] Ewout Kramer: We have removed "[]" if we don't use [x] anymore for value.<br>
[13-1-2016 22:21:37] Ewout Kramer: Oh, in CQL. Yes, that could be.<br>
[13-1-2016 22:21:59] Grahame Grieve: don't like .parents() because suddenly you need a grammatical way to start with a '.'<br>
[13-1-2016 22:22:27] Grahame Grieve: Rather than introducing a syntax like this, we could keep treating $focus as the exceptionI didn't understand that bit<br>
[13-1-2016 22:23:54] Grahame Grieve: Generally, there was a lot there I wasn't confident I understood.<br>
[13-1-2016 22:24:21] Grahame Grieve: in particular, the notion of null return vs exceptions is important. Right now, you can do this:</p>
<p>rule.path.something.empty()<br>
[13-1-2016 22:24:48] Grahame Grieve: and know that this will be true, that there will be no errors.<br>
[13-1-2016 22:24:59] Grahame Grieve: allowing exceptions..... makes that really really hard<br>
[13-1-2016 22:35:53] Ewout Kramer: don't like .parents() because suddenly you need a grammatical way to start with a '.'Yuck. No we dont want that<br>
[13-1-2016 22:42:20] Ewout Kramer: Yes, I agree the null return vs. exception is one of the biggest issues to tackle.<br>
[13-1-2016 22:50:22] Ewout Kramer: So, let's see.  I don't mind single() returning an empty collection, and I don't mind propagating it over child navigation (yada.single().family), but I think  4 + [] = [] is almost always unintended, as is [3,4] + 4 = []<br>
[13-1-2016 22:53:04] Ewout Kramer: Actually, I get confused by most of the operations, including functions, that will return empty when their input is unexpected, like toInteger():</p>
<p>Patient.identifier.id.toInteger() will now return a single integer when there is exactly 1 id, but will return empty when there are 0 or more than 1. I cannot imagine this is desired behaviour.<br>
[13-1-2016 22:53:10] Grahame Grieve: so, maybe. but thing.property.where(otherproperty+4).otherthing<br>
[13-1-2016 22:53:12] Grahame Grieve: that's not clear<br>
[13-1-2016 22:54:25 | Edited 22:54:39] Ewout Kramer: Luckily, when we would introdue select(), we could do what we want:</p>
<p>Patient.identifier.select(id.toInteger()) would return a collection of ids as integers.<br>
[13-1-2016 22:55:04] Grahame Grieve: what if they aren't integers?<br>
[13-1-2016 22:55:57] Bryn Rhodes: I actually really like the empty collection is equivalent to "null", I think that's very clean.<br>
[13-1-2016 22:56:07] Ewout Kramer: Yes<br>
[13-1-2016 22:56:10] Bryn Rhodes: I think if they aren't integers, that's an error, because it's a mistake.<br>
[13-1-2016 22:56:14] Ewout Kramer: But what to do with null +4 ?<br>
[13-1-2016 22:56:26] Bryn Rhodes: null + 4 returns null, just like it does in SQL.<br>
[13-1-2016 22:56:38] Grahame Grieve: I think that you either have exceptions, or query null handling.<br>
[13-1-2016 22:56:49] Bryn Rhodes: Null propagation is good because it allows you to write expressions without regard to whether or not the information isn't there.</p>



<a name="153812344"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812344" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812344">(Jan 14 2016 at 21:18)</a>:</h4>
<p>[13-1-2016 22:56:51] Ewout Kramer: Grahame: correct<br>
[13-1-2016 22:57:15] Bryn Rhodes: But turning exception conditions into nulls is very bad.<br>
[13-1-2016 22:57:18] Bryn Rhodes: IMHO.<br>
[13-1-2016 22:57:18] Grahame Grieve: you can do type checking at compile time, as I do, and warn the user that the effects might be not what they think<br>
[13-1-2016 22:57:19] Grahame Grieve: so I think it's ok because of that<br>
[13-1-2016 22:57:37] Grahame Grieve: it's one or the other. mixing them is very bad<br>
[13-1-2016 22:57:43] Bryn Rhodes: Why?<br>
[13-1-2016 22:58:12] Bryn Rhodes: The point, I think is that the fact that information is missing isn't an error, it's "i don't know".<br>
[13-1-2016 22:58:19] Bryn Rhodes: But 1 + "Steve" is an error.<br>
[13-1-2016 22:58:27] Grahame Grieve: If you mix the conditions, you'll have to define which is which, and then users will have to guess which is<br>
[13-1-2016 22:58:43] Grahame Grieve: so how does a user handle the case where it might be an error or not?<br>
[13-1-2016 22:59:12] Grahame Grieve: if they're constants, it's always going to be an error. but a real world case, one or both are going to things extracted from objects by query<br>
[13-1-2016 23:00:07] Grahame Grieve: if you say it's always null, the user has predictability, and can make queries without being taxed to make all sorts of type checks and error condition checks - this in a language that is not geared to procedural case statements<br>
[13-1-2016 23:01:22] Bryn Rhodes: So, my problem with that is that "null" is a valid result, it means something, and if you make an error "null" then you  don't know whether it's null because it really was null, or it's null because you had some error in your expression.<br>
[13-1-2016 23:01:47] Bryn Rhodes: It ends up hiding important information from the user.<br>
[13-1-2016 23:02:42 | Edited 23:02:44] Bryn Rhodes: Especially in a really complicated expression, that becomes a really big issue.<br>
[13-1-2016 23:03:02] Ewout Kramer: So, Bryn, 4 + [] = [], but 4 + [3,4,5] = error, right?<br>
[13-1-2016 23:03:26] Grahame Grieve: you need to stop using constants. They mislead you about what's going on<br>
[13-1-2016 23:03:32] Bryn Rhodes: Well, I would actually prefer to see that as a "compile-time" error, because you can't add a singular and a list.<br>
[13-1-2016 23:04:24] Bryn Rhodes: But if we accept that there can be implicit conversions to lists, then yes, that would be a run-time error, because there is more than one.<br>
[13-1-2016 23:07:57] Ewout Kramer: So, I suggested making this a compile time error indeed, and add single() for the circumstances where you really want to add to collections together, because you know they are single values (or nulls -  if we keep the null propagation).  And then if single() encounters &gt; 1 element....a runtime error?<br>
[13-1-2016 23:08:39] Bryn Rhodes: Yes, I like that. In fact CQL has a "singleton from" operator with exactly those semantics.<br>
[13-1-2016 23:08:46] Ewout Kramer: ok<br>
[13-1-2016 23:09:56] Ewout Kramer: So, I see 2 votes for propagating nulls over math. operators and comparisons, so null &gt; 4 = null (=false)<br>
[13-1-2016 23:11:28] Grahame Grieve: so you make users specify singleton even when they know it's null, so that the compiler doesn't tell them that they're wrong, even when they aren't<br>
[13-1-2016 23:12:31] Ewout Kramer: I don't understand that<br>
[13-1-2016 23:13:06] Ewout Kramer: You make them specify singleton if you are doing operations that can statically be determined to be collections. What does that have to do with null?<br>
[13-1-2016 23:14:59] Grahame Grieve: you said you make them specify singletons so that a collection is proven to be single.<br>
[13-1-2016 23:15:00] Bryn Rhodes: I actually really like that because it means you don't have to provide list-valued overloads for all singular operators to enable type analysis.<br>
[13-1-2016 23:15:31] Grahame Grieve: you didn't say anything about statically determined<br>
[13-1-2016 23:15:31] Grahame Grieve: Bryn, like which?<br>
[13-1-2016 23:15:49] Bryn Rhodes: Like .single()<br>
[13-1-2016 23:16:09] Ewout Kramer: I think I had conceded that single() would only throw when there's &gt; 1 element, and return empty on an empty collection<br>
[13-1-2016 23:16:28 | Edited 23:16:34] Bryn Rhodes: Yeah, I was just providing another reason that I like it.<br>
[13-1-2016 23:17:10] Ewout Kramer: That makes sense if we stick to null propagation, as you and Bryn both like to do.<br>
[13-1-2016 23:18:50] Grahame Grieve: but you're going to make a user specify .single() everywhere, because if they do something like </p>
<p>something[thisIsPossiblyOneOrMoreIntegersButIKnowItsOnlyOne + 4].other<br>
[13-1-2016 23:18:56 | Edited 23:18:57] Grahame Grieve: then you'll make that an error anyway<br>
[13-1-2016 23:20:12] Ewout Kramer: I was looking at the operators, certainly not path navigation.<br>
[13-1-2016 23:20:46] Ewout Kramer: What we do with functions that expect a single input (like toInteger) that receive &gt; 1 element, we have not yet discussed.<br>
[13-1-2016 23:22:14] Ewout Kramer: So, I really think single() is going to be exceptional.<br>
[13-1-2016 23:22:21] Ewout Kramer: It should<br>
[13-1-2016 23:22:26] Ewout Kramer: Otherwise, I'd agree with you<br>
[13-1-2016 23:22:45] Grahame Grieve: I was just concluding that I have no idea how what you're describing works<br>
[13-1-2016 23:23:25] Grahame Grieve: under some set of circumstances, it blows up, and .empty() returns false instead of true, and I can no longer understand in my head how a user could know which was which<br>
[13-1-2016 23:24:12 | Edited 23:24:17] Ewout Kramer: So, currently, what would x+y do if either x or y &gt; 1 element?<br>
[13-1-2016 23:24:46] Bryn Rhodes: Hmmm.....<br>
[13-1-2016 23:25:40] Bryn Rhodes: If you allow for dynamics, then the compiler can't know in all cases when single() is required, which means it would be allowed to be inconsistently applied in the language, which would kind of defeat it's usefulness... I think.<br>
[13-1-2016 23:26:37] Ewout Kramer: Ah, but that's true of dynamic in general, and is separate from single()<br>
[13-1-2016 23:26:47] Bryn Rhodes: Agreed.<br>
[13-1-2016 23:26:50] Grahame Grieve: that's why I think that .single() and exceptions is a bad idea<br>
[13-1-2016 23:27:11] Bryn Rhodes: I think swallowing exceptions is an even worse idea.<br>
[13-1-2016 23:28:20] Bryn Rhodes: How would I ever know if something went wrong?<br>
[13-1-2016 23:29:21] Bryn Rhodes: FHIR Path as currently defined doesn't swallow exceptions, right?<br>
[13-1-2016 23:29:32] Ewout Kramer: Right.<br>
[13-1-2016 23:29:52] Ewout Kramer: Adding something to a collection &gt; 1 elmenent returns in an empty collection.<br>
[13-1-2016 23:31:18] Grahame Grieve: so I agree that this is not a comfortable case for me. But I think that any other approach is less comfortable<br>
[13-1-2016 23:31:29] Ewout Kramer: Well, maybe we should propagate both the null and the exception. So, at the end of evaluation, you can either live with the thing being null, or inspect an exception property of the evaluation engine.<br>
[13-1-2016 23:31:46] Ewout Kramer: But how would the caller decide which behaviour he want?<br>
[13-1-2016 23:31:49] Grahame Grieve: but .empty.....<br>
[13-1-2016 23:32:09] Grahame Grieve: this is how OCL works... no exceptions.... just null<br>
[13-1-2016 23:32:14] Bryn Rhodes: What about just .single() semantics but not having to invoke it?<br>
[13-1-2016 23:32:25] Grahame Grieve: not having to invoke it?<br>
[13-1-2016 23:32:41] Ewout Kramer: well, you'd still have to chose between resulting in null or throwing an exception<br>
[13-1-2016 23:32:51] Bryn Rhodes: Yeah, so if you invoked a singular operation on operands with more than one item, it would throw an exception.<br>
[13-1-2016 23:33:09] Bryn Rhodes: If either operand is empty, return empty.<br>
[13-1-2016 23:33:18] Bryn Rhodes: Otherwise, perform the singular operation.<br>
[13-1-2016 23:33:37] Ewout Kramer: well, you'd still have to chose between resulting in null or throwing an exceptionThat remains the devilish dilemma<br>
[13-1-2016 23:33:45] Bryn Rhodes: Yeah, and that's one of the main reasons we didn't use OCL.<br>
[13-1-2016 23:33:48 | Edited 23:33:49] Bryn Rhodes: That's just not safe.<br>
[13-1-2016 23:34:17] Bryn Rhodes: What's the problem with .empty()?<br>
[13-1-2016 23:34:21] Bryn Rhodes: I don't understand.<br>
[13-1-2016 23:35:01] Grahame Grieve: well, at present, objects.filter(criteria).empty returns true if there's no object in the objects that meets criteria<br>
[13-1-2016 23:35:27] Grahame Grieve: but you guys re arguing that for some combinations of criteria, it should return false even if there are no objects that meet the criteria<br>
[13-1-2016 23:36:18 | Edited 23:36:32] Ewout Kramer: no, we are arguing that if the criteria dont make sense, they should not be considered a "false" outcome<br>
[13-1-2016 23:37:19] Ewout Kramer: Alternatively, we define how + works on collections, e.g. result in a collection where  4 is added to all input values<br>
[13-1-2016 23:37:32] Grahame Grieve: so the result of that is the user has to tell the compiler that they do make sense, even when the user knows that they make sense because the language works that way<br>
[13-1-2016 23:38:23 | Edited 23:38:37] Ewout Kramer: If I understand correctly what you are saying, you are saying: "it's ok to produce nonsense results because we have specified that we produce nonsense results"<br>
[13-1-2016 23:39:09] Ewout Kramer: Let's find some actual examples.<br>
[13-1-2016 23:39:38] Ewout Kramer: Becuase I am sure that in practice, our proposal does not change your current way of working.<br>
[13-1-2016 23:40:08] Bryn Rhodes: +1<br>
[13-1-2016 23:41:04] Grahame Grieve: The case that I see is that the resource defines something as a collection.<br>
[13-1-2016 23:41:06] Grahame Grieve: Patient name.<br>
[13-1-2016 23:41:15] Grahame Grieve: Patient.name.first + 'that'<br>
[13-1-2016 23:41:46] Grahame Grieve: a user would have lots of grounds to know that although the specification says it's a collection, they only ever have a single name<br>
[13-1-2016 23:42:19] Ewout Kramer: So, how would you use this in an invariant?<br>
[13-1-2016 23:43:02] Grahame Gr</p>



<a name="153812345"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812345" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812345">(Jan 14 2016 at 21:19)</a>:</h4>
<p>[13-1-2016 23:43:02] Grahame Grieve: contained.all("#"+id in **.reference)<br>
[13-1-2016 23:44:02 | Edited 23:44:08] Ewout Kramer: id is 0..1, and the compiler would not complain. But you mean, if id were defined as 0..*?<br>
[13-1-2016 23:44:09 | Edited 23:44:09] Grahame Grieve: yes<br>
[13-1-2016 23:46:28] Bryn Rhodes: That would still work, so long as the id did have at most one id at runtime.<br>
[13-1-2016 23:46:51] Bryn Rhodes: As an aside, how does the compiler know that the "id" is applied to the current iteration target, and the ** is applied to the top level resource?<br>
[13-1-2016 23:47:24] Ewout Kramer: ** would, in my evaluator, be applied to the current iteration target<br>
[13-1-2016 23:47:58 | Edited 23:48:00] Bryn Rhodes: Am I misunderstanding what that invariant is supposed to be enforcing then?<br>
[13-1-2016 23:48:25] Ewout Kramer: I think the invariant should read $context.**reference<br>
[13-1-2016 23:49:00] Grahame Grieve: yes it's wrong. good pick<br>
[13-1-2016 23:49:13] Bryn Rhodes: Okay, and then it would work, so long as there was at most one identifier?<br>
[13-1-2016 23:49:31] Bryn Rhodes: id, sorry<br>
[13-1-2016 23:49:35] Ewout Kramer: Currently, it would become false if &gt; 1 id<br>
[13-1-2016 23:50:07] Ewout Kramer: And you could say that's a correct outcome, but really, I wonder if the writer of the invariant was aware of that consequence.<br>
[13-1-2016 23:50:25] Ewout Kramer: (in this case, since it is Grahame, he was....but generally speaking)<br>
[13-1-2016 23:50:29] Bryn Rhodes: Yeah, and it could just as easily have resulted in the wrong outcome if there was negation involved.<br>
[13-1-2016 23:50:33] Ewout Kramer: y<br>
[13-1-2016 23:51:59] Bryn Rhodes: An error in an invariant though, is still a "false" because it means the same thing, so I don't see how that changes the behavior, it just gives the user more information about what went wrong.<br>
[13-1-2016 23:52:09] Grahame Grieve: yes, this one, it would be ok for it to be handled either way, because the invariant would be false either way<br>
[13-1-2016 23:52:23] Grahame Grieve: that was the 1st + I found. I'll find a more difficult case now<br>
[13-1-2016 23:53:23] Ewout Kramer: And, I think if there COULD have been &gt; 1 you'd really have wanted:</p>
<p>contained.select('#' + id) in **.reference<br>
[13-1-2016 23:54:29] Ewout Kramer: which is a more safe, and more true statment, because then all id's would have to appear in a reference<br>
[13-1-2016 23:54:59 | Edited 23:55:10] Ewout Kramer: (I call it select, but many langues call it map())<br>
[13-1-2016 23:55:41] Bryn Rhodes: I like select.<br>
[13-1-2016 23:56:08] Bryn Rhodes: CQL actually uses return, but there was considerable debate about that.<br>
[13-1-2016 23:57:03] Grahame Grieve: maybe I'm just stupid, but I don't understand how that is different<br>
[13-1-2016 23:58:31] Ewout Kramer: contained.all('#' + id...) has the problem that the "+" would return empty, so when there is &gt; 1 id, the statement becomes false.<br>
[13-1-2016 23:59:06] Ewout Kramer: While the version with select() would return true (it seemed to me that IF there are &gt; 1 id, you'd wanted those other id's to also be referenced)<br>
[13-1-2016 23:59:14] Ewout Kramer: That's a user's choice of course.<br>
[13-1-2016 23:59:27] Grahame Grieve: ok I get it<br>
[13-1-2016 23:59:31] Grahame Grieve: snapshot.element.tail().all(path.startsWith($context.snapshot.element.first().path+"."))<br>
[00:00:06] Grahame Grieve: I suppose you're going to argue with this one that first() makes it single. so this is not going to be a problem<br>
[00:00:08] Ewout Kramer: here, the first() fixes the problem<br>
[00:00:10] Ewout Kramer: yep<br>
[00:00:15] Ewout Kramer: you know me by now.<br>
[00:02:47] Grahame Grieve: (Range): low.empty() or high.empty() or (low &lt;= high)<br>
[00:02:57] Ewout Kramer: But the main question is: that contained.all() statement, should that have thrown when the user is 100 % there cannot be &gt; 1 id?<br>
[00:03:16] Ewout Kramer: can low and high repeat?<br>
[00:03:27] Ewout Kramer: or is this a subclause on something that is repeating?<br>
[00:04:13] Grahame Grieve: they can't repeat now<br>
[00:04:37] Bryn Rhodes: If the user is 100% certain that there cannot be &gt; 1 id and there isn't actually &gt; 1 id at runtime, then there would be no error.<br>
[00:05:23] Grahame Grieve: here's a much more interesting case:<br>
[00:05:25] Grahame Grieve: component.where(code = $context.code).empty()<br>
[00:05:51] Grahame Grieve: on Observation<br>
[00:06:08] Ewout Kramer: Ah, but I like how we have defined = on collections....<br>
[00:06:31] Ewout Kramer: no problem here for me.<br>
[00:06:51] Bryn Rhodes: Me either, = is overloaded for collections, makes sense.<br>
[00:07:53] Grahame Grieve: I think it's going to be hard to find something out of the existing resource based things<br>
[00:08:15] Ewout Kramer: in the high and low case, it would depend on whether they would need to be compared in pairs, or all lows must be &lt; highest high, or lower than the lowest high.<br>
[00:08:31] Grahame Grieve: for more interesting examples, I'm going to have to talk about profiles<br>
[00:08:31] Grahame Grieve: because is your compiler profile aware?<br>
[00:09:25] Grahame Grieve: it can't be. actually. that's the problem<br>
[00:09:46] Grahame Grieve: I'm writing an evaluation on patient that knows that the cardinality of a collection ix fixed to 1.<br>
[00:10:02] Grahame Grieve: but your evaluation engine doesn't know that, so the user has to tell it<br>
[00:11:13] Ewout Kramer: Yes.  So, if you use that statement to validate the profile, of course you would have to check for occurences &gt; 1.  This is the situation where we know the statement is executed in an environment where the isntances is already validated against the profile and we are 100% sure it will not repeat.<br>
[00:11:32] Grahame Grieve: yes, but the engine is not clued into this<br>
[00:11:36] Ewout Kramer: Rght.<br>
[00:12:58 | Edited 00:14:47] Ewout Kramer: So, there's someone who has written a profile and has told the author of the statement that there's one occurrence only. Author is a consumer of the output of a system where the profile has been run to validate incoming instances.<br>
[00:16:02] Grahame Grieve: yes<br>
[00:16:28 | Edited 00:16:36] Ewout Kramer: So, it depends whether the FP compiler is run against the base resources or against the gatekeeper profile...<br>
[00:16:58] Ewout Kramer: oh, we didn't do static checking anymore.<br>
[00:18:19] Ewout Kramer: So, now the configuration changes. The author is not updated of this fact (might be quite some time later).  Would we prefer run-time errors, or unpredictable behaviour of the downstream FP expressions?<br>
[00:18:31] Ewout Kramer: Or still - static checking?<br>
[00:18:53] Ewout Kramer: Or static checking? (but that would require single())<br>
[00:20:01] Ewout Kramer: Let's see if a night of sleep brings more insights. Gentlemen, thank you for an entertaining discussion ;-)<br>
[00:20:34] Grahame Grieve: yes sleep time<br>
[07:14:18] Ewout Kramer: Thought about it some more. </p>
<p>[00:18] Ewout Kramer: </p>
<p>&lt;&lt;&lt; So, now the configuration changes. The author is not updated of this fact (might be quite some time later).  Would we prefer run-time errors, or unpredictable behaviour of the downstream FP expressions?<br>
My answer is: runtime error (at least).  Your assumptions have changed because of an upstream change. This means that your FP queries based on those assumptions are now potentially doing the wrong thing, so they need to throw and you need to take a look at your queries to update them to the new situation (upstream profile causes different cardinality)</p>
<p>If you want to be future proof &amp; you can use single() or first(), and that's an explicit choice stating that you have covered the case where the cardinality turns out to be &gt; 1<br>
[07:15:21] Ewout Kramer: And I think I would add a parameter to my evaluator to use "strict" evaluation. If you enable that, the compiler will track cardinalities and point you out where you'd need to do single() or first() (or however you want to handle it)<br>
[07:15:31 | Edited 07:16:43] Ewout Kramer: CQL might decide to require "strict" mode, while FHIR does not.<br>
[07:18:53] Ewout Kramer: Note: the discussion about single() also holds for functions taking a parameter (like substring) that needs to be single-valued. returning empty on a substring() just because the parameter turns out to be a collection has the same risks.<br>
[07:20:24 | Removed 07:21:34] Ewout Kramer: This message has been removed.<br>
[07:51:11] Grahame Grieve: I think we need to understand the impacts on the various ways you use a query<br>
- indexing for search parameter<br>
- invariant<br>
- mapping<br>
- decision support library<br>
[07:51:20] Grahame Grieve: how do these fail in the various cases?<br>
[08:02:13] Ewout Kramer: That makes sense<br>
[08:02:31] Ewout Kramer: To validate my statement ;-)<br>
[08:11:05] Ewout Kramer: bryn, we're sitting front right in the breakfast room<br>
[13:50:23] Grahame Grieve: so we didn't close this out did we?<br>
[14:12:09] Grahame Grieve: let me know if this gets interesting<br>
[14:15:20] Ewout Kramer: ok<br>
[14:42:56] Bryn Rhodes: So, as far as next steps here, I was thinking I could start by actually taking a branch of the CQL tooling and implement the changes that have been proposed to enable the CQL grammar to express FHIRPath.<br>
[14:43:01] Bryn Rhodes: Does that sound like a good next step?<br>
[14:55:32 | Edited 14:55:51] Ewout Kramer: I think I know "I" agreed on ;)  But as a summary:</p>
<ul>
<li>Stick to null propagation (but we still need to define if nulls propagate through parameters, i.e. if you pass null to substring() what happens?). We agreed 4 + null = null, but what about string + null?</li>
<li>Will now throw an exception if operators / functions are called on collections with &gt; 1 element when 1 element (or null) is expected. </li>
<li>Throwing exceptions at runtime can be avoided by <br>
a) being absolutely sure (because you're downstream from a profile validator) that cardinality will be 1 or <br>
b) defensively use mechanisms like first(), <br>
c) Have static validation capabilities in the compiler (which can be switched on/off or are effectively warnings) to point out where </li>
</ul>



<a name="153812346"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812346" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812346">(Jan 14 2016 at 21:19)</a>:</h4>
<p>[14:55:32 | Edited 14:55:51] Ewout Kramer: I think I know "I" agreed on ;)  But as a summary:</p>
<ul>
<li>Stick to null propagation (but we still need to define if nulls propagate through parameters, i.e. if you pass null to substring() what happens?). We agreed 4 + null = null, but what about string + null?</li>
<li>Will now throw an exception if operators / functions are called on collections with &gt; 1 element when 1 element (or null) is expected. </li>
<li>
<p>Throwing exceptions at runtime can be avoided by <br>
a) being absolutely sure (because you're downstream from a profile validator) that cardinality will be 1 or <br>
b) defensively use mechanisms like first(), <br>
c) Have static validation capabilities in the compiler (which can be switched on/off or are effectively warnings) to point out where cardinalities can cause throwing errors.</p>
</li>
<li>
<p>Introduce a type filter ofType() or of() or type() to work with choice elements (which I think can also be used to filter '**' or '*' expressions to filter only certain types of nodes, which would enable static typechecking to continue after such expressions)</p>
</li>
</ul>



<a name="153812347"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812347" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812347">(Jan 14 2016 at 21:20)</a>:</h4>
<p>Ok, switch from Skype....</p>



<a name="153812369"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812369" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812369">(Jan 16 2016 at 18:20)</a>:</h4>
<ul>
<li>Regarding "Stick to null propagation": In general, CQL operations return null if any argument is null. There are a few exceptions to ensure expected behavior, but they are all documented in the operator appendix.</li>
<li>Regarding "ofType()": In CQL, we have "is", "as", and "cast as", with semantics equivalent to the "is", "as", and "cast" of C#. We have a type specifier production rule that allows these clauses to be used with any type. In FHIRPath, I would think there would just be ofType() operators for each primitive, yes?</li>
</ul>



<a name="153812370"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812370" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812370">(Jan 16 2016 at 18:21)</a>:</h4>
<p>Oh, and for consistency of naming, I wonder if "asType" would be okay?</p>



<a name="153812374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812374">(Jan 18 2016 at 19:34)</a>:</h4>
<p>ofType(x), where x is one of the primitives, yes, that's what I mean.  asType() would be perfect!</p>



<a name="153812518"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812518" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> z Brian Postlethwaite (old - don&#x27;t use) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812518">(Feb 01 2016 at 08:23)</a>:</h4>
<p>Looking for how I might prepare this xpath expression as a fhirpath expression<br>
if(//Condition/code/coding/code[@value='ihd' or @value='hearf']) then 'Yes' else ''</p>



<a name="153812522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> z Brian Postlethwaite (old - don&#x27;t use) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812522">(Feb 01 2016 at 11:28)</a>:</h4>
<p>How does this look for people?<br>
('Yes'.where($resource.code.coding.where(code='ihd' or code='hearf')) | '').first()</p>



<a name="153812523"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812523" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> z Brian Postlethwaite (old - don&#x27;t use) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812523">(Feb 01 2016 at 11:44)</a>:</h4>
<p>Simpler example: ('Yes'.where(false) | 'No').first() returns 'No'<br>
and ('Yes'.where(true) | 'No').first() returns 'Yes'</p>



<a name="153812524"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812524" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812524">(Feb 01 2016 at 12:55)</a>:</h4>
<p>very creative ;-)  Looking for an if function?</p>



<a name="153812525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> z Brian Postlethwaite (old - don&#x27;t use) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812525">(Feb 01 2016 at 12:57)</a>:</h4>
<p>Yes, an if function would have made it much nicer,,,</p>



<a name="153812609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812609">(Feb 05 2016 at 05:58)</a>:</h4>
<p>Yes I like the if function </p>



<a name="153812772"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812772" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812772">(Feb 10 2016 at 17:38)</a>:</h4>
<p>Sorry, just now seeing this. CQL defines an "if" that looks just like the XPath syntax. Not sure that would fit within FluentPath, but worth considering I think.</p>



<a name="153812826"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153812826" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153812826">(Feb 15 2016 at 09:47)</a>:</h4>
<p>Yes, I was thinking along those lines....I will update the spec this week.</p>



<a name="153813052"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153813052" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153813052">(Feb 22 2016 at 14:18)</a>:</h4>
<p>So, I have basically decided to add an iif(), <a href="https://en.wikipedia.org/wiki/IIf" target="_blank" title="https://en.wikipedia.org/wiki/IIf">https://en.wikipedia.org/wiki/IIf</a>. where the "false" part will be selected when the input is either false or empty.</p>



<a name="153813059"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153813059" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153813059">(Feb 22 2016 at 15:25)</a>:</h4>
<p>Having missed Orlando, I probably missed the plan for FHIRPath/FluentPath... when is this going to replace the XPath invariants in the StructureDefinitions?</p>



<a name="153813060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153813060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153813060">(Feb 22 2016 at 15:28)</a>:</h4>
<p>It's actually already there in the build, but just as an extension, e.g.</p>
<div class="codehilite"><pre>            &lt;constraint&gt;
              &lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-expression&quot;&gt;
                &lt;valueString value=&quot;compose.import.count() != 1 or compose.include or compose.exclude or codeSystem&quot;/&gt;
              &lt;/extension&gt;
              &lt;key value=&quot;vsd-2&quot;/&gt;
              &lt;severity value=&quot;error&quot;/&gt;
              &lt;human value=&quot;A value set with only one import SHALL also have an include and/or an exclude unless the value set includes and inline code system&quot;/&gt;
              &lt;xpath value=&quot;not(exists(f:compose)) or (count(f:compose/f:import)!=1 or exists(f:compose/f:include) or exists(f:compose/f:exclude) or exists(f:codeSystem))&quot;/&gt;
            &lt;/constraint&gt;
</pre></div>



<a name="153813061"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153813061" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153813061">(Feb 22 2016 at 15:29)</a>:</h4>
<p>Are they being kept in-sync?</p>



<a name="153813062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153813062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153813062">(Feb 22 2016 at 15:30)</a>:</h4>
<p>I'm trying to decide how heavily I'm going to invest development time in fhirpath... is the XPath going to go away?</p>



<a name="153813064"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153813064" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153813064">(Feb 22 2016 at 19:45)</a>:</h4>
<p>Jason - I very much want it to go away, but other people have committed to it. So it looks likely that we will flip to using FHIRPath (or whatever it is called) as the primary, and generate XPath from them</p>



<a name="153814778"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814778" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814778">(Mar 10 2016 at 15:54)</a>:</h4>
<p>I want to implement support for fhirpath (or is it called fluentpath?) when I move to STU3... is <a href="https://github.com/ewoutkramer/fhirpath" target="_blank" title="https://github.com/ewoutkramer/fhirpath">https://github.com/ewoutkramer/fhirpath</a> the official documentation ?</p>



<a name="153814791"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814791" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814791">(Mar 10 2016 at 16:27)</a>:</h4>
<p>@Jason that is correct, Ewout has documented  the official FHIR Path syntax definition.</p>



<a name="153814792"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814792" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814792">(Mar 10 2016 at 16:29)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> thanks. Is there an official reference implementation?</p>



<a name="153814798"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814798" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814798">(Mar 10 2016 at 16:39)</a>:</h4>
<p><span class="user-mention" data-user-id="191381">@Jason Walonoski</span> Ewout has been implementing FHIR Path into the .NET FHIR API. This implementation now covers most - if not all - of the spec, verified by a set of unit tests. So you could  consider this as a reference implementation. There are also implementations available in other languages.</p>



<a name="153814799"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814799" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814799">(Mar 10 2016 at 16:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> Ok, thanks!</p>



<a name="153814804"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814804" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814804">(Mar 10 2016 at 17:12)</a>:</h4>
<p>Note that it's still a work in progress and we're currently updating it. So what's there is changing, and we'll be balloting the update in the May ballot cycle.</p>



<a name="153814805"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814805" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814805">(Mar 10 2016 at 17:13)</a>:</h4>
<p>You might want to hold off a little bit on implementing until those changes are in place, over the next few weeks.</p>



<a name="153814850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jason Walonoski <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814850">(Mar 10 2016 at 18:08)</a>:</h4>
<p>Well, is there a stable core? I wanted to be checking the invariants at the connectathon.</p>



<a name="153814872"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153814872" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153814872">(Mar 10 2016 at 20:12)</a>:</h4>
<p>The fluentpath.g4 that's there is very close, there's another round of changes we're still discussing, but they're minor changes to the syntax itself. Our goal is to be validating by the connectathon as well.</p>



<a name="153815372"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153815372" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153815372">(Mar 14 2016 at 09:38)</a>:</h4>
<p>Hi  Jason, the invariants that are currently present in the spec are based on the jan/orlando draft of the FHIRPath spec.  In Orlando we've discussed FHIRPath broadly and we've embarked on aligning it with the needs of the CQL team (of which Bryn is a member). The rename to "FluentPath" signals the fact that it is no longer a FHIR-only technology....</p>



<a name="153861570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153861570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153861570">(Dec 07 2016 at 10:51)</a>:</h4>
<p>btw, as well as updated versions of everything else, we have posted the candidate STU1 version of FHIRPath at <a href="http://hl7.org/fhirpath" target="_blank" title="http://hl7.org/fhirpath">http://hl7.org/fhirpath</a>. It's not finally approved by the relevent committee yet, but we expect it will be soon, and we don't expect any substantiative changes. Thanks to <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> for taking the lead on this</p>



<a name="153862873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153862873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153862873">(Dec 10 2016 at 06:49)</a>:</h4>
<p>Yes, a big thanks <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> </p>



<a name="153902423"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153902423" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153902423">(Aug 14 2017 at 19:40)</a>:</h4>
<p>Is it possible for a fhir expression to follow references? for example, suppose you have a contained resource and you want to follow the reference form the parent resource to return it. For example, suppose that Observation.supbect refers to a contained Patient resource, who could you return that Patient? sort of:  Observation.contained.where(id=Observation.subject.reference.substring(1)) ...</p>



<a name="153902424"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153902424" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153902424">(Aug 14 2017 at 20:33)</a>:</h4>
<p>search in the fhirpath spec for .resolve()</p>



<a name="153902427"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153902427" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153902427">(Aug 14 2017 at 21:25)</a>:</h4>
<p>Thanks Grahame - alas it doesn't seem to work in the javascript version that's on the web (as it's a couple of years old I guess that's not too surprising :) ) . Hopefully will be resolved when the new version is available...</p>



<a name="153927887"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927887" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927887">(Jan 07 2018 at 21:05)</a>:</h4>
<p>ITS is planning to ballot FHIRPath as normative in May. There's several implementations in different languages by different authors, there's plenty of use in the FHIR spec, there's a solid set of tests. There's some production use. And there's been very little substantiative change</p>



<a name="153927888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927888">(Jan 07 2018 at 21:06)</a>:</h4>
<p>there is several change requests:</p>



<a name="153927889"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927889" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Nelson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927889">(Jan 07 2018 at 21:08)</a>:</h4>
<p>Yes we are so planning to ballot. Curious if there has been <em>any</em> substantive change?</p>



<a name="153927890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927890">(Jan 07 2018 at 21:09)</a>:</h4>
<ul>
<li>add sum()</li>
<li>add quantity comparison</li>
<li>clarify about date rounding</li>
<li>relax definitions of concept equivalents</li>
</ul>



<a name="153927891"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927891" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927891">(Jan 07 2018 at 21:09)</a>:</h4>
<p>Dale: no substantiative change proposed as yet</p>



<a name="153927892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927892">(Jan 07 2018 at 21:09)</a>:</h4>
<p>maybe the last one might count as substantiative?possible.</p>



<a name="153927893"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927893" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927893">(Jan 07 2018 at 21:10)</a>:</h4>
<p>anyway, this is a call for comments and consideration on making this normative. In particular, has anyone used the v2 part (other than me?)</p>



<a name="153927894"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927894" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Nelson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927894">(Jan 07 2018 at 21:14)</a>:</h4>
<p>We would have a hard time arguing to go another round of STU rather than normative,  IMO.  For all the reasons you stated.</p>



<a name="153927895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927895">(Jan 07 2018 at 21:16)</a>:</h4>
<p>need to do some stuff in the appendices:<br>
- Appendix A needs to be normalised in the spec<br>
- Appendix D probably needs to be trial use still<br>
- Appendix E might need to be moved to somewhere else non-normative to allow it to be updated</p>



<a name="153927896"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927896" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Nelson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927896">(Jan 07 2018 at 21:26)</a>:</h4>
<p>Agree, Appendix E should not be part of normative spec, and we might want to think about V2/Appendix D.  So some work to do, but clearly on a May normative track.</p>



<a name="153927900"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927900" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927900">(Jan 07 2018 at 21:56)</a>:</h4>
<p>Has it been published as STU in 2 publication cycles?</p>



<a name="153927901"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927901" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927901">(Jan 07 2018 at 22:21)</a>:</h4>
<p>no. only one.</p>



<a name="153927902"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927902" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927902">(Jan 07 2018 at 22:31)</a>:</h4>
<p>Is there a reason we wouldn't adhere to the 2-cycle rule for this one to get to FMM-5 (which is the pre-req for normative) that we have for all FHIR artifacts?</p>



<a name="153927903"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927903" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927903">(Jan 07 2018 at 22:35)</a>:</h4>
<p>because it's not a FHIR artifact directly. And the implementation hasn't thrown up the kind of content model issues that make that investment of time necessary. And because ITS indicated a desire go straight to normative</p>



<a name="153927904"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927904" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927904">(Jan 07 2018 at 23:02)</a>:</h4>
<p>and as you say elsewhere, we use it in some candidate normative artifacts</p>



<a name="153927905"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927905" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927905">(Jan 07 2018 at 23:27)</a>:</h4>
<p>We will be using things in normative artifacts that aren't normative for the next 5-10 years.  So that's not a compelling reason to move forward.  Nor is a WG's indication of desire.  Given the high level of dependence FHIR has on FHIRPath, I would hope that we'd adhere to the same quality expectations.  At minimum, I'd expect to see an argument presented of how the objectives intended by the requirements we're waiving are either met or irrelevant in this situation with supporting evidence or rationale.  I'd also expect evidence of why adhering to the requirement was problematic.  None of that's been shared yet.</p>



<a name="153927906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927906">(Jan 07 2018 at 23:38)</a>:</h4>
<p>"We will be using things in normative artifacts that aren't normative for the next 5-10 years" - really? what?</p>



<a name="153927911"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927911" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927911">(Jan 08 2018 at 01:41)</a>:</h4>
<p>Many resources have References that point to other resources that will include at least some resources that aren't normative yet.  And I expect there it'll take us at least 3 more publications after R4 becore the vast majority of resources are normative.</p>



<a name="153927912"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927912" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927912">(Jan 08 2018 at 01:46)</a>:</h4>
<p>so there's a big difference between 'target of a reference' and included right in the resource</p>



<a name="153927914"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927914" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andy Stechishin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927914">(Jan 08 2018 at 01:57)</a>:</h4>
<p>To be clear, ITS has not decided anything about going Normative. Bryn was asked what he would like to do with the STU period coming to a close. Bryn indicated he thought it should go Normative and so this will be discussed in the joint ITS/FHIR-i quarter at the WGM. If you feel this is inapproriate, I would suggest that you attend this session as I would expect Bryn to be making a motion at some point.</p>



<a name="153927915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927915">(Jan 08 2018 at 02:24)</a>:</h4>
<p>I should have been clear about that. No formal decision at this point, but that's the proposed motion</p>



<a name="153927916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927916">(Jan 08 2018 at 02:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191369">@Andy Stechishin</span> Unfortunately I can't make that session, which is why I'm sharing my concerns now.  I think the risk of leaving it non-normative is low.  If we are going to take it normative, I think we need to establish why we think the FMM level rules should be waived, at least in part.  Out of curiousity, what management group is responsible for FHIRPath?</p>



<a name="153927918"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927918" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927918">(Jan 08 2018 at 03:04)</a>:</h4>
<p>it is in the FHIR product family. I don't think we've really talked about the difference between FMG scope and FHIR product family</p>



<a name="153927919"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927919" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927919">(Jan 08 2018 at 03:08)</a>:</h4>
<p>Something for the TSC to discuss?  (And perhaps for the FMG and other management groups to share their thoughts on?)</p>



<a name="153927920"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927920" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927920">(Jan 08 2018 at 03:09)</a>:</h4>
<p><span class="user-mention" data-user-id="191690">@Anne Wizauer</span> Can you tentatively add this to the next FMG agenda?</p>



<a name="153927921"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927921" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Nelson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927921">(Jan 08 2018 at 03:12)</a>:</h4>
<p>Actually, I would believe that FHIRPath is broader than FHIR and resides outside of FMG. Recall the name of the product was only b/c of copyrights not b/c it was a FHIR-specific language</p>



<a name="153927922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927922">(Jan 08 2018 at 03:12)</a>:</h4>
<p>that's correct. But it's still in the FHIR Product family.</p>



<a name="153927923"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927923" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Nelson <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927923">(Jan 08 2018 at 03:18)</a>:</h4>
<p>So yes, FMG can share thoughts as you say, also V2, CQI, SDTC etc - but the decision on normative readiness would not be based on the FMM criteria.</p>



<a name="153927952"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153927952" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anne Wizauer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153927952">(Jan 08 2018 at 14:35)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="191690">@Anne Wizauer</span> Can you tentatively add this to the next FMG agenda?</p>
</blockquote>
<p>Sure thing!</p>



<a name="153928174"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153928174" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153928174">(Jan 09 2018 at 22:05)</a>:</h4>
<p>please, split FHIRpath into simple core and set of extensions (like time operators etc)</p>



<a name="153928175"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153928175" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153928175">(Jan 09 2018 at 22:10)</a>:</h4>
<p>why?</p>



<a name="153928845"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153928845" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153928845">(Jan 15 2018 at 12:43)</a>:</h4>
<p><span class="user-mention" data-user-id="191318">@nicola (RIO/SS)</span>, are you referring to our previous discussion on subsets of FHIRPath?: a simple subset to use in Discriminators, a subset for searches etc.  I think the invariants may want to use everything there is, but I can imaginge some useful subsets.</p>



<a name="153928846"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/153928846" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ewout Kramer <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#153928846">(Jan 15 2018 at 12:45)</a>:</h4>
<p>Then, about FHIRPath language extensions. You mentioned "sum()".  One of the major "usual" operations that come with these kind of languages is fold/aggregate (of which sum() would be a specialization).  We might need to talk about whether we just stick to sum() or take a look at fold() (though that would need lambda notation in the language, now we're talking major changes).</p>



<a name="165149330"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/165149330" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katarina <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#165149330">(May 08 2019 at 10:01)</a>:</h4>
<p>I want to set a constraint for a practitioner's name (German base profile). With fhirpath I would like to express that at least one name should be official (use = "official"). I have formulated the following fhirpath expression: (use = 'official').count ()&gt; 0 . When I validate an example practitioner that does not have a name with use=official, I expect an error, but there is no. Can anyone help me with fhirpath expression?</p>



<a name="165149591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/165149591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> nicola (RIO/SS) <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#165149591">(May 08 2019 at 10:06)</a>:</h4>
<p><span class="user-mention" data-user-id="191328">@Ewout Kramer</span>  i think we have to wait for more database-oriented people to start this subset - I would define it as efficient FHIRpath subset for data extraction to index and search FHIR resources. For DSL I think it's ok to have min, max, sum and avg as built-ins (for performance reason)</p>



<a name="165150275"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/165150275" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#165150275">(May 08 2019 at 10:19)</a>:</h4>
<p><span class="user-mention" data-user-id="221154">@Katarina</span> I expect that to work - whatever the problem is not in the FHIRPath statement. Can you turn it into a profile / instance combination and submit an issue so I can look at it?</p>



<a name="165164213"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/165164213" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katarina <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#165164213">(May 08 2019 at 13:47)</a>:</h4>
<p>@ Grahame Grieve Thanks for your feedback. My profile looks like this:</p>
<p>&lt;StructureDefinition xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
&lt;url value="https://example.de/fhir/StructureDefinition/MyPractitioner"/&gt;<br>
&lt;name value="MyPractitioner"/&gt;<br>
&lt;status value="draft"/&gt;<br>
&lt;fhirVersion value="3.0.1"/&gt;<br>
&lt;kind value="resource"/&gt;<br>
&lt;abstract value="false"/&gt;<br>
&lt;type value="Practitioner"/&gt;<br>
&lt;baseDefinition value="http://fhir.de/StructureDefinition/practitioner-de-basis/0.2"/&gt;<br>
&lt;derivation value="constraint"/&gt;<br>
 &lt;differential&gt;<br>
 &lt;element id="<a href="http://Practitioner.name" target="_blank" title="http://Practitioner.name">Practitioner.name</a>"&gt;<br>
&lt;path value="Practitioner.name"/&gt;<br>
&lt;min value="1"/&gt;<br>
 &lt;constraint&gt;<br>
&lt;key value="oneOfficialName"/&gt;<br>
&lt;severity value="error"/&gt;<br>
&lt;human value="One name must be official."/&gt;<br>
&lt;expression value="(use='official').count()&gt;0"/&gt;<br>
&lt;/constraint&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.name.family"&gt;<br>
&lt;path value="Practitioner.name.family"/&gt;<br>
&lt;min value="1"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.name.given"&gt;<br>
&lt;path value="Practitioner.name.given"/&gt;<br>
&lt;min value="1"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.address"&gt;<br>
&lt;path value="Practitioner.address"/&gt;<br>
&lt;min value="1"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.address.use"&gt;<br>
&lt;path value="Practitioner.address.use"/&gt;<br>
&lt;fixedCode value="work"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.address.type"&gt;<br>
&lt;path value="Practitioner.address.type"/&gt;<br>
&lt;fixedCode value="physical"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.address.line.extension:Postfach"&gt;<br>
&lt;path value="Practitioner.address.line.extension"/&gt;<br>
&lt;sliceName value="Postfach"/&gt;<br>
&lt;max value="0"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.address.state"&gt;<br>
&lt;path value="Practitioner.address.state"/&gt;<br>
 &lt;binding&gt;<br>
&lt;strength value="required"/&gt;<br>
&lt;description value="Bundesländer"/&gt;<br>
&lt;/binding&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.address.postalCode"&gt;<br>
&lt;path value="Practitioner.address.postalCode"/&gt;<br>
&lt;min value="1"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.address.country"&gt;<br>
&lt;path value="Practitioner.address.country"/&gt;<br>
&lt;min value="1"/&gt;<br>
 &lt;binding&gt;<br>
&lt;strength value="required"/&gt;<br>
&lt;/binding&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.gender"&gt;<br>
&lt;path value="Practitioner.gender"/&gt;<br>
&lt;max value="0"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.birthDate"&gt;<br>
&lt;path value="Practitioner.birthDate"/&gt;<br>
&lt;max value="0"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.photo"&gt;<br>
&lt;path value="Practitioner.photo"/&gt;<br>
&lt;max value="0"/&gt;<br>
&lt;/element&gt;<br>
 &lt;element id="Practitioner.communication"&gt;<br>
&lt;path value="Practitioner.communication"/&gt;<br>
&lt;max value="0"/&gt;<br>
&lt;/element&gt;<br>
&lt;/differential&gt;<br>
&lt;/StructureDefinition&gt;</p>
<p>And my example:</p>
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>
&lt;Practitioner xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
    &lt;meta&gt;<br>
        &lt;profile value = "https://example.de/fhir/StructureDefinition/MyPractitioner"/&gt;<br>
    &lt;/meta&gt;<br>
    &lt;active value="true"/&gt;<br>
    &lt;name&gt;<br>
        &lt;use value = "temp"/&gt;<br>
        &lt;family value="Meier"/&gt;<br>
        &lt;given value="Maria"/&gt;<br>
        &lt;given value="Anna"/&gt;<br>
        &lt;prefix value = "Dr.med."/&gt;<br>
    &lt;/name&gt;<br>
    &lt;name&gt;<br>
        &lt;use value = "maiden"/&gt;<br>
        &lt;family value="Müller"/&gt;<br>
        &lt;given value="Maria"/&gt;<br>
        &lt;given value="Anna"/&gt;<br>
        &lt;prefix value = "Dr.med."/&gt;<br>
    &lt;/name&gt;<br>
    &lt;telecom&gt;<br>
        &lt;system value="phone" /&gt;      <br>
        &lt;value value= "030-1234567"/&gt;<br>
        &lt;use value = "work"/&gt;<br>
    &lt;/telecom&gt;<br>
    &lt;telecom&gt;<br>
        &lt;system value="email" /&gt;      <br>
        &lt;value value= "meierA@hno.de"/&gt;<br>
        &lt;use value = "work"/&gt;<br>
    &lt;/telecom&gt;<br>
    &lt;address&gt;<br>
        &lt;use value = "work"/&gt;<br>
        &lt;type value = "physical"/&gt;<br>
        &lt;postalCode value = "10117"/&gt;<br>
        &lt;country value = "DE"/&gt;<br>
        &lt;state value = "DE-BE"/&gt;<br>
    &lt;/address&gt;<br>
&lt;/Practitioner&gt;</p>



<a name="186298194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/186298194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#186298194">(Jan 22 2020 at 15:43)</a>:</h4>
<p>Want to be sure I'm reading this correctly. <br>
Have this fhirpath expression:<br>
      &lt;expression value="Xor(Observation.valueCodeableConcept.exists(), Observation.dataAbsentReason.exists())"/&gt;<br>
Get:<br>
      Exception in thread "main" java.lang.Error: Not done yet (ValidatorHostServices.resolveFunction): Xor<br>
This means not implemented? Or is something else going on?</p>



<a name="186312362"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/186312362" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Lynch <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#186312362">(Jan 22 2020 at 18:00)</a>:</h4>
<p>I am not sure this is the problem, but I think "xor" should be all lowercase.</p>



<a name="186328190"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/186328190" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#186328190">(Jan 22 2020 at 20:36)</a>:</h4>
<p>Thanks, but that's not it:<br>
Exception in thread "main" java.lang.Error: Not done yet (ValidatorHostServices.resolveFunction): xor<br>
Have a workaround, so moving on...</p>



<a name="186328288"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/186328288" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#186328288">(Jan 22 2020 at 20:37)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="186333259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/186333259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#186333259">(Jan 22 2020 at 21:32)</a>:</h4>
<p>xor is an operator not a function</p>



<a name="186341926"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/186341926" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Mays <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#186341926">(Jan 22 2020 at 23:17)</a>:</h4>
<p>Thanks. Got it. Ooops...</p>



<a name="188723916"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/188723916" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katarina <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#188723916">(Feb 21 2020 at 11:36)</a>:</h4>
<p>Hi, I have the following usecase: I have an extension that is a reference to an organization profile. For the organization the type has a valueSet binding. I would like to make restrictions on the organizations that can be referenced. How would I write a fhirpath constraint to say that in the extension only organizations can be referenced for these only a restricted valueSet is valid?</p>
<p>My Organization profile with valueSet binding:</p>
<p>&lt;?xml version="1.0" encoding="utf-8"?&gt;<br>
&lt;StructureDefinition xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
  &lt;url value="<a href="https://example/fhir/StructureDefinition/Facility" target="_blank" title="https://example/fhir/StructureDefinition/Facility">https://example/fhir/StructureDefinition/Facility</a>" /&gt;<br>
  &lt;name value="Facility" /&gt;<br>
  &lt;status value="draft" /&gt;<br>
  &lt;fhirVersion value="3.0.1" /&gt;<br>
  &lt;kind value="resource" /&gt;<br>
  &lt;abstract value="false" /&gt;<br>
  &lt;type value="Organization" /&gt;<br>
  &lt;baseDefinition value="<a href="http://fhir.de/StructureDefinition/organization-de-basis/0.2" target="_blank" title="http://fhir.de/StructureDefinition/organization-de-basis/0.2">http://fhir.de/StructureDefinition/organization-de-basis/0.2</a>" /&gt;<br>
  &lt;derivation value="constraint" /&gt;<br>
  &lt;differential&gt;<br>
    &lt;element id="Organization.type"&gt;<br>
      &lt;path value="Organization.type" /&gt;<br>
      &lt;min value="1" /&gt;<br>
      &lt;max value="1" /&gt;<br>
    &lt;/element&gt;<br>
    &lt;element id="Organization.type.coding"&gt;<br>
      &lt;path value="Organization.type.coding" /&gt;<br>
      &lt;min value="1" /&gt;<br>
      &lt;max value="1" /&gt;<br>
    &lt;/element&gt;<br>
    &lt;element id="Organization.type.coding.system"&gt;<br>
      &lt;path value="Organization.type.coding.system" /&gt;<br>
      &lt;min value="1" /&gt;<br>
      &lt;binding&gt;<br>
        &lt;strength value="required" /&gt;<br>
        &lt;valueSetUri value="<a href="https://example/fhir/ValueSet/facilityType" target="_blank" title="https://example/fhir/ValueSet/facilityType">https://example/fhir/ValueSet/facilityType</a>" /&gt;<br>
      &lt;/binding&gt;<br>
    &lt;/element&gt;<br>
    &lt;element id="Organization.type.coding.code"&gt;<br>
      &lt;path value="Organization.type.coding.code" /&gt;<br>
      &lt;min value="1" /&gt;<br>
    &lt;/element&gt;<br>
  &lt;/differential&gt;<br>
&lt;/StructureDefinition&gt;</p>
<p>Usage of the extension:<br>
&lt;Bundle xmlns="<a href="http://hl7.org/fhir" target="_blank" title="http://hl7.org/fhir">http://hl7.org/fhir</a>"&gt;<br>
    &lt;type value="document" /&gt;<br>
    &lt;entry&gt;<br>
        &lt;resource&gt;<br>
            &lt;Composition&gt;<br>
                ...<br>
                &lt;extension url="<a href="https://example/fhir/StructureDefinition/IsCaredIn" target="_blank" title="https://example/fhir/StructureDefinition/IsCaredIn">https://example/fhir/StructureDefinition/IsCaredIn</a>"&gt;<br>
                    &lt;extension url="organization" &gt;<br>
                        &lt;valueReference&gt;<br>
                            &lt;reference value="urn:uuid:61ebe359-bfdc-4613-8bf2-c5e300945f22" /&gt;<br>
                        &lt;/valueReference&gt;<br>
                    &lt;/extension&gt;<br>
                &lt;/extension&gt;<br>
            &lt;/Composition&gt;<br>
        &lt;/resource&gt;<br>
    &lt;/entry&gt;<br>
    &lt;entry&gt;<br>
        &lt;fullUrl value="urn:uuid:61ebe359-bfdc-4613-8bf2-c5e300945f22" /&gt;<br>
        &lt;resource&gt;<br>
            &lt;Organization&gt;<br>
                &lt;meta&gt;<br>
                    &lt;profile value="<a href="https://example/fhir/StructureDefinition/Facility" target="_blank" title="https://example/fhir/StructureDefinition/Facility">https://example/fhir/StructureDefinition/Facility</a>" /&gt;<br>
                &lt;/meta&gt;<br>
                &lt;name value="Waldkindergarten"/&gt;<br>
<strong>here not every code in <a href="https://example/fhir/ValueSet/facilityType" target="_blank" title="https://example/fhir/ValueSet/facilityType">https://example/fhir/ValueSet/facilityType</a> should be allowed, only a specific set</strong><br>
            &lt;/Organization&gt;<br>
        &lt;/resource&gt;<br>
    &lt;/entry&gt;<br>
&lt;/Bundle&gt;</p>
<p>Is fhirpath the right way or are there other possibilities?</p>



<a name="188755801"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/188755801" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#188755801">(Feb 21 2020 at 17:44)</a>:</h4>
<p>It seems that you would just declare a targetProfile for the reference indicating that the Organization needs to be valid against the specified profile</p>



<a name="189099392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/189099392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katarina <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#189099392">(Feb 26 2020 at 09:52)</a>:</h4>
<p>Hi, how can I get the valueReference in a complex extension with fhirpath?</p>
<p>I tried this: <br>
Composition.where(extension('https://example/fhir/StructureDefinition/IsCaredIn')).children().where(extension('organization').value='12345')</p>
<p>My Composition looks like this:<br>
            &lt;Composition&gt;<br>
                                ...<br>
                &lt;extension url="<a href="https://example/fhir/StructureDefinition/IsCaredIn" target="_blank" title="https://example/fhir/StructureDefinition/IsCaredIn">https://example/fhir/StructureDefinition/IsCaredIn</a>"&gt;<br>
                      &lt;extension url="groupInOrganization" &gt;<br>
                        &lt;valueString value="Spechte und Käuze" /&gt;<br>
                      &lt;/extension&gt;<br>
                          &lt;extension url="lastStayInOrganization" &gt;<br>
                         &lt;valueDate value="2020-02-02" /&gt;   <br>
                          &lt;/extension&gt;<br>
                          &lt;extension url="organization" &gt;<br>
                        &lt;valueReference&gt;<br>
                            &lt;reference value="12345" /&gt;<br>
                        &lt;/valueReference&gt;<br>
                    &lt;/extension&gt;<br>
                &lt;/extension&gt;<br>
            &lt;/Composition&gt;</p>



<a name="189099687"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/189099687" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katarina <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#189099687">(Feb 26 2020 at 09:57)</a>:</h4>
<p>And another question:</p>
<p>"Bundle.entry.resource.ofType(Composition)" should bring all Composition-entries in the bundle, right?<br>
I have three compositions in the bundle, but "Bundle.entry.resource.ofType(Composition).count()=3" does not validate in true. What am I doing wrong?</p>



<a name="189130234"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/189130234" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#189130234">(Feb 26 2020 at 16:25)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="189152888"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/189152888" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#189152888">(Feb 26 2020 at 20:03)</a>:</h4>
<p>The extension is a reference, so that it will have the structure of a <a href="http://hl7.org/fhir/references.html#Reference" target="_blank" title="http://hl7.org/fhir/references.html#Reference">Reference</a>, so you need to dig in to the actual <code>reference</code> element: <code>...extension('organization').value.reference='12345'</code></p>



<a name="189153386"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/189153386" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#189153386">(Feb 26 2020 at 20:07)</a>:</h4>
<p>On the second one, that seems like that ought to work, but I wonder if it's getting tripped up by the way resource elements are actually serialized. Can you try <code>Bundle.entry.where(resource is Composition).count() = 3</code>?</p>



<a name="189226117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/189226117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katarina <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#189226117">(Feb 27 2020 at 15:55)</a>:</h4>
<p>Hi, thank you <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  that worked!. </p>
<p>How can I check if the type of an Organization is within a valueSet?</p>
<p>This seems not to work:<br>
entry.where(fullUrl='urn:uuid:61ebe359-bfdc-4613-8bf2-c5e300945f22').select(resource as Organization).type.coding.code.memberOf('<a href="https://example/fhir/ValueSet/organizationTypesCaredIn" target="_blank" title="https://example/fhir/ValueSet/organizationTypesCaredIn">https://example/fhir/ValueSet/organizationTypesCaredIn</a>')</p>
<p>also </p>
<p>...type.coding.code='code1'  seems not to work.</p>



<a name="189324782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/189324782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#189324782">(Feb 28 2020 at 16:21)</a>:</h4>
<p>Hmm... that seems like that memberOf ought to work, what environment are you running the FHIRPath in?</p>



<a name="189475317"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/189475317" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Katarina <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#189475317">(Mar 02 2020 at 09:39)</a>:</h4>
<p>I use Vonk.Server/3.1.1. </p>
<p>My Organization looks like this:<br>
            &lt;Organization&gt;<br>
                &lt;id value="23"/&gt;<br>
                &lt;meta&gt;<br>
                    &lt;profile value="<a href="https://example/fhir/StructureDefinition/Facility" target="_blank" title="https://example/fhir/StructureDefinition/Facility">https://example/fhir/StructureDefinition/Facility</a>" /&gt;<br>
                &lt;/meta&gt;<br>
                &lt;name value="Waldkindergarten"/&gt;<br>
                  &lt;type&gt; <br>
                    &lt;coding&gt; <br>
                         &lt;system value="https://example/fhir/ValueSet/organizationTypesCaredIn"/&gt; <br>
                         &lt;code value="foodfacility"/&gt; <br>
                        &lt;/coding&gt; <br>
                  &lt;/type&gt;<br>
            &lt;/Organization&gt;</p>
<p>I checked the CodeSystem organizationType that contains "foodfacility" and the corresponding ValueSet.<br>
But I get an error no matter if i put "foodfacility" as value for code or some other value not contained in the ValueSet.</p>



<a name="197897803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/197897803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikhil <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#197897803">(May 18 2020 at 07:17)</a>:</h4>
<p>Hi,</p>
<p>Needed a clarification regarding the FHIRPath expression defined in SearchParameter for value[x] parameters.</p>
<p>The expression for searchparameter to search a value[x] field should have all possible variants allowed for seach ?<br>
for example, As of now the FHIRPath expression for the field CarePlan-&gt;activity-&gt;detail-&gt;scheduled  is defined as</p>
<ol>
<li>
<p>"CarePlan.activity.detail.scheduled" <br>
OR</p>
</li>
<li>
<p>"CarePlan.activity.detail.scheduled as Timing | CarePlan.activity.detail.scheduled as Period | CarePlan.activity.detail.scheduled as string" ?</p>
</li>
</ol>



<a name="199445559"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199445559" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199445559">(Jun 02 2020 at 02:47)</a>:</h4>
<p>What is 'System' referred in System.String? It basically points to the datatype of the language we implement it. Can someone help?</p>



<a name="199449308"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199449308" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199449308">(Jun 02 2020 at 04:24)</a>:</h4>
<p>Are you asking about Resource.language? <a href="http://hl7.org/fhir/R4/resource.html#Resource">http://hl7.org/fhir/R4/resource.html#Resource</a><br>
What do you want to know?</p>



<a name="199450063"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199450063" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199450063">(Jun 02 2020 at 04:42)</a>:</h4>
<p>When i read the FHIRPath specification, I saw about FHIRPath type that talks about</p>



<a name="199450065"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199450065" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199450065">(Jun 02 2020 at 04:42)</a>:</h4>
<p>The evaluation engine will automatically convert the value of FHIR types representing primitives to FHIRPath types when they are used in expressions according to the following mapping:</p>



<a name="199450093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199450093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199450093">(Jun 02 2020 at 04:43)</a>:</h4>
<p>FHIRPath type represents different values : System.Boolean, System.String, System.Integer</p>



<a name="199450095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199450095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199450095">(Jun 02 2020 at 04:43)</a>:</h4>
<p>What does System refer to?</p>



<a name="199450193"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199450193" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199450193">(Jun 02 2020 at 04:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191359">@Bryn Rhodes</span></p>



<a name="199451506"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199451506" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199451506">(Jun 02 2020 at 05:22)</a>:</h4>
<p>The System namespace is used to define all the system-defined types in FHIRPath (and CQL). The <a href="http://hl7.org/fhirpath/#models">models</a> topic in FHIRPath talks about the System namespace.</p>



<a name="199471207"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/199471207" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Keerthivasan Ramanathan <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#199471207">(Jun 02 2020 at 10:09)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span> and <span class="user-mention" data-user-id="191320">@Lloyd McKenzie</span></p>



<a name="243521968"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/243521968" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grey Faulkenberry <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#243521968">(Jun 22 2021 at 14:10)</a>:</h4>
<p>Quick question about the FHIRPath spec on the hl7 site. I was just wondering if one of the lines is misplaced.<br>
<a href="http://hl7.org/fhirpath/#todate-date">toDate() : Date</a> It states nothing about partial dates<br>
<a href="http://hl7.org/fhirpath/#convertstodate-boolean">convertsToDate() : Boolean</a> it states "If the item contains a partial date (e.g. '2012-01'), the result is a partial date."<br>
<a href="http://hl7.org/fhirpath/#todatetime-datetime">toDateTime() : DateTime</a> it states "If the item contains a partial datetime (e.g. '2012-01-01T10:00'), the result is a partial datetime."<br>
<a href="http://hl7.org/fhirpath/#convertstodatetime-boolean">convertsToDateTime() : Boolean</a> it states nothing about partial dateTimes</p>



<a name="243525497"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/243525497" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#243525497">(Jun 22 2021 at 14:32)</a>:</h4>
<p>can you ask this on <a class="stream" data-stream-id="179266" href="/#narrow/stream/179266-fhirpath">#fhirpath</a></p>



<a name="267670635"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/267670635" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gabriela Espinosa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#267670635">(Jan 12 2022 at 01:11)</a>:</h4>
<p>I have a question about restricting one of multiple types of references allowed. For an Observation.basedOn field which allows multiple references, I would like to define a requirement where a reference to a specific profile should only be allowed once. Other references to other profiles should still be valid. Is there a way to express this? I have not been able to find an example or the right syntax.</p>



<a name="267677938"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/267677938" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#267677938">(Jan 12 2022 at 03:19)</a>:</h4>
<p>To check whether the is only one use count().<br>
The following test will return true with 0 or 1 matching instances of basedOn.display and false otherwise.<br>
<code>basedOn.where(display='HHH').count()&lt;=1</code></p>



<a name="267678291"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/267678291" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#267678291">(Jan 12 2022 at 03:25)</a>:</h4>
<p>Why do you want to ensure that at most one referent conforms to the profile? Is it enough to say that only 1 referent of a resource type is allowed, e.g. at most one CarePlan?</p>



<a name="267678706"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/267678706" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Townley-O&#x27;Neill <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#267678706">(Jan 12 2022 at 03:32)</a>:</h4>
<p>To follow a reference use the <code>resolve()</code> function</p>



<a name="267680094"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/267680094" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#267680094">(Jan 12 2022 at 03:58)</a>:</h4>
<p>You can also slice by profile and set a max cardinality of 1 on your slice</p>



<a name="267766326"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath/near/267766326" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gabriela Espinosa <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.html#267766326">(Jan 12 2022 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179166-implementers/topic/FHIRPath/near/267680094">said</a>:</p>
<blockquote>
<p>You can also slice by profile and set a max cardinality of 1 on your slice</p>
</blockquote>
<p>I like the idea of adding a slice for the particular reference and setting the cardinality there. Thanks for the feedback!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
