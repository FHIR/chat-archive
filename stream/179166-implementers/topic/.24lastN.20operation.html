---
layout: page
title: "FHIR Chat  · $lastN operation · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html">$lastN operation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153897609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153897609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153897609">(Jul 21 2017 at 10:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191401">@Eric Haas</span> I'm looking at implementing the $lastN operation in my server. I'm feeling that it's a little underspecified. All your examples include a category parameter, but it doesn't say that the category parameter is mandatory. But what would you return with a category? maybe you could list a set of codes instead of a category? but you must do one or other (and not both?)</p>



<a name="153897688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153897688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153897688">(Jul 21 2017 at 14:12)</a>:</h4>
<p>the specification also says nothing about whether the last n observations is the last n good observations, or whether errors are included as well</p>



<a name="153898498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898498">(Jul 26 2017 at 22:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191401">@Eric Haas</span> ping</p>



<a name="153898499"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898499" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898499">(Jul 26 2017 at 22:26)</a>:</h4>
<p>"But what would you return with a category" should have been "But what would you return without a category"</p>



<a name="153898527"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898527" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898527">(Jul 26 2017 at 23:44)</a>:</h4>
<p>"All your examples include a category parameter, but it doesn't say that the category parameter is mandatory. But what would you return with a category? maybe you could list a set of codes instead of a category? but you must do one or other (and not both?)"  ?  </p>
<p>do you mean "But what would you return without a category?"</p>
<p>I don't think a category should be mandatory since is not mandatory in underlying resource....</p>



<a name="153898530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898530">(Jul 26 2017 at 23:46)</a>:</h4>
<p>if the client asks for lastN without a category, what's the server supposed to return?</p>



<a name="153898532"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898532" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898532">(Jul 26 2017 at 23:54)</a>:</h4>
<p>the last N observations across all categories - essentially ignoring the category as a filter.</p>



<a name="153898533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898533">(Jul 26 2017 at 23:54)</a>:</h4>
<p>all kinds of observations? 1000s of them?</p>



<a name="153898534"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898534" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898534">(Jul 26 2017 at 23:56)</a>:</h4>
<p>I agree without a code or a category is confusing.  <span class="user-mention" data-user-id="191356">@Jenni Syed</span> ?</p>



<a name="153898535"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898535" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898535">(Jul 26 2017 at 23:59)</a>:</h4>
<p>I don't think there are 1000s of categories.  More than likely &lt;20</p>



<a name="153898536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898536">(Jul 27 2017 at 00:00)</a>:</h4>
<p>there's 1000s of observation codes</p>



<a name="153898537"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898537" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898537">(Jul 27 2017 at 00:01)</a>:</h4>
<p>I think the client should have to specify a list of codes or a category</p>



<a name="153898538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898538">(Jul 27 2017 at 00:01)</a>:</h4>
<p>but there will be 1000s within a single category too?</p>



<a name="153898539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898539">(Jul 27 2017 at 00:02)</a>:</h4>
<p>well, that's a different problem. What should happen? I don't think it's useful to fetch the last 5 results for each kind of lab result. that's kind of a lot of results</p>



<a name="153898540"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898540" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898540">(Jul 27 2017 at 00:06)</a>:</h4>
<p>I think is unlikely a single patient will have that many unique labs done.  maybe dozens.   I should make it clear that a subject is required though.</p>



<a name="153898541"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898541" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898541">(Jul 27 2017 at 00:09)</a>:</h4>
<p>Will add restriction that</p>
<p>a) Subject required<br>
b) code(s) or category(s) required.</p>



<a name="153898542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898542">(Jul 27 2017 at 00:10)</a>:</h4>
<p>And see how works in Connectathon</p>



<a name="153898543"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898543" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898543">(Jul 27 2017 at 00:12)</a>:</h4>
<p>dozens? take an ICU patient.... (likely substrate for lastN operation)</p>



<a name="153898544"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898544" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898544">(Jul 27 2017 at 00:13)</a>:</h4>
<p>E&amp;Us, LFTS, calcium, full blood screen, blood gases, glucose, infection control monitoring... we're already out past 50 tests before we get to anything really disease specific</p>



<a name="153898545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898545">(Jul 27 2017 at 00:13)</a>:</h4>
<blockquote>
<p>the specification also says nothing about whether the last n observations is the last n good observations, or whether errors are included as well</p>
</blockquote>
<p>What do you mean status = "entered in error"   If so I would say yes include those will ask at connectathon</p>



<a name="153898546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898546">(Jul 27 2017 at 00:14)</a>:</h4>
<p>and likely they'll have extensive work ups for enodocrine or cardiac stuff...</p>



<a name="153898547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898547">(Jul 27 2017 at 00:14)</a>:</h4>
<p>I'll include entered in error etc</p>



<a name="153898548"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898548" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898548">(Jul 27 2017 at 00:20)</a>:</h4>
<p>Agree that the sickest will have hundreds of tests... but the consumer isn't being picky they want to scan the results for what they need and they won't know a priori what tests to ask for...</p>



<a name="153898594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153898594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153898594">(Jul 27 2017 at 01:23)</a>:</h4>
<p>If you're worried about volume, set N to 1 and constrain the timeframe to the last year or so.  That should be a manageable set.  You can then probe deeper on the ones of interest.</p>



<a name="153899561"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899561" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899561">(Jul 30 2017 at 06:16)</a>:</h4>
<p>i'm back looking at this. this is hard.</p>



<a name="153899562"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899562" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899562">(Jul 30 2017 at 06:17)</a>:</h4>
<p>According to the operation definition:</p>



<a name="153899563"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899563" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899563">(Jul 30 2017 at 06:17)</a>:</h4>
<p>The response from a lastn query is a set of observations:<br>
- filtered by additional parameters<br>
- 'GROUP BY' Observation.code<br>
- sorted from most recent to the oldest</p>



<a name="153899564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899564">(Jul 30 2017 at 06:17)</a>:</h4>
<p>what does it mean to group by a <em>CodeableConcept</em>?</p>



<a name="153899565"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899565" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899565">(Jul 30 2017 at 06:18)</a>:</h4>
<p>what happens if there's more than one coding in there? What happens if the codings differ? are they in the group?</p>



<a name="153899566"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899566" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899566">(Jul 30 2017 at 06:18)</a>:</h4>
<p>what if there's no codings, and just a text?</p>



<a name="153899572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899572">(Jul 30 2017 at 08:19)</a>:</h4>
<p>Is there a definition of equality for CodeableConcept? For CQL, we defined it as the intersection of codings is non-empty, though it should probably be tweaked a bit to take the text into account when there are no codings.</p>



<a name="153899573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899573">(Jul 30 2017 at 08:21)</a>:</h4>
<p>it's not clear to me that you want to group by the 'intersection is non-empty'</p>



<a name="153899574"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899574" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899574">(Jul 30 2017 at 08:22)</a>:</h4>
<p>Isn't that what it would mean for two CodeableConcepts to be equal?</p>



<a name="153899575"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899575" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899575">(Jul 30 2017 at 08:23)</a>:</h4>
<p>I think for the group by case it might be useful to aggregate all the codings into the resulting CodeableConcept, but that would just be a nice-to-have.</p>



<a name="153899596"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899596" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899596">(Jul 30 2017 at 19:50)</a>:</h4>
<p>"'GROUP BY' Observation.code  "  When I wrote that I was thinking  that you would  consider all codings to be equals so.</p>



<a name="153899597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899597">(Jul 30 2017 at 19:50)</a>:</h4>
<p>So maybe we need to have to nominate a code system to group by?</p>



<a name="153899600"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899600" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899600">(Jul 30 2017 at 19:56)</a>:</h4>
<p><span class="user-mention" data-user-id="191356">@Jenni Syed</span> ?</p>



<a name="153899603"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899603" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899603">(Jul 30 2017 at 20:14)</a>:</h4>
<p>even nominating a code system doesn't solve it - observations might have more than one LOINC code, for example</p>



<a name="153899605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899605">(Jul 30 2017 at 20:33)</a>:</h4>
<p>But in that case they would be different CodeableConcepts, right?</p>



<a name="153899607"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899607" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899607">(Jul 30 2017 at 20:51)</a>:</h4>
<p>no you might translate a more specific LOINC to a general one.</p>



<a name="153899608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899608">(Jul 30 2017 at 21:03)</a>:</h4>
<p>I assume we are  talking about when there  are no codes given in the input query.    In that case, I think Bryn's approach make's sense from the consumer aspect.  I don't want to be looking at duplicate results just because one set is LOINC and the other a local code system.   If there a codings then they are translations and can group the results based their 'translational equivalence'.</p>



<a name="153899609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899609">(Jul 30 2017 at 21:04)</a>:</h4>
<p>In re to text only -   they are grouped based on exact string matches.   no way to get around that one.</p>



<a name="153899610"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899610" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899610">(Jul 30 2017 at 21:04)</a>:</h4>
<p>Hope to hear from Jenni</p>



<a name="153899616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899616">(Jul 30 2017 at 22:09)</a>:</h4>
<p>well, from my perspective, this operation is too hard to implement. I figure that server implementers are going to be in one of 2 situations<br>
- a server like mine, that is purely based on FHIR. I don't know how to group consistently, unless the client specifically nominates a group=code,code,code that defines how they want the grouping to work<br>
- an existing EHR that already has grouping capability, based on their own internal structures. This EHR can group however they can already group, but they'll have little capability to vary their grouping or filtering as envisaged in the operation</p>



<a name="153899617"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899617" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899617">(Jul 30 2017 at 22:09)</a>:</h4>
<p>the combination of 'any search parameter' + group by a repeating element is a lethal combination in terms of semantics and engineering efficiency</p>



<a name="153899621"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899621" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899621">(Jul 30 2017 at 22:39)</a>:</h4>
<p>There's a real simple way for me to implement this functionality but it's loosely controlled and I don't know whether the fact that it's easy is an accident of my implementation, but:</p>



<a name="153899622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899622">(Jul 30 2017 at 22:43)</a>:</h4>
<ul>
<li>we already document that sort works this way: "A search parameter can refer to an element that repeats, and therefore there can be multiple values for a given search parameter for a single resource. In this case, the sort is based on the item in the set of multiple parameters that comes earliest in the specified sort order when ordering the returned resources"</li>
<li>I can group by the sort parameter very easily, and return the top N results per group. It's a walk in the park....</li>
<li>but: sort order earliest is not defined for Codings, and it's just random in my system</li>
</ul>



<a name="153899723"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899723" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899723">(Jul 31 2017 at 20:47)</a>:</h4>
<p>I agree that we should define equality for a codeable concept. I'll dig into what this is in my system right now, but I'm betting it's by the "user chosen" code. In our case, proprietary.</p>



<a name="153899724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899724">(Jul 31 2017 at 20:47)</a>:</h4>
<p>However, we could implement in FHIR in other ways, most likely (eg: via intersection?)</p>



<a name="153899725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899725">(Jul 31 2017 at 20:48)</a>:</h4>
<p>We do support either category or code essentially in our system, as the filter. You would need one of those. We haven't defined how it would work for SHx yet in our system, that was something I was looking forward to playing with/discussing at the connectathon.</p>



<a name="153899727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899727">(Jul 31 2017 at 20:49)</a>:</h4>
<p>I think it's important to figure out how to do this, it's probably one of the most asked for pieces of functionality we have been waiting on, and one of the most used within our system</p>



<a name="153899729"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899729" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899729">(Jul 31 2017 at 20:50)</a>:</h4>
<p>For viewing things qualified as "observations" :)</p>



<a name="153899730"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899730" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899730">(Jul 31 2017 at 20:50)</a>:</h4>
<p>I would be surprised if we're the only system that has something like this. If that's true... very important to know</p>



<a name="153899744"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899744" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899744">(Jul 31 2017 at 21:49)</a>:</h4>
<p>but do you support other filters than that? could I cross patients? could I filter out to a data range? the lastN operation as it is applies over the top of an observation search. It's the combination that bites - I can't prepare a special table for it, because it applies to the outcomes of a special search. And I don't know how to generate it on the fly</p>



<a name="153899746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899746">(Jul 31 2017 at 21:50)</a>:</h4>
<p>and i'm not sure the definition of equality helps - if some observations are coded with a LOINC code and an MDC code, and some just have the LOINC code, do you want them separate in the groups  even though they are the same LOINC code? but in other cases, the presence of an MDC code very definitely makes a difference</p>



<a name="153899747"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899747" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899747">(Jul 31 2017 at 21:56)</a>:</h4>
<p>I'd say yes to that last question.  Like I said before the consumer of the information doesn't want to have to look at repeats for the same information and have to figure it out.  That is the purpose of the whole operation and  why the grouping is key to the operation.   I think the Category element  or device filter would be used if that is important.</p>



<a name="153899749"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899749" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899749">(Jul 31 2017 at 22:01)</a>:</h4>
<p>yes to which option? and I don't see how your comment clarifies</p>



<a name="153899754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899754">(Jul 31 2017 at 22:07)</a>:</h4>
<p>To answer some of the filters: I will say that in our system, you can't cross patients for most clinical queries. This is true for  this "operation" within our EHR as well</p>



<a name="153899756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899756">(Jul 31 2017 at 22:19)</a>:</h4>
<p>oops I misread the question </p>
<p>" i'm not sure the definition of equality helps - if some observations are coded with a LOINC code and an MDC code, and some just have the LOINC code, do you want them separate in the groups even though they are the same LOINC code?"</p>
<p>answer is NO  -  they should be  in same group and  that is what I think Bryn meant "intersection of codings is non-empty"</p>



<a name="153899757"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899757" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899757">(Jul 31 2017 at 22:23)</a>:</h4>
<p>Was never intended for multiple subjects so don't know why you are asking about cross patient searches.  I  updated the definition to say 'A subject using either the patient or subject search parameter'.</p>



<a name="153899758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899758">(Jul 31 2017 at 22:27)</a>:</h4>
<p>ok. I shouldn't have asked about cross-patient searches. Wasn't paying enough attention. Still, the grouping is problematic If the same MDC code appears on paired with 2 different LOINC codes, then what?</p>



<a name="153899759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899759">(Jul 31 2017 at 22:32)</a>:</h4>
<p>I think additional query  filters would need to be used by client the if that is important.(category, device, code)   That is a tricky mapping question even if I was sitting there doing it myself and I think its out of scope of what we expect the operation to do.</p>



<a name="153899760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899760">(Jul 31 2017 at 22:33)</a>:</h4>
<p>what do you expect the operation to do? because that question arises naturally out of the data the operation is applied to</p>



<a name="153899761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899761">(Jul 31 2017 at 22:33)</a>:</h4>
<p>as a server, I don't have the choice of ignoring that situation</p>



<a name="153899762"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899762" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899762">(Jul 31 2017 at 22:37)</a>:</h4>
<p>I'd say that the CodeableConcept for the result group would include both MDC codes and the LOINC code, that way you at least get deterministic behavior.</p>



<a name="153899763"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899763" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899763">(Jul 31 2017 at 22:38)</a>:</h4>
<p>Its a crude method of  fetching N related things.</p>



<a name="153899764"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899764" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899764">(Jul 31 2017 at 22:38)</a>:</h4>
<p>umm, what?</p>



<a name="153899765"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899765" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899765">(Jul 31 2017 at 22:38)</a>:</h4>
<p>Who's that what for?</p>



<a name="153899766"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899766" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899766">(Jul 31 2017 at 22:38)</a>:</h4>
<p>:)</p>



<a name="153899767"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899767" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899767">(Jul 31 2017 at 22:38)</a>:</h4>
<p>you'll just keep aggregating as long as there's implicit joins?</p>



<a name="153899768"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899768" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899768">(Jul 31 2017 at 22:39)</a>:</h4>
<p>because of combined MDC and LOINC codes</p>



<a name="153899769"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899769" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899769">(Jul 31 2017 at 22:39)</a>:</h4>
<p>If a given CodeableConcept has both an MDC code and a LOINC code, it implies that they mean the same thing, right?</p>



<a name="153899770"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899770" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899770">(Jul 31 2017 at 22:39)</a>:</h4>
<p>well, for that context. it's tricky because granualarity differs</p>



<a name="153899771"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899771" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899771">(Jul 31 2017 at 22:40)</a>:</h4>
<p>More or less.  One concpet may be wider.</p>



<a name="153899772"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899772" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899772">(Jul 31 2017 at 22:41)</a>:</h4>
<p>Well, I'm proposing we rely on that in this case to get a consistent and deterministic result. If Obs A has MDC code 1 and LOINC code X, and Obs B has MDC code 2 and LOINC code X, then the result group key would be a CodeableConcept with MDC code 1, MDC code 2, and LOINC code X, and the group would contain both Observations.</p>



<a name="153899774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899774">(Jul 31 2017 at 22:42)</a>:</h4>
<p>Well.... we could add a switch for group grossly and group finely.</p>



<a name="153899775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899775">(Jul 31 2017 at 22:42)</a>:</h4>
<p>If the definition of equality for this scenario for a CodeableConcept is "the intersection of codes is not empty", then it works.</p>



<a name="153899776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899776">(Jul 31 2017 at 22:43)</a>:</h4>
<p>and if Obs C has Loinc Code Y and MDC code 1?</p>



<a name="153899777"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899777" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899777">(Jul 31 2017 at 22:43)</a>:</h4>
<p>but for starters I think Bryn's suggestion makes the most sense.</p>



<a name="153899779"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899779" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899779">(Jul 31 2017 at 22:44)</a>:</h4>
<p>Then the group key would expand to include LOINC Code Y.</p>



<a name="153899780"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899780" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899780">(Jul 31 2017 at 22:44)</a>:</h4>
<p>still group 1 right?</p>



<a name="153899781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899781">(Jul 31 2017 at 22:45)</a>:</h4>
<p>Yes</p>



<a name="153899782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899782">(Jul 31 2017 at 22:45)</a>:</h4>
<p>And yes, now we have a situation where we're asserting LOINC Code X = LOINC Code Y, but isn't that assertion implicit in the data anyway? This is just manifesting it because of how we're processing it.</p>



<a name="153899783"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899783" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899783">(Jul 31 2017 at 22:47)</a>:</h4>
<p>so to implement this, I have to scan all the observations in the selection (potentially 100000s), determine the groupings in the this set of data, and then group</p>



<a name="153899784"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899784" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899784">(Jul 31 2017 at 22:48)</a>:</h4>
<p>if somebody has translation of :</p>
<ul>
<li>animal, mammal, dog</li>
<li>animal, mammal ,cat</li>
<li>animal,bird,crow</li>
<li>bird, rock</li>
</ul>
<p>They all get grouped together, warts and all.  Unless the clients filter by code.</p>



<a name="153899785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899785">(Jul 31 2017 at 22:48)</a>:</h4>
<p>No, you implement it generically just like you implement any group by. For each element in the list, determine the key, see if the key is a group you've encountered, if it is, the element goes in that group, if it's not, create a new group. The only difference in this case is that the comparison for "is this a group I've encountered" has the potential to update the key, but that's okay because the way equality is defined that doesn't change the semantics.</p>



<a name="153899786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899786">(Jul 31 2017 at 22:49)</a>:</h4>
<p>At least, that's how I'd implement it. :)</p>



<a name="153899787"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899787" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899787">(Jul 31 2017 at 22:50)</a>:</h4>
<p>I would like to think that you are off by a couple of order of magnitude for &gt; 96% of patients.</p>



<a name="153899788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899788">(Jul 31 2017 at 22:50)</a>:</h4>
<p>uh? the problem is that according to your algorithm, I have to revisit the previous groupings because encountering a new combination changes the previous keys</p>



<a name="153899789"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899789" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899789">(Jul 31 2017 at 22:50)</a>:</h4>
<p>I don't know, we're looking at use cases with device feeds that would quickly get there.</p>



<a name="153899790"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899790" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899790">(Jul 31 2017 at 22:51)</a>:</h4>
<p>yes</p>



<a name="153899791"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899791" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899791">(Jul 31 2017 at 22:54)</a>:</h4>
<p>Right, so if you encounter a code in the current group that has the potential to "merge" other groups. So index all the codes you've encountered and the groups they're part of, then it's still single-pass, you just may have to merge groups as you go.</p>



<a name="153899873"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153899873" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153899873">(Aug 01 2017 at 12:13)</a>:</h4>
<p>ok, so I figured out a really easy way to implement it if the equality is based on all codings. So here you go:</p>
<div class="codehilite"><pre><span></span>http://test.fhir.org/r3/Observation/$lastN?status=final&amp;category=vital-signs&amp;subject=Patient/123
</pre></div>



<a name="153903436"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153903436" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153903436">(Aug 23 2017 at 22:52)</a>:</h4>
<p><span class="user-mention" data-user-id="191356">@Jenni Syed</span>  What is SHx?   <span class="user-mention" data-user-id="191359">@Bryn Rhodes</span>  can you share your grouping algorithm in pseudocode.</p>



<a name="153903437"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153903437" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Hosking <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153903437">(Aug 23 2017 at 22:53)</a>:</h4>
<p>I may be speaking out of turn, but clinically, in my experience and in the general clinical community, SHx is shorthand for "Social History"</p>



<a name="153903560"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153903560" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michelle (Moseman) Miller <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153903560">(Aug 24 2017 at 12:57)</a>:</h4>
<p>Yes, we use SHx to mean Social History, too.</p>



<a name="153903598"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153903598" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153903598">(Aug 24 2017 at 16:49)</a>:</h4>
<p>I was thinking something along the lines of:</p>



<a name="153903599"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153903599" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153903599">(Aug 24 2017 at 16:49)</a>:</h4>
<p>Operations:</p>
<div class="codehilite"><pre><span></span>  =(Coding, Coding) =&gt; That the Codings are equal for system, code, and version
  =(CodeableConcept, CodeableConcept) =&gt; That the CodeableConcepts contain the same Codings
  ~(CodeableConcept, CodeableConcept) =&gt; That the intersection of Codings in the CodeableConcepts is not empty
</pre></div>


<p>Structures:  </p>
<div class="codehilite"><pre><span></span>results Map&lt;CodeableConcept, List&lt;Observation&gt;&gt; // Using ~(CodeableConcept, CodeableConcept)
codeIndex Map&lt;Coding, List&lt;CodeableConcept&gt;&gt; // Using =(Coding, Coding)
</pre></div>


<p>Logic:</p>
<div class="codehilite"><pre><span></span>foreach obs in Observations
  foreach code in obs.Code
    key = results.key(code) // Get the current key for the observation
    newKey = key == null ? code ? combine(key, code) // Create a new key with the combined codes
    results.add(newKey, obs) // Add the observation to the newKey
    if (key != newKey) // If the key is different (meaning there was a new coding introduced)
      // collapse all the results that have any of the new codings into the new key
      foreach newCoding in (newKey.coding minus key.coding)
        foreach mergeKey in codeIndex[newCoding]
          results.merge(mergeKey, newKey) // Merge the observations from the old key into the new key
        codeIndex.remove(newCoding) // remove the codeIndex entry for the merged coding
    foreach coding in newKey.coding
      codeIndex.add(coding, newKey)
</pre></div>



<a name="153903600"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153903600" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bryn Rhodes <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153903600">(Aug 24 2017 at 16:53)</a>:</h4>
<p>Now, to get that to work with the lastN, you'd have to either have an index on Observations by Code and Date, or you'd have to run it through the entire set and then apply the lastN to each resulting group.</p>



<a name="153903605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153903605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Haas <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153903605">(Aug 24 2017 at 18:06)</a>:</h4>
<p>thanks!</p>



<a name="153905450"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153905450" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Shultlis <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153905450">(Sep 09 2017 at 21:02)</a>:</h4>
<p>I have some questions about the LastN idea. </p>
<p>The first one is: what is the problem this is trying to solve? Is there a clear requirement? It seems to me there isn't a clear purpose. Having said that...</p>
<p>Searching for the "last n" is not limited to observations. As an application developer, whenever there is a many-one time series relationship between two resources, a way to find the last n of those will likely be useful. For example: MedicationAdministration, ImagingStudy, Procedure, Immunization, NutritionOrder, and Claim could all use "last n" search.</p>
<p>It isn't clear that "last n" is needed, though. Search already allows for restricting the number of results (per page) using _count, and using _sort on issued ensures that the desired results are all on the first page, in order.</p>
<p>The stipulation that the results should "not [include] the same observation with changes in status or versions" is reasonable, but this seems like a general requrement as an option for search on any resource.</p>
<p>The request to group the results seems reasonable, but is more generally applicable to search for any Resource.</p>
<p>The talk of a "server algorithm of some kind" appears to be</p>



<a name="153905452"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%24lastN%20operation/near/153905452" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jonathan Shultlis <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.24lastN.20operation.html#153905452">(Sep 09 2017 at 21:09)</a>:</h4>
<p>The imaginary server algorithm is fuzzy. If there is need for some kind of client-specified filter or predicate, could that be packaged as a script (in a limited language)? Scary shades of proprietary server plugins, or client-supplied scripts...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
