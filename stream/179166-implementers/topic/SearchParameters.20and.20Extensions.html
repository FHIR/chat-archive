---
layout: page
title: "FHIR Chat  · SearchParameters and Extensions · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html">SearchParameters and Extensions</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="166870522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/166870522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#166870522">(May 30 2019 at 00:51)</a>:</h4>
<p>Any insight into how I am misusing the SearchParameter would be greatly appreciated.</p>
<p>I'm trying to develop a SearchParameter that will allow me to search against data in extension fields.<br>
The extensions are valueBooleans.<br>
I have two MedicationInformation Objects, one with the extension data, one without:  (see <a href="http://hapi.fhir.org/baseR4/MedicationKnowledge" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge">http://hapi.fhir.org/baseR4/MedicationKnowledge</a>)<br>
1) <a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK1" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK1">http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK1</a>   -- has extensions<br>
2) <a href="http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK2" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK2">http://hapi.fhir.org/baseR4/MedicationKnowledge/SaulExperimentMK2</a></p>
<p>The quantityLimit extension looks like this:<br>
                    {<br>
                        "url": "<a href="https://api-v8-r4.hspconsortium.org/DrugFormulary2/open/StructureDefinition/usdrugformulary-QuantityLimit-extension" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary2/open/StructureDefinition/usdrugformulary-QuantityLimit-extension">https://api-v8-r4.hspconsortium.org/DrugFormulary2/open/StructureDefinition/usdrugformulary-QuantityLimit-extension</a>",<br>
                        "valueBoolean": true<br>
                    }</p>
<p>I have defined a SearchParameter:    <a href="http://hapi.fhir.org/baseR4/SearchParameter/quantityLimit" target="_blank" title="http://hapi.fhir.org/baseR4/SearchParameter/quantityLimit">http://hapi.fhir.org/baseR4/SearchParameter/quantityLimit</a><br>
{<br>
    "resourceType": "SearchParameter",<br>
    "id": "quantityLimit",<br>
    "meta": {<br>
      "versionId": "1",<br>
      "lastUpdated": "2019-02-22T08:37:56.297+00:00"<br>
    },<br>
    "title": "quantityLimit",<br>
    "status": "active",<br>
    "code": "quantityLimit",<br>
    "base": [<br>
      "MedicationKnowledge"<br>
    ],<br>
    "type": "string",<br>
    "expression": "MedicationKnowledge.extension(\" <a href="https://api-v8-r4.hspconsortium.org/DrugFormulary2/open/StructureDefinition/usdrugformulary-QuantityLimit-extension.valueBoolean" target="_blank" title="https://api-v8-r4.hspconsortium.org/DrugFormulary2/open/StructureDefinition/usdrugformulary-QuantityLimit-extension.valueBoolean">https://api-v8-r4.hspconsortium.org/DrugFormulary2/open/StructureDefinition/usdrugformulary-QuantityLimit-extension.valueBoolean</a>    \")",<br>
    "xpathUsage": "normal",<br>
    "comparator": [<br>
        "eq"<br>
      ],<br>
    "search": {<br>
        "mode": "match"<br>
      }<br>
  }</p>
<p>The SearchParameter is recognized by the server, but doesn't work (as intended).</p>
<p>Searching:<br>
1) <a href="http://hapi.fhir.org/baseR4/MedicationKnowledge?quantityLimit" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge?quantityLimit">http://hapi.fhir.org/baseR4/MedicationKnowledge?quantityLimit</a>   - returns two MedicationKnowledge objects... only one object has the quantityLimit extension, <strong>so this should return only one object, right?</strong><br>
2) http://hapi.fhir.org/baseR4/MedicationKnowledge?quantityLimit="true" returns zero objects,<strong> but should return one object, right?</strong></p>



<a name="166871054"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/166871054" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#166871054">(May 30 2019 at 01:01)</a>:</h4>
<p>I don't think that HAPI automatically implements search parameter definitions- you should ask on the HAPI stream</p>



<a name="166910027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/166910027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Saul Kravitz <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#166910027">(May 30 2019 at 14:02)</a>:</h4>
<p>HAPI (I've tested 3.7 and 3.8) implement search parameter definitions.<br>
See <a href="http://hapi.fhir.org/baseR4/MedicationKnowledge?productType" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge?productType">http://hapi.fhir.org/baseR4/MedicationKnowledge?productType</a>  for a search parameter that allows search against the MedicationKnowledge productType field.<br>
A sample query is:<br>
<a href="http://hapi.fhir.org/baseR4/MedicationKnowledge?productType=BRANDX" target="_blank" title="http://hapi.fhir.org/baseR4/MedicationKnowledge?productType=BRANDX">http://hapi.fhir.org/baseR4/MedicationKnowledge?productType=BRANDX</a></p>
<p>Moving to #HAPI stream.</p>



<a name="168093041"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168093041" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Glory Kim <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168093041">(Jun 13 2019 at 23:13)</a>:</h4>
<p>Is there a precedence/hierarchy in the order of search result parameters ie. should _sort always go before _count? I'm trying to understand the implementation of the search results parameters.</p>



<a name="168093139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168093139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168093139">(Jun 13 2019 at 23:15)</a>:</h4>
<p>Order doesn't matter - and should have no impact on results.</p>



<a name="168093150"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168093150" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168093150">(Jun 13 2019 at 23:15)</a>:</h4>
<p>(Though that's not true for multiple repetitions of the _sort parameter - there order matters)</p>



<a name="168093259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168093259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168093259">(Jun 13 2019 at 23:17)</a>:</h4>
<blockquote>
<p>Order doesn't matter - and should have no impact on results.</p>
</blockquote>
<p>I'll agree with you but it is conceivable that _sorting first and then _counting could give you different results from _counting and then _sorting.  If the server retrieved 1000 results in some random order and returned the first 100 sorted by X, that's different than retrieving 1000 results, sorting by X, and returning the first 100.  If we're saying that order <em>SHALL not</em> have an impact on results, then I think we need to define a parameter precedence, i.e. sort first and then count.</p>



<a name="168093401"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168093401" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Glory Kim <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168093401">(Jun 13 2019 at 23:19)</a>:</h4>
<p>To clarify, I mean the order of implementation. For example, w/ AllergyIntolerance?_sort=AAA&amp;_count=AAA&amp;_include=AAA, it seems that the resources first get sorted, and then the count applies to the primary resource, and then the include works upon the resource afterwards. There doesn't seem to be any written precedence on fhir spec stating which param should be enacted first. </p>
<p><span class="user-mention" data-user-id="192166">@Jean Duteau</span>  I agree - i think there should definitely be a parameter precedence.</p>



<a name="168093488"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168093488" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Glory Kim <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168093488">(Jun 13 2019 at 23:21)</a>:</h4>
<p>Perhaps there already is a written document, and I just missed it?</p>



<a name="168093761"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168093761" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168093761">(Jun 13 2019 at 23:26)</a>:</h4>
<blockquote>
<p>Perhaps there already is a written document, and I just missed it?</p>
</blockquote>
<p>I just read the page on search parameters and there is nothing really there.  There is this one line that implies that sorting occurs first and then paging:</p>
<blockquote>
<p>Note: The combination of _sort and _count can be used to return only the latest resource that meets a particular criteria - set the criteria, and then sort by date in descending order, with _count=1. This way, the last matching resource will be returned.</p>
</blockquote>
<p>Is it only really _sort and _count that need a precedence?</p>



<a name="168093899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168093899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168093899">(Jun 13 2019 at 23:29)</a>:</h4>
<blockquote>
<p>To clarify, I mean the order of implementation. For example, w/ AllergyIntolerance?_sort=AAA&amp;_count=AAA&amp;_include=AAA, it seems that the resources first get sorted, and then the count applies to the primary resource, and then the include works upon the resource afterwards. There doesn't seem to be any written precedence on fhir spec stating which param should be enacted first. </p>
</blockquote>
<p>One thing I did find was that _include only occurs after paging:</p>
<blockquote>
<p>When search results are paged, each page of search results should include the matching includes for the resources in each page, so that each page stands alone as a coherent package.</p>
</blockquote>



<a name="168094593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168094593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Glory Kim <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168094593">(Jun 13 2019 at 23:42)</a>:</h4>
<p>I would say all of the results parameters should/could have a precedence</p>



<a name="168095072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168095072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Glory Kim <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168095072">(Jun 13 2019 at 23:52)</a>:</h4>
<p>Also, does anyone know how multiple _includes would work without :iterate?</p>



<a name="168098269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168098269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168098269">(Jun 14 2019 at 01:06)</a>:</h4>
<p>I don't understand the precendence issue. Sort and count are unrelated - sorting does not change the count</p>



<a name="168101581"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168101581" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168101581">(Jun 14 2019 at 02:22)</a>:</h4>
<p>..and _count does not apply to includes</p>



<a name="168101788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168101788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Glory Kim <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168101788">(Jun 14 2019 at 02:29)</a>:</h4>
<p>Okay, thank you. So then, the order is to _sort &amp; _count on the main resources, and then _includes resources is tacked on at the end (not sorted) ?</p>



<a name="168102267"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168102267" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168102267">(Jun 14 2019 at 02:42)</a>:</h4>
<p>yes. includes is only the includes for the page being returned. Count is the size of the page; the order returned will obviously change which page contains which result but that isn't related to the order the parameters are specified in, and the only rule on the server side is that search has to work as specified</p>



<a name="168106689"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168106689" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jean Duteau <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168106689">(Jun 14 2019 at 04:54)</a>:</h4>
<blockquote>
<p>I don't understand the precendence issue. Sort and count are unrelated - sorting does not change the count</p>
</blockquote>
<p>I gave you the example.  _sort:name&amp;_count:100  : does this mean that I sort the resources by name and then give you back the first 100?  Okay, then _count:100&amp;_sort:name : does this mean that I take the first 100 resources returned randomly and then sort by name within that 100?  We are mostly silent on which you do first.  And if the answer is that you always _sort first and then _count, then there is an implicit precedence that we should probably state.  I mean, it's pretty self-evident, but it might bear stating.</p>



<a name="168140321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168140321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168140321">(Jun 14 2019 at 14:37)</a>:</h4>
<p>Order of operations is not driven by order in the URL - with the exception of sort.  First all filters are applied, then the result set is sorted, then paging is applied, and includes/revincludes are returned for each page.  Agree we should make that explicit in the spec.  Can you submit a change request <span class="user-mention" data-user-id="192166">@Jean Duteau</span> ?</p>



<a name="168173095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168173095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168173095">(Jun 14 2019 at 21:29)</a>:</h4>
<p>well, we could be explicit that sorting is applied before paging, but I really thought this was super obvious</p>



<a name="168173155"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/SearchParameters%20and%20Extensions/near/168173155" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/SearchParameters.20and.20Extensions.html#168173155">(Jun 14 2019 at 21:30)</a>:</h4>
<p>we are explicit about includes already btw</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
