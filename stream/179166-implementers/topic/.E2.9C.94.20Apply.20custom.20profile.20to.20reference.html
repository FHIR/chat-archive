---
layout: page
title: "FHIR Chat  · ✔ Apply custom profile to reference · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.E2.9C.94.20Apply.20custom.20profile.20to.20reference.html">✔ Apply custom profile to reference</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="273105032"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%E2%9C%94%20Apply%20custom%20profile%20to%20reference/near/273105032" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cado <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.E2.9C.94.20Apply.20custom.20profile.20to.20reference.html#273105032">(Feb 24 2022 at 15:36)</a>:</h4>
<p>Hello everyone! :)</p>
<p>We are aiming to create a custom fhir profile for our application. The profile is for an observation containing a device element with a condensed structure (e.g MyDevice).</p>
<p>Problem is that our initial attempt at defining a structure does not seem to be valid (we checked using the validator from <a href="https://github.com/hapifhir/org.hl7.fhir.core/">https://github.com/hapifhir/org.hl7.fhir.core/</a>). According to the profile element definition it cannot contain a reference.</p>
<p>We want to define the following as a custom observation profile that can have a device element containing only "identifier" and "manufacturer".</p>
<div class="codehilite"><pre><span></span><code>{
    &quot;resourceType&quot;: &quot;Observation&quot;,
    // ...
    &quot;contained&quot;: [
        {
            &quot;resourceType&quot;: &quot;Device&quot;,
            &quot;id&quot;: &quot;1&quot;,
            &quot;identifier&quot;: [
                {
                    &quot;value&quot;: &quot;myId&quot;
                }
            ],
            &quot;manufacturer&quot;: &quot;myManufacturer&quot;
        }
    ],
    &quot;device&quot;: {
        &quot;reference&quot;: &quot;#1&quot;
    }
}
</code></pre></div>
<p>We could only achieve a valid structure definition if the device is not a reference to a "contained" element (see example 1). </p>
<p>Example 1:</p>
<div class="codehilite"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;StructureDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;
// ...
&lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; /&gt;
&lt;differential&gt;
&lt;element id=&quot;Observation.device&quot;&gt;
      &lt;path value=&quot;Observation.device&quot; /&gt;
      &lt;min value=&quot;1&quot; /&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot; /&gt;
        &lt;profile value=&quot;https://example.org/fhir/StructureDefinition/MyDevice&quot; /&gt;  // !!
        &lt;targetProfile value=&quot;http://hl7.org/fhir/StructureDefinition/Device&quot; /&gt;
      &lt;/type&gt;
    &lt;/element&gt;
&lt;/differential&gt;
&lt;/StructureDefinition&gt;
</code></pre></div>
<p>For example 2, the validator would expect the sub elements "identifier"/"manufacturer" etc. to be inside the device element itself. It cannot resolve a reference to an element inside the contained array.</p>
<p>Is there a way to fix/define this somehow?</p>
<p>Example 2:</p>
<div class="codehilite"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;StructureDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;
// ...
&lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; /&gt;
&lt;differential&gt;
&lt;element id=&quot;Observation.device&quot;&gt;
      &lt;path value=&quot;Observation.device&quot; /&gt;
      &lt;min value=&quot;1&quot; /&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot; /&gt;
        &lt;profile value=&quot;https://example.org/fhir/StructureDefinition/MyDevice&quot; /&gt;  // !!
        &lt;targetProfile value=&quot;http://hl7.org/fhir/StructureDefinition/Device&quot; /&gt;
        &lt;aggregation value=&quot;contained&quot; /&gt;  // !!
      &lt;/type&gt;
    &lt;/element&gt;
&lt;/differential&gt;
&lt;/StructureDefinition&gt;
</code></pre></div>



<a name="273110040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%E2%9C%94%20Apply%20custom%20profile%20to%20reference/near/273110040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cado <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.E2.9C.94.20Apply.20custom.20profile.20to.20reference.html#273110040">(Feb 24 2022 at 16:09)</a>:</h4>
<p>Update:<br>
We managed to make it work after all. Sorry for spamming <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
<div class="codehilite"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;StructureDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;
// ...
&lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; /&gt;
&lt;differential&gt;
&lt;element id=&quot;Observation.device&quot;&gt;
      &lt;path value=&quot;Observation.device&quot; /&gt;
      &lt;min value=&quot;1&quot; /&gt;
      &lt;type&gt;
        &lt;code value=&quot;Reference&quot; /&gt;
        &lt;targetProfile value=&quot;https://example.org/fhir/StructureDefinition/MyDevice&quot; /&gt;
        &lt;aggregation value=&quot;contained&quot; /&gt;
      &lt;/type&gt;
    &lt;/element&gt;
&lt;/differential&gt;
&lt;/StructureDefinition&gt;
</code></pre></div>



<a name="273110057"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/%E2%9C%94%20Apply%20custom%20profile%20to%20reference/near/273110057" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/.E2.9C.94.20Apply.20custom.20profile.20to.20reference.html#273110057">(Feb 24 2022 at 16:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="388396">Cado</span> has marked this topic as resolved.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
