---
layout: page
title: "FHIR Chat  · FHIRPath Patch on uninitialized object/list · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html">FHIRPath Patch on uninitialized object/list</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="263793797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263793797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikael Weaver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263793797">(Dec 05 2021 at 22:52)</a>:</h4>
<p>Hello! I'm working on a FHIRPath Patch implementation for our FHIR server. I've run into two related use cases where data needs to be added to a resource, but the target object or list isn't initialized. The specification page doesn't address proper behavior for this scenario, so my assumption is that the behavior is left up to the implementer. Is that correct? Also, any input on what the server should do for these scenarios?</p>
<p>Below are a couple of sample use cases. Thanks for the help!</p>
<p><strong>Use Case 1: Adding a value to a nested object that doesn't exist.</strong><br>
The Patient has an identifier defined without a period. The user wants to be able to expire the identifier. Should the server initialize the <code>period</code> object that doesn't exist on the object or return an error?</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
    <span class="nt">"resourceType"</span><span class="p">:</span> <span class="s2">"Patient"</span><span class="p">,</span>
    <span class="nt">"identifier"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">"use"</span><span class="p">:</span> <span class="s2">"official"</span><span class="p">,</span>
            <span class="nt">"value"</span><span class="p">:</span> <span class="s2">"123"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
    <span class="nt">"resourceType"</span><span class="p">:</span> <span class="s2">"Parameters"</span><span class="p">,</span>
    <span class="nt">"parameter"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"operation"</span><span class="p">,</span>
            <span class="nt">"part"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"type"</span><span class="p">,</span>
                    <span class="nt">"valueCode"</span><span class="p">:</span> <span class="s2">"add"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"path"</span><span class="p">,</span>
                    <span class="nt">"valueString"</span><span class="p">:</span> <span class="s2">"Patient.identifier.where(use = 'official').period"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"name"</span><span class="p">,</span>
                    <span class="nt">"valueString"</span><span class="p">:</span> <span class="s2">"end"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">,</span>
                    <span class="nt">"valueDate"</span><span class="p">:</span> <span class="s2">"2021-12-01"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Use Case 2: Inserting a value into a list that doesn't exist.</strong><br>
A Patient resource exists without any identifiers. The user wants to add an identifier to the patient. Should the server initialize the <code>identifier</code> list or return an error?</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
    <span class="nt">"resourceType"</span><span class="p">:</span> <span class="s2">"Patient"</span>
<span class="p">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
    <span class="nt">"resourceType"</span><span class="p">:</span> <span class="s2">"Parameters"</span><span class="p">,</span>
    <span class="nt">"parameter"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"operation"</span><span class="p">,</span>
            <span class="nt">"part"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"type"</span><span class="p">,</span>
                    <span class="nt">"valueCode"</span><span class="p">:</span> <span class="s2">"add"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"path"</span><span class="p">,</span>
                    <span class="nt">"valueString"</span><span class="p">:</span> <span class="s2">"Patient"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"name"</span><span class="p">,</span>
                    <span class="nt">"valueString"</span><span class="p">:</span> <span class="s2">"identifier"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">,</span>
                    <span class="nt">"valueIdentifier"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">"system"</span><span class="p">:</span> <span class="s2">"http://example.org"</span><span class="p">,</span>
                        <span class="nt">"value"</span><span class="p">:</span> <span class="s2">"value 3"</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>



<a name="263803680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263803680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263803680">(Dec 06 2021 at 02:50)</a>:</h4>
<p>It may be best to ask on <a class="stream" data-stream-id="179266" href="/#narrow/stream/179266-fhirpath">#fhirpath</a></p>



<a name="263856929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263856929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Putke <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263856929">(Dec 06 2021 at 14:27)</a>:</h4>
<p>Hello, </p>
<p>I couldn't find a proper way handling patches with certain elements with the implementation of hapi FHIR server as well. I think it's addressing the same issue here. Additionally the behavoir of JSON patches and patching with FHIRPath seems to be not equal. </p>
<p>I want to add a <code>link</code>to the ressource <code>Patient</code> ressource. If there are no other <code>link</code> elements in this ressource, the server response status code is 400 with the message "parent of node to add does not exist".</p>
<p>Sample</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">[</span>

    <span class="p">{</span>
        <span class="nt">"op"</span><span class="p">:</span> <span class="s2">"add"</span><span class="p">,</span>
        <span class="nt">"path"</span><span class="p">:</span> <span class="s2">"/link/-"</span><span class="p">,</span>
        <span class="nt">"value"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"other"</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">"reference"</span><span class="p">:</span> <span class="s2">"Patient/108"</span>
            <span class="p">},</span>
            <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"seealso"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<p>The same for FHIRPath, but different behavior. This case returns a status code 200 but doesn't set the <code>link</code>. <br>
Surprisingly it's working if I try to patch the element <code>identifier</code> instead.</p>
<div class="codehilite" data-code-language="XML"><pre><span></span><code><span class="nt">&lt;Parameters</span>
    <span class="na">xmlns=</span><span class="s">"http://hl7.org/fhir"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parameter&gt;</span>
        <span class="nt">&lt;name</span> <span class="na">value=</span><span class="s">"operation"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;part&gt;</span>
            <span class="nt">&lt;name</span> <span class="na">value=</span><span class="s">"type"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;valueCode</span> <span class="na">value=</span><span class="s">"insert"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/part&gt;</span>
        <span class="nt">&lt;part&gt;</span>
            <span class="nt">&lt;name</span> <span class="na">value=</span><span class="s">"path"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;valueString</span> <span class="na">value=</span><span class="s">"Patient.link"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/part&gt;</span>
        <span class="nt">&lt;part&gt;</span>
            <span class="nt">&lt;name</span> <span class="na">value=</span><span class="s">"index"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;valueInteger</span> <span class="na">value=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/part&gt;</span>
        <span class="nt">&lt;part&gt;</span>
            <span class="nt">&lt;name</span> <span class="na">value=</span><span class="s">"value"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;valueLink&gt;</span>
                <span class="nt">&lt;other&gt;</span>
                    <span class="nt">&lt;reference</span> <span class="na">value=</span><span class="s">"Patient/108"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/other&gt;</span>
                <span class="nt">&lt;type</span> <span class="na">value=</span><span class="s">"replaced-by"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/valueLink&gt;</span>
        <span class="nt">&lt;/part&gt;</span>
    <span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/Parameters&gt;</span>
</code></pre></div>



<a name="263867496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263867496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263867496">(Dec 06 2021 at 15:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="263891145"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263891145" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikael Weaver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263891145">(Dec 06 2021 at 18:07)</a>:</h4>
<p><span class="user-mention" data-user-id="450607">@Mark Putke</span> for JSONPatch, it looks like the object must exist and be initialized according to the JSONPatch spec <a href="https://www.rfc-editor.org/rfc/rfc6902#section-4.1">RFC 6902 4.1</a>. The spec says <em>"However, the object itself or an array containing it does need to exist, and it remains an error for that not to be the case"</em>. I would expect a result of HTTP 400 there. The behavior you are seeing with the FHIRPatch implementation looks incorrect - it should either result in a successful patch or an error.</p>



<a name="263900505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263900505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikael Weaver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263900505">(Dec 06 2021 at 19:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191320">Lloyd McKenzie</span> <a href="#narrow/stream/179166-implementers/topic/FHIRPath.20Path.20on.20uninitialized.20object.2Flist/near/263803680">said</a>:</p>
<blockquote>
<p>It may be best to ask on <a class="stream" data-stream-id="179266" href="/#narrow/stream/179266-fhirpath">#fhirpath</a></p>
</blockquote>
<p>Thanks I'll ask over there in a bit.</p>



<a name="263924486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263924486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikael Weaver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263924486">(Dec 06 2021 at 21:05)</a>:</h4>
<p>Conversation moved to <a class="stream" data-stream-id="179266" href="/#narrow/stream/179266-fhirpath">#fhirpath</a> <a href="#narrow/stream/179266-fhirpath/topic/FHIRPath.20Patch.20on.20uninitialized.20.20object.2Flist">here</a>.</p>



<a name="263950774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263950774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263950774">(Dec 07 2021 at 02:10)</a>:</h4>
<p>hi Mikael. Good questions. </p>
<p>Case one is an error - the server should say something like "No content found at Patient.identifier.where(use = 'official').period when adding". This is defined in the spec when it says:</p>
<blockquote>
<p>The FHIRPath statement must return a single element</p>
</blockquote>
<p>but I agree it could be bit clearer. </p>
<p>For case #2, it's not an error - the path expression returns a single element, and it adds identifier to it.</p>
<p>I added your two test cases: <a href="https://github.com/FHIR/fhir-test-cases/blob/master/r4/patch/fhir-path-tests.xml#L1381">https://github.com/FHIR/fhir-test-cases/blob/master/r4/patch/fhir-path-tests.xml#L1381</a></p>



<a name="263950793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/263950793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#263950793">(Dec 07 2021 at 02:11)</a>:</h4>
<p>oh. i'll go update the other thread</p>



<a name="264384874"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/FHIRPath%20Patch%20on%20uninitialized%20object/list/near/264384874" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mikael Weaver <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist.html#264384874">(Dec 09 2021 at 23:57)</a>:</h4>
<p>Thank for the interpretation and test cases <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>! I have a bit more work to do for test case #2 then we'll have it fully working. I have a few more test cases that may be useful to add - I'll ping you here once they are merged.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
