---
layout: page
title: "FHIR Chat  · Nictiz profiles/extensions missing snapshot · implementers"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/index.html">implementers</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html">Nictiz profiles/extensions missing snapshot</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="167520715"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167520715" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167520715">(Jun 06 2019 at 20:42)</a>:</h4>
<p>We are trying to add support for NL/Nictiz profiles/extensions and are unable to find/download the profiles/extensions with snapshot provided. If a profile doesn't have a snapshot filled, the validator(R4) gives a meaningful error message "StructureDefinition has no snapshot - validation is against the snapshot, so it must be provided". However, if the one of the extensions do not have a snapshot, it results in a IndexOutOfBoundException as the validator seems to be looking for the first element even if none exists. The problematic line is <a href="https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1157" target="_blank" title="https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1157">https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1157</a></p>



<a name="167520932"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167520932" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167520932">(Jun 06 2019 at 20:45)</a>:</h4>
<p>Two questions<br>
1. Can anyone help me find the Nictiz STU3 Zib2017 profiles with snapshot filled?<br>
2. Can the above bug be fixed in the Validator?</p>



<a name="167523176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167523176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vadim Peretokin <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167523176">(Jun 06 2019 at 21:10)</a>:</h4>
<p>It really is a bug in the validator that it's not generating the snapshot, but for now you can use <a href="https://simplifier.net/downloads/torinox" target="_blank" title="https://simplifier.net/downloads/torinox">Torinox</a> to create them <span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span></p>



<a name="167544470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167544470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167544470">(Jun 07 2019 at 03:56)</a>:</h4>
<p>I dont think the validator generates the snapshot as such. It relies on the snapshots to be already provided.</p>



<a name="167544604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167544604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167544604">(Jun 07 2019 at 03:59)</a>:</h4>
<p>I am still googling for Nictiz profiles with snapshots but so far am unsuccessful. I know I can use the RI tooling to generate snapshots but isn't it the understanding that profiles should publish snapshot for them to be used in validation?</p>



<a name="167544809"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167544809" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167544809">(Jun 07 2019 at 04:02)</a>:</h4>
<p>We are getting this issue very often because the current tooling (Simplifier et al) doesn't seem to publish profiles with snapshot.</p>



<a name="167546515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167546515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167546515">(Jun 07 2019 at 04:41)</a>:</h4>
<p>the validator does not rely on the snapshots to be generated as of 48 hours ago (thanks <span class="user-mention" data-user-id="191375">@Alexander Henket</span> )</p>



<a name="167547252"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547252" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547252">(Jun 07 2019 at 04:57)</a>:</h4>
<p>So there's no such understanding that snapshots are mandatory for validation and it is just a deficiency in the validator implementation?</p>



<a name="167547328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547328">(Jun 07 2019 at 04:59)</a>:</h4>
<p>it was a bug - snapshots used to be generated and they are again now</p>



<a name="167547339"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547339" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547339">(Jun 07 2019 at 04:59)</a>:</h4>
<p>Unfortunately I still have to wait for the next release of HAPI to get this change and I am not sure if this helps me at all.</p>



<a name="167547425"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547425" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547425">(Jun 07 2019 at 05:01)</a>:</h4>
<p>well, you should be using the R5 validator now, not the R4 one. The R4 one is no longer maintained. I need to get around to cleaning up the code so I can delete it.</p>



<a name="167547430"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547430" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547430">(Jun 07 2019 at 05:01)</a>:</h4>
<p>You'll have to ask on HAPI support when the next release is due</p>



<a name="167547477"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547477" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547477">(Jun 07 2019 at 05:02)</a>:</h4>
<p>OK, I am sorry, my understanding of the profile publication process is very limited. Are you saying that the profiles would indeed be published with snapshots?</p>



<a name="167547480"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547480" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547480">(Jun 07 2019 at 05:02)</a>:</h4>
<p>or you can generate the snapshots yourself - it's pretty straight forward:</p>



<a name="167547493"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547493" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547493">(Jun 07 2019 at 05:02)</a>:</h4>
<div class="codehilite"><pre><span></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">StructureDefinition</span> <span class="n">sd</span> <span class="o">:</span> <span class="n">context</span><span class="o">.</span><span class="na">allStructures</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">makeSnapshot</span><span class="o">(</span><span class="n">sd</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Process Note: Unable to generate snapshot for &quot;</span><span class="o">+</span><span class="n">sd</span><span class="o">.</span><span class="na">present</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">makeSnapshot</span><span class="o">(</span><span class="n">StructureDefinition</span> <span class="n">sd</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">DefinitionException</span><span class="o">,</span> <span class="n">FHIRException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">sd</span><span class="o">.</span><span class="na">hasSnapshot</span><span class="o">())</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="n">StructureDefinition</span> <span class="n">sdb</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">fetchResource</span><span class="o">(</span><span class="n">StructureDefinition</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">sd</span><span class="o">.</span><span class="na">getBaseDefinition</span><span class="o">());</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">sdb</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">makeSnapshot</span><span class="o">(</span><span class="n">sdb</span><span class="o">);</span>
      <span class="k">new</span> <span class="n">ProfileUtilities</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">).</span><span class="na">generateSnapshot</span><span class="o">(</span><span class="n">sdb</span><span class="o">,</span> <span class="n">sd</span><span class="o">,</span> <span class="n">sd</span><span class="o">.</span><span class="na">getUrl</span><span class="o">(),</span> <span class="kc">null</span><span class="o">,</span> <span class="n">sd</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

  <span class="o">}</span>
</pre></div>



<a name="167547517"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547517" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547517">(Jun 07 2019 at 05:03)</a>:</h4>
<p>the IG publisher always publishes snapshots as well. But it's not a requirement to do that. So add that code above somewhere in your loading code, and you should be right</p>



<a name="167547522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547522">(Jun 07 2019 at 05:03)</a>:</h4>
<p>Yes, I am aware of this like I mentioned. (ProfileUtilities/RI Tooling)</p>



<a name="167547590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547590">(Jun 07 2019 at 05:04)</a>:</h4>
<p>Thanks for your help. I will proceed this route. But IGs are not required to publish snapshots any more?</p>



<a name="167547895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547895">(Jun 07 2019 at 05:11)</a>:</h4>
<p>since I don't think we ever required IGs to publish snap shots, I don't think you can say that we don't require it anymore. The IG Publisher will continue to publish them though - and I am pushing all the tool chains to end up in the IG publisher</p>



<a name="167547899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167547899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167547899">(Jun 07 2019 at 05:11)</a>:</h4>
<p>We may require that, yet</p>



<a name="167585654"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167585654" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lloyd McKenzie <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167585654">(Jun 07 2019 at 15:17)</a>:</h4>
<p>IGs that meet HL7's quality criteria will have to have snapshots to render properly.  And if they're producing the snapshots, I think it's reasonable to expect them to publish them.  However, not all IGs will necessarily meet HL7's quality criteria</p>



<a name="167623961"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167623961" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167623961">(Jun 08 2019 at 00:02)</a>:</h4>
<p>Even after generating snapshot, I see that some of the Nictiz profiles have issues with them. RI/HAPI's R4 validator gives the below errors<br>
eOverdrachtTransferDate.json</p>
<div class="codehilite"><pre><span></span>{
    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
    &quot;issue&quot;: [
        {
            &quot;extension&quot;: [
                {
                    &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,
                    &quot;valueCode&quot;: &quot;InstanceValidator&quot;
                }
            ],
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;invariant&quot;,
            &quot;details&quot;: {
                &quot;text&quot;: &quot;Constraints must be unique by key [constraint.select(key).isDistinct()]&quot;
            },
            &quot;location&quot;: [
                &quot;StructureDefinition.snapshot.element[1] (line 1, col 996)&quot;
            ]
        }
    ]
}
</pre></div>


<p>eAfspraakAppointmentOnlineEditable.json, ZIB-Deviating-Administration.json, MedicationOverview-Verification.json</p>
<div class="codehilite"><pre><span></span>{
    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
    &quot;issue&quot;: [
        {
            &quot;extension&quot;: [
                {
                    &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,
                    &quot;valueCode&quot;: &quot;InstanceValidator&quot;
                }
            ],
            &quot;severity&quot;: &quot;error&quot;,
            &quot;code&quot;: &quot;invariant&quot;,
            &quot;details&quot;: {
                &quot;text&quot;: &quot;No slicing on the root element [element.first().slicing.empty()]&quot;
            },
            &quot;location&quot;: [
                &quot;StructureDefinition.differential&quot;
            ]
        }
    ]
}
</pre></div>


<p>I got the second error on Grahame Grieve's server at <a href="http://test.fhir.org/r3" target="_blank" title="http://test.fhir.org/r3">http://test.fhir.org/r3</a> but not the first</p>



<a name="167623997"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167623997" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167623997">(Jun 08 2019 at 00:03)</a>:</h4>
<p>Any body from HL7 NL/Nictiz in this forum?</p>



<a name="167624137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167624137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167624137">(Jun 08 2019 at 00:06)</a>:</h4>
<p>The first error is due to the derived extension (re)defining the ext-1 constraint that is already declared in base. The second error is due to not having the root element <code>Extension</code> in the differential and starting with <code>Extension.extension</code> and slicing it.</p>



<a name="167629806"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167629806" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167629806">(Jun 08 2019 at 02:41)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span>  on the first error. The validator in <a href="http://test.fhir.org/r3" target="_blank" title="http://test.fhir.org/r3">test.fhir.org/r3</a> is running behind, and is not reliable</p>



<a name="167647652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167647652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167647652">(Jun 08 2019 at 11:41)</a>:</h4>
<p>Hi all: we are waiting for Simplifier to produce snapshots in the package upon producing a package. We really don't want them in our master definitions. Because we ourselves also need the snapshots for Touchstone, we have decided to produce them separately in GitHub: <a href="https://github.com/Nictiz/Nictiz-STU3-Zib2017/releases" target="_blank" title="https://github.com/Nictiz/Nictiz-STU3-Zib2017/releases">https://github.com/Nictiz/Nictiz-STU3-Zib2017/releases</a>. <span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span></p>



<a name="167647713"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167647713" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167647713">(Jun 08 2019 at 11:43)</a>:</h4>
<p>Sorry for coming late to the thread with this info. It is still a good thing for the validator to handle the snapshots. Thanks for that <span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="167647822"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167647822" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167647822">(Jun 08 2019 at 11:46)</a>:</h4>
<blockquote>
<p>on the first error. The validator in <a href="http://test.fhir.org/r3" target="_blank" title="http://test.fhir.org/r3">test.fhir.org/r3</a> is running behind, and is not reliable</p>
</blockquote>
<p>Not sure if that affects us, but it might affect our implementers.</p>



<a name="167801003"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167801003" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167801003">(Jun 10 2019 at 22:09)</a>:</h4>
<p>Thanks a lot <span class="user-mention" data-user-id="191375">@Alexander Henket</span></p>



<a name="167810884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/167810884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#167810884">(Jun 11 2019 at 01:26)</a>:</h4>
<p>RI/HAPI validation issues with the snapshots<br>
StructureDefinition - 400 zib-Infusion-Product.json<br>
StructureDefinition.snapshot.element[27].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 images-List.json<br>
StructureDefinition.snapshot.element[20].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 zib-FeedingTubeSystem-Product.json<br>
StructureDefinition.snapshot.element[27].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 nl-core-person.json<br>
StructureDefinition.snapshot.element[16].example.valueUri - URI values cannot have whitespace<br>
StructureDefinition.differential - No slicing on the root element [element.first().slicing.empty()<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"structure","details":{"text":"URI values cannot have whitespace"},"location":["StructureDefinition.snapshot.element[16].example.valueUri (line 1, col 20183)"]},{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"No slicing on the root element [element.first().slicing.empty()]"},"location":["StructureDefinition.differential"]}]}</p>
<p>StructureDefinition - 400 mp612-DispenseToFHIRConversion-Organization.json<br>
StructureDefinition.snapshot.element[16].example.valueUri - URI values cannot have whitespace<br>
StructureDefinition.snapshot.element[25].example.valueUri - URI values cannot have whitespace<br>
StructureDefinition.snapshot.element[34].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 gp-DiagnosticResult.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"No slicing on the root element [element.first().slicing.empty()]"},"location":["StructureDefinition.differential"]}]}</p>
<p>StructureDefinition - 400 images-Media.json<br>
StructureDefinition.snapshot.element[23].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 zib-VaccinationRecommendation.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]"},"location":["StructureDefinition.differential.element[4].binding"]}]}</p>
<p>StructureDefinition - 400 nl-core-practitioner.json<br>
StructureDefinition.snapshot.element[16].example.valueUri - URI values cannot have whitespace<br>
StructureDefinition.snapshot.element[25].example.valueUri - URI values cannot have whitespace<br>
StructureDefinition.snapshot.element[34].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 zib-MedicalDeviceProduct.json<br>
StructureDefinition.snapshot.element[27].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 nl-core-organization.json<br>
StructureDefinition.snapshot.element[16].example.valueUri - URI values cannot have whitespace<br>
StructureDefinition.snapshot.element[25].example.valueUri - URI values cannot have whitespace<br>
StructureDefinition.snapshot.element[34].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 zib-AdministrationAgreement.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]"},"location":["StructureDefinition.differential.element[13].binding"]}]}</p>
<p>StructureDefinition - 400 gp-LaboratoryResult.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"No slicing on the root element [element.first().slicing.empty()]"},"location":["StructureDefinition.differential"]}]}</p>
<p>StructureDefinition - 400 zib-Infusion.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]"},"location":["StructureDefinition.differential.element[5].binding"]},{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]"},"location":["StructureDefinition.differential.element[7].binding"]}]}</p>
<p>StructureDefinition - 400 MedicationOverview.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"No slicing on the root element [element.first().slicing.empty()]"},"location":["StructureDefinition.differential"]}]}</p>
<p>StructureDefinition - 400 zib-DrugUse.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"code-invalid","details":{"text":"Coding.system must be an absolute reference, not a local reference"},"location":["StructureDefinition.snapshot.element[111].example.valueCodeableConcept.coding (line 1, col 159521)"]},{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"code-invalid","details":{"text":"Coding.system must be an absolute reference, not a local reference"},"location":["StructureDefinition.differential.element[27].example.valueCodeableConcept.coding (line 1, col 159521)"]}]}</p>
<p>StructureDefinition - 400 zib-Infusion-AdministeringSystem.json<br>
StructureDefinition.snapshot.element[28].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 mp612-DispenseToFHIRConversion-AdministrationAgreement.json<br>
StructureDefinition.snapshot.element[27].example.valueUri - URI values cannot have whitespace</p>
<p>StructureDefinition - 400 mp612-DispenseToFHIRConversion-Dispense.json<br>
StructureDefinition.snapshot.element[29].example.valueUri - URI values cannot have whitespace<br>
StructureDefinition.snapshot.element[39].example.valueUri - URI values cannot have whitespace </p>
<p>StructureDefinition - 400 zib-FreedomRestrictingMeasures.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]"},"location":["StructureDefinition.differential.element[4].binding"]}]}</p>
<p>StructureDefinition - 400 zib-MedicationAdministration.json<br>
StructureDefinition.snapshot.element[28].example.valueUri - URI values cannot have whitespace </p>
<p>StructureDefinition - 400 zib-TobaccoUse.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"structure","details":{"text":"if a date has a time, it must have a timezone"},"location":["StructureDefinition.snapshot.element[33].example.valueDateTime (line 1, col 159553)"]},{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"structure","details":{"text":"if a date has a time, it must have a timezone"},"location":["StructureDefinition.differential.element[11].example.valueDateTime (line 1, col 159553)"]}]}</p>
<p>StructureDefinition - 400 zib-MedicationAgreement.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"structure","details":{"text":"URI values cannot have whitespace"},"location":["StructureDefinition.snapshot.element[72].example.valueCodeableConcept.coding.system (line 1, col 176179)"]},{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]"},"location":["StructureDefinition.differential.element[12].binding"]},{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"structure","details":{"text":"URI values cannot have whitespace"},"location":["StructureDefinition.differential.element[38].example.valueCodeableConcept.coding.system (line 1, col 176179)"]}]}</p>
<p>StructureDefinition - 400 zib-MedicationUse.json<br>
{"resourceType":"OperationOutcome","issue":[{"extension":[{"url":"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source","valueCode":"InstanceValidator"}],"severity":"error","code":"invariant","details":{"text":"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]"},"location":["StructureDefinition.differential.element[10]</p>



<a name="168184195"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168184195" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168184195">(Jun 15 2019 at 01:17)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span> can you please let me know if I should post these issues somewhere? Is there a tracker for Nictiz?</p>



<a name="168397491"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168397491" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168397491">(Jun 18 2019 at 12:56)</a>:</h4>
<p><span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span> : bugs for this should be reported through <a href="https://bits.nictiz.nl/browse/MM" target="_blank" title="https://bits.nictiz.nl/browse/MM">https://bits.nictiz.nl/browse/MM</a>. Login not required, all bugs are public</p>



<a name="168398739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168398739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168398739">(Jun 18 2019 at 13:10)</a>:</h4>
<p>I see a lot of errors are about a white in a URI. Example fragment of where that goes sour:</p>
<div class="codehilite"><pre><span></span>&lt;example&gt;
  &lt;label value=&quot;General&quot; /&gt;
  &lt;valueUri value=&quot;http://www.acme.com/identifiers/patient or urn:ietf:rfc:3986 if the Identifier.value itself is a full uri&quot; /&gt;
&lt;/example&gt;
</pre></div>


<p>I've tracked back to where that comes from, and the source is in the dependency we have on the FHIR Core Datatypes as expressed in Simplifier here: <a href="https://simplifier.net/Simplifier.Core.Stu3.DataTypes/Identifier/~xml" target="_blank" title="https://simplifier.net/Simplifier.Core.Stu3.DataTypes/Identifier/~xml">https://simplifier.net/Simplifier.Core.Stu3.DataTypes/Identifier/~xml</a></p>
<p><span class="user-mention" data-user-id="191335">@Martijn Harthoorn</span> / <span class="user-mention" data-user-id="191336">@Michel Rutten</span> : Could one of you comment here?</p>



<a name="168398943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168398943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168398943">(Jun 18 2019 at 13:12)</a>:</h4>
<p>This 'error' is a bug in HAPI/the fhirPath expression:</p>
<div class="codehilite"><pre><span></span>StructureDefinition - 400 nl-core-person.json
StructureDefinition.differential - No slicing on the root element [element.first().slicing.empty()
</pre></div>


<p>The fragment it considers is this:</p>
<div class="codehilite"><pre><span></span>  &lt;differential&gt;
    &lt;element id=&quot;Person.identifier&quot;&gt;
      &lt;path value=&quot;Person.identifier&quot; /&gt;
      &lt;slicing&gt;
        &lt;discriminator&gt;
          &lt;type value=&quot;value&quot; /&gt;
          &lt;path value=&quot;system&quot; /&gt;
        &lt;/discriminator&gt;
        &lt;rules value=&quot;open&quot; /&gt;
      &lt;/slicing&gt;
</pre></div>


<p>As you can see, there is slicing on the first element in the differential, but that element is not the root element of the resource. Hence the check does not apply. The same is true for every other occurrence of this error. We never sliced the root element in the differential. Forge will always remove elements from the differential that do not have any change in them. Hence, unless we 'fake' a change in the resource root element, it will not be present in the differential.</p>



<a name="168399737"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168399737" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168399737">(Jun 18 2019 at 13:21)</a>:</h4>
<p>This is another bug in the HAPI validator:</p>
<div class="codehilite"><pre><span></span>StructureDefinition - 400 zib-AdministrationAgreement.json
&quot;provide either a reference or a description (or both) [valueSet.exists() or description.exists()]&quot;
</pre></div>


<p>The fragment is:</p>
<div class="codehilite"><pre><span></span>&lt;binding&gt;
  &lt;strength value=&quot;required&quot; /&gt;
&lt;/binding&gt;
</pre></div>


<p>What this does is make the binding strength required while the full valueset binding/description lives in the extension in this path. While you 'could' restate valueSet+description this is just error prone. As far ass I know the validator check that trigger this false negative has been updated to only work on bindings in the snapshot where everything is expected to be completed (which it is).</p>



<a name="168400161"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168400161" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168400161">(Jun 18 2019 at 13:26)</a>:</h4>
<p>I believe these three types of errors are the only ones listed. Of those there isn't anything we can do right now as we depend on an updated datatype package in Simplifier, and on relaxed validation in HAPI, as far as I can tell. I'm not sure how to request an update for HAPI, but I believe <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> co maintains the underlying logic?</p>



<a name="168405154"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168405154" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168405154">(Jun 18 2019 at 14:18)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span> concerning the first issue, looks like an error in the official STU3 core definition of Identifier datatype (in profiles-types), seems fixed in R4.</p>
<p>[STU3] profiles-types.xml:</p>
<div class="codehilite"><pre><span></span>&lt;element id=&quot;Identifier.system&quot;&gt;
  &lt;!-- ... --&gt;
  &lt;example&gt;
    &lt;label value=&quot;General&quot; /&gt;
    &lt;valueUri value=&quot;http://www.acme.com/identifiers/patient or urn:ietf:rfc:3986 if the Identifier.value itself is a full uri&quot; /&gt;
  &lt;/example&gt;
</pre></div>


<p>[R4] profiles-types.xml:</p>
<div class="codehilite"><pre><span></span>&lt;element id=&quot;Identifier.system&quot;&gt;
  &lt;!-- ... --&gt;
  &lt;example&gt;
    &lt;label value=&quot;General&quot;/&gt;
    &lt;valueUri value=&quot;http://www.acme.com/identifiers/patient&quot;/&gt;
  &lt;/example&gt;
</pre></div>


<p>Note that the STU3 definition specifies an invalid example uri value.</p>



<a name="168405671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168405671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168405671">(Jun 18 2019 at 14:23)</a>:</h4>
<p>Spurious warnings about invalid slice names on the root element have been reported for a while, this is a known bug in the Java validator. Invariant sdf-20 disallows slice names on the <em>root</em> element; however the first element included in the differential component may (and often will) not be the root element.</p>



<a name="168439022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168439022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168439022">(Jun 18 2019 at 17:58)</a>:</h4>
<p>these all look like issues in the invariants - please create tasks for when we release a patch on R3 in about 6 weeks time</p>



<a name="168463434"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168463434" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168463434">(Jun 18 2019 at 23:04)</a>:</h4>
<p>sdf-20 seems sufficiently covered for STU3: <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20391" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20391">GF#20391</a>, <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20339" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20339">GF#20339</a>, <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13768" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13768">GF#13768</a></p>
<p>eld-10 is was fixed through <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13782" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13782">GF#13782</a> in R4 -- I added <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22712" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22712">GF#22712</a> to flag it for STU3</p>
<p>the illegal datatype example is discussed here: <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17431" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17431">GF#17431</a> -- I added <a href="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22711" target="_blank" title="http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22711">GF#22711</a> to flag it for STU3</p>
<p>Let me know if you need anything else <span class="user-mention" data-user-id="191316">@Grahame Grieve</span></p>



<a name="168463782"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168463782" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168463782">(Jun 18 2019 at 23:11)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> : Thanks. As long as the illegal example is in the Simplifier core datatype package, it would seem impossible to produce valid snapshots as identifier.system is in any snapshot. We could wait for the official patch on STU3 to be released, update Simplifier and then update our dependency, and in the mean try hold off publications on our side. Alternatively we could patch all snapshots after creating them. The other option is an update in the identifier.system example in advance of the official STU3 patch.<br>
What would you advise?</p>



<a name="168543420"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168543420" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168543420">(Jun 19 2019 at 20:36)</a>:</h4>
<p>We ignored validation of the profiles for now and moved on to validating the published example resources against these profiles. For Appointment examples, the errors we get are (other than trivial processing instruction and xsi:schemaLocation errors):</p>
<ul>
<li>Could not match discriminator (coding.system) for slice Appointment.specialty:specialtyAGB in profile <a href="http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment" target="_blank" title="http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment">http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment</a> - does not have fixed value, binding or existence assertions</li>
<li>Could not match discriminator (coding.system) for slice Appointment.specialty:specialtyUZI in profile <a href="http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment" target="_blank" title="http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment">http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment</a> - does not have fixed value, binding or existence assertions</li>
</ul>



<a name="168582820"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168582820" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michel Rutten <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168582820">(Jun 20 2019 at 10:10)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span>, not sure if this works for you, but since this is caused by an issue in the spec and is therefore out of your control, I'd propose to ignore the invalid uri validation error for now (i.e. consider this a "known issue"), until HL7 has published a technical correction.<br>
However if that causes confusion and you really need to suppress the validation error, then I suggest to (temporarily) override the invalid uri example values in the diff of all the consuming profiles.</p>



<a name="168596806"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168596806" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168596806">(Jun 20 2019 at 13:48)</a>:</h4>
<p><span class="user-mention" data-user-id="191336">@Michel Rutten</span> Thanks. We would not notice this as we do not check the snapshots through HAPI. We load them in Touchstone. It they work there, we assume they are valid. Touchstone uses the validator (STU3).</p>
<p>In a sense it is a good thing that Simplifier cannot produce snapshots yet. We produce those separate from the package, so we can also post-process them and just kick out the problematic examples before uploading to github</p>



<a name="168598051"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/168598051" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#168598051">(Jun 20 2019 at 14:00)</a>:</h4>
<p><span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span> I honestly do not know what that error means. Appointment.specialty has two slices defined. Each carries an extensible binding to a ValueSet. The ValueSets have different systems they bind to.</p>
<p>I cannot reproduce what you saw when I validate the examples on Simplifier (other things, but not that)</p>



<a name="177107661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177107661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177107661">(Oct 01 2019 at 23:25)</a>:</h4>
<p>Sorry for restarting this old thread. We had tried to validate profiles and valuesets from Nictiz 1.2.0 release ignoring some of the validation errors from above. Now only 2 issues remain w.r.t. profiles<br>
<code>zib-TobaccoUse.xml</code>: The example dateTime value does not have a timezone as per the spec.</p>
<div class="codehilite"><pre><span></span>{
  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
  &quot;issue&quot;: [
    {
      &quot;extension&quot;: [
        {
          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,
          &quot;valueCode&quot;: &quot;InstanceValidator&quot;
        }
      ],
      &quot;severity&quot;: &quot;error&quot;,
      &quot;code&quot;: &quot;invalid&quot;,
      &quot;details&quot;: {
        &quot;text&quot;: &quot;if a date has a time, it must have a timezone&quot;
      },
      &quot;location&quot;: [
        &quot;StructureDefinition.snapshot.element[33].example.valueDateTime (line 1, col 52887)&quot;
      ]
    },
    {
      &quot;extension&quot;: [
        {
          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,
          &quot;valueCode&quot;: &quot;InstanceValidator&quot;
        }
      ],
      &quot;severity&quot;: &quot;error&quot;,
      &quot;code&quot;: &quot;invalid&quot;,
      &quot;details&quot;: {
        &quot;text&quot;: &quot;if a date has a time, it must have a timezone&quot;
      },
      &quot;location&quot;: [
        &quot;StructureDefinition.differential.element[11].example.valueDateTime (line 1, col 222920)&quot;
      ]
    }
  ]
}
</pre></div>


<p><code>zib-DrugUse.xml</code>: The example coding for <code>Observation.component:RouteOfAdministration.value[x]:valueCodeableConcept</code> uses a OID without specifying it as urn:oid:</p>
<div class="codehilite"><pre><span></span>&lt;system value=&quot;2.16.840.1.113883.2.4.4.9&quot; /&gt;
</pre></div>


<div class="codehilite"><pre><span></span>{
  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
  &quot;issue&quot;: [
    {
      &quot;extension&quot;: [
        {
          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,
          &quot;valueCode&quot;: &quot;InstanceValidator&quot;
        }
      ],
      &quot;severity&quot;: &quot;error&quot;,
      &quot;code&quot;: &quot;code-invalid&quot;,
      &quot;details&quot;: {
        &quot;text&quot;: &quot;Coding.system must be an absolute reference, not a local reference&quot;
      },
      &quot;location&quot;: [
        &quot;StructureDefinition.snapshot.element[111].example.valueCodeableConcept.coding (line 1, col 172501)&quot;
      ]
    },
    {
      &quot;extension&quot;: [
        {
          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,
          &quot;valueCode&quot;: &quot;InstanceValidator&quot;
        }
      ],
      &quot;severity&quot;: &quot;error&quot;,
      &quot;code&quot;: &quot;code-invalid&quot;,
      &quot;details&quot;: {
        &quot;text&quot;: &quot;Coding.system must be an absolute reference, not a local reference&quot;
      },
      &quot;location&quot;: [
        &quot;StructureDefinition.differential.element[27].example.valueCodeableConcept.coding (line 1, col 224000)&quot;
      ]
    }
  ]
}
</pre></div>



<a name="177107819"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177107819" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177107819">(Oct 01 2019 at 23:27)</a>:</h4>
<p>Next, coming to ValueSets, there is one error in <code>RedenWijzigenStakenMedicatiegebruikCodelijst-2.16.840.1.113883.2.4.3.11.60.20.77.11.37--20181218104254.xml</code> with url <code>http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.20.77.11.37--20181218104254</code><br>
The error is with display having a whitespace at the start as shown below</p>
<div class="codehilite"><pre><span></span>&lt;include&gt;
            &lt;system value=&quot;urn:oid:2.16.840.1.113883.2.4.3.11.60.20.77.5.2.2&quot;/&gt;
            &lt;concept&gt;
                &lt;code value=&quot;16&quot;/&gt;
                &lt;display value=&quot; Allergie of non-allergische overgevoeligheid of bijwerking&quot;/&gt;
            &lt;/concept&gt;
</pre></div>


<div class="codehilite"><pre><span></span>{
  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,
  &quot;issue&quot;: [
    {
      &quot;extension&quot;: [
        {
          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,
          &quot;valueCode&quot;: &quot;InstanceValidator&quot;
        }
      ],
      &quot;severity&quot;: &quot;warning&quot;,
      &quot;code&quot;: &quot;invalid&quot;,
      &quot;details&quot;: {
        &quot;text&quot;: &quot;value should not start or finish with whitespace&quot;
      },
      &quot;location&quot;: [
        &quot;ValueSet.compose.include[3].concept[1].display (line 1, col 3553)&quot;
      ]
    }
  ]
}
</pre></div>



<a name="177108040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177108040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177108040">(Oct 01 2019 at 23:30)</a>:</h4>
<p>Also, there seem to be atleast 11 ValueSets which include the whole of SNOMED-CT without any filter as below</p>
<div class="codehilite"><pre><span></span>&lt;compose&gt;
        &lt;include&gt;
            &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;
        &lt;/include&gt;
    &lt;/compose&gt;
</pre></div>


<p>Since we pre-compute the expansions at the time of writing of ValueSet, this causes enormous delays in importing these ValueSets.</p>



<a name="177109852"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177109852" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177109852">(Oct 02 2019 at 00:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191375">@Alexander Henket</span></p>



<a name="177110309"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177110309" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177110309">(Oct 02 2019 at 00:08)</a>:</h4>
<blockquote>
<p>Since we pre-compute the expansions at the time of writing of ValueSet</p>
</blockquote>
<p>You can't do that</p>



<a name="177112564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177112564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177112564">(Oct 02 2019 at 00:51)</a>:</h4>
<p>Well, if we dont pre-compute, then testing for ValueSet membership during resource validation would be very costly right? We were OK with pre-computing during ValueSet Create/Update for base and US Core. If I remember correctly, other than encounter-reason and body-site, the other valuesets are not big.</p>



<a name="177115039"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177115039" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177115039">(Oct 02 2019 at 01:53)</a>:</h4>
<p>that was just chance. The $validate-code operation is what the validator uses, so that you don't have to pre-compute expansions</p>



<a name="177120390"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177120390" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177120390">(Oct 02 2019 at 04:19)</a>:</h4>
<p>Yes, we implemented $validate-code based on the expansions. Otherwise, we would have had to expand the ValueSet at the $validate-code invocation which would be very costly.</p>



<a name="177120577"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177120577" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177120577">(Oct 02 2019 at 04:24)</a>:</h4>
<p>Of course, we could have avoided duplicating whole code systems like SNOMED-CT as part of expansion, but I am wondering about the reason having many ValueSets including/importing whole of SNOMED-CT.</p>



<a name="177121221"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177121221" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177121221">(Oct 02 2019 at 04:42)</a>:</h4>
<p>because any SNOMED code is valid</p>



<a name="177123526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177123526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177123526">(Oct 02 2019 at 05:51)</a>:</h4>
<p>Isn't that possible/preferable using <code>ValueSet.compose.include.valueSet</code> either using the implicit SNOMED ValueSet uri or using an explicitly defined ValueSet? Is there any advantage to have many ValueSets independently including from SNOMED? Sorry for the newbie questions, just trying to understand better.</p>



<a name="177123580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177123580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177123580">(Oct 02 2019 at 05:52)</a>:</h4>
<p>But anyway, this is not breaking us currently, just some multi second delay to load the ValueSet. I really appreciate if anyone can answer regarding the other issues above</p>



<a name="177123664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177123664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177123664">(Oct 02 2019 at 05:55)</a>:</h4>
<p>Also, while validating the Nictiz published resource examples against the profiles, the major cause of errors seems to be with slicing like below:</p>



<a name="177123667"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177123667" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177123667">(Oct 02 2019 at 05:55)</a>:</h4>
<div class="codehilite"><pre><span></span>Could not match discriminator (coding.system) for slice Appointment.specialty:specialtyAGB in profile http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment - does not have fixed value, binding or existence assertions
</pre></div>



<a name="177123737"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177123737" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177123737">(Oct 02 2019 at 05:57)</a>:</h4>
<p>That accounts for nearly 70% of validation errors from RI/HAPI.</p>



<a name="177124681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177124681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177124681">(Oct 02 2019 at 06:21)</a>:</h4>
<blockquote>
<p>Is there any advantage to have many ValueSets independently including from SNOMED</p>
</blockquote>
<p>No, there isn't.</p>



<a name="177124702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177124702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177124702">(Oct 02 2019 at 06:21)</a>:</h4>
<p>but quite a few systems can't cope with the implicit value sets for SNOMED CT</p>



<a name="177130436"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177130436" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177130436">(Oct 02 2019 at 08:18)</a>:</h4>
<blockquote>
<p>Next, coming to ValueSets, there is one error in RedenWijzigenStakenMedicatiegebruikCodelijst-2.16.840.1.113883.2.4.3.11.60.20.77.11.37--20181218104254.xml &lt;snip&gt; The error is with display having a whitespace at the start as shown below</p>
</blockquote>
<p>The ValueSets you see are created as exports from non FHIR CodeSystems/ValueSets. I think it is principally wrong in FHIR to have an invariant that effectively limits what a valid display name for a given code in a code system can be. It is just not for FHIR to decide. That invariant imho has to go away. That being said: in this particular case we can influence the master definition and so I have. We have just released an update to the package 1.2.0 yesterday. The next one is planned for end of October.</p>
<p>Note: I have not been able to find any invariant in the spec that governs the error from the validator (<a href="http://hl7.org/fhir/STU3/valueset.html" target="_blank" title="http://hl7.org/fhir/STU3/valueset.html">http://hl7.org/fhir/STU3/valueset.html</a>) so it might be that the error lives in the validator only.</p>
<p>I've logged: <a href="https://bits.nictiz.nl/browse/MM-593" target="_blank" title="https://bits.nictiz.nl/browse/MM-593">https://bits.nictiz.nl/browse/MM-593</a></p>



<a name="177131395"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177131395" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177131395">(Oct 02 2019 at 08:37)</a>:</h4>
<p>actually the issue is in the terminology server. I've fixed it but not deployed it.</p>



<a name="177131460"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177131460" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177131460">(Oct 02 2019 at 08:38)</a>:</h4>
<p>The invariant simply says that a display can't have leading or trailing whitespace, and that's anchored in XML rules. You can't really claim that the whitespace is meaningful?</p>



<a name="177131595"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177131595" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177131595">(Oct 02 2019 at 08:41)</a>:</h4>
<blockquote>
<p>can you please let me know if I should post these issues somewhere? Is there a tracker for Nictiz?</p>
</blockquote>
<p>As replied here before: bugs for this should be reported through <a href="https://bits.nictiz.nl/browse/MM" target="_blank" title="https://bits.nictiz.nl/browse/MM">https://bits.nictiz.nl/browse/MM</a>. Login not required, all issues are public</p>



<a name="177131838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177131838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177131838">(Oct 02 2019 at 08:45)</a>:</h4>
<blockquote>
<p>The invariant simply says that a display can't have leading or trailing whitespace, and that's anchored in XML rules. You can't really claim that the whitespace is meaningful?</p>
</blockquote>
<p>I cannot and I am not. I'm just saying the the terminologists do what they do in creating the display names. I just apply a FHIR 'jacket' or syntax to it. FHIR should not judge the whitespace on display names: they are outside of FHIRs span of control.</p>
<p>That being said: in this very case I am able to talk to the creators directly and have already convinced them to drop the leading whitespace even though the definition was already final and published in many other forms than just for FHIR. So: this problem will be solved, but the bigger picture still remains.</p>



<a name="177132447"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177132447" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177132447">(Oct 02 2019 at 08:55)</a>:</h4>
<blockquote>
<p>Also, there seem to be at least 11 ValueSets which include the whole of SNOMED-CT without any filter as below &lt;snip&gt; Since we pre-compute the expansions at the time of writing of ValueSet, this causes enormous delays in importing these ValueSets.</p>
</blockquote>
<p>I understand it may be cumbersome to deal with that, but there simply is no reuse of value sets by the underlying zibs by design. Whenever there is a need for a value set, the definition is crafted for that specific purpose. The decision making process at the ZIB Centrum in crafting terminology for the zibs has decided that reuse of value sets is not semantically possible because each context is unique. The advantage is that maintenance on any given value set created this way can be done with only 1 context in mind.</p>
<p>I may or may not agree with you that a value set that lists SNOMED CT without any restriction is not a very useful or even perhaps semantically sound statement in a given context, but discussing changes can only be done through the ZIB  Centrum that governs the zib contents that the FHIR IGs depend on. You may find the ZIB Centrum information here <a href="https://www.nictiz.nl/standaardisatie/zib-centrum/" target="_blank" title="https://www.nictiz.nl/standaardisatie/zib-centrum/">https://www.nictiz.nl/standaardisatie/zib-centrum/</a></p>



<a name="177132758"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177132758" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177132758">(Oct 02 2019 at 09:01)</a>:</h4>
<blockquote>
<p>We had tried to validate profiles and valuesets from Nictiz 1.2.0 release ignoring some of the validation errors from above. Now only 2 issues remain w.r.t. profiles zib-TobaccoUse.xml: The example dateTime value does not have a timezone as per the spec.</p>
</blockquote>
<p>Maybe I misread the spec, but I don't see that requirement for <a href="http://hl7.org/fhir/STU3/datatypes.html#datetime" target="_blank" title="http://hl7.org/fhir/STU3/datatypes.html#datetime">dateTime</a>. Only for <a href="http://hl7.org/fhir/STU3/datatypes.html#instant" target="_blank" title="http://hl7.org/fhir/STU3/datatypes.html#instant">instant</a>. I have also validated the example manually against the regex pattern in the spec and found it matched. Why would you say it is not?</p>
<p>matches('2012-02-28T00:00:00', '-?[0-9]{4}(-(0[1-9]|1[0-2])(-(0[0-9]|[1-2][0-9]|3[0-1])(T([01][0-9]|2[0-3]):[0-5][0-9]:[0-5]<a href="http://\.[0-9]+" target="_blank" title="http://\.[0-9]+">0-9</a>?(Z|(\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00)))?)?)?')</p>



<a name="177135458"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177135458" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177135458">(Oct 02 2019 at 09:46)</a>:</h4>
<blockquote>
<p>"If hours and minutes are specified, a time zone SHALL be populated"</p>
</blockquote>



<a name="177146087"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177146087" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177146087">(Oct 02 2019 at 12:50)</a>:</h4>
<p>Right, that is true. I've read right past that. <span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span> I've flagged this for update in the next update cycle here: <a href="https://bits.nictiz.nl/browse/MM-594" target="_blank" title="https://bits.nictiz.nl/browse/MM-594">https://bits.nictiz.nl/browse/MM-594</a></p>



<a name="177181449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177181449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177181449">(Oct 02 2019 at 19:01)</a>:</h4>
<blockquote>
<p>Could not match discriminator (coding.system) for slice Appointment.specialty:specialtyAGB in profile <a href="http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment" target="_blank" title="http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment">http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment</a> - does not have fixed value, binding or existence assertions</p>
</blockquote>
<p>I dont see any ElementDefinition for the element corresponding to the discriminator coding.system with type as value. I think  this is a common problem across many Nictiz profiles. I will open a tracker item for this.</p>



<a name="177185067"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177185067" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177185067">(Oct 02 2019 at 19:44)</a>:</h4>
<p>Posted <a href="https://bits.nictiz.nl/browse/MM-597" target="_blank" title="https://bits.nictiz.nl/browse/MM-597">https://bits.nictiz.nl/browse/MM-597</a> for the issue with zib-DrugUse.xml using a OID without urn:oid</p>



<a name="177188866"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177188866" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177188866">(Oct 02 2019 at 20:24)</a>:</h4>
<blockquote>
<p>Each slice must use the element definition for the element in the discriminator(s) to ensure that the slices are clearly differentiated (by assigning a fixed value, a specific type, or a profile, depending on the discriminator type. If the type is 'value', then the element definition must use either ElementDefinition.fixed[x] or, if the element has a terminology binding, a required binding with a Value Set that enumerates the list of possible codes in the value set ("extensional definition").</p>
</blockquote>
<p>Is my understanding right that the profile should have the ElementDefinition for the element corresponding to the path given in discriminator?</p>



<a name="177193786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177193786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Mohan Tumuluri <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177193786">(Oct 02 2019 at 21:23)</a>:</h4>
<p>Posted <a href="https://bits.nictiz.nl/browse/MM-598" target="_blank" title="https://bits.nictiz.nl/browse/MM-598">https://bits.nictiz.nl/browse/MM-598</a> for the issue <code>Could not match discriminator ... for slice ... in profile ...  - does not have fixed value, binding or existence assertions</code></p>



<a name="177204446"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177204446" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177204446">(Oct 03 2019 at 00:09)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> We slice by value set in a number of cases. Each value set carries codes from a different system, so we define our discriminator based on value of system. Apparently HAPI has beef with that. We have not heard complaints from other systems thus far.</p>
<ul>
<li>Is what we do allowable? I believe so, but just checking</li>
<li>Is there a better way?</li>
<li>Would having required bindings rather than extensible help here?</li>
</ul>
<p>Example:</p>
<div class="codehilite"><pre><span></span>    &lt;element id=&quot;PractitionerRole.specialty.coding&quot;&gt;
      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;
      &lt;slicing&gt;
        &lt;discriminator&gt;
          &lt;type value=&quot;value&quot; /&gt;
          &lt;path value=&quot;system&quot; /&gt;
        &lt;/discriminator&gt;
        &lt;rules value=&quot;open&quot; /&gt;
      &lt;/slicing&gt;
    &lt;/element&gt;
    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyUZI&quot;&gt;
      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;
      &lt;sliceName value=&quot;SpecialtyUZI&quot; /&gt;
        &lt;strength value=&quot;extensible&quot; /&gt;
        &lt;valueSetReference&gt;
          &lt;reference value=&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.17.1.6--20171231000000&quot; /&gt;
          &lt;display value=&quot;SpecialismeUZICodelijst&quot; /&gt;
        &lt;/valueSetReference&gt;
      &lt;/binding&gt;
    &lt;/element&gt;
    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyAGB&quot;&gt;
      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;
      &lt;sliceName value=&quot;SpecialtyAGB&quot; /&gt;
        &lt;strength value=&quot;extensible&quot; /&gt;
        &lt;valueSetReference&gt;
          &lt;reference value=&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.17.1.7--20171231000000&quot; /&gt;
          &lt;display value=&quot;SpecialismeAGBCodelijst&quot; /&gt;
        &lt;/valueSetReference&gt;
      &lt;/binding&gt;
    &lt;/element&gt;
</pre></div>



<a name="177204883"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177204883" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177204883">(Oct 03 2019 at 00:21)</a>:</h4>
<blockquote>
<p>Posted <a href="https://bits.nictiz.nl/browse/MM-597" target="_blank" title="https://bits.nictiz.nl/browse/MM-597">https://bits.nictiz.nl/browse/MM-597</a> for the issue with zib-DrugUse.xml using a OID without urn:oid</p>
</blockquote>
<p><span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span> <a href="https://bits.nictiz.nl/browse/MM-597" target="_blank" title="https://bits.nictiz.nl/browse/MM-597">MM-597</a> Fixed and marked for next update</p>



<a name="177205425"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177205425" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177205425">(Oct 03 2019 at 00:33)</a>:</h4>
<p><span class="user-mention" data-user-id="192218">@Anand Mohan Tumuluri</span> <a href="https://bits.nictiz.nl/browse/MM-598" target="_blank" title="https://bits.nictiz.nl/browse/MM-598">MM-598</a> updated</p>



<a name="177217096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177217096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177217096">(Oct 03 2019 at 05:52)</a>:</h4>
<p>looks like you forgot &lt;binding&gt; in your copy. But it's possible that the validator is not handling this right - can you give me an instance and a profile as a test case so I can investigate?</p>



<a name="177221838"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177221838" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177221838">(Oct 03 2019 at 07:44)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> O dear, in creating a somewhat condensed view I deleted too much I see. The original is on <a href="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Profiles%20-%20ZIB%202017/nl-core-practitionerrole.xml" target="_blank" title="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Profiles%20-%20ZIB%202017/nl-core-practitionerrole.xml">GitHub</a> and there you may also find an <a href="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Examples/medmij-bgz-fhir3-0-1-practitionerrole-ts-01.xml" target="_blank" title="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Examples/medmij-bgz-fhir3-0-1-practitionerrole-ts-01.xml">example</a>. Alternatively you could work with the <a href="https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/1.3.0" target="_blank" title="https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/1.3.0">current package</a> as a whole from Simplifier</p>



<a name="177223283"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177223283" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177223283">(Oct 03 2019 at 08:13)</a>:</h4>
<p>where can I find the definition for the code system urn:oid:2.16.840.1.113883.2.4.6.7?</p>



<a name="177223369"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177223369" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177223369">(Oct 03 2019 at 08:14)</a>:</h4>
<p>same for <a href="http://fhir.nl/fhir/NamingSystem/uzi-rolcode" target="_blank" title="http://fhir.nl/fhir/NamingSystem/uzi-rolcode">http://fhir.nl/fhir/NamingSystem/uzi-rolcode</a></p>



<a name="177254241"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177254241" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177254241">(Oct 03 2019 at 15:13)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  There is no FHIR expression for many of our CodeSystems. For OIDs we have the OID Registry which allows for export of NamingSystems.</p>
<ul>
<li>
<p><a href="http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.6.7" target="_blank" title="http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.6.7">http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.6.7</a> (Vektis Zorgverlenersspecificatie)<br>
** Codes maintained in a <a href="https://www.vektis.nl/streams/standaardisatie/codelijsten/COD016-VEKT" target="_blank" title="https://www.vektis.nl/streams/standaardisatie/codelijsten/COD016-VEKT">non-FHIR-aware online system</a> by some government body. Systems can subscribe themselves to updates in a non-FHIR way or download Excel files from the website when they see fit.</p>
</li>
<li>
<p><a href="http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/?value=http://fhir.nl/fhir/NamingSystem/uzi-rolcode&amp;id-type=uri" target="_blank" title="http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/?value=http://fhir.nl/fhir/NamingSystem/uzi-rolcode&amp;id-type=uri">http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/?value=http://fhir.nl/fhir/NamingSystem/uzi-rolcode&amp;id-type=uri</a> or</p>
</li>
<li><a href="http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.15.111" target="_blank" title="http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.15.111">http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.15.111</a> (uzi-rolcode)<br>
** Codes maintained in a Certificate Practice Statement document in PDF based on national law by some government body. Periodically copied manually into a DECOR <a href="https://decor.nictiz.nl/art-decor/decor-valuesets--nictiz2bbr-?id=2.16.840.1.113883.2.4.3.11.60.1.11.2&amp;language=en-US" target="_blank" title="https://decor.nictiz.nl/art-decor/decor-valuesets--nictiz2bbr-?id=2.16.840.1.113883.2.4.3.11.60.1.11.2&amp;language=en-US">ValueSet</a> and exported from there.</li>
</ul>
<p>But those CodeSystem contents are not relevant for the slice determination based on system are they? Not having access to code systems contents, only affects what FHIR validation you could perform on the code.</p>



<a name="177280190"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177280190" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177280190">(Oct 03 2019 at 19:48)</a>:</h4>
<p>the validator is not smart enough at this time to see that:</p>
<ul>
<li>you have fixed the value of system</li>
<li>you have bound the slices of Coding to a value set </li>
<li>the value set specifies a fixed system</li>
<li>it can therefore figure out the slicing. </li>
</ul>
<p>It says "you fixed the system. I'm looking for a fixed value for system". So then you get ```Could not match discriminator ... for slice ... in profile ...  - does not have fixed value, binding or existence assertions````</p>



<a name="177280230"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177280230" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177280230">(Oct 03 2019 at 19:48)</a>:</h4>
<p>and nor is it smart enough to figure that out without access to the code system definition either.</p>



<a name="177280304"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177280304" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177280304">(Oct 03 2019 at 19:49)</a>:</h4>
<p>(since it would use the terminology server for that, and it will say, can't access the code system to know what is going on)</p>



<a name="177280481"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177280481" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177280481">(Oct 03 2019 at 19:50)</a>:</h4>
<p>And I think that what you are doing isn't conformant:</p>
<blockquote>
<p>Each slice must use the element definition for the element(s) in the discriminator(s)</p>
</blockquote>



<a name="177344000"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177344000" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177344000">(Oct 04 2019 at 14:32)</a>:</h4>
<p>I really fail to see why the profile validator would need a terminology server to find out what the value for system is when it has the ValueSet telling it just that? The only thing a terminology server could tell it that the ValueSet doesn't is which codes belong to the system, but for slicing this is not interesting. For instance validation you might need it, but alas I will never be able to distribute systems outside of my control or behind a pay wall (medication codes are to name one)</p>
<p>What do you recommend for this situation in STU3? It sounds like the slicing mechanism has a missing feature: slicing by ValueSet is quite common for us.</p>



<a name="177344831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177344831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177344831">(Oct 04 2019 at 14:41)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> Presumably I could duplicate what the ValueSet is already telling me by adding a fixed system in the profile matching the ValueSet system? Forge at least lets me do that. Not sure what to do for ValueSets that pick from more than 1 system, but I did not check if we have those.</p>
<div class="codehilite"><pre><span></span>    &lt;element id=&quot;PractitionerRole.specialty.coding&quot;&gt;
      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;
      &lt;slicing&gt;
        &lt;discriminator&gt;
          &lt;type value=&quot;value&quot; /&gt;
          &lt;path value=&quot;system&quot; /&gt;
        &lt;/discriminator&gt;
        &lt;rules value=&quot;open&quot; /&gt;
      &lt;/slicing&gt;
    &lt;/element&gt;
    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyUZI&quot;&gt;
      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;
      &lt;sliceName value=&quot;SpecialtyUZI&quot; /&gt;
      &lt;short value=&quot;SpecialtyUZI&quot; /&gt;
      &lt;alias value=&quot;SpecialismeUZI&quot; /&gt;
      &lt;binding&gt;
        &lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName&quot;&gt;
          &lt;valueString value=&quot;PractitionerSpecialty&quot; /&gt;
        &lt;/extension&gt;
        &lt;strength value=&quot;extensible&quot; /&gt;
        &lt;valueSetReference&gt;
          &lt;reference value=&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.17.1.6--20171231000000&quot; /&gt;
          &lt;display value=&quot;SpecialismeUZICodelijst&quot; /&gt;
        &lt;/valueSetReference&gt;
      &lt;/binding&gt;
    &lt;/element&gt;
    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyUZI.system&quot;&gt;
      &lt;path value=&quot;PractitionerRole.specialty.coding.system&quot; /&gt;
      &lt;fixedUri value=&quot;http://fhir.nl/fhir/NamingSystem/uzi-rolcode&quot; /&gt;
    &lt;/element&gt;
    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyAGB&quot;&gt;
      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;
      &lt;sliceName value=&quot;SpecialtyAGB&quot; /&gt;
      &lt;short value=&quot;SpecialtyAGB&quot; /&gt;
      &lt;alias value=&quot;SpecialismeAGB&quot; /&gt;
      &lt;binding&gt;
        &lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName&quot;&gt;
          &lt;valueString value=&quot;PractitionerSpecialty&quot; /&gt;
        &lt;/extension&gt;
        &lt;strength value=&quot;extensible&quot; /&gt;
        &lt;valueSetReference&gt;
          &lt;reference value=&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.17.1.7--20171231000000&quot; /&gt;
          &lt;display value=&quot;SpecialismeAGBCodelijst&quot; /&gt;
        &lt;/valueSetReference&gt;
      &lt;/binding&gt;
    &lt;/element&gt;
    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyAGB.system&quot;&gt;
      &lt;path value=&quot;PractitionerRole.specialty.coding.system&quot; /&gt;
      &lt;fixedUri value=&quot;urn:oid:2.16.840.1.113883.2.4.6.7&quot; /&gt;
    &lt;/element&gt;
</pre></div>



<a name="177345739"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177345739" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177345739">(Oct 04 2019 at 14:48)</a>:</h4>
<blockquote>
<p>And I think that what you are doing isn't conformant:</p>
<blockquote>
<p>Each slice must use the element definition for the element(s) in the discriminator(s)</p>
</blockquote>
</blockquote>
<p>If you would let me in on what that message means I could agree or disagree :-) If I understand what it means correctly, I tend to disagree. I have an ElementDefinition that, through its binding, defines what the system is that I use to slice. So far I see a tooling issue, not a profile issue. More than happy to implement a workaround if one exists for STU3 that does not involve having to produce CodeSystems for systems I cannot produce.</p>



<a name="177376605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177376605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177376605">(Oct 04 2019 at 20:33)</a>:</h4>
<blockquote>
<p>I really fail to see why the profile validator would need a terminology server to find out what the value for system is when it has the ValueSet telling it just that</p>
</blockquote>
<p>I sad it wasn't smart enough to do that. Not that it's impossible. I might be able to sort that out - there's enough information present, but I don't think that what you are doing is conformant.</p>



<a name="177376699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177376699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177376699">(Oct 04 2019 at 20:35)</a>:</h4>
<blockquote>
<p>Each slice must use the element definition for the element(s) in the discriminator(s)</p>
</blockquote>
<p>You nominate the element on which you slice - <code>system</code><br>
So the validator goes looking for the element definition for the element in the discriminator - <code>system</code>, and doesn't find one</p>



<a name="177376794"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177376794" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177376794">(Oct 04 2019 at 20:36)</a>:</h4>
<p>the fixedUri approach looks like it should work. if it doesn't, we can review further.</p>



<a name="177496604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177496604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177496604">(Oct 07 2019 at 07:33)</a>:</h4>
<blockquote>
<p>I sad it wasn't smart enough to do that. Not that it's impossible.</p>
</blockquote>
<p>Ok good then I missed that nuance.</p>



<a name="177497076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177497076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177497076">(Oct 07 2019 at 07:42)</a>:</h4>
<blockquote>
<p>the fixedUri approach looks like it should work. if it doesn't, we can review further.</p>
</blockquote>
<p>Ok, I will try to test that. There is a second solution. Looking in our archives of logged issues I found <a href="https://bits.nictiz.nl/browse/MM-433" target="_blank" title="https://bits.nictiz.nl/browse/MM-433">MM-433</a> that proposes to use $this + value set binding required (not: extensible). I'm told the .Net validator has been updated to support that as <a href="https://github.com/FirelyTeam/fhir-net-api/issues/1070" target="_blank" title="https://github.com/FirelyTeam/fhir-net-api/issues/1070">recent as last week</a>. I'd expect that the Java validator would support the same. -- related topic: <a href="#narrow/stream/179177-conformance/topic/Slicing.20and.20value.20sets" title="#narrow/stream/179177-conformance/topic/Slicing.20and.20value.20sets">https://chat.fhir.org/#narrow/stream/179177-conformance/topic/Slicing.20and.20value.20sets</a></p>
<p>There is something uneasy about adding an ElementDefinition system to the profile: I do not want to duplicate ValueSet definitions in my profiles as that may go out of sync.</p>
<p>There is also something uneasy in using $this as discriminator: how do I know what the rules are for the validator in that case? I would expect code + system, with fallback on just system if there is no expansion for the ValueSet. I definitely do not expect any check on display, version or userSelected to determine the slice. Is that how it is supposed to work, or is that just my interpretation?</p>



<a name="177499539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177499539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177499539">(Oct 07 2019 at 08:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I wanted to check what happens with our profiles in the validator, and downloaded the validator. I don't get far using either the Simplifier package or the base folder:</p>
<div class="codehilite"><pre><span></span>mbp:STU3 ahenket$ java -jar org.hl7.fhir.validator.jar -ig nictiz.fhir.nl.stu3.zib2017-1.3.0.tgz -version 3.0 -recurse -debug instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml
FHIR Validation tool Version 4.0.23-SNAPSHOT - Built 2019-10-02T15:02:10.634+10:00 - Git 17e7333bcab7
Detected Java version: 1.8.0_121 from /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available
Arguments: -ig nictiz.fhir.nl.stu3.zib2017-1.3.0.tgz -version 3.0 -recurse -debug instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml
Directories: Current = /Users/ahenket/Development/FHIR/STU3, Package Cache = /Users/ahenket/.fhir/packages
  .. connect to tx server @ http://tx.fhir.org
  .. definitions from hl7.fhir.core#3.0.1
    (v3.0.1)
+  .. load IG from nictiz.fhir.nl.stu3.zib2017-1.3.0.tgz
Loading nictiz.fhir.nl.stu3.zib2017-1.3.0.tgz to the package cache
  Fetching:.......................... done.
Exception in thread &quot;main&quot; java.lang.UnsupportedOperationException: JsonNull
    at com.google.gson.JsonElement.getAsString(JsonElement.java:192)
    at org.hl7.fhir.utilities.cache.NpmPackage.canonical(NpmPackage.java:278)
    at org.hl7.fhir.utilities.cache.PackageCacheManager.extractLocally(PackageCacheManager.java:525)
    at org.hl7.fhir.r5.validation.ValidationEngine.loadPackage(ValidationEngine.java:616)
    at org.hl7.fhir.r5.validation.ValidationEngine.loadIgSource(ValidationEngine.java:511)
    at org.hl7.fhir.r5.validation.ValidationEngine.loadIg(ValidationEngine.java:776)
    at org.hl7.fhir.r5.validation.Validator.main(Validator.java:481)

mbp:STU3 ahenket$ java -jar org.hl7.fhir.validator.jar -ig ../../GitHub/Nictiz/Nictiz-STU3-Zib2017/Profiles\ -\ ZIB\ 2017/  -version 3.0 -recurse -debug instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml
FHIR Validation tool Version 4.0.23-SNAPSHOT - Built 2019-10-02T15:02:10.634+10:00 - Git 17e7333bcab7
Detected Java version: 1.8.0_121 from /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available
Arguments: -ig &quot;../../GitHub/Nictiz/Nictiz-STU3-Zib2017/Profiles - ZIB 2017/&quot; -version 3.0 -recurse -debug instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml
Directories: Current = /Users/ahenket/Development/FHIR/STU3, Package Cache = /Users/ahenket/.fhir/packages
  .. connect to tx server @ http://tx.fhir.org
  .. definitions from hl7.fhir.core#3.0.1
    (v3.0.1)
+  .. load IG from ../../GitHub/Nictiz/Nictiz-STU3-Zib2017/Profiles - ZIB 2017/
Exception in thread &quot;main&quot; java.lang.StringIndexOutOfBoundsException: String index out of range: -1
    at java.lang.String.substring(String.java:1967)
    at org.hl7.fhir.utilities.Utilities.path(Utilities.java:549)
    at org.hl7.fhir.r5.validation.ValidationEngine.loadIgSource(ValidationEngine.java:502)
    at org.hl7.fhir.r5.validation.ValidationEngine.loadIg(ValidationEngine.java:776)
    at org.hl7.fhir.r5.validation.Validator.main(Validator.java:481)
</pre></div>


<p>What am I missing? It also seems to error out on r5 classes after recognizing I'm calling on stu3.</p>



<a name="177502584"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177502584" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177502584">(Oct 07 2019 at 09:16)</a>:</h4>
<p>I think you need the technical correction and package reconciliation to happen before that sequence will work</p>



<a name="177502591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177502591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177502591">(Oct 07 2019 at 09:16)</a>:</h4>
<p>I'll add it to my queue</p>



<a name="177505335"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177505335" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177505335">(Oct 07 2019 at 10:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span>  There's more. In Eclipse I can get more useful errors (no idea why though). I fear the validator needs more updates, or at least I don't get why the profiles would be in error:</p>
<ul>
<li>We have added an extension in our set to support PractitionerRole in places where STU3 forgot to list it. We then added the extension to our profiles under path Annotation.author[x].extension. We obviously had to slice extension, but never saw a need to slice Annotation.author[x] itself. The validator however seems to be forcing us into that, but the extension is valid across all slices so I don't see why.</li>
</ul>
<p><em>Exception in thread "main" java.lang.Error: Can't have children on an element with a polymorphic type - you must slice and constrain the types first (sortElements: Annotation.author[x]:Reference{[CanonicalType[http://hl7.org/fhir/StructureDefinition/Practitioner], CanonicalType[http://hl7.org/fhir/StructureDefinition/Patient], CanonicalType[http://hl7.org/fhir/StructureDefinition/RelatedPerson]]}, string)</em></p>
<ul>
<li>We have a Bundle profile that slices Bundle.entry.resource and assigns type List to that. It then marks Bundle.entry.resource.subject as "bundled" reference. Forge thinks that's fine. The validator does not.</li>
</ul>
<p><em>Unable to generate snapshot for <a href="http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview" target="_blank" title="http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview">http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview</a> because Profile Medication Overview response structure (<a href="http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview" target="_blank" title="http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview">http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview</a>). Error generating snapshot: Error sorting Differential: StructureDefinition <a href="http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview" target="_blank" title="http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview">http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview</a>: Differential contains path <strong>Bundle.entry.resource.subject</strong> which is not found in the base</em></p>
<ul>
<li>We generally have open slicing. Forge thinks that's fine and will happily produce snapshots. The validator does not and can only continue if I let Forge generate snapshots</li>
</ul>
<p><em>Unable to generate snapshot for <a href="http://nictiz.nl/fhir/StructureDefinition/zib-InstructionsForUse" target="_blank" title="http://nictiz.nl/fhir/StructureDefinition/zib-InstructionsForUse">http://nictiz.nl/fhir/StructureDefinition/zib-InstructionsForUse</a>: Error at path null: Type slicing with slicing.rules != closed</em></p>
<ul>
<li>We generally add XSD/SCH to instances as an immediate low key way to know we have valid instances. The validator marks that as an error, rather than a warning. That seems overdoing it imo.</li>
</ul>



<a name="177525058"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177525058" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177525058">(Oct 07 2019 at 14:37)</a>:</h4>
<p>where do I get instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml in your example?</p>



<a name="177536691"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/177536691" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#177536691">(Oct 07 2019 at 16:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> It is in the <a href="https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/1.3.0" target="_blank" title="https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/1.3.0">Simplifier package 1.3.0</a>. It is also on <a href="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Examples/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml" target="_blank" title="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Examples/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml">GitHub</a></p>
<p>I've been at it all day today and I've at least made some progress. Based on our ticket <a href="https://bits.nictiz.nl/browse/MM-433" target="_blank" title="https://bits.nictiz.nl/browse/MM-433">MM-433</a> I've committed changes to all profiles that do slicing by ValueSet. They now all have discriminator $this and all bindings are now required. Everything has been committed in the <a href="https://github.com/Nictiz/Nictiz-STU3-Zib2017/tree/develop" target="_blank" title="https://github.com/Nictiz/Nictiz-STU3-Zib2017/tree/develop">GitHub develop branch</a>.</p>
<ul>
<li>If I create the snapshots, then the validator validates most cases as expected</li>
<li>If I do not create the snapshots, the validator fails to build those</li>
<li>discriminator $this does not work when I have slice based based on fixed code + system and a slice based on ValueSet<ul>
<li>Profile <a href="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/develop/Profiles%20-%20ZIB%202017/zib-LaboratoryTestResult-Observation.xml" target="_blank" title="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/develop/Profiles%20-%20ZIB%202017/zib-LaboratoryTestResult-Observation.xml">zib-LaboratoryTestResult-Observation.xml</a> and <a href="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/develop/Examples/medmij-bgz-fhir3-0-1-labresult-ts-01.xml" target="_blank" title="https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/develop/Examples/medmij-bgz-fhir3-0-1-labresult-ts-01.xml">medmij-bgz-fhir3-0-1-labresult-ts-01.xml</a> will get you reproduction</li>
</ul>
</li>
</ul>



<a name="180685522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/180685522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#180685522">(Nov 13 2019 at 23:40)</a>:</h4>
<p>just circling back - did we get to the bottom of this?</p>



<a name="180723110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/180723110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alexander Henket <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#180723110">(Nov 14 2019 at 11:49)</a>:</h4>
<p><span class="user-mention" data-user-id="191316">@Grahame Grieve</span> I think we now know how to profile certain slicing cases within the specification. My recollection is that tooling updates are still required here and there, but details of which tooling needs which update, escapes me. The short version of my recollection for the Java validator was that snapshot generation is the biggest issue, while the slicing thing based on patterns either directly or by binding is supported. For .Net, snapshot generation is no issue, but the slicing is. Same goes for Touchstone.</p>
<p>We have not yet applied the pattern thing throughout the package yet. My thinking: </p>
<ul>
<li>We create a package that has the slicing as agreed here</li>
<li>We test that against the Java validator, and feed you with that?</li>
</ul>



<a name="180724244"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179166-implementers/topic/Nictiz%20profiles/extensions%20missing%20snapshot/near/180724244" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179166-implementers/topic/Nictiz.20profiles.2Fextensions.20missing.20snapshot.html#180724244">(Nov 14 2019 at 12:08)</a>:</h4>
<p>sure</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
