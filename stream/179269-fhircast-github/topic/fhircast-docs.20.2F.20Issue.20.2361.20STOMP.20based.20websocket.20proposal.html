---
layout: page
title: "FHIR Chat  · fhircast-docs / Issue #61 STOMP based websocket proposal · fhircast-github"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/index.html">fhircast-github</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html">fhircast-docs / Issue #61 STOMP based websocket proposal</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="159711104"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%2361%20STOMP%20based%20websocket%20proposal/near/159711104" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html#159711104">(Mar 01 2019 at 13:12)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-468660259" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-468660259">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/61" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61">Issue #61</a></p>
<blockquote>
<p>@isaacvetter, @wmaethner  - What is the plan for putting this into the spec for the May ballot? I have some concerns about the status of this proposal as well as the proposal that websockets will be used for more than just notifications sent from the hub to the client. I think it may be overkill and hinder the efforts of PACS developers - especially those with limited resources. I am moving forward with a prototype that:</p>
<p>1. Uses a "proprietary" authentication/authorization scheme in order for a client to obtain a topic (user session id). This is obviously essential for a working prototype. <br>
2. Uses websockets for Hub-&gt;client notifications only. All other communication is done using the "standard" REST methods. NOTE: Subscibe is slightly altered for websocket clients per our modification to the FHIRCast spec.<br>
3. Uses Raw data for json notifications and their responses. </p>
<p>Other than these differences, the prototype will not veer from the original FHIRCast/FHIR/Websub specifications. </p>
<p>Don't get me wrong - @bvdh has done an amazing job with this and other suggestions. I'm getting pushy because I am under pressure to get something "working" and demonstrable very soon. </p>
</blockquote>



<a name="159904682"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%2361%20STOMP%20based%20websocket%20proposal/near/159904682" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html#159904682">(Mar 04 2019 at 11:18)</a>:</h4>
<p>bvdh <a href="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/61" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61">Issue #61</a></p>
<blockquote>
<p>I agree that we should decide on how to take this further.</p>
<p>The reasoning behind suggesting STOMP were<br>
    • open standard <br>
    • defines an "over the wire protocol" that we need anyway (character coding, framing, message formats,  …)<br>
    • has been implemented and is being used by many systems<br>
    • libraries are available for all commonly used platforms (java, .net, angular, jquery,…)</p>
<p>Basically, my thought was if something exists that contains the stuff we need, we better use it instead of defining something of our own.  Also, as there are libraries available, it should be easy to implement for most parties.</p>
<p>I'm open for proposals that suggest alternatives for STOMP, but we should be careful to not step into the trap of trying to re-invent the wheel.</p>
</blockquote>



<a name="159928040"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%2361%20STOMP%20based%20websocket%20proposal/near/159928040" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html#159928040">(Mar 04 2019 at 16:35)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469320365" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469320365">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/61" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61">Issue #61</a></p>
<blockquote>
<p>I'll attempt to answer both of your points in one answer Bas. I've gave the<br>
same questions some thought as I began implementation.</p>
<p>I also asked myself "how should we identify the subscription"? Then I<br>
thought about it more and realized we don't. In my Hub, I accept the<br>
subscription if the the topic is validated, and store it (currently) in a<br>
collection of all subscribers, indexed by the topic. Remember, The topic is<br>
created during authentication and can be validated in the database of<br>
configured applications and user identities (see my proposal for<br>
authentication - I think the same should apply for an OAuth<br>
implementation).</p>
<p>So... Per the WebSub spec, all subscribers receive events - even the<br>
publisher of the  event. Therefor, when the Hub receives an event, it<br>
publishes to every subscriber in my collection.</p>
<p>As far as the STOMP protocol goes - I'll say again that the only "message"<br>
we currently have is the notification event, and that is already defined in<br>
FHIR. So, if we add messages other than context (say for example, meta data<br>
like measurements, procedure details, etc.), they would also be defined by<br>
FHIR. The FHIR spec already clearly defines the JSON and XML formats.<br>
However - because we are talking "WSS" and not "HTTPS", there is the issue<br>
of the headers. Martin Bellemeur had a nice recommendation, which I also<br>
included in my "Prototype Proposal" document. We simply wrap the FHIR JSON<br>
and header info into a simple JSON object:<br>
{<br>
"header" : { &lt;header data here&gt; }<br>
"body": { &lt;FHIR object here&gt; }<br>
}</p>
<p>My personal opinion is that it is much easier to build simple classes i<br>
nour Hub and Client, and "bind" them to JSON than it is to implement the<br>
STOMP protocol. If we provide numerous samples (Javascript, C#, Java,<br>
etc...), it should be easy for all vendors to implement.</p>
<p>BUT... That's all my opinion and I'll go along with the consensus. The main<br>
thing is to make FHIRCast a standard.</p>
<p>I'll be glad to have a telephone conference at most times. I am flexible.</p>
<p>On Mon, Mar 4, 2019 at 6:18 AM Bas van den Heuvel &lt;<a href="mailto:notifications@github.com" title="mailto:notifications@github.com">notifications@github.com</a>&gt;<br>
wrote:</p>
<blockquote>
<p>I agree that we should decide on how to take this further.</p>
<p>The reasoning behind suggesting STOMP were<br>
• open standard<br>
• defines an "over the wire protocol" that we need anyway (character<br>
coding, framing, message formats, …)<br>
• has been implemented and is being used by many systems<br>
• libraries are available for all commonly used platforms (java, .net,<br>
angular, jquery,…)</p>
<p>Basically, my thought was if something exists that contains the stuff we<br>
need, we better use it instead of defining something of our own. Also, as<br>
there are libraries available, it should be easy to implement for most<br>
parties.</p>
<p>I'm open for proposals that suggest alternatives for STOMP, but we should<br>
be careful to not step into the trap of trying to re-invent the wheel.</p>
<p>—<br>
You are receiving this because you commented.<br>
Reply to this email directly, view it on GitHub<br>
&lt;<a href="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404">https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404</a>&gt;,<br>
or mute the thread<br>
&lt;<a href="https://github.com/notifications/unsubscribe-auth/AFw87tJ1-X_wVOU51LEKWAATnXJyIBFuks5vTQDrgaJpZM4aGLV_" target="_blank" title="https://github.com/notifications/unsubscribe-auth/AFw87tJ1-X_wVOU51LEKWAATnXJyIBFuks5vTQDrgaJpZM4aGLV_">https://github.com/notifications/unsubscribe-auth/AFw87tJ1-X_wVOU51LEKWAATnXJyIBFuks5vTQDrgaJpZM4aGLV_</a>&gt;<br>
.</p>
</blockquote>
<p>-- <br>
George Kustas</p>
</blockquote>



<a name="166275800"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%2361%20STOMP%20based%20websocket%20proposal/near/166275800" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html#166275800">(May 22 2019 at 14:56)</a>:</h4>
<p>isaacvetter <a href="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-494839338" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-494839338">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/61" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61">Issue #61</a>:</p>
<blockquote>
<p>## :telephone_receiver: II Working Group Vote (5-22-2019)</p>
<p>Meeting notes: <a href="https://confluence.hl7.org/display/IMIN/Teleconferences" target="_blank" title="https://confluence.hl7.org/display/IMIN/Teleconferences">https://confluence.hl7.org/display/IMIN/Teleconferences</a></p>
<p>@isaacvetter  moved the following disposition, seconded by @gkustas </p>
<p><strong>Disposition:</strong> We will move forward with extending Websub to incorporate websocket support in lieu of the more complete and complex alternative messaging framework specified in <a href="https://stomp.github.io/stomp-specification-1.2.html" target="_blank" title="https://stomp.github.io/stomp-specification-1.2.html">STOMP</a>. We will publish PR #57 on <a href="http://fhircast.org" target="_blank" title="http://fhircast.org">fhircast.org</a>. We will modify the approach described in #57 to allow the subscriber to connect over <code>wss:</code> to a hub-provided url in the subscription response, instead of connecting directly to the <code>hub.topic</code> as a url. We will investigate replicating the verification of intent step from Websub when websockets is used. </p>
<p><strong>Disposition Comment:</strong> Further, we will look to <a href="http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_8.10.4.html" target="_blank" title="http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_8.10.4.html">DICOMWeb's use of websockets</a>.  </p>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> For: 13<br>
<span aria-label="expressionless" class="emoji emoji-1f611" role="img" title="expressionless">:expressionless:</span> Abstain: 2<br>
<span aria-label="-1" class="emoji emoji-1f44e" role="img" title="-1">:-1:</span> Against: 0</p>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> The motion passed! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>
</blockquote>



<a name="166275831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%2361%20STOMP%20based%20websocket%20proposal/near/166275831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html#166275831">(May 22 2019 at 14:56)</a>:</h4>
<p>isaacvetter <a href="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-494839517" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61#issuecomment-494839517">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/61" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61">Issue #61</a>:</p>
<blockquote>
<p>@bvdh - mind if I close this issue?</p>
</blockquote>



<a name="166338092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%2361%20STOMP%20based%20websocket%20proposal/near/166338092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html#166338092">(May 23 2019 at 07:10)</a>:</h4>
<p>bvdh closed <a href="https://github.com/HL7/fhircast-docs/issues/61" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/61">Issue #61</a>:</p>
<blockquote>
<p>Based on the discussions in the 20th connecthaton WGM, I wrote down a proposed fhir-cast websocket spec. This has been tested in the <a href="https://github.com/PhilipsOnFhir/fhir-cast" target="_blank" title="https://github.com/PhilipsOnFhir/fhir-cast">https://github.com/PhilipsOnFhir/fhir-cast</a> repository.</p>
<p># FHIR-CAST WEBSOCKET update<br>
This implementation implemnents some proposed changes of the FHIR cast <br>
Split the specification into(<a href="http://fhircast.org/" target="_blank" title="http://fhircast.org/">http://fhircast.org/</a>) specification.</p>
<p>## Specification format<br>
We propose to split the specifiaction into three layers:<br>
 1. channel protocol<br>
 2. subscribe/unsubscribe and event type<br>
 3. Event definitions<br>
## Channel protocols<br>
Channel protocols are the the different protocols that fhir-cast can use to connect to clients.   <br>
This implementation of fhir-cast implements three different<br>
 1. WebSub (exisiting spec)<br>
 2. Websockets (see below)<br>
 3. pull based context (exisiting spec)<br>
In order to separate the channels on different end-points:</p>
<ul>
<li>WebSub: \&lt;baseurl&gt;/\&lt;topic&gt;/websub  </li>
<li>WebSocket: \&lt;baseurl&gt;/websocket</li>
<li>Context: \&lt;baseurl&gt;/\&lt;topic&gt;/context</li>
</ul>
<p>GET on \&lt;baseurl&gt;/\&lt;topic&gt; will give you a list of the supported protocols.</p>
<p># Websocket<br>
The websocket part uses STOMP 1.2.   <br>
Some functionality is not required for FHIR CAST. Clients and server SHALL implement the required functionality and SHOULD implement the other.</p>
<p>## STOMP subset<br>
We will be using STOMP 1.2 over WebSocket. Not all functionality from STOM is required.<br>
The table below indicates the functionality that MAY be unsupported. It is RECOMMENDED that <br>
the client and server implement the other functionality required by STOMP although it will <br>
not be used by this specification.</p>
<p>The following table shows the support requirements for the different STOMP messages.<br>
| Message | Source | Status | Description |  <br>
| --- | --- | --- | --- |   <br>
| CONNECT | Client  REQUIRED    Connect to websocket<br>
| SEND | Client REQUIRED    <br>
| SUBSCRIBE | Client | REQUIRED | Subscribe to channel<br>
| UNSUBSCRIBE | Client  | REQUIRED | Unsubscribe from channel<br>
| BEGIN | Client | OPTIONAL | Start transaction<br>
| COMMIT | Client | OPTIONAL | Commit transaction<br>
| ABORT | Client | OPTIONAL | Abort transaction<br>
| ACK | Client | REQUIRED | Acknowledge<br>
| NACK | Client | REQUIRED | Not Acknowledge<br>
| DISCONNECT | Client | REQUIRED | Disconnect websocket<br>
| MESSAGE | Server | REQUIRED | Send message to client<br>
| RECEIPT | Server | REQUIRED | Indicate receipt content<br>
| ERROR Server | REQUIRED | Indicate error occurred</p>
<p>## Destinations<br>
Clients send messages to destinations, a destination is a directory like name on the server.  <br>
All FhirCast destinations are targetting the hube will be prefixed with /hub/.  <br>
All FhirCast destinations are targetting the spplications will be prefixed with /app/.  </p>
<p>### Client--&gt;Server <br>
Client--&gt;Server  communication SHALL use the following pattern:<br>
    /hub/fhircast/\&lt;topic&gt;/<br>
where<br>
    \&lt;clientid&gt;: is a unique id of the client, e.g. the client-id used in OAUth</p>
<p>### Server -&gt;Client<br>
Server -&gt;Client SHALL use the following destinations:<br>
    /app/fhircast/&lt;topic&gt;/&lt;event&gt;<br>
where<br>
    \&lt;clientid&gt;:    is a unique id of the client, e.g. the client-id used in Oauth<br>
    \&lt;event&gt;    is the event name/id the client sends a message to</p>
<p>Implementations can distinguish on OAuth role, adding client-id makes it easier to filter who receives what.</p>
<p>## Use cases<br>
### Client Subscribe/ Unsubscribe<br>
All clients can register for events on the websocket endpoint.</p>
<p><strong>SUBSCRIBE /hub/fhircast/\&lt;topic&gt;/\&lt;event&gt;</strong>  <br>
    subscribe app for event \&lt;event&gt; on topic \&lt;topic&gt;</p>
<p><strong>UNSUBSCRIBE /hub/fhircast/\&lt;topic&gt;/\&lt;event&gt;</strong>   <br>
    Unsubscribe for the event on the topic.</p>
<p><strong>Deny subscription</strong>   <br>
    TBD</p>
<p>### Sending events<br>
#### Server sends event   <br>
<strong>MESSAGE /app/fhircast/topic&gt;/&lt;event&gt; Event</strong>  <br>
The Event is formatted as a WebSub event. E.g. <br>
THe event is formated as is displayed below:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
<span class="err">event</span><span class="nt">&quot;: {</span>
<span class="nt">    &quot;</span><span class="err">hub.topic</span><span class="s2">&quot;: &quot;</span><span class="err">https</span><span class="p">:</span><span class="err">//hub.example.com/</span><span class="mi">7</span><span class="err">jaa</span><span class="mi">86</span><span class="err">kgdudewiaq</span><span class="mi">0</span><span class="err">wtu</span><span class="s2">&quot;,</span>
<span class="s2">    &quot;</span><span class="err">hub.event</span><span class="s2">&quot;: &quot;</span><span class="err">close-patient-chart</span><span class="s2">&quot;,</span>
<span class="s2">    &quot;</span><span class="err">context</span><span class="s2">&quot;: [</span>
<span class="s2">      {</span>
<span class="s2">        &quot;</span><span class="err">key</span><span class="s2">&quot;: &quot;</span><span class="err">patient</span><span class="s2">&quot;,</span>
<span class="s2">        &quot;</span><span class="err">resource</span><span class="s2">&quot;: {</span>
<span class="s2">          &quot;</span><span class="err">resourceType</span><span class="s2">&quot;: &quot;</span><span class="err">Patient</span><span class="s2">&quot;,</span>
<span class="s2">          &quot;</span><span class="err">id</span><span class="s2">&quot;: &quot;</span><span class="mf">798E4</span><span class="err">MyMcpCWHab</span><span class="mi">9</span><span class="s2">&quot;,</span>
<span class="s2">          &quot;</span><span class="err">identifier</span><span class="s2">&quot;: [</span>
<span class="s2">            {</span>
<span class="s2">              &quot;</span><span class="err">system</span><span class="s2">&quot;: &quot;</span><span class="err">urn</span><span class="p">:</span><span class="err">oid</span><span class="p">:</span><span class="mf">1.2</span><span class="err">.</span><span class="mf">840.114350</span><span class="s2">&quot;,</span>
<span class="s2">              &quot;</span><span class="err">value</span><span class="s2">&quot;: &quot;</span><span class="mi">1345687</span><span class="s2">&quot;</span>
<span class="s2">            },</span>
<span class="s2">            {</span>
<span class="s2">              &quot;</span><span class="err">system</span><span class="s2">&quot;: &quot;</span><span class="err">urn</span><span class="p">:</span><span class="err">oid</span><span class="p">:</span><span class="mf">1.2</span><span class="err">.</span><span class="mf">840.114350</span><span class="err">.</span><span class="mf">1.13</span><span class="err">.</span><span class="mf">861.1</span><span class="err">.</span><span class="mf">7.5</span><span class="err">.</span><span class="mf">737384.27000</span><span class="s2">&quot;,</span>
<span class="s2">              &quot;</span><span class="err">value</span><span class="s2">&quot;: &quot;</span><span class="mi">7539</span><span class="err">&quot;</span>
            <span class="p">}</span>
          <span class="err">]</span>
        <span class="err">}</span>
      <span class="err">}</span>
    <span class="err">]</span>
<span class="err">}</span>
</pre></div>


<p>#### Clients updates context<br>
<strong>MESSAGE /app/fhircast/\&lt;topic&gt;/\&lt;event&gt;</strong>  <br>
Send the event to the event endpoint. The implementation SHALL refuse messages send to the wrong endpoint.</p>
</blockquote>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
