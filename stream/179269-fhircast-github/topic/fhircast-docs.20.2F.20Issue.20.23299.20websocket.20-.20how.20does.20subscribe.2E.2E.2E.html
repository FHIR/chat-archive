---
layout: page
title: "FHIR Chat  · fhircast-docs / Issue #299 websocket - how does subscribe... · fhircast-github"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/index.html">fhircast-github</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23299.20websocket.20-.20how.20does.20subscribe.2E.2E.2E.html">fhircast-docs / Issue #299 websocket - how does subscribe...</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="180799473"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23299%20websocket%20-%20how%20does%20subscribe.../near/180799473" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23299.20websocket.20-.20how.20does.20subscribe.2E.2E.2E.html#180799473">(Nov 15 2019 at 03:36)</a>:</h4>
<p>isaacvetter opened <a href="https://github.com/HL7/fhircast-docs/issues/299" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/299">Issue #299</a>:</p>
<blockquote>
<p>When a subscriber initially requests a subscription, it performs an HTTP POST, like so:</p>
<div class="codehilite"><pre><span></span>POST https://hub.example.com
Content-Type: application/x-www-form-urlencoded

hub.mode=subscribe&amp;hub.events=patient-open,patient-close&amp;hub.lease_seconds=3600&amp;hub.topic=fdb2f928-5546-4f52-87a0-0648e9ded065&amp;hub.secret=shhh-this-is-a-secret&amp;hub.callback=https://myapp.com
</pre></div>


<p>The <code>hub.events</code> and <code>hub.lease_seconds</code> parameters are evaluated by the Hub, and the Hub responds, in the "Intent Verification" exchange with the actual <code>hub.events</code> and <code>hub.lease_seconds</code> for the newly created subscription. </p>
<p>There's a few reasons for the Hub's ability to override a subscriber's requests content or length of a requested subscription:</p>
<ol>
<li>_authorization_: a subscriber mustn't be able to subscribe to events for which it's not authorized. It's the Hub's responsibility to ensure that a subscription is limited to, not only, the subscriber's authorized events, but also the length of the subscription mustn't overrun the lifetime of the authorization. </li>
<li>_mere capability_: the <code>hub.events</code> list of events supplied by the subscriber asks the Hub: hey Hub! do you support these events? In some cases, the answer may be no. Ultimately, for <code>webhooks</code>, the Hub commits to sending specific event notifications in the "Intent Verification" exchange</li>
</ol>
<p>This all makes sense in <code>hub.channel.type</code>=<code>webhook</code>, but, <code>hub.channel.type=</code>websockets` currently doesn't include the "Intent Verification" exchange. How does the Hub communicate approved authorization or it's support for the requested events in a websocket subscription?</p>
</blockquote>



<a name="180799786"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23299%20websocket%20-%20how%20does%20subscribe.../near/180799786" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23299.20websocket.20-.20how.20does.20subscribe.2E.2E.2E.html#180799786">(Nov 15 2019 at 03:46)</a>:</h4>
<p>isaacvetter edited <a href="https://github.com/HL7/fhircast-docs/issues/299" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/299">Issue #299</a>:</p>
<blockquote>
<p>When a subscriber initially requests a subscription, it performs an HTTP POST, like so:</p>
<div class="codehilite"><pre><span></span>POST https://hub.example.com
Content-Type: application/x-www-form-urlencoded

hub.mode=subscribe&amp;hub.events=patient-open,patient-close&amp;hub.lease_seconds=3600&amp;hub.topic=fdb2f928-5546-4f52-87a0-0648e9ded065&amp;hub.secret=shhh-this-is-a-secret&amp;hub.callback=https://myapp.com
</pre></div>


<p>The <code>hub.events</code> and <code>hub.lease_seconds</code> parameters are evaluated by the Hub, and the Hub responds, in the "Intent Verification" exchange with the actual <code>hub.events</code> and <code>hub.lease_seconds</code> for the newly created subscription. </p>
<p>There's a few reasons for the Hub's ability to override a subscriber's requests content or length of a requested subscription:</p>
<ol>
<li>_authorization_: a subscriber mustn't be able to subscribe to events for which it's not authorized. It's the Hub's responsibility to ensure that a subscription is limited to, not only, the subscriber's authorized events, but also the length of the subscription mustn't overrun the lifetime of the authorization. </li>
<li>_mere capability_: the <code>hub.events</code> list of events supplied by the subscriber asks the Hub: hey Hub! do you support these events? In some cases, the answer may be no. Ultimately, for <code>webhooks</code>, the Hub commits to sending specific event notifications in the "Intent Verification" exchange</li>
</ol>
<p>This all makes sense in <code>hub.channel.type</code>=<code>webhook</code>, but, <code>hub.channel.type=</code>websockets` currently doesn't include the "Intent Verification" exchange. How does the Hub communicate approved authorization or its support for the requested events in a websocket subscription?</p>
</blockquote>



<a name="180799927"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23299%20websocket%20-%20how%20does%20subscribe.../near/180799927" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23299.20websocket.20-.20how.20does.20subscribe.2E.2E.2E.html#180799927">(Nov 15 2019 at 03:51)</a>:</h4>
<p>isaacvetter edited <a href="https://github.com/HL7/fhircast-docs/issues/299" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/299">Issue #299</a>:</p>
<blockquote>
<p>When a subscriber initially requests a subscription, it performs an HTTP POST, like so:</p>
<div class="codehilite"><pre><span></span>POST https://hub.example.com
Content-Type: application/x-www-form-urlencoded

hub.mode=subscribe&amp;hub.events=patient-open,patient-close&amp;hub.lease_seconds=3600&amp;hub.topic=fdb2f928-5546-4f52-87a0-0648e9ded065&amp;hub.secret=shhh-this-is-a-secret&amp;hub.callback=https://myapp.com
</pre></div>


<p>The <code>hub.events</code> and <code>hub.lease_seconds</code> parameters are evaluated by the Hub, and the Hub responds, in the "Intent Verification" exchange with the actual <code>hub.events</code> and <code>hub.lease_seconds</code> for the newly created subscription. </p>
<p>There's a few reasons for the Hub's ability to override a subscriber's requests content or length of a requested subscription:</p>
<ol>
<li>_authorization_: a subscriber mustn't be able to subscribe to events for which it's not authorized. It's the Hub's responsibility to ensure that a subscription is limited to, not only, the subscriber's authorized events, but also the length of the subscription mustn't overrun the lifetime of the authorization. </li>
<li>_mere capability_: the <code>hub.events</code> list of events supplied by the subscriber asks the Hub: hey Hub! do you support these events? In some cases, the answer may be no. Ultimately, for <code>webhooks</code>, the Hub commits to sending specific event notifications in the "Intent Verification" exchange</li>
</ol>
<p>This all makes sense in <code>hub.channel.type</code>=<code>webhook</code>, but, <code>hub.channel.type</code>=<code>websockets</code> currently doesn't include the "Intent Verification" exchange. How does the Hub communicate approved authorization or its support for the requested events in a websocket subscription?</p>
</blockquote>



<a name="180800861"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23299%20websocket%20-%20how%20does%20subscribe.../near/180800861" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23299.20websocket.20-.20how.20does.20subscribe.2E.2E.2E.html#180800861">(Nov 15 2019 at 04:14)</a>:</h4>
<p>isaacvetter <a href="https://github.com/HL7/fhircast-docs/issues/299#issuecomment-554204275" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/299#issuecomment-554204275">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/299" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/299">Issue #299</a>:</p>
<blockquote>
<p>Although the "Intent Verification" step using <code>webook</code> is primarily intended to confirm ownership of the callback url, it also serves as confirmation of the subscription. This confirmation is similarly needed for <code>websocket</code>. </p>
<p>We could minimally provide this subscription confirmation by mirroring the "Intent Verification" request over <code>websocket</code>, like so:</p>
<h4><code>websocket</code> Subscription Confirmation</h4>
<p>To confirm a subscription request, upon the subscriber establishing a websocket connection to the <code>hub.channel.endpoint</code> wss url, the Hub SHALL send a confirmation. This confirmation includes the following elements:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hub.mode</code></td>
<td>Required</td>
<td><em>string</em></td>
<td>The literal string "subscribe".</td>
</tr>
<tr>
<td><code>hub.topic</code></td>
<td>Required</td>
<td><em>string</em></td>
<td>The session topic given in the corresponding subscription request.</td>
</tr>
<tr>
<td><code>hub.events</code></td>
<td>Required</td>
<td><em>string</em></td>
<td>A comma-separated list of events from the Event Catalog corresponding to the events string given in the corresponding subscription request.</td>
</tr>
<tr>
<td><code>hub.lease_seconds</code></td>
<td>Required</td>
<td><em>number</em></td>
<td>The Hub-determined number of seconds that the subscription will stay active before expiring, measured from the time the verification request was made from the Hub to the subscriber. If provided to the client, the Hub SHALL unsubscribe the client once <code>lease_seconds</code> has expired and MAY send a subscription denial. If the subscriber wishes to continue the subscription it MAY resubscribe.</td>
</tr>
</tbody>
</table>
<h5><code>websocket</code> Intent Verification Request Example</h5>
<div class="codehilite"><pre><span></span>{
  &quot;hub.mode&quot;: &quot;subscribe&quot;,
  &quot;hub.topic&quot;: &quot;fdb2f928-5546-4f52-87a0-0648e9ded065&quot;,
  &quot;hub.events&quot;: &quot;patient-open,patient-close&quot;,
  &quot;hub.lease-seconds&quot;: 7200
}
~~~
</pre></div>


</blockquote>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
