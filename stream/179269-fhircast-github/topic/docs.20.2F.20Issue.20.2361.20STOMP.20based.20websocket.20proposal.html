---
layout: page
title: "FHIR Chat  · docs / Issue #61 STOMP based websocket proposal · fhircast-github"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/index.html">fhircast-github</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html">docs / Issue #61 STOMP based websocket proposal</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="155348677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/docs%20/%20Issue%20%2361%20STOMP%20based%20websocket%20proposal/near/155348677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/docs.20.2F.20Issue.20.2361.20STOMP.20based.20websocket.20proposal.html#155348677">(Jan 17 2019 at 16:27)</a>:</h4>
<p>bvdh opened <a href="https://github.com/fhircast/docs/issues/61" target="_blank" title="https://github.com/fhircast/docs/issues/61">Issue #61</a></p>
<blockquote>
<p>Based on the discussions in the 20th connecthaton WGM, I wrote down a proposed fhir-cast websocket spec. This has been tested in the <a href="https://github.com/PhilipsOnFhir/fhir-cast" target="_blank" title="https://github.com/PhilipsOnFhir/fhir-cast">https://github.com/PhilipsOnFhir/fhir-cast</a> repository.</p>
<p># FHIR-CAST WEBSOCKET update<br>
This implementation implemnents some proposed changes of the FHIR cast <br>
Split the specification into(<a href="http://fhircast.org/" target="_blank" title="http://fhircast.org/">http://fhircast.org/</a>) specification.</p>
<p>## Specification format<br>
We propose to split the specifiaction into three layers:<br>
 1. channel protocol<br>
 2. subscribe/unsubscribe and event type<br>
 3. Event definitions</p>
<p>## Channel protocols<br>
Channel protocols are the the different protocols that fhir-cast can use to connect to clients.   <br>
This implementation of fhir-cast implements three different<br>
 1. WebSub (exisiting spec)<br>
 2. Websockets (see below)<br>
 3. pull based context (exisiting spec)</p>
<p>In order to separate the channels on different end-points:<br>
 * WebSub: \&lt;baseurl&gt;/\&lt;topic&gt;/websub  <br>
 * WebSocket: \&lt;baseurl&gt;/websocket<br>
 * Context: \&lt;baseurl&gt;/\&lt;topic&gt;/context</p>
<p>GET on \&lt;baseurl&gt;/\&lt;topic&gt; will give you a list of the supported protocols.</p>
<p># Websocket<br>
The websocket part uses STOMP 1.2.   <br>
Some functionality is not required for FHIR CAST. Clients and server SHALL implement the required functionality and SHOULD implement the other.</p>
<p>## STOMP subset<br>
We will be using STOMP 1.2 over WebSocket. Not all functionality from STOM is required.<br>
The table below indicates the functionality that MAY be unsupported. It is RECOMMENDED that <br>
the client and server implement the other functionality required by STOMP although it will <br>
not be used by this specification.</p>
<p>The following table shows the support requirements for the different STOMP messages.<br>
| Message | Source | Status | Description |  <br>
| --- | --- | --- | --- |   <br>
| CONNECT | Client  REQUIRED    Connect to websocket<br>
| SEND | Client REQUIRED    <br>
| SUBSCRIBE | Client | REQUIRED | Subscribe to channel<br>
| UNSUBSCRIBE | Client  | REQUIRED | Unsubscribe from channel<br>
| BEGIN | Client | OPTIONAL | Start transaction<br>
| COMMIT | Client | OPTIONAL | Commit transaction<br>
| ABORT | Client | OPTIONAL | Abort transaction<br>
| ACK | Client | REQUIRED | Acknowledge<br>
| NACK | Client | REQUIRED | Not Acknowledge<br>
| DISCONNECT | Client | REQUIRED | Disconnect websocket<br>
| MESSAGE | Server | REQUIRED | Send message to client<br>
| RECEIPT | Server | REQUIRED | Indicate receipt content<br>
| ERROR Server | REQUIRED | Indicate error occurred</p>
<p>## Destinations<br>
Clients send messages to destinations, a destination is a directory like name on the server.  <br>
All FhirCast destinations are targetting the hube will be prefixed with /hub/.  <br>
All FhirCast destinations are targetting the spplications will be prefixed with /app/.  </p>
<p>### Client--&gt;Server <br>
Client--&gt;Server  communication SHALL use the following pattern:<br>
    /hub/fhircast/\&lt;topic&gt;/<br>
where<br>
    \&lt;clientid&gt;: is a unique id of the client, e.g. the client-id used in OAUth</p>
<p>### Server -&gt;Client<br>
Server -&gt;Client SHALL use the following destinations:<br>
    /app/fhircast/&lt;topic&gt;/&lt;event&gt;<br>
where<br>
    \&lt;clientid&gt;:    is a unique id of the client, e.g. the client-id used in Oauth<br>
    \&lt;event&gt;    is the event name/id the client sends a message to</p>
<p>Implementations can distinguish on OAuth role, adding client-id makes it easier to filter who receives what.</p>
<p>## Use cases<br>
### Client Subscribe/ Unsubscribe<br>
All clients can register for events on the websocket endpoint.</p>
<p><strong>SUBSCRIBE /hub/fhircast/\&lt;topic&gt;/\&lt;event&gt;</strong>  <br>
    subscribe app for event \&lt;event&gt; on topic \&lt;topic&gt;</p>
<p><strong>UNSUBSCRIBE /hub/fhircast/\&lt;topic&gt;/\&lt;event&gt;</strong>   <br>
    Unsubscribe for the event on the topic.</p>
<p><strong>Deny subscription</strong>   <br>
    TBD</p>
<p>### Sending events<br>
#### Server sends event   <br>
<strong>MESSAGE /app/fhircast/topic&gt;/&lt;event&gt; Event</strong>  <br>
The Event is formatted as a WebSub event. E.g. <br>
THe event is formated as is displayed below:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
<span class="err">event</span><span class="nt">&quot;: {</span>
<span class="nt">    &quot;</span><span class="err">hub.topic</span><span class="s2">&quot;: &quot;</span><span class="err">https</span><span class="p">:</span><span class="err">//hub.example.com/</span><span class="mi">7</span><span class="err">jaa</span><span class="mi">86</span><span class="err">kgdudewiaq</span><span class="mi">0</span><span class="err">wtu</span><span class="s2">&quot;,</span>
<span class="s2">    &quot;</span><span class="err">hub.event</span><span class="s2">&quot;: &quot;</span><span class="err">close-patient-chart</span><span class="s2">&quot;,</span>
<span class="s2">    &quot;</span><span class="err">context</span><span class="s2">&quot;: [</span>
<span class="s2">      {</span>
<span class="s2">        &quot;</span><span class="err">key</span><span class="s2">&quot;: &quot;</span><span class="err">patient</span><span class="s2">&quot;,</span>
<span class="s2">        &quot;</span><span class="err">resource</span><span class="s2">&quot;: {</span>
<span class="s2">          &quot;</span><span class="err">resourceType</span><span class="s2">&quot;: &quot;</span><span class="err">Patient</span><span class="s2">&quot;,</span>
<span class="s2">          &quot;</span><span class="err">id</span><span class="s2">&quot;: &quot;</span><span class="mf">798E4</span><span class="err">MyMcpCWHab</span><span class="mi">9</span><span class="s2">&quot;,</span>
<span class="s2">          &quot;</span><span class="err">identifier</span><span class="s2">&quot;: [</span>
<span class="s2">            {</span>
<span class="s2">              &quot;</span><span class="err">system</span><span class="s2">&quot;: &quot;</span><span class="err">urn</span><span class="p">:</span><span class="err">oid</span><span class="p">:</span><span class="mf">1.2</span><span class="err">.</span><span class="mf">840.114350</span><span class="s2">&quot;,</span>
<span class="s2">              &quot;</span><span class="err">value</span><span class="s2">&quot;: &quot;</span><span class="mi">1345687</span><span class="s2">&quot;</span>
<span class="s2">            },</span>
<span class="s2">            {</span>
<span class="s2">              &quot;</span><span class="err">system</span><span class="s2">&quot;: &quot;</span><span class="err">urn</span><span class="p">:</span><span class="err">oid</span><span class="p">:</span><span class="mf">1.2</span><span class="err">.</span><span class="mf">840.114350</span><span class="err">.</span><span class="mf">1.13</span><span class="err">.</span><span class="mf">861.1</span><span class="err">.</span><span class="mf">7.5</span><span class="err">.</span><span class="mf">737384.27000</span><span class="s2">&quot;,</span>
<span class="s2">              &quot;</span><span class="err">value</span><span class="s2">&quot;: &quot;</span><span class="mi">7539</span><span class="err">&quot;</span>
            <span class="p">}</span>
          <span class="err">]</span>
        <span class="err">}</span>
      <span class="err">}</span>
    <span class="err">]</span>
<span class="err">}</span>
</pre></div>


<p>#### Clients updates context<br>
<strong>MESSAGE /app/fhircast/\&lt;topic&gt;/\&lt;event&gt;</strong>  <br>
Send the event to the event endpoint. The implementation SHALL refuse messages send to the wrong endpoint.</p>
</blockquote>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
