---
layout: page
title: "FHIR Chat  · fhircast-docs / issue #311 syncerror · fhircast-github"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/index.html">fhircast-github</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html">fhircast-docs / issue #311 syncerror</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="197607641"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20issue%20%23311%20syncerror/near/197607641" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html#197607641">(May 14 2020 at 19:43)</a>:</h4>
<p>isaacvetter opened <a href="https://github.com/HL7/fhircast-docs/issues/311">Issue #311</a>:</p>
<blockquote>
<p>Especially for headless medical devices engaged in a FHIRcast session, it may be important for a subscriber to know the originating app of a syncerror event. </p>
<p>Could the syncerror event include some identifier of the app that caused the error (maybe client id?) such that a sufficiently sophisticated subscriber could attempt to evaluate the impact of a syncerror?</p>
</blockquote>



<a name="198913059"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20issue%20%23311%20syncerror/near/198913059" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html#198913059">(May 27 2020 at 16:00)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/311#issuecomment-634763250">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/311">Issue #311</a>:</p>
<blockquote>
<p>@isaacvetter, @wmaethner  - <br>
I'm getting to the "syncerror" part of this, but just a little background first...<br>
As an alternative to creating a "smart Hub" that provides the current topic session context on demand, we created two new events: DiagnosticReport-get and DiagnosticReport-set. The get is sent by a client wishing to know the current context (because perhaps it joined the party late or crashed). All other subscribers receive it and optionally respond to it with a DiagnosticReport-set. When subscribers receive the set message, they may find that the context is different from what they believe it to be. Hence, the syncerror is set.</p>
<p>I was going to implement this and realized that the syncerror is missing a few things to make it useful. Like you said, we should probably have client ids, and possibly names (that would be in the OAuth2 records for the client). But also, the syncerror doesn't have any place for structured error info. It's just a string. It would be useful to know who sent the syncerror, and WHY it sent it. Missing an ImagingStudy? Wrong accession number?</p>
<p>I'd love to get together with you guys and talk about the big picture some time. I'm hoping we can continue to keep the Hub "agnostic", but we're getting a lot of flak from Siemens, who claims that others in the WG-20 are not happy either.</p>
</blockquote>



<a name="199025489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20issue%20%23311%20syncerror/near/199025489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html#199025489">(May 28 2020 at 13:58)</a>:</h4>
<p>gkustas edited a <a href="https://github.com/HL7/fhircast-docs/issues/311#issuecomment-634763250">comment</a> on <a href="https://github.com/HL7/fhircast-docs/issues/311">Issue #311</a>:</p>
<blockquote>
<p>@isaacvetter, @wmaethner  - <br>
I'm getting to the "syncerror" part of this, but just a little background first...<br>
As an alternative to creating a "smart Hub" that provides the current topic session context on demand, we created two new events: DiagnosticReport-get and DiagnosticReport-set. The get is sent by a client wishing to know the current context (because perhaps it joined the party late or crashed). All other subscribers receive it and optionally respond to it with a DiagnosticReport-set. When subscribers receive the set message, they may find that the context is different from what they believe it to be. Hence, the syncerror is set.</p>
<p>I was going to implement this and realized that the syncerror is missing a few things to make it useful. Like you said, we should probably have client ids, and possibly names (that would be in the OAuth2 records for the client). But also, the syncerror doesn't have any place for structured error info. It's just a string. It would be useful to know who sent the syncerror, and WHY it sent it. Missing an ImagingStudy? Wrong accession number?</p>
</blockquote>



<a name="217868659"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20issue%20%23311%20syncerror/near/217868659" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html#217868659">(Nov 25 2020 at 10:45)</a>:</h4>
<p>bvdh <a href="https://github.com/HL7/fhircast-docs/issues/311#issuecomment-733627572">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/311">Issue #311</a>:</p>
<blockquote>
<p>It would also be usefull for the end-user - it can tell what application/system to check in order to resolve the sync-error. Good idea.</p>
</blockquote>



<a name="217910754"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20issue%20%23311%20syncerror/near/217910754" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html#217910754">(Nov 25 2020 at 16:54)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/311#issuecomment-733827591">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/311">Issue #311</a>:</p>
<blockquote>
<p>We've encountered situations that I guess would call for a syncerror. Example:</p>
<ol>
<li>PACS client requests a DiagnosticReport-open with an ImagingStudy that has accession 12345</li>
<li>PowerScribe receives the event and attempts to create the report, but finds that there are more than one accessions with that number. This can occur in a multi-site (multiple RIS) environment since accession numbers are not globally unique.</li>
</ol>
<p>In this situation, PowerScribe displays a dialog to the user and the request is ignored,</p>
<p>If we send a syncerror event, what would it achieve, other than letting the other clients now that one of the other clients isn't in sync. What then? </p>
<p>The reality is that there is only one person driving all the applications, and they can see what happened. In this case, I think the user might just open the correct accession from the PowerScribe worklist which would generate ANOTHER DiagnosticReport-open would would override the previous. Everyone would be in sync again.</p>
<p>I'm still struggling to see the usefulness of the syncerror event.</p>
</blockquote>



<a name="239468075"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20issue%20%23311%20syncerror/near/239468075" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html#239468075">(May 19 2021 at 17:51)</a>:</h4>
<p>bvdh <a href="https://github.com/HL7/fhircast-docs/issues/311#issuecomment-844332635">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/311">issue #311</a>:</p>
<blockquote>
<p>I've summarized the discussion during the connecthaton in the following text.</p>
<h1>Sync-error topics from Connecthaton</h1>
<p>This lists several topics that came up using the sync-error discussion during the connecthaton.</p>
<h2>event.context.issue.severity in syncerror events</h2>
<p>The specification does not clearly define the value to use for the severity field in a syncerror.</p>
<p>When the event is sent by the hub (the event cannot be delivered), the severity SHALL be set to <code>fatal</code>.</p>
<p>When the event is send by an application, the severity SHALL be set to <code>warning</code>.</p>
<p>The syncerror event definition is to be updated with this content.</p>
<h2>Identify application causing sync error</h2>
<p>When a syncerror event is sent. The application should receive human readible information on why the event has happened.</p>
<p>This information is to be included in the syncerror <code>event.context.issue.diagnostic</code> field. When the event is sent by an application, it can fill this with appropriate information.</p>
<p>When the event is sent by the hub, the source of the information is not clear.  An application SHOULD include a <em>short</em> human readible application name in the subscribe call.</p>
<p>The hub should use this information or information from the authorization server to provide provide a event.context.issue.diagnostic field that describes what happened and what application caused it.</p>
<p>The resulting specification updates are:</p>
<ol>
<li>Update the syncerror event to state that the <code>event.context.issue.diagnostic</code> is mandatory and SHALL contain human-readable information on why the event has happened. The information SHALL indicate the device that causes the syncerror.</li>
<li>The subscribe method will be extended with an optional field holding a short human-readable name for the applications that registered.</li>
<li>The hub SHOULD use the indicated application name or the name retrieved from the authorization server to describe the device in the diagnostic message.</li>
</ol>
<h2>Clarify how to recover from an syncerror</h2>
<p>The current specification does not clearly specify how applications and the hub can recover from an error condition.</p>
<p>The following approach was decided by the connecthaton discussion.</p>
<ol>
<li>Applications that send an context-change event that resulted in a syncerror should resent them after about 10 sec. The event will be resent using the id and timestamp of the original event (this prevents race conditions with context-change events send by other applications).     </li>
<li>Applications shall be able to receive resends of the same event, even at a later point in time, and handle it appropriately (check time stamp later than last, check if it changes the context or restates it).</li>
</ol>
<p>When the resent does not result in a syncerror, applications know the system is in sync again.</p>
<p>An application is considered to be part of the topic until it unsubscribes or when the subscription expires. Until that time, any event that occurs that can not be delivered or is not followed will result in a syncerror.</p>
<p>This results in the following proposed specification changes:</p>
<ol>
<li>Update the send event section with: Applications that send and context event that results in a sync-error SHOULD resent it (same time stamp) after some time (10 sec) to restablish context sync.</li>
<li>Update the receive event section with: Applications SHALL be able to receive resends of the same event, even at a later point in time, and handle it appropriately (check time stamp later than last, check if it changes the context or restates it).</li>
<li>Update the subscription section with: An application is considered to be part of the topic until it unsubscribes or when the subscription expires. Until that time, any event that occurs that can not be delivered or is not followed SHALL result in a syncerror.</li>
</ol>
<h2>Indicate how what happens when a connection drops</h2>
<p>The specification is unclear on what is the expected behavior of clients and hubs when the connection is dropped.</p>
<p>Related questions are:</p>
<ul>
<li>Does a connection drop result in a unsubscribe?  </li>
<li>In what way does client detect that a connection is dropped?</li>
</ul>
<p>The following approach was agreed upon during the connecthaton.</p>
<p>A client will detect a connection is dropped for websocket connections when the connection is dropped. Webhook connections require  some sort of heartbeat to detect a network drop.<br>
FHIRcast will define an optional heartbeat event which will be send every 10 sec/an order of magitutde lower then the subscription timeout. The interval will indicated in the event.</p>
<p>The event is RECOMMENDED for clients and hubs.</p>
<p>Implementator feedback is requested for the need to support heartbeats for websockets.</p>
<h3>Heartbeat event</h3>
<p>The heartbeat event is sent regularly to indicate a channel is open.</p>
<p>The name of the event is: heartbeat</p>
<h4>Workflow</h4>
<p>This event SHALL be send at least every 10 second. or an order of magnitude lower than the subscription time-out.</p>
<h4>Context</h4>
<p>The context of the -monitor event described in the table below.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th align="left">Optionality</th>
<th>#</th>
<th>type</th>
<th><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>period</code></td>
<td align="left">REQUIRED</td>
<td>1</td>
<td>decimal</td>
<td>The resend period in seconds</td>
</tr>
</tbody>
</table>
<p>The first field indicates the repeat interval. If an event is not received within this time period, the connection may be assumed to be lost.</p>
<h2>Example</h2>
<p>An example heartbeat event is indicated below.</p>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
  <span class="nt">"timestamp"</span><span class="p">:</span><span class="s2">"2021-05-19T10:24:58.614989800Z"</span><span class="p">,</span>
  <span class="nt">"id"</span><span class="p">:</span><span class="s2">"sdkasldkals;610101498614"</span><span class="p">,</span>
  <span class="nt">"event"</span><span class="p">:{</span>
    <span class="nt">"context"</span><span class="p">:[</span>
      <span class="p">{</span> <span class="nt">"key"</span><span class="p">:</span><span class="s2">"period"</span><span class="p">,</span>
        <span class="nt">"decimal"</span><span class="p">:</span> <span class="s2">"10"</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">"hub.topic"</span><span class="p">:</span><span class="s2">"Topic1"</span><span class="p">,</span>
    <span class="nt">"hub.event"</span><span class="p">:</span><span class="s2">"heartbeat"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</blockquote>



<a name="253487732"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20issue%20%23311%20syncerror/near/253487732" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html#253487732">(Sep 15 2021 at 21:05)</a>:</h4>
<p>bvdh <a href="https://github.com/HL7/fhircast-docs/issues/311#issuecomment-920375442">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/311">issue #311</a>:</p>
<blockquote>
<p>The commit does not cover this issue, just part of it. </p>
</blockquote>



<a name="261159202"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20issue%20%23311%20syncerror/near/261159202" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20issue.20.23311.20syncerror.html#261159202">(Nov 11 2021 at 17:02)</a>:</h4>
<p>isaacvetter closed <a href="https://github.com/HL7/fhircast-docs/issues/311">issue #311</a>:</p>
<blockquote>
<p>Especially for headless medical devices engaged in a FHIRcast session, it may be important for a subscriber to know the originating app of a syncerror event. </p>
<p>Could the syncerror event include some identifier of the app that caused the error (maybe client id?) such that a sufficiently sophisticated subscriber could attempt to evaluate the impact of a syncerror?</p>
</blockquote>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
