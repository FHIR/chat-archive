---
layout: page
title: "FHIR Chat  · fhircast-docs / Issue #253 Proposal for Websocket specifi... · fhircast-github"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/index.html">fhircast-github</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html">fhircast-docs / Issue #253 Proposal for Websocket specifi...</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="166814850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/166814850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#166814850">(May 29 2019 at 13:32)</a>:</h4>
<p>gkustas opened <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>Please see and comment on this proposal. It is a Confluence documented exported to PDF. Please let me know if there is a better way to do this.</p>
<p><a href="https://github.com/HL7/fhircast-docs/files/3232691/PO-FHIRCastWebsocketsSpecification-290519-0927-40.pdf" target="_blank" title="https://github.com/HL7/fhircast-docs/files/3232691/PO-FHIRCastWebsocketsSpecification-290519-0927-40.pdf">PO-FHIRCastWebsocketsSpecification-290519-0927-40.pdf</a></p>
<p>This proposal uses direct Websocket communication with a JSON payload (formatted with header and body elements).<br>
I made some assumptions and recommendations that should probably be changed - this is my first attempt at this sort of a thing (international standard).</p>
</blockquote>



<a name="167717790"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/167717790" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#167717790">(Jun 09 2019 at 21:29)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-500247100" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-500247100">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>I've added several updates, probably too many to enumerate. Mostly minor changes t the websocket message format, but more importantly use intent verification and use of the hub.channel.endpoint field for unsubscribing. This field will be the Websocket URL returned by the hub when the websocket client subscribes.</p>
<p><a href="https://github.com/HL7/fhircast-docs/files/3269976/PO-FHIRCastWebsocketsSpecification-090619-1726-188.pdf" target="_blank" title="https://github.com/HL7/fhircast-docs/files/3269976/PO-FHIRCastWebsocketsSpecification-090619-1726-188.pdf">PO-FHIRCastWebsocketsSpecification-090619-1726-188.pdf</a></p>
</blockquote>



<a name="168417283"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168417283" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168417283">(Jun 18 2019 at 16:25)</a>:</h4>
<p>isaacvetter <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503210403" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503210403">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>Hey @gkustas ,</p>
<p>Apologies for the delayed response.  Keeping Intent Verification seems important to enable the hub to confirm the subscription details to the client. </p>
<p>A few questions:</p>
<p>1) <code>body</code> element?<br>
2) Intent verification response should include the <code>hub.challenge</code>.<br>
3) How should a client "nack" a websocket intent verification? In your proposal, the client responds <br>
4) Should there be a websocket response from the client in the event notification ?<br>
5) Should the request context change and unsubscribe also happen over wss?</p>
<p>Isaac</p>
</blockquote>



<a name="168417592"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168417592" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168417592">(Jun 18 2019 at 16:29)</a>:</h4>
<p>isaacvetter edited a <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503210403" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503210403">comment</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>Hey @gkustas ,</p>
<p>Apologies for the delayed response.  Keeping Intent Verification seems important to enable the hub to confirm the subscription details to the client. </p>
<p>A few questions:</p>
<p>1) Does the <code>body</code> element accomplish anything beyond mirroring the HTTP model (and the <code>headers</code> element in the "response")?<br>
2) Intent verification response should include the <code>hub.challenge</code>. Right?<br>
3) How should a client "nack" a websocket intent verification? In your proposal, the client responds with an HTTP status, even though there's no HTTP. Is there a better way to do this?<br>
4) Should there be a websocket response from the client in the event notification ?<br>
5) Should the request context change and unsubscribe also happen over wss?</p>
<p>Isaac</p>
</blockquote>



<a name="168437699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168437699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168437699">(Jun 18 2019 at 17:45)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503240203" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503240203">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>Hi Isaac, thanks for getting back to me. First... Are you using the second<br>
version of my spec posted? Attaching it here to make sure.</p>
<p>1. The intent of having a "headers" element and a "body" element is to<br>
create a model that somewhat resembles an HTTP response/request. I don't<br>
know just how much we'll need it, but it seems to make sense in case of<br>
message acknowledgements (Acks/Nacks).</p>
<p>2. Yes, I guess it should, although to be honest, I'm not even sure the<br>
intent verification is necessary at all. I like the fact that we're<br>
following the standard rest specification, but it is even possible for a<br>
rogue application to sneak into a web socket connection? If so, then of<br>
course we need the intent and the challenge. I'll just add it in for now.</p>
<p>3. Depending on the error, probably something like this:<br>
{<br>
  "headers": {<br>
    "status": "INVALID",<br>
    "statusCode": "400"<br>
  }<br>
}<br>
4. Yes, I neglected to put that into the spec, after the notification event<br>
code, but ALL messages over the socket require acknowledgement . See Json<br>
Format section: "All websocket clients MUST respond with an acknowledgement<br>
response.  The Header will contain a status and status code. A body section<br>
is provided here, but there is not response data currently needed."<br>
5. No, personally I think the client should use the REST API for everything<br>
not requiring a callback endpoint. This will be more consistent and require<br>
less implementation on the hub side as well.</p>
<p>On Tue, Jun 18, 2019 at 12:25 PM Isaac Vetter &lt;<a href="mailto:notifications@github.com" title="mailto:notifications@github.com">notifications@github.com</a>&gt;<br>
wrote:</p>
<blockquote>
<p>Hey @gkustas &lt;<a href="https://github.com/gkustas" target="_blank" title="https://github.com/gkustas">https://github.com/gkustas</a>&gt; ,</p>
<p>Apologies for the delayed response. Keeping Intent Verification seems<br>
important to enable the hub to confirm the subscription details to the<br>
client.</p>
<p>A few questions:</p>
<p>1. body element?<br>
   2. Intent verification response should include the hub.challenge.<br>
   3. How should a client "nack" a websocket intent verification? In your<br>
   proposal, the client responds<br>
   4. Should there be a websocket response from the client in the event<br>
   notification ?<br>
   5. Should the request context change and unsubscribe also happen over<br>
   wss?</p>
<p>Isaac</p>
<p>—<br>
You are receiving this because you were mentioned.<br>
Reply to this email directly, view it on GitHub<br>
&lt;<a href="https://github.com/HL7/fhircast-docs/issues/253?email_source=notifications&amp;email_token=ABODZ3TC5VQQY4TNHCK6RLDP3ED67A5CNFSM4HQM2N52YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGODX7GDIY#issuecomment-503210403" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253?email_source=notifications&amp;email_token=ABODZ3TC5VQQY4TNHCK6RLDP3ED67A5CNFSM4HQM2N52YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGODX7GDIY#issuecomment-503210403">https://github.com/HL7/fhircast-docs/issues/253?email_source=notifications&amp;email_token=ABODZ3TC5VQQY4TNHCK6RLDP3ED67A5CNFSM4HQM2N52YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGODX7GDIY#issuecomment-503210403</a>&gt;,<br>
or mute the thread<br>
&lt;<a href="https://github.com/notifications/unsubscribe-auth/ABODZ3U5FBE4ISF3GXNUBQLP3ED67ANCNFSM4HQM2N5Q" target="_blank" title="https://github.com/notifications/unsubscribe-auth/ABODZ3U5FBE4ISF3GXNUBQLP3ED67ANCNFSM4HQM2N5Q">https://github.com/notifications/unsubscribe-auth/ABODZ3U5FBE4ISF3GXNUBQLP3ED67ANCNFSM4HQM2N5Q</a>&gt;<br>
.</p>
</blockquote>
<p>-- <br>
George Kustas</p>
</blockquote>



<a name="168439953"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168439953" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168439953">(Jun 18 2019 at 18:07)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503248527" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503248527">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>EDIT: I responded via email which truncated a lot of your post @isaacvetter . Please see additional comments:</p>
<p>#1. Yes - I basically answered you with your question :-). It was cut off after "the body element..."<br>
#3. So, yes, maybe there is a better way. How is the intent verification rejected via Rest? Isn't that callback done using HTTP? Maybe I'm not understanding...</p>
</blockquote>



<a name="168442538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168442538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168442538">(Jun 18 2019 at 18:35)</a>:</h4>
<p>isaacvetter <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503259034" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503259034">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>Hey @gkustas - I moved your content from the pdf into this wiki page: <a href="https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal" target="_blank" title="https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal">https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal</a> to provide additional transparency and edit history. </p>
<p>(3) REST FHIRcast says that the client should respond with an HTTP 404 to reject a subscription. I'm just trying to get my head around the modeling of HTTP in websockets. </p>
<p>(4) </p>
<blockquote>
<p>Should there be a websocket response from the client in the event notification ?<br>
Errr, sorry about that, I'd scanned your design too quickly. I clarified that in the <a href="https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal#websocket-notification-event" target="_blank" title="https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal#websocket-notification-event">wiki</a>. </p>
</blockquote>
<p>(5) </p>
<blockquote>
<blockquote>
<p>Should the request context change and unsubscribe also happen over wss?<br>
5. No, personally I think the client should use the REST API for everything<br>
not requiring a callback endpoint. This will be more consistent and require<br>
less implementation on the hub side as well.</p>
</blockquote>
</blockquote>
<p>Okay, we'll need to justify this. </p>
</blockquote>



<a name="168456605"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168456605" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168456605">(Jun 18 2019 at 21:22)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503316928" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503316928">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>Great! Thanks Isaac. I'll use the wiki for future updates.</p>
<p>Regarding the HTTP modelling of the web socket messages... I'm not married to the idea. It was a suggestion from Martin quite some time ago and it sounded like a good idea. I still think so, but perhaps there is a different model more appropriate for our limited use of web sockets. I'm open to suggestions.</p>
<p>There are only three messages sent over a web socket in the proposed spec:<br>
1. intent verification<br>
2. event notification<br>
3. client-&gt;hub ack/nack<br>
I can't think of any headers that we'd ever need for intent verification, and likewise for event notification, since authentication isn't needed once the websocket has been connected.<br>
The client ack/nack messages use ONLY the header, in order to mimic HTTP response headers.</p>
<p>We could simplify things by creating a model for client response to something like:</p>
<p>{<br>
    "status": "NOTFOUND",<br>
    "statusCode": "404"<br>
}</p>
<p>Likewise, remove the "body" element from the event notification and intent verification messages.</p>
</blockquote>



<a name="168489071"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168489071" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168489071">(Jun 19 2019 at 08:54)</a>:</h4>
<p>gedw99 <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503470891" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503470891">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>What about Catchup scenarios ?</p>
<p>I should explain my scenario.</p>
<p>If the Client has a VIew Model (Resource Collection) and its changed on the Server, you want the Client to be able to request updates when it starts up, then you want to have an orderable sequence ID.<br>
This is useful when many clients are hitting the same log endpoint that holds the immutable CUD ( create, update, deletes)events for that collection.  The client knows what Sequence ID it is at, and so can just say give me a stream of all CUD event from this sequence forward in time.</p>
<p>As far as i can see the proposal is generalised enough to enable this, but i wanted to raie this for discussion and to check my assertions. Also others maybe using Events in this way too.</p>
</blockquote>



<a name="168502024"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168502024" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168502024">(Jun 19 2019 at 12:37)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503542413" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503542413">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>Thanks @gedw99 . I'm not sure if we will have the scenario you mention, but I agree that sequencing is needed. This is why the timestamp (along with a unique id) are sent with the event. Should events be received out of sequence, the client will be able to decide what to do with the "old" event. In the scenario where the old event becomes obsolete (like a simple context change (open study, close study), the client may simply choose to ignore it. Later, as we introduce structured data (like measurements), sequencing may not be important and the event can be processed.</p>
<p>Please feel free to point out scenarios where this won't work. It's certainly not too late to change the spec.</p>
</blockquote>



<a name="168502095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168502095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168502095">(Jun 19 2019 at 12:38)</a>:</h4>
<p>gkustas edited a <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503542413" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503542413">comment</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>Thanks @gedw99 . I'm not sure if we will have the scenario you mention, but I agree that sequencing is needed. This is why the timestamp (along with a unique id) are sent with the event. Should events be received out of sequence, the client will be able to decide what to do with the "old" event. In the scenario where the old event becomes obsolete, like a simple context change (open study, close study), the client may simply choose to ignore it. Later, as we introduce structured data (like measurements), sequencing may not be important and the event can be processed.</p>
<p>Please feel free to point out scenarios where this won't work. It's certainly not too late to change the spec.</p>
</blockquote>



<a name="168530320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168530320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168530320">(Jun 19 2019 at 18:00)</a>:</h4>
<p>bvdh <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503667022" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503667022">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<blockquote>
<p>Great! Thanks Isaac. I'll use the wiki for future updates.</p>
<p>Regarding the HTTP modelling of the web socket messages... I'm not married to the idea. It was a suggestion from Martin quite some time ago and it sounded like a good idea. I still think so, but perhaps there is a different model more appropriate for our limited use of web sockets. I'm open to suggestions.</p>
<p>There are only three messages sent over a web socket in the proposed spec:</p>
<p>1. intent verification<br>
2. event notification<br>
3. client-&gt;hub ack/nack</p>
<p>I can't think of any headers that we'd ever need for intent verification, and likewise for event notification, since authentication isn't needed once the websocket has been connected.<br>
The client ack/nack messages use ONLY the header, in order to mimic HTTP response headers.</p>
<p>We could simplify things by creating a model for client response to something like:</p>
<p>{<br>
"status": "NOTFOUND",<br>
"statusCode": "404"<br>
}</p>
<p>Likewise, remove the "body" element from the event notification and intent verification messages.</p>
</blockquote>
<p>Why would the client need to respond to an event or subscription confirmation over the websocket channel?</p>
</blockquote>



<a name="168530355"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168530355" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168530355">(Jun 19 2019 at 18:01)</a>:</h4>
<p>bvdh deleted a <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503667022" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-503667022">comment</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<blockquote>
<p>Great! Thanks Isaac. I'll use the wiki for future updates.</p>
<p>Regarding the HTTP modelling of the web socket messages... I'm not married to the idea. It was a suggestion from Martin quite some time ago and it sounded like a good idea. I still think so, but perhaps there is a different model more appropriate for our limited use of web sockets. I'm open to suggestions.</p>
<p>There are only three messages sent over a web socket in the proposed spec:</p>
<p>1. intent verification<br>
2. event notification<br>
3. client-&gt;hub ack/nack</p>
<p>I can't think of any headers that we'd ever need for intent verification, and likewise for event notification, since authentication isn't needed once the websocket has been connected.<br>
The client ack/nack messages use ONLY the header, in order to mimic HTTP response headers.</p>
<p>We could simplify things by creating a model for client response to something like:</p>
<p>{<br>
"status": "NOTFOUND",<br>
"statusCode": "404"<br>
}</p>
<p>Likewise, remove the "body" element from the event notification and intent verification messages.</p>
</blockquote>
<p>Why would the client need to respond to an event or subscription confirmation over the websocket channel?</p>
</blockquote>



<a name="168954043"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179269-fhircast-github/topic/fhircast-docs%20/%20Issue%20%23253%20Proposal%20for%20Websocket%20specifi.../near/168954043" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Github Notifications (FHIRcast) <a href="https://fhir.github.io/chat-archive/stream/179269-fhircast-github/topic/fhircast-docs.20.2F.20Issue.20.23253.20Proposal.20for.20Websocket.20specifi.2E.2E.2E.html#168954043">(Jun 25 2019 at 16:38)</a>:</h4>
<p>gkustas <a href="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-505524497" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253#issuecomment-505524497">commented</a> on <a href="https://github.com/HL7/fhircast-docs/issues/253" target="_blank" title="https://github.com/HL7/fhircast-docs/issues/253">Issue #253</a>:</p>
<blockquote>
<p>@isaacvetter -</p>
<p>I found a problem with the specification, and I will update the wiki if my proposal is sound. I thought I'd run it by you first:</p>
<p>1. When a REST client subscribes, it sends hub.callback to a valid endpoint. In the hub, the callback is the "unique identifier" for this subscription. It persists a list of all subscriptions. <br>
2. When a websocket client subscribes, it send a hub.channel.type = "websocket" and null for hub.channel. The hub creates a unique websocket endpoint and returns it to the client. MY HUB uses that endpoint to persist this subscription.<br>
3. In a RESTful unsubscribe for a RESTful (non-websocket) client, the hub can easily look up the subscriber by using the hub.callback value. But in a websocket client, it cannot. It's null.<br>
My proposal is simple. I suggest that the websocket client MUST provide the websocket endpoint they are using on the hub in any REST method (such as unsubscribe) using hub.channel.endpoint.</p>
<p>Make sense?</p>
</blockquote>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
