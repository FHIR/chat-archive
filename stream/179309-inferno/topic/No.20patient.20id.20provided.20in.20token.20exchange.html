---
layout: page
title: "FHIR Chat  · No patient id provided in token exchange · inferno"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/index.html">inferno</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html">No patient id provided in token exchange</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="202115870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202115870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202115870">(Jun 26 2020 at 17:00)</a>:</h4>
<p>Another question / potential issue with SLS-08: Token exchange response body contains required information encoded in JSON</p>



<a name="202115924"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202115924" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202115924">(Jun 26 2020 at 17:00)</a>:</h4>
<p><a href="/user_uploads/10155/mEuu3ctUZrTBq8Hejb1z8kh7/image.png">image.png</a> <br>
what does it look for to check if a patient id has been provided?</p>
<div class="message_inline_image"><a href="/user_uploads/10155/mEuu3ctUZrTBq8Hejb1z8kh7/image.png" title="image.png"><img src="/user_uploads/10155/mEuu3ctUZrTBq8Hejb1z8kh7/image.png"></a></div>



<a name="202116134"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202116134" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202116134">(Jun 26 2020 at 17:02)</a>:</h4>
<p>I was under the impression that the patient id would be denoted by a "patient" claim in the access token and I verified the token I'm getting back includes a patient claim:</p>
<div class="codehilite"><pre><span></span><code>{
  &quot;exp&quot;: 1593119295,
  &quot;iat&quot;: 1593118995,
  &quot;auth_time&quot;: 1593118152,
  &quot;jti&quot;: &quot;...&quot;,
  &quot;iss&quot;: &quot;...,
  &quot;sub&quot;: &quot;...&quot;,
  &quot;typ&quot;: &quot;Bearer&quot;,
  &quot;azp&quot;: &quot;inferno&quot;,
  &quot;session_state&quot;: &quot;...&quot;,
  &quot;acr&quot;: &quot;0&quot;,
  &quot;scope&quot;: &quot;openid offline_access patient/*.* user/*.* launch profile launch/patient&quot;,
  &quot;patient&quot;: &quot;1234&quot;,
  &quot;name&quot;: &quot;testy mctestface&quot;,
}
</code></pre></div>



<a name="202116215"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202116215" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202116215">(Jun 26 2020 at 17:03)</a>:</h4>
<p>am I doing it wrong?</p>



<a name="202138536"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202138536" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202138536">(Jun 26 2020 at 20:26)</a>:</h4>
<p>We are expecting a patient context in the token exchange.  Is this the access token?  If so, we do not check the content of the access token because it is opaque to the client (unlike the id_token).  You can check the request/response in the previous step to see if the patient context is provided in the token exchange.</p>



<a name="202138630"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202138630" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202138630">(Jun 26 2020 at 20:27)</a>:</h4>
<p>For example:</p>
<p><a href="/user_uploads/10155/PKrtcpXOV01hyWQc4xDjp9qt/Screen-Shot-2020-06-26-at-4.24.49-PM.png">Screen-Shot-2020-06-26-at-4.24.49-PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/PKrtcpXOV01hyWQc4xDjp9qt/Screen-Shot-2020-06-26-at-4.24.49-PM.png" title="Screen-Shot-2020-06-26-at-4.24.49-PM.png"><img src="/user_uploads/10155/PKrtcpXOV01hyWQc4xDjp9qt/Screen-Shot-2020-06-26-at-4.24.49-PM.png"></a></div>



<a name="202139081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202139081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202139081">(Jun 26 2020 at 20:31)</a>:</h4>
<p>oh, interesting, i thought the patient was a claim to include in the token, not an attribute to include in the body of the token response...re-reading <a href="http://www.hl7.org/fhir/smart-app-launch/#step-3-app-exchanges-authorization-code-for-access-token">http://www.hl7.org/fhir/smart-app-launch/#step-3-app-exchanges-authorization-code-for-access-token</a> I guess I had that wrong...but then how does the resource server which is servicing the request to know which patient is making the request?</p>



<a name="202139793"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202139793" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202139793">(Jun 26 2020 at 20:38)</a>:</h4>
<p>The purpose of the patient context is to communicate to the client which patient id to use in queries, because it cannot inspect the content of the bearer token (and you wouldn't want a user to have to tell the app they are using what patient ID to use, better to have the authorization service communicate that to the app).  You certainly would want to somehow associate authorization information with the bearer token also so the resource server can determine if it should grant access to the resource requested.  But how to do it is up to you.  You could encode it within the bearer token somehow (as it appears you have done here), or have the resource server query some kind of introspection service / data store.</p>



<a name="202140182"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202140182" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202140182">(Jun 26 2020 at 20:43)</a>:</h4>
<p>interesting</p>



<a name="202140189"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202140189" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202140189">(Jun 26 2020 at 20:43)</a>:</h4>
<p>FWIW JWTs aren't encrypted, they are just base64-encoded and cryptographically signed to prevent tampering</p>



<a name="202140199"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202140199" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202140199">(Jun 26 2020 at 20:43)</a>:</h4>
<p>anyone can inspect a JWT</p>



<a name="202140294"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202140294" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202140294">(Jun 26 2020 at 20:44)</a>:</h4>
<p>Right, I meant that it cannot assume a standard encoding.  Not all servers will use JWTs for bearer tokens, and that's ok.</p>



<a name="202140400"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202140400" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202140400">(Jun 26 2020 at 20:45)</a>:</h4>
<p>thanks for clearing up this fundamental misunderstanding i had with SMART...I had assumed user info would be in the id_token (or available from the userinfo endpoint on the auth server) and that the patient id was really needed in the bearer token itself</p>



<a name="202141718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/No%20patient%20id%20provided%20in%20token%20exchange/near/202141718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/No.20patient.20id.20provided.20in.20token.20exchange.html#202141718">(Jun 26 2020 at 20:59)</a>:</h4>
<p>Yes, id_token is for "user" information (who you are).  The bearer token signals what the app has been granted access to.  And the context parameters (patient, encounter) gives the app a enough information to make queries that are useful to the user of the app.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
