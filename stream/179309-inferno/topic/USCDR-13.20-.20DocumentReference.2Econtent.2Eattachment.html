---
layout: page
title: "FHIR Chat  · USCDR-13 - DocumentReference.content.attachment · inferno"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/index.html">inferno</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html">USCDR-13 - DocumentReference.content.attachment</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="251289361"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251289361" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251289361">(Aug 30 2021 at 20:23)</a>:</h4>
<p><strong>Prior art:</strong></p>
<ul>
<li><a href="https://github.com/onc-healthit/inferno-program/issues/316">Inferno Github Issue #316</a></li>
<li><a href="https://github.com/onc-healthit/inferno-program/issues/261">Inferno Github Issue #261</a></li>
<li>Prior topic in this chat.fhir stream <a href="#narrow/stream/179309-inferno/topic/DocumentReference.20content.20attachment">DocumentReference.content.attachment</a></li>
</ul>
<p><strong>Spec References:</strong></p>
<ul>
<li><a href="http://hl7.org/fhir/us/core/STU3.1.1/general-guidance.html#must-support">US Core 3.1.1 Must Support</a></li>
<li><a href="http://hl7.org/fhir/us/core/STU3.1.1/StructureDefinition-us-core-documentreference.html">US Core 3.1.1 DocRef.content.attachment</a></li>
</ul>
<p><strong>Topic:</strong><br>
I want to bring up the DocumentReference.content.attachment must-support / us-core-6 invariant topic again, this time in light of the CCG clarification about choice elements:</p>
<div class="codehilite"><pre><span></span><code>&quot;A Health IT Module must support at least one Choice or Reference for
US Core IG “must support” elements with multiple Choices or References, respectively. &quot;
</code></pre></div>
<p>DocumentReference.content.attachment is labeled as must-support in 3.1.1.  Right now, Inferno USCDR-13 is requiring that a server demonstrate support for <em>both</em>  <a href="http://attachment.data">attachment.data</a> and attachment.url.  However, in light of the CCG clarification, it seems reasonable for Inferno to only require support for one or the other.   I make this claim for a few reasons:</p>
<ol>
<li>The CCG clarification uses the term "Choice", and the obvious interpretation of that is the choice[x] structure in FHIR, but <a href="http://attachment.data">attachment.data</a> and attachment.url is functionally a "choice".</li>
<li>US Core 3.1.1 indicates that if a responder doesn't have the data, and doesn't know why, then it SHALL not return it.  (Relevant note:  US Core 3.1.1 indicates that if a responder doesn't have the data, but does know why, it should DAR it.)</li>
</ol>
<p>#2 above is a little tricky, because DAR has an option of unsupported, but you have to figure out which entity is the responder.  If the responder is the API server, then if it doesn't support something (i.e. it is unintentionally unsupported), then it doesn't know enough to DAR it.  However if it is the <em>developer</em> of the API server, then they it might be intentionally unsupported, in which case a DAR would be fine.</p>
<p><strong>Summary</strong><br>
Anyway - this all boils down to whether a server who only supports <em>either</em> <a href="http://attachment.data">attachment.data</a> <em>or</em> attachment.url should pass Inferno's 3.1.1 g10 checks.  The prior art above shows this is contentious, so I wanted to get consensus here before I throw another github issue at Inferno.</p>



<a name="251289906"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251289906" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251289906">(Aug 30 2021 at 20:27)</a>:</h4>
<p>I think supporting one of the two should be enough. Clients won't mind (they have to support both in any case)</p>



<a name="251290391"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251290391" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251290391">(Aug 30 2021 at 20:31)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span> That is an update in US Core 4.0.0.<br>
The question is if there is wiggle room under US Core 3.1.1 which is required by (g)(10) test procedure.</p>



<a name="251293137"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251293137" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251293137">(Aug 30 2021 at 20:51)</a>:</h4>
<p>I think there are two different reasons why this could be fine in 3.1.1:</p>
<ul>
<li>I think the CCG clarification should/could apply here.  There is a conceptual "Choice" even though there isn't a "value[x]".   This might be stretching the <em>specific</em> intent of the CCG update, but I think it is in line with the <em>general</em> intent of the CCG update</li>
<li>I think because of how 3.1.1 defines must-support, a non-DAR'ed "don't return anything" option is allowed for stuff the server just doesn't support.</li>
</ul>



<a name="251293486"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251293486" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251293486">(Aug 30 2021 at 20:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191764">@Cooper Thompson</span> <br>
#1 they are not choices. Invariant us-core-6 state that both elements could be populated at the same time</p>
<blockquote>
<p>us-core-6: DocumentReference.content.attachment.url or <a href="http://DocumentReference.content.attachment.data">DocumentReference.content.attachment.data</a> or both SHALL be present.</p>
</blockquote>
<p>#2 The testing of MustSuppor is that a server has to demonstrate that it support all MustSupport elements. If a server never provide data with a specific MustSupprt element, then there is no evidence that the sever support such element.</p>



<a name="251294345"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251294345" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251294345">(Aug 30 2021 at 21:00)</a>:</h4>
<p>??<br>
requiring to support both does not really make sense: one of the two is enough - and the same data can be rendered in either really</p>



<a name="251294844"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251294844" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251294844">(Aug 30 2021 at 21:04)</a>:</h4>
<p>The us-core-6 invariant isn't what Inferno is using to justify checking both, right?  There isn't any compliance language that I know about that requires a server to support all permutations of an invariant.  And since that one is an "or", meeting only one of the expressions is sufficient.</p>



<a name="251384756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251384756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251384756">(Aug 31 2021 at 13:31)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span> <br>
It is not "required" to support both but MAY support both. While choice means SHALL NOT support both.<br>
<span class="user-mention" data-user-id="191764">@Cooper Thompson</span> <br>
I agree that one is sufficient to pass resource validation. I used to indicate that these two are different than value[x] choice type because there is no chance that two choice values be provided in the same resource but it is <strong>possible</strong> to have both url and data in DocumentReference. </p>
<p>For each individual resource validation (USCDR-01 - USCDR-12), Inferno use us-core-6 to check that either <code>url</code> or <code>data</code> or both are provided in each USCDR resources.</p>
<p>For the MustSupport check (USCDR-13), Inferno looks through all USCDR resources received from previous tests (USCDR-01 to USCDR-11). The evidence that server supports these two MustSupport elements is that if there is at least one USCDR resource having <code>url</code> and at least one USCDR resource having <code>data</code> (it does not matter if they are the same resource or not).</p>



<a name="251385847"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251385847" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251385847">(Aug 31 2021 at 13:37)</a>:</h4>
<blockquote>
<p>The evidence that server supports these two MustSupport elements is that if there is at least one USCDR resource having url and at least one USCDR resource having data </p>
</blockquote>
<p>Yes, my point is that checking ^ does not make any sense. Having just one or the other should be fine, because they are functionally interchangeable</p>



<a name="251386494"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251386494" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251386494">(Aug 31 2021 at 13:41)</a>:</h4>
<p>And <em>my</em> point is that checking that there are resources that support both url and data could be covered by that CCG clarification, if you consider url and data to be "Choices".</p>



<a name="251386626"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251386626" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251386626">(Aug 31 2021 at 13:42)</a>:</h4>
<p>Which means a server would only have to support one option in the list of choices, so only supporting one option across all resources would be ok.</p>



<a name="251388907"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251388907" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251388907">(Aug 31 2021 at 13:57)</a>:</h4>
<p><span class="user-mention" data-user-id="191764">@Cooper Thompson</span> CCG does say that</p>
<blockquote>
<p>A Health IT Module must support at least one Choice or Reference for US Core IG “must support” elements with multiple Choices or References, respectively. </p>
</blockquote>
<p>I think question here is that if <code>Choice</code> here is the FHIR choice type <code>value[x]</code> only or sub elements which could be considered as having <code>or</code>/<code>xor</code> relationship.</p>



<a name="251389197"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251389197" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251389197">(Aug 31 2021 at 13:59)</a>:</h4>
<p>Right.  We need a clarification on the clarification I guess...</p>



<a name="251390022"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251390022" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251390022">(Aug 31 2021 at 14:03)</a>:</h4>
<p>Another example would be <code>Observation.value[x]</code> and <code>Observation.DataAbsentReason</code></p>



<a name="251611485"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251611485" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251611485">(Sep 01 2021 at 19:00)</a>:</h4>
<p><span class="user-mention" data-user-id="191764">@Cooper Thompson</span> After thorough discussion, we decided to update USCDR-13 to match the CCG clarification on choice and reference element.</p>



<a name="251618716"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251618716" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251618716">(Sep 01 2021 at 19:50)</a>:</h4>
<p>Sweet!  Are you tracking that in a github issue?  Or do you want a new one?</p>



<a name="251619800"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/USCDR-13%20-%20DocumentReference.content.attachment/near/251619800" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/USCDR-13.20-.20DocumentReference.2Econtent.2Eattachment.html#251619800">(Sep 01 2021 at 19:58)</a>:</h4>
<p>I reopened one of the issue you mentioned <a href="https://github.com/onc-healthit/inferno-program/issues/316">https://github.com/onc-healthit/inferno-program/issues/316</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
