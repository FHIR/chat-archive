---
layout: page
title: "FHIR Chat  · BDA-03 - Should Inferno fail servers ignoring invalid scopes · inferno"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/index.html">inferno</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html">BDA-03 - Should Inferno fail servers ignoring invalid scopes</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="247923586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247923586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247923586">(Aug 02 2021 at 14:07)</a>:</h4>
<p>For the BDA-03 test, Inferno (Program Edition) is flagging the test as failed if the server doesn't error when a client requests the user/*.read scope. This is based on language in <a href="http://hl7.org/fhir/uv/bulkdata/authorization/index.html#scopes">backend auth guide</a>.  I think that check should just confirm that the server doesn't <em>grant</em> user scopes.  Our server will ignore any invalid scopes presented, and will return the scopes registered to the client during client registration (which can only be system scopes for backend  clients).</p>



<a name="247923850"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247923850" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247923850">(Aug 02 2021 at 14:09)</a>:</h4>
<p>Do folks agree in my interpretation?   If so, I can write a github issue to update BDA-03 to validate the server-issued scopes instead of the HTTP response code when a client sends invalid scopes.</p>



<a name="247927740"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247927740" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247927740">(Aug 02 2021 at 14:43)</a>:</h4>
<p>I agree that ignoring requested Scopes is fine, assuming you are in fact granting something and returning what you granted in the Scopes array of the generated access token response. If you're talking about issuing an access token with zero scopes because all of the requested Scopes were ignored and no default Scopes are configured... That seems like more dubious behavior.</p>



<a name="247927977"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247927977" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247927977">(Aug 02 2021 at 14:45)</a>:</h4>
<p>(in any case, it's not illegal or nonsensical or an application to request some combination of system level Scopes and user level scopes, using some combination of the application's own authority and the authority of a relevant user -- though this would be in the context of an authorizations code Grant (i.e., an app launch) ... We are clarifying this as we merge the backend Services content into the core SMART specification. I would not want to see the test suite and force behavior that would limit these kinds of possibilities )</p>



<a name="247933846"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247933846" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247933846">(Aug 02 2021 at 15:37)</a>:</h4>
<p>BDA-03 tests using 'user/*.read' scope and expects a 4xx error. <span class="user-mention" data-user-id="191764">@Cooper Thompson</span> What is the response from your server?</p>



<a name="247934086"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247934086" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247934086">(Aug 02 2021 at 15:39)</a>:</h4>
<p>200-OK, but we ignored the user scope and instead returned a token with the system scopes the client was registered for.</p>



<a name="247934459"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247934459" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247934459">(Aug 02 2021 at 15:42)</a>:</h4>
<p>Doesn't this violate <a href="https://tools.ietf.org/html/rfc6749#section-5.2?--">https://tools.ietf.org/html/rfc6749#section-5.2?--</a></p>



<a name="247934546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247934546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247934546">(Aug 02 2021 at 15:43)</a>:</h4>
<blockquote>
<p>The authorization server responds with an HTTP 400 (Bad Request)<br>
   status code (unless specified otherwise) and includes the following<br>
   parameters with the response:<br>
         invalid_scope<br>
               The requested scope is invalid, unknown, malformed, or<br>
               exceeds the scope granted by the resource owner.</p>
</blockquote>



<a name="247941659"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247941659" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247941659">(Aug 02 2021 at 16:55)</a>:</h4>
<p>That is from the auth code grant section.  The client credentials grant section (<a href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.4.2">https://datatracker.ietf.org/doc/html/rfc6749#section-4.4.2</a>) references section 3.3, which includes this blurb:</p>
<div class="codehilite"><pre><span></span><code>The authorization server MAY fully or partially ignore the scope
   requested by the client, based on the authorization server policy or
   the resource owner&#39;s instructions.  If the issued access token scope
   is different from the one requested by the client, the authorization
   server MUST include the &quot;scope&quot; response parameter to inform the
   client of the actual scope granted.```
</code></pre></div>



<a name="247945343"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247945343" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247945343">(Aug 02 2021 at 17:23)</a>:</h4>
<p>(Agreed with Cooper's reference -- and in the context of an authorization code grant, I wouldn't say that <code>user/*.read</code> or, say, <code>system/*.read</code> is "invalid". They might just not be authorized.)</p>



<a name="247953836"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247953836" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247953836">(Aug 02 2021 at 18:38)</a>:</h4>
<p><span class="user-mention" data-user-id="191764">@Cooper Thompson</span> Would you mind to create a github issue so we can track it?</p>



<a name="247954684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/BDA-03%20-%20Should%20Inferno%20fail%20servers%20ignoring%20invalid%20scopes/near/247954684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/BDA-03.20-.20Should.20Inferno.20fail.20servers.20ignoring.20invalid.20scopes.html#247954684">(Aug 02 2021 at 18:45)</a>:</h4>
<p>Done.  <a href="https://github.com/onc-healthit/inferno-program/issues/331">https://github.com/onc-healthit/inferno-program/issues/331</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
