---
layout: page
title: "FHIR Chat  · Searching by code on Observation · inferno"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/index.html">inferno</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html">Searching by code on Observation</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="245375428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245375428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Schwartz <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245375428">(Jul 08 2021 at 21:35)</a>:</h4>
<p>Inferno's single patient API tests use the codes returned by one successful query in subsequent queries. In particular, the various Observation (vitals) tests query first by code=&lt;some LOINC code&gt; then use the first code returned in the response (in Observation.code) as a search parameter in the next request.</p>
<p>The problem we're hitting is that we don't necessarily support searching by all the codes we return. Some are internal and we explicitly prevent searching on for security reasons. We <em>do</em>, however,  support searching by LOINC codes, as USCore requires :(<a href="https://www.hl7.org/fhir/us/core/StructureDefinition-us-core-vital-signs.html">https://www.hl7.org/fhir/us/core/StructureDefinition-us-core-vital-signs.html</a>). </p>
<p>Can Inferno look for a LOINC code in the response, instead of just picking the first code we return? It seems odd that just by switching the order of the codes we return, we could "pass" the Inferno tests.</p>



<a name="245448689"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245448689" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245448689">(Jul 09 2021 at 14:14)</a>:</h4>
<blockquote>
<p>It seems odd that just by switching the order of the codes we return, we could "pass" the Inferno tests.</p>
</blockquote>
<p>Yes, Inferno's US Core Tests are designed to test capabilities at least once  (e.g. search Observation by a code), and does not test capabilities with all possible inputs (e.g. search Observation by every possible code).  A test system could be much more thorough, but that kind of testing would be time consuming / expensive.  An obvious downside of our approach is that we do not expose every 'bug' that might exist in a system, so you may pass or fail depending on what inputs (codes in this case) Inferno happens to try.</p>



<a name="245450324"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245450324" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245450324">(Jul 09 2021 at 14:28)</a>:</h4>
<p>One thing that is a little confusing now is that the ONC certification criteria requires US Core v3.1.1, but the link you provided is for us Core v4.0.0.  There is no US Core-specific vital signs profile in v3.1.1 (it uses the one in the base FHIR spec).</p>



<a name="245451404"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245451404" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245451404">(Jul 09 2021 at 14:36)</a>:</h4>
<p>Our logic here is that you are required to support search by patient + code, as stated <a href="http://hl7.org/fhir/us/core/STU3.1.1/CapabilityStatement-us-core-server.html#observation">here</a>.  And we know that you have an observation with that code for this patient, and that we have access to seeing that code for this Observation for this patient, because you have provided it to us.  Therefore, if we search observations for this patient by that code we expect the search to work and to receive that data back.</p>



<a name="245452139"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245452139" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245452139">(Jul 09 2021 at 14:42)</a>:</h4>
<p>On the other hand, in looking at the actual profiles, they are explicit about which code you need to support searching by.  <a href="http://hl7.org/fhir/us/core/STU3.1.1/StructureDefinition-us-core-smokingstatus.html">For example</a>. Does this imply you do not need to support searching by other codes that are present in your data for these profiles?</p>



<a name="245454403"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245454403" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245454403">(Jul 09 2021 at 15:01)</a>:</h4>
<p>The FHIR spec may give servers the flexibility to do this, I'm not quite sure.  If it does, then from a client perspective it seems hard to have any confidence that any search would work.</p>



<a name="245454957"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245454957" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245454957">(Jul 09 2021 at 15:05)</a>:</h4>
<p>I think this is really a fun problem with US Core (or profiling search param requirements in general).  US Core requires support for the "code" search param.  In the base FHIR spec, the FHIRPath expression for the "code" search parameter is just Obesrvation.code.  So US Core does imply that a server needs to support searching for all codes, regardless of whether those codes are part of the value set bindings in the US Core profiled resource.  </p>
<p>This does put servers in an odd position.  The easy way for us to be compliant with US Core is to just not return (probably useful) codes that we don't support searching for.  However this goes against the spirit, as we are <em>removing</em> useful information from our API in order to be compliant.  </p>
<p>One solution would be for US Core to define their own SearchParameter instead of using "code" from the base FHIR spec, and have the FHIRpath expression for that parameter limit itself to only the specified value sets.  But that seems really annoying and I don't like that either.</p>



<a name="245457616"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245457616" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245457616">(Jul 09 2021 at 15:25)</a>:</h4>
<blockquote>
<p>The easy way for us to be compliant with US Core is to just not return (probably useful) codes that we don't support searching for.</p>
</blockquote>
<p>Right, failing servers for presenting extra information but not supporting searching by that extra information might be a technically correct failure but it discourages systems from doing anything other than the absolute minimum.</p>



<a name="245458360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245458360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245458360">(Jul 09 2021 at 15:32)</a>:</h4>
<p>So what's acceptable behavior when someone searches based on a non-uscdi-specified code? Presumably an error response would be okay, or a correct search response with matching resources would be okay -- but a 200 response with an empty Bundle wouldn't be okay.</p>



<a name="245471711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/245471711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matt Schwartz <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#245471711">(Jul 09 2021 at 17:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> , that's the approach we take today (responding with an error). I also think that's an acceptable behavior, as the current behavior discourages anything other than the absolute minimum -- as Robert said.</p>



<a name="246754110"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/246754110" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#246754110">(Jul 21 2021 at 17:45)</a>:</h4>
<p>We're considering asking ONC for a clarification here, probably suggesting that for g10 certification, we'd only be required to support searching on the terminologies defined by USCDI.  I can see this request being a bit controversial, so I'm interested if folks are generally ok with that, or have objections?  I get the value of searching on non-USCDI codes, but for very practical reasons, that can just be hard.  Do folks have strong feelings on way or another here?</p>



<a name="246761197"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/246761197" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#246761197">(Jul 21 2021 at 18:39)</a>:</h4>
<p>I'd also like to hear if others have an opinion on this.  I think it's reasonable to have the tests stick to specific named requirements as much as possible, but I also don't want to reorganize tests to avoid requirements that are inconvenient/difficult for one implementation or another.</p>



<a name="246762696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/246762696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#246762696">(Jul 21 2021 at 18:52)</a>:</h4>
<p>If this behavior is ok as long as you provide an error response, then I think we should definitely reorganize the test to stick to codes that you shouldn't be allowed to return an error response for.  But it is a little more difficult if you are doing something non-conformant here (though we may still want to reorganize the test anyhow to stick to the queries that are explicitly named within the guide).</p>



<a name="246763321"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/246763321" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen MacVicar <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#246763321">(Jul 21 2021 at 18:57)</a>:</h4>
<p>On the one hand, I would find the following behavior very puzzling as a client developer:</p>
<ul>
<li>Server gives me an Observation with code XYZ</li>
<li>Server claims to support searching Observations by code</li>
<li>Server gives me an error or empty Bundle when searching Observations by code XYZ</li>
</ul>
<p>On the other hand, if I wanted to search for particular types of Observations, I'd use the codes referenced in the IG rather than random codes that I received but don't necessarily understand.</p>



<a name="246773434"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/246773434" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#246773434">(Jul 21 2021 at 20:23)</a>:</h4>
<blockquote>
<p>I'd also like to hear if others have an opinion on this. I think it's reasonable to have the tests stick to specific named requirements as much as possible,</p>
</blockquote>
<p>This Zulip channel is monitored by folks building certified EHR systems;  the community with a perspective is going to be <em>consuming</em> these APIs. but not necessarily watching here.</p>



<a name="246773526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179309-inferno/topic/Searching%20by%20code%20on%20Observation/near/246773526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179309-inferno/topic/Searching.20by.20code.20on.20Observation.html#246773526">(Jul 21 2021 at 20:24)</a>:</h4>
<p>(I don't see a huge issue if searches with non-standardized vocabularies aren't supported, <em>but</em> getting the errors right is important -- I sure would want  this to fail loudly.)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
