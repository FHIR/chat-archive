---
layout: page
title: "FHIR Chat  · Granular scopes · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html">Granular scopes</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="199056081"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199056081" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199056081">(May 28 2020 at 17:45)</a>:</h4>
<p>In yesterday's Argo2020 call, we talked about a few different syntaxes for representing granular scopes. <span class="user-mention" data-user-id="191356">@Jenni Syed</span> you shared comments about scope size; do you have specific targets or limits you'd like us to consider, to help us pin down an objective consideration of trade-offs? (And do even our current resource-level scopes meet those targets, or are we already failing?)</p>



<a name="199058126"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199058126" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199058126">(May 28 2020 at 18:00)</a>:</h4>
<p>The URL length limit comes into play during the authorization request. This varies by browser, and your proxies etc between you and the final target. One I've seen is 2048 (at a tomcat and I think IE use to have this) total for the full URL</p>



<a name="199058790"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199058790" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199058790">(May 28 2020 at 18:05)</a>:</h4>
<p>Current scope string for our app connecting to Cerner is 280 characters (because no * - so list every resource individually)</p>



<a name="199058803"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199058803" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199058803">(May 28 2020 at 18:05)</a>:</h4>
<p>For the token size, if a server is embedding scopes into the token vs requiring constant call backs to a central service, the size limit again varies. And it varies a lot :) eg: a popular gateway may put a general 25k limit on header size. But apparently apache defaults to 8k... and I thought nginx had some even lower defaults (it's been a while, I'll see if I can find updates) <a href="https://stackoverflow.com/questions/686217/maximum-on-http-header-values">https://stackoverflow.com/questions/686217/maximum-on-http-header-values</a></p>



<a name="199058859"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199058859" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199058859">(May 28 2020 at 18:05)</a>:</h4>
<p>But that header size has to include <em>everything</em> in that token, not just scopes</p>



<a name="199059117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199059117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199059117">(May 28 2020 at 18:07)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span>  yeah, and I think we need to revisit wildcards during our SMART scope discussion :) We haven't implemented it because the spec says it means everything now <em>and in the future</em> that may be available, which is really hard to describe to a patient that is authorizing access. If we went back to "it's just a shortcut to the scopes I'm authorized for" that's different :) But a bit out of scope of this thread right now</p>



<a name="199059235"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199059235" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199059235">(May 28 2020 at 18:08)</a>:</h4>
<p>However, even if the URL req could use wildcards,  I wouldn't want to require them, and it won't solve the token header size limit since you would need to know what was actually authorized by the patient</p>



<a name="199060067"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199060067" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199060067">(May 28 2020 at 18:12)</a>:</h4>
<p>There are approaches an auth server can do to reduce size (but still not require resource servers to call back to a central location like introspection), so that is another consideration</p>



<a name="199068031"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199068031" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199068031">(May 28 2020 at 19:10)</a>:</h4>
<p>Re: header size, this is a slightly different issue, since the access token doesn't need to include literal SMART scopes inside (but obviously it's nice if they can).</p>



<a name="199068259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199068259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199068259">(May 28 2020 at 19:12)</a>:</h4>
<p>For an app that's fetching data about dozens of resource types, are the current SMART scopes hitting some practical limits? Or do we just not have experience with apps like that?</p>



<a name="199068278"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199068278" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199068278">(May 28 2020 at 19:12)</a>:</h4>
<p>Given the relatively small focus of US Core?</p>



<a name="199068644"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199068644" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199068644">(May 28 2020 at 19:15)</a>:</h4>
<p>Basically I want some way to decide whether we need to so something more extreme about scope size, like having clients send hashes of or references to a full scope list, rather than transmitting full details about scopes in the URL</p>



<a name="199069155"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199069155" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199069155">(May 28 2020 at 19:19)</a>:</h4>
<p>For example, if we wanted to support a 2048 character URL limit, including space for stuff that is not scopes, we would have maybe a kilobyte to work with for scopes. That clearly breaks down if you are individually listing fhir resources.</p>



<a name="199069974"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199069974" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199069974">(May 28 2020 at 19:24)</a>:</h4>
<p>If we did that/recommended that, we would likely also want to recommend auth servers actually use the scopes param in the token response to communicate what was actually granted</p>



<a name="199070304"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199070304" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199070304">(May 28 2020 at 19:26)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> Not following the comment on header - you just mean that (if a server doesn't require callback to central authority) the token wouldn't need to be literal SMART scopes? If so, that may affect what out of the box auth servers you could use (that don't understand SMART first class)</p>



<a name="199070821"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199070821" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199070821">(May 28 2020 at 19:28)</a>:</h4>
<p>Yes, that's all I meant (i.e., we don't specify anything about access token format).</p>



<a name="199070862"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199070862" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199070862">(May 28 2020 at 19:29)</a>:</h4>
<p>I don't think we need to do things that are extreme, but more want to understand that there are reasons to find a balance between verbosity and compactness :)</p>



<a name="199071007"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199071007" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199071007">(May 28 2020 at 19:29)</a>:</h4>
<p>But for choices that are within a factor of, say .5-1.5x of the size our current approach, I'm having a hard time knowing whether this matters.</p>



<a name="199071101"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199071101" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199071101">(May 28 2020 at 19:29)</a>:</h4>
<p>On one assessment, our current approach already doesn't scale, and anything we <em>add</em> to it only makes it worse.</p>



<a name="199073842"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199073842" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199073842">(May 28 2020 at 19:46)</a>:</h4>
<p>yeah, I'm not too worried if it doesn't expand to "all the things you could query on" :)</p>



<a name="199073915"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199073915" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199073915">(May 28 2020 at 19:46)</a>:</h4>
<p>Google has some "longer" API scopes, but also not sure how common it is for an app to use a bunch</p>



<a name="199074015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199074015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199074015">(May 28 2020 at 19:47)</a>:</h4>
<p>Today, we haven't hit limits with the URLs, and we do have some apps that ask for every combination of scope that we offer in sandbox :)</p>



<a name="199074159"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199074159" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199074159">(May 28 2020 at 19:48)</a>:</h4>
<p>That is usually whittled down before prod, so that the "conflicting" scopes are no longer requested (eg: both patient/{}.read and user/{}.read don't make sense)</p>



<a name="199074163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199074163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199074163">(May 28 2020 at 19:49)</a>:</h4>
<p>But right now support in your server is limited to a subset of the FHIR API, and some of the generic servers would have many more resource types to contend with. Plus layering on the complexity of sub resource scopes like specific categories or tags... We are obviously going to need more space to express these policies.</p>



<a name="199402528"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199402528" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199402528">(Jun 01 2020 at 18:04)</a>:</h4>
<p>I would like to offer that these needs to get more and more comprehensive might be a good reason to help security out with Permission resource. This is a very drafty draft. We have already found many problems with the draft. But the idea of Permission is to carry access control rules.  Meaning, don't bother looking at the Permission resource we have, it is just a first draft placeholder.</p>



<a name="199402785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199402785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199402785">(Jun 01 2020 at 18:06)</a>:</h4>
<p>I hope we can come up with a OAuth scope pattern that meets majority needs, while pushing more detailed needs into a Permission resource. Where that resource might be referenced or contained; where that resource might be used in other ways too</p>



<a name="199700940"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199700940" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199700940">(Jun 04 2020 at 03:09)</a>:</h4>
<p>how would you represent scopes in a Permission?</p>



<a name="199744834"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199744834" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199744834">(Jun 04 2020 at 13:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191316">Grahame Grieve</span> <a href="#narrow/stream/179170-smart/topic/Granular.20scopes/near/199700940">said</a>:</p>
<blockquote>
<p>how would you represent scopes in a Permission?</p>
</blockquote>
<p>There have been discussions of having scopes be json encoded. That seems like an opportunity to have the same json be a subset of a Permission resource. If it gets complex enough the scope could be a reference rather than contained in the scope.  --- and key to this is that Permission draft in the spec today is highly drafty and needs major re-design.  I am simply pointing out that the needs of a OAuth scope is the same needs as are driving Permission.</p>



<a name="199744922"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199744922" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199744922">(Jun 04 2020 at 13:19)</a>:</h4>
<p>I do think that we can do some much more achievable step that doesn't not require json encoding.</p>



<a name="199744958"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199744958" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199744958">(Jun 04 2020 at 13:19)</a>:</h4>
<p>I'm assuming you have an extra negative in there :-)</p>



<a name="199744996"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199744996" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199744996">(Jun 04 2020 at 13:19)</a>:</h4>
<p>For our next Argonaut call I would love it if people could bring additional proposals so that we can compare them to the approach I laid out last week.</p>



<a name="199745165"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199745165" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199745165">(Jun 04 2020 at 13:21)</a>:</h4>
<p>I worry we're not exploring this design space effectively yet, And it's hard to discuss things like size requirements in the abstract.</p>



<a name="199746467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199746467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199746467">(Jun 04 2020 at 13:30)</a>:</h4>
<p>agree. simple achievable next step.</p>



<a name="199751016"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199751016" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199751016">(Jun 04 2020 at 14:02)</a>:</h4>
<p>The primary concern was the "unbounded" scope description using a query</p>



<a name="199751269"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199751269" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199751269">(Jun 04 2020 at 14:04)</a>:</h4>
<p>eg: I can easily (and we have seen it happen) query for observations "labs" using many many loincs just to get at 3 "basic" labs (because I try to account for all the different methods that can be pre-coordinated into the code). So many that I immediately blow through typical URL length limits :)</p>



<a name="199755379"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199755379" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199755379">(Jun 04 2020 at 14:32)</a>:</h4>
<p>I was expecting that with the query syntax model, we would have a well-defined initial set.. not unconstrained. The advantage of having the query model was that it set a pattern that we could grow into as explicit use-case priority needs came up.</p>



<a name="199762943"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199762943" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199762943">(Jun 04 2020 at 15:21)</a>:</h4>
<p>code was one of the initial examples given :)</p>



<a name="199762987"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/199762987" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#199762987">(Jun 04 2020 at 15:21)</a>:</h4>
<p>(eg: limit to a specific type of result) - even though I don't know if that would be original scope</p>



<a name="200122229"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200122229" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200122229">(Jun 08 2020 at 16:22)</a>:</h4>
<p><span class="user-mention" data-user-id="191356">@Jenni Syed</span> in your example here ("using many many LOINCs" and blowing through URL length limits)... is this something where developers are hitting length limits in their <code>GET</code>-based FHIR search API calls? Like, with browsers that impose limits not just on window.location length but on AJAX request URLs too? Is this something that they can address with <code>POST</code>-based search?</p>



<a name="200122270"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200122270" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200122270">(Jun 08 2020 at 16:22)</a>:</h4>
<p>Is it related to authorization, or just a query example where URL limits come into play?</p>



<a name="200144003"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200144003" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200144003">(Jun 08 2020 at 19:21)</a>:</h4>
<p>The example in question was solved for them switching to POST (they hit the limit with the URL when they did a GET), but the concern I had for the scopes was if we allowed something similar, you can't switch that to POST for the authorization request</p>



<a name="200144020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200144020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200144020">(Jun 08 2020 at 19:21)</a>:</h4>
<p>in our case, they hit a tomcat limit, not browser</p>



<a name="200147496"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200147496" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200147496">(Jun 08 2020 at 19:52)</a>:</h4>
<p>Gotcha. So this week we can talk through approaches like <a href="https://tools.ietf.org/html/draft-ietf-oauth-jwsreq-20#section-5.2.2">https://tools.ietf.org/html/draft-ietf-oauth-jwsreq-20#section-5.2.2</a> to limit size over the wire, specifically for the <code>authorize</code> endpoint.</p>



<a name="200161484"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200161484" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200161484">(Jun 08 2020 at 22:02)</a>:</h4>
<p>that looks like it died from an IETF perspective... (it's expired)</p>



<a name="200161663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200161663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200161663">(Jun 08 2020 at 22:04)</a>:</h4>
<p>My coworker pointed out that OpenId Connect allows the authorization to use a form POST</p>



<a name="200161672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200161672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200161672">(Jun 08 2020 at 22:04)</a>:</h4>
<p>which would leave this to be mostly token size issue</p>



<a name="200161817"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200161817" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200161817">(Jun 08 2020 at 22:06)</a>:</h4>
<p>and I know some cloud providers have special errors they provide when you've asked for scopes that push their token size beyond implementation limits</p>



<a name="200161837"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200161837" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200161837">(Jun 08 2020 at 22:07)</a>:</h4>
<p>which would imply that you start breaking up your token requests by workflow...</p>



<a name="200161855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200161855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200161855">(Jun 08 2020 at 22:07)</a>:</h4>
<p>and if you're getting so many that it's a concern, that's probably a reasonable thing to do for your own sanity and token managment</p>



<a name="200164002"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200164002" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200164002">(Jun 08 2020 at 22:33)</a>:</h4>
<p>"Hasn't yet been re-re-renewed yet"' isn't the same as dead. OpenId also already allows for request objects to be passed by request_uri, so this spec is really ietf formalizing that same pattern.</p>



<a name="200174083"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200174083" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200174083">(Jun 09 2020 at 01:17)</a>:</h4>
<p>Re: submission via POST, that's a great trick that OIDC already defines (I never knew -- thanks for the heads-up). That takes off the URL size pressure for the request step. For the response step, <a href="https://openid.net/specs/oauth-v2-form-post-response-mode-1_0.html">https://openid.net/specs/oauth-v2-form-post-response-mode-1_0.html</a> takes off the pressure. Both of these leave things up to client discretion (but obviously clients that will fail on GET, will be incentivized to POST).</p>



<a name="200174097"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/200174097" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#200174097">(Jun 09 2020 at 01:17)</a>:</h4>
<p>That just leaves the authorization header itself, which we've always left out of scope.</p>



<a name="210084320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/210084320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dharmesh Patel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#210084320">(Sep 15 2020 at 02:12)</a>:</h4>
<p>A SMART App submits a PATCH Request to change the value of the patient reference in an AllergyIntolerance resource whose current patient value is set to 'Patient/{validPatientID'. The request has an access token with scope = 'patient/AllergyIntolerance.write' and patient="Patient/{validPatientID}". The body of the request contains another valid PatientID. Question #1: Should the request be allowed or denied? Question #2: Should the same request be allowed or denied if the scope='user/AllergyIntolerance.write'?</p>



<a name="210085699"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/210085699" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#210085699">(Sep 15 2020 at 02:47)</a>:</h4>
<p>1) the access token has scopes only for patient 1; it shouldn't be able to put allergies in patient 2's compartment</p>



<a name="210085750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/210085750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#210085750">(Sep 15 2020 at 02:48)</a>:</h4>
<p>2) assuming the user  in question is allowed to modify records for both patients, then user level write permissions should confer this ability to an app</p>



<a name="210085755"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/210085755" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#210085755">(Sep 15 2020 at 02:48)</a>:</h4>
<p>Note that the smart scope language provides no way to say which users have access to performance operations under the hood...</p>



<a name="210095205"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Granular%20scopes/near/210095205" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dharmesh Patel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Granular.20scopes.html#210095205">(Sep 15 2020 at 06:46)</a>:</h4>
<p>Thanks Josh.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
