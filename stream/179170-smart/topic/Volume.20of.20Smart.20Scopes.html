---
layout: page
title: "FHIR Chat  · Volume of Smart Scopes · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html">Volume of Smart Scopes</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="235436509"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235436509" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Braman (FLY.HEALTH) <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235436509">(Apr 21 2021 at 00:21)</a>:</h4>
<p>Hi All, I do extensive development for real world APIs and I have repeatedly seen problems with various major vendors products (who shall rename nameless) when it comes to the volume of scopes required by Smart on FHIR for an API.  Take a Patient Access API for example which supports CARIN and USCore (read only)  Such an API requires around 58 scopes just to support .read operations on the required resources.  I have seen oAuth servers limited to 30 scopes, I have seen refresh token minters fail on creating tokens with too many scopes, and I have seen proxy servers that need to have buffers increased to handle the amount of data that needs to go back and forth to support Smart on FHIR.  Yes, I realize that there are wildcard scopes, but with those fine grained access control is lost.  One question I have is around the need to have patient and user scopes.  Interestingly, Inferno only tests patient/&lt;Resource&gt;.read and does not include user/&lt;<a href="http://Resource.read">Resource.read</a>&gt; scopes in its default tests.  Any ideas on how we could trim down the number of scopes?  Are patient and user scopes redundant?  The spec is clear on how patient and user scope differ in theory but how do they differ in practice? How are vendors dealing with two differently when evaluating scopes in their APIs?</p>



<a name="235440218"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235440218" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235440218">(Apr 21 2021 at 01:14)</a>:</h4>
<p>Are these oAuth servers limited to 30 scopes total, or 30 for a single authorization request?  For a single request, I'm not aware of any good reason why you would need to be granted both patient &amp; user level scopes for a single resource at the same time (e.g. "patient/Observation.read user/Observation.read").  But if real-world oAuth servers can only be configured with 30 scopes total, that's a different problem.</p>



<a name="235440441"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235440441" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Braman (FLY.HEALTH) <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235440441">(Apr 21 2021 at 01:17)</a>:</h4>
<p>One server major vendor's server is in fact limited to 30 scopes total.</p>



<a name="235442135"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235442135" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235442135">(Apr 21 2021 at 01:44)</a>:</h4>
<blockquote>
<p>Interestingly, Inferno only tests patient/&lt;Resource&gt;.read and does not include user/&lt;<a href="http://Resource.read">Resource.read</a>&gt; scopes in its default tests.</p>
</blockquote>
<p>This is beside the point (I think) and I don't want to sidetrack the topic, but the ONC standardized API certification tests in Inferno require demonstrating an app launched with patient scopes for all USCDI-relevant resources¹, and separately an app launched with user scopes.  So you need to show both.  Our 'Community' tests are more flexible, and it is more up to the tester to decide to try user scopes and patient scopes, if they expect the server to support both permission-patient and permission-user SMART capabilities.</p>
<p>¹ <em>(technically also constrained to resources that are also in the patient compartment, soon!)</em></p>



<a name="235445259"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235445259" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Braman (FLY.HEALTH) <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235445259">(Apr 21 2021 at 02:34)</a>:</h4>
<p>Robert, Can you tell me from an implementation perspective how a FHIR server handles patient scopes differently from user scopes?  The spec is clear on the difference in theory, but not so much in practice, as in, how SHOULD they be used by the server to control access to resource?</p>



<a name="235445384"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235445384" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235445384">(Apr 21 2021 at 02:36)</a>:</h4>
<p>patient-level scopes give you access to a single patient's data; user-level scopes can give access to more than one patient's data. Is this what you mean?</p>



<a name="235446084"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235446084" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Braman (FLY.HEALTH) <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235446084">(Apr 21 2021 at 02:49)</a>:</h4>
<p>The patient scopes are straightforward.  The user scopes not so much (to me at least). You are saying to view data for another patient, the app must request, and the user must approve user scopes, Correct?.  How does the app know which patients it has access to?  I was always under the assumption that the user session had a single patient context.  Is that incorrect?  Every token response I have ever seen only had a single patient, and the patient context in the documentation is not an array.   In our smart on fhir flow, which allows the patient to approve scopes, the user is asked which data the user will grant access to.  It also asks which patient the user would like to view.  But only a single patient context is returned.  I have attached a screenshot to make it clearer. <a href="/user_uploads/10155/UmrcAt36TaqA6i8uGspKjNFw/patient_consent.png">patient_consent.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/10155/UmrcAt36TaqA6i8uGspKjNFw/patient_consent.png" title="patient_consent.png"><img src="/user_uploads/10155/UmrcAt36TaqA6i8uGspKjNFw/patient_consent.png"></a></div>



<a name="235446173"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235446173" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Braman (FLY.HEALTH) <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235446173">(Apr 21 2021 at 02:50)</a>:</h4>
<p>Sorry but Amberly and Jann had bad hair days</p>



<a name="235446750"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235446750" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paul Church <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235446750">(Apr 21 2021 at 02:59)</a>:</h4>
<p>User scopes assume that the server has some permissions model where a user identity (the usual example is a practitioner) has access to one or more patients for reasons that are not contained in the scope. This is normal for EHRs. It doesn't make a lot of sense for pure FHIR servers. It seems that in patient access use cases most implementers are going with a patient selection UI in the auth flow (e.g. for multiple family members) and granting a patient scope rather than teaching the fhir server all of those linkages necessary to make a user scope possible.</p>



<a name="235446970"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235446970" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235446970">(Apr 21 2021 at 03:01)</a>:</h4>
<blockquote>
<p>does the app know which patients it has access to?</p>
</blockquote>
<p>The app can search for data, and it gets what it gets. e.g. <code>GET /Patient</code>.</p>



<a name="235447277"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235447277" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235447277">(Apr 21 2021 at 03:05)</a>:</h4>
<p>Unfortunately, <code>GET /Patient</code> is not required in US Core.  Does anyone implement that?</p>



<a name="235447785"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235447785" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235447785">(Apr 21 2021 at 03:12)</a>:</h4>
<p>You can pass in search parameters (for a clinician facing app, to search a population by name); this has been implemented by EHRs I believe.</p>



<a name="235448048"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235448048" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235448048">(Apr 21 2021 at 03:16)</a>:</h4>
<p>True -- search by name, and a <a href="https://www.hl7.org/fhir/us/core/CapabilityStatement-us-core-server.html#patient">few other options</a> are required in US Core.</p>



<a name="235505842"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235505842" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235505842">(Apr 21 2021 at 13:06)</a>:</h4>
<blockquote>
<p>Does anyone implement that</p>
</blockquote>
<p>Yes, we support it, I believe Cerner does: you need that if you want to support user scopes for patient apps to get all dependents in one go</p>



<a name="235506020"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235506020" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235506020">(Apr 21 2021 at 13:08)</a>:</h4>
<p>There are going to be even more scopes in SMART v. 2!</p>



<a name="235506963"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235506963" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235506963">(Apr 21 2021 at 13:13)</a>:</h4>
<p>Yeah its a bit of a shame that the full /Patient query (bounded by user permission, of course) isn't required by us core, so there would be confidence for app builders that design the user experience around the availability of that query.</p>



<a name="235507142"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235507142" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235507142">(Apr 21 2021 at 13:15)</a>:</h4>
<p>But mandating that in all cases might be problematic</p>



<a name="235524608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235524608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235524608">(Apr 21 2021 at 14:59)</a>:</h4>
<p>Yes, for providers app it would be pretty bad</p>



<a name="235535759"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235535759" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Braman (FLY.HEALTH) <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235535759">(Apr 21 2021 at 15:55)</a>:</h4>
<p>Maybe they should just add Patient/$everything to USCore</p>



<a name="235536176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235536176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Richard Braman (FLY.HEALTH) <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235536176">(Apr 21 2021 at 15:58)</a>:</h4>
<p>is the patient context value capable of supporting more than one value?  Can it be an array?</p>



<a name="235536727"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Volume%20of%20Smart%20Scopes/near/235536727" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Volume.20of.20Smart.20Scopes.html#235536727">(Apr 21 2021 at 16:01)</a>:</h4>
<p>It is defined as <em>the patient</em> in context for the session; it's not designed to convey "patients you have access to". But I could see the utility of this (or a releated property). Would be worth sharing a comment in the SMARTv2 ballot (or just a regular Jira comment, and mention it here) for folks interested.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
