---
layout: page
title: "FHIR Chat  · authenticating · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html">authenticating</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153815300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815300">(Mar 12 2016 at 02:54)</a>:</h4>
<p>Whats the appropriate response if the Authorization server declines a request for access - 403 forbidden?</p>



<a name="153815301"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815301" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815301">(Mar 12 2016 at 03:01)</a>:</h4>
<p>Does the request have an authorization token associated with it (and it's simply no good for what the client is trying to access -- e.g. expired)? </p>



<a name="153815302"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815302" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815302">(Mar 12 2016 at 03:01)</a>:</h4>
<p>Or is it a request for a protected resource that just includes no token?</p>



<a name="153815303"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815303" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815303">(Mar 12 2016 at 03:05)</a>:</h4>
<p>The rules are basically (from <a href="https://tools.ietf.org/html/rfc6750#section-3.1" target="_blank" title="https://tools.ietf.org/html/rfc6750#section-3.1">https://tools.ietf.org/html/rfc6750#section-3.1</a>):</p>
<p>1. Missing token: 401<br>
2. Expired/bad token: 401<br>
3. Good token, but not appropriate for the requested data: 403</p>



<a name="153815304"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815304" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815304">(Mar 12 2016 at 03:06)</a>:</h4>
<p>These messages should also come with a WWW-Authenticate Response Header response header, and an error code (see the link above)</p>



<a name="153815305"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815305" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815305">(Mar 12 2016 at 03:06)</a>:</h4>
<p>(We haven't gotten deep into testing/expectations on this front though.)</p>



<a name="153815328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815328">(Mar 12 2016 at 19:12)</a>:</h4>
<p>FYI <a href="http://fhirblog.com/2016/03/13/implementing-smart-on-fhir-in-an-ehr/" target="_blank" title="http://fhirblog.com/2016/03/13/implementing-smart-on-fhir-in-an-ehr/">http://fhirblog.com/2016/03/13/implementing-smart-on-fhir-in-an-ehr/</a></p>



<a name="153815329"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815329" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815329">(Mar 12 2016 at 19:44)</a>:</h4>
<p>Awesome! I just retweeted <span class="user-mention" data-user-id="191387">@Keith Boone</span>'s link to your post <span class="user-mention" data-user-id="191321">@David Hay</span>.  Now to actually read past your intro ;) </p>



<a name="153815331"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815331" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815331">(Mar 12 2016 at 20:39)</a>:</h4>
<p><img alt=":grin:" class="emoji" src="static/third/gemoji/images/emoji/grin.png" title=":grin:">  now I just need to wait and see if I made any mistakes!</p>



<a name="153815515"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815515" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Girard <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815515">(Mar 14 2016 at 23:11)</a>:</h4>
<p>Great Article - thank you.  In step 6.1, you are making the 'token' call based off of the entry in the Conformance Statement correct?  Further, any secret information required by the identity provider will be additionally passed in 6.1, correct?</p>



<a name="153815522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815522">(Mar 15 2016 at 00:03)</a>:</h4>
<p>well, that's the connection between the Resource Server (RS) and the Authz Server (AS), and as they are both 'inside' the EHR the theory is that it shouldn't need to look the end point up. It represents the RS checking with the AzS that the token is valid. As josh said above there are other ways that that could be done without requiring the call - for example the access token could be signed, so the RS knows it hasn't been tampered with...</p>



<a name="153815523"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815523" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815523">(Mar 15 2016 at 00:04)</a>:</h4>
<p>And by 6.1 the identity has been resolved (step 3) so no other info should be needed at that point...</p>



<a name="153815527"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815527" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Girard <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815527">(Mar 15 2016 at 00:50)</a>:</h4>
<p>Agreed on the token endpoint lookup.  There have been a few identity servers that require extra information during the 'token' call - either a secret (Azure AD) or username/password (Forgerock).  This seems to be the only way to keep the extra information out of SPA apps and still use an Auth Code flow.  Have you run into a scenario where extra information is required during the token call?</p>



<a name="153815533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815533">(Mar 15 2016 at 01:06)</a>:</h4>
<p>Would that occur in step 3 of the flow? This was intended to be a simple EHR launch where the identity was known at the time of launch. The scenario sounds more like the standalone launch...</p>



<a name="153815661"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815661" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Peter Girard <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815661">(Mar 15 2016 at 13:49)</a>:</h4>
<p>So, as we understand it, the 'authorize' call happens in step 3, but for these products, do not need extra credentials.  That is, it follows exactly the way your flow shows it.  But when implementing confidential clients, Azure requires an extra parameter (client_secret - documented <a href="https://msdn.microsoft.com/en-us/library/azure/dn645542.aspx" target="_blank" title="https://msdn.microsoft.com/en-us/library/azure/dn645542.aspx">https://msdn.microsoft.com/en-us/library/azure/dn645542.aspx</a>).  In an SPA implementation, it makes no sense to store this client secret in the browser app.  So, we have come to the same sequence you have documented, just with the extra information included in the 'token' call.</p>



<a name="153815663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815663">(Mar 15 2016 at 14:37)</a>:</h4>
<p><span class="user-mention" data-user-id="197395">@Peter Girard</span> Whether or not a client secret is required is in scope of OAuth2. Using the code grant flow, the secret must be supplied during the code exchange request <strong>if</strong> one was supplied. You'd usually only supply one to confidential clients, but OAuth2 has been implemented rather liberally in this regard.</p>



<a name="153815664"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815664" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815664">(Mar 15 2016 at 14:38)</a>:</h4>
<p>One could use dynamic client registration to obtain client key/secret for non-confidential clients, like native apps, so you don't have to embed client key/secret into binaries.</p>



<a name="153815683"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815683" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815683">(Mar 15 2016 at 17:23)</a>:</h4>
<p>yes, and dynamic client registration is presently not part of smart. And it sounds a ittle scary</p>



<a name="153815688"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815688" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815688">(Mar 15 2016 at 17:49)</a>:</h4>
<p>it is scary... but so too is fixed passwords in apps...  :-)   security is hard.</p>



<a name="153815709"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815709" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815709">(Mar 15 2016 at 19:50)</a>:</h4>
<p>It surely is hard! One of the reasons I think SMART will succeed is that is provides 'recipes' for the common use cases for ordinary developers (like me) to follow in common scenarios...</p>



<a name="153815710"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815710" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815710">(Mar 15 2016 at 19:52)</a>:</h4>
<p><span class="user-mention" data-user-id="197395">@Peter Girard</span> - many thanks for your comments - I've updated the post to make the type of flow explicit...   (I actually do this stuff so I have something to refer to when I've forgotten the details later!)</p>



<a name="153815747"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815747" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815747">(Mar 16 2016 at 01:16)</a>:</h4>
<p>Next installment: <a href="http://fhirblog.com/2016/03/16/smart-security/" target="_blank" title="http://fhirblog.com/2016/03/16/smart-security/">http://fhirblog.com/2016/03/16/smart-security/</a></p>



<a name="153815753"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815753" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815753">(Mar 16 2016 at 02:18)</a>:</h4>
<p>just one more: <a href="http://fhirblog.com/2016/03/16/using-smart-to-talk-between-systems/" target="_blank" title="http://fhirblog.com/2016/03/16/using-smart-to-talk-between-systems/">http://fhirblog.com/2016/03/16/using-smart-to-talk-between-systems/</a></p>



<a name="153815772"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815772" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815772">(Mar 16 2016 at 08:19)</a>:</h4>
<p>Well, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span>, SMART at least _encourages_ using DynReg. Our Swift client automatically does dynamically register itself if a) no client id is given when initializing the client and b) the Conformance statement lists a registration endpoint.<br>
<a href="https://github.com/smart-on-fhir/Swift-SMART/wiki/Client#dynamic-client-registration" target="_blank" title="https://github.com/smart-on-fhir/Swift-SMART/wiki/Client#dynamic-client-registration">https://github.com/smart-on-fhir/Swift-SMART/wiki/Client#dynamic-client-registration</a></p>



<a name="153815773"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/authenticating/near/153815773" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/authenticating.html#153815773">(Mar 16 2016 at 08:23)</a>:</h4>
<p>Of course this means anybody can register an app. In C3-PRO we have a mechanism that uses Apple's App Store receipt during client registration, meaning the server can verify with Apple, on a back channel, who this client is.<br>
<a href="https://github.com/chb/c3-pro-ios-framework/tree/master/Sources/DataQueue#dynamic-client-registration" target="_blank" title="https://github.com/chb/c3-pro-ios-framework/tree/master/Sources/DataQueue#dynamic-client-registration">https://github.com/chb/c3-pro-ios-framework/tree/master/Sources/DataQueue#dynamic-client-registration</a><br>
This is also not bullet proof though since it's theoretically possible to download an app, extract its receipt and use in in a different app for registration.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
