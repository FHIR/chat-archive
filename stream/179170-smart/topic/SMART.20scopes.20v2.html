---
layout: page
title: "FHIR Chat  · SMART scopes v2 · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html">SMART scopes v2</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="167808521"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808521" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808521">(Jun 11 2019 at 00:30)</a>:</h4>
<p>During <a href="https://www.devdays.com/us/schedule/#event-272" target="_blank" title="https://www.devdays.com/us/schedule/#event-272">FHIR DevDays</a> in Redmond, we <a href="https://docs.google.com/presentation/d/1ICPyI-i363vPa43fV1e7BbiUySvFqi_zOfnLC7PIMVE/edit#slide=id.p1" target="_blank" title="https://docs.google.com/presentation/d/1ICPyI-i363vPa43fV1e7BbiUySvFqi_zOfnLC7PIMVE/edit#slide=id.p1">talked through</a> some of the features we need from SMART scopes that our current syntax doesn't satisfy. (Also see <a href="#narrow/stream/179170-smart/topic/SMART.20and.20Basic" title="#narrow/stream/179170-smart/topic/SMART.20and.20Basic">related conversation</a>).</p>



<a name="167808523"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808523" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808523">(Jun 11 2019 at 00:30)</a>:</h4>
<p>Next steps:</p>



<a name="167808525"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808525" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808525">(Jun 11 2019 at 00:30)</a>:</h4>
<p>1) As a research step, collect and share the different production, SMART authorization servers' user-facing description of scopes. How are production AS's describing SMART scopes to users now?</p>



<a name="167808529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808529">(Jun 11 2019 at 00:30)</a>:</h4>
<p>2) Simply adding in resource <code>category</code>s to our existing SMART syntax may quickly and simply alleviate a lot of the pain. Why not simply toss the resource category's name into the scope. e.g.</p>



<a name="167808530"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808530" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808530">(Jun 11 2019 at 00:30)</a>:</h4>
<p>* patient/Observation:lab.read</p>



<a name="167808538"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808538" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808538">(Jun 11 2019 at 00:30)</a>:</h4>
<p>* patient/Observation:activity.read</p>



<a name="167808539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808539">(Jun 11 2019 at 00:30)</a>:</h4>
<p>* patient/Condition:encounter-diagnosis.read</p>



<a name="167808542"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808542" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808542">(Jun 11 2019 at 00:30)</a>:</h4>
<p>3) Somewhat related, <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> mentioned specifying a method for an <code>OperationOutcome</code> to specify the scope that would be required to resolve an access denied error to enable a progressive authorization approach. (<em>a la</em> enabling a <a href="https://restfulapi.net/hateoas/" target="_blank" title="https://restfulapi.net/hateoas/">HATEOAS</a> approach).</p>



<a name="167808543"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167808543" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167808543">(Jun 11 2019 at 00:31)</a>:</h4>
<p>4) While SMART already describes a method for authorizing non-FHIR scopes by <a href="http://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#extensions" target="_blank" title="http://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#extensions">prefixing the scope with __ (two underscores)</a>, it doesn't explicitly describe how to describe access to FHIR operations.</p>



<a name="167871526"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/167871526" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#167871526">(Jun 11 2019 at 17:30)</a>:</h4>
<p>5) Is there something we want to do with confidentiality classification (<a href="http://build.fhir.org/v3/ConfidentialityClassification/vs.html" target="_blank" title="http://build.fhir.org/v3/ConfidentialityClassification/vs.html">http://build.fhir.org/v3/ConfidentialityClassification/vs.html</a>)? E.g. set a baseline confidentiality across resources ("normal"?), and if an app wants to access higher levels (e.g. "restricted" or "very restricted") there is an additional scope that needs to be requested? It would apply across resources IMO.</p>



<a name="168172473"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168172473" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168172473">(Jun 14 2019 at 21:18)</a>:</h4>
<p><a href="http://www.healthintersections.com.au/?p=2967" target="_blank" title="http://www.healthintersections.com.au/?p=2967">http://www.healthintersections.com.au/?p=2967</a></p>



<a name="168285120"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168285120" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168285120">(Jun 17 2019 at 06:02)</a>:</h4>
<p>this feels like a low impact addition to an operation outcome to me:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;OperationOutcome&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;break-the-glass&quot;</span><span class="p">,</span>
  <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;generated&quot;</span><span class="p">,</span>
    <span class="nt">&quot;div&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;This operation not authorized by the user. Approve &#39;Updated Medications&#39; during the Login process to OK this operation&lt;/div&gt;&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;issue&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;severity&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
      <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;forbidden&quot;</span><span class="p">,</span>
      <span class="nt">&quot;extension&quot;</span> <span class="p">:</span> <span class="p">[{</span>
        <span class="nt">&quot;url&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-required-scope&quot;</span><span class="p">,</span>
        <span class="nt">&quot;valueCode&quot;</span> <span class="p">:</span> <span class="s2">&quot;MedicationAdministration/write&quot;</span>
      <span class="p">}]</span>
      <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;The user did not authorise this operation&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>



<a name="168285208"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168285208" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168285208">(Jun 17 2019 at 06:05)</a>:</h4>
<p>I have added an extension <code>http://hl7.org/fhir/StructureDefinition/operationoutcome-required-scope</code> (which we would define formally in R5). The presence of this extension would indicate that the operation would be successful if the user approved the stated scope. The client application might want to initiate an OAuth sequence to ask the user to approve that scope (or ask  the user if they want to). </p>
<p>The extension should only be used when the server has no other reason to deny this kind of operation, such that the user might reasonably expect it to succeed if they authorised the scope (though it may still fail for business rule reasons etc)</p>



<a name="168285261"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168285261" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168285261">(Jun 17 2019 at 06:06)</a>:</h4>
<p>an alternative approach is to define the extension as <code>http://hl7.org/fhir/smart-app-launch/StructureDefinition/required-scope</code> - e.g. get smart to define it rather than putting it in R5</p>



<a name="168285859"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168285859" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jim Steel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168285859">(Jun 17 2019 at 06:23)</a>:</h4>
<p>"would be successful" might be too strong. Presumably the operation could potentially fail for other reasons, given sufficient authorisation</p>



<a name="168286293"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168286293" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168286293">(Jun 17 2019 at 06:34)</a>:</h4>
<p>yes I guess. But you wouldn't send this back if the user didn't have the authority to run the operation even if the scope was authorised</p>



<a name="168305385"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168305385" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168305385">(Jun 17 2019 at 12:28)</a>:</h4>
<p>that last statement is important. So you know that the app has overall the authority, just not with the scope it asked for. Not clear how you know that, but by making sure this is true you will not be exposing (leaking) security policy.</p>



<a name="168446655"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168446655" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168446655">(Jun 18 2019 at 19:20)</a>:</h4>
<blockquote>
<p>So you know that the app has overall the authority, just not with the scope it asked for</p>
</blockquote>
<p>There's only a few definitions of an app's authority, and they're all lists of OAuth2 scopes:</p>



<a name="168446663"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168446663" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168446663">(Jun 18 2019 at 19:20)</a>:</h4>
<p>1) the scopes the app specified during registration. <br>
2) the scopes the app asked for during authorization.<br>
3) the scopes granted by the user/authorization server.</p>



<a name="168446665"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168446665" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168446665">(Jun 18 2019 at 19:20)</a>:</h4>
<p>In the above <code>OperationOutcome</code> example did the app register for <code>user/MedicationAdministration.write</code>,  but either did not ask for it during authorization or it was denied by the user/AS ?</p>



<a name="168446670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168446670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168446670">(Jun 18 2019 at 19:20)</a>:</h4>
<p>In other words, should a FHIR server only return this <code>break-the-glass</code> OO when an app attempts to perform an unauthorized operation for which it has a registered scope?</p>



<a name="168447748"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168447748" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168447748">(Jun 18 2019 at 19:34)</a>:</h4>
<p>hmm I think I meant that the user has the authority, just haven't offered that to the app.</p>



<a name="168447783"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168447783" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168447783">(Jun 18 2019 at 19:34)</a>:</h4>
<p>I think it would imply that the app is registered for that, but that either it didn't ask, or the user didn't approve.</p>



<a name="168447818"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168447818" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168447818">(Jun 18 2019 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-id="191356">@Jenni Syed</span> specifically suggested this, so that apps don't have to ask for eveything from the user up front</p>



<a name="168448718"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168448718" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168448718">(Jun 18 2019 at 19:45)</a>:</h4>
<p>Correct, this was <em>not</em> for break the glass. The workflow for break the glass would have to be more complicated/we would need to work that out specifically</p>



<a name="168448832"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168448832" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168448832">(Jun 18 2019 at 19:46)</a>:</h4>
<p>It implies that the server stops enforcing some of the user's privs</p>



<a name="168448848"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168448848" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168448848">(Jun 18 2019 at 19:47)</a>:</h4>
<p>And typically, that massively stepped up auditing and security logs happen</p>



<a name="168448878"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168448878" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168448878">(Jun 18 2019 at 19:47)</a>:</h4>
<p>break the glass is likely its own scope(s) separate from the existing scopes</p>



<a name="168449049"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168449049" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168449049">(Jun 18 2019 at 19:49)</a>:</h4>
<p>This was to get closer to 1) giving apps better errors when they either can't check scopes actually granted or don't check them and then try to access something they "assume" they have access to</p>



<a name="168449134"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168449134" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168449134">(Jun 18 2019 at 19:50)</a>:</h4>
<p>and 2) allow apps to do auth flows closer to what iOS and android do: which is ask for scopes as functionality is used within an app/slowly expand auth to only what is needed</p>



<a name="168468328"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168468328" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168468328">(Jun 19 2019 at 00:40)</a>:</h4>
<p>Do you think that if the break-glass scope is used the authentication should be re-challenged?<br>
Such as when you access confidential parts of your user profile?</p>



<a name="168475088"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168475088" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168475088">(Jun 19 2019 at 03:49)</a>:</h4>
<p>Has anyone seen a good UX on for progressive permissions in OAuth? (My impression has been that progressive permissions work well on mobile platforms because the whole interaction happens in a single pop-up with one tap -- approve or deny a single incremental request, like "access contacts?". I'd be interested in how this translates to OAuth, with a browser redirect, potentially a login, a decision, and a redirect back)</p>



<a name="168475646"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168475646" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168475646">(Jun 19 2019 at 04:07)</a>:</h4>
<p>should not need a login, if it's still valid? Maybe we want a launch parameter to indicate incremental authorizing? Maybe I'll prototype it?</p>



<a name="168509425"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168509425" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168509425">(Jun 19 2019 at 14:04)</a>:</h4>
<p><span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span>  we did some really really high level discussions around what break the glass might look like over a year ago, and we did expect that it would go back through auth. We didn't discuss if it would require them to re-auth, but it's possible a system needs to capture additional info when that happens (like a reason).</p>



<a name="168509505"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168509505" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168509505">(Jun 19 2019 at 14:05)</a>:</h4>
<p>It was just a random side discussion with <span class="user-mention" data-user-id="191936">@Michael Donnelly</span> and I and a few others though</p>



<a name="168518247"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168518247" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168518247">(Jun 19 2019 at 15:42)</a>:</h4>
<p><span class="user-mention" data-user-id="191356">@Jenni Syed</span> I would love to hear about this... We do have a break-glass mechanism in the FHIR Spec today, as inserted by Grahame long time ago.  Im not all that happy with this, but haven't been involved in any alternative -- <a href="http://build.fhir.org/security-labels.html#break-the-glass" target="_blank" title="http://build.fhir.org/security-labels.html#break-the-glass">http://build.fhir.org/security-labels.html#break-the-glass</a><br>
YES, break-glass typically (in older systems) does require at least a "are you sure" prompt to the user, with usually a text box asking for "why?".</p>



<a name="168518374"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168518374" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168518374">(Jun 19 2019 at 15:44)</a>:</h4>
<p>is this OperationOutcome extension intended only for break-glass type workflows? I understood it was also for workflows such as point-of-care-consent capture.</p>



<a name="168521353"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168521353" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168521353">(Jun 19 2019 at 16:21)</a>:</h4>
<p>No, the operation outcome isn't intended at all for break the glass  right now</p>



<a name="168549788"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/168549788" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#168549788">(Jun 19 2019 at 22:05)</a>:</h4>
<p>I don't think we closed the break-the-glass discussion. For me, an important part is automatically switching out of break-the-glass mode (since users won't bother...). So I don't think of it as a new session - just a special function within the app. But an external app... is there any use case for an external app to have break-the-glass?</p>



<a name="169049936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/169049936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#169049936">(Jun 26 2019 at 17:05)</a>:</h4>
<p>This may be a niche use case, but a constrained /Patient.write scope, limited to adding or modifying a specific Patient.identifier, could be useful.  A specialized Patient operation for this purpose might also make sense.  May be worth discussing further if there's wider interest in this type of thing.</p>



<a name="175909378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175909378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175909378">(Sep 17 2019 at 14:07)</a>:</h4>
<p>What's the next step for this?</p>



<a name="175910340"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175910340" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175910340">(Sep 17 2019 at 14:16)</a>:</h4>
<p>HL7-wise, I think this fits under our <a href="https://www.hl7.org/special/Committees/projman/searchableProjectIndex.cfm?action=edit&amp;ProjectNumber=1341" target="_blank" title="https://www.hl7.org/special/Committees/projman/searchableProjectIndex.cfm?action=edit&amp;ProjectNumber=1341">existing project scope</a>.</p>



<a name="175910555"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175910555" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175910555">(Sep 17 2019 at 14:18)</a>:</h4>
<p>So we could get a proposal on the table for an updated IG.</p>



<a name="175910567"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175910567" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175910567">(Sep 17 2019 at 14:18)</a>:</h4>
<p><span class="user-mention" data-user-id="191936">@Michael Donnelly</span> re: scopes in particular, currently Epic doesn't use SMART scopes over the wire (e.g., ignores scopes requested by a client, and always enforces Epic-specified permissions that the developer requested at app registration time). Is this something that would be likely to change if we created "scopes v2"?</p>



<a name="175935268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175935268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175935268">(Sep 17 2019 at 18:32)</a>:</h4>
<p>At this point, we plan to continue supporting scopes per <em>client</em> rather than per <em>token</em>.  We would be likely to enhance what we have now to return  more granular SMART scopes (in the JSON response to the /token endpoint) when they become available.</p>



<a name="175935467"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175935467" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175935467">(Sep 17 2019 at 18:34)</a>:</h4>
<p>If UDAP trusted dynamic client registration comes to fruition, we'd need more granular scopes to assign the proper rights to dynamically created clients.</p>



<a name="175935615"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175935615" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175935615">(Sep 17 2019 at 18:36)</a>:</h4>
<p>(E.g. we great access discretely to Observation (Lab Results) and Observations (Vitals) rather than broadly to Observations.)</p>



<a name="175935856"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175935856" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175935856">(Sep 17 2019 at 18:38)</a>:</h4>
<blockquote>
<p>we plan to continue supporting scopes per client rather than per token. </p>
</blockquote>
<p>But even per-client today, SMART scopes aren't used directly in Epic's registration process (i.e., SMART scopes don't show up by name in the app registration process, and the options that <em>do</em> appear are at slightly different granularity -- like search-as-distinct-from-read). This doesn't strike me as a huge problem, but it does make me wonder about the value of standardizing scopes, in a world where they're not actually being <em>used</em>.</p>



<a name="175936025"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175936025" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175936025">(Sep 17 2019 at 18:40)</a>:</h4>
<p>All that said, I definitely want to work on improved scopes; I'm just trying to get a handle on whether they'll be used directly vs  serving as "hints".</p>



<a name="175936077"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175936077" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175936077">(Sep 17 2019 at 18:40)</a>:</h4>
<p>others are using them.</p>



<a name="175936085"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175936085" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175936085">(Sep 17 2019 at 18:41)</a>:</h4>
<p>(In UDAP trusted dyn-reg, Epic could <em>still</em> ignore on-the-wire scopes and simply pin the newly-registered app's permissions to the set of permissions provided during the up-front registration step.)</p>



<a name="175936130"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175936130" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175936130">(Sep 17 2019 at 18:41)</a>:</h4>
<p>Yes, I agree others are using them; I'm just trying to understand the interest expressed here from the Epic team, since Michael and Isaac brought this up :)</p>



<a name="175937183"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175937183" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175937183">(Sep 17 2019 at 18:52)</a>:</h4>
<blockquote>
<p>(In UDAP trusted dyn-reg, Epic could <em>still</em> ignore on-the-wire scopes and simply pin the newly-registered app's permissions to the set of permissions provided during the up-front registration step.)</p>
</blockquote>
<p>In the use case we discussed on Sunday, there'd be no pre-existing parent client in the EHR.  The client would provide a software statement signed by a cert issued by a trusted certifying body (e.g. healtheway), and we'd trust it (and issue a client for our system) because we'd trust that certifier.</p>



<a name="175937401"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175937401" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175937401">(Sep 17 2019 at 18:54)</a>:</h4>
<blockquote>
<p>But even per-client today, SMART scopes aren't used directly in Epic's registration process (i.e., SMART scopes don't show up by name in the app registration process, and the options that <em>do</em> appear are at slightly different granularity -- like search-as-distinct-from-read). This doesn't strike me as a huge problem, but it does make me wonder about the value of standardizing scopes, in a world where they're not actually being <em>used</em>.</p>
</blockquote>
<p>True!  But if we (the community) can get SMART scopes to the level of granularity we (Epic) believe is necessary, we (Epic) will be able to use them in our client creation process.</p>



<a name="175941672"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175941672" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175941672">(Sep 17 2019 at 19:42)</a>:</h4>
<blockquote>
<p>The client would provide a software statement signed by a cert issued by a trusted certifying body</p>
</blockquote>
<p>to be clear, what I mean is that this software statement could bake in a list of "scopes" or permissions of some kind, just as it bakes in a redirect_uri, etc.</p>



<a name="175941775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175941775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175941775">(Sep 17 2019 at 19:44)</a>:</h4>
<p>Indeed, it <a href="http://www.udap.org/udap-dynamic-client-registration.html" target="_blank" title="http://www.udap.org/udap-dynamic-client-registration.html">does</a> as a claim in the JWT: </p>
<blockquote>
<p>scope: string, space delimited list of requested scopes (optional))</p>
</blockquote>



<a name="175942233"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175942233" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175942233">(Sep 17 2019 at 19:50)</a>:</h4>
<blockquote>
<blockquote>
<p>The client would provide a software statement signed by a cert issued by a trusted certifying body</p>
</blockquote>
<p>to be clear, what I mean is that this software statement could bake in a list of "scopes" or permissions of some kind, just as it bakes in a redirect_uri, etc.</p>
</blockquote>
<p>That's what I meant too.  But I'm saying that, in that scenario, we wouldn't have the software statement until the moment the client requests to create a dynamic client.</p>



<a name="175942389"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175942389" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175942389">(Sep 17 2019 at 19:52)</a>:</h4>
<p>Ah, I found the miscommunication.  You said "the set of permissions provided during the up-front registration step," and I was thinking you meant  up-front client creation with Epic.  If you're talking about registration with a third party certifying body, we're on the same page.</p>



<a name="175944593"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20scopes%20v2/near/175944593" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20scopes.20v2.html#175944593">(Sep 17 2019 at 20:18)</a>:</h4>
<p>Indeed :) I was talking about these both equivalently</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
