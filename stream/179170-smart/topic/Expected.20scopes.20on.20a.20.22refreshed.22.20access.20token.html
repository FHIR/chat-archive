---
layout: page
title: "FHIR Chat  · Expected scopes on a &quot;refreshed&quot; access token · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html">Expected scopes on a &quot;refreshed&quot; access token</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="274619119"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274619119" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274619119">(Mar 08 2022 at 22:49)</a>:</h4>
<p>In the section about <a href="http://www.hl7.org/fhir/smart-app-launch/app-launch.html#response-7">refresh access tokens</a>, the spec has this blurb in the Response sub-section:</p>
<div class="codehilite"><pre><span></span><code>scope - Scope of access authorized. Note that this will be the same as the scope of the original access token,
and it can be different from the scopes requested by the app.
</code></pre></div>
<p>Of specific interest is the bit about the scope being the same as the original access token.  For the FHIR resource scopes, there isn't anything unexpected.  My question is about openid and fhirUser scopes.  Was the intent that the scope of a refresh access token include scopes like openid and fhirUser?  And if the scopes are provided, then presumably the associated claims should be too.   id_token is explicitly mentioned in the response object for the initial access token, but is omitted in the object for the refresh access token.  Was the intentional or not?  </p>
<p>Related question:  do we think sending an id_token in the refresh access token response object is useful?  Would that be interpreted as re-asserting user identity?  Since there isn't user interaction, a re-assertion of identity is really more of an inference than an assertion.</p>



<a name="274619582"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274619582" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274619582">(Mar 08 2022 at 22:54)</a>:</h4>
<blockquote>
<p>My question is about openid and fhirUser scopes.</p>
</blockquote>
<p>I think the intent was your access to FHIR data should be the same; the authentication context wouldn't necessarily be.</p>



<a name="274619591"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274619591" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274619591">(Mar 08 2022 at 22:54)</a>:</h4>
<p>(We don't have conformance language around this, FWIW ;-))</p>



<a name="274619649"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274619649" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274619649">(Mar 08 2022 at 22:54)</a>:</h4>
<blockquote>
<p>do we think sending an id_token in the refresh access token response object is useful? </p>
</blockquote>
<p>No, if you haven't re-authenticated the patient (and there's no place in the refresh token workflow to do that) it doesn't even make sense to me at first glance. Surely the OIDC spec has something to say about this...</p>



<a name="274619701"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274619701" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274619701">(Mar 08 2022 at 22:55)</a>:</h4>
<p><a href="https://openid.net/specs/openid-connect-core-1_0.html#RefreshTokenResponse">https://openid.net/specs/openid-connect-core-1_0.html#RefreshTokenResponse</a></p>



<a name="274619711"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274619711" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274619711">(Mar 08 2022 at 22:55)</a>:</h4>
<blockquote>
<p>Upon successful validation of the Refresh Token, the response body is the Token Response of Section 3.1.3.3 except that it might not contain an id_token.</p>
</blockquote>



<a name="274619798"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274619798" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274619798">(Mar 08 2022 at 22:56)</a>:</h4>
<p>So, from the OIDC spec perspective, including an <code>id_token</code> in a refresh token response is allowed and could be useful, but it's also OK to omit.</p>



<a name="274898234"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274898234" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274898234">(Mar 10 2022 at 21:36)</a>:</h4>
<p>Does the SMART App Launch Guide (or OAuth 2.0) provide any guarantees to the client about the scope of the refreshed access token, in relation to the original access token?  The Inferno team had interpreted the line "..this will be the same as the scope of the original access token' to literally mean that <code>scope</code> parameter provided on the token refresh response will include the same scopes as were provided along with the original access token.</p>



<a name="274899176"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274899176" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274899176">(Mar 10 2022 at 21:44)</a>:</h4>
<p>You may have already answered that question by stating that the authorization context may not necessarily be the same, but I just want to be clear that you are also referring to the content of the <code>scope</code> parameter and not just the inclusion of the <code>id_token</code> parameter.</p>



<a name="274916498"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Expected%20scopes%20on%20a%20%22refreshed%22%20access%20token/near/274916498" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Expected.20scopes.20on.20a.20.22refreshed.22.20access.20token.html#274916498">(Mar 11 2022 at 00:31)</a>:</h4>
<p>The <code>fhirUser</code> and <code>openid</code> scopes might well be excluded; but any <code>patient/</code> or <code>user/</code> scopes (FHIR data access scopes) from the original token scopes should be there</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
