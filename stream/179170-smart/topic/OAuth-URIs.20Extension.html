---
layout: page
title: "FHIR Chat  · OAuth-URIs Extension · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html">OAuth-URIs Extension</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="204019323"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/OAuth-URIs%20Extension/near/204019323" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reece Adamson <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html#204019323">(Jul 15 2020 at 22:10)</a>:</h4>
<h1>The Issue</h1>
<p>I have noticed that with a recent update of the FHIR Validator CapabilityStatements which list a <code>revoke</code> endpoint are now failing with the error:</p>
<div class="codehilite"><pre><span></span><code>FHIR Validation tool Version <span class="m">5</span>.0.12 <span class="o">(</span>Git# b770fb8a2c35<span class="o">)</span>. Built <span class="m">2020</span>-07-07T02:30:50.915Z <span class="o">(</span><span class="m">8</span> days old<span class="o">)</span>
...

Error @ CapabilityStatement.rest<span class="o">[</span><span class="m">0</span><span class="o">]</span>.security.extension<span class="o">[</span><span class="m">0</span><span class="o">]</span>.extension<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="nv">url</span><span class="o">=</span><span class="s1">&#39;revoke&#39;</span><span class="o">]</span> <span class="o">(</span>line <span class="m">36</span>, col16<span class="o">)</span> : Sub-extension url <span class="s2">&quot;revoke&quot;</span> is not defined by the Extension http://fhir-registry.smarthealthit.org/StructureDefinition/oauthshell
</code></pre></div>


<p>When I rolled back and tried with the <code>5.0.8</code> version I don't see this error or any other errors on <code>CapabilityStatement.rest[0].security.extension[0]</code>!  I deleted my local <code>~/.fhir</code> cache before each run to get a fresh slate.</p>
<hr>
<h1>Background</h1>
<p>The SMART Application Launch Framework Implementation Guide 1.0.0 shows <a href="http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example">this example</a> which includes <code>revoke</code> URLs:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;CapabilityStatement&quot;</span><span class="p">,</span>
<span class="err">...</span>
  <span class="nt">&quot;rest&quot;</span><span class="p">:</span> <span class="p">[{</span>
   <span class="err">...</span>
      <span class="nt">&quot;security&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hl7.org/fhir/restful-security-service&quot;</span><span class="p">,</span>
                <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;SMART-on-FHIR&quot;</span>
              <span class="p">}</span>
            <span class="p">],</span>
            <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;OAuth2 using SMART-on-FHIR profile (see http://docs.smarthealthit.org)&quot;</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris&quot;</span><span class="p">,</span>
            <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span><span class="p">,</span>
                <span class="nt">&quot;valueUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://my-server.org/token&quot;</span>
              <span class="p">},</span>
              <span class="p">{</span>
                <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;authorize&quot;</span><span class="p">,</span>
                <span class="nt">&quot;valueUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://my-server.org/authorize&quot;</span>
              <span class="p">},</span>
              <span class="p">{</span>
                <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;manage&quot;</span><span class="p">,</span>
                <span class="nt">&quot;valueUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://my-server.org/authorizations/manage&quot;</span>
              <span class="p">}</span>
              <span class="p">,</span>
              <span class="p">{</span>
                <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;introspect&quot;</span><span class="p">,</span>
                <span class="nt">&quot;valueUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://my-server.org/authorizations/introspect&quot;</span>
              <span class="p">},</span>
              <span class="p">{</span>
                <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;revoke&quot;</span><span class="p">,</span>
                <span class="nt">&quot;valueUri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://my-server.org/authorizations/revoke&quot;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
</code></pre></div>


<p><a href="http://www.hl7.org/fhir/smart-app-launch/StructureDefinition-oauth-uris.html">And the relevant extension that defines it (oauth-uris</a>.</p>
<p>After doing some poking around I noticed that the <a href="https://www.hl7.org/fhir/extension-oauth-uris.html">base FHIR Spec also has an extension with the same URL</a> (<a href="http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris">http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris</a>), but is missing the revoke and introspect subextensions.  I do realize the SMART spec indicates the extension is for STU3, but its a little confusing as to which one is correct seeing that they both share the same extension URL and folks are still using the IG for R4.</p>
<p>My guess is that the updated validator is using the base FHIR definition of the extension instead of the SMART version, but its still complete conjecture at this point.</p>
<hr>
<h1>Question</h1>
<ul>
<li>What is the right extension definition for: <a href="http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris">http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris</a><ul>
<li>is it <a href="https://www.hl7.org/fhir/extension-oauth-uris.html">https://www.hl7.org/fhir/extension-oauth-uris.html</a> or <a href="http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example">http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example</a></li>
</ul>
</li>
</ul>
<p>I'm not sure if there is an issue with the validator here, part of the spec, or I'm just overlooking something (which happens a lot!).  It seems like something is amiss here though...</p>
<p><em>Relevant Artifacts:</em></p>
<ul>
<li><a href="/user_uploads/10155/libIqXJ3EJUlauH-DNHHoYOl/CapabilityStatement-with-revoke.json"> Example CapabilityStatement-with-revoke.json for reproducing</a> </li>
<li><a href="https://github.com/hapifhir/org.hl7.fhir.core/releases/download/5.0.12/validator_cli.jar">5.0.12 Validator Jar</a></li>
<li><a href="https://github.com/hapifhir/org.hl7.fhir.core/releases/download/5.0.7/validator_cli.jar">5.0.8 Validator Jar</a></li>
</ul>
<p><em>References and Links:</em></p>
<ul>
<li><a href="http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example">SMART Extension Example</a></li>
<li><a href="http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example">SMART Extension Definition of OAuth URIs</a></li>
<li><a href="https://www.hl7.org/fhir/extension-oauth-uris.html">Base FHIR Extension Definition of OAuth URIs</a></li>
</ul>



<a name="204070884"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/OAuth-URIs%20Extension/near/204070884" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reece Adamson <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html#204070884">(Jul 16 2020 at 11:21)</a>:</h4>
<p>Testing again this morning the issue <em>seems</em> to be no longer occurring.  Not sure if this related to some other issues recently reported (<a href="#narrow/stream/179166-implementers/topic/Cardinalities.20differ.20between.20Simplifier.20and.20IG.20Publisher">here</a> and <a href="#narrow/stream/179252-IG-creation/topic/hl7.2Efhir.2Epubpack.20error">here</a>).</p>
<p>Still interested in clarification between the two extension definitions though if anyone has any insight.</p>



<a name="204210580"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/OAuth-URIs%20Extension/near/204210580" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html#204210580">(Jul 17 2020 at 14:14)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span></p>



<a name="204210756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/OAuth-URIs%20Extension/near/204210756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reece Adamson <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html#204210756">(Jul 17 2020 at 14:15)</a>:</h4>
<p>I had an incorrect link in my original post.  To clarify:</p>
<p>The two (different) extension definitions with the same URL are:</p>
<ul>
<li><a href="https://www.hl7.org/fhir/extension-oauth-uris.html">https://www.hl7.org/fhir/extension-oauth-uris.html</a></li>
<li><a href="http://www.hl7.org/fhir/smart-app-launch/StructureDefinition-oauth-uris.html">http://www.hl7.org/fhir/smart-app-launch/StructureDefinition-oauth-uris.html</a></li>
</ul>
<p>The base FHIR version does not define the <code>revoke</code> or <code>introspect</code> subextensions.</p>



<a name="204236569"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/OAuth-URIs%20Extension/near/204236569" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html#204236569">(Jul 17 2020 at 17:46)</a>:</h4>
<p>The extension definition <em>should</em> provide a way to convey <code>revoke</code> and <code>introspect</code>. So from this perspective, the SMART IG is correct. I'm not sure why these extensions are repeated in the core FHIR release (it's... obviously an opportunity for things to get out of sync. <span class="user-mention" data-user-id="191316">@Grahame Grieve</span> do you know how this linkage is established?)</p>



<a name="204236652"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/OAuth-URIs%20Extension/near/204236652" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html#204236652">(Jul 17 2020 at 17:47)</a>:</h4>
<p>(Also as a quick reminder, we're moving toward <a href="http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#metadata">http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#metadata</a> in general;  over time the plan is to deprecate the CapabilityStatement-based discovery of these endpoints.)</p>



<a name="204411760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/OAuth-URIs%20Extension/near/204411760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html#204411760">(Jul 20 2020 at 11:38)</a>:</h4>
<p>not sure</p>



<a name="204434871"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/OAuth-URIs%20Extension/near/204434871" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/OAuth-URIs.20Extension.html#204434871">(Jul 20 2020 at 15:13)</a>:</h4>
<p>OK -- for now we should be using the version from the SMART IT. (I submitted <a href="http://jira.hl7.org/browse/FHIR-28099">FHIR#28099</a> to address the out-of-sync content in the core spec.)</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
