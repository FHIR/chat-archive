---
layout: page
title: "FHIR Chat  · FHIR-32325 · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html">FHIR-32325</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="247259268"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247259268" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247259268">(Jul 26 2021 at 20:44)</a>:</h4>
<p>The <a href="http://jira.hl7.org/browse/FHIR-32325">FHIR-32325</a> says </p>
<p>Best practices for app developers include:</p>
<p>My understanding is that "app developer" means both server developer and client developer. Is that correct? It is a little bit confusing that "app" may mean "app in app store".<br>
<span class="user-mention" data-user-id="191315">@Josh Mandel</span> <span class="user-mention" data-user-id="191414">@Dan Gottlieb</span></p>



<a name="247372653"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247372653" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247372653">(Jul 27 2021 at 18:33)</a>:</h4>
<p>Hey Yunwei, I understand the term "app developer" to apply only to client developers, as in SMART app developer.</p>



<a name="247389860"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247389860" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247389860">(Jul 27 2021 at 20:55)</a>:</h4>
<p>Then I don't quite understand this resolution<br>
"Ensure that refresh tokens are never used more than once"<br>
How could a client ensure a refresh token are never used more than once? Shouldn't that be server's responsibility to ensure that?<br>
Think about this scenario:<br>
Client requests new token with a refresh token X. Server returns a new access token with the same refresh token X. Should client reject that?</p>



<a name="247397250"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247397250" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Carl Anderson <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247397250">(Jul 27 2021 at 21:57)</a>:</h4>
<p>Not saying this is a good practice, but couldn't the client refresh their access token normally, but then also try to refresh it again?</p>
<p>If the second attempt works, that's obviously not good.  Given that approach, maybe it's not advisable for clients to <em>always</em> try to refresh twice, but maybe it's ok to make the attempt once per session.</p>



<a name="247398492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247398492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247398492">(Jul 27 2021 at 22:07)</a>:</h4>
<p>I think it is relevant to both, but perhaps could be more explicit:</p>
<ul>
<li>Servers should only <em>allow</em> a refresh token to be used once<ul>
<li>be aware of when a refresh token has been used</li>
<li>reject subsequent requests with the same token</li>
</ul>
</li>
<li>Clients should <em>expect</em> that a refresh token will only be accepted once<ul>
<li>make sure to update your refresh token with the next one</li>
<li>gracefully fail if the refresh token has been invalidated (and perhaps warn the user?)</li>
</ul>
</li>
</ul>
<p>Note: I used 'should' out of conformance context - I think they would be clearer with a set of SHALLs, but these are best practices so...  <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="247408349"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247408349" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247408349">(Jul 28 2021 at 00:03)</a>:</h4>
<p><span class="user-mention" data-user-id="222054">@Gino Canessa</span> That is also my understanding but the current resolution makes client to take the sole responsibility of that. That makes me feel confused.</p>



<a name="247475796"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247475796" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247475796">(Jul 28 2021 at 15:40)</a>:</h4>
<p><span class="user-mention" data-user-id="191506">@Yunwei Wang</span>  Re-reading the ticket, these are additions to 'best practices for app developers', so it makes sense they are focused on client requirements.  There is a complementary ticket: <a href="http://jira.hl7.org/browse/FHIR-32324">FHIR#32324</a> which has the 'server developer' best practices.</p>
<p>That ticket includes the server direction on expiring refresh tokens.</p>



<a name="247487807"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247487807" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247487807">(Jul 28 2021 at 17:12)</a>:</h4>
<p>That backs to my original question that the refresh token is issued and processed by server. Client has to use what ever server provided. I cannot imagine what client can do otherwise when server decide to reuse refresh token.</p>



<a name="247489336"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247489336" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247489336">(Jul 28 2021 at 17:24)</a>:</h4>
<p>If the server returns the same token again, it is a poorly behaved server and the client does not have a different token to use.  However, that is quite different from trying to reuse a token from an earlier call, which is what the line says: a client should not try to reuse a token that it has already used (e.g., don't reuse a token).  Even in the case of a poorly behaved server, the client can act appropriately in its code (e.g., the token happens to have the same value, but it is a <em>different</em> token).</p>
<p>Especially given that there is no conformance language here, I am not clear on what the issue is.  If you think there could be additional clarification, I would suggest adding a comment to the ticket since it has been approved but not yet applied.</p>



<a name="247491262"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247491262" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247491262">(Jul 28 2021 at 17:38)</a>:</h4>
<p>Thanks, I added my comment to the ticket.</p>



<a name="247491717"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247491717" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yunwei Wang <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247491717">(Jul 28 2021 at 17:42)</a>:</h4>
<p>Can we pull this ticket out of approved? If there is too much trouble, I can create a new ticket after it is applied</p>



<a name="247492570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/FHIR-32325/near/247492570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/FHIR-32325.html#247492570">(Jul 28 2021 at 17:49)</a>:</h4>
<p>Re-opening a ticket has a process, this falls under FHIR-I (I believe it needs a vote to open which needs at least 2/3 approval, but not sure beyond that).  At this point, I would guess it will be simpler to open a new ticket <em>if</em> you are unhappy with how this one gets applied (I don't think opening one now would do much, since the text hasn't been updated).</p>
<p>With all of that said, point 2) in your comment is exactly what the best practice is trying to say.  A well-behaved client should expect that a token is single-use, check for a new refresh token, and then use it instead of trying to reuse an old one.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
