---
layout: page
title: "FHIR Chat  · SMART on FHIR EHR Launch flow · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html">SMART on FHIR EHR Launch flow</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="258621131"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/258621131" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kalyan Dasika <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#258621131">(Oct 21 2021 at 21:35)</a>:</h4>
<p>Hi All,</p>
<p>We are building a proof of concept, to launch a SMART app, from within our EHR. (EHR launch sequence).  We use Keycloak as the Authz server.   We are blocked on 2 aspects of this flow. </p>
<ol>
<li>
<p>At the point of launching the SMART app, user is authn'd and athuz'd and we have a patient in context in the EHR. We are seeding the SMART app with a launch parameter (a launch code that has knowledge of the EHR context) and the fhir resource server url. The expectation is that when tokens are being issued (by keycloak) we would see the patient_id as one of the properties in the json. We are seeing tokens issued. I was expecting to have access to that launch code at the point of setting claims or transforming the access token response but cannot find a way to do that. </p>
</li>
<li>
<p>I created a custom user attribute mapper  to transform the token response to include the patient_id (even hard coding is fine.. at this point) but I just cannot seem to see it in the output. I also tried with a custom OIDCProtocolMapper.. same results. </p>
</li>
</ol>
<p>I'm totally missing something at this point. Any inputs are highly appreciated.</p>



<a name="258621489"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/258621489" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#258621489">(Oct 21 2021 at 21:39)</a>:</h4>
<p>These sound like keycloak questions; I wonder if <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> might have insight</p>



<a name="258701378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/258701378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#258701378">(Oct 22 2021 at 12:01)</a>:</h4>
<p>Hi Kalyan, did you have a look at <a href="https://github.com/Alvearie/keycloak-extensions-for-fhir">https://github.com/Alvearie/keycloak-extensions-for-fhir</a> yet?</p>



<a name="258701443"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/258701443" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#258701443">(Oct 22 2021 at 12:01)</a>:</h4>
<p>I havn't done much with the EHR launch sequence, but maybe the work I did to support standalone app launch could be informative</p>



<a name="258735433"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/258735433" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kalyan Dasika <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#258735433">(Oct 22 2021 at 16:21)</a>:</h4>
<p><span class="user-mention" data-user-id="191676">@Lee Surprenant</span>  Thank you for that link. Yes it is very informative. With the help of your project and Niko's videos  I am able to make some progress on step 2.  I was able to use this call, </p>
<p>accessTokenResponse.setOtherClaims(mappingModel.getConfig().get("<a href="http://claim.name">claim.name</a>"), "SOME_PATIENT_ID2"); </p>
<p>in the overridden setClaim method, the one that uses has AccessTokenResponse and now the patient property shows in the token response payload as a top level property (not as a claim in the JWT token) as shown in the sequence diagrams here <a href="http://hl7.org/fhir/smart-app-launch/index.html">http://hl7.org/fhir/smart-app-launch/index.html</a>. I can make an additional call to get the patient in context from the EHR database (from the authz server) for the  EHR user associated with the keycloak session to get the actual patient id.  </p>
<p>But to get that EHR state look up, I would really like to make use of the launch parameter that initiates this EHR launch sequence. That is getting lost somewhere in the flow, and by the time it gets to token issue time, I don't have that anywhere. Any ideas on this front, on how other authz servers are keeping track of the launch parameter, would be greatly appreciated.</p>



<a name="259268033"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/259268033" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kalyan Dasika <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#259268033">(Oct 27 2021 at 16:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191676">Lee Surprenant</span> <a href="#narrow/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow/near/258701443">said</a>:</p>
<blockquote>
<p>I havn't done much with the EHR launch sequence, but maybe the work I did to support standalone app launch could be informative</p>
</blockquote>
<p>I have a question regarding the standalone launch project you have in git hub. </p>
<p>How did you get the patient ids for selection? </p>
<p>I see that there is a resourceId attribute set up for the user  but did not quite follow where in the flow do the patient ids get set prior to looking up the resource server for selection. I'm assuming that its space separated string of ids.</p>



<a name="259274870"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/259274870" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#259274870">(Oct 27 2021 at 17:23)</a>:</h4>
<p>Hi Kalyan.  Yes, the assumption is that this happens out-of-band somehow and we have that id.  Its possible to do otherwise, but obviously you need to start with SOMETHING that could get you to the resource id(s).</p>



<a name="259275154"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/259275154" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#259275154">(Oct 27 2021 at 17:25)</a>:</h4>
<blockquote>
<p>I'm assuming that its space separated string of ids.</p>
</blockquote>
<p>correct</p>



<a name="259299604"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/259299604" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kalyan Dasika <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#259299604">(Oct 27 2021 at 20:12)</a>:</h4>
<p><span class="user-mention" data-user-id="191676">@Lee Surprenant</span>  thank you</p>



<a name="260196097"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/260196097" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Kalyan Dasika <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#260196097">(Nov 03 2021 at 20:54)</a>:</h4>
<p><span class="user-mention" data-user-id="191676">@Lee Surprenant</span>  Thank you so much for sharing your work in the github project. It provided enough ideas for us to implement both the EHR launch and Standalone launch proof of concepts.</p>



<a name="264165223"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/264165223" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grey Faulkenberry <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#264165223">(Dec 08 2021 at 14:50)</a>:</h4>
<p>Could I follow up on this question? I'm having a little trouble understanding how to pull information from the context of a SMART on FHIR EHR launch. I can perform an external launch with authentication without issue, but in these cases, I have a patient ID or I search for it. However, my understanding is that with an EHR launch, this information is somehow passed through the context of the launch, and not something that must be known a priori. </p>
<p>I think <a href="http://www.hl7.org/fhir/smart-app-launch/example-app-launch-public.html#retrieve-access-token">this example</a> on the HL7 website is where I get stuck.  I can authenticate, including getting the access token, and then write to the server. But in the box "Issue POST to the token endpoint:" where does the patient ID come from?</p>



<a name="264165657"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/264165657" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#264165657">(Dec 08 2021 at 14:53)</a>:</h4>
<p>The EHR sends along an opaque parameter called <code>launch</code>   (i.e., as a query param) to the app when it opens the app's launch endpoint.  The app echoes  this parameter back when it redirects to the EHR's "authorize" endpoint. The EHR uses this value to tie the session together and based on this value it knows how to populate the patient and any other required context in the access token response (if access is indeed granted).</p>



<a name="264165866"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/264165866" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#264165866">(Dec 08 2021 at 14:54)</a>:</h4>
<p>The example all you pointed to is  showing  a standalone launch,  so it does not demonstrate this perimeter. <a href="http://www.hl7.org/fhir/smart-app-launch/app-launch.html#request-2">http://www.hl7.org/fhir/smart-app-launch/app-launch.html#request-2</a>  is the source of truth and includes an example.</p>



<a name="264184300"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/264184300" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grey Faulkenberry <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#264184300">(Dec 08 2021 at 16:52)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span> Haha! That's exactly what I needed. And then currently, the only 2 contexts that are generally used are launch/patient and launch/encounter? (with the understanding there may be more in the future)</p>



<a name="264209105"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/264209105" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#264209105">(Dec 08 2021 at 19:41)</a>:</h4>
<p>Yes, that's the right.</p>



<a name="265453361"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265453361" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Albrecht <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265453361">(Dec 19 2021 at 01:08)</a>:</h4>
<p>Hello, I'm a physician who makes apps as a hobby and I'm new to FHIR development.  I've been through the HL7 FHIR Intermediate course.  However, I'm not understanding something.  If I want to make a third-party app that allows patients access to their data, how can the patient setup a username and password to access their specific EHR data.  Can someone walk me through this?</p>



<a name="265453573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265453573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265453573">(Dec 19 2021 at 01:14)</a>:</h4>
<p>They set that up with a healthcare provider, using their portal (e.g., MyChart from Epic)</p>



<a name="265453590"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265453590" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265453590">(Dec 19 2021 at 01:15)</a>:</h4>
<p>As an app, you don't see these usernames or passwords ; the OAuth workflow keeps those away from you</p>



<a name="265453643"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265453643" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Albrecht <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265453643">(Dec 19 2021 at 01:16)</a>:</h4>
<p>So the patient would have to access any app that I create from their portal?  I really just want them to login from my app.</p>



<a name="265453660"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265453660" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265453660">(Dec 19 2021 at 01:17)</a>:</h4>
<p>It's a bad security prospect to force users to share their EHR password with anyone though -- you can see why this is the case?</p>



<a name="265453687"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265453687" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Albrecht <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265453687">(Dec 19 2021 at 01:19)</a>:</h4>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span>. I'm a newbie trying to understand how this would work.  The patient logs into their portal.  How then do they access the app?</p>



<a name="265453806"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265453806" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265453806">(Dec 19 2021 at 01:23)</a>:</h4>
<p><a href="https://youtu.be/vYZ2G8hx6DY">https://youtu.be/vYZ2G8hx6DY</a> at 11 min has a demo from my personal portal account</p>
<div class="youtube-video message_inline_image"><a data-id="vYZ2G8hx6DY" href="https://youtu.be/vYZ2G8hx6DY"><img src="https://uploads.zulipusercontent.net/e012304c95287d10f44bc510f1392ccddbee57ce/68747470733a2f2f692e7974696d672e636f6d2f76692f76595a32473868783644592f64656661756c742e6a7067"></a></div>



<a name="265454361"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265454361" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Albrecht <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265454361">(Dec 19 2021 at 01:38)</a>:</h4>
<p>Thank you!  I will watch the full video later.  I will be trying to figure this out for the Meditech EHR, which is what my hospital uses.</p>



<a name="265454422"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265454422" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265454422">(Dec 19 2021 at 01:40)</a>:</h4>
<p>Sure, the workflow with Meditech will be the same as with Epic, Cerner, etc</p>



<a name="265454494"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265454494" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Albrecht <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265454494">(Dec 19 2021 at 01:42)</a>:</h4>
<p>Did you have to contact EPIC to find the tools to set up this workflow?  I sent a request earlier today to get started with Meditech Greenfield.  I didn't see a way for developers to get started with Meditech otherwise.</p>



<a name="265454881"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265454881" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265454881">(Dec 19 2021 at 01:53)</a>:</h4>
<p>There shouldn't be a cost, but you'll need to register with the EHR as a developer to create a Patient facing app.</p>



<a name="265454929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/SMART%20on%20FHIR%20EHR%20Launch%20flow/near/265454929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Albrecht <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/SMART.20on.20FHIR.20EHR.20Launch.20flow.html#265454929">(Dec 19 2021 at 01:55)</a>:</h4>
<p>Thank you for clearing this up for me.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
