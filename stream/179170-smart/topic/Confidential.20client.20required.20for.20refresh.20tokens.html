---
layout: page
title: "FHIR Chat  · Confidential client required for refresh tokens · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html">Confidential client required for refresh tokens</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="217164520"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217164520" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217164520">(Nov 18 2020 at 17:00)</a>:</h4>
<p><span class="user-mention" data-user-id="193782">@Christopher Schaut</span> pointed out something that's got me worried.  <a href="http://hl7.org/fhir/smart-app-launch/#step-5-later-app-uses-a-refresh-token-to-obtain-a-new-access-token">Section 7.1.6 of SMART spec</a> says </p>
<blockquote>
<p>A server can decide which client types (public or confidential) are eligible for offline access and able to receive a refresh token.</p>
</blockquote>
<p>The <a href="https://www.healthit.gov/cures/sites/default/files/cures/2020-10/ONC_IFC_Extension_of_Applicability_and_Compliance_Dates.pdf">IFC</a> says (on page 48) </p>
<blockquote>
<p>we have specified that Health IT Modules’ authorization servers must issue a refresh token to native applications that are capable of securing a refresh token</p>
</blockquote>
<p><a href="http://hl7.org/fhir/smart-app-launch/#use-the-confidential-app--profile-if-your-app-is-able-to-protect-a-client_secret">Section 3.0.1 of the SMART spec </a> defines confidential and public apps based on whether they can secure a <strong>client secret</strong>.  But this IFC makes their definition on whether the application can secure a <strong>refresh token</strong>.</p>



<a name="217165196"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217165196" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217165196">(Nov 18 2020 at 17:04)</a>:</h4>
<p>public and confidential are actually defined by the OAuth 2 specification, not SMART</p>



<a name="217165236"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217165236" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217165236">(Nov 18 2020 at 17:05)</a>:</h4>
<p>the way an app "secures a refresh token" is indeed different than the OAuth 2 definition of public vs confidential</p>



<a name="217165469"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217165469" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217165469">(Nov 18 2020 at 17:06)</a>:</h4>
<p>eg: if an application secures the refresh token on the device itself, and the refresh token never leaves the device - it's as secure s it can be for a public app</p>



<a name="217165472"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217165472" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217165472">(Nov 18 2020 at 17:06)</a>:</h4>
<p>I don't think "securing a refresh token" is a well-defined concept, and I have been a bit frustrated to see this concept introduced in the interim final rule. I think we need to simplify the story rather than making it more complicated :-)</p>



<a name="217165539"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217165539" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217165539">(Nov 18 2020 at 17:06)</a>:</h4>
<p>indeed, this would be a moving target of threat models and options, OS, and app :)</p>



<a name="217166944"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217166944" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217166944">(Nov 18 2020 at 17:16)</a>:</h4>
<p>There's no way to "prove" an app in this ecosystem follows the guides by OAuth 2 - so this issue is just being made more out in the open by the language above. IE: I don't think all apps that had offline access were "confidential" (I know some were native)</p>



<a name="217170831"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217170831" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217170831">(Nov 18 2020 at 17:44)</a>:</h4>
<p>100% agreed</p>



<a name="217290255"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/217290255" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Schaut <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#217290255">(Nov 19 2020 at 16:03)</a>:</h4>
<p><a href="https://tools.ietf.org/html/rfc8252#section-8.6">RFC 8252 discusses client impersonation</a> </p>
<blockquote>
<p>...the authorization server SHOULD NOT process authorization requests automatically without user consent or interaction, except when the identity of the client can be assured.  This includes the case where the user has previously approved an authorization request for a given client id -- unless the identity of the client can be proven, the request SHOULD be processed as if no previous request had been approved.</p>
</blockquote>
<p>Does this mean that we should update the SMART on FHIR spec to either require the app be a confidential app to process a refresh token, or stipulate some other form of client identity verification besides being a confidential app?</p>
<p>The section does also say that claimed https schemes may serve as identity verification, but I don't think that's helpful to the native app developers that pushed for the change in the IFC.</p>



<a name="218306695"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/218306695" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Donnelly <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#218306695">(Nov 30 2020 at 16:05)</a>:</h4>
<p>Do we need to update the SMART spec? <span class="user-mention" data-user-id="191356">@Jenni Syed</span> <span class="user-mention" data-user-id="191315">@Josh Mandel</span></p>



<a name="218310572"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/218310572" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#218310572">(Nov 30 2020 at 16:33)</a>:</h4>
<p>The language you quoted above pertains to (auto-)approving authorization requests, not to exchanging an existing proof of authorization to obtain an access token. In other words, the quote above would be arguing against things like redirecting back to the app immediately from the server's "authorize" endpoint (without displaying an approval screen for the user). This consideration is distinct from what happens when you exchange an authorization code or a refresh token for an access token.</p>



<a name="218310863"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/218310863" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#218310863">(Nov 30 2020 at 16:35)</a>:</h4>
<p>(to state this in a slightly different way, OAuth considers an "authorization request" to be the thing that happens when you redirect to an authorization server's authorized endpoint -- it's distinct from the thing that happens when a client calls the token endpoint with existing proof of authorization.)</p>



<a name="218321968"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/218321968" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christopher Schaut <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#218321968">(Nov 30 2020 at 17:59)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="191315">@Josh Mandel</span>, I see what you're saying. <br>
Going back to the OAuth2 spec, <a href="https://tools.ietf.org/html/rfc6749#section-10.1">RFC 6749 section 10.1</a> says</p>
<blockquote>
<p>The authorization server must consider the security implications of interacting with unauthenticated clients and take measures to limit the potential exposure of other credentials (e.g., refresh tokens) issued to such clients.</p>
</blockquote>
<p><a href="https://tools.ietf.org/html/rfc6749#section-10.4">RFC 6749 section 10.4</a> says</p>
<blockquote>
<p>The authorization server MUST maintain the binding between a refresh token and the client to whom it was issued. <br>
...<br>
The authorization server MUST verify the binding between the refresh token and client identity whenever the client identity can be authenticated.  When client authentication is not possible, the authorization server SHOULD deploy other means to detect refresh token abuse.</p>
</blockquote>
<p>Considering the sensitivity of data we're handling, this seems to imply that within our SMART on FHIR spec we should satisfy this requirement. We should either require the client be confidential, or we should describe some alternative means, standard, or test that the authorization server can prove they can detect (and act on?) refresh token abuse. Of course, once there's refresh token abuse there is already a breach, so it begs the question of why we should permit a risk and require specific implementation of detection at all.</p>
<p>Do you think this should drive a change in the SMART spec?</p>



<a name="218330475"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/218330475" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#218330475">(Nov 30 2020 at 19:04)</a>:</h4>
<p>I'm not sure what change we could</p>



<a name="218330619"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/218330619" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#218330619">(Nov 30 2020 at 19:05)</a>:</h4>
<p>...add to improve this. My take is that pretending your app can keep a secret (when it can't) won't provide meaningful security improvements -- and forcing traffic through a centralized cloud endpoint just to have a "truly confidential" client misses the point, by spreading data across more places than it really needs to go.</p>



<a name="218330781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/218330781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#218330781">(Nov 30 2020 at 19:06)</a>:</h4>
<p>If an individual user wants to share their data with a public client, this seems like a perfectly fair and reasonable thing to do. There's a whole set of tradeoffs involved.</p>



<a name="218331116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Confidential%20client%20required%20for%20refresh%20tokens/near/218331116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Confidential.20client.20required.20for.20refresh.20tokens.html#218331116">(Nov 30 2020 at 19:09)</a>:</h4>
<p>In the long term I'd say: we could explore / experiment with approaches to dynamic client registration; if we like how it goes, we could augment SMART spec, or maybe this will land in UDAP.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
