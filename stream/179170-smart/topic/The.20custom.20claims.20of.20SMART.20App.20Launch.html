---
layout: page
title: "FHIR Chat  · The custom claims of SMART App Launch · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html">The custom claims of SMART App Launch</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="214039955"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214039955" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ingvar Sørlien <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214039955">(Oct 21 2020 at 11:59)</a>:</h4>
<p>I have a couple of question to the handling of the custom scopes of SMART App Lauch as defined in the standard:</p>
<ol>
<li>The <a href="http://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context/">SMART App Launch scopes and launch context</a> defines that the launch context should arrive with the access token, but from my understanding, it must be part OF the access token - the launch context, e.g. patient must be a custsom claim in the access token iteslf. This is at least how I have got it to work with different FHIR-servers. Is that understanding right? Or should it be both, in such way that the launch context must be provided in the token response, and also in the access token itself? </li>
</ol>
<p>If so:</p>
<ol start="2">
<li>The <a href="http://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context/">SMART App Launch scopes and launch context</a> defines the name of the scopes for the launch context as e.g. "patient", "encounter". If this should be part of the access token, the <a href="https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32#section-4.2">JWT specification is highly recommending</a> that claims should be either "registered claim names" or "Public claim names" registered in the <a href="https://www.iana.org/assignments/jwt/jwt.xhtml">JWT Public Claim Name registry</a>. Is there any plans for registering the "patient" and "encounter" as public clame names? </li>
</ol>
<p>My challenge is that the Identity provider we are currently working with are not supporting private claim names, since this is discouraged in the JWT Specification.</p>



<a name="214050910"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214050910" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214050910">(Oct 21 2020 at 13:42)</a>:</h4>
<p>1) The spec only states that the application gets it with the token response, as separate claims. It is not required to be part of the access_token, and in fact applications MUST treat the access token as an opaque string per OAuth (so they cannot retrieve the patient context from within the token). If a system (OAuth/Resource servers) decide to put the claim in the token so that a FHIR service can enforce something... it's free to do so, but token format/contract between the OAuth server and Resource server is left outside of the specifications and may change in a breaking way over time</p>



<a name="214051036"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214051036" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214051036">(Oct 21 2020 at 13:43)</a>:</h4>
<p>2) The spec is defining the names of the parameters that are returned as separate claims with the token response. Here is an example token response: <a href="http://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context/#launch-context-arrives-with-your-access_token">http://www.hl7.org/fhir/smart-app-launch/scopes-and-launch-context/#launch-context-arrives-with-your-access_token</a></p>



<a name="214051063"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214051063" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214051063">(Oct 21 2020 at 13:43)</a>:</h4>
<p>{<br>
  access_token: "secret-xyz",<br>
  patient: "123",<br>
  ...<br>
}</p>



<a name="214051195"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214051195" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214051195">(Oct 21 2020 at 13:44)</a>:</h4>
<p>Note that the access token is a separate field, encounter would be below patient in the response as a separate field as well if included (and I think the secret-... is intended to hint that the token is an opaque string not to be processed by applications)</p>



<a name="214085705"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214085705" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214085705">(Oct 21 2020 at 17:28)</a>:</h4>
<blockquote>
<p>it must be part OF the access token </p>
</blockquote>
<p>The confusion here is between "the access token response" (the JSON payload an app gets from calling <code>/token</code>) and "the access token" (a specific property of that JSON payload). In SMART, we make no restrictions on the access token itself (as a review, <span class="user-mention" data-user-id="256280">@Ingvar Sørlien</span> you may want to check out <a href="https://www.youtube.com/watch?v=X2lmbHAeOMg">video from 2 week ago</a>)</p>
<div class="youtube-video message_inline_image"><a data-id="X2lmbHAeOMg" href="https://www.youtube.com/watch?v=X2lmbHAeOMg"><img src="https://i.ytimg.com/vi/X2lmbHAeOMg/default.jpg"></a></div>



<a name="214145651"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214145651" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ingvar Sørlien <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214145651">(Oct 22 2020 at 05:41)</a>:</h4>
<p>Thank you so much for the clarifications <span class="user-mention" data-user-id="191356">@Jenni Syed</span> and <span class="user-mention" data-user-id="191315">@Josh Mandel</span>! So, the contents of the access token and the access control itself is not covered at all in the SMART Spec. That makes sense, but means that we actually have no standard defining interoperability between FHIR-servers and Authorization servers. I see why the implementers of FHIR-servers are supporting "patient" as custom claim in the access token to actually be able to use it for access control, even if this is not part of the SMART spec.</p>



<a name="214200522"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214200522" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214200522">(Oct 22 2020 at 15:07)</a>:</h4>
<blockquote>
<p>we actually have no standard defining interoperability between FHIR-servers and Authorization servers</p>
</blockquote>
<p>Token Introspection is the piece that helps here; we only briefly refer to it in the SMART 1.0 guide but will be providing more guidance in the 2.0 guide , and you can see the draft guidance at <a href="https://github.com/HL7/smart-app-launch/blob/master/fsh/ig-data/input/pages/token-introspection.md">https://github.com/HL7/smart-app-launch/blob/master/fsh/ig-data/input/pages/token-introspection.md</a></p>



<a name="214799512"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214799512" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214799512">(Oct 28 2020 at 06:20)</a>:</h4>
<p>I'm currently implementing this specific part, and kinda confused on where to put things...<br>
The context I'm looking to share is:<br>
Clinical - patient and optionally encounter<br>
User - practitioner, practitionerrole, organization</p>



<a name="214799594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214799594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214799594">(Oct 28 2020 at 06:23)</a>:</h4>
<p><a href="http://hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#scopes-for-requesting-identity-data">http://hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#scopes-for-requesting-identity-data</a><br>
I get where <code>patient</code> and <code>encounter</code> can go, that's pretty clear, and I assume can also be extended to include things like <code>episodeofcare</code> too.<br>
But the <code>fhirUser</code>looks like a custom claim in the id token that has the full url to the practitioner in it. But what about all the other parts?</p>



<a name="214799611"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214799611" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214799611">(Oct 28 2020 at 06:23)</a>:</h4>
<p>If I just added them all in as context variables, would that matter?</p>



<a name="214799685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214799685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214799685">(Oct 28 2020 at 06:24)</a>:</h4>
<p>would it make more sense in the idtoken to have each of these things as custom claims?</p>



<a name="214851977"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214851977" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214851977">(Oct 28 2020 at 15:24)</a>:</h4>
<p>So you are looking for a way to communicate the practitionerrole(s) and organization(s) of the authenticated user to the client, right?  Another option might be for the client to query <code>/PractitionerRole?practitioner=[practitioner_id]</code> based on the Practitioner provided in the fhirUser claim.  I do not know if this is a better option than the ones you provided though.</p>



<a name="214883684"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214883684" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214883684">(Oct 28 2020 at 19:04)</a>:</h4>
<p>Which wouldn't tell you which of the roles the practitioner is in the context of.</p>



<a name="214883975"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214883975" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214883975">(Oct 28 2020 at 19:07)</a>:</h4>
<p>unless the fhir user could be a practitionerrole reference too</p>



<a name="214885950"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214885950" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214885950">(Oct 28 2020 at 19:26)</a>:</h4>
<p>Like the same person being able to login under different roles? Nothing that is currently supported I am afraid (do many server even support such a thing?)</p>



<a name="214891671"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214891671" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214891671">(Oct 28 2020 at 20:13)</a>:</h4>
<p>3 of the systems that I work on, and some others from partners definitely do it (most of these were in primary care)</p>



<a name="214891961"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214891961" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214891961">(Oct 28 2020 at 20:15)</a>:</h4>
<p>Common with multiple sites, when they log into the site, the UI defaults to filter things down specific to that site - appointments/rates/templates etc</p>



<a name="214902751"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214902751" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214902751">(Oct 28 2020 at 21:57)</a>:</h4>
<p>Brian, we commonly extend the contextual information passed alongside the access_token, including with not only additional clinical information but also user information. </p>
<p>In my experience many application architectures have a centralized IAM system that consumes user identity assertions (like OIDC) and only then passes control to the "app". If you place this user content in the OIDC id_token JWT, it's more likely to get used for authnz, if alongside the access_token, for business logic (e.g. defaulting UI filtering).</p>



<a name="214922564"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/The%20custom%20claims%20of%20SMART%20App%20Launch/near/214922564" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/The.20custom.20claims.20of.20SMART.20App.20Launch.html#214922564">(Oct 29 2020 at 03:23)</a>:</h4>
<p>So where I have put it at the moment alongside the access_token and not inside the id_token is consistent with what you're suggesting then.<br>
However that would then not permit you to be able to tell them apart, if you had a smart app that worked on a selected practitioner eg for a performance review form...<br>
I'd kinda like to be able to split the difference between user context, and UI focus context (selected item).</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
