---
layout: page
title: "FHIR Chat  · Launch Sequence · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html">Launch Sequence</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="225306354"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225306354" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> B Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225306354">(Feb 05 2021 at 14:43)</a>:</h4>
<p>An EHR initiates a “launch sequence” by opening an instance pointing to the app’s registered launch URL and passing some context.</p>
<p>The parameters <strong>iss </strong>and <strong>launch</strong> are included. For the <strong>launch</strong> we need an opaque identifier, and any EHR context associated with it. This parameter must be communicated back to the EHR at authorization time by passing along a launch parameter (see example below).</p>
<p>So is the following “launch sequence” allowed: GET <a href="https://app/launch?iss=https://ehr/fhir&amp;launch=xyz123&amp;patient=abc&amp;task=123">https://app/launch?iss=https://ehr/fhir&amp;launch=xyz123&amp;patient=abc&amp;task=123</a> according SMART?</p>
<p>I'm passing extra info about patient=abc and task=123 EHR context</p>



<a name="225306903"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225306903" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225306903">(Feb 05 2021 at 14:47)</a>:</h4>
<p>This is <em>not correct</em>. Contextual data (and especially sensitive data like a patient ID) should not be passed to SMART apps via URL parameters. Instead, give the app an opaque <code>launch</code> parameter, and then <em>at the end of the authorization process</em> return the data you need as part of the access token response.</p>



<a name="225307045"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225307045" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225307045">(Feb 05 2021 at 14:48)</a>:</h4>
<p>Specifically for <code>patient</code>: this is a defined launch context parameter that we document for inclusion in the access token response. You can follow this pattern with <code>task</code> if you have a use case for task-passing.</p>



<a name="225313936"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225313936" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> B Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225313936">(Feb 05 2021 at 15:38)</a>:</h4>
<p>How does the *authorization process * get the EHR context from the host?</p>



<a name="225314178"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225314178" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225314178">(Feb 05 2021 at 15:40)</a>:</h4>
<p>That's an internal choice; you get one parameter (<code>launch</code>) to use to make the connection. One example would be: EHR writes context to a database, keyed by a random <code>launch</code> value; and authz server can read from that db.</p>



<a name="225314533"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225314533" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> B Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225314533">(Feb 05 2021 at 15:42)</a>:</h4>
<p>Ok. So the EHR and the authz server shares the EHR context and the authz server passes this info via the token response.....</p>



<a name="225320062"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225320062" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225320062">(Feb 05 2021 at 16:19)</a>:</h4>
<p>Yes, you've got it.</p>



<a name="225321929"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225321929" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> B Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225321929">(Feb 05 2021 at 16:33)</a>:</h4>
<p>It looks like if you post an launch artifact (like SAML). But you should get this artifact (first) from the authz server. The launched application delivers the launched artifact to the authz server and response with the access_token and other context.</p>
<p>Nice, but this is not a current SMART standard.........</p>



<a name="225322400"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225322400" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225322400">(Feb 05 2021 at 16:36)</a>:</h4>
<p>I'm not following. The SMART App Launch standard provides a way to communicate (arbitrary) launch context to an app, ensuring it only becomes available once authorization is complete.</p>



<a name="225322781"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225322781" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> B Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225322781">(Feb 05 2021 at 16:39)</a>:</h4>
<p>I get that part. But the first part, to use the launch parameter as an artificat or key to get launch content from the authz server.</p>



<a name="225323017"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/225323017" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> B Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#225323017">(Feb 05 2021 at 16:41)</a>:</h4>
<p>Or the communication between the host and the authz server about the launch parameter.</p>



<a name="242068993"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242068993" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bernard Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242068993">(Jun 09 2021 at 13:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191315">Josh Mandel</span> <a href="#narrow/stream/179170-smart/topic/Launch.20Sequence/near/225314178">said</a>:</p>
<blockquote>
<p>That's an internal choice; you get one parameter (<code>launch</code>) to use to make the connection. One example would be: EHR writes context to a database, keyed by a random <code>launch</code> value; and authz server can read from that db.</p>
</blockquote>
<p><span class="user-mention" data-user-id="191315">@Josh Mandel</span>  how do you passes the launch context endpoint or the db entry to the authz server. This must be done befor we start the launch? Do we have an launch context endpoint extension for the CapabilityStatement?</p>



<a name="242070209"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242070209" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242070209">(Jun 09 2021 at 14:03)</a>:</h4>
<p>There is no such thing as a "launch context endpoint". Apps supporting the EHR launch sequence have a <em>launch endpoint</em>;</p>



<a name="242070292"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242070292" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242070292">(Jun 09 2021 at 14:04)</a>:</h4>
<p>When launching such an app, the EHR redirects to that endpoint and includes a URL parameter called <code>launch</code>.</p>



<a name="242085031"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242085031" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bernard Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242085031">(Jun 09 2021 at 15:35)</a>:</h4>
<p>Ok. Launch context endpoint is the wrong definition for getting the launch context. But how does the  authz server get the endpoint (or entry) of the launch context?</p>



<a name="242087760"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242087760" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242087760">(Jun 09 2021 at 15:52)</a>:</h4>
<p>Non-programmatically. Someone maintain the list of apps the EHR 'knows' with the corresponding launch end point for each</p>



<a name="242089003"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242089003" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242089003">(Jun 09 2021 at 16:00)</a>:</h4>
<p>And note this is the same as for "how does any app register with the EHR".</p>



<a name="242178060"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242178060" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bernard Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242178060">(Jun 10 2021 at 09:08)</a>:</h4>
<p>Hello, I understand the registered launch endpoint. </p>
<p>So <br>
1) I prepare a "launch context" (e.g prepare a FHIR Task for an application) and a launch handle, before I launch the application<br>
2) I launch the application, passes the lauch parameter (or handle) to that application together with the iss parameter.<br>
3) The started application passes the launch handle to the authorization server, in or with the scope of the auth request<br>
4) somehow the authorization server needs to know where the location is (or endpoint) of this launch context. How does the authorization server knows where to find this luanch context?</p>
<p>Has somebody some example how this work with OAuth2/OpenID Connect?</p>



<a name="242196273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242196273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242196273">(Jun 10 2021 at 12:16)</a>:</h4>
<blockquote>
<p>How does the authorization server knows where to find this luanch context</p>
</blockquote>
<p>Up to the implementation. For example: the EHR saves the launch context data in a database, the launch context is the database id of this data, the authorization server retrieves the data from that database (or instead of 'database' it can be a shared service etc)</p>



<a name="242238981"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242238981" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242238981">(Jun 10 2021 at 17:07)</a>:</h4>
<p>Functionally speaking, the important thing is that the launch context needs to be tamper-proof. In other words, an outside party should not be able to tweak/change the <code>launch</code> parameter to manipulate the context. The EHR can prevent this by creating a one-time-use database id, or a signed assertion, etc.</p>



<a name="242310320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242310320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bernard Stibbe <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242310320">(Jun 11 2021 at 07:37)</a>:</h4>
<p><span class="user-mention" data-user-id="191912">@Michele Mottini</span>  Thanks for the explanation, but ...<br>
Here comes my question: How does the authorization server know the location or url or ... of that database or shared service?</p>



<a name="242338393"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242338393" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242338393">(Jun 11 2021 at 12:36)</a>:</h4>
<p>In the usual ways a piece of software 'knows' anything: hard-wired in its code, read from a configuration file, fetched from _another_ service etc.</p>



<a name="242338553"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Launch%20Sequence/near/242338553" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Launch.20Sequence.html#242338553">(Jun 11 2021 at 12:37)</a>:</h4>
<p>The upshot is that the 'EHR' that launches the app, the authorization server that controls access and the FHIR server that provides the data have to be tightly coupled - they are not really separate systems, they are just different pieces of the same system really</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
