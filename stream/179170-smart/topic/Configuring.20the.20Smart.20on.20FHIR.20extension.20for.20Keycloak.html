---
layout: page
title: "FHIR Chat  · Configuring the Smart on FHIR extension for Keycloak · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html">Configuring the Smart on FHIR extension for Keycloak</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="245854163"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/245854163" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yannick Börner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#245854163">(Jul 13 2021 at 16:55)</a>:</h4>
<p>Hi everyone,</p>
<p>I'm currently dipping my feet into Smart on FHIR, trying to secure a FHIR server and having an application write resources to it. My goal is the following: Open the application, authorize with the identity server and transmit Observations. </p>
<p>For this, I'm using the <a href="https://github.com/Alvearie/keycloak-extensions-for-fhir">Keycloak extensions for FHIR</a> and a <a href="https://fire.ly/products/firely-server/">Firely Server</a>. This is what I have done so far: </p>
<ol>
<li>iOS App is developed</li>
<li>Setup Firely Server </li>
<li>Setup KeyCloak</li>
<li>Add KeyCloak Smart on FHIR extension to Keycloak instance</li>
<li>Connect Firely Server and KeyCloak</li>
<li>The login window (Keycloak) and callback to the iOS application works! (yay)</li>
</ol>
<p>At this point however, the patient context picker as seen <a href="https://github.com/Alvearie/keycloak-extensions-for-fhir#the-patient-context-picker">here</a> is not visible to me. I suspect that I am doing/understanding something wrong with regards to configuration. In general, this is a standalone launch sequence, my current scope is <code>openid</code>(Is this correct?). The resulting question:</p>
<p><strong>How do I configure the SMART on FHIR extension for keycloak in order to achieve the workflow as outlined above?</strong></p>
<p>Big thanks to <span class="user-mention" data-user-id="191676">@Lee Surprenant</span> at this point for his work on the extension!</p>



<a name="245860448"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/245860448" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#245860448">(Jul 13 2021 at 17:40)</a>:</h4>
<blockquote>
<p>How do I configure the SMART on FHIR extension for keycloak in order to achieve the workflow as outlined above?</p>
</blockquote>
<p>A few options:</p>
<ol>
<li>manually configure a keycloak realm</li>
<li>use the keycloak-config project (in the same repo)</li>
<li>automate the config some other way (e.g. via standard realm import)</li>
</ol>



<a name="245860586"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/245860586" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#245860586">(Jul 13 2021 at 17:41)</a>:</h4>
<p>I initially tried number 3, but it never worked well for me and so I helped build 2 (with a couple colleagues)</p>



<a name="245860756"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/245860756" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#245860756">(Jul 13 2021 at 17:42)</a>:</h4>
<p>did you try one of these 3 yet?</p>



<a name="246060673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/246060673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yannick Börner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#246060673">(Jul 15 2021 at 07:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="191676">Lee Surprenant</span> <a href="#narrow/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak/near/245860756">said</a>:</p>
<blockquote>
<p>did you try one of these 3 yet?</p>
</blockquote>
<p>Hi Lee, yes, I tried number 2 which populates the keycloak instance with scopes and one realm I believe. Where I am struggling a bit is the next step. Do I need a patient resource per patient on the server <strong>and</strong> a user in Keycloak or is the patient sufficient?</p>



<a name="246061570"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/246061570" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yannick Börner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#246061570">(Jul 15 2021 at 07:45)</a>:</h4>
<p>It turns out that my assumption that the patient context picker will show up in any case is wrong. It will only show up when there are multiple resourceIds supplied, right?</p>



<a name="246061879"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/246061879" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yannick Börner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#246061879">(Jul 15 2021 at 07:49)</a>:</h4>
<p>And the final question: I tried to get an 'admin' user working that is capable of reading and writing to all resources on the server. I created the scope <code>user/*.*</code> for that purpose. Simply requesting a token with this scope did not bear any fruits however. Have you done this before?</p>



<a name="246061895"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/246061895" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Yannick Börner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#246061895">(Jul 15 2021 at 07:49)</a>:</h4>
<p>Sorry for all of the questions!</p>



<a name="246619021"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Configuring%20the%20Smart%20on%20FHIR%20extension%20for%20Keycloak/near/246619021" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lee Surprenant <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak.html#246619021">(Jul 20 2021 at 16:57)</a>:</h4>
<blockquote>
<p>It will only show up when there are multiple resourceIds supplied, right?</p>
</blockquote>
<p>Correct.  No need to select "which patient" if there's only one the user has access to.</p>
<blockquote>
<p>I created the scope user/<em>.</em> for that purpose. Simply requesting a token with this scope did not bear any fruits however. Have you done this before?</p>
</blockquote>
<p>Did you get this working yet?  I was more focused on the <code>patient/</code> scopes and launch context for this project, so hadn't gotten around to the <code>user/</code> ones yet.  That said, I think its just a matter of associating the scopes with the client app.  If using keycloak-config, you could add them to the following list so that they will be associated with <em>each</em> client when it gets registered:  <a href="https://github.com/Alvearie/keycloak-extensions-for-fhir/blob/main/keycloak-config/src/test/resources/keycloak-config.json#L464-L491">https://github.com/Alvearie/keycloak-extensions-for-fhir/blob/main/keycloak-config/src/test/resources/keycloak-config.json#L464-L491</a></p>
<p>note:  for clients that already exist, you might need to manually add the new scopes since the defaults only apply when its first created.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
