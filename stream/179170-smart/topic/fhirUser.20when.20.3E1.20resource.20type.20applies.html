---
layout: page
title: "FHIR Chat  · fhirUser when &gt;1 resource type applies · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html">fhirUser when &gt;1 resource type applies</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="223692181"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/223692181" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Marco Ramos <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#223692181">(Jan 22 2021 at 20:05)</a>:</h4>
<p>Happy Friday All!</p>
<p>I've got a question about a FHIR authorization server's implementation to support clients providing the fhirUser scope defined in the SMART Application Launch Framework Implementation Guide Release 1.0.0.</p>
<p>For some deployments, we may have a FHIR authorization server that uses a single identity provider for all users. This is regardless of whether the user is a patients, practitioner, or authorized representative. Our system currently allows a single user identity to be mapped to a patient AND a practitioner AND an authorized representative. Though this is rare, I'm trying to understand how the authorization server would decide which fhirUser reference is appropriate. </p>
<p>My initial thought is that a client meant for practitioners should prioritize the practitioner FHIR reference if it exists for the user over any other references that may exist for the user. This would appear to require some way of the authorization server understanding the target audience for the application which as far as I know isn't something that is standardized when using dynamic client registration. This approach also doesn't handle applications which target various audiences; of which I know none, but given that there is no explicit prohibition in FHIR, may need to be considered.<br>
There are other approaches that suffer from usability concerns, such as prompting the user during the authorization flow.<br>
Any input would be greatly appreciated.</p>
<p>Thanks,<br>
Marco</p>



<a name="223692797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/223692797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#223692797">(Jan 22 2021 at 20:11)</a>:</h4>
<p>Thanks for the question, Marco. I don't believe this has come up before, so I don't know if we have a very satisfying answer. Some thoughts:</p>
<ul>
<li>you could default to providing <code>Person</code> resources, allowing the app to discover available links to other representations</li>
<li>for statically registered clients, you could preferentially pick a user type based on some kind of "app type" (practitioner facing, or patient facing, etc)</li>
<li>if you support dynamic registration, you could ask for similar "app type" details; it's not standardized but could still be useful</li>
<li>you could expose different FHIR endpoints associated with different audiences or types of access</li>
</ul>



<a name="223701924"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/223701924" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michele Mottini <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#223701924">(Jan 22 2021 at 21:20)</a>:</h4>
<p>We use Person (also because in some case our users is neither a practitioner nor a patient). I believe Cerner does the same</p>



<a name="224122254"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224122254" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Lamb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224122254">(Jan 27 2021 at 00:00)</a>:</h4>
<p>When I saw Google they used patient and person (if my memory is correct).</p>
<p>If practitioner and patient inherited from person I could see allowing all these types. It seems that people would want to know what the fhir user will serialize to and what to check for identity matching.</p>



<a name="224122428"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224122428" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224122428">(Jan 27 2021 at 00:02)</a>:</h4>
<p>These types don't reflect an inheritance hierarchy; they do different jobs in FHIR (e.g., Person is all about linking)</p>



<a name="224122470"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224122470" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224122470">(Jan 27 2021 at 00:02)</a>:</h4>
<p>"would want to know" -- yes, agreed. Currently the answer is: "one of these types," and an app should handle the set of types.</p>



<a name="224123023"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224123023" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Lamb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224123023">(Jan 27 2021 at 00:09)</a>:</h4>
<p>I am not keen to have one identity have 3 roles based upon fhir profiles. To the OPs question, person seems like a good fit since the concept that is being expressed is a person (one identity but three possible roles).</p>



<a name="224123180"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224123180" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224123180">(Jan 27 2021 at 00:11)</a>:</h4>
<p>Topic we can raise for SMARTv2; a challenge is that for common scenarios, apps need to get a Patient ID and a Perosn ID and map between them. Would suggest creating a Jira item proposing a change.</p>



<a name="224123392"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224123392" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Lamb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224123392">(Jan 27 2021 at 00:13)</a>:</h4>
<p>I have some half baked ideas about how to use identity proofing but they fell apart when we use different fhir user types. I will keep in mind for v2.</p>



<a name="224123468"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224123468" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224123468">(Jan 27 2021 at 00:14)</a>:</h4>
<p>I mean, I'd expect any idea that works with one resource type should work with 5; it just might be less ergonomic to implement.</p>



<a name="224125826"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224125826" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Lamb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224125826">(Jan 27 2021 at 00:43)</a>:</h4>
<p>The half-baked idea is to support search and a launch context based upon an identity proofed identifier (not a FHIR id). This would be useful when we are allowing trust between systems and they do not know how to determine the FHIR id. The FHIR id is becoming a point of contention to get data to flow.</p>



<a name="224125985"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224125985" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224125985">(Jan 27 2021 at 00:45)</a>:</h4>
<p>Someone still needs to make rules about what fhir patient record ids that identity proofed Identity can access. So I'm not sure what the particular challenge is with fhirUser.</p>



<a name="224126479"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224126479" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Lamb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224126479">(Jan 27 2021 at 00:51)</a>:</h4>
<p>Assuming we have two systems that have solved the magic of trusting each other (we both agree Josh Lamb has an identifier of "system"|"123" and we agree to trust when one system says that Josh wants to share data). </p>
<p>If I have an identifier of "123", how do I get my FHIR patient ID without granting user-level access (launch/User)?</p>



<a name="224126681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224126681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224126681">(Jan 27 2021 at 00:53)</a>:</h4>
<p>system A supplies and identifier to system B. System B performs a lookup and its own data system and maps the supplied identifier to a patient record. System B presents the smart on fhkr authorization screen associated with the record found. The app is oblivious to all this.</p>



<a name="224127681"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224127681" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Lamb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224127681">(Jan 27 2021 at 01:07)</a>:</h4>
<p>Yes, essentially to get the FHIR id we have to exchange (I send id and you return FHIR id). </p>
<p>When I have multiple sources and the consumer has provided System A with consent already I will not need the consumer to provide the consent again (or login again). </p>
<p>If I could including something like <br>
'Patient': 'system|123' (between trusted systems) the receiver could do the lookup and not be required to send back the FHIR id or to gather consent again.</p>



<a name="224127843"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/fhirUser%20when%20%3E1%20resource%20type%20applies/near/224127843" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Lamb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/fhirUser.20when.20.3E1.20resource.20type.20applies.html#224127843">(Jan 27 2021 at 01:08)</a>:</h4>
<p>Anyway, ill keep mulling this over. Thanks for the help thinking through this.<br>
[edit] This use case should use launch user scope.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
