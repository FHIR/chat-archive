---
layout: page
title: "FHIR Chat  · invalid aud value · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html">invalid aud value</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="246464855"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246464855" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Muhammad Asif <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246464855">(Jul 19 2021 at 14:51)</a>:</h4>
<p>Hello,<br>
I have setup SMART Dev Sandbox (<a href="https://github.com/smart-on-fhir/smart-dev-sandbox">https://github.com/smart-on-fhir/smart-dev-sandbox</a>). I'm launching our Smart app that is secured with KeyCloak. On launch getting error bad_audience (bad audience value).<br>
i tried setting aud parameter value to to token endpoints of SMART dev sandbox (i.e. <a href="http://localhost:4013/v/r3/auth/token">http://localhost:4013/v/r3/auth/token</a>) but error persists.</p>
<p>Can someone guide what exact value aud parameter needs to be?</p>



<a name="246473666"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246473666" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246473666">(Jul 19 2021 at 15:54)</a>:</h4>
<p>Can you say more about what the role of KeyCloak is, and what the role of the SMART Launcher is in your setup? It's not clear how your are planning/attempting to integrate these tools.</p>



<a name="246475890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246475890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vladimir Ignatov <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246475890">(Jul 19 2021 at 16:11)</a>:</h4>
<p>The SMART Launcher is designed to give you the ability to test an "unsecured" app and see how it would behave when deployed to a secure SMART on FHIR environment. Trying to combine that with another auth layer is not necessary (nor supported). Try launching the app without KeyCloak to see if that works.</p>



<a name="246477320"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246477320" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Muhammad Asif <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246477320">(Jul 19 2021 at 16:23)</a>:</h4>
<p>I agree its to test a unsecured app. Actually i am trying to use the launcher as alternative to some EHR. Thus without going into EHR itself we can easily demo the app and manipulate data in FHIR server.</p>



<a name="246477492"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246477492" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Muhammad Asif <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246477492">(Jul 19 2021 at 16:24)</a>:</h4>
<p>Actually all the oAuth flow is done between KC and FHIR server. We have IDPs configured in KC,  and using identity federation these IDPs in KC does all the oAuth2 authentication for smart app..</p>
<p>For example in IDP we have configured FHIR server auth and token endpoints. And using these KC handle all the authentication. I am trying to pass aud as query parameter in auth end point URL.</p>



<a name="246479333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246479333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Muhammad Asif <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246479333">(Jul 19 2021 at 16:39)</a>:</h4>
<p>Is it possible to turn off aud checking feature in dev box?</p>



<a name="246481251"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246481251" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Vladimir Ignatov <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246481251">(Jul 19 2021 at 16:55)</a>:</h4>
<blockquote>
<p>Is it possible to turn off aud checking feature in dev box?</p>
</blockquote>
<p>No, unless you want to modify the code...</p>
<p>I'm not sure I follow. If you handle OAuth yourself (via KC), then what do you need the launcher for? Perhaps you only need a FHIR server instead?</p>
<p>As for the current issue,  you need to pass your FHIR base URL as <code>aud</code> query parameter to the authorize endpoint. However, the app being launched should do that for you, based on the <code>iss</code> launch parameter that it receives. Please verify that your FHIR base URL (wherever you set that in KC) is the same as the <code>iss</code> sent while launching the app.</p>



<a name="246488248"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246488248" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Muhammad Asif <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246488248">(Jul 19 2021 at 17:50)</a>:</h4>
<p>Sure i will double check and keep you posted</p>



<a name="246558776"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/246558776" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Muhammad Asif <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#246558776">(Jul 20 2021 at 08:38)</a>:</h4>
<p>Yup it get passed specifying exact FHIR base URL as in iss.  Thank you for your help.<br>
There are some epic specific context parameters get passed to SOF app. Now trying for those.</p>



<a name="248443368"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/invalid%20aud%20value/near/248443368" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Muhammad Asif <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/invalid.20aud.20value.html#248443368">(Aug 05 2021 at 06:41)</a>:</h4>
<p>It worked once had correct aud value. Thank you.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
