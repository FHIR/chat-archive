---
layout: page
title: "FHIR Chat  · Refresh token for online access · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html">Refresh token for online access</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="219922109"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/219922109" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Shah <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#219922109">(Dec 15 2020 at 00:21)</a>:</h4>
<p>In what scenarios, clients need to ask for online_access scope? If user is online, what capability it gives to the client to get new token? Can't client generate new access token using authorization code workflow without requiring user to login (but just with session cookie). I am trying to understand use case behind it and see, if anyone already implemented this using any OIDC server? Any suggestions are appreciated!</p>



<a name="219924640"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/219924640" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#219924640">(Dec 15 2020 at 00:47)</a>:</h4>
<blockquote>
<p>Can't client generate new access token using authorization code workflow without requiring user to login (but just with session cookie).</p>
</blockquote>
<p>In general this requires a user interaction. Some EHRs may be configured to allow it without clicks, but it still requires a pair of redirects and takes things out of an app's control. Using a refresh token is a better fit when the app can be authorized appropriately, since it allows a fully automated flow.</p>



<a name="219974046"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/219974046" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Shah <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#219974046">(Dec 15 2020 at 12:57)</a>:</h4>
<p>Appreciate your inputs! I understand the need but I see the limitations with at least the existing OIDC providers I have looked into.</p>
<ol>
<li>Keycloak - This does support refresh token that's by default linked to user session (that can support online_access) and when offline_access is requested, it can return the token that's generally persisted and can work longer. But it does not have a way to NOT pass refresh token if client does not have either of online_access or offline_access scope<br>
2 ORY Hydra - This supports issuing refresh token only as long as offline_access scope is requested and does not support linking refresh token to user sessions on the ground that refresh token should NOT be confused with user sessions and should not have any link/association with user session.</li>
</ol>
<p>So trying to understand best approach to resolve this.</p>



<a name="219997421"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/219997421" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#219997421">(Dec 15 2020 at 15:48)</a>:</h4>
<p>This capability might not be the best fit for an authorization server that is highly decoupled from the EHR. I certainly wouldn't points to it as the low-hanging fruit for implantation :-)</p>



<a name="220656026"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/220656026" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Shah <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#220656026">(Dec 22 2020 at 03:38)</a>:</h4>
<p>However, if one is asked to implement an OIDC solution that complies with SMART on FHIR, is it not mandatory to support online_access scope (as per SMART on FHIR specs) that generates the refresh token tied to the user session, which is in general not suggested as per OIDC.<br>
Specifically, I am referring to 21st century Cures Act, which requires Auth server for FHIR API access to be SMART on FHIR compliant, but that itself does not mention any criteria about online_access scope anywhere. So I am not certain if online access is a mandatory need or not? <br>
Ref: <a href="https://www.ory.sh/hydra/docs/concepts/before-oauth2/#access-and-refresh-tokens-are-not-sessions">https://www.ory.sh/hydra/docs/concepts/before-oauth2/#access-and-refresh-tokens-are-not-sessions</a><br>
Please suggest your thoughts onto this.</p>



<a name="220698015"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/220698015" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#220698015">(Dec 22 2020 at 15:04)</a>:</h4>
<p>ONC's Standardized API Criteria requires implementation of all <a href="https://hl7.org/fhir/smart-app-launch/conformance/index.html#core-capabilities">SMART Core Capabilities</a>, and the online_access scope is not associated with any of those core capabilities.  So for certification to that criteria (g10) using v1.0.0 of the SMART App Launch Framework, you do not need to demonstrate that functionality.</p>



<a name="220699746"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/220699746" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#220699746">(Dec 22 2020 at 15:19)</a>:</h4>
<p>That's the technical reason why there is not testing associated with <del>offline_access</del> online_access in the <a href="https://www.healthit.gov/test-method/standardized-api-patient-and-population-services#test_procedure">test procedure</a>.  But it also makes sense that online access isn't a requirement because it is more restrictive access-wise than offline access (it doesn't give apps more access than other available scopes), and it imposes tighter coupling between components within the 'ehr' which may be difficult for some health it developers to implement.</p>



<a name="220700140"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/220700140" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#220700140">(Dec 22 2020 at 15:22)</a>:</h4>
<p>Re: offline, do you just test for refresh token capabilities without involving this scope?</p>



<a name="220700282"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/220700282" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#220700282">(Dec 22 2020 at 15:23)</a>:</h4>
<p>We only test using "offline_access" scope -- systems must support that scope specifically to get refresh tokens.</p>



<a name="220700431"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/220700431" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#220700431">(Dec 22 2020 at 15:24)</a>:</h4>
<p>Systems can support online_access additionally, of course.  But they can't only support online_access and not offline_access.</p>



<a name="220702908"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/220702908" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sagar Shah <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#220702908">(Dec 22 2020 at 15:47)</a>:</h4>
<p>Thank you for all the clarifications <span class="user-mention" data-user-id="192576">@Robert Scanlon</span>  and <span class="user-mention" data-user-id="191315">@Josh Mandel</span> . That does make sense to me. We do plan to support offline_access scope in our auth server, which will be required by the clients, if they need refresh tokens.</p>



<a name="220717027"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/220717027" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Scanlon <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#220717027">(Dec 22 2020 at 17:59)</a>:</h4>
<p>I just realized I bungled offline_access/online_access in my response a few messages back, which hopefully didn't cause too much confusion (see the strikeout/replacement).  But based on your last message it seems like you were able to read through it.  Sorry!</p>



<a name="221820164"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/221820164" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#221820164">(Jan 06 2021 at 20:39)</a>:</h4>
<p>Ironically, all of our production provider apps today use online_access as the apps don't get data after the user closes the app :) We found it sad that ONC didn't mention it at all</p>



<a name="221820378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/221820378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#221820378">(Jan 06 2021 at 20:41)</a>:</h4>
<p>Leaving a refresh token out and valid (esp for public apps) when an application doesn't need that type of access is an unfortunate security vulnerability</p>



<a name="221820511"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/Refresh%20token%20for%20online%20access/near/221820511" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/Refresh.20token.20for.20online.20access.html#221820511">(Jan 06 2021 at 20:42)</a>:</h4>
<p>And the "one time use" (short term use) token isn't a great alternative for apps like that</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
