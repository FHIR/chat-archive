---
layout: page
title: "FHIR Chat  · ONC preamble - security issue for token introspection? · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/ONC.20preamble.20-.20security.20issue.20for.20token.20introspection.3F.html">ONC preamble - security issue for token introspection?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="241402378"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/ONC%20preamble%20-%20security%20issue%20for%20token%20introspection%3F/near/241402378" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/ONC.20preamble.20-.20security.20issue.20for.20token.20introspection.3F.html#241402378">(Jun 03 2021 at 14:56)</a>:</h4>
<p>In the preamble for ONC's 21st Century Cures rule, there is this blurb:</p>
<div class="codehilite"><pre><span></span><code>Token introspection will allow implementers of § 170.315(g)(10)-certified
Health IT Modules to use API authorization servers and authorization tokens
with various resource servers. This functionality has the potential to
reduce complexity for implementers of § 170.315(g)(10)-certified
Health IT Modules authorizing access to several resource servers and
reduces the overall effort and subsequent use of § 170.315(g)(10)-certified
Health IT Modules consistent with the goals of section 4002 of the Cures Act
 to enable the use of APIs without “special effort.” Although we do not
specify a standard for token introspection, we encourage industry to
coalesce around using a common standard,
like OAuth 2.0 Token Introspection (RFC 7662).
</code></pre></div>
<ul>
<li><a href="https://www.federalregister.gov/d/2020-07419/p-1256">https://www.federalregister.gov/d/2020-07419/p-1256</a></li>
</ul>
<p>I think this proposed use of token introspection adds a security issue in the case where a system allowed delegated (proxy) access, <em>unless</em> the token introspection response includes the patient FHIR ID associated with the token (similar to how SMART prescribes sending back the patient ID in the oauth2/token response.</p>
<p>I think in order to get to ONC's goal here, we need to (conditionally) require the patient FHIR ID be returned in the introspect response.</p>
<p>The issue is: how does a 3rd party resource server determine what patient's data the access token grants access to?  The patient FHIR ID is provided by the patient app to the resource server, alongside the access token issued by the certified API auth server.  However, since the client-provided patient FHIR ID can't be trusted, the resource server needs to have some way to discover to which patient the access token grants access.  Since RFC 7662 (and the current draft SMART introspect profile) only has the "sub" (which is the user, not the patient), doing introspect alone doesn't give the resource server a way to determine which patient data should be shared with the app.</p>



<a name="241402425"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/ONC%20preamble%20-%20security%20issue%20for%20token%20introspection%3F/near/241402425" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/ONC.20preamble.20-.20security.20issue.20for.20token.20introspection.3F.html#241402425">(Jun 03 2021 at 14:56)</a>:</h4>
<p><a href="http://jira.hl7.org/browse/FHIR-32849">FHIR#32849</a> - but I'm interested if folks think I'm missing something and this isn't actually a problem.</p>



<a name="241413072"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/ONC%20preamble%20-%20security%20issue%20for%20token%20introspection%3F/near/241413072" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/ONC.20preamble.20-.20security.20issue.20for.20token.20introspection.3F.html#241413072">(Jun 03 2021 at 16:08)</a>:</h4>
<p>We write <a href="http://build.fhir.org/ig/HL7/smart-app-launch/token-introspection.html#conditional-fields-in-the-introspection-response">in SMARTv2 spec</a>, currently under ballot reconciliation: </p>
<blockquote>
<p>SMART Launch Context. If a launch context parameter defined in Scopes and Launch Context (e.g., patient or intent) was included in the original access token response, the parameter SHALL be included in the token introspection response.</p>
</blockquote>



<a name="241413191"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/ONC%20preamble%20-%20security%20issue%20for%20token%20introspection%3F/near/241413191" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/ONC.20preamble.20-.20security.20issue.20for.20token.20introspection.3F.html#241413191">(Jun 03 2021 at 16:09)</a>:</h4>
<p>This is something we've tested at the past few connectathons; does this address the concern? (I can't see your Jira issue right now because Jira's down.)</p>



<a name="241427797"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/ONC%20preamble%20-%20security%20issue%20for%20token%20introspection%3F/near/241427797" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cooper Thompson <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/ONC.20preamble.20-.20security.20issue.20for.20token.20introspection.3F.html#241427797">(Jun 03 2021 at 17:50)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span> Yeah.  It's right there in the build.  Thanks for pointing that out.  I withdrew the Jira.</p>



<a name="241450853"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/ONC%20preamble%20-%20security%20issue%20for%20token%20introspection%3F/near/241450853" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/ONC.20preamble.20-.20security.20issue.20for.20token.20introspection.3F.html#241450853">(Jun 03 2021 at 20:50)</a>:</h4>
<p>Excellent -- I appreciate the attention to detail on this. It's a "small thing" from the spec perspective, but a critical detail if we want to unlock the flexibility ONC is referring to.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
