---
layout: page
title: "FHIR Chat  · id token · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html">id token</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153924622"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153924622" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153924622">(Dec 12 2017 at 21:47)</a>:</h4>
<p>If the auth server supplies an id token (maybe in response to the openid &amp; profile  scopes) then the 'profile' claim in the token is the url for the user (Patient, Provider, RelatedPerson) - correct? The spec has a section (copied below) that seems redundant (unless it allows for a server to include an issuer only) ...</p>
<p><strong>Steps for using an ID token</strong></p>
<ul>
<li>Examine the ID token for its “issuer” property</li>
<li>Perform a GET {issuer}/.well-known/openid-configuration</li>
<li>Fetch the server’s JSON Web Key by following the “jwks_uri” property</li>
<li>Validate the token’s signature against the public key from step #3</li>
<li>Extract the “profile” claim and treat it as the URL of a FHIR resource</li>
</ul>



<a name="153924631"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153924631" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153924631">(Dec 12 2017 at 22:37)</a>:</h4>
<p>I think the first four steps are used to validate the OAuth  claim. This gives you trust in the token, it is good and from someone you trust. The last step is specific to FHIR use. If you skip the first four steps then someone could present a malicious claim that you would think is a valid claim for the identified 'profile' user. (I don't see a protection that the id is the same as the profiled FHIR resource. Not sure what prevents a malicous user/app from taking a valid token (like a janitor) and doing nothing but replacing the FHIR url with one of a chief clinician with much broader user rights)</p>



<a name="153924648"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153924648" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153924648">(Dec 12 2017 at 23:54)</a>:</h4>
<p>Thanks John - apparently we do that already as part pf our base OAuth implementation (which I'm looking to migrate to SMART - hence the questions!).</p>



<a name="153924747"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153924747" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153924747">(Dec 13 2017 at 14:57)</a>:</h4>
<p>so I guessed right? But did I answer your question?</p>



<a name="153924821"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153924821" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153924821">(Dec 13 2017 at 17:04)</a>:</h4>
<p>well - not really I'm afraid :) What I'm unclear of is whether the profile claim (url of user resource) is in the userid directly, or whether you use the issuer (iss) to get it...  (or potentially both, depending on the implementation - ie look first in the userid, and if not found then get it via the issuer)...</p>



<a name="153925114"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153925114" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ben Spencer <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153925114">(Dec 14 2017 at 07:33)</a>:</h4>
<p>aiui the last step means "extract the profile claim <em>from the ID token</em>"<br>
you're not using the issuer to get the value, just to validate it</p>



<a name="153925169"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153925169" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153925169">(Dec 14 2017 at 12:15)</a>:</h4>
<p>Issuer just verifies the system, not the user.</p>



<a name="153925267"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153925267" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153925267">(Dec 14 2017 at 18:55)</a>:</h4>
<p>Oh, I get it.</p>
<p>1. get the id token.<br>
2. validate that it is correct using the first 4 steps above.<br>
3 if valid, then use the profile claim as the reference to the current user.</p>
<p>silly me!</p>



<a name="153925272"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153925272" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153925272">(Dec 14 2017 at 19:27)</a>:</h4>
<p>isnt that what I said?</p>



<a name="153925273"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153925273" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> John Moehrke <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153925273">(Dec 14 2017 at 19:28)</a>:</h4>
<p>should smart require that the id in the token also be an identifier in the referenced resource?</p>



<a name="153926074"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926074" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926074">(Dec 18 2017 at 23:03)</a>:</h4>
<p>where do I find the keys and algorithm to decrypt the id token returned when I specify openid &amp; profile in the scope?</p>



<a name="153926076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926076">(Dec 18 2017 at 23:09)</a>:</h4>
<p>For the SMART launcher it's at <a href="https://launch.smarthealthit.org/.well-known/openid-configuration/" target="_blank" title="https://launch.smarthealthit.org/.well-known/openid-configuration/">https://launch.smarthealthit.org/.well-known/openid-configuration/</a> which points to <a href="https://launch.smarthealthit.org/keys" target="_blank" title="https://launch.smarthealthit.org/keys">https://launch.smarthealthit.org/keys</a> . <span class="user-mention" data-user-id="192233">@Travis Cummings</span>  - do you know where the sandbox has this info?</p>



<a name="153926089"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926089" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926089">(Dec 19 2017 at 01:17)</a>:</h4>
<p>thanks!</p>



<a name="153926092"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926092" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926092">(Dec 19 2017 at 01:35)</a>:</h4>
<p><strong>deleted</strong></p>



<a name="153926093"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926093" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926093">(Dec 19 2017 at 02:00)</a>:</h4>
<p>Hi David, I think the id jwt is just base64 encoded and signed, not encrypted, so you should be able to decode it (I'd recommend using a jwt library) and then verify the signature with the key. The keys are out of band - the SMART launcher (a streamlined UI for the sandbox) keeps them at the address I mentioned. I was asking Travis where the older sandbox UI stores them.</p>



<a name="153926094"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926094" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926094">(Dec 19 2017 at 02:00)</a>:</h4>
<p>just figured that out!</p>



<a name="153926095"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926095" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926095">(Dec 19 2017 at 02:00)</a>:</h4>
<p>Ha, great - I have to type faster!</p>



<a name="153926096"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926096" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926096">(Dec 19 2017 at 02:00)</a>:</h4>
<p>well, I need to think faster too!</p>



<a name="153926098"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926098" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dan Gottlieb <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926098">(Dec 19 2017 at 02:01)</a>:</h4>
<p>:)</p>



<a name="153926116"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926116" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926116">(Dec 19 2017 at 06:49)</a>:</h4>
<p>You can use this site to help decode some and check their validity too<br>
<a href="https://jwt.io/" target="_blank" title="https://jwt.io/">https://jwt.io/</a></p>



<a name="153926255"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/id%20token/near/153926255" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/id.20token.html#153926255">(Dec 19 2017 at 16:39)</a>:</h4>
<p>nice!</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
