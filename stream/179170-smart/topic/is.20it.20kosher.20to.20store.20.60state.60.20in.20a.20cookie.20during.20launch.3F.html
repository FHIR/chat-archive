---
layout: page
title: "FHIR Chat  · is it kosher to store `state` in a cookie during launch? · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html">is it kosher to store `state` in a cookie during launch?</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="191176210"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191176210" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191176210">(Mar 19 2020 at 21:14)</a>:</h4>
<p>The spec states that the <a href="http://www.hl7.org/fhir/smart-app-launch/#step-1-app-asks-for-authorization" target="_blank" title="http://www.hl7.org/fhir/smart-app-launch/#step-1-app-asks-for-authorization"><code>state</code></a> param presented by the app and returned by the AS during the /authorize step, prevents <a href="https://owasp.org/www-community/attacks/csrf" target="_blank" title="https://owasp.org/www-community/attacks/csrf">CSRF</a> and <a href="https://owasp.org/www-community/attacks/Session_fixation" target="_blank" title="https://owasp.org/www-community/attacks/Session_fixation">session fixation</a>.  </p>
<p>The inherent risk of a (SameSite=Strict) <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie">cookie</a> is that the user could change the value at any point, but this wouldn't enable CSRF.  As long as the app wrote a new state value for every launch, it wouldn't be possible to fix the session before it started -- and even that's a very minimal risk. </p>
<p>Additionally, a SPA doesn't have any other choice than cookie or sessionStorage.</p>



<a name="191176265"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191176265" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191176265">(Mar 19 2020 at 21:14)</a>:</h4>
<p>Got this question -- can anyone confirm or deny my logic?</p>



<a name="191184956"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191184956" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191184956">(Mar 19 2020 at 22:54)</a>:</h4>
<p>For a single-page app, <code>state</code> indeed needs to be stored somewhere. My recommendation is <code>sessionStorage</code> because it requires less cleanup and it's harder to goof with the same-origin poilcy.</p>



<a name="191184962"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191184962" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191184962">(Mar 19 2020 at 22:54)</a>:</h4>
<p>But there may be other considerations here I haven't thought about.</p>



<a name="191189178"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191189178" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191189178">(Mar 19 2020 at 23:54)</a>:</h4>
<p>Thanks, Josh. For a multi-tabbed browser, the only functional difference between sessioStorage and a cookie is separation from other instances of the same app (domain).  If the state is only used during the launch process, the only difference would be preventing two+ instances of the same app from session hijacking. This wouldn't occur during an ehr launch in practice (in which there's no auth page presented -- and therefore no real delay), but could occur during standalone launches. </p>
<p>I think that makes sense --  assuming a user-facing auth page during an ehr launch doesnt give the user the opportunity to relaunch the same app in a different context.</p>



<a name="191695529"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191695529" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jenni Syed <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191695529">(Mar 25 2020 at 02:21)</a>:</h4>
<p>We've seen real life instances of apps being open for multiple patients stealing session storage from each other. Eg: embedded browsers share sessions.</p>



<a name="191695573"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191695573" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191695573">(Mar 25 2020 at 02:22)</a>:</h4>
<p>Do you mean "stealing" maliciously, or somehow confusing?</p>



<a name="191695673"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191695673" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191695673">(Mar 25 2020 at 02:25)</a>:</h4>
<p>If I remember correctly, I think Cerner saw some kind of shared access happening across sessions in its embedded browser environment? (It's not something that should be possible in browsers that are correctly implementing sessionStorage APIs.)</p>



<a name="191700248"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/is%20it%20kosher%20to%20store%20%60state%60%20in%20a%20cookie%20during%20launch%3F/near/191700248" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Isaac Vetter <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/is.20it.20kosher.20to.20store.20.60state.60.20in.20a.20cookie.20during.20launch.3F.html#191700248">(Mar 25 2020 at 04:21)</a>:</h4>
<p>Hey guys, I think Jenni means "confusing".  I've already incorporated this consideration in my remarks, above.</p>
<p>Here's the details of sessionstorage in a single threaded windows exe with multiple browser controls: <a href="https://github.com/cerner/fhir-client-cerner-additions/blob/master/README.md" title="https://github.com/cerner/fhir-client-cerner-additions/blob/master/README.md">https://github.com/cerner/fhir-client-cerner-additions/blob/master/README.md</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
