---
layout: page
title: "FHIR Chat  · codes and systems · smart"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/index.html">smart</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html">codes and systems</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="209804478"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209804478" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209804478">(Sep 11 2020 at 16:37)</a>:</h4>
<p>Yesterday we talked a bit about what it means to have a scope like <code>patient/Observation.s?category=vital-signs</code> -- does this mean a client can query for category codings with <em>any</em> system and a code of <code>vital-signs</code>, or can servers interpret that scope as, effectively, meaning <code>patient/Observation.rs?category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs</code>? In other words, can a server "interpret a default", and if so, should this be communicated back to the client? Here are my thoughts...</p>



<a name="209804624"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209804624" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209804624">(Sep 11 2020 at 16:38)</a>:</h4>
<ol>
<li>US Core specifically <a href="https://www.hl7.org/fhir/us/core/vitals-search.html#mandatory-search-parameters">documents queries</a> like <blockquote>
<p>GET [base]/Observation?patient=[reference]&amp;category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs</p>
</blockquote>
</li>
</ol>
<p>... which to me suggests we should be equally precise in most of our documentation. We shouldn't write <code>vital-signs</code> without a system as a shorthand to make things "look pretty".</p>



<a name="209804702"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209804702" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209804702">(Sep 11 2020 at 16:39)</a>:</h4>
<ol start="2">
<li>Since FHIR search supports queries like "get me all Observations where the category code is <code>vital-signs</code>, regardless of system," our scope language should too -- but that doesn't mean we should encourage it.</li>
</ol>



<a name="209804858"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209804858" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209804858">(Sep 11 2020 at 16:40)</a>:</h4>
<ol start="3">
<li>It's reasonable for a server to assume a default code, but this must be reflected back to to the client so the client can adjust its queries accordingly. In other words, the granted scopes should signal to a client "here are things I'll allow you to query for". So it'd be a mistake to tell the client that the scope <code>patient/Observation.s?category=vital-signs</code> was granted, if in fact only the narrower  <code>patient/Observation.s?category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs</code> was granted. Why? It's a mistake to tell the client the "shorter" scope because the server could <em>reject</em> a query for <code>GET Observation?patient=[]&amp;category=vital-signs</code> as too broad, and the client would have no way to tell why.</li>
</ol>



<a name="209805166"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209805166" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209805166">(Sep 11 2020 at 16:43)</a>:</h4>
<ol start="4">
<li>If a server does, in fact grant a fully-specified scope like <code>patient/Observation.s?category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs</code>, then it should <em>not</em> allow a query like "GET Observation?patient=[]&amp;category=http://some-other-system|vital-signs`. </li>
</ol>
<p><code>*</code> currently <a href="https://smart.argo.run">https://smart.argo.run</a> violates this expectation :-)</p>



<a name="209805208"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209805208" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209805208">(Sep 11 2020 at 16:44)</a>:</h4>
<p>I'd love to hear feedback from others on these points, either through thumbs up/down on the individual posts, or in discussion below :)</p>



<a name="209806299"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209806299" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Gino Canessa <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209806299">(Sep 11 2020 at 16:53)</a>:</h4>
<p>For 1., I'm less concerned about "pretty" than I am about scope size limits.  Especially if including multiple codes from a system, this will get quite large quite fast.</p>



<a name="209806728"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209806728" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209806728">(Sep 11 2020 at 16:57)</a>:</h4>
<p>I think I agree with requiring system, but I also worry about size explosion.</p>



<a name="209806854"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209806854" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209806854">(Sep 11 2020 at 16:58)</a>:</h4>
<p>Since category/type based queries are mostly gonna be scoped to the preferred or required coding system, could we invent a shorthand for it?</p>



<a name="209807076"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209807076" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209807076">(Sep 11 2020 at 17:00)</a>:</h4>
<p>e.g. <code>patient/Observation.s?category=__preferred|vital-signs</code></p>



<a name="209807117"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209807117" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209807117">(Sep 11 2020 at 17:00)</a>:</h4>
<p>I'm all for suggestions about how to "have our cake and eat it too," but they get complex. In xml and the semantic web, the concept of a "<a href="https://www.w3.org/TR/2010/NOTE-curie-20101216/">curie</a>" (compact URI) comes into play -- like, you can define prefixes. So we could say that <code>oc:</code> means <code>http://terminology.hl7.org/CodeSystem/observation-category</code> or whatever. This is different from assuming a default system, because it still allows the system to be blank.</p>



<a name="209807142"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209807142" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209807142">(Sep 11 2020 at 17:00)</a>:</h4>
<p>Ooh, that's a neat trick Pascal.</p>



<a name="209807193"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209807193" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209807193">(Sep 11 2020 at 17:01)</a>:</h4>
<p>Could maybe even be shorter, like <code>p</code>, because <code>p</code> is clearly not a URL <span aria-label="yum" class="emoji emoji-1f60b" role="img" title="yum">:yum:</span></p>



<a name="209807333"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209807333" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209807333">(Sep 11 2020 at 17:02)</a>:</h4>
<p>Yup. Though <code>__</code> and <code>p</code> are both apparently FHIR uris in the limited sense that <a href="http://build.fhir.org/datatypes.html#uri">they pass <code>Regex: \S*</code></a> :p</p>



<a name="209807449"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209807449" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209807449">(Sep 11 2020 at 17:03)</a>:</h4>
<p>Ah darn I never actually looked at that. But wow <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="209807585"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209807585" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209807585">(Sep 11 2020 at 17:04)</a>:</h4>
<p>So assuming we have a "ccurie" (to coin a term: contextual compact URI) like <code>_</code> or whatever, we trade off a bit of processing complexity for some bytes in our scope expressions.</p>
<p><strong>Do we agree that none of this comes into play at <em>query</em> time, like I can't ask for "GET Observation?category=_|vital-signs" ?</strong></p>



<a name="209807696"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209807696" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209807696">(Sep 11 2020 at 17:05)</a>:</h4>
<p>(I kinda like <code>_</code> here, as the "throwaway variable" used in programming languages like swift, rust, etc. And you can't get shorter while still being explicit.)</p>



<a name="209809157"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209809157" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209809157">(Sep 11 2020 at 17:17)</a>:</h4>
<p>ccurie ™ it is!<br>
So would it be <code>_:vital_signs</code> to align with curie or <code>_|vital_signs</code> for underscore to just mean the preferred or required system?<br>
I think I'd like to also be able to query this way, but that would be a separate balloting question, I don't think we _have_ to be able to.</p>



<a name="209809231"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209809231" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209809231">(Sep 11 2020 at 17:17)</a>:</h4>
<p>I was thinking just <code>_|vital-signs</code> in the scopes to align with FHIR query conventions</p>



<a name="209809308"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209809308" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209809308">(Sep 11 2020 at 17:18)</a>:</h4>
<p>Yeah I like that too, but your query example above uses <code>_:</code></p>



<a name="209809337"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209809337" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209809337">(Sep 11 2020 at 17:18)</a>:</h4>
<p>Fixed now! Thanks.</p>



<a name="209809360"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209809360" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209809360">(Sep 11 2020 at 17:18)</a>:</h4>
<p>Ha, great, works for me!</p>



<a name="209809474"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209809474" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209809474">(Sep 11 2020 at 17:19)</a>:</h4>
<p>(Now that takes us to the discussion about.... how do you know what's preferred? How does a server publish its contextual bindings? Does this mechanism only apply for value set bindings in the FHIR core spec, or can it be used in IG-specific ways? etc.)</p>



<a name="209809704"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179170-smart/topic/codes%20and%20systems/near/209809704" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pascal Pfiffner <a href="https://fhir.github.io/chat-archive/stream/179170-smart/topic/codes.20and.20systems.html#209809704">(Sep 11 2020 at 17:21)</a>:</h4>
<p>Yeah good point. Obviously the easiest would be to just have it apply to preferred/required bindings in the core spec and disallow it for others, but this warrants discussion.</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
