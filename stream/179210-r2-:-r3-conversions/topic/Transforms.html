---
layout: page
title: "FHIR Chat  · Transforms · r2 : r3 conversions"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/index.html">r2 : r3 conversions</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html">Transforms</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="153863545"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863545" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863545">(Dec 15 2016 at 01:45)</a>:</h4>
<p><span class="user-mention" data-user-id="191366">@Stephen Royce</span> <span class="user-mention" data-user-id="191478">@Oliver Egger</span> <span class="user-mention" data-user-id="191367">@Brian Postlethwaite</span> I have subscribed you to this new channel for the r2:r3 mapping work</p>



<a name="153863546"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863546" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Postlethwaite <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863546">(Dec 15 2016 at 01:46)</a>:</h4>
<p>Thanks.</p>



<a name="153863547"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863547" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863547">(Dec 15 2016 at 01:46)</a>:</h4>
<p>today, my plan is to commit the following:<br>
- candidate maps for R2/R3 in both directions<br>
- a test application that executes all of the maps to test them<br>
- extend the build to publish the maps along with their status</p>



<a name="153863594"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863594" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863594">(Dec 15 2016 at 06:04)</a>:</h4>
<p>ok. maps are all generated, and added</p>



<a name="153863595"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863595" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863595">(Dec 15 2016 at 06:04)</a>:</h4>
<p>see, for example: </p>



<a name="153863596"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863596" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863596">(Dec 15 2016 at 06:04)</a>:</h4>
<p><a href="http://build.fhir.org/allergyintolerance-version-maps.html" target="_blank" title="http://build.fhir.org/allergyintolerance-version-maps.html">http://build.fhir.org/allergyintolerance-version-maps.html</a></p>



<a name="153863597"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863597" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863597">(Dec 15 2016 at 06:05)</a>:</h4>
<p>there's a set of JUnit test cases that test them all. They all fail. just committing that now</p>



<a name="153863602"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863602" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stephen Royce <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863602">(Dec 15 2016 at 06:08)</a>:</h4>
<p>Suite! :)<br>
I assume you're good for me to get into this after Christmas?</p>



<a name="153863608"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863608" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863608">(Dec 15 2016 at 06:25)</a>:</h4>
<p>sure</p>



<a name="153863609"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863609" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863609">(Dec 15 2016 at 07:02)</a>:</h4>
<p>thx!</p>



<a name="153863675"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863675" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863675">(Dec 16 2016 at 05:32)</a>:</h4>
<p>ok, so, maps are committed for all the conversions I've been maintaining. A JUnit test case exists that tries to convert every r2 example to it's r3 equivalent using the map. Then it validates them. So far, 558 of the 729 examples fail - about what I expected.  </p>



<a name="153863676"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863676" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863676">(Dec 16 2016 at 05:32)</a>:</h4>
<p>then the build picks up the maps and the outcome of the tests, and publishes them</p>



<a name="153863677"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863677" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863677">(Dec 16 2016 at 05:33)</a>:</h4>
<p>see, for example: <a href="http://build.fhir.org/flag-version-maps.html" target="_blank" title="http://build.fhir.org/flag-version-maps.html">http://build.fhir.org/flag-version-maps.html</a></p>



<a name="153863678"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863678" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863678">(Dec 16 2016 at 05:34)</a>:</h4>
<p>I now need to convert them back to R2, and check that they round trip ok. That will increase the number of failures. </p>



<a name="153863679"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863679" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863679">(Dec 16 2016 at 05:35)</a>:</h4>
<p>once I've done that, our task, between us, is to :<br>
- run the JUnit test<br>
- pick a resource that is failing, and edit the script so it succeeds. </p>



<a name="153863680"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863680" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863680">(Dec 16 2016 at 05:35)</a>:</h4>
<p>I think the place to start is with running the JUnit tests. Are you all confortable running them from in eclipse? that will save me lots of work packaging the JUnit tests a different way</p>



<a name="153863692"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863692" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oliver Egger <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863692">(Dec 16 2016 at 09:06)</a>:</h4>
<p>i'm comfortable running org/hl7/fhir/conversion/tests/R2R3ConversionTests.java  within eclipse, however I'm oxs based, so the path are nor the same, attached a patch which shoudl work on both (not verified on windows)<a href="/user_uploads/10155/6Lwg2SJPRrJ0GTjEAnx6O-wY/R2R3ConversionTestsPatch.patch" target="_blank" title="R2R3ConversionTestsPatch.patch">R2R3ConversionTestsPatch.patch</a> </p>



<a name="153863773"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863773" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863773">(Dec 16 2016 at 20:49)</a>:</h4>
<p>adopted a variant of your patch. When you run the tests, you have to set the working directory to the build folder. </p>



<a name="153863774"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863774" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863774">(Dec 16 2016 at 20:49)</a>:</h4>
<p>and also, you have to do a full build locally before running the tests. see </p>



<a name="153863775"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863775" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863775">(Dec 16 2016 at 20:50)</a>:</h4>
<p><a href="http://wiki.hl7.org/index.php?title=FHIR_Build_Process" target="_blank" title="http://wiki.hl7.org/index.php?title=FHIR_Build_Process">http://wiki.hl7.org/index.php?title=FHIR_Build_Process</a></p>



<a name="153863890"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863890" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863890">(Dec 17 2016 at 19:55)</a>:</h4>
<p>ok, just committed full working stack, with Flag passing all tests</p>



<a name="153863892"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863892" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863892">(Dec 17 2016 at 19:59)</a>:</h4>
<p>we're now good to go. Your rough process is :<br>
- update from svn<br>
- run a full build<br>
- run the R2R3ConversionTests java class from Eclipse (Run as a JUnit Application), and make sure the default directory is {build})<br>
- now consult {build}\implementations\r2maps\management.txt to help choose a resource type to work on<br>
- look in {build}\implementations\r2maps\outcomes.json to see what errors there are with the resource<br>
- look in {build}\implementations\r2maps\test-output, and use some diff tool to compare the before/after on the round trips<br>
- make adjustments to the mapping script<br>
- rerun the tests and back to comparisons<br>
- update management.txt, and commit along with updated script</p>



<a name="153863896"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863896" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863896">(Dec 17 2016 at 20:22)</a>:</h4>
<p>when running R2R3ConverstionTests, you can pass it a command line parameter to limit it to a particular resource type (e.g. -Dresource=X)</p>



<a name="153863899"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153863899" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153863899">(Dec 17 2016 at 21:07)</a>:</h4>
<p>a couple of other notes:<br>
- the before/after comparison is on canonical XML and ignores comments. So you might see text differences in the before/after that the test says is ok<br>
- order presently matters in the R3 -&gt; R3 conversions. I'll have to fix that </p>



<a name="153864722"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153864722" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153864722">(Dec 22 2016 at 01:30)</a>:</h4>
<p>hmm, I've got concept map and value set round tripping working  - but both caused some deep revisions to the mapping language. I'll let you know when I've updated the tutorial</p>



<a name="153864724"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153864724" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153864724">(Dec 22 2016 at 01:32)</a>:</h4>
<p>found them in the spec - way cool!</p>



<a name="153864725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153864725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153864725">(Dec 22 2016 at 01:33)</a>:</h4>
<p>Thx</p>



<a name="153864834"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153864834" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153864834">(Dec 22 2016 at 21:34)</a>:</h4>
<p>ok. doco is updated, order problem is fixed. I have round-tripping working for the hardest resources (ValueSet, ConceptMap, StructureDefinition - mostly, CapabilityStatement). All good to go for the simpler stuff</p>



<a name="153865550"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153865550" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153865550">(Jan 04 2017 at 22:24)</a>:</h4>
<p>well. So I got into gear and got the process of doing resource maps down to 5-10 min per type. So I decided to just do all the resources.</p>



<a name="153865552"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179210-r2%20%3A%20r3%20conversions/topic/Transforms/near/153865552" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Grahame Grieve <a href="https://fhir.github.io/chat-archive/stream/179210-r2-:-r3-conversions/topic/Transforms.html#153865552">(Jan 04 2017 at 22:24)</a>:</h4>
<p>shortly, a summary will become available at <a href="http://build.fhir.org/r2maps.html" target="_blank" title="http://build.fhir.org/r2maps.html">http://build.fhir.org/r2maps.html</a></p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
