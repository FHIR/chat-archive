---
layout: page
title: "FHIR Chat  · OAuth access token · clinFHIR"
---

{% raw %}<h2>Stream: <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/index.html">clinFHIR</a></h2>
<h3>Topic: <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html">OAuth access token</a></h3>

<hr>

<base href="https://chat.fhir.org">

<head><link href="https://fhir.github.io/chat-archive/style.css" rel="stylesheet"></head>

<a name="212310462"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212310462" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212310462">(Oct 05 2020 at 14:54)</a>:</h4>
<p>Is there a straightforward way to use an OAuth access token with clinFHIR?</p>
<p>A minimal implementation would involve adding an "Authorization: Bearer &lt;access_token&gt;" header to outbound FHIR API requests.</p>



<a name="212338194"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212338194" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212338194">(Oct 05 2020 at 18:27)</a>:</h4>
<p>Not at the moment - which module are you thinking of? Patient Viewer? Wouldn't be hard to do that. (I've been meaning to do the full SMART thing some time so this might be an interim step )...</p>



<a name="212342833"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212342833" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212342833">(Oct 05 2020 at 19:03)</a>:</h4>
<p><a href="https://microsoft-healthcare-madison.github.io/patient-lists-demo/">https://microsoft-healthcare-madison.github.io/patient-lists-demo/</a> has an example of this kind of thing under "settings" -- <br>
<a href="/user_uploads/10155/g1Ysv3dmq3Kome8VafDOQLhL/image.png">image.png</a>  lets you just paste in a token if you happen to be connecting to a server that needs one.</p>
<div class="message_inline_image"><a href="/user_uploads/10155/g1Ysv3dmq3Kome8VafDOQLhL/image.png" title="image.png"><img src="/user_uploads/10155/g1Ysv3dmq3Kome8VafDOQLhL/image.png"></a></div><p>H/T <span class="user-mention" data-user-id="233081">@Carl Anderson</span></p>



<a name="212347012"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212347012" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212347012">(Oct 05 2020 at 19:41)</a>:</h4>
<p>Something like that would be great.</p>



<a name="212347790"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212347790" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212347790">(Oct 05 2020 at 19:49)</a>:</h4>
<p>Yes, the Patient Viewer module.</p>



<a name="212510795"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212510795" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212510795">(Oct 07 2020 at 03:07)</a>:</h4>
<p>OK - will get on to it...</p>



<a name="212932614"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212932614" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212932614">(Oct 10 2020 at 20:09)</a>:</h4>
<p>Ok - all done (and thanks to help from <span class="user-mention" data-user-id="191926">@Joel Schneider</span> for investigation work).  If you use the Patient Viewer module, when you click the 'Select Patient' button then at the bottom of the dialog is a text box where you can enter an Access Token. The token is stored in the browser memory and will be supplied in the Authorization header of any subsequest request in Patient Viewer.</p>
<p>Interestingly, adding this header causes AngularJS (which  clinFHIR is written in) to generate an HTTP OPTIONS request  - which the server must support as part of CORS. Turns out you need to do a little bit of Hapi configuration to support this. </p>
<p>This doesn't work:</p>
<div class="codehilite"><pre><span></span><code> CorsInterceptor corsInterceptor = new CorsInterceptor();
</code></pre></div>


<p>This does:</p>
<div class="codehilite"><pre><span></span><code>CorsConfiguration corsConfiguration = new CorsConfiguration();
corsConfiguration.applyPermitDefaultValues();
corsConfiguration.setAllowedMethods(Arrays.asList(new String[] { &quot;*&quot; }));
CorsInterceptor corsInterceptor = new CorsInterceptor(corsConfiguration);
</code></pre></div>


<p>If people want, I can look to implement the full OAuth2 dance, but for now this should be enough...</p>



<a name="212952946"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212952946" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212952946">(Oct 11 2020 at 07:14)</a>:</h4>
<p>Created a related hapi-fhir pull request here:<br>
<a href="https://github.com/jamesagnew/hapi-fhir/pull/2126">https://github.com/jamesagnew/hapi-fhir/pull/2126</a></p>



<a name="212955707"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/212955707" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joel Schneider <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#212955707">(Oct 11 2020 at 08:38)</a>:</h4>
<p>It would be best to also add relevant exposed headers to the custom CorsConfiguration, e.g.:</p>
<div class="codehilite"><pre><span></span><code>corsConfiguration.setExposedHeaders(Arrays.asList(new String[] {
    &quot;Content-Location&quot;,
    &quot;Date&quot;,
    &quot;ETag&quot;,
    &quot;Location&quot;,
    &quot;X-Request-Id&quot;,
    &quot;X-Correlation-Id&quot;
}));
</code></pre></div>



<a name="213050364"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/213050364" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#213050364">(Oct 12 2020 at 15:07)</a>:</h4>
<blockquote>
<p>Interestingly, adding this header causes AngularJS (which clinFHIR is written in) to generate an HTTP OPTIONS request</p>
</blockquote>
<p>It's actually more basic -- this is standard, automatic browser behavior for requests that can't be considered "simple requests". <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Simple_requests">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Simple_requests</a> has a good overview.</p>



<a name="213064035"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/213064035" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#213064035">(Oct 12 2020 at 17:11)</a>:</h4>
<p>Thanks Josh! Joel has also suggested a shift to HTTPS - something I've been thinking about, but  should really move on. Main complication I'm anticipating is accessing plain HTTP servers - IIRC the browser displays a warning when that happens...</p>



<a name="213065670"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/213065670" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#213065670">(Oct 12 2020 at 17:27)</a>:</h4>
<p>Yeah, one possibility is to offer https-or-not, by hosting your app at https: and http: endpoints.</p>



<a name="213065685"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/213065685" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#213065685">(Oct 12 2020 at 17:27)</a>:</h4>
<p>We do this for <a href="http://launch.smarthealthit.org/">http://launch.smarthealthit.org/</a> and <a href="https://launch.smarthealthit.org/">https://launch.smarthealthit.org/</a></p>



<a name="213067725"></a>
<h4><a href="https://chat.fhir.org#narrow/stream/179176-clinFHIR/topic/OAuth%20access%20token/near/213067725" class="zl"><img src="https://fhir.github.io/chat-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Hay <a href="https://fhir.github.io/chat-archive/stream/179176-clinFHIR/topic/OAuth.20access.20token.html#213067725">(Oct 12 2020 at 17:49)</a>:</h4>
<p>Will give that a try...</p>


{% endraw %}
<hr><p>Last updated: Apr 12 2022 at 19:14 UTC</p>
