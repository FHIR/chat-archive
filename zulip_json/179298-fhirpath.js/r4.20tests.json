[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196799\">@Nikolay Artamonov</span> I was about to work on adding the r4 tests, and Nicola said the two of you had discussed something like that.  I was going to write a script to convert the patient xml resource into JSON, and then another script to convert <a href=\"https://github.com/hl7-fhir/fhir-svn/blob/master/tests/resources/tests-fhir-r4.xml\" target=\"_blank\" title=\"https://github.com/hl7-fhir/fhir-svn/blob/master/tests/resources/tests-fhir-r4.xml\">https://github.com/hl7-fhir/fhir-svn/blob/master/tests/resources/tests-fhir-r4.xml</a> into yaml, and add some code to test/fhirpath.test.js to read the yaml and run its tests.  I would add support for an \"exclude\" option on the test groups and also the individual tests, so we can turn off the tests for the parts we don't (yet) support.</p>\n<p>However, if you were already planning to do this, then I will happily let you handle that and I will and move on to another part of the FHIRPath spec.</p>",
        "id": 153994306,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1536331580
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span>  Today I start writing script to convert fhir-r4.xml into yaml, so I can do this part.</p>",
        "id": 153994309,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1536331969
    },
    {
        "content": "<p>I think, we can push this code into repo in a separate folder</p>",
        "id": 153994310,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1536332015
    },
    {
        "content": "<p>Yes, I was thinking of test/bin for test-related utility scripts, and maybe test/r4 for r4 tests.<br>\n<span class=\"user-mention\" data-user-id=\"196799\">@Nikolay Artamonov</span>  Sounds good-- I will wait for your changes.</p>",
        "id": 153994311,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1536332147
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191318\">@nicola (RIO/SS)</span> converter code?</p>",
        "id": 153994313,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1536332211
    },
    {
        "content": "<p>Yes  - so we can re-run it later on next version of FHIR xml :)</p>",
        "id": 153994314,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1536332247
    },
    {
        "content": "<p>I think I had found an npm package for reading XML.  I can't remember which one.</p>",
        "id": 153995865,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1536693822
    },
    {
        "content": "<p><span class=\"emoji emoji-1f44d\" title=\"+1\">:+1:</span>  This is one time job - please add it to devDeps</p>",
        "id": 153995866,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1536693888
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196799\">@Nikolay Artamonov</span>  I think it was <a href=\"https://www.npmjs.com/package/xml2js\" target=\"_blank\" title=\"https://www.npmjs.com/package/xml2js\">https://www.npmjs.com/package/xml2js</a>, which seems popular.</p>",
        "id": 153995932,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1536702401
    },
    {
        "content": "<p>Thx <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span> , I will try it</p>",
        "id": 153996206,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1536754531
    },
    {
        "content": "<p>I hate babel - do we really need it - it blows the project :( Can we do it without babel?</p>",
        "id": 153997503,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1537239596
    },
    {
        "content": "<p>Oh, ok ( I will remove it</p>",
        "id": 153997609,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537279894
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span>  I push some changes, can U review ?</p>",
        "id": 153997621,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537284037
    },
    {
        "content": "<p>Thanks-- will do.</p>",
        "id": 153997630,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537284823
    },
    {
        "content": "<p>I can't find inputfile - patient-example.xml in HL7 repos, it's this Patient-example file <a href=\"https://www.hl7.org/fhir/patient-example.json.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/patient-example.json.html\">https://www.hl7.org/fhir/patient-example.json.html</a> ?</p>",
        "id": 153997647,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537287667
    },
    {
        "content": "<p>It is here: <a href=\"https://github.com/FHIR/fluentpath/blob/master/spec/tests.zip\" target=\"_blank\" title=\"https://github.com/FHIR/fluentpath/blob/master/spec/tests.zip\">https://github.com/FHIR/fluentpath/blob/master/spec/tests.zip</a></p>",
        "id": 153997654,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537289340
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196799\">@Nikolay Artamonov</span> PR approved; now we are just waiting on the second review.  I think the converter you've written is enough for one PR.  The work to actually integrate the converted tests can be a separate PR.<br>\n<span class=\"user-mention\" data-user-id=\"191318\">@nicola (RIO/SS)</span> Will you be able to review Nikolay's PR soon? (<a href=\"https://github.com/lhncbc/fhirpath.js/pull/58\" target=\"_blank\" title=\"https://github.com/lhncbc/fhirpath.js/pull/58\">https://github.com/lhncbc/fhirpath.js/pull/58</a>)</p>",
        "id": 153997705,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537294549
    },
    {
        "content": "<p>Thx <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span> !  Generated yaml test file contains 2k lines, think we should split it? For patient-example.xml  - need another converter?</p>",
        "id": 153997710,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537294963
    },
    {
        "content": "<p>I don't think we should split it up.  However, I just \"unapproved\" your pull request by requesting another change.  We need to capture the value of inputfile for each test.  If search the test XML file, you will see some tests that use something other than patient-example.xml.</p>\n<p>I am hoping we don't have to convert patient-example.xml.  I have posted a question on the fhirpath.js stream.</p>",
        "id": 153997733,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537299339
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196799\">@Nikolay Artamonov</span> Following Bryn's example, I was able to get the patient example loaded here:  <a href=\"http://hapi.fhir.org/baseDstu3/Patient/example\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Patient/example\">http://hapi.fhir.org/baseDstu3/Patient/example</a> although I had to change the organization ID to match one actually on the FHIR server.  I guess it would probably be better to change it back to one after you copy that.</p>",
        "id": 153997840,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537308137
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span>  How we should update test with value of input file ?  I our tests data-structure saved in test file or we can connect it from another file?</p>",
        "id": 153998063,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537362194
    },
    {
        "content": "<p>The tests should just have \"inputfile: [name of file]\".   I guess for \"[name of file]\", you could replace \".xml\" with \".json\".  Then, add the JSON resources the tests need as separate files (maybe in a subdirectory).  See Bryn's response at: <a href=\"#narrow/stream/115-fhirpath/subject/JSON.20version.20of.20FHIRPath.20tests.3F\" title=\"#narrow/stream/115-fhirpath/subject/JSON.20version.20of.20FHIRPath.20tests.3F\">https://chat.fhir.org/#narrow/stream/115-fhirpath/subject/JSON.20version.20of.20FHIRPath.20tests.3F</a> for where to find the files (note the \"raw\" link).</p>",
        "id": 153998081,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537364136
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>  - desc: &#39;** test&#39;\n    inputfile: patient-example.json\n    expression: 1 | 1 is Integer\n    result:\n      - true\n</pre></div>\n\n\n<p>looks ok?</p>",
        "id": 153998276,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537376189
    },
    {
        "content": "<p>or</p>\n<div class=\"codehilite\"><pre><span></span>  - desc: &#39;** test&#39;\n  - inputfile: patient-example.json\n    expression: 1 | 1 is Integer\n    result:\n      - true\n</pre></div>",
        "id": 153998277,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537376305
    },
    {
        "content": "<p>Also thinks we should convert json into yaml, isn't?</p>",
        "id": 153998283,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537378090
    },
    {
        "content": "<p>I don't think we should bother converting the JSON resources into YAML.  It is better to stick with the format we get from the FHIR build.</p>\n<p>Regarding the test formats above, I think the first is correct, because for each test there is a description and an input file.</p>",
        "id": 153998331,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537381485
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span>  how we connect json resouce files with yaml test cases? Convert and manually past in? Can test file include more than one \"subject\" ?</p>",
        "id": 153998359,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537385903
    },
    {
        "content": "<p>Yes, more than one subject (potentially a different one for each test).  The test processing code will have to be modified to handle the new \"inputfile\" property.  When it finds a new inputfile, it will load it and use it as the subject for the test.  (It can cache the loaded files, because they won't change.)  But, this change should be done in a separate pull request.  All was I hoping for in this one was the inclusion of the \"inputfile\" parameter in the test definition file, and perhaps the JSON resources.  Since your changes in this PR have already been reviewed, I don't want to add a bunch of new code changes for the processing in the same PR.</p>",
        "id": 153998360,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537386122
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196799\">@Nikolay Artamonov</span> Now that that is merged, are you planning to revise our test running code to work with the converted fhir-r4.xml?<br>\n I was thinking the converted test file could be checked in as fhir-r4.json, and then we could disable groups or individual tests with some additional property (e.g., disable: false) for things we do not yet support.</p>",
        "id": 153998701,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537464476
    },
    {
        "content": "<p>Why json? We convert into yaml, and how we will include input files data?</p>",
        "id": 153998725,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537472462
    },
    {
        "content": "<p>Right, yaml for the tests.   When the test processor reads a test with an \"inputfile\" property, it will load that file (if not already loaded) and use it as the subject for the test.</p>",
        "id": 153998732,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537473050
    },
    {
        "content": "<p>Input load file already done? So we should convert json inputfile data to yaml, right?</p>",
        "id": 153998741,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537474297
    },
    {
        "content": "<p>The inputfile values are the filenames you added under test/resources.  I think you should leave those as JSON and have  fhirpath.test.js<br>\n read them in as needed to execute the expressions in the converted yaml from the standard r4 tests.</p>",
        "id": 153998762,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537476297
    },
    {
        "content": "<p>I add converted r4 test with disabled not implemented functions</p>",
        "id": 153999388,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1537777806
    },
    {
        "content": "<p>Thanks-- I took a quick look just now and it looks good, but I will go through it in more detail.  I added <span class=\"user-mention\" data-user-id=\"191318\">@nicola (RIO/SS)</span>  as a reviewer.</p>",
        "id": 153999448,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1537803910
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span> <span class=\"user-mention\" data-user-id=\"191318\">@nicola (RIO/SS)</span>  What are my next steps?</p>",
        "id": 154000319,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1538064613
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196799\">@Nikolay Artamonov</span>  On the pull request, did you see the comment about preserving the test structure (groups of tests)?</p>",
        "id": 154000343,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1538067119
    },
    {
        "content": "<p>Yes, ok I will do it =)</p>",
        "id": 154001926,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1538241262
    },
    {
        "content": "<p>Great-- thanks!</p>",
        "id": 154002212,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1538251207
    },
    {
        "content": "<p>What mean \"focus\" option in tests?</p>",
        "id": 154004468,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1538487877
    },
    {
        "content": "<p>I implement grops of tests.<br>\n<a href=\"https://www.dropbox.com/s/nkz1ol1psg6ef64/Screenshot%202018-10-02%2021.19.10.png?dl=0\" target=\"_blank\" title=\"https://www.dropbox.com/s/nkz1ol1psg6ef64/Screenshot%202018-10-02%2021.19.10.png?dl=0\">https://www.dropbox.com/s/nkz1ol1psg6ef64/Screenshot%202018-10-02%2021.19.10.png?dl=0</a></p>\n<div class=\"message_inline_image\"><a href=\"https://www.dropbox.com/s/nkz1ol1psg6ef64/Screenshot%202018-10-02%2021.19.10.png?dl=0\" target=\"_blank\" title=\"\"><img src=\"https://www.dropbox.com/s/nkz1ol1psg6ef64/Screenshot%202018-10-02%2021.19.10.png?dl=1\"></a></div>",
        "id": 154004839,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1538504389
    },
    {
        "content": "<p>The screenshot looks good!  \"focus\" means \"run this test (or group)\".  There is a flag in the the test runner that tells it to only run the focused tests (or groups).</p>",
        "id": 154005352,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1538578891
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span> can you check my last changes in pr ?</p>",
        "id": 154006633,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1538986580
    },
    {
        "content": "<p>Yes-- sorry for the delay on that.  I will do it today.<br>\nI suppose it would best to disable the tests that are failing for now (since it is from new tests rather than new code) so we can get it merged.</p>",
        "id": 154006990,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1539093246
    },
    {
        "content": "<p>I disable tests which are failed with not implemented parts.</p>",
        "id": 154007014,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1539099859
    },
    {
        "content": "<p>Another failed tests - looks like we have bugs in the implementations</p>",
        "id": 154007027,
        "sender_full_name": "Nikolay Artamonov",
        "timestamp": 1539101334
    },
    {
        "content": "<p>Yes, clearly we do have some bugs, and your tests are showing that.  What I am suggesting is that we disable those too, so we can go ahead and merge your tests in.  Then, as we have time, we can re-enable those tests and fix the issues.  It will be easier for me to run your tests if they are merged and part of the branch I am working on.</p>",
        "id": 154007038,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1539102921
    },
    {
        "content": "<p>Reviewed commits.</p>",
        "id": 154007059,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1539104998
    }
]