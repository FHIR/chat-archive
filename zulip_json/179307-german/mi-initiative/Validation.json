[
    {
        "content": "<p>Welche Werkzeuge benutzt ihr zur Validierung ? Irgendwas in eurem FHIR-Server integriertes, einen eigenen Service, Code-Komponente im ETL ?</p>",
        "id": 228560130,
        "sender_full_name": "Georg Fette",
        "timestamp": 1614763287
    },
    {
        "content": "<p>Die HAPI Lib bietet zB einen Validator, den wir bisher gerne in unseren Unit- und CI-Tests nutzen: <a href=\"https://hapifhir.io/hapi-fhir/docs/validation/introduction.html\">https://hapifhir.io/hapi-fhir/docs/validation/introduction.html</a></p>",
        "id": 228564085,
        "sender_full_name": "Marvin Kampf",
        "timestamp": 1614765293
    },
    {
        "content": "<p>Im Simplifier von firely kann man ebenfalls Validieren.</p>\n<p>Dazu gleich noch eine Frage:<br>\nIch habe beim Validieren eine QuestionaireResponse-json gegen ein entsprechenden Profil validiert und den folgenden Fehler bekommen:<br>\nInvariant : Instance failed constraint qrs-1 \"Nested item can't be beneath both item and answer\"<br>\nRule: (answer.exists() and item.exists()).not()<br>\nQuestionnaireResponse.item[1].item[1]</p>\n<p>Kann mir da jemand einen Tipp geben, wie dies zu deuten ist. Offensichtlich geht es um die erlaubte Struktur aus Items und Answers. Beide habe ich eigentlich nicht auf einer  Ebene platziert, falls es das ist, worauf der Fehler hinweist...</p>",
        "id": 228778300,
        "sender_full_name": "Andreas Dürschmid",
        "timestamp": 1614867133
    },
    {
        "content": "<p>Kannst du die Ressource mal teilen? (z.B. hier <a href=\"https://simplifier.net/snippet\">https://simplifier.net/snippet</a>)</p>",
        "id": 228780934,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1614868083
    },
    {
        "content": "<p>Funktioniert das so?<br>\n<a href=\"https://simplifier.net/snippet/andreasdrschmid/1\">https://simplifier.net/snippet/andreasdrschmid/1</a></p>",
        "id": 228783924,
        "sender_full_name": "Andreas Dürschmid",
        "timestamp": 1614869115
    },
    {
        "content": "<p>Die Regel besagt, dass ein item entweder ein nested item haben kann oder eine answer. Beides gleichzeitig wie in deinem Beispiel geht nicht.</p>",
        "id": 229627447,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1615368778
    },
    {
        "content": "<p>item[1].item[1].answer (L:47)<br>\nund: item[1].item[1].item[0].answer[0].item (L:59) widersprechen dieser Regel</p>",
        "id": 229629447,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1615369735
    },
    {
        "content": "<p>So habe ich das auch verstanden, ging aber davon aus, die Ressource entsprechend angepasst zu haben. <br>\nJetzt habe ich aber den einen Punkt doch noch gefunden, den ich bisher immer übersehen hatte:</p>\n<p>\"linkId\": \"2.2\",<br>\n          \"text\": \"Infektion des kardiovaskulären Systems\",<br>\n          \"answer\": [<br>\n            {<br>\n              \"valueBoolean\": \"true\"<br>\n            }<br>\n          ],<br>\n          \"item\": [<br>\n            {<br>\n              \"linkId\": \"2.2.1\",<br>\n              \"text\": \"falls Infektion des kardiovaskulären Systems\",<br>\n              \"answer\": [</p>",
        "id": 229832486,
        "sender_full_name": "Andreas Dürschmid",
        "timestamp": 1615461581
    },
    {
        "content": "<p>Das wäre dann Zeile 47 bzw. 52 wie oben geschrieben, danke dafür. L:59 ist mir noch nicht ganz klar, wenn es dort ein Problem gibt. Dieses Konstrukt kommt dann ja auch später noch vor.</p>",
        "id": 229833078,
        "sender_full_name": "Andreas Dürschmid",
        "timestamp": 1615461925
    },
    {
        "content": "<p>Hatte schonmal jemand erfolg damit gegen die MII-Profile via HAPI-FHIR-Server zu validieren? Ein naives setzen der Umgebungsvariablen für Version 5.3.0 wie folgt:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">     # </span>https://github.com/hapifhir/hapi-fhir-jpaserver-starter/blob/master/src/main/resources/application.yaml#L46\n<span class=\"go\">      HAPI_FHIR_IMPLEMENTATIONGUIDES_MIILABOR_URL: \"https://packages.simplifier.net/de.medizininformatikinitiative.kerndatensatz.laborbefund/1.0.2\"</span>\n<span class=\"go\">      HAPI_FHIR_IMPLEMENTATIONGUIDES_MIILABOR_NAME: \"de.medizininformatikinitiative.kerndatensatz.laborbefund\"</span>\n<span class=\"go\">      HAPI_FHIR_IMPLEMENTATIONGUIDES_MIILABOR_VERSION: \"1.0.2\"</span>\n</code></pre></div>\n<p>schlug mit</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">ca.uhn.fhir.jpa.packages.ImplementationGuideInstallationException: Error installing IG de.medizininformatikinitiative.kerndatensatz.laborbefund#1.0.2: ca.uhn.fhir.jpa.packages.ImplementationGuideInstallationException: Failure when generating snapshot of StructureDefinition: null</span>\n</code></pre></div>\n<p>fehl. Auch wenn ich unter &lt;<a href=\"https://packages.simplifier.net/de.medizininformatikinitiative.kerndatensatz.laborbefund/1.0.2\">https://packages.simplifier.net/de.medizininformatikinitiative.kerndatensatz.laborbefund/1.0.2</a>&gt; den IG direkt als tgz herunterladen konnte - zumindest via browser.</p>",
        "id": 230371493,
        "sender_full_name": "Christian Gulden",
        "timestamp": 1615824264
    },
    {
        "content": "<p>... noch etwas weiter runtergescrollt im stacktrace und dann den konkreten Fehler:</p>\n<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"go\">org.hl7.fhir.exceptions.FHIRException: Illegal path 'Laborbefund' in differential in https://www.medizininformatik-initiative.de/fhir/core/modul-labor/StructureDefinition/LogicalModel/Laborbefund: must start with https://www.medizininformatik-initiative.de/fhir/core/StructureDefinition/Laborbefund. (or be 'https://www.medizininformatik-initiative.de/fhir/core/StructureDefinition/Laborbefund')</span>\n</code></pre></div>",
        "id": 230491065,
        "sender_full_name": "Christian Gulden",
        "timestamp": 1615891445
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span>  Da müsste das LogicalModel angepasst werden? Oder ist der Validator da zu streng?</p>",
        "id": 230492938,
        "sender_full_name": "Noemi Deppenwiese",
        "timestamp": 1615892519
    },
    {
        "content": "<p>Ich meine, wir müssen die LogicalModels anpassen, damit die HAPI package imports wieder funktionieren. Der type muss das erste Element im Differential matchen.</p>",
        "id": 230672236,
        "sender_full_name": "Julian Sass",
        "timestamp": 1615979258
    },
    {
        "content": "<p>Der Validator ist hier nicht zu streng sondern falsch</p>",
        "id": 230676982,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1615981850
    },
    {
        "content": "<p>SDF-8 sagt ganz klar, dass für Logical Models der Path im Differential immer nur den gleichen Prefix haben muss jedoch nicht äquivalent zum Typ sein muss: <a href=\"http://hl7.org/fhir/structuredefinition.html#invs\">http://hl7.org/fhir/structuredefinition.html#invs</a></p>",
        "id": 230677164,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1615981946
    },
    {
        "content": "<p>Gerne kann das jemand mal in den Implementers werfen oder im entsprechenden Repo einen Bug Report aufmachen.</p>",
        "id": 230677215,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1615981984
    },
    {
        "content": "<p>Alles klar!</p>",
        "id": 230850862,
        "sender_full_name": "Noemi Deppenwiese",
        "timestamp": 1616068920
    },
    {
        "content": "<p><a href=\"#narrow/stream/179307-german.2Fmi-initiative/topic/.5BPerson.5D.20usw.2E.20Meldungen.20im.20validator.2Ejar\">https://chat.fhir.org/#narrow/stream/179307-german.2Fmi-initiative/topic/.5BPerson.5D.20usw.2E.20Meldungen.20im.20validator.2Ejar</a><br>\nSorry, das wollte ich längst gemacht haben :| ... hat inzwischen schon jemand das Problem berichtet?</p>",
        "id": 231290681,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1616410159
    },
    {
        "content": "<p>Nicht das ich mitbekommen hätte</p>",
        "id": 231349375,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1616433345
    },
    {
        "content": "<p>Ist jetzt als Issue eingetragen: <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/issues/466\">https://github.com/hapifhir/org.hl7.fhir.core/issues/466</a></p>",
        "id": 231473889,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1616507760
    },
    {
        "content": "<p>Moin, es gibt eine <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/issues/466#issuecomment-832327973\">Rückmeldung</a> hierzu von Graham: <code>Resolved. But note that there's a problem with that logical model which becomes evident once that issue is resolved, which is that the first element in the differential has a type and it should not have</code></p>",
        "id": 237619867,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1620287707
    },
    {
        "content": "<p>Sehe ich ein wenig anders: sdf-15a \"If the first element in a differential has no \".\" in the path and it's not a logical model, it has no type\". <a href=\"https://www.hl7.org/fhir/structuredefinition.html#invs\">https://www.hl7.org/fhir/structuredefinition.html#invs</a></p>",
        "id": 237883992,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1620418539
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"196715\">Marvin Kampf</span> <a href=\"#narrow/stream/179307-german.2Fmi-initiative/topic/Validation/near/228564085\">said</a>:</p>\n<blockquote>\n<p>Die HAPI Lib bietet zB einen Validator, den wir bisher gerne in unseren Unit- und CI-Tests nutzen: <a href=\"https://hapifhir.io/hapi-fhir/docs/validation/introduction.html\">https://hapifhir.io/hapi-fhir/docs/validation/introduction.html</a></p>\n</blockquote>\n<p>Ich scheitere aktuell daran, der Library de.gecco in Version 1.0.3 unterzuschieben. Seid ihr da auch erfolgreich gewesen?</p>",
        "id": 247913400,
        "sender_full_name": "Florian Seidel",
        "timestamp": 1627906336
    },
    {
        "content": "<p>was ist der Fehler?</p>",
        "id": 248959567,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1628589340
    },
    {
        "content": "<p>Ich stoße auf vergleichsweise viele falsch negative Ergebnisse:<br>\nBeispielsweise validiert das Chronic LungDiseases Example nicht mit folgenden Fehlern:<br>\n    ERROR at Condition.verificationStatus - Unknown code '<a href=\"http://snomed.info/sct#410605003\">http://snomed.info/sct#410605003</a>'<br>\n    WARNING at Condition.category[0] - Keiner der angegebenen Codes ist im Valueset <a href=\"http://hl7.org/fhir/ValueSet/condition-category\">http://hl7.org/fhir/ValueSet/condition-category</a> (<a href=\"http://hl7.org/fhir/ValueSet/condition-category\">http://hl7.org/fhir/ValueSet/condition-category</a>, und ein Code sollte aus diesem Valueset stammen, es sei denn, er enthÃ¤lt keinen geeigneten Code) (Codes = <a href=\"http://snomed.info/sct#418112009\">http://snomed.info/sct#418112009</a>)</p>\n<p>Die ValidationSupportChain bau ich wie folgt:</p>\n<div class=\"codehilite\"><pre><span></span><code>    ValidationSupportChain supportChain = new ValidationSupportChain();\n    supportChain.addValidationSupport(new DefaultProfileValidationSupport(ctx));\n    PrePopulatedValidationSupport prePopulatedSupport = new PrePopulatedValidationSupport(ctx);\n    // Alle StructureDefinitions, CodeSysteme und ValueSets aus dem de.gecco#1.0.3 package und den zugehörigen Dependencies\n    factory.codeSystems.forEach(prePopulatedSupport::addCodeSystem);\n    factory.valueSets.forEach(prePopulatedSupport::addValueSet);\n    factory.structureDefinitions.forEach(prePopulatedSupport::addStructureDefinition);\n    supportChain.addValidationSupport(prePopulatedSupport);\n    supportChain.addValidationSupport(new CommonCodeSystemsTerminologyService(ctx));\n    // Implementierung des RemoteTerminologyServiceWithAuthSupport welcher ein Client Certificate mitgeben kann\n    RemoteTerminologyServiceWithAuthValidationSupport tx = new RemoteTerminologyServiceWithAuthValidationSupport(ctx);\n    tx.getFhirContext().setRestfulClientFactory(new ApacheRestfulClientWithClientCertFactory(ctx, keystorepath, keyStorePassword, keyPassword));\n    tx.setBaseUrl(terminologyServerBaseUrl);\n    supportChain.addValidationSupport(tx);\n    supportChain.addValidationSupport(new InMemoryTerminologyServerValidationSupport(ctx));\n    supportChain.addValidationSupport(new SnapshotGeneratingValidationSupport(ctx));\n    CachingValidationSupport cache = new CachingValidationSupport(supportChain);\n    FhirInstanceValidator validatorModule = new FhirInstanceValidator(cache);\n</code></pre></div>",
        "id": 249078247,
        "sender_full_name": "Florian Seidel",
        "timestamp": 1628668523
    },
    {
        "content": "<p>Ah, die errors on unknown CS bekommt man weg indem man als letztes einen <code>UnknownCodeSystemWarningValidationSupport</code>in die ValidationChain hängt.</p>",
        "id": 249078861,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1628668948
    },
    {
        "content": "<p>(btw: den SnapShotValidationSupport sollte man als erstes Element in die Chain hängen)</p>",
        "id": 249078892,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1628668977
    },
    {
        "content": "<p>Ändert leider nichts :/</p>\n<div class=\"codehilite\"><pre><span></span><code>    UnknownCodeSystemWarningValidationSupport ucswvs = new UnknownCodeSystemWarningValidationSupport(ctx);\n    ucswvs.setAllowNonExistentCodeSystem(true);\n    supportChain.addValidationSupport(ucswvs);\n</code></pre></div>",
        "id": 249082470,
        "sender_full_name": "Florian Seidel",
        "timestamp": 1628671515
    }
]