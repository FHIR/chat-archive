[
    {
        "content": "<p>I'm currently trying to pass the all Observation tests in the Single Patient API collection. When using only Observations with \"effectiveDateTime\", I get an (expected) warning saying that no resource was provided with effectivePeriod in it. However, as soon as I upload an Observation using effectivePeriod, I get the following error message:</p>\n<p>\"Invalid Observation: Observation.effective.ofType(Period): vs-1: if Observation.effective[x] is dateTime and has a value then that value shall be precise to the day [($this as dateTime).toString().length() &gt;= 8]\"</p>\n<p>The needed precision  is given. Any pointers on what might cause the issue? <a href=\"/user_uploads/10155/6bgX4U6Oh95izNath90jmE1T/pediatric-weight-for-height-test.json\">pediatric-weight-for-height-test.json</a></p>",
        "id": 215353634,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1604339275
    },
    {
        "content": "<p>This is a constraint defined in <a href=\"http://hl7.org/fhir/R4/vitalsigns.html#10.1.20.2.3\">FHIR Vital Sign Profile</a>: <br>\n<a href=\"/user_uploads/10155/YMIdq4YjsaHYcXW92uPN-TTO/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/YMIdq4YjsaHYcXW92uPN-TTO/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/YMIdq4YjsaHYcXW92uPN-TTO/image.png\"></a></div>",
        "id": 215354874,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1604339808
    },
    {
        "content": "<p>I am not sure if this FHIRPath is correct. When the value is Period type, <code>($this as dateTime)</code> would return empty based on my limited knowledge about FHIRPath. Maybe <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  can weight in on this</p>",
        "id": 215355157,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1604339918
    },
    {
        "content": "<p>What would be the recommendation going forward?</p>",
        "id": 215600436,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1604505193
    },
    {
        "content": "<p>We are still looking into this.  We had just updated our reference data set to include effectivePeriod, and ran into the exact problem you are seeing, which makes me think it is a problem with the FHIRPath in the vital-sign profile, or the HL7 Validator (and not your data).  But we are still looking into it.</p>",
        "id": 215617246,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1604512131
    },
    {
        "content": "<p>Thank you for the update!</p>",
        "id": 215617367,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1604512197
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> -- does this invariant look right to you?</p>",
        "id": 215617594,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1604512311
    },
    {
        "content": "<p>I'm no fhirpath expert but lemme test it and see. ( Suprised it has been undiscovered this long.)</p>",
        "id": 215621620,
        "sender_full_name": "Eric Haas",
        "timestamp": 1604514164
    },
    {
        "content": "<p>I think it needs  to be:</p>\n<p><code>Observation.effectiveDateTime implies Observation.effectiveDateTime.toString().length() &gt;= 8</code></p>\n<p>I am not in front of a PC to test it out  (not aware of OSX testing tools)</p>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  ?</p>\n<p>Made a tracker to correct <a href=\"http://jira.hl7.org/browse/FHIR-29654\">J#29654</a></p>",
        "id": 215628048,
        "sender_full_name": "Eric Haas",
        "timestamp": 1604517230
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>!  Not to jump ahead, but assuming this is the problem/solution, would fixing this require a FHIR v4.0.2 be published?</p>",
        "id": 215631630,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1604519011
    },
    {
        "content": "<p>this is a FHIR4b or FHIR5</p>",
        "id": 215633547,
        "sender_full_name": "Eric Haas",
        "timestamp": 1604519918
    },
    {
        "content": "<p>There is a similar discussion <a href=\"#narrow/stream/179166-implementers/topic/Observation.20FHIRPath.20expressions.3F\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Observation.20FHIRPath.20expressions.3F</a></p>",
        "id": 215719455,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1604587027
    },
    {
        "content": "<p>I am concerned how long this will take to make it back into US Core <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>, if this kind of fix is targeted at FHIR4b/FHIR5.  I assume it will be some time before US Core is updated to point to FHIR4b/FHIR5?  And in the meantime the use of Observation.effectivePeriod is non-conformant (assuming the FHIRPath is wrong as we suspect).</p>",
        "id": 215722238,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1604588138
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> We also found the same FHIRPath is used in us-core-1 constraint in US Core Lab Result profile<br>\nI created <a href=\"http://jira.hl7.org/browse/FHIR-29658\">FHIR-29658</a> for US Core. Can you put it in discussion at next US Core call?</p>",
        "id": 215723561,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1604588638
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192576\">Robert Scanlon</span> <a href=\"#narrow/stream/179309-inferno/topic/Single.20Patient.20API.20Observation.20Tests/near/215722238\">said</a>:</p>\n<blockquote>\n<p>I am concerned how long this will take to make it back into US Core <span class=\"user-mention silent\" data-user-id=\"191401\">Eric Haas</span>, if this kind of fix is targeted at FHIR4b/FHIR5.  I assume it will be some time before US Core is updated to point to FHIR4b/FHIR5?  And in the meantime the use of Observation.effectivePeriod is non-conformant (assuming the FHIRPath is wrong as we suspect).</p>\n</blockquote>\n<p>I cannot do anything to speed up the process, w can't just change the core.   So need to deal with as a known issue.</p>",
        "id": 215738950,
        "sender_full_name": "Eric Haas",
        "timestamp": 1604594424
    },
    {
        "content": "<p>Here is the information I collected from different sources:</p>\n<ul>\n<li>Next FHIR release is R4B which will fix the the vs-1 constraint</li>\n<li>Next US Core release is Q2 2021 which will fix the us-core-1 constraint</li>\n<li>US Core 2021 release is based on R4 v4.0.1, not R4B<br>\nUnless there is way to back port this fix to R4 v4.0.1, this issue will not be fully addressed before US Core 2022 release.</li>\n</ul>",
        "id": 215887411,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1604688220
    },
    {
        "content": "<p>I agree that the FHIRPath is wrong</p>",
        "id": 216451992,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1605177780
    }
]