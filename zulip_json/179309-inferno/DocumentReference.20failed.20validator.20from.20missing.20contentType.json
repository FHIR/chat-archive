[
    {
        "content": "<p>Hey, continuing a conversation that was started here:</p>\n<p><a href=\"https://github.com/onc-healthit/onc-certification-g10-test-kit/issues/67\">https://github.com/onc-healthit/onc-certification-g10-test-kit/issues/67</a></p>\n<p>So here's another failure we're having when running the g10 tests. We have a DocumentReference being returned for a patient that has a status of entered-in-error, and thus we have no attachment that we want to return for the resource. Because of this, we are setting the data-absent-reason extensions on DocumentReference.content.attachment, DocumentReference.content.attachment.contentType, and <a href=\"http://DocumentReference.content.attachment.data\">DocumentReference.content.attachment.data</a>. The FHIR validator doesn't seem to like this, and it returns an error because we have no code in the contentType field. So is our implementation wrong to return data like this? Or is this something the validator needs to be updated to handle?</p>\n<p>Here's an example of the data that triggers this:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;custodian&quot;: {\n    &quot;reference&quot;: &quot;Organization/234124&quot;\n  },\n  &quot;resourceType&quot;: &quot;DocumentReference&quot;,\n  &quot;date&quot;: &quot;2017-01-01T00:00:00.000Z&quot;,\n  &quot;status&quot;: &quot;entered-in-error&quot;,\n  &quot;subject&quot;: {\n    &quot;reference&quot;: &quot;Patient/978124&quot;\n  },\n  &quot;content&quot;: [\n    {\n      &quot;attachment&quot;: {\n        &quot;extension&quot;: [\n          {\n            &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n            &quot;valueCode&quot;: &quot;unknown&quot;\n          }\n        ],\n        &quot;_data&quot;: {\n          &quot;extension&quot;: [\n            {\n              &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n              &quot;valueCode&quot;: &quot;unknown&quot;\n            }\n          ]\n        },\n        &quot;_contentType&quot;: {\n          &quot;extension&quot;: [\n            {\n              &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n              &quot;valueCode&quot;: &quot;unknown&quot;\n            }\n          ]\n        }\n      },\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n          &quot;valueCode&quot;: &quot;unknown&quot;\n        }\n      ]\n    }\n  ],\n  &quot;author&quot;: [\n    {\n      &quot;reference&quot;: &quot;Organization/1237648&quot;\n    }\n  ],\n  &quot;meta&quot;: {\n    &quot;security&quot;: [\n      {\n        &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v3-ActCode&quot;,\n        &quot;code&quot;: &quot;NOPAT&quot;,\n        &quot;display&quot;: &quot;no disclosure to patient, family or caregivers without attending provider&#39;s authorization&quot;\n      }\n    ]\n  },\n  &quot;identifier&quot;: [\n    {\n      &quot;system&quot;: &quot;https://fhir.athena.io/sid/ah-documentreference&quot;,\n      &quot;value&quot;: &quot;12489&quot;\n    }\n  ],\n  &quot;context&quot;: {\n    &quot;encounter&quot;: [\n      {\n        &quot;identifier&quot;: {\n          &quot;system&quot;: &quot;https://fhir.athena.io/sid/ah-encounter&quot;,\n          &quot;value&quot;: &quot;1039478&quot;\n        },\n        &quot;reference&quot;: &quot;Encounter/1239487&quot;\n      }\n    ],\n    &quot;period&quot;: {\n      &quot;end&quot;: &quot;2021-01-01&quot;,\n      &quot;start&quot;: &quot;2021-01-01&quot;\n    }\n  },\n  &quot;category&quot;: [\n    {\n      &quot;coding&quot;: [\n        {\n          &quot;system&quot;: &quot;http://hl7.org/fhir/us/core/CodeSystem/us-core-documentreference-category&quot;,\n          &quot;code&quot;: &quot;clinical-note&quot;,\n          &quot;display&quot;: &quot;Clinical Note&quot;\n        }\n      ]\n    }\n  ],\n  &quot;id&quot;: &quot;01927834&quot;,\n  &quot;type&quot;: {\n    &quot;coding&quot;: [\n      {\n        &quot;system&quot;: &quot;http://loinc.org&quot;,\n        &quot;code&quot;: &quot;75425-9&quot;,\n        &quot;display&quot;: &quot;Cardiology Diagnostic Study Note&quot;\n      }\n    ]\n  }\n}\n</code></pre></div>\n<p>and the error: </p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;text&quot;: {\n    &quot;status&quot;: &quot;extensions&quot;,\n    &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;table class=\\&quot;grid\\&quot;&gt;&lt;tr&gt;&lt;td&gt;&lt;b&gt;Severity&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Location&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Code&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Details&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Diagnostics&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Source&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;ERROR&lt;/td&gt;&lt;td/&gt;&lt;td&gt;Invalid Code&lt;/td&gt;&lt;td&gt;No code provided, and a code is required from the value set&lt;/td&gt;&lt;td/&gt;&lt;td&gt;No display for Extension&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&quot;\n  },\n  &quot;issue&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-line&quot;,\n          &quot;valueInteger&quot;: 29\n        },\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-col&quot;,\n          &quot;valueInteger&quot;: 27\n        },\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,\n          &quot;valueCode&quot;: &quot;InstanceValidator&quot;\n        }\n      ],\n      &quot;severity&quot;: &quot;error&quot;,\n      &quot;code&quot;: &quot;code-invalid&quot;,\n      &quot;details&quot;: {\n        &quot;text&quot;: &quot;No code provided, and a code is required from the value set&quot;\n      },\n      &quot;expression&quot;: [\n        &quot;DocumentReference.content[0].attachment.contentType&quot;\n      ]\n    }\n  ]\n}\n</code></pre></div>",
        "id": 278058793,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649266355
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191506\">@Yunwei Wang</span></p>",
        "id": 278058843,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649266373
    },
    {
        "content": "<p>interesting point. I would expect the profile is mostly targetting active DocumentReference, not entered-in-error.</p>",
        "id": 278059719,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649266748
    },
    {
        "content": "<p>I believe in this case the data is soft-deleted in our servers, which we've decided to represent as entered-in-error and not return the data</p>",
        "id": 278060294,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267028
    },
    {
        "content": "<p>I run the resource with HL7 fhir-validator jar. According to the result, you have to provide content-type code. You cannot use DAR extension there.</p>",
        "id": 278060451,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649267096
    },
    {
        "content": "<p>The tricky thing is that the content-type has a datatype of <code>code</code>.</p>",
        "id": 278060555,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649267156
    },
    {
        "content": "<p>Seems there should be a different profile expectation for entered-in-error. Not unusual for an instance that was formerly published that was eventually found to be wrong, to be marked as entered-in-error to notify previous readers that the data they pulled should be not relied upon, and not unusual for this instance to have all former element values blanked...   (vs delete, which is not very transparent).</p>",
        "id": 278060722,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649267233
    },
    {
        "content": "<p>Oh, I got it. contentType has a \"required\" binding. It shows in the \"Full View\". So you must provide a value from the bound valueset.</p>\n<p><a href=\"/user_uploads/10155/ZxvrPiOqhTB-2aUL2V4FwehW/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/ZxvrPiOqhTB-2aUL2V4FwehW/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/ZxvrPiOqhTB-2aUL2V4FwehW/image.png\"></a></div>",
        "id": 278061197,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649267461
    },
    {
        "content": "<p>right, so what do we do when there isn't actually any content we want to share?</p>",
        "id": 278061256,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267493
    },
    {
        "content": "<p>Seems like we could choose to leave the resource as-is but set the contentType to something. I don't see any mime types that correspond to empty data or null data, but I found a stack overflow page suggesting example/example could be used for this purpose</p>",
        "id": 278061310,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267517
    },
    {
        "content": "<p><a href=\"https://stackoverflow.com/a/56295737\">https://stackoverflow.com/a/56295737</a></p>",
        "id": 278061385,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267539
    },
    {
        "content": "<p>I run some test. These should work</p>\n<div class=\"codehilite\"><pre><span></span><code>  &quot;content&quot;: [\n    {\n      &quot;attachment&quot;: {\n        &quot;extension&quot;: [\n          {\n            &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n            &quot;valueCode&quot;: &quot;unknown&quot;\n          }\n        ]\n      },\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n          &quot;valueCode&quot;: &quot;unknown&quot;\n        }\n      ]\n    }\n  ],\n</code></pre></div>",
        "id": 278061627,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649267662
    },
    {
        "content": "<p>I think this is a failure of the specification, not the test tool. right?</p>",
        "id": 278061655,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649267681
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191506\">@Yunwei Wang</span> that however fails the US Core tests</p>\n<div class=\"codehilite\"><pre><span></span><code>        &quot;text&quot;: &quot;us-core-6: &#39;DocumentReference.content.attachment.url or  DocumentReference.content.attachment.data or both SHALL be present.&#39; Rule &#39;DocumentReference.content.attachment.url or  DocumentReference.content.attachment.data or both SHALL be present.&#39; Failed&quot;\n</code></pre></div>",
        "id": 278061764,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267733
    },
    {
        "content": "<p>aha!</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;content&quot;: [\n      {\n        &quot;attachment&quot;: {\n          &quot;extension&quot;: [\n            {\n              &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n              &quot;valueCode&quot;: &quot;unknown&quot;\n            }\n          ],\n          &quot;_url&quot;: {\n            &quot;extension&quot;: [\n              {\n                &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n                &quot;valueCode&quot;: &quot;unknown&quot;\n              }\n            ]\n          }\n        },\n        &quot;extension&quot;: [\n          {\n            &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n            &quot;valueCode&quot;: &quot;unknown&quot;\n          }\n        ]\n      }\n    ],\n</code></pre></div>",
        "id": 278061920,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267809
    },
    {
        "content": "<p>that passes everything</p>",
        "id": 278061932,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267816
    },
    {
        "content": "<p><span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 278061966,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649267831
    },
    {
        "content": "<p>so I think we can just switch to setting url to have the absent reason and remove content type and data</p>",
        "id": 278061981,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267839
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191404\">John Moehrke</span> <a href=\"#narrow/stream/179309-inferno/topic/DocumentReference.20failed.20validator.20from.20missing.20contentType/near/278061655\">said</a>:</p>\n<blockquote>\n<p>I think this is a failure of the specification, not the test tool. right?</p>\n</blockquote>\n<p>I'm not sure... seems like we have the option to work around this by using url instead of data + contentType</p>",
        "id": 278062175,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649267933
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> Is this the correct way to express a DocuemntReference without attachment? It valid (according to validator) but looks strange.</p>",
        "id": 278062314,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649268002
    },
    {
        "content": "<p>well, I took this discussion and decided that I will file an \"improvement opportunity\" for the parallel work using DocumentReference in IHE (aka MHD).</p>",
        "id": 278063025,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649268315
    },
    {
        "content": "<p>my teammate pointed out contentType seems to still be required even if url is provided instead of data...</p>",
        "id": 278063693,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649268646
    },
    {
        "content": "<p>Yes. you still need to provide contentType. My mistake. I didn't provide <code>-profile</code> parameter in my previous testings.</p>",
        "id": 278068003,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649270412
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"279806\">@Nathan Loyer</span> Your use case is similar to what discussed in this thread: <a href=\"#narrow/stream/179166-implementers/topic/Period.20Datatype.20Invariant\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Period.20Datatype.20Invariant</a></p>",
        "id": 278068839,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649270841
    },
    {
        "content": "<p>Is it correct for us-core-6 to be checked on an object that is indicated to be missing? That seems strange.</p>",
        "id": 278068982,
        "sender_full_name": "Andrew Feeney",
        "timestamp": 1649270911
    },
    {
        "content": "<p>I tried the latest validator_cli v5.6.40. It gives the same error.</p>",
        "id": 278070610,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649271669
    },
    {
        "content": "<p>Entered in error is not the same as missing  US Core latest guidance on entered in error data is here: <a href=\"http://build.fhir.org/ig/HL7/US-Core/general-guidance.html#representing-entered-in-error-and-deleted-information\">http://build.fhir.org/ig/HL7/US-Core/general-guidance.html#representing-entered-in-error-and-deleted-information</a></p>\n<p>and it states :</p>\n<blockquote>\n<p>Note this typically will not be conformant with the US Core or FHIR StructureDefinitions.</p>\n</blockquote>",
        "id": 278076324,
        "sender_full_name": "Eric Haas",
        "timestamp": 1649274441
    },
    {
        "content": "<p>nice... but then the profile should not allow entered-in-error status... right?</p>",
        "id": 278076527,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649274538
    },
    {
        "content": "<p>I guess it seems like you're suggesting if the status is entered-in-error then it is expected for the resource to not conform with the profile... but this data exists on a patient we intended to test with inferno for our certification, so... do we just not use this patient?</p>",
        "id": 278081257,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649276677
    },
    {
        "content": "<p>er, patient. I'll edit that</p>",
        "id": 278081293,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649276693
    },
    {
        "content": "<p>Yes, i am saying that when status is entered-in-error, it should not be tested against the profiles. Which Eric has found the text that indicates this.</p>",
        "id": 278150951,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649331913
    },
    {
        "content": "<p>it is unfortunate that the profiles do allow for entered-in-error, as that implies that they shall be compliant. But together the profile and the note indicate to me that entered-in-error might be compliant, but might not... therefore, no use in validating it.</p>",
        "id": 278151083,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649331993
    },
    {
        "content": "<p>Maybe inferno tests should be updated to turn fhir validator failures into warnings when the status is entered-in-error</p>",
        "id": 278198139,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649352185
    },
    {
        "content": "<p>Inferno has to follow the US Core v3.1.1 which is required by g10 test procedure. You can <br>\n1) raise a JIRA ticket on US Core IG asking to 'patch' US Core 3.1.1 with the same guidance as Eric quoted<br>\n2) raise a feedback to ONC to clarify the test procedure on error data</p>",
        "id": 278208713,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649357060
    },
    {
        "content": "<p>The us core 3.1.1 docs seem to say the same thing as the page Eric linked:<br>\n<a href=\"https://hl7.org/fhir/us/core/STU3.1.1/general-guidance.html#representing-entered-in-error-and-deleted-information\">https://hl7.org/fhir/us/core/STU3.1.1/general-guidance.html#representing-entered-in-error-and-deleted-information</a></p>",
        "id": 278220846,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649362815
    },
    {
        "content": "<p>I don't think any updates to the spec are needed</p>",
        "id": 278220883,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649362848
    },
    {
        "content": "<p>It doesn't have that note</p>\n<blockquote>\n<p>Note this typically will not be conformant with the US Core or FHIR StructureDefinitions.</p>\n</blockquote>\n<p>but it does have </p>\n<blockquote>\n<p>If the status is entered-in-error:<br>\nfor patient viewing systems the content of resource SHOULD be removed. In other words a blank resource.<br>\nA provider facing system MAY be supplied with additional details that the patient viewing system would typically not have access to.</p>\n</blockquote>\n<p>which seems to still be the spec saying that if the status is entered-in-error, then it wont be completely compliant with the profiles</p>",
        "id": 278221178,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649363007
    },
    {
        "content": "<p>IMO, this is why we have DAR extension. I know the problem here is the BCP code. Other than that, DAR should be used.</p>",
        "id": 278233669,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649369769
    },
    {
        "content": "<p>The intent of the spec and language was to always hide data that was potentially dangerous to show certain audiences. That is why we carved out the exceptions around entered-in-error. If a provider puts in data for the wrong patient and a patient facing application downloaded that data. The status was a way to cue that application to remove that resource. The intent was to only populate fields that were absolutely required to remain FHIR compliant and not to meet the requirements of the profile....</p>\n<p>IMO DAR is getting used a bit too much. Why populate a bunch of fields with DAR unknown? It bloats the resource and articulates nothing more than what the status already did.</p>",
        "id": 278317408,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649430273
    },
    {
        "content": "<p>I would agree there. We only add the DAR objects so our resources are compliant with the profiles.</p>",
        "id": 278319320,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649431134
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"279806\">Nathan Loyer</span> <a href=\"#narrow/stream/179309-inferno/topic/DocumentReference.20failed.20validator.20from.20missing.20contentType/near/278061920\">said</a>:</p>\n<blockquote>\n<p>aha!</p>\n<p><div class=\"codehilite\"><pre><span></span><code>&quot;content&quot;: [\n      {\n        &quot;attachment&quot;: {\n          &quot;extension&quot;: [\n            {\n              &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n              &quot;valueCode&quot;: &quot;unknown&quot;\n            }\n          ],\n          &quot;_url&quot;: {\n            &quot;extension&quot;: [\n              {\n                &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n                &quot;valueCode&quot;: &quot;unknown&quot;\n              }\n            ]\n          }\n        },\n        &quot;extension&quot;: [\n          {\n            &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;,\n            &quot;valueCode&quot;: &quot;unknown&quot;\n          }\n        ]\n      }\n    ],\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>So back to the issue at hand... I can't duplicate what I did the other day anymore... I think I might have accidentally scrolled up to much to a previous response or something. I don't have my cli logs for these runs anymore because I rebooted, and I can't replicate my success. So now we're back to the drawing board of what to do for this resource.</p>",
        "id": 278319483,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649431219
    },
    {
        "content": "<p>options that I am considering... </p>\n<ul>\n<li>add a contentType setting to something even though there is no content, could use example/example or something</li>\n<li>just hard delete this record so the tests pass</li>\n<li>convince yall to update inferno to not fail when a resource with status of entered-in-error resource fails profile validation</li>\n</ul>\n<p>My preference is the third item :) </p>\n<p><span class=\"user-mention silent\" data-user-id=\"191506\">Yunwei Wang</span> <a href=\"#narrow/stream/179309-inferno/topic/DocumentReference.20failed.20validator.20from.20missing.20contentType/near/278208713\">said</a>:</p>\n<blockquote>\n<p>Inferno has to follow the US Core v3.1.1 which is required by g10 test procedure. You can <br>\n1) raise a JIRA ticket on US Core IG asking to 'patch' US Core 3.1.1 with the same guidance as Eric quoted<br>\n2) raise a feedback to ONC to clarify the test procedure on error data</p>\n</blockquote>\n<p>Do you still think those items are necessary to change this? I feel like the current text of 3.1.1 says the same thing as what Eric quoted, albeit less explicitly.</p>",
        "id": 278320477,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649431691
    },
    {
        "content": "<p>I think Eric gave the golden quote...</p>",
        "id": 278321241,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649432043
    },
    {
        "content": "<p>Right, but that was in the us core 4.0.0 and above and not in 3.1.1</p>",
        "id": 278322223,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649432499
    },
    {
        "content": "<p>it does set precedence. and there is no way to change 3.1.1... right?</p>",
        "id": 278322394,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649432574
    },
    {
        "content": "<p><a href=\"http://hl7.org/fhir/us/core/STU3.1.1/general-guidance.html#representing-deleted-information\">http://hl7.org/fhir/us/core/STU3.1.1/general-guidance.html#representing-deleted-information</a><br>\nIf the status is entered-in-error:</p>\n<p>for patient viewing systems the content of resource SHOULD be removed. In other words a blank resource.</p>",
        "id": 278322509,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649432636
    },
    {
        "content": "<p>That language is in 3.1.1</p>",
        "id": 278322545,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649432643
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191404\">John Moehrke</span> <a href=\"#narrow/stream/179309-inferno/topic/DocumentReference.20failed.20validator.20from.20missing.20contentType/near/278322394\">said</a>:</p>\n<blockquote>\n<p>it does set precedence. and there is no way to change 3.1.1... right?</p>\n</blockquote>\n<p>I believe Yunwei's comments were specifying how we can get 3.1.1 updated to add this bit of clarity, but I'm trying to argue that the current text is sufficient to justify our interpretation.</p>",
        "id": 278322649,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649432694
    },
    {
        "content": "<p>First, the narrative in v4.0 is much better than v3.1.1. That is why I mentioned the narrative in v3.1.1 should be 'patched'</p>\n<p>I am concerned this could fundamentally change the FHIR validation. Should FHIR validator just ignore any resources with enter-in-error status? </p>\n<p>We should be very careful here. If a server only provides \"incomplete\" (I don't know what the correct phrase is to describe this use case) resources with enter-in-error status, does that server conforms to US Core IG? (<span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> )</p>\n<p>Even this is the intention of US Core, (g)(10) certification has higher bar than US Core. According to the test procedure</p>\n<div class=\"codehilite\"><pre><span></span><code>The health IT developer demonstrates the ability of the Health IT Module to respond with data that meet the following conditions:\nAll data elements indicated with a cardinality of one or greater and / or “must support” are included;\n</code></pre></div>\n<p>ONC has the final word on this test procedure requirement.</p>",
        "id": 278325425,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649433823
    },
    {
        "content": "<p>The correct course would be to log a JIRA to ONC for clarification on that language, but that language doesn't dictate or take into consideration of conditionality. That language is merely saying that the certified system must support every field that profile calls out. That language was probably included because of how everyone thinks of must support differently. It doesn't say that in the error example that every field must be populated that the profile calls out because the IG specifically calls out the entered-in-error example and allows for the exception.</p>",
        "id": 278326425,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649434234
    },
    {
        "content": "<p>The question of entered-in-error for any resource... I would say yes because the language is included in a section of specification above specific profile artifacts and each profile should inherit that rule.</p>",
        "id": 278326578,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649434308
    },
    {
        "content": "<p>what is the use in having entered-in-error count towards compliance at all? I definitely think it must not be forbidden, but successfully having resources with entered-in-error are simply a fact-of-life. Their existence should be agnostic to compliance.</p>",
        "id": 278327268,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649434613
    },
    {
        "content": "<p>And to the other question if a server only support \"incomplete\" data... That has always stumped us. We never know what it means to be \"fully\" compliant. Because there is a capability statement that include all sorts of operations included in the IG. If the server support only 1 resource is that compliant? I think some people would say yes. </p>\n<p>Certification calls out what must be tested and creates the context of compliance here. There isn't anything in certification that says what the IG has called out as being against the rules.</p>",
        "id": 278327469,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649434705
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191404\">John Moehrke</span> <a href=\"#narrow/stream/179309-inferno/topic/DocumentReference.20failed.20validator.20from.20missing.20contentType/near/278327268\">said</a>:</p>\n<blockquote>\n<p>what is the use in having entered-in-error count towards compliance at all? I definitely think it must not be forbidden, but successfully having resources with entered-in-error are simply a fact-of-life. Their existence should be agnostic to compliance.</p>\n</blockquote>\n<p>Exactly right. It is an unfortunate reality of humans entering data into the system. We cannot hold mistakes up to the same standard and valid data.</p>",
        "id": 278327601,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649434783
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191506\">Yunwei Wang</span> <a href=\"#narrow/stream/179309-inferno/topic/DocumentReference.20failed.20validator.20from.20missing.20contentType/near/278325425\">said</a>:</p>\n<blockquote>\n<p>I am concerned this could fundamentally change the FHIR validation. Should FHIR validator just ignore any resources with enter-in-error status? </p>\n<p>We should be very careful here. If a server only provides \"incomplete\" (I don't know what the correct phrase is to describe this use case) resources with enter-in-error status, does that server conforms to US Core IG? (<span class=\"user-mention silent\" data-user-id=\"191401\">Eric Haas</span> )</p>\n</blockquote>\n<p>I would say if a server only returns DocRef resources that are entered-in-error and have no data for anything required, then that would not be compliant, but if the server returns 20 DocRefs for the test patients, 19 of which are fully compliant with the spec, but one has entered-in-error status and no other data, then that should count as being compliant.</p>",
        "id": 278329462,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649435642
    },
    {
        "content": "<p>Which that is what is happening for us with our current test runs.</p>",
        "id": 278329562,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649435676
    },
    {
        "content": "<p>So it sounds like we need ONC to give us a judgement here, even if that amounts to them approving of our interpretation and giving yall the greenlight to make a corresponding update to the test code without changes to the us core spec. </p>\n<p>I've never spoken directly with them, how do we initiate that? You mentioned a Jira board, which one would that be?</p>",
        "id": 278329935,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649435841
    },
    {
        "content": "<p>This is an edge case where systems are not going to expose this information to their patients no matter the conformance implications.</p>",
        "id": 278330619,
        "sender_full_name": "Eric Haas",
        "timestamp": 1649436145
    },
    {
        "content": "<p>Right the question is whether on not we want a bunch of DARs... Which seem like a waste of resources.</p>",
        "id": 278331266,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649436411
    },
    {
        "content": "<p>Not sure if this is the right place to log a clarifying question to ONC: <a href=\"https://oncprojectracking.healthit.gov/wiki/olp\">https://oncprojectracking.healthit.gov/wiki/olp</a><br>\nCreate issue: <a href=\"https://oncprojectracking.healthit.gov/support/login.jsp?os_destination=%2Fsecure%2FCreateIssue%21default.jspa\">https://oncprojectracking.healthit.gov/support/login.jsp?os_destination=%2Fsecure%2FCreateIssue%21default.jspa</a><br>\nSearch issue: <a href=\"https://oncprojectracking.healthit.gov/support/issues/?jql=\">https://oncprojectracking.healthit.gov/support/issues/?jql=</a></p>",
        "id": 278331538,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649436522
    },
    {
        "content": "<p>I suspect they are going to defer to the spec here.</p>",
        "id": 278331587,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649436543
    },
    {
        "content": "<p>That loops back to <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> 's question. If we say that enter-in-error is an exception from other status, why do we even have enter-in-error in US Core?</p>",
        "id": 278332039,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649436751
    },
    {
        "content": "<p>Because it isn't a final say that all entered-in-error won't follow us-core... There may be instances where a provider app, or some other integration may be allowed to get all data and may be returned... I think there is some weird thing because it is a status you can't modify the values because it is required and dictated by the base spec. In reality what is probably a good middle ground is some mechanism for a server to communicate at a per resource level if it conforms to the profile for that resource.... Not sure it is really needed, but it is probably the best of both worlds.</p>",
        "id": 278332475,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649436952
    },
    {
        "content": "<p>Removing entered-in-error from the value set creates another set of problems.</p>",
        "id": 278332608,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649436990
    },
    {
        "content": "<p>just because an entered-in-error might be compliant, does not mean that concept needs to be inscope.</p>",
        "id": 278334298,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649437658
    },
    {
        "content": "<p>This came out from an edge case that there is not unknown code for contentType. In general, is this a common process for an EHR to serve incomplete resource through FHIR API?</p>",
        "id": 278334403,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649437695
    },
    {
        "content": "<p>What are you defining as incomplete?</p>",
        "id": 278334496,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649437740
    },
    {
        "content": "<p>In any definition... the answer is yes.</p>",
        "id": 278334523,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649437751
    },
    {
        "content": "<p>Because it potentially just as dangerous to \"hide\" resources to expose \"incomplete\" resources.</p>",
        "id": 278334579,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649437784
    },
    {
        "content": "<p>I found a similar discussion already happened at <br>\n<a href=\"#narrow/stream/179166-implementers/topic/Period.20Datatype.20Invariant\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Period.20Datatype.20Invariant</a><br>\nand<br>\n<a href=\"#narrow/stream/179175-argonaut/topic/US.20Core.3AExtensible.20and.20Required.20bindings.20for.20historical.20data\">https://chat.fhir.org/#narrow/stream/179175-argonaut/topic/US.20Core.3AExtensible.20and.20Required.20bindings.20for.20historical.20data</a><br>\nand a JIRA ticket<br>\n<a href=\"https://jira.hl7.org/browse/FHIR-25183\">https://jira.hl7.org/browse/FHIR-25183</a></p>",
        "id": 278334609,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649437802
    },
    {
        "content": "<p>After three years, we are still looking for an answer.</p>",
        "id": 278334863,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1649437917
    },
    {
        "content": "<p>LOL</p>",
        "id": 278334868,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649437921
    },
    {
        "content": "<p>I was about to day the same thing...</p>",
        "id": 278334913,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649437927
    },
    {
        "content": "<p>I mean interoperability is hard.... Especially with how people understand things differently, when we have 20+ years of data that don't meet today's standards, and when humans are still involved.. The intent of what we did in US-Core is create meaningful profiles that are usable. We tried to allow for \"bad\" data to be communicated without being too overbearing to implementers.... The fact that we have an EHR trying to stick DARs for a bunch a fields just to pass a test goes against what we intended.</p>",
        "id": 278335176,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649438063
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191404\">John Moehrke</span> <a href=\"#narrow/stream/179309-inferno/topic/DocumentReference.20failed.20validator.20from.20missing.20contentType/near/278334298\">said</a>:</p>\n<blockquote>\n<p>just because an entered-in-error might be compliant, does not mean that concept needs to be inscope.</p>\n</blockquote>\n<p>Fair enough. I think some of the things that would have to be figured out if we go down that route (BTW doesn't solve for current certification because SVAP wouldn't include it so the current tests/tools would need to abide by what the IG states currently):<br>\n1.)  Are we allowed to change the required status binding? I thought not, but I may be making it up.<br>\n2.) How do we remove that one field?<br>\n3.) What happens when you have an entered-in-error in a bundle of \"compliant\" resources? Doesn't the consumer still have to code for this exception anyways?</p>",
        "id": 278335508,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649438247
    },
    {
        "content": "<p>Postel's Law</p>",
        "id": 278335689,
        "sender_full_name": "John Moehrke",
        "timestamp": 1649438322
    },
    {
        "content": "<p>That is always best practice :-D</p>",
        "id": 278335872,
        "sender_full_name": "Drew Torres",
        "timestamp": 1649438401
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"279806\">Nathan Loyer</span> <a href=\"#narrow/stream/179309-inferno/topic/DocumentReference.20failed.20validator.20from.20missing.20contentType/near/278329935\">said</a>:</p>\n<blockquote>\n<p>So it sounds like we need ONC to give us a judgement here, even if that amounts to them approving of our interpretation and giving yall the greenlight to make a corresponding update to the test code without changes to the us core spec. </p>\n<p>I've never spoken directly with them, how do we initiate that? You mentioned a Jira board, which one would that be?</p>\n</blockquote>\n<p>ONC's official inquiry portal is located here: <a href=\"https://www.healthit.gov/feedback\">https://www.healthit.gov/feedback</a> and please feel free to submit your questions to us</p>",
        "id": 278550608,
        "sender_full_name": "Keith Carlson",
        "timestamp": 1649682541
    },
    {
        "content": "<p>So I was chatting with <span class=\"user-mention\" data-user-id=\"211704\">@Joe Paquette</span> about this today... he pointed out something that I missed, which is that the caveats in the spec about returning empty/blank resources when the status is entered-in-error are specific to patient viewing systems, which I took to mean when the request has a token for a patient standalone launch. There is no claim in here saying that the data should be removed when the request is coming from provider facing systems or backend system/system calls, which I took to mean EHR launch tokens and 2-legged tokens respectively. </p>\n<p>Note that when we are running this single patient API test suite, we are using the EHR launch tokens... so that is leading me to believe that we should be returning all of this data if we still have it in the database with the status of entered-in-error. When it's a patient user token making the request the data should be redacted, but all other use cases should return the data if it is available.</p>\n<p>I haven't logged a ticket to the ONC Jira yet, we were working on how we wanted to write up the request when we discovered this caveat, which might make a ticket for this unnecessary...</p>",
        "id": 278714284,
        "sender_full_name": "Nathan Loyer",
        "timestamp": 1649779430
    }
]