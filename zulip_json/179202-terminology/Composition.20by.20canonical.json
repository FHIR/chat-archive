[
    {
        "content": "<p>Hi all, I was talking to <span class=\"user-mention\" data-user-id=\"191503\">@Robert McClure</span>,  discussing the consequences of the new canonical datatype, when I noticed that <code>ValueSet.compose.include</code> uses <code>system</code> and <code>version</code> to refer to a code system, but at the same time uses a <code>canonical</code> to refer to a valueset.  Now, I can imagine how this came about, but changing that reference to canonical would not only make it more consistent, it would also add the capability of managing resolution of unqualified canonicals (so canonicals without a version) in much the same way as resolution of ValueSets.</p>",
        "id": 153955408,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1525277161
    },
    {
        "content": "<p>There is actually much more to say about this, since this refers back to discussions we have been having during the last WGM, where we're investigating how to deal with a world where references to valuesets and codesystems and profiles are mostly not versioned, while we live in a versioned world.  For those not there (and a bit technically inclined), you can read more about a possible solution here: <a href=\"https://blog.fire.ly/2017/11/28/versioning-and-canonical-urls/\" target=\"_blank\" title=\"https://blog.fire.ly/2017/11/28/versioning-and-canonical-urls/\">https://blog.fire.ly/2017/11/28/versioning-and-canonical-urls/</a>)</p>",
        "id": 153955409,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1525277327
    },
    {
        "content": "<p>It would be nice if the solution for version resolution of ValueSets would be the same for CodeSystems, and it looks like it's not currently the case.</p>",
        "id": 153955410,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1525277378
    },
    {
        "content": "<p>I think I agree with you that making that change to canonical for code systems should be able to meet the need (unless there's an aspect that I'm forgetting).  In many cases code systems that are referenced may not actually have a CodeSystem resource instance that is being referred to, but I don't think that should be an issue.  And I agree that it makes sense to use a consistent approach in both cases.  But it's also a quite significant change to a resource which is a normative candidate (of course it would have been good if we had done it at the same time with all of the other updates to move to canonical).  So I'm not sure what my conclusion is on it yet.</p>",
        "id": 153955416,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1525279088
    },
    {
        "content": "<p>We don't want code system to be canonical.  We're not allowed to use \"|version\" there - unless we wanted to move to Coding using canonical - which would be a rather huge shift at this point.</p>",
        "id": 153955439,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1525285932
    },
    {
        "content": "<p>I agree, that is precisely the issue.  It would be a rather huge change - and I don't know if the benefit of having improved consistency would be sufficient for us to do it.</p>",
        "id": 153955444,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1525288557
    },
    {
        "content": "<p>According to Using SNOMED on FHIR page: <a href=\"http://build.fhir.org/snomedct.html#4.2.1.0.2\" target=\"_blank\" title=\"http://build.fhir.org/snomedct.html#4.2.1.0.2\">http://build.fhir.org/snomedct.html#4.2.1.0.2</a>, the version number should be embeded in URL.<br>\n<a href=\"http://snomed.info/sct/[sctid]/version/[YYYYMMDD]\" target=\"_blank\" title=\"http://snomed.info/sct/[sctid]/version/[YYYYMMDD]\">http://snomed.info/sct/[sctid]/version/[YYYYMMDD]</a></p>",
        "id": 153955458,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1525290485
    },
    {
        "content": "<p>In this case, still need to fill version element?</p>",
        "id": 153955459,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1525290595
    },
    {
        "content": "<p>This was discussed at yesterday's SNOMED on FHIR call. The general consensus was that the CodeSystem.url for SNOMED CT should be  <a href=\"http://snomed.info/sct\" target=\"_blank\" title=\"http://snomed.info/sct\">http://snomed.info/sct</a> - i.e. a URI that is immutable across editions/modules and versions. The CodeSystem.version for SNOMED CT carries the SCTID for the module/edition and version.</p>",
        "id": 153955514,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1525294943
    },
    {
        "content": "<p>I don't see an issue with using |version as a part of a switch to the code system uri being canonical. Yes, it's a shift but this way we can consistently reference identifier and version for things that need to be versioned and resolve canonical identifiers in the same way. I am very opposed to making code system, or any terminology component, a one-off variant of the approach we finalize on for determining the correct version of things to be used for an implementation.  I also don't see a problem with supporting sct needs within canonical.</p>",
        "id": 153955516,
        "sender_full_name": "Robert McClure",
        "timestamp": 1525295338
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191506\">@Yunwei Wang</span> The intent of that documentation on the \"Using SNOMED CT with FHIR\" page is for what to use for the 'version' parameter, not for 'url' - the url is always intended to be  <a href=\"http://snomed.info/sct\" target=\"_blank\" title=\"http://snomed.info/sct\">http://snomed.info/sct</a> (as noted in the Summary table, and as Peter said).</p>",
        "id": 153955524,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1525295943
    },
    {
        "content": "<p>Just to be clear, this: <a href=\"http://snomed.info/sct/[sctid]/version/[YYYYMMDD]\" target=\"_blank\" title=\"http://snomed.info/sct/[sctid]/version/[YYYYMMDD]\">http://snomed.info/sct/[sctid]/version/[YYYYMMDD]</a> is the format of a SNOMED CT version \"number\". It is <em>not</em> a valid URI for the SNOMED CT CodeSystem.</p>",
        "id": 153955536,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1525302432
    },
    {
        "content": "<blockquote>\n<p>We don't want code system to be canonical.  We're not allowed to use \"|version\" there - unless we wanted to move to Coding using canonical - which would be a rather huge shift at this point.</p>\n</blockquote>\n<p>I see how we switch here between referring to a CodeSystem as the Resource (even if unavailable) and codesystem as part of a codesystem+code pair referring to a concept from a codesystem. If we could say Coding does the latter, while compose does the former, it looks like we could still do it. But I agree it feels like a big change, and I don't want to redo any discussions you might already have had about this.  The consequence though is that version management for ValueSets /CodeSystems is treated differently from other conformance resources, while I have the feeling the versioning problems we try to solve with canonical are basically the same...</p>",
        "id": 153955616,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1525327617
    },
    {
        "content": "<p>One reason for this distinction is that Code System and Value Set  uri and version formats are often specified by external organisations.</p>",
        "id": 153955619,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1525329302
    },
    {
        "content": "<p>That's not technically an issue.  While the canonical URL <em>should</em> resolve to the resource, it doesn't have to.   For example, the canonical URLs for LOINC-defined value sets don't currently resolve.</p>",
        "id": 153955676,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1525350212
    },
    {
        "content": "<p>Right - there isn't a technical issue with using canonical for this.</p>",
        "id": 153955704,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1525357164
    },
    {
        "content": "<p>If there is no technical barrier, then I think there are good reasons to align and use canonical. Just because SCT will be long and convoluted doesn't ruin the approach. And I don't think we need to make everything fit the old way just to satisfy the SCT crowd.</p>",
        "id": 153955737,
        "sender_full_name": "Robert McClure",
        "timestamp": 1525373582
    },
    {
        "content": "<p>It would be useful to understand the benefits of making this change from both server implementation and client perspectives. SCT requirements are critical for us (and others I suspect) without that, we'd have no business case for using a FHIR Terminology Services API.</p>",
        "id": 153955810,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1525381903
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Do you have opinions on this - moving system to be a true canonical, including using the canonical approach to version in Coding?  (And thinking too about the possibility of canonical becoming a complex type.)</p>",
        "id": 153955904,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1525407641
    },
    {
        "content": "<p>so <span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> says about that value set canonicals are different to everything else, but I don't believe that's true. Value set references work just like everything else (and Ewout is balloting on my behalf that they should be more strongly aligned than they are in binding)</p>",
        "id": 153956095,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1525494851
    },
    {
        "content": "<p>code system references are different to everything else. There's a reason for that, because we do not handle code systems like everything else. We've deliberately chosen not to take on part of the code system scope, and we've recognised that most important code systems will not be distributed using the code system resource. And we've got the tie between Coding.system/version and the code system URL.</p>",
        "id": 153956096,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1525494944
    },
    {
        "content": "<p>so I think that changing valueset.compose.system to a canonical is a mistake, and I am very strongly opposed to considering changing the way Coding.system works. That would be a procedural disaster as well as wrong</p>",
        "id": 153956097,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1525495018
    },
    {
        "content": "<p>As <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> has stated, <strong>code systems</strong> are different - we have chosen not to take on part of the code system scope and most important code systems will <strong>not</strong> be distributed using the CodeSystem resource.  With that in mind it doesn't entirely follow for me that CodeSystem references <strong>must</strong> be handled differently from everything else and could not use canonical.  But unless there's a further argument that I haven't heard or grasped it doesn't seem to me that changing to canonical for CodeSystem references would buy us anything other than a small bit more consistency and no additional actual functionality.  And it may be useful to highlight that CodeSystem is different in this way, as Grahame suggests.  So unless there is a further argument or explanation of why it's needed, I'm not in favor of making the change.</p>",
        "id": 153956135,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1525522752
    },
    {
        "content": "<p>Look folks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>, just because you say \"code systems (standard HL7 refrain here) are out of scope for FHIR\" doesn't allow you to keep pretending you don't actually do it. FHIR terminology is gaining a HUGE footprint and there are MANY MANY FHIR code systems that can only be obtained from a FHIR server. So enough with the pretend fantasy that you can do things because \"FHIR doesn't manage code systems\" - I call BS.  It took HL7 3 decades to admit they actually need to manage terminology and you all are a big reason \"we\" can now do it, so let's be honest a bit sooner here. Second, What do you mean <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> that we already treat value sets the same when we clearly do not unless you can clarify how we can manage value sets (and code systems) using npm without making this change. And <span class=\"user-mention\" data-user-id=\"191364\">@Peter Jordan</span>, You are going to have to help me understand why using canonical breaks SCT references. So far I can tell that is not true.</p>",
        "id": 153956188,
        "sender_full_name": "Robert McClure",
        "timestamp": 1525543258
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191503\">@Robert McClure</span>  Looking at the FHIR definition of canonical urls at <a href=\"http://hl7.org/fhir/2018May/references.html#canonical\" target=\"_blank\" title=\"http://hl7.org/fhir/2018May/references.html#canonical\">http://hl7.org/fhir/2018May/references.html#canonical</a> - do you think that the url property of a CodeSystem resource representing SNOMED CT -  <a href=\"http://snomed.info/sct\" target=\"_blank\" title=\"http://snomed.info/sct\">http://snomed.info/sct</a> - conforms with that definition?  Or try testing that url using this...<br>\n<a href=\"https://seositecheckup.com/tools/url-canonicalization-test\" target=\"_blank\" title=\"https://seositecheckup.com/tools/url-canonicalization-test\">https://seositecheckup.com/tools/url-canonicalization-test</a></p>",
        "id": 153956205,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1525551675
    },
    {
        "content": "<p>I didn't say that code systems are out of scope for FHIR. What I said was 'we decided that some aspects of code systems are out of scope' for FHIR. I said that we treat value set urls as canonicals, the same as we do for other conformance resources</p>",
        "id": 153956241,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1525576993
    },
    {
        "content": "<p>but we do treat code system references as slightly different, for several reasons that I think are valid</p>",
        "id": 153956242,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1525577030
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191364\">@Peter Jordan</span> Yes, I've looked at the definition. Yes I think no matter how this ends up working it's going to be a mess for all of FHIR, not just terminology, hence my support for an npm-like solution <strong>and</strong> absolute need for a central registry. Yes, it seems that SNOMED did not read <a href=\"https://www.mattcutts.com/blog/seo-advice-url-canonicalization/\" target=\"_blank\" title=\"https://www.mattcutts.com/blog/seo-advice-url-canonicalization/\">this</a> when they selected <a href=\"http://snomed.info/sct\" target=\"_blank\" title=\"http://snomed.info/sct\">http://snomed.info/sct</a> as canonical, and it fails miserably on the test site. But so what? They can fix that. And my concern is more about using versioning via canonical and I still think while the approach SCT has chosen does not work well in this scheme, if FHIR agrees to make all of this canonical things can be fixed so it works. So I don't see an issue.</p>",
        "id": 153956251,
        "sender_full_name": "Robert McClure",
        "timestamp": 1525622275
    },
    {
        "content": "<p>Perhaps we should discuss this further at a Connectathon breakout session?</p>",
        "id": 153956266,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1525642127
    },
    {
        "content": "<p>Yes.  I don't think that all of what is being said is coming from a common base of understanding.  And we need to be together on that before we decide on solutions for problems that we've identified (once we agree on what they are).</p>",
        "id": 153956267,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1525645671
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191503\">@Robert McClure</span> I don't follow your point re <a href=\"http://snomed.info/sct\" target=\"_blank\" title=\"http://snomed.info/sct\">http://snomed.info/sct</a> and that google link.  These are URIs not URLs (Identifies, not Locations).  Resolving them is irrelevant wrt FHIR or their intended use.</p>\n<p>Note, I can understand why you may be confused -- the FHIR documentation does not make a clear distinction in its use of \"url\" and \"uri\" - witness this statement from <a href=\"http://hl7.org/fhir/2018May/references.html#canonical\" target=\"_blank\" title=\"http://hl7.org/fhir/2018May/references.html#canonical\">http://hl7.org/fhir/2018May/references.html#canonical</a> </p>\n<blockquote>\n<p><em>2.3.0.5 Canonical URLs</em><br>\nMany resource types have a defined element \"url\" which is the canonical URI that always identifies the resource.</p>\n</blockquote>",
        "id": 153956843,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1525732453
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> I was just responding to Peter's comments about testing the uri as a url. I agree, that uri for the system <strong>is a uri</strong> even though the datatype is url. As for the rest of it - let's discuss next week.  To keep from swallowing an entire Q, perhaps we need to meet at a separate time <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> ?</p>",
        "id": 153957023,
        "sender_full_name": "Robert McClure",
        "timestamp": 1525808840
    }
]