[
    {
        "content": "<p>Hi everyone!</p>\n<p>I am currently implementing the POST-$translate method for a ConceptMap resource. </p>\n<p>I ran into a problem that in the current version of FHIR R4 only coding can be passed to the <strong>dependency.concept</strong> parameter.<br>\nIn one of the discussions here, I found out that in R5 it is proposed to replace <strong>dependency.concept</strong> with <strong>dependency.value</strong>, where it would be possible to write not only CodeableConcept, but all other types as well.</p>\n<p>The problem is that it's not enough for me to pass only the value, for example:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"err\"> </span><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Parameters\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"parameter\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"code\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span> <span class=\"s2\">\"10001005\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"dependency\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"part\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"valueQuantity\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">\"value\"</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"unit\"</span><span class=\"p\">:</span> <span class=\"s2\">\"year\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://unitsofmeasure.org\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"a\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>But I need to identify it with <strong>concept</strong>. So it's not just some <strong>value</strong>, but it's the value within a code system, for example:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"err\"> </span><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Parameters\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"parameter\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"code\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span> <span class=\"s2\">\"10001005\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"dependency\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"part\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"valueQuantity\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">\"value\"</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"unit\"</span><span class=\"p\">:</span> <span class=\"s2\">\"year\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://unitsofmeasure.org\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"a\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">},</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"concept\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"valueCoding\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://smomed.info/sct\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"445518008\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Is it okay to do something like that?</p>",
        "id": 249012337,
        "sender_full_name": "Jane Pankratova",
        "timestamp": 1628617768
    },
    {
        "content": "<p>If I'm following, \"age at onset\" identifies the property that the mapping depends on? In which case, the type of the <code>dependency.concept</code> parameter should be <code>CodeableConcept</code></p>\n<p>Alternatively, you have two dependsOn values, one of type Quantity and one of type Coding.</p>\n<p>Ultimately it depends on how your ConceptMap is representing this mapping information.</p>",
        "id": 249034546,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1628627994
    },
    {
        "content": "<blockquote>\n<p>If I'm following, \"age at onset\" identifies the property that the mapping depends on? In which case, the type of the dependency.concept parameter should be CodeableConcept</p>\n</blockquote>\n<p>Yes, it does.<br>\nAnd it should be CodeableConcept when there's that kind of rule: <code>IFA 11850561000119105 / Contusion of right chest wall /</code>. So the mapping depends on not value property  but code property.</p>\n<p>It will look like that (if I've got it right):</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Parameters\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"parameter\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"code\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span> <span class=\"s2\">\"10001005\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"dependency\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"part\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"concept\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"valueCodeableConcept\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">\"coding\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n              <span class=\"p\">{</span>\n                <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://smomed.info/sct\"</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"11850561000119105\"</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Contusion of right chest wall\"</span>\n              <span class=\"p\">}</span>\n            <span class=\"p\">],</span>\n            <span class=\"nt\">\"text\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Contusion of right chest wall\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>But I don't understand how to deal with it if I want to pass not <code>codeableConcept</code> but some value, so I can use it in the process of mapping. And I also need to link the value with its code. It means that I need to specify that the current <code>valueQuantity</code> (age in this example) belongs to SNOMED's <code>445518008</code> property (like in the example below) (+ for example, if I apply $translate to another ConceptMap, I could say that this <code>valueQuantity</code> belongs to LOINC code system).</p>\n<p>I can't do that - just pass \"age on set\" as <code>CodeableConcept</code>  for $translate because it doesn't contain any value for this:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Parameters\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"parameter\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"code\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span> <span class=\"s2\">\"10001005\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"dependency\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"part\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"concept\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"valueCodeableConcept\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">\"coding\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n              <span class=\"p\">{</span>\n                <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://smomed.info/sct\"</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"445518008\"</span><span class=\"p\">,</span>\n                <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Age at onset of clinical finding (observable entity)\"</span>\n              <span class=\"p\">}</span>\n            <span class=\"p\">],</span>\n            <span class=\"nt\">\"text\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Age at onset of clinical finding (observable entity)\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>That's why I want to use R5 because <strong>dependency.concept</strong> is replaced with <strong>dependency.value</strong>, so I can start passing value properties, but it doesn't support  <strong>dependency.concept</strong> anymore (according to the proposal file, and it's not described in specification yet) which I need to link these two properties.</p>\n<p>So, I imagine it to be like that that every part of <strong>dependency</strong> parameter has:</p>\n<ul>\n<li>concept (dependency.concept | coding) - 0..1</li>\n<li>value (dependency.value[x] |  [x] - every type) - 0..1</li>\n</ul>\n<p>It means If I have value property I specify both <strong>concept</strong> and <strong>value</strong>, and if I have only code property, I specify only <strong>concept</strong>.</p>\n<blockquote>\n<p>Alternatively, you have two dependsOn values, one of type Quantity and one of type Coding.</p>\n</blockquote>\n<p>If I understand your comment right, it's not like I want to have two not linked together values, I need to have two values (both Quantity and and its defining Coding) combined together.</p>",
        "id": 249073505,
        "sender_full_name": "Jane Pankratova",
        "timestamp": 1628664256
    },
    {
        "content": "<p>The R5 equivalent of <code>dependency.concept</code> is <code>dependency.valueCoding</code></p>\n<p>However, it sounds like what you're want to express is that the <code>dependency.valueQuantity</code> is the value of an <code>age at onset</code> field, with that field being identified by a SNOMED code.  In this case, the <code>dependency.element</code> value could be set to <code>http://snomed.info/id/445518008</code>  (which would correspond to <code>group.element.target.dependsOn.property</code> in the ConceptMap).</p>",
        "id": 249295768,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1628803776
    },
    {
        "content": "<p>It is analogous to the example here <a href=\"https://build.fhir.org/conceptmap-example-specimen-type.html\">https://build.fhir.org/conceptmap-example-specimen-type.html</a> (which is using product rather than dependsOn, but the essential idea is the same)</p>",
        "id": 249296017,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1628803901
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"err\"> </span><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Parameters\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"parameter\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"code\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span> <span class=\"s2\">\"10001005\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"dependency\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"part\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"element\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"valueUri\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://snomed.info/id/445518008\"</span>\n        <span class=\"p\">},</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"valueQuantity\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">\"value\"</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"unit\"</span><span class=\"p\">:</span> <span class=\"s2\">\"year\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://unitsofmeasure.org\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"a\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 249306304,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1628811168
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191343\">Michael Lawley</span> <a href=\"#narrow/stream/179202-terminology/topic/Concept.20Map.20.24translate/near/249295768\">said</a>:</p>\n<blockquote>\n<p>The R5 equivalent of <code>dependency.concept</code> is <code>dependency.valueCoding</code></p>\n<p>However, it sounds like what you're want to express is that the <code>dependency.valueQuantity</code> is the value of an <code>age at onset</code> field, with that field being identified by a SNOMED code.  In this case, the <code>dependency.element</code> value could be set to <code>http://snomed.info/id/445518008</code>  (which would correspond to <code>group.element.target.dependsOn.property</code> in the ConceptMap).</p>\n</blockquote>\n<p>Yes, that's what I want. I've got it! Thanks a lot.</p>",
        "id": 250452939,
        "sender_full_name": "Jane Pankratova",
        "timestamp": 1629791555
    }
]