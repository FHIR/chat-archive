[
    {
        "content": "<p>I've been dabbling with extracting RxNorm as an example including terms, attributes, and relationships. I will note that <a href=\"https://build.fhir.org/rxnorm\">https://build.fhir.org/rxnorm</a> doesn't mention attributes at all, which seems to suggest that attributes aren't available for most FHIR servers to query over.  (Is this intentional?)</p>\n<p>Working from the <a href=\"https://www.nlm.nih.gov/research/umls/rxnorm/docs/rxnormfiles.html\">current prescribable file</a> from NLM, I loaded into sqlite and use the following script to generate an ndjson.gz file ( 4.5MB):</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Generate ndjson file</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>sqlite3 rxnorm.db  <span class=\"s2\">\"with</span>\n<span class=\"s2\">by_tty as (</span>\n<span class=\"s2\">    select rxcui, tty, json_group_array(str) arr</span>\n<span class=\"s2\">    from rxnconso where SAB='RXNORM' group by rxcui, tty),</span>\n<span class=\"s2\">by_conso as (</span>\n<span class=\"s2\">    select rxcui, json_group_object(tty, json(arr)) as terms</span>\n<span class=\"s2\">    from by_tty group by rxcui),</span>\n<span class=\"s2\">by_atn as (</span>\n<span class=\"s2\">    select rxcui, atn, json_group_array(atv) arr</span>\n<span class=\"s2\">    from rxnsat where sab='RXNORM' group by rxcui, atn),</span>\n<span class=\"s2\">by_attr as (</span>\n<span class=\"s2\">    select rxcui, json_group_object(atn, json(arr)) as attrs</span>\n<span class=\"s2\">    from by_atn group by rxcui),</span>\n<span class=\"s2\">by_rela as (</span>\n<span class=\"s2\">    select rxcui2 as rxcui, rela, json_group_array(rxcui1) arr</span>\n<span class=\"s2\">    from rxnrel where sab='RXNORM' and stype1='CUI' group by rxcui, rela),</span>\n<span class=\"s2\">by_rels as (</span>\n<span class=\"s2\">    select rxcui, json_group_object(rela, json(arr)) as rels</span>\n<span class=\"s2\">    from by_rela group by rxcui)</span>\n<span class=\"s2\">select json_object(</span>\n<span class=\"s2\">    'cui', c.rxcui,</span>\n<span class=\"s2\">    'terms', json(terms),</span>\n<span class=\"s2\">    'attrs', json(coalesce(attrs, '{}')),</span>\n<span class=\"s2\">    'rels', json(coalesce(rels, '{}')))</span>\n<span class=\"s2\">from by_conso c</span>\n<span class=\"s2\">    left join by_attr a on c.rxcui=a.rxcui</span>\n<span class=\"s2\">    left join by_rels r on c.rxcui=r.rxcui</span>\n<span class=\"s2\">\"</span> <span class=\"p\">|</span> gzip &gt; rxnorm.ndjson.gz\n</code></pre></div>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Example concept representation (shown with jq invocation)</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ jq --slurp  <span class=\"s1\">'</span>\n<span class=\"s1\">    .[] |</span>\n<span class=\"s1\">    select(.terms.SCD[]?|test(\"loratadine\")) |</span>\n<span class=\"s1\">    select(.attrs.RXTERM_FORM[]?==\"Cap\")</span>\n<span class=\"s1\">'</span> &lt;<span class=\"o\">(</span>zcat rxnorm.ndjson.gz <span class=\"o\">)</span>\n</code></pre></div>\n<p>Which yields an example:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"cui\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"828269\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"terms\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"PSN\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"loratadine 10 MG 24HR Oral Capsule\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"SCD\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"loratadine 10 MG Oral Capsule\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"SY\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"loratadine 10 MG 24HR Oral Capsule\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"NDC\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"11673098607\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"11673098630\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"11822044600\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"11822202203\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"21130019502\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"25000002108\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"25000002113\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"25000002121\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"25000002134\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"25000002136\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"25000002146\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"36800075539\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"36800075552\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"41226068630\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"49483068607\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"49483068630\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"49738068607\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"49738068630\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"50804084010\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"53943011613\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"55910062939\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"55910062952\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"59556088201\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"59556088281\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"63868066910\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"68016005510\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69452021103\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69452021107\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69452021116\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69452021126\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69452028317\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69452028319\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69452028325\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69842068607\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69842068630\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"69842068660\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"70000021701\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"72288044639\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"79481044600\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"RXN_AI\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"{316167} 28889\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"RXN_AM\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"{316167} 28889\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"RXN_AVAILABLE_STRENGTH\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"10 MG\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"RXN_BOSS_FROM\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"{316167} AI\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"RXN_HUMAN_DRUG\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"US\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"RXTERM_FORM\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"Cap\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"rels\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"consists_of\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"316167\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"has_dose_form\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"316965\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"has_tradename\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"836338\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"isa\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"828268\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"1165336\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"1165337\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n</div></div>\n<p>This isn't directly useful, but I think the JSON model is the same <em>kind of thing</em> as the \"Concept\" resource that <span class=\"user-mention\" data-user-id=\"191318\">@nicola (RIO/SS)</span> has described.</p>",
        "id": 275740661,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1647558654
    },
    {
        "content": "<p>Interesting. I had a tentative stab at doing this on Terminz 2-3 years ago - the result can be obtained from <a href=\"https://terminz.azurewebsites.net/fhir/CodeSystem/$lookup?system=http://www.nlm.nih.gov/research/umls/rxnorm&amp;code=828269&amp;property=*\">here</a><br>\nIt uses the 01032022 version of RxNorm (I only update it sporadically). Many of the property types are incorrect, but this was only meant as a 'starter for 10' to take to a Connectathon.</p>",
        "id": 275757325,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1647575364
    },
    {
        "content": "<p>If you could tweak that sqlite to generate objects more like:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"828269\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"display\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"loratadine 10 MG 24HR Oral Capsule\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"designation\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"use\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"PSN\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"system\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"???\"</span><span class=\"w\"> </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"loratadine 10 MG 24HR Oral Capsule\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"use\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SCD\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"system\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"???\"</span><span class=\"w\"> </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"loratadine 10 MG Oral Capsule\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"use\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"> </span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"SY\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"system\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"???\"</span><span class=\"w\"> </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"loratadine 10 MG 24HR Oral Capsule\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"property\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"11673098607\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"11673098630\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"11822044600\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"11822202203\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"21130019502\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"25000002108\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"25000002113\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"25000002121\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"25000002134\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"25000002136\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"25000002146\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"36800075539\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"36800075552\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"41226068630\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"49483068607\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"49483068630\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"49738068607\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"49738068630\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"50804084010\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"53943011613\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"55910062939\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"55910062952\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"59556088201\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"59556088281\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"63868066910\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"68016005510\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69452021103\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69452021107\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69452021116\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69452021126\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69452028317\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69452028319\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69452028325\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69842068607\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69842068630\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"69842068660\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"70000021701\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"72288044639\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"NDC\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"79481044600\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RXN_AI\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"{316167} 28889\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RXN_AM\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"{316167} 28889\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RXN_AVAILABLE_STRENGTH\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"10 MG\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RXN_BOSS_FROM\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"{316167} AI\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RXN_HUMAN_DRUG\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"US\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RXTERM_FORM\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Cap\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"consists_of\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"316167\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"has_dose_form\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"316965\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"has_tradename\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"836338\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"828268\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1165336\"</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">{</span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"parent\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1165337\"</span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n<p>Then it would drop right in to <code>CodeSystem</code></p>",
        "id": 276149368,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1647932073
    },
    {
        "content": "<p>(I don't know RxNorm, so I've just guessed types for the properties above and that \"PSN\" might mean preferred synonym, and hence be the thing to use for \"display\")</p>",
        "id": 276149501,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1647932249
    },
    {
        "content": "<p>Cool! Sure, I'll give that a shot. I see I should be using word \"designation\" above. Quick notes</p>\n<ul>\n<li>\n<p>PSN is a \"prescribable name\" suitable for electronic prescribing UIs</p>\n</li>\n<li>\n<p>To my knowledge RxNorm only models attributes as strings, so even NDC codes would use valueString</p>\n</li>\n</ul>\n<p>QQ: is there a way to differentiate in FHIR between an attribute with a coded value vs a relationship to a concept? Like... use <a href=\"http://build.fhir.org/codesystem-definitions.html#CodeSystem.property.type\">http://build.fhir.org/codesystem-definitions.html#CodeSystem.property.type</a> of valueCode for within-CodeSystem relationships, and use Codings got other coded attributes? Or is there a way to express this distinction explicitly?</p>",
        "id": 276183617,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1647953690
    },
    {
        "content": "<p>Here's an updated script that makes the changes you suggested (although I don't re-name \"isa\", and I use valueString for all attributes and valueCode for all relations)</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Generation</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>sqlite3 rxnorm.db  \"<br>\nwith<br>\nby_designation as (<br>\n    select rxcui, json_object('use', json_object('code', tty), 'value', str) designation, (case<br>\n        when tty = 'PSN' then 1<br>\n        when tty in ('SY', 'TMSY', 'DF', 'ET', 'DFG') then -1<br>\n        else 0<br>\n        end) priority<br>\n    from rxnconso where SAB='RXNORM' order by priority desc),<br>\nby_attr as (<br>\n    select rxcui, json_object('code', atn, 'valueString', atv) attribute<br>\n    from rxnsat where sab='RXNORM'),<br>\nby_rela as (<br>\n    select rxcui2 as rxcui, json_object('code', rela, 'valueCode', rxcui1) relation<br>\n    from rxnrel where sab='RXNORM' and stype1='CUI'),<br>\nby_prop as (<br>\n    select rxcui, json_object('code', 'tty', 'valueString', designation-&gt;&gt;'use.code') as property from by_designation<br>\n    UNION<br>\n    select rxcui, attribute as property from by_attr<br>\n    UNION<br>\n    select rxcui, relation as property from by_rela<br>\n),<br>\noutput_pass_1 as (<br>\n    select json_object(<br>\n        'code', c.rxcui,<br>\n        'display', c.designation-&gt;&gt;'value',<br>\n        'designation', json_group_array(json(c.designation))) as concept<br>\n    from by_designation c<br>\n    group by c.rxcui),<br>\noutput_pass_2 as (<br>\n    select json_object(<br>\n        'code', prev.concept-&gt;&gt;'code',<br>\n        'display', prev.concept-&gt;'display',<br>\n        'designation', prev.concept-&gt;'designation',<br>\n        'property', json_group_array(json(<a href=\"http://by_prop.property\">by_prop.property</a>))) as concept<br>\n    from output_pass_1 prev<br>\n    left join by_prop on prev.concept-&gt;&gt;'code' = by_prop.rxcui<br>\n    group by prev.concept-&gt;&gt;'code'<br>\n    )<br>\nselect * from output_pass_2<br>\n\" | gzip &gt; rxnorm.ndjson.gz</p>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Example query</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ jq -c  --slurp  <span class=\"s1\">'</span>\n<span class=\"s1\">    .[]</span>\n<span class=\"s1\">    | select(.designation[] | select(.use.code == \"SBD\"))</span>\n<span class=\"s1\">    | select(.property[] | select(.code==\"RXTERM_FORM\" and .valueString==\"Gel\"))</span>\n<span class=\"s1\">'</span> &lt;<span class=\"o\">(</span>zcat rxnorm.ndjson.gz <span class=\"o\">)</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"JavaScript\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"998437\"</span><span class=\"p\">,</span>\n  <span class=\"s2\">\"display\"</span><span class=\"o\">:</span> <span class=\"s2\">\"miconazole nitrate 2 % Topical Gel\"</span><span class=\"p\">,</span>\n  <span class=\"s2\">\"designation\"</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"use\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"PSN\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"s2\">\"value\"</span><span class=\"o\">:</span> <span class=\"s2\">\"miconazole nitrate 2 % Topical Gel\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"use\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"SCD\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"s2\">\"value\"</span><span class=\"o\">:</span> <span class=\"s2\">\"miconazole nitrate 0.02 MG/MG Topical Gel\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"use\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"SY\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"s2\">\"value\"</span><span class=\"o\">:</span> <span class=\"s2\">\"miconazole nitrate 2 % Topical Gel\"</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">],</span>\n  <span class=\"s2\">\"property\"</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"RXN_AI\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"{998427} 42790\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"RXN_AM\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"{998427} 6932\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"RXN_AVAILABLE_STRENGTH\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"0.02 MG/MG\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"RXN_BOSS_FROM\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"{998427} AI\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"RXN_HUMAN_DRUG\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"US\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"RXTERM_FORM\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"Gel\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"consists_of\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueCode\"</span><span class=\"o\">:</span> <span class=\"s2\">\"998427\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"has_dose_form\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueCode\"</span><span class=\"o\">:</span> <span class=\"s2\">\"346286\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"isa\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueCode\"</span><span class=\"o\">:</span> <span class=\"s2\">\"1164112\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"isa\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueCode\"</span><span class=\"o\">:</span> <span class=\"s2\">\"377981\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"tty\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"PSN\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"tty\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"SCD\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"tty\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"valueString\"</span><span class=\"o\">:</span> <span class=\"s2\">\"SY\"</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n</div></div>",
        "id": 276236032,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1647974303
    },
    {
        "content": "<p>Thank you, that is an awesome leg up!</p>",
        "id": 276438601,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1648105557
    },
    {
        "content": "<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Boilerplate and tweaks for an actual CodeSystem</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>sqlite3 rxnorm.db  <span class=\"s2\">\"</span>\n<span class=\"s2\">with</span>\n<span class=\"s2\">by_designation as (</span>\n<span class=\"s2\">    select rxcui, json_object('use', json_object('code', tty), 'value', str) designation, (case</span>\n<span class=\"s2\">        when tty = 'PSN' then 1</span>\n<span class=\"s2\">        when tty in ('SY', 'TMSY', 'DF', 'ET', 'DFG') then -1</span>\n<span class=\"s2\">        else 0</span>\n<span class=\"s2\">        end) priority</span>\n<span class=\"s2\">    from rxnconso where SAB='RXNORM' order by priority desc),</span>\n<span class=\"s2\">by_attr as (</span>\n<span class=\"s2\">    select rxcui, json_object('code', atn, 'valueString', atv) attribute</span>\n<span class=\"s2\">    from rxnsat where sab='RXNORM'),</span>\n<span class=\"s2\">by_rela as (</span>\n<span class=\"s2\">    select rxcui2 as rxcui, json_object('code', rela, 'valueCode', rxcui1) relation</span>\n<span class=\"s2\">    from rxnrel where sab='RXNORM' and stype1='CUI'),</span>\n<span class=\"s2\">by_prop as (</span>\n<span class=\"s2\">    select rxcui, json_object('code', 'TTY', 'valueString', designation-&gt;&gt;'use.code') as property from by_designation</span>\n<span class=\"s2\">    UNION</span>\n<span class=\"s2\">    select rxcui, attribute as property from by_attr</span>\n<span class=\"s2\">    UNION</span>\n<span class=\"s2\">    select rxcui, relation as property from by_rela</span>\n<span class=\"s2\">),</span>\n<span class=\"s2\">output_pass_1 as (</span>\n<span class=\"s2\">    select json_object(</span>\n<span class=\"s2\">        'code', c.rxcui,</span>\n<span class=\"s2\">        'display', c.designation-&gt;&gt;'value',</span>\n<span class=\"s2\">        'designation', json_group_array(json(c.designation))) as concept</span>\n<span class=\"s2\">    from by_designation c</span>\n<span class=\"s2\">    group by c.rxcui),</span>\n<span class=\"s2\">output_pass_2 as (</span>\n<span class=\"s2\">    select json_object(</span>\n<span class=\"s2\">        'code', prev.concept-&gt;&gt;'code',</span>\n<span class=\"s2\">        'display', prev.concept-&gt;'display',</span>\n<span class=\"s2\">        'designation', prev.concept-&gt;'designation',</span>\n<span class=\"s2\">        'property', json_group_array(json(by_prop.property))) as concept</span>\n<span class=\"s2\">    from output_pass_1 prev</span>\n<span class=\"s2\">    left join by_prop on prev.concept-&gt;&gt;'code' = by_prop.rxcui</span>\n<span class=\"s2\">    group by prev.concept-&gt;&gt;'code'</span>\n<span class=\"s2\">    )</span>\n<span class=\"s2\">select json_object(</span>\n<span class=\"s2\">  'resourceType', 'CodeSystem',</span>\n<span class=\"s2\">  'id', 'rxnorm',</span>\n<span class=\"s2\">  'url', 'http://www.nlm.nih.gov/research/umls/rxnorm',</span>\n<span class=\"s2\">  'version', '20220703',</span>\n<span class=\"s2\">  'name', 'RxNorm',</span>\n<span class=\"s2\">  'title', 'RxNorm',</span>\n<span class=\"s2\">  'status', 'draft',</span>\n<span class=\"s2\">  'experimental', 'true',</span>\n<span class=\"s2\">  'valueSet', 'http://www.nlm.nih.gov/research/umls/rxnorm/vs',</span>\n<span class=\"s2\">  'content', 'complete',</span>\n<span class=\"s2\">  'property', json_array(</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"NDC\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"ORIG_CODE\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"ORIG_SOURCE\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_ACTIVATED\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_AI\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_AM\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_AVAILABLE_STRENGTH\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_BN_CARDINALITY\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_BOSS_FROM\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_BOSS_STRENGTH_DENOM_UNIT\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_BOSS_STRENGTH_DENOM_VALUE\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_BOSS_STRENGTH_NUM_UNIT\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_BOSS_STRENGTH_NUM_VALUE\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_HUMAN_DRUG\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_IN_EXPRESSED_FLAG\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_OBSOLETED\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_QUALITATIVE_DISTINCTION\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_QUANTITY\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_STRENGTH\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXN_VET_DRUG\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"RXTERM_FORM\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"TTY\\\", \\\"type\\\": \\\"string\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"consists_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"constitutes\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"contained_in\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"contains\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"dose_form_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"doseformgroup_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"form_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_dose_form\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_doseformgroup\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_form\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_ingredient\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_ingredients\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_part\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_precise_ingredient\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_quantified_form\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"has_tradename\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"ingredient_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"ingredients_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"part_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"precise_ingredient_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"quantified_form_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"reformulated_to\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"reformulation_of\\\", \\\"type\\\": \\\"code\\\"}'),</span>\n<span class=\"s2\">    json('{\\\"code\\\": \\\"tradename_of\\\", \\\"type\\\": \\\"code\\\"}')</span>\n<span class=\"s2\">  ),</span>\n<span class=\"s2\">  'concept', json_group_array(concept)</span>\n<span class=\"s2\">) from output_pass_2</span>\n<span class=\"s2\">\"</span> <span class=\"se\">\\</span>\n  <span class=\"p\">|</span> sed <span class=\"s1\">'s/\"inverse_isa\"/\"child\"/g'</span> <span class=\"se\">\\</span>\n  <span class=\"p\">|</span> sed <span class=\"s1\">'s/\"isa\"/\"parent\"/g'</span> <span class=\"se\">\\</span>\n  <span class=\"p\">|</span> gzip &gt; rxnorm.json.gz\n</code></pre></div>\n</div></div>\n<p>As a first-cut, this is usable, promising, and only 5.5M compressed.</p>\n<p>Looking at <a href=\"https://www.hl7.org/fhir/rxnorm.html#4.3.2.3\">https://www.hl7.org/fhir/rxnorm.html#4.3.2.3</a> there's a more explicit spec for identifying the display term, as well as a general filter here <a href=\"https://www.hl7.org/fhir/rxnorm.html#filters\">https://www.hl7.org/fhir/rxnorm.html#filters</a> for identifying valid(?) CUIs that probably need to be factored in and then it'd be nice to have a standard transform into a CodeSystem representation.</p>",
        "id": 276480123,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1648130882
    },
    {
        "content": "<p>I was a bit puzzled by <a href=\"https://www.hl7.org/fhir/rxnorm.html\">https://www.hl7.org/fhir/rxnorm.html</a> as a whole, so I decided to just think about how I would want to represent RxNorm concepts on my own as a first pass. The SQL queries listed on that page for generating display names, for example, only match concepts for a couple of types. They omit about a dozen types including branded and generic drug packs, branded and generic ingredients, precise ingredients, and so on. I'm also not sure why the SCD/SBD designation afeknfsy would be preferred to a prescribable designation string for example. This might be reasonable but I don't know whether this was a considered decision or just a default choice.</p>\n<p>(I did submit a Jira issue asking why RxNorm attributes are not included in that page, but I realize I don't have full context for the choices made in that page.)</p>",
        "id": 276485336,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648132979
    },
    {
        "content": "<p>I will noodle on suggestions for mapping a file like this into a standard CodeSystem resource. The main decision I see is whether to include the additional framing metadata (URL, publisher, version, etc) as a headerline in this GZip ndjson file or as a separate companion CodeSystem (sans concepts) JSON file. I tend toward the latter.</p>",
        "id": 276485761,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648133127
    },
    {
        "content": "<p><a href=\"https://build.fhir.org/rxnorm\">https://build.fhir.org/rxnorm</a> specifies version as</p>\n<blockquote>\n<p>Where a version is used, it should be the date of release, encoded as in the download files, e.g. \"07092014\"</p>\n</blockquote>\n<p>... but this doesn't distinguish between different releases like Full releases vs Current Prescribable Content releases. So I'm going to use a modified convention based on RxNorm filenames (with the <code>RxNorm_</code> prefix and <code>.zip</code> suffix stripped).</p>",
        "id": 276518067,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648145389
    },
    {
        "content": "<p>One thought is that for publication, separating the CodeSystem from the Concepts array as follows may be a good idea:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>CodeSystem as small FHIR JSON file</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"CodeSystem\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://www.nlm.nih.gov/research/umls/rxnorm\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"identifier\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">\"system\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"urn:ietf:rfc:3986\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"urn:oid:2.16.840.1.113883.4.642.4.343\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"full_prescribe_03072022\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RxNormCurrentPrescribableContent\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"title\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RxNorm Current Prescribable Content\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"status\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"draft\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"experimental\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"publisher\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"U.S. National Library of Medicine\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"valueSet\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://www.nlm.nih.gov/research/umls/rxnorm/vs\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"description\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"RxNorm provides normalized names for clinical drugs and links its names to many of the drug vocabularies commonly used in pharmacy management and drug interaction software\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"copyright\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Attribution and Rights for Government Works:  Works produced by the U.S. government are not subject to copyright protection in the United States. Any such works found on National Library of Medicine (NLM) Web sites may be freely used or reproduced without permission in the U.S. Please acknowledge NLM as the source of the information by including the phrase “Courtesy of the U.S. National Library of Medicine” or “Source: U.S. National Library of Medicine.”\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"caseSensitive\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">true</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"content\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"complete\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[{</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"https://tx.fhir.me/concepts.ndjson.gz\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"nt\">\"valueUrl\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"ipfs://QmdcesSyDm12aSjfg1fFR28Yhfi6yC6nRxcNJkazU2zN5r/concepts/rxnorm/full_prescribe_03072022.ndjson.gz\"</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}]</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>\n</div></div>\n<p>...this then links out to a concepts file via <code>.extension.valueUrl</code> (example above uses IPFS; can be resolved via <code>ipfs get QmdcesSyDm12aSjfg1fFR28Yhfi6yC6nRxcNJkazU2zN5r/concepts/rxnorm/full_prescribe_03072022.ndjson.gz</code> or with a web gateway like <a href=\"https://cloudflare-ipfs.com/ipfs/QmdcesSyDm12aSjfg1fFR28Yhfi6yC6nRxcNJkazU2zN5r/concepts/rxnorm/full_prescribe_03072022.ndjson.gz\">https://cloudflare-ipfs.com/ipfs/QmdcesSyDm12aSjfg1fFR28Yhfi6yC6nRxcNJkazU2zN5r/concepts/rxnorm/full_prescribe_03072022.ndjson.gz</a>). I'm thinking this would make it easier for servers to associate content with the \"scaffold\" as needed.</p>",
        "id": 276522356,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648147302
    },
    {
        "content": "<p>I'm not at all familiar with RxNorm details, so the rxnorm.html page was the best I had to go on, but I do get the sense that it's not mature.<br>\nIt would be great to get people expert in the content itself involved in reviewing it and filling in the gaps.</p>",
        "id": 276530790,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1648151613
    },
    {
        "content": "<p>On the version topic, whether rxnorm uses date strings in the form DDMMYYYY or MMDDYYYY ( I guess the latter since it's the US), these are bad for sorting -- it would be far better to base them on YYYYMMDD so that a natural lexical ordering also matches date ordering.<br>\nAlso I did wonder about the Full releases vs Current Prescribable Content release and how these relate to each other - are they just parallel versions where one is a strict subset of the other?</p>",
        "id": 276531082,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1648151742
    },
    {
        "content": "<blockquote>\n<p>On the version topic, whether rxnorm uses date strings in the form DDMMYYYY or MMDDYYYY ( I guess the latter since it's the US), these are bad for sorting -- it would be far better to base them on YYYYMMDD so that a natural lexical ordering also matches date ordering.</p>\n</blockquote>\n<p>100%. The current rxnorm.html page establishes this convention as a direct reflection of NLM's filename conventions.</p>",
        "id": 276531330,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648151847
    },
    {
        "content": "<blockquote>\n<p>I did wonder about the Full releases vs Current Prescribable Content release and how these relate to each other - are they just parallel versions where one is a strict subset of the other?</p>\n</blockquote>\n<p>Yes, Current Prescribable should be a strict subset of Full. It's licensed more liberally, excludes attributes sourced from third-party drug terminologies, and excludes retired concepts. (At least, that's my rough understanding.)</p>",
        "id": 276531368,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648151864
    },
    {
        "content": "<p>I'm not sure why you want to separate the metadata parts from the concepts though.  (Part of) the metadata changes every release and it's not a significant addition?</p>",
        "id": 276532530,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1648152363
    },
    {
        "content": "<p>I'm only looking to separate them insofar as I want to support things like</p>\n<ul>\n<li>POSTing a small resource to a server and letting the server resolve concepts asynchronously in the background</li>\n<li>Streaming processing of concepts one by one</li>\n</ul>\n<p>But maybe I'll try for a \"belt and suspenders\" and throw the \"shell\" CodeSystem into the first line of the ndjson.gz file</p>",
        "id": 276532912,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648152570
    },
    {
        "content": "<p>Not sure if this is helpful, but throwing it out there in case it is.. <br>\nThe OMOP/OHDSI terminology downloads include RxNorm (300.3K concepts) in the omop terminology schema. <br>\nIt's an easy schema to query. <br>\nI ran a few queries to see what's there and it appears to capture the hierarchies and many relationships. </p>\n<p>These are all the relationship types I see for it for one direction of the relationship (with counts): <br>\nHas dose form group 39179<br>\nHas form    3145<br>\nHas marketed form   343467<br>\nHas precise ing 14138<br>\nHas quantified form 20342<br>\nHas tradename   378819<br>\nIs a    8<br>\nMapped from 1092880<br>\nMaps to 200375<br>\nPrecise ing of  14138<br>\nQuantified form of  6446<br>\nRxNorm - ATC    30084<br>\nRxNorm - ATC pr lat 5078<br>\nRxNorm - ATC pr up  3622<br>\nRxNorm - ATC sec lat    1278<br>\nRxNorm - ATC sec up 36571<br>\nRxNorm - SNOMED eq  21148<br>\nRxNorm dose form of 1758063<br>\nRxNorm has dose form    105946<br>\nRxNorm has ing  87212<br>\nRxNorm ing of   260090<br>\nRxNorm inverse is a 243613<br>\nRxNorm is a 219049<br>\nSubsumes    4<br>\nTradename of    105457</p>",
        "id": 276541704,
        "sender_full_name": "Craig McClendon",
        "timestamp": 1648157207
    },
    {
        "content": "<p>Indeed -- the releases in OMOP do a good job covering core vocabularies used in profiles like US Core</p>",
        "id": 276546208,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648159913
    },
    {
        "content": "<p>Attributes and relationships are well accounted for. The distribution mechanism relies <a href=\"https://athena.ohdsi.org/vocabulary/list\">https://athena.ohdsi.org/vocabulary/list</a> or something similar to centrally/consistently allocate identifiers for each code system, which makes it a bit harder to manage in an environment where different publishers manage their own process. (While this thread is focused on rxnorm, the capability I'm driving at here is a general-purpose distribution mechanism for CodeSystems that can easily be loaded into a FHIR server. Using OMOP table structures is certainly a possibility there, but it require working through a bit of mapping into the FHIR structures on the receiving side, and I'm wondering whether it's possible to do something more \"fhir native\".)</p>",
        "id": 276546504,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648160092
    },
    {
        "content": "<p>I've captured my current thinking in <a href=\"https://github.com/jmandel/fhir-concept-publication-demo\">https://github.com/jmandel/fhir-concept-publication-demo</a> which has examples of:</p>\n<ul>\n<li>CodeSystem JSON file with all concepts embedded</li>\n<li>CodeSystem JSON \"shell\" with a pointer to concepts in an ndjson file</li>\n<li>ndjson file where the first line is a CodeSystem and each subsequent line is a Concept</li>\n</ul>",
        "id": 276546611,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648160159
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193261\">@Craig McClendon</span> can you explain what's going on with \"Is a\" and \"RxNorm is a\" (and, I guess, \"Subsumes\" and \"RxNorm inverse is a\") -- why are these separate?</p>",
        "id": 276555663,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1648166759
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span>  I don't know enough about RxNorm to tell you much. 'Is a' has only 8 relationships, 'Subsumes' 4. Here are some samples of the codes that match those relationships (columns below are concept1_id , concept1_name, concept2_id, concept2_name)</p>\n<div class=\"codehilite\"><pre><span></span><code>&#39;Is a&#39;\n40220901    influenza A virus (H5N1) antigen    21601333    Influenza vaccines\n42903441    influenza A virus   21601333    Influenza vaccines\n42903442    influenza B virus   21601333    Influenza vaccines\n42903696    immunoglobulin M, human 21601255    Immunoglobulins, normal human\n43531966    immunoglobulin A    21601255    Immunoglobulins, normal human\n44814323    hepatitis C virus   21601337    Hepatitis vaccines\n19117912    immunoglobulin G    21601255    Immunoglobulins, normal human\n19013765    respiratory syncytial virus immune globulin intravenous 21601276    Other immunoglobulins\n\n&#39;Subsumes&#39;\n1311078 cytarabine  2718853 Injection, cytarabine liposome, 10 mg\n1338512 doxorubicin 43533290    Injection, doxorubicin hydrochloride, liposomal, imported lipodox, 10 mg\n1338512 doxorubicin 44786607    Injection, doxorubicin hydrochloride, liposomal, not otherwise specified, 10 mg\n1717240 amphotericin B  2718244 Injection, amphotericin b liposome, 10 mg\n\n&#39;RxNorm inverse is a&#39;\n739473  relugolix Oral Product  739475  relugolix Oral Tablet\n739473  relugolix Oral Product  739476  relugolix 120 MG Oral Tablet\n...\n</code></pre></div>",
        "id": 276621697,
        "sender_full_name": "Craig McClendon",
        "timestamp": 1648216463
    },
    {
        "content": "<p>Catching up on zulip... I am not an RxNorm technical expert; don't even have it loaded in a DB (that may be coming soon ;-) BUT wrt <span class=\"user-mention\" data-user-id=\"193261\">@Craig McClendon</span> relationship list above,  I don't think any of those codes are RxNorm <em>concept identifiers</em>, IE; RxCUIs. They might be atom identifiers. And even then, remember that RxNorm <strong>only</strong> represents drug elements, so things like viruses and Influenza vaccines likely are external information included in the files. It does include information (limited) representing drug classes. For example <a href=\"https://mor.nlm.nih.gov/RxNav/search?searchBy=RXCUI&amp;searchTerm=2472780\">relugolix Oral Product </a> has [RxCUI = 2472780].</p>",
        "id": 277472924,
        "sender_full_name": "Robert McClure",
        "timestamp": 1648844486
    },
    {
        "content": "<p>That's my mistake <span class=\"user-mention\" data-user-id=\"191503\">@Robert McClure</span>  - I listed the primary keys and not the concept codes above. The RxCUI 2472780 is indeed associated with Relugolix Oral Product in the Athena database.</p>",
        "id": 277474403,
        "sender_full_name": "Craig McClendon",
        "timestamp": 1648845259
    },
    {
        "content": "<p>If anyone is interested, you can use the Athena web UI to browse and see what all is in it.  I think this link should work:    <a href=\"https://athena.ohdsi.org/search-terms/terms?query\">https://athena.ohdsi.org/search-terms/terms?query</a></p>",
        "id": 277475386,
        "sender_full_name": "Craig McClendon",
        "timestamp": 1648845827
    }
]