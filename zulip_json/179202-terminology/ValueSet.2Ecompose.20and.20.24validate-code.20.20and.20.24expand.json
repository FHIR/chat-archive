[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> I just executed the <code>$expand</code> operation on your server (<a href=\"http://fhir.hausamconsulting.com/\">http://fhir.hausamconsulting.com/</a>) against a ValueSet (<a href=\"http://fhir.hausamconsulting.com/r4/ValueSet/346804/$expand\">http://fhir.hausamconsulting.com/r4/ValueSet/346804/$expand</a>) that I loaded onto that server. The ValueSet has got an <code>.expansion</code> but no <code>.compose</code>. As a result the server returned an error. The result is similar, when executing <code>$validate-code</code>.</p>\n<p>Subsequently, is it correct to assume that a ValueSet needs to have a <code>.compose</code> for <code>$expand</code> and <code>$validate-code</code> to work properly? Would <code>$expand</code> work in this case if the server  stored expansions (<a href=\"https://www.hl7.org/fhir/valueset.html#storage\">https://www.hl7.org/fhir/valueset.html#storage</a>)?</p>",
        "id": 223422220,
        "sender_full_name": "Gabriel Kleinoscheg",
        "timestamp": 1611170689
    },
    {
        "content": "<blockquote>\n<p>is it correct to assume that a ValueSet needs to have a .compose for $expand and $validate-code to work properly?</p>\n</blockquote>\n<p>that depends on what you mean by \"properly\". A value set with just an expansion is fragile, or error prone. But a server can choose to support it as it is; <a href=\"http://tx.fhir.org\">tx.fhir.org</a> does (or should).</p>",
        "id": 223425428,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1611172192
    },
    {
        "content": "<p>what do you want to happen? if you already have a valueset with a .expansion you already have the output of $expand, no? the server could be less transparent and serve up the valueset without altering it, but it makes more sense to me that in the situation where the operation is just going to return you a read on the VS it should be transparent about that.<br>\nI would be a little more apt to agree for $validate-code but I would also understand if the terminology server doesn't want to validate when they can't verify the integrity of the expansion</p>",
        "id": 223430617,
        "sender_full_name": "ryan moehrke",
        "timestamp": 1611174539
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"376049\">@Gabriel Kleinoscheg</span> I'm not actually quite sure what the behavior of HAPI 5.1.0 (which my server is using currently) is in regard to stored expansions.  It's something that Rob McClure has discussed with James Agnew, but I'm not entirely sure what that has landed with what HAPI has implemented.  I really should know that, though (especially for my own server), so I will try to check that out.</p>",
        "id": 223440246,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1611179095
    },
    {
        "content": "<p>There's also a requirement that the supplied expansion is only usable if the $expand call is made with compatible parameters.</p>",
        "id": 223445890,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1611181503
    },
    {
        "content": "<p>Yes, we've stated that in our discussions.  And it's kind of obvious (or probably should be) that it has to be that way.  But I'm not sure that we've actually documented that in any detail anywhere in the spec so far?</p>",
        "id": 223446103,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1611181624
    },
    {
        "content": "<p>I think this is clear:</p>\n<blockquote>\n<p>If the value set already has an expansion (e.g., a stored expansion):</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>Check that the parameters associated with the $expand operation are consistent with the parameters recorded in the expansion</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>If the parameters are inconsistent, then either generate a new expansion, or, if there is no definition (.compose), return an error</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>Additional parameters may be applied to an existing expansion if the server has validated that the result will be the same as if the expansion was generated directly from the value set definition (e.g. text filter, designations included).</li>\n</ul>\n</blockquote>",
        "id": 223446625,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1611181982
    },
    {
        "content": "<p>Yes, I agree that is clear.  I wasn't recalling that we had actually included that level of detail.</p>",
        "id": 223448428,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1611183113
    },
    {
        "content": "<p>Thank you all so far, for your answers.</p>\n<p>With \"to work properly\" I meant that <code>$expand</code> returns an expansion and <code>$validate-code</code> lets you check if a code is part of the ValueSet (containing only a expansion).</p>\n<p>I now want to summarize your answers - please correct me if I'm wrong:</p>\n<ul>\n<li><code>$expand</code> may return an expansion<ul>\n<li>if the ValueSet contains a <code>.compose</code> (by default retrieving the most current concepts from the referenced CodeSystem)</li>\n<li>if the ValueSet contains only an <code>.expansion</code> it depends on the server if stored expansions are supported. <ul>\n<li>For this case, I wonder if there was an expample where I could test this functionality. Especially, what <span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> mentioned: \"Check that the parameters associated with the <code>$expand</code> operation are consistent with the parameters recorded in the expansion\".</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><code>$validate-code</code>requires <code>.compose</code></li>\n</ul>",
        "id": 223484404,
        "sender_full_name": "Gabriel Kleinoscheg",
        "timestamp": 1611220686
    },
    {
        "content": "<p><a href=\"http://tx.fhir.org\">tx.fhir.org</a> should return you the expansion. I haven't got around to checking expansion parameters yet</p>",
        "id": 223486997,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1611222552
    },
    {
        "content": "<p>This all would be a lot simpler if we worked to include the <a href=\"http://build.fhir.org/ig/HL7/cqf-recommendations/terminology.html#using-value-sets\">cpg value set profiles (properly generalized)</a> in FHIR core on value set. Vocab is working to do this.  We would then encourage terminology servers (HAPI anyone?) to use these profiles to clarify what the resource can be used to do.</p>",
        "id": 223586181,
        "sender_full_name": "Robert McClure",
        "timestamp": 1611272000
    }
]