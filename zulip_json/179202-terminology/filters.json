[
    {
        "content": "<p>I am looking for a FHIR terminology server that can expand a Value Set based on a filter (descendants of a concept). The Code system is not SNOMED or LOINC, but a complete FHIR CodeSystem. I realize that \"filters\" are server specific, but I wonder if anyone have implemented this? or plan to do so? It would decrease the maintenance burden significantly, because additions to the CodeSystem in most cases, would not require a manual update of the related ValueSets.</p>\n<p>Suggestions for alternative implementations are also welcome :-)</p>\n<p>I have tried using a hapi fhir server. I can implement the CodeSystem and ValueSet, but not use the expand operator (naturally), since the server does not implement the filter.</p>\n<p>(If you have seen this post before, it is because I have also posted it in the Implementers-stream. They suggested that I posted it here instead :-))</p>",
        "id": 210853227,
        "sender_full_name": "Kirstine Rosenbeck Gøeg",
        "timestamp": 1600771427
    },
    {
        "content": "<p>I think the server running at <a href=\"http://tx.fhir.org\">tx.fhir.org</a> does, but if HAPI does not, you can make a PR to it so that it does</p>",
        "id": 210855275,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600772875
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194347\">@Kirstine Rosenbeck Gøeg</span> Which version(s) of HAPI have you tried?  I believe at least the latest versions (e.g. 5.1.0) should be able to do this.  If you can share an example, that could help.</p>",
        "id": 210903809,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1600795536
    },
    {
        "content": "<p>Ontoserver does this.  In fact it supports use of a ValueSet of any filter defined in the FHIR CodeSystem.  <a href=\"https://ontoserver.csiro.au\">https://ontoserver.csiro.au</a></p>",
        "id": 210933699,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1600810243
    },
    {
        "content": "<p>Thanks for the suggestion <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> </p>\n<p>The hapi server version is 5.0.0. Here is an example of my ValueSet expansion that fails:</p>\n<p>{<br>\n  \"resourceType\": \"ValueSet\",<br>\n  \"status\": \"active\",<br>\n  \"compose\": {<br>\n    \"include\": [ {<br>\n      \"system\": \"<a href=\"http://kl.dk/fhir/common/caresocial/CodeSystem/KLCommonCareSocialCodes\">http://kl.dk/fhir/common/caresocial/CodeSystem/KLCommonCareSocialCodes</a>\",<br>\n      \"filter\": [ {<br>\n        \"property\": \"descendants\",<br>\n        \"op\": \"descendent-of\",<br>\n        \"value\": \"940f37e6-8a3d-483b-adac-be8af3268a5b\"<br>\n      } ]<br>\n    } ]<br>\n  },<br>\n  \"expansion\": {<br>\n    \"identifier\": \"61bfd0bc-dd62-45e2-8964-0564fda8ada1\",<br>\n    \"timestamp\": \"2020-09-23T07:42:44+00:00\",<br>\n    \"total\": 0<br>\n  }<br>\n}</p>\n<p>Which uses the CodeSystem that you can see here: <a href=\"http://build.fhir.org/ig/Kirstinerosenbeck/FKInfo/branches/master/CodeSystem-KLCommomCareSocialCodes.html\">http://build.fhir.org/ig/Kirstinerosenbeck/FKInfo/branches/master/CodeSystem-KLCommomCareSocialCodes.html</a></p>\n<p>It is not a referencing problem. The CodeSystem is also on the hapi server, and everything works as it should for explicitly defined ValueSets.</p>",
        "id": 210969071,
        "sender_full_name": "Kirstine Rosenbeck Gøeg",
        "timestamp": 1600847513
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> That is great. To be honest, I have already looked in the Ontoserver documentation. I could only find descriptions of the use of filters for LOINC and SNOMED CT - not FHIR CodeSystem, and that is the reason I didn't explored this option further at first. Is it described in the documentation?</p>",
        "id": 210973882,
        "sender_full_name": "Kirstine Rosenbeck Gøeg",
        "timestamp": 1600850646
    },
    {
        "content": "<p>It probably isn't. The intention is to follow <a href=\"http://hl7.org/fhir/codesystem.html#properties\">http://hl7.org/fhir/codesystem.html#properties</a>, but it does differ somewhat (the Ontoserver implementation predates that section). The built-in filters we support for any FHIR CodeSystem that you upload (whether or not you declare them) are:</p>\n<ul>\n<li><code>concept</code>(with operators =, in, not-in, isa, is-not-a, regex, generalizes and descendent-of)</li>\n<li><code>parent</code> and <code>child</code> (=, in, not-in, exists)</li>\n<li><code>inactive</code> and <code>definition</code> (=, exists)<br>\nAlso, you can declare a CodeSystem filter with the same name as a property, and the server will evaluate those as well. The set of filter operators that will be accepted is dependent on the type of the property (e.g. is-a or generalizes are only available for code- or coding-typed properties)</li>\n</ul>",
        "id": 211096691,
        "sender_full_name": "Jim Steel",
        "timestamp": 1600932035
    },
    {
        "content": "<p>Additionally, any declared property implicitly defines a filter of the same name with operators <code>=</code> and <code>in</code> as per <a href=\"http://hl7.org/fhir/codesystem.html#filters\">http://hl7.org/fhir/codesystem.html#filters</a></p>",
        "id": 211098770,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1600933740
    }
]