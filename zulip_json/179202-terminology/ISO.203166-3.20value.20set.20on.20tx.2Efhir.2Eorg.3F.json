[
    {
        "content": "<p>The Military History guide is using the ISO3166-3 value set (<a href=\"http://hl7.org/fhir/ValueSet/iso3166-1-3\">http://hl7.org/fhir/ValueSet/iso3166-1-3</a>) and is either getting warnings that the value set is unknown to <a href=\"http://tx.fhir.org\">tx.fhir.org</a> or errors that a code (that is known to be in the value set) isn't from the value set.  Before I spend too much time helping debug what is going on, I thought I'd quickly ask if this value set is actually on <a href=\"http://tx.fhir.org\">tx.fhir.org</a>?  <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span></p>",
        "id": 247754431,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1627675073
    },
    {
        "content": "<p>just a note that I did check and the codesystem  (urn:iso:std:iso:3166) shows as being on <a href=\"http://tx.fhir.org/r4\">tx.fhir.org/r4</a></p>",
        "id": 247754872,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1627675313
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192166\">@Jean Duteau</span> I don't think it should really matter (ideally) if the value set is already on the server or not.  I just tested it by POSTing a ValueSet/$expand query to <a href=\"http://tx.fhir.org\">tx.fhir.org</a> (i.e. <code>POST http://tx.fhir.org/r4/ValueSet/$expand</code>) with that ValueSet resource instance as the body and I get this expansion <a href=\"/user_uploads/10155/HvIrGi2G_VpnWm7vYSBZdcOm/iso3166-1-3_expansion.json\">result</a>  - which appears to be correct (with codes from \"Aruba\" to \"Zimbabwe\").  I assume that includes the code that you are looking for?  If not, then maybe it's a version issue?  And if it does, then there's something else to look for.</p>",
        "id": 247759032,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627677616
    },
    {
        "content": "<p>hmm, this is the warning that I'm getting: </p>\n<div class=\"codehilite\"><pre><span></span><code>[Unable to determine whether the provided codes are in the value set http://hl7.org/fhir/ValueSet/iso3166-1-3 because the value set or code system is not known to the validator]\n</code></pre></div>\n<p>And this is the error that Ioana was getting:</p>\n<div class=\"codehilite\"><pre><span></span><code>None of the codings provided are in the value set http://hl7.org/fhir/ValueSet/iso3166-1-3 (http://hl7.org/fhir/ValueSet/iso3166-1-3), and a coding from this value set is required) (codes = urn:iso:std:iso:3166#AFG)\n</code></pre></div>\n<p>I'll look into it some more to see what could be going on.</p>",
        "id": 247759585,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1627677935
    },
    {
        "content": "<p>Does the expansion contain your code(s)?</p>",
        "id": 247760505,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627678449
    },
    {
        "content": "<p>Obviously that doesn't immediately matter if the validator for some reason doesn't even think that it can find the value set, but at least it will be good to know if the expansion does contain what you need.</p>",
        "id": 247760811,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627678618
    },
    {
        "content": "<p>It does.  Both IRQ and AFG are there</p>",
        "id": 247762147,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1627679319
    },
    {
        "content": "<p>the server is deliberately throwing that exception</p>",
        "id": 248442515,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1628144588
    },
    {
        "content": "<p>I guess we need to look at the code (as in server code, not country code)</p>",
        "id": 248442620,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1628144729
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> what I could find is that the server tries to list the enumerated codes in the valueset - for 2-character codes, the VS is defined extensionally<br>\n<a href=\"https://tx.fhir.org/r4/ValueSet/iso3166-1-2\">https://tx.fhir.org/r4/ValueSet/iso3166-1-2</a></p>",
        "id": 248460001,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1628159180
    },
    {
        "content": "<p>but for 3-character codes, the VS definition is intensional <a href=\"https://tx.fhir.org/r4/ValueSet/iso3166-1-3\">https://tx.fhir.org/r4/ValueSet/iso3166-1-3</a></p>",
        "id": 248460053,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1628159221
    },
    {
        "content": "<p>and the server trips around that enumeration</p>",
        "id": 248460064,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1628159232
    },
    {
        "content": "<p>besides changing the server code (I can't do it at this level), is there something we could do?</p>",
        "id": 248460090,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1628159251
    },
    {
        "content": "<p>flagging for <span class=\"user-mention\" data-user-id=\"193299\">@Luke Duncan</span></p>",
        "id": 248481439,
        "sender_full_name": "Carl Leitner",
        "timestamp": 1628172320
    },
    {
        "content": "<p>Update: the  warning is now an error: ERROR: Observation/DeploymentEpisode: Observation.component[0].value.ofType(CodeableConcept): None of the codings provided are in the value set <a href=\"http://hl7.org/fhir/ValueSet/iso3166-1-3\">http://hl7.org/fhir/ValueSet/iso3166-1-3</a> (<a href=\"http://hl7.org/fhir/ValueSet/iso3166-1-3\">http://hl7.org/fhir/ValueSet/iso3166-1-3</a>), and a coding from this value set is required) (codes = urn:iso:std:iso:3166#IRQ)<br>\n== C:\\Users\\Ioana\\Documents\\GitHub\\fhir-military-service\\fsh-generated\\resources\\Observation-DeploymentEpisode1.json ==<br>\nERROR: Observation/DeploymentEpisode1: Observation.component[0].value.ofType(CodeableConcept): None of the codings provided are in the value set <a href=\"http://hl7.org/fhir/ValueSet/iso3166-1-3\">http://hl7.org/fhir/ValueSet/iso3166-1-3</a> (<a href=\"http://hl7.org/fhir/ValueSet/iso3166-1-3\">http://hl7.org/fhir/ValueSet/iso3166-1-3</a>), and a coding from this value set is required) (codes = urn:iso:std:iso:3166#AFG)</p>",
        "id": 249268528,
        "sender_full_name": "Ioana Singureanu",
        "timestamp": 1628790543
    },
    {
        "content": "<p>I have been toying with this. I have a build that is clean, but I had to reproduce the iso3166-1-3 valueset. (I am still working on getting it fully created properly, but it worked to create a valueset with the two codes your examples used)</p>",
        "id": 249358500,
        "sender_full_name": "John Moehrke",
        "timestamp": 1628860538
    },
    {
        "content": "<p>Strange... I can create a valueset that includes the two codes your examples use.. and that works. But if I create a valueset with the same regex as is found in iso3166-1-3; it fails exactly the same.</p>",
        "id": 249368034,
        "sender_full_name": "John Moehrke",
        "timestamp": 1628865368
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> ?</p>",
        "id": 249368087,
        "sender_full_name": "John Moehrke",
        "timestamp": 1628865397
    },
    {
        "content": "<p>the valueset in the IG looks just like iso3166-1-3... so it is not clear this is a problem with the valueset. This might be a problem with the validator?</p>",
        "id": 249368232,
        "sender_full_name": "John Moehrke",
        "timestamp": 1628865470
    },
    {
        "content": "<p>or is it a problem with the terminology support of the validator when the valueset is based on a regex?</p>",
        "id": 249368884,
        "sender_full_name": "John Moehrke",
        "timestamp": 1628865773
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191968\">@Ioana Singureanu</span> is it possible to just use unrestricted 3166 for now? Identify it as something that needs to be resolved in the future</p>",
        "id": 249369277,
        "sender_full_name": "John Moehrke",
        "timestamp": 1628865960
    },
    {
        "content": "<p>I tried to create the valueset without using regex. It does not seem that valuesets using exclude are working either. I tried to create a valueset made up of iso3166 excluding the 2 character codes in the iso3166-1-2 valueset. The valueset I created seems to be right, but the expansion is not. The resulting expansion still includes everything in 3166</p>\n<div class=\"codehilite\"><pre><span></span><code>ValueSet:    MilitaryCountryVS\nId: military-service-country-vs\nTitle: &quot;Military Branch country Value Set&quot;\n* include codes from system urn:iso:std:iso:3166\n* exclude codes from valueset http://hl7.org/fhir/ValueSet/iso3166-1-2\n</code></pre></div>",
        "id": 249376822,
        "sender_full_name": "John Moehrke",
        "timestamp": 1628869451
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span>  I'm also finding an issue with exclude not working on a different value set.  I had thought that I saw that the regex actually did work - but I assume from what you are saying you are finding that it is not working?  I can take another look at it.<br>\n<span class=\"user-mention\" data-user-id=\"191968\">@Ioana Singureanu</span></p>",
        "id": 249402059,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1628882498
    },
    {
        "content": "<p>The exclude did not create a valueset in the ig with proper expansion.</p>",
        "id": 249402300,
        "sender_full_name": "John Moehrke",
        "timestamp": 1628882605
    },
    {
        "content": "<p>Yes, that's similar to what I was referring to on the other value set - an incorrect code validation (probably from an incorrect expansion).  It seemed that the 'exclude' was actually being <strong>included</strong>. <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 249402698,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1628882789
    },
    {
        "content": "<p>so is this resolved?</p>",
        "id": 249677825,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1629174982
    },
    {
        "content": "<p>I think not<br>\n<a href=\"https://tx.fhir.org/r4/ValueSet/iso3166-1-3/$validate-code?system=urn:iso:std:iso:3166&amp;code=USA\">https://tx.fhir.org/r4/ValueSet/iso3166-1-3/$validate-code?system=urn:iso:std:iso:3166&amp;code=USA</a></p>",
        "id": 249686034,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1629184784
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> presuming there's something that can be done on the server, anything I can do?</p>",
        "id": 249901829,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1629315711
    },
    {
        "content": "<p>well, I had a quick look and it turned out to be some pretty simple stuff I hadn't done, so fixed next release</p>",
        "id": 250057030,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1629411978
    },
    {
        "content": "<p>thanks anyway</p>",
        "id": 250057035,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1629411984
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191968\">@Ioana Singureanu</span> fyi, the fix is coming</p>",
        "id": 250110793,
        "sender_full_name": "John Moehrke",
        "timestamp": 1629462468
    }
]