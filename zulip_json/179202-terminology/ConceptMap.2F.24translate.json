[
    {
        "content": "<p>Hi,<br>\nI've got this ConceptMap right here (-&gt; <a href=\"http://test.fhir.org/r3/ConceptMap/104\" target=\"_blank\" title=\"http://test.fhir.org/r3/ConceptMap/104\">http://test.fhir.org/r3/ConceptMap/104</a>), which has a mapping for </p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">&lt;group&gt;</span>\n    <span class=\"nt\">&lt;source</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://dmi.de/fhir/CodeSystem/kdl&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;target</span> <span class=\"na\">value=</span><span class=\"s\">&quot;urn:oid:1.3.6.1.4.1.19376.3.276.1.5.9&quot;</span><span class=\"nt\">/&gt;</span>\n     [...]\n    <span class=\"nt\">&lt;element&gt;</span>\n      <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;AM010102&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;G-AEP Kriterien&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;target&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;AUFN&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Einweisungs- und Aufnahmedokumente&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;equivalence</span> <span class=\"na\">value=</span><span class=\"s\">&quot;wider&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/target&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n  <span class=\"nt\">&lt;/group&gt;</span>\n</pre></div>\n\n\n<p>however, the Operation <a href=\"http://test.fhir.org/r3/ConceptMap/104/$translate?code=AM010102&amp;system=http://dmi.de/fhir/CodeSystem/kdl\" target=\"_blank\" title=\"http://test.fhir.org/r3/ConceptMap/104/$translate?code=AM010102&amp;system=http://dmi.de/fhir/CodeSystem/kdl\">http://test.fhir.org/r3/ConceptMap/104/$translate?code=AM010102&amp;system=http://dmi.de/fhir/CodeSystem/kdl</a><br>\nreturns:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">&lt;Parameters</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;parameter&gt;</span>\n    <span class=\"nt\">&lt;name</span> <span class=\"na\">value=</span><span class=\"s\">&quot;result&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;valueBoolean</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span><span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;/parameter&gt;</span>\n  <span class=\"nt\">&lt;parameter&gt;</span>\n    <span class=\"nt\">&lt;name</span> <span class=\"na\">value=</span><span class=\"s\">&quot;message&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;valueString</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Code AM010102 in system http://dmi.de/fhir/CodeSystem/kdl not recognized&quot;</span><span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;/parameter&gt;</span>\n<span class=\"nt\">&lt;/Parameters&gt;</span>\n</pre></div>\n\n\n<p>I would argue, that the given the ConceptMap, the server has everything it needs to answer the request...<br>\nBut apparently, it's running additional checks like validating the Code against the source ValueSet or against the CodeSystem? Which additional Resources do I need?</p>",
        "id": 154013617,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1540908473
    },
    {
        "content": "<p>Well, the server isn't recognizing the source value set or the group source code system, so I expect you need to add something for those:<br>\n<code>http://test.fhir.org/r3/ValueSet?url=http%3A//dmi.de/fhir/ValueSet/kdl</code><br>\n<code>http://test.fhir.org/r3/CodeSystem?url=http%3A//dmi.de/fhir/CodeSystem/kdl</code></p>",
        "id": 154013633,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1540911537
    },
    {
        "content": "<p>I added the CodeSystem, now I get</p>\n<div class=\"codehilite\"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Parameters xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n    &lt;parameter&gt;\n        &lt;name value=&quot;result&quot;/&gt;\n        &lt;valueBoolean value=&quot;false&quot;/&gt;\n    &lt;/parameter&gt;\n    &lt;parameter&gt;\n        &lt;name value=&quot;message&quot;/&gt;\n        &lt;valueString value=&quot;Invalid class typecast&quot;/&gt;\n    &lt;/parameter&gt;\n&lt;/Parameters&gt;\n</pre></div>",
        "id": 154013645,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1540912515
    },
    {
        "content": "<p>Same after adding the ValueSet...</p>",
        "id": 154013647,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1540912578
    },
    {
        "content": "<p>Both URLs you suggested resolve to the corresponding Ressources now...</p>",
        "id": 154013649,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1540912643
    },
    {
        "content": "<p>\"Invalid class typecast\" sounds like a server bug to me, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>?</p>",
        "id": 154013653,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1540912749
    },
    {
        "content": "<p>yes, and I think I've fixed that</p>",
        "id": 154013881,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540937905
    },
    {
        "content": "<p>I'll upgrade the server</p>",
        "id": 154013884,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540937911
    },
    {
        "content": "<p>BTW, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> : <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> doesn't allow the uploading of ConceptMaps. Is that on purpose?</p>",
        "id": 154015856,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1541494440
    },
    {
        "content": "<p>yes because lots of processes depend on it being correct. I can upload, but others can't</p>",
        "id": 154015862,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541498070
    },
    {
        "content": "<p>Ok, but the behaviour of $translate should be the same on <a href=\"http://test.fhir.org\" target=\"_blank\" title=\"http://test.fhir.org\">test.fhir.org</a>, right?</p>",
        "id": 154016178,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1541599175
    },
    {
        "content": "<p>yes same serfver</p>",
        "id": 154016344,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541619308
    },
    {
        "content": "<p>though I think <a href=\"http://test.fhir.org\" target=\"_blank\" title=\"http://test.fhir.org\">test.fhir.org</a> is an upgrade behind, which I'll be fixing in a few hours</p>",
        "id": 154016345,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541619327
    },
    {
        "content": "<p>The operation definition for <code>$translate</code> says very little about how to deal with various error cases - eg translating an unknown code in a known code system, or translating an unknown code system.<br>\nIn particular, should the operation return a 200 or a 4xx (400, 404, 4??) status code</p>",
        "id": 174681303,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1567380590
    },
    {
        "content": "<p>my take: <br>\n- if the inputs are not understood, return 400<br>\n- if the inputs are understood, but there is no translation, then 200 OK with result = false<br>\n- there are always cases where the server can't be sure that the client asked the wrong question, so it's impossible to nail down 4xx vs 5xx</p>\n<p>it would be good to have a task to clarify this</p>",
        "id": 174681360,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567380691
    },
    {
        "content": "<p>5xx means error internal to server ; 4xx is \"error\" in the request itself (where this may include not supported by this server; 501 might be okay for this, by my preference would be for a 422)</p>",
        "id": 174681453,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1567380900
    },
    {
        "content": "<p>sure. we can certainly recommend 4xx or even 422 but I don't think it's good to make it a SHALL</p>",
        "id": 174681474,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567380957
    },
    {
        "content": "<p>Can you clarify what \"inputs are (not) understood\" means?  I don't think of this as a known/unknown issue</p>",
        "id": 174681531,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1567381025
    },
    {
        "content": "<p>either inputs are missing, or the values are not considered to be valid.</p>",
        "id": 174681700,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567381356
    },
    {
        "content": "<p>So here's an example call <code>[base]/ConceptMap/$translate?system=http://hl7.org/fhir/address-use&amp;code=xxx&amp;source=http://hl7.org/fhir/ValueSet/address-use&amp;target=http://terminology.hl7.org/ValueSet/v3-AddressUse</code> where the code being translated, <code>xxx</code> is not in the code system <code>http://hl7.org/fhir/address-use</code></p>\n<p>Our server \"understands\" the inputs - a code &amp; a system URI, but there is no translation because the code is not valid.  We return a 200 and a result = false.  Should we instead return a 400?  This would align with <code>$lookup</code>, but does require more processing</p>",
        "id": 174980448,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1567694578
    },
    {
        "content": "<p>I agree that 200 is right in this case, and we should document that</p>",
        "id": 175011142,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567714833
    }
]