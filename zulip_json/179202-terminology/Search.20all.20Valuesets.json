[
    {
        "content": "<p><a href=\"http://jira.hl7.org/browse/FHIR-19442\">FHIR#19442</a> proposes to remove the expand across value sets. It wasn't my favourite piece of API but I'm stunned that the requirement it represents (\"text search across all terminology on the server\") isn't a compelling thing for other servers.</p>\n<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> surely your customers are asking for this?</p>",
        "id": 257948967,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634505089
    },
    {
        "content": "<p>The way the <code>@all</code> valuset is defined (all <code>ValueSets</code> known to the system) is problematic from my perspective - I would be more open to all <code>CodeSystems</code> known to the system (but how to treat multiple versions of the same CodeSystem, especially if additional parameters like <code>property=parent</code> are supplied?)</p>",
        "id": 257949965,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634505955
    },
    {
        "content": "<p>So far, we've only had one customer ask about this capability.</p>",
        "id": 257950062,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634506034
    },
    {
        "content": "<p>This part of the definition: \"Note that this URL has no fixed meaning - its interpretation is server specific\" would, I guess, allow us to provide _some_ support, but I'm not sure how useful it would be in practice.</p>",
        "id": 257950182,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634506143
    },
    {
        "content": "<p>I'd be ok with searching all code systems; that was defined before we had CodeSystem.</p>",
        "id": 257953138,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634509016
    },
    {
        "content": "<p>I guess that would the GET [base]/CodeSystem/$search?text=xxxxx</p>",
        "id": 257953162,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634509049
    },
    {
        "content": "<p>I'm happy to retire @all if we define something equivalent on codesystem</p>",
        "id": 257953173,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634509062
    },
    {
        "content": "<p>Heh, I had guessed that it was defined before CodeSystem.<br>\nIf it were instead defined in terms of \"all CodeSystems known to the system\", we're still stuck with the <code>property</code> problem (although that is not limited to this use-case; I can always define an explicit ValueSet that uses multiple versions of the same CodeSystem).</p>",
        "id": 257954104,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634509974
    },
    {
        "content": "<p>I agree that this makes more sense for code systems than value sets, but still quite challenging for TS providers to implement. For example, what about searching for incomplete terms? That might easily result in GIGO. It's a feature that I might use, but I'm not sure that I would provide it to anyone entering data in an EHR/EMR/PHR.</p>",
        "id": 257954784,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1634510682
    },
    {
        "content": "<p>totally wouldn't provide to end-users, but totally important for people building value sets  and concept maps</p>",
        "id": 257955288,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634511229
    },
    {
        "content": "<p>Naive implementation is to just do equivalent of [base]/CodeSystem/_search, construct a ValueSet from the results, then pass through to $expand.</p>",
        "id": 257956727,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634512570
    },
    {
        "content": "<p>that's possible, yes. though not many systems support _text on code system, and not on code systems on snomed ct</p>",
        "id": 257957201,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634513046
    },
    {
        "content": "<p>sorry - I wasn't proposing using _text -- just a way of implementing an implicit ValueSet for all codesystems -- so a search to get \"all known code systems, possibly mix in some extras like SNOMED that may only have an implied existence, and build an internal ValueSet set with (long) list of includes.</p>",
        "id": 257962366,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634518428
    },
    {
        "content": "<p>sure. but what should the API look like for that? that's what I was proposing as an alternative for getting rid of the all valuesets thign</p>",
        "id": 257962445,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634518508
    },
    {
        "content": "<p>oh, ok, then you'd want it to return Codings?</p>",
        "id": 257964429,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634520429
    },
    {
        "content": "<p>returning an expansion is ok</p>",
        "id": 257964947,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634520988
    },
    {
        "content": "<p>I think I'd be happier with the implicit ValueSet approach -- my quick prototyping gives reasonable results if I define <code>@all</code> as all codes from the latest (CodeSystem.version) of all CodeSystems known to the system.</p>",
        "id": 257996233,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634547154
    },
    {
        "content": "<p>well, I think that a text search of all terminology content is a useful thing to have from a consumer's point of view. So I'm not on board with simply removing the functionality per the task at hand.</p>",
        "id": 258000404,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634549369
    },
    {
        "content": "<p>Given that \"all ValueSets known to the system\" should include all the \"all codes in a codesystem\" implicit valuesets and this would subsume any sub-setting valueset, then I think the @all valueset works as being defined in terms of code systems, not valuesets.<br>\nThe next question is whether its \"latest versions of\" or \"all versions of\" the codesystems.</p>",
        "id": 258123073,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634603227
    },
    {
        "content": "<p>Doing <code>curl 'http://localhost:8090/fhir/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/@all&amp;count=10&amp;activeOnly=true&amp;filter=lung'</code> in my prototype with 1246 CodeSystems (mostly FHIR, but several SNOMEDs and LOINC) takes about 8-10 s, finds ~7000 matches and produces 96k of JSON which is mostly just listing all the code system-version pairs scanned.</p>",
        "id": 258123416,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634603480
    },
    {
        "content": "<p>The <code>contains</code> part of the result looks like:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"contains\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://ncicb.nci.nih.gov/xml/owl/EVS/Thesaurus.owl\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"19.11d\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"C12468\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Lung\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://jim\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"0.0.3\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"lung\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"lung\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://id.who.int/icd11/foundation\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2019-04\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"1338477196\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Lung\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://terminology.hl7.org/CodeSystem/v2-0550\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2.9\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"LUNG\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Lung\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://jim3\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"0.1.0\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"lung\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"lung\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://terminology.hl7.org/CodeSystem/service-type\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"3.5.0\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"380\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Lung\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://id.who.int/icd11/mms\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2019-04\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"XA57M6\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Lung\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://jim\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"0.0.9\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"lung\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"lung\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://snomed.info/sct\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://snomed.info/sct/32506021000036107/version/20200430\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"228220003\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Lungi\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://snomed.info/sct\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"version\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://snomed.info/sct/32506021000036107/version/20200531\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"228220003\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Lungi\"</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>Note that there are separate entries for different versions of the same CodeSystem.</p>",
        "id": 258123517,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634603551
    },
    {
        "content": "<p>well... server discretion on that?</p>",
        "id": 258131863,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634610538
    },
    {
        "content": "<p>My experimental support for <code>http://hl7.org/fhir/ValueSet/@all</code> is now testable on <a href=\"https://r4.ontoserver.csiro.au/fhir\">https://r4.ontoserver.csiro.au/fhir</a><br>\nNote that there's &gt; 11M (versioned) codes in this sandbox server, so it will not be doing \"realtime\" <code>$expand?filter=</code> :-)</p>",
        "id": 258306363,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1634699892
    }
]