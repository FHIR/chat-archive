[
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> &amp; <span class=\"user-mention\" data-user-id=\"250090\">@Yannick Lagger</span>  ,<br>\nI am using vscode-fhir-tools for validating Patient resource. However, I am getting error for valid ethnicity code.<br>\nCould you please check, if this is the issue in the tool itself as the code is valid.<br>\nKindly advise.</p>\n<p>Thanks<br>\nAnkita</p>",
        "id": 265274882,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639735142
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/00GE3g718meCc1ZUTu7CcVlC/Patient.json\">Patient.json</a></p>",
        "id": 265274899,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639735155
    },
    {
        "content": "<p>FAILURE: 1 errors, 1 warnings, 3 notes<br>\nError @ Patient.extension[1].extension[0].value.ofType(Coding) (line 128, col42): The Coding provided (urn:oid:2.16.840.1.113883.6.238#2135-2) is not in the value set <a href=\"http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category\">http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category</a>, and a code is required from this value set. (error message = Not in value set <a href=\"http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category\">http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category</a>)<br>\nInformation @ Patient.extension[0] (line 105, col10): Unknown extension <a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race\">http://hl7.org/fhir/us/core/StructureDefinition/us-core-race</a><br>\nInformation @ Patient.extension[0].extension[0].value.ofType(Coding) (line 111, col42): Code System URI 'urn:oid:2.16.840.1.113883.6.238' is unknown so the code cannot be validated<br>\nInformation @ Patient.extension[1].extension[0].value.ofType(Coding) (line 128, col42): Code System URI 'urn:oid:2.16.840.1.113883.6.238' is unknown so the code cannot be validated</p>",
        "id": 265274920,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639735171
    },
    {
        "content": "<p>this error message comes from the FHIR validator itself, not from vscode-fhir-tools. </p>\n<p>the information 'Unknown extension' means probably that you need to add the us-core ig to the parameters (via -ig) that the validator knows the <a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race\">http://hl7.org/fhir/us/core/StructureDefinition/us-core-race</a> extension</p>",
        "id": 265275806,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1639735616
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span>  for the response. I understand that its coming from FHIR validator, however, while validating the same resource through ClinFHIR validator, there is no such error. Not sure why do we have different behavior, as both are using same FHIR validator.</p>",
        "id": 265277638,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639736547
    },
    {
        "content": "<p>maybe ClinFHIR is configured with us-core? did you add us-core as an ig to the FHIR Validitor parameter? Alternatively you can use <a href=\"https://validator.fhir.org/\">https://validator.fhir.org/</a> and specify the ig in the validator options.</p>",
        "id": 265277971,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1639736804
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> for the suggestion. I have verified using the FHIR Validator jar along with ig parameter and got error for both Race &amp; Ethnicity.</p>",
        "id": 265278797,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639737262
    },
    {
        "content": "<p><em>FAILURE</em>: 2 errors, 0 warnings, 2 notes<br>\n  Error @ Patient.extension[0].extension[0].value.ofType(Coding) (line 111, col54) : The Coding provided (urn:oid:2.16.840.1.113883.6.238#2106-3) is not in the value set <a href=\"http://hl7.org/fhir/us/core/ValueSet/omb-race-category\">http://hl7.org/fhir/us/core/ValueSet/omb-race-category</a>, and a code is required from this value set.  (error message = Error from server: Unable to find value set <a href=\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103\">http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103</a>)<br>\n  Error @ Patient.extension[1].extension[0].value.ofType(Coding) (line 128, col54) : The Coding provided (urn:oid:2.16.840.1.113883.6.238#2135-2) is not in the value set <a href=\"http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category\">http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category</a>, and a code is required from this value set.  (error message = Error from server: Unable to find value set <a href=\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.102\">http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.102</a>)<br>\n  Information @ Patient.extension[0].extension[0].value.ofType(Coding) (line 111, col54) : Code System URI 'urn:oid:2.16.840.1.113883.6.238' is unknown so the code cannot be validated<br>\n  Information @ Patient.extension[1].extension[0].value.ofType(Coding) (line 128, col54) : Code System URI 'urn:oid:2.16.840.1.113883.6.238' is unknown so the code cannot be validated<br>\nPS D:\\07-FHIR\\FHIR Validator&gt;</p>",
        "id": 265278834,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639737286
    },
    {
        "content": "<p>Both are valid codes as per US Core, still validator is throwing error. Could you please suggest someone from FHIR Validator Team who can help here.</p>",
        "id": 265279095,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639737415
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> &amp; <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Kindly look into this issue and share your feedback.<br>\nThanks</p>",
        "id": 265281319,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639738678
    },
    {
        "content": "<p>Looks to me that your  validator didn't load the value set expansion. Is there another error stating why it couldn't/didn't load the value set?</p>",
        "id": 265297177,
        "sender_full_name": "Daniel Venton",
        "timestamp": 1639748980
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"335936\">@Daniel Venton</span> I am not getting any other error apart from this. I tried validation using VS-Tool and also through the validator jar directly. However, we have same error in both the cases.</p>",
        "id": 265304514,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639752422
    },
    {
        "content": "<p>Loading<br>\n  Load FHIR v4.0 from hl7.fhir.r4.core#4.0.1 - 4575 resources (00:04.0542)<br>\n  Load hl7.terminology#3.0.0 - 3795 resources (00:02.0202)<br>\n  Terminology server <a href=\"http://tx.fhir.org\">http://tx.fhir.org</a> - Version 2.0.10 (00:02.0462)<br>\n  Get set...  go (00:00.0087)<br>\nValidating<br>\n  Validate ..\\Resources\\Patient\\Patient1.fhir.json   ..Detect format for ..\\Resources\\Patient\\Patient1.fhir.json<br>\n  Load hl7.fhir.uv.bulkdata#2.0.0 - 6 resources (00:04.0767)<br>\n  Load hl7.fhir.uv.smart-app-launch#2.0.0 - 0 resources (00:00.0003)<br>\n  Load us.nlm.vsac#0.3.0 - 8916 resources (00:03.0305)<br>\n  Load hl7.fhir.uv.sdc#2.7.0 - 60 resources (00:00.0014)<br>\n  Load hl7.fhir.us.core#4.1.0 - 177 resources (00:00.0020)<br>\n 00:16.0005<br>\nDone. Times: Loading: 00:09.0533, validation: 00:24.0120. Memory = 2Gb</p>",
        "id": 265305131,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639752670
    },
    {
        "content": "<p>Now that I look at it more, I think it tells you the problem \"Unable to find value set <a href=\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103\">http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103</a>)\"<br>\nThat value set doesn't exist on nlm (I didn't verify)</p>",
        "id": 265327256,
        "sender_full_name": "Daniel Venton",
        "timestamp": 1639760639
    },
    {
        "content": "<p>We didn't use VSAC for R&amp;E  until the current balloted version (4.1.0) and if you read the spec and look at the terminology, we have big bold Ballot comments stating that there is a tooling issue with integration of VSAC.  for example, see  <a href=\"http://hl7.org/fhir/us/core/2022Jan/ValueSet-detailed-race.html\">http://hl7.org/fhir/us/core/2022Jan/ValueSet-detailed-race.html</a>.</p>\n<p>I think your solution is to specify the version of US Core when using the canonical e.g., :  <code>http://hl7.org/fhir/us/core/ValueSet/detailed-ethnicity|3.1.1 </code></p>",
        "id": 265389442,
        "sender_full_name": "Eric Haas",
        "timestamp": 1639798999
    },
    {
        "content": "<p>I got it.. Thank you <span class=\"user-mention\" data-user-id=\"335936\">@Daniel Venton</span> &amp; <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>  for the feedback.. I will try with version as specified by <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> and share the details.</p>",
        "id": 265391621,
        "sender_full_name": "Ankita Srivastava",
        "timestamp": 1639801959
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> - <a href=\"http://tx.fhir.org\">tx.fhir.org</a> doesn't have any previous versions of the R&amp;E ValueSets (e.g., <a href=\"https://tx.fhir.org/r4/ValueSet/?_id=omb-race-category\">https://tx.fhir.org/r4/ValueSet/?_id=omb-race-category</a>). Given this, how should one programmatically retrieve the expansions of these ValueSets?</p>",
        "id": 269467591,
        "sender_full_name": "Matt Rouhana",
        "timestamp": 1643225215
    },
    {
        "content": "<p><a href=\"https://tx.fhir.org/r4/ValueSet/?_id=omb-race-category\">https://tx.fhir.org/r4/ValueSet/?_id=omb-race-category</a></p>\n<p>Gives me:  </p>\n<p><a href=\"/user_uploads/10155/Hv5lDy2TQsqyJg6pkwmePKVO/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/Hv5lDy2TQsqyJg6pkwmePKVO/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/Hv5lDy2TQsqyJg6pkwmePKVO/image.png\"></a></div>",
        "id": 269477857,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643229312
    },
    {
        "content": "<p>So you can fetch the value set.  I am not sure of the question and I am probably not going to be able to answer it.  but maybe <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>  can.  He a terminology wizard!</p>",
        "id": 269478080,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643229399
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>  - I need the <em>expansion</em> of the ValueSet. Trying to obtain this via <code>https://tx.fhir.org/r4/ValueSet/omb-race-category/$expand?_format=json</code> produces an error, because <a href=\"http://tx.fhir.org\">tx.fhir.org</a> can't find the VSAC ValueSets (upon which the R&amp;E ValueSets now depend):</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"OperationOutcome\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"text\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"status\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"generated\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"div\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;p&gt;Unable to find value set \\\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.2074.1.1.3\\\"&lt;/p&gt;&lt;/div&gt;\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"issue\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"severity\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"error\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"not-supported\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"details\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"text\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Unable to find value set \\\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.2074.1.1.3\\\"\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"diagnostics\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"(00000000009146BE){FHIRServer.exe} [0000000000D156BE] Unknown function at TMethodImplementationIntercept + $85B4EE\\r\\n(0000000005550ADC){FHIRServer.exe} [0000000005951ADC] Unknown function at TMethodImplementationIntercept + $549790C\\r\\n(0000000005552776){FHIRServer.exe} [0000000005953776] Unknown function at TMethodImplementationIntercept + $54995A6\\r\\n(000000000004C8A7){FHIRServer.exe} [000000000044D8A7] Unknown function at __dbk_fcall_wrapper + $2E867\\r\\n(000000000004D61B){FHIRServer.exe} [000000000044E61B] Unknown function at __dbk_fcall_wrapper + $2F5DB\\r\\n(00000000000118F6){FHIRServer.exe} [00000000004128F6]\\r\\n(0000000000011931){FHIRServer.exe} [0000000000412931]\\r\\n(00000000009146BE){FHIRServer.exe} [0000000000D156BE] Unknown function at TMethodImplementationIntercept + $85B4EE\\r\\n(00000000009150CC){FHIRServer.exe} [0000000000D160CC] Unknown function at TMethodImplementationIntercept + $85BEFC\\r\\n(0000000000912886){FHIRServer.exe} [0000000000D13886] Unknown function at TMethodImplementationIntercept + $8596B6\\r\\n(00000000009114E5){FHIRServer.exe} [0000000000D124E5] Unknown function at TMethodImplementationIntercept + $858315\\r\\n(0000000000A61514){FHIRServer.exe} [0000000000E62514] Unknown function at TMethodImplementationIntercept + $9A8344\\r\\n(0000000000A60CC4){FHIRServer.exe} [0000000000E61CC4] Unknown function at TMethodImplementationIntercept + $9A7AF4\\r\\n(000000000350C296){FHIRServer.exe} [000000000390D296] Unknown function at TMethodImplementationIntercept + $34530C6\\r\\n(0000000000AF7AC8){FHIRServer.exe} [0000000000EF8AC8] Unknown function at TMethodImplementationIntercept + $A3E8F8\\r\\n(0000000000AEFE07){FHIRServer.exe} [0000000000EF0E07] Unknown function at TMethodImplementationIntercept + $A36C37\\r\\n(000000000383431D){FHIRServer.exe} [0000000003C3531D] Unknown function at TMethodImplementationIntercept + $377B14D\\r\\n(0000000003830F4C){FHIRServer.exe} [0000000003C31F4C] Unknown function at TMethodImplementationIntercept + $3777D7C\\r\\n(000000000382D648){FHIRServer.exe} [0000000003C2E648] Unknown function at TMethodImplementationIntercept + $3774478\\r\\n(0000000003850ED8){FHIRServer.exe} [0000000003C51ED8] Unknown function at TMethodImplementationIntercept + $3797D08\\r\\n(000000000384F1B8){FHIRServer.exe} [0000000003C501B8] Unknown function at TMethodImplementationIntercept + $3795FE8\\r\\n(000000000021DB7C){FHIRServer.exe} [000000000061EB7C] Unknown function at TMethodImplementationIntercept + $1649AC\\r\\n(000000000021F40C){FHIRServer.exe} [000000000062040C] Unknown function at TMethodImplementationIntercept + $16623C\\r\\n(00000000001FA7AE){FHIRServer.exe} [00000000005FB7AE] Unknown function at TMethodImplementationIntercept + $1415DE\\r\\n(00000000001F8861){FHIRServer.exe} [00000000005F9861] Unknown function at TMethodImplementationIntercept + $13F691\\r\\n(00000000001FFC54){FHIRServer.exe} [0000000000600C54] Unknown function at TMethodImplementationIntercept + $146A84\\r\\n(00000000001FEB4D){FHIRServer.exe} [00000000005FFB4D] Unknown function at TMethodImplementationIntercept + $14597D\\r\\n(000000000012F1C3){FHIRServer.exe} [00000000005301C3] Unknown function at TMethodImplementationIntercept + $75FF3\\r\\n(00000000000124ED){FHIRServer.exe} [00000000004134ED]\\r\\n(00000000000003D2){KERNEL32.DLL} [00007FFFA78813D2] BaseThreadInitThunk + $22\\r\\n(00000000000144F4){ntdll.dll   } [00007FFFA81E54F4] RtlUserThreadStart + $34\\r\\n\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}]</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 269493711,
        "sender_full_name": "Matt Rouhana",
        "timestamp": 1643236778
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"251487\">@Matt Rouhana</span> To make the expansion for this value set work, <a href=\"http://tx.fhir.org\">tx.fhir.org</a> would need to have copies of the other two value sets and the code systems that they are based on.  That's potentially doable technically, but would need to verify the licensing and be sure that it's feasible (might need discussion with HTA).</p>",
        "id": 269494962,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1643237559
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>  is it possible to go in the terminology server's wayback machine and grab a prior version of a valueset like from USCore ver 3.1.1?</p>",
        "id": 269513811,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643246727
    },
    {
        "content": "<p>I think that is what he is asking, because it is giving us the latest valueset (ver 4.1.0)  and that is referring to VSAC.</p>",
        "id": 269514266,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643247094
    },
    {
        "content": "<p>never mind, I just answered my own question:  based on the <code>$expand</code> <a href=\"http://build.fhir.org/valueset-operation-expand.html\">OperationDefinition </a>   can add the version to get the expansion ....</p>",
        "id": 269514577,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643247380
    },
    {
        "content": "<ul>\n<li>\n<p>valueSetVersion<br>\n-0..1</p>\n</li>\n<li>\n<p>string            </p>\n</li>\n<li>The identifier that is used to identify a specific version of the value set to be used when generating the expansion. This is an arbitrary value managed by the value set author and is not expected to be globally unique. For example, it might be a timestamp (e.g. yyyymmdd) if a managed version is not available.</li>\n</ul>",
        "id": 269514613,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643247440
    },
    {
        "content": "<p><code>GET [base]/ValueSet/$expand?url=http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category&amp;amp;valueSetVerson=3.1.1</code></p>",
        "id": 269514746,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643247565
    },
    {
        "content": "<p>I tried:<br>\n<code>https://tx.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category&amp;valueSetVersion=3.1.1</code>  but get the same issue  its looking for VSAC even though the ValueSet in 3.1.1 does not use  VSAC?  <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>  is the valueSetVersion supported for <a href=\"http://tx.fhir.org\">tx.fhir.org</a>?</p>",
        "id": 269515380,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643248133
    },
    {
        "content": "<p>I</p>",
        "id": 269528977,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1643262707
    },
    {
        "content": "<p>I'll have a look at this, but I think it's a more general issue waiting for me to sort out vsac</p>",
        "id": 269529003,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1643262723
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> I think there's only one version of the ValueSet available on <a href=\"http://tx.fhir.org\">tx.fhir.org</a>, and it's the latest one (4.1.0).</p>",
        "id": 269578359,
        "sender_full_name": "Matt Rouhana",
        "timestamp": 1643293270
    },
    {
        "content": "<p>I've tried as many publicly available terminology servers as I can find - there doesn't appear to be a way to <code>$expand</code> any of the US Core ValueSets on any of them (either because the ValueSet doesn't exist on the server, the server doesn't support the <code>$expand</code> operation, or the server can't find the dependent VSAC ValueSets).</p>",
        "id": 269584881,
        "sender_full_name": "Matt Rouhana",
        "timestamp": 1643295736
    },
    {
        "content": "<p>the only short term fix I can think of is use the version 3.1.1 package where the R and E codes are enumerated.</p>",
        "id": 270076268,
        "sender_full_name": "Eric Haas",
        "timestamp": 1643652178
    }
]