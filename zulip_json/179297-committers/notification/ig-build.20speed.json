[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>  The 3rd column has build times for the last 20 jobs, ranging from 1.5min to 12min (depending on the specific IG) -- they don't seem obviously different than expected... Can you point to a specific result where you're having trouble?</p>\n<div class=\"codehilite\"><pre><span></span><code>$ kubectl -n fhir get jobs  --sort-by=.metadata.creationTimestamp | tail -n 20\nig-buildhxz2r   1/1           11m        5h17m\nig-buildc2h6x   1/1           3m50s      5h5m\nig-buildwb84f   1/1           5m31s      4h59m\nig-buildxzhwx   1/1           6m57s      4h12m\nig-build685h9   1/1           12m        3h41m\nig-build5cw9d   1/1           90s        3h38m\nig-buildw52pw   1/1           8m17s      3h38m\nig-buildv8vc6   1/1           88s        3h38m\nig-buildwjtlr   1/1           12m        3h13m\nig-buildbnrb2   1/1           6m53s      3h9m\nig-buildf5gjn   1/1           3m6s       172m\nig-buildrf8q7   1/1           7m3s       107m\nig-build5msbp   1/1           3m50s      90m\nig-buildskqst   1/1           3m29s      79m\nig-builds7n46   1/1           16m        77m\nig-buildv2658   1/1           9m33s      59m\nig-build7sd5m   1/1           17m        56m\nig-buildgtnjd   1/1           9m38s      44m\nig-buildhj2gn   1/1           10m        39m\nig-build76chr   0/1           10m        10m\n</code></pre></div>",
        "id": 216506525,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605204860
    },
    {
        "content": "<p>OK so 10-20 minutes is expected. It is killing my productivity when editing<br>\nand developing a spec in real time.   Additionally, the build slow my<br>\nlaptop down so much as to make it unavailable.<br>\nAnybody have an efficient workflow.  I like to see the rendered output for<br>\neach change without having to go back 10-20 minutes later to review.</p>\n<p>Eric M Haas, DVM, MS<br>\nHealth eData Inc<br>\n35 Crescent Avenue, Sausalito, CA 94965</p>",
        "id": 216514969,
        "sender_full_name": "Eric Haas",
        "timestamp": 1605208790
    },
    {
        "content": "<p>which IG is this?</p>",
        "id": 216521786,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1605212286
    },
    {
        "content": "<p>us core</p>",
        "id": 216521860,
        "sender_full_name": "Eric Haas",
        "timestamp": 1605212333
    },
    {
        "content": "<p>I can't run eCR or BFDR locally without walking away from my machine and doing something else for a while. (My solution is to never run locally).</p>\n<p>The only \"efficient\" workflow I can suggest is not running on your machine. I use Trifolia to run outside of the CI build without slowing my machine down.  Of course, I still have to wait, but at least I can use my machine.  </p>\n<p>I also often just use the CI build as my development environment  - just commit a lot and keep working and then check changes there. Again, at least it doesn't slow my machine down.</p>\n<p>My biggest issue is that I often forget what change I was even trying to test by the time it finished running (and I've made a bunch more changes since). </p>\n<p>I just committed eCR to Git at 6:33 and the CI build finished at 6:47.</p>\n<p>Both BFDR and eCR are very large - lots of profiles and even more examples, so I just assumed the length of time was par for the course. (And I get super envious when people mention that their IGs only take 2 minutes!)</p>",
        "id": 216527524,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605214649
    },
    {
        "content": "<p>honestly, why work with a slow laptop? You have a bad io system if your laptop becomes unresponsive because you are running the IG publisher. It's single threaded, so it's not CPU</p>",
        "id": 216528925,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1605215373
    },
    {
        "content": "<p>It's brand new. I don't know what to do to make it faster?</p>",
        "id": 216529092,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605215459
    },
    {
        "content": "<p>what is it?</p>",
        "id": 216529185,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1605215515
    },
    {
        "content": "<p>It's the highest spec 13\" MacBook Pro.</p>",
        "id": 216529197,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605215519
    },
    {
        "content": "<p>then it shouldn't become unusable</p>",
        "id": 216529265,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1605215535
    },
    {
        "content": "<p>I don't even notice an impact on my laptop for running an IG, except the fan will speed up</p>",
        "id": 216529308,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1605215571
    },
    {
        "content": "<p>but it's not a mac</p>",
        "id": 216529315,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1605215577
    },
    {
        "content": "<p>I don't know enough about hardware to know how to stop it from slowing down.</p>",
        "id": 216529321,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605215580
    },
    {
        "content": "<p>Anyway - I'm reasonably happy with using Trifolia or the CI build, so not really any issues. It's not like it's going to be any faster running locally.</p>",
        "id": 216529498,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605215655
    },
    {
        "content": "<p>I was really just suggesting an alternate workflow for Eric.</p>",
        "id": 216529589,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605215698
    },
    {
        "content": "<p>I use the CI build too.  same as you but like you said its hard to keep track of changes</p>",
        "id": 216531633,
        "sender_full_name": "Eric Haas",
        "timestamp": 1605216753
    },
    {
        "content": "<p>The CI build should not be slower than your local hardware; we're throwing a lot of compute resources at this task! Are there folks seeing the CI build running slower than a from-scratch local build?</p>",
        "id": 216537106,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605219319
    },
    {
        "content": "<p>(If the issue is just \"running the publisher is slow\" rather than \"the auto-build pipeline is slow\", that's important too -- but we should make sure we know what/where we're trying to optimize.)</p>",
        "id": 216537323,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605219436
    },
    {
        "content": "<p>Builds run fine on my machine.  Take 1-2 minutes depending on the IG and I can still work while they're running - though the fan does kick in.  No noticable difference in speed on the CI build.  Note that I do have 32GB of RAM, which probably helps</p>",
        "id": 216539856,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1605220789
    },
    {
        "content": "<p>I have 32GB of RAM. 1-2 minutes? That would be amazing. Have you ever run eCR or BFDR on your machine??! How many profiles and examples do your IGs have?</p>",
        "id": 216542653,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605222519
    },
    {
        "content": "<p>Oh wait - you're saying your builds take the same amount of time on your machine as the CI build. eCR takes close to 15 mins on the CI build...</p>",
        "id": 216542818,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605222621
    },
    {
        "content": "<p>USCore:</p>\n<p>Autobuild; 16+ minutes  ( It looks like about 10 of that is version comparison)<br>\non my macbook air ca 2016:  10:43 minutes</p>",
        "id": 216542843,
        "sender_full_name": "Eric Haas",
        "timestamp": 1605222652
    },
    {
        "content": "<blockquote>\n<p>It looks like about 10 of that is version comparison</p>\n</blockquote>\n<p>Interesting, what does this mean?</p>",
        "id": 216542865,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605222675
    },
    {
        "content": "<p>I'm guessing from this ... <a href=\"http://build.fhir.org/ig/HL7/US-Core/branches/master/build.log\">http://build.fhir.org/ig/HL7/US-Core/branches/master/build.log</a></p>",
        "id": 216542888,
        "sender_full_name": "Eric Haas",
        "timestamp": 1605222700
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Validating Conformance Resources                                                 (03:57.0178)\nInstalling hl7.fhir.us.core#3.1.1 to the package cache\n  Fetching:.....\n  Installing: ..... done.\nUS Core Comparisons Finished\nInstalling hl7.fhir.r4.core#4.0.1 to the package cache\n  Fetching:....................................................................................................\n  Installing: .................................................................................................... done.\n-tx: Connect to http://tx.fhir.org/r4\nVersion Comparison: compare 3.1.1 to current for http://hl7.org/fhir/us/core/CodeSystem/careplan-category\nVersion Comparison: compare 3.1.1 to current for urn:oid:2.16.840.1.113883.6.238\nVersion Comparison: compare 3.1.1 to current for http://hl7.org/fhir/us/core/CodeSystem/condition-category\nVersion Comparison: compare 3.1.1 to current for http://hl7.org/fhir/us/core/CodeSystem/us-core-documentreference-category\n...\nVersion Comparison: compare 3.1.1 to current for http://hl7.org/fhir/us/core/SearchParameter/us-core-medicationrequest-status\nValidating Resources                                                             (12:41.0123)\n</code></pre></div>\n<p>but I could be wrong and it could be the us core comparison or validation step</p>",
        "id": 216543132,
        "sender_full_name": "Eric Haas",
        "timestamp": 1605222855
    },
    {
        "content": "<p>I do think that a lot of time is taken up with the US Core comparisons - i.e. for every single Observation. You'd think that the actual US Core build would be significantly faster because it doesn't have to do those checks.</p>",
        "id": 216543292,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605222965
    },
    {
        "content": "<p>And I lied - according to the log I looked at it took 9 minutes. But the time from hitting commit to the time it shows up in Notifications makes it seem a couple of minutes slower.</p>",
        "id": 216543508,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605223130
    },
    {
        "content": "<p>eCR takes 10:45 on my system.  About 2 minutes of which was the comparison process, where it seemed to hang on a couple of them</p>",
        "id": 216544389,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1605223780
    },
    {
        "content": "<p>Ok, well that makes me feel better! :)</p>",
        "id": 216544732,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605223988
    },
    {
        "content": "<p>OK .. do we think its too long?  The  -w option is also broken for me - that would be extremely helpful for checking rendering and links. but is there a dev-lite option?  1-2 minutes would be great!</p>",
        "id": 216548178,
        "sender_full_name": "Eric Haas",
        "timestamp": 1605226179
    },
    {
        "content": "<p>(not a great time to be mucking with the build so maybe for next yr?)</p>",
        "id": 216548281,
        "sender_full_name": "Eric Haas",
        "timestamp": 1605226240
    },
    {
        "content": "<p>Well, I do think it's too long. But is it realistic to think it could be significantly faster? There is a LOT of checking that happens.</p>",
        "id": 216552579,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1605229462
    },
    {
        "content": "<p>I did some quick benchmarks on my machine with US Core:</p>\n<ul>\n<li>No local txcache folder: 11 minutes<br>\n    - ~9 minutes of this was waiting for responses from <a href=\"http://tx.fhir.org\">tx.fhir.org</a></li>\n<li>Warm txcache folder (run twice in a row, take 2nd time): 3.6 minutes<br>\n    - ~2 minutes of this was waiting for responses from <a href=\"http://tx.fhir.org\">tx.fhir.org</a></li>\n</ul>\n<p>My <a href=\"http://tx.fhir.org\">tx.fhir.org</a> time benchmarking is based on proxying requests via a localhost server and recording how long it takes to get a response. So this may not be perfect and could presumably vary by the load on <a href=\"http://tx.fhir.org\">tx.fhir.org</a>. If anyone's interested I can probably generate a log of which requests took the longest by this timing method.</p>\n<p>The localhost server I used also has a \"cache mode\" that will immediately serve a locally cached response from <a href=\"http://tx.fhir.org\">tx.fhir.org</a> if one exists. If I use this I can get \"warm txcache\" build time down to <strong>1 minute 30 seconds</strong> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> but who knows what kind of unintended consequences \"cache mode\" has on the build.</p>\n<p>But this suggests that if there were a way to set up a more aggressive cache in front of <a href=\"http://tx.fhir.org\">tx.fhir.org</a>, that might yield some pretty significant performance improvements for IG builds. I have no idea if the <a href=\"http://tx.fhir.org\">tx.fhir.org</a> responses are amenable to this kind of easy caching though...</p>",
        "id": 217338827,
        "sender_full_name": "Max Masnick",
        "timestamp": 1605824371
    }
]