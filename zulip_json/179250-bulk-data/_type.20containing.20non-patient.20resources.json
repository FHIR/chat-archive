[
    {
        "content": "<p>Hi.  </p>\n<p>From Query Parameter section in FHIR Bulk Data Access Specification, the _type parameter specifically states: For Patient- and Group-level requests, the Patient Compartment SHOULD be used as a point of reference for recommended resources to be returned. However, other resources outside of the patient compartment that are helpful in interpreting the patient data (such as Organization and Practitioner) may also be returned.   </p>\n<p>I also see an example (though not when I go to View table of parameters for Group Export), within _type parameter definition:  For example _type=Practitioner could be used to bulk data extract all Practitioner resources from a FHIR endpoint.  Is this just for system-level requests, or also for patient- and group-level requests?</p>\n<p>Can I assume that when non-patient data resources (Organization, Location, Practitioner, Practitioner Role -which are not in the patient compartment) are included in the _type parameter for patient- and Group-level requests that all data for these non-patient resources should be returned (and should also use the _since parameter when valued to limit the non-patient specific data returned)?</p>\n<p>Furthermore, if a patient- or group-level request is made with only a non-patient data resource in the _type parameter, is that valid?<br>\n<span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span> <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 193075083,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1586194471
    },
    {
        "content": "<blockquote>\n<p>that all data for these non-patient resources should be returned</p>\n</blockquote>\n<p>I'd say no. Our server returns only those directly referenced by patient-related resources</p>",
        "id": 193076529,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1586195079
    },
    {
        "content": "<p>It sounds a bit odd to me if that's allowed at all on patient/group requests - _type should take the patient compartment and filter it down to the requested types. It also doesn't align with how I would expect the access control boundaries to work, you'd be getting a whole pile of resources that aren't necessarily tied to your patient/group scope.</p>",
        "id": 193076541,
        "sender_full_name": "Paul Church",
        "timestamp": 1586195083
    },
    {
        "content": "<p>In the <a href=\"http://HealthIT.gov\" title=\"http://HealthIT.gov\">HealthIT.gov</a> sandbox, this is not what I am seeing for Organization and Location resource (note: Practitioner and Provenance not available in the sandbox as of now): <br>\nWhen I ran the Bulk Data API to either 1) Extract Patient Data using Date (from a specific point in time) and Resource Type or 2) Extract subset of Patients using Group Id, Date(from a specific point in time) and Resource Type AND I select the ORGANIZATION and LOCATION resources types, it appears that they are just scanning the location and organization as master files but are using the _Since (which I can’t tell is a create or change date/time) to further filter results.</p>\n<p>So, this is where my original question came from.  Thoughts <span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span> <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 193940115,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1586889741
    },
    {
        "content": "<p>This could probably be better documented in the IG, but my expectation would be the same as Michele's: the server may chose to include Organization and Location resources referenced from those in the patient compartment resources being returned. I'd think these shouldn't be impacted by the _since param, and if _type is populated, they'd only be returned if they were included in the resource type list. If only Organization resources are requested from a patient export endpoint, I'd expect the export to be empty since they aren't referenced by any results and aren't part of the patient compartment.</p>",
        "id": 193943268,
        "sender_full_name": "Dan Gottlieb",
        "timestamp": 1586891193
    },
    {
        "content": "<p>It's possible that the sandbox were you looking at takes a different view (or has bugs :). What's the url?</p>",
        "id": 193943283,
        "sender_full_name": "Dan Gottlieb",
        "timestamp": 1586891204
    },
    {
        "content": "<p>URL is <a href=\"https://fhirprod.sitenv.org/bulkdataclient/#/home\" title=\"https://fhirprod.sitenv.org/bulkdataclient/#/home\">https://fhirprod.sitenv.org/bulkdataclient/#/home</a></p>\n<p>We focused on Location and organization to see if it was in anyway tied to the patient population and it doesn’t appear to be.  We pulled all the data for the full population for the beginning of time and had 9 organization and 3 locations.<br>\nWe then changed to use Group ID = 1 (which is apparently a small population of 2 or 3 patients) and got the same 9 organization and 3 locations. </p>\n<p>Then, we changed the _Since to be 01-01-2000 and received less organizations and locations (I think it was 4 and 2 respectively) but they were consistent across the population sizes I chose. We then changed it to 01-01-2010 and received 1 organization and 1 location consistently across the populations I chose.  Lastly I bumped it up to 2020 and received no data for either.  Along the way at some point we did it requesting Patient and at 2010 I received no data for patients but the same consistent organizations and location results.</p>\n<p>Hope you can follow that.</p>",
        "id": 193946010,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1586892517
    },
    {
        "content": "<p>Seems wrong .... but in the end what matters is if you get the Location and Organization (and maybe Practitioner etc) you need to complete the patient compartment resources you are interested in. Because if that's the case even if they give you more is not really an issue, it is an issue if some are missing</p>",
        "id": 193961551,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1586901248
    },
    {
        "content": "<p>Yup, seems like the server's behavior isn't quite right around this. <span class=\"user-mention\" data-user-id=\"192017\">@Nagesh Bashyam</span> - are you maintaining this code?</p>",
        "id": 194030078,
        "sender_full_name": "Dan Gottlieb",
        "timestamp": 1586957484
    },
    {
        "content": "<p>So, assuming the consensus is as <span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span> mentions above:  when _type includes any of the resources not included in the patient compartment (Organization, Location, Practitioner, Practitioner Role), they will only be returned when they are referenced within other resources in the resource type list.  <br>\nIs it acceptable if these resources are contained within the resources that reference them?</p>",
        "id": 195459000,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1588013056
    },
    {
        "content": "<blockquote>\n<p>Is it acceptable if these resources are contained within the resources that reference them?</p>\n</blockquote>\n<p>It is allowed by the specs, but I am not sure how many clients will handle that (our does not for example) - and it will also cause lots of duplications: same location will be in a lot of different encounters etc</p>",
        "id": 195459612,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1588013337
    },
    {
        "content": "<p>If they're naturally contained (e.g. Medication inside a MedicationRequest) because they don't have enough information to stand alone, that'd be ok.  But they shouldn't be packaged as a contained resource unless you'd always expect to share them that way (and expect the receiver to store them that way).</p>",
        "id": 195488988,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588031767
    },
    {
        "content": "<p>If  non-patient resources outside of the patient compartment are to only be returned as stand alone (not contained) when they are referenced by other resources  included in the _type parameter, wouldn't  we be potentially be returning the same non-patient resource (e.g. Organization, Practitioner)  multiple times for one bulk data request?  </p>\n<p>Furthermore, for incremental bulk data requests, wouldn't we again be returning resources that the requestor already has if we are not making these non-patient resources _since aware?</p>\n<p>Thoughts <span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span> <span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> <span class=\"user-mention\" data-user-id=\"192017\">@Nagesh Bashyam</span> ?</p>",
        "id": 195605380,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1588097909
    },
    {
        "content": "<blockquote>\n<p>wouldn't we be potentially be returning the same non-patient resource (e.g. Organization, Practitioner) multiple times for one bulk data request?</p>\n</blockquote>\n<p>No, they are returned just once (if they were contained they'll be returned multiple times)</p>\n<blockquote>\n<p>Furthermore, for incremental bulk data requests, wouldn't we again be returning resources that the requestor already has if we are not making these non-patient resources _since aware?</p>\n</blockquote>\n<p>Yes, but if we make them _since aware resolving references would become very hard - the requestor would have to keep all the original ids</p>",
        "id": 195606603,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1588098461
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span>  - I am still not clear on the direction of what should be returned for non-patient resources when requested in _type parameter (when no other patient resources are being requested in the _type parameter) on a patient or group export.  Can we add this to tomorrow's meeting agenda please?</p>",
        "id": 207435876,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1597857409
    },
    {
        "content": "<p>Added!</p>",
        "id": 207445089,
        "sender_full_name": "Dan Gottlieb",
        "timestamp": 1597862221
    },
    {
        "content": "<p>Given the latest clarifications from ONC, looks like Location, PractitionerRole, and RelatedPerson can be contained.  </p>\n<ul>\n<li>When these resources are contained and when the export request specifically asks for these non-patient resources in the _type parameter, what is the expectation?  Are these resources ignored and returned as they would have been within the resources that contain them had they not been included in _type? <span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span></li>\n</ul>",
        "id": 208748272,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1598994232
    },
    {
        "content": "<p>If they are contained you are going to get them regardless</p>",
        "id": 208753644,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1598997093
    },
    {
        "content": "<p>I agree! The whole point of a contained resource is that it cannot be externally identified so it is literally baked into the containing resource. Servers should neither be adding nor stripping contained resources at export time.</p>",
        "id": 208754927,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1598997936
    },
    {
        "content": "<p>That's what I thought about contained resources.  But if these contained resources are included in the _type they are just ignored - no OperationOutcome and export processing continues - correct?</p>",
        "id": 208811048,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1599046945
    },
    {
        "content": "<p>Not 100% sure what you mean. If they are listed in the _type parameter the server exports the non-contained ones - if any</p>",
        "id": 208812143,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599047649
    },
    {
        "content": "<p>So if we've implemented Location as contained and then an export request is received where _type parameter is valued to Patient, Encounter, Location, do I ignore that they asked for Location and just return an ndjson file for Patient and Encounter?  or would you reject the request and return http 400 with OperationOutcome something like:    &lt;Location&gt; not supported as standalone resource?</p>",
        "id": 208818183,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1599051093
    },
    {
        "content": "<p>Ah now I understand, thanks. I'd say accept the request and return Patient and Encounter - no error</p>",
        "id": 208820086,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599052005
    },
    {
        "content": "<p>We're established the following:   </p>\n<p>If the client explicitly asks for export of resources that the bulk data server doesn't support, or asks for only resource types that are outside the Patient Compartment, the server SHOULD return details via an OperationOutcome resource in an error response to the request. When a &lt;code&gt;Prefer: handling=lenient&lt;/code&gt; header is included in the request, the server MAY process the request instead of returning an error.</p>\n<p>Now for the easy question of the day; looking for your thoughts on this:</p>\n<p>If a resource type outside of the patient compartment is requested (along with at least one resource type being requested that is in the patient compartment) , but the implementation at your site is containing that resource (e.g., Location or RelatedPerson), would you reject the request  with details via an OperationOutcome or just continue processing the request and ignore?  They would basically get the location information for free as contained.</p>",
        "id": 210306940,
        "sender_full_name": "Michelle Vondercrone",
        "timestamp": 1600283561
    },
    {
        "content": "<p>Clients should not need to care if resources are contained or not -- it would be weird to reject a client because the query requested locations, even though you're planning to in fact return the locations.</p>",
        "id": 210311308,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600285737
    }
]