[
    {
        "content": "<p>In <a href=\"http://hl7.org/fhir/uv/bulkdata/export/index.html#file-request\" target=\"_blank\" title=\"http://hl7.org/fhir/uv/bulkdata/export/index.html#file-request\">File Request</a>, \"If the requiresAccessToken field in the Complete Status body is set to true, the request SHALL include a valid access token.\" So if client does NOT include bearer token, or include an invalid token, should the error code be 400 (bad request) or 401(unauthorized)?<br>\n<span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> <span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span></p>",
        "id": 189250652,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1582833480
    },
    {
        "content": "<p>Hmm,  since it's a token related error, any reason it shouldn't be a 401?</p>",
        "id": 189251671,
        "sender_full_name": "Dan Gottlieb",
        "timestamp": 1582834199
    },
    {
        "content": "<p>I think it should be 401 but I could not find anywhere (bulk-data, FHIR, OAuth, etc) says that it MUST/SHALL be 401.</p>",
        "id": 189251931,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1582834332
    },
    {
        "content": "<p>Yunwei - does <a href=\"https://tools.ietf.org/html/rfc7235#section-3.1\" target=\"_blank\" title=\"https://tools.ietf.org/html/rfc7235#section-3.1\">HTTP</a> say that it should be 401?</p>",
        "id": 189252034,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1582834413
    },
    {
        "content": "<p>(Answered over at <a class=\"stream-topic\" data-stream-id=\"179166\" href=\"/#narrow/stream/179166-implementers/topic/HTTP.20code.20400.20or.20401\">#implementers &gt; HTTP code 400 or 401</a>  as well as I could.)</p>",
        "id": 189252241,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1582834538
    },
    {
        "content": "<p>I think if you control this server, then a 401 is probably a good way to communicate it -- but of course if <code>requiresAccessToken</code> is <em>false</em>, we're typically talking about a non-FHIR file server.</p>",
        "id": 189252414,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1582834649
    },
    {
        "content": "<p>But when <code>requiresAccessToken</code> is <em>true</em>, the one strong thing we can say is that the error response must have a <code>WWW-Authenticate</code> header. That's from <a href=\"https://tools.ietf.org/html/rfc6750#section-3\" target=\"_blank\" title=\"https://tools.ietf.org/html/rfc6750#section-3\">https://tools.ietf.org/html/rfc6750#section-3</a>, which holds for any OAuth 2.0 bearer token-protected server.</p>",
        "id": 189252605,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1582834788
    },
    {
        "content": "<p>For a client, if it does NOT send bearer token, then it could get either 400 (less common), or 401 (more common). If the client sends invalid token, then it shall get 401. Is that understanding correct?</p>",
        "id": 189252888,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1582834952
    },
    {
        "content": "<p>With an invalid token, the use of a 401 status is a SHOULD. See <a href=\"https://tools.ietf.org/html/rfc6750#section-3.1\" target=\"_blank\" title=\"https://tools.ietf.org/html/rfc6750#section-3.1\">https://tools.ietf.org/html/rfc6750#section-3.1</a> which says:</p>\n<div class=\"codehilite\"><pre><span></span>   invalid_token\n         The access token provided is expired, revoked, malformed, or\n         invalid for other reasons.  The resource SHOULD respond with\n         the HTTP 401 (Unauthorized) status code.  The client MAY\n         request a new access token and retry the protected resource\n         request.\n</pre></div>",
        "id": 189253047,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1582835064
    },
    {
        "content": "<p>But the <code>invalid_token</code> error code in the <code>WWW-Authenticate</code>: that's what's required.</p>",
        "id": 189253092,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1582835105
    },
    {
        "content": "<p><code>SHOULD</code> mean exception is possible. Sigh.</p>",
        "id": 189253309,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1582835264
    },
    {
        "content": "<p>Gotta love standards ;-)</p>",
        "id": 189253385,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1582835294
    },
    {
        "content": "<p>as I indicated elsewhere... access denied needs to allow for many return codes as possibility .. see <a href=\"http://build.fhir.org/security.html#AccessDenied\" target=\"_blank\" title=\"http://build.fhir.org/security.html#AccessDenied\">http://build.fhir.org/security.html#AccessDenied</a></p>",
        "id": 189262075,
        "sender_full_name": "John Moehrke",
        "timestamp": 1582840957
    },
    {
        "content": "<p>Move to argonaut</p>",
        "id": 189271632,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1582848789
    }
]