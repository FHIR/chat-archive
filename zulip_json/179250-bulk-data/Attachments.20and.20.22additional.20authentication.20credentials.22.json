[
    {
        "content": "<p>Imagine a successful export with requiresAccessToken = true in the response.  The bulk client retrieves a DocumentReference .ndjson file and is about to resolve one of the DocumentReference's content attachment urls.   The <a href=\"https://build.fhir.org/ig/HL7/bulk-data/export.html#attachments\">attachment section of the build spec</a> says \"the url location must be accessible by a client with a valid access token, and SHALL NOT require the use of additional authentication credentials.\"</p>\n<p>I have always read this as requiring a holistic approach where the client's JWT credentials are used in a client assertion presented to a single authorization server token url and the resulting access token used consistently from export request to checking the status to downloading both ndjson files and attachments (noting of course that tokens expire and they may need to ask for another).  Consistent \"authentication credentials\" is <em>not</em> solely referring to the client's own identify assertion, but rather in conjunction with a consistent authorization server url (i.e. no switching mid-workflow for a different type of token).   It's a bit legalese but I wanted to state it explicitly to ensure agreement.</p>",
        "id": 246160697,
        "sender_full_name": "Dennis Patterson",
        "timestamp": 1626385563
    },
    {
        "content": "<p>The intention is that when requiresAccessToken==true, the client can use the same process it used for getting access tokens to manage the export to also </p>\n<ul>\n<li>get an access token for fetching the output ndjson files</li>\n<li>get an access token for fetching binary attachment content</li>\n</ul>",
        "id": 246161556,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626386140
    },
    {
        "content": "<p>I'm not sure if you've looked through the ballot responses, but we did have some clarifying language on his front that was part of the block vote this week.</p>",
        "id": 246161631,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626386175
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> ! Could you or <span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span> post the jira(s) with the updated language?</p>",
        "id": 246724829,
        "sender_full_name": "Dennis Patterson",
        "timestamp": 1626876639
    },
    {
        "content": "<p><a href=\"https://jira.hl7.org/browse/FHIR-32114\">https://jira.hl7.org/browse/FHIR-32114</a> and <a href=\"https://jira.hl7.org/browse/FHIR-32772\">https://jira.hl7.org/browse/FHIR-32772</a></p>",
        "id": 246725647,
        "sender_full_name": "Dan Gottlieb",
        "timestamp": 1626876971
    },
    {
        "content": "<p>For this discussion, the sentence I found most helpful from the first jira is \"This definition [of requiresAccessToken] should be clear that we're talking about 'downloading the generated files requires the same authorization mechanism as the $export operation itself' â€“ not just any bearer token, but the <strong>same scheme</strong> as the kickoff, polling, etc.\"</p>",
        "id": 246730089,
        "sender_full_name": "Dennis Patterson",
        "timestamp": 1626878981
    },
    {
        "content": "<p>It might be even clearer to say \"the same scheme and same token url\"</p>",
        "id": 246877710,
        "sender_full_name": "Dennis Patterson",
        "timestamp": 1626974211
    },
    {
        "content": "<p>The sentence you are quoting was just the issue description; it's important to evaluate the actual resolution if you want to make wording tweaks. Resolution was to add</p>\n<blockquote>\n<p>downloading the generated files requires the same authorization mechanism as the $export operation itself</p>\n</blockquote>",
        "id": 246881585,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626975904
    },
    {
        "content": "<p>If this is unclear, feel free to submit a follow up requesting specific additional changes.</p>",
        "id": 246881626,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626975922
    },
    {
        "content": "<p>\"servers SHALL populate the Attachment.contentType code as well as either the data element or the url element\". Should that be either data or url <strong>or both</strong>?</p>",
        "id": 246889149,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1626979416
    },
    {
        "content": "<blockquote>\n<p>either the data element or the url element</p>\n</blockquote>\n<p>I haven't heard a use case for populating both; has this come up in your experience?</p>",
        "id": 246889286,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626979473
    },
    {
        "content": "<p>It is mentioned in US Core IG: \"us-core-6: DocumentReference.content.attachment.url or <a href=\"http://DocumentReference.content.attachment.data\">DocumentReference.content.attachment.data</a> or both SHALL be present.\"</p>",
        "id": 246889399,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1626979529
    },
    {
        "content": "<p>We don't currently prohibit this, but (again) we haven't heard a use case for populating both.</p>",
        "id": 246890126,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626979913
    },
    {
        "content": "<p>So it is an \"inclusive OR\".</p>",
        "id": 246890200,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1626979945
    },
    {
        "content": "<p>I mean, ... if you want it to be? I don't know that we have super strict semantics on this. (And I'm trying to understand whether it matters.)</p>",
        "id": 246890238,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626979971
    }
]