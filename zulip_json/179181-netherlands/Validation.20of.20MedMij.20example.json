[
    {
        "content": "<p>I'm having trouble to validate <a href=\"https://simplifier.net/NictizSTU3-Zib2017/Observation-example-duplicate-10/~json\" target=\"_blank\" title=\"https://simplifier.net/NictizSTU3-Zib2017/Observation-example-duplicate-10/~json\">this MedMij example resource</a> against the published versions of MedMij profiles using the official FHIR validator. I've tried profiles from both Simplifier and Github, but that did not make a difference.</p>\n<p>Setup:</p>\n<div class=\"codehilite\"><pre><span></span>curl https://fhir.github.io/latest-ig-publisher/org.hl7.fhir.validator.jar &gt; validator.jar\ncurl &#39;https://simplifier.net/nictizstu3-zib2017/observation-example-duplicate-10/$download?format=json&#39; &gt; example.json\n\nmkdir profiles\ncd profiles\ncurl &#39;https://simplifier.net/nictizstu3-zib2017/zib-laboratorytestresult-observation/$download?format=json&#39; &gt; zib-medmij-profile.json\ncurl &#39;https://simplifier.net/nictizstu3-zib2017/nl-core-observation/$download?format=json&#39; &gt; nl-core-observation-profile.json\ncurl &#39;https://simplifier.net/nictizstu3-zib2017/zibextensioncodespecification/$download?format=json&#39; &gt; zib-code-specification-extension.json\ncurl &#39;http://decor.nictiz.nl/fhir/3.0/public/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.13.1.1--20171231000000&#39; &gt; resultaat-type-codelijst.xml\ncurl &#39;http://decor.nictiz.nl/fhir/3.0/public/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.13.1.5--20171231000000&#39; &gt; onderzoek-codelijst.xml\ncurl &#39;http://decor.nictiz.nl/fhir/3.0/public/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.13.1.7--20171231000000&#39; &gt; interpretatie-vlaggen-codelijst.xml\ncd ..\n</pre></div>\n\n\n<p>Command:</p>\n<div class=\"codehilite\"><pre><span></span>java -jar validator.jar example.json  -version 3.0.1 -ig profiles\n</pre></div>\n\n\n<p>Output:</p>\n<div class=\"codehilite\"><pre><span></span>FHIR Validation tool Version 4.1.7-SNAPSHOT - Built 2019-11-21T18:18:33.170+11:00 - Git 45df4708d77b\nDetected Java version: 1.8.0_131 from /usr/lib/jvm/java-8-oracle/jre on amd64 (64bit). 1682MB available\nArguments: example.json -version 3.0.1 -ig profiles\nDirectories: Current = /tmp, Package Cache = /home/hjpv/.fhir/packages\n  .. FHIR Version 3.0, definitions from hl7.fhir.r3.core#3.0.2\n  .. connect to tx server @ http://tx.fhir.org\n    (v3.0.2)\n+  .. load IG from profiles\n  .. validate [example.json]\nTerminology server: Check for supported code systems for http://snomed.info/sct\n*FAILURE* validating example.json:  error:3 warn:0 info:2\n  Error @ Observation.category[0].coding[0] (line 13, col10) : unable to find code 49581000146104 in http://snomed.info/sct for &#39;http://snomed.info/sct#49581000146104&#39;\n  Error @ Observation.category[0] (line 11, col6) : Could not match any discriminators ([coding.system, coding.code]) for slice Observation.category:ResultType in profile http://nictiz.nl/fhir/StructureDefinition/zib-LaboratoryTestResult-Observation - None of the discriminator [coding.system, coding.code] have fixed value, binding or existence assertions\n  Error @ Observation.category[1] (line 20, col6) : Could not match any discriminators ([coding.system, coding.code]) for slice Observation.category:ResultType in profile http://nictiz.nl/fhir/StructureDefinition/zib-LaboratoryTestResult-Observation - None of the discriminator [coding.system, coding.code] have fixed value, binding or existence assertions\n  Information @ Observation.category[0] (line 11, col6) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/observation-category (http://hl7.org/fhir/ValueSet/observation-category, and a code is recommended to come from this value set) (codes = http://snomed.info/sct#49581000146104)\n  Information @ Observation.category[1] (line 20, col6) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/observation-category (http://hl7.org/fhir/ValueSet/observation-category, and a code is recommended to come from this value set) (codes = http://snomed.info/sct#275711006)\n</pre></div>\n\n\n<p>It seems to find three problems:</p>\n<ul>\n<li>Unknown snomed code</li>\n<li>Incorrect slicing definition for <code>Observation.category</code></li>\n<li>Not using recommended value set for <code>Observation.category</code></li>\n</ul>\n<p>Especially the second one is difficult to circumvent for me. Am I doing something wrong? Any help appreciated, thanks!</p>",
        "id": 181857464,
        "sender_full_name": "Henk-Jan Meijer",
        "timestamp": 1574712094
    },
    {
        "content": "<p>this is on my todo list</p>",
        "id": 181858469,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574712930
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> so this is an issue with the validator then? Any way I can track progress? Thanks for your quick reply!</p>",
        "id": 181889447,
        "sender_full_name": "Henk-Jan Meijer",
        "timestamp": 1574742747
    },
    {
        "content": "<p>It's at least partially an issue with the validator. Maybe with the profiles too. I'll ask Alexander to keep you informed</p>",
        "id": 181889514,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574742899
    },
    {
        "content": "<p>Great, thanks again</p>",
        "id": 181889788,
        "sender_full_name": "Henk-Jan Meijer",
        "timestamp": 1574743121
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195731\">@Henk-Jan Meijer</span> We are aware of some issues with the profiles around slicing. In finding out how to best deal with that, we tested them against the Java validator and the .Net validator. It turned out that the profiles could be improved, but also that both the java validator and the .Net validator needed some tweaks. The updated profiles have been committed to our develop branch in github. Firely is working on updating the .Net validator (<span class=\"user-mention\" data-user-id=\"192301\">@Ardon Toonstra</span> could comment on that), and <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> is looking into the java validator.</p>\n<p>It is possible that in updating the reference frameworks, issues are discovered that we don't know about today, but would require other updates to the profiles. This is why we hold off publication for the moment.</p>",
        "id": 181953650,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1574795534
    },
    {
        "content": "<p>I will provide some test cases for the java and .Net validator shortly! :)</p>",
        "id": 181999764,
        "sender_full_name": "Ardon Toonstra",
        "timestamp": 1574844332
    },
    {
        "content": "<p>thx</p>",
        "id": 182013491,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574857495
    },
    {
        "content": "<p>is 49581000146104 a valid snomed code is it?</p>",
        "id": 182196122,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575051558
    },
    {
        "content": "<p>looks like it should be 118246004</p>",
        "id": 182196208,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575051642
    },
    {
        "content": "<p>(this is from the test cases) <span class=\"user-mention\" data-user-id=\"192301\">@Ardon Toonstra</span> which come from NIctiz specs <span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span></p>",
        "id": 182196221,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575051669
    },
    {
        "content": "<p>after updating for other unrelated errors, and fixing the manifest, those tests pass without any modifications to the validator. Can you check the changes please</p>",
        "id": 182196662,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575052228
    },
    {
        "content": "<p>Hi Grahame: yes that is valid <a href=\"http://terminologie.nictiz.nl/art-decor/snomed-ct?conceptId=49581000146104\" target=\"_blank\" title=\"http://terminologie.nictiz.nl/art-decor/snomed-ct?conceptId=49581000146104\">http://terminologie.nictiz.nl/art-decor/snomed-ct?conceptId=49581000146104</a><br>\n<a href=\"/user_uploads/10155/5GlWEmWTq9dYmZoT0HBTymNY/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/5GlWEmWTq9dYmZoT0HBTymNY/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/5GlWEmWTq9dYmZoT0HBTymNY/pasted_image.png\"></a></div>",
        "id": 182229932,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1575102368
    },
    {
        "content": "<p>Thatâ€™s bizarre - why use a different concept id for the same concept as in the international version?</p>",
        "id": 182231613,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575105816
    },
    {
        "content": "<p>118246004 is a navigational concept, 49581000146104 is a finding. So not entirely the same as they are from different branches and thus have different semantics?</p>",
        "id": 182236084,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1575114289
    },
    {
        "content": "<p>But I cannot tell you why this concept did not exist internationally. Seems generic enough.</p>",
        "id": 182247873,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1575135269
    },
    {
        "content": "<p>interesting. I wonder what 'Laboratory test finding (Finding)' as a finding is. It sounds like a navigational concept to me. However, what is going in is clearly intentional not a mistake. I'll have to get dutch snomed loaded on <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a></p>",
        "id": 182249526,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575137797
    },
    {
        "content": "<p>entering MLDS through the NL portal has competely confused MLDS abut which language to use for me...</p>",
        "id": 182249756,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575138230
    },
    {
        "content": "<p>Let me know if you need help somewhere with that</p>",
        "id": 182254916,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1575147299
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> </p>\n<blockquote>\n<p>after updating for other unrelated errors, and fixing the manifest, those tests pass without any modifications to the validator. Can you check the changes please</p>\n</blockquote>\n<p>Thnx, looks ok! I now see that I already made a note that the Java validator supported this. The .NET validator does not, so I will reuse the test files.  At least these tests may help in regression testing...</p>",
        "id": 182757646,
        "sender_full_name": "Ardon Toonstra",
        "timestamp": 1575637222
    },
    {
        "content": "<p>indeed. Feel free to add any other validation test cases</p>",
        "id": 182787673,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575655907
    },
    {
        "content": "<p>Just wondering: still got some errors by repeating Henk-Jan's test case (by downloading everything with curl some minutes ago) and getting the following:</p>\n<div class=\"codehilite\"><pre><span></span>tvinke@localhost ~/projects/fhir-validation-test $ java -jar validator.jar example.json  -version 3.0.1 -ig profiles\nFHIR Validation tool Version 4.1.51-SNAPSHOT (Git# 32240f41c724). Built 2020-01-21T12:27:30.908+11:00 (12 hours old)\nDetected Java version: 1.8.0_121 from /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available\nArguments: example.json -version 3.0.1 -ig profiles\nDirectories: Current = /Users/tvinke/projects/fhir-validation-test, Package Cache = /Users/tvinke/.fhir/packages\n  .. FHIR Version 3.0, definitions from hl7.fhir.r3.core#3.0.2\n  .. connect to tx server @ http://tx.fhir.org\n    (v3.0.2)\n+  .. load IG from profiles\n  .. validate [example.json]\nTerminology server: Check for supported code systems for http://snomed.info/sct\n*FAILURE* validating example.json:  error:3 warn:2 info:2\n  Error @ Observation.category[0].coding[0] (line 13, col10) : unable to find code 49581000146104 in http://snomed.info/sct (version http://snomed.info/sct/900000000000207008/version/20190731) for &#39;http://snomed.info/sct#49581000146104&#39;\n  Error @ Observation.category[0] (line 11, col6) : Could not match any discriminators ([coding.system, coding.code]) for slice Observation.category:ResultType in profile http://nictiz.nl/fhir/StructureDefinition/zib-LaboratoryTestResult-Observation - None of the discriminator [coding.system, coding.code] have fixed value, binding or existence assertions\n  Error @ Observation.category[1] (line 20, col6) : Could not match any discriminators ([coding.system, coding.code]) for slice Observation.category:ResultType in profile http://nictiz.nl/fhir/StructureDefinition/zib-LaboratoryTestResult-Observation - None of the discriminator [coding.system, coding.code] have fixed value, binding or existence assertions\n  Information @ Observation.category[0] (line 11, col6) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/observation-category (http://hl7.org/fhir/ValueSet/observation-category, and a code is recommended to come from this value set) (codes = http://snomed.info/sct#49581000146104)\n  Information @ Observation.category[1] (line 20, col6) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/observation-category (http://hl7.org/fhir/ValueSet/observation-category, and a code is recommended to come from this value set) (codes = http://snomed.info/sct#275711006)\n  Warning @ Observation.category[1].coding[0] (line 22, col10) : The display &quot;Chemistry&quot; is not a valid display for the code {http://snomed.info/sct}275711006 - should be one of [&quot;Serum chemistry test&quot;,&quot;Serum chemistry test (procedure)&quot;]\n  Warning @ Observation.interpretation (line 51, col16) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/observation-interpretation (http://hl7.org/fhir/ValueSet/observation-interpretation, and a code should come from this value set unless it has no suitable code) (codes = http://snomed.info/sct#281302008)\n</pre></div>\n\n\n<p>I'm about to rely a lot on the validator in my current project, so I'd like to know if there are still some known issues with it, or may be that I'm using it incorrectly.</p>",
        "id": 186186703,
        "sender_full_name": "Ted Vinke",
        "timestamp": 1579616398
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"259573\">@Ted Vinke</span> I must admit I missed your call for help here. The java validator is mostly maintained by <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>. However it is maintained on GitHub and pull requests are accepted.</p>\n<p>Nictiz has been working with Firely for the .Net validator and Grahame for the Java validator. It's a process but we'll get there.</p>\n<p>Looking at the error you get I can see that the Dutch SNOMED CT extension is not loaded onto <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> that you use by default as terminology server.  The command you use to fire up the validator is based on the FHIR Core spec. This explains why the extensions are flagged as unknown. The command should include -ig and the path to the MedMij profiles e.g.:</p>\n<p><code>-ig profiles</code></p>\n<p>Just give it the set and the validator will pick the right profile based on the Patient.meta.profile in the instance. As it stands today the Java validator is not capable of producing snapshots. Also Simplifier is not capable of producing snapshots so the Simplifier package you installed does not have them and the Java validator cannot produce them. For that reason we distribute a separate folder containing the snapshots produced using the .net framework offline. You can find that on <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/releases\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/releases\">Github</a>.</p>\n<p>Using that snapshot folder you can validate using:</p>\n<div class=\"codehilite\"><pre><span></span>$ java -jar org.hl7.fhir.validator.jar -ig &quot;/Users/ahenket/Downloads/nictiz-stu3-zib2017-snapshots-1.3.3&quot; -version 3.0 -recurse -debug STU3-Java/instances/medmij-bgz-fhir3-0-1-labresult-ts-01.xml\nFHIR Validation tool Version 4.1.53-SNAPSHOT (Git# ee6e0d90de9b). Built 2020-01-24T17:20:43.54+11:00 (3 days old)\nDetected Java version: 1.8.0_121 from /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available\nArguments: -ig /Users/ahenket/Downloads/nictiz-stu3-zib2017-snapshots-1.3.3 -version 3.0 -recurse -debug STU3-Java/instances/medmij-bgz-fhir3-0-1-labresult-ts-01.xml\nDirectories: Current = /Users/ahenket/Development/FHIR, Package Cache = /Users/ahenket/.fhir/packages\n  .. FHIR Version 3.0, definitions from hl7.fhir.r3.core#3.0.2\n  .. connect to tx server @ http://tx.fhir.org\n    (v3.0.2)\n+  .. load IG from /Users/ahenket/Downloads/nictiz-stu3-zib2017-snapshots-1.3.3\n* load file: zib-OxygenSaturation.xml .. success\n.\n.\n.\n  .. validate [STU3-Java/instances/medmij-bgz-fhir3-0-1-labresult-ts-01.xml]\nTerminology server: Check for supported code systems for http://snomed.info/sct\n*FAILURE* validating STU3-Java/instances/medmij-bgz-fhir3-0-1-labresult-ts-01.xml:  error:3 warn:1 info:2\n  Error @ Observation.category[0].coding[0] (line 8, col17) : unable to find code 49581000146104 in http://snomed.info/sct (version http://snomed.info/sct/900000000000207008/version/20190731) for &#39;http://snomed.info/sct#49581000146104&#39;\n  Error @ Observation.category[0] (line 7, col15) : Could not match any discriminators ([coding.system, coding.code]) for slice Observation.category:ResultType in profile http://nictiz.nl/fhir/StructureDefinition/zib-LaboratoryTestResult-Observation - None of the discriminator [coding.system, coding.code] have fixed value, binding or existence assertions\n  Error @ Observation.category[1] (line 14, col15) : Could not match any discriminators ([coding.system, coding.code]) for slice Observation.category:ResultType in profile http://nictiz.nl/fhir/StructureDefinition/zib-LaboratoryTestResult-Observation - None of the discriminator [coding.system, coding.code] have fixed value, binding or existence assertions\n  Information @ Observation.category[0] (line 7, col15) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/observation-category (http://hl7.org/fhir/ValueSet/observation-category, and a code is recommended to come from this value set) (codes = http://snomed.info/sct#49581000146104)\n  Information @ Observation.category[1] (line 14, col15) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/observation-category (http://hl7.org/fhir/ValueSet/observation-category, and a code is recommended to come from this value set) (codes = http://snomed.info/sct#275711006)\n  Warning @ Observation.interpretation (line 39, col21) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/observation-interpretation (http://hl7.org/fhir/ValueSet/observation-interpretation, and a code should come from this value set unless it has no suitable code) (codes = http://snomed.info/sct#281302008)\n</pre></div>\n\n\n<p>Disecting the errors:</p>\n<ul>\n<li>Error @ Observation.category[0].coding[0] (line 8, col17) : unable to find code 49581000146104 -- due to Dutch extension not being present in the terminology server <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a>. Should be fixed over time by <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>. At the very least it should not be an error, but a warning at best</li>\n<li>Error @ Observation.category[0] (line 7, col15) : Could not match any discriminators -- this is due to the way the profile is created. We are releasing an update today that should fixed that part</li>\n<li>Warning @ Observation.interpretation (line 39, col21) : None of the codes provided are in the value set -- this is due to the instance using V3 interpretation codes as suggested by the zib/profile while the base resource has an extensible binding on V2 interpretation codes. We should probably at least add a ConceptMap here and potentially consider using that to actually use what the base resource binds to. Flagged as <a href=\"https://bits.nictiz.nl/browse/MM-898\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-898\">https://bits.nictiz.nl/browse/MM-898</a></li>\n</ul>",
        "id": 186664926,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1580117128
    },
    {
        "content": "<p>the \"recommended to come from a value set\" message is under discussion here:</p>",
        "id": 186666513,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580118617
    },
    {
        "content": "<p><a href=\"#narrow/stream/179177-conformance/topic/Validator.20messages.20and.20preferred.20bindings\" title=\"#narrow/stream/179177-conformance/topic/Validator.20messages.20and.20preferred.20bindings\">https://chat.fhir.org/#narrow/stream/179177-conformance/topic/Validator.20messages.20and.20preferred.20bindings</a></p>",
        "id": 186666550,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580118652
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> is the one to talk to get dutch snomed loaded on <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a></p>",
        "id": 186666572,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580118672
    },
    {
        "content": "<p>I have a SNOMED Int. MLDS account, which theoretically should allow me to be able to download the Netherlands edition.  But my credentials currently aren't giving me access to the downloads.  So in lieu of getting that sorted out immediately, if someone (<span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span>?) is able to provide a copy of the distribution (the current Netherlands edition snapshot or preferably the full Netherlands edition distribution) then we can get this done.</p>",
        "id": 186686059,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1580135287
    },
    {
        "content": "<p>I believe <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> went through all that trouble and should be able to provide you with licensed access to the extension</p>",
        "id": 186973784,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1580382073
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span>   Yes, I'm sure that's the case.  I'll ask <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> for it.</p>",
        "id": 187026008,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1580415228
    }
]