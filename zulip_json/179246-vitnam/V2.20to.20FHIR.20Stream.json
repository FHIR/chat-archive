[
    {
        "content": "<div class=\"codehilite\"><pre><span></span>MSH|^~\\&amp;|REGADT|MCM|IFENG||199112311501||ADT^A04^ADT_A01|000001|P|2.5|||\nEVN|A04|200301101500|200301101400|01||200301101410\nPID|||191919^^^GENHOS^MR~371-66-9256^^^USSSA^SS|253763|MASSIE^JAMES^A||19560129|M|||171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;^||(900)485-5344|(900)485-5344||S|C|10199925^^^GENHOS^AN|371-66-9256||&lt;cr&gt;\nNK1|1|MASSIE^ELLEN|SPOUSE|171 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)545-1234~(900)545-1200|EC1^FIRST EMERGENCY CONTACT&lt;cr&gt;\nNK1|2|MASSIE^MARYLOU|MOTHER|300 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)545-1234~(900)545-1200|EC2^SECOND EMERGENCY CONTACT&lt;cr&gt;\nNK1|3&lt;cr&gt;\nNK1|4|||123 INDUSTRY WAY^^ISHPEMING^MI^49849^&quot;&quot;^||(900)545-1200|EM^EMPLOYER|19940605||PROGRAMMER|||ACME SOFTWARE COMPANY&lt;cr&gt;\nPV1||O|O/R||||0148^ADDISON,JAMES|0148^ADDISON,JAMES|0148^ADDISON,JAMES|AMB|||||||0148^ADDISON,JAMES|S|1400|A|||||||||||||||||||GENHOS|||||199501101410|&lt;cr&gt;\nPV2||||||||200301101400||||||||||||||||||||||||||200301101400&lt;cr&gt;\nOBX||ST|1010.1^BODY WEIGHT||62|kg|||||F&lt;cr&gt;\nOBX||ST|1010.1^HEIGHT||190|cm|||||F&lt;cr&gt;\nDG1|1|19||BIOPSY||00|&lt;cr&gt;\nGT1|1||MASSIE^JAMES^&quot;&quot;^&quot;&quot;^&quot;&quot;^&quot;&quot;^||171 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)485-5344||||SE^SELF|371-66-925||||MOOSES AUTO CLINIC|171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;|(900)485-5344|&lt;cr&gt;\nIN1|0|0|BC1|BLUE CROSS|171 ZOBERLEIN^^ISHPEMING^M149849^&quot;&quot;^||(900)485-5344|90||||||50 OK|&lt;cr&gt;\nIN1|2|&quot;&quot;|&quot;&quot;&lt;cr&gt;\n</pre></div>",
        "id": 153921978,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511922275
    },
    {
        "content": "<p><a href=\"http://www.healthintersections.com.au/A31ToPerson.js\" target=\"_blank\" title=\"http://www.healthintersections.com.au/A31ToPerson.js\">http://www.healthintersections.com.au/A31ToPerson.js</a></p>",
        "id": 153921985,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511922852
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>function A31ToPerson(aEvent)\n{\n    // this function mines a A04 message to create a FHIR Patient resource\n    // Mostly the Person resource only covers the information in the PID segment.\n    //\n    // the actual message is the one found in the v2.5 standard (section 3.5.3):\n//MSH|^~\\&amp;|REGADT|MCM|IFENG||199112311501||ADT^A04^ADT_A01|000001|P|2.5|||\n//EVN|A04|200301101500|200301101400|01||200301101410\n//PID|||191919^^^GENHOS^MR~371-66-9256^^^USSSA^SS|253763|MASSIE^JAMES^A||19560129|M|||171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;^||(900)485-5344|(900)485-5344||S|C|10199925^^^GENHOS^AN|371-66-9256||&lt;cr&gt;\n//NK1|1|MASSIE^ELLEN|SPOUSE|171 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)545-1234~(900)545-1200|EC1^FIRST EMERGENCY CONTACT&lt;cr&gt;\n//NK1|2|MASSIE^MARYLOU|MOTHER|300 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)545-1234~(900)545-1200|EC2^SECOND EMERGENCY CONTACT&lt;cr&gt;\n//NK1|3&lt;cr&gt;\n//NK1|4|||123 INDUSTRY WAY^^ISHPEMING^MI^49849^&quot;&quot;^||(900)545-1200|EM^EMPLOYER|19940605||PROGRAMMER|||ACME SOFTWARE COMPANY&lt;cr&gt;\n//PV1||O|O/R||||0148^ADDISON,JAMES|0148^ADDISON,JAMES|0148^ADDISON,JAMES|AMB|||||||0148^ADDISON,JAMES|S|1400|A|||||||||||||||||||GENHOS|||||199501101410|&lt;cr&gt;\n//PV2||||||||200301101400||||||||||||||||||||||||||200301101400&lt;cr&gt;\n//OBX||ST|1010.1^BODY WEIGHT||62|kg|||||F&lt;cr&gt;\n//OBX||ST|1010.1^HEIGHT||190|cm|||||F&lt;cr&gt;\n//DG1|1|19||BIOPSY||00|&lt;cr&gt;\n//GT1|1||MASSIE^JAMES^&quot;&quot;^&quot;&quot;^&quot;&quot;^&quot;&quot;^||171 ZOBERLEIN^^ISHPEMING^MI^49849^&quot;&quot;^|(900)485-5344|(900)485-5344||||SE^SELF|371-66-925||||MOOSES AUTO CLINIC|171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;|(900)485-5344|&lt;cr&gt;\n//IN1|0|0|BC1|BLUE CROSS|171 ZOBERLEIN^^ISHPEMING^M149849^&quot;&quot;^||(900)485-5344|90||||||50 OK|&lt;cr&gt;\n//IN1|2|&quot;&quot;|&quot;&quot;&lt;cr&gt;\n\n   var v2 = aEvent.Source.Message;\n   var p = FHIR.newPatient;\n   var r = FHIR.makeRequest();\n   r.Resource = p;\n   aEvent.Dest.FhirRequest = r;\n\n   // fill out the request\n   r.id = makePatientId(v2);\n   if (r.id == null || r.id == &quot;&quot;)\n     r.id = &quot;test&quot;;\n   r.ResourceType = frtPatient;\n   r.CommandType = fcmdUpdate;\n   r.Lang = &quot;en&quot;;\n\n\n   // now we have to build the Person resource.\n   fillOutPatientDetails(p, v2);\n   buildNarrative(p, v2);\n  }\n</pre></div>",
        "id": 153921986,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511922903
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kd\">function</span> <span class=\"nx\">A31ToPerson</span><span class=\"p\">(</span><span class=\"nx\">aEvent</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n\n   <span class=\"kd\">var</span> <span class=\"nx\">v2</span> <span class=\"o\">=</span> <span class=\"nx\">aEvent</span><span class=\"p\">.</span><span class=\"nx\">Source</span><span class=\"p\">.</span><span class=\"nx\">Message</span><span class=\"p\">;</span>\n   <span class=\"kd\">var</span> <span class=\"nx\">p</span> <span class=\"o\">=</span> <span class=\"nx\">FHIR</span><span class=\"p\">.</span><span class=\"nx\">newPatient</span><span class=\"p\">;</span>\n   <span class=\"kd\">var</span> <span class=\"nx\">r</span> <span class=\"o\">=</span> <span class=\"nx\">FHIR</span><span class=\"p\">.</span><span class=\"nx\">makeRequest</span><span class=\"p\">();</span>\n   <span class=\"nx\">r</span><span class=\"p\">.</span><span class=\"nx\">Resource</span> <span class=\"o\">=</span> <span class=\"nx\">p</span><span class=\"p\">;</span>\n   <span class=\"nx\">aEvent</span><span class=\"p\">.</span><span class=\"nx\">Dest</span><span class=\"p\">.</span><span class=\"nx\">FhirRequest</span> <span class=\"o\">=</span> <span class=\"nx\">r</span><span class=\"p\">;</span>\n\n   <span class=\"nx\">Bundle</span> <span class=\"nx\">b</span> <span class=\"o\">=</span> <span class=\"nx\">FHIR</span><span class=\"p\">.</span><span class=\"nx\">search</span><span class=\"p\">(</span><span class=\"s2\">&quot;Patient?identifier=&quot;</span><span class=\"o\">+</span><span class=\"nx\">MRN</span><span class=\"p\">);</span>\n   <span class=\"k\">if</span> <span class=\"nx\">b</span><span class=\"p\">.</span><span class=\"nx\">entry</span><span class=\"p\">.</span><span class=\"nx\">count</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n     <span class=\"nx\">patientId</span> <span class=\"o\">=</span> <span class=\"nx\">b</span><span class=\"p\">.</span><span class=\"nx\">entry</span><span class=\"p\">.</span><span class=\"nx\">resource</span><span class=\"p\">.</span><span class=\"nx\">id</span><span class=\"p\">;</span>\n   <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"nx\">b</span><span class=\"p\">.</span><span class=\"nx\">entry</span><span class=\"p\">.</span><span class=\"nx\">count</span> <span class=\"o\">&gt;</span> <span class=\"mi\">1</span>\n     <span class=\"nx\">makeAnError</span><span class=\"p\">(</span><span class=\"s2\">&quot;Multiple matches for Patient &quot;</span><span class=\"o\">+</span><span class=\"nx\">MRN</span><span class=\"p\">);</span>\n   <span class=\"k\">else</span>\n     <span class=\"nx\">patientId</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">;</span> <span class=\"c1\">// we&#39;re going to create a new patient</span>\n\n   <span class=\"c1\">// fill out the request</span>\n   <span class=\"nx\">r</span><span class=\"p\">.</span><span class=\"nx\">id</span> <span class=\"o\">=</span> <span class=\"nx\">patientId</span><span class=\"p\">;</span>\n   <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">r</span><span class=\"p\">.</span><span class=\"nx\">id</span> <span class=\"o\">!=</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">)</span>\n     <span class=\"nx\">r</span><span class=\"p\">.</span><span class=\"nx\">CommandType</span> <span class=\"o\">=</span> <span class=\"nx\">fcmdUpdate</span><span class=\"p\">;</span>\n   <span class=\"k\">else</span>\n     <span class=\"nx\">r</span><span class=\"p\">.</span><span class=\"nx\">CommandType</span> <span class=\"o\">=</span> <span class=\"nx\">fcmdCreate</span><span class=\"p\">;</span>\n   <span class=\"nx\">r</span><span class=\"p\">.</span><span class=\"nx\">ResourceType</span> <span class=\"o\">=</span> <span class=\"nx\">frtPatient</span><span class=\"p\">;</span>\n   <span class=\"nx\">r</span><span class=\"p\">.</span><span class=\"nx\">Lang</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;vn&quot;</span><span class=\"p\">;</span>\n\n\n   <span class=\"c1\">// now we have to build the Person resource.</span>\n   <span class=\"nx\">fillOutPatientDetails</span><span class=\"p\">(</span><span class=\"nx\">p</span><span class=\"p\">,</span> <span class=\"nx\">v2</span><span class=\"p\">);</span>\n   <span class=\"nx\">buildNarrative</span><span class=\"p\">(</span><span class=\"nx\">p</span><span class=\"p\">,</span> <span class=\"nx\">v2</span><span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n</pre></div>",
        "id": 153921987,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511924200
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>function A31ToPerson(aEvent)\n{\n\n   var v2 = aEvent.Source.Message;\n   var p = FHIR.newPatient;\n   var r = FHIR.makeRequest();\n   r.Resource = p;\n   aEvent.Dest.FhirRequest = r;\n\n   MRN = v2[&quot;PID-3[5 = &#39;MR&#39;]&quot;];\n   Bundle b = FHIR.search(&quot;Patient?identifier=&quot;+MRN);\n   if b.entry.count = 1\n     patientId = b.entry.resource.id;\n   else if b.entry.count &gt; 1\n     makeAnError(&quot;Multiple matches for Patient &quot;+MRN);\n   else\n     patientId = &quot;&quot;; // we&#39;re going to create a new patient\n\n   // fill out the request\n   r.id = patientId;\n   if (r.id != &quot;&quot;)\n     r.CommandType = fcmdUpdate;\n   else\n     r.CommandType = fcmdCreate;\n   r.ResourceType = frtPatient;\n   r.Lang = &quot;vn&quot;;\n\n\n   // now we have to build the Person resource.\n   fillOutPatientDetails(p, v2);\n   buildNarrative(p, v2);\n  }\n</pre></div>",
        "id": 153921988,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511924249
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kd\">function</span> <span class=\"nx\">buildNarrative</span><span class=\"p\">(</span><span class=\"nx\">p</span><span class=\"p\">,</span> <span class=\"nx\">v2</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n  <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">text</span> <span class=\"o\">=</span> <span class=\"nx\">FHIR</span><span class=\"p\">.</span><span class=\"nx\">newNarrative</span><span class=\"p\">;</span>\n  <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">text</span><span class=\"p\">.</span><span class=\"nx\">statusST</span> <span class=\"o\">=</span> <span class=\"nx\">NarrativeStatusGenerated</span><span class=\"p\">;</span>\n\n  <span class=\"kd\">var</span> <span class=\"nx\">n2</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-5&quot;</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">name</span> <span class=\"o\">=</span> <span class=\"nx\">n2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot; &quot;</span><span class=\"o\">+</span><span class=\"nx\">n2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">a2</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-11&quot;</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">address</span> <span class=\"o\">=</span> <span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">+</span><span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot; &quot;</span><span class=\"o\">+</span><span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot; &quot;</span><span class=\"o\">+</span><span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">mrn</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">Element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-3[@5 = \\&quot;MR\\&quot;].1&quot;</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">dob</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-7&quot;</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">gender</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-8&quot;</span><span class=\"p\">).</span><span class=\"nx\">DisplayForCode</span><span class=\"p\">;;</span>\n\n\n  <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">text</span><span class=\"p\">.</span><span class=\"nx\">div</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">xhtml</span><span class=\"p\">(</span>\n    <span class=\"s2\">&quot;&lt;div&gt;Patient &quot;</span><span class=\"o\">+</span><span class=\"nx\">name</span><span class=\"o\">+</span><span class=\"s2\">&quot; (&quot;</span><span class=\"o\">+</span><span class=\"nx\">mrn</span><span class=\"o\">+</span><span class=\"s2\">&quot;): &quot;</span><span class=\"o\">+</span><span class=\"nx\">gender</span><span class=\"o\">+</span><span class=\"s2\">&quot;, born &quot;</span><span class=\"o\">+</span><span class=\"nx\">dob</span><span class=\"o\">+</span><span class=\"s2\">&quot;.&lt;br/&gt;Address: &quot;</span><span class=\"o\">+</span><span class=\"nx\">address</span><span class=\"o\">+</span><span class=\"s2\">&quot;&lt;/div&gt;&quot;</span>\n  <span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</pre></div>",
        "id": 153921989,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511928327
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kd\">function</span> <span class=\"nx\">fillOutPatientDetails</span><span class=\"p\">(</span><span class=\"nx\">p</span><span class=\"p\">,</span> <span class=\"nx\">v2</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n  <span class=\"c1\">// MRN. We need to assign a global scope to the mrn. It has to be known based on local config</span>\n   <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">identifier</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Identifier</span><span class=\"p\">{</span>\n     <span class=\"nx\">value</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">Element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-3[@5 = \\&quot;MR\\&quot;].1&quot;</span><span class=\"p\">),</span>\n     <span class=\"c1\">// system = lookupURL(v2.Element(&quot;PID-3[@5 = \\&quot;MR\\&quot;].4&quot;)),</span>\n     <span class=\"nx\">system</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;http://hospitals.vn/&quot;</span><span class=\"o\">+</span><span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">Element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-3[@5 = \\&quot;MR\\&quot;].4&quot;</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot;/mrn&quot;</span><span class=\"p\">,</span>\n     <span class=\"nx\">type</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">CodeableConcept</span><span class=\"p\">(){</span> <span class=\"nx\">coding</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span>\n       <span class=\"k\">new</span> <span class=\"nx\">Coding</span><span class=\"p\">(</span> <span class=\"nx\">system</span><span class=\"o\">=</span><span class=\"s2\">&quot;http://hl7.org/fhir/v2/0203&quot;</span><span class=\"p\">,</span> <span class=\"nx\">code</span><span class=\"o\">=</span><span class=\"s2\">&quot;MR&quot;</span><span class=\"p\">){})}</span>\n   <span class=\"p\">});</span>\n\n   <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">identifier</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">Identifier</span><span class=\"p\">{</span>\n     <span class=\"nx\">value</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">Element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-3[@5 = \\&quot;MR\\&quot;].1&quot;</span><span class=\"p\">),</span>\n     <span class=\"nx\">system</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;http://moh.gov.vn/vss&quot;</span><span class=\"p\">,</span>\n     <span class=\"nx\">type</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">CodeableConcept</span><span class=\"p\">(){</span> <span class=\"nx\">coding</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span>\n       <span class=\"k\">new</span> <span class=\"nx\">Coding</span><span class=\"p\">(</span> <span class=\"nx\">system</span><span class=\"o\">=</span><span class=\"s2\">&quot;http://hl7.org/fhir/v2/0203&quot;</span><span class=\"p\">,</span> <span class=\"nx\">code</span><span class=\"o\">=</span><span class=\"s2\">&quot;NIIP&quot;</span><span class=\"p\">){})}</span>\n   <span class=\"p\">});</span>\n\n  <span class=\"c1\">// Nguyen^Thi Phuong Trang^</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">n2</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">[</span><span class=\"s2\">&quot;PID-5&quot;</span><span class=\"p\">];</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">n</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">HumanName</span><span class=\"p\">(){</span>\n     <span class=\"nx\">text</span> <span class=\"o\">=</span> <span class=\"nx\">n2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot; &quot;</span><span class=\"o\">+</span><span class=\"nx\">n2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">);</span>\n  <span class=\"p\">};</span>\n\n  <span class=\"nx\">n</span><span class=\"p\">.</span><span class=\"nx\">family</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">string</span><span class=\"p\">(</span><span class=\"nx\">n2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)));</span>\n  <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"nx\">s</span> <span class=\"o\">:</span> <span class=\"nx\">n2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">).</span><span class=\"nx\">split</span><span class=\"p\">(</span><span class=\"s2\">&quot; &quot;</span><span class=\"p\">))</span>\n    <span class=\"nx\">n</span><span class=\"p\">.</span><span class=\"nx\">given</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">string</span><span class=\"p\">(</span><span class=\"nx\">s</span><span class=\"p\">));</span>\n\n  <span class=\"c1\">// 171 ZOBER-LEIN^^ISHPEMING^MI^49849^&quot;&quot;^</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">a2</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-11&quot;</span><span class=\"p\">);</span>\n  <span class=\"kd\">var</span> <span class=\"nx\">a</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nx\">Address</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"nx\">text</span> <span class=\"o\">=</span> <span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot;\\r\\n&quot;</span><span class=\"o\">+</span><span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot; &quot;</span><span class=\"o\">+</span><span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"s2\">&quot; &quot;</span><span class=\"o\">+</span><span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">))</span>\n  <span class=\"p\">}</span>\n  <span class=\"nx\">a</span><span class=\"p\">.</span><span class=\"nx\">line</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">string</span><span class=\"p\">(</span><span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)));</span>\n  <span class=\"nx\">a</span><span class=\"p\">.</span><span class=\"nx\">city</span> <span class=\"o\">=</span> <span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">);</span>\n  <span class=\"nx\">a</span><span class=\"p\">.</span><span class=\"nx\">state</span> <span class=\"o\">=</span> <span class=\"nx\">a2</span><span class=\"p\">.</span><span class=\"nx\">component</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">);</span>\n  <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">addressList</span><span class=\"p\">.</span><span class=\"nx\">addItem</span><span class=\"p\">(</span><span class=\"nx\">a</span><span class=\"p\">);</span>\n\n  <span class=\"c1\">// (900)485-5344|(900)485-5344</span>\n  <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">telecom</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">ContactPoint</span><span class=\"p\">()</span> <span class=\"p\">{</span><span class=\"nx\">use</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;phone&quot;</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-13&quot;</span><span class=\"p\">),</span> <span class=\"nx\">type</span><span class=\"o\">=</span> <span class=\"s2\">&quot;home&quot;</span><span class=\"p\">};</span>\n  <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">telecom</span><span class=\"p\">.</span><span class=\"nx\">add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"nx\">ContactPoint</span><span class=\"p\">()</span> <span class=\"p\">{</span><span class=\"nx\">use</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;phone&quot;</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-14&quot;</span><span class=\"p\">),</span> <span class=\"nx\">type</span><span class=\"o\">=</span> <span class=\"s2\">&quot;work&quot;</span><span class=\"p\">};</span>\n\n\n  <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">birthDate</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-7&quot;</span><span class=\"p\">).</span><span class=\"nx\">copy</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">).</span><span class=\"nx\">reformat</span><span class=\"p\">;</span>\n  <span class=\"c1\">// gender &amp; religion: code is also original text. That may not be appropriate, depending on the source of the message</span>\n  <span class=\"nx\">string</span> <span class=\"nx\">g</span> <span class=\"o\">=</span> <span class=\"nx\">v2</span><span class=\"p\">.</span><span class=\"nx\">element</span><span class=\"p\">(</span><span class=\"s2\">&quot;PID-8&quot;</span><span class=\"p\">);</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">g</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;M&quot;</span><span class=\"p\">)</span>\n    <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">gender</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;male&quot;</span><span class=\"p\">;</span>\n  <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">g</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;F&quot;</span><span class=\"p\">)</span>\n    <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">gender</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;female&quot;</span><span class=\"p\">;</span>\n  <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">g</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;U&quot;</span><span class=\"p\">)</span>\n    <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">gender</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;unknown&quot;</span><span class=\"p\">;</span>\n  <span class=\"k\">else</span> <span class=\"c1\">// if (g = &quot;O&quot;)</span>\n    <span class=\"nx\">p</span><span class=\"p\">.</span><span class=\"nx\">gender</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;other&quot;</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n</pre></div>",
        "id": 153921990,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511928327
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>// run this every minute\nprocedure PushProcess() {\n  sql = select * from my_database_queue where handled = 0\n  for each row in fetch(sql) do {\n    // transaction:\n    Bundle b = makeResources(row);\n    Bundle resp = client.submitTransaction(b);\n    for entry in resp.entry do\n      if we_have_no_national_id\n        update our record with the national id\n    runsql(&quot;update row set handled = 1&quot;);\n  }\n}\n\nprocedure makeResources(row) {\n  Bundle b = new Bundle();\n  b.type = transaction;\n  b.id = makeUUID;\n\n  // this row is a changed problem!\n  Condition c = new Condition();\n  BundleEntry be = b.entry.add;\n  be.resource = c;\n  if my_record_has_national_id\n    c.id = national_id\n  else\n    c.id = &quot;&quot;; we&#39;re going to create it\n\n  fill out the condition from your databases\n\n}\n\nSecurity:\n3 options to authenticate the client (push process):\n - username/password = Basic Authentication Header\n - Mutual TLS certificates (SSL)\n - Certificate exchange (smart on FHIR &quot;backend services&quot; http://docs.smarthealthit.org/authorization/backend-services/)\n</pre></div>",
        "id": 153921992,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511931783
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Pull\n\non Search Patient do {\n  check the user has access to which patients\n  build base sql for selecting from patients in scope\n    (select * from patients, user_patients\n      where patients.patientkey = userPaitents.paitnetkey and userpatients.userkey = [user])\n  for each parameter: add to sql statement\n    (?name=thi -&gt; and patients.name = &quot;%thi%&quot;)\n  create response bundle, type = searchset\n  for each row in fetch(sql)\n    add entry to bundle\n    fill out the resource from your database\n}\n\non read patient do {\n  read the id\n  check the user has access to the patient [id]\n  if so\n    fill out the resource from your database\n}\n\non Update patient do {\n  read the id\n  check the user has access to the patient [id]\n  check submitted resource is valid\n  check meets business rules\n  if so\n    fill out your database from the resource\n}\n\non Create patient do {\n  check the user has access to create patients\n  check submitted resource is valid\n  check meets business rules (check ids unique etc)\n  if so\n    assign an id (next primary key, uuid etc)\n    fill out your database from the resource\n    return the id in the location header\n}\n\nkey pull issue:\n- only want data that has changed\n  GET Patient/[id]/$everything?_lastUpdated=2017-10-23T13:14:15+07:00\n\n\nSecurity on pull:\n\nA: Securing systems:\n3 options to authenticate the client (push process):\n - username/password = Basic Authentication Header\n - Mutual TLS certificates (SSL)\n - Certificate exchange (smart on FHIR &quot;backend services&quot; http://docs.smarthealthit.org/authorization/backend-services/)\n\nB: Securing the user:\n- OAuth (smart on FHIR)\n\n  Authorization: Bearer [token]\n</pre></div>",
        "id": 153921994,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511940094
    },
    {
        "content": "<p>Grahame's server: <a href=\"http://www.healthintersections.com.au/FhirServer\" target=\"_blank\" title=\"http://www.healthintersections.com.au/FhirServer\">http://www.healthintersections.com.au/FhirServer</a></p>",
        "id": 153921995,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511940339
    },
    {
        "content": "<p>Command Line Tool for HAPI FHIR -- <a href=\"http://hapifhir.io/doc_cli.html\" target=\"_blank\" title=\"http://hapifhir.io/doc_cli.html\">http://hapifhir.io/doc_cli.html</a></p>",
        "id": 153921996,
        "sender_full_name": "Raymond Francis Sarmiento",
        "timestamp": 1511940364
    },
    {
        "content": "<p><a href=\"https://fhirblog.com/2016/10/19/setting-up-your-own-fhir-server-for-profiling/\" target=\"_blank\" title=\"https://fhirblog.com/2016/10/19/setting-up-your-own-fhir-server-for-profiling/\">https://fhirblog.com/2016/10/19/setting-up-your-own-fhir-server-for-profiling/</a></p>",
        "id": 153921998,
        "sender_full_name": "Raymond Francis Sarmiento",
        "timestamp": 1511941187
    },
    {
        "content": "<p>James Agnew's HAPI FHIR github:<br>\n<a href=\"https://github.com/jamesagnew/hapi-fhir\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir\">https://github.com/jamesagnew/hapi-fhir</a></p>",
        "id": 153921999,
        "sender_full_name": "Raymond Francis Sarmiento",
        "timestamp": 1511941509
    },
    {
        "content": "<p>How to build a health database <br>\n<a href=\"https://www.openhealthhub.org/t/howto-build-a-health-database-and-fhir-api-server-in-15-mins-using-open-source/155\" target=\"_blank\" title=\"https://www.openhealthhub.org/t/howto-build-a-health-database-and-fhir-api-server-in-15-mins-using-open-source/155\">https://www.openhealthhub.org/t/howto-build-a-health-database-and-fhir-api-server-in-15-mins-using-open-source/155</a></p>",
        "id": 153922000,
        "sender_full_name": "Tuan Le",
        "timestamp": 1511941629
    },
    {
        "content": "<p>How to build a health database and FHIR server in 15 mins using open source<br>\n<a href=\"https://goo.gl/28pkTz\" target=\"_blank\" title=\"https://goo.gl/28pkTz\">https://goo.gl/28pkTz</a></p>\n<p>This is essentially HAPI FHIR and MySQL</p>",
        "id": 153922001,
        "sender_full_name": "Raymond Francis Sarmiento",
        "timestamp": 1511941648
    },
    {
        "content": "<p><span class=\"emoji emoji-1f44d\" title=\"thumbs up\">:thumbs_up:</span> thanks</p>",
        "id": 153922007,
        "sender_full_name": "Hanh Dang",
        "timestamp": 1511944180
    },
    {
        "content": "<p>by everyone.... see you next time!</p>",
        "id": 153922023,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511952103
    },
    {
        "content": "<p>Great stuff, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span><br>\nWe learned a lot! Have a safe flight :)</p>",
        "id": 153922025,
        "sender_full_name": "Raymond Francis Sarmiento",
        "timestamp": 1511952382
    },
    {
        "content": "<p>thanks</p>",
        "id": 153922184,
        "sender_full_name": "Trần Ngọc Quốc",
        "timestamp": 1512006507
    }
]