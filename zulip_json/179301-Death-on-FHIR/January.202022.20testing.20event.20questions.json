[
    {
        "content": "<p>We've had some questions on the January testing event via email; I'm posting the conversation here as well for posterity and for anyone else who may find the conversation helpful.</p>\n<ol>\n<li>Use of Test Steve 2.0 to test FHIR messaging will be like the previous Connectathon procedure in which a jurisdiction creates a death record in the FHIR message, manually upload the FHIR message to Steve 2.0 and then notifies NCHS which will retrieve the message run it through their program to generate ICD-10 cause of death and race codes and then manually load that FHIR message back to Test Steve 2.0.  The jurisdiction will then log in to Test Steve 2.0 and manually download the returned FHIR message and then upload that message back into our Test EDRS system that would load or consume the FHIR message so that the ICD-10 cause of death and race codes can be extracted and stored in the corresponding death record in the Test EDRS</li>\n</ol>\n<p>That’s correct, except that processing of the uploaded file should happen automatically without notifying NCHS. It’s still a good idea to track what’s happening, but the responses should be automatically generated.</p>\n<ol start=\"2\">\n<li>Use of the test API in which a Test EDRS has the functionality to press a button in a jurisdiction Test EDRS for a death record in which the Test EDRS creates a FHIR message and automatically send the test FHIR message to the API with the proper formatting and authorized credentials in the header in which the API will accept the message and then automatically run the NCHS program to that review the cause of death literals and race information and then generates the ICD-10 cause of death and race codes and automatically creates the FHIR message to be sent back to the jurisdiction.</li>\n</ol>\n<p>Yes, that’s correct. It will also include the acknowledgement messages. The list of messages is outlined in the test plan for each test.</p>\n<ol start=\"3\">\n<li>In the same procedure but in the opposite direction, the NCHS FHIR API will send a message header with the proper credentials that a jurisdiction Test EDRS will recognize and then load that returned FHIR message to be \"consumed\" and the Test EDRS system will automatically identify that record and read the ICD-10 cause of death and race codes and then extract and store these codes in the proper death record. Ability for the Test EDRS to correctly load the returned FHIR message will be based on the 3 numeric fields in the FHIR message or the jurisdiction in the original FHIR message can use one of the customizable data fields such as using the jurisdiction EDRS unique primary key value and that primary key value will be retained and sent back in the returned FHIR message that can be used by the Test EDRS to correctly identify the corresponding death record.</li>\n</ol>\n<p>Yes, that’s correct, with the additional detail that the return message will be pulled from the API by the EDRS; that way, the EDRS doesn’t have to set up a listening endpoint.</p>\n<ol start=\"4\">\n<li>Would it also be accurate to say since the jurisdiction will be sending FHIR messages real time to the Test API, they will not be batched so the subsequent returned FHIR message with ICD-10 and race codes to be consumed back in the test EDRS will also be returned real time as well and not batched?</li>\n</ol>\n<p>That’s correct, all testing with FHIR is not batched (including through STEVE). Keep in mind that there might be some delay in providing the coding response message because coding does not happen instantaneously.</p>",
        "id": 267142199,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1641520750
    },
    {
        "content": "<p>I have received the following error when trying to get OAuth token with the provided curl command. I can login SAMS<br>\n{<br>\n    \"error\": \"invalid_request\",<br>\n    \"error_description\": \"The resource owner could not be authenticated due to missing or invalid credentials\"<br>\n}</p>\n<p>I can get the token successfully after setting up System account</p>",
        "id": 267634894,
        "sender_full_name": "Aihua Tong",
        "timestamp": 1641930368
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196927\">@Pete Krautscheid</span> <span class=\"user-mention\" data-user-id=\"414424\">@Sarah MacAdam</span></p>",
        "id": 267903605,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1642095367
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"469398\">@Aihua Tong</span>, glad you were able to sort out connections during our calls.</p>\n<p>For others who are testing, as Aihua notes it will be important to set up the system account within your SAMS account for testing. As we discussed during the most recent call, I've reached out to the SAMS team to try to understand why many of us aren't seeing the system account within the SAMS account and will post updates when I hear more.</p>",
        "id": 267904199,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1642095636
    },
    {
        "content": "<p>I am getting the following trying post a bundle...</p>\n<p><a href=\"https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN\">https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN</a></p>\n<p>{<br>\n    \"Error\": \"Authorization Failure\",<br>\n    \"Reason\": \"User is not a memeber of a SAMS Activity\"<br>\n}</p>",
        "id": 269321458,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643143637
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"295307\">@Doug Wheeler</span> , did your initial GET request to <a href=\"https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN/Bundles\">https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN/Bundles</a> succeed? Are you POSTing to the same Bundles endpoint?</p>",
        "id": 269322019,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643143902
    },
    {
        "content": "<p>I did...  It returned a 200 {\"resourceType\":\"Bundle\",\"type\":\"searchset\",\"timestamp\":\"2022-01-25T15:52:34.4789931-05:00\"}</p>\n<p>Is that the expected outcome?  I am guessing no...</p>",
        "id": 269322267,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643144021
    },
    {
        "content": "<p>Yes, that's correct! That's essentially saying \"Here's a bundle of all your responses\"; because you don't have any responses yet it's an empty list.</p>",
        "id": 269323760,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643144603
    },
    {
        "content": "<p>Interesting....  GET <a href=\"https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/ID/Bundles\">https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/ID/Bundles</a> returns...  </p>\n<p>{<br>\n\"Error\":\"Authorization Failure\",<br>\n\"Reason\":\"User is not a memeber of a SAMS Activity\"<br>\n}</p>\n<p>Vs GET <a href=\"https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN/Bundles\">https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN/Bundles</a> returns...</p>\n<p>{<br>\n    \"resourceType\": \"Bundle\",<br>\n    \"type\": \"searchset\",<br>\n    \"timestamp\": \"2022-01-25T16:09:11.8698786-05:00\"<br>\n}</p>\n<p>You must be checking my jurisdiction in the token against the jurisdiction requested.</p>",
        "id": 269324814,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643145034
    },
    {
        "content": "<p>Absolutely!</p>",
        "id": 269325779,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643145438
    },
    {
        "content": "<p>I am getting the following trying post a bundle...</p>\n<p><a href=\"https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN\">https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN</a></p>\n<p>{<br>\n\"Error\": \"Authorization Failure\",<br>\n\"Reason\": \"User is not a memeber of a SAMS Activity\"<br>\n}</p>",
        "id": 269394465,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643196088
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"295307\">@Doug Wheeler</span> , instead of POSTing to <a href=\"https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN\">https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN</a><br>\nyou should be POSTing to <a href=\"https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN/Bundles\">https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN/Bundles</a> (the same entry point as the GET request you’ve tested)</p>",
        "id": 269401282,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643199367
    },
    {
        "content": "<p>There is a typo in the error message \"User is not a memeber of a SAMS Activity\".</p>\n<p>Now that I am posting to the right endpoint I am getting a 400 Bad Request.  So I will take the payload I am trying to submit and validate it via Canary.</p>\n<p>The ball is in my court!</p>\n<p>Thank you!</p>",
        "id": 269402125,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643199884
    },
    {
        "content": "<p>The other thing I could have done to trouble shoot the AuthZ issues would have been to sign into my SAMS account and confirmed my account was part of the NVSS_VHIR_API MN group.  Correct?</p>",
        "id": 269403797,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643200818
    },
    {
        "content": "<p>Should I just be getting a 400 or I am I really running Test 5: submission of malformed message, with an incorrectly formatted record?</p>\n<p>The jurisdiction will send a single FHIR message containing an invalid death record that cannot be processed to NCHS, NCHS will reply with the appropriate error message, and the jurisdiction will acknowledge the error. The following criteria will indicate success:</p>\n<p>   error is returned to jurisdiction and contains the correct error message<br>\n   error acknowledgement is returned to NCHS and references the error message</p>",
        "id": 269404435,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643201176
    },
    {
        "content": "<p>Our primary focus for the interoperability project has been the CMS to EDRS.  We did participate in previous NCHS Connectathon(s) but the focus of these Connectathons were EDRS to NCHS via STEVE2, not via RESTful API.  All three also use FHIR and leverage the VRDRJavaLib, Canary and other tools so there is a lot of synergy between the interfaces.</p>\n<p>The new RESTful NCHS API being developed and test in this event is different but very similar to the API we developed for MR&amp;C for the CMS to EDRS API.  Both require onboarding clients and granting API access via OAuth2, both APIs are JSON encoded FHIR, etc.  So, there are a lot of similarities.</p>\n<p>But there are differences the biggest one being MR&amp;C is not a native MOM infrastructure.  The MR&amp;C EDRS is a web application.  And we did not want to have to build or buy a MOM solution to achieve interoperability.  </p>\n<p>One difference between the two APIs is the async vs. synch response to Sending of messages i.e. POST FHIR payload and the ability to get / poll for status updates on a submission.   The CMS to EDRS has a similar use case, but we post a bundle containing a VRDR-Death-Certificate-Document and respond synchronously with a 200 with a FHIR message containing an Operational Outcome indicate Success, Warnings, etc.  Not saying it has to be one or the other is better it just what we came up with.  We audit API access but we do not persist the messages.</p>\n<p>POST:  /mrc/api/FHIR/R4/vrdr-death-certification-document</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;resourceType&quot;: &quot;Bundle&quot;,\n&quot;id&quot;: &quot;d70f4572-5f87-4caa-9d81-f3b0d79321bd&quot;,\n&quot;meta&quot;: {\n    &quot;profile&quot;: [\n        &quot;http://hl7.org/fhir/us/vrdr/StructureDefinition/VRDR-Death-Certificate-Document&quot;\n    ]\n},\n</code></pre></div>\n\n<p>I could go on and on, but I really got a lot of insight and ideas for how to improve our API moving forward and better document our API, test our API, and improve our API!  Surprisingly there are more similarities than difference and I can see how the two interfaces could become more and more \"standard\".</p>\n<p>The COP and NCHS has done an excellent job organizing and documenting everything!  </p>\n<p>Kudos!!!</p>",
        "id": 269414684,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643205541
    },
    {
        "content": "<p>I got this image from one of the slides.  It is not obvious to me if this is a postback or not.  I don't see anything in any of the test cases suggesting a postback.  It looks like 2.GET FHIR response is from NVSS &gt; API Endpoint is a postback from NVSS to the API Endpoint I think maybe it is a GET from the API Adapter to NVSS.</p>\n<p><a href=\"/user_uploads/10155/4qgoqbIra5UbKL53qKXKMtZm/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/4qgoqbIra5UbKL53qKXKMtZm/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/4qgoqbIra5UbKL53qKXKMtZm/image.png\"></a></div>",
        "id": 269419150,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643207133
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"295307\">@Doug Wheeler</span> , thanks for noting the typo in the SAMS message, I've let the SAMS team know.</p>\n<p>For the AuthZ issues, the fact that you were able to use a token to successfully send a GET request to the  <a href=\"https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN/Bundles\">https://apigw.cdc.gov/OSELS/NCHS/NVSSFHIRAPI/MN/Bundles</a> endpoint means that your authorization step succeeded (even though you saw an empty Bundle); POSTing to that same endpoint works the same way.</p>\n<p>A simple malformed FHIR message should not give you a 400, you should get a 204 and then a FHIR message will be returned to you shortly on the return endpoint with some details about the issue. That said, in the spirit of <a href=\"https://www.hl7.org/fhir/http.html#Status-Codes\">https://www.hl7.org/fhir/http.html#Status-Codes</a> I think we should look into returning an OperationOutcome for 400 errors with some more information. A 400 means some other type of error is happening before FHIR processing even begins. Can you share what you're POSTing as part of your submission? Are you using curl or postman to test it out?</p>\n<p>Thanks for describing your approach! There are definitely similarities and will look forward to hearing about lessons you've learned so we can be sure to apply them to the NVSS API as well.</p>",
        "id": 269419435,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643207239
    },
    {
        "content": "<p>At this time we're not using any type of POSTback, messages flow back to jurisdictions via jurisdictions initiating GETs to the Bundles endpoint. The analogy I like to use is that we have two pipes, one for Jurisdiction -&gt; NCHS and the other for NCHS -&gt; Jurisdiction. In both cases the interaction is initiated by the jurisdiction (e.g., the jurisdiction turns the valve on and off). The Jurisdiction -&gt; NCHS pipe is via the jurisdiction initiating POSTs to the /Bundles endpoint and the NCHS -&gt; Jurisdiction  pipe is via the jurisdiction initiating GETs to the /Bundles endpoint (which I think is what you're saying at the end of your last message).</p>",
        "id": 269420218,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643207545
    },
    {
        "content": "<p>In the context of the NCHS Adapter would that use the same SAMS token regardless of user or does the SAMS token also have username/profile data embedded in it?</p>",
        "id": 269457637,
        "sender_full_name": "Doug Wheeler",
        "timestamp": 1643221293
    },
    {
        "content": "<p>The SAMS token is specifically issued for a particular user (and expires after 3600 seconds aka 1 hour)</p>",
        "id": 269461834,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643223017
    },
    {
        "content": "<p>Unfortunately we can't easily pull the jurisdiction info from the token because of limits in the information that the SAMS Gateway forwards to the API, though we'll do a little more investigation.</p>",
        "id": 269462652,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643223359
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"295307\">@Doug Wheeler</span>, related to your comments earlier today, there's a trick for using Canary to generate records that you can use for testing with the API, if your goal is just to learn more about interacting with the API:</p>\n<ol>\n<li>Under \"Message Testing\" select \"Connectathon FHIR VRDR Messages (Producing)\"</li>\n<li>Pick one of the records</li>\n<li>Pick a certificate number and select your jurisdiction</li>\n<li>The text box in step 2 will contain a FHIR death record for your jurisdiction!</li>\n</ol>\n<p>You can also use Canary to wrap that record in a submission record:</p>\n<ol>\n<li>Copy that record to your clipboard (the little buttons to the top right of the box should help)</li>\n<li>Navigate in Canary to \"Message Tools\" and \"Creating FHIR VRDR Messages\"</li>\n<li>Select \"Submission\" message</li>\n<li>Paste the record from above into the box in step 2</li>\n<li>Click Submit</li>\n<li>Click Generate on the bottom of the page</li>\n<li>The resulting box will contain a message containing a connectathon testing record for your jurisdiction!</li>\n</ol>",
        "id": 269465207,
        "sender_full_name": "Pete Krautscheid",
        "timestamp": 1643224285
    }
]