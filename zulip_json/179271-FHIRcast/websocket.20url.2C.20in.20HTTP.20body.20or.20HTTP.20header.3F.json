[
    {
        "content": "<p>When a FHIRcast client requests and is granted a new websocket subscription, the Hub returns a <code>wss://</code> url which the client subsequently connects to and event notifications are sent over.</p>",
        "id": 181936825,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1574784599
    },
    {
        "content": "<p>Both in our <a href=\"https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/wiki/Websocket-proposal\">informal wiki writeup</a> and in our <a href=\"http://fhircast.org/specification/Feb2020Ballot/\" target=\"_blank\" title=\"http://fhircast.org/specification/Feb2020Ballot/\">draft websocket spec</a>, the Hub returns this wss url in the body of the HTTP response.</p>",
        "id": 181936879,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1574784607
    },
    {
        "content": "<p>On a recent II call, <span class=\"user-mention\" data-user-id=\"202436\">@Bill Wallace</span> recommended that this wss url is returned to the subscribing client, not in the HTTP body, but rather in the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location\" target=\"_blank\" title=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location\">Content-Location</a> HTTP header. Bill made the point that this would make FHIRcast a bit more consistent with <a href=\"http://dicom.nema.org/medical/dicom/current/output/html/part18.html#sect_9.4.3\" target=\"_blank\" title=\"http://dicom.nema.org/medical/dicom/current/output/html/part18.html#sect_9.4.3\">DICOM's use of websockets</a> (which do the same thing). Re-using an existing HTTP header also feels classy and a bit more RESTful. My understanding of Content-Location is that this would be an appropriate use of the header. I've <a href=\"https://github.com/HL7/fhircast-docs/pull/303\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/pull/303\">written up a PR</a> to make this change to our draft websockets spec.</p>",
        "id": 181936884,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1574784612
    },
    {
        "content": "<p>Does anyone have feedback or concern about this change? Especially if you've already developed support for websockets? (<span class=\"user-mention\" data-user-id=\"196152\">@George Kustas</span> , <span class=\"user-mention\" data-user-id=\"192821\">@Martin Bellehumeur</span> , <span class=\"user-mention\" data-user-id=\"194364\">@Leo Bergnéhr</span> , <span class=\"user-mention\" data-user-id=\"194356\">@Will Maethner</span> , <span class=\"user-mention\" data-user-id=\"219196\">@Wouter Devriendt</span> )</p>",
        "id": 181936892,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1574784615
    },
    {
        "content": "<p>Sounds OK to me, but there are several implementations working now that will need to change. I think that is OK, since we’re all in “RSNA demo code” now. We’ll have to make a video and share it. Lots happening!</p>",
        "id": 181944549,
        "sender_full_name": "George Kustas",
        "timestamp": 1574789636
    },
    {
        "content": "<blockquote>\n<p>Does anyone have feedback or concern about this change? Especially if you've already developed support for websockets? (<span class=\"user-mention silent\" data-user-id=\"196152\">George Kustas</span> , <span class=\"user-mention silent\" data-user-id=\"192821\">Martin Bellehumeur</span> , <span class=\"user-mention silent\" data-user-id=\"194364\">Leo Bergnéhr</span> , <span class=\"user-mention silent\" data-user-id=\"194356\">Will Maethner</span> , <span class=\"user-mention silent\" data-user-id=\"219196\">Wouter Devriendt</span> )</p>\n</blockquote>\n<p>For us it will require a change that could take some time.  I have filed the request.</p>",
        "id": 182663048,
        "sender_full_name": "Martin Bellehumeur (Visage Imaging)",
        "timestamp": 1575555719
    },
    {
        "content": "<p>Congrats to <span class=\"user-mention\" data-user-id=\"196152\">@George Kustas</span>  for the launch of Powercast at RSNA.  I think the first FHIRcast hub on the market.  You’re a pioneer! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 182663230,
        "sender_full_name": "Martin Bellehumeur (Visage Imaging)",
        "timestamp": 1575555826
    },
    {
        "content": "<p>Team effort from <span class=\"user-mention\" data-user-id=\"192821\">@Martin Bellehumeur</span> , <span class=\"user-mention\" data-user-id=\"194360\">@Niklas Svenzén</span> ,  Barco,  Primordial and more who really pulled it all together to show FhirCast  do it's thing. Context sharing off course, but also two-way clinical findings updates (including measurements).</p>",
        "id": 182677533,
        "sender_full_name": "George Kustas",
        "timestamp": 1575563984
    },
    {
        "content": "<p>I am finally implementing this in our hub and running into a problem. It appears that only \"http\" and \"https\" are valid in the content-location. The client is throwing the exception. Any suggestions <span class=\"user-mention\" data-user-id=\"192821\">@Martin Bellehumeur</span> , <span class=\"user-mention\" data-user-id=\"202436\">@Bill Wallace</span> , <span class=\"user-mention\" data-user-id=\"191864\">@Isaac Vetter</span></p>",
        "id": 190772020,
        "sender_full_name": "George Kustas",
        "timestamp": 1584388633
    },
    {
        "content": "<p>after reading this, I'm not so sure that we should be using content-location for the websocket connection endpoint: <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location\" target=\"_blank\" title=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location</a></p>",
        "id": 190773193,
        "sender_full_name": "George Kustas",
        "timestamp": 1584389183
    },
    {
        "content": "<p>In general, there doesn't seem to be a restriction on the URI protocol that can be used in content-location. Whether that header is the appropriate place for the websocket URL, I don't know. One thing to consider might be the difference in <a href=\"https://en.wikipedia.org/wiki/HTTP/1.1_Upgrade_header#Use_with_WebSocket\" target=\"_blank\" title=\"https://en.wikipedia.org/wiki/HTTP/1.1_Upgrade_header#Use_with_WebSocket\">HTTP 1.1</a> and <a href=\"https://tools.ietf.org/html/rfc8441\" target=\"_blank\" title=\"https://tools.ietf.org/html/rfc8441\">HTTP/2</a> in the way the websocket connection is bootstrapped...</p>",
        "id": 190777103,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1584391268
    },
    {
        "content": "<p>The fact that using it caused an exception in the Microsoft .Net implemented library worries me. I don't think we're using it as intended. Perhaps this would be a better alternative: <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-WebSocket-Accept\" target=\"_blank\" title=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-WebSocket-Accept\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-WebSocket-Accept</a>. But I would rather keep it in the body for now.</p>",
        "id": 190791247,
        "sender_full_name": "George Kustas",
        "timestamp": 1584400194
    },
    {
        "content": "<p>I tested against sandbox.js and my PACS client gets the content-location header.  Which hub have you added to?  I tried connect and connect2 but did not see the header set.</p>",
        "id": 190816735,
        "sender_full_name": "Martin Bellehumeur (Visage Imaging)",
        "timestamp": 1584432491
    },
    {
        "content": "<p>INtertesting... What library is your client using? IS that javascript?</p>",
        "id": 190845531,
        "sender_full_name": "George Kustas",
        "timestamp": 1584451093
    },
    {
        "content": "<p>Hey Guys - sorry for the ridiculously late response. <span class=\"user-mention\" data-user-id=\"196152\">@George Kustas</span>, this is excellent feedback. I think that the last thing we want to do is have the base spec be incompatible with a framework as common as .Net's HttpClient. </p>\n<p><span class=\"user-mention\" data-user-id=\"192821\">@Martin Bellehumeur</span> - any concern with switching back to the response body?</p>\n<h1>Background</h1>\n<p>In <a href=\"https://github.com/HL7/fhircast-docs/pull/303\">PR#303</a>, we updated the Subscription Response from the Hub to return a websocket wss: url via the Content-Location header; however, this causes some issues with web communication patterns in .NET Framework. Basically, when using the Framework HttpClient class and SendAsync, if Content-Location is set on a response, the HttpClient will reset the URI of the request to the value of the Content-Location header (like a redirect). This causes issues when our content location is a \"wss://\" prefixed URI because the HttpClient only accepts \"http://\" or \"https://\" protocols, obviously. There doesn't appear to be a reasonable way to work around this issue with HttpClient, even using a configurable HttpClientHandler.</p>",
        "id": 201029961,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1592320403
    },
    {
        "content": "<p>Hi Isaac, I have no concerns with switching back to the response body.</p>",
        "id": 201368980,
        "sender_full_name": "Martin Bellehumeur (Visage Imaging)",
        "timestamp": 1592559004
    },
    {
        "content": "<p>PR here: <a href=\"https://github.com/HL7/fhircast-docs/pull/333\">https://github.com/HL7/fhircast-docs/pull/333</a> <br>\ncc/ <span class=\"user-mention\" data-user-id=\"194452\">@Bas van den Heuvel</span> , <span class=\"user-mention\" data-user-id=\"196152\">@George Kustas</span> , <span class=\"user-mention\" data-user-id=\"238450\">@Endre Berki</span></p>",
        "id": 209787898,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1599834678
    }
]