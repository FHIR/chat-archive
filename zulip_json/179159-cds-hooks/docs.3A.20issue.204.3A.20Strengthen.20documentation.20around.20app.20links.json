[
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-248372188\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-248372188\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Test Zulip integration...</p>\n</blockquote>",
        "id": 153849940,
        "sender_full_name": "Github Notifications",
        "timestamp": 1474392531
    },
    {
        "content": "<p>It works!</p>",
        "id": 153849941,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1474393098
    },
    {
        "content": "<p>On the first try too! :-)</p>",
        "id": 153849942,
        "sender_full_name": "Kevin Shekleton",
        "timestamp": 1474393689
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-267768133\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-267768133\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Originally I was thinking that SMART app links didn't have to be any special type of link in the CDS card. This is because the EHR has a known registry/whitelist of SMART app launch URLs. Thus, by comparing every CDS card link to this registry, if it was found to be contained within, the EHR could modify the link to add the SMART <code>iss</code> and <code>launch</code> parameters.</p>\n<p>However, I have the following concerns with this approach:</p>\n<p>1. It assumes the EHR has a registry/whitelist of known SMART app launch URLs</p>\n<p>While this is true of the EHR I'm intimately familiar with (Cerner), I don't know that this will hold true for all EHRs. Maintaining such a registry/whitelist is not necessary and in the case of Cerner, is done for business reasons (not due to technical or security reasons).</p>\n<p>Additionally, in the not too distant future I can see where it may not be possible to maintain such a registry/whitelist for certain use cases (like for instance patient's bringing their own SMART app). While our use case of CDS Hooks has been focused on the practitioners in the EHR, I would not be surprised to see us venture into other venues like patients in their personal EHR or patient portal.</p>\n<p>2. It requires the EHR to re-write the card link</p>\n<p>Only the EHR knows the appropriate values for the <code>iss</code> and <code>launch</code> parameters during a SMART app launch. As such, a CDS service can never supply a link to a SMART app that is absolute. Instead, the link must be made 'correct' by the EHR re-writing the link to add the appropriate parameters.</p>\n<hr>\n<p>Based on this, I would like to define a first-class SMART app link within a CDS card. So, either an explicit SMART app launch URL field or some additional attribute on a link indicating that this is a SMART app. The former option is more explicit/clear at the cost of API verbosity where the latter (achieved through something like a <code>type</code> attribute on a link) is terse, but perhaps unnecessarily open-ended.</p>\n<p>Right now I'm leaning towards that latter option of including a <code>type</code> attribute on each link (this is in addition the existing <code>label</code> and <code>url</code> attributes) with a value of <code>smart</code>. Non SMART app links could have a type of <code>absolute</code>.</p>\n<p>I'd appreciate any thoughts from others on this.</p>\n</blockquote>",
        "id": 153863870,
        "sender_full_name": "Github Notifications",
        "timestamp": 1481987971
    },
    {
        "content": "<p>kalyaniyerra <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-269825570\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-269825570\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>I like the option 2 to add the type attribute on each link to specify smart or absolute. This option adds for future extensibility for other types of apps also.</p>\n</blockquote>",
        "id": 153865127,
        "sender_full_name": "Github Notifications",
        "timestamp": 1483134238
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272656049\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272656049\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<blockquote>\n<p>Right now I'm leaning towards that latter option of including a type attribute on each link (this is in addition the existing label and url attributes) with a value of smart. Non SMART app links could have a type of absolute.</p>\n</blockquote>\n<p>After offline conversation with <span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\">@Isaac Vetter</span> (Epic), @kalyaniyerra (Premier), the RxREVU team (Peregrin, Sean, Joel), and Elsevier (Alex DeJong), we decided to proceed with this proposal. This new <code>type</code> field will be required for each link returned in a card.</p>\n<p>When the type is <code>smart</code>, the EHR will be responsible for appending valid and appropriate <code>launch</code> and <code>iss</code> parameters to the URL.</p>\n</blockquote>",
        "id": 153867017,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484430878
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272657673\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272657673\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>I'd appreciate it if another set of eyes could review my proposed documentation changes here: <a href=\"https://github.com/cds-hooks/docs/pull/16\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/16\">https://github.com/cds-hooks/docs/pull/16</a></p>\n</blockquote>",
        "id": 153867064,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484432609
    },
    {
        "content": "<p>jcward10 <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272658011\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272658011\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Can we have a recommendedTarget key? Then, the cds tool can recommend opening the link in an iframe modal or a new tab. </p>\n</blockquote>",
        "id": 153867068,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484432965
    },
    {
        "content": "<p>isaacvetter <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272658360\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272658360\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Hey <span class=\"user-mention\" data-user-email=\"jcward10@gmail.com\">@Jeremy Ward</span>, I'm not sure that the cds tool always knows what the possible targets are for a given EHR. The EHR can be, at least, a desktop, web or mobile app. In two of these three scenario's, an iframe or new tab may not be possible.</p>\n</blockquote>",
        "id": 153867075,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484433323
    },
    {
        "content": "<p>olbrich <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272658718\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272658718\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\">@Isaac Vetter</span> I can see scenarios in which a hook might behave differently depending on the User agent.  For example, a hook might not have enough space to work properly on a mobile browser and thus might suggest that the user should use a desktop web browser to complete their task instead.  I suppose that's why <span class=\"user-mention\" data-user-email=\"jcward10@gmail.com\">@Jeremy Ward</span>'s suggestion is just a recommendation.</p>\n</blockquote>",
        "id": 153867081,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484433636
    },
    {
        "content": "<p>Penumbra69 <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272658939\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272658939\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>We have a similar card-generation capability in house (non-fhir), and in it we have a few fields for rendering the information to a client (we support  mobile, web, and sms).  One is Markdown compatible, One is 140 characters of text, one is HTML (we call it the 'div' field which always is a &lt;div&gt;&lt;/div&gt;).  The renderer can then pluck from the card the rendering it is capable of.  More work to store, more data to pass - but solved the conundrum for us.</p>\n</blockquote>",
        "id": 153867086,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484433858
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272660711\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272660711\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<blockquote>\n<p>Can we have a recommendedTarget key? Then, the cds tool can recommend opening the link in an iframe modal or a new tab.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-email=\"jcward10@gmail.com\">@Jeremy Ward</span> and I had an offline conversation where I explained my thoughts on this but I want to also document them here. To cut to the chase, I agree with <span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\">@Isaac Vetter</span> in that the CDS service isn't the best entity to recommend a target. Even though this would be an optional recommendation, it has the high probability to be a crummy recommendation in which case I don't see a need to add this in the spec.</p>\n<p>The target of the link is based upon the platform and capabilities of the EHR. Eg: mobile native app vs desktop native app vs pure browser. In the case of the Cerner EHR (of which I'm very familiar), we could launch a link (specifically a SMART app) in the following ways:</p>\n<p>- A new browser window<br>\n- Within the current browser window<br>\n- Navigating the user to a different section of the workflow in which the SMART app has already been configured, outside the confines of the CDS card</p>\n<p>In each of these scenarios, the EHR knows best how to open the link and I would ignore any recommendation provided by the CDS service.</p>\n<p>I've seen demos/prototypes of embedded SMART apps in other EHRs and each opened them in a variety of ways (new windows, new iframes opened in a slide over panel, etc).</p>\n<p>For all of these reasons, I don't think we should add a new <code>recommendedTarget</code> field</p>\n</blockquote>",
        "id": 153867112,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484435885
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272662619\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272662619\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>I just merged #16 which resolves this issue. Note - this is a new breaking change to the API.</p>\n<p>If we want to continue the discussion on the sidebar conversation here around link targets we should open a new issue.</p>\n</blockquote>",
        "id": 153867144,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484438101
    },
    {
        "content": "<p>kpshek closed <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>",
        "id": 153867145,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484438101
    },
    {
        "content": "<p>kpshek reopened <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Our documentation around app links needs to be clarified. Questions that the documentation should answer:<br>\n- Are there any expectations that links should always be TLS protected? (https)<br>\n- Do links to SMART apps need any other metadata or identifying information?<br>\n- Are links absolute URLs?<br>\n- Should EHRs open links in a new window? embedded frame? etc.<br>\n- Do we support custom URL schemes? (eg, native links like myapp://)</p>\n</blockquote>",
        "id": 153867450,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484504298
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272713447\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-272713447\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Re-opening this issue. I realized that PR #16 addressed a few aspects of the questions I wanted to answer when I originally logged this issue.</p>\n<blockquote>\n<p>Are there any expectations that links should always be TLS protected? (https)</p>\n</blockquote>\n<p>I plan on updating the documentation to state that TLS protected endpoints are strongly recommended, but not required with <code>absolute</code> links. <code>smart</code> links must be TLS protected as the <a href=\"http://docs.smarthealthit.org/authorization/\" target=\"_blank\" title=\"http://docs.smarthealthit.org/authorization/\">SMART project requires this</a>.</p>\n<blockquote>\n<p>Do links to SMART apps need any other metadata or identifying information?</p>\n</blockquote>\n<p>Answered this with the new <code>smart</code> <code>type</code> field on links.</p>\n<blockquote>\n<p>Are links absolute URLs?</p>\n</blockquote>\n<p>Answered this with the new <code>absolute</code> <code>type</code> field on links.</p>\n<blockquote>\n<p>Should EHRs open links in a new window? embedded frame? etc.</p>\n</blockquote>\n<p>I plan on putting my thoughts above on this topic into the documentation. </p>\n<blockquote>\n<p>Do we support custom URL schemes? (eg, native links like myapp://)</p>\n</blockquote>\n<p>Right now I want to be silent on this until we actually prototype something out. I _think_ this would work with what we have today (this would be an <code>absolute</code> link).</p>\n</blockquote>",
        "id": 153867471,
        "sender_full_name": "Github Notifications",
        "timestamp": 1484504789
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"191355\">@Kevin Shekleton</span> ,</p>\n<blockquote>\n<blockquote>\n<p>Do we support custom URL schemes? (eg, native links like myapp://)<br>\nRight now I want to be silent on this until we actually prototype something out. I _think_ this would work with what we have today (this would be an absolute link).</p>\n</blockquote>\n</blockquote>\n<p>This seems like an unnecessary limitation. I'm pretty sure that there's nothing in the SMART spec that precludes SMART launch apps with uri schemes other than https.  Is this incorrect?</p>\n<p>Definitely, it's worth testing out, but we shouldn't preclude it.</p>\n<p>Isaac</p>",
        "id": 153867482,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1484513982
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191864\">@Isaac Vetter</span> - You are correct. If a SMART app is available over http, it needs to be TLS protected (https). However, SMART apps can be available via custom URI schemes too</p>",
        "id": 153867484,
        "sender_full_name": "Kevin Shekleton",
        "timestamp": 1484515111
    },
    {
        "content": "<p>I'll clarify my issue comment</p>",
        "id": 153867486,
        "sender_full_name": "Kevin Shekleton",
        "timestamp": 1484515126
    },
    {
        "content": "<p>jmandel <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-281458239\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-281458239\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>The other requirement to highlight here, I think, is letting an app finish and *return control back to the EHR* — in our test harness for example we use this capability to link to a hypertension management tool where a user can select a drug, and then return to the EHR and have the UI updated with their choice.</p>\n<p>Right now we do this using a <code>redirect</code> URL: the app's job is to redirect to that URL if/when the user has finished working with the app (e.g. made a final decision); the EHR gets to host whatever content it needs at this URL (e.g. execute a JS function to communicate back with the EHR host window, or execute a server-side process to mark the session as complete).</p>\n</blockquote>",
        "id": 153872985,
        "sender_full_name": "Github Notifications",
        "timestamp": 1487706345
    },
    {
        "content": "<p>vadi2 <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287094965\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287094965\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Another thing that's unclear in the documentation to me is about this <code>redirect</code> url - is the <code>hookInstance</code> supplied back to the EHR, so the EHR knows which decision is complete?</p>\n</blockquote>",
        "id": 153877493,
        "sender_full_name": "Github Notifications",
        "timestamp": 1489678322
    },
    {
        "content": "<p>jmandel <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287180675\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287180675\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Ah. Once control returns to the EHR, the EHR re-invokes the notification using the same <code>hookId</code>, and it's at that point that the external service returns a user's \"decisions\". So as currently specified, the external service needs to retain this state (id + decision) long enough to support the return loop.</p>\n</blockquote>",
        "id": 153877534,
        "sender_full_name": "Github Notifications",
        "timestamp": 1489695974
    },
    {
        "content": "<p>vadi2 <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287282918\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287282918\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Hm... but then if multiple hooks are started at once, the EHR wouldn't know which one is it that came back. I guess the EHR would have to re-try them all and see if decisions are available for them?</p>\n</blockquote>",
        "id": 153877642,
        "sender_full_name": "Github Notifications",
        "timestamp": 1489734494
    },
    {
        "content": "<p>vadi2 <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287288822\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287288822\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>The other way is - I'm not finding anything saying otherwise in the spec - is that the <code>redirect</code> URL supplied by the EHR to begin with would have this <code>hookInstance</code> within it as a parameter, so when the CDS pings it, it would know which is completed.</p>\n<p>I guess I'm looking to see what current implementations, if any, are doing in this regard?</p>\n</blockquote>",
        "id": 153877649,
        "sender_full_name": "Github Notifications",
        "timestamp": 1489736876
    },
    {
        "content": "<p>jmandel <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287353155\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287353155\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>So far, I think the only implementation is our test harness. In the current implementation: the redirect URL is a static URL hosted by the test harness; it's just a page whose job is basically \"find my window.opener and notify them that i'm done; then close me\". But that's an implementation detail...</p>\n<p>It would be possible for the main EHR frame to keep track of which apps it has launched in which child windows (e.g. by generating unique redirect URLs, or tracking metadata about its window objects in JS, or some other mechanism), to prevent re-triggering all services. But that's technically an optimization; it should also be safe to re-trigger all hooks any time a user returns from an app.</p>\n<p>It's certainly an \"open design issue\" to determine what's implementable within real-world EHRs, and this is one of the trickier workflow steps to pull off.</p>\n</blockquote>",
        "id": 153877785,
        "sender_full_name": "Github Notifications",
        "timestamp": 1489757240
    },
    {
        "content": "<p>vadi2 <a href=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287363056\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4#issuecomment-287363056\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/4\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/4\">issue 4</a></p>\n<blockquote>\n<p>Thanks, I suppose I was just looking for someone to say that's an implementation detail as the spec is unclear on this part. Appreciated!</p>\n</blockquote>",
        "id": 153877809,
        "sender_full_name": "Github Notifications",
        "timestamp": 1489759658
    }
]