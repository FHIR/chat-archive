[
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> we are trying to validate against the latest CARIN IG and we are finding  we cannot validate when Data Absence Reason Extension is used.  For example, if we do not have <a href=\"http://patient.name\">patient.name</a>, we would followed: <br>\n{<br>\n  \"resourceType\" : \"Patient\",<br>\n       ...<br>\n       \"name\": [<br>\n         {<br>\n           \"extension\": [<br>\n             {<br>\n               \"url\": \"<a href=\"http://hl7.org/fhir/StructureDefinition/data-absent-reason\">http://hl7.org/fhir/StructureDefinition/data-absent-reason</a>\",<br>\n               \"valueCode\": \"unknown\"<br>\n             }<br>\n           ]<br>\n         }<br>\n       ]<br>\n        \"telecom\" :<br>\n        ...<br>\n     }</p>\n<p>However, when validating against the latest CARIN IG, we get an error stating that <a href=\"http://patient.name\">patient.name</a> is required.  When we validate against USCore, we pass without error.  <br>\nAny suggestions on what may be causing the issue?  Is it an IG problem, validator,  other?  Appreciate some guidance.</p>",
        "id": 210447492,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600375027
    },
    {
        "content": "<p>Does the validator state anything useful?</p>",
        "id": 210448253,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1600375387
    },
    {
        "content": "<ul>\n<li>.. load IG from hl7.fhir.us.carin-bb#0.3.1<br>\n  .. validate [C:\\fhir\\requests\\fhir_resource_20200917T161102.json]<br>\n<em>FAILURE</em> validating C:\\fhir\\requests\\fhir_resource_20200917T161102.json:  error:1 warn:1 info:6<br>\n  Error @ Patient.name[0] (line 25, col18) : us-core-8: Patient.name.given or Patient.name.family or both SHALL be present [family.exists() or given.exists()]<br>\n  Information @ Patient.extension[0] (line 37, col18) : This element does not match any known slice defined in the profile <a href=\"http://hl7.org/fhir/us/carin-bb/StructureDefinition/CARIN-BB-Patient\">http://hl7.org/fhir/us/carin-bb/StructureDefinition/CARIN-BB-Patient</a><br>\n  Information @ Patient.extension[1] (line 48, col18) : This element does not match any known slice defined in the profile <a href=\"http://hl7.org/fhir/us/carin-bb/StructureDefinition/CARIN-BB-Patient\">http://hl7.org/fhir/us/carin-bb/StructureDefinition/CARIN-BB-Patient</a><br>\n  Information @ Patient.extension[2] (line 59, col18) : This element does not match any known slice defined in the profile <a href=\"http://hl7.org/fhir/us/carin-bb/StructureDefinition/CARIN-BB-Patient\">http://hl7.org/fhir/us/carin-bb/StructureDefinition/CARIN-BB-Patient</a><br>\n  Information @ Patient.extension[0] (line 37, col18) : Unknown extension <a href=\"http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category\">http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category</a><br>\n  Information @ Patient.extension[1] (line 48, col18) : Unknown extension <a href=\"http://hl7.org/fhir/us/core/ValueSet/omb-race-category\">http://hl7.org/fhir/us/core/ValueSet/omb-race-category</a><br>\n  Information @ Patient.extension[2] (line 59, col18) : Unknown extension <a href=\"http://hl7.org/fhir/us/core/ValueSet/birthsex\">http://hl7.org/fhir/us/core/ValueSet/birthsex</a><br>\n  Warning @ Patient.identifier[0].type (line 13, col36) : None of the codes provided are in the value set <a href=\"http://hl7.org/fhir/ValueSet/identifier-type\">http://hl7.org/fhir/ValueSet/identifier-type</a> (<a href=\"http://hl7.org/fhir/ValueSet/identifier-type\">http://hl7.org/fhir/ValueSet/identifier-type</a>), and a code should come from this value set unless it has no suitable code) (codes = <a href=\"http://hl7.org/fhir/us/carin-bb/CodeSystem/IdentifierTypeCS#mb\">http://hl7.org/fhir/us/carin-bb/CodeSystem/IdentifierTypeCS#mb</a>)</li>\n</ul>",
        "id": 210452191,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600377234
    },
    {
        "content": "<p>I am having my team go back and confirm which IG they are validating against.  Looks like you, <span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> ,  addressed a similar issue here:  <a href=\"#narrow/stream/204607-CARIN-IG.20for.20Blue.20Button.C2.AE/topic/Validating.20with.20the.20CI.20IG\">https://chat.fhir.org/#narrow/stream/204607-CARIN-IG.20for.20Blue.20Button.C2.AE/topic/Validating.20with.20the.20CI.20IG</a></p>",
        "id": 210458641,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600381241
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> I looked at the StructureDefintion and cannot find data-absent, data absent, or data absence in any profile.  Is there something I am missing?<br>\nI would have thought that I'd find at least something similar to:<br>\nhuman\" : \"If there is no component or hasMember element then either a value[x] or a data absent reason must be present.\",<br>\n            \"expression\" : \"(component.empty() and hasMember.empty()) implies (dataAbsentReason.exists() or value.exists())\",<br>\n            \"xpath\" : \"f:component or f:memberOF or f:*[starts-with(local-name(.), 'value')] or f:dataAbsentReason\",<br>\nAm I over thinking here?  Appreciate any feedback.</p>",
        "id": 210573825,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600462257
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197108\">@Jason Teeple</span>  I don’t think you will find it in an IG. I think it is a general mechanism for flagging a reason for missing data.  Search on data absent reason extension.  I’m trying to find a coherent description. When I do I’ll post it here.</p>",
        "id": 210575480,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1600463247
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> If you look at the structure definition, you should find the mechanism.  For example, take a look either of these USCore Profiles: <a href=\"http://hl7.org/fhir/us/core/StructureDefinition-us-core-patient.json.html\">http://hl7.org/fhir/us/core/StructureDefinition-us-core-patient.json.html</a> <a href=\"http://hl7.org/fhir/us/core/StructureDefinition-pediatric-bmi-for-age.json.html\">http://hl7.org/fhir/us/core/StructureDefinition-pediatric-bmi-for-age.json.html</a> <br>\nSearch data-absent and you will see what I am referencing.<br>\nI am not finding similar concepts within the CARIN Patient Structure Definition or any other resource Structure Definition.</p>",
        "id": 210588877,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600475855
    },
    {
        "content": "<p>US Core decided to allow omitting required fields using dataAbsentReason - see <a href=\"https://www.hl7.org/fhir/us/core/general-guidance.html#must-support\">https://www.hl7.org/fhir/us/core/general-guidance.html#must-support</a></p>",
        "id": 210589911,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1600477403
    },
    {
        "content": "<p>That does not mean that the CARIN IG has to do the same - and doing that would not be fixing a validation problem but a material change in the implementation guide</p>",
        "id": 210589975,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1600477478
    },
    {
        "content": "<p>Da Vinci expects to explicitly expose DAR in their IGs where they feel it must be supported - and don't allow its use for mandatory elements where we haven't explicitly enabled it - because there are some mandatory elements where it genuinely makes no sense to send the instance unless the value is present.  As well, we don't mark elements as mandatory unless we genuinely expect them to <em>always</em> be present, not just \"really ought to be present\".</p>",
        "id": 210590573,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1600478417
    },
    {
        "content": "<p>However, for anything we inherit from US Core, the US Core rules apply - we can't override those.</p>",
        "id": 210590584,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1600478435
    },
    {
        "content": "<p>The CARIN IG states: If the source system does not have data for a Must Support data element with minimum cardinality = 0, the data element is omitted from the resource. If the source system does not have data for a required data element (in other words, where the minimum cardinality is &gt; 0), follow guidance defined in the core FHIR specification and summarized in the US Core.<br>\n<a href=\"http://build.fhir.org/ig/HL7/carin-bb/Guidance.html#missing-data\">http://build.fhir.org/ig/HL7/carin-bb/Guidance.html#missing-data</a></p>",
        "id": 210610384,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600514786
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/204607-CARIN-IG.20for.20Blue.20Button.C2.AE/topic/Validation.20Issues/near/210590584\">said</a>:</p>\n<blockquote>\n<p>However, for anything we inherit from US Core, the US Core rules apply - we can't override those.</p>\n</blockquote>\n<p>I could be misunderstanding, but it looks like <a href=\"http://Patient.name\">Patient.name</a> did not inherit the USCore rules.  <br>\n<a href=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.json.html\">https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.json.html</a><br>\n<a href=\"http://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-C4BB-Patient.profile.json.html\">http://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-C4BB-Patient.profile.json.html</a></p>",
        "id": 210610854,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600515557
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191912\">Michele Mottini</span> <a href=\"#narrow/stream/204607-CARIN-IG.20for.20Blue.20Button.C2.AE/topic/Validation.20Issues/near/210589975\">said</a>:</p>\n<blockquote>\n<p>That does not mean that the CARIN IG has to do the same - and doing that would not be fixing a validation problem but a material change in the implementation guide</p>\n</blockquote>\n<p>Since the CARIN IG states rules for missing data, wouldn't the structure definitions need to be updated? Validating against the structure definition and using the DAR rules consistent with the CARIN IG definition would expose validation issues, would it not?</p>",
        "id": 210611181,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600516003
    },
    {
        "content": "<p>mustSupport can't be validated by looking at an instance, only by looking at system behavior (was the element stored, was it displayed, is it possible to capture it, etc.)  I see <a href=\"http://patient.name\">patient.name</a> marked as mustSupport in the BB profile.  The descriptive rules around mustSupport are in the text of the US-Core IG - and are inherited by reference.  They don't appear in the actual profiles.</p>",
        "id": 210617251,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1600524858
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/204607-CARIN-IG.20for.20Blue.20Button.C2.AE/topic/Validation.20Issues/near/210617251\">said</a>:</p>\n<blockquote>\n<p>mustSupport can't be validated by looking at an instance, only by looking at system behavior (was the element stored, was it displayed, is it possible to capture it, etc.)  I see <a href=\"http://patient.name\">patient.name</a> marked as mustSupport in the BB profile.  The descriptive rules around mustSupport are in the text of the US-Core IG - and are inherited by reference.  They don't appear in the actual profiles.</p>\n</blockquote>\n<p>I am not connecting what you are saying.  Why would rules inherited from profile A, not  appear in profile B; specifically within the structure definition?  </p>\n<p>We have data mapped, there are instances when there is a MustSupport/Required (Support flag + 1...1/1...*) and the data is available.  However, there are also instances when the data may not be available (happens more than folks like to admit).  When the data is not available, we follow the rules outlined in USCore for Missing Data.  </p>\n<p>Using the ONC FHIR Validator (<a href=\"https://inferno.healthit.gov/validator/\">https://inferno.healthit.gov/validator/</a>), advanced options, I load a standalone profile (<a href=\"http://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-C4BB-Patient.profile.json.html\">http://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-C4BB-Patient.profile.json.html</a>) and input my resource to validate. If, for example, my Patient profile has a DAR for <a href=\"http://Patient.name\">Patient.name</a>,  validating against CARIN 4 BB, I will get an error.  However, if I take my same resource and validate against <a href=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.json.html\">https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.json.html</a>, I will not get an error.  </p>\n<p>If CARIN 4BB inherits rules from USCore, then the rules are not applied during validation.</p>",
        "id": 210628616,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600540443
    },
    {
        "content": "<p>The mustSupport declartions from the base profile <em>are</em> inherited.  The descriptive language explaining how mustSupport works in US Core aren't declared in profiles, they're declared in IG text - and there's no inheritance mechanism for that.  However, it applies none-the-less.</p>",
        "id": 210645896,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1600569827
    },
    {
        "content": "<p>The validator totally ignores mustSupport.  It has nothing to do with DAR and has nothing to do with instance validation.  mustSupport is all about system capability, not instances.</p>",
        "id": 210645938,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1600569874
    },
    {
        "content": "<p>We are focusing on the wrong part of my concern.   <br>\nI am more focused on DAR than mustSupport. I understand that mustSupport is system capability, and not instance. <br>\nLet me rephrase my questions: <br>\n(1) How should DAR be represented in the IG , profile, and structure definition?<br>\n(2) How should the appropriate use of DAR be validated?<br>\n(3) Can DAR be validate using a validator?<br>\n<a href=\"https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator\">https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator</a> <br>\n<a href=\"http://inferno.healthit.gov/validator/\">http://inferno.healthit.gov/validator/</a></p>\n<p>CARIN BB states when DAR should be applied, required 1...1 / 1...* and follow USCore Guidance. <br>\nUsing the ONC FHIR Validator (<a href=\"https://inferno.healthit.gov/validator/\">https://inferno.healthit.gov/validator/</a>), advanced options, I load a standalone profile (<a href=\"http://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-C4BB-Patient.profile.json.html\">http://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-C4BB-Patient.profile.json.html</a>) and input my resource to validate. If, for example, my Patient resource has a DAR for <a href=\"http://Patient.name\">Patient.name</a>, validating against CARIN 4 BB, I will get an error. However, if I take the same Patient resource and validate against <a href=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.json.html\">https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.json.html</a>, I will not get an error.</p>",
        "id": 210661650,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600600284
    },
    {
        "content": "<ol>\n<li>By default, DAR is allowed everywhere unless there are explicit constraints against it.  </li>\n<li>Making individual constraints against it is a huge amount of work, so if there are going to be constraints, they'll typically be expressed in text and not enforced in the profile.  (You could create a global prohibition with an invariant, but if you're going to allow its use anywhere, then the prohibition needs to enumerate all the allowed places, which quickly becomes untenable. )  So, in general, the best that can be done is declaring DAR in those places you expect it to be used and creating invariants that require it when a value is absent (and disallow it when a value is present)</li>\n<li>What's described in #2 can be done.  However, prohibiting DAR in those places where you don't want it will be quite challenging.</li>\n</ol>",
        "id": 210667066,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1600608354
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>, this helps immensely.  Including <span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> b/c he was asking a similar question in another stream.</p>",
        "id": 210668554,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1600610881
    },
    {
        "content": "<p>Thx <span class=\"user-mention\" data-user-id=\"197108\">@Jason Teeple</span>  and <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> .</p>\n<p>Would be very helpful if everything in <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  description above was documented somewhere...  is it?  One intelligent reader (<span class=\"user-mention\" data-user-id=\"195707\">@Jason Teeple</span> ) and another reader (me) couldn’t figure it out by searching the FHIR documentation.</p>",
        "id": 210689346,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1600642403
    },
    {
        "content": "<p>DAR isn't documented specially, because it's not special.  It's an extension like any other.</p>",
        "id": 210689391,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1600642448
    },
    {
        "content": "<p>I suspect DAR has the potential to be an abused extension if the intended usage is not well documented.</p>",
        "id": 212764555,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1602202091
    },
    {
        "content": "<p>There are lots of extensions that could be sent in place of a value - for a variety of reasons.  Any of those could be abused - and some extensions could be created with the sole objective of bypassing a required element and not doing anything else at all.  Placing additional documentation around DAR isn't going to prevent that issue.</p>",
        "id": 212782335,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1602217643
    }
]