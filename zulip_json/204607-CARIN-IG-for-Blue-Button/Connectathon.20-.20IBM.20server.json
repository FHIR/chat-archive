[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192632\">@Paul Bastide</span> I see your end point in the tracking spreadsheet, but how one does register a client app? Are there available patient logins?</p>",
        "id": 209653371,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599748279
    },
    {
        "content": "<p>We have one app registered called inferno with no secret</p>",
        "id": 209655374,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1599748809
    },
    {
        "content": "<p>OK - how do I register our app?</p>",
        "id": 209655465,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599748838
    },
    {
        "content": "<p><del>feel free to use basic auth - fhiruser/change-password to act on behalf of Patient1</del> Lee corrected me, that's just for auth.</p>",
        "id": 209655468,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1599748839
    },
    {
        "content": "<p>I have a client app that uses SMART - OAuth2 code flow - no way to register it?</p>",
        "id": 209655723,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599748916
    },
    {
        "content": "<p>I think you can register it at the endpoint advertised in the conformance and smart-configuration.  We're pretty new to that part though, I think I've only ever done it via a token</p>",
        "id": 209656191,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599749072
    },
    {
        "content": "<p>if unauthenticated client registration isn't working, i can generate a token that will allow you to register the app</p>",
        "id": 209656644,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599749232
    },
    {
        "content": "<p>Let me try...</p>",
        "id": 209657523,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599749526
    },
    {
        "content": "<p>also I've only done it through inferno...let me go there and steal some sample requests</p>",
        "id": 209657666,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599749588
    },
    {
        "content": "<p>Tried POST:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n      &quot;redirect_uris&quot;: [\n        &quot;https://myfhr.careevolution.com/cfhrprovideraccounts/redirecttarget&quot;,\n        &quot;http://localhost/WebClientTest.Adapter1.WebClient/cfhrprovideraccounts/redirecttarget&quot;,\n        &quot;http://localhost:64531/WebClient/cfhrprovideraccounts/redirecttarget&quot;\n      ],\n      &quot;client_name&quot;: &quot;CareEvolution&quot;,\n      &quot;token_endpoint_auth_method&quot;: &quot;client_secret_basic&quot;\n     }\n</code></pre></div>",
        "id": 209658274,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599749779
    },
    {
        "content": "<p>Got 403 Forbidden:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;error&quot;: &quot;insufficient_scope&quot;,\n    &quot;error_description&quot;: &quot;Policy &#39;Trusted Hosts&#39; rejected request to client-registration service. Details: Host not trusted.&quot;\n}\n</code></pre></div>",
        "id": 209658327,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599749798
    },
    {
        "content": "<p>Mhh ... probably the <code>http://localhost</code></p>",
        "id": 209658385,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599749826
    },
    {
        "content": "<p>No, even removing those it did not like it</p>",
        "id": 209658486,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599749861
    },
    {
        "content": "<p>ok, mind trying it with this access key then?</p>\n<div class=\"codehilite\"><pre><span></span><code>eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJmODVmN2ZiZS0yMGM1LTRlMTEtYmQ4Yi03MzgzZmQyNmU4Y2IifQ.eyJleHAiOjE1OTk5MjIwOTQsImlhdCI6MTU5OTc0OTI5NCwianRpIjoiY2NjNGYxODYtNTgxOC00MjFjLWFhYWQtYWU1YzUyNTJmOGUzIiwiaXNzIjoiaHR0cHM6Ly9jbHVzdGVyMS01NzM4NDYtMjUwYmFiYmJlNGMzMDAwZTE1NTA4Y2QwN2MxZDI4MmItMDAwMC51cy1lYXN0LmNvbnRhaW5lcnMuYXBwZG9tYWluLmNsb3VkL2F1dGgvcmVhbG1zL21hc3RlciIsImF1ZCI6Imh0dHBzOi8vY2x1c3RlcjEtNTczODQ2LTI1MGJhYmJiZTRjMzAwMGUxNTUwOGNkMDdjMWQyODJiLTAwMDAudXMtZWFzdC5jb250YWluZXJzLmFwcGRvbWFpbi5jbG91ZC9hdXRoL3JlYWxtcy9tYXN0ZXIiLCJ0eXAiOiJJbml0aWFsQWNjZXNzVG9rZW4ifQ.N6I9is-PYxXM7beH0ePwCbmCFDxSlvggkUGBAXeXX3Y\n</code></pre></div>",
        "id": 209658797,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599749980
    },
    {
        "content": "<p>As a bearer auth token ?</p>",
        "id": 209659100,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599750087
    },
    {
        "content": "<p>Yep</p>",
        "id": 209659147,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599750108
    },
    {
        "content": "<p>It worked, thanks</p>",
        "id": 209659222,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599750126
    },
    {
        "content": "<p>shoot, I think I have one more thing to do for this to start working with our fhir server though (currently its only trusting the keycloak client).  fun times :-)</p>",
        "id": 209659981,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599750386
    },
    {
        "content": "<p>you should be able to get the bearer token via smart app launch now though, so do let us know if you have trouble with that</p>",
        "id": 209660109,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599750444
    },
    {
        "content": "<p>Got to the auth screen, which credential can I use?</p>",
        "id": 209661625,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599750964
    },
    {
        "content": "<p>fhiruser/change-password should work</p>",
        "id": 209661719,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1599750983
    },
    {
        "content": "<p>ah sorry, I though that was a url</p>",
        "id": 209661863,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599751010
    },
    {
        "content": "<p>Logged in fine, but FHIR requests all fail with 403.....but that was what Lee was saying  I guess?</p>",
        "id": 209662288,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599751157
    },
    {
        "content": "<p>' one more thing to do '</p>",
        "id": 209662311,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599751170
    },
    {
        "content": "<p>yep :-)</p>",
        "id": 209662335,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599751179
    },
    {
        "content": "<p>sadly lots going on (per usual in connectathon).  i will ping you when i figured this out</p>",
        "id": 209662438,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599751205
    },
    {
        "content": "<p>No problem</p>",
        "id": 209662471,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599751217
    },
    {
        "content": "<p>Also: there is a problem with the CapabilityStatement: the SMART URLs should be URIs not URLs, ie in </p>\n<div class=\"codehilite\"><pre><span></span><code>                &quot;extension&quot;: [\n                    {\n                        &quot;extension&quot;: [\n                            {\n                                &quot;url&quot;: &quot;token&quot;,\n                                &quot;valueUrl&quot;: &quot;https://cluster1-573846-250babbbe4c3000e15508cd07c1d282b-0000.us-east.containers.appdomain.cloud/auth/realms/master/protocol/openid-connect/token&quot;\n                            },\n                            {\n                                &quot;url&quot;: &quot;authorize&quot;,\n                                &quot;valueUrl&quot;: &quot;https://cluster1-573846-250babbbe4c3000e15508cd07c1d282b-0000.us-east.containers.appdomain.cloud/auth/realms/master/protocol/openid-connect/auth&quot;\n                            },\n                            {\n                                &quot;url&quot;: &quot;register&quot;,\n                                &quot;valueUrl&quot;: &quot;https://cluster1-573846-250babbbe4c3000e15508cd07c1d282b-0000.us-east.containers.appdomain.cloud/auth/realms/master/clients-registrations/openid-connect&quot;\n                            }\n                        ],\n                        &quot;url&quot;: &quot;http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris&quot;\n                    }\n</code></pre></div>\n\n\n<p>the values should be <code>valueUri</code> not <code>valueUrl</code> - see <a href=\"http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#declaring-support-for-oauth2-endpoints\">http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#declaring-support-for-oauth2-endpoints</a></p>",
        "id": 209667761,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599753279
    },
    {
        "content": "<p>Thanks, I can clean that up</p>",
        "id": 209667888,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1599753326
    },
    {
        "content": "<p>I created an issue - <a href=\"https://github.com/IBM/FHIR/issues/1496\">https://github.com/IBM/FHIR/issues/1496</a> (FYI) - I'll raise a PR for it in a few minutes (thanks again)</p>",
        "id": 209668468,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1599753538
    },
    {
        "content": "<p>Thank you (it is pretty subtle, it took my a while to figure out why our client was not loading them...)</p>",
        "id": 209668860,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599753684
    },
    {
        "content": "<p>it is - and thank you</p>",
        "id": 209669574,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1599753969
    },
    {
        "content": "<p>Nice, yeah -- as a matter of historical interest, at the time we introduced this discovery mechanism <code>valueUrl</code> did not exist :-)</p>",
        "id": 209672529,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599755280
    },
    {
        "content": "<p>(on the plus side <a href=\"https://cluster1-573846-250babbbe4c3000e15508cd07c1d282b-0000.us-east.containers.appdomain.cloud/fhir-server/api/v4/.well-known/smart-configuration\">https://cluster1-573846-250babbbe4c3000e15508cd07c1d282b-0000.us-east.containers.appdomain.cloud/fhir-server/api/v4/.well-known/smart-configuration</a> avoids this particular issue ;-))</p>",
        "id": 209672780,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599755369
    },
    {
        "content": "<p>finally think i got this working for the dynamically-registerred clients</p>",
        "id": 209715034,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599775183
    },
    {
        "content": "<p>Yep, it works - here is your data in our app:</p>\n<p><a href=\"/user_uploads/10155/U9wmqL3kxFLUnhOqNHHCoSVl/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/U9wmqL3kxFLUnhOqNHHCoSVl/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/U9wmqL3kxFLUnhOqNHHCoSVl/image.png\"></a></div>",
        "id": 209715572,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599775496
    },
    {
        "content": "<p>One note: your are using <code>http://terminology.hl7.org/CodeSystem/claim-type</code> instead of <code>http://hl7.org/fhir/us/carin/CodeSystem/carin-bb-claim-type</code> for <code>ExplanationOfBenefit.type.coding.system</code></p>",
        "id": 209715723,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599775593
    },
    {
        "content": "<p>thanks, i updated our conformance artifacts to the latest version today but havn't updated the sample data yet</p>",
        "id": 209715772,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599775640
    },
    {
        "content": "<p>let me give that a go</p>",
        "id": 209715779,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599775643
    },
    {
        "content": "<p>ok, the sample data should be revved now too (with the alterations mentioned at <a href=\"#narrow/stream/204607-CARIN-IG.20for.20Blue.20Button.C2.AE/topic/Examples.20from.20Connectathon\">https://chat.fhir.org/#narrow/stream/204607-CARIN-IG.20for.20Blue.20Button.C2.AE/topic/Examples.20from.20Connectathon</a>)</p>",
        "id": 209716994,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599776467
    },
    {
        "content": "<p>Mhhh...seeing the same system for the type</p>",
        "id": 209717307,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599776700
    },
    {
        "content": "<p>Also: there are three ExplanationOfBenefit with the same identifier, that I think is wrong</p>",
        "id": 209717958,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599777188
    },
    {
        "content": "<p>...but maybe that _is_ the correct system? <code>http://hl7.org/fhir/us/carin/CodeSystem/carin-bb-claim-type</code> is not longer in the current build</p>",
        "id": 209728002,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599786449
    },
    {
        "content": "<p>yep, sure seems right to me<br>\n<a href=\"/user_uploads/10155/X6LYVc25g5Wm5NbmlgNHsX1h/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/X6LYVc25g5Wm5NbmlgNHsX1h/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/X6LYVc25g5Wm5NbmlgNHsX1h/image.png\"></a></div>",
        "id": 209769574,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599824389
    },
    {
        "content": "<p>even right in the parent: <a href=\"https://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-C4BB-ExplanationOfBenefit.html\">https://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-C4BB-ExplanationOfBenefit.html</a> has a required binding to <a href=\"http://hl7.org/fhir/R4/valueset-claim-type.html\">http://hl7.org/fhir/R4/valueset-claim-type.html</a></p>",
        "id": 209769658,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599824431
    },
    {
        "content": "<blockquote>\n<p>Also: there are three ExplanationOfBenefit with the same identifier, that I think is wrong</p>\n</blockquote>\n<p>I simply uploaded the examples from the specification.  I agree its strange that 3 of them have the same identifier.  I can update them to be different</p>",
        "id": 209770035,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599824740
    },
    {
        "content": "<p>Yes, we based our code on the released version of the implementation guide: <a href=\"http://hl7.org/fhir/us/carin-bb/2020Feb/StructureDefinition-CARIN-BB-ExplanationOfBenefit.html\">http://hl7.org/fhir/us/carin-bb/2020Feb/StructureDefinition-CARIN-BB-ExplanationOfBenefit.html</a> and not on the current build, and so we use / expect the  <code>http://hl7.org/fhir/us/carin/CodeSystem/carin-bb-claim-type</code> system</p>",
        "id": 209772583,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599826636
    },
    {
        "content": "<blockquote>\n<p>I can update them to be different</p>\n</blockquote>\n<p>That would be good - our client thinks they are the same claim and overwrites them, so we end up with 2 instead of 4</p>",
        "id": 209772685,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599826695
    },
    {
        "content": "<p>done</p>",
        "id": 209773071,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599826938
    },
    {
        "content": "<blockquote>\n<p>we based our code on the released version of the implementation guide</p>\n</blockquote>\n<p>yes, we were on that too until about a week ago :-)<br>\ni think you know but thats not really a \"released\" version, just a ballot snapshot.</p>",
        "id": 209773109,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599826979
    },
    {
        "content": "<p>No, I did not know (those distinctions are somewhat hazy for me)</p>",
        "id": 209773589,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599827245
    },
    {
        "content": "<p>ok, yeah, CARIN BB is still pre-release, so not even an STU1 yet</p>",
        "id": 209774574,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1599827838
    },
    {
        "content": "<p>I fetched the data again and now I have all four claims, thanks <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span></p>",
        "id": 209803611,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599841802
    }
]