[
    {
        "content": "<p>We're leveraging AWS KMS to create the necessary asymmetric key in order to sign the smart card. How can I go from this:</p>\n<p>-----BEGIN PUBLIC KEY-----<br>\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEVo94oTHAMQIFSajYapXtx7WzuoY7<br>\n8WHnDPtREwrTbT3BIRK6vKUdFIq+FRiyrHtaYnOgoba7yLrT3aWggXIggw==<br>\n-----END PUBLIC KEY-----</p>\n<p>to this format:</p>\n<p>{<br>\n  \"kty\": \"EC\",<br>\n  \"use\": \"sig\",<br>\n  \"crv\": \"P-256\",<br>\n  \"kid\": \"1234\",<br>\n  \"x\": \"oBUyo8CQAFPeYPvv78ylh5MwFZjTCLQeb042TjiMJxE=\",<br>\n  \"y\": \"vvQyxZkUjJQUPU/0bCy3Pj5qQdfu8jwEfqEeYGZ95CU=\",<br>\n  \"alg\": \"ES256\"<br>\n}</p>\n<p>Also, is it possible to generate the sha256 _public_ key fingerprint or would I need the private key to do so?</p>\n<p>Thanks</p>",
        "id": 237251770,
        "sender_full_name": "Stephen Whitney",
        "timestamp": 1620088660
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"179170\" href=\"/#narrow/stream/179170-smart/topic/Public.20key\">#smart &gt; Public key</a> by <span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span></p>",
        "id": 237253091,
        "sender_full_name": "Notification Bot",
        "timestamp": 1620089750
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 237253156,
        "sender_full_name": "Stephen Whitney",
        "timestamp": 1620089785
    },
    {
        "content": "<p>The sha256 thumbprint can be calculated from the public JWK alone. To get a JWK the keywords you want are: \"convert from PEM to JWK\".</p>",
        "id": 237253175,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1620089810
    },
    {
        "content": "<p>Depending on your language of choice, <a href=\"https://www.jvt.me/posts/2019/01/10/x509-pkcs8-pem-key-to-jwks-node/\">https://www.jvt.me/posts/2019/01/10/x509-pkcs8-pem-key-to-jwks-node/</a> may be a helpful tutorial</p>",
        "id": 237253267,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1620089885
    },
    {
        "content": "<p>Sweet! Output:<br>\n{<br>\n    \"keys\": [<br>\n        {<br>\n            \"kty\": \"EC\",<br>\n            \"kid\": \"HEEpaVqRJ8y4OCE7BKnqEPo-eCz44JpF_quM609TRDw\",<br>\n            \"crv\": \"P-256\",<br>\n            \"x\": \"Tg3UZ-kOp8kZV_okaO_MaEGzLfPykGoKTvCW-3hZT2A\",<br>\n            \"y\": \"PconlrnIFK6Jh_cA1ejeaQ5AuQ4rDAJ-KiZY4TX7vdE\"<br>\n        }<br>\n    ]<br>\n}</p>\n<p>Is this sufficient to add to .well-known/jwks.json?</p>\n<p>Thanks again <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 237255277,
        "sender_full_name": "Stephen Whitney",
        "timestamp": 1620091504
    },
    {
        "content": "<p>Looks pretty good, though it's missing <code>alg</code> and <code>use</code> -- the validation SDK at <a href=\"https://smarthealth.cards/#what-testing-tools-are-available-to-validate-smart-health-cards-implementations\">https://smarthealth.cards/#what-testing-tools-are-available-to-validate-smart-health-cards-implementations</a> will review this for you in detail.</p>",
        "id": 237257451,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1620093334
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"269724\">Stephen Whitney</span> <a href=\"#narrow/stream/284830-smart.2Fhealth-cards/topic/Public.20key/near/237251770\">said</a>:</p>\n<blockquote>\n<p>Also, is it possible to generate the sha256 _public_ key fingerprint or would I need the private key to do so?</p>\n</blockquote>\n<p>The key fingerprint <code>kid</code> only depends on the fields <code>crv</code>, <code>kty</code>, <code>x</code>, and <code>y</code> (see <a href=\"https://tools.ietf.org/html/rfc7638#section-3.2\">section 3.2 of RFC7638</a>), so you can generate this from the public key.  What platform/ language are you using for development? There should be a library handy to convert a PEM-formatted key into a JWK, and also calculate the <code>kid</code>.</p>",
        "id": 237322822,
        "sender_full_name": "Christian Paquin",
        "timestamp": 1620134664
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"385047\">Christian Paquin</span> <a href=\"#narrow/stream/284830-smart.2Fhealth-cards/topic/Public.20key/near/237322822\">said</a>:</p>\n<div class=\"codehilite\"><pre><span></span><code>The key fingerprint `kid` only depends on the fields `crv`, `kty`, `x`, and `y` (see [section 3.2 of RFC7638](https://tools.ietf.org/html/rfc7638#section-3.2)), so you can generate this from the public key.  What platform/ language are you using for development? There should be a library handy to convert a PEM-formatted key into a JWK, and also calculate the `kid`.\n</code></pre></div>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"385047\">@Christian Paquin</span>. We're using python as our development language. I'm not sure python-jose or pyjwt will convert PEM-formatted key into a JWK so I used Node as mentioned by Josh to generate the JWK outside of our codebase.</p>",
        "id": 237335144,
        "sender_full_name": "Stephen Whitney",
        "timestamp": 1620138979
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"365368\">@James Kizer</span> or <span class=\"user-mention\" data-user-id=\"391350\">@Alan Viars</span>  may be able to point to some reference code in python as well. We should create a wiki page with links to these kinds of reference examples, because I think people find them pretty helpful.</p>",
        "id": 237336518,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1620139460
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> <a href=\"#narrow/stream/284830-smart.2Fhealth-cards/topic/Public.20key/near/237336518\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"365368\">James Kizer</span> or <span class=\"user-mention silent\" data-user-id=\"391350\">Alan Viars</span>  may be able to point to some reference code in python as well. We should create a wiki page with links to these kinds of reference examples, because I think people find them pretty helpful.</p>\n</blockquote>\n<p>Here is my fork of James' code: <a href=\"https://github.com/TransparentHealth/healthcards_python_sample_scripts\">https://github.com/TransparentHealth/healthcards_python_sample_scripts</a>   The only changes I made were: 1. to make this pip installable,  2.make scripts get installed as scripts, 3.) to make shc a package module for easy import.  I see I should update the README too.  To install with pip just type \"pip install shc\".  The code in each files \"def main():\" should provide adequate examples for use.  I made the pip/package so I could do a simple import into my Django-based implementation.</p>",
        "id": 237355825,
        "sender_full_name": "Alan Viars",
        "timestamp": 1620145416
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> <a href=\"#narrow/stream/284830-smart.2Fhealth-cards/topic/Public.20key/near/237336518\">said</a>:</p>\n<div class=\"codehilite\"><pre><span></span><code>We should create a wiki page with links to these kinds of reference examples ...\n</code></pre></div>\n<p><a href=\"https://confluence.hl7.org/display/PHWG/SMART+Health+Cards+Implementation+Tools\">https://confluence.hl7.org/display/PHWG/SMART+Health+Cards+Implementation+Tools</a> added</p>",
        "id": 237361893,
        "sender_full_name": "Paul Denning",
        "timestamp": 1620147725
    }
]