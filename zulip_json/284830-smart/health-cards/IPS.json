[
    {
        "content": "<p>If you'd like to convert an IPS to a SHC, you can do this:</p>\n<ul>\n<li>\n<p>Post your IPS as a transaction to <a href=\"http://test.fhir.org/r4\">http://test.fhir.org/r4</a> (web workaround: go to that address in your browser, paste the IPS into the text box at the bottom of the page, and choose 'upload')</p>\n</li>\n<li>\n<p>observe the id of the patient created (look at the id of the second resource in the response)</p>\n</li>\n<li>\n<p>fetch a healthcare card for the patient created (web workaround: <a href=\"http://test.fhir.org/r4/Patient/[id]/$health-cards-issue?credentialType=https://smarthealth.cards%23health-card\">http://test.fhir.org/r4/Patient/[id]/$health-cards-issue?credentialType=https://smarthealth.cards%23health-card</a>)</p>\n</li>\n</ul>\n<p>bingo, you have yourself an SHC generated from the IPS.</p>",
        "id": 253167603,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631570480
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/vI29vURGRkY55Hxv5mJ5XTvO/qr.png\">qr.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/vI29vURGRkY55Hxv5mJ5XTvO/qr.png\" title=\"qr.png\"><img src=\"/user_uploads/10155/vI29vURGRkY55Hxv5mJ5XTvO/qr.png\"></a></div>",
        "id": 253167673,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631570514
    },
    {
        "content": "<p>That was generated from <span class=\"user-mention\" data-user-id=\"191364\">@Peter Jordan</span>'s sample IPS. It's necessary that the IPS has immunizations coded with one of the valid SHC coding systems, or it will be ignored.</p>",
        "id": 253167766,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631570545
    },
    {
        "content": "<p>There's a piece of functionality that IPS has that SHC doesn't, and maybe it should. In IPS, you can say, 'the patient hasn't had this type of vaccination'. It seems to me like that would be an edge case for covid certs</p>",
        "id": 253167842,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631570597
    },
    {
        "content": "<p>The payload below is what I get when I scan the QR code. It looks like it is missing the <code>shc:/</code> header in the payload.</p>\n<p><code>56762959532654603460292540772804336028702865676754222809286237253760287028647167452228092862676756640775452733594526440840395570532363315424440541063307566255713324083245655533382608634305290341261266314211605736010841353153717074243574414406734158062960381252755236356224593774032473582003427131374511262236630420060310040630532733280565082055557255065627326227662109390503322837745370713842542541543776623009741071537071301204712237644410585971715305673361416139454321293021125843200828103935761068655752000822743376254445225433571023125460617443375027633405246505045609733207670604732558063640342636602735456658725568350639544028366830036900601112285254654153703028607671611234296756444575750934066621230825115271052136653069654560370460636023267645242227032865405765105561564010392512076223365620003252031109375209624220695977556677663840086625596105706155074256032333746929052477423462653435502574295204056405063455736233580665345068655936567337762111116857562159122465415068703226221160446231283606560539107522337131540368385054402704327138565964236872343930263440674555123052537337223538356875452050335977722254286261606172613643314300637168386236767024303353743461033856675737347068450306343362387353275854554455725856107364094464622543504075236900640336657573092576642864662807773539122120013640353324066836417245085630285374357774583227762063215065392358312635271211773921672108066223247441325011405945312744260420631070113554766571773054645372536058663359127474</code></p>",
        "id": 253248207,
        "sender_full_name": "Daniel Lee",
        "timestamp": 1631625443
    },
    {
        "content": "<p>When I do manually add the header though it becomes valid and I'm able to decode the bundle.</p>",
        "id": 253248524,
        "sender_full_name": "Daniel Lee",
        "timestamp": 1631625566
    },
    {
        "content": "<p>mine? oh?</p>",
        "id": 253269072,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631632593
    },
    {
        "content": "<p>I got the same (no \"shc:/\") when scanned using the IOS shortcut that Josh pointed out in <a href=\"#narrow/stream/284830-smart.2Fhealth-cards/topic/iPhone.20camera.20No.20Usable.20Data/near/239810439\">https://chat.fhir.org/#narrow/stream/284830-smart.2Fhealth-cards/topic/iPhone.20camera.20No.20Usable.20Data/near/239810439</a></p>",
        "id": 253270555,
        "sender_full_name": "Paul Denning",
        "timestamp": 1631633125
    },
    {
        "content": "<p>weird. my code is definitely feeding shc:/ in at the start</p>",
        "id": 253270971,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631633290
    },
    {
        "content": "<p>ok, so this is something that actually confused me. The spec says:</p>\n<blockquote>\n<p>When embedding a JWS string in QR codes, the JWS string SHALL be encoded as Numerical Mode QR codes consisting of the digits 0-9</p>\n</blockquote>\n<p>So I turned numeric mode on the QRCode library I'm using (ZXing). Which means that it ignores \"shc:/\" since they're not numeric. </p>\n<p>So I don't have a clue what I'm supposed to do here....</p>",
        "id": 253275559,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631635110
    },
    {
        "content": "<p>The JWS segment is Numeric encoded, but the<code>shc:/</code> segment is byte encoded. You need to use a library that supports mixed mode qr codes (e.g. see this <a href=\"https://www.npmjs.com/package/qrcode#manual-mode\">Javascript QR Code Library</a>).</p>\n<p>This can also be seen in action in the <a href=\"https://github.com/smart-on-fhir/health-cards/blob/main/generate-examples/src/index.ts#L180-L188\">specification example generation code here</a>.</p>",
        "id": 253276737,
        "sender_full_name": "Reece Adamson",
        "timestamp": 1631635499
    },
    {
        "content": "<p>Should be a multi-segment code with the shc:/ portion being bytes and the rest numeric. We have a js example at <a href=\"https://github.com/dvci/health-cards-walkthrough/blob/main/SMART%20Health%20Cards.ipynb\">https://github.com/dvci/health-cards-walkthrough/blob/main/SMART%20Health%20Cards.ipynb</a> and C# example at <a href=\"https://github.com/StateOfCalifornia/DigitalCovid19VaccineRecord-API/blob/a98b914440968cc98dd123dbc74886694a8f2a68/Infrastructure/QrCodeApi/QrApiService.cs\">https://github.com/StateOfCalifornia/DigitalCovid19VaccineRecord-API/blob/a98b914440968cc98dd123dbc74886694a8f2a68/Infrastructure/QrCodeApi/QrApiService.cs</a>.</p>",
        "id": 253276756,
        "sender_full_name": "Neelima Karipineni",
        "timestamp": 1631635503
    },
    {
        "content": "<p><a href=\"https://github.com/smart-on-fhir/health-cards/wiki/Libraries-for-SMART-Health-Cards\">https://github.com/smart-on-fhir/health-cards/wiki/Libraries-for-SMART-Health-Cards</a> has a set of QR generation libraries that are known to support &gt;1 segment with different encodings</p>",
        "id": 253276998,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1631635582
    },
    {
        "content": "<p>well, I don't get to use any of those, and I don't have access to a qrcode generator that does segments.</p>",
        "id": 253277067,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631635616
    },
    {
        "content": "<p>What does \"get to\" mean?</p>",
        "id": 253277086,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1631635625
    },
    {
        "content": "<p><a href=\"https://github.com/nayuki/QR-Code-generator\">https://github.com/nayuki/QR-Code-generator</a> has c bindings as a common denomniator</p>",
        "id": 253277139,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1631635649
    },
    {
        "content": "<p>yes just saw that. Guess I'm going that path</p>",
        "id": 253277171,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631635661
    },
    {
        "content": "<p>(this is what the EU covid cert spec defines base45 encoding to avoid -- it's a good trick; if we wanted to use it with JWTs instead of CBOR, we'd have to introduce another compression step into the mix, to have binary data to pass <em>into</em> that encoding.)</p>",
        "id": 253277345,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1631635724
    }
]