[
    {
        "content": "<p>What did Quebec use for their vaccine credential?    Quebec could make obtaining QR code more complex in response to breaches, minister says<br>\nCBC News · <a href=\"https://www.cbc.ca/news/canada/montreal/vaccination-passport-safety-security-hacker-1.6155488\">https://www.cbc.ca/news/canada/montreal/vaccination-passport-safety-security-hacker-1.6155488</a></p>",
        "id": 251133861,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630244894
    },
    {
        "content": "<p>They're using SMART Health Cards, like California, New York, Louisiana (and Walmart, CVS, Epic, Cerner, and others). I don't think there have been details published about the specific issues mentioned in the article here, but based on early feedback there is an implementation issue and not a protocol issue.</p>",
        "id": 251135941,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1630247079
    },
    {
        "content": "<p>I expected that it was a validation, more specifically a lack of validation, issue.   The model we use does enable the data to be seen without forcing a validation of the signature. Thus it is possible to have a poorly (maliciously) implemented reader that simply displays.<br>\nWhich the best lesson-learned could be that there will need to be a set of testing (test plan) requirements that can be used to show that a \"reader\" application is doing all the right things, and not just displaying the content.</p>",
        "id": 251261880,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630343672
    },
    {
        "content": "<p>an organization that is going to rely on these QR codes needs to have some way to prove that the app they are using is legitimately validating. Thus we need both good data and various bad data as part of a comprehensive test plan.</p>",
        "id": 251262130,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630343778
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191404\">John Moehrke</span> <a href=\"#narrow/stream/284830-smart.2Fhealth-cards/topic/Quebec.20breach/near/251262130\">said</a>:</p>\n<blockquote>\n<p>Thus we need both good data and various bad data as part of a comprehensive test plan.</p>\n</blockquote>\n<p>I think it's a good idea to have a threat modelling list for validation apps, to at least avoid accidental (vs. malicious) implementation errors. The <a href=\"https://github.com/smart-on-fhir/health-cards-validation-SDK\">validation SDK</a> has a lot of test files that could be used to create such a test plan (invalid payload, signatures, etc.)</p>",
        "id": 251267782,
        "sender_full_name": "Christian Paquin",
        "timestamp": 1630346229
    },
    {
        "content": "<p>ESET security released a vulnerability report. Is it related to the SDK behavior?<br>\n<a href=\"https://www.welivesecurity.com/fr/2021/08/31/faille-preuve-vaccination-quebec-vaxicode-verif/\">https://www.welivesecurity.com/fr/2021/08/31/faille-preuve-vaccination-quebec-vaxicode-verif/</a></p>",
        "id": 251470476,
        "sender_full_name": "Marc-André Poulin",
        "timestamp": 1630448868
    },
    {
        "content": "<p>Translating the relevant part:</p>\n<p>\"The vulnerability resides in the fact that once downloaded a public key can be used to validate any other passport, without verifying the content of the issuer field (iss).\"</p>",
        "id": 251471305,
        "sender_full_name": "Marc-André Poulin",
        "timestamp": 1630449321
    },
    {
        "content": "<p>that is not a vulnerability, that is normal public/private key fact. Public keys are \"public\".  Public keys enable signature validation.</p>",
        "id": 251550542,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630500031
    },
    {
        "content": "<p>The problem is outlined in the article. It is that the app does not maintain a proper truststore of certificates worthy of trust for issuing vaccine certificates. The attack involves two QR codes, the first of which is intended to fail, but the failure of it does not cleanup and thus remnants of that first QR validation (the attackers public key is in the trust store), and thus the second QR succeeds.  --- THUS this is just poor software design.</p>",
        "id": 251551772,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630500629
    },
    {
        "content": "<p>likely only one QR was needed.. first scan fails, but individual insists they try again, and second scan succeeds.</p>",
        "id": 251551879,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630500686
    },
    {
        "content": "<p>seems the app new version has fixed truststore with no ability to update public keys. this will fail when new issuers are needed, or when existing issuers need to get new certificates. -- again, poor software design.</p>",
        "id": 251552148,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630500797
    },
    {
        "content": "<p>@john agreed, I think you described the attack properly, but isn't the SDK downloading and adding the key to the keystore in the first place. Referring to the code here: <a href=\"https://github.com/smart-on-fhir/health-cards-validation-SDK/blob/a68f478a6c4607cfce9f60df7ce0c8afba49111f/src/jws-compact.ts#L210\">https://github.com/smart-on-fhir/health-cards-validation-SDK/blob/a68f478a6c4607cfce9f60df7ce0c8afba49111f/src/jws-compact.ts#L210</a></p>",
        "id": 251552181,
        "sender_full_name": "Marc-André Poulin",
        "timestamp": 1630500815
    },
    {
        "content": "<p>The SDK doesn't appear to validate that the key used to validate is the same as the one provided by the iss field, allowing the attack to happen.</p>",
        "id": 251552660,
        "sender_full_name": "Marc-André Poulin",
        "timestamp": 1630500990
    },
    {
        "content": "<p>if the reference code is susceptible to this, then it should be fixed... properly.</p>",
        "id": 251552692,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630501007
    },
    {
        "content": "<p>The iss check is additional. the main problem was truststore management.</p>",
        "id": 251552775,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630501040
    },
    {
        "content": "<p>There are a few related issues here, stemming from the way that SMART issuer testing tools were incorporated into the Quebec verifier app. <span class=\"user-mention\" data-user-id=\"385047\">@Christian Paquin</span> can provide more context, but the gist is:</p>\n<ul>\n<li>\n<p>The official testing tool is designed to help issuers debug their implementations, providing useful feedback about the pieces that are right and wrong. As such, it parses payloads leniently, to generate more useful developer facing warnings or expose downstream errors even if there are some early showstoppers. We did not design the testing tool with the idea that its code would be incorporated directly into verifier apps, but we should have anticipated that this would be appealing for verifiers. <a href=\"https://github.com/smart-on-fhir/health-cards-validation-SDK/pull/143\">https://github.com/smart-on-fhir/health-cards-validation-SDK/pull/143</a>  clarifies the design intent, and we are also planning to rename the tool itself to avoid ambiguity on this point (to wit, I'm referring to it as a testing tool here rather than a validation SDK).</p>\n</li>\n<li>\n<p>As John points out, the testing tool uses a keystore in such a way that keys in the store are not bound to specific issuers. (For background: the testing tool was designed to run tests independently, so state would not accumulate in the keystore across invocations and typical usage. It is also designed to support issuers in early stage testing when they have not yet published keys on the web, so it provides additional mechanisms to load keys into its store.) In any case, the lack of binding between keys and issuers is a bug that we will fix ASAP (this should not change testing results when the testing tool is being used as intended).</p>\n</li>\n<li>\n<p>We did not have any officially documented channel for reporting security issues with the testing tool; this has been fixed in <a href=\"https://github.com/smart-on-fhir/health-cards-validation-SDK/pull/146\">https://github.com/smart-on-fhir/health-cards-validation-SDK/pull/146</a> (but of course individual verifier apps and issuers likely need their own security reporting channels; this is something we will continue to push on through the VCI directory; see <a href=\"https://github.com/the-commons-project/vci-directory/issues/52\">https://github.com/the-commons-project/vci-directory/issues/52</a>)</p>\n</li>\n</ul>",
        "id": 251558985,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1630503362
    },
    {
        "content": "<p>Makes sense, thank you <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 251560976,
        "sender_full_name": "Marc-André Poulin",
        "timestamp": 1630504075
    },
    {
        "content": "<p>all reference sample code should be assumed it will be used in production without correcting the residual TODO issues... Sad reality of the software world. Not unique to us here.  Someone will eventually figure out how to prevent this.<br>\nThanks for the clarity and the proper handling.</p>",
        "id": 251562101,
        "sender_full_name": "John Moehrke",
        "timestamp": 1630504466
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"436993\">Marc-André Poulin</span> <a href=\"#narrow/stream/284830-smart.2Fhealth-cards/topic/Quebec.20breach/near/251470476\">said</a>:</p>\n<blockquote>\n<p>ESET security released a vulnerability report. Is it related to the SDK behavior?<br>\n<a href=\"https://www.welivesecurity.com/fr/2021/08/31/faille-preuve-vaccination-quebec-vaxicode-verif/\">https://www.welivesecurity.com/fr/2021/08/31/faille-preuve-vaccination-quebec-vaxicode-verif/</a></p>\n</blockquote>\n<p>I've seen a lot of reports on the issue, in the Quebec press, blogs, twitter, etc. This is by far the most accurate and detailed summary.</p>",
        "id": 251572005,
        "sender_full_name": "Christian Paquin",
        "timestamp": 1630507780
    }
]