[
    {
        "content": "<p>When I read the specs at <a href=\"https://www.hl7.org/fhir/profiling.html#discriminator\" target=\"_blank\" title=\"https://www.hl7.org/fhir/profiling.html#discriminator\">https://www.hl7.org/fhir/profiling.html#discriminator</a> I noticed that when we are doing value slicing or pattern slicing that  </p>\n<div class=\"codehilite\"><pre><span></span>then the element definition must use either:\n- ElementDefinition.fixed[x], or\n- ElementDefinition.pattern[x], or\n- if the element has a terminology binding, a required binding with a Value Set that enumerates the list of possible codes in the value set (&quot;extensional definition&quot;)\n</pre></div>\n\n\n<p>I read that as follows: each ElementDefinition defining the slice must either have a fixed[x] or pattern[x] or binding constraint. If that is the case, what is then the difference between  value slicing and pattern slicing?</p>\n<p>In the FHIR .NET Api, we only allow the fixed[x] and binding constraint for a value slicing and a pattern[x] constraint for the pattern slicing. But I have the feeling that is not correct. Am I right?</p>",
        "id": 178950150,
        "sender_full_name": "Marco Visser",
        "timestamp": 1571922971
    },
    {
        "content": "<p>Value must match exactly - no extra elements or extensions.  Pattern must match what's specified but is free to have extra elements including extra repetitions.  As a result, pattern is usually better.</p>",
        "id": 178965606,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1571931927
    },
    {
        "content": "<p>Note however that the <a href=\"http://hl7.org/fhir/R4/elementdefinition-definitions.html#ElementDefinition.pattern_x_\" target=\"_blank\" title=\"http://hl7.org/fhir/R4/elementdefinition-definitions.html#ElementDefinition.pattern_x_\">documentation for pattern[x]</a> states:</p>\n<blockquote>\n<p>In general, pattern[x] is not intended for use with primitive types, where is has the same meaning as fixed[x].</p>\n</blockquote>\n<p>So if you're fixing a primitive, <code>fixed[x]</code> is preferred.</p>",
        "id": 178969777,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1571934391
    },
    {
        "content": "<p>As it relates to slicing, it's also helpful to consider that if you're fixing more than one part of a complex type (like <code>code</code> and <code>system</code> in a <code>CodeableConcept</code> or <code>Coding</code>), then using <code>pattern[x]</code> allows you to have a simpler (single) discriminator rather than two discriminators.  It also prevents you from needing to use slicing when fixing <code>code</code>/<code>system</code> of a <code>CodeableConcept</code>.</p>",
        "id": 178969981,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1571934533
    },
    {
        "content": "<p>It doesn't <em>quite</em> have the same meaning as 'fixed.  A pattern would allow extensions on the primitive.  A fixed value would not.</p>",
        "id": 178972407,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1571935948
    },
    {
        "content": "<p>I feel as though we haven't actually answered the question. I don't know off the top of my head what the validator does, but I agree with this in principle:</p>\n<blockquote>\n<p>we only allow the fixed[x] and binding constraint for a value slicing and a pattern[x] constraint for the pattern slicing</p>\n</blockquote>",
        "id": 178975622,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571937874
    },
    {
        "content": "<blockquote>\n<p>It doesn't quite have the same meaning as 'fixed. A pattern would allow extensions on the primitive. A fixed value would not.</p>\n</blockquote>\n<p>Right -- which is why it probably says \"in general\".  But in practice, I haven't seen too many primitives with a <code>pattern[x]</code>.  That said, I think it might be helpful to actually state that meaningful distinction in the spec itself so people understand exactly what they're disallowing when using <code>fixed[x]</code> with a primitive.</p>",
        "id": 178988486,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1571945529
    },
    {
        "content": "<p>I might go so far as to raise a warning when someone slices be value instead of by pattern.</p>",
        "id": 178989194,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1571945982
    },
    {
        "content": "<blockquote>\n<p>I don't know off the top of my head what the validator does, but I agree with this in principle:</p>\n<blockquote>\n<p>we only allow the fixed[x] and binding constraint for a value slicing and a pattern[x] constraint for the pattern slicing</p>\n</blockquote>\n</blockquote>\n<p><a href=\"http://hl7.org/fhir/R4/profiling.html#discriminator\" target=\"_blank\" title=\"http://hl7.org/fhir/R4/profiling.html#discriminator\">Section 5.1.0.11</a> makes it fairly clear that the <code>pattern</code> discriminator type must be accompanied by the <code>pattern[x]</code> construct.  In the first table it says:</p>\n<blockquote>\n<p>pattern: The slices have different values in the nominated element, as determined by testing them against the applicable ElementDefinition.pattern[x].</p>\n</blockquote>\n<p>It doesn't state that <code>value</code> corresponds directly (and only) to <code>fixed[x]</code> however.  And the following language makes it sound kind of ambiguous:</p>\n<blockquote>\n<p>If the type is value, or pattern, then the element definition must use either:<br>\n- ElementDefinition.fixed[x], or<br>\n- ElementDefinition.pattern[x], or<br>\n- if the element has a terminology binding, a required binding with a Value Set that enumerates the list of possible codes in the value set (\"extensional definition\")</p>\n</blockquote>\n<p>I think associating <code>value</code> to <code>fixed[x]</code> makes sense (and is most implementable) -- but it would complicate a hypothetical situation in which a set of elements uses <code>pattern[x]</code> to apply expected codes (<code>Coding</code> or <code>CodeableConcept</code>) but the slices should discriminate on the code <code>system</code> only.</p>",
        "id": 178989387,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1571946116
    },
    {
        "content": "<p>note from the <a class=\"stream\" data-stream-id=\"179177\" href=\"/#narrow/stream/179177-conformance\">#conformance</a> stream - there's a use case for mixing pattern and binding?</p>",
        "id": 178994419,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571949186
    },
    {
        "content": "<p>I'm not actually sure that differentiating pattern and value on the discriminator makes sense - we can delegate that to the slices, and decide that value and pattern are effectively synonyms?</p>",
        "id": 178994515,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571949234
    },
    {
        "content": "<p>Not sure I understand what you're proposing <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>?</p>",
        "id": 179009820,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1571961380
    },
    {
        "content": "<p>at present there is no way to mix pattern and value set binding in a single set of slices</p>",
        "id": 179010071,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571961643
    },
    {
        "content": "<p>but we also have an anti-pattern here: we say at the start of the slicing whether it's a value or a pattern, and then have value or pattern fields - I can't see how that's useful.</p>",
        "id": 179010113,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571961696
    },
    {
        "content": "<p>So your proposal is to merge the slicing types (or more specifically to deprecate one, given that it's already normative) and to allow valueset, fixed and pattern to all be used by the same slicing type?  I could live with that.  (Would still like to spit out warnings or at least \"good practice\" alerts whenever someone uses 'fixed'.</p>",
        "id": 179011857,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1571963460
    },
    {
        "content": "<p>I think that something like that would make more sense</p>",
        "id": 179012648,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571964164
    },
    {
        "content": "<p>The proposal sounds ok to me. So wich type is normative, value?<br>\n( I believe we described a use case for mixing pattern and valueset binding here: <a href=\"#narrow/stream/179177-conformance/topic/Slicing.20and.20value.20sets\" title=\"#narrow/stream/179177-conformance/topic/Slicing.20and.20value.20sets\">zulip chat</a> )</p>",
        "id": 179042181,
        "sender_full_name": "Ardon Toonstra",
        "timestamp": 1572004093
    },
    {
        "content": "<p>Both are.  We'll have to deprecated one.   And if we see it, we'll treat it the same as the other</p>",
        "id": 179046936,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572008492
    },
    {
        "content": "<p>Shall I create a gforge ticket? Or does one already exists?</p>",
        "id": 179306641,
        "sender_full_name": "Ardon Toonstra",
        "timestamp": 1572335000
    },
    {
        "content": "<p>I don't think one does</p>",
        "id": 179311312,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572340360
    },
    {
        "content": "<p><a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25206\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25206\">gForge id 25206</a></p>",
        "id": 180507420,
        "sender_full_name": "Ardon Toonstra",
        "timestamp": 1573559182
    },
    {
        "content": "<p>Here the link to the ticket on Confluence:  <a href=\"https://jira.hl7.org/browse/FHIR-25206\" target=\"_blank\" title=\"https://jira.hl7.org/browse/FHIR-25206\">https://jira.hl7.org/browse/FHIR-25206</a><br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , do you know the status of this issue? Wasn't this already discussed with FHIR-I?</p>",
        "id": 189312720,
        "sender_full_name": "Ardon Toonstra",
        "timestamp": 1582899055
    },
    {
        "content": "<p>doesn't look like it?</p>",
        "id": 189338295,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582915292
    },
    {
        "content": "<p>Could we discuss this issue in one of the next FHIR-I calls? <span class=\"user-mention\" data-user-id=\"192301\">@Ardon Toonstra</span> and I could make sure that everyone relevant for the discussion from Firely is present.</p>",
        "id": 189432387,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1583067164
    }
]