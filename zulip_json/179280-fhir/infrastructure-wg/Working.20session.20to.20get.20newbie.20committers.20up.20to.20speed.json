[
    {
        "content": "<p>At the WGM last week, we talked about having a session where experienced folks would some people new to the committing process through getting the build working locally, so we'd be able to usefully volunteer to get down the list of outstanding trackers to be applied.  When are we planning to do that?</p>",
        "id": 255054955,
        "sender_full_name": "Michael Donnelly",
        "timestamp": 1632752123
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191936\">Michael Donnelly</span> has marked this topic as resolved.</p>",
        "id": 255054974,
        "sender_full_name": "Notification Bot",
        "timestamp": 1632752130
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191936\">Michael Donnelly</span> has marked this topic as unresolved.</p>",
        "id": 255054983,
        "sender_full_name": "Notification Bot",
        "timestamp": 1632752133
    },
    {
        "content": "<p>My leaning is next week.  Finalize that on today's call?</p>",
        "id": 255061992,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1632754526
    },
    {
        "content": "<p>Cool.  I won't be there today, but I'll make it solid on my calendar for next week.</p>",
        "id": 255091111,
        "sender_full_name": "Michael Donnelly",
        "timestamp": 1632765335
    },
    {
        "content": "<p>How much other interest have we gotten so far?</p>",
        "id": 256114061,
        "sender_full_name": "Michael Donnelly",
        "timestamp": 1633374230
    },
    {
        "content": "<p>Did we... advertise it the way we said we would?</p>",
        "id": 256120007,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633376567
    },
    {
        "content": "<p>I don't remember how we said we would...</p>",
        "id": 256130553,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633380601
    },
    {
        "content": "<p>I added documentation for the Docker environment at <a href=\"https://github.com/FHIR/auto-ig-builder/tree/master/images/ig-publisher-base#build-the-core-fhir-spec\">https://github.com/FHIR/auto-ig-builder/tree/master/images/ig-publisher-base#build-the-core-fhir-spec</a> and included a note + link to this in bolded text at <a href=\"https://confluence.hl7.org/display/FHIR/FHIR+Build+Process\">https://confluence.hl7.org/display/FHIR/FHIR+Build+Process</a></p>",
        "id": 256132218,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633381377
    },
    {
        "content": "<p>note that I don't understand a word of that</p>",
        "id": 256132355,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633381443
    },
    {
        "content": "<p>You might not need to at this stage; if you don't prefer to use Docker, you shouldn't. But of course, if it works and we get feedback, we can start making it more approachable for folks who aren't already seeking it out.</p>",
        "id": 256133447,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633381952
    },
    {
        "content": "<p>That said, if you do have docker installed locally  (e.g. on linux, or in wsl on windows, or on an intel mac, or following <a href=\"https://docs.docker.com/desktop/mac/apple-silicon/#known-issues\">instructions</a> for platform emulation on an M1 Mac (though for the M1 environment, someone with a mac should probably produce a distinct image to take advantage of the architecture)... you should be able to literally paste the following into a bash shell and have the spec build:</p>\n<div class=\"codehilite\"><pre><span></span><code>git clone https://github.com/hl7/fhir\ncd fhir\n\ndocker run --rm -it \\\n  -v $(pwd):/home/publisher/ig \\\n  hl7fhir/ig-publisher-base:latest \\\n  ./publish.sh\n</code></pre></div>",
        "id": 256133998,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633382106
    },
    {
        "content": "<p>Get the image locally: do I do both those things? or just choose one?</p>\n<p>Build an IG: do I want to do that? is \"$(pwd):\" something I copy and paste, or do I do something with it first?</p>\n<p>\"If you want to avoid downloading depenencies like gradle and kindling on each run\" - how would I know whether I want to do that or not? What's gradle and kindling? </p>\n<p>same for \"Similarly if you wan to avoid downloading FHIR cache entries repeatedly\" - would I want to ? What it be good? or bad?</p>",
        "id": 256134186,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633382181
    },
    {
        "content": "<p>I'm trying to get my tx server to run on linux and osx right now, and I'm encountering piles of documentation like this - giving me a choice I don't understand, in a syntax I don't understand - insider doco written for other insiders</p>",
        "id": 256134341,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633382264
    },
    {
        "content": "<blockquote>\n<p>Get the image locally: do I do both those things? or just choose one?</p>\n</blockquote>\n<p>You can pick; if you just follow the examples, Docker will download the image automatically.</p>",
        "id": 256134601,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633382374
    },
    {
        "content": "<blockquote>\n<p>Build an IG: do I want to do that? </p>\n</blockquote>\n<p>The premise if you either want to build an IG or you want to build the FHIR core spec. There is a section for each.</p>",
        "id": 256134652,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633382399
    },
    {
        "content": "<p>I'm just picking on the documentation. Saying 'you'll want to' makes me ask myself if I do, and why I do.</p>",
        "id": 256134840,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633382460
    },
    {
        "content": "<blockquote>\n<p>Is \"$(pwd):\" something I copy and past</p>\n</blockquote>\n<p>You copy and paste. It's a syntax that the shell resolves as \"run the <code>pwd</code> command and insert its output here\", which is to say: <code>$(pwd)</code> will resolve to the full path of the folder you're in when you run the docker command (i.e., wherever you cloned the fhir spec to).</p>",
        "id": 256134857,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633382468
    },
    {
        "content": "<p>This is 100% insider documentation.</p>",
        "id": 256134891,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633382488
    },
    {
        "content": "<p>First it needs to work. If it works, we can start documenting it in a way that others find useful.</p>",
        "id": 256134912,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633382500
    },
    {
        "content": "<p>But I'll want feedback from <span class=\"user-mention\" data-user-id=\"194452\">@Bas van den Heuvel</span> and <span class=\"user-mention\" data-user-id=\"191936\">@Michael Donnelly</span>  and <span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span>  or others on the \"insider track\" to get the mechanics ironed out before we go deep on explanations. (And as I suggested: probably if you don't know Docker, you don't want to use a docker-focused build process.)</p>",
        "id": 256135069,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633382561
    },
    {
        "content": "<p>I reckon they don't know all the answers to my questions</p>",
        "id": 256135144,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633382596
    },
    {
        "content": "<p>FWIW, I just finished a non-Docker build on a Linux VM with:</p>\n<ul>\n<li>Java 11 OpenJDK</li>\n<li>Jeckyl (latest Ruby and latest Jeckyl for Ubuntu LTS 20.04)</li>\n<li>12 GB memory</li>\n<li>No JAVA_OPTIONS settings</li>\n</ul>\n<p>and also with the caveat that I had been able to occasionally build the core spec over the last few  years with only few issues.</p>\n<p>Total time: 52m 29s</p>\n<p>I will see if I can get a clean environment to try Docker.</p>",
        "id": 256138147,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1633383956
    },
    {
        "content": "<p>52min is very long</p>",
        "id": 256161779,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633397560
    },
    {
        "content": "<p>I've updated the documentation here: <a href=\"https://confluence.hl7.org/display/FHIR/FHIR+Build+Process\">https://confluence.hl7.org/display/FHIR/FHIR+Build+Process</a> to reflect what's actually needed:<br>\n-yes, you need a JDK (not a JRE)</p>\n<ul>\n<li>no need for Ant, Jekyll or .NET or to full around with JAVA_HOME</li>\n<li>you do need to set JAVA_TOOL_OPTIONS</li>\n</ul>",
        "id": 256174096,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633406833
    },
    {
        "content": "<p>On a Windows machine w/ 32GB, full build took me 23min</p>",
        "id": 256174128,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633406870
    },
    {
        "content": "<blockquote>\n<p>52min is very long</p>\n</blockquote>\n<p>That was the first gradle-based build. After running <a href=\"http://clean.sh\">clean.sh</a>, the second build took 31 min.<br>\nWhat I noticed was that the validation of each artifact (resource, or example) took at least one second each.  Maybe that is one place where the build can be sped up.</p>",
        "id": 256252786,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1633443342
    },
    {
        "content": "<p>On my Linux desktop (64GB RAM, SSD, Ryzen 5 3600 CPU -- my 2020 work-from-home PC) the full build took ~11min. This includes downloading gradle and whatever else \"<a href=\"http://publish.sh\">publish.sh</a>\" needed to do from a clean state.</p>",
        "id": 256269828,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633448851
    },
    {
        "content": "<p>Do we need to do docker build? I used to just run <code>./gradlew publish.sh</code> as instructed by README</p>",
        "id": 256302077,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1633461158
    },
    {
        "content": "<p>No need for docker if you want to invoke it directly.</p>",
        "id": 256302660,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633461374
    },
    {
        "content": "<p>Docker is useful if there are specific environment requirements as it allows setting them up in a clean environment. This allows for checking those requirements each time the container is run and shields the local system from this specific requirements. E.g. in the example provided by Josh, running the IG builder requires sushi, python, graphiz, jekyll, asciidoc,... In such situation, a Dockerized build as a lot of advantages. It also makes it easy to run build jobs on different computers. </p>\n<p>In the case of the FHIR build, the only remaining environment requirement seams to be a recent Java SDK. Although it is perfectly feasible running the build in Docker. I think taking the Docker approach in this situation might be a little bit overkill. <br>\nIt could still be useful if one wants to offload the build to a different machine. We can provide a script/Dockerfile for this but I think this is less critical.</p>",
        "id": 256366634,
        "sender_full_name": "Bas van den Heuvel",
        "timestamp": 1633503756
    },
    {
        "content": "<p>100% agree. Docker is not a solution I'm trying to push on anyone or \"sell\" this community on. It's just something I use already in the auto build pipeline and in my own development, and for folks who want it, it's available.</p>",
        "id": 256406613,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1633525336
    },
    {
        "content": "<blockquote>\n<p>What I noticed was that the validation of each artifact (resource, or example) took at least one second each. Maybe that is one place where the build can be sped up</p>\n</blockquote>\n<p>well, you're welcome to dive into the validation code and find speed improvements. But the low hanging fruit was picked a long time ago</p>",
        "id": 257257834,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634066551
    },
    {
        "content": "<p>The slowdown must have been due to either that I was running it on VMWare VM, or that I didn't give enough memory to Java.<br>\nI ran a new clone directly on a 4-core Intel laptop with 16GB memory, SSD, Linux with _JAVA_OPTIONS=-Xmx15000m (note the leading underscore) - 17 minutes</p>",
        "id": 257308042,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1634098181
    },
    {
        "content": "<p>Somewhat related, if you are planning on working on the core spec, it is probably a good idea to subscribe to <a class=\"stream\" data-stream-id=\"179165\" href=\"/#narrow/stream/179165-committers\">#committers</a> .  E.g., Grahame asked for people to pause work while he straightens out some build issues <a href=\"#narrow/stream/179165-committers/topic/Main.20build.20R5\">in this thread</a>.</p>\n<p>Somewhat related to <em>that</em>, if you are pushing builds you can subscribe to <a class=\"stream\" data-stream-id=\"179297\" href=\"/#narrow/stream/179297-committers.2Fnotification\">#committers/notification</a> to see the results of builds in Zulip  =).</p>",
        "id": 257380764,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1634137295
    },
    {
        "content": "<p>(back in the day, <a href=\"https://github.com/HL7/fhir/wiki/Get-Started-with-FHIR-on-GitHub#get-started-with-git-github-and-the-fhir-spec\">https://github.com/HL7/fhir/wiki/Get-Started-with-FHIR-on-GitHub#get-started-with-git-github-and-the-fhir-spec</a> documented a process for joining committers; is this documentation still correct or authoritative? I couldn't find a Confluence equivalent but may not have searched for the right things.)</p>",
        "id": 257383477,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634138240
    },
    {
        "content": "<p>should be a fine place to keep that on github, right? Just might be useful to have a small article on confluence pointing to that github wiki page.</p>",
        "id": 257399350,
        "sender_full_name": "John Moehrke",
        "timestamp": 1634143935
    },
    {
        "content": "<p>that wiki does not mention vscache, and doesn't mention what to do when your branch gets behind master.</p>",
        "id": 257399666,
        "sender_full_name": "John Moehrke",
        "timestamp": 1634144054
    },
    {
        "content": "<p>likely should also have some hints about how helpful revert is.</p>",
        "id": 257399753,
        "sender_full_name": "John Moehrke",
        "timestamp": 1634144088
    }
]