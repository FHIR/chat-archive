[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> <span class=\"user-mention\" data-user-id=\"191410\">@Brett Marquard</span> The us-core extension profiles have non-conformant element ids in them. How can I report this officially?</p>\n<p>For example, us-core-race has id <code>Extension.extension:ombCategory.valueCoding</code> which should be <code>Extension.extension:ombCategory.value[x]:valueCoding</code></p>\n<p>Also, an additional differential element is needed at <code>Extension.extension:ombCategory.value[x]</code> to limit the allowed value to Coding.</p>\n<p>See <a href=\"http://hl7.org/fhir/elementdefinition.html#id\">http://hl7.org/fhir/elementdefinition.html#id</a> and <a href=\"http://hl7.org/fhir/elementdefinition.html#typesx\">http://hl7.org/fhir/elementdefinition.html#typesx</a></p>",
        "id": 247978856,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1627943060
    },
    {
        "content": "<p>Is this happening in the most recent version of US Core?</p>",
        "id": 248145546,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1627946485
    },
    {
        "content": "<p>(Trying to figure out if this is a current publisher issue)</p>",
        "id": 248145552,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1627946497
    },
    {
        "content": "<p>I'm looking at the <a href=\"http://www.hl7.org/fhir/us/core/StructureDefinition-us-core-race.profile.json.html\">latest US Core race extension</a>, and the snapshot has an element with <code>Extension.extension:ombCategory.value[x]:valueCoding</code>.  The differential does have <code>Extension.extension:ombCategory.valueCoding</code>, but that shortcut syntax is allowed in the differential (as described in <a href=\"https://fire.ly/2019/09/13/type-slicing-in-fhir-r4/\">this blog</a> and hopefully the spec <em>somewhere</em>).</p>\n<p>I agree, however, that the differential <em>should</em> also contain a type constraint on <code>Extension.extension:ombCategory.value[x]</code> constraining it to only <code>Coding</code>.  The spec is clear about this as <span class=\"user-mention\" data-user-id=\"191351\">@Chris Grenz</span> points out.  The snapshot generator, however, is <em>incorrectly</em> inferring the constraint from the <code>Extension.extension:ombCategory.valueCoding</code> -- so if you look at the snapshot, it <em>does</em> have a type constraint.  But this is a bug, not a feature (and one that I'm 98% sure I've reported before).</p>",
        "id": 248151872,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1627948793
    },
    {
        "content": "<p>The R4 spec specifically disallows that id format in the differential. The blog post points out that this was unclear in R3.</p>\n<p><code>valueCoding</code> _is_ the correct value in the path.</p>",
        "id": 248169760,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1627950475
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> I think the \"Normalization\" section of the blog post is non-conformant...</p>",
        "id": 248169975,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1627950664
    },
    {
        "content": "<p>make a tracker as a technical correction.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>   I expected the validator to catch this?</p>",
        "id": 248172671,
        "sender_full_name": "Eric Haas",
        "timestamp": 1627953241
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191351\">@Chris Grenz</span> -- I am pretty sure that most (or all?) of the major tools support choice type renaming in differential element ids.  The IG Publisher happily accepts it and translates it to the full id in the snapshot.  Even the vital signs profiles included in FHIR R4 core use choice type renaming in differential ids (<a href=\"http://hl7.org/fhir/R4/bodyweight.profile.json.html\">example</a>).  So if you're right that it is not allowed, then there are a lot of tools and definitions that need to change (including FHIR core itself).  We should probably get to the bottom of this.</p>",
        "id": 248173375,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1627954036
    },
    {
        "content": "<p>Hmm... That's how I read this: <a href=\"http://hl7.org/fhir/elementdefinition.html#id\">http://hl7.org/fhir/elementdefinition.html#id</a></p>\n<p>SHALL be present and SHALL use this algo. And the algo specifically calls out the type choice scenario...</p>",
        "id": 248174130,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1627954875
    },
    {
        "content": "<p>My understanding was that valueCoding is not allowed in either id or path anymore.</p>",
        "id": 248176168,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1627957428
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191351\">@Chris Grenz</span> -- yeah, that section of doc does read that way.  I only know what I've seen and been told regarding this.  I am having a hard time finding it in the spec though.</p>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> - the spec at least mentions it in reference for paths:</p>\n<blockquote>\n<p>The inclusion of a type specific path (such as \"Patient.deceasedBoolean\") SHALL NOT be interpreted as constraining allowed types, but instead, it constrains the use of a particular type</p>\n</blockquote>\n<p>And that bit (quoted above) was specifically <em>added</em> in R4, so it's not just an unintentional carryover from STU3.</p>\n<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> <span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> <span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> - does <a href=\"http://fire.ly\">fire.ly</a> have any insight on choice type renaming and where it is and is not allowed? Since <a href=\"http://fire.ly\">fire.ly</a> <a href=\"https://fire.ly/2019/09/13/type-slicing-in-fhir-r4/\">wrote the blog article</a>, I imagine you had some conversations around this back when it was decided.</p>",
        "id": 248215647,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1627994895
    },
    {
        "content": "<p>It's important to distinguish between path and id. <code>path: Extension.valueCoding</code> is fine and refers to <code>id: Extension.value[x]:valueCoding</code></p>\n<p><code>id: Extension.valueCoding</code> should be an error.</p>",
        "id": 248220347,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1627997305
    },
    {
        "content": "<p>I guess I just don't understand the point of it then.  It's not much of a \"shortcut\" syntax if you're still required to do the long form in the <code>id</code> anyway.  If <code>id</code> was optional then you could argue that there's value if you're <em>only</em> doing the path, but sdf-17 requires every differential element to have an id -- so what's the point?</p>",
        "id": 248221146,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1627997690
    },
    {
        "content": "<p>I'm afraid not -- Michel (who wrote this) is out of the picture and he &amp; Grahame worked on this stuff pretty much in isolation. <span class=\"user-mention\" data-user-id=\"193551\">@Marco Visser</span> and me are now responsible for his code, but I would have to dig in the code.  I do know that Michel wrote this after he implemented it in the R4 API (and thus forge).</p>",
        "id": 248222744,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1627998464
    },
    {
        "content": "<p>I'm not sure what the problem is here?</p>",
        "id": 249677394,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1629174363
    },
    {
        "content": "<p>See Chrisâ€™ original post on the syntax used in the differentials for choice datatypes</p>",
        "id": 249813239,
        "sender_full_name": "Eric Haas",
        "timestamp": 1629268906
    },
    {
        "content": "<p>Submitted <a href=\"https://jira.hl7.org/browse/FHIR-33233\">https://jira.hl7.org/browse/FHIR-33233</a></p>",
        "id": 250418143,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1629756240
    }
]