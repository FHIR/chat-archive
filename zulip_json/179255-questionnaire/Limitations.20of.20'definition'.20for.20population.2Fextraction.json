[
    {
        "content": "<p>Gabriella Brown raised <a href=\"http://jira.hl7.org/browse/FHIR-25251\" target=\"_blank\" title=\"http://jira.hl7.org/browse/FHIR-25251\">FHIR#25251</a> which asks whether we truly intend to limit item.definition references to element ids actually defined in the referenced profile or whether it's legitimate to reach 'deeper' into the structure than the snapshot actually exposes.  (E.g. pointing to Patient.name.given in the base Patient resource profile).  We've come up with 3 possible different answers, each having different pros and cons in terms of complexity, expressivity, etc. and who gets to feel the pain.  We're seeking wider community feedback.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> please take a look at the comments on the issue and provide thoughts either here or there.</p>",
        "id": 188162666,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1581635610
    },
    {
        "content": "<p>looks like the wrong task to me</p>",
        "id": 188162754,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581635656
    },
    {
        "content": "<p>Fixed.  (Had copied the filter number rather than the issue number)</p>",
        "id": 188162801,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1581635708
    },
    {
        "content": "<p>some comments:</p>\n<ul>\n<li>it should definitely be id not path </li>\n<li>it's not useful to talk out of a profile into implied content - you are referring to an element definition, and the definition doesn't depend on the context through which you find it. </li>\n<li>not is it useful to alias the element. e.g [core]#HumanName.text isn't different to [us-core]#/Patient.name.text, and so shouldn't be given an alias</li>\n</ul>\n<p>Given that, I think that (a) we should be clear that it's id. and (b) you should have to refer to the id directly.</p>",
        "id": 188163410,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581636170
    },
    {
        "content": "<p>Meaning that if you want to refer specifically to Patient.name.given, you'd have to define a specific profile that exposed that - because pointing to HumanName.given doesn't have the same semantic.</p>",
        "id": 188163640,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1581636368
    },
    {
        "content": "<p>(context is different)</p>",
        "id": 188163645,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1581636378
    },
    {
        "content": "<p>Thanks for bringing this up for discussion! What do you mean by exposing Patient.name.given in a profile? Is it generally intended that a Profile should be created to be able to use a Questionnaire? </p>\n<p>Generally, what is the way to create a questionnaire for an arbitrary structure definition? (<a href=\"https://www.hl7.org/fhir/operation-structuredefinition-questionnaire.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/operation-structuredefinition-questionnaire.html\">https://www.hl7.org/fhir/operation-structuredefinition-questionnaire.html</a>) Would you have to make a profile with elements iterating every possible path into the resource that goes through a complex type?</p>\n<p>How would you write a Questionnaire that just has three questions: first name, last name, birthdate, that get extracted to Patient.name.given, Patient.name.family, and Patient.birthdate, with given and family on the same HumanName object in the <a href=\"http://Patient.name\" target=\"_blank\" title=\"http://Patient.name\">Patient.name</a> list?</p>\n<p>I think the context of the element definition does matter for extraction. If you create a Questionnaire, ignore its tree structure, and get a response with two HumanName.given items and two HumanName.family items, where would you put them? All four on the same HumanName object in <a href=\"http://Patient.name\" target=\"_blank\" title=\"http://Patient.name\">Patient.name</a>? Each on its own HumanName object in <a href=\"http://Patient.name\" target=\"_blank\" title=\"http://Patient.name\">Patient.name</a>? (how would you even know that <a href=\"http://Patient.name\" target=\"_blank\" title=\"http://Patient.name\">Patient.name</a> is the right place, as opposed to a contained Patient resource?) I think the questionnaire should be able to express this in itself without needing to reference a profile (some sort of path context to an element in a resource, and some way to group nested elements onto particular containing elements).</p>\n<p>Also it is my impression that population is based entirely on fhirpath initialExpression extensions, and the definitions are only used for extraction.</p>",
        "id": 188168172,
        "sender_full_name": "Gabriela Brown",
        "timestamp": 1581640953
    },
    {
        "content": "<blockquote>\n<p>if you want to refer specifically to Patient.name.given  you'd have to define a specific profile that exposed that</p>\n</blockquote>\n<p>Yes, pretty much,  because referring to Patient.name.given as an inferred idea doesn't say what you mean</p>",
        "id": 188172262,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581645954
    },
    {
        "content": "<blockquote>\n<p>Is it generally intended that a Profile should be created to be able to use a Questionnaire</p>\n</blockquote>\n<p>No. you can always have a questionnaire without a profile. But is intended that you can delegate the semantics of the questions to re-useable element definitions in StructureDefinitions</p>",
        "id": 188172304,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581646014
    },
    {
        "content": "<blockquote>\n<p>that get extracted to </p>\n</blockquote>\n<p>Extracted is not the same is is-defined-by</p>",
        "id": 188172317,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581646054
    },
    {
        "content": "<p>at least, i think that's the core question</p>",
        "id": 188172364,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581646089
    },
    {
        "content": "<p>Isn't the issue here that we're referring to a potential id value that is in no snapshot, but that it could be.<br>\nJust as in the <code>Patient.name.given</code> example.<br>\nAs the snapshot doesn't have to walk into every property of every element (otherwise types like identifier would explode)</p>",
        "id": 188173604,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1581648227
    },
    {
        "content": "<p>And from my understanding, the definition property was prefixed with the profile canonical URL to start from, then a <code>#</code> then the element ID that could be walked to in that profile (even if it walks into the datatype that isn't fully expanded in the snapshot)</p>",
        "id": 188173661,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1581648290
    },
    {
        "content": "<p>(At least that's how I've implemented it at present)</p>",
        "id": 188173669,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1581648304
    },
    {
        "content": "<p>but what's the point? it's not a meaningful definition</p>",
        "id": 188175872,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581652040
    },
    {
        "content": "<p>The definition itself is not meaningful, but I guess it is the structure implied by the path (<code>Patient.name.given</code>) that is meaningful for extraction. Although, you can derive same meaning from the group hierarchy, which I think is what <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> is getting at? Ex:</p>\n<div class=\"codehilite\"><pre><span></span>  <span class=\"s2\">&quot;item&quot;</span><span class=\"err\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;definition&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/Person#Person.name&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;group&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;repeats&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n      <span class=\"s2\">&quot;item&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;name-given&quot;</span><span class=\"p\">,</span>\n          <span class=\"nt\">&quot;definition&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/HumanName#HumanName.given&quot;</span><span class=\"p\">,</span>\n          <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;string&quot;</span><span class=\"p\">,</span>\n          <span class=\"nt\">&quot;repeats&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n        <span class=\"p\">},</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;name-family&quot;</span><span class=\"p\">,</span>\n          <span class=\"nt\">&quot;definition&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/HumanName#HumanName.family&quot;</span><span class=\"p\">,</span>\n          <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;string&quot;</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n</pre></div>\n\n\n<p>^this approach makes sense to me. It's the same example Gabriela provided on the thread <a href=\"#narrow/stream/179166-implementers/topic/Representing.20Complex.20DataTypes.20in.20defintion-based.20extraction/near/181574410\" title=\"#narrow/stream/179166-implementers/topic/Representing.20Complex.20DataTypes.20in.20defintion-based.20extraction/near/181574410\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Representing.20Complex.20DataTypes.20in.20defintion-based.20extraction/near/181574410</a> but I don't think there was a consensus there on how it should look.</p>",
        "id": 188179986,
        "sender_full_name": "Miriam",
        "timestamp": 1581658977
    },
    {
        "content": "<p>My example was very simple, but more likely will have a profiled name element in the profile, and then just walk the 1 step further into the family element.</p>",
        "id": 188180228,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1581659370
    },
    {
        "content": "<p>2 examples I did for a practitioner qualifications form....<br>\n<a href=\"https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/prac-demo\" target=\"_blank\" title=\"https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/prac-demo\">https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/prac-demo</a><br>\nThis second one includes definitions through extensions and slices (defined in a profile)<br>\n<a href=\"https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/prac-ext-demo\" target=\"_blank\" title=\"https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/prac-ext-demo\">https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/prac-ext-demo</a><br>\n(referenced profile is here <a href=\"https://sqlonfhir-r4.azurewebsites.net/fhir/StructureDefinition/hcxdir-practitioner\" target=\"_blank\" title=\"https://sqlonfhir-r4.azurewebsites.net/fhir/StructureDefinition/hcxdir-practitioner\">https://sqlonfhir-r4.azurewebsites.net/fhir/StructureDefinition/hcxdir-practitioner</a>)</p>",
        "id": 188180368,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1581659573
    },
    {
        "content": "<p>Thanks for sharing the examples <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span>. Looking at the <code>Practitioner.name.text</code> item I guess you would have two options for extractability: (1) use definition <code>HumanName.text</code> but nest it in a <code>group</code> with definition <code>Practitioner.name</code>, (2) profile <code>Practitioner.name.text</code> and use that as the definition.</p>\n<p>I think it's worth clarifying the Extraction Guide on this point, because it is only sort of implied: in order to perform Extraction without profiling, the structure of the Questionnaire must match exactly the structure of the Resource(s) to extract. It makes sense, but because <code>group</code>s are described as  meant to \"organize content of the questionnaire into sections, sub-sections, etc.\" we're sort of stuck with visual groupings that match the FHIR resource shape exactly (e.g. I can't collect first name, last name, and birthDate in a single \"section\").</p>\n<p>I don't have any other suggestion <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span> just want to clarify my understanding on this point. Seems like Profile is really the way to go for anything more complex.</p>",
        "id": 188228828,
        "sender_full_name": "Miriam",
        "timestamp": 1581702625
    }
]