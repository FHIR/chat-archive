[
    {
        "content": "<p>The section on <a href=\"https://build.fhir.org/ig/HL7/sdc/expressions.html#x-fhir-query-enhancements\">x-fhir-query enhancements</a> contains some rules I am not sure how to implement when processing JSON-formatted resources.  For instance, it says, \"If the expression resolves to a complex element of type Coding, Identifier, or Reference, the element content will be substituted using the standard token format.\"</p>\n<p>However, what fhirpath.js returns when processing a JSON resource is the data for the nodes picked out by the FHIRPath expression.  For example, an expression <code>Observation.code.coding</code> might return:</p>\n<div class=\"codehilite\"><pre><span></span><code>[\n {\n  &quot;system&quot;: &quot;http://loinc.org&quot;,\n  &quot;code&quot;: &quot;29463-7&quot;,\n  &quot;display&quot;: &quot;Body Weight&quot;\n }\n]\n</code></pre></div>\n\n\n<p>When the caller gets that back, there is nothing in the data to indicate that that is a Coding, except that one might guess it is a Coding based on the fields.</p>",
        "id": 214090053,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1603303182
    },
    {
        "content": "<p>Is that an x-fhir-query issue or a Javascript issue?</p>",
        "id": 214104093,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1603309331
    },
    {
        "content": "<p>I think it is problem that does not happen with the XML format, and that the JSON format as designed has a shortcoming.  On the other hand, I don't think there is anything in the FHIRPath specification about what a FHIRPath engine is supposed to return, so it could perhaps provide an option to mess with the JSON (after it finished running the expression), to convert the array elements into strings, or to inject type information into the structures.</p>",
        "id": 214110555,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1603312209
    }
]