[
    {
        "content": "<p>Looking for help in constructing a fhirpath expression.<br>\nGiven the following structure (where answer and answerOption are children of item, and there can be hundreds of items):</p>\n<p>-item<br>\n---answerOption<br>\n-----display (Yes)<br>\n-----decimalValue (1)<br>\n-----display (No)<br>\n-----decimalValue (2)<br>\n---providedAnswer<br>\n-----display (Yes)</p>\n<p>Need to get, for any providedAnswer, the decimal value from the answerOption.  Eg, in above example, answer is Yes, therefore decimalValue = 1.<br>\nWhat would be the fhirpath expression? <br>\n(using <a href=\"https://hl7.github.io/fhirpath.js/\">https://hl7.github.io/fhirpath.js/</a> for testing)</p>\n<p>Thank you in advance.</p>",
        "id": 265026386,
        "sender_full_name": "Julia",
        "timestamp": 1639582323
    },
    {
        "content": "<p>The per-spec answer would probably be <code>%resource.answers().value.ordinal()</code>. I believe answers() and ordinal() is not widely implemented yet. You can play with it at <a href=\"http://legentix.com/faiabench/#/\">http://legentix.com/faiabench/#/</a> by copying a Questionnaire into the left-middle text box, deleting the QuestionnaireResponse in the left bottom field, answering some questions in the middle, hitting the flame symbol on the right and then entering a FHIRPath expression.<br>\n<a href=\"/user_uploads/10155/Guz_ubSOlKMmFh7goATxizLh/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/Guz_ubSOlKMmFh7goATxizLh/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/Guz_ubSOlKMmFh7goATxizLh/image.png\"></a></div>",
        "id": 265052694,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1639592530
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192169\">Tilo Christ</span> <a href=\"#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265052694\">said</a>:</p>\n<blockquote>\n<p>The per-spec answer would probably be <code>%resource.answers().value.ordinal()</code>. I believe answers() and ordinal() is not widely implemented yet. You can play with it at <a href=\"http://legentix.com/faiabench/#/\">http://legentix.com/faiabench/#/</a> by copying a Questionnaire into the left-middle text box, deleting the QuestionnaireResponse in the left bottom field, answering some questions in the middle, hitting the flame symbol on the right and then entering a FHIRPath expression.<br>\n<a href=\"/user_uploads/10155/Guz_ubSOlKMmFh7goATxizLh/image.png\">image.png</a></p>\n</blockquote>\n<p>So for the above JSON, the entire expression would look like this?  item.providedAnswer.where(%resource.item.answerOption().value.ordinal())</p>",
        "id": 265060586,
        "sender_full_name": "Julia",
        "timestamp": 1639595875
    },
    {
        "content": "<p>maybe I'm a bit confused what I'm looking at in your example. I thought it was the QuestionnaireResponse? Is this a piece of Questionnaire or QuestionnaireResponse? What is \"providedAnswer\" meant to be? answerOption would live in the Questionnaire, but provided answers are part of the response.</p>",
        "id": 265063037,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1639596966
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192169\">Tilo Christ</span> <a href=\"#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265063037\">said</a>:</p>\n<blockquote>\n<p>maybe I'm a bit confused what I'm looking at in your example. I thought it was the QuestionnaireResponse? Is this a piece of Questionnaire or QuestionnaireResponse? What is \"providedAnswer\" meant to be? answerOption would live in the Questionnaire, but provided answers are part of the response.</p>\n</blockquote>\n<p>Yes, that is right.  I need to fetch something from questionnaire.answerOption, based on questionnaireResponse.answer value</p>",
        "id": 265065895,
        "sender_full_name": "Julia",
        "timestamp": 1639598051
    },
    {
        "content": "<p>Not necessarily. If that numerical value is handled as an ordinalValue then it gets passed through into the response and you can pick up everything from the response.</p>",
        "id": 265066291,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1639598222
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"427598\">@Julia</span> See <a href=\"https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/phq9.json\">https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/phq9.json</a> for an example of a PHQ-9, which has a total score calculation that selects the ordinalValue value based on the answer from the QuestionnaireResponse.  You can also find the same form in this app: <a href=\"https://lhcforms.nlm.nih.gov/sdc\">https://lhcforms.nlm.nih.gov/sdc</a>, in the \"Featured\" list on the left after picking a patient.</p>",
        "id": 265099952,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1639616814
    },
    {
        "content": "<p>It's amazing to see how much the complexity of this shrinks once answers() and ordinal() becomes widely available: <a href=\"https://github.com/tiloc/faiadashu/blob/main/example/assets/instruments/phq9_instrument.json\">https://github.com/tiloc/faiadashu/blob/main/example/assets/instruments/phq9_instrument.json</a></p>",
        "id": 265140097,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1639652841
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"195344\">Paul Lynch</span> <a href=\"#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265099952\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"427598\">Julia</span> See <a href=\"https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/phq9.json\">https://github.com/lhncbc/lforms-fhir-app/blob/master/e2e-tests/data/R4/phq9.json</a> for an example of a PHQ-9, which has a total score calculation that selects the ordinalValue value based on the answer from the QuestionnaireResponse.  You can also find the same form in this app: <a href=\"https://lhcforms.nlm.nih.gov/sdc\">https://lhcforms.nlm.nih.gov/sdc</a>, in the \"Featured\" list on the left after picking a patient.</p>\n</blockquote>\n<p>Thank you so much!  This is exactly what I was looking for.</p>",
        "id": 265161017,
        "sender_full_name": "Julia",
        "timestamp": 1639663930
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192169\">Tilo Christ</span> <a href=\"#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265066291\">said</a>:</p>\n<blockquote>\n<p>Not necessarily. If that numerical value is handled as an ordinalValue then it gets passed through into the response and you can pick up everything from the response.</p>\n</blockquote>\n<p>Thank you very much! This is an interesting approach that I will try out.</p>",
        "id": 265161157,
        "sender_full_name": "Julia",
        "timestamp": 1639664014
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192169\">Tilo Christ</span> <a href=\"#narrow/stream/179255-questionnaire/topic/fhirpath.20expression/near/265140097\">said</a>:</p>\n<blockquote>\n<p>It's amazing to see how much the complexity of this shrinks once answers() and ordinal() becomes widely available: <a href=\"https://github.com/tiloc/faiadashu/blob/main/example/assets/instruments/phq9_instrument.json\">https://github.com/tiloc/faiadashu/blob/main/example/assets/instruments/phq9_instrument.json</a></p>\n</blockquote>\n<p>That is definitely a lot simpler.  For anyone else looking for where those functions are defined, see:  <a href=\"https://build.fhir.org/ig/HL7/sdc/expressions.html#fhirpath\">https://build.fhir.org/ig/HL7/sdc/expressions.html#fhirpath</a>, and also the tracker items  <a href=\"https://jira.hl7.org/browse/FHIR-28173\">https://jira.hl7.org/browse/FHIR-28173</a> and <a href=\"https://jira.hl7.org/browse/FHIR-33539\">https://jira.hl7.org/browse/FHIR-33539</a></p>",
        "id": 265208104,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1639683270
    },
    {
        "content": "<p>I have a great scoring demo resource<br>\n<a href=\"https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/abbey-pain-scale/_history/5?_format=html\">https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/abbey-pain-scale/_history/5?_format=html</a><br>\nThis one uses the ordinal too.<br>\nMind you I used the extension rather than the shortcut method.</p>",
        "id": 265245940,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639707203
    }
]