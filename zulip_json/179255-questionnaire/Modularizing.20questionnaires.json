[
    {
        "content": "<p>Hi, all!</p>\n<p>Let's move all discussions related to modularizing questionnaires<br>\n( FHIR-22356 FHIR-27049 FHIR-27132 ) to this thread.</p>\n<p>It is not clear for me how inclusion should work accordingly <a href=\"https://jira.hl7.org/browse/FHIR-22356?focusedCommentId=173742&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-173742\">https://jira.hl7.org/browse/FHIR-22356?focusedCommentId=173742&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-173742</a> :<br>\nFor example</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n   <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Questionnaire&quot;</span><span class=\"p\">,</span>\n   <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;parent&quot;</span><span class=\"p\">,</span>\n   <span class=\"nt\">&quot;item&quot;</span><span class=\"p\">:[</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;What is your name?&quot;</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;2&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:[</span>\n            <span class=\"p\">{</span>\n               <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/sub-questionnaire&quot;</span><span class=\"p\">,</span>\n               <span class=\"nt\">&quot;valueCanonical&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Questionnaire/children&quot;</span>\n            <span class=\"p\">}</span>\n         <span class=\"p\">],</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;display&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;This is placeholder for questionanire&quot;</span>\n      <span class=\"p\">}</span>\n   <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n   <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Questionnaire&quot;</span><span class=\"p\">,</span>\n   <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;children&quot;</span><span class=\"p\">,</span>\n   <span class=\"nt\">&quot;item&quot;</span><span class=\"p\">:[</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;2.1&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;How are you?&quot;</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;2.2&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;How old are you?&quot;</span>\n      <span class=\"p\">}</span>\n   <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n\n<p>How the result of $assembe operation should look like:</p>\n<p>Sub questionnaire should replace replace display and falt quetion into parent item</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n   <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Questionnaire&quot;</span><span class=\"p\">,</span>\n   <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;assembled&quot;</span><span class=\"p\">,</span>\n   <span class=\"nt\">&quot;item&quot;</span><span class=\"p\">:[</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;What is your name?&quot;</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;2.1&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;How are you?&quot;</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;2.2&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;How old are you?&quot;</span>\n      <span class=\"p\">}</span>\n   <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n\n<p>Or Sub questionnaire should add items into  display item</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n   <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Questionnaire&quot;</span><span class=\"p\">,</span>\n   <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;parent&quot;</span><span class=\"p\">,</span>\n   <span class=\"nt\">&quot;item&quot;</span><span class=\"p\">:[</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;What is your name?&quot;</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n         <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;2&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;item&quot;</span><span class=\"p\">:[</span>\n            <span class=\"p\">{</span>\n               <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;2.1&quot;</span><span class=\"p\">,</span>\n               <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n               <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;How are you?&quot;</span>\n            <span class=\"p\">},</span>\n            <span class=\"p\">{</span>\n               <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;2.2&quot;</span><span class=\"p\">,</span>\n               <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;text&quot;</span><span class=\"p\">,</span>\n               <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;How old are you?&quot;</span>\n            <span class=\"p\">}</span>\n         <span class=\"p\">],</span>\n         <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;display&quot;</span><span class=\"p\">,</span>\n         <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;This is placeholder for questionanire&quot;</span>\n      <span class=\"p\">}</span>\n   <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 198323755,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590069633
    },
    {
        "content": "<p>I am not sure if the child Qusetionnarre could have more than one root items, like in the previous example. I think the first result is correct. \"The expansion process will <strong>cause the display item to be replaced</strong> by the contents of the referenced questionnaire.\"</p>",
        "id": 198328882,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1590072259
    },
    {
        "content": "<p>But I am not sure if there could be more than one root items in the child questionnaire. I think yes.</p>",
        "id": 198329001,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1590072313
    },
    {
        "content": "<p>The child questionnaire can have multiple root items.  The 'display' item would be replace all root items of the child questionnaire</p>",
        "id": 198341491,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590077986
    },
    {
        "content": "<p>So, I don't get how questionnaire-constraint, variable and itemContext will be propagated to the item that contains the 'display'.<br>\n<a href=\"https://jira.hl7.org/browse/FHIR-22356?focusedCommentId=174768&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-174768\">https://jira.hl7.org/browse/FHIR-22356?focusedCommentId=174768&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-174768</a><br>\nSince the display item will be replaced by a set of items from included questionnaire.</p>",
        "id": 198349335,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590081439
    },
    {
        "content": "<p>It propagates to the item <em>containing</em> the display item.  The display item is replaced, but the thing containing it is still there.</p>",
        "id": 198350021,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1590081752
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span>  I finally get it.</p>",
        "id": 198350325,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590081917
    },
    {
        "content": "<p>Unfortunately, I will not join the workgroup meeting tonight.<br>\nIn the previous meeting we discussed Prefix-based Modularized Questionnaires. It is great!</p>\n<p>However, the issue I created initially was about two types of questionnaires.<br>\n<a href=\"https://jira.hl7.org/browse/FHIR-27132?focusedCommentId=174882&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-174882\">https://jira.hl7.org/browse/FHIR-27132?focusedCommentId=174882&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-174882</a></p>\n<p>Should there will be two types of questionnaire inclusion?<br>\nsubQuestionnaire that propagate attributes/extensions and reuseQuestionnaire that don't </p>\n<p>What do you think?</p>",
        "id": 198351254,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590082341
    },
    {
        "content": "<p>I don't see a benefit to two approaches.  If the re-use questionnaire has attributes/extensions that need propagating, then they'll have to propagate.  Having a different referencing mechanism doesn't really simplify things</p>",
        "id": 198351522,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590082488
    },
    {
        "content": "<p>Since inclusion for one questionnaire more the once allowed, it makes sense to provide different itemContext for populate operation.<br>\nAlso,  <span class=\"user-mention\" data-user-id=\"191506\">@Yunwei Wang</span> provided a case <a href=\"https://jira.hl7.org/browse/FHIR-27049\">https://jira.hl7.org/browse/FHIR-27049</a> when defining a variable that may be useful.</p>\n<p>If attribute propagation is a  default behavior there is no way to implement these two cases.</p>",
        "id": 198355512,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590084442
    },
    {
        "content": "<p>You wouldn't include the same questionnaire more than once beneath the same item</p>",
        "id": 198355820,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590084582
    },
    {
        "content": "<p>For example, if you have a questionnaire that asks questions about address (city, postal code, etc.), you might import that in multiple places, but you'd never import it multiple times in the same place</p>",
        "id": 198355930,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590084631
    },
    {
        "content": "<p>The address questionnaire is a good case.<br>\nFor example, I create a form for patient resource.<br>\nI need to include the address questionnaire twice for patient's address and for patient contats' adresses.<br>\nFor patient's address I need itemContext = %LaunchPatient.address<br>\nFor patient contacts' address, I need  set itemContext=%LaunchPatient.contact on contact group level<br>\nthen set itemContext= address before the inclussion of a questionanire.</p>\n<p>If I don't provide  itemContext for address questionnaire I will get a questionnaire that can be used only for inclusion.<br>\nif I  provide  itemContext for address questionnaire it will clash with itemContext from parent questionnaire and cause an error.</p>\n<p>Here is a full example <br>\n<a href=\"https://github.com/beda-software/aidbox-sdc/blob/master/tests/sdc/test_assemble.py#L122\">https://github.com/beda-software/aidbox-sdc/blob/master/tests/sdc/test_assemble.py#L122</a></p>",
        "id": 198357641,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590085496
    },
    {
        "content": "<p>Right.  So in that case, you wouldn't declare the itemContext in your child questionnaire - you'd define it on the parent element of the display that references the child questionnaire.  That's a design choice, but not one that drives a different referencing mechanism</p>",
        "id": 198363017,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590088207
    },
    {
        "content": "<p>What we <em>might</em> want to do is frag a Questionnaire as being a 'fragment' - i.e. you shouldn't try to validate everything in the Questionnaire.  Alternatively, we could put extensions in the child questionnaire that explicitly indicate what contexts need to be available in the location where it's einvoked</p>",
        "id": 198363145,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590088272
    },
    {
        "content": "<blockquote>\n<p>What we might want to do is frag a Questionnaire as being a 'fragment' - i.e. you shouldn't try to validate everything in the Questionnaire. Alternatively, we could put extensions in the child questionnaire that explicitly indicate what contexts need to be available in the location where it's einvoked</p>\n</blockquote>\n<p>Sounds good</p>",
        "id": 198366793,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590090125
    },
    {
        "content": "<p>Would you like to submit a change request to that effect?</p>",
        "id": 198373186,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590093098
    },
    {
        "content": "<p>Sure, may I update the document <a href=\"https://confluence.hl7.org/display/FHIRI/Prefix-based+Modularized+Questionnaires\">https://confluence.hl7.org/display/FHIRI/Prefix-based+Modularized+Questionnaires</a> and gather all details there?<br>\nOr should I submit a ticket first?</p>",
        "id": 198402248,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590116850
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Could you please advise?</p>",
        "id": 198725724,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1590476240
    },
    {
        "content": "<p>Sorry.  Feel free to update the Confluence page</p>",
        "id": 198778732,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590506711
    },
    {
        "content": "<p>Hi!</p>\n<p>I updated the document <a href=\"https://confluence.hl7.org/display/FHIRI/Prefix-based+Modularized+Questionnaires\">https://confluence.hl7.org/display/FHIRI/Prefix-based+Modularized+Questionnaires</a><br>\nReview and feedback are appreciated<br>\nAs a next step, I am going to replace the example section with actual FHIR resources.</p>\n<p>I also implemented described spec <a href=\"https://github.com/beda-software/aidbox-sdc/blob/master/app/operations/assemble.py\">https://github.com/beda-software/aidbox-sdc/blob/master/app/operations/assemble.py</a></p>",
        "id": 199710610,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1591253295
    },
    {
        "content": "<p>It seems that <a href=\"https://confluence.hl7.org/display/FHIRI/Prefix-based+Modularized+Questionnaires\">https://confluence.hl7.org/display/FHIRI/Prefix-based+Modularized+Questionnaires</a> is not a part of SDC. Are we going to include it in the release?</p>",
        "id": 239378450,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1621409170
    },
    {
        "content": "<p>It looks like the changes <a href=\"http://jira.hl7.org/browse/FHIR-22356\">FHIR-22356</a> are approved but not yet applied.  I think the plan is to get all approved changes for SDC into the IG before publication.</p>",
        "id": 239400636,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1621420668
    },
    {
        "content": "<p>this will be a SDC for FHIR R4 feature right.  and what is this timeline?</p>",
        "id": 244210906,
        "sender_full_name": "Eric Haas",
        "timestamp": 1624918201
    },
    {
        "content": "<p>That sounded like you were asking the foolish question of \"when will SDC be published?\" :)   Soon, I hope...</p>",
        "id": 244211086,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624918295
    },
    {
        "content": "<p>will modularizing be in there for fhir R4?</p>",
        "id": 244211183,
        "sender_full_name": "Eric Haas",
        "timestamp": 1624918355
    },
    {
        "content": "<p>y</p>",
        "id": 244211198,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624918372
    },
    {
        "content": "<p>I have a use case for modular questionnaires. Is the above solution implemented in some tooling folks can share? thanks!</p>",
        "id": 254562645,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1632413900
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"194192\">@Richard Stanley</span> <br>\nThank you for asking.</p>\n<p>Here is an implementation of assemble operation <a href=\"https://github.com/beda-software/aidbox-sdc/blob/master/app/operations/assemble.py\">https://github.com/beda-software/aidbox-sdc/blob/master/app/operations/assemble.py</a></p>\n<p>It is a part of aidbox-sdc.</p>",
        "id": 254904873,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1632638042
    }
]