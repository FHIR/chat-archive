[
    {
        "content": "<p>Lloyd,</p>\n<p>Can the topic of validation of QRs against Questionnaires that have populate and enableWhen expressions be added to the SDC call agenda for Thursday?    I also think the topic suggested by   <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>      will be interesting.</p>\n<p>I have more than enableWhen's.  I also have answerExpressions for dropdowns coming from the parent Questionnaire Response which are creating messages from the IG validator.</p>\n<p>I understand that the IG validator cannot look at the parent Questionnaire nor the parent QuestionnaireResponse.   I still want to explore ideas other than the workaround of hard-coding  every populate or enableWhen expression question with an initial value in order for the example QRs to meet the test of the IG validator.</p>\n<p>If the IG validator validates the child QRs against their respective child Questionnaire, couldn't the example data be hard-coded into a variable in the child Questionnaire?    Or can the IG validation code running on the child QR  not see any variables in its respective Questionnaire?</p>\n<p>Even if I have to use your workaround for the IG to be published,  I think SDC needs to look at options for possible resolution because now that SDC 3.0 is published,  more implementers will be using expressions in their Questionnaires and their IGs could run up against this same issue.</p>",
        "id": 275438058,
        "sender_full_name": "Diane",
        "timestamp": 1647379785
    },
    {
        "content": "<p>Is the issue that the IG validator is complaining that questions with answerExpression do not have a list?</p>",
        "id": 275439316,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1647380370
    },
    {
        "content": "<p>We can certainly talk about that on Thursday.<br>\nAnswerExpression is similarly not something you typically want to depend on launch context.</p>",
        "id": 275443880,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1647383174
    },
    {
        "content": "<p>I am still unable to get the list of sites from the drop-down to copy from the parent questionnaire to a local questionnaire question and then from the local questionnaire question to another local question. (See Tests C1-C9 in the TestResults1 screen shot.)</p>\n<p>I was able to get the drop down list from a local question to populate into another local question's drop down list using:</p>\n<p>answerExpression: %questionnaire.descendants().where(linkId='mae10.1.1').answerOption.valueCoding  or answerExpression: %questionnaire.descendants().where(linkId='mae10.1.1').answerOption.value</p>\n<p>It seems that  initialExpression: %questionnaire.descendants().where(linkId='mae10.1.1').answerOption.valueCoding   seems to just copy in the one value \"Yes\"  but not the whole coding.</p>\n<p>initialExpression: %resource.descendants().where(linkId='mae10.1.1').answerOption.value   doesn't work at all (Test K5)</p>\n<p>calculatedExpression: %resource.descendants().where(linkId='mae10.1.1').answer.valueCoding   only returns the value selected in the dropdown \"No\"  but not the whole coding.  (TestE3)</p>\n<p>(See screen shots TestResults2 and TestResults3).</p>\n<p>Ultimately, I was able to get a Yes/No drop down list to copy from the parent questionnaire to a local questionnaire questionnaire and then from a local questionnaire question to another local question.</p>\n<p>I used answerExpression: %questionnaire.descendants().where(linkId='mae1.4').answerOption.valueCoding.  answerExpression: %questionnaire.descendants().where(linkId='mae1.4').answerOption.value works as well.</p>\n<p>See Tests R1 and R4  in the TestResults3 screen shot.</p>\n<p>Using that same syntax for Test S1 and S4  did not result in a drop down list.</p>\n<p>%questionnaire.descendants().where(linkId='mae4.1.1').answerOption.valueCoding. </p>\n<p>I think that the problem is trying to bring in data from the site list from the parent questionnaire  vs trying to bring in data from a Yes/No question.</p>\n<p>Tests R1 and R4 are based on mae1.4 which gets data from the parent questionnaire via  %lookupInitiateStudy.descendants().where(linkId = 'in9.1').answer.valueCoding.  </p>\n<p>Link ID in9.1  in the parent questionnaire looks very basic:</p>\n<p>\"item\": [ {<br>\n      \"extension\": [ {<br>\n        \"url\": \"<a href=\"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl\">http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl</a>\",<br>\n        \"valueCodeableConcept\": {<br>\n          \"coding\": [ {<br>\n            \"system\": \"<a href=\"http://hl7.org/fhir/questionnaire-item-control\">http://hl7.org/fhir/questionnaire-item-control</a>\",<br>\n            \"code\": \"drop-down\",<br>\n            \"display\": \"Drop down\"<br>\n          } ],<br>\n          \"text\": \"Drop down\"<br>\n        }<br>\n      } ],<br>\n      \"linkId\": \"in9.1\",<br>\n      \"text\": \"Does this study require a FDA exemption?\",<br>\n      \"type\": \"choice\",<br>\n      \"answerOption\": [ {<br>\n        \"valueCoding\": {<br>\n          \"system\": \"<a href=\"http://terminology.hl7.org/CodeSystem/v2-0532\">http://terminology.hl7.org/CodeSystem/v2-0532</a>\",<br>\n          \"code\": \"Y\",<br>\n          \"display\": \"Yes\"<br>\n        }<br>\n      }, {<br>\n        \"valueCoding\": {<br>\n          \"system\": \"<a href=\"http://terminology.hl7.org/CodeSystem/v2-0532\">http://terminology.hl7.org/CodeSystem/v2-0532</a>\",<br>\n          \"code\": \"N\",<br>\n          \"display\": \"No\"<br>\n        }<br>\n      } ]<br>\n}</p>\n<p>But, the test questions like S1 and S2  and C1-C9  are based on question mae4.1.1   which gets  data from the parent questionnaire via   %lookupInitiateStudy.descendants().where(linkId = 'in8.9').answer.value</p>\n<p>LinkId in8.9 in the parent questionnaire is part of a repeating group.  I have attached the questionnaire definitions for link ID in8.9.</p>\n<p>Although the child questionnaire doesn't have a problem with making an open-choice question from the parent questionnaire using answerExpression %lookupInitiateStudy.descendants().where(linkId = 'in8.9').answer.value,  it doesn't seem like the local question in the child questionnaire knows what to do with a question based on this type of dynamic pick list.</p>\n<p>The answer in the QR for link ID mae4.1.1  looks like this:</p>\n<div class=\"codehilite\"><pre><span></span><code> &quot;linkId&quot;: &quot;mae4.1.1&quot;,\n        &quot;text&quot;: &quot;LinkID: mae4.1.1  [Getting data from parent questionnnaire]  answerExpression:  %lookupInitiateStudy.descendants().where(linkId = &#39;in8.9&#39;).answer.value&quot;,\n        &quot;answer&quot;: [ {\n          &quot;valueCoding&quot;: {\n            &quot;display&quot;: &quot;University of Nebraska Medical Center  |  Gastroenterology  |  George Garcia, MD  |  Omaha, NE&quot;\n          }\n        } ]\n      },\n</code></pre></div>\n<p>Could there be a problem with using data from mae4.1.1  in a subsequent question because there is no answer.valueCoding.code? </p>\n<p>What do I do now?</p>\n<p><a href=\"/user_uploads/10155/1ehd00EdMy65KZ9g8-38I9re/test-questions-for-copying-answer-to-next-question.json\">test-questions-for-copying-answer-to-next-question.json</a> <a href=\"/user_uploads/10155/N0K0c7b9zQg_A7HPE8uYz-JZ/TestResults1.png\">TestResults1.png</a> <a href=\"/user_uploads/10155/ota5Puo5zpy_quO3F4M6whGH/TestResults2.png\">TestResults2.png</a> <a href=\"/user_uploads/10155/KMrpuMpCMccr-cK4jBYTCjPi/TestResults3.png\">TestResults3.png</a> <a href=\"/user_uploads/10155/ZRzIg_hCNCmLpI2HIf7GgTG8/questionnaire-definitions-for-linkId-in8.9.txt\">questionnaire-definitions-for-linkId-in8.9.txt</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/N0K0c7b9zQg_A7HPE8uYz-JZ/TestResults1.png\" title=\"TestResults1.png\"><img src=\"/user_uploads/10155/N0K0c7b9zQg_A7HPE8uYz-JZ/TestResults1.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/ota5Puo5zpy_quO3F4M6whGH/TestResults2.png\" title=\"TestResults2.png\"><img src=\"/user_uploads/10155/ota5Puo5zpy_quO3F4M6whGH/TestResults2.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/KMrpuMpCMccr-cK4jBYTCjPi/TestResults3.png\" title=\"TestResults3.png\"><img src=\"/user_uploads/10155/KMrpuMpCMccr-cK4jBYTCjPi/TestResults3.png\"></a></div>",
        "id": 277097214,
        "sender_full_name": "Diane",
        "timestamp": 1648619512
    },
    {
        "content": "<p>You don't want to populate the drop-down-list  from the parent into the drop-down-list for the child.  You want to populate the <em>answers</em> of the child with the list of information from the parent.  There won't be a drop-down-list for the child - it'll be open to everything.  That's step one.  So you need to be using the initial-value extension (<em>not</em> answerExpression) on the question.  Once that works, we can then work on using the answers for question 1 as a dropdown for question 2.</p>",
        "id": 277172418,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1648658431
    },
    {
        "content": "<p>Two questions:</p>\n<ol>\n<li>\n<p>Does the attached Step1 Diagram.png depict what I am supposed to be doing in Step 1?</p>\n</li>\n<li>\n<p>Is TestA1 in Step1 Results.png  initialExpression: %lookupInitiateStudy.descendants().where(linkId = 'in8.9').answer.value  how a correct Step 1 will look?  The form will have a blank where the answer and the drop down should be? <a href=\"/user_uploads/10155/G68w9pd-MYgdD_6FUbdO0dQ3/Step1-Diagram.png\">Step1-Diagram.png</a> <a href=\"/user_uploads/10155/g3l0vVreBGKTqrKNaCxqbgvc/Step1-Results.png\">Step1-Results.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/G68w9pd-MYgdD_6FUbdO0dQ3/Step1-Diagram.png\" title=\"Step1-Diagram.png\"><img src=\"/user_uploads/10155/G68w9pd-MYgdD_6FUbdO0dQ3/Step1-Diagram.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/g3l0vVreBGKTqrKNaCxqbgvc/Step1-Results.png\" title=\"Step1-Results.png\"><img src=\"/user_uploads/10155/g3l0vVreBGKTqrKNaCxqbgvc/Step1-Results.png\"></a></div></li>\n</ol>",
        "id": 277202597,
        "sender_full_name": "Diane",
        "timestamp": 1648673626
    },
    {
        "content": "<p>I am confused about the diagram, which seems to indicate that the list of a question in the parent questionnaire is being used in the child questionnaire.  I thought it was that the answers from a question the parent questionnaire were being used as a list for a question in the child questionnaire.</p>",
        "id": 277203061,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1648673907
    },
    {
        "content": "<p>Also, where you have initialExpression and the expression might provide more than one value, you probably want to set \"repeats\" to true.</p>",
        "id": 277203524,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1648674133
    },
    {
        "content": "<p>You can remove the test cases where the expressions end in \".answer\".   It should be \"answer.value\", though LHC-Forms also handles \"answer.valueCoding\".</p>",
        "id": 277203791,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1648674307
    },
    {
        "content": "<p>I tried replace the launchContext as the source of the parent QR with a \"contained\" QR with one question answered with \"blue\" and \"green\", and that seems to be working in the way I would expect:<br>\n<a href=\"/user_uploads/10155/kKCPfyr7mhKmBX0la3fn0o_9/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/kKCPfyr7mhKmBX0la3fn0o_9/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/kKCPfyr7mhKmBX0la3fn0o_9/image.png\"></a></div>",
        "id": 277204232,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1648674574
    },
    {
        "content": "<p>Lloyd says:</p>\n<blockquote>\n<p>You don't want to populate the drop-down-list from the parent into the drop-down-list for the child.  You want to populate the answers of the child with the list of information from the parent. </p>\n</blockquote>\n<p>So, I think that I need to put the site list into the answers in the child questionnaire (and not use the answerExpression).   I am also not sure if I need an interim question between the question in the parent questionnaire that collects the site details  to this workaround.   The interim question would put the site list into a drop down list.  I have attached a new diagram without an interim question.   <a href=\"/user_uploads/10155/xPrQ61Tp38ZGnxq6Dpc6-OMW/Step-1-Diagram-Version-2.png\">Step-1-Diagram-Version-2.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/xPrQ61Tp38ZGnxq6Dpc6-OMW/Step-1-Diagram-Version-2.png\" title=\"Step-1-Diagram-Version-2.png\"><img src=\"/user_uploads/10155/xPrQ61Tp38ZGnxq6Dpc6-OMW/Step-1-Diagram-Version-2.png\"></a></div>",
        "id": 277207697,
        "sender_full_name": "Diane",
        "timestamp": 1648676560
    },
    {
        "content": "<p>That diagram looks like it will work, but I thought your goal was to have people select from a list of those answers in the child questionnaire.  In that case, you would want a second question in the child questionnaire that uses answerExpression to create a list based on the answers from the purple question in your diagram.</p>",
        "id": 277213794,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1648681320
    },
    {
        "content": "<p>I'm attaching an example based on your test form, in case that is what you meant to do.  It works in the latest LHC-Forms. (<a href=\"https://jsfiddle.net/jp1bwouc/\">https://jsfiddle.net/jp1bwouc/</a>)<br>\n<a href=\"/user_uploads/10155/spmsr39bynS6ssbKvlwO1fL5/test-questions-edit.json\">test-questions-edit.json</a></p>",
        "id": 277218019,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1648685151
    },
    {
        "content": "<p>BTW, you might notice the example uses descendants() in the expressions rather than repeat(item) which we noted on last week's call would be more efficient.  Unfortunately, while making that example, I found that fhirpath.js currently has a bug which causes an expression like %someVar.repeat(item) to destroy the value of %someVar, so descendants() is a work-around.  I hope we can get a fix for that out soon.</p>",
        "id": 277218353,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1648685418
    },
    {
        "content": "<p>Paul,</p>\n<p>This helps A LOT!  Many thanks!</p>\n<p>I have taken your contained resource and replaced it with my parent questionnaire response (just item in8 which is the repeating group of sites). </p>\n<p>See  <a href=\"https://jsfiddle.net/o053rsdh/\">https://jsfiddle.net/o053rsdh/</a>     which is not working.</p>\n<p>I tested the fhirpath. See fhirpath js screen shot.png,  from my page which runs fhirpath js  and the fhirpath syntax seems to work.  I don't know why LinkID: answersFromParentQR   in the fiddle is not working.</p>\n<p>I haven't tried to convert to repeat(item) yet. I wanted to wait until I got the syntax for this problem fixed first.  <a href=\"/user_uploads/10155/3zdvXGmdPHZL3slIyC3db7yM/fhirpath-js-screen-shot.png\">fhirpath-js-screen-shot.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/3zdvXGmdPHZL3slIyC3db7yM/fhirpath-js-screen-shot.png\" title=\"fhirpath-js-screen-shot.png\"><img src=\"/user_uploads/10155/3zdvXGmdPHZL3slIyC3db7yM/fhirpath-js-screen-shot.png\"></a></div>",
        "id": 277331874,
        "sender_full_name": "Diane",
        "timestamp": 1648756549
    },
    {
        "content": "<p>The difference seems to be that your \"in8.9\" questions have answer.valueString instead of answer.valueCoding as in my example.  I think valueString should be usable with answerExpression in a question of type open-choice, so I think is probably an LHC-Forms bug.  In the parent questionnaire, what is the type of question linkId = \"in8.9\", and how did it come to have a valueString answer?</p>",
        "id": 277335275,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1648758285
    },
    {
        "content": "<p>in8.9  is a derived (and hidden) field.  It is a concatenation of the questions for the institution name. the department, the PI first name, PI last name, PI degrees, PI city and PI state, with pipe separators. It is not a code because it doesn't originate from a choice question.  It comes from the repeating group (in8) where the user inputs all of the potential sites for the study being originated.</p>\n<p>Then, in8.9  is used in all of the child forms to make the drop-down where the user selects the site that the child questionnaire pertains to.</p>\n<p>In a future state, the candidateExpression extension would be used to list the site choices in the child questionnaires.</p>\n<p><a href=\"/user_uploads/10155/F2yI3-Md9Hn8u0RUJPnaf77J/repeating-group-in-parent.png\">repeating-group-in-parent.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/F2yI3-Md9Hn8u0RUJPnaf77J/repeating-group-in-parent.png\" title=\"repeating-group-in-parent.png\"><img src=\"/user_uploads/10155/F2yI3-Md9Hn8u0RUJPnaf77J/repeating-group-in-parent.png\"></a></div><p><a href=\"/user_uploads/10155/COXT1gmyxPCBjTioKTjAOlvB/child-drop-down-select-site.png\">child-drop-down-select-site.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/COXT1gmyxPCBjTioKTjAOlvB/child-drop-down-select-site.png\" title=\"child-drop-down-select-site.png\"><img src=\"/user_uploads/10155/COXT1gmyxPCBjTioKTjAOlvB/child-drop-down-select-site.png\"></a></div>",
        "id": 277337995,
        "sender_full_name": "Diane",
        "timestamp": 1648759759
    },
    {
        "content": "<p>I might need an extra interim hidden question somewhere to put the sites into a dropdown using answerExpression  so that they can be used in the initialExpression answersFromParentQR   hidden question?</p>",
        "id": 277339465,
        "sender_full_name": "Diane",
        "timestamp": 1648760519
    },
    {
        "content": "<p>No.  You shouldn't have to have an initialExpression for the answers from parent.  Key is that it needs to function as an 'extensible' list, or alternatively, that the expression just evaluates to what's already there.</p>",
        "id": 277339637,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1648760609
    }
]