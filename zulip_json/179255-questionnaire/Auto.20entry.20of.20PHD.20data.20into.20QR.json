[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span>    This thread is a continuation. Inspired by the last SDC WG call. It is rather long....</p>\n<p>The use case is quite simple:<br>\nA patient in a home environment retrieves a questionnaire that instructs the patient to take a measurement with a communicating Personal Health Device. For the moment I am going to ignore the cases of what happens if the device does not exist, doesn't work, or other related problems.  So the patient takes the measurement, and the desired data is automatically entered into the QR and the QR is automatically linked to the FHIR Observations generated from the PHD. So the QR contains BOTH the measurement values and the links. Based upon use cases in the field, there is a strong desire to have both - the 80% use case looking at 'trusted' input data in the answers (not manually entered). The other 20% for when further details are needed and the full Observation resources have to be accessed.</p>\n<p>The Questionnaire may also 'pop up' in response to a measurement taken; in other words, it is resident on the application host and triggered under the right conditions.</p>\n<p>How would I do this? Without knowing about any other IG or workflow this is what I would do</p>\n<ul>\n<li>Hidden with that faithful question in the questionnaire would be a set of MDC (Medical Device Codes) that would specify<ul>\n<li>the device type</li>\n<li>the measurements desired</li>\n<li>device information desired<br>\nI am assuming there is some way to attach those codes to the Questionnaire question that the patient would not have to know about.</li>\n</ul>\n</li>\n</ul>\n<p>The patient would take the measurement. Clearly the application must be able to extract information from the questionnaire and it must be able to communicate with the PHDs and decode that data. Since PHDs provide the MDC codes, such an application could </p>\n<ul>\n<li>validate the device type</li>\n<li>select the desired measurements</li>\n<li>select the desired device information</li>\n</ul>\n<p>given that the Questionnaire has the MDC codes.</p>\n<p>Now what? At this point the application only consists of language objects or structs representing the QR and the PHDData. The application is already capable of generating the Observation and Device resources from the PHDData based upon the PHD IG. What is new is creating the QR resource and filling in that QR answer with the values from the PHDData and linking that QR answer to the Observation and Device resources generated by the PHDData.</p>\n<p>The way I actually did this was to create a transaction Bundle with the PHDData resources following the PHD IG with the addition of the QR. The QR answer would reference the relevant Observations in the Bundle and it would have the desired values in answers. The QR would have both. Of course, all references are temporary at this time and will not be resolved to their final state until the transaction is processed at the server.</p>\n<p>The entire sequence except perhaps the retrieval of the Questionnaire and the final upload could happen offline. Connectivity in some countries and locations is either spotty or expensive or both.</p>\n<p>Now that is how I would do it having complete ignorance about any other work flows.</p>\n<p>What I would like to request is how to handle such a use case making use of SDC workflows.</p>",
        "id": 264573529,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1639243175
    },
    {
        "content": "<p>A Questionnaire \"popping up\" is completely outside of the SDC space.  SDC only comes into play once a user is already filling out a Questionnaire.    Within a Questionnaire, I think the only piece needed is an extension that essentially says 'populate now' which could appear on the context elements to be retrieved.  The form filler can grab them from a device directly, allow the user to select them from a local file on their system or grab recent data from the server.  Once the observation(s) for that group have been grabbed, they can serve as answers to questions and/or have information extracted from them to answer questions.  Whether those answers are hidden, read-only or editable would be up to the form designer</p>",
        "id": 264594233,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639269429
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> That aside how would one pose the question? Should one create a group where the code is the MDC code base for specializations? This code would indicate to the renderer that this group is related to getting data from a communicating PHD.</p>",
        "id": 265022973,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1639581036
    },
    {
        "content": "<p>You'd have a code (MDC or otherwise) on the relevant questions within the Group that had the 'trigger' extension on it.  When a user invoked the trigger, the client would do its best to fill the questions as best it could.  If it knows that a particular device provides data for a particular MDC, LOINC, or some other code, then it can hit the device for that data.</p>",
        "id": 265068650,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639599114
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span><br>\nIn last Thursday's meeting for SDC you mentioned this extension set to specify behavior</p>\n<div class=\"codehilite\"><pre><span></span><code>  &lt;extension url=&quot;real-time-collection&quot;&gt;\n    &lt;extension url=&quot;code&quot;&gt;\n      &lt;valueCoding&gt;\n      ...\n      &lt;/valueCoding&gt;\n    &lt;/extension&gt;\n    &lt;extension url=&quot;name&quot;&gt;\n      &lt;valueString value=&quot;variable123&quot;&gt;\n    &lt;/extension&gt;\n  &lt;/extension&gt;\n  &lt;extension url=&quot;real-time-collection&quot;&gt;\n    ...\n  &lt;/extension&gt;\n</code></pre></div>\n<p>What was the purpose of the 'name' extension? I understand the 'code' extension as being the set of codes that are going to instruct the renderer which device types and which measurements to autopopulate and link to the QR. But I don't recall the purpose of the 'name'.</p>",
        "id": 265561386,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1640006632
    },
    {
        "content": "<p>The name is what exposes what's been retrieved for subsequent use in FHIRPath to populate question answers and/or control Questionnaire logic.</p>",
        "id": 265576487,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1640013622
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Little confused there. I will submit some attempts. I have finally implemented support for Q and QRs in my gateway.</p>",
        "id": 265698570,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1640100997
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> I have created two questionnaire entries but I am a little unsure of what the name case should do</p>\n<p>Here is the extension variant</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Questionnaire&quot;,\n  &quot;item&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;extension&quot;: [\n            {\n              &quot;url&quot;: &quot;mdc-device-code&quot;,\n              &quot;valueCodeableConcept&quot;: {\n                &quot;coding&quot;: [\n                  {\n                    &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                    &quot;code&quot;: &quot;528391&quot;,\n                    &quot;display&quot;: &quot;MDC_DEV_SPEC_PROFILE_BP&quot;\n                  }\n                ]\n              }\n            },\n            {\n              &quot;url&quot;: &quot;mdc-msmt-code&quot;,\n              &quot;valueCodeableConcept&quot;: {\n                &quot;coding&quot;: [\n                  {\n                    &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                    &quot;code&quot;: &quot;150021&quot;,\n                    &quot;display&quot;: &quot;MDC_PRESS_BLD_NONINV_SYS&quot;\n                  }\n                ]\n              }\n            },\n            {\n              &quot;url&quot;: &quot;name&quot;,\n              &quot;valueString&quot;: &quot;Some Name&quot;\n            }\n          ],\n          &quot;url&quot;: &quot;real-time-collection&quot;\n        }\n      ],\n      &quot;text&quot;: &quot;Get the Systolic pressure from your Blood pressure device&quot;,\n      &quot;type&quot;: &quot;group&quot;,\n      &quot;item&quot;: [\n        {\n          &quot;text&quot;: &quot;When the systolic blood pressure value has been received it will be automatically entered into the response&quot;,\n          &quot;type&quot;: &quot;display&quot;\n        },\n        {\n          &quot;linkId&quot;: &quot;BP.sys&quot;,\n          &quot;code&quot;: [\n            {\n              &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n              &quot;code&quot;: &quot;150021&quot;,\n              &quot;display&quot;: &quot;MDC_PRESS_BLD_NONINV_SYS&quot;\n            }\n          ],\n          &quot;text&quot;: &quot;The device data systolic pressure will be automaticially entered&quot;,\n          &quot;type&quot;: &quot;quantity&quot;,\n          &quot;item&quot;: [\n            {\n              &quot;linkId&quot;: &quot;BP.sys.Ref&quot;,\n              &quot;text&quot;: &quot;The Observation resource reference for the systolic pressure will beautomatically entered&quot;,\n              &quot;type&quot;: &quot;reference&quot;\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n</code></pre></div>\n<p>And here is one without using extensions that I was originally thinking</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Questionnaire&quot;,\n  &quot;item&quot;: [\n    {\n      &quot;code&quot;: [\n        {\n          &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n          &quot;code&quot;: &quot;528391&quot;,\n          &quot;display&quot;: &quot;MDC_DEV_SPEC_PROFILE_BP&quot;\n        }\n      ],\n      &quot;text&quot;: &quot;Take a measurement with your Blood pressure device&quot;,\n      &quot;type&quot;: &quot;group&quot;,\n      &quot;item&quot;: [\n        {\n          &quot;text&quot;: &quot;When the systolic blood pressure value has been received it will be automatically entered into the response&quot;,\n          &quot;type&quot;: &quot;display&quot;\n        },\n        {\n          &quot;linkId&quot;: &quot;BP.sys&quot;,\n          &quot;code&quot;: [\n            {\n              &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n              &quot;code&quot;: &quot;150021&quot;,\n              &quot;display&quot;: &quot;MDC_PRESS_BLD_NONINV_SYS&quot;\n            }\n          ],\n          &quot;text&quot;: &quot;The device data systolic pressure will be automatically entered&quot;,\n          &quot;type&quot;: &quot;quantity&quot;,\n          &quot;item&quot;: [\n            {\n              &quot;linkId&quot;: &quot;BP.sys.Ref&quot;,\n              &quot;text&quot;: &quot;The Observation resource reference for the systolic pressure will be automatically entered&quot;,\n              &quot;type&quot;: &quot;reference&quot;\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n</code></pre></div>",
        "id": 266845658,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1641320975
    },
    {
        "content": "<p>I wouldn't use an extension called \"deviceCode\".  What you're really wanting to do is say \"go get the following observation and store it in variable X\".  The extension shouldn't be specific to observations coming from devices and definitely shouldn't be specific to mdc.</p>",
        "id": 266868130,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1641332691
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  Is that where the 'name' extension comes in? It tells the name of the variable to store it in, for example valueQuantity? I am trying to link the pieces together. Still not quite sure what you have in mind. What I have as the two mdc codes should be one code which is to tell my application the specifics of the real time collection. When the application sees the MDC codes in the valueCodeableConcept that indicates this is to get data from a PHD. The name extension  will have in the valueString 'valueQuantity'?</p>",
        "id": 266870141,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1641333779
    },
    {
        "content": "<p>You'll have a complex extension with two child extensions - one with a valueString (name) and one with a valueCoding (observationCode).</p>",
        "id": 266878714,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1641338932
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span>    Does this capture the idea?</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Questionnaire&quot;,\n  &quot;item&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;extension&quot;: [    // Lists the items to be collected.\n            {               // There is no &#39;link-id-for-collectable&#39; extension which means the PHD info is not\n                            // collected.\n              &quot;url&quot;: &quot;collectable-item&quot;,    // This entry tells the application which type of PHD is to be used\n              &quot;valueCodeableConcept&quot;: {\n                &quot;coding&quot;: [\n                  {\n                    &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                    &quot;code&quot;: &quot;528391&quot;,\n                    &quot;display&quot;: &quot;MDC_DEV_SPEC_PROFILE_BP&quot;\n                  }\n                ]\n              }\n            },\n            {\n              &quot;extension&quot;: [    // Lists where to put the results. There will be two locations for the results\n                {\n                  &quot;url&quot;: &quot;link-id-for-collectable&quot;,    // The first location is given by the answer type in link-id &#39;BP.sys.Quant&#39;\n                  &quot;valueString&quot;: &quot;BP.sys.Quant&quot;        // which is of type &#39;valueQuantity&#39; and therefore the systolic value\n                },                                     // and units retrieved from the PHD can be loaded\n                {\n                  &quot;url&quot;: &quot;link-id-for-collectable&quot;,    // The second location is given by the answer type in link-id BP.Observation.Ref\n                  &quot;valueString&quot;: &quot;BP.Observation.Ref&quot;  // which is of type Reference. The Observation Resource for the BP msmt will go\n                }                                      // here\n              ],\n              &quot;url&quot;: &quot;collectable-item&quot;,    // This entry tells the application which msmt is to be collected\n              &quot;valueCodeableConcept&quot;: {\n                &quot;coding&quot;: [\n                  {\n                    &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                    &quot;code&quot;: &quot;150021&quot;,\n                    &quot;display&quot;: &quot;MDC_PRESS_BLD_NONINV_SYS&quot;\n                  }\n                ]\n              }\n            }\n          ],\n          &quot;url&quot;: &quot;real-time-collection&quot;\n        }\n      ],\n      &quot;text&quot;: &quot;Get the Systolic pressure from your Blood pressure device&quot;,\n      &quot;type&quot;: &quot;group&quot;,\n      &quot;item&quot;: [\n        {\n          &quot;text&quot;: &quot;When the systolic blood pressure value has been received it will be automatically entered into the response&quot;,\n          &quot;type&quot;: &quot;display&quot;\n        },\n        {\n          &quot;linkId&quot;: &quot;BP.sys.Quant&quot;,\n          &quot;text&quot;: &quot;The device data systolic pressure will be automatically entered&quot;,\n          &quot;type&quot;: &quot;quantity&quot;,\n          &quot;item&quot;: [\n            {\n              &quot;linkId&quot;: &quot;BP.Observation.Ref&quot;,\n              &quot;text&quot;: &quot;The Observation resource reference for the systolic pressure will be automatically entered&quot;,\n              &quot;type&quot;: &quot;reference&quot;\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n</code></pre></div>\n<p>The 'real-time-collectable' extension has two 'collectable-item' sub-extensions indicating what is to be collected. The 'collectable-item' sub-extension has itself two 'link-id-for-collectable' extensions indicating where to put the collectable item. The first collectable-item sub extension has no 'link-id-for-collectable' extension since there is no device information that is to be inserted into the answer.</p>\n<p>Perhaps a better approach would be to have three collectable item sub extensions, one for the device, the other for the msmt, and the third for the Observation resource. Something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Questionnaire&quot;,\n  &quot;item&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;extension&quot;: [\n            {\n              &quot;url&quot;: &quot;collectable-item&quot;,\n              &quot;valueCodeableConcept&quot;: {\n                &quot;coding&quot;: [\n                  {\n                    &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                    &quot;code&quot;: &quot;528391&quot;,\n                    &quot;display&quot;: &quot;MDC_DEV_SPEC_PROFILE_BP&quot;\n                  }\n                ]\n              }\n            },\n            {\n              &quot;extension&quot;: [\n                {\n                  &quot;url&quot;: &quot;link-id-for-collectable&quot;,\n                  &quot;valueString&quot;: &quot;BP.sys.Quant&quot;\n                }\n              ],\n              &quot;url&quot;: &quot;collectable-item&quot;,\n              &quot;valueCodeableConcept&quot;: {\n                &quot;coding&quot;: [\n                  {\n                    &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                    &quot;code&quot;: &quot;150021&quot;,\n                    &quot;display&quot;: &quot;MDC_PRESS_BLD_NONINV_SYS&quot;\n                  }\n                ]\n              }\n            },\n            {\n              &quot;extension&quot;: [\n                {\n                  &quot;url&quot;: &quot;link-id-for-collectable&quot;,\n                  &quot;valueString&quot;: &quot;BP.Observation.Ref&quot;\n                }\n              ],\n              &quot;url&quot;: &quot;collectable-item&quot;,\n              &quot;valueCodeableConcept&quot;: {\n                &quot;coding&quot;: [\n                  {\n                    &quot;system&quot;: &quot;http://hl7.org/fhir/&quot;,\n                    &quot;code&quot;: &quot;observation.html&quot;\n                  }\n                ],\n                &quot;text&quot;: &quot;FHIR Observation resource&quot;\n              }\n            }\n          ],\n          &quot;url&quot;: &quot;real-time-collection&quot;\n        }\n      ],\n      &quot;text&quot;: &quot;Get the Systolic pressure from your Blood pressure device&quot;,\n      &quot;type&quot;: &quot;group&quot;,\n      &quot;item&quot;: [\n        {\n          &quot;text&quot;: &quot;When the systolic blood pressure value has been received it will be automatically entered into the response&quot;,\n          &quot;type&quot;: &quot;display&quot;\n        },\n        {\n          &quot;linkId&quot;: &quot;BP.sys.Quant&quot;,\n          &quot;text&quot;: &quot;The device data systolic pressure will be automatically entered&quot;,\n          &quot;type&quot;: &quot;quantity&quot;,\n          &quot;item&quot;: [\n            {\n              &quot;linkId&quot;: &quot;BP.Observation.Ref&quot;,\n              &quot;text&quot;: &quot;The Observation resource reference for the systolic pressure will be automatically entered&quot;,\n              &quot;type&quot;: &quot;reference&quot;\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n</code></pre></div>\n<p>A total aside - I kind of wish extensions were last in some sense so that the sub-extensions appeared under the extension. But I can also see why they are first. In the end, the machine doesn't care, only us human readers of JSON and XML care.</p>",
        "id": 266925964,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1641383540
    },
    {
        "content": "<p>I would expect your base extension would be \"<a href=\"http://hl7.org/fhir/someIg/StructureDefinition/real-time-collection\">http://hl7.org/fhir/someIg/StructureDefinition/real-time-collection</a>\".  It would have two child extensions called \"name\" (valueString) and \"code\" (valueCoding).  There's no need to deal with linkIds at all in this extension.  In child elements you'd use %someName (the value from the 'name' child extension) as part of initialValueExpression extensions.</p>",
        "id": 266976773,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1641409607
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Could you give me an example of what you are thinking?</p>",
        "id": 266985635,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1641413926
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;extension&quot;: [\n    {\n      &quot;url&quot;: &quot;http://hl7.org/fhir/someig/StructureDefinition/real-time-collection&quot;,\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;code&quot;,\n          &quot;valueCoding&quot;: {\n            &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n            &quot;code&quot;: &quot;528391&quot;\n          }\n        },\n        {\n          &quot;url&quot;: &quot;name&quot;,\n          &quot;valueString&quot;: &quot;BP&quot;\n        }\n      ]\n    }\n  ]\n}\n</code></pre></div>\n<p>You'd then refer to <code>%BP</code> in the initialExpression or other extensions</p>",
        "id": 266987000,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1641414622
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Let's see how far I get.<br>\nThe rendering application obtains the Questionnaire<br>\nThe rendering application creates a Questionnaire Response</p>\n<ul>\n<li>The app comes across the real time entry extension</li>\n<li>It sees the code extensions to see what real time information it is to collect</li>\n<li>It looks at the name information for each code entry. If the valueString is not empty, the application is going to get the information represented by the code</li>\n<li>The user takes the measurement</li>\n<li>The application collects the data as indicated by the code entries</li>\n</ul>\n<p>Now what? These collected values are answers to questions. I don't know where to put the answers without some link-id telling me what question a given retrieved code entry is to answer. If the name valueString had the link id I would know what question the retrieved value is to answer.</p>\n<p>I still do not know how my application is to create the QR given the Q. I think there are some assumptions here I am unaware of.</p>",
        "id": 267058204,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1641474303
    },
    {
        "content": "<p>After collection, the Observation collected becomes available in memory to calculatedExpression, initialExpression and other expressions within the Questionnaire, which allows the rendering application to populate question answers and/or control Questionnaire behavior based on the information retrieved.  Have you read through the SDC section on population and advanced behavior?</p>",
        "id": 267084796,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1641488176
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Okay, now I think I see the issue. I do not have the Observation resource yet and have not created it. It will be created along with the QR and uploaded in a Bundle together. This makes providing references much easier. It will also provide all the other Observations (including the Coincident Time Stamp Observation) and Device Resources related to the Observation and they will be including in the Bundle. The upload may not occur immediately after the QR is done as there may be no connectivity.</p>\n<p>I have not read through that section (maybe I have but at the time I looked at it I had no context with respect to this behavior).</p>",
        "id": 267122971,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1641507498
    },
    {
        "content": "<p>My expectation is that the real-time-measurement would have to produce the Observation resource and make it available \"real-time\" and would prompt the user to click something once it was expected to be available so the software could go grab it and make it available to the rest of the decision logic.  If/whether it subsequently gets packaged up in a transaction Bundle is a side-point.  The render needs to have access to it in memory if it's going to use the data to answer questions.</p>",
        "id": 267127145,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1641510116
    },
    {
        "content": "<p>If you can't/won't have the Observation resource created yet in your flow,  you could try something similar to my <a href=\"#narrow/stream/179255-questionnaire/topic/Linking.20PHD.20data.20to.20Questionnaire.20Response/near/262006099\">https://chat.fhir.org/#narrow/stream/179255-questionnaire/topic/Linking.20PHD.20data.20to.20Questionnaire.20Response/near/262006099</a> suggestion for the design, where the Observation is created later in the process flow.</p>",
        "id": 267128377,
        "sender_full_name": "Diane",
        "timestamp": 1641510844
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"237340\">@Diane</span>  The use case we have is that a patient receives a questionnaire which prompts him/her to take a measurement with a communicating personal health device (say a blood pressure cuff). There is information in the questionnaire that tells the rendering application that a measurement is going to be taken with a blood pressure cuff (MDC_DEV_SPEC_PROFILE_BP) and report a set of values when the measurement is received (MDC_PRESS_BLD_NONINV_SYS, MDC_PRESS_BLD_NONINV_DIA - systolic and diastolic pressures). These codes are provided by the device so the renderer will be able to identify the device (that it is the correct one) and get the desired measurements from it (these devices often report pulse rate as well but in this case it is not being asked for).</p>\n<p>The render is on a gateway that is able to decode measurements from PHDs and can convert these measurements to FHIR following the PHD IG.</p>\n<p>At this point the renderer can create the Questionnaire Response object and populate the answer fields to the question with the correct answers. When the patient completes the questionnaire, the renders passes the QR object and Measurement and Device object to the Fhir creator. The FHIR creator creates the Device, Patient, Observation and QuestionnaireResponses and packs them into a Bundle. This creation adds a reference to the Observations in the QR  which already contains the values. So the QR contains both, the systolic and diastolic values in the answer and references to the Observation resources. The transaction Bundle is serialized and uploaded.</p>\n<p>If connectivity is bad and the upload can't be made at the current time, the serialized Bundle is saved and uploaded at a future time when connectivity is restored.</p>\n<p>That's the idea in any case.</p>",
        "id": 267920048,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1642102954
    },
    {
        "content": "<p>It seems like Lloyd McKenzie's proposed flow of creating the Observation resource at the time of the measurement might be closer to what you need.  As Lloyd said, the Observation can be created but not packaged into the transaction Bundle until later.</p>",
        "id": 267936241,
        "sender_full_name": "Diane",
        "timestamp": 1642110866
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"237340\">@Diane</span> Basically that is what I am doing - but a final serialized resource does not get created until upload. Its just an object that is converted to resources at the time of upload.</p>",
        "id": 267937278,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1642111403
    },
    {
        "content": "<p>Right.  You'll have to move that timeline forward if you want to access the data in a Questionnaire in a non-proprietary way.</p>",
        "id": 267945951,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1642115986
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Should the valueString in the name extension be a FHIR path to the resource element? For example, in the case of the device specialization it would be 'Device.specialization.systemType.where(coding.system='urn:iso:std:iso:11073:10101').coding.code'<br>\nThat would point you to the specialization code which should be that in the 'code' extension.</p>",
        "id": 268407741,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1642519751
    },
    {
        "content": "<p>So I guess the work flow is after the user takes the measurement, the Device and Observation resources are created, the the renderer accesses the values from the created resources.</p>",
        "id": 268408114,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1642519884
    },
    {
        "content": "<p>No.  In FHIRPath, a value[x] element just has a name of <code>.value</code>.  If you want to filter, I believe you can say <code>.value as string</code>.</p>",
        "id": 268419506,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1642523968
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span></p>\n<p>Okay, with respect to the nested extensions I guess the way to do it is to place the real time extension pairs is in each individual item.</p>\n<p>I still am unsure how to use the 'name' extension so I placed the FHIR path to the resource value (assumption is that the resource exists) in the valueString element that the renderer would use to get the value and place it in the item answer for the QR. In some sense, assuming the resources exist, the 'code' extension seems almost superfluous. In any case. The Questionnaire looks like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Questionnaire&quot;,\n  &quot;item&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;extension&quot;: [\n            {\n              &quot;url&quot;: &quot;code&quot;,\n              &quot;valueCoding&quot;: {\n                &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                &quot;code&quot;: &quot;528391&quot;,\n                &quot;display&quot;: &quot;MDC_DEV_SPEC_PROFILE_BP&quot;\n              }\n            },\n            {\n              &quot;url&quot;: &quot;name&quot;,\n              &quot;valueString&quot;: &quot;Device.specialization.systemType.where(coding.system=&#39;urn:iso:std:iso:11073:10101&#39;).coding.code&quot;\n            }\n          ],\n          &quot;url&quot;: &quot;http://hl7.org/fhir/something/StructureDefinition/real-time-collection&quot;\n        }\n      ],\n      &quot;text&quot;: &quot;Get the Systolic and diastolic pressure from your Blood pressure device&quot;,\n      &quot;type&quot;: &quot;group&quot;,\n      &quot;item&quot;: [\n        {\n          &quot;text&quot;: &quot;Please take a measurement with your communicating Blood Pressure Device&quot;,\n          &quot;type&quot;: &quot;display&quot;,\n          &quot;item&quot;: [\n            {\n              &quot;extension&quot;: [\n                {\n                  &quot;extension&quot;: [\n                    {\n                      &quot;url&quot;: &quot;code&quot;,\n                      &quot;valueCoding&quot;: {\n                        &quot;system&quot;: &quot;http://hl7.org/fhir/&quot;,\n                        &quot;code&quot;: &quot;observation.html&quot;\n                      }\n                    },\n                    {\n                      &quot;url&quot;: &quot;name&quot;,\n                      &quot;valueString&quot;: &quot;Observation.id&quot;\n                    }\n                  ],\n                  &quot;url&quot;: &quot;http://hl7.org/fhir/something/StructureDefinition/real-time-collection&quot;\n                }\n              ],\n              &quot;linkId&quot;: &quot;BP.Observation.Ref&quot;,\n              &quot;text&quot;: &quot;Enter the reference to the Observation resource for the blood pressure. (It will be automatically entered)&quot;,\n              &quot;type&quot;: &quot;reference&quot;,\n              &quot;item&quot;: [\n                {\n                  &quot;extension&quot;: [\n                    {\n                      &quot;extension&quot;: [\n                        {\n                          &quot;url&quot;: &quot;code&quot;,\n                          &quot;valueCoding&quot;: {\n                            &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                            &quot;code&quot;: &quot;150021&quot;,\n                            &quot;display&quot;: &quot;MDC_PRESS_BLD_NONINV_SYS&quot;\n                          }\n                        },\n                        {\n                          &quot;url&quot;: &quot;name&quot;,\n                          &quot;valueString&quot;: &quot;Observation.component.where(code.coding.where(code=&#39;150021&#39;)).value&quot;\n                        }\n                      ],\n                      &quot;url&quot;: &quot;http://hl7.org/fhir/something/StructureDefinition/real-time-collection&quot;\n                    }\n                  ],\n                  &quot;linkId&quot;: &quot;BP.sys.Quant&quot;,\n                  &quot;text&quot;: &quot;Enter the systolic pressure (It will be automatically entered)&quot;,\n                  &quot;type&quot;: &quot;quantity&quot;\n                },\n                {\n                  &quot;extension&quot;: [\n                    {\n                      &quot;extension&quot;: [\n                        {\n                          &quot;url&quot;: &quot;code&quot;,\n                          &quot;valueCoding&quot;: {\n                            &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                            &quot;code&quot;: &quot;150022&quot;,\n                            &quot;display&quot;: &quot;MDC_PRESS_BLD_NONINV_DIA&quot;\n                          }\n                        },\n                        {\n                          &quot;url&quot;: &quot;name&quot;,\n                          &quot;valueString&quot;: &quot;Observation.component.where(code.coding.where(code=&#39;150022&#39;)).value&quot;\n                        }\n                      ],\n                      &quot;url&quot;: &quot;http://hl7.org/fhir/something/StructureDefinition/real-time-collection&quot;\n                    }\n                  ],\n                  &quot;linkId&quot;: &quot;BP.dia.Quant&quot;,\n                  &quot;text&quot;: &quot;Enter the diastolic pressure (It will be automatically entered)&quot;,\n                  &quot;type&quot;: &quot;quantity&quot;\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n</code></pre></div>\n<p>Not sure if I am beginning to get your approach or not, but if I need to have the situation that the resource exists, having the FHIR path is certainly a great way to tell the renderer where to get the needed value for the answer. So I assume the work flow would be that the extension in the group would tell the renderer that the answers in this group are going to be a real-time collection and the code extension says that it is a BP cuff. The name extension gives the location of the specialization code. Since we are not getting any data from the Device resource its probably best NOT to have the name extension here.</p>\n<p>For the remaining item entries the name and code extensions tell the renderer what to get and where to get it (except the location of the resource is not specified)</p>",
        "id": 268456282,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1642540290
    },
    {
        "content": "<p>The name should be short.  E.g. \"Diastolic\".  You'll reference it later extensions as \"%Diastolic\".  You don't want it to be long and it definitely <em>can't</em> have any periods in it.</p>",
        "id": 268491245,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1642566572
    }
]