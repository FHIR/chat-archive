[
    {
        "content": "<p>I am working with <span class=\"user-mention\" data-user-id=\"235060\">@Grey Faulkenberry</span> to implement FHIRPath support into a questionnaire filler. I am trying to get the following SDC example to work: <a href=\"http://build.fhir.org/ig/HL7/sdc/examples.html#using-enablewhen-enablebehavior-and-enablewhenexpression\">http://build.fhir.org/ig/HL7/sdc/examples.html#using-enablewhen-enablebehavior-and-enablewhenexpression</a> . I have 2 questions:</p>\n<ol>\n<li>am I right in assuming that \"repeats\" is a typo and it should be repeat (no trailing s)?</li>\n<li>is there any kind of implicit / polymorphism etc. specified behavior that should allow \"answer.toString()\" to work as in the example, or should it be \"answer.valueDate.toString()\"?</li>\n</ol>\n<p>I am essentially trying to understand whether our code is broken, or the example is incorrect.</p>",
        "id": 251113970,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1630222610
    },
    {
        "content": "<p>which repeats would be a typo?</p>",
        "id": 251115448,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630224347
    },
    {
        "content": "<p>the one in expression seems a typo indeed</p>",
        "id": 251115834,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630224780
    },
    {
        "content": "<p>I am referring to this overall expression <code>\"expression\": \"%resource.repeats(item).where(linkId='4.2.b.1').answer.valueCoding.code ='female' and today().toString().substring(0, 4).toInteger() - %resource.repeats(item).where(linkId='4.2.b.5').answer.toString().substring(0, 4).toInteger() &gt;= 40\"</code> <br>\nIt has <code>repeats(item)</code> in it two times. </p>\n<p>My second question is referring to the second half of the example where it says <code>.answer.toString()</code>.</p>",
        "id": 251119864,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1630229219
    },
    {
        "content": "<p>I think you are correct in assuming there are 2 issues with the documentation.<br>\nI don't know about the implicit casting, and I don0t find it in FHIRPath. The repeats seems a typo. I think the expression should be </p>\n<div class=\"codehilite\"><pre><span></span><code>%resource.repeat(item).where(linkId=&#39;4.2.b.1&#39;).answer.valueCoding.code =&#39;female&#39;\nand (today().toString().substring(0, 4).toInteger() - %resource.repeat(item).where(linkId=&#39;4.2.b.5&#39;).answer.valueDate.toString().substring(0, 4).toInteger() &gt;= 40)\n</code></pre></div>",
        "id": 251123346,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630233145
    },
    {
        "content": "<p>Can others confirm please?<br>\nrepeats does not exist in fhirpath, should be repeat. And answer.toString does not resolve, should be answer.valueDate.toString</p>",
        "id": 251125007,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630235020
    },
    {
        "content": "<p>answer.valueString is not correct either, it is answer.value</p>",
        "id": 251125969,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630236119
    },
    {
        "content": "<p>And you can add .toString() to that also.</p>",
        "id": 251126019,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630236141
    },
    {
        "content": "<p>Check the fhirpath spec for how polymorphic types are defined here<br>\n<a href=\"http://hl7.org/fhirpath/#paths-and-polymorphic-items\">http://hl7.org/fhirpath/#paths-and-polymorphic-items</a></p>",
        "id": 251126138,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630236276
    },
    {
        "content": "<p>so from this very compact spec, am I right in assuming that only the field name as specified for the choice is valid (if the FHIR spec says <code>fieldname[x]</code>, then I can only use <code>.fieldname</code>, but not <code>.fieldnameString</code>? So the fully correct example would be <code>%resource.repeat(item).where(linkId='4.2.b.1').answer.value.code ='female' and today().toString().substring(0, 4).toInteger() - %resource.repeat(item).where(linkId='4.2.b.5').answer.value.toString().substring(0, 4).toInteger() &gt;= 40</code>?</p>",
        "id": 251138316,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1630249616
    },
    {
        "content": "<p>both resolve (according to <a href=\"https://hl7.github.io/fhirpath.js/\">https://hl7.github.io/fhirpath.js/</a>): <br>\n<code>answer.value</code> and <code>answer.valueDate.toString()</code></p>",
        "id": 251138860,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630250253
    },
    {
        "content": "<p>But I am wondering whether the latter \"valueDate\" is merely a side-effect of the JavaScript/JSON based implementation, or should really resolve according to spec.</p>",
        "id": 251139280,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1630250755
    },
    {
        "content": "<p>valueDate used to be allowed.  It's not officially allowed any longer, though some of the tool stacks still support it.  Can you submit a change request for us to fix the SDC example?</p>",
        "id": 251141666,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1630253299
    },
    {
        "content": "<p>my favourite pastime on a rainy Sunday: <a href=\"https://jira.hl7.org/browse/FHIR-33262\">https://jira.hl7.org/browse/FHIR-33262</a></p>",
        "id": 251142578,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1630254332
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192169\">Tilo Christ</span> <a href=\"#narrow/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example/near/251142578\">said</a>:</p>\n<blockquote>\n<p>my favourite pastime on a rainy Sunday: <a href=\"https://jira.hl7.org/browse/FHIR-33262\">https://jira.hl7.org/browse/FHIR-33262</a></p>\n</blockquote>\n<p>there are worse pastimes... :)</p>",
        "id": 251142655,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630254389
    },
    {
        "content": "<p>does LHCForms support enableWhenExpression?</p>",
        "id": 251142669,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630254417
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span></p>",
        "id": 251142673,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630254421
    },
    {
        "content": "<p>Not yet, but I am hoping to get started on it this week.  I don't think it will be hard it add.  I just need to get some time to work on it.</p>",
        "id": 251232729,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1630331717
    },
    {
        "content": "<p>thank you</p>",
        "id": 251249355,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1630338252
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179255-questionnaire/topic/FHIRPath.20SDC.20example/near/251142669\">said</a>:</p>\n<blockquote>\n<p>does LHCForms support enableWhenExpression?</p>\n</blockquote>\n<p>Just published <a href=\"http://lhncbc.github.io/lforms/\">LHC-Forms</a> 29.3.0 with enableWhenExpression support.</p>",
        "id": 252369128,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1631047368
    }
]