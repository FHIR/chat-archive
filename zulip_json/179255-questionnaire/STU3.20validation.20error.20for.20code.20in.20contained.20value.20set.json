[
    {
        "content": "<p>Hi <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span> I am validating a STU3 QuestionnaireResponse against a Questionnaire with the newest validator (5.0.7-SNAPSHOT) and am getting a strange error for an answer coded with SNOMED CT. The code is in a ValueSet that is contained in the questionnaire (both resources are shown below) and is a valid code. Nonetheless, the validator says (full output pasted in further down):</p>\n<div class=\"codehilite\"><pre><span></span><code>Error @ QuestionnaireResponse.item[0].answer[0] (line 12, col52) : The value provided (http://snomed.info/sct::55011004) is not in the options value set in the questionnaire\n</code></pre></div>\n\n\n<p>If I replace the SNOMED code with a LOINC code in both resources, everything works fine. If I enter an invalid SNOMED code, the validator complains about it being invalid, so it is finding the code. Spent 30 minutes going over this and still did not spot the issue - is this a known problem or am I  missing smt?</p>\n<p>QuestionnaireResponse resource:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n    <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;QuestionnaireResponse&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;language&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;en&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;questionnaire&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">&quot;reference&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://example.com/Questionnaire/testQ&quot;</span>\n    <span class=\"p\">},</span>\n    <span class=\"nt\">&quot;status&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;completed&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;item&quot;</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n        <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;change&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;answer&quot;</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n            <span class=\"nt\">&quot;valueCoding&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;system&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://snomed.info/sct&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;55011004&quot;</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">}]</span>\n    <span class=\"p\">}]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n\n<p>Questionnaire resource:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n    <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Questionnaire&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://example.com/Questionnaire/testQ&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;status&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;draft&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;item&quot;</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n        <span class=\"nt\">&quot;linkId&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;change&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;choice&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;options&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;reference&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;#includesVS&quot;</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}],</span>\n    <span class=\"nt\">&quot;contained&quot;</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n        <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;ValueSet&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://example.com/ValueSet/testVS&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;includesVS&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;status&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;active&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;expansion&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;identifier&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;urn:uuid:1f503a0a-b45d-406e-9bfa-43e78a25fe97&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;timestamp&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;2020-06-23T12:08:51.687Z&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;contains&quot;</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n                <span class=\"nt\">&quot;system&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://snomed.info/sct&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;55011004&quot;</span>\n            <span class=\"p\">}]</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n\n<p>Validator output:</p>\n<div class=\"codehilite\"><pre><span></span><code>USERX$ java -jar validator/org.hl7.fhir.validator.jar -version 3.0.2 -ig questionnaire/ examples/test.QuestionnaireResponse.json\nFHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 6bc790d98b04). Built 2020-06-07T08:35:37.25+10:00 (59 days old)\nDetected Java version: 12.0.2 from /Library/Java/JavaVirtualMachines/adoptopenjdk-12.jdk/Contents/Home on x86_64 (64bit). 4096MB available\nArguments: -version 3.0.2 -ig questionnaire/ examples/test.QuestionnaireResponse.json\nDirectories: Current = /Users/[REMOVED], Package Cache = /Users/[REMOVED]\n  .. FHIR Version 3.0, definitions from hl7.fhir.r3.core#3.0.2\n  .. connect to tx server @ http://tx.fhir.org\n    (v3.0.2)\n+  .. load IG from questionnaire/\n  .. validate [examples/test.QuestionnaireResponse.json]\nTerminology server: Check for supported code systems for http://snomed.info/sct\n*FAILURE* validating examples/test.QuestionnaireResponse.json:  error:1 warn:0 info:0\n  Error @ QuestionnaireResponse.item[0].answer[0] (line 12, col52) : The value provided (http://snomed.info/sct::55011004) is not in the options value set in the questionnaire\n</code></pre></div>",
        "id": 206031288,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1596639026
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> is the correct action here to post a Git issue against HAPI core?</p>",
        "id": 206085010,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1596666004
    },
    {
        "content": "<p>yes</p>",
        "id": 206096748,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596677872
    },
    {
        "content": "<p>note, though, that this a problem in the questionnaire, not the validator</p>",
        "id": 206097119,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596678317
    },
    {
        "content": "<blockquote>\n<p>note, though, that this a problem in the questionnaire, not the validator</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> just so I report this correctly: do you mean that it is a problem with the general handling of Questionnaire resources?</p>",
        "id": 206110909,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1596698090
    },
    {
        "content": "<p>no it's a problem with your questionnaire</p>",
        "id": 206112264,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596699549
    },
    {
        "content": "<p>I meant to describe it - the embedded value set is not correct:</p>",
        "id": 206112649,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596699929
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>            &quot;contains&quot;: [{\n                &quot;system&quot;: &quot;http://snomed.info/sct&quot;,\n                &quot;concept&quot; : [{\n                  &quot;code&quot;: &quot;55011004&quot;\n                }]\n            }]\n</code></pre></div>",
        "id": 206112660,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596699951
    },
    {
        "content": "<p>Ah right, so I can get it to work if my value set  only contains <code>compose</code>. But the moment I add <code>expansion</code>, I get the error, with or without the <code>compose</code> element. Yet the contained value set validates OK as a standalone. I think my morning coffee is not working, I must admit I still do not see the error in the expansion/the use of expanded value sets (or understand why it works with LOINC but not SNOMED).</p>",
        "id": 206128816,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1596713301
    },
    {
        "content": "<p>hmm. what I pasted there is wrong..</p>",
        "id": 206129022,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596713425
    },
    {
        "content": "<p>found the problem and fixed it. It will be in today's release</p>",
        "id": 206133836,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596717101
    },
    {
        "content": "<p>Thanks, as always, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 206134327,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1596717367
    }
]