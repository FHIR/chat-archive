[
    {
        "content": "<p>If you have a Questionnaire question for height in which the user can choose units of either inches or meters, and then you want to do a BMI calculation (or something else) with that entered quantity, is there a way in which the FHIRPath expression can retrieve the value entered in a particular desired unit?  For instance if the BMI rule is expecting the height in meters, but the user has selected inches, is there some way in which the height in meters can be obtained?</p>\n<p>Now that I think about it, it might be possible to write a rather complicated FHIRPath expression for this if the possible units are known in advance (for instance, if it is known that the units are either inches or meters and not cm or feet).  But is there, or should there be, some support for this from Questionnaire/QuestionnaireResponse?</p>",
        "id": 154015201,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541177529
    },
    {
        "content": "<p>So you're asking if FHIRPath can do UCUM unit conversions for you?  That sounds like a good question to ask in a FHIRPath specific stream.  It'd be an awesome feature, but not one I can recall having seen in the spec.</p>",
        "id": 154015204,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541178265
    },
    {
        "content": "<p>No, although that is an interesting question as well.  I was asking if Questionnaire/QR would have some support for doing that, for instance, by specifying that the value obtained from QR.answer.valueCoding would be in a particular unit, and not necessarily the unit the user selected when entering the data.</p>\n<p>Just for reference, the following FHIRPath expression could work if it is known that the units are either inches or meters:</p>\n<div class=\"codehilite\"><pre><span></span>(%height.answer.valueQuantity.where(unit=&#39;[in_i]&#39;).value*0.0254).combine(%height.answer.valueQuantity.where(unit=&#39;m&#39;).value)\n</pre></div>\n\n\n<p>But, what I am really wondering here is whether that is necessary.  There might be a situation in which the user could pick a UCUM unit not defined on the form (like cm).</p>",
        "id": 154015206,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541178742
    },
    {
        "content": "<p>Not following how you could presume that the data would be in anything other than the unit the user specified...</p>",
        "id": 154015208,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541179148
    },
    {
        "content": "<p>The form renderer would convert what the user entered to the target unit specified in the Questionnaire, so that when the QR data was accessed, it would be in that unit.</p>",
        "id": 154015211,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541179700
    },
    {
        "content": "<p>Transformation between user entry and what's stored?  That's quite contrary to the base purpose of QuestionnaireResponse - which is to be a precise record of what the user actually entered.  The transformation happens during the conversion process.  If you wanted to calculate the value of a separate hidden question, you could do that, but I wouldn't be in favor of anything that changes user-entered data.</p>",
        "id": 154015213,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541180000
    },
    {
        "content": "<p>It would not need to affect the answer that was stored under item.answer.valueQuantity.  Perhaps the transformed value could be stored on a different attribute.</p>",
        "id": 154015216,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541180369
    },
    {
        "content": "<p>You could stick it in an extension I suppose, but I'd lean towards a hidden question.</p>",
        "id": 154015219,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541180893
    },
    {
        "content": "<p>A hidden question presumes that a form designer knows what transformation to make and put in the hidden question.  I think it will probably be necessary for a some external library call to be made (e.g. by the form renderer) to do the transformation from the actual to desired unit.</p>\n<p>The other option other than an extension on Questionnaire would be to put something in FHIRPath (as you mentioned) for converting one Quantity to another Quantity with the desired unit.   That might have wider usefulness.</p>",
        "id": 154015226,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541181796
    },
    {
        "content": "<p>Out of curiosity, what is the ucum unit that you're converting?</p>",
        "id": 154015369,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1541209750
    },
    {
        "content": "<p>Inches to meters.  [in_i] to m.</p>",
        "id": 154015682,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541436216
    },
    {
        "content": "<p>so we haven't surfaced this in FHIRPath. It's not that hard to implement assuming you have a UCUM library (and there are UCUM libraries for most languages these days).</p>",
        "id": 154016975,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541722816
    },
    {
        "content": "<p>given that we have quantity as a type, it would make sense to add 2 functions to it:<br>\nboolean quantity.convertsTo(String unit)<br>\nquantity quantity.convert(String unit)</p>",
        "id": 154016976,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541722929
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> what say you?</p>",
        "id": 154016977,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541722936
    },
    {
        "content": "<p>Since we already have <a href=\"http://hl7.org/fhirpath/2018Sep/#convertstoquantity-boolean\" target=\"_blank\" title=\"http://hl7.org/fhirpath/2018Sep/#convertstoquantity-boolean\">convertsToQuantity</a> and <a href=\"http://hl7.org/fhirpath/2018Sep/#toquantity-quantity\" target=\"_blank\" title=\"http://hl7.org/fhirpath/2018Sep/#toquantity-quantity\">toQuantity</a>, I would suggest just adding an optional overload to those functions <code>unit: String</code> that would support the behavior.</p>",
        "id": 154016999,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1541726913
    },
    {
        "content": "<p>So we would have <code>convertsToQuantity([unit: String])</code> and <code>toQuantity([unit: String])</code></p>",
        "id": 154017000,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1541726950
    },
    {
        "content": "<p>yes I like that</p>",
        "id": 154017005,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541727577
    },
    {
        "content": "<p>String and not code?</p>",
        "id": 154017009,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541728202
    },
    {
        "content": "<p>if you mean the parameter types, then yes - these are FHIRPath system types, not FHIR types</p>",
        "id": 154017011,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541728503
    },
    {
        "content": "<p>But you'd pass an actual code and not a descriptive string, correct?</p>",
        "id": 154017013,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541728658
    },
    {
        "content": "<p>yes must be UCUM code</p>",
        "id": 154017014,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541728684
    },
    {
        "content": "<p>Yes, same representation as the quantity literal (<a href=\"http://hl7.org/fhirpath/2018Sep/grammar.html\" target=\"_blank\" title=\"http://hl7.org/fhirpath/2018Sep/grammar.html\">http://hl7.org/fhirpath/2018Sep/grammar.html</a>)</p>",
        "id": 154017031,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1541740111
    },
    {
        "content": "<p><a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=19635\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=19635\">GF#19635</a></p>",
        "id": 154017032,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1541740386
    }
]