[
    {
        "content": "<p>Is there a best way to show a text depending on variables, or make it parametrized?<br>\nI have a questionnaire that calculates a risk score. Now I want the questionnaire to display at the end:</p>\n<ul>\n<li>If score  &lt; X, display text \" risk is <strong>low</strong>,  probability of <strong>1%</strong> of...\"</li>\n<li>If X &lt; score &lt; Y, display text \"risk is <strong>moderate</strong>, probability of <strong>17%</strong> of...\"</li>\n<li>If  score &gt; Y, display text \"risk is <strong>high</strong>, probability of <strong>25%</strong> of...\"</li>\n</ul>",
        "id": 253006057,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1631474207
    },
    {
        "content": "<p>I'm using different enableWhenExpressions to show the text. Is there a more compact way?</p>",
        "id": 253006097,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1631474255
    },
    {
        "content": "<p>I think what you are doing is the \"official\" way. Danish <a href=\"http://sundhet.dk\">sundhet.dk</a> has defined a local extension  (<a href=\"http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-questionnaire-feedback\">http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-questionnaire-feedback</a>), but that doesn't make it much more compact either, I think enableWhenExpression simply didn't exist yet, when they defined it.</p>",
        "id": 253006295,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1631474457
    },
    {
        "content": "<p>back to this, I'm not happy with what I have so far:</p>",
        "id": 265123130,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639642505
    },
    {
        "content": "<p>I have a questionnaire for risk score calculation.<br>\nDepending on the answers, I will get a score, and an interpretation of that score. e.g. if score = 8, interpretation is \"risk of 10-year diabetes is estimated at 1 in 25\"</p>",
        "id": 265123848,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639643015
    },
    {
        "content": "<p>So where is the unhappiness coming from? Isn't what you got now the thing that you asked for?</p>",
        "id": 265136958,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1639651151
    },
    {
        "content": "<p>(sorry, I was distracted).</p>",
        "id": 265159019,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639663103
    },
    {
        "content": "<p>The issue I have is where to put the interpretation. If I have 5 possible interpretations, i have 5 questionnaire items (and I only show one of them)</p>",
        "id": 265159161,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639663180
    },
    {
        "content": "<p>In terms of mapping, I have 5 items to map to 1, but I don't know which of these items. I cannot concatenate as I wanted, and I do not want to reproduce the calculation logic in the extraction...</p>",
        "id": 265159462,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639663262
    },
    {
        "content": "<p>Here's an example of that type of scoring...<br>\n<a href=\"https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/abbey-pain-scale/_history/5?_format=html\">https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/abbey-pain-scale/_history/5?_format=html</a></p>",
        "id": 265246117,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639707403
    },
    {
        "content": "<p>First 5 radios get scores based on ordinal and then another field with the rating based on that score.<br>\nWorks with our renderer, must try it with the lhc forms.</p>",
        "id": 265246148,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639707451
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> does this contain a single answer item where the text depends on the calculated score?</p>",
        "id": 265446276,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639865190
    },
    {
        "content": "<p>If you mean you wanted to display a different text label (display item) you could have each of the options in there and enable them to display the appropriate one based on the score answer.</p>",
        "id": 265446463,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639865414
    },
    {
        "content": "<p>Right, that is what I have but that is what I am not what I'm happy with</p>",
        "id": 265498341,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639945510
    },
    {
        "content": "<p>(if I understand what you mean)</p>",
        "id": 265498345,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639945522
    },
    {
        "content": "<p>oh wait, perhaps you mean having a rather long fhirpath expression that contains the different text values?</p>",
        "id": 265498358,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639945559
    },
    {
        "content": "<p>if I have different questions each with one possible text and then do the enableWhen, it gets messy:<br>\n<a href=\"/user_uploads/10155/syikUwmOfHL9Btxu502cWvEL/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/syikUwmOfHL9Btxu502cWvEL/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/syikUwmOfHL9Btxu502cWvEL/image.png\"></a></div>",
        "id": 265498512,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639945761
    },
    {
        "content": "<p>(i cannot do concatenate because all of the questions will have text. And to select only the right one, I'd have to replicate the logic in my mapping, while the logic is already in the questionnaire)</p>",
        "id": 265498581,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639945829
    },
    {
        "content": "<p>I'm lost.<br>\nIf you only want 1 value for the interpretation, just have the 1 read only choice question, with the expression to process the score into the interpretation result, and that feeds nicely into your observation.</p>",
        "id": 265498761,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639946109
    },
    {
        "content": "<p>(that's precisely what my example abbey pain scale score does)</p>",
        "id": 265498820,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639946165
    },
    {
        "content": "<p>at this moment I have 5 items with enablewhen, each for a given range of the score. From what I'm reading, that's not what you are saying, right?</p>",
        "id": 265499443,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639947117
    },
    {
        "content": "<p>Yup. Just 1 coded interpretation, and that's even more relevant given your diagram going to one obs as the interpretation field.</p>",
        "id": 265499568,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639947282
    },
    {
        "content": "<p>But then the interpretation has to have all those <code>if</code>s, right? 'if score &lt; X, \"this is one text\" else if score &lt; y, \"this is another risk\"...'</p>",
        "id": 265504237,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639953570
    },
    {
        "content": "<p>(if so, I'll figure out the syntax later)</p>",
        "id": 265504243,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1639953596
    },
    {
        "content": "<p>Syntax is in my example.</p>",
        "id": 265510786,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639961942
    },
    {
        "content": "<p>Amn since you want it coded in the observation anyway.</p>",
        "id": 265510795,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639961977
    },
    {
        "content": "<p>i don't see it. I see syntax for calculating the score as a string...<br>\nwhat I need is an item that has the text - not \"the pain is 5\" nor \"the pain is excruciating/mild/...\", but <br>\n\"the pain is not bearable and the patient has to be on meds\" vs \"the patient does not need any further medication\"</p>",
        "id": 265557493,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640004247
    },
    {
        "content": "<p>I _could_ make a valueset for that...</p>",
        "id": 265557533,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640004285
    },
    {
        "content": "<p>You can use expressions to set the text of the item or the answers, so presumably that should cover your use-case?</p>",
        "id": 265576353,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1640013573
    },
    {
        "content": "<p>I do think should be stored as an answer in the QR if you're planning to copy into observation.<br>\nAnd if you just want the string, use a text item, and output the entire description rather than code.</p>",
        "id": 265620322,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1640037600
    },
    {
        "content": "<p>Right. The struggle is: How do I define the possible text values <em>outside</em> of the FHIRpath expression, and in the FHIRpath expression I would just use them?<br>\nIn other words, how can I avoid having a FHIRpath expression that contains things like iif((result&lt;X,\"the pain is not bearable and the patient has to be on meds\",iif(result&lt;Y,\"the patient does not need any further medication\"...)</p>",
        "id": 265654166,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640070633
    },
    {
        "content": "<p>You could put the descriptions into variables...</p>",
        "id": 265682944,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1640092118
    },
    {
        "content": "<p>Possible places; variable, coded options, inline in the fhirpath expression. Or other display labels (though that doesn't help extraction - it's not in the saved data)</p>",
        "id": 265683105,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1640092244
    },
    {
        "content": "<p>If it's outside the FHIRPath expression, where do you want it to be?</p>",
        "id": 265691049,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1640097140
    },
    {
        "content": "<p>Would it maybe be an option to place them into display items and then use something along the lines of <code>%questionnaire.item.where(linkId='pain-level-1').text</code> to access their text description?</p>",
        "id": 265704882,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1640104044
    },
    {
        "content": "<blockquote>\n<p>Right. The struggle is: How do I define the possible text values outside of the FHIRpath expression, and in the FHIRpath expression I would just use them?<br>\nIn other words, how can I avoid having a FHIRpath expression that contains things like iif((result&lt;X,\"the pain is not bearable and the patient has to be on meds\",iif(result&lt;Y,\"the patient does not need any further medication\"...)</p>\n</blockquote>\n<p>Could also define this in a CQL library.</p>",
        "id": 265723660,
        "sender_full_name": "David Winters",
        "timestamp": 1640114044
    },
    {
        "content": "<p>The one I feel more comfortable with is a valueset. I think this means:</p>\n<ol>\n<li>Right after calculating the score, get a code (1-3 = \"low\", 4-5=\"med\"...)</li>\n<li>Use FHIRPath to get the display for that code (\"low\" : \"the pain is low and the patient just needs to get some distraction\"</li>\n</ol>",
        "id": 265853533,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640207634
    },
    {
        "content": "<p>How would I do this?</p>",
        "id": 265853538,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640207639
    },
    {
        "content": "<p>I think <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> your code is about populating the answer with the expression. Can I use FHIRPath to get the display for a code?</p>",
        "id": 265853625,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640207688
    },
    {
        "content": "<p>at which point? During the extraction into the obs?<br>\njust use the answer.coding.display</p>",
        "id": 265862896,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1640213055
    },
    {
        "content": "<p>For the answer that is the calculated risk choice field, just select the appropriate code (as in my demo above)</p>",
        "id": 265862958,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1640213115
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> I was struggling a bit with this as well but it was for a MeasureReport. As in the example I mentioned during the Hackathon (<a href=\"https://mayjuun.com/fhirfli/7-sdc-workflow-example/\">https://mayjuun.com/fhirfli/7-sdc-workflow-example/</a>), I have multiple Questionnaires and I use a single Measure -&gt; MeasureReport to calculate all of the scores/subscores. This is at least partly because some of the scores involve questions from multiple questionnaires. Currently I'm representing the scores calculations as shown above, each with 3 pieces of information generated from the expression, a score, a code of low/medium/high (to represent risk), and then an annotation. For instance, I may have something like this unrealistic example:</p>\n<div class=\"codehilite\"><pre><span></span><code>0-5;low;No follow-up necessary\n6-10;medium;Schedule a doctor appointment\n11-15;high;Call 911 right now\n</code></pre></div>\n<p>Currently I have this built into the expression</p>\n<div class=\"codehilite\"><pre><span></span><code>.iif($this &gt; 10, $this.toString() + &#39;;high;Call 911 right now&#39;, iif($this &lt; 6, $this.toString() + &#39;;low;No follow-up necessary&#39;, $this.toString() + &#39;;medium;Schedule a doctor appointment&#39;)\n// Or maybe using .select as recommended to Tilo by Bryn\n.select(iif($this &gt; 10, $this.toString() + &#39;;high;Call 911 right now&#39;, iif($this &lt; 6, $this.toString() + &#39;;low;No follow-up necessary&#39;, $this.toString() + &#39;;medium;Schedule a doctor appointment&#39;))\n</code></pre></div>\n<p>But then I have to use some idiosyncratic code to tell it how to parse out the result of the expression, and I'd like to be able to define the entire thing within FHIR. Any suggestions for this? (I'm also happy to clarify if my explanation wasn't clear).</p>",
        "id": 268094769,
        "sender_full_name": "Grey Faulkenberry",
        "timestamp": 1642209010
    },
    {
        "content": "<p>Got the current definitions on a server somewhere I can look at?</p>",
        "id": 268096827,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1642211176
    }
]