[
    {
        "content": "<p>There were a few topics related to Questionnaire.item.type:</p>\n<ul>\n<li>there are some use-cases where there's a desire to have answers that can be a mixture of numbers + codes or possibly dates + codes.  If we were to do this, then our notion of \"open\" vs. \"closed\" questions would change, and we'd instead have questions where multiple types were allowed and one of them was string.  (Though we might still have the notion of open/closed in terms of whether the list of provided options is exhaustive.)</li>\n<li>if we were to allow this, we'd probably make Questionnaire.item.type have just 3 values - group, display, question and then we'd have a 0..* element called questionType which would list the possible data types.  We could create a rule that would make questionType required if question was present (though perhaps allow it to be omitted if it's being inferred from the referenced code or definition?)</li>\n</ul>\n<p>We have a few options here:</p>\n<ol>\n<li>say that we'll never support this</li>\n<li>support it in R5 (and test at connectathon in may?)</li>\n<li>leave Questionnaire.item.type as STU to give us the ability to do this in the future</li>\n</ol>\n<p>From a pure architecture perspective, I find the change attractive, but I don't know how justifiable the change is.  I'm not a fan of option #3.</p>",
        "id": 228992864,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614965634
    },
    {
        "content": "<p>Could you please provide an example. It is not clear what is a use-case.</p>",
        "id": 229455672,
        "sender_full_name": "Ilya Beda",
        "timestamp": 1615286262
    },
    {
        "content": "<p>Example: \"How many people reside in your household?\" - answer can be integer, max 50.  Also supports the codes \"unknown\", \"prefer not to answer\"</p>",
        "id": 229481981,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1615298990
    },
    {
        "content": "<p>I am not sure about whether questions would really be mixed type. To stick with your example, I really want to know the # of residents as a number, but if I am unlucky that number happens to be unknown. I am wondering though whether the HL7v3 concept of a \"nullFlavor\" should be added to responses in order to cover that? <a href=\"https://www.hl7.org/fhir/v3/NullFlavor/cs.html\">https://www.hl7.org/fhir/v3/NullFlavor/cs.html</a> So maybe it should just be documented that a nullFlavor extension can be used for this purpose?</p>\n<p>For me, a nullFlavor would also cover several other cases I am currently struggling with, related to \"how can I save a half-finished response for later completion?\". So being able to mark responses as INV, NAV, NASK, etc. would really help there.</p>",
        "id": 233020448,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1617471595
    },
    {
        "content": "<p>I played with the idea a little, and here is what it might look like, if somebody didn't want to respond: </p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n    <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"QuestionnaireResponse\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"text\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">\"status\"</span><span class=\"p\">:</span> <span class=\"s2\">\"generated\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"div\"</span><span class=\"p\">:</span> <span class=\"s2\">\"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;h2&gt;Enter your weight in kg&lt;/h2&gt;***&lt;/div&gt;\"</span>\n    <span class=\"p\">},</span>\n    <span class=\"nt\">\"questionnaire\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://build.fhir.org/ig/HL7/sdc/examples.html\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"status\"</span><span class=\"p\">:</span> <span class=\"s2\">\"unknown\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"authored\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2021-04-04T00:22:08.098798\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"item\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">\"extension\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://terminology.hl7.org/CodeSystem/v3-NullFlavor\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueCoding\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://terminology.hl7.org/CodeSystem/v3-NullFlavor\"</span><span class=\"p\">,</span>\n                        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"MSK\"</span><span class=\"p\">,</span>\n                        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"masked\"</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">],</span>\n            <span class=\"nt\">\"linkId\"</span><span class=\"p\">:</span> <span class=\"s2\">\"100000\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"text\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Enter your weight in kg\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"answer\"</span><span class=\"p\">:</span> <span class=\"p\">[]</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>For \"unknown\", it would be \"ASKU\" instead of MSK.</p>",
        "id": 233037727,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1617488934
    },
    {
        "content": "<p>This might even be more appropriate: <a href=\"https://www.hl7.org/fhir/extension-data-absent-reason.html\">https://www.hl7.org/fhir/extension-data-absent-reason.html</a>  So it would be \"asked-declined\" and \"asked-unknown\".</p>",
        "id": 233045632,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1617498453
    },
    {
        "content": "<p>I think examples like that are multiple questions, not the same one.<br>\nNothing else tries do do this.</p>",
        "id": 233127853,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1617587486
    },
    {
        "content": "<p>Picturing the UI controls to do it...</p>",
        "id": 233127860,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1617587513
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191367\">Brian Postlethwaite</span> <a href=\"#narrow/stream/179255-questionnaire/topic/Make.20item.2Etype.20repeat.3F/near/233127860\">said</a>:</p>\n<blockquote>\n<p>Picturing the UI controls to do it...</p>\n</blockquote>\n<p><a href=\"/user_uploads/10155/xa1LuiZlM763wenusPTi-xKk/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/xa1LuiZlM763wenusPTi-xKk/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/xa1LuiZlM763wenusPTi-xKk/image.png\"></a></div><p>Another animated example can be seen here (the strike-out of question 3 happens because user chooses not to answer): </p>\n<p><a href=\"https://github.com/FireJuun/prapare/blob/main/demo.gif\">PRAPARE</a> </p>\n<div class=\"message_inline_image\"><a href=\"https://github.com/FireJuun/prapare/blob/main/demo.gif\" title=\"PRAPARE\"><img src=\"https://raw.githubusercontent.com/FireJuun/prapare/main/demo.gif\"></a></div><p>I am also trying to picture the UI though if these were 3 questions (one for \"How many people in the household\", one for \"unknown\", one for \"prefer not to answer\"). How would that play with <a href=\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-entryMode\">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-entryMode</a> of <code>sequential</code> or the \"Get Next Question\" for an adaptive questionnaire server?<br>\nWith the data absent reason solution it would be relatively simple: I present the question incl. the possibility to decline and after the user has either answered or declined, I can move onwards to the next question that asks for some \"real\" information, such as household income.</p>\n<p>If I split that up into 3 questions, would the sequence be:</p>\n<ul>\n<li>System presents question \"How many people are in your household?\"</li>\n<li>User enters 0, because they don't wish to answer</li>\n<li>System moves on to question \"Do you know the number of people in your household?\"</li>\n<li>\n<p>User selects 'yes'<br>\nSystem presents question \"Do you wish to answer the question?\"</p>\n</li>\n<li>\n<p>User selects 'no'</p>\n</li>\n</ul>\n<p>The other UI piece that I am currently building out is a progress indicator for how much of a questionnaire has already been filled. For that I can also see how keeping a question and the option to not answer the question as one indivisible unit would make my implementation a lot easier.</p>",
        "id": 233167975,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1617627150
    },
    {
        "content": "<p>Having answer be an empty array is not permitted.  I don't think we'd want to introduce extensions here.  Consuming systems are going to expect that all possible answers (and provided answers) are expressed using core elements.</p>",
        "id": 233186865,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1617636067
    },
    {
        "content": "<p>Ok, maybe I have misread the spec. I took the cardinality of 0..* for answer in a QuestionnaireResponse as meaning \"can be empty\".  But anyhow, if my idea is coming a little too late and will break a considerable amount of existing systems that would contradict the idea of interoperability. </p>\n<p>Would data-absent-reason still be a good ValueSet for question#2 then? So to stick with your example, I would put a question about house hold residents as a question for an integer with an enableWhen for \"householdDataAbsentReason\" != asked-unknown and != asked-declined, and then have question#2 linkId \"householdDataAbsentReason\", type <code>coding</code> with ValueSet \"<a href=\"http://hl7.org/fhir/ValueSet/data-absent-reason\">http://hl7.org/fhir/ValueSet/data-absent-reason</a>\"? </p>\n<p>Unless of course, somebody made \"dataAbsentReason\" a part of the core spec for QuestionnaireResponse, similar to how it is being specified on the Observation resource. Maybe that would also enable smooth extraction of questionnaires into observations?</p>",
        "id": 233190735,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1617637781
    },
    {
        "content": "<p>It can be empty - but if it's empty, you have to omit the element.  Empty arrays aren't allowed in FHIR anywhere.</p>",
        "id": 233191256,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1617638037
    },
    {
        "content": "<p>dataAbsentReason is certainly a reasonable code system to draw from as possible answers.  Whether Questionnaire authors will use it will vary</p>",
        "id": 233191394,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1617638094
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179255-questionnaire/topic/Make.20item.2Etype.20repeat.3F/near/233191256\">said</a>:</p>\n<blockquote>\n<p>It can be empty - but if it's empty, you have to omit the element.  Empty arrays aren't allowed in FHIR anywhere.</p>\n</blockquote>\n<p>Ahhh, ok, now I get what you mean, the <code>answers: []</code> piece in my example above. That is something I should fix.</p>\n<blockquote>\n<p>dataAbsentReason is certainly a reasonable code system to draw from as possible answers. Whether Questionnaire authors will use it will vary</p>\n</blockquote>\n<p>As somebody who is trying to write a slick questionnaire filler I am of course always happy if the spec is somewhat prescriptive. That allows me to offer more consistent styling, more consistent UI elements, more functionalities etc. without resorting to heuristics and inference.</p>",
        "id": 233193273,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1617638934
    },
    {
        "content": "<p>Unfortunately the spec can't be more prescriptive than what existing data can tolerate - and existing forms (which we need to be able to express as FHIR Questionnaires) draw content from a wide variety of code systems and have minimal consistency.  We can hope that as the need to map data from forms into FHIR data becomes more common that - in time - more forms will have FHIR-friendly codes.  But it's far from guaranteed - and will certainly take a long time.</p>",
        "id": 233197415,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1617641073
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179255-questionnaire/topic/Make.20item.2Etype.20repeat.3F/near/233197415\">said</a>:</p>\n<blockquote>\n<p>Unfortunately the spec can't be more prescriptive than what existing data can tolerate - and existing forms (which we need to be able to express as FHIR Questionnaires) draw content from a wide variety of code systems and have minimal consistency.  We can hope that as the need to map data from forms into FHIR data becomes more common that - in time - more forms will have FHIR-friendly codes.  But it's far from guaranteed - and will certainly take a long time.</p>\n</blockquote>\n<p>Fair enough, but one can dream and wish <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> Are you aware of any group that tries to come up with authoring guidelines for \"FHIR friendly\" questionnaires? If we want to move there then we should eventually define what it is?</p>",
        "id": 233198850,
        "sender_full_name": "Tilo Christ",
        "timestamp": 1617641862
    },
    {
        "content": "<p>None that I'm aware of - but there are all sorts of things I'm not aware of :)</p>",
        "id": 233201201,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1617642998
    }
]