[
    {
        "content": "<p>I'm trying to search for any QuestionnaireResponses to a certain Questionnaire. This search works:</p>\n<div class=\"codehilite\"><pre><span></span><code>QuestionnaireResponse?_lastUpdated=gt$2020-01-01&amp;subject=Patient/1234567890\n</code></pre></div>\n<p>But none of these do.</p>\n<div class=\"codehilite\"><pre><span></span><code>QuestionnaireResponse?questionnaire=d79017af-3a87-4ca1-aa6d-400f66d037b9&amp;_lastUpdated=gt$2020-01-01&amp;subject=Patient/1234567890\nQuestionnaireResponse?questionnaire=d79017af-3a87-4ca1-aa6d-400f66d037b9\nQuestionnaireResponse?questionnaire=Questionnaire/d79017af-3a87-4ca1-aa6d-400f66d037b9\n</code></pre></div>\n<p>I've tried this on both HAPI and GCP. I assume I'm just formatting it incorrectly, but I've tried the permutations above plus a number of others, and I can't seem to figure it out. What would be the correct format for this?</p>",
        "id": 262277976,
        "sender_full_name": "Grey Faulkenberry",
        "timestamp": 1637554440
    },
    {
        "content": "<p>QuestionnaireResponse.questionnaire has a type of 'canonical'.  That means it must refer to Questionnaire.url, which in turn must be a full URL.  (Relative URLs aren't allowed.)</p>",
        "id": 262324164,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637590733
    },
    {
        "content": "<p>So try <code>questionnaire=http://somewhere.org/fhir/Questionnaire/d79017af-...</code> assuming that's the 'url' of your Questionnaire.  There are variants where you can also specify the Questionnaire.version.  Don't forget to escape the URL when it appears as a parameter in your search.</p>",
        "id": 262324344,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637590821
    },
    {
        "content": "<p>Aha, that's my problem. Thanks Lloyd!</p>",
        "id": 262335031,
        "sender_full_name": "Grey Faulkenberry",
        "timestamp": 1637595398
    },
    {
        "content": "<p>Or not. I'm apparently still missing something. On Hapi, there's this questionnaire:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/Questionnaire/1634062\n</code></pre></div>\n<p>Along with this QuestionnaireResponse:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/QuestionnaireResponse/1672619\n</code></pre></div>\n<p>But then when I try this:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/QuestionnaireResponse?questionnaire=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FQuestionnaire%2F1634062&amp;_pretty=true\n</code></pre></div>\n<p>I get an error. Any thoughts on what I'm doing wrong?</p>",
        "id": 262356351,
        "sender_full_name": "Grey Faulkenberry",
        "timestamp": 1637604470
    },
    {
        "content": "<p>I don't see a 'url' element declared in that Questionnaire.</p>",
        "id": 262356536,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637604549
    },
    {
        "content": "<p>If it doesn't have a 'url' defined, you can't reference it.</p>",
        "id": 262356553,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637604558
    },
    {
        "content": "<p>Alright, how about now?</p>",
        "id": 262356932,
        "sender_full_name": "Grey Faulkenberry",
        "timestamp": 1637604735
    },
    {
        "content": "<p>That should work I believe.  If it's not, best to raise on <a class=\"stream\" data-stream-id=\"179167\" href=\"/#narrow/stream/179167-hapi\">#hapi</a></p>",
        "id": 262365115,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637608628
    },
    {
        "content": "<p>Will do, just wanted to make sure it was formatted properly, thanks!</p>",
        "id": 262376377,
        "sender_full_name": "Grey Faulkenberry",
        "timestamp": 1637614549
    },
    {
        "content": "<p>As far as I could tell :)</p>",
        "id": 262378915,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637615905
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179255-questionnaire/topic/Search.20for.20QuestionnaireResponse.20from.20Questionnaire/near/262324164\">said</a>:</p>\n<blockquote>\n<p>QuestionnaireResponse.questionnaire has a type of 'canonical'.  That means it must refer to Questionnaire.url, which in turn must be a full URL.  (Relative URLs aren't allowed.)</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  Is a canonical like \"#q\" (as used in <a href=\"https://build.fhir.org/ig/HL7/sdc/adaptive.html\">https://build.fhir.org/ig/HL7/sdc/adaptive.html</a>) considered to be a \"full\" URL?</p>",
        "id": 263159070,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1638285370
    },
    {
        "content": "<p>Yes.  If you're pointing to a contained Questionnaire, then you can get away with just the #[id].  (And no need for the contained Questionnaire to <em>have</em> a url.)</p>",
        "id": 263164913,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638287827
    },
    {
        "content": "<p>OK, so I apparently still need some help, because I can't get this to work on HAPI or GCP. Here is my HAPI setup:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/Questionnaire/1634062\n</code></pre></div>\n<p>And then there's this response to it:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/QuestionnaireResponse/1672619\n</code></pre></div>\n<p>Note that the QuestionnaireResponse has </p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/Questionnaire/1634062\n</code></pre></div>\n<p>as the URL, and I can even search like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/Questionnaire?url=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FQuestionnaire%2F1634062&amp;_pretty=true\n</code></pre></div>\n<p>And it will find the Questionnaire I'm looking for. However, when I perform this search:<br>\nBut then when I try to search for the second using the first as a parameter:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/QuestionnaireResponse?questionnaire=http%3A%2F%2Fhapi.fhir.org%2FbaseR4%2FQuestionnaire%2F1634062&amp;_pretty=true\n</code></pre></div>\n<p>I get an error. </p>\n<p>Another example on GCP (this request requires authentication, but I get the same result):</p>\n<div class=\"codehilite\"><pre><span></span><code>https://healthcare.googleapis.com/v1/projects/zanenet-njinck/locations/us-central1/datasets/dev-zanenet-njinck/fhirStores/stage-zanenet-njinck-datastore/fhir/Questionnaire/5b267df7-b195-4a75-8848-50c8a01dc85b\n</code></pre></div>\n<p>Or I can search for the questionnaire:</p>\n<div class=\"codehilite\"><pre><span></span><code>https://healthcare.googleapis.com/v1/projects/zanenet-njinck/locations/us-central1/datasets/dev-zanenet-njinck/fhirStores/stage-zanenet-njinck-datastore/fhir/Questionnaire?url=https%3A%2F%2Fhealthcare.googleapis.com%2Fv1%2Fprojects%2Fzanenet-njinck%2Flocations%2Fus-central1%2Fdatasets%2Fdev-zanenet-njinck%2FfhirStores%2Fstage-zanenet-njinck-datastore%2Ffhir%2FQuestionnaire%2F5b267df7-b195-4a75-8848-50c8a01dc85b\n</code></pre></div>\n<p>So it recognizes the url properly. Then this is an example for a QuestionnaireResponse to the Questionnaire:</p>\n<div class=\"codehilite\"><pre><span></span><code>https://healthcare.googleapis.com/v1/projects/zanenet-njinck/locations/us-central1/datasets/dev-zanenet-njinck/fhirStores/stage-zanenet-njinck-datastore/fhir/Questionnaire/a210d717-8c68-449d-8668-41fcb9391f7e\n</code></pre></div>\n<p>And I note that the questionnaire field for this QuestionniareResponse is:</p>\n<div class=\"codehilite\"><pre><span></span><code>https://healthcare.googleapis.com/v1/projects/zanenet-njinck/locations/us-central1/datasets/dev-zanenet-njinck/fhirStores/stage-zanenet-njinck-datastore/fhir/Questionnaire/5b267df7-b195-4a75-8848-50c8a01dc85b\n</code></pre></div>\n<p>And yet, when I try this:</p>\n<div class=\"codehilite\"><pre><span></span><code>https://healthcare.googleapis.com/v1/projects/zanenet-njinck/locations/us-central1/datasets/dev-zanenet-njinck/fhirStores/stage-zanenet-njinck-datastore/fhir/QuestionnaireResponse?questionnaire=https://healthcare.googleapis.com/v1/projects/zanenet-njinck/locations/us-central1/datasets/dev-zanenet-njinck/fhirStores/stage-zanenet-njinck-datastore/fhir/Questionnaire/5b267df7-b195-4a75-8848-50c8a01dc85b\n</code></pre></div>\n<p>Or this:</p>\n<div class=\"codehilite\"><pre><span></span><code>https://healthcare.googleapis.com/v1/projects/zanenet-njinck/locations/us-central1/datasets/dev-zanenet-njinck/fhirStores/stage-zanenet-njinck-datastore/fhir/QuestionnaireResponse?questionnaire=https%3A%2F%2Fhealthcare.googleapis.com%2Fv1%2Fprojects%2Fzanenet-njinck%2Flocations%2Fus-central1%2Fdatasets%2Fdev-zanenet-njinck%2FfhirStores%2Fstage-zanenet-njinck-datastore%2Ffhir%2FQuestionnaire%2F5b267df7-b195-4a75-8848-50c8a01dc85b\n</code></pre></div>\n<p>It returns an empty bundle.<br>\nCould anyone help point out what I'm doing wrong?</p>",
        "id": 264386377,
        "sender_full_name": "Grey Faulkenberry",
        "timestamp": 1639095127
    },
    {
        "content": "<p>That indeed looks like a HAPI bug to me.</p>",
        "id": 264402223,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639110881
    },
    {
        "content": "<p>Suggest asking on <a class=\"stream\" data-stream-id=\"179167\" href=\"/#narrow/stream/179167-hapi\">#hapi</a></p>",
        "id": 264406230,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639115741
    },
    {
        "content": "<p>The thing that bothered me was that I got an error on the GCP platform as well (and they use their own implementation). So I was trying to make sure I wasn't missing something. I had asked this on the HAPI channel but hadn't gotten a response yet.</p>",
        "id": 264461546,
        "sender_full_name": "Grey Faulkenberry",
        "timestamp": 1639149561
    },
    {
        "content": "<p>The questionnaire parameter works in HAPI 5.3: <a href=\"https://lforms-fhir.nlm.nih.gov/baseR4/QuestionnaireResponse?questionnaire=https://lforms-fhir.nlm.nih.gov/baseR4/Questionnaire/74728-7-modified-x\">https://lforms-fhir.nlm.nih.gov/baseR4/QuestionnaireResponse?questionnaire=https://lforms-fhir.nlm.nih.gov/baseR4/Questionnaire/74728-7-modified-x</a></p>",
        "id": 264465819,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1639151422
    }
]