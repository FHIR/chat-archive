[
    {
        "content": "<p>I was relying on meta.profile to select between STU3 &amp; R4 (per <a href=\"http://build.fhir.org/versioning.html#mp-version\" target=\"_blank\" title=\"http://build.fhir.org/versioning.html#mp-version\">http://build.fhir.org/versioning.html#mp-version</a>).  However, the SDC profile has just: <a href=\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire\" target=\"_blank\" title=\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire\">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire</a>, without a FHIR version number.  Shouldn't there be a version number?</p>",
        "id": 154016487,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541633051
    },
    {
        "content": "<p>you can still add in the core profile too.</p>",
        "id": 154016506,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1541635942
    },
    {
        "content": "<p>I'm looking forward to just doing R4 when I can migrate all our usage across, that's going to be my 1st Q next year.</p>",
        "id": 154016507,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1541635998
    },
    {
        "content": "<p>The profile itself doesn't need to say that, its a part of the bigger chain. and hope that R5 won't look significantly different :) but not holding my breath on that one</p>",
        "id": 154016508,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1541636052
    },
    {
        "content": "<p>To reference a specific version you can do this: \"<a href=\"http://fhir/uv/sdc/StructureDefinition/sdc-questionnaire|2.0\" target=\"_blank\" title=\"http://fhir/uv/sdc/StructureDefinition/sdc-questionnaire|2.0\">http://fhir/uv/sdc/StructureDefinition/sdc-questionnaire|2.0</a>\"</p>",
        "id": 154016540,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541640369
    },
    {
        "content": "<p>That's not a version of FHIR, that's a version of the guide. <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span>  is looking for the FHIR version aren't you?</p>",
        "id": 154016545,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1541646367
    },
    {
        "content": "<p>what about StructureDefinition.fhirVersion?</p>",
        "id": 154016574,
        "sender_full_name": "Eric Haas",
        "timestamp": 1541653185
    },
    {
        "content": "<p>I think Paul was meaning in the questionnaire instance.</p>",
        "id": 154016590,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1541666075
    },
    {
        "content": "<p>Identifying FHIR version in an instance is done using profile - as Paul already identified.  Pretty sure he's looking for IG version...</p>",
        "id": 154016622,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541680034
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  I thought I was looking for a FHIR version.  Is there a FHIR version associated with SDC 2.0 (e.g. something like R4)?  I would think there would need to be, since it is based on Questionnaire, which is a part of FHIR....</p>",
        "id": 154016687,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541688862
    },
    {
        "content": "<p>The spec declares that it's based on 3.0.1</p>",
        "id": 154016691,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541689048
    },
    {
        "content": "<p>(Asserted in the footer on each page)</p>",
        "id": 154016692,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541689070
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> Brian is correct-- I am trying to determine the version from a instance.  The case is where someone is uploading a file containing a Questionnaire resource, to be displayed in an SMART app using LForms to render it.</p>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Okay, so I can map from SDC versions to FHIR versions-- if the SDC version number is provided.   The page at <a href=\"http://hl7.org/fhir/uv/sdc/2018Sep/sdc-questionnaire.html\" target=\"_blank\" title=\"http://hl7.org/fhir/uv/sdc/2018Sep/sdc-questionnaire.html\">http://hl7.org/fhir/uv/sdc/2018Sep/sdc-questionnaire.html</a> says the the official URL is \"<a href=\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire\" target=\"_blank\" title=\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire\">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire</a>\".  Why wouldn't that include a version number?  Also, is there someplace that says  \"<a href=\"http://fhir/uv/sdc/StructureDefinition/sdc-questionnaire|3.5.0\" target=\"_blank\" title=\"http://fhir/uv/sdc/StructureDefinition/sdc-questionnaire|3.5.0\">http://fhir/uv/sdc/StructureDefinition/sdc-questionnaire|3.5.0</a>\" is the right format for specifying the version?</p>\n<p>I saw a note at <a href=\"http://build.fhir.org/versioning.html#mp-version\" target=\"_blank\" title=\"http://build.fhir.org/versioning.html#mp-version\">http://build.fhir.org/versioning.html#mp-version</a> that the R4 version will be \"4\" when published.  Does that mean that these 3.5.0 URLs will change to 4.0 when it is published?</p>",
        "id": 154016699,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541689762
    },
    {
        "content": "<p>Determining the instance can be done using profile - but there's no requirement that instances will do so.  If your SMART app is expecting to handle multiple versions of FHIR, you should allow it to be launched with a parameter that identifies version from context as that will be the other common convention.  Other than that, you could look for certain characteristic differences in the different versions of the resources passed in</p>",
        "id": 154016701,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1541689926
    },
    {
        "content": "<p>Because the demo app is in the SMART App Gallery, which does not yet have an option for R4, and yet the purpose of the app is to demo new the SDC (which requires R4), communication with the App Gallery FHIR server is over R3, but I am trying to allow the upload of R4 forms (which can be displayed as R4, but not saved as R4).</p>",
        "id": 154016705,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1541691162
    },
    {
        "content": "<p>Hmm, I'm feeling your pain there.<br>\nFrom the stuff we've been doing, we have seperate versions of our engines for each fhir version.<br>\nWith R4 going normative, we're hoping to change that.<br>\nFor other stuff I just use the parsers to work it out.<br>\nCheck what I do in Fhirpathtester. If the types or extensions are only from a specific version, then all good.<br>\nWe haven't changed the meaning of any properties or extensions. However between 2 and 3 the fhirpath syntax igbtly changed</p>",
        "id": 154016906,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1541713433
    },
    {
        "content": "<p>you should look at <a href=\"http://build.fhir.org/versioning.html\" target=\"_blank\" title=\"http://build.fhir.org/versioning.html\">http://build.fhir.org/versioning.html</a></p>",
        "id": 154016982,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541723184
    },
    {
        "content": "<p>From the point of view of a client rendering a Questionnaire, putting the version of the IG's Questionnaire profile in meta.profile might be less useful that directly specifying the version of FHIR that is supported, like <a href=\"http://hl7.org/fhir/4.0.1/StructureDefinition/Questionnaire\">http://hl7.org/fhir/4.0.1/StructureDefinition/Questionnaire</a>.  Otherwise, the renderer has to know (or figure out) what version of FHIR any IG's Questionnaire profile is based on.  Can both the IG profile version and the FHIR Questionnaire version be specified in meta.profile?</p>",
        "id": 240393755,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1622064237
    },
    {
        "content": "<p>An instance <em>can</em> expose the FHIR version in the profile - see here: <a href=\"https://build.fhir.org/versioning.html#mp-version\">https://build.fhir.org/versioning.html#mp-version</a><br>\nHowever most of the time, it'll be known from HTTP content negotiation or mime type.</p>",
        "id": 240402128,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622069758
    },
    {
        "content": "<p>We have web apps where people can upload a file containing a Questionnaire, so we have to detect the version from the resource itself.</p>",
        "id": 240476199,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1622125801
    },
    {
        "content": "<p>The upload doesn't have a header that passes the mime type?</p>",
        "id": 240484793,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622129045
    },
    {
        "content": "<p>No.  It is a standard \"input  type=file\" button in the web page, which opens a file chooser for the user to pick a file from their computer for uploading.</p>",
        "id": 240510334,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1622139962
    },
    {
        "content": "<p>Even that normally has a mime type passed in.  If you upload an Excel, Javascript normally can tell that as something distinct from a PNG?</p>",
        "id": 240518861,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622143706
    },
    {
        "content": "<p>Okay, possibly it might say \"application/json\", but I don't see how that would help in detecting which version of FHIR it is.</p>",
        "id": 240519256,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1622143893
    },
    {
        "content": "<p>It <em>could</em> say <code>application/fhir+json;fhirVersion=4.0</code>.  Is that something your RESTful client has any ability to know/specify?  If systems are just going to drag and drop or do a file select on an arbitrary Questionnaire version, you've got 2 options - have an additional webform control that allows them to pick the version from a drop-down, or simply validate the input against the versions you recognize until you find one it doesn't fail on.  Instances, in general, won't declare their versions in the instance.</p>",
        "id": 240528213,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622148064
    },
    {
        "content": "<p>(And making users edit the instances to assert a version profile won't make your tool terribly user-friendly.)</p>",
        "id": 240528281,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622148092
    },
    {
        "content": "<p>The \"it\" specifying the mime type is not the web app doing the rendering, but the web browser or OS.  Google Chrome or Windows 10 isn't likely to recognize certain JSON files as being FHIR R4 anytime soon.</p>\n<p>We do try to guess the FHIR version if it isn't specified in meta.profile, but we check meta.profile first in case someone has specified it there.</p>",
        "id": 240528978,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1622148385
    },
    {
        "content": "<p>Sounds like the appropriate thing to do.</p>",
        "id": 240529097,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622148449
    },
    {
        "content": "<p>Why wouldn't it be good for FHIR to require that every instance of a resource assert which FHIR version it is?  There must be some reason, I suppose.</p>",
        "id": 240529099,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1622148451
    },
    {
        "content": "<p>Because we want receivers to be tolerant of version differences</p>",
        "id": 240536192,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622151909
    },
    {
        "content": "<p>If you receive an Observation that doesn't declare its version, you can quite likely successfully process it if you're set up to consume R4, STU3 or DSTU2 instances.  We know from experience with v2 that receiving the equivalent in v2 space (which does declare version) can mean a charge of $100k+ to \"add support\" for a new version.</p>",
        "id": 240536375,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622151990
    },
    {
        "content": "<p>I can likely process an undeclared version, but I am much more likely to be able to process a version that is known that I do support.  If it is an unknown version, one can always fall back to the undeclared case.  But, maybe you are saying that software tends not to be written that way if the authors know a version is required.</p>",
        "id": 240536799,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1622152224
    },
    {
        "content": "<p>Right.  There's also an incentive (and pattern) of introducing a 'tax' around support for new versions that isn't necessarily justified.</p>",
        "id": 240538993,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1622153584
    }
]