[
    {
        "content": "<p>I'm reading through the resolution to <a href=\"http://jira.hl7.org/browse/FHIR-27937\">FHIR#27937</a> and am struggling to understand what we were thinking.  Changing 'Questionnaire' to 'QuestionnaireResponse' makes no sense - as this is a reference in a Questionnaire to a different Questionnaire that can be used to create the desired resource on the fly.  </p>\n<p>However, on looking at the extension in detail, there are other things that don't make sense:</p>\n<ul>\n<li>the type is 'uri'.  However, if we're wanting to point to a Questionnaire, the type should be 'canonical'</li>\n<li>the description of the extension says that the reference can be \"indirect via mapping if the Reference is to some other sort of resource\", but I have no clue what that means.  It would make no sense for a Questionnaire to point to a specific AllergyIntolerance or Procedure or something.  The best I can presume is that the intention is to point to a profile and then somehow have the system generate a form based on the profile and populate the resulting response into an instance of the profiled resource.  However, there's really no need to list the profile to use because we already have an extension on Questionnaire.item for questions of type Reference that indicates the desired resource type and possibly profile the referenced resource should comply with - so pointing to a profile with this extension would be redundant.</li>\n</ul>\n<p>My proposal: re-open the current tracker item and reject it; create and approve a new tracker item to change the type to \"canonical&lt;Questionnaire&gt;\" and remove the language about indirect.  Thoughts?</p>",
        "id": 263778459,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638724327
    },
    {
        "content": "<p>I think uri to canonical&lt;Questionnaire&gt; is correct.<br>\nHowever I do get what the rest of the text is expecting.</p>",
        "id": 263800284,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638753892
    },
    {
        "content": "<p>The Reference type being identified here is the one that the Quesitonnaire item (or element) contains.<br>\nThe indirect part is if the resource type referenced by the item is not a QuestionnaireResponse, but an Observation reference, which then needs to be extracted to reference (from the Q that was linked)</p>",
        "id": 263800414,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638754027
    },
    {
        "content": "<p>I think this is intended to cover use cases where you have a questionnaire to capture some other data, and can be turned into the target type, then linked (if they didn't already find one)</p>",
        "id": 263800454,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638754083
    },
    {
        "content": "<p>I'm not following.  If you're going to extract, the details of the extraction will be in the Questionnaire.  And if you're going to extract, you MUST point to the Questionnaire - or there'll be no QuestionnaireResponse to extract from.  I was fully expecting extraction to be necessary in all cases...</p>",
        "id": 263804331,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638760003
    },
    {
        "content": "<p>Maybe examples will help.</p>",
        "id": 263804357,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638760049
    },
    {
        "content": "<p>Was that an offer to share some? :)</p>",
        "id": 263805321,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638761481
    },
    {
        "content": "<p>Yes. Just putting it together</p>",
        "id": 263805393,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638761570
    },
    {
        "content": "<p>This is one with the 2 types of usage...</p>\n<div class=\"codehilite\" data-code-language=\"XML\"><pre><span></span><code><span class=\"nt\">&lt;Questionnaire</span> <span class=\"na\">xmlns=</span><span class=\"s\">\"http://hl7.org/fhir\"</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">\"res-ref\"</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">\"http://fhir.telstrahealth.com/demos/Questionnaire/res-ref\"</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;version</span> <span class=\"na\">value=</span><span class=\"s\">\"1\"</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;title</span> <span class=\"na\">value=</span><span class=\"s\">\"Resource Reference demo\"</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">\"draft\"</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;date</span> <span class=\"na\">value=</span><span class=\"s\">\"2015-05-22\"</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;publisher</span> <span class=\"na\">value=</span><span class=\"s\">\"Telstra Health\"</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;item&gt;</span>\n    <span class=\"nt\">&lt;linkId</span> <span class=\"na\">value=</span><span class=\"s\">\"EOS_APS_V01_root\"</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;text</span> <span class=\"na\">value=</span><span class=\"s\">\"Test some resource references\"</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">\"group\"</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;item&gt;</span>\n      <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">\"http://hl7.org/fhir/StructureDefinition/questionnaire-referenceResource\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;valueCode</span> <span class=\"na\">value=</span><span class=\"s\">\"Observation\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/extension&gt;</span>\n      <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-lookupQuestionnaire\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;valueCanonical</span> <span class=\"na\">value=</span><span class=\"s\">\"https://lforms-fhir.nlm.nih.gov/baseR4/Questionnaire/55418-8-x\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/extension&gt;</span>\n      <span class=\"nt\">&lt;linkId</span> <span class=\"na\">value=</span><span class=\"s\">\"recentSpecificObservation\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;text</span> <span class=\"na\">value=</span><span class=\"s\">\"Please select the most recent glucose observation\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">\"reference\"</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/item&gt;</span>\n    <span class=\"nt\">&lt;item&gt;</span>\n      <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">\"http://hl7.org/fhir/StructureDefinition/questionnaire-referenceResource\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;valueCode</span> <span class=\"na\">value=</span><span class=\"s\">\"QuestionnaireResponse\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/extension&gt;</span>\n      <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-lookupQuestionnaire\"</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;valueCanonical</span> <span class=\"na\">value=</span><span class=\"s\">\"https://fhir.telstrahealth.com/fastforms/Questionnaire/hacc\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/extension&gt;</span>\n      <span class=\"nt\">&lt;linkId</span> <span class=\"na\">value=</span><span class=\"s\">\"haccFunding\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;text</span> <span class=\"na\">value=</span><span class=\"s\">\"Additional funding information\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">\"reference\"</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/item&gt;</span>\n  <span class=\"nt\">&lt;/item&gt;</span>\n<span class=\"nt\">&lt;/Questionnaire&gt;</span>\n</code></pre></div>",
        "id": 263805545,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638761837
    },
    {
        "content": "<p>Note that the first item is after an Observation to reference, but the definition indicates that you can use the Questionniare to capture that data and extract to the obs...</p>",
        "id": 263805628,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638761966
    },
    {
        "content": "<p>Also note that <a href=\"https://hl7.org/fhir/R4/extension-questionnaire-referencefilter.html\">https://hl7.org/fhir/R4/extension-questionnaire-referencefilter.html</a> can be used to filter down, however I'm not sure that the definition of that filter is adequate - should create a jira tracker to clarify that? i.e. handlebars syntax and what real values should be there...</p>",
        "id": 263805683,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638762024
    },
    {
        "content": "<p>Ok.  Then in all cases the reference is to a Questionnaire.  The only special note that would be required is saying that the result is generally extracted to create the target resource, the only exception being if the target resource is a QuestionnaireResponse.  (The existing wording definitely doesn't convey that, at least not to me...)</p>",
        "id": 263806849,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638763530
    },
    {
        "content": "<p>The canonical is yes, but the text that was saying QuestionnaireResponse, was to the item.reference, not this extension - that's where the confusion slips in.</p>",
        "id": 263807078,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638763833
    },
    {
        "content": "<p>And direct (being the type of the item.reference restiction is QuestionnaireResponse) and indirect (being that you need to convert from the QR to the target reference type)</p>",
        "id": 263807091,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638763877
    },
    {
        "content": "<p>Does that sound like the intent of the tracker?</p>",
        "id": 263807102,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638763896
    },
    {
        "content": "<p>Ok, I can work with that understanding.</p>",
        "id": 263807304,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638764247
    },
    {
        "content": "<p>So still going to change from a uri/url extension to a canonical right?</p>",
        "id": 263807507,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1638764585
    },
    {
        "content": "<p>y</p>",
        "id": 263807967,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638765322
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191367\">Brian Postlethwaite</span> <a href=\"#narrow/stream/179255-questionnaire/topic/Problem.20with.20resolution.20of.20FHIR-/near/263805683\">said</a>:</p>\n<blockquote>\n<p>Also note that <a href=\"https://hl7.org/fhir/R4/extension-questionnaire-referencefilter.html\">https://hl7.org/fhir/R4/extension-questionnaire-referencefilter.html</a> can be used to filter down, however I'm not sure that the definition of that filter is adequate - should create a jira tracker to clarify that? i.e. handlebars syntax and what real values should be there...</p>\n</blockquote>\n<p>Please do.  It is not at all clear how to use that extension.</p>",
        "id": 263858289,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1638801434
    },
    {
        "content": "<p>So, if you have a item.reference to an Observation, and use the lookupQuestionnaire extension, is the assumption that the $extract on the Questionnaire would only result in a single Observation being extracted?</p>",
        "id": 263858793,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1638801650
    },
    {
        "content": "<p>That's certainly my assumption</p>",
        "id": 263865377,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638804183
    },
    {
        "content": "<p>It's a Questionnaire specifically designed to result in an instance of the desired resource.</p>",
        "id": 263865450,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638804200
    }
]