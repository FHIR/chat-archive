[
    {
        "content": "<p>Is it right to embed Math Logic in a questionnaire? <br>\nquestionItem1 reponse = 3<br>\nquestionItem2 response= 10 </p>\n<p>Would there be a place where i could embed the math logic into? Item1 + Item2.<br>\nI was thinking about this example: <a href=\"https://www.hl7.org/fhir/questionnaire-example-gcs.json.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/questionnaire-example-gcs.json.html\">https://www.hl7.org/fhir/questionnaire-example-gcs.json.html</a> It is a math based questionnaire but leaves calculations to the client side perhaps.</p>",
        "id": 154000291,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1538060817
    },
    {
        "content": "<p>Take a look at the structured data capture implementation guide.  It provides some guidance in this space (though more is still needed).  Essentially you're going to use the \"variable\" extension and the \"calculatedExpression\" extension</p>",
        "id": 154000293,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538060996
    },
    {
        "content": "<p>great. thanks. will check back</p>",
        "id": 154000294,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1538061840
    },
    {
        "content": "<p>Seems like its not for r3?</p>",
        "id": 154000313,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1538063925
    },
    {
        "content": "<p>Correct, though you can adopt the same approach in R3 with a custom extension</p>",
        "id": 154000320,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538064631
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> why is argonaut using different extensions than SDC defines:</p>\n<div class=\"codehilite\"><pre><span></span>      &lt;extension url=&quot;http://fhir.org/guides/argonaut-questionnaire/StructureDefinition/extension-score&quot;&gt;\n        &lt;valueDecimal value=&quot;17&quot;/&gt;\n      &lt;/extension&gt;\n</pre></div>",
        "id": 154000913,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538109198
    },
    {
        "content": "<p>1) for STU3<br>\n2) There was no extension for option.valueString or for items...which we only fixed for R4</p>",
        "id": 154000939,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538115197
    },
    {
        "content": "<p>I don't understand why either of those is a reason not to use the SDC extension URL</p>",
        "id": 154000947,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538130081
    },
    {
        "content": "<p>Score shouldn't be an extension - score should be the answer to a question</p>",
        "id": 154000990,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538141302
    },
    {
        "content": "<p>it should be the calculdated-value extension</p>",
        "id": 154000995,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538141518
    },
    {
        "content": "<p>The calculated-value tells you the calculation.  The actual score goes in the item.answer.value</p>",
        "id": 154001024,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538146802
    },
    {
        "content": "<p>of so that's the ordinal value extension - why not use that one?</p>",
        "id": 154001052,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538148216
    },
    {
        "content": "<p>Ordinal value is for a code or option.  It's tied to the choice, it's not dynamic.</p>",
        "id": 154001064,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538148360
    },
    {
        "content": "<p>so that's what the extension above is?</p>",
        "id": 154001068,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538148550
    },
    {
        "content": "<p>The extension above is the formula, not the value.</p>",
        "id": 154001079,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538149971
    },
    {
        "content": "<p>The value of the score is conveyed as the answer to a question.  It can be a hidden question if you don't want the person filling the form to see the score.</p>",
        "id": 154001080,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538149999
    },
    {
        "content": "<p>the argonaut extension has <strong>nothing</strong> to  do with a calculated value -  it is what value is assigned to the question.  I  see how the word \"score\" is confusing and will need to change that.   There is no scoring -as in calculating the score and providing that- extensions for the Argo Q - just numbers that can be assigned to any type of question.   The total score could be a hidden q-a pair though we don't document that.</p>",
        "id": 154001181,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538197111
    },
    {
        "content": "<p>I'm not understanding this then. What is 'the score' if it's not the ordinal value?</p>",
        "id": 154001189,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538209412
    },
    {
        "content": "<p>see this example.   Score=17 is the integer value associated with that question.  Its is static number and not calculated - I think you make a good point as to what it means when calculating a total score since is open to interpretation.   it could be a weight a, or a max for that question/group etc.    Its easier to interpret a score in the second example  when is a multiple choice since its easier to intepret each choice having a value or weight that can be used to calculate  a total.  <a href=\"/user_uploads/10155/voxWd0lQ5qHqBrgLviDaHH5u/Screen-Shot-2018-09-29-at-3.23.57-AM.png\" target=\"_blank\" title=\"Screen-Shot-2018-09-29-at-3.23.57-AM.png\">Screen-Shot-2018-09-29-at-3.23.57-AM.png</a> <a href=\"/user_uploads/10155/oztyd-TZ5A3QmX0T-pRXCSg-/Screen-Shot-2018-09-29-at-3.40.30-AM.png\" target=\"_blank\" title=\"Screen-Shot-2018-09-29-at-3.40.30-AM.png\">Screen-Shot-2018-09-29-at-3.40.30-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/voxWd0lQ5qHqBrgLviDaHH5u/Screen-Shot-2018-09-29-at-3.23.57-AM.png\" target=\"_blank\" title=\"Screen-Shot-2018-09-29-at-3.23.57-AM.png\"><img src=\"/user_uploads/10155/voxWd0lQ5qHqBrgLviDaHH5u/Screen-Shot-2018-09-29-at-3.23.57-AM.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/oztyd-TZ5A3QmX0T-pRXCSg-/Screen-Shot-2018-09-29-at-3.40.30-AM.png\" target=\"_blank\" title=\"Screen-Shot-2018-09-29-at-3.40.30-AM.png\"><img src=\"/user_uploads/10155/oztyd-TZ5A3QmX0T-pRXCSg-/Screen-Shot-2018-09-29-at-3.40.30-AM.png\"></a></div>",
        "id": 154001228,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538217652
    },
    {
        "content": "<p>and like  I said before the word 'score' here may be confusing.  'weight' or 'integer value associated wth this item' might be better</p>",
        "id": 154001229,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538217742
    },
    {
        "content": "<p>here is a score associated with a text answer...</p>",
        "id": 154001231,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538217887
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/RzcwrWNrqlcGvNR7QzsS9JE_/Screen-Shot-2018-09-29-at-3.44.08-AM.png\" target=\"_blank\" title=\"Screen-Shot-2018-09-29-at-3.44.08-AM.png\">Screen-Shot-2018-09-29-at-3.44.08-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/RzcwrWNrqlcGvNR7QzsS9JE_/Screen-Shot-2018-09-29-at-3.44.08-AM.png\" target=\"_blank\" title=\"Screen-Shot-2018-09-29-at-3.44.08-AM.png\"><img src=\"/user_uploads/10155/RzcwrWNrqlcGvNR7QzsS9JE_/Screen-Shot-2018-09-29-at-3.44.08-AM.png\"></a></div>",
        "id": 154001232,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538217900
    },
    {
        "content": "<p>so this is the ordinalValue extension then</p>",
        "id": 154001233,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538218267
    },
    {
        "content": "<p>yes and it predated the expansion of  its context and consolidation of all the various extensions , I plan to update the name of it to align with it.  Its the STU3 version of it</p>",
        "id": 154001234,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538218831
    },
    {
        "content": "<p>well can we do that for this connectathon?</p>",
        "id": 154001235,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538218919
    },
    {
        "content": "<p>Its unlikely I will have a chance to change it before then.</p>",
        "id": 154001236,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538219042
    },
    {
        "content": "<p>There are other things that predate SDC and will need to be aligned too.</p>",
        "id": 154001238,
        "sender_full_name": "Eric Haas",
        "timestamp": 1538219184
    },
    {
        "content": "<p>.. all my tooling is SDC based :-(</p>",
        "id": 154001255,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538221096
    },
    {
        "content": "<p>Why is that a frowny-face? ;)</p>",
        "id": 154001257,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538221126
    },
    {
        "content": "<p>because the questionnaires for the connectathon track are not consistent with SDC, so my tooling isn't applicable</p>",
        "id": 154001258,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1538221169
    },
    {
        "content": "<p>I did understand that.  And am happy the intention is to align</p>",
        "id": 154001263,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1538221262
    },
    {
        "content": "<blockquote>\n<p>Take a look at the structured data capture implementation guide.  It provides some guidance in this space (though more is still needed).  Essentially you're going to use the \"variable\" extension and the \"calculatedExpression\" extension</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> is there an example using these two extensions?</p>",
        "id": 154020656,
        "sender_full_name": "Koray Atalag",
        "timestamp": 1543033177
    },
    {
        "content": "<p>Not yet.  I hope to have time to work on examples in December and January in advance of the connectathon.</p>",
        "id": 154020667,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1543090033
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191420\">@Koray Atalag</span> I have an example here: <a href=\"https://raw.githubusercontent.com/lhncbc/lforms-fhir-app/master/e2e-tests/data/weight-height-questionnaire.json\" target=\"_blank\" title=\"https://raw.githubusercontent.com/lhncbc/lforms-fhir-app/master/e2e-tests/data/weight-height-questionnaire.json\">https://raw.githubusercontent.com/lhncbc/lforms-fhir-app/master/e2e-tests/data/weight-height-questionnaire.json</a></p>\n<p>which calculates a BMI, though it has a couple of minor problems:</p>\n<p>1) In the questionnaire-calculatedExpression, I think the correct FHIRPath would put \"%resource.item\" where I just have \"item\".<br>\n2) it is still using R3 syntax for the lists (\"option\" instead of \"answerOption\")-- but I think that issue is probably not relevant.</p>\n<p>You can upload this example into our viewer here:  <a href=\"https://apps.smarthealthit.org/app/lforms-questionnaire-app\" target=\"_blank\" title=\"https://apps.smarthealthit.org/app/lforms-questionnaire-app\">https://apps.smarthealthit.org/app/lforms-questionnaire-app</a> and see it working.</p>",
        "id": 154020874,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1543247672
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span>  Thanks for the links. I have a related question:<br>\nI noticed the QuestionnaireResponse created through the SMART App \"LHNCPC SDC Questionnaire App\", does not calculate the BMI through FHIRPath, is this because it is a server side step and the QR is autoupdated after upload with the appropriate result?</p>",
        "id": 154860362,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1547144613
    },
    {
        "content": "<p>First, I should point out that due to a reorganization of the files, the updated link for the Questionnaire example is at <a href=\"https://raw.githubusercontent.com/lhncbc/lforms-fhir-app/master/e2e-tests/data/R4/weight-height-questionnaire.json\" target=\"_blank\" title=\"https://raw.githubusercontent.com/lhncbc/lforms-fhir-app/master/e2e-tests/data/R4/weight-height-questionnaire.json\">https://raw.githubusercontent.com/lhncbc/lforms-fhir-app/master/e2e-tests/data/R4/weight-height-questionnaire.json</a> .</p>\n<p>As you'll see in that example, the BMI is calculated through FHIRPath (search for \"BMI calculation\").  It is done on the client side.  The QuestionnaireResponse (\"Show As\"-&gt;\"FHIR QuestionnaireResponse (SDC)\") also includes the value that was calculated.</p>\n<p>I just updated the system this morning, and of course after the update was live, found a couple of bugs which I am working to fix.  But, the above example still works.</p>",
        "id": 154860857,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1547145070
    },
    {
        "content": "<p>Perfect, thanks. <br>\nI couldn't get the calculated BMI item in QR SDC at <a href=\"https://lhncbc.github.io/lforms-fhir-app/\" target=\"_blank\" title=\"https://lhncbc.github.io/lforms-fhir-app/\">https://lhncbc.github.io/lforms-fhir-app/</a> <br>\nI used both stu3 and the r3 sample through upload.</p>",
        "id": 154863602,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1547147609
    },
    {
        "content": "<p>The calculatedExpression extension is for R4, so you would need to use the R4 example.</p>",
        "id": 154863760,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1547147747
    },
    {
        "content": "<p>Did you mean R4?  I see you wrote both \"STU3\" and \"r3\" which are the same.  I just tried the R4 example there and it worked.</p>",
        "id": 154864350,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1547148253
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/RdshTwHYSYixrh_p-6Z4yyec/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/RdshTwHYSYixrh_p-6Z4yyec/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/RdshTwHYSYixrh_p-6Z4yyec/pasted_image.png\"></a></div>",
        "id": 154864426,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1547148324
    },
    {
        "content": "<p>Sorry, I meant R4. For some reason, that isn't working for me when I try it. I'll try again with the right file.</p>",
        "id": 154867528,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1547151161
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194948\">@Raheel Sayeed</span> One thing that might be causing confusion is that, while the BMI calculation will run after you upload the form, after you have saved form to the server and pull it back, it will no longer run, because the server is STU3 (and so the resource that is saved and comes back no longer has the R4 extensions).</p>",
        "id": 154878449,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1547160254
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span> that was an issue.</p>",
        "id": 155187998,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1547573676
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194948\">@Raheel Sayeed</span> It just (re-)discovered that LHC-Forms somewhat accidentally does support calculatedExpression for STU3 questionnaires, and there are tests in LHC-Forms for that functionality with STU3.  This means that support does exist on the <a href=\"https://apps.smarthealthit.org/app/lforms-questionnaire-app\" target=\"_blank\" title=\"https://apps.smarthealthit.org/app/lforms-questionnaire-app\">NLM SDC Questionnaire SMART app</a>.  For an example STU3 form that uses calculatedExpression to do a BMI value, see <a href=\"https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json\" target=\"_blank\" title=\"https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json\">https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json</a>.  You can use the \"upload\" button on the SMART app to upload it and try it.  (Ignore the warning message you get.)</p>",
        "id": 159014488,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1550696493
    },
    {
        "content": "<p>Whooa, this is great. thanks <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span></p>",
        "id": 159100645,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1550779915
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span> Have you implemented FHIRPath logic for the calculatedExpression? Can you point me to it in the app?</p>",
        "id": 159620299,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1551365580
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194948\">@Raheel Sayeed</span>  Did you look at <a href=\"https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json\" target=\"_blank\" title=\"https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json\">https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json</a>?  If you search there for \"calculatedExpression\" you will see an example.</p>",
        "id": 159621440,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1551366446
    },
    {
        "content": "<p>I did, I was trying that in the app: <a href=\"https://apps.smarthealthit.org/app/lforms-questionnaire-app\" target=\"_blank\" title=\"https://apps.smarthealthit.org/app/lforms-questionnaire-app\">https://apps.smarthealthit.org/app/lforms-questionnaire-app</a> (\"Try App\"), uploaded the resource you mentioned. It  does layout the form and upon saving it back, It calculated once, rightly showed the BMI in QR. But I couldn't replicate that behavior.</p>",
        "id": 159628158,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1551370742
    },
    {
        "content": "<p>By \"replicate\", do you mean that when you used calculatdExpression in your own questionnaire, and loaded it into that app, that the calculation didn't work?  If you'd like to email me the questionnaire, I'll take a look and see if I can spot the problem.  Assuming your questionnaire and expression are correct, it might be that you have run  into a bug.</p>",
        "id": 159629187,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1551371403
    },
    {
        "content": "<p>I meant the same questionnaire  ––&gt; <a href=\"https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json\" target=\"_blank\" title=\"https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json\">https://raw.githubusercontent.com/lhncbc/lforms/master/test/data/STU3/weightHeightQuestionnaire.json</a> . Perhaps some issue with the sandbox its running against.</p>",
        "id": 159630662,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1551372552
    },
    {
        "content": "<p>Are you using \"upload\" to upload the form, or are you using a saved copy from the server?  The server's FHIR version is R3, so those copies don't have the calculatedExpression extension.</p>",
        "id": 159632967,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1551374196
    },
    {
        "content": "<p>Yes, did use upload. and it did work once. later uploads didn't quite work.</p>",
        "id": 159644439,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1551382311
    },
    {
        "content": "<p>Which web browser are you using?  I just retested with Firefox and Chrome, and it is working for me.  I do notice an issue with Edge (but the form there does not even load, so I don't think that is what you are seeing.)</p>",
        "id": 159646101,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1551383616
    },
    {
        "content": "<p>Totally worked. Safari was the problem. BMI is calculated at client side. </p>\n<p>A question though: I see calculation happening client side. Ideally, on R4 servers, is this handled server side? A QR generated with an FHIRPath item, is updated with calculated value after POST.</p>",
        "id": 159647204,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1551384277
    },
    {
        "content": "<p><a href=\"http://hl7.org/fhir/2018Sep/extension-questionnaire-calculatedexpression.html\" target=\"_blank\" title=\"http://hl7.org/fhir/2018Sep/extension-questionnaire-calculatedexpression.html\">http://hl7.org/fhir/2018Sep/extension-questionnaire-calculatedexpression.html</a> says, \"Calculated value is updated as other answers in the QuestionnaireResponse are filled in.\"  So, the intent is that the BMI value updates in response to the user inputting/changing values.  After a QR is saved to a server, that BMI value does not automatically get updated based on new heights and weights saved in other resources.  (One could pull back a QuestionnaireResponse and edit the height &amp; weight values to get the BMI to update, but again that would be client-side.)</p>",
        "id": 159649308,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1551385786
    },
    {
        "content": "<p>(It also sounds like I should find a way to test from Safari.)</p>",
        "id": 159651306,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1551387313
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194948\">@Raheel Sayeed</span> I think I have fixed the Safari and Edge issues (which were different problems) in the <a href=\"https://apps.smarthealthit.org/app/lforms-questionnaire-app\" target=\"_blank\" title=\"https://apps.smarthealthit.org/app/lforms-questionnaire-app\">SDC SMART app</a>.  As a side benefit to working on this problem, I now have a Mac in my office.</p>",
        "id": 161790343,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1553625177
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span> Great! it works.</p>",
        "id": 163582842,
        "sender_full_name": "Raheel Sayeed",
        "timestamp": 1555522312
    }
]