[
    {
        "content": "<p>I'm working on a project where we receive fhir messages that are validated according to profiles depending on the eventType. These messages are stored in a custom event-store as part of an EventSourcing architecture. The profiles are owned and managed by my team.</p>\n<p>I do foresee that the events' structure\\profile may change over time and might even have breaking changes. In that scenario we still want to be able to receive messages conforming to old versions of the profiles while our clients transitions to new versions. We also want to handle messages of different versions while replaying events from the event-store.</p>\n<p>What is the current best practice to label messages with a version? I've considered the following alternatives:</p>\n<ol>\n<li>Explicitly specify the profile in Bundle.Meta.Profile, and embed the version in the profile's canonical-url: e.g. <code>some-domain/StructureDefinition/my-message-v2</code>.</li>\n<li>Same as 1., but have different business-versions, e.g. <code>some-domain/StructureDefinition/my-message|2.1.0</code>. Will the validator handle this?</li>\n<li>Embed the version in the MessageHeader.event Code, e.g. <code>patient-admitted-v2</code>. The correct profile can be selected using slicing.</li>\n</ol>\n<p>Whichever version we choose I guess each version must have its own fhir package in order to handle breaking changes in transient dependencies?</p>",
        "id": 245107182,
        "sender_full_name": "Eirik Myklebost",
        "timestamp": 1625611043
    },
    {
        "content": "<ol>\n<li>This will work, but creates maintenance challenges of fixing all of your links</li>\n<li>Validator <em>should</em> handle that, though support for multiple versions of a single profile is not widely (at all?) tested</li>\n<li>That sounds like it's going to get really ugly really fast</li>\n</ol>",
        "id": 245107934,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1625611667
    },
    {
        "content": "<p>So you would suggest going for option 1.? Can you think of a better solution that I haven't considered?</p>",
        "id": 245108976,
        "sender_full_name": "Eirik Myklebost",
        "timestamp": 1625612446
    },
    {
        "content": "<p>My preference is option #2, I just can't guarantee how well the tools will work yet.  It's certainly something that <em>should</em> work.</p>",
        "id": 245111791,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1625614919
    },
    {
        "content": "<p>Ok, thanks! That is also be my preference. I will have to look into loading multiple different versions of the same fhir package. If it doesn't work I can use different validator instances and choose depending on the profile.</p>",
        "id": 245145239,
        "sender_full_name": "Eirik Myklebost",
        "timestamp": 1625646198
    },
    {
        "content": "<p>why can't new profiles be defined as the profiling changes? Thus each is tagged with exactly what the sender intended?</p>",
        "id": 245168058,
        "sender_full_name": "John Moehrke",
        "timestamp": 1625659137
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191404\">John Moehrke</span> <a href=\"#narrow/stream/179263-fhir-messages/topic/Versioned.20Messages/near/245168058\">said</a>:</p>\n<blockquote>\n<p>why can't new profiles be defined as the profiling changes? Thus each is tagged with exactly what the sender intended?</p>\n</blockquote>\n<p>I'm not sure I understood the question, but that would effectively be what option 1 is suggesting; creating a new profile for the new version.</p>",
        "id": 245170971,
        "sender_full_name": "Eirik Myklebost",
        "timestamp": 1625660811
    },
    {
        "content": "<p>okay, I was reading that you were adding a version vector to the profile. I was specifically saying that the profile canonical URI would change, not just the version.</p>",
        "id": 245171084,
        "sender_full_name": "John Moehrke",
        "timestamp": 1625660884
    },
    {
        "content": "<p>If you change the canonical URL of the profile, that breaks all references to the profile.  Standard behavior in an IG is to leave all of the canonical URLs the same and increment the version of everything in the IG.  That's simplest from a maintenance perspective.</p>",
        "id": 245185757,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1625666987
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"223185\">Eirik Myklebost</span> has marked this topic as resolved.</p>",
        "id": 252627717,
        "sender_full_name": "Notification Bot",
        "timestamp": 1631195029
    }
]