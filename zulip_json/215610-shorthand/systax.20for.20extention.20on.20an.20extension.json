[
    {
        "content": "<p>This is a profile on a standard extension.  It was fine until I added the container information which defined as an extension on the manufacturing batch extension.  I get this error:  The sum of mins of slices must be &lt;= max of sliced element, but sum of mins (1) &gt; max (0) of Extension.extension:container.extension.   The error repeats for each element in the sub-extension.</p>\n<p>Profile: DrugProductmanufacturingBatch<br>\nParent: <a href=\"http://hl7.org/fhir/StructureDefinition/medication-manufacturingBatch\">http://hl7.org/fhir/StructureDefinition/medication-manufacturingBatch</a><br>\nId: drug-product-manufacturing-batch<br>\nTitle: \"Drug Product Manufacturing Batch\"<br>\nDescription: \"This profile defines the details of a batch of medicine.\"</p>\n<ul>\n<li>^url = \"<a href=\"https://hl7.org/fhir/pq-cmc/StructureDefinition/extDrugProductMfgBatch\">https://hl7.org/fhir/pq-cmc/StructureDefinition/extDrugProductMfgBatch</a>\"</li>\n<li>extension[manufacturingDate] 1..1 MS </li>\n<li>extension[manufacturingDate] ^short = \"Manufacturing Date\"  </li>\n<li>extension[manufacturingDate].valueDateTime MS </li>\n<li>extension[manufacturingDateClassification] 1..1 MS </li>\n<li>extension[manufacturingDateClassification] ^short = \"Manufacturing Date Description\"  </li>\n<li>extension[manufacturingDateClassification].valueCodeableConcept MS </li>\n<li>extension[assignedManufacturer] 1..1 MS </li>\n<li>extension[assignedManufacturer] ^short = \"Assigned Manufacturer\"  </li>\n<li>extension[assignedManufacturer].valueReference only Reference(MfgTestSiteOrganization)</li>\n<li>extension[expirationDateClassification] 1..1 MS </li>\n<li>extension[expirationDateClassification] ^short = \"Expiration Date Classification\"  </li>\n<li>extension[expirationDateClassification].valueCodeableConcept MS</li>\n<li>extension[batchUtilization] 1..1 MS </li>\n<li>extension[batchUtilization] ^short = \"Batch Utilization\"  </li>\n<li>extension[batchUtilization].valueCodeableConcept MS </li>\n<li>extension[batchQuantity] 1..1 MS</li>\n<li>extension[batchQuantity] ^short = \"Batch Size\"  </li>\n<li>extension[batchQuantity].valueQuantity MS </li>\n<li>extension[additionalInformation] MS </li>\n<li>extension[additionalInformation] ^short = \"Additional Information\"  </li>\n<li>extension[additionalInformation].valueString MS </li>\n<li>extension[container] 1..*  MS</li>\n<li>extension[container] ^short = \"Container\"</li>\n<li>extension[container].extension[lotNumber] 1..1 MS</li>\n<li>extension[container].extension[lotNumber] ^short = \"Container Lot Number\"</li>\n<li>extension[container].extension[lotNumber].string  1..1 MS</li>\n<li>extension[container].extension[type] 1..1 MS</li>\n<li>extension[container].extension[type] ^short = \"Container Type\"</li>\n<li>extension[container].extension[type].CodeableConcept  1..1 MS</li>\n<li>extension[container].extension[quantity] 1..1 MS</li>\n<li>extension[container].extension[quantity] ^short = \"Container Fill per Container Size\" </li>\n<li>extension[container].extension[quantity].Ratio  1..1 MS</li>\n<li>extension[container].extension[closureSystemDescription] 1..1 MS</li>\n<li>extension[container].extension[closureSystemDescription] ^short = \"Closure System Description\" </li>\n<li>extension[container].extension[closureSystemDescription].string  1..1 MS</li>\n<li>extension[container].extension[closureType] 1..1 MS</li>\n<li>extension[container].extension[closureType] ^short = \"Closure Type\"</li>\n<li>extension[container].extension[closureType].CodeableConcept  1..1 MS</li>\n</ul>",
        "id": 275434410,
        "sender_full_name": "Catherine Hosage Norman",
        "timestamp": 1647377999
    },
    {
        "content": "<p>interesting! this definitely appears to be an incorrectly reported error, I'm investigating it now.</p>",
        "id": 275505571,
        "sender_full_name": "Mint Thompson",
        "timestamp": 1647435102
    },
    {
        "content": "<p>I think I've found the cause: in the definition of the parent extension, the max of <code>Extension.extension:container.extension</code> is, in fact, 0. This is very strange, considering that there are slices defined on this element, but that is why SUSHI is reporting this error.</p>",
        "id": 275506379,
        "sender_full_name": "Mint Thompson",
        "timestamp": 1647435544
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"242620\">@Mint Thompson</span> is exactly right.  The <a href=\"https://hl7.org/fhir/5.0.0-snapshot1/extension-medication-manufacturingbatch.html\">manufacturingBatch extension</a> defines <a href=\"https://hl7.org/fhir/5.0.0-snapshot1/extension-medication-manufacturingbatch-definitions.html#medication-manufacturingBatch.Extension.extension:container.extension\">Extension.extension:container.extension</a> with <code>\"max\": \"0\"</code>:<br>\n<a href=\"/user_uploads/10155/uGlhhkG7ud1_c9XZoLagWG_C/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/uGlhhkG7ud1_c9XZoLagWG_C/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/uGlhhkG7ud1_c9XZoLagWG_C/image.png\"></a></div>",
        "id": 275527103,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1647444268
    },
    {
        "content": "<p>But it then goes on to specify 5 slices for sub-extensions on it.  So, clearly, that seems like an error.</p>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- is this the sort of thing that the IG Publisher should catch (defining <code>extension 0..0</code> and then defining a bunch of slices on it)?  If we wanted to get this fixed in the extension, who is the right person to contact?  Or should we just submit a tracker?</p>",
        "id": 275527527,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1647444428
    },
    {
        "content": "<p>This seems much like the problem I have been asking about in the slicing and extension on a slice... I have a small example</p>",
        "id": 275531461,
        "sender_full_name": "John Moehrke",
        "timestamp": 1647446002
    },
    {
        "content": "<p>I don't think so.  The problem here is pretty clear (or at least seems to be).  It doesn't make sense to have something <code>0..0</code> and then go and slice it.</p>",
        "id": 275533559,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1647446633
    },
    {
        "content": "<p>i'm making the change in a branch.  Not sure how that got there.  I <em>think</em> I actually created this extension with FSH and then put the resulting SD in the FHIR build.  but it was quite a while ago.</p>",
        "id": 275534010,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1647446773
    },
    {
        "content": "<p>Jean,  Any progress on this.  I just un-commented the lines, tried it  and it is not fixed in the latest release of the publisher.</p>",
        "id": 276431970,
        "sender_full_name": "Catherine Hosage Norman",
        "timestamp": 1648096931
    },
    {
        "content": "<p>it's not a publisher fix, it's how the extension was defined in the build.</p>",
        "id": 276434584,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1648100473
    },
    {
        "content": "<p>I need to get my IG out by the end of the month.  Should I write an extension in the IG to add these elements and then change when the build gets fixed?</p>",
        "id": 276479576,
        "sender_full_name": "Catherine Hosage Norman",
        "timestamp": 1648130637
    },
    {
        "content": "<p>yes, timing wise that's what you'll need to do.  I'm not even sure process-wise how we can get this technical correction into the R4 builds.</p>",
        "id": 276489126,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1648134416
    },
    {
        "content": "<p>I am working against R5.  None of medication extension was in R4.</p>",
        "id": 276508592,
        "sender_full_name": "Catherine Hosage Norman",
        "timestamp": 1648141694
    }
]