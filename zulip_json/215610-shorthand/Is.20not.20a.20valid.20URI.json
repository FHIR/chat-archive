[
    {
        "content": "<p>I am pretty new to FSH and learning things.... I am doing profiling for my teams and I have the following questions. I am enclosing two short hand scripts, the first one works, and the second one does not. The variation is the former is a ValueSet and the later is a CodeSystem. Can you experts help point out what am I doing wrong here?</p>\n<p>Working version.</p>\n<p>Snippet from the Specimen profile FSH Script<br>\n=======================================</p>\n<ul>\n<li>identifier.type 1..1</li>\n<li>identifier.type from xxx-specimen-id-types</li>\n</ul>\n<p>The Specimen ID types ValueSet derived from HL7 types<br>\n================================================<br>\nAlias:  IDT = <a href=\"http://hl7.org/fhir/ValueSet/identifier-type\">http://hl7.org/fhir/ValueSet/identifier-type</a><br>\nValueSet:       xxxSpecimentIdentifierTypes<br>\nId:             xxx-specimen-id-types<br>\nTitle:          \"xxx Specimen Identifier types\"<br>\nDescription:    \"Specimen Identifier types supported by xxx\"</p>\n<ul>\n<li>IDT#PLAC  \"Specimen's identifier if accessioned outside of xxx\"</li>\n<li>IDT#ACSN  \"Accession ID - If accessioned using xxx workflow\"</li>\n<li>IDT#FILL  \"Specifimen identifier for internal tracking in xxx\"</li>\n</ul>\n<p>This compiles perfectly, no issues.</p>\n<p>Snippet from the ServiceRequest profile FSH Script<br>\n=======================================</p>\n<ul>\n<li>identifier.type 1..1</li>\n<li>identifier.type from xxx-order-id-types</li>\n</ul>\n<p>The Order ID types CodeSystem of our own list<br>\n=======================================<br>\nCodeSystem: xxxOrderIdentifierTypes<br>\nId: xxx-order-id-types<br>\nTitle: \"Various types of identifiers that can be used in diagnostic order to xxx\"<br>\nDescription: \"Various types of identifiers that can be used in diagnostic order to xxx\"</p>\n<ul>\n<li>#MR   \"MR\" \"Medical record number\"</li>\n<li>#ACSN \"ACSN\" \"Accession ID\"</li>\n<li>#PRN  \"PRN\" \"Physician ID\"</li>\n<li>#NPI \"NPI\" \"Physician NPI\"</li>\n<li>#ACCN \"ACCN\" \"Account Number\" </li>\n<li>#PLAC \"PLAC\" \"Placer Order ID\"</li>\n<li>#FILL \"FILL\" \"Filler Order ID\"</li>\n<li>#PREQ \"PREQ\" \"Placer Request ID\"</li>\n<li>#REQ  \"REQ\" \"Request ID\"</li>\n</ul>\n<p>The above fails<br>\nerror Resolved value \"xxx-order-id-types\" is not a valid URI.</p>\n<p>My custom extensions to ID types are only PRN, NPI PREQ and REQ the rest are in the ValueSet <a href=\"http://hl7.org/fhir/ValueSet/identifier-type\">http://hl7.org/fhir/ValueSet/identifier-type</a>.  I did not find instruction how to form a ValueSet (if possible) derived partly from mulitple ValueSets intermixed with our own CodeSystem values.</p>\n<p>Thanks for your help in advance.</p>",
        "id": 204440170,
        "sender_full_name": "Muthu Muthuraj",
        "timestamp": 1595260420
    },
    {
        "content": "<p>The error is in your ServiceRequest FSH script and it is because you can't bind an element to a code system.</p>",
        "id": 204441215,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1595260894
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"192166\">@Jean Duteau</span>.  I think you nailed it.  That said, it seems that SUSHI should provide a more helpful error message there.  I'll add an issue to improve that.</p>",
        "id": 204450393,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1595265781
    },
    {
        "content": "<p>Can you guys provide me guidance on what is the right way to use Code Systems. SUSHI site tells us how to define one, but does not tell us how to use them with an example?</p>",
        "id": 204451489,
        "sender_full_name": "Muthu Muthuraj",
        "timestamp": 1595266424
    },
    {
        "content": "<p>I told you in our private chat.  Your CodeSystem is just fine. You now need to create a ValueSet that references the codes you want.  And then the Profile binds the ServiceRequest.identifier.type to that value set.  Just like you did in your Specimen profile.</p>",
        "id": 204451660,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1595266492
    },
    {
        "content": "<p>I just saw it! Thanks Jean!</p>",
        "id": 204451893,
        "sender_full_name": "Muthu Muthuraj",
        "timestamp": 1595266617
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192166\">Jean Duteau</span> <a href=\"#narrow/pm-with/192166,285733-pm/near/204446647\">said</a>:</p>\n<blockquote>\n<p>your codesystem is just fine.  it's the fact that profile elements can't reference a codesystem directly.  profile elements always have to reference a valueset.  so you would need to define a value set that references the codesystem and then the profile element reference that value set.</p>\n</blockquote>\n<p>Can I do this to resolve the problem? I am still getting the same error:</p>\n<ul>\n<li>identifier.type 1..1</li>\n<li>identifier.type from xxx-order-id-vs</li>\n</ul>\n<p>ValueSet:   xxxOrderIdVS<br>\nId:         xxx-order-id-vs<br>\nTitle:      \"Valid Order ID types for xxx\"<br>\nDescription:    \"Valid Order ID types for xxx\"</p>\n<p>*include codes from CodeSystem  xxx-order-id-cs</p>",
        "id": 204453415,
        "sender_full_name": "Muthu Muthuraj",
        "timestamp": 1595267456
    },
    {
        "content": "<p>Instead of <code>include codes from CodeSystem xxx-order-id-cs</code>,  the FSH syntax is <code>include codes from system xxx-order-id-cs</code>.</p>",
        "id": 204453907,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1595267720
    },
    {
        "content": "<p>Also... you need a space between the <code>*</code> and <code>include</code> (i.e., <code>* include</code> not <code>*include</code>).</p>",
        "id": 204454351,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1595267928
    },
    {
        "content": "<p>And in case you were not aware, you don't have to reference it by the <code>Id</code> -- you can reference it by the name if that is easier (the name is the part after <code>CodeSystem:</code>).</p>",
        "id": 204454578,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1595268038
    },
    {
        "content": "<p>Thank you for pointing out the typo on *include.... Here is what I have</p>\n<ul>\n<li>identifier.type 1..1</li>\n<li>identifier.type from xxx-order-id-vs</li>\n</ul>\n<p>ValueSet:   xxxOrderIDTypeVS<br>\nId:         xxx-order-id-vs<br>\nTitle:      \"Valid Order requests for xxx\"<br>\nDescription:    \"Valid Order requests for xxx\"</p>\n<ul>\n<li>include codes from system xxx-order-id-cs</li>\n</ul>\n<p>CodeSystem: xxxOrderIdentifierCS<br>\nId: xxx-order-id-cs<br>\nTitle: \"Various types of identifiers that can be used in diagnostic order to xxx\"<br>\nDescription: \"Various types of identifiers that can be used in diagnostic order to xxx\"</p>\n<ul>\n<li>#MR   \"MR\" \"Medical record number\"</li>\n<li>#ACSN \"ACSN\" \"Accession ID\"</li>\n<li>#PRN  \"PRN\" \"Physician ID requestForms.PhysicianID\"</li>\n<li>#NPI  \"NPI\" \"Physician NPI\"<br>\n...<br>\n...</li>\n</ul>\n<p>error mismatched input 'codes' expecting CARET_SEQUENCE<br>\n  File: xxxOrderIdTypeVS.fsh<br>\n  Line: 6</p>\n<p>error Error in parsing: Cannot read property 'getText' of null<br>\n  File: xxxOrderIdTypeVS.fsh<br>\n  Line: 1 - 6</p>\n<p>error Resolved value \"xxx-order-id-vs\" is not a valid URI.<br>\n  File: xxxOrder.fsh<br>\n  Line: 44</p>",
        "id": 204456556,
        "sender_full_name": "Muthu Muthuraj",
        "timestamp": 1595268979
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"239822\">Nick Freiter</span> <a href=\"#narrow/stream/215610-shorthand/topic/Is.20not.20a.20valid.20URI/near/204453907\">said</a>:</p>\n<blockquote>\n<p>Instead of <code>include codes from CodeSystem xxx-order-id-cs</code>,  the FSH syntax is <code>include codes from system xxx-order-id-cs</code>.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"239822\">@Nick Freiter</span> With SUSHI 0.13.1, * include codes from ... fails with the errors that Muthu posted above.</p>\n<p><span class=\"user-mention\" data-user-id=\"285733\">@Muthu Muthuraj</span> You need to have SUSHI 0.14.0 to use the * include codes from ...  line.<br>\nHere is a test file that processes successfully in SUSHI 0.13.1 (which I suspect you are using) or 0.14.0.<br>\n<a href=\"/user_uploads/10155/DTXlHFsEMQG9Yq0E-LGwVWhY/TestScript.fsh\">TestScript.fsh</a></p>",
        "id": 204457816,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1595269645
    },
    {
        "content": "<p>Running SUSHI v0.12.5</p>\n<p>I guess I have not been upgrading in a while... I will have to figure out how to update...</p>",
        "id": 204458554,
        "sender_full_name": "Muthu Muthuraj",
        "timestamp": 1595270013
    },
    {
        "content": "<p>npm install -g fsh-sushi :)</p>",
        "id": 204458584,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1595270040
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192166\">Jean Duteau</span> <a href=\"#narrow/stream/215610-shorthand/topic/Is.20not.20a.20valid.20URI/near/204458584\">said</a>:</p>\n<blockquote>\n<p>npm install -g fsh-sushi :)</p>\n</blockquote>\n<p>Alright!! That fixed it :) Where do I send your bottle of red wine from my side .. :)</p>",
        "id": 204458850,
        "sender_full_name": "Muthu Muthuraj",
        "timestamp": 1595270218
    },
    {
        "content": "<p>I'lll send you the address - you can trust me to pass it on...</p>",
        "id": 204459449,
        "sender_full_name": "David Hay",
        "timestamp": 1595270555
    }
]