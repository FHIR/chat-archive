[
    {
        "content": "<p><a href=\"#narrow/stream/179252-IG-creation/topic/Sushi.20loader.20fail\">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/Sushi.20loader.20fail</a> <br>\nHi having some problems running latest version of fsh-sushi - cross posted original issue</p>",
        "id": 217858576,
        "sender_full_name": "Brett Esler",
        "timestamp": 1606294851
    },
    {
        "content": "<p>We are also experiencing the same error (only on windows machines)</p>",
        "id": 217866059,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1606299375
    },
    {
        "content": "<p>Did you update npm and node?</p>",
        "id": 217866630,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1606299758
    },
    {
        "content": "<p>One colleague used node 14 and it failed, the other one uses node 10</p>",
        "id": 217867055,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1606300030
    },
    {
        "content": "<p>The node 14 users reverted his win system to the last rescue point (with node10) and after that sushi worked.</p>",
        "id": 217867175,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1606300105
    },
    {
        "content": "<p>This also impacts <a href=\"http://build.fhir.org\">build.fhir.org</a>. <br>\nIt seems that antlr4 v4.9 was released on Nov 24 and it seems to require node 14. </p>\n<p>Mark Scrimshire: I am getting an antlr4/error on my <a href=\"http://build.fhir.org\">build.fhir.org</a> build I was compiling locally with 0.16.0 but <a href=\"http://build.fhir.org\">build.fhir.org</a> is using fsh-sushi 1.0.1. I upgraded local copy to <a href=\"mailto:feh-sushi@1.0.1\">feh-sushi@1.0.1</a> and now I get the same issue in loader</p>\n<p>Mark Scrimshire: <a href=\"http://Build.fhir.org\">Build.fhir.org</a> gives following sushi/antlr4 error:<br>\n/usr/local/bin/sushi -&gt; /usr/local/lib/node_modules/fsh-sushi/dist/app.js<br>\nnpm WARN notsup Unsupported engine for <a href=\"mailto:antlr4@4.9.0\">antlr4@4.9.0</a>: wanted: {\"node\":\"&gt;=14\"} (current: {\"node\":\"12.16.1\",\"npm\":\"6.13.4\"})<br>\nnpm WARN notsup Not compatible with your version of node/npm: <a href=\"mailto:antlr4@4.9.0\">antlr4@4.9.0</a></p>\n<p><a href=\"mailto:fsh-sushi@1.0.1\">fsh-sushi@1.0.1</a><br>\n...</p>\n<p>Sushi: npx: installed 111 in 4.976s (00:05.0058)<br>\nSushi: Cannot find module 'antlr4/error' (00:05.0231)<br>\nSushi: Require stack: (00:05.0231)</p>",
        "id": 217880445,
        "sender_full_name": "Mark Scrimshire",
        "timestamp": 1606309034
    },
    {
        "content": "<p>I just joined the party</p>",
        "id": 217882148,
        "sender_full_name": "John Moehrke",
        "timestamp": 1606309936
    },
    {
        "content": "<p>sushi told me to update node and npm... so I did... now complete failure</p>",
        "id": 217882231,
        "sender_full_name": "John Moehrke",
        "timestamp": 1606309991
    },
    {
        "content": "<p>Oh boy.  OK.  We're on it.</p>",
        "id": 217882740,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606310285
    },
    {
        "content": "<p>If it is ANTLR, then I'm disappointed that a <em>minor</em> release would introduce a breaking change like that.  But they don't exactly use semantic versioning, so I guess I should not be surprised.  I thought our <code>package.lock</code> file would protect us from unintentional upgrades like this, but perhaps not.</p>",
        "id": 217883042,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606310486
    },
    {
        "content": "<p>OK.  So here's the skinny.  We use a file called <code>package-lock.json</code> to lock our dependencies to specific versions.  We thought this protected us from situations like this.  It turns out, however, that <code>package-lock.json</code> is \"not publishable\" -- which means it only enforces dependencies in development, but does not enforce them for people installing the published version (which includes all of you).</p>\n<p>To enforce dependencies for published versions of a Node.js library, you need to use <code>npm-shrinkwrap.json</code> instead.  I've made that change locally and it seems to work as expected (keeping us on the <em>intended</em> version of the ANTLR dependency).  We'll release an updated version of SUSHI with that change soon!</p>",
        "id": 217886309,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606312245
    },
    {
        "content": "<p><a href=\"http://build.fhir.org\">build.fhir.org</a> also joined the party..... :(</p>",
        "id": 217887848,
        "sender_full_name": "Mark Scrimshire",
        "timestamp": 1606312992
    },
    {
        "content": "<p>FYI -- I've published SUSHI 1.0.2 with the fix for this.  I rebuilt a few of the failing projects on the auto-build server and confirmed it fixed them.  I haven't published the release notes yet, but you can grab it via the normal means: <code>npm install -g fsh-sushi</code>.  To be clear, this release ensures antlr4 stays on v4.8.0 which does <em>not</em> require Node 14 (Node 10 and Node 12 should work fine).</p>",
        "id": 217900472,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606318830
    },
    {
        "content": "<p>I'm also in the middle of publishing a 0.16.1 for those of you who, for some reason, cannot make the jump to 1.x.  I'll officially announce both of them in this stream once it's published.</p>",
        "id": 217900609,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606318900
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 217900631,
        "sender_full_name": "David Pyke",
        "timestamp": 1606318909
    },
    {
        "content": "<p>You're welcome.  <span class=\"user-mention\" data-user-id=\"191368\">@Brett Esler</span>, <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span>, <span class=\"user-mention\" data-user-id=\"192609\">@Mark Scrimshire</span>, <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span>, <span class=\"user-mention\" data-user-id=\"192587\">@David Pyke</span> -- please accept our apologies for this issue.  It caught us by surprise too.  We obviously try to avoid these types of show-stopping issues and we definitely learned something from this one.  I'm sorry for any inconveniences it caused you and I thank you for helping us identify and resolve it.</p>",
        "id": 217901037,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606319107
    },
    {
        "content": "<p>no worries, thanks for your awesome work!</p>",
        "id": 217901380,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1606319276
    },
    {
        "content": "<p>it is all teamwork</p>",
        "id": 217901529,
        "sender_full_name": "John Moehrke",
        "timestamp": 1606319343
    },
    {
        "content": "<p>did you leave in debugging, or is this something else?</p>\n<div class=\"codehilite\"><pre><span></span><code>Sushi: info  Loaded package hl7.fhir.r4.core#4.0.1                               (00:04.0543)\nSushi: (node:13864) Warning: Accessing non-existent property &#39;INVALID_ALT_NUMBER&#39; of module exports inside circular dependency (00:04.0691)\nSushi: (Use `node --trace-warnings ...` to show where the warning was created)   (00:04.0693)\nSushi: (node:13864) Warning: Accessing non-existent property &#39;INVALID_ALT_NUMBER&#39; of module exports inside circular dependency (00:04.0695)\nSushi: info  Converting FSH to FHIR resources...                                 (00:04.0704)\n</code></pre></div>",
        "id": 217901752,
        "sender_full_name": "John Moehrke",
        "timestamp": 1606319463
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> -- no, we did not leave in debugging.  This may be related to SUSHI now using the locked in versions and maybe one of them is behaving slightly differently than the previously unlocked-in version.  What version of Node.js are you using?  (hint: <code>node -v</code>).</p>",
        "id": 217908674,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606322329
    },
    {
        "content": "<p>Iâ€™ve been getting those errors since I started using sushi in the summer.</p>",
        "id": 217909765,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1606322863
    },
    {
        "content": "<p>I looked into this some more.  I'm guessing that anyone who is seeing this error is using Node 14.  It seems to be related to the <code>antlr4</code> dependency (it strikes again!).  It's likely fixed in <code>antlr4@4.9.0</code>, but if we upgrade to that, then it forces <em>everyone</em> to switch to Node 14 -- which we don't want to do right now.  So for now, I think you should probably just try your best to ignore it!</p>",
        "id": 217913872,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606324655
    },
    {
        "content": "<p>okay. by your command.</p>",
        "id": 217916729,
        "sender_full_name": "John Moehrke",
        "timestamp": 1606325972
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  very much appreciated; nice to have my issues fixed while I was sleeping!</p>",
        "id": 217935597,
        "sender_full_name": "Brett Esler",
        "timestamp": 1606336256
    },
    {
        "content": "<p>what do I have to do to get this fix? I ran <code>npm install -g fsh-sushi</code>, and I'm now on <a href=\"mailto:fsh-sushi@1.0.2\">fsh-sushi@1.0.2</a>, but I get</p>\n<div class=\"codehilite\"><pre><span></span><code>Sushi: npx: installed 111 in 4.281s                                              (00:04.0588)\nSushi: Cannot find module &#39;antlr4/error&#39;                                         (00:04.0781)\n</code></pre></div>",
        "id": 217936822,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606336927
    },
    {
        "content": "<p>the IG I'm trying to run has fsh.ini:</p>\n<div class=\"codehilite\" data-code-language=\"INI\"><pre><span></span><code><span class=\"k\">[FSH]</span>\n<span class=\"na\">sushi-version</span><span class=\"o\">=</span><span class=\"s\">beta</span>\n</code></pre></div>",
        "id": 217937289,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606337191
    },
    {
        "content": "<p>That's the problem.  They are still pointing at the old beta tag -- and we did not release a patch to the beta since the beta is over.</p>",
        "id": 217938610,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606337961
    },
    {
        "content": "<p>You know what -- I'll just move the beta tag to point to 1.0.2 -- since the beta is over and 1.0.x is what the beta was for anyway.  Stand by.</p>",
        "id": 217938623,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606337970
    },
    {
        "content": "<p>OK, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- go ahead and give it another shot.</p>",
        "id": 217938783,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606338057
    },
    {
        "content": "<p>(BTW -- if anyone has <code>fsh.ini</code> pointing to <code>0.16.0</code> they are going to run into the same issue -- but in that case we cannot just switch a tag.  They'll have to change <code>fsh.ini</code> to point to <code>0.16.1</code>.)</p>",
        "id": 217938905,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1606338117
    },
    {
        "content": "<p>yes fixed</p>",
        "id": 217959221,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606356407
    },
    {
        "content": "<p>poke... I am still getting this set of messages. I have no fsh.ini as I have moved to the sushi-config.yaml.</p>",
        "id": 220181858,
        "sender_full_name": "John Moehrke",
        "timestamp": 1608157362
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> -- we thought this was fixed. Are you getting this locally or in the CI build?  If locally, what version of SUSHI are you running?  You can find out via <code>sushi -v</code>.  You should be using version 1.0.2.</p>",
        "id": 220185162,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1608159218
    },
    {
        "content": "<p>local build</p>",
        "id": 220197823,
        "sender_full_name": "John Moehrke",
        "timestamp": 1608169053
    },
    {
        "content": "<p>I have fresh updated both IG build and sushi</p>",
        "id": 220197833,
        "sender_full_name": "John Moehrke",
        "timestamp": 1608169065
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"sushi\"><pre><span></span><code>\n</code></pre></div>",
        "id": 220197925,
        "sender_full_name": "John Moehrke",
        "timestamp": 1608169123
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Sushi: info  Running SUSHI v1.0.2 (implements FHIR Shorthand specification v1.0.0) (00:03.0321)\n</code></pre></div>",
        "id": 220197932,
        "sender_full_name": "John Moehrke",
        "timestamp": 1608169132
    },
    {
        "content": "<p>Oh!  <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> -- I was thinking that you were saying that you get the error Grahame most recently reported in the thread (<code>Cannot find module 'antlr4/error'</code>) -- which is definitely fixed.  But I re-read the thread from the start and see that you are probably talking about <code>Warning: Accessing non-existent property 'INVALID_ALT_NUMBER' of module exports inside circular dependency</code>.</p>\n<p>This error message only happens if you are running Node 14.  People running Node 10 or 12 will not see it.  The good news is that this error message is completely harmless and can be ignored.  The bad news is that the only way for us to make it go away is make a change that would require <em>everyone</em> to use Node 14.  We have a lot of users on Node 10 and Node 12 that such a change would affect -- so we're not ready to do that.  As I said, you can safely ignore it, but if it really bothers you, then the best way to avoid it is to downgrade Node.js to Node 12.</p>",
        "id": 220243215,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1608212018
    }
]