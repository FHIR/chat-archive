[
    {
        "content": "<p>so I have this sushi fragment (on an instance):</p>\n<div class=\"codehilite\"><pre><span></span><code>* generalPractitioner[0] = Reference(drwelby)       //the GP\n* generalPractitioner[0].display = &quot;Dr Marcus Welby&quot;\n\n* generalPractitioner[1] = Reference(gp-org1)       //the GP Practice\n* generalPractitioner[1].display = &quot;Good Health Medcial Centre&quot;\n* generalPractitioner[1].extension[edi-address].valueString = &quot;hl-001&quot;\n* generalPractitioner[1].extension[gp-practice-enrollment-date].valueDate = &quot;2020-01-01&quot;\n</code></pre></div>\n\n\n<p>which generates this instance</p>\n<div class=\"codehilite\"><pre><span></span><code>  &quot;generalPractitioner&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org.nz/fhir/StructureDefinition/edi-address&quot;\n        },\n        {\n          &quot;url&quot;: &quot;http://hl7.org.nz/fhir/nhi/StructureDefinition/gp-practice-enrollment-date&quot;\n        }\n      ],\n      &quot;reference&quot;: &quot;Practitioner/drwelby&quot;,\n      &quot;display&quot;: &quot;Dr Marcus Welby&quot;\n    },\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org.nz/fhir/StructureDefinition/edi-address&quot;,\n          &quot;valueString&quot;: &quot;hl-001&quot;\n        },\n        {\n          &quot;url&quot;: &quot;http://hl7.org.nz/fhir/nhi/StructureDefinition/gp-practice-enrollment-date&quot;,\n          &quot;valueDate&quot;: &quot;2020-01-01&quot;\n        }\n      ],\n      &quot;reference&quot;: &quot;Organization/gp-org1&quot;,\n      &quot;display&quot;: &quot;Good Health Medcial Centre&quot;\n    }\n  ],\n</code></pre></div>\n\n\n<p>The first entry should not have the extension - right?</p>",
        "id": 201906629,
        "sender_full_name": "David Hay",
        "timestamp": 1593034388
    },
    {
        "content": "<p>it shouldn't, but it depends on your profile definition, if you had one.</p>",
        "id": 201906842,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1593034510
    },
    {
        "content": "<p>Well - here's the profile segment:</p>\n<div class=\"codehilite\"><pre><span></span><code>* generalPractitioner only Reference(HaPractitioner | HaOrganization)\n* generalPractitioner.extension contains\n    $edi-address named edi-address 0..1 and\n    $gp-enrollmentDate named gp-practice-enrollment-date 0..1\n</code></pre></div>\n\n\n<p>The issue is that only one of the references in the instance had the extension defined. I could try explicitly removing it from the instance - hold on...</p>",
        "id": 201907852,
        "sender_full_name": "David Hay",
        "timestamp": 1593035189
    },
    {
        "content": "<p>hmm, yeah, that seems like it should only include the extension if it was defined (0..1) on both</p>",
        "id": 201907943,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1593035242
    },
    {
        "content": "<p>Actually, of course, i can't 'remove' the extension from an instance of course...</p>",
        "id": 201907977,
        "sender_full_name": "David Hay",
        "timestamp": 1593035276
    },
    {
        "content": "<p>no, but if you don't define it in either repetition, do you still get the extension 'stub'?</p>",
        "id": 201908184,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1593035403
    },
    {
        "content": "<p>This looks like a bug in SUSHI to me.  You probably shouldn't be getting those extension 'stub's in the <code>generalPractitioner[0]</code> entry.  I don't have time to investigate right now, but we can try to look into that tomorrow!</p>",
        "id": 201908682,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1593035732
    },
    {
        "content": "<p>No worries - I'll work around it...</p>",
        "id": 201909031,
        "sender_full_name": "David Hay",
        "timestamp": 1593035967
    },
    {
        "content": "<p>I was able to reproduce this and can confirm it is definitely a bug. I made an issue to track the bug here: <a href=\"https://github.com/FHIR/sushi/issues/502\">https://github.com/FHIR/sushi/issues/502</a>.</p>",
        "id": 201965601,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1593090230
    }
]