[
    {
        "content": "<p>I have a profile where I slice on the boolean value of an extension:</p>\n<div class=\"codehilite\"><pre><span></span><code>* careTeam MS\n* careTeam.extension contains CareTeamClaimScope named careTeamClaimScope 1..1 MS\n* careTeam.sequence MS\n* careTeam.provider MS\n* careTeam.provider only Reference(PASPractitioner or PASOrganization)\n* careTeam.role MS\n* careTeam.qualification MS\n* careTeam ^slicing.discriminator.type = #value\n* careTeam ^slicing.discriminator.path = &quot;extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value&quot;\n* careTeam ^slicing.rules = #open\n* careTeam ^slicing.description = &quot;Slice based on whether the care team member belongs to the overall claim or to an individual claim item.&quot;\n* careTeam contains OverallClaimMember 0..14 and ItemClaimMember 0..10\n* careTeam[OverallClaimMember].extension[careTeamClaimScope].valueBoolean 1..1\n* careTeam[OverallClaimMember].extension[careTeamClaimScope].valueBoolean = true\n* careTeam[ItemClaimMember].extension[careTeamClaimScope].valueBoolean 1..1\n* careTeam[ItemClaimMember].extension[careTeamClaimScope].valueBoolean = false\n</code></pre></div>\n<p>I'm unsure if the slicing discriminator path is correct because I'm getting an error about it:</p>\n<div class=\"codehilite\"><pre><span></span><code>Slicing cannot be evaluated: Unable to resolve discriminator in definitions: extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value (@char 1)\n</code></pre></div>\n<p>But I've tried all sorts of paths and always get that error.  When I look at the generated StructureDefinition, I'm slightly confused because of the slicing on extension that happens:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Claim.careTeam&quot;,\n        &quot;path&quot;: &quot;Claim.careTeam&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;value&quot;,\n              &quot;path&quot;: &quot;extension(&#39;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&#39;).value&quot;\n            }\n          ],\n          &quot;rules&quot;: &quot;open&quot;,\n          &quot;description&quot;: &quot;Slice based on whether the care team member belongs to the overall claim or to an individual claim item.&quot;\n        },\n        &quot;mustSupport&quot;: true\n      },\n      {\n        &quot;id&quot;: &quot;Claim.careTeam.extension&quot;,\n        &quot;path&quot;: &quot;Claim.careTeam.extension&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;value&quot;,\n              &quot;path&quot;: &quot;url&quot;\n            }\n          ],\n          &quot;ordered&quot;: false,\n          &quot;rules&quot;: &quot;open&quot;\n        },\n        &quot;min&quot;: 1\n      },\n</code></pre></div>\n<p>The first slicing is my slice on careTeam, the second is the default slicing on extension that occurs.  Then I get the extension slice:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Claim.careTeam.extension:careTeamClaimScope&quot;,\n        &quot;path&quot;: &quot;Claim.careTeam.extension&quot;,\n        &quot;sliceName&quot;: &quot;careTeamClaimScope&quot;,\n        &quot;min&quot;: 1,\n        &quot;max&quot;: &quot;1&quot;,\n        &quot;type&quot;: [\n          {\n            &quot;code&quot;: &quot;Extension&quot;,\n            &quot;profile&quot;: [\n              &quot;http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope&quot;\n            ]\n          }\n        ],\n        &quot;mustSupport&quot;: true\n      },\n</code></pre></div>\n<p>And then I get four entries that are about slices, but I'm not sure if they are correct:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember&quot;,\n        &quot;path&quot;: &quot;Claim.careTeam&quot;,\n        &quot;sliceName&quot;: &quot;OverallClaimMember&quot;,\n        &quot;min&quot;: 0,\n        &quot;max&quot;: &quot;14&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope&quot;,\n        &quot;path&quot;: &quot;Claim.careTeam.extension&quot;,\n        &quot;sliceName&quot;: &quot;careTeamClaimScope&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope.value[x]&quot;,\n        &quot;path&quot;: &quot;Claim.careTeam.extension.value[x]&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;type&quot;,\n              &quot;path&quot;: &quot;$this&quot;\n            }\n          ],\n          &quot;ordered&quot;: false,\n          &quot;rules&quot;: &quot;open&quot;\n        },\n        &quot;min&quot;: 1\n      },\n      {\n        &quot;id&quot;: &quot;Claim.careTeam:OverallClaimMember.extension:careTeamClaimScope.valueBoolean&quot;,\n        &quot;path&quot;: &quot;Claim.careTeam.extension.valueBoolean&quot;,\n        &quot;min&quot;: 1,\n        &quot;max&quot;: &quot;1&quot;,\n        &quot;patternBoolean&quot;: true\n      },\n</code></pre></div>",
        "id": 252079703,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1630851619
    },
    {
        "content": "<p>Ugh.  Slicing is always <em>tricky</em>.  I'm not sure what is going on here.  A few thoughts:</p>\n<ul>\n<li>Everything you've shown <em>seems</em> OK to me based on my knowledge of slicing, but when you get into slices within nested slices, and then nested slices again -- it's hard to know how the publisher/validator handles that.</li>\n<li>You could potentially eliminate one level of slicing (the type slicing) by changing <code>careTeam[OverallClaimMember].extension[careTeamClaimScope].valueBoolean</code> to just <code>careTeam[OverallClaimMember].extension[careTeamClaimScope].value[x]</code> (assuming it has already been constrained to only <code>boolean</code>).  Maybe that would help?</li>\n<li>You did not say anything about the <code>ItemClaimNumber</code> slice, but I assume you have four entries about that slice group as well (just like <code>OverallClaimNumber</code>).  Right?</li>\n<li>I doubt it would make a difference, but you could also try changing your discriminator to use <code>$this</code>: <code>\"$this.extension('http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-careTeamClaimScope').value\"</code>.</li>\n</ul>",
        "id": 252298649,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1631018576
    },
    {
        "content": "<p>okay, then I think this is a problem in the validator.  changing it to use $this didn't change anything mainly because the publisher strips that out.</p>",
        "id": 252305770,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1631021747
    },
    {
        "content": "<p>OK.  Please report back if/when you hear anything -- especially if it turns out that there is an issue w/ the slicing itself!</p>",
        "id": 252312546,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1631024379
    }
]