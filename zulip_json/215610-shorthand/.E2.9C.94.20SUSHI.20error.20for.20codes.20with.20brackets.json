[
    {
        "content": "<p>I seem to have found a parametrized rules bug in SUSHI 2.0.0, but wanted to check that I'm not hallucinating before creating a GitHub issue. I notice this while writing a profile and using the UCUM code <code>{#}/(24.h)</code>. When I passed this as a parameter to a parametrized rule, it created errors in some cases - it seems that the parser mistakes the final \")\" in the code string for the closing bracket in the rule parameter list. As far as I can tell, it happens only when (1) the parametrized rule has multiple arguments AND (2) the unit code string contains (round) brackets.</p>\n<p>Below is an example showing this behavior:</p>\n<div class=\"codehilite\"><pre><span></span><code>Alias: $ucum = http://unitsofmeasure.org\n\n// One parameter only\nRuleSet: AddUnitsCode(unitCode)\n* valueQuantity.code = #{unitCode}\n\n// Two parameters\nRuleSet: AddUnits(system, unitCode)\n* valueQuantity.system = {system}\n* valueQuantity.code = #{unitCode}\n\n// This works - unit code without &quot;()&quot;\nProfile: Test1\nParent: Observation\nId: test1\n* insert AddUnits($ucum, {#}/min)\n\n// This works - unit code with &quot;()&quot;, but only a single rule set parameter\nProfile: Test2\nParent: Observation\nId: test2\n* insert AddUnitsCode({#}/(24.h))\n\n// This does NOT work - unit code with &quot;()&quot; and multiple rule set parameters\n// SUSHI throws an error and in the output, the final &quot;)&quot; is missing from the unit code\nProfile: Test3\nParent: Observation\nId: test3\n* insert AddUnits($ucum, {#}/(24.h))\n</code></pre></div>",
        "id": 253209287,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1631604629
    },
    {
        "content": "<p>did you escape your <code>)</code> ?</p>",
        "id": 253210492,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1631605228
    },
    {
        "content": "<p>inside a insert, you'd want to escape: <code>)</code> --&gt; <code>\\)</code> - I don't see it here</p>",
        "id": 253210609,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1631605298
    },
    {
        "content": "<p>Ah, thanks <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span>, that does indeed do the trick! Now that you mention, I also see this mentioned prominently in the <a href=\"http://build.fhir.org/ig/HL7/fhir-shorthand/reference.html#inserting-parameterized-rule-sets\">corresponding FSH documentation</a>... <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span>. My only excuse is that the fact that it worked for a single parameter led me to believe it smt. more complicated <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 253212565,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1631606444
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"194703\">Morten Ernebjerg</span> has marked this topic as resolved.</p>",
        "id": 253212570,
        "sender_full_name": "Notification Bot",
        "timestamp": 1631606448
    }
]