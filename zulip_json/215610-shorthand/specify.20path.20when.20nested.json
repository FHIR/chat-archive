[
    {
        "content": "<p>Consider a PlanDefinition with multiple nested actions. Is there a way to target say the very first action? <code>* action.trigger 1..1</code> applies to all actions.</p>",
        "id": 199439756,
        "sender_full_name": "Brian Kaney",
        "timestamp": 1591058591
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191782\">@Brian Kaney</span>  you can just add indexes into the repeating components, along the lines of</p>\n<div class=\"codehilite\"><pre><span></span><code>Instance: PlanDef1\nInstanceOf: PlanDefinition\n* subtitle = &quot;bar&quot;\n* status = #draft\n* action[0].trigger[0].type = #named-event\n* action[0].trigger[0].name = &quot;abc&quot;\n* action[0].trigger[1].type = #periodic\n* action[0].trigger[1].name = &quot;def&quot;\n* action[1].trigger[0].type = #data-added\n* action[1].trigger[0].name = &quot;xyz&quot;\n</code></pre></div>",
        "id": 199456287,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1591081682
    },
    {
        "content": "<p>Also with FSH, when a path with a repeating element is used and the index is not included, SUSHI assumes you mean the zero index. As such</p>\n<div class=\"codehilite\"><pre><span></span><code>* action.trigger 1..1\n</code></pre></div>\n\n\n<p>is the same as</p>\n<div class=\"codehilite\"><pre><span></span><code>* action[0].trigger[0] 1..1\n</code></pre></div>",
        "id": 199456431,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1591081830
    },
    {
        "content": "<p>Indexes work well for defining <em>instances</em>, but when defining <em>profiles</em>, it is a little trickier to apply a constraint to only a specific element in an array -- particularly when you want to identify that element by its position.</p>\n<p>If you have a meaningful way to slice the array, it's fairly straightforward to apply constraints to individual slices by their slice name (FSH documentation covers this fairly well, so I won't repeat it here).  So that would be my first suggestion; if there is some differentiating aspect to each <code>action</code>, then use slices to differentiate the actions and apply the constraints as you wish to each slice.</p>\n<p>If you really need to apply constraints by an element's position (i.e., its index), then I think the only way you can do that is via FHIRPath invariants.  That might look something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>Invariant:  my-ig-1\nDescription: &quot;The first action should have exactly one trigger&quot;\nExpression: &quot;first().trigger.count() = 1&quot;\nSeverity:   #error\n</code></pre></div>\n\n\n<p>then in your PlanDefinition profile:</p>\n<div class=\"codehilite\"><pre><span></span><code>* action obeys my-ig-1\n</code></pre></div>\n\n\n<p><em>NOTE: I didn't test the FHIRPath, so I can't guarantee it's 100% right, but hopefully my example at least gets across the idea.</em></p>",
        "id": 199487116,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1591102828
    },
    {
        "content": "<p>Also, see this thread for a related conversation: <a href=\"#narrow/stream/215610-shorthand/topic/Constraining.20a.20Resource/near/198232962\">https://chat.fhir.org/#narrow/stream/215610-shorthand/topic/Constraining.20a.20Resource/near/198232962</a></p>",
        "id": 199487486,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1591103001
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  -- I didn't think of <code>Expression</code>, but I think this is the direction I'll explore. Thanks again!</p>",
        "id": 199498295,
        "sender_full_name": "Brian Kaney",
        "timestamp": 1591107720
    },
    {
        "content": "<p>Yeah, actually, I don't know that the FSH documentation does cover that fairly well.  There's enough in the documentation to figure it out, but frankly, this needs a book to describe how to use FSH to create an IG .  I know someone with experience writing books, but he might not be available for a bit... ;-)</p>",
        "id": 199540812,
        "sender_full_name": "Keith Boone",
        "timestamp": 1591125891
    },
    {
        "content": "<p>Ha.  Yeah, I know there's plenty of places where you still need to connect the dots -- and creating an IG (with or without FSH) is extremely complex.  I was referring more specifically to <a href=\"https://build.fhir.org/ig/HL7/fhir-shorthand/reference.html#sliced-array-paths\">how to reference slices by path</a> and <a href=\"https://build.fhir.org/ig/HL7/fhir-shorthand/reference.html#step-2-defining-slice-contents\">how to set constraints on specific slices</a> -- which at least have some decent examples.  Now... how to correctly decide what the <code>slicing</code> rules should be in the first place... that's the hard part.</p>",
        "id": 199542483,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1591126732
    }
]