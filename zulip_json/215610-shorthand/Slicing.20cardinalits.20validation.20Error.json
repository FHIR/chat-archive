[
    {
        "content": "<p>I think i found a bug in the slicing valdidation:<br>\nIf you set a sliced element to 0..0 and the element contains slices sushi reports an error:</p>\n<blockquote>\n<p>error No individual slice may have max &gt; max of sliced element, but max of slice valueQuantity (1) &gt; max of sliced element (0).</p>\n</blockquote>\n<p><a href=\"https://www.hl7.org/fhir/profiling.html#slice-cardinality\">https://www.hl7.org/fhir/profiling.html#slice-cardinality</a> enforces this rule for the min card.. but not the max cardinality.<br>\nCreated an issue:<br>\n<a href=\"https://github.com/FHIR/sushi/issues/918\">https://github.com/FHIR/sushi/issues/918</a></p>",
        "id": 253733978,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1631881719
    },
    {
        "content": "<p>Thanks for reporting...  I think the main thing SUSHI is trying to enforce is that if an array can only have <em>x</em> elements, then it's wrong to say that any slice within it can have <em>x+1</em> elements.  For example, it doesn't make sense to say \"no components allowed\" but also say \"up to one systolic component is allowed and up to one diastolic component is allowed\".</p>\n<p>This error is most helpful when an author is adding slices to an array whose cardinality has already been constrained -- because their new slice constraint is obviously incorrect.  But I agree that it's a bit more confusing when it happens because you card-constrain an array that is <em>already</em> sliced (and the new array constraint allows fewer elements than some of the slices do).  I guess the questions are (a) would the author still want to know that (in case it is unintentional)? (b) Should we force the other to also reconstrain the slices to fit within the overall array max? (c) Should SUSHI reconstrain those slices for them? Or (d) should we just let it go as-is even though it introduces inconsistency between the slices and container?</p>",
        "id": 253736364,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1631882940
    },
    {
        "content": "<p>Would it be possible for SUSHI to distinguish between (a)  the case where there is a contradiction in the slice/element cardinalities defined within a <em>single</em> profile, and (b) the case where the contradiction is between constraints in a base and a derived profile? If I read the example from <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> correctly, he is talking about case (b) where my feeling is that a warning would do. However, I also think that an error is still appropriate in case (a) since I cannot imagine a case where a cardinality-contradiction is on purpose in that scenario.</p>",
        "id": 253941656,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1632054343
    },
    {
        "content": "<p>+1 to all what <span class=\"user-mention\" data-user-id=\"194703\">@Morten Ernebjerg</span>  said.</p>",
        "id": 254012340,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1632125356
    },
    {
        "content": "<p>I only would make it a warning in either way as this isn't forbidden by the FHIR spec.</p>",
        "id": 254012515,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1632125456
    },
    {
        "content": "<p>i assume there is no workaround, and we have to wait for the next version?</p>",
        "id": 254527575,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1632400767
    },
    {
        "content": "<p>Well... the workaround is to add rules to restrict the card of the slices so they fit within the overall card of the container.  But if you're asking for a workaround to remove the error... no, I don't think we have one at this point.  We haven't started working on a solution for this yet, but we start a new development sprint today, so we'll try to fit it into the list for the next two weeks.</p>",
        "id": 254536174,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1632404275
    },
    {
        "content": "<p>that would be wonderful. <br>\nUnfortunately i'm deriving from another Profile, defining these slices, but i need to set the whole element to 0..0</p>",
        "id": 254538809,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1632405351
    },
    {
        "content": "<p>I think this is a very common use-case, will provide structured comments in the issue</p>",
        "id": 254538896,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1632405372
    },
    {
        "content": "<p>Updated the Issue with expected behaviour</p>",
        "id": 254549431,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1632408986
    },
    {
        "content": "<blockquote>\n<p>Unfortunately i'm deriving from another Profile, defining these slices, but i need to set the whole element to 0..0</p>\n</blockquote>\n<p>Yeah, but just to be clear, you should still be able to zero out the inherited slices via something like:</p>\n<div class=\"codehilite\"><pre><span></span><code>* component[inheritedSliceName] 0..0\n</code></pre></div>\n<p>You might have to do that <em>before</em> setting the sliced element to 0..0.  But that should get you around the error for now.</p>",
        "id": 254553611,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1632410422
    },
    {
        "content": "<p>thanks for the workaround, so obvious</p>",
        "id": 254670865,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1632472911
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> - I re-read that part of the spec you linked to and realized that it seemed like it <em>does</em> say that the slice max cannot be greater than the element max.  It just doesn't say it very clearly.  So I asked about it separately and Grahame confirmed the intent: \"slice max can't be greater than element max\".  So SUSHI is, in fact, enforcing FHIR spec here...  So now I'm wondering if we run into this situation if we should just issue a warning and automatically reduce all maxes to be no greater than the element max.</p>",
        "id": 256234340,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1633436054
    },
    {
        "content": "<p>Thanks for your effort <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span></p>",
        "id": 256250487,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633442567
    },
    {
        "content": "<p>I agree , if the outcome of the other thread is: you have to set each slice to 0..0 manually.</p>",
        "id": 256250595,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633442609
    },
    {
        "content": "<p>Sushi issuing a warning and automatically setting all slices to 0..0 would be very convinient</p>",
        "id": 256250727,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633442645
    }
]