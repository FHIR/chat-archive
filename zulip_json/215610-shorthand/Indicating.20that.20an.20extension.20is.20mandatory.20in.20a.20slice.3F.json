[
    {
        "content": "<p>I want to indicate that an extension in one of my slices is mandatory:</p>\n<div class=\"codehilite\"><pre><span></span><code>* item[DateTime].type from DateTimeItemTypes (required)\n* item[DateTime].extension contains http://hl7.org/fhir/StructureDefinition/regex named regex 1..1 MS\n</code></pre></div>\n<p>But I can't seem to then set this in my instance.  When I do <code>item[2].extension[regex].valueString = \"asd\"</code>, I get the following error: <code>The element or path you referenced does not exist: item[2].extension[regex].valueString</code>.</p>\n<p>I'm assuming that is because the <code>named regex</code> part is in the slice and not in the profile itself?</p>",
        "id": 215928548,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1604718593
    },
    {
        "content": "<p>Again, is this mixing profiling and instances? Wouldn't the instance be: </p>\n<div class=\"codehilite\"><pre><span></span><code>item[2].extension[0].url = http://hl7.org/fhir/StructureDefinition/regex\nitem[2].extension[0].valueString = &quot;asd&quot;\n</code></pre></div>\n<p>And then it matches the profiling you've specified?</p>",
        "id": 215970671,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1604779107
    },
    {
        "content": "<p>I have to say, I find that the shorthand documentation is a little lacking in differentiating how to use extensions in instances versus defining them. </p>\n<p>PS. Actually, I think the language is a little lacking in that regard too. It would be nicer if using an extension was easier than having to hand code the elements.</p>\n<p>PPS. Actually, I think the language is a little lacking in capabilities for instance creation generally. It would be nicer if creating an instance was easier than having to hand code majority of the elements.</p>",
        "id": 215970844,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1604779346
    },
    {
        "content": "<p>hmm, i've always specified the extensions in my instances using the name that I've given to them.</p>",
        "id": 216039745,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1604890963
    },
    {
        "content": "<p>Really? I tried that once and couldn't get it to work, so I figured I was mis-reading the documentation and that approach only worked for profiling. Hmm, maybe I'll have to go back and try it again.</p>",
        "id": 216040177,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1604891593
    },
    {
        "content": "<p>yeah, here is other extensions that I specify in my instance and they work properly:</p>\n<div class=\"codehilite\"><pre><span></span><code>* item[0].extension[requiredText].valueMarkdown = &quot;Please answer this&quot;\n* item[0].extension[sasVariableName].valueString = &quot;SLT&quot;\n</code></pre></div>",
        "id": 216040238,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1604891654
    },
    {
        "content": "<p>and my profile has the following:</p>\n<div class=\"codehilite\"><pre><span></span><code>* item.extension contains ItemTitle named title 1..1 MS and\n    ItemSASVariableName named sasVariableName 1..1 MS and\n    ItemRequiredText named requiredText 0..1 MS and\n    http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl named itemControl 0..1 MS\n</code></pre></div>",
        "id": 216040248,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1604891695
    },
    {
        "content": "<p>Ah, ok. my instances aren't profiled, they're just instances of Questionnaire. I wonder if that changes things.</p>",
        "id": 216040318,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1604891797
    },
    {
        "content": "<p>sure, if you haven't defined the extension already, then it probably wouldn't work like I'm doing it.</p>",
        "id": 216040330,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1604891835
    },
    {
        "content": "<p>You should be able to add any extension that SUSHI knows about, even if that extension is not on the profile. So the line:</p>\n<div class=\"codehilite\"><pre><span></span><code>item[2].extension[regex].valueString = &quot;asd&quot;\n</code></pre></div>\n<p>should work on an <code>Instance</code> of a Questionnaire, or a profile of Questionnaire. I've tried testing out that line on an Instance of Questionnaire, and it was working for me. If you're able to share the full Instance you are defining that is causing the error, that could help so we could recreate this.</p>",
        "id": 216081581,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1604927593
    },
    {
        "content": "<p>To add one important clarification to <span class=\"user-mention\" data-user-id=\"239822\">@Nick Freiter</span>'s note above, the example above (for adding an arbitrary extension) only works if <code>regex</code> resolves to an extension by name, id, or url (which, in this case, works out because <code>regex</code> is the actual id of the extension).  The only other way for it to work is for it to resolve to the slice name of an extension in the profile this is an instance of.</p>",
        "id": 216085676,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1604929887
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span>  and <span class=\"user-mention\" data-user-id=\"192166\">@Jean Duteau</span> -- I'm sorry the documentation is lacking.  You <em>should</em> be able to reference slices by name in instances.  Since extensions are just slices of extension, it should work for them as well.</p>\n<p>As for <code>item[2].extension[regex].valueString = \"asd\"</code>, <span class=\"user-mention\" data-user-id=\"239822\">@Nick Freiter</span> already noted why this <em>should</em> work no matter what -- but one thing to note is that <code>item[2]</code> will not be recognized by SUSHI as an item in the <code>DateTime</code> slice, so therefore it does not use any of the constraints you specified in <code>item[DateTime]</code>.  You would have to say <code>item[DateTime].extension[regex].valueString = \"asd\"</code> for it to recognize and use those constraints.  I don't recall for sure, but I think if you want to access the 2nd item in the <code>DateTime</code> slice, you would do <code>item[DateTime][1].extension[regex].valueString = \"asd\"</code>.</p>",
        "id": 216086189,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1604930172
    },
    {
        "content": "<p>Thanks.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"239822\">Nick Freiter</span> <a href=\"#narrow/stream/215610-shorthand/topic/Indicating.20that.20an.20extension.20is.20mandatory.20in.20a.20slice.3F/near/216081581\">said</a>:</p>\n<blockquote>\n<p>You should be able to add any extension that SUSHI knows about, even if that extension is not on the profile. </p>\n</blockquote>\n<p>What constitutes SUSHI knowing about an extension? Does that require a \"contains...named\" line, and if so,  can I do that when invoking an extension rather than profiling the resource the extension is used in? (In my case, the resource and extension are both defined in FHIR core, and I'm just creating an instance using it.)</p>",
        "id": 216099958,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1604935980
    },
    {
        "content": "<p>SUSHI \"knows\" about an extension if that extension is defined in FSH using the <code>Extension</code> keyword, or that extension is defined as a StructureDefinition in the dependencies that are specified in the <code>sushi-config.yaml</code> file, or that extension is defined in FHIR Core (since the FHIR Core definitions are always loaded by SUSHI, without the need for specifying a dependency). It does not require a <code>contains...named</code> line on the profile.</p>",
        "id": 216109116,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1604939509
    },
    {
        "content": "<p>I'm not sure what you mean by \"invoking an extension\", but I think an example could help clarify what I mean. The following definition is valid:</p>\n<div class=\"codehilite\"><pre><span></span><code>Instance: Foo\nInstanceOf: Questionnaire\n* item[0].extension[regex].valueString = &quot;asd&quot;\n</code></pre></div>\n<p>Even though <code>Foo</code> is an instance of <code>Questionnaire</code> directly, and not a profile of <code>Questionnaire</code>, I can reference the <code>regex</code> extension as shown, since SUSHI has loaded the <code>regex</code> extension from the core FHIR definitions.  There is no need to profile <code>Questionnaire</code> with a rule like:</p>\n<div class=\"codehilite\"><pre><span></span><code>* extension contains http://hl7.org/fhir/StructureDefinition/regex named regex\n</code></pre></div>",
        "id": 216109605,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1604939728
    },
    {
        "content": "<p>OK, assuming I have the dependencies in there, how do I define the name \"regex\"? Can I do:</p>\n<div class=\"codehilite\"><pre><span></span><code>Instance: Foo\nInstanceOf: Questionnaire\n* item[0].extension[&quot;http://hl7.org/fhir/StructureDefinition/regex&quot;].valueString = &quot;asd&quot;\n</code></pre></div>",
        "id": 216112253,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1604940897
    },
    {
        "content": "<p>You can refer to an extension by its name, id, or url, and SUSHI will look for an extension with a matching name, id, or url. So in this case, the <code>regex</code> extension is defined in FHIR to have and id and name of <code>regex</code>, so you can reference it directly as I showed:</p>\n<div class=\"codehilite\"><pre><span></span><code>* item[0].extension[regex].valueString = &quot;asd&quot;\n</code></pre></div>\n<p>There is no need to define the name \"regex\". If you are in a situation where names may conflict, it is usually best to use the URL. In that case I think the most common approach would be to use an alias, like so:</p>\n<div class=\"codehilite\"><pre><span></span><code>Alias: REGEX = http://hl7.org/fhir/StructureDefinition/regex\n\nInstance: foo\nInstanceOf: Questionnaire\n* item[0].extension[REGEX].valueString = &quot;asd&quot;\n</code></pre></div>",
        "id": 216113094,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1604941259
    },
    {
        "content": "<p>Hmm, so I just retried this.</p>\n<p>I have <code>Alias: $ext-questionnaire-itemControl   = http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl</code> defined.</p>\n<p>And in my Questionnaire instance, the following works:</p>\n<div class=\"codehilite\" data-code-language=\"fsh\"><pre><span></span><code>...\n* item[7].item[2].item[0].linkId    = \"outcome_asymp_help\"\n* item[7].item[2].item[0].text      = \"No: the case remains asymptomatic; Yes: the previously asymptomatic case developed symptoms and/or signs of illness.\"\n* item[7].item[2].item[0].type      = #display\n* item[7].item[2].item[0].extension[0].url = $ext-questionnaire-itemControl\n* item[7].item[2].item[0].extension[0].valueCodeableConcept = $cs-itemControl#help\n</code></pre></div>\n<p>But none of these work:</p>\n<div class=\"codehilite\" data-code-language=\"fsh\"><pre><span></span><code>* item[7].item[2].item[0].extension[$ext-questionnaire-itemControl].valueCodeableConcept = $cs-itemControl#help\n* item[7].item[2].item[0].extension[http://hl7.org/fhir/questionnaire-item-control].valueCodeableConcept = $cs-itemControl#help\n* item[7].item[2].item[0].extension[\"http://hl7.org/fhir/questionnaire-item-control\"].valueCodeableConcept = $cs-itemControl#help\n</code></pre></div>\n<p>All result in the error</p>\n<div class=\"codehilite\"><pre><span></span><code>Sushi: error The element or path you referenced does not exist: item[7].item[2].item.extension[http://hl7.org/fhir/questionnaire-item-control].valueCodeableConcept (00:08.0336)\n</code></pre></div>",
        "id": 216431089,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1605160985
    },
    {
        "content": "<p>Which version of SUSHI are you using? There was a bug in SUSHI versions 0.16.0 or earlier which caused SUSHI to fail to find the path of an extension being added to an Instance, if the extension was nested within another element. See the bug report <a href=\"https://github.com/FHIR/sushi/issues/621\">here</a>.</p>",
        "id": 216462105,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1605184958
    },
    {
        "content": "<p>OK, I'm using 1.6.0. I wasn't ready jump over to the beta.</p>",
        "id": 216475423,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1605191555
    }
]