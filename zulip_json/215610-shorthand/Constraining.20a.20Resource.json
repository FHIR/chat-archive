[
    {
        "content": "<p>I'm trying to create a profile on Bundle and constrain the first resource in .entry to a particular MessageHeader profile. Looking at other IGs, it feels like I need to do this:<br>\nentry[&lt;slice name&gt;].resource ^type.profile = &lt;desired profile&gt;<br>\nI tried using the name of the profile I created (BDRMessageHeader) and while it didn't cause a Sushi error, it didn't display correctly. It works fine when I give it the explicit URL for the desired profile. Should this work with just the profile name (like it does when you restrict a Reference element)? Or am I constraining it the wrong way?</p>",
        "id": 198104172,
        "sender_full_name": "Craig Newman",
        "timestamp": 1589911165
    },
    {
        "content": "<p>I think in this situation you would want to use an <code>only</code> rule, as described in more detail here: <a href=\"http://build.fhir.org/ig/HL7/fhir-shorthand/branches/master/reference.html#data-type-restriction-rules\">http://build.fhir.org/ig/HL7/fhir-shorthand/branches/master/reference.html#data-type-restriction-rules</a>. As an example, I think you would want something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>* entry[specialMessage].resource only BDRMessageHeader\n</code></pre></div>\n\n\n<p>Assuming that <code>specialMessage</code> is a slice you have added to the <code>entry</code> element already.</p>",
        "id": 198110001,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1589914060
    },
    {
        "content": "<p>Is it possible to simply state</p>\n<div class=\"codehilite\"><pre><span></span><code>* entry[0].resource only BDRMessageHeader\n</code></pre></div>",
        "id": 198110442,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1589914284
    },
    {
        "content": "<p>Sushi doesn't seem to like Vassil's solution. I get an error of \"No element found at path entry[0].resource\"</p>",
        "id": 198112072,
        "sender_full_name": "Craig Newman",
        "timestamp": 1589915031
    },
    {
        "content": "<p>In the context of a profile, we can't constrain specific elements in the <code>entry</code> array. The <code>entry</code> array is an element that has cardinality <code>0..*</code>, and we can constrain the <em>contents</em> of that array using slicing, but you can't put a constraint on an element at the 0th index.</p>",
        "id": 198115699,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1589916885
    },
    {
        "content": "<p>If you really want to constrain the <em>first</em> entry, you <em>may</em> be able to do that by setting <a href=\"http://hl7.org/fhir/R4/elementdefinition-definitions.html#ElementDefinition.slicing.ordered\">ordered</a> in the slicing definition, but the FHIR spec seems to discourage that.  I'm also not sure how it works with elements that don't belong to a slice (do they go before or after the ordered slices?).</p>\n<p>The other approach to enforce a type constraint on the first entry resource would be to use an invariant with a FHIRPath expression saying that the first entry resource must be a certain type.</p>",
        "id": 198117744,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589917919
    },
    {
        "content": "<p>I may be going overboard given the base spec is very clear that the first entry in a message bundle must be a MessageHeader but it did seem worth it to specify the profile to use. I currently have this:</p>\n<ul>\n<li>entry ^slicing.discriminator.type = #type</li>\n<li>entry ^slicing.discriminator.path = \"resource\"</li>\n<li>entry ^slicing.rules = #open</li>\n<li>entry ^slicing.ordered = true</li>\n<li>entry ^slicing.description = \"First entry must be MessageHeader\"</li>\n<li>entry contains MessageHeader 1..1</li>\n<li>entry[MessageHeader].resource 1..1</li>\n<li>entry[MessageHeader].resource only BDRMessageHeader </li>\n</ul>\n<p>But I have to admit that discriminators confuse me. Should the path be resource.resolve()?</p>",
        "id": 198119666,
        "sender_full_name": "Craig Newman",
        "timestamp": 1589918849
    },
    {
        "content": "<p>It seems to me that the ability to constrain the first entry in a Bundle without making the whole array of entries ordered is something that is necessary for documents, messages, and notifications. The proper way to do that needs to be called out as a pattern to follow. Would that be \"an invariant with a FHIRPath expression saying that the first entry resource must be a certain type\"?</p>",
        "id": 198120149,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1589919095
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192758\">@Craig Newman</span> -- if the target is a reference, you need <code>resolve()</code>, otherwise, you do not.  Since <code>entry.resource</code> is <em>not</em> a reference, I think your discriminator path is OK.</p>",
        "id": 198232633,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589996562
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> -- is there a standard way to say that the first element in a list must be of a certain type or profile (for example some kind of \"header\" type)?  We've established that you <em>might</em> be able to do this with an ordered slicing, but a FHIRPath constraint might be better.  Are those the options?  Is one preferable?</p>",
        "id": 198232962,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589996719
    },
    {
        "content": "<p>There's a change request to allow slicing by position, but it's not applied yet.  (And it would only be appropriate for arrays where the order has defined meaning in the core spec - e.g. HumanName.given)</p>",
        "id": 198245705,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590002836
    },
    {
        "content": "<p>So is there a recommendation for specifying the first item in a list using R4?</p>",
        "id": 198246087,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590003006
    },
    {
        "content": "<p>Other than with an invariant, no.</p>",
        "id": 198246922,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590003426
    },
    {
        "content": "<p>I've run into a similar issue, but the main problem I'm having is more about getting an example to display in the order I'd like.  No matter what I try it puts the MessageHeader in a bundle at the end.</p>\n<p>This is how the profile is defined for Bundle.entry:</p>\n<ul>\n<li>entry 2..2</li>\n<li>entry ^slicing.discriminator.type = #type</li>\n<li>entry ^slicing.discriminator.path = \"resource\"</li>\n<li>entry ^slicing.rules = #closed</li>\n<li>entry ^slicing.ordered = true</li>\n<li>entry contains <br>\n      PMIRMessageHeaderEntry 1..1 and <br>\n      PMIRBundleHistoryEntry 1..1</li>\n</ul>\n<p>And when I try to create an example using this, I put it in like this (there is more content, but just as an example)</p>\n<ul>\n<li>entry[PMIRMessageHeaderEntry].fullUrl = \"<a href=\"http://example.com/fhir/MessageHeader/1\">http://example.com/fhir/MessageHeader/1</a>\"</li>\n<li>entry[PMIRBundleHistoryEntry].fullUrl = \"<a href=\"http://example.come/fhir/Bundle/abc\">http://example.come/fhir/Bundle/abc</a>\"</li>\n</ul>\n<p>And the output always puts the MessageHeader last.  I tried reversing the order, I tried changing the slice names so the Header came first alphabetically.  It always puts the MessageHeader as the second entry in the Bundle.  I understand the entry isn't really ordered, but it's odd that SUSHI puts the header last no matter what the input is.</p>",
        "id": 206288604,
        "sender_full_name": "Luke Duncan",
        "timestamp": 1596822633
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193299\">@Luke Duncan</span> this looks like a bug where SUSHI isn't respecting the order when creating instances. Can you file an issue in JIRA?  <a href=\"https://jira.hl7.org/browse/FHIR-27321?jql=project%20%3D%20FHIR%20AND%20Specification%20%3D%20%22Shorthand%20(FHIR)%20%5BFHIR-shorthand%5D%22%20\">https://jira.hl7.org/browse/FHIR-27321?jql=project%20%3D%20FHIR%20AND%20Specification%20%3D%20%22Shorthand%20(FHIR)%20%5BFHIR-shorthand%5D%22%20</a></p>",
        "id": 206458780,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1597065334
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span> I created this issue:  <a href=\"https://jira.hl7.org/browse/FHIR-28234\">https://jira.hl7.org/browse/FHIR-28234</a></p>\n<p>Thanks!</p>",
        "id": 206476987,
        "sender_full_name": "Luke Duncan",
        "timestamp": 1597074647
    }
]