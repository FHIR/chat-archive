[
    {
        "content": "<p>When I started converting the IPS (International Patient Summary) IG to FSH, I ran into trying to figure out how to set <code>ValueSet.compose.include.version</code> to a specific code system version.  I didn't see any examples or other documentation on how to do that.  Mark Kramer suggested that using <code>* ^compose.include.version = “v123”</code> is the way to do that and has been supported for some time - and that makes perfect sense, except that so far it doesn't seem to be working.  This is the FSH syntax that I am using (except for most of the content - &gt; 26000 rows):</p>\n<div class=\"codehilite\"><pre><span></span><code>ValueSet: SnomedIntlGps\nId: snomed-intl-gps\nTitle: &quot;SNOMED International Global Patient Set (GPS)&quot;\nDescription: &quot;&quot;&quot;SNOMED International Global Patient Set (GPS) value set.    The value set includes all of the codes from the SNOMED International Global Patient Set (GPS)    subset of SNOMED CT.  The current version of the value set contains all concepts (26,158) from    the September 2020 release of the GPS (based on the July 2020 SNOMED CT International Edition    release).\n\n   This value set is provided in this IG as a FHIR ValueSet resource instance for the convenience of implementers.   &quot;&quot;&quot;\n* ^meta.profile = &quot;http://hl7.org/fhir/StructureDefinition/shareablevalueset&quot;\n* ^text.status = #additional\n* ^text.div = &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;\\n\\t\\t\\t&lt;div id=\\&quot;cld\\&quot;&gt;&lt;p&gt;This value set has a large enumerated (extensional) definition.  See &amp;quot;Definition&amp;quot; in the table above for the definition description.  The full definition is available in the resource instance (see links in &amp;quot;Source Resource&amp;quot; in the table above).&lt;/p&gt;&lt;/div&gt;\\n\\t\\t&lt;/div&gt;&quot;\n* ^version = &quot;1.0.0&quot;\n* ^status = #active\n* ^experimental = false\n* ^date = &quot;2021-06-01T09:59:23-05:00&quot;\n* ^publisher = &quot;Health Level Seven International - Patient Care Work Group&quot;\n* ^contact.telecom.system = #url\n* ^contact.telecom.value = &quot;http://www.hl7.org/Special/committees/patientcare&quot;\n* ^jurisdiction = $m49.htm#001\n* ^immutable = false\n* ^copyright = &quot;The GPS is produced by SNOMED International under the terms of the [Creative Commons Attribution 4.0 International Public License](https://creativecommons.org/licenses/by/4.0/)\\n\\nAdditional information about this license specific to SNOMED International’s release of the GPS:\\n* SNOMED CT is © and ® SNOMED International. The right to maintain the GPS remains vested exclusively in SNOMED International.\\n* The Licensee can redistribute the GPS.\\n* The Licensee can create derivatives or implementation-related products and services based on the GPS.\\n* The Licensee cannot claim that SNOMED International or any of its Members endorses the Licensee’s derivative because it uses content from the GPS.\\n* Neither SNOMED International nor any of the contributors accept any liability for the Licensee’s use or redistribution of the GPS.\\n* SNOMED CT® was originally created by the College of American Pathologists.\\n\\nWithout obtaining prior written permission from SNOMED International, you are expressly prohibited from using, distributing or reproducing the SNOMED International, SNOMED CT or SNOMED GPS logo, service mark or trademark. Please review all terms and conditions of use [here](http://www.snomed.org/terms-and-conditions).&quot;\n* ^compose.include.version = &quot;http://snomed.info/sct/900000000000207008/version/20200731&quot;\n* SNOMED_CT#109006 &quot;Anxiety disorder of childhood OR adolescence (disorder)&quot;\n.......\n</code></pre></div>\n<p>And this is the resulting StructureDefinition in fsh-generated/resources:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;ValueSet&quot;,\n  &quot;status&quot;: &quot;active&quot;,\n  &quot;name&quot;: &quot;SnomedIntlGps&quot;,\n  &quot;id&quot;: &quot;snomed-intl-gps&quot;,\n  &quot;title&quot;: &quot;SNOMED International Global Patient Set (GPS)&quot;,\n  &quot;description&quot;: &quot;SNOMED International Global Patient Set (GPS) value set.    The value set includes all of the codes from the SNOMED International Global Patient Set (GPS)    subset of SNOMED CT.  The current version of the value set contains all concepts (26,158) from    the September 2020 release of the GPS (based on the July 2020 SNOMED CT International Edition    release).   \\n\\n   This value set is provided in this IG as a FHIR ValueSet resource instance for the convenience of implementers.   &quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;url&quot;: &quot;http://hl7.org/fhir/uv/ips/ValueSet/snomed-intl-gps&quot;,\n  &quot;meta&quot;: {\n    &quot;profile&quot;: [\n      &quot;http://hl7.org/fhir/StructureDefinition/shareablevalueset&quot;\n    ]\n  },\n  &quot;text&quot;: {\n    &quot;status&quot;: &quot;additional&quot;,\n    &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;div id=\\&quot;cld\\&quot;&gt;&lt;p&gt;This value set has a large enumerated (extensional) definition. See &amp;quot;Definition&amp;quot; in the table above for the definition description. The full definition is available in the resource instance (see links in &amp;quot;Source Resource&amp;quot; in the table above).&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&quot;\n  },\n  &quot;experimental&quot;: false,\n  &quot;date&quot;: &quot;2021-06-01T09:59:23-05:00&quot;,\n  &quot;publisher&quot;: &quot;Health Level Seven International - Patient Care Work Group&quot;,\n  &quot;contact&quot;: [\n    {\n      &quot;telecom&quot;: [\n        {\n          &quot;system&quot;: &quot;url&quot;,\n          &quot;value&quot;: &quot;http://www.hl7.org/Special/committees/patientcare&quot;\n        }\n      ]\n    }\n  ],\n  &quot;jurisdiction&quot;: [\n    {\n      &quot;coding&quot;: [\n        {\n          &quot;code&quot;: &quot;001&quot;,\n          &quot;system&quot;: &quot;http://unstats.un.org/unsd/methods/m49/m49.htm&quot;\n        }\n      ]\n    }\n  ],\n  &quot;immutable&quot;: false,\n  &quot;copyright&quot;: &quot;The GPS is produced by SNOMED International under the terms of the [Creative Commons Attribution 4.0 International Public License](https://creativecommons.org/licenses/by/4.0/)\\n\\nAdditional information about this license specific to SNOMED International’s release of the GPS:\\n* SNOMED CT is © and ® SNOMED International. The right to maintain the GPS remains vested exclusively in SNOMED International.\\n* The Licensee can redistribute the GPS.\\n* The Licensee can create derivatives or implementation-related products and services based on the GPS.\\n* The Licensee cannot claim that SNOMED International or any of its Members endorses the Licensee’s derivative because it uses content from the GPS.\\n* Neither SNOMED International nor any of the contributors accept any liability for the Licensee’s use or redistribution of the GPS.\\n* SNOMED CT® was originally created by the College of American Pathologists.\\n\\nWithout obtaining prior written permission from SNOMED International, you are expressly prohibited from using, distributing or reproducing the SNOMED International, SNOMED CT or SNOMED GPS logo, service mark or trademark. Please review all terms and conditions of use [here](http://www.snomed.org/terms-and-conditions).&quot;,\n  &quot;compose&quot;: {\n    &quot;include&quot;: [\n      {\n        &quot;system&quot;: &quot;http://snomed.info/sct&quot;,\n        &quot;concept&quot;: [\n          {\n            &quot;code&quot;: &quot;109006&quot;,\n            &quot;display&quot;: &quot;Anxiety disorder of childhood OR adolescence (disorder)&quot;\n          },\n.....\n</code></pre></div>\n<p>You can see that <code>compose.include.version</code> isn't flowing through to the ValueSet resource instance that Sushi generates.  Do I need to do something different in the FSH syntax.  Or is this a Sushi bug?</p>",
        "id": 241438233,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622747424
    },
    {
        "content": "<p>This is with Sushi v1.3.2.</p>",
        "id": 241438774,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622747701
    },
    {
        "content": "<p>Because the CodeSystem syntax manages the components for you (grouping codes into components based on common systems, etc), we disabled <code>^</code> syntax on elements of <code>component</code> because it would be difficult for authors to identify the right component by index in complex code systems.  That said, SUSHI should produce an error when you attempt to do that (rather than just ignoring it).</p>",
        "id": 241442184,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1622749311
    },
    {
        "content": "<p>Luckily, there are actually several ways to do what you're looking to do.  For example purposes, I've added one more code so you can see how it goes for multiple codes.  Here are some of your options:</p>\n<div class=\"codehilite\"><pre><span></span><code>// Approach A\n// Use {system}|{version}#{code} syntax for each code\n\nValueSet: VersionedSystemApproachA\n* SNOMED_CT|http://snomed.info/sct/900000000000207008/version/20200731#109006 &quot;Anxiety disorder of childhood OR adolescence (disorder)&quot;\n* SNOMED_CT|http://snomed.info/sct/900000000000207008/version/20200731#999999 &quot;Fake code for example purposes&quot;\n\n// Approach B\n// Set an alias to the full canonical URL of the system: {systemURL}|{version}\n// then use the alias when defining each code\n\nAlias: SCTv20200731 = http://snomed.info/sct|http://snomed.info/sct/900000000000207008/version/20200731\n\nValueSet: VersionedSystemApproachB\n* SCTv20200731#109006 &quot;Anxiety disorder of childhood OR adolescence (disorder)&quot;\n* SCTv20200731#999999 &quot;Fake code for example purposes&quot;\n\n// Approach C\n// Use syntax that lists codes and then ends with &quot;from system {system}|{version}&quot;\n\nValueSet: VersionedSystemApproachC\n* #109006 &quot;Anxiety disorder of childhood OR adolescence (disorder)&quot; and\n  #999999 &quot;Fake code for example purposes&quot;\n  from system SNOMED_CT|http://snomed.info/sct/900000000000207008/version/20200731\n</code></pre></div>\n<p>You can see and try this in FSH Online here: <a href=\"https://fshschool.org/FSHOnline/#/share/3vOBsO5\">https://fshschool.org/FSHOnline/#/share/3vOBsO5</a></p>",
        "id": 241442498,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1622749472
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> I converted your entire IG to FSH (including the version indicators). How do you want it? (Can you receive a zip file via email? Or do you want me to do a PR?)</p>",
        "id": 241448388,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1622752216
    },
    {
        "content": "<p>I've already done that, <span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span> (but thanks for doing it).</p>",
        "id": 241455166,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622754870
    },
    {
        "content": "<p>The converted IG using FSH is in the <a href=\"https://github.com/HL7/fhir-ips/tree/connectathon\">connectathon</a> branch.  I'm just working on this value set issue (right now that's only local and I haven't committed it to the branch yet).</p>",
        "id": 241459300,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622756426
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> Thanks for these ideas - it looks like any of them should work.  I'm sure I'm missing something, but it looks like the FSH Online example is only showing the conversion to JSON of \"VersionedSystemApproachA\".</p>",
        "id": 241460403,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622756897
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> -- you should see a pane on the right-hand side of the screen that allows you to select from the output files.</p>",
        "id": 241460568,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1622756973
    },
    {
        "content": "<p>Thanks.  I was looking for that - but hadn't seen that the far right panel was actually doing that.</p>",
        "id": 241460829,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622757081
    },
    {
        "content": "<p>I will pick one of these approaches and get all of the \"GPS\" value sets defined with the correct version in FSH.  I'm also planning to convert the \"GPS subset\" value sets (like 'allergy-intolerance-substance-condition-gps-uv-ips') to be defined intensionally, using 2 instances of <code>ValueSet.compose.include.filter</code> inside a single <code>ValueSet.compose.include</code> (which should return the intersection of the two filters).  Can you point me to a way to do that in FSH?</p>",
        "id": 241461602,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622757506
    },
    {
        "content": "<p>The syntax for multiple filters is shown in the 4th row of the first table in the <a href=\"http://hl7.org/fhir/uv/shorthand/reference.html#defining-value-sets\">spec section on defining value sets</a>.  The basic syntax is:</p>\n<div class=\"codehilite\"><pre><span></span><code>* include codes from system {CodeSystem name|id|url} where {filter} and {filter} and ...\n</code></pre></div>\n<p>For example:</p>\n<div class=\"codehilite\"><pre><span></span><code>* include codes from system SNOMED_CT where concept is-a #1234 &quot;Foo&quot; and concept is-a #6789 &quot;Bar&quot;\n</code></pre></div>\n<p>That example probably doesn't make actual sense, but it shows the basic approach.  Note that you can wrap the filters onto different lines if you want to make it more readable:</p>\n<div class=\"codehilite\"><pre><span></span><code>* include codes from system SNOMED_CT where\n    concept is-a #1234 &quot;Foo&quot; and\n    concept is-a #6789 &quot;Bar&quot;\n</code></pre></div>\n<p>FSH Online: <a href=\"https://fshschool.org/FSHOnline/#/share/3z2KSI3\">https://fshschool.org/FSHOnline/#/share/3z2KSI3</a></p>",
        "id": 241462521,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1622758071
    },
    {
        "content": "<p>Also, I just want to note that we have a new beta of SUSHI coming out soon (probably Monday) that has an improved <code>CodeSystem</code> syntax.  I don't know if you are defining code systems in FSH, but if so, you might want to check out the new stuff that allows for hierarchical codes and setting the individual concept elements (like designation and property).  See <a href=\"http://build.fhir.org/ig/HL7/fhir-shorthand/reference.html#defining-code-systems\">Defining Code Systems</a> and <a href=\"http://build.fhir.org/ig/HL7/fhir-shorthand/reference.html#caret-paths\">Caret Paths</a> in the current build (STU2) FSH spec.</p>",
        "id": 241462924,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1622758277
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  If in doubt, read the documentation! :)  When I looked at that before I was mainly trying to figure out the code system version issue in the include (which I missed), and I didn't really recall what was there for the filters.  So I think I should have what I need - appreciate it!</p>",
        "id": 241463173,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622758409
    },
    {
        "content": "<p>And that also sounds like a great addition for CodeSystem!</p>",
        "id": 241463266,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1622758455
    }
]