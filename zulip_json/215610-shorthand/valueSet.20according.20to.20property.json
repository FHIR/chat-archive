[
    {
        "content": "<p>Let's say I have a codeSystem where every concept has a property we'll call \"type\". Each concept can be either a procedure or a diagnosis. I need to make separate valueSets according to this property where one valueSet is for procedures and the other is for diagnoses. I've tried to get this to work but cannot figure out the actual way to write this is FSH. Usually when this happens I find an example of this somewhere, goFsh it and learn from that. But I can't find something like this so I was wondering if anyone can give me the line of code I'm looking for. <br>\nSomething along the lines of:<br>\n<code>* include concepts from $code-system where concept.property.valueCode=\"Diagnosis\"</code></p>",
        "id": 278458783,
        "sender_full_name": "Kippi Bordowitz",
        "timestamp": 1649583878
    },
    {
        "content": "<p>more information:<br>\nThis is what the VS I'm trying to create looks like:<br>\n<a href=\"/user_uploads/10155/swuPbry2hHBDsp0tnlMkzZev/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/swuPbry2hHBDsp0tnlMkzZev/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/swuPbry2hHBDsp0tnlMkzZev/image.png\"></a></div><p>This is what the CodeSystem looks like (partial):<br>\n<a href=\"/user_uploads/10155/UTDw-0tFENbSR3ktqLfiLKRM/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/UTDw-0tFENbSR3ktqLfiLKRM/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/UTDw-0tFENbSR3ktqLfiLKRM/image.png\"></a></div><p>and this is the small codeSystem containing the type codes:<br>\n<a href=\"/user_uploads/10155/YiLmjo9fAAljAh5F2i4Itcdd/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/YiLmjo9fAAljAh5F2i4Itcdd/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/YiLmjo9fAAljAh5F2i4Itcdd/image.png\"></a></div><p>The error I'm getting when I run sushi is:<br>\n<code>error Code \"procedure\" is not defined for system ICD9IL.\n  File: C:\\FHIR\\IsraelCoreProfile - Current working\\input\\fsh\\ValueSet-icd9il-procedures.fsh\n  Line: 9</code></p>",
        "id": 278469413,
        "sender_full_name": "Kippi Bordowitz",
        "timestamp": 1649598892
    },
    {
        "content": "<p>That ValueSet definition looks off to me: you want the <code>type</code> property to <code>=</code> the value <code>\"procedure\"</code>.<br>\nBut the error you're seeing suggests your code system is not right -- is <code>procedure</code> a valid code in $icd9-il ?  It may be that you should define this property as string-typed?</p>",
        "id": 278502380,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1649643669
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span>  Sorry, I'm not sure I understand. The main CS ($icd9-il) refers to another CS (icd9-il-code-types) created specially for this purpose: 2 codes - not strings - that allow me to then define for each concept a property, as defined in the smaller CS. <br>\nWe have done this once before without a hitch. <br>\nhere: <br>\n<a href=\"/user_uploads/10155/6xZvPgJKZxjYP5bSGao_Z_m6/image.png\">image.png</a> <br>\n<a href=\"/user_uploads/10155/wkU6-yu7Rotf8UGTy87fYEjZ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/6xZvPgJKZxjYP5bSGao_Z_m6/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/6xZvPgJKZxjYP5bSGao_Z_m6/image.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/wkU6-yu7Rotf8UGTy87fYEjZ/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/wkU6-yu7Rotf8UGTy87fYEjZ/image.png\"></a></div>",
        "id": 278514599,
        "sender_full_name": "Kippi Bordowitz",
        "timestamp": 1649660454
    },
    {
        "content": "<p>also - is the line of code I'm using in the valueSet correct? Because that's something we've never tried</p>",
        "id": 278514799,
        "sender_full_name": "Kippi Bordowitz",
        "timestamp": 1649660631
    },
    {
        "content": "<p>The ValueSet definition is definitely not right.  It should be something like:</p>\n<div class=\"codehilite\"><pre><span></span><code>ValueSet: ICD9ILProcedures\nId: icd9il-procedures\nTitle: &quot;ICD9 IL Procedures&quot;\nDescription: &quot;codes of procedures from ICD9-IL&quot;\n* ^language = #he-IL\n* ^url = $icd9-il-procedures\n* ^status = #draft\n* ^version = &quot;0.7.0&quot;\n* codes from system $icd9-il where type = #procedure\n</code></pre></div>\n<p>which translates to</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"ValueSet\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"status\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"draft\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"ICD9ILProcedures\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"icd9il-procedures\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"title\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"ICD9 IL Procedures\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"description\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"codes of procedures from ICD9-IL\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"0.7.0\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://example.com/i9p\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"language\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"he-IL\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"nt\">\"compose\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"include\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"system\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://example.com/i9\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"filter\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"property\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"type\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"op\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"=\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"procedure\"</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 278554196,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1649684192
    },
    {
        "content": "<p>Note that the ^property.uri in your CodeSystem definition is <em>not</em> defining a system for the code-typed property. It is instead a unique identifier for the property itself.<br>\nWhen you define a property of type <code>code</code>, it is assumed to be a code from the same CodeSystem.  Since it is no, you have two choices -- define it to be of type Coding (which is cumbersome and verbose), or define it to be of type string (which is direct &amp; pragmatic, but not really \"the right way\").</p>",
        "id": 278554858,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1649684507
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> thanks. <br>\nI think you meant  <code>* codes from system $icd9-il where type = \"procedure\"</code>, no? (i.e. - <code>\"procedure\"</code> instead of <code>#procedure</code>).  <br>\nThen I redid the codeSystem like so:<br>\n<a href=\"/user_uploads/10155/aYCp9ksw_dt2UlBTbZC90eC1/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/aYCp9ksw_dt2UlBTbZC90eC1/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/aYCp9ksw_dt2UlBTbZC90eC1/image.png\"></a></div><p>It seems to work but how would I go about testing it? Like, there should be 31 concepts in this valueSet but obviously the valueset doesn't hold them in any way.</p>",
        "id": 278567717,
        "sender_full_name": "Kippi Bordowitz",
        "timestamp": 1649689641
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"380122\">@Kippi Bordowitz</span>.  Some of this is starting to go outside my realm of expertise -- as we're beyond the FSH part of this and into straight-up CodeSystem and ValueSet design.  One thing I've noted is that <code>CodeSystem</code> has a <a href=\"http://hl7.org/fhir/R4/codesystem-definitions.html#CodeSystem.filter\">filter</a> property on it, described as \"a filter that can be used in a value set compose statement when selecting concepts using a filter.\"  So, I wonder if you need to specify that as well.  You might try something like:</p>\n<div class=\"codehilite\"><pre><span></span><code>* ^filter.code = #type\n* ^filter.operator = #=\n* ^filter.value = &quot;the type to filter on:  procedure or diagnosis&quot;\n</code></pre></div>\n<p>But, again, this is outside my wheelhouse, so at this point I am guessing.  Since you're into CodeSystem design now, you might consider asking on <a class=\"stream\" data-stream-id=\"179202\" href=\"/#narrow/stream/179202-terminology\">#terminology</a> or <a class=\"stream\" data-stream-id=\"179252\" href=\"/#narrow/stream/179252-IG-creation\">#IG creation</a>.</p>",
        "id": 278612081,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1649708869
    },
    {
        "content": "<p>Every property defined in a CodeSystem can be used as a simple filter, so you could declare it like above, but it is not required.<br>\n<span class=\"user-mention\" data-user-id=\"380122\">@Kippi Bordowitz</span> If you're able to successfully generate the resources (ICD9-IL CodeSystem and the ValueSet), then you can test using the <code>$expand</code> operation.<br>\nI believe the igpublisher effectively does this when it generates the page for the ValueSet.  However, if you need/want to test by hand, then you can upload to our Ontoserver public sandbox (<a href=\"https://r4.ontoserver.csiro.au/fhir\">https://r4.ontoserver.csiro.au/fhir</a>) and test it there.</p>",
        "id": 278616102,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1649710837
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> thanks! <br>\nI made a small mistake while uploading the valueSet to our hapi-fhir server. once corrected, the testing seems to have worked. <br>\nI'm not familiar with $expand so I will have to read up on it.</p>",
        "id": 278666862,
        "sender_full_name": "Kippi Bordowitz",
        "timestamp": 1649754905
    }
]