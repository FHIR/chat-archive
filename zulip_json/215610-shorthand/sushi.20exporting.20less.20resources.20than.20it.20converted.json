[
    {
        "content": "<p>Hi. I have an FSH file that contains 11 Measures but sushi exports only 5 Measures in JSON. Sushi reports successful processing of all of the resources (0 Errors) but it says it exported less resources than it converted. Also, there's an error '(node:76987) Warning: Accessing non-existent property 'INVALID_ALT_NUMBER' of module exports inside circular dependency'. A quick Google search suggests is has something to do with Node and ANTLR. The Node version is v16.4.0.<br>\nThe FSH file is here: <a href=\"https://pastebin.com/crcDJX1Q\">https://pastebin.com/crcDJX1Q</a> Any thoughts on what may be happening?</p>",
        "id": 244614591,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1625167336
    },
    {
        "content": "<p>We've seen <code>INVALID_ALT_NUMBER</code> before.  As you found, it is related to ANTLR and happens for Node version 14 and up. Our understanding (and experience) so far, however, is that it is a harmless error.  I would guess it is not related to what you have found, but I have not had a chance to review your FSH yet -- so I guess I can't say for sure!</p>",
        "id": 244615833,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625168029
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> So, I downgraded to node@12 and reinstalled and reran sushi. The issue persists - meaning exporting less resources than it is converting. The FSH resources were converted by gosushi from existing resources if that matters.</p>",
        "id": 244617305,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1625168800
    },
    {
        "content": "<p>OK.  I'll try to take a look at your FSH soon.  It's a little difficult because my company blocks pastebin and dropbox and other things like that.  So I have to jump through a few hoops to get at it.  If you have GitHub and can put it in a <a href=\"https://gist.github.com/\">gist</a>, that might be easier for me to access.</p>",
        "id": 244617498,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625168902
    },
    {
        "content": "<p>Will do, one min.<br>\nHere you go: <a href=\"https://gist.github.com/citizenrich/f89a2062172a1530a8781b85e7b9a07f\">https://gist.github.com/citizenrich/f89a2062172a1530a8781b85e7b9a07f</a></p>",
        "id": 244617771,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1625169092
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"194192\">@Richard Stanley</span>.  I can't reproduce this.  I've used SUSHI 2.0.0 Beta 1, SUSHI 1.3.2, and FSH Online, and in all cases, I am getting 11 measures back (counting the actual JSON documents that are output).  For example, here is a permalink to this on FSH Online: <a href=\"https://fshschool.org/FSHOnline/#/share/3hcybDE\">https://fshschool.org/FSHOnline/#/share/3hcybDE</a></p>\n<p>I'm not sure why you would see different results.  Are you sure you're looking in the right folder (<code>fsh-generated/resources</code>)?</p>",
        "id": 244622702,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625171534
    },
    {
        "content": "<p>Thanks for having a look <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  Yes, I'm looking in the correct folder. I'm doing FSHOnly generation in an IG which is here: <a href=\"https://github.com/intrahealth/simple-hiv-ig\">https://github.com/intrahealth/simple-hiv-ig</a> It's very strange.</p>",
        "id": 244624809,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1625172514
    },
    {
        "content": "<p>Oh!  I see it now... Hmmm... Here is an example of what is going on.  In <code>library.fsh</code> you have:</p>\n<div class=\"codehilite\"><pre><span></span><code>Instance: HIVSimpleAgeGroup\nInstanceOf: Library\nUsage: #example\n// etc.\n</code></pre></div>\n<p>and in <code>measure.fsh</code> you have:</p>\n<div class=\"codehilite\"><pre><span></span><code>Instance: HIVSimpleAgeGroup\nInstanceOf: Measure\nUsage: #example\n// etc.\n</code></pre></div>\n<p>So... you have two instances w/ the same name here.  Since you can refer to instances by their name, SUSHI really prefers (and expects) unique names.  IIRC SUSHI keeps a dictionary of instances keyed by name, so if there are two w/ the same name, the last one in wins.  I think that's what is happening here.  If you avoid duplicate names, it should work as expected.  If you want the ids to be the same (between the library and the measure) then you'll just need to set the <code>id</code> using an assignment rule.  E.g.:</p>\n<div class=\"codehilite\"><pre><span></span><code>Instance: HIVSimpleAgeGroupLibrary\nInstanceOf: Library\nUsage: #example\n* id = &quot;HIVSimpleAgeGroup&quot;\n// etc.\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\"><pre><span></span><code>Instance: HIVSimpleAgeGroupMeasure\nInstanceOf: Measure\nUsage: #example\n* id = &quot;HIVSimpleAgeGroup&quot;\n// etc.\n</code></pre></div>",
        "id": 244626074,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625173160
    },
    {
        "content": "<p>It's unfortunate that SUSHI did not log an error for this case.  It really should, so I'll log a bug for that.</p>",
        "id": 244626232,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625173232
    },
    {
        "content": "<p>(Also, sorry that SUSHI wasted your time by not logging an error telling you what was wrong).</p>",
        "id": 244626454,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625173335
    },
    {
        "content": "<p>Thanks so much, <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> Yeah, ok, you mentioned that in another GitHub issue and I should have noticed it. Thanks!</p>",
        "id": 244627219,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1625173764
    }
]