[
    {
        "content": "<p>I have an npm question - a deep techie question. I'm running on windows, and I can run sushi from the Java IG Publisher using <code>cmd /c sushi . -o.</code>. But I can't run it from the command line - I get </p>\n<div class=\"codehilite\"><pre><span></span><code>&#39;sushi&#39; is not recognized as an internal or external command,\noperable program or batch file.\n</code></pre></div>\n<p>So that's weird. I can run it as npx fsh-sushi . -o .:</p>\n<div class=\"codehilite\"><pre><span></span><code>npx: installed 901 in 14.016s\ninfo  Running SUSHI v2.2.1 (implements FHIR Shorthand specification v1.2.0)\ninfo  Arguments:\ninfo    --out C:\\Users\\graha\ninfo    C:\\Users\\graha\nerror\n</code></pre></div>\n<p>This ends with the rather surprising error:</p>\n<div class=\"codehilite\"><pre><span></span><code>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\nSUSHI has adopted a new folder structure for FSH tanks (a.k.a. SUSHI projects).\nSupport for other folder structures is NO LONGER SUPPORTED.\nTo migrate to the new folder structure, make the following changes:\n  - rename .\\config.yaml to .\\sushi-config.yaml\n  - move .\\*.fsh files to .\\input\\fsh\\*.fsh\n  - if you used the &quot;template&quot; property in your config, remove it and manage .\\ig.ini directly\n  - if you used the &quot;history&quot; property in your config, remove it and manage .\\package-list.json directly\n  - ensure your .gitignore file is not configured to ignore the sources in their new locations\n  - add /fsh-generated to your .gitignore file to prevent SUSHI output from being checked into source control\n\nNOTE: After you make these changes, the default output folder for SUSHI will change to .\\fsh-generated.\n\nFor detailed migration instructions, see: https://fshschool.org/docs/sushi/migration/\n\n\nerror Migration to current SUSHI project structure is required. See above error message for details. Exiting.\n</code></pre></div>\n<p>That's surprising because there's no sushi config at all in that directory I ran it in (but it's a side point compared to my actual question which is around getting sushi to run at all).</p>\n<p>So that's when I run the java code from the command line, or from eclipse. But I also run it some a windows GUI app. When I do that - run the java code, that is - then neither <code>sushi</code> no npx fsh-sushi works.</p>\n<p>it's not really surprising that the first fails, since i can't run sushi from the command line - but why not? is there anything npm users know about how I can fix that?</p>\n<p>And when I run npx fhs-sushi from my GUI app, then I get </p>\n<div class=\"codehilite\"><pre><span></span><code>Run Sushi on C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master                   (00:00.0019)\nSushi: &#39;CALL &quot;C:\\Program Files\\nodejs\\\\node.exe&quot; &quot;C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-cli.js&quot; prefix -g&#39; is not recognized as an internal or external command, (00:00.0065)\nSushi: operable program or batch file.                                           (00:00.0066)\nSushi: spawn C:\\Windows\\system32\\cmd.exe= ENOENT                                 (00:00.0202)\nSushi couldn&#39;t be run. Complete output from running Sushi :                      (00:00.0211)\nNote: Check that Sushi is installed correctly (&quot;npm install -g fsh-sushi&quot;. On windows, get npm from https://www.npmjs.com/get-npm) (00:00.0211)\nException: Process exited with an error: 1 (Exit value: 1)                       (00:00.0212)\nPublishing Content Failed: Process exited with an error: 1 (Exit value: 1)       (00:00.0213)\n</code></pre></div>\n<p>That's a pretty weird error inside the npm sub-system right? As far as running the java code... I'm reproducing all the environment variables, and passing them to the java process, but I'm not running cmd (I don't think I need that?). So I'm at sea here - do the npm users here have any insight?</p>",
        "id": 263369449,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638399346
    },
    {
        "content": "<p>Do you know if you have sushi installed as a global module on your system?  To check this, run <code>npm list -g --depth 0</code>.  If you see <code>fsh-sushi</code> listed, then you have it installed globally.  If you do not see it listed, then run <code>npm install -g fsh-sushi</code> to install it.  After that, you <em>should</em> be able to run <code>sushi</code> from the command line.</p>\n<p>If you do have sushi installed globally but it's still not working from the command line, then the global npm modules are probably not in your path.  Maybe try out the solutions from this SO to see if they work? <a href=\"https://stackoverflow.com/questions/23860262/npm-global-install-does-not-add-packages-to-path-on-windows-8-1\">https://stackoverflow.com/questions/23860262/npm-global-install-does-not-add-packages-to-path-on-windows-8-1</a></p>\n<p>As for the issue from the GUI -- I'm not really sure about that one...</p>",
        "id": 263370605,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1638400014
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>C:\\Users\\graha&gt;npm list -g --depth 0\nC:\\Users\\graha\\AppData\\Roaming\\npm\n`-- fsh-sushi@2.2.0\n</code></pre></div>",
        "id": 263370679,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638400062
    },
    {
        "content": "<p>but the stack overflow link sorted out the command line issue. I'll try the other again</p>",
        "id": 263371171,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638400365
    },
    {
        "content": "<p>and I get further from my GUI app too. But... there's  a weird thing happening. Running from Eclipse directly:</p>\n<div class=\"codehilite\"><pre><span></span><code>Run Sushi on C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master                   (00:00.0018)\nSushi: info  Running SUSHI v2.2.1 (implements FHIR Shorthand specification v1.2.0) (00:00.0581)\nSushi: info  Arguments:                                                          (00:00.0582)\nSushi: info    --out C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master           (00:00.0582)\nSushi: info    C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master                 (00:00.0583)\nSushi: info  Using configuration file: C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master\\sushi-config.yaml (00:00.0590)\nSushi: info  Importing FSH text...                                               (00:00.0600)\nSushi: info  Preprocessed 32 documents with 48 aliases.                          (00:00.0883)\nSushi: info  Imported 140 definitions and 108 instances.                         (00:01.0033)\nSushi: info  Checking local cache for hl7.fhir.us.core#4.0.0...                  (00:01.0034)\nSushi: info  Found hl7.fhir.us.core#4.0.0 in local cache.                        (00:01.0081)\nSushi: info  Loaded package hl7.fhir.us.core#4.0.0                               (00:01.0081)\nSushi: info  Checking local cache for hl7.fhir.r4.core#4.0.1...                  (00:01.0081)\nSushi: info  Found hl7.fhir.r4.core#4.0.1 in local cache.                        (00:01.0606)\nSushi: info  Loaded package hl7.fhir.r4.core#4.0.1                               (00:01.0606)\nSushi: (node:19764) Warning: Accessing non-existent property &#39;INVALID_ALT_NUMBER&#39; of module exports inside circular dependency (00:01.0607)\nSushi: (Use `node --trace-warnings ...` to show where the warning was created)   (00:01.0607)\nSushi: (node:19764) Warning: Accessing non-existent property &#39;INVALID_ALT_NUMBER&#39; of module exports inside circular dependency (00:01.0607)\nSushi: info  Converting FSH to FHIR resources...                                 (00:01.0652)\nSushi: info  Converted 42 FHIR StructureDefinitions.                             (00:18.0815)\nSushi: info  Converted 2 FHIR CodeSystems.                                       (00:18.0821)\nSushi: info  Converted 96 FHIR ValueSets.                                        (00:19.0150)\nSushi: info  Converted 108 FHIR instances.                                       (00:24.0349)\nSushi: info  Exporting FHIR resources as JSON...                                 (00:24.0349)\nSushi: info  Exported 248 FHIR resources as JSON.                                (00:25.0319)\nSushi: info  Assembling Implementation Guide sources...                          (00:25.0319)\nSushi: info  Generated ImplementationGuide-hl7.fhir.us.mcode.json                (00:25.0329)\nSushi: info  Assembled Implementation Guide sources; ready for IG Publisher.     (00:25.0329)\nSushi:                                                                           (00:25.0330)\nSushi: ========================= SUSHI RESULTS ===========================       (00:25.0330)\nSushi: |  -------------------------------------------------------------  |       (00:25.0330)\nSushi: | |    Profiles   |  Extensions  |   Logicals   |   Resources   | |       (00:25.0330)\nSushi: | |-------------------------------------------------------------| |       (00:25.0331)\nSushi: | |      28       |      14      |      0       |       0       | |       (00:25.0331)\nSushi: |  -------------------------------------------------------------  |       (00:25.0331)\nSushi: |  -------------------------------------------------------------  |       (00:25.0331)\nSushi: | |      ValueSets     |    CodeSystems    |     Instances      | |       (00:25.0332)\nSushi: | |-------------------------------------------------------------| |       (00:25.0332)\nSushi: | |         96         |         2         |        108         | |       (00:25.0332)\nSushi: |  -------------------------------------------------------------  |       (00:25.0333)\nSushi: |                                                                 |       (00:25.0333)\nSushi: ===================================================================       (00:25.0333)\nSushi: | Ex-clam-ation point!                   0 Errors      0 Warnings |       (00:25.0333)\nSushi: ===================================================================       (00:25.0334)\n</code></pre></div>",
        "id": 263373537,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638401992
    },
    {
        "content": "<p>running from my gui:</p>",
        "id": 263373543,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638401999
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Run Sushi on C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master                   (00:00.0018)\nSushi: info  Running SUSHI v2.2.1 (implements FHIR Shorthand specification v1.2.0) (00:00.0573)\nSushi: info  Arguments:                                                          (00:00.0574)\nSushi: info    --out C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master           (00:00.0574)\nSushi: info    C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master                 (00:00.0575)\nSushi: info  Using configuration file: C:\\work\\org.hl7.fhir.igs\\HL7-fhir-mCODE-ig#master\\sushi-config.yaml (00:00.0619)\nSushi: info  Importing FSH text...                                               (00:00.0629)\nSushi: info  Preprocessed 32 documents with 48 aliases.                          (00:00.0913)\nSushi: info  Imported 140 definitions and 108 instances.                         (00:01.0068)\nSushi: info  Checking local cache for hl7.fhir.us.core#4.0.0...                  (00:01.0069)\nSushi: info  Did not find hl7.fhir.us.core#4.0.0 in local cache.                 (00:01.0069)\nSushi: info  Checking local cache for hl7.fhir.r4.core#4.0.1...                  (00:01.0070)\nSushi: info  Did not find hl7.fhir.r4.core#4.0.1 in local cache.                 (00:01.0070)\nSushi: (node:36160) Warning: Accessing non-existent property &#39;INVALID_ALT_NUMBER&#39; of module exports inside circular dependency (00:01.0071)\nSushi: (Use `node --trace-warnings ...` to show where the warning was created)   (00:01.0072)\nSushi: (node:36160) Warning: Accessing non-existent property &#39;INVALID_ALT_NUMBER&#39; of module exports inside circular dependency (00:01.0072)\nSushi: info  Downloading hl7.fhir.us.core#4.0.0...                               (00:01.0095)\nSushi: info  Downloading hl7.fhir.r4.core#4.0.1...                               (00:01.0096)\nSushi: error Failed to load hl7.fhir.us.core#4.0.0: getaddrinfo EAI_FAIL packages2.fhir.org (00:01.0097)\nSushi: error Failed to load hl7.fhir.r4.core#4.0.1: getaddrinfo EAI_FAIL packages2.fhir.org (00:01.0097)\nSushi: error Valid StructureDefinition resource not found. The FHIR package in your local cache may be corrupt. Local FHIR cache can be found at &lt;home-directory&gt;/.fhir/packages. For more information, see https://wiki.hl7.org/FHIR_Package_Cache#Location. (00:01.0135)\n</code></pre></div>",
        "id": 263373640,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638402045
    },
    {
        "content": "<p>any ideas what's going on here?</p>",
        "id": 263373681,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638402078
    },
    {
        "content": "<p>I'm just taking a WAG, but I wonder if your current working directory and environment variables, particularly PATH, differ when launched from the command line vs. the GUI. Also, whether the launched process inherits those, or go back to some defaults.</p>",
        "id": 263375822,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1638403424
    },
    {
        "content": "<p>I clone all the environment variables. But yes, they are from the launching process, though it doesn't do anything different</p>",
        "id": 263479234,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638469063
    },
    {
        "content": "<p>That's definitely odd... When SUSHI tries to load packages, it tries first from <code>packages.fhir.org</code>.  If that produces an error, it swallows it and tries <code>packages2.fhir.org</code>.  If that produces an error, it runs it up the stack.  That's why you see the error for <code>packages2.fhir.org</code> even though I'd guess it's actually happening on <code>packages.fhir.org</code> first.  Are the network parameters any different when running in the GUI?  Might it be using a different set of certificates?  Or different DNS?  Or anything like that?  Does Java GUI have more restrictive security that might be aborting networking attempts from a forked process (which is I think how IGP runs SUSHI)?</p>",
        "id": 263495772,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1638476702
    }
]