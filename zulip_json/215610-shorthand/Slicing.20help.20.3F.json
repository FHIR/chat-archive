[
    {
        "content": "<p>I need to slice Reference.identifier into 4 slices. SUSHI does not give any validation error on this, but IG Publisher does:</p>\n<div class=\"codehilite\"><pre><span></span><code>Generating Snapshots                                                             (00:36.0602)\nUnable to generate snapshot for http://hl7.no/fhir/StructureDefinition/no-domain-vitalsignsobservation-subjectreference: Attempt to a slice an element that does not repeat: Reference.identifier/Reference.identifier from http://hl7.org/fhir/StructureDefinition/Reference in http://hl7.no/fhir/StructureDefinition/no-domain-vitalsignsobservation-subjectreference, at element Reference.identifier (slice = FNR, DNR, HNR, FHN)\n</code></pre></div>\n<p>FSH:</p>\n<div class=\"codehilite\"><pre><span></span><code>* identifier ^slicing.discriminator.type = #value\n* identifier ^slicing.discriminator.path = &quot;system&quot;\n* identifier ^slicing.rules = #open\n* identifier contains\n    FNR 0..1 and\n    DNR 0..1 and\n    HNR 0..1 and\n    FHN 0..1\n</code></pre></div>\n<p>What changes are needed in FSH ?</p>",
        "id": 250617806,
        "sender_full_name": "Janaka Peiris",
        "timestamp": 1629897381
    },
    {
        "content": "<p>In some cases around slicing, SUSHI has a more hands-off approach and allows you to specify some things that may not be technically correct/allowed.  It's my understanding that FHIR only allows you to slice lists (upper cardinality &gt; 1) or choice elements (elements ending in <code>[x]</code>).  This is likely why the IG publisher is complaining, because <code>Reference.identifier</code> is neither a list nor a choice.  I think I recall some conversations where others have asked for single-cardinality non-choice elements to be supported, so you could try to do some searching to find those threads if you want to add your voice to them.</p>\n<p>Depending on what you want to do and where you need to do it, you may have a few choices:</p>\n<ul>\n<li>Do the slicing in the profiles where the reference is used (although this only works if the reference path itself is a list -- and I'm not sure that happens much with references).</li>\n<li>Create a different profile on Reference for each identifier type you want to support and then constrain the reference uses to only allow those profiles (but then you're not allowing other, non-conforming reference types).</li>\n<li>Use invariants to specify whatever conformance rules you were going to try to specify in the slices.</li>\n</ul>",
        "id": 250621047,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1629898779
    },
    {
        "content": "<p>Just for reference (in case it might be helpful to anyone), there was another discussion about slicing non-repeating non-polymorphic elements: <a href=\"#narrow/stream/179252-IG-creation/topic/Slicing.20non-repeating.20elements\">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/Slicing.20non-repeating.20elements</a></p>",
        "id": 250632481,
        "sender_full_name": "Corey Spears",
        "timestamp": 1629903698
    },
    {
        "content": "<p>Ah yes, that's the one I was thinking of.  Thanks, <span class=\"user-mention\" data-user-id=\"191529\">@Corey Spears</span>!</p>",
        "id": 250640293,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1629907280
    }
]