[
    {
        "content": "<p>Hi Fsh-folks. I've gofsh'ed my IG and now I have an error on the QA page I don't really understand. The error is the following: <code> The element Extension.url has a fixed of type uri, which is not in the list of allowed types ([http://hl7.org/fhirpath/System.String]) </code></p>\n<p>The QA page can be found here: <a href=\"https://build.fhir.org/ig/hl7dk/dk-core/branches/going-fshing/qa.html#_scratch_ig-build-temp-6H6E5O_repo_fsh-generated_resources_StructureDefinition-dk-core-RegionalSubDivisionCodes\">https://build.fhir.org/ig/hl7dk/dk-core/branches/going-fshing/qa.html#_scratch_ig-build-temp-6H6E5O_repo_fsh-generated_resources_StructureDefinition-dk-core-RegionalSubDivisionCodes</a> and the source is here: <a href=\"https://github.com/hl7dk/dk-core/blob/going-fshing/input/fsh/extensions.fsh\">https://github.com/hl7dk/dk-core/blob/going-fshing/input/fsh/extensions.fsh</a> </p>\n<p>From the sources I can't really understand where that error is comming from. Help would be much appreciated (<span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> ).</p>",
        "id": 229020458,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1614976576
    },
    {
        "content": "<p>Hi Jens, I have the same error, and it doesn't seem to be related to SUSHI or FSH. It appeared somewhere around IG Publisher version 1.1.60. At that time, I didn't change SUSHI, just the IG Publisher - and <em>poof</em> - all of a sudden I had 60+ instances of this error. <br>\nIf you look at the latest build of US Core IG, they have the same error, and they aren't using SUSHI for their StructureDefinitions.</p>",
        "id": 229122856,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1615059316
    },
    {
        "content": "<p><a href=\"https://github.com/HL7/fhir-ig-publisher/issues/240\">https://github.com/HL7/fhir-ig-publisher/issues/240</a></p>",
        "id": 229123677,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1615060078
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> you might want to look into this</p>",
        "id": 229175121,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1615111629
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/215610-shorthand/topic/The.20element.20Extension.2Eurl.20has.20a.20fixed.20of.20type.20uri/near/229020458\">said</a>:</p>\n<blockquote>\n<p>Hi Fsh-folks. I've gofsh'ed my IG and now I have an error on the QA page I don't really understand. The error is the following: <code> The element Extension.url has a fixed of type uri, which is not in the list of allowed types ([http://hl7.org/fhirpath/System.String]) </code></p>\n<p>The QA page can be found here: <a href=\"https://build.fhir.org/ig/hl7dk/dk-core/branches/going-fshing/qa.html#_scratch_ig-build-temp-6H6E5O_repo_fsh-generated_resources_StructureDefinition-dk-core-RegionalSubDivisionCodes\">https://build.fhir.org/ig/hl7dk/dk-core/branches/going-fshing/qa.html#_scratch_ig-build-temp-6H6E5O_repo_fsh-generated_resources_StructureDefinition-dk-core-RegionalSubDivisionCodes</a> and the source is here: <a href=\"https://github.com/hl7dk/dk-core/blob/going-fshing/input/fsh/extensions.fsh\">https://github.com/hl7dk/dk-core/blob/going-fshing/input/fsh/extensions.fsh</a> </p>\n<p>From the sources I can't really understand where that error is comming from. Help would be much appreciated (<span class=\"user-mention silent\" data-user-id=\"191469\">Chris Moesel</span> ).</p>\n</blockquote>\n<p>I have the same issue after updating IG publisher. FSH generated a fixedUri by default which generates the error in IG publisher.<br>\nCan't say  what's right though.</p>",
        "id": 229281461,
        "sender_full_name": "Torben M. Hagensen",
        "timestamp": 1615201675
    },
    {
        "content": "<p>I don't know what's going on either -- but <code>fixedUri</code> should be appropriate since <code>Extension.url</code> is defined as having the <code>uri</code> type: <a href=\"/user_uploads/10155/l4BZv1fMKRAJGPtF8EBjRwcs/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/l4BZv1fMKRAJGPtF8EBjRwcs/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/l4BZv1fMKRAJGPtF8EBjRwcs/image.png\"></a></div>",
        "id": 229297829,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1615210229
    },
    {
        "content": "<p>This <em>looks</em> like a problem in the publisher, since I just started getting these errors too, and:</p>\n<ul>\n<li>Internally the specs use .fixedValueUri for extension urls, so that is the correct type.</li>\n<li>The error seems to be indicating the type must be <code>http://hl7.org/fhirpath/System.String</code>, which is the backing type for uri.</li>\n</ul>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , thoughts?</p>",
        "id": 229383113,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1615241149
    },
    {
        "content": "<p>another data point... This sushi snippet from my patient profile produces no publisher errors:</p>\n<div class=\"codehilite\"><pre><span></span><code>Alias: PatientBirthPlaceExtension = http://hl7.org/fhir/StructureDefinition/patient-birthPlace\n* extension contains PatientBirthPlaceExtension named PatBirthPlaceExt 0..1 MS\n// * extension[PatBirthPlaceExt].valueAddress.country MS\n</code></pre></div>\n<p>but if I uncomment the last line, I get the error</p>\n<div class=\"codehilite\"><pre><span></span><code>The element Patient.extension:PatBirthPlaceExt.url has a fixed of type uri, which is not in the list of allowed types ([http://hl7.org/fhirpath/System.String])\n</code></pre></div>",
        "id": 229508772,
        "sender_full_name": " Bob Milius",
        "timestamp": 1615308135
    },
    {
        "content": "<p>Doing a little digging, and just want to put my thoughts down in case it saves anyone time.</p>\n<ul>\n<li>This appears to be caused by changes in the <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/\">FHIR Core</a> library.</li>\n<li>I believe this appeared in either <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/commits/5.3.3\">5.3.3</a> or <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/commits/5.3.4\">5.3.4</a>, when <code>SD_VALUE_TYPE_IILEGAL</code> was added.</li>\n<li>With the understanding that this is my first time looking through this code...<ul>\n<li>In <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/dfc59882cac54d06637f765c587c05b45f3e58cd/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/instance/type/StructureDefinitionValidator.java#L150-L164\">StructureDefinitionValidator.java</a>, these lines look like the change that we are looking for</li>\n<li><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/dfc59882cac54d06637f765c587c05b45f3e58cd/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/instance/type/StructureDefinitionValidator.java#L158\">This line</a> in particular is the error that is being logged.</li>\n<li>However, the Structure Definitions I'm getting errors on (exported by FSH) do not have a snapshot section, only a differential.</li>\n</ul>\n</li>\n</ul>\n<p>Having never played with the validator code, I am loathe to start tinkering (or even set up my environment to do so).  That said, I don't know how much more I can learn from just browsing the source.</p>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> is my reading of this correct?  If so, is there a change to be made to the validator and/or should FSH be exporting a snapshot in addition to the differential?</p>",
        "id": 229517528,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1615311083
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span> im pretty sure that the differential made by fsh is sufficient. My guess would be that it is the generation of the snapshot, but I haven't had time to have a look yet</p>",
        "id": 229560373,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1615326702
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span>!  As I mentioned, I just started looking at commits around when the error started appearing.  I know how busy people are, so was trying to think on ways around it.  Cheers!</p>",
        "id": 229680064,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1615389928
    },
    {
        "content": "<p>Re-raised the issue here: <a href=\"#narrow/stream/179252-IG-creation/topic/BUG.3A.20The.20element.20Extension.2Eurl.20has.20a.20fixed.20of.20type.20uri\">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/BUG.3A.20The.20element.20Extension.2Eurl.20has.20a.20fixed.20of.20type.20uri</a> so I could get Mark's attention too.</p>",
        "id": 230527433,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1615906846
    },
    {
        "content": "<p>Alright so, I think this is related to a commit made on March 2-3 (14dc86e3a2f895498d5a63aa8baefa0c5283fc85)</p>",
        "id": 231088410,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187233
    },
    {
        "content": "<p>There was code added in the validation process to add the message you are encountering</p>",
        "id": 231088489,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187261
    },
    {
        "content": "<p>specifically:<br>\n<code>    // in a snapshot, we validate that fixedValue, pattern, and defaultValue, if present, are all of the right type\n    if (snapshot &amp;&amp; element.getIdBase().contains(\".\")) {\n      if (rule(errors, IssueType.EXCEPTION, stack.getLiteralPath(), !typeCodes.isEmpty() || element.hasChild(\"contentReference\"), I18nConstants.SD_NO_TYPES_OR_CONTENTREF, element.getIdBase())) {\n        Element v = element.getNamedChild(\"defaultValue\");\n        if (v != null) {\n          rule(errors, IssueType.EXCEPTION, stack.push(v, -1, null, null).getLiteralPath(), typeCodes.contains(v.fhirType()), I18nConstants.SD_VALUE_TYPE_IILEGAL, element.getIdBase(), \"defaultValue\", v.fhirType(), typeCodes);\n        }\n        v = element.getNamedChild(\"fixed\");\n        if (v != null) {\n          rule(errors, IssueType.EXCEPTION, stack.push(v, -1, null, null).getLiteralPath(), typeCodes.contains(v.fhirType()), I18nConstants.SD_VALUE_TYPE_IILEGAL, element.getIdBase(), \"fixed\", v.fhirType(), typeCodes);\n        }\n        v = element.getNamedChild(\"pattern\");\n        if (v != null) {\n          rule(errors, IssueType.EXCEPTION, stack.push(v, -1, null, null).getLiteralPath(), typeCodes.contains(v.fhirType()), I18nConstants.SD_VALUE_TYPE_IILEGAL, element.getIdBase(), \"pattern\", v.fhirType(), typeCodes);\n        }\n      }\n    }</code></p>",
        "id": 231088535,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187283
    },
    {
        "content": "<p>That is the only time this message is used in the core.</p>",
        "id": 231088629,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187339
    },
    {
        "content": "<p><code>SD_VALUE_TYPE_IILEGAL = The element {0} has a {1} of type {2}, which is not in the list of allowed types ({3})</code></p>",
        "id": 231088637,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187342
    },
    {
        "content": "<p>This is in the StructureDefinitionValidator</p>",
        "id": 231088763,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187396
    },
    {
        "content": "<p>actually, I'm giong to post this all in the other thread Lloyd made</p>",
        "id": 231088832,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187433
    }
]