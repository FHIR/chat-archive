[
    {
        "content": "<p>Is there already a docker container that I can volume-mount a local dir into and have sushi + IG Publisher both run and do their thing? (i.e., with Java + Jekyll/ruby + node all installed/configured?) I can make one, but figured I'd check here first.</p>",
        "id": 207283157,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1597768786
    },
    {
        "content": "<p>OK, I put together a dev wrapper at <a href=\"https://github.com/FHIR/auto-ig-builder/tree/master/images/ig-publisher-base\">https://github.com/FHIR/auto-ig-builder/tree/master/images/ig-publisher-base</a>. Demo: coming...</p>",
        "id": 207463783,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1597872586
    },
    {
        "content": "<p>Quick question: if I run <code>_genonce.sh</code> before ig.ini exists, the publisher fails. I need to manually run <code>sushi</code> first, and <em>then</em> <code>_genonce.sh</code> succeeds. Is this expected?</p>",
        "id": 207463933,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1597872686
    },
    {
        "content": "<p>OK, wrapped in docker for local dev:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ git clone -b move-to-fsh https://github.com/hl7/smart-app-launch\n$ cd smart-app-launch\n\n$ docker run \\\n    --rm -it \\\n    -v $(pwd):/home/publisher/ig \\\n    hl7fhir/ig-publisher-base\n\n$ sushi # This shouldn&#39;t be necessary but currently it is, the first time\n$ _updatePublisher.sh # If you haven&#39;t done it before\n\n$ _genonce.sh\n</code></pre></div>\n\n\n<p>(<span class=\"user-mention\" data-user-id=\"191414\">@Dan Gottlieb</span> would love to make sure this works for you; I don't have a good way to test on Mac OS.)</p>",
        "id": 207471483,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1597878117
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span>  The image works great on Mac! Building the Bulk Data IG fails though, I think because of incompatibilities with the latest version of the publisher that I'll need to track down...</p>",
        "id": 207527109,
        "sender_full_name": "Dan Gottlieb",
        "timestamp": 1597933169
    },
    {
        "content": "<blockquote>\n<p>Quick question: if I run <a href=\"http://_genonce.sh\">_genonce.sh</a> before ig.ini exists, the publisher fails. I need to manually run sushi first, and then <a href=\"http://_genonce.sh\">_genonce.sh</a> succeeds. Is this expected?</p>\n</blockquote>\n<p>Yeah, I think that's expected if you run it using <code>_genonce.sh</code>.  On the HL7 auto-build, it's not necessary because that runs the publisher with the <code>-auto-ig-build</code> flag -- and Grahame does some special magic to accommodate the missing <code>ig.ini</code> when that flag is used.  If you updated the image to call the publisher directly (w/ <code>-auto-ig-build</code>) it would work -- but I don't know if there are any additional undesirable side effects in that case.</p>",
        "id": 207555253,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1597947064
    },
    {
        "content": "<p>Sorry, forgot to tag you, <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span>.  Don't know if you follow this channel regularly.</p>",
        "id": 207555331,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1597947116
    },
    {
        "content": "<p>Thanks Chris! I guess I'll leave this as-is for the moment, but it's good to know I can emulate the auto-build behavior if needed.</p>",
        "id": 207556145,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1597947529
    },
    {
        "content": "<p>there's several side effects from running it with the -auto-ig-build flag, and I certainly wouldn't want to see people do that regularly. But I don't understand this anyway - if the problem is with <a href=\"http://_genonce.sh\">_genonce.sh</a>, and you work around it by running the Ig publisher directly, you don't need the -auto-ig-build flag when you do that</p>",
        "id": 207573829,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597957147
    },
    {
        "content": "<p>The problem with <code>_genonce.sh</code> is that it does not use the <code>-auto-ig-build</code> flag.  The workaround is to run the IG Publisher directly <em>with the -auto-ig-build flag</em> -- so if that's not a recommended approach for end-users, then there is no workaround except to run SUSHI before you run the publisher.  OR to manually manage the ig.ini file instead of having SUSHI generate it (which, really, isn't that much of a lift).</p>",
        "id": 207574580,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1597957575
    },
    {
        "content": "<p>I don't understand then. Why is this required?</p>",
        "id": 207575471,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597958099
    },
    {
        "content": "<p>When run normally, the IG publisher expects an <code>ig.ini</code> file at the root -- and checks for that first thing (before running SUSHI).  But some FSH projects depend on SUSHI to <em>generate</em> the <code>ig.ini</code> file -- so it won't be there when the IG Publisher checks for it.  This causes a problem for those projects -- requiring them to run SUSHI manually first, and then run the IG Publisher (which happily finds the <code>ig.ini</code> now and then runs SUSHI <em>again</em>).</p>",
        "id": 207577574,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1597959513
    },
    {
        "content": "<p>I don't see this. I take an existing guide, and delete everything except for the fsh directory, and run the publisher on it directly, and it all succeeds ok</p>",
        "id": 207584239,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597964354
    },
    {
        "content": "<p>If I understand well, the problem is that the _genOnce does not work when there is no ig.ini created.</p>",
        "id": 207597504,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597980715
    },
    {
        "content": "<p>if that is true, that is by design. _genOnce is not to setup a new IG (create ig.ini, etc). _genOnce is to build the IG.</p>",
        "id": 207597545,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597980750
    },
    {
        "content": "<p>I don't think we should mix the 2 modes of operation</p>\n<ol>\n<li>setup a new IG, (re)create the entire ig.ini etc</li>\n<li>update content like a page or an example</li>\n</ol>",
        "id": 207597566,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597980816
    },
    {
        "content": "<p>If my understanding of the challenge is correct, then I don't think this is a problem.</p>",
        "id": 207597723,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597980988
    },
    {
        "content": "<p>(i have suggested elsewhere to separate the activities of setting up an ig from sushi vs parsing fsh)</p>",
        "id": 207597771,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597981080
    },
    {
        "content": "<p>why does _genOnce care about the ig.ini?</p>",
        "id": 207601706,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597987805
    },
    {
        "content": "<p>_genonce simply does java -jar -ig ig.ini</p>",
        "id": 207602447,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597989142
    },
    {
        "content": "<p>it cares that it exists, not the content</p>",
        "id": 207602472,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597989196
    },
    {
        "content": "<p>why does it do that?</p>",
        "id": 207602561,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597989329
    },
    {
        "content": "<p>it should do java -jar -ig .</p>",
        "id": 207602575,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597989359
    },
    {
        "content": "<p>i don't know if there's a reason. we can wait for Lloyd to confirm, if there was any. but perhaps we can change  that.</p>",
        "id": 207603490,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597990808
    },
    {
        "content": "<p>i didn't know that -ig.ini . worked - it does. Will it cause any issues if we change it?</p>",
        "id": 207603509,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597990921
    },
    {
        "content": "<p>i.e. what could go wrong if we change it? Perhaps that would be an issue if someone had 2 ini files in the root folder (...why ever?).</p>",
        "id": 207603566,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597991012
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> if you agree you can merge this  PR<br>\n<a href=\"https://github.com/FHIR/sample-ig/pull/40\">https://github.com/FHIR/sample-ig/pull/40</a></p>",
        "id": 207603921,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597991618
    },
    {
        "content": "<p>merged. Can't be more than on functional ini file that matters</p>",
        "id": 207605028,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597993077
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> and <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> -- and my apologies for misunderstanding who is requiring what where and when!</p>",
        "id": 207624642,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1598010167
    },
    {
        "content": "<p>Awesome! And in the process I learned where sushi sources these _gen*.sh scripts from ;-)</p>",
        "id": 207626613,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1598011831
    },
    {
        "content": "<p>The ig.ini points to the ig.  The ig.ini is in a predictable place with a predictable name.  The ig is not.  We don't want the .bat files changing from project to project.</p>",
        "id": 207784313,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598205717
    },
    {
        "content": "<p>I don't understand that comment but the ig.ini has turned out not to be a predictable place</p>",
        "id": 207791570,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598217064
    },
    {
        "content": "<p>The publisher requires the ig.ini to be in the root folder, no?</p>",
        "id": 207804474,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598239777
    },
    {
        "content": "<p>Did this end up resulting in a change? For a clean build of a FSH IG, are the required steps still run sushi before running _genonce (which runs sushi again)? Is there an option I can pass to _genonce to supress  running sushi the second time?</p>",
        "id": 208738153,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1598989675
    },
    {
        "content": "<p>_genonce isn't running sushi.  The IG publisher finds a fsh folder and then runs sushi.  you don't have to run sushi the first time if you provide an ig.ini in the root directory that points to the ig and defines the template to use.</p>",
        "id": 208738507,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598989842
    },
    {
        "content": "<p>Right, should have been clearer. Is there an option I can pass to _genonce that will get passed on to the publisher to suppress the publisher from running sushi the second time?</p>",
        "id": 208738710,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1598989938
    },
    {
        "content": "<p>don't name your fsh folder \"fsh\".  i'm pretty sure that's how the ig publisher detects that sushi should run</p>",
        "id": 208738763,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598989974
    },
    {
        "content": "<p>i think that the easiest option for now is to create/check in the ig.ini file so that it is there from the beginning.  then you don't have to run sushi the first time.</p>",
        "id": 208739102,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598990152
    },
    {
        "content": "<p>so your source repository would have the bat/sh scripts, the fsh directory, and the ig.ini file</p>",
        "id": 208739189,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598990176
    },
    {
        "content": "<p>hmm, just found a -no-sushi parameter for the publisher.</p>",
        "id": 208739227,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1598990191
    },
    {
        "content": "<p>really?  cool!</p>",
        "id": 208739240,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598990204
    },
    {
        "content": "<p>Yay! It works:</p>\n<div class=\"codehilite\"><pre><span></span><code>./_genonce.sh -no-sushi\n</code></pre></div>",
        "id": 208739428,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1598990289
    },
    {
        "content": "<p>Thank you for this image <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> . This really helps to get an environment ready to build FSH items within a Container using Dev Containers in VSCode.</p>",
        "id": 233373353,
        "sender_full_name": "Larry Shields",
        "timestamp": 1617736615
    },
    {
        "content": "<p>Sure thing! I haven't don't much (anything) to keep it up to date, so let me know if there are any issues! (Or better yet, propose a fix in a PR ;-))</p>",
        "id": 233374868,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1617737292
    },
    {
        "content": "<p>Here is that docker image I shared at DevDays (I added a wrapper script called <code>nori</code> ) - <a href=\"https://github.com/Vermonster/shorthand-docker\">https://github.com/Vermonster/shorthand-docker</a> </p>\n<p>It has all the requirements to run sushi and IG Publisher. The idea is to help local development for people who don't want to install all the system requirements, but the image could also be used as a basis for CI/CD.</p>",
        "id": 242412239,
        "sender_full_name": "Brian Kaney",
        "timestamp": 1623451366
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> - the <a href=\"https://github.com/FHIR/auto-ig-builder/blob/master/images/ig-publisher-base/Dockerfile\">ig-publisher-base image</a> seems to be exhibiting strange behavior. It doesn't actually update SUSHI until the <code>ENTRYPOINT</code>, so trying to build on top of the image and <code>RUN sushi .</code> during the build results in an older version of SUSHI being used:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>docker run --rm -it hl7fhir/ig-publisher-base:latest\n. . .\npublisher@92e879a8d4da:~/ig$ sushi --version\nSUSHI v2.2.0 <span class=\"o\">(</span>implements FHIR Shorthand specification v1.2.0<span class=\"o\">)</span>\n</code></pre></div>\n<p>vs</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>docker build -t new-ig .\n<span class=\"o\">[</span>+<span class=\"o\">]</span> Building <span class=\"m\">11</span>.3s <span class=\"o\">(</span><span class=\"m\">12</span>/15<span class=\"o\">)</span>\n. . .\n <span class=\"o\">=</span>&gt; <span class=\"o\">[</span>ig-publisher <span class=\"m\">1</span>/7<span class=\"o\">]</span> FROM docker.io/hl7fhir/ig-publisher-base:lates  <span class=\"m\">0</span>.0s\n <span class=\"o\">=</span>&gt; CACHED <span class=\"o\">[</span>ig-publisher <span class=\"m\">2</span>/7<span class=\"o\">]</span> WORKDIR /home/publisher/ig               <span class=\"m\">0</span>.0s\n <span class=\"o\">=</span>&gt; CACHED <span class=\"o\">[</span>ig-publisher <span class=\"m\">3</span>/7<span class=\"o\">]</span> COPY src/. .                             <span class=\"m\">0</span>.0s\n <span class=\"o\">=</span>&gt; ERROR <span class=\"o\">[</span>ig-publisher <span class=\"m\">5</span>/7<span class=\"o\">]</span> RUN sushi .                               <span class=\"m\">8</span>.8s\n------\n &gt; <span class=\"o\">[</span>ig-publisher <span class=\"m\">5</span>/7<span class=\"o\">]</span> RUN sushi .:\n<span class=\"c1\">#12 2.000 info  Running SUSHI v2.0.1 (implements FHIR Shorthand specification v1.2.0)</span>\n</code></pre></div>",
        "id": 261675277,
        "sender_full_name": "Matt Rouhana",
        "timestamp": 1637083326
    }
]