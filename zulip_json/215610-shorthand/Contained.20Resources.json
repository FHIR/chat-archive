[
    {
        "content": "<p>Is there support for contained resources?</p>",
        "id": 188108708,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1581602730
    },
    {
        "content": "<p>That's a good question...  We don't have tests for that.  As you know, <code>contained</code> has type <code>Resource</code> -- so I suspect that maybe SUSHI would only allow you to set fields that are on <code>Resource</code> (if you defined the contained resources inline in the instance).  We probably need to come up w/ a syntax that would allow the author to indicate a more specific type (than <code>Resource</code>) when doing that.  We also could/should consider allowing authors to define contained resources as separate instances (using <code>Instance:</code> keyword) and then reference them as a contained resource in another instance.</p>",
        "id": 188109622,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1581603419
    },
    {
        "content": "<p>I didn't mean to go as far to allow collaborative work. I was wondering how to reference them since we cannot put Reference(#contained_resource_01)</p>",
        "id": 188110959,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1581604363
    },
    {
        "content": "<p>syntax for declaration - could be a nested syntax? <br>\ne.g. everything under the keyword \"contained\" would be a contained resource.</p>",
        "id": 188111191,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1581604510
    },
    {
        "content": "<p>I'm trying to add a contained resources with a choice of resources allowed to an extension (because I like being an edge case) and can't find an example of contained resources in FSH or any mention of it in the docs.  Can anyone show me a pointer or example as to how that might be done?</p>",
        "id": 199046976,
        "sender_full_name": "David Pyke",
        "timestamp": 1590683870
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"192587\">@David Pyke</span>.  Here's a quick example.  Let me know if you were looking for something different:</p>\n<div class=\"codehilite\"><pre><span></span><code>// First define the instances you want contained as inline instances\nInstance: ShirleyTemple\nInstanceOf: Patient\nUsage: #inline\n* name.given = &quot;Shirley&quot;\n* name.family = &quot;Temple&quot;\n\n// You could define more the same way...\n\n// Now in your instance that you want to contain it in, assign it to contained\nInstance: MyExtension\nInstanceOf: SomeExtension\nUsage: #example\n* contained[0] = ShirleyTemple\n// you could add others via contained[1], contained[2], etc\n</code></pre></div>",
        "id": 199048707,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590684729
    },
    {
        "content": "<p>I meant  an example of how to define the extension.  Sorry</p>",
        "id": 199048774,
        "sender_full_name": "David Pyke",
        "timestamp": 1590684775
    },
    {
        "content": "<p>Or really, how to define a contained resource in FSH in general</p>",
        "id": 199048873,
        "sender_full_name": "David Pyke",
        "timestamp": 1590684837
    },
    {
        "content": "<p>Oh.  Do you mean something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>Extension: MyExtension\n* contained only Condition or Procedure or MedicationOrder\n</code></pre></div>\n\n\n<p>If so, that's how you do it... <em>but</em> it seems that SUSHI might generate the StructureDefinition in a way that the IG Publisher no longer supports.  I'm not sure on that though -- so if you run into issues, do let us know.  It's something we need to look into.</p>",
        "id": 199049206,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590684995
    },
    {
        "content": "<p>THat's exactly what I was looking for. I'll see what the publisher does with it</p>",
        "id": 199049587,
        "sender_full_name": "David Pyke",
        "timestamp": 1590685181
    },
    {
        "content": "<p>I probably should have mentioned it was a sub-extension.  I defined it as:</p>\n<ul>\n<li>extension[subscriber].contained only Patient or Practitioner or RelatedPerson or Organization<br>\nsushi fails with <br>\nerror No element found at path extension[subscriber].contained for CEQextension, skipping rule</li>\n</ul>",
        "id": 199050463,
        "sender_full_name": "David Pyke",
        "timestamp": 1590685577
    },
    {
        "content": "<p>extension[subscriber].value[x] only contained didn't work.  Not that I expected it to.</p>",
        "id": 199052107,
        "sender_full_name": "David Pyke",
        "timestamp": 1590686221
    },
    {
        "content": "<p>I could be missing something here, but does Extension have a <code>contained</code> field on it? I know <code>contained</code> is defined on DomainResource, and therefore most resources, but I didn't think that Extension had a <code>contained</code>.</p>",
        "id": 199052739,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1590686467
    },
    {
        "content": "<p>It doesn't, it only has value[x].  THat's my problem I'm not sure how to set the value to a contained resource.</p>",
        "id": 199053665,
        "sender_full_name": "David Pyke",
        "timestamp": 1590686809
    },
    {
        "content": "<p>If I'm trying to do the impossible, that might be my problem</p>",
        "id": 199053824,
        "sender_full_name": "David Pyke",
        "timestamp": 1590686833
    },
    {
        "content": "<p>I'm assuming extension[subscriber].value[x] only valueReference([list of Resources]) contained would be something like what I want</p>",
        "id": 199054137,
        "sender_full_name": "David Pyke",
        "timestamp": 1590686962
    },
    {
        "content": "<p>Are you trying to define a valueReference pointing to a contained resource?</p>",
        "id": 199054160,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1590686979
    },
    {
        "content": "<p>Yes</p>",
        "id": 199054177,
        "sender_full_name": "David Pyke",
        "timestamp": 1590686990
    },
    {
        "content": "<p>Ultimately, I'm trying to create a subextension that is a contained resource with a choice of 4 different resource options</p>",
        "id": 199054674,
        "sender_full_name": "David Pyke",
        "timestamp": 1590687181
    },
    {
        "content": "<p>How that would be done is the exciting part</p>",
        "id": 199054712,
        "sender_full_name": "David Pyke",
        "timestamp": 1590687200
    },
    {
        "content": "<p>If you want a reference to only point to a contained resource, isn't that declared in the aggregation element? <a href=\"https://www.hl7.org/fhir/elementdefinition-definitions.html#ElementDefinition.type.aggregation\">https://www.hl7.org/fhir/elementdefinition-definitions.html#ElementDefinition.type.aggregation</a><br>\nBut that would mean you couldn't require it on every use of that extension, just on ones you have added in an extension slice to the structureDefinition..</p>\n<p>The other terrible idea I had was to add an invariant that requires the reference value to start with \"#\" but that seems just as unlikely to be usable</p>",
        "id": 199055800,
        "sender_full_name": "ryan moehrke",
        "timestamp": 1590687789
    },
    {
        "content": "<p>That would work, how do you do that in fsh?</p>",
        "id": 199057434,
        "sender_full_name": "David Pyke",
        "timestamp": 1590688519
    },
    {
        "content": "<p>The heck with this, I'm going to push back and do it as a bundle.  I'm sure there's a way to do this but I can't figure it out.</p>",
        "id": 199057706,
        "sender_full_name": "David Pyke",
        "timestamp": 1590688656
    },
    {
        "content": "<p>I just used a lot of ^ escaped lines, obviously you would use #contained not #bundled but this is the format:</p>\n<p>Profile:        PatientSingleAgg<br>\nParent:         Patient<br>\nId:             PatientSingleAgg<br>\nTitle:          \"PatientSingleAgg\"<br>\nDescription:    \"PatientSingleAgg profile for testing\"</p>\n<ul>\n<li>contact.organization ^type.code = Reference</li>\n<li>contact.organization ^type.targetProfile = <a href=\"http://hl7.org/fhir/StructureDefinition/Organization\">http://hl7.org/fhir/StructureDefinition/Organization</a></li>\n<li>contact.organization ^type.aggregation = #bundled</li>\n</ul>",
        "id": 199058746,
        "sender_full_name": "ryan moehrke",
        "timestamp": 1590689096
    },
    {
        "content": "<p>I'll give it a shot and see how sushi and the publisher like that</p>",
        "id": 199058973,
        "sender_full_name": "David Pyke",
        "timestamp": 1590689182
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192587\">David Pyke</span> <a href=\"#narrow/stream/215610-shorthand/topic/Contained.20Resources/near/199057706\">said</a>:</p>\n<blockquote>\n<p>The heck with this, I'm going to push back and do it as a bundle.  I'm sure there's a way to do this but I can't figure it out.</p>\n</blockquote>\n<p>If it can be done as a bundle, it probably should be done as a bundle. Contained resources are not a \"packaging\" structure...</p>",
        "id": 199060071,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1590689544
    },
    {
        "content": "<p>I agree, I was asked to attempt this by Those That Rule.  Now that I've tried a bunch of different ways, I'm going to just bundle them</p>",
        "id": 199083139,
        "sender_full_name": "David Pyke",
        "timestamp": 1590698197
    },
    {
        "content": "<p>Thanks everyone for working this one out.  Sorry I totally misunderstood the question!  BTW, <span class=\"user-mention\" data-user-id=\"237342\">@ryan moehrke</span> -- I think yours could be simplified, right?  The type is already a reference to an Organization, so I don't think you need to repeat that.  You should only need:</p>\n<div class=\"codehilite\"><pre><span></span><code>* contact.organization ^type.aggregation = #bundled\n</code></pre></div>",
        "id": 199086246,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590699732
    },
    {
        "content": "<p>Unless you were trying to just show how you could restrict the type to only certain types.  In that case, I think <code>only</code> would still work and would be simpler than using <code>^</code> all the way.</p>",
        "id": 199086344,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590699799
    },
    {
        "content": "<p>thanks, for my purposes its probably good as-is but it's good to know there's a better way of going about it</p>",
        "id": 199088489,
        "sender_full_name": "ryan moehrke",
        "timestamp": 1590701149
    },
    {
        "content": "<p>Hello, <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> . wondering if you folks have an syntax on  \"contained\". I am creating profile of PractitionerRole and looking for a way to have contained Resource type to be only InsurancePlan with card. 1..*</p>",
        "id": 220159086,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1608145984
    },
    {
        "content": "<p>so you want to disallow any other contained resources?</p>",
        "id": 220159213,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608146051
    },
    {
        "content": "<p>yes</p>",
        "id": 220159304,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1608146106
    },
    {
        "content": "<p>and how is the relation between insuranceplan and practitionerrole?</p>",
        "id": 220159359,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608146147
    },
    {
        "content": "<p>PractitionerRole does not link to InsurancePlan normally..</p>",
        "id": 220159381,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608146162
    },
    {
        "content": "<p>insuranceplan own the networks which practionerrole participates</p>",
        "id": 220160021,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1608146483
    },
    {
        "content": "<p>how do you link? PractitionerRole does not have an attribute that would is a reference to InsurancePlan</p>",
        "id": 220162046,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608147302
    },
    {
        "content": "<p>Completely off topic:   in the Plan-Net IG, we added an extension to provide the reference from a PractitionerRole to a Network (a profile of Organization, owned by a Payer.   <a href=\"https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/StructureDefinition-plannet-PractitionerRole.html\">https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/StructureDefinition-plannet-PractitionerRole.html</a></p>",
        "id": 220163143,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1608147888
    },
    {
        "content": "<p>we don't have much information about InsurancePlan resource (were are not the payer) nor we maintained the resource. kind of place holder for downstream system use this and build actual resource (it up to downstream system). this is not reference outside of that specific PractitionerRole.<br>\n<span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span>  our system is back-end processing service.</p>",
        "id": 220164309,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1608148484
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"343998\">@Jabeen Mohammed</span>.  I think <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> is concerned because normally a contained resource is <em>referenced</em> from the profile in some way.  This reference shows how the contained resource is related to the thing that contains it.  A contained resource that is <em>not</em> referenced at all has no formal relationship to the thing containing it.  People can <em>guess</em> at the relationship, but you really ought to formalize it.  One way to do that, as <span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> suggested, is to create an extension that references an <code>InsurancePlan</code> to formally represent the relationship between <code>PractitionerRole</code> and <code>InsurancePlan</code>.</p>\n<p>I'm not very familiar w/ this domain, so my suggestion may not be exactly right (semantically), but here is an example of how you might do this with FSH if you wanted to represent a <code>PractitionerRole</code> that \"accepts\" one or more <code>InsurancePlan</code>s (that you want contained):</p>\n<div class=\"codehilite\"><pre><span></span><code>Extension: AcceptsInsurancePlan\nId: accepts-insurance-plan\n* value[x] 1..1\n* value[x] only Reference(InsurancePlan)\n\nProfile: MyPractitionerRole\nParent: PractitionerRole\nId: my-practitioner-role\n* contained 1..*\n* contained only InsurancePlan\n* extension contains AcceptsInsurancePlan named accepts 1..*\n</code></pre></div>",
        "id": 220167197,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1608149882
    },
    {
        "content": "<p>yes, i was asking because resources can only be contained in other resources if there is a reference from the resource to the contained resource, or if the contained resource references the container resource.</p>",
        "id": 220167911,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608150228
    },
    {
        "content": "<p>if such an extension is created, then the problem is solved</p>",
        "id": 220167998,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608150255
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span>  I wish my client client's agree to extension which more of norm. but got find way... hopefully can convince them on extension <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 220171707,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1608152113
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  thanks for example... <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 220172228,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1608152366
    },
    {
        "content": "<p>A contained resource only makes sense if the parent resource points to it, or if it points to the parent resource</p>",
        "id": 220172294,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608152397
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/references.html#contained\">http://build.fhir.org/references.html#contained</a></p>",
        "id": 220172376,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608152423
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> <span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span>  thanks for guys...<br>\nI was able to share the comparison \"contained\" vs \"extension\" with my clients customers and the winner was \"extension\".</p>",
        "id": 220203724,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1608175841
    },
    {
        "content": "<p>Hello,<br>\nIm building an IG using  FHIR Shorthand,  and I need to specifiy a resource with acontained resource in it.</p>\n<p>I've been doing a reserch and I also asked in this forum on other topic (Implementors), because i didn't know that this stream exists, an until now I found that a contained resource only can be use in the instance of a resource. </p>\n<p>Â¿It's not possible to use  in the definition of the resource?</p>\n<p>greetins and thanks in advance</p>",
        "id": 227409765,
        "sender_full_name": "Juan Manuel Caputo",
        "timestamp": 1614076680
    },
    {
        "content": "<p>You can add a contained resource to a Profile of a resource using the <code>^</code> syntax. Here is a contrived but simple example:</p>\n<div class=\"codehilite\"><pre><span></span><code>Instance: ContainedResource\nInstanceOf: Observation\n* status = #final\n\nProfile: PatientProfile\nParent: Patient\n* ^contained[0] = ContainedResource\n</code></pre></div>\n<p>This will create a StructureDefinition for the PatientProfile, and that StructureDefinition will contain the ContainedResource Observation.</p>",
        "id": 227427032,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1614085875
    },
    {
        "content": "<p>Hello</p>\n<p>How can I add info about a contained resource? I'm trying different ways but do not succeed. </p>\n<div class=\"codehilite\"><pre><span></span><code>* ^contained[+] = List\n* ^contained[=].status 1..1 MS\n* ^contained[=].status ^short = &quot;current | retired | entered-in-error&quot;&quot;\n</code></pre></div>\n<p>The second and third lines give errors:</p>\n<ul>\n<li>Assignment rules must include at least one space both before and after the '=' sign</li>\n<li>The element or path you referenced does not exist: contained[0].status</li>\n</ul>\n<p>How can this be expressed?</p>",
        "id": 249993688,
        "sender_full_name": "Barbro Vessman",
        "timestamp": 1629382965
    },
    {
        "content": "<p>You add all that data in the contained resource profile and instance definition, not in the parent profile itself.</p>",
        "id": 249994022,
        "sender_full_name": "David Pyke",
        "timestamp": 1629383111
    },
    {
        "content": "<p>you don't need the '^' unless you mean to add a contained resource to the underlying StructureDefinition. Here's what I do in one of my profiles:</p>\n<div class=\"codehilite\"><pre><span></span><code>* contained contains BusinessOperation 1..* MS and USAgentAffiliation 0..1 MS and USAgent 0..1 MS\n* contained[BusinessOperation] only LabelerBusinessOperation\n* contained[USAgentAffiliation] only USAgentAffiliation\n* contained[USAgent] only USAgentOrganization\n</code></pre></div>\n<p>And then in the instance:</p>\n<div class=\"codehilite\"><pre><span></span><code>* contained[USAgentAffiliation] = SampleLabelerUSAgentAffiliation\n* contained[USAgentAffiliation].organization.reference = &quot;#&quot;\n* contained[USAgentAffiliation].participatingOrganization.reference = &quot;#usagent&quot;\n* contained[USAgent] = SampleLabelerUSAgent\n* contained[USAgent].id = &quot;usagent&quot;\n* contained[BusinessOperation] = SampleLabelerBusinessOperation\n* contained[BusinessOperation].providedBy.reference = &quot;#&quot;\n</code></pre></div>",
        "id": 249994256,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1629383208
    },
    {
        "content": "<p>OK, thanks a lot  <span class=\"user-mention\" data-user-id=\"192587\">@David Pyke</span>  and <span class=\"user-mention\" data-user-id=\"192166\">@Jean Duteau</span> . Great with examples! Same thing with referenced resources then I suppose</p>",
        "id": 249996166,
        "sender_full_name": "Barbro Vessman",
        "timestamp": 1629384080
    },
    {
        "content": "<p>What is the correct syntax to specify another profile needs to be used for a contained resource that will be referred to in the file?</p>\n<p>Profile: DrugProduct<br>\nParent: MedicinalProductDefinition<br>\nId: pqcmc-DrugProduct<br>\nTitle: \"Drug Product\"<br>\nDescription: \"Includes the properties of the drug product, its components and impurities\"<br>\n// ComponentSubstance is a profile</p>\n<ul>\n<li>\n<p>.contained = ComponentSubstance <br>\n // this gave the error: Cannot assign Instance at path contained to element of type Resource. Definition not found for Instance: </p>\n</li>\n<li>\n<p>description ^short = \"Drug Product Description\"<br>\n// This gave the error: Cannot assign Reference value: Reference(ComponentSubstance). Value does not match element type: Resource<br>\nThe last seems closer, but it is not catching on that behind the ComponentSubstance is a parent resource.  So is there a way to specify use this profile with the resource?</p>\n</li>\n</ul>",
        "id": 267683833,
        "sender_full_name": "Catherine Hosage Norman",
        "timestamp": 1641964678
    },
    {
        "content": "<p>correction to the  last bullet</p>\n<ul>\n<li>.contained = Reference(ComponentSubstance)  not description ^short = \"Drug Product Description\".</li>\n</ul>",
        "id": 267683971,
        "sender_full_name": "Catherine Hosage Norman",
        "timestamp": 1641964828
    },
    {
        "content": "<p>Contained is a resource array so you probably need to slice it first and then restrict the slice to a specific profile.</p>",
        "id": 267684912,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1641966360
    },
    {
        "content": "<p>If you mean to say that all contained resources have to be of the same type, then the example I gave earlier would work: contained only ComponentSubstance</p>",
        "id": 267685034,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1641966491
    },
    {
        "content": "<p>Bingo!  thanks</p>",
        "id": 267751477,
        "sender_full_name": "Catherine Hosage Norman",
        "timestamp": 1642006097
    }
]