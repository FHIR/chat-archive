[
    {
        "content": "<p>I am trying to use a newly defined attribute from R5 in an R4 based IG. I am using the guidance here:<br>\n<a href=\"https://fshschool.org/docs/sushi/configuration/#dependencies\">https://fshschool.org/docs/sushi/configuration/#dependencies</a><br>\n<a href=\"http://build.fhir.org/versions.html#extensions\">http://build.fhir.org/versions.html#extensions</a></p>\n<p>I tried a few things, and couldn't get it to work. To verify: </p>\n<ul>\n<li>would I used 'r5' as the extension version?</li>\n<li>would the URL look like <a href=\"http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note\">http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note</a></li>\n</ul>\n<p>(and sorry, this is likely not a shorthand specific thing, but I started here since I am using FSH <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span>)</p>",
        "id": 265948572,
        "sender_full_name": "Kevin Power",
        "timestamp": 1640289516
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191913\">@Kevin Power</span> -- sorry for the delay!  This one got lost in the holiday shuffle!  You should be able to do this by setting up the dependency in <code>sushi-config.yaml</code>:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">dependencies</span><span class=\"p\">:</span>\n  <span class=\"nt\">hl7.fhir.extensions.r5</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">4.0.1</span>\n</code></pre></div>\n<p>Then using it in a profile and/or instance.  I usually create an alias for the extension URL to simplify things.  For example:</p>\n<div class=\"codehilite\"><pre><span></span><code>Alias: R5DiagnosticReportNote = http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note\n\nProfile: MyDiagnosticReportProfile\nParent: DiagnosticReport\nDescription: &quot;An example profile showing how to use an R5 extension.&quot;\n* extension contains R5DiagnosticReportNote named note 0..*\n</code></pre></div>\n<p>I'm attaching a working project as a zip file with an example profile and two instances.</p>\n<p><a href=\"/user_uploads/10155/iih0ZjPoRCvXnsZLwjoUnO-z/DiagnosticReportNoteExample.zip\">DiagnosticReportNoteExample.zip</a></p>",
        "id": 266858771,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1641328092
    },
    {
        "content": "<p>Note that this will use the <em>current</em> R5 build from the build server -- and it attempts to download it every time (since current can change multiple times per day).  Unfortunately, this means that this will not currently work due to the <em>expired</em> security certificate on <a href=\"http://build.fhir.org\">build.fhir.org</a>. Until that is fixed, the R5 download will fail.  I posted a workaround <a href=\"#narrow/stream/215610-shorthand/topic/R5.20support/near/266722279\">here</a> if you really need to make progress on this while we wait for the build server issue to be fixed.</p>",
        "id": 266859164,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1641328290
    },
    {
        "content": "<p>Oh! But since this uses a current build and attempts to download every time, you shouldn't remove the special environment variable until you're done working on it, because as soon as you remove it, local builds will fail again.</p>",
        "id": 266859454,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1641328430
    },
    {
        "content": "<p>Ha, just noticed that <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> So left the environment variable set for now.</p>\n<p>So, if I start with just the dependency, it seems to download packages and builds fine. However, I get this error when I build a 2nd time:</p>\n<blockquote>\n<p>Sushi: error Failed to load supplemental FHIR package hl7.fhir.r5.core#current: ENOTEMPTY: directory not empty, rename '/Users/kmpower/.fhir/packages/hl7.fhir.r5.core#current/openapi' -&gt; '/Users/kmpower/.fhir/packages/hl7.fhir.r5.core#current/package/openapi' </p>\n</blockquote>",
        "id": 266860207,
        "sender_full_name": "Kevin Power",
        "timestamp": 1641328815
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> - If I delete the package folder, it seems to then work. However, once I try to add the extension to my profile, I get the following stack dump:</p>\n<div class=\"codehilite\" data-code-language=\"g-code\"><pre><span></span><code>Stack Dump (for debugging):                                                      (00:37.0827)\njava.lang.Exception: Error generating snapshot for /Users/kmpower/Documents/GitHub/genomics-reporting/fsh-generated/resources/StructureDefinition-genomics-report(genomics-report): Unable to generate snapshot for http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/genomics-report in /Users/kmpower/Documents/GitHub/genomics-reporting/fsh-generated/resources/StructureDefinition-genomics-report\n<span class=\"w\">        </span>at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4810)\n<span class=\"w\">        </span>at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:4094)\n<span class=\"w\">        </span>at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:944)\n<span class=\"w\">        </span>at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:795)\n<span class=\"w\">        </span>at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8975)\nCaused by: org.hl7.fhir.exceptions.FHIRException: Unable to generate snapshot for http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/genomics-report in /Users/kmpower/Documents/GitHub/genomics-reporting/fsh-generated/resources/StructureDefinition-genomics-report\n<span class=\"w\">        </span>at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4859)\n<span class=\"w\">        </span>at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4808)\n<span class=\"w\">        </span>... 4 more\nCaused by: org.hl7.fhir.exceptions.FHIRException: Reference to unknown extension http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note\n<span class=\"w\">        </span>at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1163)\n<span class=\"w\">        </span>at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1529)\n<span class=\"w\">        </span>at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:654)\n<span class=\"w\">        </span>at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4857)\n<span class=\"w\">        </span>... 5 more\n</code></pre></div>\n<p>Not sure if that is another symptom of the first problem I mentioned or not.</p>",
        "id": 266862405,
        "sender_full_name": "Kevin Power",
        "timestamp": 1641329927
    },
    {
        "content": "<p>Hopefully you don't have to delete the package folder every time!  If so, that doesn't seem right...</p>",
        "id": 266864454,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1641330970
    },
    {
        "content": "<p>As for the error, my only guess is that the IG Publisher is using an older version of FHIR R5 to resolve the special cross-version extensions.  The <code>note</code> element was only added to <code>DiagnosticReport</code> in the last snapshot release.  So if the IG Publisher is using FHIR R5 4.6.0 or lesser, then it wouldn't recognize the <a href=\"http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note\">http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note</a> extension.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- is my guess right? Is the IG publisher possibly using an older R5 package to try to resolve cross-version extensions?</p>",
        "id": 266864788,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1641331162
    },
    {
        "content": "<p>Thanks for all the help <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> <br>\n<a href=\"https://media4.giphy.com/media/uWlpPGquhGZNFzY90z/giphy.gif?cid=c623cb359pulbwj2mskzt0d529afq0yeznm9t7jjknkttn6e&amp;rid=giphy.gif&amp;ct=g\">https://media4.giphy.com/media/uWlpPGquhGZNFzY90z/giphy.gif?cid=c623cb359pulbwj2mskzt0d529afq0yeznm9t7jjknkttn6e&amp;rid=giphy.gif&amp;ct=g</a></p>\n<div class=\"message_inline_image\"><a href=\"https://media4.giphy.com/media/uWlpPGquhGZNFzY90z/giphy.gif?cid=c623cb359pulbwj2mskzt0d529afq0yeznm9t7jjknkttn6e&amp;rid=giphy.gif&amp;ct=g\"><img src=\"https://uploads.zulipusercontent.net/41a3f2ad95bc5e831adf89658128fd8ed5559a29/68747470733a2f2f6d65646961342e67697068792e636f6d2f6d656469612f75576c705047717568475a4e467a5939307a2f67697068792e6769663f6369643d63363233636233353970756c62776a326d736b7a7430643532396166713079657a6e6d3974376a6a6b6e6b74746e3665267269643d67697068792e6769662663743d67\"></a></div>",
        "id": 266865648,
        "sender_full_name": "Kevin Power",
        "timestamp": 1641331649
    },
    {
        "content": "<p>My pleasure!  Let's see what Grahame says and we'll take it from there...</p>",
        "id": 266865844,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1641331750
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> - Just FYI, you might be onto something. I switched over to a different attribute that is also being added in R5 (composition) and everything works as I would expect (so maybe it was in an earlier snapshot that the IG is using).</p>\n<p>I will also add that I am not sure what changed, but the weird error I was getting with the build failing the 2nd time has now stopped happening. So, not sure what that is about.</p>",
        "id": 266880047,
        "sender_full_name": "Kevin Power",
        "timestamp": 1641339864
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191469\">Chris Moesel</span> <a href=\"#narrow/stream/215610-shorthand/topic/Extensions.20for.20R5.20elements.20in.20an.20R4.20IG/near/266864788\">said</a>:</p>\n<blockquote>\n<p>As for the error, my only guess is that the IG Publisher is using an older version of FHIR R5 to resolve the special cross-version extensions.  The <code>note</code> element was only added to <code>DiagnosticReport</code> in the last snapshot release.  So if the IG Publisher is using FHIR R5 4.6.0 or lesser, then it wouldn't recognize the <a href=\"http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note\">http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.note</a> extension.  <span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> -- is my guess right? Is the IG publisher possibly using an older R5 package to try to resolve cross-version extensions?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> - I know you are swamped, but wanted to tag you on this one again to see if you have any thoughts.</p>",
        "id": 267011444,
        "sender_full_name": "Kevin Power",
        "timestamp": 1641428379
    }
]