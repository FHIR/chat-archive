[
    {
        "content": "<p>Does anyone recognize this error?:</p>\n<div class=\"codehilite\"><pre><span></span><code>RHausamMacbookPro:livd rhausam$ sh _genonce.sh\nChecking internet connection...\nOnline\n\nFHIR IG Publisher Version 1.1.35 (Git# a4a66bd10efb). Built 2020-10-14T21:26:37.503Z (48 hours old)\nFile log: /var/folders/vv/4dq6q1157n3b62yb7cxyr6br0000gn/T/fhir-ig-publisher-tmp.log\nDetected Java version: 14.0.2 from /Users/rhausam/.asdf/installs/java/adoptopenjdk-14.0.2+12 on x86_64 (64bit). 4096MB available\nParameters: -ig .\n\ndir = /Users/rhausam/git-repo/livd, path = /Users/rhausam/.asdf/installs/java/adoptopenjdk-14.0.2+12/bin:/usr/local/sbin:/Users/rhausam/.asdf/shims:/usr/local/opt/asdf/bin:/Users/rhausam/.rbenv/shims:/Users/rhausam/.rbenv/bin:/usr/local/opt/llvm/bin:/usr/local/Cellar/pyenv-virtualenv/1.1.5/shims:/Users/rhausam/.pyenv/shims:/Library/Frameworks/Python.framework/Versions/2.7/bin:/usr/local/opt/bison/bin:/opt/local/bin:/opt/local/sbin:/Users/rhausam/google-cloud-sdk/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Applications/VMware Fusion.app/Contents/Public:/usr/local/MacGPG2/bin:/usr/local/share/dotnet:/opt/X11/bin:~/.dotnet/tools:/usr/local/git/bin:/opt/apache-maven-3.6.2/bin:/usr/local/ant/bin:/root/.dotnet/tools\n\nRun time = Friday, October 16, 2020 at 4:32:40 PM Central Daylight Time (2020-10-16T16:32:40-05:00)\nPackage Cache: /Users/rhausam/.fhir/packages                                     (00:00.0079)\nRun Sushi on /Users/rhausam/git-repo/livd                                        (00:00.0088)\nSushi: npx: installed 111 in 7.876s                                              (00:08.0925)\nSushi: info  Running SUSHI v1.0.0-beta.2 (implements FHIR Shorthand specification v1.0.0) (00:09.0565)\nSushi: info  Arguments:                                                          (00:09.0566)\nSushi: info    --out /Users/rhausam/git-repo/livd                                (00:09.0568)\nSushi: info    /Users/rhausam/git-repo/livd/fsh                                  (00:09.0569)\nSushi: info  Using configuration file: /Users/rhausam/git-repo/livd/sushi-config.yaml (00:09.0577)\nSushi: info  Importing FSH text...                                               (00:09.0587)\nSushi: info  Preprocessed 5 documents with 0 aliases.                            (00:09.0922)\nSushi: info  Imported 5 definitions and 0 instances.                             (00:09.0950)\nSushi: info  Checking local cache for hl7.fhir.r4.core#4.0.1...                  (00:09.0952)\nSushi: info  Found hl7.fhir.r4.core#4.0.1 in local cache.                        (00:13.0251)\nSushi: info  Loaded package hl7.fhir.r4.core#4.0.1                               (00:13.0252)\nSushi: info  Converting FSH to FHIR resources...                                 (00:13.0408)\nSushi: info  Converted 5 FHIR StructureDefinitions.                              (00:16.0965)\nSushi: info  Exporting FHIR resources as JSON...                                 (00:16.0966)\nSushi: info  Exported 5 FHIR resources as JSON.                                  (00:17.0047)\nSushi: info  Assembling Implementation Guide sources...                          (00:17.0048)\nSushi: error SUSHI encountered the following unexpected error: _g.find is not a function (00:17.0052)\nSushi couldn&#39;t be run. Complete output from running Sushi :                      (00:17.0926)\nNote: Check that Sushi is installed correctly (&quot;npm install -g fsh-sushi&quot;. On windows, get npm from https://www.npmjs.com/get-npm) (00:17.0928)\nException: Process exited with an error: 1 (Exit value: 1)                       (00:17.0928)\nPublishing Content Failed: Process exited with an error: 1 (Exit value: 1)       (00:17.0929)\n                                                                                 (00:17.0931)\nUse -? to get command line help                                                  (00:17.0932)\n                                                                                 (00:17.0935)\nStack Dump (for debugging):                                                      (00:17.0937)\norg.apache.commons.exec.ExecuteException: Process exited with an error: 1 (Exit value: 1)\n    at org.apache.commons.exec.DefaultExecutor.executeInternal(DefaultExecutor.java:404)\n    at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:166)\n    at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:153)\n    at org.hl7.fhir.igtools.publisher.Publisher.runFsh(Publisher.java:1549)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1437)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:719)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8342)\n</code></pre></div>\n\n\n<p>Suggestions?</p>",
        "id": 213617180,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602884245
    },
    {
        "content": "<p>I just gave Chris a heads-up.</p>",
        "id": 213617382,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1602884375
    },
    {
        "content": "<p>thanks!</p>",
        "id": 213617445,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602884404
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> -- is this IG available on GitHub?  If so, can you point me to it?  I've never seen that error before and would like to try to reproduce it.</p>",
        "id": 213617666,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602884529
    },
    {
        "content": "<p>I'm in the process of converting the LIVD IG to fsh and I haven't pushed those particular changes yet - I was planning to get it working first. :)  But I can push it to a branch.  I'll do that now and let you know as soon as it's there.</p>",
        "id": 213617846,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602884694
    },
    {
        "content": "<p>I also discovered an interesting issue when GoFSH converted my LOINC code system fragment to fsh and apparently had trouble with the LOINC 'SYSTEM' property, as it seems to convert to lowercase 'system' which also appears to be a reserved word?  That's not a particularly immediate concern, as I've just renamed the fsh file (with a .bad extension) and am sticking with the json version for now - but it also may be interested to look at whenever you get a chance.</p>",
        "id": 213618362,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602885101
    },
    {
        "content": "<p>Fair enough.  For my reference, was LIVD working with SUSHI 1.0.0 Beta 1?  In other words, did we introduce this error in Beta 2?</p>",
        "id": 213618582,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602885245
    },
    {
        "content": "<p>No.  We've never run it with SUSHI before - I'm just doing the conversion now.</p>",
        "id": 213619005,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602885587
    },
    {
        "content": "<p>Here's the branch: <a href=\"https://github.com/HL7/livd/tree/convert-to-fsh\">https://github.com/HL7/livd/tree/convert-to-fsh</a></p>",
        "id": 213619141,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602885665
    },
    {
        "content": "<p>Thanks!  I'll take a look, although I'm running out of time today so can't promise a quick-fix...</p>",
        "id": 213619248,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602885748
    },
    {
        "content": "<p>Thanks.  Nothing like a last minute issue as the weekend is starting!  Wouldn't you know that I would find something that apparently nobody else has? ;)</p>",
        "id": 213619448,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602885946
    },
    {
        "content": "<p>You've got mad skillz!</p>",
        "id": 213619486,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602885963
    },
    {
        "content": "<p>GoFSH was pretty helpful in converting our profile spreadsheets.  It didn't seem to pick up the extensions, but the profiles themselves look pretty good (at least so far - and we know that we need clean them up as they have way too many unneeded constraints which came from the original spreadsheets).</p>",
        "id": 213619648,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602886106
    },
    {
        "content": "<p>Oh.  How'd you do that?  GoFSH doesn't support the spreadsheets directly -- so did you use IG Publisher to build the profile XML/JSON and then feed that into GoFSH?</p>",
        "id": 213619674,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602886169
    },
    {
        "content": "<p>Yes, that's basically it.  I just thought I would try it and see if GoFSH would be able to find the StructureDefinitions in the build output, and apparently it did.</p>",
        "id": 213619795,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602886291
    },
    {
        "content": "<p>For the extensions I ended up having to craft them by hand in json, as I couldn't seem to get them working in fsh at all (even when I hand-crafted them).  But I can look at that more later and try to get it to work.</p>",
        "id": 213619861,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602886344
    },
    {
        "content": "<p>OK.  Extensions <em>should</em> have worked.  I'm surprised that they did not.</p>",
        "id": 213620147,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602886602
    },
    {
        "content": "<p>Found the issue and luckily it is a simple fix that you can do on your side.</p>",
        "id": 213620171,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602886621
    },
    {
        "content": "<p>Yeah.  I thought so, too.  But I'm just learning, and I probably didn't get something right in the syntax.</p>",
        "id": 213620220,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602886667
    },
    {
        "content": "<p>Oh, great.  That's quick!</p>",
        "id": 213620229,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602886676
    },
    {
        "content": "<p>Your <a href=\"https://github.com/HL7/livd/blob/convert-to-fsh/input/examples/bundle-livd-example.json#L5\">livd-example bundle</a> has:</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;meta&quot;: {\n  &quot;profile&quot;: &quot;http://hl7.org/fhir/uv/livd/StructureDefinition/bundle-uv-livd&quot;\n},\n</code></pre></div>\n\n\n<p>but <code>meta.profile</code> is 0..*, so it should be an array. It needs to be:</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;meta&quot;: {\n  &quot;profile&quot;: [&quot;http://hl7.org/fhir/uv/livd/StructureDefinition/bundle-uv-livd&quot;]\n},\n</code></pre></div>\n\n\n<p>I made that change locally and it fixed the problem.  Ideally SUSHI should be able to handle a simple mistake like that without bombing out of the whole process, but right now I guess it does not.</p>",
        "id": 213620351,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602886786
    },
    {
        "content": "<p>The validator should have picked that up, too. :(  I'm taking meta.profile our of most places now - but this has been on the back burner for a while and we're just updating it now to move it ahead and I hadn't even looked at that.  Thanks a lot for the debugging.  Possibly the error message could also be a bit more helpful! :)</p>",
        "id": 213620569,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602886989
    },
    {
        "content": "<p>I know you're just in the middle of things and you didn't mean to push this out for external review, but since I'm here... ;-). I noticed that you have your ImplementationGuide XML at <code>input/livd.xml</code> and your <code>ig.ini</code> points to it.  Since your <code>sushi-config.yaml</code> does not have <code>FSHOnly: true</code>, however, SUSHI is <em>also</em> generating an ImplementationGuide resource for you.  Which may not be necessary.</p>\n<p>So... you have a choice:<br>\n(a) <strong>FSH-only mode</strong>: If you want SUSHI to only build your <code>input/fsh</code> files -- and you will continue to manage your IG files manually -- then you can <em>delete</em> the <code>sushi-config.yaml</code> file and SUSHI will pull any necessary config data from your <code>input/livd.xml</code>.<br>\n(b) <strong>Managed IG mode</strong>: If you want SUSHI to also manage your IG files (ImplementationGuide resource and optionally menu.xml) then you should update <code>sushi-config.yaml</code> w/ relevant info from <code>input/livd.xml</code>, point <code>ig.ini</code> to the generated ImplementationGuide resource in <code>fsh-generated</code>, and delete the <code>input/livd.xml</code> file.</p>\n<p>If you want to delay that decision, I'd suggest starting w/ (a) and then you can transition to (b) if you want to later.  I think that's the easiest path for transitioning an existing Implementation Guide.</p>",
        "id": 213621322,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1602887677
    },
    {
        "content": "<p>Oh, thanks for the advice on that, Chris.  It does sound like (a) --&gt; (b) is the right path.  I guess we will need to think a bit more and decide whether we do want to move to (b), or maybe just stay at (a).  My main goal was being able to get away from the spreadsheets, while not forcing everyone working on the IG to do everything by hand in json or xml.  FSH is certainly perfect for that - and we can take a little time and consider the rest.</p>",
        "id": 213627249,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1602895174
    }
]