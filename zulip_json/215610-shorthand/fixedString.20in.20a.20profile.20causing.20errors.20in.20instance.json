[
    {
        "content": "<p>Trying to create an instance of the <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-au-immunization.html\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-au-immunization.html\">Australian Imm profile</a> and getting an error when setting a value on a sliced element:</p>\n<div class=\"codehilite\"><pre><span></span><code>* performer[administeredBy].function = http://terminology.hl7.org/CodeSystem/v2-0443#AP &quot;Administering Provider&quot;\n* performer[administeredBy].function.text = &quot;Administering Provider&quot; // a fixed string in the profile\n* performer[administeredBy].actor = Reference(aupc-practitioner1)\n</code></pre></div>\n\n\n<p>Error (on the second line): </p>\n<blockquote>\n<p>Cannot fix this element using a pattern; as it is already fixed in the StructureDefinition using fixedString. Since fixed[x] requires exact matches, while pattern[x] allows for variation in unspecified properties, fixed[x] cannot be replaced by pattern[x] since it would loosen the constraint.</p>\n</blockquote>",
        "id": 195794615,
        "sender_full_name": "David Hay",
        "timestamp": 1588216546
    },
    {
        "content": "<p>I got that and realized that I just had to leave it empty - i.e don't put it on the instance.  Even though the string was exactly what was specified in the profile, it wouldn't work.  I believe that this is also true if it was a code instead of a string.</p>",
        "id": 195794825,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1588216818
    },
    {
        "content": "<p>I did try that - unfortunately I still got an error:</p>\n<blockquote>\n<p>error Element Immunization.performer:administeredBy.function.text has minimum cardinality 1 but occurs 0 time(s).</p>\n</blockquote>",
        "id": 195797390,
        "sender_full_name": "David Hay",
        "timestamp": 1588220699
    },
    {
        "content": "<p>I have noted that leaving it out is fine if the profile is defined in FSH though...</p>",
        "id": 195797479,
        "sender_full_name": "David Hay",
        "timestamp": 1588220788
    },
    {
        "content": "<p>Right.  my profile was defined in FSH.  Even though that works, that still points to a problem with SUSHI being overzealous.</p>",
        "id": 195797847,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1588221423
    },
    {
        "content": "<p>Yes - it's an interesting question whether or not sushu should apply 'defaults'...</p>",
        "id": 195797927,
        "sender_full_name": "David Hay",
        "timestamp": 1588221574
    },
    {
        "content": "<p>This looks like it is an artifact of when we added the new <code>exactly</code> keyword for fixing values on Profiles and Extensions. Some of the logic for determining whether or not a value can be fixed is shared between Profiles/Extensions and Instances, so it looks like when we changed the logic for Profiles/Extensions to work with the <code>exactly</code> keyword, we missed this side effect on Instances.</p>\n<p>Normally SUSHI should actually automatically set the value of <code>performer[administeredBy].function.text</code>, but the same error that is stopping you from setting it manually is stopping SUSHI from setting it by hand. Unfortunately I don't think there is really any workaround until we fix this.</p>",
        "id": 195834170,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1588251258
    },
    {
        "content": "<p>Tracking this as an issue <a href=\"https://github.com/FHIR/sushi/issues/398\" title=\"https://github.com/FHIR/sushi/issues/398\">https://github.com/FHIR/sushi/issues/398</a></p>",
        "id": 195834204,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1588251285
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 195881368,
        "sender_full_name": "David Hay",
        "timestamp": 1588271194
    },
    {
        "content": "<p>Hi Nick - is this another example of this issue?</p>\n<p>profile</p>\n<div class=\"codehilite\"><pre><span></span><code>* identifier ^slicing.discriminator.type = #value\n* identifier ^slicing.discriminator.path = &quot;system&quot;\n* identifier ^slicing.rules = #openAtEnd\n\n//The slice has the name NHI\n* identifier contains\n    NHI 1..1\n\n* identifier[NHI].system = &quot;https://standards.digital.health.nz/id/nhi&quot; (exactly)\n</code></pre></div>\n\n\n<p>Instance:</p>\n<div class=\"codehilite\"><pre><span></span><code>* identifier[NHI].system = &quot;https://standards.digital.health.nz/id/nhi&quot;\n* identifier[NHI].value = &quot;ABC1234&quot;\n</code></pre></div>\n\n\n<p>Error:</p>\n<div class=\"codehilite\"><pre><span></span><code>error Cannot fix this element using a pattern; as it is already fixed in the StructureDefinition using fixedUri. Since fixed[x] requires exact matches, while pattern[x] allows for variation in unspecified properties, fixed[x] cannot be replaced by pattern[x] since it would loosen the constraint.\n</code></pre></div>",
        "id": 195914107,
        "sender_full_name": "David Hay",
        "timestamp": 1588288519
    },
    {
        "content": "<p>Yeah, looks like the same issue to me! We are working on a fix, and will test out to see how it works with the examples you gave above.</p>",
        "id": 195953536,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1588333745
    },
    {
        "content": "<p>This should be fixed in SUSHI 0.12.5 <a href=\"https://github.com/FHIR/sushi/releases/tag/v0.12.5\" title=\"https://github.com/FHIR/sushi/releases/tag/v0.12.5\">https://github.com/FHIR/sushi/releases/tag/v0.12.5</a></p>",
        "id": 196011566,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1588368059
    }
]