[
    {
        "content": "<p>I am attempting to create an extension.  The extensions is a bit unusual for me, in that this is the first time I have created an extension that uses a metadata   type instead of a primitive or general-purpose  type.  In this case the ParameterDefinition profile.  I am attempting to add a measure-parameter-definition extension to the my measure profile.</p>\n<p>This appears to work, sushi compiles successfully, and IG is produced. However when I create an example, it throws an error when the profiler is Generating Narratives for the example.</p>\n<p>Error I'm getting is: <br>\nGenerating Narratives<br>\norg.apache.commons.lang3.NotImplementedException: type org.hl7.fhir.r5.model.ParameterDefinition not handled - should not be here</p>\n<p><a href=\"/user_uploads/10155/IrgiwLaEMZfta_Nyz3vYk1RX/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/IrgiwLaEMZfta_Nyz3vYk1RX/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/IrgiwLaEMZfta_Nyz3vYk1RX/image.png\"></a></div><p>The IG publishes with the error, but does have a nice red section on the example html page where the narrative is normally displayed.  Not so much worried about that, but more concerned about other consequences we might encounter later.</p>\n<p>A few questions on this:<br>\n1) Is there anything wrong with my approach?  Is there any problem with using meta-data types  as an extension value in this way?<br>\n2) Am I doing it correctly?<br>\n3) Will the narrative error result in any other issues when using this profile, or is it just a bug with the narrative generation?</p>\n<p>Here is my stripped down fsh code to reproduce the error:</p>\n<div class=\"codehilite\"><pre><span></span><code>Extension:      MeasureParameterDefinition\nId:             measure-parameter-definition\nTitle:          &quot;Measure Parameter Definition&quot;\n* value[x] only ParameterDefinition\n\nProfile:        QualityMeasure\nParent:         Measure\nId:             quality-measure\nTitle:          &quot;Quality Measure&quot;\n* extension contains MeasureParameterDefinition named measureParameterDefinition 0..*\n\nInstance:       QualityMeasureExample\nInstanceOf:     QualityMeasure\nUsage:          #example\nTitle:          &quot;Quality Measure Example&quot;\n* status = #active\n* extension[measureParameterDefinition].valueParameterDefinition.name = #measurePeriod\n* extension[measureParameterDefinition].valueParameterDefinition.use = #out\n* extension[measureParameterDefinition].valueParameterDefinition.type = #Period\n</code></pre></div>\n<p>Thank you!</p>",
        "id": 229510983,
        "sender_full_name": "Stuart Cox",
        "timestamp": 1615308921
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"285362\">@Stuart Cox</span>.  To answer your questions:</p>\n<p>1) I don't see anything wrong with your approach.  The <a href=\"http://hl7.org/fhir/R4/extensibility.html#extension\">definition of Extension</a> shows that <code>value[x]</code> is an <a href=\"http://hl7.org/fhir/R4/datatypes.html#open\">open type element</a>, which allows <code>ParameterDefinition</code> -- so I don't see any reason why you shouldn't be able to use it.  In fact, that extension definition (previously linked) even lists <code>valueParameterDefinition</code> as a valid instantiated value name.</p>\n<p>2) I think you are doing it correctly.  The FSH looks valid and the FHIR it produces looks valid too (at least to me).</p>\n<p>3) This seems like it is just a bug with narrative generation, but I'm not an expert in the inner workings of the IG Publisher, so I'd want <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> to confirm that. Grahame -- if you want to see the resulting FHIR definitions, click <a href=\"https://fshschool.org/FSHOnline/#/share/3bteTXG\">this link</a> to view it in FSH Online and then click the \"Run\" button.</p>",
        "id": 229520696,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1615312065
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> for your quick response.   Love the FSH online tool!</p>",
        "id": 229530479,
        "sender_full_name": "Stuart Cox",
        "timestamp": 1615315451
    }
]