[
    {
        "content": "<p>I have a compound extension and when one of the sub-extensions is hit with an invariant, sushi is slicing that extension.  That's a problem as that causes the invariant to fail and renders the actual json version invalid.</p>",
        "id": 251265435,
        "sender_full_name": "David Pyke",
        "timestamp": 1630345192
    },
    {
        "content": "<p>Source code is here: <a href=\"https://github.com/Carequality/CEQSubscription/\">https://github.com/Carequality/CEQSubscription/</a></p>",
        "id": 251265653,
        "sender_full_name": "David Pyke",
        "timestamp": 1630345311
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> ?</p>",
        "id": 251267156,
        "sender_full_name": "David Pyke",
        "timestamp": 1630345938
    },
    {
        "content": "<p>I don't have a moment to look at this right now, but I can see if someone else on the SUSHI team has time.  Can you be more specific about where we should be looking in that IG?  Like what extension and where?</p>",
        "id": 251269554,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1630346895
    },
    {
        "content": "<p>The error from Forge is in this <a href=\"/user_uploads/10155/O5Ys1zCbo2McoAiRi1c-Zf6-/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/O5Ys1zCbo2McoAiRi1c-Zf6-/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/O5Ys1zCbo2McoAiRi1c-Zf6-/image.png\"></a></div>",
        "id": 251270114,
        "sender_full_name": "David Pyke",
        "timestamp": 1630347117
    },
    {
        "content": "<p>Having the slice in place prevents the invariant.  and we don't want it sliced, just forced valueString</p>",
        "id": 251270318,
        "sender_full_name": "David Pyke",
        "timestamp": 1630347198
    },
    {
        "content": "<p>So you are putting an invariant on <code>valueString</code>?  If you specify a choice path in SUSHI using the specific type-based path (e.g., <code>valueString</code>), then SUSHI automatically applies type-slicing in order to create an element for that specific path.  This is <em>necessary</em> for choices that have not been constrained to a single type -- but not so necessary if the choice has been constrained to a single type already.  Still, SUSHI does it as a general rule whenever you access a specific choice type like that.  To get around it, apply your invariant directly to <code>value[x]</code> rather than <code>valueString</code>.</p>",
        "id": 251272144,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1630347929
    },
    {
        "content": "<p>(Quickly guessing based on screenshot above.  Let me know if I misunderstood it or assumed something I should not have assumed).</p>\n<p>EDIT: This wasn't the issue at all.  Ignore above.</p>",
        "id": 251272280,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1630347983
    },
    {
        "content": "<p>I had it on value, but not value[x], but the issue remained.  Having it on valueString, didnt' help.</p>",
        "id": 251275411,
        "sender_full_name": "David Pyke",
        "timestamp": 1630349244
    },
    {
        "content": "<p>If there's someone I can work with, I'd be glad too.</p>",
        "id": 251275475,
        "sender_full_name": "David Pyke",
        "timestamp": 1630349278
    },
    {
        "content": "<p>i think it's your invariant - extension('ceqPushExtension') is asserting the URL of the extension is ceqPushExtension when it's actually '<a href=\"https://sequoiaproject.org/fhir/push-r4/StructureDefinition/CEQextension\">https://sequoiaproject.org/fhir/push-r4/StructureDefinition/CEQextension</a>'</p>",
        "id": 251276019,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1630349504
    },
    {
        "content": "<p>I've tried both, ceqPushExtension and CEQextension, still get the problem.</p>",
        "id": 251276112,
        "sender_full_name": "David Pyke",
        "timestamp": 1630349533
    },
    {
        "content": "<p>It's only the Forge warning that's giving me any idea of what might be wrong.</p>",
        "id": 251276174,
        "sender_full_name": "David Pyke",
        "timestamp": 1630349569
    },
    {
        "content": "<p>well, when I changed it as above, I don't get the error anymore:</p>\n<div class=\"codehilite\"><pre><span></span><code>Invariant:  CEQ-Param-Name\nDescription: &quot;searchParamName shall be Patient or PatientID&quot;\nExpression: &quot;extension(&#39;https://sequoiaproject.org/fhir/push-r4/StructureDefinition/CEQextension&#39;).extension(&#39;searchParamName&#39;).value in ( &#39;Patient&#39; | &#39;PatientID&#39; )&quot;\nSeverity:   #error\n</code></pre></div>",
        "id": 251276483,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1630349707
    },
    {
        "content": "<p>I hadn't tried it with using the full URL.</p>",
        "id": 251277070,
        "sender_full_name": "David Pyke",
        "timestamp": 1630349943
    },
    {
        "content": "<p>I'll pass that on to the people implementing and see if it makes their lives better!  Thanks!</p>",
        "id": 251277371,
        "sender_full_name": "David Pyke",
        "timestamp": 1630350046
    }
]