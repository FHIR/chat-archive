[
    {
        "content": "<p>Hi! I've been playing around with the Mapping feature a bit and have found an issue. Not sure if this is due to incorrect usage from my part, a known limitation or bug, but I thought I'd post here and find out.</p>\n<p>I'm trying to put a mapping on a specific type of value[x], in this case in an extension. Have not tried on a native value[x]. The path seems to map incorrectly causing IG-publisher to fail in snapshot generation. </p>\n<p>Including a sample fsh-file below that provokes the result.</p>\n<div class=\"codehilite\"><pre><span></span>Profile: IssueProfile\nParent: http://hl7.org/fhir/StructureDefinition/Basic\nId: issue-report\nTitle: &quot;IssueReport&quot;\n\n* extension contains IssueExtension named issue 1..1 MS\n\nExtension: IssueExtension\nId: issue-extension\nTitle: &quot;IssuePeriod&quot;\n* ^context.expression = &quot;Basic&quot;\n* value[x] only Period\n* valuePeriod 1..1 MS\n\nMapping:  IssueMapping\nSource:   IssueProfile\nTarget:   &quot;http://something&quot;\nTitle:    &quot;...&quot;\nId:       issue-mapping\n* extension[issue].valuePeriod.start -&gt; &quot;Should have path Basic.extension:issue.value[x]:valuePeriod.start gets Basic.extension:issue.valuePeriod.start&quot;\n</pre></div>",
        "id": 191620318,
        "sender_full_name": "Pétur Valdimarsson",
        "timestamp": 1585061471
    },
    {
        "content": "<p>Oh good find! This is something we haven't seen before, but I'm not sure it is specific to Mappings alone. I was able to get a similar looking error using the following FSH:</p>\n<div class=\"codehilite\"><pre><span></span>Profile: IssueProfile\nParent: http://hl7.org/fhir/StructureDefinition/Basic\nId: issue-report\nTitle: &quot;IssueReport&quot;\n* extension contains IssueExtension named issue 1..1 MS\n// * extension[issue].valuePeriod MS\n* extension[issue].valuePeriod.start MS\n\nExtension: IssueExtension\nId: issue-extension\nTitle: &quot;IssuePeriod&quot;\n* ^context.expression = &quot;Basic&quot;\n* value[x] only Period\n* valuePeriod 1..1\n</pre></div>\n\n\n<p>where the  offending line is <code>* extension[issue].valuePeriod.start MS</code>. However, if the line above that, <code>* extension[issue].valuePeriod MS</code> is uncommented, then the IG Publisher does not give any errors. This seems like it could be an issue with the IG Publisher failing to find the nested element unless the parent of that nested element is also in the differential.</p>\n<p>One possible workaround for you is to add a line to the mapping  that maps  <code>extension[issue].valuePeriod</code>:</p>\n<div class=\"codehilite\"><pre><span></span>* extension[issue].valuePeriod -&gt; &quot;This should work now&quot;\n</pre></div>\n\n\n<p>Another possible solution would be to apply the mapping to the <code>IssueExtension</code> directly instead of applying via IssueProfile:</p>\n<div class=\"codehilite\"><pre><span></span>Mapping:  IssueMapping\nSource:   IssueExtension\nTarget:   &quot;http://something&quot;\nTitle:    &quot;...&quot;\nId:       issue-mapping\n* valuePeriod.start -&gt; &quot;Should have path Basic.extension:issue.value[x]:valuePeriod.start gets Basic.extension:issue.valuePeriod.start&quot;\n</pre></div>",
        "id": 191642410,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1585069592
    },
    {
        "content": "<p>I submitted an issue for this <a href=\"https://github.com/FHIR/sushi/issues/293\" target=\"_blank\" title=\"https://github.com/FHIR/sushi/issues/293\">https://github.com/FHIR/sushi/issues/293</a>, since I still think we need to dive a bit deeper and figure out if this is an issue on our end, the IG Publisher's end, or some mixture of the two.</p>",
        "id": 191642877,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1585069805
    },
    {
        "content": "<p>In theory, the publisher supports sparse differentials -- but I think it does require some gaps to be filled when you're talking about paths w/ slices.  It <em>might</em> be a publisher issue, but I'm guessing that maybe we just need to detect this situation in SUSHI and generate the intermediate differential element for <code>extension[issue].valuePeriod</code>.</p>",
        "id": 191646905,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585071456
    },
    {
        "content": "<p>Thanks for the swift reply and workaround! Will continue playing around and I'll let you know if I find other issues.</p>",
        "id": 191648878,
        "sender_full_name": "Pétur Valdimarsson",
        "timestamp": 1585072318
    },
    {
        "content": "<p>Oh.  That.  It's fixed locally.  I don't <em>think</em> it made it into a release yet?  Maybe today?</p>",
        "id": 192796797,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585917591
    }
]