[
    {
        "content": "<p>I'm trying to reverse engineer an existing Extension into FSH.</p>\n<p>The differential of the existing extension (created via Forge is<br>\n<a href=\"/user_uploads/10155/US_Buz3-NZt9IrxgKZe2qQF8/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/US_Buz3-NZt9IrxgKZe2qQF8/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/US_Buz3-NZt9IrxgKZe2qQF8/image.png\"></a></div><p>The FSH so far is very simple (removed all the metadata lines for simplicity)</p>\n<div class=\"codehilite\"><pre><span></span><code>* value[x] only Reference\n</code></pre></div>\n\n\n<p>Problems<br>\n(1) How do I set the target profile (Line 69) - I tried  <code> * value[x] only Reference(\"https://fhir.nhs.uk/R4/StructureDefinition/UKCore-Location\") </code> but taht created errors</p>\n<p>(2) How do I set the \"short\" , \"definition\" and cardinality for the extension element?</p>\n<p>(3) Any ideas on how I achieve lines 74-85?</p>\n<p>I took a look examples I could see on GitHub but they seemed to have much simpler definitions.</p>\n<p>Thanks.</p>",
        "id": 198965737,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1590621501
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> , have you looked at PDEX Plan-Net extensions? There are plenty of complex ones: <a href=\"https://github.com/HL7/davinci-pdex-plan-net/blob/master/fsh/Extensions.fsh\">https://github.com/HL7/davinci-pdex-plan-net/blob/master/fsh/Extensions.fsh</a></p>",
        "id": 198966008,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1590621710
    },
    {
        "content": "<p>Also, there was a hint recently that if you wish to set \"short\" of a profile or extension you can use \". ^short\", e.g.</p>\n<ul>\n<li>. ^short = \"My Profile's Short Description\"</li>\n</ul>",
        "id": 198966283,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1590621863
    },
    {
        "content": "<p>Great tips, <span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span>!  Here are a few more:</p>\n<p>(1) There are a few ways to create a reference to a profile... if the thing you're referring to is defined in the same IG as your extension, you can refer to it by name (e.g., <code>Reference(UKCoreLocation)</code>).  If it's external to your IG, it needs to be from FHIR core or from one of your declared dependencies.  Assuming that's the case, you should be able to refer to it by URL <em>without</em> quotation marks (e.g., <code>Reference(https://fhir.nhs.uk/R4/StructureDefinition/UKCore-Location)</code>) or define an alias to the URL and refer to it by that (e.g., <code>Reference($UKCoreLocation)</code>).</p>\n<p>(2) As Igor suggested, you can use the <code>.</code> path to refer to the root element.  So you'd be looking at something like:</p>\n<div class=\"codehilite\"><pre><span></span><code>* . 1..1\n* . ^short = &quot;Main location&quot;\n* . ^definition = &quot;The main location of the organisation.&quot;\n</code></pre></div>\n\n\n<p>(3) To get it to come out exactly like the JSON you posted, I think you should be able to do:</p>\n<div class=\"codehilite\"><pre><span></span><code>* value[x].identifier.assigner only Reference(https://fhir.nhs.uk/R4/StructureDefinition/UKCore-Organization)\n</code></pre></div>\n\n\n<p>You might need the latest SUSHI (0.12.7 or 0.13.0-beta.2) for that one to work though.  Another approach that I think is also valid (but would result in slightly different JSON) is:</p>\n<div class=\"codehilite\"><pre><span></span><code>* valueReference.identifier.assigner only Reference(https://fhir.nhs.uk/R4/StructureDefinition/UKCore-Organization)\n</code></pre></div>\n\n\n<p>BTW -- I can't help but notice that this extension cannot decide if organization has an <em>s</em> or a <em>z</em>.</p>",
        "id": 198971138,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590626109
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  re the spelling issues <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span>  if only they were the only issues in the profiles. Attention to detail is not a forte of the developers of the profiles.</p>",
        "id": 198992073,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1590652214
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> thanks for the help and the links to the davinci ig - very useful</p>",
        "id": 198992158,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1590652316
    },
    {
        "content": "<p>Based on the help received I think I am close enough. There are a few differences within the resulting StructureDefinition as the output is not sparse like that produced from Forge. I'm not 100% sure about the following part as it appears that SUSHI is making assumptions as it was never declared.</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Extension.extension&quot;,\n        &quot;path&quot;: &quot;Extension.extension&quot;,\n        &quot;max&quot;: &quot;0&quot;\n      },\n</code></pre></div>\n\n\n<p>For info the final FSH used was</p>\n<div class=\"codehilite\"><pre><span></span><code>Extension: ExtensionUKCoreMainLocation\nId: Extension-UKCore-MainLocation\nTitle: &quot;Extension UK Core Main Location&quot;\nDescription: &quot;An extension to support a reference to the main location for an organisation.&quot;\n* ^publisher = &quot;NHS Digital&quot;\n* ^copyright = &quot;Copyright Â© 2019 NHS Digital&quot;\n* ^date =  &quot;2019-12-06T00:00:00+00:00&quot;\n* ^status = #draft\n* ^contact[0].name = &quot;Interoperability Team&quot;\n* ^contact[0].telecom.system = #email\n* ^contact[0].telecom.value = &quot;interoperabilityteam@nhs.net&quot;\n* ^contact[0].telecom.use = #work\n* ^context.expression = #Organization\n\n* . 0..1\n* . ^short = &quot;Main location&quot;\n* . ^definition = &quot;The main location of the organisation.&quot;\n\n* value[x] only Reference(https://fhir.nhs.uk/R4/StructureDefinition/UKCore-Organization)\n* value[x] 1..1\n* value[x] ^short = &quot;Main location&quot;\n* value[x] ^definition = &quot;Reference to the main location for an organization.&quot;\n* value[x].identifier.assigner only Reference(https://fhir.nhs.uk/R4/StructureDefinition/UKCore-Organization)\n</code></pre></div>\n\n\n<p>This yielded the following which is close enough for me :-)</p>\n<div class=\"codehilite\"><pre><span></span><code> &quot;differential&quot;: {\n    &quot;element&quot;: [\n      {\n        &quot;id&quot;: &quot;Extension&quot;,\n        &quot;path&quot;: &quot;Extension&quot;,\n        &quot;short&quot;: &quot;Main location&quot;,\n        &quot;definition&quot;: &quot;The main location of the organisation.&quot;,\n        &quot;max&quot;: &quot;1&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Extension.extension&quot;,\n        &quot;path&quot;: &quot;Extension.extension&quot;,\n        &quot;max&quot;: &quot;0&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Extension.url&quot;,\n        &quot;path&quot;: &quot;Extension.url&quot;,\n        &quot;fixedUri&quot;: &quot;https://fhir.nhs.uk/R4/StructureDefinition/Extension-UKCore-MainLocation&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Extension.value[x]&quot;,\n        &quot;path&quot;: &quot;Extension.value[x]&quot;,\n        &quot;short&quot;: &quot;Main location&quot;,\n        &quot;definition&quot;: &quot;Reference to the main location for an organization.&quot;,\n        &quot;min&quot;: 1,\n        &quot;type&quot;: [\n          {\n            &quot;code&quot;: &quot;Reference&quot;,\n            &quot;targetProfile&quot;: [\n              &quot;https://fhir.nhs.uk/R4/StructureDefinition/UKCore-Organization&quot;\n            ]\n          }\n        ]\n      },\n      {\n        &quot;id&quot;: &quot;Extension.value[x].identifier&quot;,\n        &quot;path&quot;: &quot;Extension.value[x].identifier&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Extension.value[x].identifier.assigner&quot;,\n        &quot;path&quot;: &quot;Extension.value[x].identifier.assigner&quot;,\n        &quot;type&quot;: [\n          {\n            &quot;code&quot;: &quot;Reference&quot;,\n            &quot;targetProfile&quot;: [\n              &quot;https://fhir.nhs.uk/R4/StructureDefinition/UKCore-Organization&quot;\n            ]\n          }\n        ]\n      }\n    ]\n  }\n</code></pre></div>",
        "id": 198992530,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1590652613
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  Thanks for your help - this is to be used for some examples for a talk with HL7 UK next month. I think (hope) there will be a lot of interest over here with suppliers who need to create profiles and/or terminology products</p>",
        "id": 198992673,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1590652721
    },
    {
        "content": "<p>The reason SUSHI automatically does:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Extension.extension&quot;,\n        &quot;path&quot;: &quot;Extension.extension&quot;,\n        &quot;max&quot;: &quot;0&quot;\n      },\n</code></pre></div>\n\n\n<p>is because this is implied by <code>value[x]</code> being <code>1..1</code>. Since an extension cannot have both  a value and extensions, when you make the <code>value[x] 1..1</code>, this implicitly means that extension cannot have extension on it, so SUSHI makes it <code>0..0</code>, so that this is explicit.</p>",
        "id": 199011356,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1590666643
    }
]