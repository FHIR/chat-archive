[
    {
        "content": "<p>I'm struggling to get the IG publisher to accept a markdown-only IG that was processed using sushi.  Right now the IG publisher is complaining about the presence of an <code>implementationguide-page</code> extension on an example resource, which appears in the sushi-generated output.  So, I'm thinking sushi is putting this extension there and it shouldn't - but I don't understand what it is or why it's there (or how to suppress it).</p>\n<p>Here's the exact set of errors from the publisher's <code>qa.html</code> page:</p>\n<div class=\"codehilite\"><pre><span></span><code>/Users/can/code/smart-web-messaging/docs/ImplementationGuide-hl7.fhir.smart-web-messaging.xml\n    Path        ImplementationGuide/hl7.fhir.smart-web-messaging: ImplementationGuide.definition.resource[0].extension[1]\n    Severity    error\n    Message     The extension http://hl7.org/fhir/StructureDefinition/implementationguide-page is unknown, and not allowed here\n    Path        ImplementationGuide/hl7.fhir.smart-web-messaging: ImplementationGuide.definition.resource[0].extension[1].url\n    Severity    error\n    Message     URL value &quot;http://hl7.org/fhir/StructureDefinition/implementationguide-page&quot; does not resolve\n</code></pre></div>\n\n\n<p>I have this in my <code>config.yaml</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"nt\">resources</span><span class=\"p\">:</span>\n  <span class=\"nt\">Patient/example</span><span class=\"p\">:</span>\n    <span class=\"nt\">exampleBoolean</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">true</span>\n    <span class=\"nt\">name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">Ignore</span>\n    <span class=\"nt\">description</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">Ignore</span>\n</code></pre></div>\n\n\n<p>And I have this in my fish tank at <code>fsh/ig-data/input/examples/patient-example.json</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Patient&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;example&quot;</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n\n<p>I'm using the latest versions of sushi <code>v0.14.0</code> and the publisher.jar <code>v1.1.2</code>.</p>\n<p>After running sushi, these are all the files that contain the <code>implementationguide-page</code> token that the publisher is complaining about.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"go\">can@msft-mbp ~/code/work/ig/build (master) $ find . -type f | xargs grep -l &#39;implementationguide-page&#39;</span>\n<span class=\"go\">./temp/qa/ImplementationGuide-hl7.fhir.smart-web-messaging-xml-html.html</span>\n<span class=\"go\">./temp/qa/ImplementationGuide-hl7.fhir.smart-web-messaging-json-html.html</span>\n<span class=\"go\">./temp/qa/ImplementationGuide-hl7.fhir.smart-web-messaging-ttl-html.html</span>\n<span class=\"go\">./temp/pages/_includes/ImplementationGuide-hl7.fhir.smart-web-messaging.escaped.json</span>\n<span class=\"go\">./temp/pages/_includes/ImplementationGuide-hl7.fhir.smart-web-messaging-json-html.xhtml</span>\n<span class=\"go\">./temp/pages/_includes/ImplementationGuide-hl7.fhir.smart-web-messaging.json</span>\n<span class=\"go\">./temp/pages/_includes/ImplementationGuide-hl7.fhir.smart-web-messaging-ttl-html.xhtml</span>\n<span class=\"go\">./temp/pages/_includes/ImplementationGuide-hl7.fhir.smart-web-messaging-xml-html.xhtml</span>\n<span class=\"go\">./temp/pages/ImplementationGuide-hl7.fhir.smart-web-messaging.ttl</span>\n<span class=\"go\">./temp/pages/ImplementationGuide-hl7.fhir.smart-web-messaging.xml</span>\n<span class=\"go\">./temp/pages/ImplementationGuide-hl7.fhir.smart-web-messaging.json</span>\n<span class=\"go\">./template/onGenerate-ig-working.1.xml</span>\n<span class=\"go\">./template/onGenerate-ig-working.xml</span>\n<span class=\"go\">./template/onGenerate-ig-updated.xml</span>\n<span class=\"go\">./template/scripts/onGenerate.data.xslt</span>\n<span class=\"go\">./template/scripts/createArtifactSummary.xslt</span>\n<span class=\"go\">./template/scripts/onGenerate.final.xslt</span>\n<span class=\"go\">./template/onGenerate-ig-working.json</span>\n<span class=\"go\">./output/ImplementationGuide-hl7.fhir.smart-web-messaging.ttl</span>\n<span class=\"go\">./output/ImplementationGuide-hl7.fhir.smart-web-messaging.xml</span>\n<span class=\"go\">./output/ImplementationGuide-hl7.fhir.smart-web-messaging.json</span>\n</code></pre></div>\n\n\n<p>Finally, this is the resource generated in the json IG:</p>\n<div class=\"codehilite\"><pre><span></span><code>    <span class=\"s2\">&quot;resource&quot;</span><span class=\"err\">:</span> <span class=\"p\">[</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/tools/StructureDefinition/resource-information&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Patient&quot;</span>\n          <span class=\"p\">},</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/implementationguide-page&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;valueUri&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Patient-example.html&quot;</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">],</span>\n        <span class=\"nt\">&quot;reference&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n          <span class=\"nt\">&quot;reference&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Patient/example&quot;</span>\n        <span class=\"p\">},</span>\n        <span class=\"nt\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Ignore&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;description&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Ignore&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;exampleBoolean&quot;</span><span class=\"p\">:</span> <span class=\"kc\">true</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">]</span><span class=\"err\">,</span>\n</code></pre></div>\n\n\n<p>Any ideas what I'm doing wrong here?</p>",
        "id": 203735347,
        "sender_full_name": "Carl Anderson",
        "timestamp": 1594656826
    },
    {
        "content": "<p>This is strange, but those extensions are not coming from sushi. The outputs from sushi are the inputs to the IG Publisher, so sushi builds into the <code>input</code> folder. Note that no <code>implementationguide-page</code> tokens are found in the <code>input</code> folder, but rather in the folders containing the results of the IG Publisher build (<code>temp</code> and <code>output</code>). Sushi generates an ImplementationGuide-id.json file, but then the IG Publisher does its own processing on that file, and that processing does generally include adding those extensions. </p>\n<p>In running some simple testing, I got the same extensions added into my <code>resource</code> array when running a simple IG through the publisher. So I'm not sure what is going on here, since the IG Publisher is seemingly adding that extension and then getting mad that it is there.</p>",
        "id": 203752403,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1594665148
    },
    {
        "content": "<p>Ah, thank you, Nick.  I keep forgetting that the sushi 'output' is called 'input'.</p>",
        "id": 203757465,
        "sender_full_name": "Carl Anderson",
        "timestamp": 1594667458
    },
    {
        "content": "<p>Yeah - that confused me for the longest time too!</p>",
        "id": 203776593,
        "sender_full_name": "David Hay",
        "timestamp": 1594677353
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  It seems this still a current publisher issue that is preventing validation of IGs. Any ideas?</p>",
        "id": 210868647,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1600781002
    },
    {
        "content": "<p>no. how do I reproduce this?</p>",
        "id": 210890923,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600790036
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> or <span class=\"user-mention\" data-user-id=\"239822\">@Nick Freiter</span> can you provide an example for Grahame?</p>",
        "id": 210892118,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1600790482
    },
    {
        "content": "<p>Can I try to understand what you are trying to do <span class=\"user-mention\" data-user-id=\"233081\">@Carl Anderson</span> </p>\n<ul>\n<li>you have a patient resource as an example, and that patient resource has an extension?</li>\n<li>or is the extension in the resource declaration within the IG</li>\n</ul>\n<p>I can't find what is <a href=\"http://hl7.org/fhir/StructureDefinition/implementationguide-page\">http://hl7.org/fhir/StructureDefinition/implementationguide-page</a></p>",
        "id": 210901730,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1600794706
    },
    {
        "content": "<p>What I'm trying to do is - have an IG that doesn't have any resources at all.  To satisfy the publisher tool, I had to have <em>something</em> for it to iterate over, so I gave it an extremely trivial 'throwaway' patient example.</p>",
        "id": 210906851,
        "sender_full_name": "Carl Anderson",
        "timestamp": 1600796886
    },
    {
        "content": "<p>that's not a tooling issue, that's a definitional issue to take up with FHIR-I</p>",
        "id": 210907078,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600797001
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> experienced this error in an IG with plenty of profiles. Here’s a list of the errors you can see if you’re curious: <a href=\"/user_uploads/10155/37gp5r0nJlypEDIrY3DNxS9C/ig-validation-errors.txt\">ig-validation-errors.txt</a></p>",
        "id": 210907621,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1600797239
    },
    {
        "content": "<p>back to my question then: how do I reproduce this?</p>",
        "id": 210907818,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600797316
    },
    {
        "content": "<p>FHIR-I has taken it up and agreed to make resource optional.  Just hasn't been applied yet</p>",
        "id": 210909021,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1600797814
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> - thanks.</p>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> &amp; <span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span> - I'm not sure I can remember how to produce this error, after 2 months.  <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span>  Maybe <span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> can share his details.</p>",
        "id": 210909546,
        "sender_full_name": "Carl Anderson",
        "timestamp": 1600798023
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> reproduction instructions using the mCODE IG are below. </p>\n<ol>\n<li>Download <a href=\"http://hl7.org/fhir/us/mcode/definitions.json.zip\">http://hl7.org/fhir/us/mcode/definitions.json.zip</a> and extract <code>ImplementationGuide-hl7.fhir.us.mcode.json</code></li>\n<li>Run <code>java -jar org.hl7.fhir.validator.jar -version 4.0.0 -ig hl7.fhir.us.mcode#1.0.0 -ig hl7.fhir.us.core ImplementationGuide-hl7.fhir.us.mcode.json</code></li>\n<li>I then see these errors: <a href=\"https://gist.github.com/masnick/5d93d60f9696018821165b02acbcb39b\">https://gist.github.com/masnick/5d93d60f9696018821165b02acbcb39b</a></li>\n</ol>",
        "id": 210982569,
        "sender_full_name": "Max Masnick",
        "timestamp": 1600855920
    },
    {
        "content": "<p>I see the same errors when following the same instructions on a fresh build of the IG from <a href=\"https://github.com/HL7/fhir-mCODE-ig/tree/master\">https://github.com/HL7/fhir-mCODE-ig/tree/master</a>.</p>",
        "id": 210983938,
        "sender_full_name": "Max Masnick",
        "timestamp": 1600856742
    },
    {
        "content": "<p>When I run the validator on the IG output by SUSHI (<code>fhir-mCODE-ig/input/ImplementationGuide-hl7.fhir.us.mcode.json</code>), I get different errors: <a href=\"https://gist.github.com/masnick/8ebb48d9f06a963b708626c9f35affd2\">https://gist.github.com/masnick/8ebb48d9f06a963b708626c9f35affd2</a></p>",
        "id": 210984021,
        "sender_full_name": "Max Masnick",
        "timestamp": 1600856799
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> were you able to reproduce this yourself?</p>",
        "id": 212539969,
        "sender_full_name": "Max Masnick",
        "timestamp": 1602066849
    },
    {
        "content": "<p>I can. <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> This extension come from the template, and is never used by the IGPublisher: <a href=\"http://hl7.org/fhir/StructureDefinition/implementationguide-page\">http://hl7.org/fhir/StructureDefinition/implementationguide-page</a>.  What's going on with this?</p>",
        "id": 212633163,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1602114203
    },
    {
        "content": "<p>The extension is set by the IGPublisher.   It's used by the templates - it indicates the URL for the page associated with the artifact.</p>",
        "id": 212639392,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1602120912
    },
    {
        "content": "<p>It's been in the code since prior to April 2019 - when everything got refactored, making it harder to trace when it was introduced.</p>",
        "id": 212639487,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1602121023
    },
    {
        "content": "<p>ok, well, all existing IGs are affected by this, but new ones won't be from now on</p>",
        "id": 213233644,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1602634781
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> is there a way to resolve this for existing IGs?</p>",
        "id": 213415546,
        "sender_full_name": "Max Masnick",
        "timestamp": 1602764505
    },
    {
        "content": "<p>no. is it an operational issue? validating the IG resource itself is pretty obscure</p>",
        "id": 213418158,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1602765742
    },
    {
        "content": "<p>This is not an operational issue...it was mentioned in a HL7 Jira issue but it's not causing any issues as far as I know.</p>",
        "id": 214110956,
        "sender_full_name": "Max Masnick",
        "timestamp": 1603312433
    }
]