[
    {
        "content": "<p>We are currently having a weird issue. If we are using the german address profile: <a href=\"https://simplifier.net/basisprofil-de-r4/addressdebasis\">https://simplifier.net/basisprofil-de-r4/addressdebasis</a> in profile which slices address we are getting some:  No element found at path address[Postfach].type for CardRule in ISiKPatient, skipping rule errors.</p>",
        "id": 261114126,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636625436
    },
    {
        "content": "<p>address part of profile: </p>\n<div class=\"codehilite\"><pre><span></span><code>* address contains\n    Strassenanschrift 0..* MS and\n    Postfach 0..* MS\n* address[Strassenanschrift] only AddressDeBasis\n  * ^patternAddress.type = #both\n  * type 1.. MS\n* address[Postfach] only AddressDeBasis\n  * ^patternAddress.type = #postal\n  * type 1.. M\n</code></pre></div>",
        "id": 261114160,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636625463
    },
    {
        "content": "<p>if i switch the order of these slices the error goes away</p>",
        "id": 261114197,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636625484
    },
    {
        "content": "<p>there is no ordered slicing applied anywhere</p>",
        "id": 261114213,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636625496
    },
    {
        "content": "<p>I prepared a test project: <a href=\"https://github.com/patrick-werner/testDerivedAddress\">https://github.com/patrick-werner/testDerivedAddress</a></p>",
        "id": 261114234,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636625512
    },
    {
        "content": "<p>Happy to create an issue for this, just wanted to check if this isn't a bug, or if you are already aware of this</p>",
        "id": 261114310,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636625549
    },
    {
        "content": "<p>+1 for looking into this, as it has been affecting me as well.</p>",
        "id": 261121674,
        "sender_full_name": "Yannick BÃ¶rner",
        "timestamp": 1636630349
    },
    {
        "content": "<p>I'll take a look at this later today.  I thought I could fit it in quickly before a meeting, but just realized that since it depends on a Simplifier IG, I'll need to populate the snapshots in my cache.  I've been meaning to try out the new Firely terminal capability for doing this, so I'll give that a try when I have a chunk of time bigger than the seven minutes I currently have before my next meeting.</p>",
        "id": 261271814,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1636732465
    },
    {
        "content": "<p>OK.  I've been able to reproduce this.  Very odd indeed.  I'll debug into it to see if I can figure out what is going on.  Thanks for reporting it!</p>",
        "id": 261315968,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1636753923
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> -- This strange behavior is due to incorrect element ids in the <code>address-de-basis</code> definition that is pulled in from the <code>de.basisprofil.r4</code> dependency.  Here is a listing of all the ids and paths in the snapshot elements for <code>address-de-basis</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code> 0    ID: Address                                  PATH: Address\n 1    ID: Element.id                               PATH: Address.id\n 2    ID:                                          PATH: Address.extension\n 3    ID: Address.extension:Stadtteil              PATH: Address.extension\n 4    ID: Address.use                              PATH: Address.use\n 5    ID: Address.type                             PATH: Address.type\n 6    ID: Address.text                             PATH: Address.text\n 7    ID: Address.line                             PATH: Address.line\n 8    ID: Element.id                               PATH: Address.line.id\n 9    ID:                                          PATH: Address.line.extension\n10    ID: Address.line.extension:Strasse           PATH: Address.line.extension\n11    ID: Address.line.extension:Hausnummer        PATH: Address.line.extension\n12    ID: Address.line.extension:Adresszusatz      PATH: Address.line.extension\n13    ID: Address.line.extension:Postfach          PATH: Address.line.extension\n14    ID: string.value                             PATH: Address.line.value\n15    ID: Address.city                             PATH: Address.city\n16    ID: Address.district                         PATH: Address.district\n17    ID: Address.state                            PATH: Address.state\n18    ID: Address.postalCode                       PATH: Address.postalCode\n19    ID: Address.country                          PATH: Address.country\n20    ID: Address.period                           PATH: Address.period\n21    ID: Element.id                               PATH: Address.period.id\n22    ID: Element.extension                        PATH: Address.period.extension\n23    ID: Address.period.start                     PATH: Address.period.start\n24    ID: Address.period.end                       PATH: Address.period.end\n</code></pre></div>",
        "id": 261319215,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1636755823
    },
    {
        "content": "<p>Note the problems at the following indices from the table above:</p>\n<ul>\n<li>1: id is <code>Element.id</code> but should be <code>Address.id</code></li>\n<li>2: id is missing but should be <code>Address.extension</code></li>\n<li>9: id is missing but should be <code>Address.line.extension</code></li>\n<li>14: id is <code>string.value</code> but should be <code>Address.line.value</code></li>\n<li>21: id is <code>Element.id</code> but should be <code>Address.period.id</code></li>\n<li>22: id is <code>Element.extension</code> but should be <code>Address.period.extension</code></li>\n</ul>\n<p>If you look at <code>address-de-basis</code>'s differential elements, they all have the correct ids -- so this seems to be a bug in the snapshot generation algorithm used by Firely terminal.  I used <code>fhir bake -p de.basisprofil.r4</code> to generate the snapshots into my FHIR cache.</p>",
        "id": 261319697,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1636756190
    },
    {
        "content": "<p>SUSHI uses the ids from the Address profile definition to generate the nested address elements in your Patient profile.  Since the address profile ids are wrong, so are the generated ids in the Patient profile -- which then causes issues w/ SUSHI's ability to find the elements again when it needs to.</p>\n<p>The correct solution to this problem would require the <code>address-de-basis</code> snapshot element ids to be fixed.  Once that's done, it should work well within SUSHI.  While we could potentially fix the ids on import in SUSHI, I'm not sure that would be a fool-proof procedure, and honestly, it would just be covering up a problem that needs to be addressed anyway.</p>",
        "id": 261320108,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1636756515
    },
    {
        "content": "<p>Thanks for the analysis <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span></p>",
        "id": 261415895,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636894554
    },
    {
        "content": "<p>Yes bake in firely terminal isn't working correctly at the moment. Thats why i used a snapshotted package downloaded from simplifier (which doesn't include missing ids as far as i checked)</p>",
        "id": 261416288,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636895118
    },
    {
        "content": "<p>i pushed the snapshotted package to the repo as well: <a href=\"https://github.com/patrick-werner/testDerivedAddress/blob/master/de.basisprofil.r4-1.1.0.tgz\">https://github.com/patrick-werner/testDerivedAddress/blob/master/de.basisprofil.r4-1.1.0.tgz</a></p>",
        "id": 261416458,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636895392
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> -- are you still getting those errors with the corrected (downloaded) package?  Or did using the package w/ correct snapshots fix the issue for you?</p>",
        "id": 261521363,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1636993492
    },
    {
        "content": "<p>i actually never used bake, but went with the spapshotted package from Simplifier (i also added this to the repo)</p>",
        "id": 261528860,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636996694
    },
    {
        "content": "<p>And i am getting theses errors on a snapshotted package with correct ids</p>",
        "id": 261528906,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1636996720
    },
    {
        "content": "<p>OK, thanks.  Then I'll take a look at this again.</p>",
        "id": 261538196,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1637000495
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> -- I've found the bug and logged it <a href=\"https://github.com/FHIR/sushi/issues/956\">here</a>.  I have a local fix that appears to be working, but I need to run it through regression before submitting a PR for it.</p>",
        "id": 261692829,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1637090476
    },
    {
        "content": "<blockquote>\n<p>The correct solution to this problem would require the address-de-basis snapshot element ids to be fixed. Once that's done, it should work well within SUSHI.</p>\n</blockquote>\n<p>I am trying to figure out which snapshot generator has created the ones on <code>address-de-basis</code>. If that's SImplifier, I expect bake to do exactly the same thing. If they differ, that would be really interesting. As far as I know the id-generation algo hasn't been changed the last 18 monts at least, but we'll take a look.</p>",
        "id": 261761602,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1637142161
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> , snapshots WITH ids were coming from Simplifier, the one with missing IDs comes from fhir bake.</p>",
        "id": 261764696,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1637143987
    },
    {
        "content": "<p>Both using different versions of the .net API (already confirmed the issue with <span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> and <span class=\"user-mention\" data-user-id=\"260054\">@Yannick BÃ¶rner</span> )</p>",
        "id": 261764734,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1637144015
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191469\">Chris Moesel</span> <a href=\"#narrow/stream/215610-shorthand/topic/Bug.3A.20No.20element.20found.20at.20path/near/261692829\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191451\">Patrick Werner</span> -- I've found the bug and logged it <a href=\"https://github.com/FHIR/sushi/issues/956\">here</a>.  I have a local fix that appears to be working, but I need to run it through regression before submitting a PR for it.</p>\n</blockquote>\n<p>Thank you!<br>\nWould it be easier for you if i directly create issues?</p>",
        "id": 261764856,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1637144080
    },
    {
        "content": "<p>HI Patrick, thanks - not necessary for this one anymore as Alex and Yannick are on it, and you caught my attention now too ;-)</p>",
        "id": 261768344,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1637146247
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> -- when we release SUSHI updates, we like to point to GitHub issues that it resolves.  So we will typically create issues for anything reported on Zulip (if it is a real bug).  If you create the issue yourself, that does help a little -- but honestly, it's not hard for us to do it either.  So no big deal either way.</p>",
        "id": 261787523,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1637157741
    },
    {
        "content": "<p>We found the issue in Firely Terminal. Will be fixed in the next release, most likely this week.</p>",
        "id": 261794556,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1637160737
    },
    {
        "content": "<p>It has been posted on other channels, but a fix has been released for this issue (beta) for Firely Terminal<br>\n<a href=\"https://www.nuget.org/packages/Firely.Terminal/2.5.0-beta-2\">https://www.nuget.org/packages/Firely.Terminal/2.5.0-beta-2</a></p>",
        "id": 263408604,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1638435659
    },
    {
        "content": "<p>Was the issue with the location of the .fhir folder also fixed?</p>",
        "id": 263420739,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1638442842
    },
    {
        "content": "<p>Fixed in latest beta release (2.5.0-beta-2)</p>",
        "id": 263421005,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1638443033
    }
]