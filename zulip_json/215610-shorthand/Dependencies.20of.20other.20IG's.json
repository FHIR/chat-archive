[
    {
        "content": "<p>I am trying to establish a link between my new fsh/sushi project and a set of core profiles that I have developed earlier.</p>\n<p>I have used Simplifier to create a package from the profiles, valuesets and codesystems etc in my core profiles. and published it on <a href=\"https://simplifier.net/packages\">https://simplifier.net/packages</a> which is in my understanding equivalent to <a href=\"http://packages.fhir.org\">packages.fhir.org</a> - however, I have seen that other refer to <a href=\"https://build.fhir.org/ig/qas.json\">https://build.fhir.org/ig/qas.json</a> as well, as a place to look up packages. Anyway: My package, dk.fhir.ig.kl.common.caresocial, seems to be available all these places. It also has an implementation guide: <a href=\"http://build.fhir.org/ig/hl7dk/KL-dk/\">http://build.fhir.org/ig/hl7dk/KL-dk/</a></p>\n<p>I declare the dependency in my config.yaml file like this:<br>\ndependencies:<br>\ndk.fhir.ig.kl.common.caresocial: 0.1.7                  //(I have also tried with other versions e.g. 0.1.6 , dev and current)</p>\n<p>Then I want to use the core-profiles in my new project e.g. using my core-profile KLCommonCareSocialObservation as a parent, e.g.</p>\n<p>Profile: KLToolsCareRSS<br>\nParent: KLCommonCareSocialObservation<br>\nTitle: \"KLToolsCareRSS\"<br>\nDescription: \"Thirty second chair stand test score, as performed in Danish municipalities\"</p>\n<ul>\n<li>code = SCT#450738001</li>\n<li>value[x] only integer</li>\n<li>valueInteger 1..1</li>\n</ul>\n<p>I have also tried using the canonical url as a parent as well i.e. <a href=\"http://kl.dk/fhir/common/caresocial/StructureDefinition/KLCommonCareSocialObservation\">http://kl.dk/fhir/common/caresocial/StructureDefinition/KLCommonCareSocialObservation</a><br>\nAnd I have tried to declare a dependency to a package that I have not published myself (wondering if anything was wrong with my package)</p>\n<p>No matter what I do, sushi does not \"know\" the parent  - the error message simply states \"Parent KLCommonCareSocialObservation not found for KLToolsCareRSS\"</p>\n<p>What might be wrong?</p>",
        "id": 214847261,
        "sender_full_name": "Kirstine Rosenbeck GÃ¸eg",
        "timestamp": 1603896875
    },
    {
        "content": "<p>I've tested this out, and find that I am able to use this package if I use version <code>0.1.6</code>, so my <code>dependencies</code> looks like:</p>\n<div class=\"codehilite\"><pre><span></span><code>dependencies:\n  dk.fhir.ig.kl.common.caresocial: 0.1.6\n</code></pre></div>\n\n\n<p>Note that that the indentation before <code>dk.fhir.ig.kl.common.caresocial: 0.1.6</code> is significant, the dependency will not be found if that indentation is not present.</p>\n<p>I've found that using <code>0.1.7</code> does not work for me, but I believe this may be due to a slight issue with the package. When I download the <code>0.1.7</code> version from <a href=\"http://packages.fhir.org/dk.fhir.ig.kl.common.caresocial\">http://packages.fhir.org/dk.fhir.ig.kl.common.caresocial</a>, the  <code>ImplementationGuide-dk.fhir.ig.kl.common.caresocial.json</code> resource has its <code>version</code> set to <code>0.1.6</code>. So SUSHI is unable to find an <code>ImplementationGuide</code> resource in this package with a <code>version</code> corresponding to the expected version, <code>0.1.7</code>.  If this is happening, I would expect that you should see an error like:<br>\n<a href=\"/user_uploads/10155/_wWhkwgjNi2Ltr-Vc2Z20UFz/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/_wWhkwgjNi2Ltr-Vc2Z20UFz/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/_wWhkwgjNi2Ltr-Vc2Z20UFz/image.png\"></a></div><p>Do you see any errors when you run SUSHI?</p>",
        "id": 214852453,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1603898850
    },
    {
        "content": "<p>It does appear also that using <code>current</code> as a version works for me. The <code>current</code> version is the one that uses <a href=\"http://build.fhir.org\">build.fhir.org</a> to get whatever version of the IG has most recently been built to there.</p>",
        "id": 214853784,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1603899356
    },
    {
        "content": "<p>I'm running into an issue with  dependency released on Simplifier.</p>",
        "id": 224721338,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612184356
    },
    {
        "content": "<p><a href=\"https://simplifier.net/Einwilligungsmanagement/~packages\">https://simplifier.net/Einwilligungsmanagement/~packages</a><br>\nde.einwilligungsmanagement 0.0.4-snapshot</p>",
        "id": 224721399,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612184392
    },
    {
        "content": "<p>This is caused by simplifier still not properly syncing its packages to the FHIR registry.</p>",
        "id": 224721472,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612184416
    },
    {
        "content": "<p>I couldn't find a way to get this work. Pointing to the downloaded package is not an option, right?</p>",
        "id": 224721497,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612184440
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span>.  Currently, you cannot point at a specific package file on disk to have SUSHI load it -- although that is an interesting idea!  Do you know if the IG Publisher supports pointing at arbitrary packages this way?  I don't see anything in <code>ImplementationGuide.dependsOn</code> that would allow for this, so I'm a little skeptical.  We likely would not want to support it in SUSHI if it still failed at the IG Publisher step anyway.</p>\n<p>I've just tested this myself for the package you listed.  I see that while SUSHI can download the package, the package it downloads from the registry does not have the <code>snapshot</code> elements populated, so SUSHI cannot use it.  I was able to get things working by downloading the full package from Simplifier (which <em>does</em> have the snapshots) and adding/replacing the <code>de.einwilligungsmanagement#0.0.4-snapshot</code> contents in my global FHIR cache.  More specifically, all the downloaded &amp; unzipped definition files need to exist at <code>{USER_HOME_DIR}/.fhir/packages/de.einwilligungsmanagement#0.0.4-snapshot/package/*</code>.</p>\n<p>Since Simplifier also uses a slightly different file-naming and IG URL scheme than the IG Publisher, I also had to specify the package <code>uri</code> in my <code>sushi-config.yaml</code> file:</p>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">dependencies</span><span class=\"p\">:</span>\n  <span class=\"nt\">de.einwilligungsmanagement</span><span class=\"p\">:</span>\n    <span class=\"nt\">uri</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">https://simplifier.net/guide/einwilligungsmanagement</span>\n    <span class=\"nt\">version</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">0.0.4-snapshot</span>\n</code></pre></div>",
        "id": 224732081,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1612189371
    },
    {
        "content": "<p>This is, of course, not ideal -- and your IG will fail the HL7 Auto Build process (since it will try to use the one from the registry) -- but if you just have to get it working locally, this is at least an approach you can consider.</p>",
        "id": 224732293,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1612189470
    },
    {
        "content": "<p>So we can't set the URI to a local file path?</p>",
        "id": 224732542,
        "sender_full_name": "David Pyke",
        "timestamp": 1612189572
    },
    {
        "content": "<p>hey <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> <br>\nThe java validator allows this by using the <code>-ig</code>parameter and providing a location of a downloaded FHIR package/ or a URL where a package is downloadable.</p>",
        "id": 224732867,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612189720
    },
    {
        "content": "<p>Thanks for the explanation! So Simplifier always just puts in the differentials inside of the package registry (IIRC).</p>",
        "id": 224733194,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612189847
    },
    {
        "content": "<p>This is a problem for sushi consuming Simplifier packages, right?</p>",
        "id": 224733318,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612189908
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192587\">@David Pyke</span> -- the <code>uri</code> is supposed to be the <em>canonical</em> URI of the IG, so setting it to the local file path wouldn't be correct -- and it still wouldn't work because SUSHI uses the URI only for metadata purposes (and can't assume that canonical URLs are resolvable anyway).</p>",
        "id": 224734537,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1612190442
    },
    {
        "content": "<p>However, if you look at it and it's a local file path, then you could assume it's not a canonical and use it as a base ig.</p>",
        "id": 224734761,
        "sender_full_name": "David Pyke",
        "timestamp": 1612190536
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> -- we can look into how the IG Publisher does it and see if we can offer a similar behavior in SUSHI.  And yes, <code>StructureDefinition</code>s without snapshots is a problem for SUSHI because SUSHI doesn't generate snapshots -- but it needs snapshots in the base profiles in order to correctly generate differentials for new profiles based on them.</p>",
        "id": 224734872,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1612190588
    },
    {
        "content": "<blockquote>\n<p>David Pyke: However, if you look at it and it's a local file path, then you could assume it's not a canonical and use it as a base ig.</p>\n</blockquote>\n<p>Maybe?  But then it's not a canonical URL anymore, so when SUSHI attempts to use it for metadata reasons, it would be wrong.  That structure in <code>sushi-config.yaml</code> is intended to mirror what will go in the generated IG JSON for <code>dependsOn</code>.  Using it for a duel purpose would confuse matters.  I think if SUSHI needs to support pointing to local packages we just need to create a very specific feature for that rather than overloading an existing field.</p>",
        "id": 224735294,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1612190782
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191469\">Chris Moesel</span> <a href=\"#narrow/stream/215610-shorthand/topic/Dependencies.20of.20other.20IG's/near/224734872\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191451\">Patrick Werner</span> -- we can look into how the IG Publisher does it and see if we can offer a similar behavior in SUSHI.  And yes, <code>StructureDefinition</code>s without snapshots is a problem for SUSHI because SUSHI doesn't generate snapshots -- but it needs snapshots in the base profiles in order to correctly generate differentials for new profiles based on them.</p>\n</blockquote>\n<p>This will lead to confusion, as Simplifier packages always only contain diffs, and IG packages Snapshots?</p>",
        "id": 224739090,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612192264
    },
    {
        "content": "<p>Yeah, it's not ideal.  In a perfect world, Simplifier would publish to the registry w/ snapshots.  I feel like this has already been discussed in the past, so I <em>think</em> the Simplifier team (or at least <em>someone</em> on the team) already knows about it.  I think.</p>",
        "id": 224740169,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1612192708
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> this is a related issue to <a href=\"https://jira.hl7.org/browse/HSCR-1\">https://jira.hl7.org/browse/HSCR-1</a></p>",
        "id": 224741054,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612193069
    },
    {
        "content": "<p>Thanks for the mention <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span>! I consider them separate issues (not that it's very relevant, but for bookkeeping). HSCR-1 is just making sure we bring <a href=\"http://registry.fhir.org\">registry.fhir.org</a> Elastic in sync every x time with the packages database behind it, above is on whether <a href=\"http://Simplifier.net\">Simplifier.net</a> should or should not mandate snapshots when creating packages.<br>\nThe latter has certainly been discussed and I was under the impression we did for new packages. Lemme check...</p>",
        "id": 224742602,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1612193607
    },
    {
        "content": "<p>thanks! (and i agree, separate issues, related only through impact on downstream tooling)</p>",
        "id": 224743126,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1612193790
    },
    {
        "content": "<p>I was wrong, we don't. I'll get it back on the agenda. <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span></p>",
        "id": 224743513,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1612193936
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> any progress on including Snapshots into the packages?<br>\nI think this issue will affect more and more people as many people are shifting to sushi at the moment.</p>",
        "id": 233280576,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1617696099
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> Yes, we continued discussing this here: <a href=\"#narrow/stream/215610-shorthand/topic/Dependencies/near/230725234\">https://chat.fhir.org/#narrow/stream/215610-shorthand/topic/Dependencies/near/230725234</a></p>",
        "id": 233294000,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1617703184
    }
]