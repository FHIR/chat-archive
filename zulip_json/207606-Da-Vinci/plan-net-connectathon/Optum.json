[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"337701\">@David Clowers</span> <br>\nI confess that our reference implementation provides poor diagnostic output to the user, but I've been poking around within the debugger to understand some odd behaviors.</p>\n<p>I'm getting \"{\\n  \\\"resourceType\\\": \\\"OperationOutcome\\\",\\n  \\\"issue\\\": [ {\\n    \\\"severity\\\": \\\"error\\\",\\n    \\\"code\\\": \\\"processing\\\",\\n    \\\"diagnostics\\\": \\\"Multiple values detected for non-repeatable parameter 'type'. This server is not configured to allow multiple (AND) values for this param.\\\"\\n  }, {\\n    \\\"severity\\\": \\\"information\\\",\\n    \\\"code\\\": \\\"informational\\\",\\n    \\\"diagnostics\\\": \\\"TrackingUuid = 76051679-4576-4617-98ee-f2a743c3d3c3\\\"\\n  } ]\\n}\"\"</p>\n<p>From the query   <a href=\"https://appnameformularlyconnectathonjan2021.azurewebsites.net/R4/Organization?_summary=count&amp;type=prvgrp,fac\">https://appnameformularlyconnectathonjan2021.azurewebsites.net/R4/Organization?_summary=count&amp;type=prvgrp,fac</a>\"</p>\n<p>1) shouldn't this be specifying an OR, not an AND based on the syntax?<br>\n2) The search parameter says multiple and and or are required.... <a href=\"http://hl7.org/fhir/us/davinci-pdex-plan-net/SearchParameter-organization-type.html\">http://hl7.org/fhir/us/davinci-pdex-plan-net/SearchParameter-organization-type.html</a></p>\n<p>This causes the front panel of our app to report that there are zero Organizations, since the query is for all type values that are not ntwk, which is hot to differentiate networks from other organizations.</p>\n<p>Also, some queries fail:<br>\n<a href=\"https://appnameformularlyconnectathonjan2021.azurewebsites.net/R4/Organization?_id=H1045033000\">https://appnameformularlyconnectathonjan2021.azurewebsites.net/R4/Organization?_id=H1045033000</a></p>\n<p>Returns with Invalid request: The FHIR endpoint on this server does not know how to handle GET operation[Organization] with parameters [[_id]]</p>\n<p>Ditto for Get of Insurance plans, Locations by _id.     So, I suspect this is a general configuration issue.</p>",
        "id": 222785392,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1610659015
    },
    {
        "content": "<p>Our understanding per the IG was that the way to differentiate between Organization and Network was by using the profile parameter in the endpoint, i.e.:<br>\nOrganization: {host}/Organization?_profile=http://hl7.org/fhir/us/davinci-pdex-plan-net/StructureDefinition/plannet-Organization<br>\nNetwork: {host}/Organization?_profile=http://hl7.org/fhir/us/davinci-pdex-plan-net/StructureDefinition/plannet-Network</p>\n<p>Thus we only filter by one type in Provider, 'prvgrp'. If we should change our implementation to allow for multiple search parameters for .type, we can look into updating this, but just wanted to confirm first whether we should be using this approach or the approach with the profile param.</p>",
        "id": 222786488,
        "sender_full_name": "David Clowers",
        "timestamp": 1610659495
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"337701\">@David Clowers</span> -- I think there are two things intermingled:<br>\n  1) how to differentiate Plannet-Network profiles of Organization from Plannet-Organization profiles<br>\n  2) Conforming to the search interface to the IG.   The search parameter Organization:type requires the ability to do ANDs(multiple instances of the search parameter) and ORs (a comma separated list).</p>\n<p>Re #1:  Indeed the only way to differentiate between the two profiles was by searching on _profile for a long time.  <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> taught me that this was very poor form, so we changed things so that the Organization.type field is used to differentiate the two, with Network profiles required to have type=ntwk, and the Organization profile requiring one of the allowed types fac,bus,prvgrp,payer,atyprv.</p>",
        "id": 222790290,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1610661389
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> Thanks for this feedback and clarification. We will take a look at updating this in our service.</p>",
        "id": 222792176,
        "sender_full_name": "David Clowers",
        "timestamp": 1610662361
    },
    {
        "content": "<p>One more clarification...does that mean we can deprecate the profile parameter entirely?</p>",
        "id": 222792755,
        "sender_full_name": "David Clowers",
        "timestamp": 1610662558
    },
    {
        "content": "<p>As per <a href=\"https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/CapabilityStatement-plan-net.html#resource--details\">https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/CapabilityStatement-plan-net.html#resource--details</a>   it is not required.</p>",
        "id": 222793310,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1610662672
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> <span class=\"user-mention\" data-user-id=\"222957\">@Dave Hill</span> Not sure if this is the best place to ask this question, but since it's related to one of our Connectathon 26 findings, here goes. Does this mean we should also look at deprecating the _profile parameter for Formulary as well? Currently our implementation still uses this for routing.</p>",
        "id": 225633883,
        "sender_full_name": "David Clowers",
        "timestamp": 1612833536
    },
    {
        "content": "<p>And if so, what should be used in its place?</p>",
        "id": 225633906,
        "sender_full_name": "David Clowers",
        "timestamp": 1612833555
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"337701\">@David Clowers</span>    <br>\nThe _profile search parameter is not required.  See <a href=\"http://hl7.org/fhir/us/davinci-drug-formulary/CapabilityStatement-usdf-server.html#behavior\">http://hl7.org/fhir/us/davinci-drug-formulary/CapabilityStatement-usdf-server.html#behavior</a></p>\n<p>Please expand on \"Currently our implementation still uses this for routing.\"<br>\nIsn't the resource type (MedicationKnowledge) sufficient for routing?</p>",
        "id": 225688826,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1612877327
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> The current IG seems to imply that the _profile parameter is required, so this is how our implementation is currently working.<br>\nSee this section: <a href=\"http://build.fhir.org/ig/HL7/davinci-pdex-formulary/#anticipated-client-queries\">http://build.fhir.org/ig/HL7/davinci-pdex-formulary/#anticipated-client-queries</a><br>\nThe profiles are actually CoveragePlan and FormularyDrug, based on the List and MedicationKnowledge resources respectively. So our understanding of the implementation is that the _profile parameter is required to route these requests to the proper resources. Is this not the case?<br>\nExample request headers per the IG:<br>\n    GET [base]/List?_profile=http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-CoveragePlan<br>\n    GET [base]/MedicationKnowledge?_profile=http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-FormularyDrug&amp;DrugPlan=myPlanID</p>",
        "id": 225742090,
        "sender_full_name": "David Clowers",
        "timestamp": 1612898173
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"337701\">@David Clowers</span>   .  I think you have found a bug in the IG that reflects our thinking when the authors were young and naive.<br>\nI'm going to create a tracker to eliminate the _profile= from all of those example queries.<br>\n<a href=\"https://jira.hl7.org/browse/FHIR-31031\">https://jira.hl7.org/browse/FHIR-31031</a></p>\n<p>FHIR queries are directed at the Resource that is profiled, as you note.   So FormularyDrug queries are actually queries against MedicationKnowledge resources, and CoveragePlan queries are queries against List resources.     Using the _profile search parameter constrains the returned data to instances that declare conformance to the profile through the meta.profile field.   Populating this field is not required for conformance to the IG, so there is no reasonable expectation that a server would populate that field.  (I'm a fan of populating that field, but I'm in the minority.)</p>\n<p>GET [base]/List.   This would return all List instances, including those that represent CoveragePlan<br>\nGET [base]/MedicationKnowledge?DrugPlan=myPlanID.  This would return all MedicateKnowledge that are supported by the DrugPlan search parameter, and that instance matches the provided PlanID.   DrugPlan is only supported for the FormularyDrug profile.</p>",
        "id": 225745779,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1612899755
    }
]