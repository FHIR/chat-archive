[
    {
        "content": "<p>hey <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> all the ig-build notifications on the <a class=\"stream\" data-stream-id=\"179297\" href=\"/#narrow/stream/179297-committers.2Fnotification\">#committers/notification</a> channel are saying that errs = 0, irrespective of how many errors they actually have. Where do you get that value from?</p>",
        "id": 198007420,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589844275
    },
    {
        "content": "<p>This has been the case for the last week or so.  No errors showing in qa.html either.</p>",
        "id": 198008680,
        "sender_full_name": "Tim Blake",
        "timestamp": 1589845577
    },
    {
        "content": "<p>If qa.html is wrong, there's probably a deeper cause. But the Zulip notification is built like <a href=\"https://github.com/FHIR/auto-ig-builder/blob/3a616d751efcd3caf7d7849143f8caf423ac8995/images/ig-build/builder/builder.py#L24\">https://github.com/FHIR/auto-ig-builder/blob/3a616d751efcd3caf7d7849143f8caf423ac8995/images/ig-build/builder/builder.py#L24</a> (basically, parsing out a comment from qa.html).</p>",
        "id": 198014147,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1589851445
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191802\">@Tim Blake</span> I don't know what this means:</p>\n<blockquote>\n<p>No errors showing in qa.html either.</p>\n</blockquote>\n<p>I get errors in qa.html.</p>",
        "id": 198023869,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589866661
    },
    {
        "content": "<p>e.g. <a href=\"https://build.fhir.org/ig/Healthedata1/sample-ig/branches/master/qa.html\">https://build.fhir.org/ig/Healthedata1/sample-ig/branches/master/qa.html</a></p>",
        "id": 198023914,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589866689
    },
    {
        "content": "<p>I don't - <a href=\"http://build.fhir.org/ig/timblake78/nsw-health-itoc/branches/master/qa.html\">http://build.fhir.org/ig/timblake78/nsw-health-itoc/branches/master/qa.html</a></p>",
        "id": 198024125,
        "sender_full_name": "Tim Blake",
        "timestamp": 1589867022
    },
    {
        "content": "<p>I'm not sure what you mean. you don't have any errors?</p>",
        "id": 198024190,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589867065
    },
    {
        "content": "<p>The qa.html linked above (for Healthedata1) that does have errors is using IG Publisher Version: <strong>v1.0.89</strong>-SNAPSHOT.</p>\n<p>I think the 0 errors started occurring after v1.0.90</p>",
        "id": 198024243,
        "sender_full_name": "Rob Eastwood",
        "timestamp": 1589867131
    },
    {
        "content": "<p>what errors do you think should show?</p>",
        "id": 198024310,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589867199
    },
    {
        "content": "<p>I can't remember what they were, but I know that there were about 12 of them prior to a few IG publisher builds ago</p>",
        "id": 198024785,
        "sender_full_name": "Tim Blake",
        "timestamp": 1589867949
    },
    {
        "content": "<p>As a demonstration, I created a <a href=\"https://github.com/robeastwood-agency/fhir-ig-experiment-01/blob/master/input/resources/Patient/example-fail-01.xml\">simple Patient instance</a> with this structure; note the clearly out of place elements:</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n  &lt;id value=&quot;example-fail-01&quot;/&gt;\n  &lt;name&gt;\n    &lt;use value=&quot;usual&quot;/&gt;\n    &lt;family value=&quot;Smith&quot;/&gt;\n    &lt;given value=&quot;Jack&quot;/&gt;\n  &lt;/name&gt;\n  &lt;!-- these elements are clearly out of place and should invoke errors --&gt;\n  &lt;something value=&quot;else&quot;/&gt;\n  &lt;meta&gt;\n    &lt;something value=&quot;other&quot;/&gt;\n  &lt;/meta&gt;\n  &lt;name&gt;\n    &lt;use value=&quot;official&quot;/&gt;\n    &lt;family value=&quot;Smith&quot;/&gt;\n    &lt;given value=&quot;John&quot;/&gt;\n    &lt;given value=&quot;Jacob&quot;/&gt;\n    &lt;given value=&quot;Jingleheimer&quot;/&gt;\n    &lt;period&gt;\n      &lt;end value=&quot;2001-01-01&quot;/&gt;\n    &lt;/period&gt;\n  &lt;/name&gt;\n  &lt;gender value=&quot;male&quot;/&gt;\n  &lt;birthDate value=&quot;1955-05-30&quot;/&gt;\n&lt;/Patient&gt;\n</code></pre></div>\n\n\n<h2>Using IGP v1.0.94, there are no errors on the command line; viz:</h2>\n<div class=\"codehilite\"><pre><span></span><code>onGenerate:\nGenerating Summary Outputs                                                       (00:27.0979)\nSending Usage Stats to Server                                                    (00:36.0653)\nJekyll: Source: C:/work/git/fhir-ig-experiment-01/temp/pages                     (00:44.0766)\nJekyll: Generating...                                                            (00:44.0766)\nJekyll: done in 1.839 seconds.                                                   (00:46.0605)\nInstalling fhir.ig.experiment.01#dev to the package cache\n  Fetching:\n  Installing:  done.\nChecking Output HTML                                                             (00:47.0106)\nfound 476 files                                                                  (00:47.0125)\n  ... 476 html files, 0 pages invalid xhtml (0%)                                 (00:48.0030)\n  ... 20143 links, 0 broken links (0%)                                           (00:48.0030)\nBuild final .zip                                                                 (00:48.0030)\nFinal .zip built                                                                 (00:48.0454)\nFinished. 00:27.0647. Validation output in C:\\work\\git\\fhir-ig-experiment-01\\output\\qa.html\nErrors: 0  Warnings: 0  Info: 0 (00:48.0876)\nDone\n</code></pre></div>\n\n\n<p>And the QA report displays: <br>\n<a href=\"/user_uploads/10155/ApB9RJC2UezY-9Hb0Stm_JrI/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/ApB9RJC2UezY-9Hb0Stm_JrI/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/ApB9RJC2UezY-9Hb0Stm_JrI/image.png\"></a></div><h2>Using IGP v1.0.89, the command line indicates 3 errors:</h2>\n<div class=\"codehilite\"><pre><span></span><code>...\nBuild final .zip                                                                 (00:51.0223)\nFinal .zip built                                                                 (00:51.0654)\nFinished. 00:27.0781. Validation output in C:\\work\\git\\fhir-ig-experiment-01\\output\\qa.html\nErrors: 3  Warnings: 0  Info: 0 (00:52.0080)\nDone\n</code></pre></div>\n\n\n<p>And the QA report displays this: <br>\n<a href=\"/user_uploads/10155/aBPuD1l8fGQGOeLVeno4u2Io/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/aBPuD1l8fGQGOeLVeno4u2Io/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/aBPuD1l8fGQGOeLVeno4u2Io/image.png\"></a></div>",
        "id": 198136920,
        "sender_full_name": "Rob Eastwood",
        "timestamp": 1589928687
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <br>\nig publisher (v95) still ignores all errors when doing a local build. It does report warnings and information.</p>",
        "id": 198410683,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1590130310
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Yes, I'm seeing the same thing.  After reading this I decided to recheck our newly published IPS IG by building with 1.0.89 instead of 1.0.95 - and 5 errors showed up (compared to 0 with 1.0.95).  Two of the errors were straightforward and quite egregious (apparently due to a copy-paste issue).  When a constraint for Observation.specimen was added to two of our Observation result profiles, the constraint was specified as a reference to the IPS Specimen profile but with a type of <strong>CodeableConcept</strong> (instead of Reference) - and the version 1.0.95 Publisher and qa.html didn't report the error :(   The other three errors are less obvious, showing up only on the example bundle as \"illegal use of resolve() in discriminator - Multiple possible target type profiles on Composition.section:sectionResults.entry:results-observation\" - but still they are not being reported with the 1.0.95 Publisher.</p>",
        "id": 198538431,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1590245003
    },
    {
        "content": "<p>I had seen the \"illegal use of resolve() in discriminator\" errors before, and when they went away I thought that either our changes to the slicing had fixed the issue or that the slicing was now being handled more robustly by the Publisher/Validator (or both), so either way it was good now - but instead, apparently the issue was just being masked. :(</p>",
        "id": 198538758,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1590245415
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> any news?</p>",
        "id": 198722162,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1590471454
    },
    {
        "content": "<p>I'm still seeing this in 1.0.97.  IPS has no errors reported, but this [profile] (<a href=\"http://build.fhir.org/ig/HL7/fhir-ips/branches/master/StructureDefinition-Observation-results-laboratory-uv-ips.html\">http://build.fhir.org/ig/HL7/fhir-ips/branches/master/StructureDefinition-Observation-results-laboratory-uv-ips.html</a>) contains this obviously incorrect code:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot; : &quot;Observation.specimen&quot;,\n        &quot;path&quot; : &quot;Observation.specimen&quot;,\n        &quot;type&quot; : [\n          {\n            &quot;code&quot; : &quot;CodeableConcept&quot;,\n            &quot;profile&quot; : [\n              &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Specimen-uv-ips&quot;\n            ]\n          }\n        ],\n        &quot;mustSupport&quot; : true\n      },\n</code></pre></div>\n\n\n<p>I'm planning to commit a technical correction for it (and the same issue in results-pathology) soon - but the error isn't being flagged.</p>",
        "id": 198952978,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1590613338
    },
    {
        "content": "<p>that's a nasty thing to do. I can't make a nice graceful error for that. Next IG publisher will halt with the error:</p>",
        "id": 198994206,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590653945
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Type mismatch processing profile http://hl7.org/fhir/uv/ips/StructureDefinition/Specimen-uv-ips at path Observation.specimen: The element type is CodeableConcept, but the profile http://hl7.org/fhir/uv/ips/StructureDefinition/Specimen-uv-ips is for a different type Specimen\n</code></pre></div>",
        "id": 198994218,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590653957
    },
    {
        "content": "<p>Yes, precisely! That's obviously why you don't want it reporting \"Errors: 0\" regardless  - it's easy for even stuff like that coming from copy/paste and an incomplete update to slip right through because it says everything is good. :(</p>",
        "id": 199009928,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1590665508
    },
    {
        "content": "<p>that one was never picked up as an error at all in the code</p>",
        "id": 199017267,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590670216
    },
    {
        "content": "<p>that's why you were getting errors : 0.</p>",
        "id": 199017294,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590670227
    },
    {
        "content": "<p>it took me 8 hours to nail this down :-(</p>",
        "id": 199017321,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590670248
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  I'm really sorry about that.  This was a relatively late addition and it didn't affect (because it wasn't even there) anything else that we have dealt with along the way.  And what you just said doesn't quite match with what I saw, because when I went <strong>back</strong> to building the IG with Publisher v1.0.89, the error <strong>was</strong> picked up and appropriately reported by the code.  So this really couldn't be <strong>why</strong> we were getting \"Errors: 0\", because we <strong>didn't</strong> get that with 1.0.89 (and presumably that would also have been true with many of the prior versions?), plus we and others also have seen the issue completely independently of whether this particular error is present or not.</p>",
        "id": 199020577,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1590671799
    },
    {
        "content": "<p>what was the exact error message in 1.0.89 then?</p>",
        "id": 199067864,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590692980
    },
    {
        "content": "<p>I still can't reproduce this. I've run a bunch of IGs with both .89 and the current version, and I consistently don't see any errors reported by .89 not reported by the current IG publisher</p>",
        "id": 199118105,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590734238
    },
    {
        "content": "<p>Sorry - had to sleep. :)  I'm working on getting the details for you.</p>",
        "id": 199141182,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1590751528
    },
    {
        "content": "<p>V98 reports the errors I was expecting. <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 199337534,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1590988079
    },
    {
        "content": "<p>Many thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 199337575,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1590988103
    },
    {
        "content": "<p>you'll have to check again with 99</p>",
        "id": 199350423,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1591003767
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179165-committers/topic/ig-build.20notifications/near/199350423\">said</a>:</p>\n<blockquote>\n<p>you'll have to check again with 99</p>\n</blockquote>\n<p>Expected errors are displaying on QA report with v99  - thanks very much <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 199432601,
        "sender_full_name": "Rob Eastwood",
        "timestamp": 1591051326
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  Looks like you did indeed reproduce it.  With 1.0.99 I'm now seeing the expected errors with IPS, too.</p>",
        "id": 199446444,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1591067368
    },
    {
        "content": "<p>After being fixed for quite a while, now the 1.1.20 of the Publisher is failing on the UTG ci build - this version works OK on my local machine environment with the git content.   Error log does not show anything beyond \"Generating Summary Outputs                                                       (06:40.0695)<br>\nSending Usage Stats to Server                                                    (09:02.0275)<br>\nJekyll: Source: /scratch/ig-build-temp-U51D5N/repo/temp/pages                    (09:05.0710)<br>\nJekyll: Generating...                                                            (09:05.0710)\" but the build does not go to completion.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> I have no idea where to begin looking for the reason here.     Jekyll does not seem to complete.</p>",
        "id": 209664529,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599752021
    },
    {
        "content": "<p>This IG has always been a bit of a special case -- in the past, has been a resource allocation issue. We're giving it 15Gi RAM currently; does it need more than this? Looking now...</p>",
        "id": 209665795,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599752500
    },
    {
        "content": "<p>not sure.   I give it 16G when I run it locally:   java -Xmx16G -Xss1G -jar /Users/...</p>",
        "id": 209668505,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599753550
    },
    {
        "content": "<p>it keeps growing as well - more resources added to it bit by bit every few days...</p>",
        "id": 209668613,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599753588
    },
    {
        "content": "<p>Does Jekyll need more?</p>",
        "id": 209679744,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1599758388
    },
    {
        "content": "<p>finally the last bit of the log showed up:                                                             (09:01.0203)<br>\nJekyll has failed. Complete output from running Jekyll:                          (09:37.0730)<br>\nNote: Check that Jekyll is installed correctly                                   (09:37.0731)<br>\nPublishing Content Failed: Process exited with an error: 137 (Exit value: 137)   (09:37.0731)<br>\n                                                                                 (09:37.0731)<br>\nUse -? to get command line help                                                  (09:37.0731)<br>\n                                                                                 (09:37.0731)<br>\nStack Dump (for debugging):                                                      (09:37.0731)<br>\norg.apache.commons.exec.ExecuteException: Process exited with an error: 137 (Exit value: 137)<br>\n    at org.apache.commons.exec.DefaultExecutor.executeInternal(DefaultExecutor.java:404)<br>\n    at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:166)<br>\n    at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:153)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.runJekyll(Publisher.java:5508)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.runTool(Publisher.java:5412)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.generate(Publisher.java:4878)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:848)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:694)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8075)</p>",
        "id": 209681926,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599759476
    },
    {
        "content": "<p>no idea what error 137 is</p>",
        "id": 209681991,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599759489
    },
    {
        "content": "<p>error 137 is \"out of memory\" :)</p>",
        "id": 209682167,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1599759561
    },
    {
        "content": "<p>ah well then there we have it</p>",
        "id": 209682316,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599759616
    },
    {
        "content": "<p>my local build this morning:</p>",
        "id": 209682338,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599759628
    },
    {
        "content": "<p>Validation Results for HL7Terminology</p>\n<p>Generated Thu Sep 10 08:46:16 MDT 2020, FHIR version 4.0.1 for hl7.terminology# (canonical = <a href=\"http://terminology.hl7.org\">http://terminology.hl7.org</a> (history)). See Errors Only<br>\nQuality Checks<br>\nPublisher Version:  IG Publisher Version: v1.1.20<br>\nSupressed Messages: 24 Suppressed Issues<br>\nDependency Checks:  <br>\nPackage Version FHIR Release    Canonical   Web Base    Comment<br>\n.. hl7.terminology  1.0.39  4.0.1   <a href=\"http://terminology.hl7.org\">http://terminology.hl7.org</a>      HL7 Packages must have an id that starts with hl7.fhir.<br>\nHL7 Publication Rules:  </p>\n<div class=\"codehilite\"><pre><span></span><code>package-list.json: No category entry for the registry category (talk to FHIR product director on #IG Creation for assistance). Note: existing IGs already have a category in the existing package-list.json - update your package-list.json from there\npackage-list.json: No entry found for version\n</code></pre></div>\n\n\n<p>HTA Analysis:   UTG is exempt from terminology dependency analysis<br>\nRealm rules:    </p>\n<div class=\"codehilite\"><pre><span></span><code>n/a\n</code></pre></div>\n\n\n<p>Previous Version Comparison:    Unable to compare with previous version: Unable to find version history at <a href=\"http://terminology.hl7.org\">http://terminology.hl7.org</a> (Problem #1 with package-list.json at <a href=\"http://terminology.hl7.org\">http://terminology.hl7.org</a>: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 2 column 2 path $)<br>\nSummary:    broken links = 0, errors = 494, warn = 1636, info = 43</p>",
        "id": 209682341,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599759629
    },
    {
        "content": "<p>I am using 16G in my java call.</p>",
        "id": 209682398,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599759657
    },
    {
        "content": "<p>16Gb seems to work for the java build but not for Jekyll. That's alarming. <span class=\"user-mention\" data-user-id=\"191982\">@Ted Klein</span> how much RAM is Jekyll using in your system, or how much do you have ovearll?</p>",
        "id": 209688556,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599762323
    },
    {
        "content": "<p>Th 16GB allocation might be blocking too much memory that jekyll is being starved</p>",
        "id": 209688767,
        "sender_full_name": "David Pyke",
        "timestamp": 1599762399
    },
    {
        "content": "<p>I have 32G in this laptop I am running the build on</p>",
        "id": 209692072,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599763918
    },
    {
        "content": "<p>Josh I am not sure how to even check that; Jekyll is launched from within publisher.jar, and I do not know if there are parameter settings for it somewhere</p>",
        "id": 209693169,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599764367
    },
    {
        "content": "<p>OK -- your OS probably provides some profiling (e..g, Windows task manager, or <code>top</code> in linux). I'm just going to crank things up across the board in our auto-build cluster (bigger machines, bigger limits)</p>",
        "id": 209693727,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599764526
    },
    {
        "content": "<p>OK I'll have to look into it; running OSX on a MacBook Pro 2018 vintage here, v 10.14.6; there may be some environment settings in the bash terminal shell I am running java in.</p>",
        "id": 209693961,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599764634
    },
    {
        "content": "<p>BTW how <em>long</em> does a full build take for you Ted? With memory cranked up... right now the auto-builder has been cranking for 25 min, Java using &gt;16GB RAM, 100% CPU). It's going to hit our 30min limit shortly ;-)</p>",
        "id": 209696825,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599766005
    },
    {
        "content": "<p>wow.   didn't think my MacBook Pro was THAT good...(18:40.0207).  So under 20 minutes.  On a laptop.  While on a zoom call and recording the session LOL.</p>",
        "id": 209698498,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599766701
    },
    {
        "content": "<p>Well, the good news is the deadline is actually a full hour, as configured -- the bad news is it's <em>still</em> going to fail.</p>",
        "id": 209700777,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599767709
    },
    {
        "content": "<p>I'll give this a shot locally to compare...</p>",
        "id": 209700973,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599767785
    },
    {
        "content": "<p>Wait, 100% CPU? There is that much concurrent execution?</p>",
        "id": 209701173,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1599767861
    },
    {
        "content": "<p>It's 100% of a core</p>",
        "id": 209701433,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599767980
    },
    {
        "content": "<p>Thank you for clarifying. (Which is to say, not much in the way of concurrent execution.)</p>",
        "id": 209701465,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599768001
    },
    {
        "content": "<p>in the meantime I am editing some resources and just kicked off another local build and it is running...</p>",
        "id": 209702016,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599768264
    },
    {
        "content": "<p>Yeah, I was going to say that building <a href=\"https://github.com/hl7/utg\">https://github.com/hl7/utg</a> fails for me locally with:</p>\n<div class=\"codehilite\"><pre><span></span><code>Stack Dump (for debugging):                                                      (03:52.0477)\n/home/publisher/ig/template/scripts/ant-utg.xml:72: Unable to create javax script engine for javascript\n    at org.apache.tools.ant.util.optional.JavaxScriptRunner.evaluateScript(JavaxScriptRunner.java:145)\n    at org.apache.tools.ant.util.optional.JavaxScriptRunner.executeScript(JavaxScriptRunner.java:82)\n    at org.apache.tools.ant.taskdefs.optional.script.ScriptDef.executeScript(ScriptDef.java:348)\n    at org.apache.tools.ant.taskdefs.optional.script.ScriptDefBase.execute(ScriptDefBase.java:52)\n    at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:292)\n    at jdk.internal.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:564)\n    at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:99)\n    at org.apache.tools.ant.Task.perform(Task.java:350)\n    at org.apache.tools.ant.Target.execute(Target.java:449)\n    at org.apache.tools.ant.Target.performTasks(Target.java:470)\n    at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1388)\n    at org.apache.tools.ant.Project.executeTarget(Project.java:1361)\n    at org.hl7.fhir.igtools.templates.Template.runScriptTarget(Template.java:185)\n    at org.hl7.fhir.igtools.templates.Template.beforeGenerateEvent(Template.java:342)\n    at org.hl7.fhir.igtools.publisher.Publisher.templateBeforeGenerate(Publisher.java:3262)\n    at org.hl7.fhir.igtools.publisher.Publisher.generate(Publisher.java:4821)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:848)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:694)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8075)\n</code></pre></div>",
        "id": 209702286,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599768386
    },
    {
        "content": "<p>wow.   mine is nearly complete here.   I'll commit and push my changes to make sure what you see ih Git is what I just built OK here.   I am 14 minutes in here...</p>",
        "id": 209703736,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599769191
    },
    {
        "content": "<p>Final .zip built                                                                 (17:49.0004)<br>\nFinished. Times: loading: 02:09.0204, generate: 14:34.0839, narrative generation: 01:25.0311, realm-rules: 00:00.0014, previous-version: 00:00.0002, jekyll: 03:25.0698, validation: 00:54.0300 (#3843), template: 00:29.0161 (#3) (17:49.0565)</p>",
        "id": 209703932,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599769276
    },
    {
        "content": "<p>committed and pushed; utg ig version 1.0.40 builds fine with IGP 1.1.20 on my local system, rendered IG looks good.</p>",
        "id": 209704652,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599769645
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> have you made any headway on this?   it looks like UTG still will not build - works ok for me locally.   <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> tried it locally but his machine runs out of heap space and memory.   Any prognosis?</p>",
        "id": 209843234,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599863611
    },
    {
        "content": "<p>I tried building yesterday and failed locally. I updated the RAM available in the cloud VM, doubling the size of the VM node where these jobs launch.  It still seems to be getting stuck. I'd like to make sure I can get it to build locally...</p>",
        "id": 209862715,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599882519
    },
    {
        "content": "<p>Ugh.  What a mystery.   Well I am building as normal here locally, if there is anything I can do to help you run this to ground I'm happy to try to help.</p>",
        "id": 209880763,
        "sender_full_name": "Ted Klein",
        "timestamp": 1599915867
    },
    {
        "content": "<p>I'd like to make progress here -- I've updated limits in auto-builder to allocated 19G RAM for Java and 22G RAM for the overall build container. But meanwhile I still can't complete a build locally; <a href=\"https://gist.github.com/jmandel/f2d622ba1ed520a0074ba89f283cb02a\">failure stacktrace captured here</a>.</p>",
        "id": 210165508,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600192807
    },
    {
        "content": "<p>that's a java set up issue.</p>",
        "id": 210181779,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600199814
    },
    {
        "content": "<p>Or Ant? I found <a href=\"https://stackoverflow.com/questions/43067454/ant-running-from-maven-antrun-plugin-cant-find-scripting-engine-on-java-9\">this reference</a> to adding class-path to (in this case) ant-utg.xml, but I don't know if it's relevant...</p>",
        "id": 210183001,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1600200333
    },
    {
        "content": "<p>The java setup in my Docker container comes from the open jdk base (<a href=\"https://github.com/FHIR/auto-ig-builder/blob/master/images/ig-publisher-base/Dockerfile#L1\">https://github.com/FHIR/auto-ig-builder/blob/master/images/ig-publisher-base/Dockerfile#L1</a>)</p>",
        "id": 210185035,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600201250
    },
    {
        "content": "<p>Is there some additional dependency?</p>",
        "id": 210185064,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600201262
    },
    {
        "content": "<p>Not sure if it's related, but I see you're using OpenJDK 16, and it appears they removed the Nashorn JavaScript Engine in OpenJDK 15.  See: <a href=\"https://openjdk.java.net/jeps/372\">https://openjdk.java.net/jeps/372</a></p>\n<p>Perhaps you need to add a jar that provides a JavaScript engine implementation? (only a guess based on the error message)</p>",
        "id": 210186563,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1600201974
    },
    {
        "content": "<blockquote>\n<p>Not sure if it's related, but I see you're using OpenJDK 16</p>\n</blockquote>\n<p>I thought we were aiming to support only LTS versions of OpenJDK (where OpenJDK 11 is the latest, to last until 2022) <br>\nIs that not the case?</p>",
        "id": 210188221,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1600202816
    },
    {
        "content": "<p>Interesting! I'll update to use whatever is the \"right\" version. (In general I'd assumed we wanted to keep things working with the latest.)</p>",
        "id": 210188641,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600203023
    },
    {
        "content": "<p>(The auto-builder has been on OpenJDK 15 for 6 months (before that OpenJDK 12 for 16 months, and before that OpenJDK 8)</p>",
        "id": 210188885,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600203130
    },
    {
        "content": "<p>I'll update the \"ig-publisher-base\" to try OpenJDK 15 to start (i.e., to match the auto builder, which was the goal all along) -- good lead <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>.</p>",
        "id": 210189137,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600203269
    },
    {
        "content": "<p>Well, my lead suggests it was <em>removed</em> in 15, so if things actually <em>work</em> in 15, then... ¯\\_(ツ)_/¯</p>",
        "id": 210189377,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1600203375
    },
    {
        "content": "<p>Nope, confirmed broken in 15 too -- so that's <em>one</em> reason the auto-build is failing (though in practice I don't think it's getting far enough to fail on this?)</p>",
        "id": 210192499,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600204994
    },
    {
        "content": "<p>Trying now in 14...</p>",
        "id": 210192519,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600205013
    },
    {
        "content": "<p>In related news, even though I can't build UTG locally, it <em>does</em> appear to have <a href=\"https://build.fhir.org/ig/HL7/UTG/\">built today in the auto-build</a>, once the extra memory was provided. So much for creating consistent environments for local testing and the auto-build cluster...</p>",
        "id": 210193056,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600205267
    },
    {
        "content": "<p>FYI <span class=\"user-mention\" data-user-id=\"191982\">@Ted Klein</span></p>",
        "id": 210193250,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600205365
    },
    {
        "content": "<p>Yes apparently the ci build worked I see the current UTG version 1.0.40 is built with publisher 1.1.21, albeit with some funny display things that are different now (dunno if bugs or intended).   Thank heavens as a new Change Proposal was submitted and I have to build the branch to be pushed to consensus review...</p>",
        "id": 210196311,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600206983
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191982\">@Ted Klein</span> what is different?</p>",
        "id": 210198911,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600208541
    },
    {
        "content": "<p>a couple of things.  the rendering of the &lt;name&gt; element in code systems is strange with included double quotes and it looks like &lt;title&gt; is being combined</p>",
        "id": 210211329,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600218035
    },
    {
        "content": "<p>but a bigger problem just cropped up just this minute - in building the branch UP-99 for a proposal that was submitted earlier today, I get the error:</p>",
        "id": 210211349,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600218063
    },
    {
        "content": "<p>onGenerate:<br>\nException in thread \"main\" java.lang.Error: The resource type \"NamingSystem\" does not implement the property \"experimental\"<br>\n    at org.hl7.fhir.r5.model.NamingSystem.getExperimental(NamingSystem.java:1665)<br>\n    at org.hl7.fhir.igtools.renderers.CanonicalRenderer.describeStatus(CanonicalRenderer.java:122)<br>\n    at org.hl7.fhir.igtools.renderers.CanonicalRenderer.genSummaryCore1(CanonicalRenderer.java:77)<br>\n    at org.hl7.fhir.igtools.renderers.CanonicalRenderer.summaryTable(CanonicalRenderer.java:61)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.generateOutputsCanonical(Publisher.java:7681)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.generateResourceHtml(Publisher.java:6632)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.generateHtmlOutputs(Publisher.java:6564)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.generate(Publisher.java:4849)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:871)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:717)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8276)</p>",
        "id": 210211353,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600218066
    },
    {
        "content": "<p>we do not use 'experimental' in any of our NamingSystem resources.   wtf?  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> this did not show up the the build of master branch a few hours ago.</p>",
        "id": 210211413,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600218122
    },
    {
        "content": "<p>this is being rendered on the main build for all code system resources:   Name: EventExpected\"eventExpected\"</p>",
        "id": 210211458,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600218179
    },
    {
        "content": "<p>so seems to be dead once again; the java parameter for the timeout is STILL too small for this beast of an IG (UTG).    Maybe we can boost the timeout value a bit?    Here is the tail end of the error log:</p>",
        "id": 210316189,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600288084
    },
    {
        "content": "<p>DEBUG:root:Time to deadline 3473.041943 seconds<br>\nDEBUG:root:</p>\n<p>*** Timeout -- deadline reached<br>\nDEBUG:root:running: java -Xms19000m -Xmx19000m -jar ../publisher.jar -ig ig.json -auto-ig-build -target <a href=\"https://build.fhir.org/ig/HL7/UTG/\">https://build.fhir.org/ig/HL7/UTG/</a> -out /scratch/ig-build-temp-TEKD4P/repo<br>\nDEBUG:root:Time to deadline -0.011687 seconds<br>\nDEBUG:root:</p>\n<p>*** Timeout -- deadline reached</p>",
        "id": 210316190,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600288085
    },
    {
        "content": "<p>OK, setting the timeout from 1h to 2h :/</p>",
        "id": 210318853,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600289481
    },
    {
        "content": "<p>Though I don't understand why it should take this long; I can't reproduce this slow behavior locally</p>",
        "id": 210318876,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600289502
    },
    {
        "content": "<p>Maybe something to do with rebuild of the cache files?   Thing took 18.5 minutes to build on my laptop.</p>",
        "id": 210324917,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600293123
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> I don't understand that output - it doesn't have any information from the IG publisher itself?</p>",
        "id": 210329670,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600296713
    },
    {
        "content": "<p>So if you look at the bot generated log file you can see the whole thing.  Something very mysterious is going on.</p>",
        "id": 210329913,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600296880
    },
    {
        "content": "<p>where?</p>",
        "id": 210329976,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600296948
    },
    {
        "content": "<p>on this stream up a dozen entries or so last branch UP-99 build</p>",
        "id": 210330082,
        "sender_full_name": "Ted Klein",
        "timestamp": 1600297035
    },
    {
        "content": "<p>that didn't help me</p>",
        "id": 210330197,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600297134
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/ig/HL7/UTG/branches/UP-99-change-meta-data-and-url-for-icd-10-ca-and-cci-codesystems-and-namingsystems/failure/build.log\">http://build.fhir.org/ig/HL7/UTG/branches/UP-99-change-meta-data-and-url-for-icd-10-ca-and-cci-codesystems-and-namingsystems/failure/build.log</a> doesn't have publisher output -- that's the question right?</p>",
        "id": 210341859,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600309542
    },
    {
        "content": "<p>yes.</p>",
        "id": 210341867,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600309559
    },
    {
        "content": "<p>it logs that it started the publisher, and then that it killed it, but there's no output from the publisher itself</p>",
        "id": 210341914,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600309584
    },
    {
        "content": "<p>Yeah, I'm really not sure why that's happening. I'll investigate this tomorrow locally.</p>",
        "id": 210342282,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600310077
    },
    {
        "content": "<p>thanks. The fact that ci-build for UTG is not working is creating real stress in the community</p>",
        "id": 210343339,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600311500
    },
    {
        "content": "<p>Appreciate the context -- I've been looking just now. The \"good news\" is that when I kick off a build for the <code>UP-99-change-meta-data-and-url-for-icd-10-ca-and-cci-codesystems-and-namingsystems</code> in the auto-builder, I see more in the build log than the snipped from the previous build:</p>\n<div class=\"codehilite\"><pre><span></span><code>INFO:root:about to clone!\nDEBUG:root:running: git clone --recursive https://github.com/HL7/UTG --branch UP-99-change-meta-data-and-url-for-icd-10-ca-and-cci-codesystems-and-namingsystems repo\nDEBUG:root:Time to deadline 3479.99728 seconds\nCloning into &#39;repo&#39;...\nDEBUG:root:running: wget -q https://github.com/HL7/fhir-ig-publisher/releases/latest/download/publisher.jar -O publisher.jar\nDEBUG:root:Time to deadline 3474.512956 seconds\nDEBUG:root:running: npm -g install fsh-sushi\nDEBUG:root:Time to deadline 3473.041943 seconds\nDEBUG:root:\n\n*** Timeout -- deadline reached\n</code></pre></div>\n\n\n<p>... which snippet is consistent with, um, the behavior you'd expect if the <code>npm</code> command just hung for an hour.</p>",
        "id": 210343685,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600311871
    },
    {
        "content": "<p>When I re-triggered it just, it at least appears to be logging / chugging away as expected.</p>\n<div class=\"codehilite\"><pre><span></span><code>...\nLoad Package hl7.fhir.xver-extensions#0.0.4\nInitialization complete                                                          (00:18.0806)\nFetch http://terminology.hl7.org/package-list.json for version check             (00:18.0807)\nLoad Content                                                                     (00:18.0918)\nProcessing Conformance Resources                                                 (02:36.0432)\nGenerating Snapshots                                                             (02:50.0709)\nGenerating Narratives                                                            (02:50.0928)\n</code></pre></div>",
        "id": 210343703,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600311917
    },
    {
        "content": "<p>npm?</p>",
        "id": 210344401,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600312936
    },
    {
        "content": "<p>I dunno, npm was the last command run before an hour ticked by on the clock</p>",
        "id": 210344483,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600313138
    },
    {
        "content": "<p>plenty of stack overflow posts about npm hanging</p>",
        "id": 210344657,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600313390
    },
    {
        "content": "<p>if it continues to be a problem, we decide whether we need npm or not</p>",
        "id": 210345093,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1600313983
    },
    {
        "content": "<p>Sure -- we can also add <code>--verbose</code> to track down what's happening.</p>",
        "id": 210345142,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600314017
    },
    {
        "content": "<p>This might have been a connectivity blip that npm didn't recover gracefully from.</p>",
        "id": 210345149,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600314036
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/ig/HL7/UTG/branches/UP-99-change-meta-data-and-url-for-icd-10-ca-and-cci-codesystems-and-namingsystems/index.html\">http://build.fhir.org/ig/HL7/UTG/branches/UP-99-change-meta-data-and-url-for-icd-10-ca-and-cci-codesystems-and-namingsystems/index.html</a> looks like it worked. Let me know if anything fails again. (Please do @-mention me with any notes.)</p>",
        "id": 210345169,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1600314089
    }
]