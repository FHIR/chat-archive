[
    {
        "content": "<p>The difference here may be that the entire container is running out of memory rather than the java process inside the container running out of memory. When the latter happens we should get an error message. The former perhaps not. We tried to prevent this by limiting the memory available to the JVM (so it remains within container limits), which maybe where things are breaking down.</p>",
        "id": 153946383,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1521536851
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span></p>",
        "id": 153946384,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1521536862
    },
    {
        "content": "<p>BTW do you know how much memory should be enough to run this job?</p>",
        "id": 153946385,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1521537131
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> -- thanks for looking into this.  I'm currently trying to see if there is a value for the docker run <code>-m</code> parameter (memory limit) that will allow it to work without having to disable the oom killer.  I'll let you know what I find.  BTW -- I've answered some of your other questions over on GH: <a href=\"https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374602422\" target=\"_blank\" title=\"https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374602422\">https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374602422</a> (sorry for fragmenting this discussion).</p>",
        "id": 153946479,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1521555072
    },
    {
        "content": "<p>Thanks. That report on timing is interesting -- 5min vs 30min just based on memory allocation</p>",
        "id": 153946483,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1521555340
    },
    {
        "content": "<p>I'm inclined to just crank it way up, but I'd like to have property error detections in place, too -- which seems hard to accomplish from within the container. We may need a separate pod (in the kubernetes deployment, which is what manages our hosted environment) to mention for errors...</p>",
        "id": 153946484,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1521555426
    },
    {
        "content": "<p>My last run I tried it with <code>-m 6G</code> and it still failed.  I'm currently trying <code>-m 8G</code> (still running).  I guess our IG must be huge compared to others (or I'm doing something _very_ wrong).</p>",
        "id": 153946485,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1521555494
    },
    {
        "content": "<p>Interesting. Well, none of this is deeply tested, so maybe yours just is significantly bigger than the others. How many resources/profiles/valuesets are you defining?</p>",
        "id": 153946486,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1521555745
    },
    {
        "content": "<p>The run w/ <code>-m 8G</code> succeeded in 19 minutes.  Is it reasonable to request that you allocate <code>8G</code> to the container?</p>\n<p>This IG defines 134 logical models (!), 30 profiles, 31 extensions, 41 value sets, and 30 code systems.</p>",
        "id": 153946490,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1521556150
    },
    {
        "content": "<p>that's pretty substantial. I'll spend some time looking at optimization when I get a chance.</p>",
        "id": 153946640,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1521572007
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- as an update, I actually found that despite passing in <code>-m 8G</code>, my container was <em>actually</em> still only getting 2 GB allocation.  That one successful run was pure luck.  After reconfiguring my docker host (Docker for Mac) so I could specify a limit above 2 GB, I was able to successfully run it with an allocation of 4 GB.  I ran <code>top</code> inside the container while it was running and found that the Java process maxed out at 2.9 GB.  So... that 8 GB thing was totally wrong -- it's not as bad as we thought, but there probably still is some room for optimization!</p>",
        "id": 153946644,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1521572372
    },
    {
        "content": "<p>ok thx. all the definitions + all the resources in 2 dfferent object models + expansions for all the value sets... shouldn't really be 2.9GB... I'll have to investigate. How much html is produced?</p>",
        "id": 153946652,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1521573178
    },
    {
        "content": "<p>FYI -- my final results and recommendations can be found here: <a href=\"https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374728387\" target=\"_blank\" title=\"https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374728387\">https://github.com/hl7-fhir/auto-ig-builder/issues/3#issuecomment-374728387</a></p>",
        "id": 153946656,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1521574453
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> does this answer your question or are you looking for something else?</p>",
        "id": 153946657,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1521574517
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Checking Output HTML                                                             (00:04:13.0243sec)\nfound 2946 files\n  ... 2946 html files, 0 pages invalid xhtml (0%)                                (00:04:28.0707sec)\n  ... 769433 links, 137 broken links (0%)                                        (00:04:28.0707sec)\n</pre></div>",
        "id": 153946658,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1521574527
    },
    {
        "content": "<p>that's it, thanks. its not that many pages....</p>",
        "id": 153946661,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1521574804
    },
    {
        "content": "<p>With many, many thanks to <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span>, the auto-build is now producing my IG.  Hurray!  See the GitHub issue linked above if you want the gory details.</p>",
        "id": 153946884,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1521650367
    }
]