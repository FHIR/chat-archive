[
    {
        "content": "<p>I am getting a NPE in a full FHIR build that doesn't give any information on what could be wrong:</p>\n<div class=\"codehilite\"><pre><span></span><code>This was a Full Build                                                      4.392  38sec  817MB\nFHIR build failure @ Mon, Sep 20, 2021 12:23-0600                          0.668  38sec  817MB\nError: null\njava.lang.NullPointerException\n        at java.base/java.util.ResourceBundle.containsKey(ResourceBundle.java:2302)\n        at org.hl7.fhir.utilities.i18n.I18nBase.messageExistsForLocale(I18nBase.java:50)\n        at org.hl7.fhir.utilities.i18n.I18nBase.formatMessage(I18nBase.java:67)\n        at org.hl7.fhir.validation.BaseValidator.ruleHtml(BaseValidator.java:421)\n        at org.hl7.fhir.definitions.validation.ResourceValidator.rule(ResourceValidator.java:124)\n        at org.hl7.fhir.definitions.validation.ResourceValidator.checkSearchParams(ResourceValidator.java:383)\n        at org.hl7.fhir.definitions.validation.ResourceValidator.check(ResourceValidator.java:217)\n        at org.hl7.fhir.definitions.validation.ResourceValidator.check(ResourceValidator.java:594)\n        at org.hl7.fhir.tools.publisher.Publisher.validate(Publisher.java:1787)\n        at org.hl7.fhir.tools.publisher.Publisher.execute(Publisher.java:609)\n        at org.hl7.fhir.tools.publisher.Publisher.main(Publisher.java:474)\n</code></pre></div>\n<p>I'm going to review what I changed to see what could have gone wrong, but it will searching in the dark...</p>",
        "id": 254095490,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1632162346
    },
    {
        "content": "<p><a href=\"https://github.com/HL7/fhir/tree/jd-MedKnowledge\">https://github.com/HL7/fhir/tree/jd-MedKnowledge</a> is the branch if anyone wants to help me search...</p>",
        "id": 254095598,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1632162376
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> this is an issue with the i18n code</p>",
        "id": 254097541,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632163200
    },
    {
        "content": "<p>Okay will look now</p>",
        "id": 254097655,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163235
    },
    {
        "content": "<p>This points to a message existing in one language that doesn't exist in another</p>",
        "id": 254097749,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163275
    },
    {
        "content": "<p>no?</p>",
        "id": 254097754,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163276
    },
    {
        "content": "<p>message id doesn't exist at all?</p>",
        "id": 254097840,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632163318
    },
    {
        "content": "<p>it shouldn't build then</p>",
        "id": 254097892,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163325
    },
    {
        "content": "<p>or the bundle was never loaded?</p>",
        "id": 254097922,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632163339
    },
    {
        "content": "<p>That might be more likely</p>",
        "id": 254097942,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163349
    },
    {
        "content": "<p>I'll run the build locally</p>",
        "id": 254097949,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163353
    },
    {
        "content": "<p>I got the same fail</p>",
        "id": 254098613,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163644
    },
    {
        "content": "<p>very quickly</p>",
        "id": 254098618,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163647
    },
    {
        "content": "<p>looking into it now</p>",
        "id": 254098632,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632163653
    },
    {
        "content": "<p>thanks for the quick look into this.  i'm sure it will eventually point to something wrong I've done but it's hard to tell what specific wrong thing I did this time. :)</p>",
        "id": 254102135,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1632165040
    },
    {
        "content": "<p>When it attempts to evaluate this search parameter definition<br>\n<a href=\"/user_uploads/10155/bmk-aFZaxHTpfiAbH87GJwi1/image.png\">image.png</a> <br>\nit throws a null pointer exception</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/bmk-aFZaxHTpfiAbH87GJwi1/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/bmk-aFZaxHTpfiAbH87GJwi1/image.png\"></a></div>",
        "id": 254103742,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632165746
    },
    {
        "content": "<p>Specifically</p>",
        "id": 254104032,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632165878
    },
    {
        "content": "<p>when the path = \"MedicationKnowledge.sponsor\"</p>",
        "id": 254104063,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632165895
    },
    {
        "content": "<p>it tries to execute this: <br>\n<code>ElementDefn e = rd.getRoot().getElementForPath(trimIndexes(\"MedicationKnowledge.sponsor\"), definitions, \"Resolving Search Parameter Path\", true, false);</code></p>",
        "id": 254104138,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632165942
    },
    {
        "content": "<p>and e is null</p>",
        "id": 254104242,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632165977
    },
    {
        "content": "<p>then it attempts to iterate through e.getTypes()</p>",
        "id": 254104286,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632165998
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>for (TypeRef t : e.getTypes()) {\n    if (t.getName().equals(&quot;Reference&quot;) || t.getName().equals(&quot;canonical&quot;)) {\n        for (String pn : t.getParams()) {\n            if (definitions.hasLogicalModel(pn))\n                p.getTargets().addAll(definitions.getLogicalModel(pn).getImplementations());\n            else\n                p.getTargets().add(pn);\n        }\n    }\n}```\n</code></pre></div>",
        "id": 254104290,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166002
    },
    {
        "content": "<p>and throws a NPE there</p>",
        "id": 254104324,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166023
    },
    {
        "content": "<p>Then it tries to filter up a message from the exception, but the message contained in the NPE exception is null, so when it tries to localize it, it barfs</p>",
        "id": 254104562,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166149
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"192166\">@Jean Duteau</span> any idea why that might be happenning?</p>",
        "id": 254104604,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166170
    },
    {
        "content": "<p>the NPE on MedicationKnowledge.sponsor</p>",
        "id": 254104638,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166186
    },
    {
        "content": "<p>i know why that's happening - removed that field.  i can fix the searchparameter to get that not to error.</p>",
        "id": 254104763,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1632166234
    },
    {
        "content": "<p>Alright, that's good to hear</p>",
        "id": 254104796,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166252
    },
    {
        "content": "<p>Let me know if there are any other issues</p>",
        "id": 254104812,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166262
    },
    {
        "content": "<p>do you need me to create a git issue so that we handle e being null?</p>",
        "id": 254104846,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1632166278
    },
    {
        "content": "<p>The problem is that there is no message for that kind of NPE...so it can't really be localized</p>",
        "id": 254104963,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166323
    },
    {
        "content": "<p>I'm not sure how to deal with that</p>",
        "id": 254104979,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166327
    },
    {
        "content": "<p>For sure create an issue with all the details</p>",
        "id": 254105020,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166349
    },
    {
        "content": "<p>please put the details into the ticket, not a link to this conversation</p>",
        "id": 254105056,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632166367
    },
    {
        "content": "<p>we should raise an informative error if e == null</p>",
        "id": 254110386,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632168717
    },
    {
        "content": "<p>'can't find element for path [x]'</p>",
        "id": 254110432,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632168725
    },
    {
        "content": "<p>don't need to worry about localizing that one</p>",
        "id": 254110448,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632168735
    },
    {
        "content": "<p>weird that the error was in resource bundle</p>",
        "id": 254110475,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632168746
    },
    {
        "content": "<p>hmm, the FHIR Git doesn't have an issues tab, so I can't raise an issue there</p>",
        "id": 254115306,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1632170804
    },
    {
        "content": "<p>this would be in the org.hl7.fhir.core repo</p>",
        "id": 254118188,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632171970
    },
    {
        "content": "<p>Is it possible that the build can dump the name of the last file it worked on? I get lots of NPEs for all sorts of things (but search params are a common one). It would narrow things down enormously. Maybe all the files are loaded ages before this part of the code, but if it even said \"processing search params\" that would help.</p>",
        "id": 254118364,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1632172060
    },
    {
        "content": "<p>yes loaded long before</p>",
        "id": 254120827,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632173088
    },
    {
        "content": "<p>is saying what the current action is to little more detail possible?</p>",
        "id": 254122968,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1632174077
    },
    {
        "content": "<p>well, that's a tricky...  the logs are already pretty big</p>",
        "id": 254123109,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632174130
    },
    {
        "content": "<p>what would be really useful is that you should never have to chase NPEs, and so if you ever get one, report it here. It's generally easy for us to fix them so you get an informative error message; it's finding them that's hard</p>",
        "id": 254123178,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632174178
    },
    {
        "content": "<p>I keep running it and eventually get it to finish, but some times it has taken 3-4 times.</p>",
        "id": 254123816,
        "sender_full_name": "Melva Peters",
        "timestamp": 1632174505
    },
    {
        "content": "<p><a href=\"https://dev.azure.com/fhir-pipelines/fhir-publisher/_build/results?buildId=4303&amp;view=logs&amp;j=ab68b630-6476-573a-954f-d89e4292687e&amp;t=ab58c233-aa15-51d8-8258-3d2a9910e74a&amp;l=330\">https://dev.azure.com/fhir-pipelines/fhir-publisher/_build/results?buildId=4303&amp;view=logs&amp;j=ab68b630-6476-573a-954f-d89e4292687e&amp;t=ab58c233-aa15-51d8-8258-3d2a9910e74a&amp;l=330</a><br>\nnot sure if that is useable</p>",
        "id": 254267211,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1632253733
    },
    {
        "content": "<p>Are you asking for assistance in investigating that?</p>",
        "id": 254269013,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1632254505
    },
    {
        "content": "<p>No thanks. Grahame asked for examples of NPEs to be posted. This is one I eventually resolved on another branch, but I thought it may help.</p>",
        "id": 254271831,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1632255706
    }
]