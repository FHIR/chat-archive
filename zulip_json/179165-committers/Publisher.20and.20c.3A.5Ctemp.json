[
    {
        "content": "<p>I just downloaded a new version of publisher today and started getting the following error.  Is writing to c:\\temp something new?  My system is very locked down and I don't have access to that folder so assume that is the issue but insight appreciated (Note that before update all was working fine)  C:\\Users\\lmicha2\\Downloads\\deqm&gt;_genonce<br>\nChecking internet connection...<br>\nReply from 104.196.166.17: bytes=32 time=95ms TTL=115<br>\nWe're online<br>\nPicked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8<br>\nException in thread \"main\" java.io.FileNotFoundException: c:\\temp\\fhir-ig-publisher-tmp.log (Access is denied)<br>\n        at java.base/java.io.FileOutputStream.open0(Native Method)<br>\n        at java.base/java.io.FileOutputStream.open(FileOutputStream.java:298)<br>\n        at java.base/java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:237)<br>\n        at java.base/java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:126)<br>\n        at org.hl7.fhir.igtools.publisher.utils.PublisherConsoleLogger.start(PublisherConsoleLogger.java:27)<br>\n        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8281)<br>\nPress any key to continue . . . </p>\n<p>If I am understanding correctly, I will see if I can get access to c:\\temp...</p>",
        "id": 220182992,
        "sender_full_name": "Linda",
        "timestamp": 1608158029
    },
    {
        "content": "<p>yes, that's pretty new</p>",
        "id": 220184443,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1608158773
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 220188233,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1608161247
    },
    {
        "content": "<p>I mean, yes, it is now a requirement that you have the temp directory and yes, it is a recent update</p>",
        "id": 220194001,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1608165697
    },
    {
        "content": "<p>many machines won't have a temp directory or allow unfettered access to a temp directory, so we need to find an alternative</p>",
        "id": 220194083,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1608165760
    },
    {
        "content": "<p>although I will say that I just updated the publisher and ran it on my unix machine and didn't see this error.  I changed the user to one who has less permissions and then saw a similar error</p>",
        "id": 220194215,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1608165899
    },
    {
        "content": "<p>is the build following the TEMP environment variable, or just hard coded to C:\\temp?</p>",
        "id": 220198165,
        "sender_full_name": "John Moehrke",
        "timestamp": 1608169353
    },
    {
        "content": "<p>it seems to be hard-coded... that is not a good idea. sometimes C: is a read-only drive</p>",
        "id": 220198326,
        "sender_full_name": "John Moehrke",
        "timestamp": 1608169528
    },
    {
        "content": "<p>it is a requirement that every machine has a temporary directory, yes.</p>",
        "id": 220293310,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608234857
    },
    {
        "content": "<p>I have no idea why it be trying to use c:\\temp if it doesn't exist</p>",
        "id": 220293342,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608234873
    },
    {
        "content": "<p>no. I see. If you have a c:\\temp folder, it will try and use it as the temporary directory. Why do you have one that is not accessible?</p>",
        "id": 220293583,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608234995
    },
    {
        "content": "<blockquote>\n<p>many machines won't have a temp directory or allow unfettered access to a temp directory</p>\n</blockquote>",
        "id": 220293686,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608235059
    },
    {
        "content": "<p>I'm not interested in trying to support machines that don't provide a temporary scratch space</p>",
        "id": 220293710,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608235074
    },
    {
        "content": "<p>in the proper place</p>",
        "id": 220293720,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608235078
    },
    {
        "content": "<p>The proper place would be where the corresponding  environment variable points to, wouldn't it? To be more precise, <code>java.io.tmpdir</code> makes a system call that tries to resolve %TEMP% or %TMP% on Windows. On Linux and Mac, <code>java.io.tmpdir</code> is hardcoded to /tmp</p>\n<p>Alternatively, creating a temp directory relative to the base directory the publisher is running could work, I think.</p>",
        "id": 220298839,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1608237463
    },
    {
        "content": "<p>Vassil is on the target for my suggestion. You should follow the TEMP environment variable. Some C: drives might have a \\temp, yet the TEMP environment variable points at a a much faster medium.</p>",
        "id": 220317992,
        "sender_full_name": "John Moehrke",
        "timestamp": 1608247760
    },
    {
        "content": "<p>the code will use java.io.tmp unless it sees a c:\\temp, in which case it uses that. Since on windows, the temporary folder is buried deep inside a hidden folder; this is a nightmare place to put a log that you then must ask a user to get you (Microsoft hates users...)</p>",
        "id": 220326897,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608254805
    },
    {
        "content": "<blockquote>\n<p>Since on windows, the temporary folder is buried deep inside a hidden folder</p>\n</blockquote>\n<p>Yes, by default %TEMP% and %TMP% point to %USERPROFILE%\\AppData\\Local\\Temp<br>\nSounds like the exception should be not only if C:\\temp exists, but also if %TEMP% or %TMP% are set to their default values (ending in AppData\\Local\\Temp)</p>",
        "id": 220328822,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1608256653
    },
    {
        "content": "<p>well, it turns out that on a Mac, the tmp folder is also deep inside a hidden folder :)<br>\njava.io.tmpdir = /var/folders/f8/4jjd500570q0jt3h1stsf...</p>",
        "id": 220329092,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1608256923
    },
    {
        "content": "<p>I'd suggest the correct approach is to let the OS put the temp files where the OS wants to put temp files, and telling the user to <code>cd %TMP%</code> if they want a copy.</p>",
        "id": 220329946,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1608257822
    },
    {
        "content": "<p>On my windows machine java.io.tmpdir, %TEMP% and %TMP% all point to %USERPROFILE%\\AppData\\Local\\Temp</p>",
        "id": 220330032,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1608257916
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179165-committers/topic/Publisher.20and.20c.3A.5Ctemp/near/220326897\">said</a>:</p>\n<blockquote>\n<p>the code will use java.io.tmp unless it sees a c:\\temp, in which case it uses that. Since on windows, the temporary folder is buried deep inside a hidden folder; this is a nightmare place to put a log that you then must ask a user to get you (Microsoft hates users...)</p>\n</blockquote>\n<p>If you want to go that approach, I'd recommend checking CRUD permissions on <code>C:\\temp</code> instead of just existence.  It's common to both have that directory and not have permission to write to it.</p>",
        "id": 220384594,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1608305128
    },
    {
        "content": "<blockquote>\n<p>It's common to both have that directory and not have permission to write to it</p>\n</blockquote>\n<p>why? bizarre.</p>",
        "id": 220419905,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608320829
    },
    {
        "content": "<blockquote>\n<p>telling the user to cd %TMP% if they want a copy</p>\n</blockquote>\n<p>I'll refer all users to Elliot so you can work them through it</p>",
        "id": 220419948,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608320855
    },
    {
        "content": "<p>Many orgs have the computers locked down so that everything comes from the User's profile directory - e.g., to allow signing in on any device and having all your files there.  The rest of the computer (or at least fixed drives) are all locked for user writing so that users can't 'lose' documents by writing them in the wrong locations.</p>\n<p>Not my favorite practice, but it's common enough that I'm not surprised when I run into it.</p>",
        "id": 220431613,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1608327960
    },
    {
        "content": "<p>If it needs to be in an easy to find location, what's wrong with the build directory?</p>",
        "id": 220436052,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1608330729
    }
]