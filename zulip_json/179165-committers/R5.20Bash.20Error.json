[
    {
        "content": "<p>Ran into the following error while making a pull request to the master branch:</p>\n<div class=\"codehilite\"><pre><span></span><code>mv: cannot stat &#39;/home/***/uploading/www/branches/r5-mnm-changes-1&#39;: No such file or directory\nfind: &#39;./Pharmacy20210218&#39;: No such file or directory\n##[error]Bash exited with code &#39;1&#39;.\n</code></pre></div>\n<p>It looks similar to the issue that <span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> ran into with the R4B branch if that helps, though I'm not sure if that issue got resolved.</p>",
        "id": 230597020,
        "sender_full_name": "Marc Duteau",
        "timestamp": 1615931497
    },
    {
        "content": "<p>You might ask here: <a href=\"#narrow/stream/179293-committers.2Fgit-help\">https://chat.fhir.org/#narrow/stream/179293-committers.2Fgit-help</a>.  That's where the experts who promised to help with Git issues hang out.  (Unfortunately, I'm not one of them...)</p>",
        "id": 230697444,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1615990739
    },
    {
        "content": "<p>This isn't a git error, it's an error in the build process.  It's basically the same error that some of us saw on the R4B branch and it's affecting this pull request on R5.</p>",
        "id": 230709769,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1615995072
    },
    {
        "content": "<p>Yeah, this is an error that is occurring server side when it tries to upload the built branch to the server. What I don't understand is why it only happens to some people and not others... It's trying to look for a branch name that doesn't exist</p>",
        "id": 230738468,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616004000
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span>  now I have the same error on a different branch/pull request:</p>\n<div class=\"codehilite\"><pre><span></span><code>Publishing to target jd-pharmacy\n501M    .\n962M    .\n1.5G    .\nmv: cannot stat &#39;/home/***/uploading/www/branches/jd-pharmacy&#39;: No such file or directory\nfind: &#39;./Consent-for-R4B&#39;: No such file or directory\n##[error]Bash exited with code &#39;1&#39;.\n</code></pre></div>",
        "id": 230919875,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616093922
    },
    {
        "content": "<p>Consent-for-R4B was merged and deleted.  You need to update your branch list</p>",
        "id": 230920040,
        "sender_full_name": "David Pyke",
        "timestamp": 1616093993
    },
    {
        "content": "<p>git fetch -p</p>",
        "id": 230920188,
        "sender_full_name": "David Pyke",
        "timestamp": 1616094034
    },
    {
        "content": "<p>Thanks David, I had not had the chance to look into a solution for this</p>",
        "id": 230920604,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616094160
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192587\">@David Pyke</span> Are you saying I need to do that?  Or does Mark need to do that?</p>",
        "id": 230931077,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616098802
    },
    {
        "content": "<p>you need to do that</p>",
        "id": 230931137,
        "sender_full_name": "David Pyke",
        "timestamp": 1616098815
    },
    {
        "content": "<p>okay, except that I started with a brand new clone of the repository this morning, made a branch, made changes, pushed the changes, and made a pull request.  Why would my branch list be out-of-date?</p>",
        "id": 230931323,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616098898
    },
    {
        "content": "<p>It does.  I get that all the time.  I even have a script to run to clean it up after a pull request</p>",
        "id": 230931494,
        "sender_full_name": "David Pyke",
        "timestamp": 1616098978
    },
    {
        "content": "<p>git fetch -p<br>\ngit branch --unset-upstream<br>\ngit checkout master<br>\ngit pull</p>",
        "id": 230931558,
        "sender_full_name": "David Pyke",
        "timestamp": 1616099006
    },
    {
        "content": "<p>Is this something new?  I've never seen this and there are branches merged and deleted all of the time.</p>",
        "id": 230931694,
        "sender_full_name": "Melva Peters",
        "timestamp": 1616099058
    },
    {
        "content": "<p>i don't think that will solve anything.  your git commands don't do anything to my branch and certainly doesn't do anything to the build pipeline that is set up and is trying to copy a branch that a) may not exist and b) I don't even reference in my pull request.</p>",
        "id": 230931811,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616099116
    },
    {
        "content": "<p>yeah, this isn't going to solve anything because it doesn't change anything on my branch.  the problem is still in Mark's build pipeline scripts.</p>",
        "id": 230932294,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616099336
    },
    {
        "content": "<p>I'm now getting a similar error for the first time today (and did the exact same steps as earlier this week without issue).<br>\n<a href=\"https://github.com/HL7/fhir/pull/1184/\">https://github.com/HL7/fhir/pull/1184/</a></p>\n<blockquote>\n<p>mv: cannot stat '/home/***/uploading/www/branches/michelle-miller-30769-Procedure-method-extension-cardinality': No such file or directory</p>\n</blockquote>\n<p>What is the fix?</p>",
        "id": 231024803,
        "sender_full_name": "Michelle (Moseman) Miller",
        "timestamp": 1616161676
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Given that R5 changes for the upcoming ballot are due in 11 days, these issues are a definite problem.  Is one of you digging into them?</p>",
        "id": 231025002,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616161749
    },
    {
        "content": "<p>I will dig into it now</p>",
        "id": 231026878,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616162517
    },
    {
        "content": "<p>Alright, so here's where I'm at so far. I cannot replicated this locally...yet. I was able to run the same publish commands locally on my box with no issues...in fact, you can see Michelle's published branch here: <a href=\"https://build.fhir.org/branches/michelle-miller-30769-Procedure-method-extension-cardinality/\">https://build.fhir.org/branches/michelle-miller-30769-Procedure-method-extension-cardinality/</a></p>\n<p>I'm unsure why there are conflicts with branch names...that no longer exist. I'm trying once again with my own, new, local branch, but I suspect that will succeed as well. I think this has to do with the way that Azure pipelines is cloning the repo. I'm going to look into that, and attempt to replicate the exact steps azure uses to clone from git to see why this might be happening.</p>",
        "id": 231037832,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616166496
    },
    {
        "content": "<p>So, I can replicate this now. The uploads _are_ actually working, it's just returning an error that the folder name doesn't exist? I will figure out why that is happening.</p>",
        "id": 231039564,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616166999
    },
    {
        "content": "<p>It always works the second time, the issue is that the server tries to execute a move to a folder that doesn't exist yet</p>",
        "id": 231043277,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168490
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> you sent me this code snippet before, but in the code here: <a href=\"https://github.com/FHIR/auto-ig-builder/blob/master/images/ci-build/publish#L22-L25\">https://github.com/FHIR/auto-ig-builder/blob/master/images/ci-build/publish#L22-L25</a></p>",
        "id": 231043355,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168521
    },
    {
        "content": "<p>specifically line 23</p>",
        "id": 231043426,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168538
    },
    {
        "content": "<p>shouldn't it be <code>mkdir -p ~/uploading/www/branches/$DEPLOY_TO_BRANCH</code></p>",
        "id": 231043530,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168585
    },
    {
        "content": "<p>I think line 24 is where the error is occurring</p>",
        "id": 231043578,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168609
    },
    {
        "content": "<p>if you don't mind me asking, why is it trying to move the folder?  Isn't the point of this pull request process just to see if the build passed without errors?  Why do we then need to move that branch anywhere when it is just trying to be merged and might be deleted shortly?</p>",
        "id": 231043722,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616168666
    },
    {
        "content": "<p>This is occurring on the server, I didn't write this code, so I am unsure. If I had to guess, I would assume the uploaded tar is unzipped and then moved to the proper directory</p>",
        "id": 231043840,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168718
    },
    {
        "content": "<p>The issue is that the server is returning an error, which while not detrimental to the build process, is being caught by azure and it is flagging it as a fail</p>",
        "id": 231044007,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168769
    },
    {
        "content": "<p>which is the correct thing for azure to do</p>",
        "id": 231044040,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168777
    },
    {
        "content": "<p>understood, except I'm wondering why this step is occurring at all.  In the azure pipeline for FHIR core builds, it seems like it should just build the branch and if that passes without error, stop.</p>",
        "id": 231044157,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616168837
    },
    {
        "content": "<p>I'm just doing a test right now, re-running this build here: <a href=\"https://dev.azure.com/fhir-pipelines/fhir-publisher/_build/results?buildId=2841&amp;view=logs&amp;j=ab68b630-6476-573a-954f-d89e4292687e\">https://dev.azure.com/fhir-pipelines/fhir-publisher/_build/results?buildId=2841&amp;view=logs&amp;j=ab68b630-6476-573a-954f-d89e4292687e</a></p>",
        "id": 231044163,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168839
    },
    {
        "content": "<p>I'm curious if the behaviour I'm seeing locally on my machine (fail always the first time, succeeds afterwards) is going to be mirrored by the pipeline</p>",
        "id": 231044337,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168886
    },
    {
        "content": "<p>if it is, then I'm 99% sure this is the issue</p>",
        "id": 231044363,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168895
    },
    {
        "content": "<p>if it fails again, I will have to start digging again</p>",
        "id": 231044412,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616168915
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192166\">@Jean Duteau</span> Some users want to preview their build on the website before the merge?</p>",
        "id": 231046741,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616169725
    },
    {
        "content": "<p>Yeah the upload I just tested worked the second time. This is a server side problem with the way the files are moved around.</p>",
        "id": 231047270,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616169927
    },
    {
        "content": "<p>sure, but that seems like it should be a different process from the pull request.  Obviously the error needs to be fixed but for merging pull requests, all we need is confirmation that the branch build succeeds.</p>",
        "id": 231047391,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616169973
    },
    {
        "content": "<p>It's more part of the CI process, in theory, we want to do a full upload and test before merging into master</p>",
        "id": 231047577,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616170066
    },
    {
        "content": "<p>because, if it does fail, we want it to fail on the branch and not master</p>",
        "id": 231047639,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616170084
    },
    {
        "content": "<p>a full CI is not just about \"does it build\"</p>",
        "id": 231047683,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616170105
    },
    {
        "content": "<p>gotta run it end to end. ...Ideally, we should have a process that tests if the branch webpage is live and working</p>",
        "id": 231047759,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616170134
    },
    {
        "content": "<p>i guess.  i'm not sure that is really needed, but I don't know enough about the CI pipeline :)</p>",
        "id": 231048262,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1616170360
    },
    {
        "content": "<p>There is a balance, I push things from a purely technical point of view, and then I get push back from the standards world.</p>",
        "id": 231048361,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616170409
    },
    {
        "content": "<p>the hope is that we meet somewhere that works for both worlds</p>",
        "id": 231048394,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616170423
    },
    {
        "content": "<p>I'm re-running everyone's jobs right now, in the hope that they succeed the second time as we've seen</p>",
        "id": 231048818,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616170588
    },
    {
        "content": "<p>I'm going to ignore error on the upload step for now, in hopes that I can talk with <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> to resolve this</p>",
        "id": 231048894,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616170634
    },
    {
        "content": "<blockquote>\n<p>Mark Iantorno: shouldn't it be mkdir -p ~/uploading/www/branches/$DEPLOY_TO_BRANCH</p>\n</blockquote>\n<p>No, if you do:</p>\n<div class=\"codehilite\"><pre><span></span><code>$ mkdir test-ig\n$ mkdir /tmp/test-ig\n$ mv test-ig/ /tmp/test-ig\n</code></pre></div>\n<p>then you wind up with <code>/tmp/test-ig/test-ig</code> when you want <code>/tmp/test-ig</code>.</p>",
        "id": 231052570,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616172028
    },
    {
        "content": "<blockquote>\n<p>I think line 24 is where the error is occurring</p>\n</blockquote>\n<div class=\"codehilite\"><pre><span></span><code> mv ~/uploading/$TARGET/ ~/uploading/www/branches/$DEPLOY_TO_BRANCH\n</code></pre></div>\n\n<p>How is this failing? Maybe I'm being dense here --- what specifically is going wrong, and why do you think so?</p>",
        "id": 231052760,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616172097
    },
    {
        "content": "<p>So, the error is happening when I execute this command: <br>\n<code> tar czf - * | ssh  -i $(Agent.TempDirectory)/deploy.rsa -p 2222 $(BUILD_FHIR_ORG_USERNAME)@build.fhir.org ./publish $TARGET_DIRECTORY</code><br>\n...which I don't think should be executing any <code>mv</code> commands locally...unless I truly have no idea what is going on. </p>\n<p>I think that error: <code>mv: cannot stat '/home/fhir_upload/uploading/www/branches/&lt;branch-name-here&gt;': No such file or directory</code> is coming from the server. This error only happens the first time a branch is uploaded, every subsequent run succeeds no problem. </p>\n<p>So we know from that, </p>\n<ol>\n<li>The first run will always fail on a new branch, all run after succeed</li>\n<li>There is due to the fact that a mv command is being executed, with the destination location being a directory with the branch name</li>\n<li>The first run actually still succeeds on the server, despite this error being returned. We know this because the website for that branch is live and working, even after the first run</li>\n</ol>\n<p>I think that the first time an upload runs, whatever process is on the server is creating the folder with the branch name successfully, but only after a mv is attempted and failed at some point. I'm not sure how to prove this though.</p>",
        "id": 231063456,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616176242
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 231063466,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616176246
    },
    {
        "content": "<blockquote>\n<p>mv: cannot stat '/home/fhir_upload/uploading/www/branches/&lt;branch-name-here&gt;': No such file or directory</p>\n</blockquote>\n<p>Yes you're getting this output -- but is the build <em>failing</em> at this step? the <code> || true</code> should prevent failure.</p>",
        "id": 231064211,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616176536
    },
    {
        "content": "<p>Yeah, I would ahve thought so as well, but...it is not?</p>",
        "id": 231064331,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616176575
    },
    {
        "content": "<p>So the publish script is printing this and <em>exiting</em>?</p>",
        "id": 231064489,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616176648
    },
    {
        "content": "<p>it's printing that and continuing, but Azure is detecting it and failing the step I'm pretty sure?</p>",
        "id": 231064895,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616176811
    },
    {
        "content": "<p>I'm not sure what it means to <em>continue</em> and to also <em>fail</em> the step. With <code>set -e</code> any failed step should exit the scrit. My understanding might be off here; is there a minimal example that might help reveal what's happening? Like when I test locally...</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ bash -c <span class=\"s1\">'exit 5'</span>\n$ <span class=\"nb\">echo</span> <span class=\"nv\">$?</span>\n<span class=\"m\">5</span>\n\n$ bash -c <span class=\"s1\">'exit 5'</span> <span class=\"o\">||</span> <span class=\"nb\">true</span>\n$ <span class=\"nb\">echo</span> <span class=\"nv\">$?</span>\n<span class=\"m\">0</span>\n</code></pre></div>",
        "id": 231066384,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616177378
    },
    {
        "content": "<p>Once the backlog of branches completes, I will try that, however...</p>",
        "id": 231066925,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177603
    },
    {
        "content": "<p>this is another example of one that hard fails</p>",
        "id": 231066947,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177610
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"publishing\"><pre><span></span><code>502M    .\n962M    .\n1.5G    .\nmv: cannot stat '/home/***/uploading/www/branches/michelle-miller-30769-Procedure-method-extension-cardinality': No such file or directory\nfind: './R4B-EBMonFHIR-Part-3': No such file or directory\nfind: './R4B-EBMonFHIR-Part-4': No such file or directory\n##[error]Bash exited with code '1'.\nFinishing: Bash\n</code></pre></div>",
        "id": 231066973,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177619
    },
    {
        "content": "<p>the upload is initiated locally with the command I posted before, but then the server throws those errors</p>",
        "id": 231067025,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177642
    },
    {
        "content": "<p>the mv command tell us it cannot stat</p>",
        "id": 231067086,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177656
    },
    {
        "content": "<p>then two find commands fail back to back'</p>",
        "id": 231067101,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177664
    },
    {
        "content": "<p>those are run remotely not locally</p>",
        "id": 231067130,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177678
    },
    {
        "content": "<p>they cause bash to hard exit</p>",
        "id": 231067154,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177691
    },
    {
        "content": "<p>the upload operation shouldn't care about those other two branches: R4B-EBMon...-3 &amp; -4</p>",
        "id": 231067327,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177759
    },
    {
        "content": "<p>yet it tries to find them and do something with them?</p>",
        "id": 231067388,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177770
    },
    {
        "content": "<p>Why is the server even concerned with them?</p>",
        "id": 231067413,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177778
    },
    {
        "content": "<blockquote>\n<p>find commands fail back to back</p>\n</blockquote>\n<p>This is what I was wondering about -- these aren't guarded by a <code>|| true</code>, so I could understand how these break a build (though I don't know what's going wrong with them)</p>",
        "id": 231067615,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616177872
    },
    {
        "content": "<p>Do you know what <code>find</code> is failing on?</p>",
        "id": 231067671,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616177883
    },
    {
        "content": "<p>I do not? This is all jsut from executing that one upload command</p>",
        "id": 231067724,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177904
    },
    {
        "content": "<blockquote>\n<p>upload operation shouldn't care about those other two branches</p>\n</blockquote>\n<p>We use \"someone uploaded something\" as a trigger for \"hey let's clean up old stuff\"</p>",
        "id": 231067743,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616177912
    },
    {
        "content": "<p>can we make that clean up process not cause a fail if something goes wrong?</p>",
        "id": 231067802,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616177937
    },
    {
        "content": "<p>Yeah, I'd look at <a href=\"https://github.com/FHIR/auto-ig-builder/blob/master/images/ci-build/publish#L33-L35\">https://github.com/FHIR/auto-ig-builder/blob/master/images/ci-build/publish#L33-L35</a> as the culprit ; consider adding a guard around this.</p>",
        "id": 231067872,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616177962
    },
    {
        "content": "<p>But... I don't know <em>why</em> that find should be able to fail.</p>",
        "id": 231067895,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616177971
    },
    {
        "content": "<p>like, what is going wrong?</p>",
        "id": 231067908,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616177978
    },
    {
        "content": "<p>no clue</p>",
        "id": 231068033,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178016
    },
    {
        "content": "<p>if I commit to that branch and that repo will it automatically go into prod?</p>",
        "id": 231068088,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178036
    },
    {
        "content": "<p>No, there's a manual step to build and re-deploy these.</p>",
        "id": 231068417,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616178151
    },
    {
        "content": "<p>But I'm wary about skipping things without understanding why they break. Let me try manually running this <code>find</code> in the current container and see what happens.</p>",
        "id": 231068514,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616178195
    },
    {
        "content": "<p>KK thank you</p>",
        "id": 231068716,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178286
    },
    {
        "content": "<p>It... runs fine with exit code 0 and no output.</p>",
        "id": 231069020,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616178428
    },
    {
        "content": "<p>Try with a brand new branch</p>",
        "id": 231069463,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178628
    },
    {
        "content": "<p>It consistently happens on the first try with a new branch</p>",
        "id": 231069490,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178643
    },
    {
        "content": "<p>I'm running this <code>find</code> command directly, not in the context of a branch upload.</p>",
        "id": 231069771,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616178750
    },
    {
        "content": "<p>What is <code>./R4B-EBMonFHIR-Part-3'</code> ? The find seems to be mentioning it in the output you shared above.</p>",
        "id": 231069802,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616178770
    },
    {
        "content": "<p>I would guess it was a branch at one point that existed</p>",
        "id": 231069865,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178794
    },
    {
        "content": "<p>And does not anymore</p>",
        "id": 231069879,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178805
    },
    {
        "content": "<p>So in that log out I sent above the person was trying to upload their branch, but somehow, a job on the server is looking for that other folder belonging to that other branch to do something with</p>",
        "id": 231070064,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178878
    },
    {
        "content": "<p>Each time an upload is performed we run</p>\n<div class=\"codehilite\"><pre><span></span><code>find . -path ./master -prune -o -type d -ctime +21  -path &#39;./*&#39;\n</code></pre></div>\n\n<p>which says \"which branches here are &gt;21 days old\"?</p>",
        "id": 231070140,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616178918
    },
    {
        "content": "<p>The upload has completed though, even though you get the bash upload failed, you can still navigate to <a href=\"http://build.fhir.org/branches\">build.fhir.org/branches</a> and see the newly uploaded branch</p>",
        "id": 231070171,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178937
    },
    {
        "content": "<p>Yeah I think this might be a result of that cleaning job</p>",
        "id": 231070200,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616178950
    },
    {
        "content": "<p>Right, so that's consistent with failing near the <code>find</code> step. Which happens after the upload and \"move into web hosting tree\" is done.</p>",
        "id": 231070207,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616178954
    },
    {
        "content": "<p>When you get an error is is <em>always</em> about \"./R4B-EBMonFHIR-Part-3\" ?</p>",
        "id": 231070381,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616179026
    },
    {
        "content": "<p>No</p>",
        "id": 231070392,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616179033
    },
    {
        "content": "<p>The branch name varies</p>",
        "id": 231070411,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616179043
    },
    {
        "content": "<p>Are they always branches with something in common? Some special character, some particular age? What's the pattern here?</p>",
        "id": 231070537,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616179091
    },
    {
        "content": "<p>I'll go through the last 5 failed builds and get the branch names</p>",
        "id": 231070588,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616179114
    },
    {
        "content": "<p>one sec</p>",
        "id": 231070592,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616179116
    },
    {
        "content": "<p>OK., thanks!</p>",
        "id": 231070647,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616179146
    },
    {
        "content": "<p>find: './R4B-EBMonFHIR-Part-3': No such file or directory<br>\nfind: './R4B-EBMonFHIR-Part-4': No such file or directory<br>\nfind: './R4B-EBMonFHIR-Part-5': No such file or directory<br>\nfind: './Consent-for-R4B': No such file or directory<br>\nfind: './R4B-EBMonFHIR-Part-1': No such file or directory<br>\nfind: './Pharmacy-20210223': No such file or directory<br>\nfind: './rik-meddef': No such file or directory<br>\nfind: './Pharmacy20210218': No such file or directory</p>",
        "id": 231071016,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616179293
    },
    {
        "content": "<p>those are the last 4 or so failed pipeline runs</p>",
        "id": 231071048,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616179312
    },
    {
        "content": "<p>Searching Zulip for these names... I see some of these branches (all?) deleted yesterday (like from GH). Should that matter?</p>",
        "id": 231071491,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616179486
    },
    {
        "content": "<p>I am unsure...? It shouldn't matter for the upload push though, right?</p>",
        "id": 231071768,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616179598
    },
    {
        "content": "<p>Shouldn't. But... looking for patterns :)</p>",
        "id": 231072601,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616179945
    },
    {
        "content": "<p>If you have a reliable way to trigger this error, I can try disabling the <code>find</code> step manually and we can test that (will have to be later though -- I'm in a workshop with divided attention).</p>",
        "id": 231073008,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616180123
    },
    {
        "content": "<p>I can trigger the error with a new branch publish</p>",
        "id": 231073271,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616180228
    },
    {
        "content": "<p>let me know and I will run one</p>",
        "id": 231073289,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616180236
    },
    {
        "content": "<p>takes 25 min</p>",
        "id": 231073300,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616180241
    },
    {
        "content": "<p>to run on azure</p>",
        "id": 231073317,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616180246
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> I'm just stepping away for a few minutes, but if you get your changes in before I get  back, you can start the test by opening this PR: <a href=\"https://github.com/HL7/fhir/compare/server_side_error_test_branch?expand=1\">https://github.com/HL7/fhir/compare/server_side_error_test_branch?expand=1</a></p>",
        "id": 231075044,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616180920
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> have you had a chance to push the changes in?</p>",
        "id": 231089361,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187662
    },
    {
        "content": "<p>Just getting a chance -- OK, edited</p>",
        "id": 231089862,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616187904
    },
    {
        "content": "<p>creating your test PR</p>",
        "id": 231089875,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616187910
    },
    {
        "content": "<p>ah don't merge!</p>",
        "id": 231089906,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187921
    },
    {
        "content": "<p>just create the pr</p>",
        "id": 231089915,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616187926
    },
    {
        "content": "<p>It worked?</p>",
        "id": 231096973,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616192045
    },
    {
        "content": "<p><a href=\"https://github.com/HL7/fhir/pull/1185\">https://github.com/HL7/fhir/pull/1185</a></p>",
        "id": 231096977,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616192046
    },
    {
        "content": "<p>I will monitor the issue</p>",
        "id": 231096995,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616192055
    },
    {
        "content": "<p>can you send me the commit with the changes you made when you get the chance please</p>",
        "id": 231097026,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616192072
    },
    {
        "content": "<p>I'm not comfortable committing these changes because I still don't know why they would help :/</p>",
        "id": 231098004,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616192740
    },
    {
        "content": "<p>But I guess you're confirming that they <em>have</em> helped?</p>",
        "id": 231098017,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616192756
    },
    {
        "content": "<p>I'm going to revert and poke again with another PR</p>",
        "id": 231098170,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616192865
    },
    {
        "content": "<p>Okay, makes sense</p>",
        "id": 231098766,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616193249
    },
    {
        "content": "<p>The PR worked</p>",
        "id": 231098807,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616193262
    },
    {
        "content": "<p>it is still throwing this error: mv: cannot stat '/home/***/uploading/www/branches/server_side_error_test_branch': No such file or directory<br>\nbut the other ones are not occuring</p>",
        "id": 231098900,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616193333
    },
    {
        "content": "<p>but that's fine as it's not causing the crash, the other ones were for sure</p>",
        "id": 231098923,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616193349
    },
    {
        "content": "<p>I also put a || true in the upload command locally to deal with the <code>\\mv: cannot stat '/home/***/uploading/www/branches/server_side_error_test_branch': No such file or directory issue</code></p>",
        "id": 231099009,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616193387
    },
    {
        "content": "<p>I don't think the line with <code>mv</code> is ever returning an exit status code other than <code>0</code>, is it? I'll instrument with more debugging output.</p>",
        "id": 231099432,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616193673
    },
    {
        "content": "<p>kk</p>",
        "id": 231099441,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616193681
    },
    {
        "content": "<p>it was jsut the other two then</p>",
        "id": 231099444,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616193686
    },
    {
        "content": "<p>and they did not occur</p>",
        "id": 231099454,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616193692
    },
    {
        "content": "<p>OK, got it.  Adding an \"echo\" to the rm arg makes it clear what's happening:</p>\n<div class=\"codehilite\"><pre><span></span><code>find  .  -path ./master -prune  -o -type d  -path &#39;./*&#39;  -exec echo rm  -rf {}  \\;\nrm -rf ./b\nrm -rf ./b/a\nrm -rf ./b/b\nrm -rf ./a\nrm -rf ./a/b\nrm -rf ./a/a\n</code></pre></div>\n<p>... we delete <code>b</code> and then try to delete <code>b/a</code> after <code>b</code> is gone.</p>",
        "id": 231103834,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616196518
    },
    {
        "content": "<p><a href=\"https://github.com/FHIR/auto-ig-builder/commit/fe48dde73835582f97ec9a6b4a9c29223dc58c47\">https://github.com/FHIR/auto-ig-builder/commit/fe48dde73835582f97ec9a6b4a9c29223dc58c47</a> should take care of it. Deploying...</p>",
        "id": 231103897,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616196578
    },
    {
        "content": "<p>(<a href=\"http://build.fhir.org\">build.fhir.org</a> should be back in a minute... and back!)</p>",
        "id": 231104138,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1616196741
    },
    {
        "content": "<p>Wonderful. Thanks Josh.</p>",
        "id": 231108770,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1616200589
    }
]