[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> see <a href=\"https://build.fhir.org/ig/HL7/UTG/\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/UTG/\">https://build.fhir.org/ig/HL7/UTG/</a> - this failed to build - but it's not listed in <a href=\"https://fhir.github.io/auto-ig-builder/builds.html\" target=\"_blank\" title=\"https://fhir.github.io/auto-ig-builder/builds.html\">https://fhir.github.io/auto-ig-builder/builds.html</a></p>",
        "id": 173251336,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565824796
    },
    {
        "content": "<p>Did it trigger a notification here?</p>",
        "id": 173251888,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1565825352
    },
    {
        "content": "<p>looks like no</p>",
        "id": 173252186,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565825664
    },
    {
        "content": "<p>it does have a webhook for <a href=\"https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger\" target=\"_blank\" title=\"https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger\">https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger</a>  (push)</p>",
        "id": 173252297,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565825767
    },
    {
        "content": "<p>Okay -- there are certainly some failure states that might prevent a message from coming through. I will plan to take a look at this tomorrow unless there is urgency?</p>",
        "id": 173253085,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1565826599
    },
    {
        "content": "<p>(in any it looks like the build was triggered and it failed because the publish-box was missing.)</p>",
        "id": 173254003,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1565827563
    },
    {
        "content": "<p>yes that will be why. But it should go into the list of IGs, right?</p>",
        "id": 173259608,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565835036
    },
    {
        "content": "<p>Yes -- actually UTG was showing up as failed in <a href=\"https://fhir.github.io/auto-ig-builder/builds.html\" target=\"_blank\" title=\"https://fhir.github.io/auto-ig-builder/builds.html\">https://fhir.github.io/auto-ig-builder/builds.html</a> but it was put at the bottom as \"unknown date of failure\". There are two issues: first is that no <code>qa.json</code> file is generated; and second is my logic for parsing dates out of <code>build.log</code> was wrong. I fixed the date parsing there, so UTG appears in the right spot. (I'm still unclear on why no qa.json is generated though.) </p>\n<p><a href=\"/user_uploads/10155/i2xJAVS7zC2TdUCgKLcdrXxz/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/i2xJAVS7zC2TdUCgKLcdrXxz/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/i2xJAVS7zC2TdUCgKLcdrXxz/pasted_image.png\"></a></div>",
        "id": 173311568,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1565892982
    },
    {
        "content": "<p>thx. I'll investigate the qa.json issue</p>",
        "id": 173313366,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565894402
    },
    {
        "content": "<p>As far as I can see, this is the issue with the UTG build:</p>\n<div class=\"codehilite\"><pre><span></span>Exception in thread &quot;main&quot; java.lang.Error: The auto-build infrastructure does not publish IGs that contain HTML pages without the publish-box present. For further information, see note at http://wiki.hl7.org/index.php?title=FHIR_Implementation_Guide_Publishing_Requirements#HL7_HTML_Standards_considerations\n</pre></div>\n\n\n<p>Ted and I discussed this yesterday.  Does UTG need to somehow be an exception to the publish box requirement, as it's not a typical IG?  Or does that need to be updated in UTG? <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 173314015,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1565894921
    },
    {
        "content": "<p>no it's very much not an exception to the version handling requirement</p>",
        "id": 173314963,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565895564
    },
    {
        "content": "<p>I committed a fix for this</p>",
        "id": 173314973,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565895575
    },
    {
        "content": "<p>(to UTG)</p>",
        "id": 173314977,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565895581
    },
    {
        "content": "<p>sounds good</p>",
        "id": 173316043,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1565896296
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> the current failing build is caused by a change in <a href=\"https://build.fhir.org/ig/qas.json\" target=\"_blank\" title=\"https://build.fhir.org/ig/qas.json\">https://build.fhir.org/ig/qas.json</a>:</p>\n<p>it used to say     </p>\n<p><code>\"repo\": \"nrdavis1/HSPCFHIRtest\"</code></p>\n<p>But it's changed to </p>\n<p><code>    \"repo\": \"nrdavis1/HSPCFHIRtest/branches/master/demo/qa.json\"</code></p>",
        "id": 187594182,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027196
    },
    {
        "content": "<p>at least, i think that's what it used to say</p>",
        "id": 187594187,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027208
    },
    {
        "content": "<p>Ooh, indeed. So, this is a change I made to support branches other than master -- didn't realize you have a dependency on qas.json!</p>",
        "id": 187594272,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027268
    },
    {
        "content": "<p>So: I can change this back, or we can update the build. I'd prefer to keep the full paths, because it opens up the possibiliy for doing more downstream. But let me know.</p>",
        "id": 187594310,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027317
    },
    {
        "content": "<p>hmm</p>",
        "id": 187594345,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027353
    },
    {
        "content": "<p>can you explain how it supports branches other than master?</p>",
        "id": 187594397,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027372
    },
    {
        "content": "<p>it's the 'qa.json' bit that's the real problem.</p>",
        "id": 187594417,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027395
    },
    {
        "content": "<p>The idea is that each qa.json file identifies which org, repo, and branch it's associated with.</p>",
        "id": 187594423,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027399
    },
    {
        "content": "<p>Like, you'd be okay with <code>\"nrdavis1/HSPCFHIRtest/branches/master/demo\"</code> or <code>\"nrdavis1/HSPCFHIRtest/branches/master/\"</code> ?</p>",
        "id": 187594447,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027424
    },
    {
        "content": "<p>hmm. ok. so in that URL there, what does 'demo' mean?</p>",
        "id": 187594451,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027426
    },
    {
        "content": "<p>I'd be ok with anything if I know what it means and how I have to process it</p>",
        "id": 187594486,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027454
    },
    {
        "content": "<p>Um, I'm not sure. <code>demo</code> is a directory inside the output, where qa.json resides.</p>",
        "id": 187594487,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027456
    },
    {
        "content": "<p>but I've been ignoring the whole branching thing when processing the list... I'm not sure what the right behavior is</p>",
        "id": 187594511,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027480
    },
    {
        "content": "<p>Looks like maybe a mistake: <a href=\"https://github.com/nrdavis1/HSPCFHIRtest/blob/master/demo/qa.json\" target=\"_blank\" title=\"https://github.com/nrdavis1/HSPCFHIRtest/blob/master/demo/qa.json\">https://github.com/nrdavis1/HSPCFHIRtest/blob/master/demo/qa.json</a> is checked into github!</p>",
        "id": 187594552,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027490
    },
    {
        "content": "<p>So, this gets at the question of how <code>qas.json</code> is created in the first place: by scanning the directory tree for any <code>qa.json</code> files. But I can filter that further, to make sure I only look at qa.json files in the root of the output of a successful build.</p>",
        "id": 187594624,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027567
    },
    {
        "content": "<p>so you're just finding a qa.json somewhere ? the other ones:</p>\n<p><code>cqframework/opioid-cds-r4/branches/Recommendations_Test/qa.json</code></p>\n<p>that makes sense</p>",
        "id": 187594634,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027573
    },
    {
        "content": "<p>qa.json that I produce will always and only be in output</p>",
        "id": 187594651,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581027586
    },
    {
        "content": "<p>Right, that one in cqframework is fine. OK. so two follow-ups:</p>\n<p>1) I'll update my <code>find</code> command to be more specific, and <br>\n2) Maybe the author of <a href=\"https://github.com/nrdavis1/HSPCFHIRtest/blob/master/demo/qa.json\" target=\"_blank\" title=\"https://github.com/nrdavis1/HSPCFHIRtest/blob/master/demo/qa.json\">https://github.com/nrdavis1/HSPCFHIRtest/blob/master/demo/qa.json</a> wants to clean up that repo (<span class=\"user-mention\" data-user-id=\"191411\">@Nathan Davis</span>  I think) -- but obviously we should be robust to stuff like this.</p>",
        "id": 187594749,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027655
    },
    {
        "content": "<p>On (1), deploying a fix now. Will then trigger a rebuild of <code>qas.json</code></p>",
        "id": 187595212,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581027987
    },
    {
        "content": "<p>OK, done.</p>",
        "id": 187595633,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581028301
    },
    {
        "content": "<p>So you'll still see outputs like <code>\"repo\": \"HL7/cimi-vital-signs/branches/master/qa.json\"</code>, but never to sub-paths like <code>demo</code>.</p>",
        "id": 187595695,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581028328
    },
    {
        "content": "<p>If you'd like, I can also strip the final path segment off of the output.</p>",
        "id": 187595725,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581028353
    },
    {
        "content": "<p>no it's fine. I'm doing a release shortly that fixes it</p>",
        "id": 187596040,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581028596
    },
    {
        "content": "<p>Thanks, and sorry for the change without notice! (These paths were previosuly all kinds of broken, with random truncations on branches other than master.)</p>",
        "id": 187596248,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581028761
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> and <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- I haven't looked into it yet, so feel free to disregard if you'd like.  But... SUSHI's ability to resolve <code>#current</code> versions of IGs just broke.  And I think it resolves from the build server.  So I'm guessing that maybe some of those layout changes affected our IG resolution code for <code>#current</code> versions.  And I expect that if others (Forge?) had similar code, it might affect them too.</p>",
        "id": 187597647,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1581029950
    },
    {
        "content": "<p>But right now that is a hypothesis.  I can let you know when I've looked into it and have some proof one way or another.</p>",
        "id": 187597678,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1581029976
    },
    {
        "content": "<p>Thanks for the heads up -- please let me know what you find. The joys of iteratively discovering that an initially single-purpose file (designed to fuel the build dashboard) has become a dependency for a bunch of other tools ;-)</p>",
        "id": 187598474,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581030694
    },
    {
        "content": "<p>Sorry for any trouble with this.</p>",
        "id": 187598485,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581030703
    },
    {
        "content": "<blockquote>\n<p>SUSHI's ability to resolve #current versions of IGs just broke</p>\n</blockquote>\n<p>I expect that's what we're talking about in this thread</p>",
        "id": 187599780,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581031958
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> hate to bug you, but this thread was kicked off when <span class=\"user-mention\" data-user-id=\"192993\">@Peter Williams</span> snomed ig didn't build... but it is not listed in the IG page at all right now.</p>",
        "id": 187606408,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581039928
    },
    {
        "content": "<p>OK, so I can confirm that it is the change to the <code>repo</code> property in the <code>qas.json</code> that is causing the issue for SUSHI.  We're actually following the exact formula that Grahame gave us for locating the current package, so it's no wonder we both were affected. ;-)</p>\n<blockquote>\n<p>how it works is that you access <a href=\"https://build.fhir.org/ig/qas.json\" target=\"_blank\" title=\"https://build.fhir.org/ig/qas.json\">https://build.fhir.org/ig/qas.json</a>. then, you sort that by date, and then iterate that json array from most recent to oldest to find either the package-id or canonical url that you are looking for the #current package for, and then fetch the package from <a href=\"https://build.fhir.org/ig/[repo]/package.tgz\" target=\"_blank\" title=\"https://build.fhir.org/ig/[repo]/package.tgz\">https://build.fhir.org/ig/[repo]/package.tgz</a></p>\n</blockquote>\n<p><a href=\"#narrow/stream/179239-tooling/topic/NPM.20package.20system/near/183582585\" title=\"#narrow/stream/179239-tooling/topic/NPM.20package.20system/near/183582585\">https://chat.fhir.org/#narrow/stream/179239-tooling/topic/NPM.20package.20system/near/183582585</a></p>",
        "id": 187607954,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1581042325
    },
    {
        "content": "<p>So I assume the fix is just to replace the trailing <code>/qa.json</code> with <code>/package.tgz</code>...  Should be easy enough.</p>",
        "id": 187608193,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1581042618
    },
    {
        "content": "<p>well.... I changed my pproach to just use the first 2 folders - org/repo, and drop all the branch information - I'm not sure when/whether I want the branch or the root. For the moment, I'm using the root only</p>",
        "id": 187610137,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581045643
    },
    {
        "content": "<p>Ah, OK.  Then we'll match your approach.  It probably wouldn't be good if we used a different approach than the publisher.  Thanks for the heads up.  But in that case, sorting by date probably doesn't matter, right?  I mean, I expect the the first two folders (org/repo) will probably be the same for all of them?  We'll still do the sort just in case though.</p>",
        "id": 187610385,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1581046026
    },
    {
        "content": "<p>yes I still sort by date too</p>",
        "id": 187610501,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581046262
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> Thanks for the Forge ping, but we haven't built in logic yet that would try to find (#dev or) #current packages on the build server. We'll likely expose those versions from Simplifier too, so we'll need to think about generalizing that package logic anyway.</p>",
        "id": 187612201,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1581048985
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> hate to bug you, but this thread was kicked off when <span class=\"user-mention silent\" data-user-id=\"192993\">Peter Williams</span> snomed ig didn't build... but it is not listed in the IG page at all right now.</p>\n</blockquote>\n<p>No bother, but I do see it there now. In a success state from 10 hours ago. Is the issue that it is was not showing up when it fails?</p>",
        "id": 187633685,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581077529
    },
    {
        "content": "<p>I think so</p>",
        "id": 187681325,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581110402
    },
    {
        "content": "<p>hmm, OK. Right now I see other failed builds, so it must be something specific to the snomed IG. Maybe save a copy of qas.json and builds.json if this happens again?</p>",
        "id": 187681774,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581110757
    },
    {
        "content": "<p>ok</p>",
        "id": 187681878,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581110853
    },
    {
        "content": "<p>I've cleaned up (deleted actually) my repo that was mentioned last Friday. (<a href=\"https://github/nrdavis1/HSPCFHIRtest\" target=\"_blank\" title=\"https://github/nrdavis1/HSPCFHIRtest\">https://github/nrdavis1/HSPCFHIRtest</a>).  I have a question tho.  Why was this repo part of whatever process you were running that flagged it as an issue?  It wasn't an HL7 official repo.</p>",
        "id": 187860145,
        "sender_full_name": "Nathan Davis",
        "timestamp": 1581370103
    },
    {
        "content": "<p>we were doing maintenance on the ci-build subsystem, and yours uses the ci-build.</p>",
        "id": 187866556,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581374430
    },
    {
        "content": "<p>(as it should)</p>",
        "id": 187866802,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581374686
    }
]