[
    {
        "content": "<p>I am getting a build failure validating an example because the contained resource is not referenced.<br>\nThe contained one references the parent but the build examples validator doesn't seem to recognise it.</p>\n<p>I have tried:</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;MedicinalProductDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n    &lt;id value=&quot;equilidem-with-ing-and-auth&quot;/&gt;\n    &lt;contained&gt;\n        &lt;RegulatedAuthorization&gt;\n            &lt;id value=&quot;authorization&quot;/&gt;\n            &lt;subject&gt;\n                &lt;reference value=&quot;#&quot;/&gt;\n            &lt;/subject&gt;\n</code></pre></div>\n\n\n<p>and </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;MedicinalProductDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n    &lt;id value=&quot;equilidem-with-ing-and-auth&quot;/&gt;\n    &lt;contained&gt;\n        &lt;RegulatedAuthorization&gt;\n            &lt;id value=&quot;authorization&quot;/&gt;\n            &lt;subject&gt;\n                &lt;reference value=&quot;#equilidem-with-ing-and-auth&quot;/&gt;\n            &lt;/subject&gt;\n</code></pre></div>\n\n\n<p>and</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;MedicinalProductDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n    &lt;id value=&quot;equilidem-with-ing-and-auth&quot;/&gt;\n    &lt;contained&gt;\n        &lt;RegulatedAuthorization&gt;\n            &lt;id value=&quot;authorization&quot;/&gt;\n            &lt;subject&gt;\n                &lt;reference value=&quot;MedicinalProductDefinition/equilidem-with-ing-and-auth&quot;/&gt;\n            &lt;/subject&gt;\n</code></pre></div>",
        "id": 206601210,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1597165456
    },
    {
        "content": "<p>it's the parent that references the contained right?</p>",
        "id": 206605289,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597167283
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"nt\">&lt;MedicinalProductDefinition</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;contained&gt;</span>\n        <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;equilidem-with-ing-and-auth&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;RegulatedAuthorization&gt;</span>\n            <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;authorization&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;subject&gt;</span>\n                <span class=\"nt\">&lt;reference</span> <span class=\"na\">value=</span><span class=\"s\">&quot;#equilidem-with-ing-and-auth&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/subject&gt;</span>\n    <span class=\"nt\">&lt;/contained&gt;</span>\n    <span class=\"nt\">&lt;anotherElementInTheParentResource&gt;</span>\n                <span class=\"nt\">&lt;reference</span> <span class=\"na\">value=</span><span class=\"s\">&quot;#equilidem-with-ing-and-auth&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/anotherElementInTheParentResource&gt;</span>\n</code></pre></div>",
        "id": 206605431,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597167358
    },
    {
        "content": "<p>I thought that the contained cannot reference the parent - please correct me if I am mistaken</p>",
        "id": 206605549,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1597167397
    },
    {
        "content": "<p>no - it is the contained that references the parent, in this case (though I also have the opposite in the same example). That is allowed. But the build doesn't seem to like it. Maybe I need a different syntax or maybe the validator doesn't know this case properly</p>",
        "id": 206621438,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1597174855
    },
    {
        "content": "<p>what's the actual error message?</p>",
        "id": 206625283,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597176813
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code> [java] ERROR @ MedicinalProductDefinition.contained[0].ofType(RegulatedAuthorization).subject (line 0, col0): medicinalproductdefinition-example-equilidem-using-ingredient-and-auth:: MedicinalProductDefinition.contained[0].ofType(RegulatedAuthorization).subject: ref-1: SHALL have a contained resource if a local reference is provided ( (url: equilidem-with-ing-and-auth; ids: authorization,EquilidoniumPhosphate,CalciumCarbonate)) [reference.startsWith(&#39;#&#39;).not() or (reference.substring(1).trace(&#39;url&#39;) in %rootResource.contained.id.trace(&#39;ids&#39;))] (src = InstanceValidator)\n</code></pre></div>",
        "id": 206625539,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1597176942
    },
    {
        "content": "<p>and also      [java] ERROR @ MedicinalProductDefinition.contained[0].ofType(RegulatedAuthorization).subject (line 0, col0): medicinalproductdefinition-example-equilidem-using-ingredient-and-auth:: MedicinalProductDefinition.contained[0].ofType(RegulatedAuthorization).subject: Unable to resolve resource \"#equilidem-with-ing-and-auth\" (src = InstanceValidator)</p>",
        "id": 206625569,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1597176959
    },
    {
        "content": "<p>it varies based on what I try, but that is the gist of it</p>",
        "id": 206625631,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1597176978
    },
    {
        "content": "<p>there is a resource that nothing points at, it thinks, and a resource reference that points at nothing, it thinks. But they actually point at each other.</p>",
        "id": 206629585,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1597179023
    },
    {
        "content": "<p>is this still a problem?</p>",
        "id": 207223529,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597726626
    },
    {
        "content": "<p>your first example is correct. I'm confused as to why the invariant doesn't seem to allow it</p>",
        "id": 207223690,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597726879
    },
    {
        "content": "<p>yes this is still an issue as of today<br>\n     [java] medicinalproductdefinition-example-equilidem-using-ingredient-and-auth:: MedicinalProductDefinition.contained[0].ofType(RegulatedAuthorization).subject: Unable to resolve resource \"#\"<br>\n     [java] medicinalproductdefinition-example-equilidem-using-ingredient-and-auth:: MedicinalProductDefinition.contained[0].ofType(RegulatedAuthorization).subject: ref-1: SHALL have a contained resource if a local reference is provided ( (url: ; ids: authorization,EquilidoniumPhosphate,CalciumCarbonate)) [reference.startsWith('#').not() or (reference.substring(1).trace('url') in %rootResource.contained.id.trace('ids'))]</p>",
        "id": 209487447,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1599642394
    }
]