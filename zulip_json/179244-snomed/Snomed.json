[
    {
        "content": "<p>Naveen Mallela2:09 PM<br>\nHello everyone,</p>\n<p>Please help me with the snomed CT API query if you have implemented the same for Fhir.</p>\n<p><a href=\"http://hl7.org/fhir/R4/valueset-clinical-findings.html\" target=\"_blank\" title=\"http://hl7.org/fhir/R4/valueset-clinical-findings.html\">http://hl7.org/fhir/R4/valueset-clinical-findings.html</a></p>\n<p>I'm trying to fetch Fhir Snomed CT Clinical Findings grammatically by calling the Restful API (Snomstorm).<br>\nThe URI for the API call is <a href=\"https://snowstorm.ihtsdotools.org/snowstorm/snomed-ct/MAIN%2F2020-01-31/concepts/404684003/descendants?stated=false&amp;offset=0&amp;limit=10000\" target=\"_blank\" title=\"https://snowstorm.ihtsdotools.org/snowstorm/snomed-ct/MAIN%2F2020-01-31/concepts/404684003/descendants?stated=false&amp;offset=0&amp;limit=10000\">https://snowstorm.ihtsdotools.org/snowstorm/snomed-ct/MAIN%2F2020-01-31/concepts/404684003/descendants?stated=false&amp;offset=0&amp;limit=10000</a></p>\n<p>The issue i'm facing is the max limit we can fetch Concepts is 10,000. How do we fetch records from 10,001 to 20,000 and so on until we get all the concepts?</p>\n<p>Thanks, Naveen</p>",
        "id": 188958292,
        "sender_full_name": "Naveen Mallela",
        "timestamp": 1582572976
    },
    {
        "content": "<p>That's not a FHIR API call. Maybe <span class=\"user-mention\" data-user-id=\"192993\">@Peter Williams</span>  of SNOMED International can help you with that particular API.</p>",
        "id": 188969002,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1582580401
    },
    {
        "content": "<p>The FHIR way would be <code>[base]/$expand?url=http://hl7.org/fhir/ValueSet/clinical-findings&amp;count=10000&amp;offset=10000</code></p>",
        "id": 188995456,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1582613244
    },
    {
        "content": "<p>Yes, internally our server would have difficulty returning more than 10K concepts with a count/offset approach.   The Snowstorm API allows for using \"searchAfter\", but as <span class=\"user-mention\" data-user-id=\"191364\">@Peter Jordan</span>  says this is not the FHIR API we're talking about here.   <span class=\"user-mention\" data-user-id=\"266495\">@Naveen Mallela</span>  has been in contact with our helpdesk directly.   Thanks all!</p>",
        "id": 189023726,
        "sender_full_name": "Peter Williams",
        "timestamp": 1582640979
    },
    {
        "content": "<p>Thanks a lot Peter. Rory helped me getting on the call and showing me how to do it. He suggested me to install a local version of Snomstorm and we were able to make it work. Thanks a lot again.</p>",
        "id": 189328666,
        "sender_full_name": "Naveen Mallela",
        "timestamp": 1582909394
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192993\">@Peter Williams</span> Thanks a lot Peter. Rory helped me getting on the call and showing me how to do it. He suggested me to install a local version of Snomstorm and we were able to make it work. Thanks a lot again.</p>",
        "id": 189328835,
        "sender_full_name": "Naveen Mallela",
        "timestamp": 1582909502
    },
    {
        "content": "<p>Awesome!</p>",
        "id": 189329382,
        "sender_full_name": "Peter Williams",
        "timestamp": 1582909849
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span>  </p>\n<p>The correct way to fetch records for more than 10,000 is to use the endpoint \"concepts\" instead of \"descendents\". The &lt; should be append to the code we are searching and it will return all the descendents. <br>\nExample below \"&lt;404684003\" as the concept ID.</p>\n<p>1) The first query will return the first 10,000 using the URL<br>\n<a href=\"http://localhost:8080/MAIN/concepts?ecl=%3C404684003&amp;offset=0&amp;limit=10000\" target=\"_blank\" title=\"http://localhost:8080/MAIN/concepts?ecl=%3C404684003&amp;offset=0&amp;limit=10000\">http://localhost:8080/MAIN/concepts?ecl=%3C404684003&amp;offset=0&amp;limit=10000</a></p>\n<p>2) If we scroll to the end of the response we can find the properties total, limit, searchAfter and searchAfterArray.<br>\n\"total\":113597,\"limit\":500,\"searchAfter\":\"WzE1Njg1MjAxMDAwMTE5MTAwXQ==\",\"searchAfterArray\":[15685201000119100]</p>\n<p>So we take the value of searchAfter and add a new URL request header \"searchAfter\" and use the value of searchAfter=.</p>\n<p>Since its url, we need to replace = value as \"%3D\". So the actual url looks like below. </p>\n<p>3) <a href=\"http://localhost:8080/MAIN/concepts?ecl=%3C404684003&amp;offset=0&amp;limit=500&amp;searchAfter=WzE2MDA2MTExMDAwMTE5MTA3XQ%3D%3D\" target=\"_blank\" title=\"http://localhost:8080/MAIN/concepts?ecl=%3C404684003&amp;offset=0&amp;limit=500&amp;searchAfter=WzE2MDA2MTExMDAwMTE5MTA3XQ%3D%3D\">http://localhost:8080/MAIN/concepts?ecl=%3C404684003&amp;offset=0&amp;limit=500&amp;searchAfter=WzE2MDA2MTExMDAwMTE5MTA3XQ%3D%3D</a></p>\n<p>for the next 10K we follow the same process.</p>\n<p>Thanks, Naveen</p>",
        "id": 189331032,
        "sender_full_name": "Naveen Mallela",
        "timestamp": 1582910898
    }
]