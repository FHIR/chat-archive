[
    {
        "content": "<p>Hi. I'm trying to use the Belgian extension for SNOMED, but this comes as a 10MB file that doesn't seem to include the international bit, only the belgian stuff. It says in the download page:<br>\nThis is the PRODUCTION Release of the September 2019 SNOMED CT Belgium Extension.<br>\nThis package is dependent upon the SNOMED CT July 2019 International Edition, and so should be consumed and analysed accordingly.</p>",
        "id": 182705614,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1575580884
    },
    {
        "content": "<p>Can anyone advise how to compile this onto a full (International + Belgium) set?</p>",
        "id": 182705749,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1575580951
    },
    {
        "content": "<p>that is, in Rf2 format</p>",
        "id": 182705933,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575581062
    },
    {
        "content": "<p>Yes, I forgot to mention the RF2 format</p>",
        "id": 182706012,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1575581112
    },
    {
        "content": "<p>Depends on the tool you're using to import it, but certainly for our tool, we usually just concatenate the zip files (add all the contents of the relevant international release - in this case the july 2019 - into the extension zip)</p>",
        "id": 182719559,
        "sender_full_name": "Jim Steel",
        "timestamp": 1575593192
    },
    {
        "content": "<p>so... he's using my importer which only works with the combined RF2 data files. Simply combining them resulted in duplicate relationships?</p>",
        "id": 182730513,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575608113
    },
    {
        "content": "<p>We combine the files using the information in the Module Dependency Reference Set.<br>\nIt is the only valid way to create a SNAPSHOT release  (because an extension may invalidate some relationships in the International SNAPSHOT)</p>",
        "id": 182732425,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1575611395
    },
    {
        "content": "<p>That is, if the Belgian extension does more than just add Reference sets and new \"leaf\" concepts.</p>",
        "id": 182732479,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1575611460
    },
    {
        "content": "<p>Is this Module Dependency Reference Set (yes, I googled it) something I can use to combine my BE Extension with the corresponding Intl release? are there instructions or tools for that?</p>",
        "id": 182732749,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1575611877
    },
    {
        "content": "<p>The BE release is the first I've found that doesn't release the snapshot</p>",
        "id": 182732891,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575612068
    },
    {
        "content": "<p>OK so the best is to ask the BE people to get the snapshot... I will ask</p>",
        "id": 182733205,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1575612550
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> will it hurt (i.e. will it cause suffering) to simply bypass duplicates in the code? Just an early thought - I mean, if these are identified as duplicate, why throw an exception and not simply ignore it?</p>",
        "id": 182733271,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1575612631
    },
    {
        "content": "<p>If it's a \"conformant\" release then it (the MDRS) should be included.  But you still need a loader that understands what to do when combining the files; it't not just a matter of concatenating the file contents.</p>",
        "id": 182733278,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1575612647
    },
    {
        "content": "<blockquote>\n<p>what to do when combining the files</p>\n</blockquote>\n<p>that's why I was using the snapshot- ducking getting involved with this</p>",
        "id": 182733435,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575612922
    },
    {
        "content": "<p>The basic model is is determine the moduleId for the release you want - call this BE, and the release data, call this RD<br>\nLook in the MDRS for all active rows in module BE and effectiveTime RD.  This will give you a list of target moduleIds and associated target effectiveTimes - call these Mi and Ti<br>\nThen, for every input file exclude all rows where the module = one of the Mi and the effectiveTime is greater than the corresponding Ti<br>\nFinally, for every row, with the 1st column as the \"key\" select each row with the latest effectiveTime.</p>\n<p>For SNAPSHOT releases + simple extensions you're only going to exclude a few rows.  For non-simple extensions they should never be released in this partial form because they need to be run through a DL classifier to compute appropriate inferred relationships.</p>",
        "id": 182733749,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1575613475
    },
    {
        "content": "<p>To jump in here, the BE release is a valid RF2 extension release with FULL, DELTA and SNAPSHOT containing mostly translated descriptions. It can be downloaded from the Belgian NRC here <a href=\"http://mlds.ihtsdotools.org/be\" target=\"_blank\" title=\"http://mlds.ihtsdotools.org/be\">http://mlds.ihtsdotools.org/be</a> . With regards to using, as Michael points out, it depends on the tools you have. We loaded it into our terminology server used by the SNOMED CT Browser as an extension which is a branch off of the international edition.</p>",
        "id": 182770784,
        "sender_full_name": "Rory Davidson",
        "timestamp": 1575645896
    },
    {
        "content": "<p>hm. I applied for permission to access BE snomed so I can look</p>",
        "id": 182787804,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575656005
    },
    {
        "content": "<p>It is not improbable that I did something wrong. But I only saw a 10 MB file, and the International Edition was separate.</p>",
        "id": 182797368,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1575662005
    },
    {
        "content": "<p>I've also applied for permission to check :-)</p>",
        "id": 182813830,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1575673629
    },
    {
        "content": "<p>I feel like I needed a note from my parents</p>",
        "id": 182814847,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575674541
    },
    {
        "content": "<p>have you been good?</p>",
        "id": 182880618,
        "sender_full_name": "David Hay",
        "timestamp": 1575788081
    },
    {
        "content": "<p>hmm let's not actually ask my parents</p>",
        "id": 182882126,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575791404
    },
    {
        "content": "<p>best not...</p>",
        "id": 182882588,
        "sender_full_name": "David Hay",
        "timestamp": 1575792358
    },
    {
        "content": "<p>I just confirmed that in BE we do not have a single release file.</p>",
        "id": 184723269,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578046840
    },
    {
        "content": "<p>Does anyone know of practices/tools to do that?</p>",
        "id": 184723276,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578046862
    },
    {
        "content": "<p>Ask the snomed people. I am assuming you terminology center is working with them.  I would give you names/emails but it's probably best to go through the BE-TC.</p>",
        "id": 184726205,
        "sender_full_name": "Adam Flinton",
        "timestamp": 1578050328
    },
    {
        "content": "<p>&amp; in answer to your question yes there are tools etc.</p>",
        "id": 184726221,
        "sender_full_name": "Adam Flinton",
        "timestamp": 1578050356
    },
    {
        "content": "<p>By single release file I am assuming a zip containing both the be extension and the relevant intl release it is based off.</p>",
        "id": 184726353,
        "sender_full_name": "Adam Flinton",
        "timestamp": 1578050478
    },
    {
        "content": "<p>OK I will get the BE terminology center to check with SNOMED</p>",
        "id": 184726516,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578050703
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193753\">@Rory Davidson</span> and <span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> and I have been discussing it. In general, there is no plan to produce such a release. It's a tooling problem. What I haven't figured out is why the BE snapshot duplicates some things from the international release, and whether it's redefining them or just repeating them. It's on my todo list</p>",
        "id": 184796268,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578130058
    },
    {
        "content": "<p>I mentioned to the SCT BE team that we need a single file release. This is when they asked if there are tools because otherwise they must create a DB and run the process (I'm guessing deduplicating?)</p>",
        "id": 184796372,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578130220
    },
    {
        "content": "<p>Is there anything we can do to help? Perhaps I can send you and the BE people and email so that my ignorance is not a bottleneck</p>",
        "id": 184796381,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578130264
    },
    {
        "content": "<p>well, Snomed Intl have a lambda that will do it but it's not reusable outside a particular context. Really, it's our code that's supposed to manage this. Only I haven't had time to figure it out. You could look - for all the concepts, descriptions, and relationships duplicated, are their definitions the same? or different?</p>",
        "id": 184796653,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578130890
    },
    {
        "content": "<p>there's about a 1000 duplicates</p>",
        "id": 184796654,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578130908
    },
    {
        "content": "<p>I'll work on getting the duplicates and analysing this</p>",
        "id": 184796871,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578131397
    },
    {
        "content": "<p>I can for example look at where the servertools imports and detects a duplicate and log those for analysis.</p>",
        "id": 184796979,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578131579
    },
    {
        "content": "<p>y. you need to change to not blow up and instead log</p>",
        "id": 184797016,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578131642
    },
    {
        "content": "<p>Normally, there shouldn't be any duplicates in extensions, especially in the BE extension which is primarily only translated descriptions. Do you have any examples and I can dig further as well?</p>",
        "id": 184799740,
        "sender_full_name": "Rory Davidson",
        "timestamp": 1578136679
    },
    {
        "content": "<p>I ran the import tool logging the exceptions, and </p>\n<ol>\n<li>In the first phase, there were lots of times the same set of issues:</li>\n</ol>\n<div class=\"codehilite\"><pre><span></span>Unable to find caps type 900000000000003001\nUnable to find caps type 900000000000013009\nUnable to find caps type 900000000000550004\nUnable to find desc module 11000172109\nUnable to find desc module 900000000000012004\nUnable to find desc module 900000000000207008\nUnable to find desc type 900000000000003001\nUnable to find desc type 900000000000013009\n</pre></div>\n\n\n<ol start=\"2\">\n<li>After this, I still get a \"Duplicates not allowed\" but I do not know where this comes from, I cannot find that message in the code.</li>\n</ol>",
        "id": 184823485,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578179127
    },
    {
        "content": "<p>It's time for me to RTFM and see what needs to be done to these files</p>",
        "id": 184823496,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578179152
    },
    {
        "content": "<p>What I do find as \"duplicates\" is that the same concepts are being defined in different languages</p>",
        "id": 184824053,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578180238
    },
    {
        "content": "<p>Some examples, not knowing if insightful:<br>\nfrom sct2_Description_Snapshot-en_INT_20190731:</p>\n<div class=\"codehilite\"><pre><span></span>id  effectiveTime   active  moduleId    conceptId   languageCode    typeId  term    caseSignificanceId\n...\n215929010   20170731    1   900000000000207008  134187008   en  900000000000013009  Child protection procedure  900000000000448009\n...\n</pre></div>",
        "id": 184824092,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578180255
    },
    {
        "content": "<p>from sct2_Description_Snapshot-nl_BE1000172_20190915:</p>\n<div class=\"codehilite\"><pre><span></span>81000172116 20180315    1   11000172109 11000172109 nl  900000000000013009  Belgische module    900000000000017005\n341000172119    20180315    1   11000172109 134187008   nl  900000000000013009  procedure voor kinderbescherming    900000000000448009\n...\n</pre></div>",
        "id": 184824094,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578180268
    },
    {
        "content": "<p>from sct2_Description_Snapshot-fr_BE1000172_20190915:</p>\n<div class=\"codehilite\"><pre><span></span>71000172119 20180315    1   11000172109 11000172109 fr  900000000000013009  Module Belge    900000000000017005\n331000172114    20180315    1   11000172109 134187008   fr  900000000000013009  procédure de protection de l&#39;enfant 900000000000448009\n...\n</pre></div>",
        "id": 184824095,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578180276
    },
    {
        "content": "<p>the entire sct2_Description_Snapshot-en_BE1000172_20190915 is:</p>\n<div class=\"codehilite\"><pre><span></span>11000172113 20180315    1   11000172109 11000172109 en  900000000000003001  Belgian module (core metadata concept)  900000000000017005\n21000172115 20180315    1   11000172109 11000172109 en  900000000000013009  Belgian module  900000000000017005\n31000172117 20180315    1   11000172109 21000172104 en  900000000000003001  Belgian French language reference set (foundation metadata concept) 900000000000017005\n41000172112 20180315    1   11000172109 21000172104 en  900000000000013009  Belgian French language reference set   900000000000017005\n51000172114 20180315    1   11000172109 31000172101 en  900000000000003001  Belgian Dutch language reference set (foundation metadata concept)  900000000000017005\n61000172111 20180315    1   11000172109 31000172101 en  900000000000013009  Belgian Dutch language reference set    900000000000017005\n80481000172113  20180315    1   11000172109 71000172103 en  900000000000003001  Dichorionic triamniotic triplet pregnancy (disorder)    900000000000448009\n80491000172111  20180315    1   11000172109 71000172103 en  900000000000013009  Dichorionic triamniotic triplet pregnancy   900000000000448009\n80571000172114  20180315    1   11000172109 111000172100    en  900000000000003001  Monochorionic triamniotic triplet pregnancy (disorder)  900000000000448009\n80581000172112  20180315    1   11000172109 111000172100    en  900000000000013009  Monochorionic triamniotic triplet pregnancy 90000000000044800\n</pre></div>",
        "id": 184824097,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578180284
    },
    {
        "content": "<p>With regards to the duplicates, the BE descriptions are expected. As you say, these are new descriptions in different languages for the same concept which is an aspect of the SNOMED CT model enabling the unique concept id to be used irrelevant of which language is requested..</p>",
        "id": 184836647,
        "sender_full_name": "Rory Davidson",
        "timestamp": 1578206590
    },
    {
        "content": "<p>what are you loading from? snapshot?</p>",
        "id": 184847202,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578227712
    },
    {
        "content": "<p>yes</p>",
        "id": 184847577,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578228347
    },
    {
        "content": "<p>So, these are not \"duplicates\".  A SNOMED concept may have many descriptions (akin to a FHIR CodeSystem concept having many designations).<br>\nWhat is the import tool that you're using?</p>",
        "id": 184881265,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1578288894
    },
    {
        "content": "<p>Grahame's server utils</p>",
        "id": 184881585,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578289540
    },
    {
        "content": "<p>any further progress on this?</p>",
        "id": 185077784,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1578453869
    },
    {
        "content": "<p>Hi Rob. We're working on this. We're looking for some materials to demonstrate a terminology server for first timers.</p>",
        "id": 185095224,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578478283
    },
    {
        "content": "<p>If this helps, we have an open-source terminology server for SNOMED CT which supports the FHIR Terminology Services and manages both editions and extensions and is pretty quick to set up for demonstrations - <a href=\"https://github.com/IHTSDO/snowstorm\" target=\"_blank\" title=\"https://github.com/IHTSDO/snowstorm\">https://github.com/IHTSDO/snowstorm</a></p>",
        "id": 185104513,
        "sender_full_name": "Rory Davidson",
        "timestamp": 1578486426
    },
    {
        "content": "<p>This is interesting, thanks. Perhaps what we have in Belgium is an extension and can be handled as such...? We started some discussion to investigate. <br>\nThis server seems helpful</p>",
        "id": 185106778,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578488192
    },
    {
        "content": "<p>Yes, it is an extension in Belgium and should be handled as such. We use that server which hosts the online SNOMED CT browser for Belgium as well so it should work.</p>",
        "id": 185111466,
        "sender_full_name": "Rory Davidson",
        "timestamp": 1578491136
    },
    {
        "content": "<p>ok we will try.</p>",
        "id": 185113729,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578492375
    },
    {
        "content": "<p>Also the snapshot edition of the BE edition (or tools to generate itt) would be very useful.</p>",
        "id": 185113842,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578492458
    },
    {
        "content": "<p>the issue I have is duplicate relationships, not additional descriptions. here's some examples:</p>",
        "id": 185268084,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578612608
    },
    {
        "content": "<p>in the snapshot for the current BE release:</p>",
        "id": 185269075,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578613534
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>107532022   20180915    0   11000172109 116577007   116576003   0   116680003   900000000000011006  900000000000451002\n</pre></div>",
        "id": 185269079,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578613545
    },
    {
        "content": "<p>In the snapshot for international, v 20190731</p>",
        "id": 185269168,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578613598
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>107532022   20190131    0   900000000000207008  116577007   116576003   0   116680003   900000000000011006  900000000000451002\n</pre></div>",
        "id": 185269216,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578613640
    },
    {
        "content": "<p>I find 2753 examples of this</p>",
        "id": 185269228,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578613651
    },
    {
        "content": "<p>All the entries I have checked just have a different module Id. But that's only a small sampling...</p>",
        "id": 185269343,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578613741
    },
    {
        "content": "<p>I could not find the place in the import tool where duplicates are intercepted to log them. I just got a message \"Duplicates not allowed\"</p>",
        "id": 185269736,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578614056
    },
    {
        "content": "<p>I haven't committed that yet.</p>",
        "id": 185269748,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578614073
    },
    {
        "content": "<p>ah ok</p>",
        "id": 185269754,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578614079
    },
    {
        "content": "<p>in a few hours we will have a phone call with Rory and the BE crew, I think this can wait until then</p>",
        "id": 185269812,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1578614143
    },
    {
        "content": "<p>my import fails later with some error about refsets and field types. I'm expecting that this is my issue but I haven't had time to investigate yet</p>",
        "id": 185269902,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578614196
    },
    {
        "content": "<p>Are you getting this from the Full release (not the Snapshot)?</p>",
        "id": 185279359,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1578626888
    },
    {
        "content": "<p>full release of intl and snapshot of BE</p>",
        "id": 185281018,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578629799
    },
    {
        "content": "<p>Makes sense.  Are you following this <a href=\"https://confluence.ihtsdotools.org/display/DOCTSG/3.1+Generating+Dynamic+Snapshot+Views\" target=\"_blank\" title=\"https://confluence.ihtsdotools.org/display/DOCTSG/3.1+Generating+Dynamic+Snapshot+Views\">algorithm</a> for selecting the component rows for a particular snapshot view?  In the full release, for the rows with a particular component (concept, description, relationship, etc.) id, only the one with the most recent effectiveTime that is equal to or less than the specified snapshot time (usually, but not always, the current time) is selected for the snapshot view.  With an extension, as in the examples that you gave, if the extension version is based on the international release version that you are using (which it should be - presumably the current BE release is based on the international 20190731 release?), then for the current snapshot view you would still select only the row with the greatest effectiveTime, which in this case would be the row for 107532022 from the international release (with effectiveTime 20190131).  The row from the BE release (with effectiveTime 20180915) would be excluded.  That may resolve the duplicate?  <span class=\"user-mention\" data-user-id=\"193753\">@Rory Davidson</span> can correct me if I said anything wrong!</p>",
        "id": 185284076,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1578634964
    },
    {
        "content": "<p>Yes, <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>, that's correct. The most record with the most recent effective date trumps any previous records. This can span between modules as well. The snapshot only shows that most recent effective dated record, whereas the full contains them all.</p>",
        "id": 185296583,
        "sender_full_name": "Rory Davidson",
        "timestamp": 1578650863
    },
    {
        "content": "<p>ok thanks. I had not seen that link (and still can't, courtesy of Australia's 3rd world internet...). but I'll resolve it that way</p>",
        "id": 185299563,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578653398
    },
    {
        "content": "<p>ok thanks. I had not seen that link (and still can't, courtesy of Australia's 3rd world internet...). but I'll resolve it that way</p>",
        "id": 185299676,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578653482
    },
    {
        "content": "<p>But be careful when crossing modules - If the BE extension for 20180915 depends on the International Edition for 20180731, then that row above (Int module, but later date of 20190131) does NOT trump the BE row.</p>",
        "id": 186855292,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1580271796
    }
]