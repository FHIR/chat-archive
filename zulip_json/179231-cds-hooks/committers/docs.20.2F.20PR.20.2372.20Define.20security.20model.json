[
    {
        "content": "<p>kpshek opened <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a><br>\nfrom <code>issue/7-security</code> to <code>master</code></p>\n<blockquote>\n<p>This is an in-progress branch -- please don't bother reviewing right now. The purpose for issuing this pull request early is to get Heroku review apps deployed.</p>\n</blockquote>",
        "id": 153898833,
        "sender_full_name": "Github Notifications",
        "timestamp": 1501178653
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153901650,
        "sender_full_name": "Github Notifications",
        "timestamp": 1502381647
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153901768,
        "sender_full_name": "Github Notifications",
        "timestamp": 1502395444
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153904235,
        "sender_full_name": "Github Notifications",
        "timestamp": 1504209072
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/pull/72#issuecomment-326420227\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72#issuecomment-326420227\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>\n<blockquote>\n<p>Thanks for the great suggestions &amp; feedback @olbrich - I've replied to each inline above</p>\n</blockquote>",
        "id": 153904240,
        "sender_full_name": "Github Notifications",
        "timestamp": 1504213454
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153905047,
        "sender_full_name": "Github Notifications",
        "timestamp": 1504906048
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153905078,
        "sender_full_name": "Github Notifications",
        "timestamp": 1504930401
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153905129,
        "sender_full_name": "Github Notifications",
        "timestamp": 1504962720
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153905223,
        "sender_full_name": "Github Notifications",
        "timestamp": 1504977715
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153905248,
        "sender_full_name": "Github Notifications",
        "timestamp": 1504979019
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/pull/72#issuecomment-328349626\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72#issuecomment-328349626\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>\n<blockquote>\n<p>At the San Diego Connectathon this weekend (2017-09-09), a large group of us participating in the CDS Hooks track discussed this issue in an offline discussion. This group of ~30 represented a broad set of stakeholders, from multiple EHR vendors, several CDS Service providers, healthcare organizations, and those representing various HL7 working groups. What follows is the summary of our discussion and the consensus of the group.</p>\n<p>We affirmed our desire to define a standard approach to security within CDS Hooks. Additionally, our current proposed strategy has received overall positive implementer feedback. Particulars around the JWT did receive feedback that will warrant changes. Today, our JWT is based upon the JWT that SMART uses as part of the OpenID Connect workflow to assert a user identity. Based upon implementation feedback and considerations, we agreed that our use of a JWT is not to establish user identity but rather a bearer token for the CDS Service to authorize an EHR. As such, the content of our JWT would change, the details of which are below.</p>\n<ul>\n<li><code>sub</code>: remove this field as our JWT is not trying to assert a user identity</li>\n<li><code>iss</code>: Change this from the FHIR server URL to the URL of the actual issuer. This could still be the FHIR server but not guaranteed. For instance, in the case of the CDS Hooks Sandbox, the issuer would change to <a href=\"http://sandbox.cds-hooks.org\" target=\"_blank\" title=\"http://sandbox.cds-hooks.org\">http://sandbox.cds-hooks.org</a>. The reason for this change is that the <code>iss</code> value should be the entity responsible for signing the JWT. In the case of the CDS Hooks Sandbox, or other CDS Hooks systems which are capable of connecting to multiple/arbitrary FHIR servers, having the issuer be strictly the FHIR server is wrong.</li>\n<li><code>aud</code>: Change this to the URL of the CDS Service being invoked. Previously, this was the OAuth 2 client id of the CDS Service but the consensus of the community was that the CDS Service does not need to know this value. Additionally, making the audience the URL of the CDS Service being invoked will protect against JWTs be sent to incorrect audiences.</li>\n<li><code>jti</code>: Add this new field which is a nonce (UUID) to protect against replay attacks.</li>\n</ul>\n<p>I'll be updating the documentation to reflect these changes shortly.</p>\n</blockquote>",
        "id": 153905746,
        "sender_full_name": "Github Notifications",
        "timestamp": 1505056946
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153905783,
        "sender_full_name": "Github Notifications",
        "timestamp": 1505060389
    },
    {
        "content": "<p>brynrhodes review_requested <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153911928,
        "sender_full_name": "Github Notifications",
        "timestamp": 1506982387
    },
    {
        "content": "<p>isaacvetter <a href=\"https://github.com/cds-hooks/docs/pull/72#issuecomment-333715804\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72#issuecomment-333715804\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>\n<blockquote>\n<p>Kevin, </p>\n<p>I re-read the whole security section and came up with one substantive suggestion and many non-substantive suggestions.</p>\n<p>== Substantive ==<br>\nThis sentence:</p>\n<blockquote>\n<p>As such, the access token should be scoped to:<br>\nThe CDS Service being invoked<br>\nThe current user<br>\nThe current patient </p>\n</blockquote>\n<p>I don't think that the access_token should be limited to a specific patient. The CDS Service is acting on behalf of the user and therefore should have the same level of data access as the current user.  </p>\n<p>==Non-Substantive ==</p>\n<p>1. Replace \"The proposed security model has not yet received implementer feedback and as such, is subject to change\" with \"The CDS Hooks security model is undergoing a rigorous security assessment and as such, may be subject to change\"</p>\n<p>1. The language in the security section uses conditional sentences, which weaken the specification and use more words than necessary. Notably, look at the use of  the word \"should\". Some of these uses should be replaced with current tense, factual statements, using words like \"is\" and \"does\".  Let's only use \"should\" when there really is a choice to be made by an implementer. <br>\n* Each time the EHR makes a request to the CDS Service, it _should send_ an Authorization header <br>\n* Each time the EHR makes a request to the CDS Service, it _sends_ an Authorization header </p>\n<ul>\n<li>When the EHR invokes the CDS Service discovery endpoint, the aud value _should be either_</li>\n<li>When the EHR invokes the CDS Service discovery endpoint, the aud value _is either_</li>\n</ul>\n<p>1. These two sentences are overly complicated: \"Mutual TLS (mTLS) can be used between an EHR and CDS Service and that would allow the CDS Service to establish trust of the EHR. However, if mTLS is used, this should be in addition to using JSON web tokens to establish trust of the EHR.\" Replace with: <br>\n\"Mutual TLS (mTLS) _may be used alongside JSON web tokens to establish trust of the EHR by the CDS Service_. \"</p>\n<p>1. Using the slate doc column format (instead of the MkDocs inline code snippets), this sentence is pretty confusing: \"Try taking the example JWT here and pasting it into the form at <a href=\"https://jwt.io/\" target=\"_blank\" title=\"https://jwt.io/\">https://jwt.io/</a> to see how the token is constructed.\"</p>\n<p>1. \" TODO: Need to outline the risks of noalg signatures\" Do we really? </p>\n<p>1. Suggest replacing \" TODO: Need to propose how the EHR public key is discovered. Preference would be a further extension in the EHR FHIR server Conformance resource.\" with \" TODO: CDS Hooks doesn't yet specify how a CDS Service discovers the public key that the EHR uses to sign the JWT. \"</p>\n<p>1. \"likely result in a slow performing CDS Service due to the authorization overhead.\" should either use the term \"slow\" or \"poorly performing\" in place of \"slow performing\". </p>\n</blockquote>",
        "id": 153911952,
        "sender_full_name": "Github Notifications",
        "timestamp": 1506995365
    },
    {
        "content": "<p>isaacvetter labeled <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153914953,
        "sender_full_name": "Github Notifications",
        "timestamp": 1508445423
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153915506,
        "sender_full_name": "Github Notifications",
        "timestamp": 1508789495
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153916806,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509391461
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153916814,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509392555
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/pull/72#issuecomment-340563968\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72#issuecomment-340563968\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\" data-user-id=\"558\">@Isaac Vetter</span> &amp; @brynrhodes - I've addressed all of your comments in 3cb827a.</p>\n<p>Could you guys both take a look at this document and approve the merge if it looks good?</p>\n</blockquote>",
        "id": 153916817,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509393135
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153916826,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509394629
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153916837,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509395398
    },
    {
        "content": "<p>kpshek synchronized <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153916848,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509396109
    },
    {
        "content": "<p>kpshek closed <a href=\"https://github.com/cds-hooks/docs/pull/72\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/pull/72\">PR #72</a></p>",
        "id": 153916856,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509397218
    }
]