[
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span> ,</p>\n<p>This is with reference to doing a GET on <a href=\"https://3.92.228.209:9443/fhir-server/api/v4/Patient\">https://3.92.228.209:9443/fhir-server/api/v4/Patient</a> using smartonfhir.<br>\nI tried sending scopes user/<em>.</em> to do a GET all patients, but it says \"Authorization token is missing 'patient_id' claim\". </p>\n<p>My token is as below:</p>\n<p>{<br>\n  \"nbf\": 1647868834,<br>\n  \"exp\": 1647872434,<br>\n  \"iss\": \"<a href=\"https://oauthserver.justtest.in\">https://oauthserver.justtest.in</a>\",<br>\n  \"aud\": [<br>\n    \"<a href=\"https://fhirserver.justtest.in:9443/fhir-server/api/v4\">https://fhirserver.justtest.in:9443/fhir-server/api/v4</a>\",<br>\n    \"Inferno\"<br>\n  ],<br>\n  \"client_id\": \"InternalToken\",<br>\n  \"jti\": \"E6F5283E7911A8775E78004B7B28274D\",<br>\n  \"iat\": 1647868834,<br>\n  \"upn\": \"fhiruser\",<br>\n  \"need_patient_banner\": \"false\",<br>\n  \"smart_style_url\": \"<a href=\"https://oauthserver.justtest.in/SmartOnFHIR/v1.json\">https://oauthserver.justtest.in/SmartOnFHIR/v1.json</a>\",<br>\n  \"scope\": \"user/<em>.</em>\",<br>\n  \"group\": [<br>\n    \"FHIRUsers\",<br>\n    \"FHIRAdmins\"<br>\n  ]<br>\n}</p>\n<p>Is it required to always send 'patient_id' as part of the token?</p>\n<p>My use case is, a provider logs into an app, after it is authorized by the OAuth application, it needs to get the patients in the FHIR server.</p>\n<p>Could you please share your thoughts on this?</p>\n<p>Regards.<br>\nSagar</p>",
        "id": 276053058,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1647870663
    },
    {
        "content": "<p>yes, the current design is that there is a patient_id claim in the token that lists all the patients to which the current user has access.  its definitely NOT the only way to do this so feedback is welcome</p>",
        "id": 276053677,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1647870936
    },
    {
        "content": "<p>aside:  \"user/.\" looks funny, i assume you just lost the <code>*</code> while copy/pasting?</p>",
        "id": 276053789,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1647870980
    },
    {
        "content": "<p>question:  would you expect <code>user/*.*</code> to grant access to <em>all</em> patients by default?  are you doing anything to limit what the user has access to?</p>",
        "id": 276053950,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1647871057
    },
    {
        "content": "<p>yes, i think within an organization, all providers have access to all patients. <br>\nso when a provider logs in, how can he retrieve all the patients in that organization, although he may not have created some of these?</p>\n<p>yes, \"user/.\" was actually \"user/star.star\". Sorry for the typo. That \"star\" is getting lost in the chat.</p>",
        "id": 276054545,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1647871292
    },
    {
        "content": "<p>Question: \"would you expect user/star.star to grant access to all patients by default? are you doing anything to limit what the user has access to?\"<br>\nAnswer: Yes, I would like 'user/star.star' to have access to all patients by default. And further access on all the resources of that selected patient (which will be in the token).</p>",
        "id": 276146824,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1647929001
    },
    {
        "content": "<blockquote>\n<p>yes, i think within an organization, all providers have access to all patients.<br>\nso when a provider logs in, how can he retrieve all the patients in that organization, although he may not have created some of these?</p>\n</blockquote>\n<blockquote>\n<p>Answer: Yes, I would like 'user/star.star' to have access to all patients by default. And further access on all the resources of that selected patient (which will be in the token).</p>\n</blockquote>\n<p>The second sentence doesn't make sense to me</p>",
        "id": 276180294,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1647951985
    },
    {
        "content": "<p>I just opened <a href=\"https://github.com/IBM/FHIR/issues/3495\">https://github.com/IBM/FHIR/issues/3495</a> ...please let me know if that behavior change would match your expectations as a user</p>",
        "id": 276189372,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1647956279
    },
    {
        "content": "<p>Yes, that is fine.<br>\nThank you, <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span></p>",
        "id": 276305557,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1648027157
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> want to double-check if Firely Server is similar on this?</p>",
        "id": 276892290,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1648482181
    },
    {
        "content": "<p>Sorry, <span class=\"user-mention\" data-user-id=\"191363\">@Vadim Peretokin</span>. I wasn't subscribed to this stream and didn't yet a notification. No, Firely Server will grant you by default access to all resources if you have a user-level scope. For modelling user-level access, I would be looking at GraphDefinitions to represent what is in scope and what isn't.</p>",
        "id": 277779922,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1649099456
    },
    {
        "content": "<p>Thanks for chiming in Vadim and Alexander... that sounds consistent with the change I mention above and we plan to include that change in our next release.</p>",
        "id": 277911923,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1649178500
    }
]