[
    {
        "content": "<p>where can i find the bucket jar file fhir-bucket-4.5.0-cli.jar for re-indexing the existing resources</p>",
        "id": 216835950,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605507180
    },
    {
        "content": "<p>hi Sridhar, <code>fhir-bucket</code> is pretty new and so we didn't have it in our release steps to copy the built artifact to the GitHub release yet</p>",
        "id": 216892055,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1605542858
    },
    {
        "content": "<p>can you access it from <a href=\"https://bintray.com/ibm-watson-health/ibm-fhir-server-releases/fhir-bucket#files/com/ibm/fhir/fhir-bucket/4.5.0\">https://bintray.com/ibm-watson-health/ibm-fhir-server-releases/fhir-bucket#files/com/ibm/fhir/fhir-bucket/4.5.0</a> ?</p>",
        "id": 216892073,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1605542868
    },
    {
        "content": "<p>I'll go ahead and copy that into our github release too...thanks for pointing it out</p>",
        "id": 216892211,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1605542914
    },
    {
        "content": "<p>done...you'll now find it under \"Assets\" at <a href=\"https://github.com/IBM/FHIR/releases/tag/4.5.0\">https://github.com/IBM/FHIR/releases/tag/4.5.0</a></p>",
        "id": 216892439,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1605543016
    },
    {
        "content": "<p>I am facing some issue while Reindex resources</p>\n<p>Exception in thread \"main\" com.ibm.fhir.database.utils.api.UndefinedNameException: org.postgresql.util.PSQLException: ERROR: relation \"resource_types\" does not exist<br>\n  Position: 45<br>\n    at com.ibm.fhir.database.utils.postgresql.PostgreSqlTranslator.translate(PostgreSqlTranslator.java:100)<br>\n    at com.ibm.fhir.bucket.persistence.ResourceTypesReader.run(ResourceTypesReader.java:50)<br>\n    at com.ibm.fhir.bucket.persistence.ResourceTypesReader.run(ResourceTypesReader.java:25)<br>\n    at com.ibm.fhir.database.utils.common.CommonDatabaseAdapter.runStatement(CommonDatabaseAdapter.java:475)<br>\n    at com.ibm.fhir.bucket.scanner.DataAccess.init(DataAccess.java:98)<br>\n    at com.ibm.fhir.bucket.app.Main.scanAndLoad(Main.java:765)<br>\n    at com.ibm.fhir.bucket.app.Main.process(Main.java:749)<br>\n    at com.ibm.fhir.bucket.app.Main.main(Main.java:834)<br>\nCaused by: org.postgresql.util.PSQLException: ERROR: relation \"resource_types\" does not exist<br>\n  Position: 45<br>\n    at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2533)<br>\n    at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2268)<br>\n    at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:313)<br>\n    at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:448)<br>\n    at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:369)<br>\n    at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:159)<br>\n    at org.postgresql.jdbc.PgPreparedStatement.executeQuery(PgPreparedStatement.java:109)<br>\n    at com.ibm.fhir.bucket.persistence.ResourceTypesReader.run(ResourceTypesReader.java:41)<br>\n    ... 6 more<br>\nException in thread \"Thread-4\" java.lang.NullPointerException<br>\n    at com.ibm.fhir.bucket.app.Main.shutdown(Main.java:699)<br>\n    at com.ibm.fhir.bucket.app.Main.lambda$scanAndLoad$1(Main.java:759)<br>\n    at com.ibm.fhir.bucket.app.Main$$Lambda$1/000000000831B060.run(Unknown Source)<br>\n    at java.lang.Thread.run(Thread.java:823)</p>",
        "id": 217418528,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605887564
    },
    {
        "content": "<p>can anyone help with this</p>",
        "id": 217418596,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605887592
    },
    {
        "content": "<p>java -Djava.util.logging.config.file=logging.properties -jar fhir-bucket-4.5.0-cli.jar --fhir-properties <a href=\"http://fhir.properties\">fhir.properties</a> --tenant-name demo1 --max-concurrent-fhir-requests 200 --no-scan --reindex-tstamp 2020-11-20 --reindex-resource-count 10 --reindex-concurrent-requests 20 --db-type postgresql --db-properties <a href=\"http://postgresql.properties\">postgresql.properties</a> --cos-properties <a href=\"http://cos.properties\">cos.properties</a></p>",
        "id": 217418663,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605887628
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"304455\">@Robin Arnold</span> have you seen anything like this? <span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span></p>",
        "id": 217419679,
        "sender_full_name": "John Timm",
        "timestamp": 1605888004
    },
    {
        "content": "<p>This comes from the schema used internally by fhir-bucket. This schema is used when fhir-bucket is used to load data from object storage - it shouldn't be needed if all you are doing is reindexing, but it must be still looking for it. I'll take a look at the code-path. If it's needed, the simplest thing would be to run the create schema step. Let me get back to you.</p>",
        "id": 217421126,
        "sender_full_name": "Robin Arnold",
        "timestamp": 1605888582
    },
    {
        "content": "<p>Unfortunately with this version you'll need run the above fhir-bucket command once with the <code>--create-schema</code>option. Make sure that your <a href=\"http://postgresql.properties\">postgresql.properties</a> file is pointing to the database you want to use. This doesn't have to the same database as the FHIR server, but it certainly can be. Make sure you have currentSchema=FHIRBUCKET in that properties file too to direct the code to create the tables in the FHIRBUCKET schema. </p>\n<p>Sorry about this - the intention was that the schema wouldn't be required for the reindexing function. We have an open issue to tidy up the CLI, so I'll make a note about this.</p>",
        "id": 217422858,
        "sender_full_name": "Robin Arnold",
        "timestamp": 1605889203
    },
    {
        "content": "<p>After following the step even though the column \"resource_type_id\" is not null i am getting this error</p>",
        "id": 217425175,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605890115
    },
    {
        "content": "<p>Exception in thread \"main\" com.ibm.fhir.database.utils.api.DataAccessException: org.postgresql.util.PSQLException: ERROR: null value in column \"resource_type_id\" violates not-null constraint<br>\n  Detail: Failing row contains (null, Appointment).<br>\n    at com.ibm.fhir.database.utils.postgresql.PostgreSqlTranslator.translate(PostgreSqlTranslator.java:104)<br>\n    at com.ibm.fhir.bucket.persistence.MergeResourceTypesPostgres.run(MergeResourceTypesPostgres.java:59)<br>\n    at com.ibm.fhir.database.utils.common.CommonDatabaseAdapter.runStatement(CommonDatabaseAdapter.java:459)<br>\n    at com.ibm.fhir.database.utils.postgresql.PostgreSqlAdapter.runStatement(PostgreSqlAdapter.java:266)<br>\n    at com.ibm.fhir.bucket.app.Main.bootstrapDb(Main.java:653)<br>\n    at com.ibm.fhir.bucket.app.Main.process(Main.java:747)<br>\n    at com.ibm.fhir.bucket.app.Main.main(Main.java:834)<br>\nCaused by: org.postgresql.util.PSQLException: ERROR: null value in column \"resource_type_id\" violates not-null constraint<br>\n  Detail: Failing row contains (null, Appointment).<br>\n    at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2533)<br>\n    at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2268)<br>\n    at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:313)<br>\n    at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:448)<br>\n    at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:369)<br>\n    at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:159)<br>\n    at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:125)<br>\n    at com.ibm.fhir.bucket.persistence.MergeResourceTypesPostgres.run(MergeResourceTypesPostgres.java:54)<br>\n    ... 5 more</p>",
        "id": 217425194,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605890122
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/402ekuKEc0hHcdVn2LOcrAXo/Screenshot-2020-11-20-at-22.03.30.png\">Screenshot-2020-11-20-at-22.03.30.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/402ekuKEc0hHcdVn2LOcrAXo/Screenshot-2020-11-20-at-22.03.30.png\" title=\"Screenshot-2020-11-20-at-22.03.30.png\"><img src=\"/user_uploads/10155/402ekuKEc0hHcdVn2LOcrAXo/Screenshot-2020-11-20-at-22.03.30.png\"></a></div>",
        "id": 217425260,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605890147
    },
    {
        "content": "<p>I'll have to check where this is coming from. It looks like a regression. But if the schema was generated (fhir_bucket.resource_types exists), then you should now be able to run the reindex operation.</p>",
        "id": 217426285,
        "sender_full_name": "Robin Arnold",
        "timestamp": 1605890494
    },
    {
        "content": "<p>What is your currentSchema set to in your <a href=\"http://postgresql.properties\">postgresql.properties</a> file? You must not use the FHIRDATA schema here - it has to be a different schema name for example FHIRBUCKET.</p>",
        "id": 217427135,
        "sender_full_name": "Robin Arnold",
        "timestamp": 1605890811
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 217477189,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605920731
    },
    {
        "content": "<p>yes after changing currentSchema=FHIRBUCKET the above issue got resolved thank you</p>",
        "id": 217483940,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605932576
    },
    {
        "content": "<p>can someone share a default <a href=\"http://fhir.properties\">fhir.properties</a></p>",
        "id": 217483948,
        "sender_full_name": "Sridhar S",
        "timestamp": 1605932601
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 217652963,
        "sender_full_name": "Sridhar S",
        "timestamp": 1606150223
    },
    {
        "content": "<p>2020-11-24 09:07:13.133 00000025    INFO .reindex.DriveReindexOperation Reindex - all done<br>\nAfter i got the message that reindex is all done the process is still been running for hours is it right behaviour or am i missing something</p>",
        "id": 217745929,
        "sender_full_name": "Sridhar S",
        "timestamp": 1606220728
    },
    {
        "content": "<p>2020-11-24 12:23:47.560 00000024    INFO .fhir.bucket.scanner.COSReader allocateJobs[NDJSON]: free = 1<br>\n2020-11-24 12:23:47.561 00000024    INFO .fhir.bucket.scanner.COSReader Allocated job count[NDJSON]: 0<br>\n2020-11-24 12:23:47.561 00000024    INFO .fhir.bucket.scanner.COSReader Jobs inflight[NDJSON] 0, just allocated: 0<br>\n2020-11-24 12:23:57.561 00000024    INFO .fhir.bucket.scanner.COSReader allocateJobs[NDJSON]: free = 1<br>\n2020-11-24 12:23:57.562 00000024    INFO .fhir.bucket.scanner.COSReader Allocated job count[NDJSON]: 0<br>\n2020-11-24 12:23:57.562 00000024    INFO .fhir.bucket.scanner.COSReader Jobs inflight[NDJSON] 0, just allocated: 0<br>\n2020-11-24 12:24:07.562 00000024    INFO .fhir.bucket.scanner.COSReader allocateJobs[NDJSON]: free = 1<br>\n2020-11-24 12:24:07.563 00000024    INFO .fhir.bucket.scanner.COSReader Allocated job count[NDJSON]: 0<br>\n2020-11-24 12:24:07.563 00000024    INFO .fhir.bucket.scanner.COSReader Jobs inflight[NDJSON] 0, just allocated: 0<br>\n2020-11-24 12:24:17.563 00000024    INFO .fhir.bucket.scanner.COSReader allocateJobs[NDJSON]: free = 1<br>\n2020-11-24 12:24:17.564 00000024    INFO .fhir.bucket.scanner.COSReader Allocated job count[NDJSON]: 0<br>\n2020-11-24 12:24:17.565 00000024    INFO .fhir.bucket.scanner.COSReader Jobs inflight[NDJSON] 0, just allocated: 0<br>\n2020-11-24 12:24:27.565 00000024    INFO .fhir.bucket.scanner.COSReader allocateJobs[NDJSON]: free = 1<br>\n2020-11-24 12:24:27.566 00000024    INFO .fhir.bucket.scanner.COSReader Allocated job count[NDJSON]: 0<br>\n2020-11-24 12:24:27.566 00000024    INFO .fhir.bucket.scanner.COSReader Jobs inflight[NDJSON] 0, just allocated: 0</p>",
        "id": 217745936,
        "sender_full_name": "Sridhar S",
        "timestamp": 1606220731
    },
    {
        "content": "<p>Dear IBM team, </p>\n<p>we are also trying to update our local ibm fhir server from version 4.4.2 to version 4.5.0.</p>\n<p>As suggested from here (<a href=\"https://github.com/IBM/FHIR/releases\">https://github.com/IBM/FHIR/releases</a>) and also from here (<a href=\"https://github.com/IBM/FHIR/tree/master/fhir-bucket\">https://github.com/IBM/FHIR/tree/master/fhir-bucket</a>), we need to do \"Database Migration\" which includes \"Schema Migration\" and \"Reindex resources\". We have done \"Schema Migration\" but are stuck with \"Reindex resources\". Would you please help us with the following questions:</p>\n<ol>\n<li>\n<p>Is this \"Reindex resources\" definitely necessary for the  updates from 4.4.2 to 4.5.0 with existing fhir resources? Without doing this the existing resources will not be searched correctly?</p>\n</li>\n<li>\n<p>The command includes \"--fhir-properties <a href=\"http://fhir.properties\">fhir.properties</a>\", it is the connection properties file for the FHIR server. But how exact it should be? Is there a template available?</p>\n</li>\n<li>\n<p>The command includes \"--cos-properties <a href=\"http://cos.properties\">cos.properties</a>\", it is the connection properties file for COS. Is it only optional? I am asking because we are not using IBM COS bucket and don't understand why we need this for reindex. But running withou this returned:<br>\n<code>\nException in thread \"main\" java.lang.IllegalArgumentException: No COS properties\n        at com.ibm.fhir.bucket.app.Main.checkConfig(Main.java:473)\n        at com.ibm.fhir.bucket.app.Main.main(Main.java:832)\n</code><br>\nMany thanks!</p>\n</li>\n</ol>",
        "id": 218027698,
        "sender_full_name": "guokun zhang",
        "timestamp": 1606414272
    },
    {
        "content": "<blockquote>\n<p>Is this \"Reindex resources\" definitely necessary for the updates from 4.4.2 to 4.5.0 with existing fhir resources? </p>\n</blockquote>\n<p>yes</p>\n<blockquote>\n<p>Without doing this the existing resources will not be searched correctly?</p>\n</blockquote>\n<p>correct</p>",
        "id": 218087599,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1606481016
    },
    {
        "content": "<p>however, <code>fhir-bucket</code> is not required for invoking the <code>$reindex</code> operation...it was just for convenience</p>",
        "id": 218087688,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1606481073
    },
    {
        "content": "<p>I recently drafted <a href=\"https://github.com/IBM/FHIR/pull/1730\">https://github.com/IBM/FHIR/pull/1730</a> to explain the operation a little bit better.  Basically you just need to repeatedly POST to this endpoint with a <code>tstamp</code> parameter that is later than the time in which the db schema migration was applied.</p>",
        "id": 218087875,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1606481234
    },
    {
        "content": "<p>If you do decide to use the <code>fhir-bucket</code> utility, the best documentation for that is in the README for that module:  <a href=\"https://github.com/IBM/FHIR/tree/master/fhir-bucket#configuration\">https://github.com/IBM/FHIR/tree/master/fhir-bucket#configuration</a></p>",
        "id": 218091326,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1606483384
    },
    {
        "content": "<p>there you will find templates for both <a href=\"http://fhir.properties\">fhir.properties</a> and <a href=\"http://cos.properties\">cos.properties</a></p>",
        "id": 218091351,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1606483406
    },
    {
        "content": "<p>however, one thing we recently found is that there is a bad bug in the 4.5.0 reindex implementation which is preventing it from properly re-indexing certain search parameters.  That issue is <a href=\"https://github.com/IBM/FHIR/issues/1742\">https://github.com/IBM/FHIR/issues/1742</a> and we'll be rolling a 4.5.1 ASAP to get that addressed (hopefully monday)</p>",
        "id": 218091579,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1606483542
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 219322056,
        "sender_full_name": "guokun zhang",
        "timestamp": 1607511852
    }
]