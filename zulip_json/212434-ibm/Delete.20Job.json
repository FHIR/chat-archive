[
    {
        "content": "<p>While testing a case (BDE-10: Bulk Data Server returns \"202 Accepted\" for delete request) in Inferno we received the following exception. Please let us know how do we handle this.</p>\n<p>Job deletion is not supported with the configured (in-memory) database.</p>\n<p>com.ibm.fhir.exception.FHIROperationException: Job deletion is not supported with the configured (in-memory) database.  [probeId=ac-1e-0-bf-64dd1ae5-19b6-4b78-87b3-829a85a226cd]<br>\nat com.ibm.fhir.operation.bulkdata.util.BulkDataExportUtil.buildOperationException(BulkDataExportUtil.java:143)<br>\nat com.ibm.fhir.operation.bulkdata.util.BulkDataExportUtil.buildOperationException(BulkDataExportUtil.java:139)<br>\nat com.ibm.fhir.operation.bulkdata.client.action.batch.BatchCancelRequestAction.run(BatchCancelRequestAction.java:120)<br>\nat com.ibm.fhir.operation.bulkdata.client.BulkDataClient.delete(BulkDataClient.java:517)<br>\nat com.ibm.fhir.operation.bulkdata.processor.impl.ExportImportImpl.delete(ExportImportImpl.java:154)<br>\nat com.ibm.fhir.operation.bulkdata.StatusOperation.doInvoke(StatusOperation.java:61)<br>\nat com.ibm.fhir.server.operation.spi.AbstractOperation.invoke(AbstractOperation.java:57)<br>\nat com.ibm.fhir.server.util.FHIRRestHelper.doInvoke(FHIRRestHelper.java:1171)<br>\nat com.ibm.fhir.server.resources.Operation.invokeDelete(Operation.java:171)<br>\nat com.ibm.fhir.server.resources.Operation$Proxy$_$$_WeldClientProxy.invokeDelete(Unknown Source)<br>\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>\nat java.lang.reflect.Method.invoke(Method.java:498)<br>\nat com.ibm.ws.jaxrs20.cdi.component.JaxRsFactoryImplicitBeanCDICustomizer.serviceInvoke(JaxRsFactoryImplicitBeanCDICustomizer.java:342)<br>\nat com.ibm.ws.jaxrs20.server.LibertyJaxRsServerFactoryBean.performInvocation(LibertyJaxRsServerFactoryBean.java:641)<br>\nat com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.performInvocation(LibertyJaxRsInvoker.java:160)<br>\nat org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:101)<br>\nat com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:273)<br>\nat org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:213)<br>\nat com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:444)<br>\nat org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:112)<br>\nat org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:59)<br>\nat org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:96)<br>\nat org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)<br>\nat org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:123)<br>\nat org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:274)<br>\nat com.ibm.ws.jaxrs20.endpoint.AbstractJaxRsWebEndpoint.invoke(AbstractJaxRsWebEndpoint.java:137)<br>\nat com.ibm.websphere.jaxrs.server.IBMRestServlet.handleRequest(IBMRestServlet.java:146)<br>\nat com.ibm.websphere.jaxrs.server.IBMRestServlet.doDelete(IBMRestServlet.java:131)<br>\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:712)<br>\nat com.ibm.websphere.jaxrs.server.IBMRestServlet.service(IBMRestServlet.java:96)<br>\nat com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1258)<br>\nat com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:746)<br>\nat com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:443)<br>\nat com.ibm.ws.webcontainer.filter.WebAppFilterChain.invokeTarget(WebAppFilterChain.java:183)<br>\nat com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:94)<br>\nat com.ibm.fhir.server.filter.rest.FHIRRestServletFilter.doFilter(FHIRRestServletFilter.java:155)<br>\nat javax.servlet.http.HttpFilter.doFilter(HttpFilter.java:127)<br>\nat com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:197)<br>\nat com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:91)<br>\nat com.ibm.ws.security.jaspi.JaspiServletFilter.doFilter(JaspiServletFilter.java:56)<br>\nat com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:197)<br>\nat com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:91)<br>\nat com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:1002)<br>\nat com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1140)<br>\nat com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1011)<br>\nat com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:75)<br>\nat com.ibm.ws.webcontainer40.servlet.CacheServletWrapper40.handleRequest(CacheServletWrapper40.java:85)<br>\nat com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:938)<br>\nat com.ibm.ws.webcontainer.osgi.DynamicVirtualHost$2.run(DynamicVirtualHost.java:279)<br>\nat com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink$TaskWrapper.run(HttpDispatcherLink.java:1159)<br>\nat com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.wrapHandlerAndExecute(HttpDispatcherLink.java:428)<br>\nat com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.ready(HttpDispatcherLink.java:387)<br>\nat com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:566)<br>\nat com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleNewRequest(HttpInboundLink.java:500)<br>\nat com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.processRequest(HttpInboundLink.java:360)<br>\nat com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.ready(HttpInboundLink.java:327)<br>\nat com.ibm.ws.channel.ssl.internal.SSLConnectionLink.determineNextChannel(SSLConnectionLink.java:1100)<br>\nat com.ibm.ws.channel.ssl.internal.SSLConnectionLink$MyReadCompletedCallback.complete(SSLConnectionLink.java:675)<br>\nat com.ibm.ws.channel.ssl.internal.SSLReadServiceContext$SSLReadCompletedCallback.complete(SSLReadServiceContext.java:1824)<br>\nat com.ibm.ws.tcpchannel.internal.WorkQueueManager.requestComplete(WorkQueueManager.java:504)<br>\nat com.ibm.ws.tcpchannel.internal.WorkQueueManager.attemptIO(WorkQueueManager.java:574)<br>\nat com.ibm.ws.tcpchannel.internal.WorkQueueManager.workerRun(WorkQueueManager.java:958)<br>\nat com.ibm.ws.tcpchannel.internal.WorkQueueManager$Worker.run(WorkQueueManager.java:1047)<br>\nat com.ibm.ws.threading.internal.ExecutorServiceImpl$RunnableWrapper.run(ExecutorServiceImpl.java:238)<br>\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)<br>\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)<br>\nat java.lang.Thread.run(Thread.java:748)</p>",
        "id": 260089599,
        "sender_full_name": "Mahesh Dabi",
        "timestamp": 1635914799
    },
    {
        "content": "<p>the OpenLiberty jbatch default is to use an in-memory job database.  that doesn't support purging (what we do when we see a delete of a completed job).<br>\nyou'll need to use a real job database to support deletes.</p>",
        "id": 260139722,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1635948928
    },
    {
        "content": "<p>Thank you, Lee and Paul, delete job worked after we did the change suggested by Paul.</p>",
        "id": 260239513,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1636013756
    },
    {
        "content": "<p>Sorry there, the delete job worked just once. Now it fails. I have the configuration in bulkdata.xml as below <br>\n    &lt;variable name=\"BATCH_DB_NAME\" defaultValue=\"fhirdb\"/&gt;<br>\n    &lt;variable name=\"BATCH_DB_SCHEMA\" defaultValue=\"fhir_jbatch\"/&gt;<br>\n    &lt;variable name=\"BATCH_DB_PORT\" defaultValue=\"5432\"/&gt;<br>\n    &lt;variable name=\"BATCH_DB_USER\" defaultValue=\"postgres\"/&gt;<br>\n    &lt;variable name=\"BATCH_DB_PASS\" defaultValue=\"password\"/&gt;<br>\n    &lt;variable name=\"BATCH_DB_SSL\" defaultValue=\"\"/&gt;<br>\n    &lt;variable name=\"BATCH_DB_SSL_CERT_PATH\" defaultValue=\"\"/&gt;</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;dataSource id=&quot;fhirbatchDS&quot; jndiName=&quot;jdbc/fhirbatchDB&quot; type=&quot;javax.sql.XADataSource&quot; statementCacheSize=&quot;200&quot; syncQueryTimeoutWithTransactionTimeout=&quot;true&quot;&gt;\n    &lt;jdbcDriver javax.sql.XADataSource=&quot;org.postgresql.xa.PGXADataSource&quot; libraryRef=&quot;sharedLibPostgres&quot;/&gt;\n    &lt;properties.postgresql\n         serverName=&quot;localhost&quot;\n         portNumber=&quot;${BATCH_DB_PORT}&quot;\n         databaseName=&quot;${BATCH_DB_NAME}&quot;\n         user=&quot;${BATCH_DB_USER}&quot;\n         password=&quot;${BATCH_DB_PASS}&quot;                     \n     /&gt;\n    &lt;connectionManager maxPoolSize=&quot;200&quot; minPoolSize=&quot;40&quot;/&gt;\n&lt;/dataSource&gt;\n</code></pre></div>\n\n<p>The error message we are getting is as below <br>\nAn authentication alias should be used instead of defining a user name and password on dataSource[fhirbatchDS].</p>\n<p>[11/4/21 9:40:13:988 UTC] 0000001c com.ibm.fhir.server.filter.rest.FHIRRestServletFilter        I Received request: tenantId:[default] dsId:[default] user:[fhiruser] method:[DELETE] uri:[https://fhir.secureit.co.in:9443/fhir-server/api/v4/$bulkdata-status?job=LqzauvqtHSmkpChVHo%2B1MQ]<br>\n[11/4/21 9:40:14:723 UTC] 0000001c com.ibm.ws.jca.cm.ConnectorService                           I J2CA8050I: An authentication alias should be used instead of defining a user name and password on dataSource[fhirbatchDS].<br>\n[11/4/21 9:40:15:737 UTC] 0000001c com.ibm.fhir.server.resources.FHIRResource                   E The existing job has failed to delete<br>\ncom.ibm.fhir.exception.FHIROperationException: The existing job has failed to delete  [probeId=ac-1e-0-bf-e4b8d9d3-c645-488f-a4ba-a3478c83e38b]<br>\n    at com.ibm.fhir.operation.bulkdata.util.BulkDataExportUtil.buildOperationException(BulkDataExportUtil.java:143)<br>\n    at com.ibm.fhir.operation.bulkdata.util.BulkDataExportUtil.buildOperationException(BulkDataExportUtil.java:139)<br>\n    at com.ibm.fhir.operation.bulkdata.client.action.batch.BatchCancelRequestAction.deleteJob(BatchCancelRequestAction.java:411)<br>\n    at com.ibm.fhir.operation.bulkdata.client.action.batch.BatchCancelRequestAction.run(BatchCancelRequestAction.java:118)<br>\n    at com.ibm.fhir.operation.bulkdata.client.BulkDataClient.delete(BulkDataClient.java:517)<br>\n    at com.ibm.fhir.operation.bulkdata.processor.impl.ExportImportImpl.delete(ExportImportImpl.java:154)<br>\n    at com.ibm.fhir.operation.bulkdata.StatusOperation.doInvoke(StatusOperation.java:61)<br>\n    at com.ibm.fhir.server.operation.spi.AbstractOperation.invoke(AbstractOperation.java:57)<br>\n    at com.ibm.fhir.server.util.FHIRRestHelper.doInvoke(FHIRRestHelper.java:1171)<br>\n    at com.ibm.fhir.server.resources.Operation.invokeDelete(Operation.java:171)<br>\n    at com.ibm.fhir.server.resources.Operation$Proxy$_$$_WeldClientProxy.invokeDelete(Unknown Source)<br>\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)<br>\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>\n    at java.lang.reflect.Method.invoke(Method.java:498)<br>\n    at com.ibm.ws.jaxrs20.cdi.component.JaxRsFactoryImplicitBeanCDICustomizer.serviceInvoke(JaxRsFactoryImplicitBeanCDICustomizer.java:342)<br>\n    at com.ibm.ws.jaxrs20.server.LibertyJaxRsServerFactoryBean.performInvocation(LibertyJaxRsServerFactoryBean.java:641)<br>\n    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.performInvocation(LibertyJaxRsInvoker.java:160)<br>\n    at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:101)<br>\n    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:273)<br>\n    at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:213)<br>\n    at com.ibm.ws.jaxrs20.server.LibertyJaxRsInvoker.invoke(LibertyJaxRsInvoker.java:444)<br>\n    at org.apache.cxf.jaxrs.JAXRSInvoker.invoke(JAXRSInvoker.java:112)<br>\n    at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:59)<br>\n    at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:96)<br>\n    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)<br>\n    at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:123)<br>\n    at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:274)<br>\n    at com.ibm.ws.jaxrs20.endpoint.AbstractJaxRsWebEndpoint.invoke(AbstractJaxRsWebEndpoint.java:137)<br>\n    at com.ibm.websphere.jaxrs.server.IBMRestServlet.handleRequest(IBMRestServlet.java:146)<br>\n    at com.ibm.websphere.jaxrs.server.IBMRestServlet.doDelete(IBMRestServlet.java:131)<br>\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:712)<br>\n    at com.ibm.websphere.jaxrs.server.IBMRestServlet.service(IBMRestServlet.java:96)<br>\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1258)<br>\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:746)<br>\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:443)<br>\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.invokeTarget(WebAppFilterChain.java:183)<br>\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:94)<br>\n    at com.ibm.fhir.server.filter.rest.FHIRRestServletFilter.doFilter(FHIRRestServletFilter.java:155)<br>\n    at javax.servlet.http.HttpFilter.doFilter(HttpFilter.java:127)<br>\n    at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:197)<br>\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:91)<br>\n    at com.ibm.ws.security.jaspi.JaspiServletFilter.doFilter(JaspiServletFilter.java:56)<br>\n    at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:197)<br>\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:91)<br>\n    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:1002)<br>\n    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1140)<br>\n    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters(WebAppFilterManager.java:1011)<br>\n    at com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:75)<br>\n    at com.ibm.ws.webcontainer40.servlet.CacheServletWrapper40.handleRequest(CacheServletWrapper40.java:85)<br>\n    at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:938)<br>\n    at com.ibm.ws.webcontainer.osgi.DynamicVirtualHost$2.run(DynamicVirtualHost.java:279)<br>\n    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink$TaskWrapper.run(HttpDispatcherLink.java:1159)<br>\n    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.wrapHandlerAndExecute(HttpDispatcherLink.java:428)<br>\n    at com.ibm.ws.http.dispatcher.internal.channel.HttpDispatcherLink.ready(HttpDispatcherLink.java:387)<br>\n    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:566)<br>\n    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.handleNewRequest(HttpInboundLink.java:500)<br>\n    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.processRequest(HttpInboundLink.java:360)<br>\n    at com.ibm.ws.http.channel.internal.inbound.HttpInboundLink.ready(HttpInboundLink.java:327)<br>\n    at com.ibm.ws.channel.ssl.internal.SSLConnectionLink.determineNextChannel(SSLConnectionLink.java:1100)<br>\n    at com.ibm.ws.channel.ssl.internal.SSLConnectionLink$MyReadCompletedCallback.complete(SSLConnectionLink.java:675)<br>\n    at com.ibm.ws.channel.ssl.internal.SSLReadServiceContext$SSLReadCompletedCallback.complete(SSLReadServiceContext.java:1824)<br>\n    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.requestComplete(WorkQueueManager.java:504)<br>\n    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.attemptIO(WorkQueueManager.java:574)<br>\n    at com.ibm.ws.tcpchannel.internal.WorkQueueManager.workerRun(WorkQueueManager.java:958)<br>\n    at com.ibm.ws.tcpchannel.internal.WorkQueueManager$Worker.run(WorkQueueManager.java:1047)<br>\n    at com.ibm.ws.threading.internal.ExecutorServiceImpl$RunnableWrapper.run(ExecutorServiceImpl.java:238)<br>\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)<br>\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)<br>\n    at java.lang.Thread.run(Thread.java:748)</p>\n<p>[11/4/21 9:40:15:752 UTC] 0000001c com.ibm.fhir.server.filter.rest.FHIRRestServletFilter        I Completed request[1.765 secs]: tenantId:[default] dsId:[default] user:[fhiruser] method:[DELETE] uri:[https://fhir.secureit.co.in:9443/fhir-server/api/v4/$bulkdata-status?job=LqzauvqtHSmkpChVHo%2B1MQ] status:[500]</p>",
        "id": 260249965,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1636020702
    },
    {
        "content": "<p>Lee, did you get a chance to look at this?</p>",
        "id": 260361761,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1636081755
    },
    {
        "content": "<p>Hello Lee and Paul,</p>\n<p>You can ignore the earlier message.</p>\n<p>Here is the scenario:</p>\n<p>After starting the ubuntu server, the very first time the 'job delete' works fine, at least we get the correct response code. But when I visited the logs, there were errors and the job delete was not completely successful. Please see an attached snapshot of different logs (SuccessfulJobDelete_Log.zip). <a href=\"/user_uploads/10155/oLDNFjcDjKxUiiyM8gjDwnRZ/SuccessfulJobDelete_Log.zip\">SuccessfulJobDelete_Log.zip</a></p>\n<p>When we attempted a fresh bulk export and further job delete it failed, I think it is because the earlier job delete was not completely successful. Please see attached logs (SecondJobDelete_Log.zip). <a href=\"/user_uploads/10155/qrcAqv2IiawPn66k1NjV_Izr/SecondJobDelete_Log.zip\">SecondJobDelete_Log.zip</a></p>\n<p>Please let me know if you need more information.</p>\n<p>Thank you.</p>",
        "id": 260371072,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1636095035
    },
    {
        "content": "<p>Do you know how to retrieve the \"job logs\"?  The console logs you sent are interesting, but maybe the job logs will have more info on the first exception:</p>\n<div class=\"codehilite\"><pre><span></span><code>[INFO    ] FFDC1015I: An FFDC Incident has been created: &quot;java.lang.NullPointerException com.ibm.jbatch.container.artifact.proxy.ItemReaderProxy 40&quot; at ffdc_21.11.05_05.43.03.0.log\n</code></pre></div>\n<p>doc:  <a href=\"https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#4105-job-logs\">https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide#4105-job-logs</a></p>",
        "id": 260393664,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1636111894
    },
    {
        "content": "<p>Hello Lee, </p>\n<p>Please see attached logs folder <a href=\"/user_uploads/10155/A79vGuagBKfxDfuHv-vM4Q6N/logs.zip\">logs.zip</a>  after I tried a fresh bulk export followed by a successful delete. This was run through Inferno, and Inferno runs some other test cases apart from Bulk export and Delete. Please check only logs related to DELETE job.</p>\n<p>Thank you.</p>",
        "id": 260399300,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1636115912
    },
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span> , </p>\n<p>Did you get a chance to check the logs? Please let me know if you need more information.</p>\n<p>Thank you, <br>\nSagar</p>",
        "id": 260751934,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1636431238
    },
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span>  . <br>\nWe installed the latest IBM FHIR server, but the delete job fails intermittently. Did you get a chance to see the logs attached in the earlier chat here? Please let us know your thoughts. <br>\nThank you,<br>\nSagar</p>",
        "id": 264989796,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1639564503
    },
    {
        "content": "<p>Hi Sagar, thanks for your patience.  I suggest you open an issue at <a href=\"https://github.com/IBM/FHIR/issues\">https://github.com/IBM/FHIR/issues</a> and attach your log.<br>\nIt looks to me like inferno is doing a Group/$export with the default resource types which results in an export job with 66 partitions.<br>\nThe job starts to run these partitions (4 at a time) and then we receive the DELETE.<br>\nWhen our server receives the DELETE, it will take one of two actions:</p>\n<ol>\n<li>If the job is running, it will try to stop the job</li>\n<li>If the job is completed, it will purge the job</li>\n</ol>\n<p>The job execution's step1 logs all look good to me...they recognize the DELETE and exit with a status of STOPPED.<br>\nBut then the overall execution gets marked with status FAILED for some reason:</p>\n<div class=\"codehilite\"><pre><span></span><code>[11/5/21 12:29:18:990 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   startedPartitions = [0, 1, 2, 3], numThreads = 3\n[11/5/21 12:29:18:990 UTC] com.ibm.jbatch.container.context.impl.JobContextImpl           Returing ref (non-clone) to job context properties\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   Calling analyzeStatus(): PartitionReplyMsg: partition #: 3exec info: TopLevelNameIntanceExecutionInfo:jobName=bulkgroupexportchunkjob:instanceId=2:executionId=2, PARTITION_FINAL_STATUS, FAILED, FAILED\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   CWWKY0013I: Partition 3 ended with batch status FAILED and exit status FAILED for step step1 for job instance 2 and job execution 2.\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   Iterate through loop with finishedPartitions = [com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl$FinishedPartition@4e6ab5ff, com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl$FinishedPartition@66ff0a1e, com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl$FinishedPartition@53a4855b]\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   startedPartitions = [0, 1, 2, 3, 4], numThreads = 3\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.context.impl.JobContextImpl           Returing ref (non-clone) to job context properties\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   For partitioned step: step1, the partition # 1 ended with status &#39;COMPLETED\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   For partitioned step: step1, the partition # 0 ended with status &#39;COMPLETED\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.PartitionedStepCont   For partitioned step: step1, the partition # 3 ended with status &#39;FAILED\n[11/5/21 12:29:19:168 UTC] com.ibm.jbatch.container.controller.impl.BaseStepControllerI   CWWKY0019W: Step step1 failed with batch status FAILED and exit status null for job instance 2 and job execution 2.\n[11/5/21 12:29:19:465 UTC] com.ibm.jbatch.container.controller.impl.BaseStepControllerI   CWWKY0030I: An exception occurred while running the step step1.\ncom.ibm.jbatch.container.exception.BatchContainerRuntimeException: One or more partitions failed: [For partitioned step: step1, the partition # 3 ended with status &#39;FAILED]\n    at com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl.checkFinishedPartitionsForFailures(PartitionedStepControllerImpl.java:1021)\n    at com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl.invokeCoreStep(PartitionedStepControllerImpl.java:475)\n    at com.ibm.jbatch.container.controller.impl.BaseStepControllerImpl.execute(BaseStepControllerImpl.java:295)\n    at com.ibm.jbatch.container.controller.impl.PartitionedStepControllerImpl.execute(PartitionedStepControllerImpl.java:201)\n    at com.ibm.jbatch.container.controller.impl.ExecutionTransitioner.doExecutionLoop(ExecutionTransitioner.java:118)\n    at com.ibm.jbatch.container.controller.impl.WorkUnitThreadControllerImpl.executeCoreTransitionLoop(WorkUnitThreadControllerImpl.java:96)\n    at com.ibm.jbatch.container.controller.impl.WorkUnitThreadControllerImpl.executeWorkUnit(WorkUnitThreadControllerImpl.java:178)\n    at com.ibm.jbatch.container.controller.impl.WorkUnitThreadControllerImpl$AbstractControllerHelper.runExecutionOnThread(WorkUnitThreadControllerImpl.java:503)\n    at com.ibm.jbatch.container.controller.impl.WorkUnitThreadControllerImpl.runExecutionOnThread(WorkUnitThreadControllerImpl.java:92)\n    at com.ibm.jbatch.container.util.BatchWorkUnit.run(BatchWorkUnit.java:113)\n    at com.ibm.ws.context.service.serializable.ContextualRunnable.run(ContextualRunnable.java:79)\n    at com.ibm.ws.threading.internal.ExecutorServiceImpl$RunnableWrapper.run(ExecutorServiceImpl.java:238)\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n    at java.lang.Thread.run(Thread.java:748)\n</code></pre></div>\n<p>Still, it proceeds to set the overall job batch status (and the Job Exist Status) to STOPPED.<br>\nThen, we try the purge and it fails with the following:</p>\n<div class=\"codehilite\"><pre><span></span><code>[11/5/21 12:29:19:436 UTC] 00000031 com.ibm.ws.logging.internal.impl.IncidentImpl                I FFDC1015I: An FFDC Incident has been created: &quot;com.ibm.ws.jbatch.rest.internal.resources.RequestException: The specified job instance, 2, cannot be purged because it has active job executions. com.ibm.ws.jbatch.rest.internal.resources.RequestRouter 71&quot; at ffdc_21.11.05_12.29.19.1.log\n[11/5/21 12:29:19:464 UTC] 0000001d com.ibm.ws.logging.internal.impl.IncidentImpl                I FFDC1015I: An FFDC Incident has been created: &quot;com.ibm.jbatch.container.exception.BatchContainerRuntimeException: One or more partitions failed: [For partitioned step: step1, the partition # 3 ended with status &#39;FAILED] com.ibm.jbatch.container.controller.impl.BaseStepControllerImpl 296&quot; at ffdc_21.11.05_12.29.19.0.log\n</code></pre></div>\n<p>It will take some work to investigate any further, but we already have a couple folks looking into bulkdata right now, so the timing is good.  Thanks again.</p>",
        "id": 265005314,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1639572944
    },
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span> </p>\n<p>Thank you for your reply, I have created an issue at <a href=\"https://github.com/IBM/FHIR/issues/3120\">https://github.com/IBM/FHIR/issues/3120</a> . Also attached fresh set of logs in the issue.<br>\nPlease assign it appropriately and let me know if you need more information.</p>\n<p>Thank you,<br>\nSagar</p>",
        "id": 265116017,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1639635048
    },
    {
        "content": "<p>HI <span class=\"user-mention\" data-user-id=\"392120\">@Sagar Sarvankar</span> basically your job is a STOPPING state with <code>\"batchStatus\": \"STOPPING\",[\\n]\"</code> it's looping over this status.  When you run with <code>trace.specification = *=fine</code>  you essentially bury the machine, and extend the amount of time it takes to process the batch job being stopped.  Could you retry with <code>*=info:- org.jboss.*=FINE:io.openliberty.microprofile.*=FINE:com.ibm.fhir.*=FINE:javax.batch.*=FINE:com.ibm.ws.jbatch.*=FINE:com.ibm.ws.*=INFO:com.ibm.jbatch.*=FINE:com.ibm.ws.jbatch.rest.*=FINEST</code>?   Also is there a reason you running with OpenJDK 1.8? Using the OpenJ9 (Semeru JVM) may actually help performance wise - <a href=\"https://developer.ibm.com/languages/java/semeru-runtimes/downloads/\">https://developer.ibm.com/languages/java/semeru-runtimes/downloads/</a></p>",
        "id": 265156603,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1639661960
    },
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"192632\">@Paul Bastide</span> , <br>\nThank you for your quick reply.  I did the changes that you mentioned, but those did not work.</p>\n<p>Here is the pattern I identified in the cases that it passes and fails.</p>\n<p>Using Postman:<br>\nPerformed two different requests<br>\nGET            <a href=\"https://fhirserver.justtest.in:9443/fhir-server/api/v4/Group/17db31227ca-52d96331-11d8-4ebd-8bc5-f4ef2d39a4ec/$export\">https://fhirserver.justtest.in:9443/fhir-server/api/v4/Group/17db31227ca-52d96331-11d8-4ebd-8bc5-f4ef2d39a4ec/$export</a><br>\nDELETE     <a href=\"https://fhirserver.justtest.in:9443/fhir-server/api/v4/$bulkdata-status?job=k_d8cTAU%2BUeVEwqURPZ3oA\">https://fhirserver.justtest.in:9443/fhir-server/api/v4/$bulkdata-status?job=k_d8cTAU%2BUeVEwqURPZ3oA</a></p>\n<p>After the GET is completed, if I quickly do a DELETE then job gets deleted and returns success.<br>\nAfter the GET is completed, if I take my own time to send DELETE, then it returns Internal Server Error (500).</p>\n<p>Looking at the logs I observed that, if the DELETE is sent while the export is in progress it works, else it returns 500. I am not sure if that observation is correct. I have attached the Postman logs of both the above scenarios. Could you please check that? <a href=\"/user_uploads/10155/ZhtTTTGFw_QG-WPkgMUBv0BM/Postman.zip\">Postman.zip</a></p>\n<p>Using Inferno:<br>\nTried several times and it just worked once, whereas it failed all the times otherwise. Could you please check the logs for the same here? <a href=\"/user_uploads/10155/PU-g96azGprhWrjuHb7uKVEY/Inferno.zip\">Inferno.zip</a></p>\n<p>We are very close in passing the Inferno tool with IBM FHIR. If the DELETE works fine, we will be good.</p>\n<p>Please let me know your thoughts.</p>\n<p>Regards,<br>\nSagar</p>",
        "id": 265290229,
        "sender_full_name": "Sagar Sarvankar",
        "timestamp": 1639744893
    }
]