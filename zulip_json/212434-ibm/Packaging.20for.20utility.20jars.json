[
    {
        "content": "<p>For 4.0.1 we created the following epic for packaging our various utilities with the fhir server distribution:  <a href=\"https://github.com/IBM/FHIR/issues/575\" target=\"_blank\" title=\"https://github.com/IBM/FHIR/issues/575\">https://github.com/IBM/FHIR/issues/575</a></p>",
        "id": 185538445,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578950134
    },
    {
        "content": "<p>now we are getting into the meat of it and we're wondering how to package them</p>",
        "id": 185538535,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578950180
    },
    {
        "content": "<p>For fhir-persistence-schema, Paul created a shaded jar that has a final name which omits the version:<br>\n<a href=\"/user_uploads/10155/0AUszf0MllHGBGozAGRc8U0y/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/0AUszf0MllHGBGozAGRc8U0y/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/0AUszf0MllHGBGozAGRc8U0y/pasted_image.png\"></a></div>",
        "id": 185538578,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578950231
    },
    {
        "content": "<p>conversely, I used the shade plugin's default and ended up replacing the versioned jar with the single executable jar:<br>\n<a href=\"/user_uploads/10155/JffU2Zh7claYh0ZQe4CYsCL1/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/JffU2Zh7claYh0ZQe4CYsCL1/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/JffU2Zh7claYh0ZQe4CYsCL1/pasted_image.png\"></a></div>",
        "id": 185538690,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578950299
    },
    {
        "content": "<p>do we want to generate both shaded and non-shaded jars for these 2 module?  do we want the version included in the final executable jar's name (the jar that gets packaged with the distribution)?</p>",
        "id": 185538812,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578950356
    },
    {
        "content": "<p>for fhir-validator, it gets even more interesting, because we probably DO want both the \"normal\" and \"uber-jar\" variants for that one</p>",
        "id": 185538919,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578950410
    },
    {
        "content": "<p>rough size differences are 72K to 16M for fhir-persistence-schema</p>",
        "id": 185539319,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578950688
    },
    {
        "content": "<p>the good news in the case of persistence-schema it's bound closely to the model.</p>",
        "id": 185539382,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578950734
    },
    {
        "content": "<p>I think my slight preference is to generate ONLY the uber jar for persistence-schema and swagger-generator, since I don't know of any re-use scenarios for those outside of just executing them</p>",
        "id": 185539930,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951068
    },
    {
        "content": "<p>but i couldn't really figure out how to make the shade plugin do that (in my case it just moved the 'normal' jar to <code>original-*.jar</code></p>",
        "id": 185540038,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951131
    },
    {
        "content": "<p>I'm +1 on that plan</p>",
        "id": 185540067,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578951155
    },
    {
        "content": "<p>but i think ONLY the shaded jar gets 'attached' as the output</p>",
        "id": 185540071,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951158
    },
    {
        "content": "<p>so thats the only one that would end up in the maven repo</p>",
        "id": 185540092,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951172
    },
    {
        "content": "<p><em>i think</em></p>",
        "id": 185540097,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951175
    },
    {
        "content": "<p>they can all end up there</p>",
        "id": 185540106,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578951182
    },
    {
        "content": "<p>Do you have opinion on the second part; should the packaged executable jar have a version postfix or no?</p>",
        "id": 185540155,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951225
    },
    {
        "content": "<p>Ugh, the fhir-swagger-generator actually pulls in all of fhir-examples too, because I updated it to include examples in the generated api definitions</p>",
        "id": 185541159,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951940
    },
    {
        "content": "<p>so that one comes in around 65 MB</p>",
        "id": 185541169,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951947
    },
    {
        "content": "<p>which means the combined weight of these three utilities will increase our distribution by like 100 MB</p>",
        "id": 185541224,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578951969
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span> we can add an exclusion on that to the shadeplugin</p>",
        "id": 185542523,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578952846
    },
    {
        "content": "<p>it'll cut the size down</p>",
        "id": 185542532,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578952854
    },
    {
        "content": "<p>the problem is its actually used during generation</p>",
        "id": 185542563,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578952876
    },
    {
        "content": "<p>its a legit dependency of the plugin</p>",
        "id": 185542571,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578952882
    },
    {
        "content": "<p>we don't use ALL of the examples</p>",
        "id": 185542578,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578952891
    },
    {
        "content": "<p>but we do use some subset of them</p>",
        "id": 185542585,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578952900
    },
    {
        "content": "<p>hum... I think we can use a transformer and strip it out</p>",
        "id": 185542590,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578952905
    },
    {
        "content": "<p>tell me what you want, and I think I can remove the others</p>",
        "id": 185542596,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578952913
    },
    {
        "content": "<p>at some future time, i was thinking of letting the user specify which examples they want</p>",
        "id": 185542680,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578952955
    },
    {
        "content": "<p>e.g. spec examples, minimal examples, or mock examples</p>",
        "id": 185542696,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578952968
    },
    {
        "content": "<p>Excluding Resources with the DontIncludeResourceTransformer</p>",
        "id": 185542722,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578952985
    },
    {
        "content": "<p>we NEVER want the complete-absent ones though</p>",
        "id": 185542726,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578952986
    },
    {
        "content": "<p><a href=\"https://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html#IncludeResourceTransformer\" target=\"_blank\" title=\"https://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html#IncludeResourceTransformer\">https://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html#IncludeResourceTransformer</a></p>",
        "id": 185542747,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578952996
    },
    {
        "content": "<p>we can use that</p>",
        "id": 185542752,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1578952999
    },
    {
        "content": "<p>cool</p>",
        "id": 185542759,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953007
    },
    {
        "content": "<p>today, the only ones we use are the ones at <code>/json/ibm/complete-mock</code></p>",
        "id": 185542848,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953047
    },
    {
        "content": "<p>and of those, only the ones with a postfix of <code>-1</code></p>",
        "id": 185542864,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953057
    },
    {
        "content": "<p>e.g. <code>/json/ibm/complete-mock/Patient-1.json</code></p>",
        "id": 185542877,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953071
    },
    {
        "content": "<p>btw i asked google about the version vs non-version jar and read through the answers at <a href=\"https://stackoverflow.com/questions/16482102/when-should-a-jar-file-name-have-a-version-number-in-it-what-are-the-pros-and-c\" target=\"_blank\" title=\"https://stackoverflow.com/questions/16482102/when-should-a-jar-file-name-have-a-version-number-in-it-what-are-the-pros-and-c\">https://stackoverflow.com/questions/16482102/when-should-a-jar-file-name-have-a-version-number-in-it-what-are-the-pros-and-c</a></p>",
        "id": 185542946,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953120
    },
    {
        "content": "<p>so now i'm thinking of including the versions (which is also the maven and shade default)</p>",
        "id": 185542970,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953142
    },
    {
        "content": "<p>resulting structure will be<br>\n<a href=\"/user_uploads/10155/_d-BJgkLGav7ZZcY2KPACEVx/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/_d-BJgkLGav7ZZcY2KPACEVx/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/_d-BJgkLGav7ZZcY2KPACEVx/pasted_image.png\"></a></div>",
        "id": 185543243,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953327
    },
    {
        "content": "<p>although I always wondered if we could flatten it a bit more</p>",
        "id": 185543289,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953362
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192334\">@John Timm</span> any idea why we include the <code>fhir</code> and <code>server</code> directories in this distribution zip?</p>",
        "id": 185543391,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953415
    },
    {
        "content": "<p>seems like the two directories under <code>server</code> could just be added directly under <code>fhir-server-dist</code></p>",
        "id": 185543424,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953451
    },
    {
        "content": "<p>or perhaps just replacing <code>fhir/server</code> with some other name like <code>installFiles</code> would help make it clearer that these are artifacts that are used by the install scripts to install the server within a new directory</p>",
        "id": 185543874,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1578953757
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span> I'm not sure why it is nested like that. That layout hasn't changed in quite a while.</p>",
        "id": 185603402,
        "sender_full_name": "John Timm",
        "timestamp": 1579013842
    },
    {
        "content": "<p>after a few different iterations, we ended up creating a \"shaded\" version of both fhir-swagger-generator and fhir-persistence-schema.  to make their purpose more clear, I attached a classifier of \"cli\" to the all-in-one executable flavor of these jars.  I also updated their READMEs.  The PR was <a href=\"https://github.com/IBM/FHIR/pull/587\" target=\"_blank\" title=\"https://github.com/IBM/FHIR/pull/587\">https://github.com/IBM/FHIR/pull/587</a></p>",
        "id": 185696329,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1579094413
    }
]