[
    {
        "content": "<p>one interesting thing about our layered implementation is we end up with extremely similar tests at multiple levels:</p>\n<ul>\n<li>fhir-model (unit)</li>\n<li>fhir-persistence (functional?)</li>\n<li>fhir-server-test (e2e / integration)</li>\n</ul>",
        "id": 179474961,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468189
    },
    {
        "content": "<p>I was just reviewing <a href=\"https://github.com/IBM/FHIR/pull/341\" target=\"_blank\" title=\"https://github.com/IBM/FHIR/pull/341\">https://github.com/IBM/FHIR/pull/341</a> and this came to my mind once again</p>",
        "id": 179475001,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468221
    },
    {
        "content": "<p>whats our perspective on the right place for these tests?</p>",
        "id": 179475033,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468240
    },
    {
        "content": "<p>should we test everything we can at each layer?</p>",
        "id": 179475087,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468253
    },
    {
        "content": "<p>should we be more exhaustive in the unit tests and less exhaustive in the e2e tests</p>",
        "id": 179475129,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468277
    },
    {
        "content": "<p>should we just favor the e2e ones and do less unit testing?</p>",
        "id": 179475142,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468288
    },
    {
        "content": "<p>for this particular issue, i was expecting to see some tests added in fhir-persistence</p>",
        "id": 179475189,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468324
    },
    {
        "content": "<p>but perhaps i'm just biased because thats where i've spent a lot of time recently?</p>",
        "id": 179475214,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468350
    },
    {
        "content": "<p>I think it's probably a case by case thing. I would expect that changes to PL yields, at the very least, additional unit tests. Ideally, there would also be an integration test if we think that the REST layer might be impacted by a change (for example, the paging context work we did yesterday).</p>",
        "id": 179475352,
        "sender_full_name": "John Timm",
        "timestamp": 1572468431
    },
    {
        "content": "<p>integration tests are needed when we cross component boundaries</p>",
        "id": 179475379,
        "sender_full_name": "John Timm",
        "timestamp": 1572468451
    },
    {
        "content": "<p>if the change is isolated, then i think integration tests are a nice to have but not necessarily a requirement</p>",
        "id": 179475433,
        "sender_full_name": "John Timm",
        "timestamp": 1572468483
    },
    {
        "content": "<p>IMO, most of the \"exhaustive\" testing should be done in the units (if possible)</p>",
        "id": 179475483,
        "sender_full_name": "John Timm",
        "timestamp": 1572468510
    },
    {
        "content": "<p>what i've sort of been thinking (for changes effecting the persistence layer at least) is to have through/exhaustive unit tests</p>",
        "id": 179475530,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468546
    },
    {
        "content": "<p>shooting for good code coverage</p>",
        "id": 179475542,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468557
    },
    {
        "content": "<p>and then a smattered of end-to-end / integration tests to show things are working as expected in the cases we care most about</p>",
        "id": 179475578,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468584
    },
    {
        "content": "<p>but sometimes i waver on that and think \"what really matters is the e2e behavior of the system, so maybe thats where we should be exhaustive\"</p>",
        "id": 179475666,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468627
    },
    {
        "content": "<p>i go back and forth depending on the weather...</p>",
        "id": 179475693,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468640
    },
    {
        "content": "<p>just due  to the nature of e2e tests and the setup and time required to run, etc. it's more difficult and not always practical to build something that is exhaustive</p>",
        "id": 179475773,
        "sender_full_name": "John Timm",
        "timestamp": 1572468692
    },
    {
        "content": "<p>also, our fhir-persistence tests aren't REALLY unit tests</p>",
        "id": 179475775,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468693
    },
    {
        "content": "<p>i think they're much closer to functional tests</p>",
        "id": 179475790,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468703
    },
    {
        "content": "<p>or, if they are unit tests, the unit under test is quite large</p>",
        "id": 179475800,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468720
    },
    {
        "content": "<p>whereas with units it is easier to be more exhaustive</p>",
        "id": 179475847,
        "sender_full_name": "John Timm",
        "timestamp": 1572468724
    },
    {
        "content": "<p>I don't think the PL tests are technically unit tests. in DSTU2 we called them \"lightweight integration tests\"</p>",
        "id": 179475885,
        "sender_full_name": "John Timm",
        "timestamp": 1572468754
    },
    {
        "content": "<p>yeah, that sounds about right</p>",
        "id": 179475898,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468765
    },
    {
        "content": "<p>they aren't e2e but they do require \"integration\" with a database backend</p>",
        "id": 179475902,
        "sender_full_name": "John Timm",
        "timestamp": 1572468769
    },
    {
        "content": "<p>so is that the spot to be exhaustive?</p>",
        "id": 179475906,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468771
    },
    {
        "content": "<p>for PL stuff, I think it's the best option</p>",
        "id": 179475929,
        "sender_full_name": "John Timm",
        "timestamp": 1572468787
    },
    {
        "content": "<p>hard to test the PL stuff without at least Derby at your disposal</p>",
        "id": 179475949,
        "sender_full_name": "John Timm",
        "timestamp": 1572468806
    },
    {
        "content": "<p>ok, thanks for the discussion.  it makes me feel more confident to ask albert to add PL tests for testing this \"duplicate search results\" case</p>",
        "id": 179476074,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1572468879
    }
]