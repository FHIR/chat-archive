[
    {
        "content": "<p>I'm trying to write an invariant where a code has to be in a set of codes depending on a condition:<br>\nIf type = C43660, then serviceProvisionCode = C106443, C131710, C131708, and/or C131709.</p>\n<p>I've tried writing this as:<br>\ntype.coding.code != 'C43360' or serviceProvisionCode.where((coding.code in {'C106643','C131710','C131708','C131709'}).not()).count() = 0<br>\nOR<br>\ntype.coding.code != 'C43360' or serviceProvisionCode.where(({'C106643','C131710','C131708','C131709'} contains coding.code).not()).count() = 0</p>\n<p>Both of those fail with a \"expecting a token name\" error:<br>\nProblem processing expression type.coding.code != 'C43360' or serviceProvisionCode.where((coding.code in {'C106643','C131710','C131708','C131709'}).not()).count() = 0 in profile <a href=\"http://hl7.org/fhir/us/spl/StructureDefinition/LabelerBusinessOperation\">http://hl7.org/fhir/us/spl/StructureDefinition/LabelerBusinessOperation</a> path HealthcareService: Error @1, 7: Found { expecting a token name<br>\nProblem processing expression type.coding.code != 'C43360' or serviceProvisionCode.where(({'C106643','C131710','C131708','C131709'} contains coding.code).not()).count() = 0 in profile <a href=\"http://hl7.org/fhir/us/spl/StructureDefinition/LabelerBusinessOperation\">http://hl7.org/fhir/us/spl/StructureDefinition/LabelerBusinessOperation</a> path HealthcareService: Error @1, 5: Found { expecting a token name</p>\n<p>I'm guessing that I'm not specifying the static collection correctly.  Can someone lend me a hand?</p>",
        "id": 242107020,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1623262165
    },
    {
        "content": "<p>where('C106643' | 'C131710'|'C131708' | 'C131709')</p>",
        "id": 242132721,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1623273896
    },
    {
        "content": "<p><code>type.coding.where(code = 'C43360').exists() implies serviceProvisionCode.coding.where(code in ('C106643' | 'C131710' | 'C131708' | 'C131709')).exists()</code></p>",
        "id": 242135272,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1623275180
    },
    {
        "content": "<p>Using implies makes it a little more readable, IMHO</p>",
        "id": 242135291,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1623275194
    },
    {
        "content": "<p>This logic is also assuming system, which might be dangerous?</p>",
        "id": 242135387,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1623275253
    },
    {
        "content": "<p>thanks to both.  I can't find that syntax in the FHIRPath spec, so a pointer to it would be nice.  As to assuming system, I've already got a required binding so I know the system is fixed.</p>",
        "id": 242139016,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1623277660
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> I need to say that only those codes are allowed.  I think what you wrote says that one of those codes has to be there, but that others could also be there?</p>",
        "id": 242139333,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1623277874
    },
    {
        "content": "<p>Ah, yes:</p>\n<div class=\"codehilite\"><pre><span></span><code>type.coding.where(code = &#39;C43360&#39;).exists() implies serviceProvisionCode.coding.select(code = (&#39;C106643&#39; | &#39;C131710&#39; | &#39;C131708&#39; | &#39;C131709&#39;)).allTrue()\n</code></pre></div>",
        "id": 242142648,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1623280489
    },
    {
        "content": "<p>And the link to the union syntax: <a href=\"http://hl7.org/fhirpath/#unionother-collection\">http://hl7.org/fhirpath/#unionother-collection</a></p>",
        "id": 242142766,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1623280603
    },
    {
        "content": "<p>FHIRPath by design does not have a list-selector syntax, so constructing a list is effectively a chain of unions.</p>",
        "id": 242142824,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1623280665
    },
    {
        "content": "<p>i bow to your fhirpath skills :)</p>",
        "id": 242143498,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1623281282
    }
]