[
    {
        "content": "<p>In <a href=\"http://build.fhir.org/eventdefinition-example.json.html\" target=\"_blank\" title=\"http://build.fhir.org/eventdefinition-example.json.html\">this example</a> we see the following expression:</p>\n<div class=\"codehilite\"><pre><span></span>(this | %previous).location.where(location = &#39;Location/emergency&#39; and status in {&#39;active&#39;, &#39;completed&#39;}).exists()\n</pre></div>\n\n\n<p>Should <code>this</code> actually be <code>$this</code>, or are both valid?</p>",
        "id": 164728006,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1556818516
    },
    {
        "content": "<p>(Related: how are fhirpath expressions in the spec validated?)</p>",
        "id": 164728038,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1556818541
    },
    {
        "content": "<p>Should be <code>$this</code>, it's a special-purpose identifier in the grammar.</p>",
        "id": 164730692,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1556820324
    },
    {
        "content": "<p>The expressions in the spec are validated with the engine running</p>",
        "id": 164730778,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1556820376
    },
    {
        "content": "<p>in the build</p>",
        "id": 164730795,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1556820387
    },
    {
        "content": "<p>But since that particular example doesn't actually run as part of the build, it's not validated.</p>",
        "id": 164730817,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1556820411
    },
    {
        "content": "<p>that expression is not validated - it's not in a place the validator knows to look and validate. And I think it should actually be </p>\n<p><code>(%current | %previous).location.where(location = 'Location/emergency' and status in {'active', 'completed'}).exists()</code></p>",
        "id": 164730911,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1556820478
    },
    {
        "content": "<p>Where is %current defined?</p>",
        "id": 164731048,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1556820571
    },
    {
        "content": "<p><code>%current</code> is a context variable so it's defined by whatever the context specifies. In this case, a trigger condition, so it's specified as part of the condition element as an expectation of the implementation.</p>",
        "id": 164731158,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1556820643
    },
    {
        "content": "<p>That makes sense.  FYI, at <a href=\"http://build.fhir.org/metadatatypes-definitions.html#TriggerDefinition.condition\" target=\"_blank\" title=\"http://build.fhir.org/metadatatypes-definitions.html#TriggerDefinition.condition\">http://build.fhir.org/metadatatypes-definitions.html#TriggerDefinition.condition</a>, I saw %previous mentioned, but not %current defined as a variable name.  Although it says you should be able to get to the current resource,  it does not say what variable name it is in.</p>",
        "id": 164731858,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1556821047
    },
    {
        "content": "<p>right. that work is incomplete for that reason</p>",
        "id": 164732403,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1556821432
    },
    {
        "content": "<p>Added <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21233\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21233\">GF#21233</a></p>",
        "id": 164737053,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1556824913
    }
]