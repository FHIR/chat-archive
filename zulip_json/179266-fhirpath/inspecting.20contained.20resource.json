[
    {
        "content": "<p>How do I correctly get a hold of a certain (set of) contained resource(s) in an invariant. Lets say I have a Communication resource and the sender is a contained device. In my Invariant, I would like to get access to that particular contained resource. The following does not work (and it aint elegant either): <code>contained.where(id = sender.reference.replace('#',''))</code></p>",
        "id": 191822816,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1585178076
    },
    {
        "content": "<p>the question is how is that correctly stated using FHIR Path?</p>",
        "id": 191822849,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1585178113
    },
    {
        "content": "<p>You should ideally be resolving the references (using <code>.resolve()</code>) rather than relying on foreknowledge that the content will be contained.</p>",
        "id": 191840272,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1585198412
    },
    {
        "content": "<p>How do I inspect the identifier of the device when the example looks like the following?</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;sender&quot;: {\n    &quot;reference&quot;: &quot;#1&quot;\n  },\n  &quot;meta&quot;: {\n    &quot;profile&quot;: [\n      &quot;http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-message&quot;\n    ]\n  },\n  &quot;status&quot;: &quot;completed&quot;,\n  &quot;medium&quot;: [\n    {\n      &quot;text&quot;: &quot;WRITTEN&quot;,\n      &quot;coding&quot;: [\n        {\n          &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v3-ParticipationMode&quot;,\n          &quot;code&quot;: &quot;WRITTEN&quot;\n        }\n      ]\n    }\n  ],\n  &quot;recipient&quot;: [\n    {\n      &quot;reference&quot;: &quot;http://inttest.ehealth.sundhed.dk/trifork-fhir-server/Patient/XXX&quot;\n    }\n  ],\n  &quot;resourceType&quot;: &quot;Communication&quot;,\n  &quot;category&quot;: [\n    {\n      &quot;text&quot;: &quot;Besked&quot;,\n      &quot;coding&quot;: [\n        {\n          &quot;system&quot;: &quot;http://ehealth.sundhed.dk/cs/message-category&quot;,\n          &quot;code&quot;: &quot;message&quot;\n        }\n      ]\n    }\n  ],\n  &quot;contained&quot;: [\n    {\n      &quot;id&quot;: &quot;1&quot;,\n      &quot;resourceType&quot;: &quot;Device&quot;,\n      &quot;identifier&quot;: [\n        {\n          &quot;value&quot;: &quot;hello.system&quot;\n        }\n      ]\n    }\n  ],\n  &quot;payload&quot;: [\n    {\n      &quot;contentString&quot;: &quot;Hello world&quot;\n    }\n  ],\n  &quot;sent&quot;: &quot;2019-04-03T18:01:10-08:00&quot;\n}\n</pre></div>\n\n\n<p>sender.resolve() returns the empty set</p>",
        "id": 191852599,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1585212051
    },
    {
        "content": "<p>at least using <a href=\"https://marketplace.visualstudio.com/items?itemName=Yannick-Lagger.vscode-fhir-tools\" title=\"https://marketplace.visualstudio.com/items?itemName=Yannick-Lagger.vscode-fhir-tools\">https://marketplace.visualstudio.com/items?itemName=Yannick-Lagger.vscode-fhir-tools</a></p>",
        "id": 191852616,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1585212069
    },
    {
        "content": "<p>I have the same need, I guess</p>",
        "id": 259450545,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1635454477
    },
    {
        "content": "<p>I am looking into a contained resource. <br>\nThis evaluates to true:<br>\n<code>contained.first().id=implementation.custodian.reference.substring(1,999)</code></p>",
        "id": 259450663,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1635454550
    },
    {
        "content": "<p>(as it should) - this means that the first contained resource matches what I want to look for</p>",
        "id": 259450736,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1635454570
    },
    {
        "content": "<p>so why doesn't <code>contained.where(id=implementation.custodian.reference.substring(1,999))</code> return the first contained resource?</p>",
        "id": 259450847,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1635454648
    },
    {
        "content": "<p><code>contained.where(id=%resource.implementation.custodian.reference.substring(1,999))</code> will probably work</p>",
        "id": 259459927,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635459671
    },
    {
        "content": "<p>When you're inside the where clause, the names of the properties you're referencing have to be 'visible' from the node you're on.  In this case, the root node of all the contained resources</p>",
        "id": 259460035,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635459729
    },
    {
        "content": "<p>%resource allows you to start at the root of the resource that is the 'base' for the current node</p>",
        "id": 259461111,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635460572
    },
    {
        "content": "<p>It seems that %resource is not implemented in the javascript library that I want to use.</p>",
        "id": 259487022,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1635488508
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span></p>",
        "id": 259520824,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635512704
    },
    {
        "content": "<p>It is, but you have to set it when calling it.</p>",
        "id": 259697293,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1635550877
    },
    {
        "content": "<p>What does that mean?</p>",
        "id": 259718758,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1635583132
    },
    {
        "content": "<p>The code that calls it needs to pass in an array of variables, including this one.</p>",
        "id": 259719898,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1635584879
    },
    {
        "content": "<p>Not the part on here that talks about environment variables, use that and add in resource to that array like it has for %a<br>\n<a href=\"https://github.com/HL7/fhirpath.js/\">https://github.com/HL7/fhirpath.js/</a></p>",
        "id": 259720069,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1635585145
    },
    {
        "content": "<p>thanks. That works</p>",
        "id": 259811415,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1635718813
    }
]