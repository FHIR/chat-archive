[
    {
        "content": "<p>Hello! I'm working on a FHIRPath Patch implementation for our FHIR server. I've run into two related use cases where data needs to be added to a resource, but the target object or list isn't initialized. The specification page doesn't address proper behavior for this scenario, so my assumption is that the behavior is left up to the implementer. Is that correct? Also, any input on what the server should do for these scenarios?</p>\n<p>JSONPatch specifically calls this out in <a href=\"https://www.rfc-editor.org/rfc/rfc6902#section-4.1\">RFC 6902 4.1</a>. The spec says <em>\"However, the object itself or an array containing it does need to exist, and it remains an error for that not to be the case\"</em>.</p>\n<p>Below are a couple of sample use cases. Thanks for the help!</p>\n<p><strong>Use Case 1: Adding a value to a nested object that doesn't exist.</strong><br>\nThe Patient has an identifier defined without a period. The user wants to be able to expire the identifier. Should the server initialize the <code>period</code> object that doesn't exist on the object or return an error?</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n    <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Patient\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"identifier\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">\"use\"</span><span class=\"p\">:</span> <span class=\"s2\">\"official\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"value\"</span><span class=\"p\">:</span> <span class=\"s2\">\"123\"</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n    <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Parameters\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"parameter\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"operation\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"part\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"type\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span> <span class=\"s2\">\"add\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"path\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Patient.identifier.where(use = 'official').period\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"name\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span> <span class=\"s2\">\"end\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueDate\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2021-12-01\"</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">]</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p><strong>Use Case 2: Inserting a value into a list that doesn't exist.</strong><br>\nA Patient resource exists without any identifiers. The user wants to add an identifier to the patient. Should the server initialize the <code>identifier</code> list or return an error?</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n    <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Patient\"</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n    <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Parameters\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"parameter\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"operation\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"part\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"type\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span> <span class=\"s2\">\"add\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"path\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Patient\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"name\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span> <span class=\"s2\">\"identifier\"</span>\n                <span class=\"p\">},</span>\n                <span class=\"p\">{</span>\n                    <span class=\"nt\">\"name\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value\"</span><span class=\"p\">,</span>\n                    <span class=\"nt\">\"valueIdentifier\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://example.org\"</span><span class=\"p\">,</span>\n                        <span class=\"nt\">\"value\"</span><span class=\"p\">:</span> <span class=\"s2\">\"value 3\"</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">]</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 263913688,
        "sender_full_name": "Mikael Weaver",
        "timestamp": 1638820968
    },
    {
        "content": "<p>See <a href=\"#narrow/stream/179166-implementers/topic/FHIRPath.20Patch.20on.20uninitialized.20object.2Flist\">the orig thread</a> for the answer</p>",
        "id": 264384591,
        "sender_full_name": "Mikael Weaver",
        "timestamp": 1639094091
    }
]