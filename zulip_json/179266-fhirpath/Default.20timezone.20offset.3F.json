[
    {
        "content": "<p>In reconciling test results from different engines, the question of a default timezone offset has come up. The spec currently says if a date/time value doesn't have a timezone offset, use the timezone offset of the evaluating environment. But this is potentially a policy decision, so we'd like to get input on the question (<a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20311\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20311\">GF#20311</a>).</p>",
        "id": 156995524,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548636991
    },
    {
        "content": "<p>We're also looking at removing the timezone offset from Time values (<a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20310\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20310\">GF#20310</a>).</p>",
        "id": 156995531,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548637018
    },
    {
        "content": "<p>In a server context, I find default timezone problematic</p>",
        "id": 156996821,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548639458
    },
    {
        "content": "<blockquote>\n<p>We're also looking at removing the timezone offset from Time values (<a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20310\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20310\">GF#20310</a>).</p>\n</blockquote>\n<p>I am neither for it nor against, but I am not sure I follow the reasoning.    It says \"the timezone offset is ambiguous because it does not provide enough context to determine the timezone\".  If someone writes, @T11:00-07:00,  does it matter which timezone is -7?</p>",
        "id": 157043987,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548698483
    },
    {
        "content": "<p>Bryn's advanced use case was a repeating event that happens every day at 15:00+05:00. And there, it does matter</p>",
        "id": 157050241,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548703159
    },
    {
        "content": "<p>because oes it change with timezones?</p>",
        "id": 157050257,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548703171
    },
    {
        "content": "<p>As I understand it, \"15:00+05:00\" specifies a moment in time, irrespective of timezone-- the moment that can also be expressed as \"10:00Z\".</p>",
        "id": 157052265,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548704842
    },
    {
        "content": "<p>it can't specify a monet in time, since it has no date.</p>",
        "id": 157052623,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548705182
    },
    {
        "content": "<p>True.  A moment that occurs every 24 hours, then.  My question is how a timezone can affect the meaning \"15:00+05:00\".  The offset is already known.</p>",
        "id": 157052865,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548705419
    },
    {
        "content": "<p>because usually, at least, people actually mean a timezone rather than an offset. As I am all too familiar with, since HL7 calls are a moving target for me. They happen at a time in a timezone, rather than at an offset time</p>",
        "id": 157052972,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548705507
    },
    {
        "content": "<p>I don't know of anything that happens at an offset</p>",
        "id": 157052980,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548705517
    },
    {
        "content": "<p>The problem is that many times events are expressed in a timezone whose offset changes based on the date.  So Eastern Time is either EST or EDT and has a different offset.</p>",
        "id": 157053035,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1548705578
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192166\">@Jean Duteau</span>  So, that would cause a problem is someone wrote, \"15:00 ET\" (Eastern Time), because the offset would in that case depend on the date.  But, I think what is under discussion is the whether it will permitted to specify an offset with just a time, like \"15:00-05:00\".   You might not not know whether that that -05:00 is ET time or not, but you know it is 5 hours behind UTC.</p>",
        "id": 157053940,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548706435
    },
    {
        "content": "<p>(helps to go read the tracker item)  I now agree with what you are saying.  The tracker seems to imply that I want to take the timezone offset and convert it back to an actual timezone.  I would argue that you can't do that even if you have a date, because -05:00 can be any number of timezones even for a given date.  So that problem of converting to a timezone seems out of scope of the Time datatype and thus wouldn't be an argument for-or-against the offset.  As well, Grahame and my original answer also seem to be out of scope since that's not what the timezone offset is for.  If I have a time expressed as \"15:00 ET\", I'm hooped with the existing time and date datatypes because that isn't one specific offset.</p>",
        "id": 157054424,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1548706851
    },
    {
        "content": "<p>The proposed disposition is I think to remove the timezone offset from the Time type because of the ambiguity (the same approach the FHIR Time type takes).</p>",
        "id": 157056707,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548708978
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> We were just discussing what the \"ambiguity\" is, and how removing the offset helps.  The questions are 1) What is ambiguous about \"15:00-05:00\", and 2) How is \"15:00\" less ambiguous?</p>",
        "id": 157057090,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548709281
    },
    {
        "content": "<p>I don't think it's ambiguous. I just think it's uselss</p>",
        "id": 157060011,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548711533
    },
    {
        "content": "<p>I can't say how useful it is, but if you have a stream of data you're reading and a subset of it is from a person at offset \"-05:00\", that gives you some rough idea of where the person is (possibly), and whether (for example) the person is likely to see an email or be reachable by phone at a particular time.</p>",
        "id": 157061784,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548713159
    },
    {
        "content": "<p>Offset becomes tricky when considering locale-dependent augmentations such as U.S. daylight saving time, European summer time, etc.  Would the addition of server locale metadata make the offset more useful?</p>",
        "id": 157061976,
        "sender_full_name": "Joel Schneider",
        "timestamp": 1548713363
    },
    {
        "content": "<p>Is not ambiguous, it's pointless.<br>\nIf you want to fix a regular time (which is the common case), you need the zone, not offset. E. G. 9:30 america/new york</p>",
        "id": 157062057,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1548713427
    },
    {
        "content": "<p>With that you can construct the real intended date time for any specific date correctly.</p>",
        "id": 157062090,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1548713470
    },
    {
        "content": "<p>This is what we need in the HealthcareService resource for availability. I think this is still in a tracker and not applied yet.<br>\nThe binding would be to the tz database<br>\n<a href=\"https://en.m.wikipedia.org/wiki/Tz_database\" target=\"_blank\" title=\"https://en.m.wikipedia.org/wiki/Tz_database\">https://en.m.wikipedia.org/wiki/Tz_database</a></p>",
        "id": 157062212,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1548713593
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> , for pointing out the \"common case\".  (I was thinking of other cases, but they are probably not realistic.)</p>",
        "id": 157062876,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548714240
    },
    {
        "content": "<p>For defaulting timezone offset, options are: 1) don't default at all, or 2) default to the timezone offset of the server, or 3) default to the timezone offset of the request. In CQL, we use option 3. It's not perfect, but it's more likely to give the expected answer than converting to UTC.</p>",
        "id": 157076886,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548731617
    },
    {
        "content": "<p>We also use the timestamp of the request for the now() and today() functions. <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20312\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20312\">GF#20312</a></p>",
        "id": 157076936,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548731693
    },
    {
        "content": "<p>The FHIR spec suggests option 2 (but also cautions, <a href=\"http://hl7.org/fhir/search.html#date\" target=\"_blank\" title=\"http://hl7.org/fhir/search.html#date\">here there be dragons</a>)</p>",
        "id": 157077058,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548731900
    },
    {
        "content": "<p>Where do you pull it from in the request?</p>",
        "id": 157077428,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1548732460
    },
    {
        "content": "<p>We don't specify that, but have suggested the Date header for http requests.</p>",
        "id": 157077580,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548732721
    },
    {
        "content": "<blockquote>\n<p>We don't specify that, but have suggested the Date header for http requests.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span>   It sounds like you are thinking of server-side evaluation of FHIRPath.  For client-side evaluation (e.g. in the context or rendering/updating a Questionnaire) what would the \"request\" be, from which one would get the default timezone offset?  Maybe in that case since it is client side, it would just use the client's (browser's) timezone offset?</p>",
        "id": 157112567,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548775628
    },
    {
        "content": "<p>Yes, that's how I tend to think about it, even for client-side evaluation, there's still a \"call\" to the engine, and that's where you would pass the \"request\" time. In a browser, using the browser's current timestamp.</p>",
        "id": 157115813,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548778469
    },
    {
        "content": "<p>That should work.</p>",
        "id": 157115981,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548778637
    },
    {
        "content": "<p>what's the timezone of the request?</p>",
        "id": 157135930,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548794293
    },
    {
        "content": "<p>Timezone offset of the request</p>",
        "id": 157140478,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548797716
    },
    {
        "content": "<p>really? where is that?</p>",
        "id": 157140752,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548797973
    },
    {
        "content": "<p>Not sure what you mean?</p>",
        "id": 157140918,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548798085
    },
    {
        "content": "<blockquote>\n<p>Unfortunately, there is no corresponding “Accept-Timezone” header- the HTTP standard does not contain any facility to allow the browser to automatically tell the server what time zone the user cares about.</p>\n</blockquote>",
        "id": 157141360,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548798430
    },
    {
        "content": "<p>Gotcha, and the Date header only allows communication of UTC. But that could be used to compute an offset on the server.</p>",
        "id": 157141670,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548798656
    },
    {
        "content": "<p>That you could then pass to the engine.</p>",
        "id": 157141688,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548798666
    },
    {
        "content": "<p>How do you compute an offset from a UTC date stamp without knowing the timezone in advance?</p>",
        "id": 157142283,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1548799064
    },
    {
        "content": "<p>you can't. all you can know is the server timezone. see <a href=\"https://tools.ietf.org/html/draft-sharhalakis-httptz-05\" target=\"_blank\" title=\"https://tools.ietf.org/html/draft-sharhalakis-httptz-05\">https://tools.ietf.org/html/draft-sharhalakis-httptz-05</a>, which never got up. I asked the http working group about it, and they said 'use javascript', as if restful apis were not a thing :-(</p>",
        "id": 157142980,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548799585
    },
    {
        "content": "<p>So it is possible, but it requires the client provide the request DateTime as a parameter. That's pretty important for decision support use cases, is it too much burden to require the client to provide it?</p>",
        "id": 157143934,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548800428
    },
    {
        "content": "<p>lol I bet the answer is yes. You could ask on the implementer channel</p>",
        "id": 157143966,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548800466
    },
    {
        "content": "<p>Or is this a case where the spec could allow for a policy-based decision?</p>",
        "id": 157143971,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548800472
    },
    {
        "content": "<p>what kind of policy baed decision in which spec?</p>",
        "id": 157144069,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548800532
    },
    {
        "content": "<p>I think there are two places in the FHIRPath spec where it matters, 1) What is the current date/time, and 2) Should date/time values that don't have a timezone offset specified use the timezone offset of the current date/time. Both those can be policy decisions based on the scenario, with the simplest being 1) local server time, and 2) no default.</p>",
        "id": 157144498,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1548800936
    },
    {
        "content": "<p>I think at the FHIRPath spec level, yes, that should be the rule</p>",
        "id": 157145675,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1548802076
    },
    {
        "content": "<p>I've updated the dispositions for <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20310\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20310\">GF#20310</a>, <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20311\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20311\">GF#20311</a>, <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20015\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20015\">GF#20015</a>, and <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20312\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20312\">GF#20312</a> based on this discussion.</p>",
        "id": 157333661,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1549003127
    }
]