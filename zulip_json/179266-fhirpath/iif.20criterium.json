[
    {
        "content": "<p>In 5.5.1 of <a href=\"http://hl7.org/fhirpath/\" target=\"_blank\" title=\"http://hl7.org/fhirpath/\">http://hl7.org/fhirpath/</a> (the definition of \"iif\") it says what to do if the \"crterium\" expression evalutes to true or false (which I guess means [true] or [false]).  What should happen if it evaluates to something else, like [5.72], [true, true], [true, false], or [ ]?</p>",
        "id": 153983406,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1533677251
    },
    {
        "content": "<p>the expression will always be evaulatable to one of the following values: true | false | null</p>",
        "id": 153983407,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533677287
    },
    {
        "content": "<p>I guess that if it evaluates to null, do neither true or false</p>",
        "id": 153983408,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533677308
    },
    {
        "content": "<p>I thought expressions returned collections.  What rule is used to convert a collection to one of true, false, or null?</p>\n<p>Does doing neither true nor false mean terminating in an error (as the Math functions in 6.6 do)?</p>",
        "id": 153983411,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1533677718
    },
    {
        "content": "<p>null will propagate. collection boolean evaluation is explicitly described</p>",
        "id": 153983412,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533677828
    },
    {
        "content": "<p>section 4.5</p>",
        "id": 153983413,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533677860
    },
    {
        "content": "<p>Thanks.  I was looking for something like 4.5.</p>\n<p>In 4.4, it says \"There is no concept of null in FHIRPath.\"   So, I think you meant true | false | empty collection.  (I guess null is less to type.) If I understand correctly then, it sounds like any value other than a single \"true\", or \"false\", or an empty collection will raise an error, and if the result is the empty collection, then that is also the result of the iif.</p>",
        "id": 153983421,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1533678540
    },
    {
        "content": "<p>I'm not sure about the iif bit - <span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> ?</p>",
        "id": 153983422,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533678922
    },
    {
        "content": "<p>That's correct, if <code>criterion</code> evaluates to <code>true</code>, the result is the value of the <code>true-result</code> argument, otherwise, the result is the value of the <code>otherwise-result</code> argument (or empty if no otherwise-result is provided).</p>",
        "id": 153983461,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1533689481
    },
    {
        "content": "<p>do you mean condition expression should always be of type bool?  what if expression returns [1,2], should i always call exists() or empty() otherwise throw exception? and do you mean that in case of null none of branches are executed and just empty result is returned?</p>",
        "id": 153983581,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1533721437
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191318\">@nicola (RIO/SS)</span> I think Grahame was saying we use the procedure in 4.5 to force criterion into either true, false, or empty collection (or raising an error) and then Bryn was saying  (and 5.5.1 says) the false and empty collection cases are handled the same.</p>",
        "id": 153983856,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1533763430
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span>  just confirm empty means false?</p>",
        "id": 153984047,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1533800700
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191318\">@nicola (RIO/SS)</span>  sorry for the delay, I've been on vacation. I wouldn't characterize it this way, I would say that for <code>iif</code>, empty is interpreted in the same way that <code>false</code> is, but I wouldn't say that empty means false.</p>",
        "id": 153985436,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1534019865
    },
    {
        "content": "<p>The rationale for having ternary logic is that the data is incomplete and so you have to deal with that possibility, and it's invalid to always treat missing information as false. We use the same semantics for missing information and ternary logic that SQL and XQuery do.</p>",
        "id": 153985437,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1534019955
    },
    {
        "content": "<p>But non of programming languages?</p>",
        "id": 153985438,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1534019990
    },
    {
        "content": "<p>Everything is a collection does have pros and cons, but for a path selection language, it makes really good sense, and the semantics we've imposed for singleton evaluation of collections provides a clear interpretation for operations that expect singletons.</p>",
        "id": 153985439,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1534020024
    },
    {
        "content": "<p>Not sure what you mean.</p>",
        "id": 153985440,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1534020060
    },
    {
        "content": "<p>with singleton semantic should we treat everything with more than 1 element as runtime error?</p>",
        "id": 153985441,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1534020072
    },
    {
        "content": "<p>implement maybe monad as vector of one element is not the only way to do it :)</p>",
        "id": 153985445,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1534020301
    },
    {
        "content": "<p>So in fhirpath there is maybe monad for ordinary programming language expressions like plus, logic etc - which is represented as collection of at most one element and list monad with implicit flattening for chaining</p>",
        "id": 153985447,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1534020464
    },
    {
        "content": "<p>I see, in 4.5 runtime error is stated.</p>",
        "id": 153985448,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1534020668
    },
    {
        "content": "<p>What i see in xpath/xquery not <code>everything is a collection</code> - for arithmetic and boolean logic they define just ordinary programming language types and semantic.</p>",
        "id": 153985449,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1534021054
    },
    {
        "content": "<p>I just stumbled over this again.  I don't see anything in <a href=\"http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#iifcriterion-expression-true-result-collection-otherwise-result-collection-collection\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#iifcriterion-expression-true-result-collection-otherwise-result-collection-collection\">5.5.1 - iif</a> that says the criterion is supposed to be coerced into a boolean.  So, perhaps the description needs an update, or if not, then what is the result of <code>iif(5, 1, 2)</code>?</p>",
        "id": 178884798,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1571857205
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> Perhaps that belongs on a new topic?</p>",
        "id": 178957807,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1571927433
    },
    {
        "content": "<p>Yes, sorry.</p>",
        "id": 178996766,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1571950674
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> ?</p>",
        "id": 179003031,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1571955212
    },
    {
        "content": "<p>The general guidance in <a href=\"http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#singleton-evaluation-of-collections\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#singleton-evaluation-of-collections\">Singleton Evaluation of Collections</a> applies to the expression argument. Since the conversion is defined as <a href=\"http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#conversion\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/FHIRPath/branches/master/N1/#conversion\">explicit</a>, existence is interpreted as true, so the result of <code>iif(5, 1, 2)</code> is 1. Note that this means the result of <code>iff(0, 1, 2)</code> is also 1.</p>",
        "id": 179249035,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1572280651
    },
    {
        "content": "<p>Seems like it would be worth a clarifying comment in the specification.</p>",
        "id": 179249086,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1572280676
    },
    {
        "content": "<p>The clarifying comment I would like to see is that the iif criterion is expected to return a Boolean.</p>",
        "id": 179249512,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1572280843
    },
    {
        "content": "<p>Agreed, submit a tracker?</p>",
        "id": 179253418,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1572283055
    },
    {
        "content": "<p>Sure -- <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25059\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25059\">GF#25059</a></p>",
        "id": 179254703,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1572283855
    },
    {
        "content": "<p>So iif(, 1, 2 = 2?</p>",
        "id": 179275223,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572296388
    },
    {
        "content": "<p>I think you are missing some symbols.</p>",
        "id": 179283269,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1572302483
    },
    {
        "content": "<p>ok: <code>iif(, 1, 2)</code> = 2?</p>",
        "id": 179284147,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572303269
    },
    {
        "content": "<p>I think that would actually result in a syntax error, but this <code>iif({ }, 1, 2)</code> would result in 2, yes, because the empty collection would evaluate to an empty collection, which would result in the iif returning the _otherwise-result_ argument.</p>",
        "id": 179287376,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1572306073
    },
    {
        "content": "<p>Also, I think iif(5, 1,2) would be an error, because the 5 is not \"explicitly\" cast to a Boolean.</p>",
        "id": 179339855,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1572362603
    }
]