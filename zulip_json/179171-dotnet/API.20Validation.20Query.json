[
    {
        "content": "<p>I am using the.NET API to validate a STU3 message bundle. </p>\n<p>The results of the validation are mixed and the errors shown look to be valid in that we can understand why they have been identified.</p>\n<p>Looking at the output the following is seen.</p>\n<p><a href=\"/user_uploads/10155/rzdpno0xs6PXKZ7UIa7LLtiK/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<p>It appears as if the API is failing on aspects of the terminology validation but this is not making it to the validation result. </p>\n<p>Is this an error in the .NET API code?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/rzdpno0xs6PXKZ7UIa7LLtiK/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/rzdpno0xs6PXKZ7UIa7LLtiK/pasted_image.png\"></a></div>",
        "id": 153910127,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1506279901
    },
    {
        "content": "<p>.NeE FHIR Client nugget package can validate extensional ValueSet specified in spec. The error says that the valueset it is trying to validate is too complex for the client package to handle. To validate against such complex ValueSet, you have use a  terminology server.</p>",
        "id": 153910128,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506281800
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191506\">@Yunwei Wang</span> I appreciate that that's the case. My issue is that the validation result returned was positive - surely if the terminology validation failed then the validation result should take this into account.</p>",
        "id": 153910129,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1506282514
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> Are you using a FHIR server to do the validation or Fhir Client library?</p>",
        "id": 153910133,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506287057
    },
    {
        "content": "<p>It the FHIR Client library. All the work is local no FHIR servers are involved.</p>",
        "id": 153910139,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1506289738
    },
    {
        "content": "<p>The problem is the library doesn't know how to validate that value set.</p>",
        "id": 153910140,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506290208
    },
    {
        "content": "<p>Yes, I'm fine with that. The issue is that as the valuesets cannot be expanded and hence the codes validated - the validation of the instance should fail. Yet the failed terminology validations appears to be silent and does not impact the overall validation status.</p>",
        "id": 153910141,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1506290393
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> do you know which valueset validation failed?</p>",
        "id": 153910151,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506305361
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> this is a common argument with regard to terminology validation. Some of us thing that it should fail to error, and some of us think it should fail to no error.</p>",
        "id": 153910163,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1506315474
    },
    {
        "content": "<p>On the java validator, this is a setting</p>",
        "id": 153910164,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1506315483
    },
    {
        "content": "<p>This is up to the terminology service class that you pass as a reference to the validator in .net<br>\nThen it depends what you do in that class that counts.<br>\n(My server has a local implementation that fails to the dotnet one that Ewout ported)</p>",
        "id": 153910169,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1506319184
    },
    {
        "content": "<p>You can of course pass in a reference to the <code>ExternalTerminologyService</code> class to use too.<br>\n(and make it a problem for a real terminology service implementation)</p>",
        "id": 153910170,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1506319243
    },
    {
        "content": "<p>to me the question is not really about where the terminology service occurs. It's what happens when it fails. If an intrinsic part of a validation process can fail and not be signalled then that's worrying. I had hoped the.NET API would cater for this. It appears that the JAVA equivalent controls this through config which appears sensible. Is there a reason why the .NET version did not take the same approach?</p>",
        "id": 153910215,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1506333938
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> reason being it is still a work in progress. IMHO validation needs to use three-way logic (correct | incorrect | undetermined) everywhere. Then clients can determine how to deal with indeterminate validation results (i.e. accept or reject).</p>",
        "id": 153910219,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1506334351
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> I agree but unfortunately at this point in time that's not on the table. From an implementation perspective it's looking like we will need to move certain processes towards JAVA which is not really where I'd planned to be at this point.</p>",
        "id": 153910250,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1506341188
    },
    {
        "content": "<p>Ouch, did you just mention the J-word in this stream...?</p>\n<p>I think that with some small temporary tweaks and/or additional config settings, we should be able to let the .NET validator fail in case of missing (ValueSet) dependencies, so you can safely deploy it within your production environment.<br>\nThen we can take some time to discuss proper validator improvements (i.e. 3-way logic) within the community and harmonize API behavior.</p>",
        "id": 153910264,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1506342116
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span>  it hurts me a lot but it's the obvious way forward at the moment. It's going to be a tricky manoeuvre getting out of this which runs the risk of baking in a direction of travel for some time. It's not really where I hoped we'd be.</p>",
        "id": 153910272,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1506342527
    },
    {
        "content": "<p>I read through the source code for .NET validator. Interesting, I noticed the error is suppressed for non required bindings. And for required binding, my understanding about the source code is that the validator should return validator error in OperationOutcome.</p>",
        "id": 153910437,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506350040
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> that is why I want to know if you know which value set failed. If it is non-required binding. Maybe that is the reason.</p>",
        "id": 153910439,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506350082
    },
    {
        "content": "<blockquote>\n<p>Yes, I'm fine with that. The issue is that as the valuesets cannot be expanded and hence the codes validated - the validation of the instance should fail. Yet the failed terminology validations appears to be silent and does not impact the overall validation status.</p>\n</blockquote>\n<p>It's not obvious to me that this should be a failure - I've flip-flopped a few times, since there are arguments both ways, so I can confirm what Grahame says. As Yunwei said, I have settled on an approach where required bindings report an error, and others a warning. </p>\n<p>That said, it's preferable that the .NET and Java API handle things the same way.  I am not a fan of a setting - although it's easy to do and you could simply add a suggestion for enhancement to the .NET API Github issue list.  The idea that -depending on the setting- some servers will validate your instance as correct and others as incorrect feels wrong.</p>\n<p>I feel that the problem lies deeper: the current validator (and probably the Java one too) either determines something is valid or invalid - but there are cases (not just this one BTW), where the outcome is \"undetermined\".  I initially did not choose to go this way - since it might be unclear to the user, but it's issues like these that maybe proof we do need to introduce \"undetermined\" outcomes.</p>",
        "id": 153910612,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1506412317
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span>  it hurts me a lot but it's the obvious way forward at the moment. It's going to be a tricky manoeuvre getting out of this which runs the risk of baking in a direction of travel for some time. It's not really where I hoped we'd be.</p>\n</blockquote>\n<p>If you'd need it as a setting to sooth the pain - feel free to ask!</p>",
        "id": 153910613,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1506412417
    }
]