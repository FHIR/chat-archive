[
    {
        "content": "<p>Hi everyone. <br>\nI need to validate the incoming message and have public message definitions to restrict resources/codes etc by event type. Please advise how to create a message definition (well, probably creation is simple - just use models from the lib but anyway) and validate incoming messages using it with firely-net-sdk?</p>",
        "id": 229819002,
        "sender_full_name": "Pash",
        "timestamp": 1615454765
    },
    {
        "content": "<p>Defining a message structure (=profiling) isn't easy at all [if you're new to it], see <a href=\"http://build.fhir.org/conformance-module.html\">http://build.fhir.org/conformance-module.html</a> .. creating/parsing a message is easy, as is validation, using the ,net SDK, the definition of a profile is not.</p>",
        "id": 229819374,
        "sender_full_name": "René Spronk",
        "timestamp": 1615454979
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191372\">@René Spronk</span>  I see. So starting from the easiest: just check if the message contains 1 Patient. Assume this definition is created: <a href=\"https://www.codepile.net/pile/kBLDjWB9\">https://www.codepile.net/pile/kBLDjWB9</a>  (in memory. By the way, please feel free to add notes there is something looks wrong), how to use it to check the message? I want to investigate how hard is to do it using the best practices and obviously dirty workaround here - validate it manually.</p>",
        "id": 229824431,
        "sender_full_name": "Pash",
        "timestamp": 1615457398
    },
    {
        "content": "<p>Validation strategies can be found here: <a href=\"http://build.fhir.org/validation.html\">http://build.fhir.org/validation.html</a> - what approach you choose depends on your requirements</p>",
        "id": 229825425,
        "sender_full_name": "René Spronk",
        "timestamp": 1615457842
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191372\">@René Spronk</span> hm, I need only validation with MessageDefinition, don't need full profile validation (not sure if it possible, but it is also my question). So just need to check if Bundle with a specific event type (in the MessageHeader) has a set of resources (and additionally validate some properties in that resources, but lets start from an easier example ) and be able to publish that profiles as contracts for third parties. Any advice on how to do it with firely-net-sdk?</p>",
        "id": 229831067,
        "sender_full_name": "Pash",
        "timestamp": 1615460816
    },
    {
        "content": "<p>I'm not a .net SDK user myself, so I'll leave that to others to respond to.</p>",
        "id": 229831157,
        "sender_full_name": "René Spronk",
        "timestamp": 1615460880
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191372\">@René Spronk</span>  np, thank you for help!</p>\n<p><span class=\"user-mention\" data-user-id=\"191347\">@Mirjam Baltus</span>  probably you can help with my stupid question?</p>",
        "id": 229831732,
        "sender_full_name": "Pash",
        "timestamp": 1615461187
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"352507\">@Pash</span> Actually this is not a stupid question at all, but I also have to say that I do not know of a straightforward solution. I think you will have to code the validation by hand.<br>\nThe MessageHeader of the message could contain a link to the MessageDefinition. With that, I would try to see if the MessageHeader.event[x] matches the one in the definition. Or, if it is not linked, I would try to find the relevant MessageDefinition by using a lookup on the event code in the MessageHeader. After that, I would run through the focus resources in the definition to see if they are listed in the message header, plus also perhaps do a check on the Bundle to see if they're included. But again, this would all be done by coding the important parts of my checks.</p>",
        "id": 229836632,
        "sender_full_name": "Mirjam Baltus",
        "timestamp": 1615463859
    },
    {
        "content": "<p>Trying to validate Resource using custom StructureDefinition. In MessageDefinition I have reference to custom StructureDefinition (where specified validation rules valid ONLY in the current context). How to validate resource by only 1 (and every time different) StructureDefinition? I see it is \"InMemoryProfileResolver\" in FHIR NET lib, but it is private. So I need to create profile resolvers and validators on a fly (not sure if it is a good solution). Any advice?</p>",
        "id": 230592857,
        "sender_full_name": "Pash",
        "timestamp": 1615929428
    },
    {
        "content": "<p>Should I create my own custom IResourceResolver?</p>",
        "id": 230596466,
        "sender_full_name": "Pash",
        "timestamp": 1615931192
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"352507\">@Pash</span> You can point the validator to use a specific profile to validate against. Here's an example:</p>\n<div class=\"codehilite\" data-code-language=\"C#\"><pre><span></span><code><span class=\"kt\">var</span> <span class=\"n\">source</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">CachedResolver</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"n\">MultiResolver</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"n\">DirectorySource</span><span class=\"p\">(</span><span class=\"s\">@\"MyProfileFolder\"</span><span class=\"p\">,</span>\n                    <span class=\"k\">new</span> <span class=\"nf\">DirectorySourceSettings</span><span class=\"p\">()</span> <span class=\"p\">{</span> <span class=\"n\">IncludeSubDirectories</span> <span class=\"p\">=</span> <span class=\"k\">true</span> <span class=\"p\">}),</span>\n                    <span class=\"n\">ZipSource</span><span class=\"p\">.</span><span class=\"n\">CreateValidationSource</span><span class=\"p\">()));</span>\n\n<span class=\"kt\">var</span> <span class=\"n\">ctx</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">ValidationSettings</span>\n<span class=\"p\">{</span>\n    <span class=\"n\">ResourceResolver</span> <span class=\"p\">=</span> <span class=\"n\">source</span><span class=\"p\">,</span>\n    <span class=\"n\">GenerateSnapshot</span> <span class=\"p\">=</span> <span class=\"k\">true</span><span class=\"p\">,</span>\n<span class=\"p\">};</span>\n<span class=\"kt\">var</span> <span class=\"n\">validator</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Validator</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">);</span>\n\n<span class=\"kt\">var</span> <span class=\"n\">result</span> <span class=\"p\">=</span> <span class=\"n\">validator</span><span class=\"p\">.</span><span class=\"n\">Validate</span><span class=\"p\">(</span><span class=\"n\">pat</span><span class=\"p\">,</span> <span class=\"s\">@\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient\"</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>My example just validates a Patient poco against the US Core Patient profile.<br>\nIf you put all your custom profiles in the folder,  you can expand the last line to validate against a specific profile depending on some determining value.</p>",
        "id": 231462843,
        "sender_full_name": "Mirjam Baltus",
        "timestamp": 1616503389
    },
    {
        "content": "<p>Hi, <br>\nI am using the .net firely library to validate my bundle resource and I get an error on the extenisons - {Text=\"Unable to resolve reference to profile 'http://XXX/patient-code'\"} this is expected in my case as the extensions haven't been published yet. Is there a way to treat these as just warnings. and not error to be able to validate the bundle.</p>",
        "id": 232447985,
        "sender_full_name": "Jeena a",
        "timestamp": 1617119097
    },
    {
        "content": "<p>See my answer here: <a href=\"https://github.com/FirelyTeam/firely-net-sdk/discussions/1675\">https://github.com/FirelyTeam/firely-net-sdk/discussions/1675</a></p>",
        "id": 232601442,
        "sender_full_name": "Marten Smits",
        "timestamp": 1617201063
    }
]