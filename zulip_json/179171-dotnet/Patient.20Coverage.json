[
    {
        "content": "<p>I'm trying to get patient coverage using the following route:</p>\n<p>Header:<br>\nBearer Token &lt;Access Token&gt;<br>\nGET: <a href=\"https://apporchard.epic.com/interconnect-aocurprd-oauth/api/FHIR/R4/Coverage?patient=&lt;patient\">https://apporchard.epic.com/interconnect-aocurprd-oauth/api/FHIR/R4/Coverage?patient=&lt;patient</a> id&gt;</p>\n<p>I was able to get the access token from using the following route:</p>\n<p>POST: <a href=\"https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token\">https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token</a><br>\nBody:<br>\ngrant_type = client_credentials<br>\nclient_assertion_type = urn:ietf:params:oauth:client-assertion-type:jwt-bearer<br>\nclient_assertion = &lt;client assertion token&gt;</p>\n<p>For some reason when I tried calling coverage route, I always get a 401.  The test user I'm using has an Aetena plan.  Is there something I'm missing?</p>",
        "id": 219359360,
        "sender_full_name": "Ger Vang",
        "timestamp": 1607530696
    },
    {
        "content": "<p>I think the problem is that you are using a <a href=\"http://fhir.epic.com\">fhir.epic.com</a> token against an AppOrchard end point - they are two different systems. You should either use the <a href=\"http://fhir.epic.com\">fhir.epic.com</a> end point or get a token from AppOrchard</p>",
        "id": 219361715,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1607531632
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191912\">Michele Mottini</span> <a href=\"#narrow/stream/179171-dotnet/topic/Patient.20Coverage/near/219361715\">said</a>:</p>\n<blockquote>\n<p>I think the problem is that you are using a <a href=\"http://fhir.epic.com\">fhir.epic.com</a> token against an AppOrchard end point - they are two different systems. You should either use the <a href=\"http://fhir.epic.com\">fhir.epic.com</a> end point or get a token from AppOrchard</p>\n</blockquote>\n<p>I don't see an endpoint for patient coverage on <a href=\"http://fhir.epic.com\">fhir.epic.com</a>.  Is there one?  If so, where is the documentation?</p>\n<p>I've looked at <a href=\"https://fhir.epic.com/Specifications?api=1076\">https://fhir.epic.com/Specifications?api=1076</a> but I don't see an endpoint on this page.</p>",
        "id": 219367476,
        "sender_full_name": "Ger Vang",
        "timestamp": 1607534116
    },
    {
        "content": "<p>I don't know - if it does not have Coverage you'll have to get an AppOrchard token</p>",
        "id": 219368591,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1607534578
    },
    {
        "content": "<p>Thanks.  I'll try to look into AppOrchard.</p>",
        "id": 219369634,
        "sender_full_name": "Ger Vang",
        "timestamp": 1607535019
    },
    {
        "content": "<p>Coverage is available in fhir.epic.  You can just use the normal R4 fhir.epic endpoint:  <a href=\"https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Coverage?patient=patientID\">https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Coverage?patient=patientID</a>.  We don't have the \"Try It\" available for it yet, so you won't see the template URL in the Try It utility.</p>",
        "id": 219381564,
        "sender_full_name": "Cooper Thompson",
        "timestamp": 1607540299
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191764\">Cooper Thompson</span> <a href=\"#narrow/stream/179171-dotnet/topic/Patient.20Coverage/near/219381564\">said</a>:</p>\n<blockquote>\n<p>Coverage is available in fhir.epic.  You can just use the normal R4 fhir.epic endpoint:  <a href=\"https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Coverage?patient=patientID\">https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Coverage?patient=patientID</a>.  We don't have the \"Try It\" available for it yet, so you won't see the template URL in the Try It utility.</p>\n</blockquote>\n<p>I tried this but I'm getting a 401 Forbidden.  Could it be a permission issue with the patient profile or my app (backend and patients)?</p>",
        "id": 219397237,
        "sender_full_name": "Ger Vang",
        "timestamp": 1607547739
    },
    {
        "content": "<p>I was able to get the Coverage data from <a href=\"https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Coverage?patient=&lt;patient\">https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Coverage?patient=&lt;patient</a> id&gt; but  I'm having trouble finding the Coverage.SearchResponse model from Hl7.Fhir.Model to map with the response data from <a href=\"https://fhir.epic.com/Specifications?api=1078\">https://fhir.epic.com/Specifications?api=1078</a></p>\n<p>Does anyone know if there is a model I can use or should I just build my own?  I tried using Hl7.Fhir.Model.Coverage but that doesn't work since the properties are different.</p>",
        "id": 220001177,
        "sender_full_name": "Ger Vang",
        "timestamp": 1608048679
    },
    {
        "content": "<p><code> https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Coverage?patient=&lt;patient id&gt;</code> will return a Bundle containing Coverage resources, so you should use Hl7.Fhir.Model.Bundle</p>",
        "id": 220003269,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1608049366
    },
    {
        "content": "<p>I'm getting this error when I try to deserialize the response using Newtonsoft.Json.JsonCovert.</p>\n<p><code>Could not create an instance of type Hl7.Fhir.Model.Resource. Type is an interface or abstract class and cannot be instantiated. Path 'entry[0].resource.resourceType', line 1, position 503.</code></p>\n<p>Could the problem be the Newtonsoft deserializer?</p>\n<div class=\"codehilite\" data-code-language=\"C#\"><pre><span></span><code><span class=\"n\">JsonConvert</span><span class=\"p\">.</span><span class=\"n\">DeserializeObject</span><span class=\"p\">&lt;</span><span class=\"n\">Bundle</span><span class=\"p\">&gt;(</span><span class=\"n\">responseContent</span><span class=\"p\">)</span>\n</code></pre></div>",
        "id": 220006059,
        "sender_full_name": "Ger Vang",
        "timestamp": 1608050357
    },
    {
        "content": "<p>You cannot use Newtonsoft deserializers, use the Hl7.Fhir ones. If you use the client in Fhir .NET library you do not even have to invoke the deserialization manually</p>",
        "id": 220006330,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1608050460
    },
    {
        "content": "<p>That did the trick! Thank you.</p>\n<p>In case someone ran into the same issues as me, here is an example: <br>\n<a href=\"https://stackoverflow.com/questions/49314247/how-to-deserialise-json-to-fhir-valueset-resource-in-net\">https://stackoverflow.com/questions/49314247/how-to-deserialise-json-to-fhir-valueset-resource-in-net</a></p>",
        "id": 220009399,
        "sender_full_name": "Ger Vang",
        "timestamp": 1608051774
    }
]