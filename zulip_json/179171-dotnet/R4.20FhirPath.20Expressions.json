[
    {
        "content": "<p>Has anyone else run into this problem with quite a few R4 search FHIRPath expressions throwing this type of error when using the .NET FhirPath implementation.<br>\n`Invocation of 'binary.|' failed: Invocation of '<a href=\"http://binary.as\" target=\"_blank\" title=\"http://binary.as\">binary.as</a>' failed: Cannot cast from 'collection' to 'any single value'</p>\n<p>An example of this is the Observation search Parameter name: combo-value-concept which has the expression of: </p>\n<p>`(Observation.value as CodeableConcept) | (Observation.component.value as CodeableConcept)'</p>\n<p>It is actually the second part of the 'Or' that makes it fail, this part 'Observation.component.value as CodeableConcept' and <br>\nI think it is because 'Observation.component.value' returns many and many cannot be cast to 'CodeableConcept'.</p>\n<p>A test case that shows this failing is to load this example resource from the spec into a server <a href=\"http://hl7.org/fhir/2018Sep/observation-example-1minute-apgar-score.xml.html\" target=\"_blank\" title=\"http://hl7.org/fhir/2018Sep/observation-example-1minute-apgar-score.xml.html\">http://hl7.org/fhir/2018Sep/observation-example-1minute-apgar-score.xml.html</a> as that example has many Observation components. <br>\nI tried loading that resource into Graham's Server <a href=\"http://test.fhir.org/r4\" target=\"_blank\" title=\"http://test.fhir.org/r4\">http://test.fhir.org/r4</a>, at first I got errors about extensions so I removed all of the extensions found in that resource, then I got a horrible exception. I can only assume due to the same problem I have, maybe.</p>\n<p>What I am struggling with is what is the root problem, I feel like it is the expression its self, not the FHIRPath implementation.</p>\n<p>Has anyone else seen commentary on this problem?</p>",
        "id": 154017078,
        "sender_full_name": "Angus Millar",
        "timestamp": 1541754571
    },
    {
        "content": "<p>Hi Angus - the .NET FhirPath library has not yet been updated to R4. However <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> has helped me out and will send me a PR for this soon.</p>",
        "id": 154019590,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1542642146
    }
]