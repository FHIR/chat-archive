[
    {
        "content": "<p>I am getting the Object reference not set to an instance of an object exception on ExtrapolateMethod when posting Bundle to Spark. Any ideas? </p>\n<p>Here is the exception stack trace, <br>\nSystem.NullReferenceException occurred<br>\n  HResult=0x80004003<br>\n  Message=Object reference not set to an instance of an object.<br>\n  Source=Spark.Engine<br>\n  StackTrace:<br>\n   at Spark.Engine.Extensions.EntryExtensions.ExtrapolateMethod(ILocalhost localhost, EntryComponent entry, IKey key) in C:\\git\\sparkdevelop2\\src\\Spark.Engine\\Extensions\\InteractionExtensions.cs:line 50<br>\n   at Spark.Engine.Service.FhirServiceExtensions.ResourceManipulationOperationFactory.GetManipulationOperation(EntryComponent entryComponent, ILocalhost localhost, ISearchService service) in C:\\git\\sparkdevelop2\\src\\Spark.Engine\\Service\\FhirServiceExtensions\\ResourceManipulationOperationFactory.cs:line 62<br>\n   at Spark.Engine.Service.FhirServiceExtensions.TransactionService.&lt;HandleTransaction&gt;b__9_0(EntryComponent e) in C:\\git\\sparkdevelop2\\src\\Spark.Engine\\Service\\FhirServiceExtensions\\TransactionService.cs:line 105<br>\n   at Spark.Engine.Service.FhirServiceExtensions.TransactionService.HandleTransaction(Bundle bundle, IInteractionHandler interactionHandler) in C:\\git\\sparkdevelop2\\src\\Spark.Engine\\Service\\FhirServiceExtensions\\TransactionService.cs:line 105<br>\n   at Spark.Engine.Service.FhirService.Transaction(Bundle bundle) in C:\\git\\sparkdevelop2\\src\\Spark.Engine\\Service\\FhirService.cs:line 314<br>\n   at Spark.Controllers.FhirController.Transaction(Bundle bundle) in C:\\git\\sparkdevelop2\\src\\Spark\\Controllers\\FhirController.cs:line 175<br>\n   at System.Web.Http.Controllers.ReflectedHttpActionDescriptor.ActionExecutor.&lt;&gt;c__DisplayClass10.&lt;GetExecutor&gt;b__9(Object instance, Object[] methodParameters)<br>\n   at System.Web.Http.Controllers.ReflectedHttpActionDescriptor.ExecuteAsync(HttpControllerContext controllerContext, IDictionary`2 arguments, CancellationToken cancellationToken)</p>\n<p>And here is my xml body for the post request to Spark server:</p>\n<p>&lt;Bundle xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\" xmlns:xsi=\"<a href=\"http://www.w3.org/2001/XMLSchema-instance\" target=\"_blank\" title=\"http://www.w3.org/2001/XMLSchema-instance\">http://www.w3.org/2001/XMLSchema-instance</a>\"&gt;<br>\n    &lt;type value=\"collection\"/&gt;<br>\n    &lt;entry&gt;<br>\n        &lt;resource&gt;<br>\n            &lt;Patient&gt;<br>\n                &lt;id value=\"PID-patient-identification\"/&gt;<br>\n                &lt;text&gt;<br>\n                    &lt;status value=\"generated\"/&gt;<br>\n                    &lt;xhtml:div xmlns:xhtml=\"<a href=\"http://www.w3.org/1999/xhtml\" target=\"_blank\" title=\"http://www.w3.org/1999/xhtml\">http://www.w3.org/1999/xhtml</a>\"&gt;<br>\n                        &lt;p class=\"L\"&gt;FASTING:NO&lt;/p&gt;<br>\n                    &lt;/xhtml:div&gt;<br>\n                &lt;/text&gt;<br>\n                &lt;identifier&gt;<br>\n                    &lt;use value=\"official\"/&gt;<br>\n                    &lt;type&gt;<br>\n                        &lt;coding&gt;<br>\n                            &lt;code value=\"PT\"/&gt;<br>\n                        &lt;/coding&gt;<br>\n                    &lt;/type&gt;<br>\n                    &lt;value value=\"\"/&gt;<br>\n                &lt;/identifier&gt;<br>\n                &lt;name&gt;<br>\n                    &lt;use value=\"official\"/&gt;<br>\n                    &lt;family value=\"\"/&gt;<br>\n                &lt;/name&gt;<br>\n                &lt;telecom&gt;<br>\n                    &lt;system value=\"phone\"/&gt;<br>\n                    &lt;value value=\"\"/&gt;<br>\n                    &lt;use value=\"home\"/&gt;<br>\n                &lt;/telecom&gt;<br>\n                &lt;gender value=\"female\"/&gt;<br>\n                &lt;birthDate value=\"\"/&gt;<br>\n                &lt;address&gt;<br>\n                    &lt;use value=\"home\"/&gt;<br>\n                &lt;/address&gt;<br>\n            &lt;/Patient&gt;<br>\n        &lt;/resource&gt;<br>\n    &lt;/entry&gt;<br>\n&lt;/Bundle&gt;</p>\n<p>I went to <a href=\"http://fhirtest.uhn.ca/create\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/create\">http://fhirtest.uhn.ca/create</a> to test the same above message. When I did a create, got a 201 Success response.<br>\nAny ideas?</p>\n<p>Thanks<br>\nSantosh Jami</p>",
        "id": 153898188,
        "sender_full_name": "Santosh Jami",
        "timestamp": 1501029853
    },
    {
        "content": "<p>I don't know what is going here as far as the error is concerned, however the SPARK server is DSTU2, and the HAPI server at the address you provided is an SUT3 server.<br>\nCan't spot anything in that bundle that looks nasty.<br>\n(Validation on the empty strings must have been suppressed and ignored)<br>\nA pretty sparse Patient example, assuming you weren't after comments on the content of the resource itself...</p>",
        "id": 153898191,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1501031746
    },
    {
        "content": "<p>Thanks Brian.I selected DSTU2 for hapi. Have you posted any successful bundle to Spark or may be point me where I can get a test bundle message to post to Spark and test it?</p>",
        "id": 153898192,
        "sender_full_name": "Santosh Jami",
        "timestamp": 1501031984
    },
    {
        "content": "<p>I posted this example that I got from github,  <a href=\"https://github.com/ewoutkramer/fhir-net-api/blob/7bf0863b2a7ef061cde1f05e80359d5f23f4681a/src/Hl7.Fhir.Specification.Tests/TestData/grahame-validation-examples/bundle-good.xml\" target=\"_blank\" title=\"https://github.com/ewoutkramer/fhir-net-api/blob/7bf0863b2a7ef061cde1f05e80359d5f23f4681a/src/Hl7.Fhir.Specification.Tests/TestData/grahame-validation-examples/bundle-good.xml\">https://github.com/ewoutkramer/fhir-net-api/blob/7bf0863b2a7ef061cde1f05e80359d5f23f4681a/src/Hl7.Fhir.Specification.Tests/TestData/grahame-validation-examples/bundle-good.xml</a><br>\nThe end point I hit was <a href=\"http://spark.furore.com/fhir\" target=\"_blank\" title=\"http://spark.furore.com/fhir\">http://spark.furore.com/fhir</a><br>\nBut got same exception - Am I missing somethins? AM sure the bundles are tested on Spark. </p>\n<p>{<br>\n  \"resourceType\": \"Bundle\",<br>\n  \"id\": \"bundle\",<br>\n  \"type\": \"collection\",<br>\n  \"entry\": [<br>\n    {<br>\n      \"fullUrl\": \"<a href=\"http://acme.com/Patient/pat1\" target=\"_blank\" title=\"http://acme.com/Patient/pat1\">http://acme.com/Patient/pat1</a>\",<br>\n      \"resource\": {<br>\n          \"resourceType\": \"Patient\",<br>\n          \"id\" : \"pat1\",<br>\n          \"link\" : {<br>\n            \"type\" : \"refer\",<br>\n            \"other\" : {<br>\n              \"reference\" : \"Patient/pat2\"<br>\n            }<br>\n          }<br>\n        }<br>\n    },<br>\n    {<br>\n      \"fullUrl\": \"<a href=\"http://acme.com/Patient/pat2\" target=\"_blank\" title=\"http://acme.com/Patient/pat2\">http://acme.com/Patient/pat2</a>\",<br>\n      \"resource\": {<br>\n        \"resourceType\": \"Patient\",<br>\n        \"id\" : \"pat1\"<br>\n      }<br>\n    }<br>\n  ]<br>\n}</p>",
        "id": 153898194,
        "sender_full_name": "Santosh Jami",
        "timestamp": 1501032368
    },
    {
        "content": "<p>I haven't actively been working with spark for some time as we have our own implementation, so sorry can't ad much more for now.</p>",
        "id": 153898198,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1501034797
    },
    {
        "content": "<p>You can get the code from github and debug it yourself though ;)</p>",
        "id": 153898199,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1501034797
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> . Looking at the code, I found there is a null check missing in the code,<br>\n  return entry.Request.Method ?? DetermineMethod(localhost, key);<br>\nmy entry.Request is null, entry.Request.Method always fails</p>",
        "id": 153898201,
        "sender_full_name": "Santosh Jami",
        "timestamp": 1501035033
    },
    {
        "content": "<p>Yup, looks like a bug.<br>\nYou could either fix it and make a pull request, or just add the data in your submitted bundle ;)</p>",
        "id": 153898205,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1501038212
    }
]