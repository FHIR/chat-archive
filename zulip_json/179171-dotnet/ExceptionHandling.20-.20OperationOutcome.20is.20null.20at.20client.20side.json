[
    {
        "content": "<p>We're using the Hl7.DSTU2.Core version 0.90.6.26409</p>\n<p>When an exception response is sent from the server, we are currently experiencing that the client gets an OperationOutcome which is null. We can see in fiddler that there is an OperationOutcome object sent with the exception, so it must be on the client side. Is there a setting or something we should be aware of?</p>\n<p>Currently we're only using the DSTU2 client for integrationtests, however, the tests will be used by third parties as examples of how to communicate with our implementation of a given service with the client.</p>\n<p>Query which will fail:</p>\n<div class=\"codehilite\"><pre> [Test]\n    public void ThisTest_WillHaveAnException()\n    {\n        var url = &quot;http://fhirtest.uhn.ca/baseDstu2/&quot;;\n        var uri = new Uri(url);\n        var _client = new FhirClient(uri);\n\n        var searchParams = new SearchParams();\n        searchParams.Add(&quot;bogus&quot;, &quot;dude&quot;);\n        var result = Assert.Throws&lt;FhirOperationException&gt;(() =&gt; _client.Search&lt;CommunicationRequest&gt;(searchParams));\n\n        Assert.IsTrue(result.Outcome != null, &quot;Why is this null?&quot;);\n    }\n</pre></div>\n\n\n<p>The result will contain an error, however the result.OperationOutcome will be null.</p>\n<p>Anyone else experienced this? Are we using the exceptionhandling wrong on the client side?</p>",
        "id": 153847008,
        "sender_full_name": "Harald Sømnes Hanssen",
        "timestamp": 1473685175
    },
    {
        "content": "<p>What you are doing is mostly right.<br>\nThe return type of the Search is a Bindle, so can't be an OperationOutcome too.<br>\nTo get the operation outcome from the failed call you need to:<br>\n<code>OperationOutcome operationOutcome = client.LastBodyAsResource as OperationOutcome;</code></p>",
        "id": 153847133,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1473718764
    },
    {
        "content": "<p>Updated the code, but the OperationOutcome is still null when we add your snippet. So something is odd.</p>\n<div class=\"codehilite\"><pre>  [Test]\n    public void ThisTest_WillHaveAnException()\n    {\n        var url = &quot;http://fhirtest.uhn.ca/baseDstu2/&quot;;\n        var uri = new Uri(url);\n        var _client = new FhirClient(uri);\n\n        var searchParams = new SearchParams();\n        searchParams.Add(&quot;bogus&quot;, &quot;dude&quot;);\n        var result = Assert.Throws&lt;FhirOperationException&gt;(() =&gt; _client.Search&lt;CommunicationRequest&gt;(searchParams));\n        var operationOutcome = _client.LastBodyAsResource as OperationOutcome;\n\n        Assert.IsTrue(operationOutcome != null, &quot;Why is this null?&quot;);\n        var json = JsonConvert.SerializeObject(operationOutcome);\n\n        Console.WriteLine(json);\n    }\n</pre></div>\n\n\n<p>Edit: I think I found the culprit. It is the client. The dstu2 core version we are using due to be compatible with Sparks.Engine, has some bugs which aren't critical on the server side, however, on the client side it is differently. As soon as I updated from alpha-1 to alpha-5, the operationoutcome isn't null anymore.</p>",
        "id": 153847151,
        "sender_full_name": "Harald Sømnes Hanssen",
        "timestamp": 1473750590
    },
    {
        "content": "<p>Yes, there were some issues with the older versions.<br>\nThat latest prerelease is pretty good.<br>\n(and assuming you mean the fhirclient rather than spark.engine)</p>",
        "id": 153847152,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1473751239
    },
    {
        "content": "<p>Yeah, I'm talking about the fhirclient (or HL7.DSTU2.Core)</p>\n<p>I'm hoping that the spark.engine will be updated soon since there are a lot of breaking changes with the new core. My project uses spark.engine for some of the functionality. Luckily consumers of the FHIR server endpoint do not have to depend on the alpha-1 release of the core.</p>",
        "id": 153847185,
        "sender_full_name": "Harald Sømnes Hanssen",
        "timestamp": 1473755393
    },
    {
        "content": "<p>Yes, my server needed quite a bit of updating too.<br>\nStill haven't pushed an updated version public yet either.</p>",
        "id": 153847186,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1473755603
    },
    {
        "content": "<p>(Though I have pushed my STU3 version today - complete with some Fluentpath new additions)</p>",
        "id": 153847187,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1473755658
    }
]