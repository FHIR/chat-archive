[
    {
        "content": "<p>I am discovering that I have some excessive memory usage related to the fhir-net-api. Has anyone else experienced this? Are there specific things I should be doing to \"finish\" using the fhir-net-api (dispose the objects, or send them to the gc)?</p>",
        "id": 153879203,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490206534
    },
    {
        "content": "<p>Do you have any more details on this?<br>\nI've done a lot of testing with it and haven't experienced the issue in my server.<br>\nAnd the unit tests that run over all the examples don't exhibit the issues.</p>",
        "id": 153879237,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1490215378
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191505\">@Sean McIlvenna</span> Forge is using the FHIR .NET API and I haven't noticed any excessive memory usage. Can you provide some more details?</p>",
        "id": 153879473,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490261202
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/0_pIzvxV2WCVud9P9y05UAHc/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/0_pIzvxV2WCVud9P9y05UAHc/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\"><img src=\"/user_uploads/10155/0_pIzvxV2WCVud9P9y05UAHc/pasted_image.png\"></a></div>",
        "id": 153879505,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490280521
    },
    {
        "content": "<p>Both of these represent data being used by fhir-net-api.<br>\nThis seems to be just upon loading the application, not having done any work serializing or deserializing Fhir models yet</p>",
        "id": 153879506,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490280621
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/nzdasubqrSaD-JBqDTs00e7M/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/nzdasubqrSaD-JBqDTs00e7M/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\"><img src=\"/user_uploads/10155/nzdasubqrSaD-JBqDTs00e7M/pasted_image.png\"></a></div>",
        "id": 153879507,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490280778
    },
    {
        "content": "<p>The first relating to left-over instances of String<br>\nThe second relating to left-over instances of Dictionary&lt;string, Object&gt;</p>",
        "id": 153879508,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490280806
    },
    {
        "content": "<p>Interesting analysis, what tool are you using? I assume the initial memory pressure is the result of loading the FHIR models from specification.zip.</p>",
        "id": 153879509,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490281108
    },
    {
        "content": "<p>ANT Memory Profiler</p>",
        "id": 153879510,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490281138
    },
    {
        "content": "<p>ANTS Memory Profiler</p>",
        "id": 153879511,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490281144
    },
    {
        "content": "<p>Have had some memory issues as of recently... Trying to nail them down. May not be related to fhir-net-api at all, but this is what I'm seeing in the profiles, so far</p>",
        "id": 153879512,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490281185
    },
    {
        "content": "<p>ok, we don't have that tool so I can't repeat your analysis.</p>",
        "id": 153879513,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490281186
    },
    {
        "content": "<p>Wondering what am I looking at? Are these live objects? Or are they ready to be collected?</p>",
        "id": 153879515,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490281226
    },
    {
        "content": "<p>It appears that they ARE collected</p>",
        "id": 153879519,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490281667
    },
    {
        "content": "<p>but they are causing .NET to reserve a ton of memory</p>",
        "id": 153879521,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490281684
    },
    {
        "content": "<p>Hmm... I'd be more than interested to work together and try to improve this. Currently our dev team is consumed by STU3 update. But I'd love to get back on this.</p>",
        "id": 153879522,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490281806
    },
    {
        "content": "<p>Hi Sean, can you tell me what you were doing?   Was this in the STU3 or DSTU2 version? Do you know whether this is recent?</p>",
        "id": 153879527,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1490282189
    },
    {
        "content": "<p>ok... well, I realize just now that I DO load all profiles at application start so that I don't have to do it mid-request</p>",
        "id": 153879528,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490282264
    },
    {
        "content": "<p>hmmm, might have to re-think that</p>",
        "id": 153879529,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490282271
    },
    {
        "content": "<p>STU3, btw Ewout</p>",
        "id": 153879532,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490282407
    },
    {
        "content": "<p>Interesting - STU3 is in alpha but should not really (yet) differ in behaviour. Obviously, it has not been tested in production as far as I know, so keep us in the loop if you find something suspicious.  Yes, reading all SDs from profiles-others for example would create quite some objects...</p>",
        "id": 153879537,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1490283810
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191505\">@Sean McIlvenna</span> , I'm wondering what the black dictionary instances in the right column (2nd picture) represent. Can you expand them and/or provide some more details?</p>",
        "id": 153879538,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490284303
    },
    {
        "content": "<p>I tried expanding them, and it didn't show what they contain, or any other helpful info, for that matter</p>",
        "id": 153879539,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490284375
    },
    {
        "content": "<p>=[</p>",
        "id": 153879540,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490284376
    },
    {
        "content": "<p>I think my problem is entirely related to the fact that I'm pre-loading all STU3 profiles</p>",
        "id": 153879541,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490284393
    },
    {
        "content": "<p>I'm working on altering my logic now to separate out all the profiles into individual xml files, and then load each one as I need them</p>",
        "id": 153879542,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490284417
    },
    {
        "content": "<p>not pre-loading them seems to have saved myself about 200mb</p>",
        "id": 153879543,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490284437
    },
    {
        "content": "<p>I take it fhir-net-api STU3 is still not released to nuget?</p>",
        "id": 153879545,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490286566
    },
    {
        "content": "<p>couldn't find it, at least</p>",
        "id": 153879546,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490286571
    },
    {
        "content": "<p><a href=\"https://www.nuget.org/packages/Hl7.Fhir.STU3/0.93.0-alpha1\" target=\"_blank\" title=\"https://www.nuget.org/packages/Hl7.Fhir.STU3/0.93.0-alpha1\">https://www.nuget.org/packages/Hl7.Fhir.STU3/0.93.0-alpha1</a></p>",
        "id": 153879549,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490286925
    },
    {
        "content": "<p>Hey Sean, yes, and since all profiles carry a *huge* snapshot version, this will result in zillions of objects....</p>",
        "id": 153879552,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1490290150
    },
    {
        "content": "<p>There is a cached resolver that just caches what you need, maybe that would work?</p>",
        "id": 153879553,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1490290176
    },
    {
        "content": "<p>Is that representative of the develop-stu3 branch?</p>",
        "id": 153879599,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490303117
    },
    {
        "content": "<p>0.93.0-alpha1</p>",
        "id": 153879600,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1490303152
    },
    {
        "content": "<p>Just a note on what you loaded in Sean, you might want to trash teh narratives from those resources as they come in if you don't need them as they are quite large according to the info you have there.</p>",
        "id": 153879691,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1490334938
    },
    {
        "content": "<p>or depending on where you got them from (local disk?) can you remove them from your source so doesn't even get serialized too.</p>",
        "id": 153879692,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1490334971
    }
]