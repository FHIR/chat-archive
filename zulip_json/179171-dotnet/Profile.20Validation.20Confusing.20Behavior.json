[
    {
        "content": "<p>I have four custom StructureDefinitions  in my DirectorySource</p>\n<p>1. PkPatient.StructureDefinition.xml (has extension PkCnic.StructureDefinition.xml with cardinality 1..1 )<br>\n2. PkCnic.StructureDefinition.xml<br>\n3. UsPatient.StructureDefinition.xml (has extension UsSsn.StructureDefinition.xml  with cardinality 1..1 )<br>\n4. UsSsn.StructureDefinition.xml          <br>\nISSUE:<br>\n1. PkPatient profile is in the meta of patient resource<br>\n2. PkCnic extension is in the patient resource<br>\n3. But the validation result of the patient resource is with UsPatient profile is \"OVERALL SUCCESS\"<br>\n4. Why this is giving me success result? while validating with UsPatient profile? I have never added UsSsn extention in the patient resource<br>\n5. It shouldn't give a validation error?<br>\nhere is my code</p>\n<div class=\"codehilite\"><pre><span></span>        Patient patient = new Patient();\n        patient.Meta = new Meta\n        {\n            Profile = new List&lt;string&gt;\n            {\n                &quot;http://example.org/fhir/StructureDefinition/PkPatient&quot;\n            }\n        };\n        patient.Id = &quot;1&quot;;\n        patient.Gender = AdministrativeGender.Male;\n        patient.Active = true;\n        HumanName hn = new HumanName();\n        hn.Family = &quot;Jhon&quot;;\n        hn.Given = new List&lt;string&gt; { &quot;Doe&quot; };\n        patient.Name.Add(hn);\n        patient.AddExtension(&quot;http://example.org/fhir/StructureDefinition/PkCnic&quot;, new FhirString(&quot;123456789&quot;));\n\n\n\n        ZipSource zipSource = new ZipSource(&quot;&lt;path&gt;\\\\specification.zip&quot;); \n        DirectorySource directorySource = new DirectorySource(&quot;&lt;path&gt;&quot;); // FOLDER CONTAINS CUSTOM STRUCTURE DEFINITIONS\n\n\n        Validator validator = new Validator(new ValidationSettings\n        {\n            ResourceResolver = new MultiResolver(zipSource, directorySource)\n        });\n\n\n        OperationOutcome operationOutcome = validator.Validate(patient, &quot;http://example.org/fhir/StructureDefinition/UsPatient&quot;);\n</pre></div>",
        "id": 173900535,
        "sender_full_name": "Muhammad Abubakar Ikram",
        "timestamp": 1566493382
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> ?</p>",
        "id": 173953488,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1566551218
    },
    {
        "content": "<p>Any update?</p>",
        "id": 174888563,
        "sender_full_name": "Muhammad Abubakar Ikram",
        "timestamp": 1567608271
    },
    {
        "content": "<p>So my understanding is as follows:</p>\n<ul>\n<li>\n<p>Extensions are by default permitted anywhere within a profile even if not explicitly added. When validation occurs as long as the profile for any extensions used can be located then the validation will happen.</p>\n</li>\n<li>\n<p>By explicitly adding an extension to the profile, you can choose to make extensions mandatory etc and it is probably good practice but if they are optional you don't need to do so.</p>\n</li>\n</ul>\n<p>Slightly different question but this may help <a href=\"#narrow/stream/179175-argonaut/topic/Extensions.20.26.20Profiles\" title=\"#narrow/stream/179175-argonaut/topic/Extensions.20.26.20Profiles\">https://chat.fhir.org/#narrow/stream/179175-argonaut/topic/Extensions.20.26.20Profiles</a></p>",
        "id": 174900270,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1567615970
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> I understand that extensions are permitted without the inclusion of profile in the meta.</p>\n<p>What I am curious about is, that I am getting validation success against the profile whose mandatory extension (1..1) is not included in the resource!</p>\n<p>Why validation success if the extension is specified mandatory in the profile but not included in the resource?</p>",
        "id": 175372305,
        "sender_full_name": "Muhammad Abubakar Ikram",
        "timestamp": 1568145183
    },
    {
        "content": "<p>Sounds like you found a bug. Could you submit an issue to:<br>\n<a href=\"https://github.com/FirelyTeam/fhir-net-api/issues/\" target=\"_blank\" title=\"https://github.com/FirelyTeam/fhir-net-api/issues/\">https://github.com/FirelyTeam/fhir-net-api/issues/</a><br>\nPlease attach the profile &amp; extension if possible, so we can reproduce the issue.</p>",
        "id": 175518971,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1568286965
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> <br>\n<span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> </p>\n<p>UPDATE:</p>\n<p>I got the expected result. </p>\n<p>This is how I got the expected result.</p>\n<p>I was just constraining the cardinality inside the extension structureDefinition and in the patient structureDefinition for the extension.</p>\n<p>I also had to check the \"Must Support\" attribute for the value[x] of the extension inside the custom patient profile.</p>\n<p>now it is giving me error of cardinality that there must be  (1..1 something.........) this is what I was expecting.</p>\n<p>if for making an extension mandatory we must have to check the \"Must Support\" for the value[x] then this is not bug.</p>\n<p>If only setting the cardinality is the requirement for making mandatory extension then it is bug.</p>\n<p>Now please review the situation.</p>",
        "id": 175519237,
        "sender_full_name": "Muhammad Abubakar Ikram",
        "timestamp": 1568287285
    },
    {
        "content": "<p>MustSupport is separate from cardinality, one constraint should not affect validation of the other.</p>",
        "id": 175519336,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1568287390
    },
    {
        "content": "<p>Still sounds like a bug</p>",
        "id": 175519342,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1568287399
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> alright I will post the issue.</p>\n<p>yes for sure I'll attach the profiles so you can reproduce the issue.</p>\n<p>I was just playing around the FHIR profiling. So these are just testing profiles.</p>",
        "id": 175519488,
        "sender_full_name": "Muhammad Abubakar Ikram",
        "timestamp": 1568287548
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span>  here is the issue <br>\n<a href=\"https://github.com/FirelyTeam/fhir-net-api/issues/1109\" target=\"_blank\" title=\"https://github.com/FirelyTeam/fhir-net-api/issues/1109\">https://github.com/FirelyTeam/fhir-net-api/issues/1109</a></p>",
        "id": 175521790,
        "sender_full_name": "Muhammad Abubakar Ikram",
        "timestamp": 1568289712
    },
    {
        "content": "<p>Well, I've had a play with the code supplied and I'm stumped....</p>",
        "id": 175534478,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1568298683
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"193100\">@Muhammad Abubakar</span> for the clear bug description you created.</p>",
        "id": 175547778,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1568307121
    },
    {
        "content": "<p>Welcome, I would be happy if some little contribution from my side can help us all.</p>",
        "id": 175551066,
        "sender_full_name": "Muhammad Abubakar Ikram",
        "timestamp": 1568309259
    }
]