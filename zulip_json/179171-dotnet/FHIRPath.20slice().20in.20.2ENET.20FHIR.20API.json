[
    {
        "content": "<p>Hello!</p>\n<p>We found the slice() function implementation missing in current .NET FHIR API, and are attempting to write our own. We found we can add to the DefaultSymbolTable that is declared public on FhirPathCompiler. In principle, it should be possible to add any custom function this way.</p>\n<p>However, implementing slice() requires that the code handling this function call would have access to the path within the context resource of the element on which the function is being called. For example, say, we're evaluating \"Observation.component.slice('<a href=\"http://profileUrl\">http://profileUrl</a>', 'systolic').value\". The callback behind the slice() would need to resolve the StructureDefinition by its url, then navigate to the element id given by current resource path at the point of invocation (in this case, \"Observation.component\"), then read its slicing definition and locate the necessary child node of the context resource based on discriminator.</p>\n<p>Is there any way in current .NET FHIR API to access current context element path from within the delegate implementing a fhirpath function? So far my understanding there isn't, and it would require modifications to the library itself. Is this one of the reasons why slice() wasn't implemented yet, unlike all the other functions?</p>",
        "id": 240855004,
        "sender_full_name": "Vladimir Smirnov",
        "timestamp": 1622481014
    },
    {
        "content": "<p>The reason it's not implemented as there are multiple ways to do it, and specifically as it reaches outside the instance.<br>\nThe path is available to the instance through the wrapper classes and interfaces that the fhirpath engine uses.<br>\nI'll have to go look it up to work it out.<br>\nI've done this for several other things in the fhirpathtester app.</p>",
        "id": 240874962,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1622498696
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> thank you for reference to fhirpath tester! We looked up in your code, and turns out fhirpath function delegates operate on instances of ITypedElement, which has the property Location containing current element path.</p>",
        "id": 240920507,
        "sender_full_name": "Vladimir Smirnov",
        "timestamp": 1622542340
    },
    {
        "content": "<p>Yup, that's exactly right.<br>\nYou can also see how I added some other functions in there like short path and commonpath for some custom stuff for myself.</p>",
        "id": 240926416,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1622546221
    }
]