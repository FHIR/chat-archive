[
    {
        "content": "<p>Marc Riding   <br>\n12:01 PM</p>\n<p></p>\n<p> </p>\n<p>--- Moved from &lt;Implementers&gt;</p>\n<p>Hi Guys,</p>\n<p>I am really struggling here, any tutorials on using the hl7.fhir .net libs would be greatly appreciated.</p>\n<p>Like I said, I am trying to construct something like <a href=\"https://nhsconnect.github.io/ITK-FHIR-Mental-Health-eDischarge/engage_jon_burrows.html\" target=\"_blank\" title=\"https://nhsconnect.github.io/ITK-FHIR-Mental-Health-eDischarge/engage_jon_burrows.html\">https://nhsconnect.github.io/ITK-FHIR-Mental-Health-eDischarge/engage_jon_burrows.html</a> </p>\n<p>Just really confusing how to go about constructing this xml. Am really disappointed the nhs has just dropped us off at the deep end. Is anyone else going through the same thing ?<br>\nEwout Kramer: Hi @Marc Riding, here is a link to the docs for the C# FHIR API: <a href=\"http://docs.simplifier.net/fhirnetapi/index.html\" target=\"_blank\" title=\"http://docs.simplifier.net/fhirnetapi/index.html\">http://docs.simplifier.net/fhirnetapi/index.html</a></p>\n<hr>\n<p>Martijn Harthoorn: Hi Marc, You probably need something like this:</p>\n<p>var eoc = new EpisodeOfCare();<br>\n // add fields / data to the resource</p>\n<p>var bundle = new Bundle();<br>\n bundle.Entry.Add(new Bundle.EntryComponent { Resource = eoc });</p>\n<hr>\n<p>Ewout Kramer: If you have more questions on how to use it, join us at the #net stream.</p>\n<hr>\n<p>Thanks for the help guys, really appreciate it, I will plod on using trial and error for now, I am making some progress, but very slow. Reminds me of when I first learnt to program, that sort of pace!</p>\n<p>Thanks again</p>",
        "id": 154011396,
        "sender_full_name": "Marc Riding",
        "timestamp": 1540300475
    },
    {
        "content": "<p>I have got the following code working:</p>\n<div class=\"codehilite\"><pre><span></span>    &#39;&#39; Create patient resource object.\n    Dim myPat As Hl7.Fhir.Model.Patient\n    myPat = New Hl7.Fhir.Model.Patient()\n    myPat.BirthDate = &quot;31/01/2001&quot;\n\n    &#39;&#39; Create Name resource object.\n    Dim myHumanName = New HumanName()\n    myHumanName.Given = New String() {&quot;Marc&quot;}\n    myHumanName.Family = &quot;Riding&quot;\n    myHumanName.Prefix = New String() {&quot;Mr&quot;}\n\n    &#39;&#39; Create Address resource object.\n    Dim myAddr = New Address\n    myAddr.Text = &quot;addrText1&quot;\n\n    &#39;&#39; Add name &amp; addr to patient object\n    myPat.Name.Add(myHumanName)\n    myPat.Address.Add(myAddr)\n\n    &#39;&#39; Create bundle object, add pat to bundle.\n    Dim myBundle As New Bundle()\n    myBundle.AddResourceEntry(myPat, &quot;url0001&quot;)\n\n    &#39;&#39; Dim myAdmitSection As New Composition.SectionComponent\n    &#39;&#39; myAdmitSection.Title = &quot;Admission Details&quot;\n\n    &#39;&#39; Dim myComposition As New Composition\n    &#39;&#39; myComposition.Section.Add(myAdmitSection)\n\n    &#39;&#39; myBundle.AddResourceEntry(myComposition)\n\n    &#39;&#39; Serialize bundle to xml.\n    Dim serializer As New FhirXmlSerializer()\n    Dim rawxml = New FhirXmlSerializer().SerializeToString(myBundle)\n\n    TextBox1.Text = rawxml\n</pre></div>\n\n\n<p>... This is producing the following XML:<br>\n&lt;Bundle xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n    &lt;entry&gt;<br>\n        &lt;fullUrl value=\"url0001\" /&gt;<br>\n        &lt;resource&gt;<br>\n            &lt;Patient&gt;<br>\n                &lt;name&gt;<br>\n                    &lt;family value=\"Riding\" /&gt;<br>\n                    &lt;given value=\"Marc\" /&gt;<br>\n                    &lt;prefix value=\"Mr\" /&gt;<br>\n                &lt;/name&gt;<br>\n                &lt;birthDate value=\"31/01/2001\" /&gt;<br>\n                &lt;address&gt;<br>\n                    &lt;text value=\"addrText1\" /&gt;<br>\n                &lt;/address&gt;<br>\n            &lt;/Patient&gt;<br>\n        &lt;/resource&gt;<br>\n    &lt;/entry&gt;<br>\n&lt;/Bundle&gt;</p>\n<p>So I am making some progress, any hints on how to create the Composition and the slice(\"Admission Details\") ? - the section I have that's commented is not working.</p>\n<p>Marc</p>",
        "id": 154011397,
        "sender_full_name": "Marc Riding",
        "timestamp": 1540301448
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Dim composition  = new Hl7.Fhir.Model.Composition()\n&#39;&#39; assign composition properties\n&#39;&#39; add section\nDim adSection = new Hl7.Fhir.Model.Composition.SectionComponent()\nadSection.Title = &quot;Admission Details&quot;\n&#39;&#39;  add other section properties\n&#39;&#39; add adSection to composition\ncomposition.Section.Add(adSection )\n</pre></div>",
        "id": 154011403,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1540303532
    },
    {
        "content": "<p>Hi Yunwei, </p>\n<p>thanks for the reply buddy, do you know hew to add the composition to the Bundle ?</p>",
        "id": 154011405,
        "sender_full_name": "Marc Riding",
        "timestamp": 1540304240
    },
    {
        "content": "<p>The same as you added patient. Add composition as a resource entry to bundle</p>\n<div class=\"codehilite\"><pre><span></span>myBundle.addResourceEntry(composition, null)\n</pre></div>",
        "id": 154011410,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1540305486
    },
    {
        "content": "<p>Thanks again Yunwei, I was missing the URL param, thought I was getting a type error.</p>",
        "id": 154011424,
        "sender_full_name": "Marc Riding",
        "timestamp": 1540306702
    },
    {
        "content": "<p>Hi guys,</p>\n<p>Making good progress with things, got most of the eDischarge sections created and added to the bundle.</p>\n<p>Wonder if anyone can advise me on creating a custom (NHS) resource/profile. </p>\n<p>Below is what the example xml should come out like , so should I just construct it by hand using xml literals in .net ? or is there a more programmatical method to create these careConnect/NHS-specific entries ?</p>\n<div class=\"codehilite\"><pre><span></span>&lt;entry&gt;\n    &lt;fullUrl value=&quot;urn:uuid:f8deaa1e-62ac-41cb-a475-9df3ea737a8e&quot;/&gt;\n    &lt;resource&gt;\n        &lt;AllergyIntolerance&gt;\n            &lt;id value=&quot;f8deaa1e-62ac-41cb-a475-9df3ea737a8e&quot;/&gt;\n            &lt;meta&gt;\n                &lt;profile value=&quot;https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-AllergyIntolerance-1&quot;/&gt;\n            &lt;/meta&gt;\n            &lt;identifier&gt;\n                &lt;system value=&quot;https://tools.ietf.org/html/rfc4122&quot;/&gt;\n                &lt;value value=&quot;17faf6c5-2897-458d-9893-3428c755fffb&quot;/&gt;\n            &lt;/identifier&gt;\n            &lt;clinicalStatus value=&quot;active&quot;/&gt;\n            &lt;verificationStatus value=&quot;confirmed&quot;/&gt;\n            &lt;category value=&quot;food&quot;/&gt;\n            &lt;code&gt;\n                &lt;coding&gt;\n                    &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;\n                    &lt;code value=&quot;256349002&quot;/&gt;\n                    &lt;display value=&quot;Peanut - dietary&quot;/&gt;\n                &lt;/coding&gt;\n            &lt;/code&gt;\n            &lt;patient&gt;\n                &lt;reference value=&quot;urn:uuid:f919dedc-3c62-462f-a171-8d86c5aaa074&quot;/&gt;\n            &lt;/patient&gt;\n            &lt;assertedDate value=&quot;2015-03-13&quot;/&gt;\n            &lt;reaction&gt;\n                &lt;manifestation&gt;\n                    &lt;coding&gt;\n                        &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;\n                        &lt;code value=&quot;247472004&quot;/&gt;\n                        &lt;display value=&quot;Weal&quot;/&gt;\n                    &lt;/coding&gt;\n                &lt;/manifestation&gt;\n            &lt;/reaction&gt;\n        &lt;/AllergyIntolerance&gt;\n    &lt;/resource&gt;\n&lt;/entry&gt;\n</pre></div>",
        "id": 154012338,
        "sender_full_name": "Marc Riding",
        "timestamp": 1540546950
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"196741\">@Marc Riding</span>, you can easily create resource instances programmatically using the PoCo classes from the Hl7.Fhir.Core library, for example:</p>\n<div class=\"codehilite\"><pre><span></span>var at = new Hl7.Fhir.Model.AllergyIntolerance()\n{\n   Id = &quot;1&quot;,\n   Identifier = new List&lt;Identifier&gt;()\n   {\n      new Identifier(&quot;http://example.org/fhir/mysystem&quot;, &quot;abc123&quot;)\n   },\n   // ...\n};\n</pre></div>",
        "id": 154012339,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1540547364
    },
    {
        "content": "<p>Hi all,</p>\n<p>I am now creating these fhir resources, and have created the ones which have ready-made PoCo's from hl7.fhir.core  (thanks Michel).</p>\n<p>But for instance I would like to create a resource of profile type:  <a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-MedicationStatement-1\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-MedicationStatement-1\">https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-MedicationStatement-1</a> </p>\n<p>This uses <a href=\"http://hl7.org/fhir/StructureDefinition/MedicationStatement\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/MedicationStatement\">http://hl7.org/fhir/StructureDefinition/MedicationStatement</a> as the constrained type (this is like a base/superclass I assume ?)</p>\n<p>So I am able to create the Hl7.Fhir.Model.MedicationStatement PoCo, but how do I create the care-connect version of the medication statement resource ? </p>\n<p>Marc</p>",
        "id": 154017955,
        "sender_full_name": "Marc Riding",
        "timestamp": 1542111723
    },
    {
        "content": "<p>You create a Hl7.Fhir.Model.MedictionStatement object filling it based on the profile rules: do not populate elements that are removed in the profile (like basedOn it seems), always fill all required elements etc.</p>",
        "id": 154017993,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1542116811
    },
    {
        "content": "<p>Thanks  Michele,</p>\n<p>That is what I was doing, but what about for elements that are in the custom profile, but NOT in the standard model ? - the one I need to create is the \"medicationReference\" element (it is 1..1 on the profile). Obviously there is no PoCo field or method/function for this element.</p>\n<p>Marc</p>",
        "id": 154018011,
        "sender_full_name": "Marc Riding",
        "timestamp": 1542118293
    },
    {
        "content": "<p>A profile cannot add new elements to a resource (except as extensions)</p>",
        "id": 154018015,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1542119224
    },
    {
        "content": "<p><code>medicationReference</code> is part of MedicationStatament and it is in the class - look for MedicationElement</p>",
        "id": 154018016,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1542119286
    },
    {
        "content": "<p>you have to set it to a ResourceReference so it is rendered as medicationReference</p>",
        "id": 154018017,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1542119344
    },
    {
        "content": "<p>sorry - Medication not MedicationElement</p>",
        "id": 154018020,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1542119470
    },
    {
        "content": "<p>Thanks again Michele,</p>\n<p>I am still having trouble with the example above. I cannot work out how to use the .net code to add a medication reference to a medication statement. Tbh I can't even seem do this in the standard model, let alone our custom nhs profile.</p>\n<p>Also, when googling for custom fhir resources I came across this forums where <span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span>  mentions about using profiles-resources.xml file to add custom resources to the .net/poco library. Is this an option ?</p>\n<p>Edit - sorry, might be useful if I actually post the link to the forum ;)<br>\n<a href=\"https://github.com/ewoutkramer/fhir-net-api/issues/337\" target=\"_blank\" title=\"https://github.com/ewoutkramer/fhir-net-api/issues/337\">https://github.com/ewoutkramer/fhir-net-api/issues/337</a></p>",
        "id": 154018330,
        "sender_full_name": "Marc Riding",
        "timestamp": 1542189003
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196741\">@Marc Riding</span> If you send me the details of what you are attempting to do then I'll write you some example code to achieve it. PM me the the details</p>",
        "id": 154018435,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1542206351
    },
    {
        "content": "<p>To set the medication reference: <code>new Hl7.Fhir.Model.MedicationStatement { Medication = new Hl7.Fhir.Model.ResourceReference( \"Medication/the-id\") . . . }</code></p>",
        "id": 154018523,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1542213070
    },
    {
        "content": "<p>Don't think trying to re-generate the library with profiles would be the way to go - everything you need is in the standard library</p>",
        "id": 154018524,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1542213120
    },
    {
        "content": "<p>MedicationReference is in the standard resource profile. If it's help examples are on the demo CCRI server. This example has the TOC document broken down into sections and then resources within the section <a href=\"https://data.developer.nhs.uk/ccri/ed/patient/1172/document/8\" target=\"_blank\" title=\"https://data.developer.nhs.uk/ccri/ed/patient/1172/document/8\">https://data.developer.nhs.uk/ccri/ed/patient/1172/document/8</a> <br>\nThis is based on the documentviewer which NHS TOC should have told you about.</p>",
        "id": 154019408,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1542546469
    },
    {
        "content": "<p>Thanks for all the help guys, </p>\n<p>I managed to get the medication list and references created. They wouldn't serialize once I got them into the composition &amp; bundle, but luckily enough for now we are relieved of creating these resources as our medications are not snomed-encoded - We are leaving the medications as xhtml at the section level for now.</p>\n<p>Marc</p>",
        "id": 154019536,
        "sender_full_name": "Marc Riding",
        "timestamp": 1542627981
    }
]