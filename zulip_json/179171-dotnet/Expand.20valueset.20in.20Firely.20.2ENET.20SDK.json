[
    {
        "content": "<p>Hi, I have the following query working in Postman, which I want to do with the  Firely .NET SDK, but I can't see any way to define count or offset when using \"ExpandValueSet\"? </p>\n<p>Working query in Postman: {baseUrl}/ValueSet/{valueset-name}/$expand?count=100&amp;offset=10</p>\n<p>Anyone have any experience with this?</p>",
        "id": 221647181,
        "sender_full_name": "Stine Johansen",
        "timestamp": 1609854439
    },
    {
        "content": "<p>Hi, so I just tried testing this out on HAPI FHIR server R4 from a C# console application using Hl7.Fhir.R4 NuGet package.  The valueset can be seen at <a href=\"http://hapi.fhir.org/baseR4/ValueSet/1729316\">http://hapi.fhir.org/baseR4/ValueSet/1729316</a>. In the console application, I created a FhirClient using a base Uri of <a href=\"http://hapi.fhir.org/baseR4\">http://hapi.fhir.org/baseR4</a>. To keep it simple, I just called client.get() then checked to see if it had an expansion, and then used the Contains property on the ValueSet’s Expansion property. Since Contains property is an IEnumerable&lt;&gt; you can use Linq on it.</p>\n<p>var valSet = (ValueSet)client.Get(“ValueSet/1729316”);</p>\n<p>if (valSet.HasExpansion) // it does, with 54 elements<br>\n{<br>\n    var subset = valSet.Expansion.Contains.Skip(5).Take(10);<br>\n}</p>\n<p>Hope this helps a little.  I’m still learning FHIR.</p>",
        "id": 221827060,
        "sender_full_name": "Joe Mundi",
        "timestamp": 1609969050
    },
    {
        "content": "<p>I don't k ow the syntax with that routine, but that would grab all the data locally, and then filter client side with linq.</p>",
        "id": 221841698,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1609978463
    },
    {
        "content": "<p>Thanks for the tip! I tried your code, and even though there are 1851 expansion, I got HasExpansion == false. However, I see that I can use it like an HttpClient and managed to get all elements with the following, so I think I'll manage to implement some paging as well.</p>\n<div class=\"codehilite\"><pre><span></span><code>   public ValueSet ExpandValueSet(string valueSetName)\n    {\n        var valSet = (ValueSet) _client.Get($&quot;ValueSet/{valueSetName}/$expand?count=10000&quot;);\n        return valSet;\n    }\n</code></pre></div>",
        "id": 221863071,
        "sender_full_name": "Stine Johansen",
        "timestamp": 1610003347
    },
    {
        "content": "<p>You can also use the operation methods on the FhirClient, instead of the more low level Get:</p>\n<div class=\"codehilite\" data-code-language=\"C#\"><pre><span></span><code>   <span class=\"kt\">var</span> <span class=\"n\">p</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Parameters</span><span class=\"p\">();</span>\n   <span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">Parameter</span><span class=\"p\">.</span><span class=\"n\">Add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"n\">Parameters</span><span class=\"p\">.</span><span class=\"n\">ParameterComponent</span><span class=\"p\">()</span> <span class=\"p\">{</span> <span class=\"n\">Name</span> <span class=\"p\">=</span> <span class=\"s\">\"count\"</span><span class=\"p\">,</span> <span class=\"n\">Value</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"p\">(</span><span class=\"m\">10000</span><span class=\"p\">)</span> <span class=\"p\">});</span>\n   <span class=\"n\">p</span><span class=\"p\">.</span><span class=\"n\">Parameter</span><span class=\"p\">.</span><span class=\"n\">Add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"n\">Parameters</span><span class=\"p\">.</span><span class=\"n\">ParameterComponent</span><span class=\"p\">()</span> <span class=\"p\">{</span> <span class=\"n\">Name</span> <span class=\"p\">=</span> <span class=\"s\">\"offset\"</span><span class=\"p\">,</span> <span class=\"n\">Value</span> <span class=\"p\">=</span> <span class=\"k\">new</span> <span class=\"n\">Integer</span><span class=\"p\">(</span><span class=\"m\">2000</span><span class=\"p\">)</span> <span class=\"p\">});</span>\n\n  <span class=\"kt\">var</span> <span class=\"n\">valSet</span> <span class=\"p\">=</span> <span class=\"p\">(</span><span class=\"n\">ValueSet</span><span class=\"p\">)</span> <span class=\"n\">client</span><span class=\"p\">.</span><span class=\"n\">InstanceOperation</span><span class=\"p\">(</span><span class=\"n\">ResourceIdentity</span><span class=\"p\">.</span><span class=\"n\">Build</span><span class=\"p\">(</span><span class=\"s\">\"ValueSet\"</span><span class=\"p\">,</span> <span class=\"s\">\"{valueSetName}\"</span><span class=\"p\">),</span> <span class=\"s\">\"expand\"</span><span class=\"p\">,</span> <span class=\"n\">p</span><span class=\"p\">,</span> <span class=\"n\">useGet</span><span class=\"p\">:</span><span class=\"k\">true</span><span class=\"p\">);</span>\n</code></pre></div>",
        "id": 221864567,
        "sender_full_name": "Mirjam Baltus",
        "timestamp": 1610005232
    },
    {
        "content": "<p>Great tip Mirjam, thank you!  One question I still have, and it looks like Stine ran into something similar, is that sometimes a ValueSet has an expansion contained within its representation and sometimes it does not. Is that just bad test data in the HAPI server, or is ValueSet going to be unpredictable and should we just call the $expand operation?  </p>\n<p>Also, is there more documentation about what are the FHIR client capabilities? I would never have known to try the code you listed above without digging deep into the source code.</p>",
        "id": 221939653,
        "sender_full_name": "Joe Mundi",
        "timestamp": 1610025205
    },
    {
        "content": "<p>A ValueSet does not need to have an expansion element. If the ValueSet is defined by enumerating all the codes with the ValueSet.include part, that would already give you the list of codes you need. ValueSets can also be defined with a filter, in which case you will need the expansion if you need to check a code against the list, or if you want to show the codes that are in the ValueSet. Please do keep in mind that not all servers are capable of performing a $expand, or might only be able to create an expansion for smaller code systems.</p>\n<p>The documentation of the FhirClient is still lacking detail, I'm afraid . But the FhirClient has methods for all the interactions listed on the RestFul FHIR page in the specs, and the SDK code has a lot of inline documentation.</p>",
        "id": 222311509,
        "sender_full_name": "Mirjam Baltus",
        "timestamp": 1610378925
    }
]