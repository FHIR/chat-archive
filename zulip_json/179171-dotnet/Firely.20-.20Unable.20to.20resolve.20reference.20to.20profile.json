[
    {
        "content": "<p>I am trying to validate a Patient resource that follows the us-core-patient using the <a href=\"https://server.fire.ly/\">Firely server</a>. I have been following <a href=\"https://docs.fire.ly/projects/Firely-Server/en/latest/features/validation.html#validate-on-the-resourcetype-level\">Firely documentation for validation</a> and trying the validation on a system and ResourceType level. However I get the error <code>Unable to resolve reference to profile 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'</code>. To reference the us-core-patient I either put the canonical url in the endpoint like so<br>\n<code>https://server.fire.ly/Patient/$validate?profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient</code><br>\nor put it in the meta field for the resource</p>\n<div class=\"codehilite\"><pre><span></span><code>    &quot;resourceType&quot;: &quot;Patient&quot;,\n    &quot;meta&quot;: {\n        &quot;profile&quot;: [\n            &quot;http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient&quot;\n        ]\n    },\n</code></pre></div>\n<p>I managed to get the validation working using the FHIR validator jar [FHIR Validation tool Version 5.4.4 (Git# 952db0248a25)] for the Patient resource.<br>\n<span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> Do you or anyone else know what might be the issue?<br>\nAdditionally, another situation when validating a bundle using the Firely server I receive no errors, but the FHIR validator jar returns errors such as <code>Bundle entry missing fullUrl</code> or <code>Except for transactions and batches, each entry in a Bundle must have a fullUrl which is the identity of the resource in the entry</code>; what could account for these differences?</p>",
        "id": 243043683,
        "sender_full_name": "Corey Wen",
        "timestamp": 1623946698
    },
    {
        "content": "<p>You reference the profile correctly, but unless that profile is present in the Firely Server so the validator can locate it and use it, it still will not work. I don't know if/how our public server has these us-core profiles installed, <span class=\"user-mention\" data-user-id=\"259036\">@Matthijs van der Wielen</span> or <span class=\"user-mention\" data-user-id=\"191757\">@Christiaan Knaap</span> will surely know more about that.</p>",
        "id": 243135187,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1624007567
    },
    {
        "content": "<blockquote>\n<p>Except for transactions and batches, each entry in a Bundle must have a fullUrl which is the identity of the resource in the entry</p>\n</blockquote>\n<p>There are certainly differences between the two validators, the Java one has more \"hand-built\" rules like these. This validation is not expressed in, say, the profile for Bundle, but rather these are present as written narrative rules in the spec only.  The .NET validator still misses quite a few of those rules.</p>",
        "id": 243135356,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1624007678
    },
    {
        "content": "<p>I have added this request to the list at <a href=\"https://github.com/FirelyTeam/firely-net-sdk/issues/1766\">https://github.com/FirelyTeam/firely-net-sdk/issues/1766</a></p>",
        "id": 243135590,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1624007867
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"408951\">@Corey Wen</span> ,<br>\nI checked and the us-core-patient is loaded on the public endpoint, but only for STU3. So when you try to validate a R4 profile this will not work. Could you let me know it that is the case? </p>\n<p>FYI you can check weather this profile is included using  ({{BASE_URL}}/administration/StructureDefinition?url=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient)</p>",
        "id": 243136395,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1624008365
    },
    {
        "content": "<p>Hi, I believe I was trying to validate a R4 profile but I am not sure how confirm if that is actually the case. I'm relatively new to FHIR so I'm not 100% sure. There is no data in my resource that denotes it being R4 or STU3, but this is the <a href=\"https://www.hl7.org/fhir/us/core/StructureDefinition-us-core-patient.html\">profile for us-core patient</a> I was following.</p>",
        "id": 243163436,
        "sender_full_name": "Corey Wen",
        "timestamp": 1624024338
    },
    {
        "content": "<p>If you used <code>https://server.fire.ly/Patient/$validate?profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient</code>, I am pretty sure this is the R4 endpoint. <span class=\"user-mention\" data-user-id=\"259036\">@Matthijs van der Wielen</span> , correct?</p>",
        "id": 243168720,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1624026758
    },
    {
        "content": "<p>Yes, that is correct. I meant to respond to this, we are investigating why the STU3 resources has been loaded on the R4 endpoint. This should be the us-core R4 patient and not the STU3 patient. I will let you know once we've fixed this.</p>",
        "id": 243345536,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1624258812
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"408951\">@Corey Wen</span> ,</p>\n<p>One of my colleagues pointed out to me that we do have the R4 resource for the us-core-patient preloaded on our admin db. Let me explain how this works: </p>\n<p><a href=\"http://server.fire.ly\">server.fire.ly</a> by default still returns STU3.<br>\nWays to get to STU3 or R4 explicitly:</p>\n<ul>\n<li><a href=\"http://server.fire.ly/R3/\">server.fire.ly/R3/</a></li>\n<li><a href=\"http://server.fire.ly/R4/\">server.fire.ly/R4/</a></li>\n<li><a href=\"http://server.fire.ly\">server.fire.ly</a>, Content-Type = application/fhir+json; fhirVersion=3.0</li>\n<li><a href=\"http://server.fire.ly/\">server.fire.ly/</a>, Content-Type = application/fhir+json; fhirVersion=4.0<br>\nFor more information on that please take a look at our documentation: <a href=\"https://docs.fire.ly/projects/Firely-Server/en/latest/features/multiversion.html\">https://docs.fire.ly/projects/Firely-Server/en/latest/features/multiversion.html</a></li>\n</ul>\n<p>Finally, us-core Patient is loaded for both R3 and R4:<br>\n&lt;base&gt;/administration/R3/StructureDefinition?url=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient<br>\n&lt;base&gt;/administration/R4/StructureDefinition?url=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient<br>\nNote to add /administration before the version part of the path.</p>\n<p>We are working on changing the default to R4 instead of STU3. So the validation should work if you use <code>https://server.fire.ly/R4/Patient/$validate?profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient</code></p>",
        "id": 243612534,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1624430900
    },
    {
        "content": "<p>I tried sending a post request using Postman and unfortunately I still received the same error of <br>\n<code>\"Unable to resolve reference to profile 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'\"</code>.<br>\nI have both \"Content-Type\" and \"Accept\" as <code>application/fhir+json; fhirVersion=4.0</code> and tried the post request to two endpoints, one being<br>\n<code>https://server.fire.ly/R4/$validate</code> with the us-core patient in the .meta field of my Patient resource, and another endpoint<br>\n<code>https://server.fire.ly/R4/Patient/$validate?profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient</code>.</p>",
        "id": 243791857,
        "sender_full_name": "Corey Wen",
        "timestamp": 1624543920
    },
    {
        "content": "<p>Sorry for the inconvenience <span class=\"user-mention\" data-user-id=\"408951\">@Corey Wen</span>. Usually the us-core profiles are loaded into our administration database by default after a reset, but it seems after the last one this did not happen. I have uploaded the profiles manually now, so it should work if you try again.</p>",
        "id": 243823702,
        "sender_full_name": "Mirjam Baltus",
        "timestamp": 1624557802
    }
]