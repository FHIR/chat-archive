[
    {
        "content": "<p>yashaskram opened <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>Passing parameters between CDS Hook and SoF app launch (when hook provider and app provider are same and would like to use the state/context</p>\n<p>Couple of use cases <br>\n1)  Taking users to a particular point in the SoF app based on the CDS Hook interaction. Sharing app context<br>\n2)  Pre populating information based on the hook interaction. Sharing hook id (Example Imaging appropriate use case – populating or linking back to the CDS receipt information generated in the hook interaction)</p>\n<p>Couple of straw men (Thx to @kpshek  and <span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\" data-user-id=\"558\">@Isaac Vetter</span> ) to start with. </p>\n<p>A link in CDS card has params data </p>\n<p>{<br>\n  \"summary\": \"Example Card\",<br>\n  \"indicator\": \"info\",<br>\n  \"detail\": \"This is an example card.\",<br>\n  \"source\": {<br>\n    \"label\": \"Static CDS Service Example\",<br>\n    \"url\": \"<a href=\"https://example.com\" target=\"_blank\" title=\"https://example.com\">https://example.com</a>\"<br>\n  },<br>\n  \"links\": [<br>\n    {<br>\n      \"label\": \"Google\",<br>\n      \"url\": \"<a href=\"https://google.com\" target=\"_blank\" title=\"https://google.com\">https://google.com</a>\",<br>\n      \"type\": \"smart\"<br>\n<strong>\"params\": \"foo=a&amp;bar=c\"</strong><br>\n    },<br>\n}</p>\n<p><strong>SMART launch URL param</strong><br>\nEHR appends the params value to the SMART app launch URL. This is a change we’d want to put into SMART (to call out launch params by the SMART app) and take advantage of here in CDS Hooks.<br>\nhttp://&lt;app launch url&gt;&amp;<strong>foo=a&amp;bar=c</strong>&amp;iss=xx&amp;launch=xx</p>\n<p><strong>OAuth claim alongside access token during SMART launch</strong><br>\nSimilar to above, but the EHR passes the custom value in the CDS card SMART link alongside the access token during a SMART launch. In this case the value doesn’t have to be URL encoded</p>\n<p>{  <br>\n  \"need_patient_banner\":true,<br>\n  \"patient\":\"123\",<br>\n  \"encounter\":\"456\",<br>\n  \"token_type\":\"Bearer\",<br>\n  \"access_token\":\"....\",<br>\n  \"id_token\":\"...\",<br>\n  \"scope\":\"patient\\/Patient.read patient\\/Observation.read launch online_access openid profile\",<br>\n  \"expires_in\":570,<br>\n<strong>\"params\":\"foo=a&amp;bar=c\"</strong><br>\n}</p>\n<p>Other ideas / thoughts?</p>\n</blockquote>",
        "id": 153897340,
        "sender_full_name": "Github Notifications",
        "timestamp": 1500490421
    },
    {
        "content": "<p>isaacvetter <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-316497416\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-316497416\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>Hey @yashaskram, </p>\n<p>I think that the CDS Hooks community has an ideal that a cds service can/will recommend SMART apps that are external to it. As we get closer to production implementations, it'll be interesting to see if that's actually a common use-case. I think that it makes sense to enable tighter integration when the service and app are the same system -- as long as we continue to enable the case where they're not.</p>\n<p>Because the SMART app launch url is typically pre-registered in an EHR's SMART app directory, the launch url itself can't be dynamic. </p>\n<p>Overall, I think that both of the above _params_ approaches are overcomplicated. Echoing service-provided strings feels risky from a security point of view. A parameter of parameters feels inelegant.  </p>\n<p>Why not just put the hook id alongside the access_token as a SMART launch parameter? This feels both cleaner and simpler. We could try to get the launch param standardizes in SMART as \"session_id\" or something like that. It'd then be the responsibility of the server/app server to maintain state, which it's doing already. </p>\n</blockquote>",
        "id": 153897342,
        "sender_full_name": "Github Notifications",
        "timestamp": 1500493915
    },
    {
        "content": "<p>robs16 <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-316732183\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-316732183\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>If you are going through the trouble of putting these parameters in a separate field within the link definition - perhaps they should be headers and defined as a map?</p>\n<p>I tend to agree with <span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\" data-user-id=\"558\">@Isaac Vetter</span> that a defined launch parameter would probably be better. However, rather than treating the hook instance as a security token, I would like to see a JWT instead (it could include the hook instance).</p>\n</blockquote>",
        "id": 153897474,
        "sender_full_name": "Github Notifications",
        "timestamp": 1500563090
    },
    {
        "content": "<p>yashaskram <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-319804732\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-319804732\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>hook id as SMART launch would parameter work for the particular use case above. Only concern I have is that it is not extensible for other use cases where app would like to share context with EHR upfront (in the use cases where local rules engine within EHR is leveraged to launch SMART app which I think is outside of the scope of this group)</p>\n<p>hook_id (or session_id) as launch param works for us -&gt; Can we agree upon this approach to be v 1.0 milestone? </p>\n</blockquote>",
        "id": 153900228,
        "sender_full_name": "Github Notifications",
        "timestamp": 1501709450
    },
    {
        "content": "<p>brettmarquard labeled <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>",
        "id": 153915038,
        "sender_full_name": "Github Notifications",
        "timestamp": 1508496128
    },
    {
        "content": "<p>kpshek milestoned <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>",
        "id": 153915521,
        "sender_full_name": "Github Notifications",
        "timestamp": 1508792963
    },
    {
        "content": "<p>kpshek assigned <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>",
        "id": 153915523,
        "sender_full_name": "Github Notifications",
        "timestamp": 1508792970
    },
    {
        "content": "<p>isaacvetter assigned <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>",
        "id": 153917191,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509560047
    },
    {
        "content": "<p>isaacvetter <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-341193099\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-341193099\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>@yashaskram and I just talked this through. </p>\n<p>I really do think that the hookInstance from the CDS request passed as a SMART launch parameter is the cleanest, simplest and least invasive method for enabling a session from the CDS Request to the launched SMART app, in the case where the service and the app are the same.</p>\n</blockquote>",
        "id": 153917193,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509560139
    },
    {
        "content": "<p>yashaskram <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-341239871\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-341239871\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\" data-user-id=\"558\">@Isaac Vetter</span>  -  I am thinking more about how above would work for our use case. Let me detail our use case a bit more. We have hundreds of clinical pathways and our pathway CDS Hook service can respond back with multiple cards applicable for the patient in context. For example: lets say the CDS Hook service responds back two cards as below</p>\n<p>{<br>\n  \"cards\": [<br>\n    {<br>\n      \"summary\": \"Card 1 - Clinical Pathway 1\",<br>\n      \"indicator\": \"info\",<br>\n      \"detail\": \"This is an example app card.\",<br>\n      \"links\": [<br>\n        {<br>\n          \"label\": \"SMART App\",<br>\n          \"url\": \"<a href=\"https://smart.example.com/launch\" target=\"_blank\" title=\"https://smart.example.com/launch\">https://smart.example.com/launch</a>\",<br>\n          \"type\": \"smart\"<br>\n        }<br>\n      ]<br>\n    },<br>\n    {<br>\n      \"summary\": \"Card 2 - Clinical Pathway 2\",<br>\n      \"indicator\": \"info\",<br>\n      \"detail\": \"This is an example app card.\",<br>\n      \"links\": [<br>\n        {<br>\n          \"label\": \"SMART App\",<br>\n          \"url\": \"<a href=\"https://smart.example.com/launch\" target=\"_blank\" title=\"https://smart.example.com/launch\">https://smart.example.com/launch</a>\",<br>\n          \"type\": \"smart\"<br>\n        }<br>\n      ]<br>\n    }<br>\n  ]<br>\n}</p>\n<p>The need is when user opens the smart link in the app card, it launches a particular clinical pathway. One option is to register each pathway as its own SMART of FHIR app which is something we like to avoid so planning to accomplish above with out having to register each pathway as individual SMART on FHIR app. </p>\n<p>Going back to your input to use hookInstance as SMART launch param to solve this problem will work only if we assume there is one card response for a particular hook request.</p>\n<p>The option which we were thinking before <a href=\"http://url\" target=\"_blank\" title=\"http://url\">https://github.com/cds-hooks/docs/issues/59#issuecomment-316497416</a> is to have a dedicated element in base spec (as opposed to using extension or hookInstance). What do you think about going ahead with that approach say having a field - cardid (or hookid) added to cards spec as in the example below</p>\n<p>{<br>\n  \"cards\": [<br>\n    {<br>\n<strong>\"cardid\": \"123\"</strong><br>\n      \"summary\": \"Card 1 - Clinical Pathway 1\",<br>\n      \"indicator\": \"info\",<br>\n      \"detail\": \"This is an example app card.\",<br>\n      \"links\": [<br>\n        {<br>\n          \"label\": \"SMART App\",<br>\n          \"url\": \"<a href=\"https://smart.example.com/launch\" target=\"_blank\" title=\"https://smart.example.com/launch\">https://smart.example.com/launch</a>\",<br>\n          \"type\": \"smart\"<br>\n        }<br>\n      ]<br>\n    },<br>\n    {<br>\n      \"<strong>cardid\": \"345\"</strong><br>\n      \"summary\": \"Card 2 - Clinical Pathway 2\",<br>\n      \"indicator\": \"info\",<br>\n      \"detail\": \"This is an example app card.\",<br>\n      \"links\": [<br>\n        {<br>\n          \"label\": \"SMART App\",<br>\n          \"url\": \"<a href=\"https://smart.example.com/launch\" target=\"_blank\" title=\"https://smart.example.com/launch\">https://smart.example.com/launch</a>\",<br>\n          \"type\": \"smart\"<br>\n        }<br>\n      ]<br>\n    }<br>\n  ]<br>\n}</p>\n<p>Below might be outside CDS Hook scope, but the hope is CDS Hook requester  (EHR) can send this information back alongside access token during SMART launch similar to below</p>\n<p>{<br>\n\"need_patient_banner\":true,<br>\n\"patient\":\"123\",<br>\n\"encounter\":\"456\",<br>\n\"token_type\":\"Bearer\",<br>\n\"access_token\":\"....\",<br>\n\"id_token\":\"...\",<br>\n\"scope\":\"patient/Patient.read patient/Observation.read launch online_access openid profile\",<br>\n\"expires_in\":570,<br>\n\"cardid: \"123\"<br>\n}</p>\n<p>Personally I am kind off inclined to using extension <a href=\"http://url\" target=\"_blank\" title=\"http://url\">https://github.com/cds-hooks/docs/issues/76</a> at the links level for this issue but I also prefer above approach. And also with the latter, it doesn't stop implementer's to go with extensions if needed</p>\n</blockquote>",
        "id": 153917223,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509569780
    },
    {
        "content": "<p>isaacvetter <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-341410627\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-341410627\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>Hey @yashaskram , </p>\n<p>Thanks for explaining the above. The feature you're describing isn't about strictly maintaining a session between the CDS request and the SMART app, as I had thought (and which would be generically useful anytime the CDS service and the SMART app are the same system), rather, it's needed to distinguish between your hundreds of \"apps\" (or workflows), all of which have the same launch url registered in the EHR.</p>\n<p>Do you think that this will be a common need? While I do understand your use-case, it doesn't seem common -- I expect that most SMART apps are registered as different apps or display the same content upon launch. What are other scenarios where a card specific id (I'd go with the term \"cardInstance\" for consistency) would be useful?</p>\n<p>Isaac</p>\n</blockquote>",
        "id": 153917311,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509626928
    },
    {
        "content": "<p>grahamegrieve <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-341520089\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-341520089\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>Generically, it seems like a good robust idea for a cds-hooks service to be able to pass some information from the card to the app it is launching </p>\n</blockquote>",
        "id": 153917372,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509648099
    },
    {
        "content": "<p>yashaskram <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-342208108\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-342208108\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\" data-user-id=\"558\">@Isaac Vetter</span>  scenarios where specific card id is useful in when CDS service provider has multiple points with in their app and want to take the users to a particular point in their app based on the rules/logic executed during the CDS Hooks request processing</p>\n<p>I thought about cardInstance to be in sync with hookInstance but in our current implementation the card identifier (which we would like to share with EHR and get back during SMART launch) is not unique but we can make it unique. We can go with cardInstance</p>\n</blockquote>",
        "id": 153917841,
        "sender_full_name": "Github Notifications",
        "timestamp": 1509986532
    },
    {
        "content": "<p>kpshek edited <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a>(assigned to kpshek)</p>\n<blockquote>\n<p>Passing parameters between CDS Hook and SoF app launch (when hook provider and app provider are same and would like to use the state/context</p>\n<p>Couple of use cases <br>\n1)  Taking users to a particular point in the SoF app based on the CDS Hook interaction. Sharing app context<br>\n2)  Pre populating information based on the hook interaction. Sharing hook id (Example Imaging appropriate use case – populating or linking back to the CDS receipt information generated in the hook interaction)</p>\n<p>Couple of straw men (Thx to @kpshek  and @isaacvetter ) to start with. </p>\n<p>A link in CDS card has params data </p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n  <span class=\"nt\">&quot;summary&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Example Card&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;indicator&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;info&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;detail&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;This is an example card.&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;source&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">&quot;label&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Static CDS Service Example&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;https://example.com&quot;</span>\n  <span class=\"p\">},</span>\n  <span class=\"nt\">&quot;links&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">&quot;label&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Google&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;https://google.com&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;smart&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;params&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;foo=a&amp;bar=c&quot;</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p><strong>SMART launch URL param</strong><br>\nEHR appends the params value to the SMART app launch URL. This is a change we’d want to put into SMART (to call out launch params by the SMART app) and take advantage of here in CDS Hooks.<br>\nhttp://&lt;app launch url&gt;&amp;<strong>foo=a&amp;bar=c</strong>&amp;iss=xx&amp;launch=xx</p>\n<p><strong>OAuth claim alongside access token during SMART launch</strong><br>\nSimilar to above, but the EHR passes the custom value in the CDS card SMART link alongside the access token during a SMART launch. In this case the value doesn’t have to be URL encoded</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n  <span class=\"nt\">&quot;need_patient_banner&quot;</span><span class=\"p\">:</span><span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;patient&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;123&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;encounter&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;456&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;token_type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Bearer&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;access_token&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;....&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;id_token&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;...&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;scope&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;patient\\/Patient.read patient\\/Observation.read launch online_access openid profile&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;expires_in&quot;</span><span class=\"p\">:</span><span class=\"mi\">570</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;params&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;foo=a&amp;bar=c&quot;</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p>Other ideas / thoughts?</p>\n</blockquote>",
        "id": 153920993,
        "sender_full_name": "Github Notifications",
        "timestamp": 1511347483
    },
    {
        "content": "<p>jmandel <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-346343040\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-346343040\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>Only quick note I'll make is that:</p>\n<p>1. If we ever expect passed parameters to include sensitive information or details that an app needs to authenticate, then URL parameters aren't a good fit (and accept token response parameters should be ok)</p>\n<p>2. No matter what we tell people, sometimes sensitive information or details that need to be authenticated by the app (rather than blindly trusted) will be part of a developer's use case... so see (1).</p>\n</blockquote>",
        "id": 153921012,
        "sender_full_name": "Github Notifications",
        "timestamp": 1511355544
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-346348182\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59#issuecomment-346348182\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>\n<blockquote>\n<p>Thanks for that note, @jmandel. In all of the proposals we've discussed so far around this, the value would be communicated to the SMART app along with the other context variables alongside the OAuth 2 access token -- not as URL parameters on the launch URL.</p>\n</blockquote>",
        "id": 153921016,
        "sender_full_name": "Github Notifications",
        "timestamp": 1511356869
    },
    {
        "content": "<p>kpshek closed <a href=\"https://github.com/cds-hooks/docs/issues/59\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/59\">Issue #59</a></p>",
        "id": 153922116,
        "sender_full_name": "Github Notifications",
        "timestamp": 1511977179
    }
]