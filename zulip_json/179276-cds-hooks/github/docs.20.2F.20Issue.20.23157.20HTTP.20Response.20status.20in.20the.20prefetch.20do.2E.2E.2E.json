[
    {
        "content": "<p>mattvarghese opened <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>Specifically this property on prefetch properties</p>\n<div class=\"codehilite\"><pre><span></span>      &quot;response&quot;: {\n        &quot;status&quot;: &quot;200 OK&quot;\n      },\n</pre></div>\n\n\n<p>Based on this sentence, the value of this property can only ever be 200 OK</p>\n<blockquote>\n<p>Additionally, if the EHR encounters an error while prefetching any data, the prefetch template key SHOULD NOT be sent to the CDS Service.</p>\n</blockquote>\n<p>At the same time, there may not even be an HTTP request and therefore any HTTP status associated with a prefetch based on this sentence</p>\n<blockquote>\n<p>The EHR may satisfy some of the desired prefetched templates via some internal service or even its own FHIR server</p>\n</blockquote>\n<p>So, should this be retained in the spec, or should it be removed? If it is retained, we need to reconcile the other sentences cited to not make a contradiction.</p>\n</blockquote>",
        "id": 153932125,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517164182
    },
    {
        "content": "<p>kpshek milestoned <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>",
        "id": 153932288,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517173126
    },
    {
        "content": "<p>euvitudo <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362009721\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362009721\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>Agree with @mattvarghese. My thought is that it would be useful to retain the status (and augment the possible values, or simply rely on the standard set of HTTP statuses.  At some point the service will need to determine whether to call out to the FHIR server for required(?) resource (provided fhirAuthorization is included) or to return an error (or otherwise?) indicating that it cannot proceed without the resource; or attempt to proceed without the resource.</p>\n</blockquote>",
        "id": 153934265,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517420129
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362012506\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362012506\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>I think this is a reasonable change too. I would be curious to hear an differing opinions here, but I think the fact that prefetch data can be satisfied by a means other than FHIR makes having the <code>response</code> structure odd.</p>\n<p>@jmandel - any objections?</p>\n</blockquote>",
        "id": 153934297,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517420672
    },
    {
        "content": "<p>jmandel <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362013906\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362013906\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>The reasons this was originally here was to enable easy slotting of <code>Bundle.entry</code> values into prefetch responses. If we <em>do</em> eliminate this, would we want to kill the whole \"response\" field and then collapse \"resource\" up a node in the tree? In other words:</p>\n<p>### Move from</p>\n<div class=\"codehilite\"><pre><span></span>   &quot;prefetch&quot; : {\n      &quot;patientToGreet&quot; : {\n         &quot;response&quot; : {\n            &quot;status&quot; : &quot;200 OK&quot;\n         },\n         &quot;resource&quot; : {\n            &quot;resourceType&quot; : &quot;Patient&quot;,\n            &quot;gender&quot; : &quot;male&quot;,\n            &quot;birthDate&quot; : &quot;1925-12-23&quot;,\n            &quot;id&quot; : &quot;1288992&quot;,\n            &quot;active&quot; : true\n         }\n      }\n   }\n</pre></div>\n\n\n<p>### To</p>\n<div class=\"codehilite\"><pre><span></span>   &quot;prefetch&quot; : {\n      &quot;patientToGreet&quot; : {\n            &quot;resourceType&quot; : &quot;Patient&quot;,\n            &quot;gender&quot; : &quot;male&quot;,\n            &quot;birthDate&quot; : &quot;1925-12-23&quot;,\n            &quot;id&quot; : &quot;1288992&quot;,\n            &quot;active&quot; : true\n      }\n   }\n</pre></div>\n\n\n</blockquote>",
        "id": 153934307,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517420937
    },
    {
        "content": "<p>brynrhodes <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362014853\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362014853\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>Agree that would be simpler, but I think we might be losing the ability to say \"This prefetch key has no data\", which I think is a useful thing to say.</p>\n</blockquote>",
        "id": 153934310,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517421112
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362015549\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362015549\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<blockquote>\n<p>Agree that would be simpler, but I think we might be losing the ability to say \"This prefetch key has no data\", which I think is a useful thing to say.</p>\n</blockquote>\n<p>If the EHR attempted the prefetch but there was no data, then the prefetch key can be present in the request with a value of an empty object. Eg:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"s2\">&quot;prefetch&quot;</span> <span class=\"err\">:</span> <span class=\"p\">{</span>\n  <span class=\"nt\">&quot;current-medications&quot;</span><span class=\"p\">:</span> <span class=\"p\">{}</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n</blockquote>",
        "id": 153934311,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517421263
    },
    {
        "content": "<p>euvitudo <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362015816\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362015816\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>@kpshek - regarding </p>\n<blockquote>\n<p>...but I think the fact that prefetch data can be satisfied by a means other than FHIR...</p>\n</blockquote>\n<p>from an implementer's point of view, I would rather support a single standard versus opening it up to anything under the sun.  If the former, it tightens up the spec and makes it a more reasonable implementation.  If the latter, then you should include a discussion regarding what a service should expect in prefetch data and how to convey that in the <code>cds-services</code> metadata.</p>\n</blockquote>",
        "id": 153934312,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517421311
    },
    {
        "content": "<p>jmandel <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362015862\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362015862\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>So, in this example, presumably <code>current-medications</code> is an empty bundle... </p>\n</blockquote>",
        "id": 153934313,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517421319
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362016599\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362016599\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>@euvitudo - I left out a critical word. I meant to say:</p>\n<blockquote>\n<p>...but I think the fact that prefetch data can be satisfied by a means other than FHIR <strong>server</strong></p>\n</blockquote>\n<p>For instance, the EHR may have the requested prefetch data locally in memory (FHIR format). In this case, there is no RESTful service being invoked to prefetch the requested data. This is why the <code>response</code> structure doesn't make as much sense.</p>\n</blockquote>",
        "id": 153934314,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517421459
    },
    {
        "content": "<p>euvitudo <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362017109\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362017109\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>Regarding the <code>current-medications</code> field, why not more simply use a <code>null</code>?  An empty object is not very useful, but a null (as ugly as they may be).</p>\n<p>Regarding @brynrhodes' comment, it _would_ be useful to know when a prefetch value has no data (in one case the service doesn't need to attempt a retrieval from the FHIR server; or the fact that there are not data is meaningful to the service).</p>\n</blockquote>",
        "id": 153934315,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517421553
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362017750\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362017750\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<blockquote>\n<p>Regarding the current-medications field, why not more simply use a null?</p>\n</blockquote>\n<p>I agree @euvitudo, that's a better choice than an empty object (it is far more simply for a CDS Service to reason about a null value than my proposal).</p>\n</blockquote>",
        "id": 153934316,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517421680
    },
    {
        "content": "<p>jmandel <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362018100\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362018100\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>Whatever we do, I think we want it clear how to tell the difference among:</p>\n<p>1. EHR did not run a prefetch on this parameter<br>\n2. EHR ran a prefetch and found a result<br>\n3. EHR ran a prefetch and found no match (note this shouldn't apply to <code>search</code> operations, which should successfully return empty bundles that would be conveyed as the response)<br>\n4. EHR rand a prefetch and encountered an error (e.g. if the service is asking to prefetch data it's not allowed to see; this is important to distinguish because it tells an app that shouldn't try to run this query on its own, after being invoked)</p>\n<p>Is that correct? If so, @kpshek can you list how you're proposing each of these cases gets conveyed?</p>\n</blockquote>",
        "id": 153934318,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517421751
    },
    {
        "content": "<p>euvitudo <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362020237\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362020237\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>On a more meta-note, I've always thought it strange that prefetch value type is Bundle.entry (not a Resource).  It would be much more flexible to specify a prefetch value as an object that contains a prefetch status (as defined by the CDS Hooks spec) and, if applicable, a FHIR Resource.</p>\n</blockquote>",
        "id": 153934324,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517422192
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362020499\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362020499\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<blockquote>\n<p>1. EHR did not run a prefetch on this parameter</p>\n</blockquote>\n<p>prefetch key is omitted from the request.  We address this today in the spec with: \"The CDS Service MUST NOT receive any prefetch template key that the EHR chooses not to satisfy.\"</p>\n<blockquote>\n<p>2. EHR ran a prefetch and found a result</p>\n</blockquote>\n<p>prefetch key exists with a valued object. We need to be clear on the data type (@euvitudo's comments agree)</p>\n<blockquote>\n<p>3. EHR ran a prefetch and found no match (note this shouldn't apply to search operations, which should successfully return empty bundles that would be conveyed as the response)</p>\n</blockquote>\n<p>prefetch key exists with a null object (@euvitudo's suggestion which I agree with).</p>\n<blockquote>\n<p>4. EHR ran a prefetch and encountered an error (e.g. if the service is asking to prefetch data it's not allowed to see; this is important to distinguish because it tells an app that shouldn't try to run this query on its own, after being invoked)</p>\n</blockquote>\n<p>prefetch key is omitted from the request. We address this in the current spec with \"Additionally, if the EHR encounters an error while prefetching any data, the prefetch template key SHOULD NOT be sent to the CDS Service. It is the CDS Service's responsibility to check prefetched data against its template to determine what requests were satisfied (if any) and to manually retrieve any additional necessary data.\"</p>\n<p>I don't see value in communicating any errors that occurred when attempting to prefetch the data. The error could be transient, could only apply to the EHR, or something else that doesn't matter to the CDS Service. At the end of the day, prefetch is optional and the CDS Service has to determine how it handles missing prefetch data by either:</p>\n<ul>\n<li>Returning a 412 (\"If the CDS Service is unable to obtain required data because it cannot access the FHIR server and the request did not contain the necessary prefetch keys, the service SHALL respond with an HTTP 412 Precondition Failed status code.\")</li>\n<li>Trying to fetch the data itself. Sure, it may fail again but the CDS Service has to try (if it really needs the data).</li>\n</ul>\n</blockquote>",
        "id": 153934325,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517422244
    },
    {
        "content": "<p>jmandel <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362021489\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362021489\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>That's fine @kpshek; you're saying you don't need item 4 from my list. Your proposal above clearly distinguishes among 1/2/3. I'm happy with that, and if we go with this plan... I think we can collapse the <code>resource</code> node per my previous note:</p>\n<div class=\"codehilite\"><pre><span></span>   <span class=\"s2\">&quot;prefetch&quot;</span> <span class=\"err\">:</span> <span class=\"p\">{</span>\n      <span class=\"nt\">&quot;patientToGreet&quot;</span> <span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;resourceType&quot;</span> <span class=\"p\">:</span> <span class=\"s2\">&quot;Patient&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;gender&quot;</span> <span class=\"p\">:</span> <span class=\"s2\">&quot;male&quot;</span><span class=\"p\">,</span>\n      <span class=\"p\">}</span>\n   <span class=\"p\">}</span>\n</pre></div>\n\n\n<p>@euvitudo are you okay with this? It doesn't quite satisfy your perspective that</p>\n<blockquote>\n<p>It would be much more flexible to specify a prefetch value as an object that contains a prefetch status (as defined by the CDS Hooks spec) and, if applicable, a FHIR Resource.</p>\n</blockquote>\n</blockquote>",
        "id": 153934329,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517422462
    },
    {
        "content": "<p>euvitudo <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362023557\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-362023557\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>@jmandel - Agreed it doesn't satisfy the perspective regarding status, however I think I might be OK with it insofar as the specification indicates what each of the three conditions means.</p>\n<p>The reason for that is that including the status is a bit of an optimization allowing the service to decide what do to per a given status, leaving the exclusion of such in the spec open to interpretation by each service.</p>\n<p>At this point I'm not completely sure whether that helps or whether it complicates the implementation, but it does allow implementers to decide the approach per the given prefetch value (for better or for worse).</p>\n</blockquote>",
        "id": 153934331,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517422876
    },
    {
        "content": "<p>mattvarghese edited <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>Specifically this property on prefetch properties</p>\n<div class=\"codehilite\"><pre><span></span>      &quot;response&quot;: {\n        &quot;status&quot;: &quot;200 OK&quot;\n      },\n</pre></div>\n\n\n<p>Based on this sentence, the value of this property can only ever be 200 OK</p>\n<blockquote>\n<p>Additionally, if the EHR encounters an error while prefetching any data, the prefetch template key SHOULD NOT be sent to the CDS Service.</p>\n</blockquote>\n<p>At the same time, there may not even be an HTTP request and therefore any HTTP status associated with a prefetch based on this sentence</p>\n<blockquote>\n<p>The EHR may satisfy some of the desired prefetched templates via some internal service or even its own FHIR server</p>\n</blockquote>\n<p>So, should this be retained in the spec, or should it be removed? If it is retained, we need to reconcile the other sentences cited to not make a contradiction.</p>\n</blockquote>",
        "id": 153935087,
        "sender_full_name": "Github Notifications",
        "timestamp": 1517599922
    },
    {
        "content": "<p>isaacvetter assigned <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>",
        "id": 153939395,
        "sender_full_name": "Github Notifications",
        "timestamp": 1519231288
    },
    {
        "content": "<p>isaacvetter <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-373404264\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-373404264\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>Hey Everybody, </p>\n<p>Just created PR #176 to satisfy this issue. I think that it's pretty clearcut, based upon the above. </p>\n<p>The only thing that I didn't do was provide a concrete example of a bull FHIR read. Given that (currently) our only two defined \"prefetch variables\" are {{User.Id}} and {{Patient.Id}} and that a null prefetch template only makes sense to be passed to the CDS service as part of a FHIR read, I'm at a loss to identify a realistic scenario when an EHR doesn't have a patient or practitioner resource for the current user or patient ... Any suggestions?</p>\n<p>If not, I'll close this issue when the PR's merged.</p>\n<p>Isaac</p>\n</blockquote>",
        "id": 153945082,
        "sender_full_name": "Github Notifications",
        "timestamp": 1521125701
    },
    {
        "content": "<p>kpshek closed <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>",
        "id": 153945137,
        "sender_full_name": "Github Notifications",
        "timestamp": 1521129835
    },
    {
        "content": "<p>grahamegrieve <a href=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-373483796\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157#issuecomment-373483796\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/157\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/157\">Issue #157</a></p>\n<blockquote>\n<p>if you start thinking about using cds-hooks in the configuration part of an EHR, or outside an EHR altogether, then you can quickly come up with scenarios where the host doesn't have a patient or practitioner resource</p>\n</blockquote>",
        "id": 153945203,
        "sender_full_name": "Github Notifications",
        "timestamp": 1521139651
    }
]