[
    {
        "content": "<p>kpshek opened <a href=\"https://github.com/cds-hooks/docs/issues/50\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50\">Issue #50</a></p>\n<blockquote>\n<p>In discussion with @brynrhodes and <span class=\"user-mention\" data-user-email=\"isaacvetter@gmail.com\" data-user-id=\"558\">@Isaac Vetter</span> regarding aligning Clinical Reasoning and CDS Hooks, one of the topics of discussion was around how Clinical Reasoning allows the EHR to include to the CDS service that it should evaluate it's rules at the specified date/time (<code>evaluteAt</code> field). This is used for testing or debugging purposes in Clinical Reasoning.</p>\n<p><a href=\"https://tools.ietf.org/html/rfc7089#section-2.1.1\" target=\"_blank\" title=\"https://tools.ietf.org/html/rfc7089#section-2.1.1\">rfc7089</a> defines an <code>Accept-Datetime</code> HTTP request header to accomplish this same functional goal. In our case, the EHR would send the <code>Accept-Datetime</code> HTTP header in the CDS Service request. The CDS Service would evaluate it's decision support logic as of this given datetime.</p>\n<p>Per rfc7089, the CDS Service should also return a response header in this scenario with the <code>Memento-Datetime</code> HTTP header set to the datetime the decision support was evaluated at.</p>\n<p>It is worth mentioning that in order for the decision support rules to be evaluated at an arbitrary datetime, all services and systems used by the CDS Service must be capable of supporting this concept. This includes both the EHR and FHIR server who must be capable of querying FHIR resources at the given datetime.</p>\n</blockquote>",
        "id": 153889985,
        "sender_full_name": "Github Notifications",
        "timestamp": 1494881243
    },
    {
        "content": "<p>des4900 <a href=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-301761841\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-301761841\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/50\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50\">Issue #50</a></p>\n<blockquote>\n<p>Another use case for evaluating CDS at a specified date-time is for scheduling services and providers and patients for routine interventions or analysis in the future.  For example, it can be used to determine that a patient needs certain lab work done in advance of an upcoming appointment, or simply that a patient needs to have a preventative appointment, and should be contacted.</p>\n</blockquote>",
        "id": 153890080,
        "sender_full_name": "Github Notifications",
        "timestamp": 1494936508
    },
    {
        "content": "<p>euvitudo <a href=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-302249630\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-302249630\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/50\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50\">Issue #50</a></p>\n<blockquote>\n<p>I would prefer <code>evaluateAt</code> (or some variation) to be part of the payload.</p>\n<p>I would prefer not to have to implement RFC 7089 on the backend.  Some reasons include:</p>\n<ul>\n<li>RFC 7089 is not an official standard.</li>\n<li>GET and HEAD are mentioned in the RFC, but POST is not, and in fact, in the context of the RFC, POST doesn't make sense, as the RFC is all about obtaining past versions of Web documents.</li>\n<li>Implementing this would be overly complex.</li>\n</ul>\n<p>Finally, it seems relevant that a CDS Service should indicate what features it implements (much like the CapabilityStatement).  If it cannot support an <code>evaluateAt</code> (or variation), then it simply doesn't include that in its service metadata.  <code>prefetch</code> is already stating what it would prefer to have included in the request payload.</p>\n</blockquote>",
        "id": 153890328,
        "sender_full_name": "Github Notifications",
        "timestamp": 1495060242
    },
    {
        "content": "<p>yashaskram <a href=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-302540616\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-302540616\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/50\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50\">Issue #50</a></p>\n<blockquote>\n<p>I might be completedly off base here with my understanding of this ask.</p>\n<ul>\n<li>Is this a scenarios where CDS service provider is expected to queue up the hook request until evaluateAt ?</li>\n<li>How would CDS Hook service get the FHIR data at evaluateAt time? Is the expectation that the access token would live until evaluateAt + x ? </li>\n<li>And also how does EHR handle card response when EHR user close the patient chart before evaluateAt?</li>\n</ul>\n<p>In general  I agree with <span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span>  that it should part of the payload (from implementation efforts perspective) if we plan to have this supported as part of CDS Hook spec. </p>\n</blockquote>",
        "id": 153890477,
        "sender_full_name": "Github Notifications",
        "timestamp": 1495141365
    },
    {
        "content": "<p>kpshek milestoned <a href=\"https://github.com/cds-hooks/docs/issues/50\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50\">Issue #50</a></p>",
        "id": 153892319,
        "sender_full_name": "Github Notifications",
        "timestamp": 1496694132
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-306372485\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-306372485\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/50\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50\">Issue #50</a></p>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span> &amp; @yashaskram - Thanks for your thoughts / comments on this issue!</p>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span>: RFC 7089 is not an official standard.</p>\n</blockquote>\n<p>My original intention of suggesting RFC 7089 was to leverage work that had already been done for a similar concept. I realize it isn't a standard but neither is many other concepts we're designing. :-)</p>\n<p>However, I given that RFC 7089 doesn't call out POST requests as supporting <code>Accept-Datetime</code> in addition to that we're only using a small portion of this RFC, I agree that we shouldn't reference RFC 7089 or use the name <code>Accept-Datetime</code>.</p>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span>: Implementing this would be overly complex</p>\n</blockquote>\n<p>How would a request header to the CDS Service be overly complex to read/handle? Whether it is a request header or a POST body parameter, it seems just as easy to implement IMHO. For instance, in Rails, we're talking about the difference between:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"c1\"># request header</span>\n<span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">headers</span><span class=\"o\">[</span><span class=\"s1\">&#39;Evaluate-At-Datetime&#39;</span><span class=\"o\">]</span>\n\n<span class=\"c1\"># POST body param</span>\n<span class=\"n\">params</span><span class=\"o\">[</span><span class=\"s1\">&#39;Evaluate-At-Datetime&#39;</span><span class=\"o\">]</span>\n</pre></div>\n\n\n<p>In Java, reading a request header is also easy:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"c1\">// request is a javax.servlet.http.HttpServletRequest</span>\n<span class=\"n\">request</span><span class=\"o\">.</span><span class=\"na\">getHeader</span><span class=\"o\">(</span><span class=\"s\">&quot;Evaluate-At-Datetime&quot;</span><span class=\"o\">);</span>\n\n<span class=\"c1\">// Or, if we&#39;re dealing with a connection of type java.net.URLConnection</span>\n<span class=\"n\">connection</span><span class=\"o\">.</span><span class=\"na\">getHeaderFields</span><span class=\"o\">().</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"s\">&quot;Evaluate-At-Datetime&quot;</span><span class=\"o\">);</span>\n</pre></div>\n\n\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span>: Finally, it seems relevant that a CDS Service should indicate what features it implements (much like the CapabilityStatement). If it cannot support an evaluateAt (or variation), then it simply doesn't include that in its service metadata. prefetch is already stating what it would prefer to have included in the request payload.</p>\n</blockquote>\n<p>Just as important if the CDS Service supports this functionality is that the EHR and more importantly FHIR server can support this functionality. We do not something akin to the CapabilityStatement today. The CDS Service definition in Discovery does describe each CDS Service, but I wouldn't equate it to a CapabilityStatement. I'd prefer to avoid venturing into that domain for the time being.</p>\n<p>@yashaskram - This use case originally came from Ken, @brynrhodes, &amp; <span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span>'s team at Univ of Utah where with Clinical Reasoning, they can evaluate CDS at a given point in time. For instance, they can answer questions like \"What decision support was shown to user U for patient P last week on May 30, 2017 8:00am\"? This is very cool functionality but requires the <em>entire</em> system to support this sophisticated date-based querying. Critically, the FHIR server must support these time based queries, none of which are support by production FHIR servers from the major commercial EHR vendors today. The Univ of Utah implementation supports it because they have built this all themselves.</p>\n<blockquote>\n<p>@yashaskram: In general I agree with <span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span> that it should part of the payload (from implementation efforts perspective) if we plan to have this supported as part of CDS Hook spec.</p>\n</blockquote>\n<p>I also think it's important to note that this feature is going to be an edge case in that it will not see widespread adoption. I say this because in order for this 'evaluate at' functionality to be supported, the underlying FHIR server must support these types of queries. Currently, I do not know of any EHR vendor that has implemented this functionality. This is why I would prefer keeping this out of the CDS Service request body as we would be defining a new request field for something that is not widely implemented. This is why the request header was appealing to me.</p>\n<p><span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span> - What about this revised proposal?</p>\n<p><code>Evaluate-At-Timestamp</code> - A request header specified by the EHR In the CDS Service request to indicate the timestamp used by the CDS Service as the notion of 'now'. If the CDS Service is able to honor this timestamp, its response back to the EHR must include the <code>Evaluate-At-Timestamp</code> header with the same timestamp value. The timestamp value is an ISO 8601 UTC timestamp using the format YYYY-MM-DDTHH:MM:SSZ</p>\n</blockquote>",
        "id": 153892349,
        "sender_full_name": "Github Notifications",
        "timestamp": 1496720101
    },
    {
        "content": "<p>euvitudo <a href=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-306379723\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-306379723\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/50\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50\">Issue #50</a></p>\n<blockquote>\n<p>@kpshek:</p>\n<blockquote>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span>: RFC 7089 is not an official standard.</p>\n</blockquote>\n<p>My original intention of suggesting RFC 7089 was to leverage work that had already been done for a similar concept. I realize it isn't a standard but neither is many other concepts we're designing. :-)</p>\n</blockquote>\n<p>So you don't intend for cds-hooks to become a standard?</p>\n<blockquote>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span>: Implementing this would be overly complex</p>\n</blockquote>\n<p>How would a request header to the CDS Service be overly complex to read/handle? Whether it is a request header or a POST body parameter, it seems just as easy to implement IMHO. For instance, in Rails, we're talking about the difference between:</p>\n</blockquote>\n<p>You take my comment out of context.  What I said was a bullet point to implementing RFC 7089.</p>\n<blockquote>\n<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span>: Finally, it seems relevant that a CDS Service should indicate what features it implements (much like the CapabilityStatement). If it cannot support an evaluateAt (or variation), then it simply doesn't include that in its service metadata. prefetch is already stating what it would prefer to have included in the request payload.</p>\n</blockquote>\n<p>Just as important if the CDS Service supports this functionality is that the EHR and more importantly FHIR server can support this functionality. We do not something akin to the CapabilityStatement today. The CDS Service definition in Discovery does describe each CDS Service, but I wouldn't equate it to a CapabilityStatement. I'd prefer to avoid venturing into that domain for the time being.</p>\n</blockquote>\n<p>In my mind the CDS Hooks Discovery mechanism is indeed equivalent to a CapabilityStatement.  Also in my mind is the fact there's no way around defining it as such.</p>\n<blockquote>\n<blockquote>\n<p>@yashaskram: In general I agree with <span class=\"user-mention\" data-user-email=\"euvitudo@gmail.com\" data-user-id=\"821\">@Phillip Warner</span> that it should part of the payload (from implementation efforts perspective) if we plan to have this supported as part of CDS Hook spec.</p>\n</blockquote>\n<p>I also think it's important to note that this feature is going to be an edge case in that it will not see widespread adoption. I say this because in order for this 'evaluate at' functionality to be supported, the underlying FHIR server must support these types of queries. Currently, I do not know of any EHR vendor that has implemented this functionality. This is why I would prefer keeping this out of the CDS Service request body as we would be defining a new request field for something that is not widely implemented. This is why the request header was appealing to me.</p>\n</blockquote>\n<p>I honestly see this as no different than supporting the request header for this use case.</p>\n<p>At any rate, if you insist on a header, naming the header Evaluate-At-DateTime would be my preference; requiring it to conform to ISO 8601 would be fine; requiring UTC is unreasonable, as ISO 8601 supports time zones.  Any decent Date-Time library should be able to support this.</p>\n</blockquote>",
        "id": 153892365,
        "sender_full_name": "Github Notifications",
        "timestamp": 1496723840
    },
    {
        "content": "<p>kpshek <a href=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-306384530\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50#issuecomment-306384530\">commented</a> on <a href=\"https://github.com/cds-hooks/docs/issues/50\" target=\"_blank\" title=\"https://github.com/cds-hooks/docs/issues/50\">Issue #50</a></p>\n<blockquote>\n<blockquote>\n<p>So you don't intend for cds-hooks to become a standard?</p>\n</blockquote>\n<p>Of course I want CDS Hooks to be a standard. <img alt=\"😄\" class=\"emoji\" src=\"/static/generated/emoji/images/emoji/unicode/1f604.png\" title=\"😄\"> Sorry, my original comment wasn't clear. What I intended to get across was that it didn't matter to me that RFC 7089 wasn't a standard because most of everything that we're creating also isn't a standard right now. At any rate, this is moot because I agree with you that using RFC 7089 is a good choice. <img alt=\"😜\" class=\"emoji\" src=\"/static/generated/emoji/images/emoji/unicode/1f61c.png\" title=\"😜\"> </p>\n<blockquote>\n<p>You take my comment out of context. What I said was a bullet point to implementing RFC 7089.</p>\n</blockquote>\n<p>I'm sorry, I didn't mean to take your comment out of context. I see now that you were probably referring to the complexity of implementing all of RFC 7089. I completely agree it is far more involved and contains more than the small piece I was proposing we leverage.</p>\n<blockquote>\n<p>In my mind the CDS Hooks Discovery mechanism is indeed equivalent to a CapabilityStatement. Also in my mind is the fact there's no way around defining it as such.</p>\n</blockquote>\n<p>I agree our Discovery endpoint is closely related to the CapabilityStatement in FHIR. I'm just trying to keep it as simple as possible for as long as possible. <img alt=\"😄\" class=\"emoji\" src=\"/static/generated/emoji/images/emoji/unicode/1f604.png\" title=\"😄\"> </p>\n<blockquote>\n<p>requiring UTC is unreasonable, as ISO 8601 supports time zones. Any decent Date-Time library should be able to support this</p>\n</blockquote>\n<p>ISO 8601 support time zone <em>offsets</em> but this is a different concept than timezones. Timezone offsets have not concept of DST whereas timezones do. For instance, given an ISO 8601 date of <code>2005-10-30T02:00:00-05:00</code>, what is the correct UTC value? Here is Java code which illustrates this issue:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">org.joda.time.DateTimeZone</span><span class=\"o\">;</span>\n<span class=\"kn\">import</span> <span class=\"nn\">org.joda.time.Instant</span><span class=\"o\">;</span>\n\n<span class=\"n\">Instant</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Instant</span><span class=\"o\">(</span><span class=\"s\">&quot;2005-10-30T02:00:00-05:00&quot;</span><span class=\"o\">);</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">);</span> <span class=\"c1\">// 2005-10-30T07:00:00.000Z</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">.</span><span class=\"na\">toDateTime</span><span class=\"o\">(</span><span class=\"n\">DateTimeZone</span><span class=\"o\">.</span><span class=\"na\">UTC</span><span class=\"o\">));</span> <span class=\"c1\">// 2005-10-30T07:00:00.000Z</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">.</span><span class=\"na\">toDateTime</span><span class=\"o\">(</span><span class=\"n\">DateTimeZone</span><span class=\"o\">.</span><span class=\"na\">forOffsetHours</span><span class=\"o\">(-</span><span class=\"mi\">5</span><span class=\"o\">)));</span> <span class=\"c1\">// 2005-10-30T02:00:00.000-05:00</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">.</span><span class=\"na\">toDateTime</span><span class=\"o\">(</span><span class=\"n\">DateTimeZone</span><span class=\"o\">.</span><span class=\"na\">forID</span><span class=\"o\">(</span><span class=\"s\">&quot;America/Chicago&quot;</span><span class=\"o\">)));</span> <span class=\"c1\">// 2005-10-30T01:00:00.000-06:00</span>\n<span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">.</span><span class=\"na\">toDateTime</span><span class=\"o\">(</span><span class=\"n\">DateTimeZone</span><span class=\"o\">.</span><span class=\"na\">forID</span><span class=\"o\">(</span><span class=\"s\">&quot;America/Indiana/Indianapolis&quot;</span><span class=\"o\">)));</span> <span class=\"c1\">// 2005-10-30T02:00:00.000-05:00</span>\n</pre></div>\n\n\n<p>So, if we want to support time zones we need to use an ISO 8601 timestamp <em>and</em> a time zone. However, if we align on UTC, we will not have this issue.</p>\n</blockquote>",
        "id": 153892385,
        "sender_full_name": "Github Notifications",
        "timestamp": 1496726306
    }
]