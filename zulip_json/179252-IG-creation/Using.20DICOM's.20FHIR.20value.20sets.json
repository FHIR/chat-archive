[
    {
        "content": "<p>Hi. I have this kind of errors generated in QA report, related to referencing DICOM value sets within the FHIR profiles : </p>\n<div class=\"codehilite\"><pre><span></span><code>ValueSet http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_33.html not found by validator\n</code></pre></div>\n<p>The QA report is under this link: <a href=\"https://build.fhir.org/ig/HL7/fhir-radiation-dose-summary-ig/qa.html\">https://build.fhir.org/ig/HL7/fhir-radiation-dose-summary-ig/qa.html</a><br>\nAnother kind of error is reported if we use direct json link to the value set definition: </p>\n<div class=\"codehilite\"><pre><span></span><code>The valueSet reference ftp://medical.nema.org/medical/dicom/resources/valuesets/fhir/json/CID_4052.json on element Observation.component.value[x] could not be resolved\n</code></pre></div>\n<p>Does someone experienced using successfully DICOM value sets in IGs ?</p>",
        "id": 244587352,
        "sender_full_name": "Abderrazek Boufahja",
        "timestamp": 1625154340
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> might have an answer. Your valueset canonical URLs look right to me. However, I don't think that the DICOM value sets are in the terminology server referenced by the build. There should be a way to have a valueset resource in your IG for validation, but not included as part of the output, but I don't know how to do that.</p>",
        "id": 244592931,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1625156795
    },
    {
        "content": "<p>They should be in UTG. I get them in my basicAudit IG.</p>",
        "id": 244595338,
        "sender_full_name": "John Moehrke",
        "timestamp": 1625157987
    },
    {
        "content": "<p>I do have the same problem, however I am using <a href=\"http://dicom.nema.org/resources/ontology/DCM\">http://dicom.nema.org/resources/ontology/DCM</a> which is supposedly the URL that shall be used, according to <a href=\"https://terminology.hl7.org/CodeSystem-v3-DCM.html\">https://terminology.hl7.org/CodeSystem-v3-DCM.html</a>. I have noticed there is a mismatch from what ImagingStudy Resource has defined versus the UTG.</p>",
        "id": 244668321,
        "sender_full_name": "Diana_Ovelgoenne",
        "timestamp": 1625211074
    },
    {
        "content": "<p>Thank you for your different responses. I am also using codes coming from  <a href=\"http://dicom.nema.org/resources/ontology/DCM\">http://dicom.nema.org/resources/ontology/DCM</a>  which works fine. However, when I reference Value Sets, it does not validate well. <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span>  , I am not able to find references to DICOM value sets in BasicAudit IG , but only usage of codes from DICOM Code System.</p>",
        "id": 244684067,
        "sender_full_name": "Abderrazek Boufahja",
        "timestamp": 1625221475
    },
    {
        "content": "<p>Ah, they might not been pulled into utg.. you can pull them from dicom... They are published in the dicom publication in various formats including as fhir.</p>",
        "id": 244712078,
        "sender_full_name": "John Moehrke",
        "timestamp": 1625236842
    },
    {
        "content": "<p>I think the issue is not finding the value sets manually, but rather referencing them from an IG, and failing IG validation.</p>",
        "id": 244725432,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1625242697
    },
    {
        "content": "<p>You can tell the ig build about URI that are special...  In the IHE FormatCode IG I have to add the DICOM oid to the ignore warnings.</p>",
        "id": 245027783,
        "sender_full_name": "John Moehrke",
        "timestamp": 1625572675
    },
    {
        "content": "<p>For me adding the Valuesets generated by DICOM is not a problem (except that the experimental = false needs to be removed or there is a compiling error. The same goes for codes inside the ontology, not a problem. But the question that I have is: when needing to define on code either a CID or a TID, how are these supposed to be defined when putting them on the corresponding code value are they CID_xxx, CID xxx, xxx, sect_CID_xxx? And shall the code system  be <a href=\"http://dicom.nema.org/medical/Dicom/current/output/chtml/part16\">http://dicom.nema.org/medical/Dicom/current/output/chtml/part16</a> instead of <a href=\"http://dicom.nema.org/resources/ontology/DCM\">http://dicom.nema.org/resources/ontology/DCM</a> ?</p>\n<p>I also have problems when using ImagingStudy, as the IG Publisher complains about the URL for the SOP classes and the one from radlex for imaging procedure code.</p>\n<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> <span class=\"user-mention\" data-user-id=\"197037\">@Jonathan Whitby</span>   do you happen to know the answer?  Please help! the ImagingStudy errors are the only missing errors on my IG.</p>",
        "id": 245163822,
        "sender_full_name": "Diana_Ovelgoenne",
        "timestamp": 1625656712
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"197447\">@Diana_Ovelgoenne</span>, I haven't poked around with DICOM value sets in a while, so bear with my poor memory.</p>\n<ul>\n<li>For codes, the system should be <a href=\"http://dicom.nema.org/resources/ontology/DCM\">http://dicom.nema.org/resources/ontology/DCM</a>.</li>\n<li>For value sets/context groups, the canonical url of the value set should be the appropriate section of the chunked html version of the standard (e.g., <a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_33.html\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_33.html</a> for modality). The system URL of the codes in the value set is the DICOM ontology, or the LOINC code system, etc.</li>\n<li>SOP classes and other OIDs should use urn:dicom:uid (or, perhaps, urn:ietf:rfc:3986 -- there is some ambiguity) as the system.</li>\n<li>RSNA and LOINC have changed the documentation for Radlex codes since we orginally wrote the binding. I'd point you at the \"LOINC/RSNA Radiology Playbook and Playbook Core\" section of <a href=\"https://loinc.org/fhir/\">https://loinc.org/fhir/</a> to get the latest value set.</li>\n</ul>",
        "id": 245228987,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1625685427
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> thanks for the answer, i have updated my canonicals as per your example. still a little fuzzy to handle with shorthand.<br>\n<span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> I am doing the recommendation from Elliot to put the full URL at the canonical, but sometimes, not always, sushi complains that I need to put a code system rather than this URL. I am truncating in those scenarios from  the definition \"<a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_3805.html#CID_3805\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_3805.html#CID_3805</a>\" to \"<a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16#CID_3805\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16#CID_3805</a>\" and then sushi doesn't complain. But this is happening just with some of the CID values I need to put in, not with all. Do you happen to know why there's this inconsistency? Or how I shall better handle it?</p>",
        "id": 245412583,
        "sender_full_name": "Diana_Ovelgoenne",
        "timestamp": 1625817693
    },
    {
        "content": "<p>I kept the warnings related to DICOM ValueSet not found by validator, I will suppose that the canonical URL is well (thanks <span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> for having already confirmed this). I have another error from the same kind : </p>\n<div class=\"codehilite\"><pre><span></span><code>    Error from server: Unable to provide support for code system http://snomed.info/srt\n</code></pre></div>\n<p>This happen when I reference the DICOM value sets as \"include\" within a new value set: <a href=\"https://build.fhir.org/ig/HL7/fhir-radiation-dose-summary-ig/ValueSet-radiopharmaceutical-rds-vs.html\">https://build.fhir.org/ig/HL7/fhir-radiation-dose-summary-ig/ValueSet-radiopharmaceutical-rds-vs.html</a> . The Publisher try to create a global expand of the new value set, and end up with an error:<br>\n<a href=\"/user_uploads/10155/k3wp9VB24hueP49P319WGz7u/image.png\">image.png</a><br>\nand the error reported below about the code system <a href=\"http://snomed.info/srt\">http://snomed.info/srt</a><br>\n<a href=\"http://snomed.info/srt\">http://snomed.info/srt</a> is an old code system used by DICOM, and the latest version of DICOM has migrated to SCT. Thus, I think somewhere in the terminology server there are old DICOM value sets with the old codes from SRT and not SCT. But, I cannot be sure about it.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/k3wp9VB24hueP49P319WGz7u/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/k3wp9VB24hueP49P319WGz7u/image.png\"></a></div>",
        "id": 245412606,
        "sender_full_name": "Abderrazek Boufahja",
        "timestamp": 1625817713
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197447\">@Diana_Ovelgoenne</span> -- I do not have any specific knowledge about DICOM or the nuances of using it in FHIR, so please consider that as you read my response! ;-)</p>\n<p>When I download the \"FHIR JSON\" from <a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_3805.html\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_3805.html</a>, it gave me a <em>ValueSet</em> definition containing <em>SNOMED-CT</em> codes. But it sounds like you want to reference CID 3805 as a <em>code</em> -- not a ValueSet.  Is that right?</p>\n<p>As <span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> noted above, FHIR defines <code>http://dicom.nema.org/resources/ontology/DCM</code> as the proper canonical URL for DICOM Controlled Terminology <em>codes</em>, but I've noted that it does not contain CID 3805 as a valid code (perhaps because it only includes codes from <em>Chapter D</em>?).</p>\n<p>The problem with using <code>http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_3805.html</code> when referencing a <em>code</em> is that this URL is actually the canonical for a <em>ValueSet</em> (which I confirmed by downloading the FHIR JSON for it).  You cannot use a ValueSet canonical as the <em>system URL</em> for a code.  You can only use a CodeSystem canonical as the system URL for a code.</p>\n<p>When you do {url}#{code} in FSH, SUSHI tries to resolve the URL to ensure it is a valid CodeSystem URL.  If it resolves to something else (like a ValueSet), SUSHI will emit an error.  But if SUSHI cannot resolve it, then SUSHI assumes it is OK (because it would be annoying if SUSHI emitted an error for every URL it cannot resolve to a definition).  This explains why you sometimes get errors and sometimes do not -- it all depends on if the URL you're using is recognized by SUSHI or not.  And whether or not it is recognized may depend on what dependencies you've declared in your config.</p>",
        "id": 245460880,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625846071
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197447\">@Diana_Ovelgoenne</span>, you mention \"<a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16#CID_3805\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16#CID_3805</a>\". The actual canonical URL for that value set is \"<a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_3805.html\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_3805.html</a>\". Also, I don't see any SNOMED RT codes in the radiopharmaceutical value set you mention (there are a couple listed as synonyms, but none as primary values), so I'm not sure where your error is from.</p>\n<p>Just to make sure there isn't some confusion: there is a canonical URL that defines a code system. All codes from that system are qualified by that canonical URL, this is how we tell 12345 in SNOMED CT from 12345 in DICOM. Separately, there are value sets, which identify sets of codes from one or more code systems that can be used together for a purpose, like the radiopharmaceutical value set. The value set also has a canonical URL as its identifier, but that is the identifier of the value set, not the system for the values in the value set. The value set URL doesn't actually show up in a resource instance, only in profile or resource definitions. It is the code system for the code used that is included in the resource.</p>\n<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>, although I don't think it applies to this case, I believe fragments are allowed in canonical URLs. Is there some way to use such a code system in FSH? e.g. \"<a href=\"http://some.sdo.org/CodeSystems.html#systemABC#1234\">http://some.sdo.org/CodeSystems.html#systemABC#1234</a>\" (code value 1234 in code system \"<a href=\"http://some.sdo.org/CodeSystems.html#systemABC\">http://some.sdo.org/CodeSystems.html#systemABC</a>\")?</p>",
        "id": 245465153,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1625848169
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> -- regarding your last question -- that's a good point.  I was kind of hoping that SUSHI would do the right thing (and use the <em>last</em> <code>#</code> as the separator), but it seems that it uses the first instead: <a href=\"https://fshschool.org/FSHOnline/#/share/3htRJDk\">https://fshschool.org/FSHOnline/#/share/3htRJDk</a></p>\n<p>I tried to see if maybe using an alias would take care of it, but that reveals a different problem: <a href=\"https://fshschool.org/FSHOnline/#/share/3yH3b4t\">https://fshschool.org/FSHOnline/#/share/3yH3b4t</a></p>\n<p><em>(sigh)</em></p>",
        "id": 245470886,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625850858
    },
    {
        "content": "<p>I'll log the bugs.</p>",
        "id": 245470963,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625850899
    },
    {
        "content": "<p>Logged as <a href=\"https://github.com/FHIR/sushi/issues/872\">SUSHI#872</a> and <a href=\"https://github.com/FHIR/sushi/issues/873\">SUSHI#873</a>.</p>",
        "id": 245472074,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1625851498
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span>  All what you have been saying works fine for the CID, but what is it with the TID objects? Their concept name is e.g. \"TID 3911 Plaque Properties\", they aren't codified,  whereas the canonical is <a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_3911.html\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_3911.html</a>. So if I would want to represent this as a Parent Observation's code in FSH I would put \"<a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_3911.html\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_3911.html</a>\" only? I assume FSH would be expecting a value for the code and not just the code system.</p>",
        "id": 245666862,
        "sender_full_name": "Diana_Ovelgoenne",
        "timestamp": 1626084377
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197447\">@Diana_Ovelgoenne</span>, I don't understand, are you trying to treat the template IDs as codes, or having trouble with the codes used within the template? The codes within the template should be straight forward: <code>EV (122376, DCM, \"Total Plaque Volume\")</code> is value 122376 from code system <a href=\"http://dicom.nema.org/resources/ontology/DCM\">http://dicom.nema.org/resources/ontology/DCM</a>. I don't know that there is a defined value set of the template IDs, but I suppose we could ask for DICOM to create one, if you need it.</p>",
        "id": 245758767,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1626129284
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> what I need is the template IDs as codes, if you see the example I copied <a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_3911.html\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_TID_3911.html</a> the templates are nested (see calcium scoring results in line 4), so I need an identifier per template so when I put them into FHIR, I can say code = TID Id. I can't use the Total plaque Volume as a whole identifier of the properties, because this is just one out of the 6 defined.<br>\nMy idea is to have a Diagnostic Report using this <a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CTMRCardiovascularAnalysisReportTemplates.html\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CTMRCardiovascularAnalysisReportTemplates.html</a><br>\nwhere each section, but 2 (the DCM ones), is a Parent Observation which needs a code. and if you dig in this template you will see that there are many references to different TIDs.</p>",
        "id": 245783616,
        "sender_full_name": "Diana_Ovelgoenne",
        "timestamp": 1626157510
    },
    {
        "content": "<p>regarding the error I get : unknown Code System, I think I found it. </p>\n<div class=\"codehilite\"><pre><span></span><code>    Error from server: Unable to provide support for code system http://snomed.info/srt\n</code></pre></div>\n<p>It is related to the DICOM value sets in <a href=\"http://tx.fhir.org\">tx.fhir.org</a> : <a href=\"http://tx.fhir.org/r4/ValueSet/dicm-25-Radiopharmaceuticals\">http://tx.fhir.org/r4/ValueSet/dicm-25-Radiopharmaceuticals</a> <br>\nThis ValueSet in the tx server is an old version (20160314) of the value set <a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_25.html\">http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_25.html</a>  <br>\nThe value set in the tx server refer to the code system <a href=\"http://snomed.info/srt\">http://snomed.info/srt</a> , however the value set in DICOM website refer to <a href=\"http://snomed.info/sct\">http://snomed.info/sct</a> : ftp://medical.nema.org/medical/dicom/resources/valuesets/fhir/xml/CID_25.xml (this is a move made by DICOM during last year I think).</p>",
        "id": 245818552,
        "sender_full_name": "Abderrazek Boufahja",
        "timestamp": 1626180304
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197447\">@Diana_Ovelgoenne</span> If I understand you correctly, you're trying to recreate a DICOM SR attribute-for-attribute in a FHIR DiagnosticReport/<br>\nComposition, which is a use case I'd never considered (and I'm not sure I support). There isn't an obvious code system or value set to use for the TIDs, although you could use your own, at least for now. I suggest discussing this with II/WG-27, both as to whether this encoding is the best approach, and how to resolve the terminology issues. There are a couple of other \"codes\" used in DICOM (like the list of SOP classes, or false-color pallettes) that also need value sets defined, so this could be done at the same time.</p>",
        "id": 245879472,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1626206618
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"253132\">@Abderrazek Boufahja</span> , I think this needs <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> to work with <span class=\"user-mention\" data-user-id=\"193145\">@David Clunie</span> to ensure that updates to the DICOM terminology gets into the terminology server on a regular basis.</p>",
        "id": 245879910,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1626206805
    },
    {
        "content": "<p>yes, I have opened this topic multiple times... I think we need an advocate on the vocabulary HTA team to get the right things done. Im working on similar with IHE...</p>",
        "id": 245887901,
        "sender_full_name": "John Moehrke",
        "timestamp": 1626210275
    },
    {
        "content": "<p>with IHE I have taken the additional step to wrap the codeSystem and valueSet resources into an IG; which I think will help with the situation, but as of now don't have any evidence that it is better</p>",
        "id": 245888061,
        "sender_full_name": "John Moehrke",
        "timestamp": 1626210323
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> -- regarding how to specify a code whose system has a fragment in it (<a href=\"https://github.com/FHIR/sushi/issues/873\">SUSHI #873</a>), apparently I totally forgot that you can escape the <code>#</code> sign:</p>\n<div class=\"codehilite\"><pre><span></span><code>http://some.sdo.org/CodeSystems.html\\#systemABC#1234\n</code></pre></div>\n<p><a href=\"https://fshschool.org/FSHOnline/#/share/2TzSule\">Proof it works</a>.  Sorry it took us so long to figure out that it's been working all along.</p>",
        "id": 247258482,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1627331906
    },
    {
        "content": "<p>Well, that's obvious... once you point it out.</p>\n<p><span class=\"user-mention\" data-user-id=\"197447\">@Diana_Ovelgoenne</span>, not sure if this is helpful to your issue.</p>",
        "id": 247273658,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1627339625
    }
]