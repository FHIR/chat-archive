[
    {
        "content": "<p>What does \"Internal error: illegal function name null() in discriminator\" mean? I'm seeing it in my IG at <a href=\"https://build.fhir.org/ig/hl7dk/dk-medcom/branches/corrections/qa.html\">https://build.fhir.org/ig/hl7dk/dk-medcom/branches/corrections/qa.html</a></p>\n<p>As far as I can tell, my profile seems correct. Is this a bug I introduced in the discriminator expression or is it a bug in the publisher?</p>\n<p><a href=\"/user_uploads/10155/Q7u7WSImagbvQSP8fyGhlTA0/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/Q7u7WSImagbvQSP8fyGhlTA0/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/Q7u7WSImagbvQSP8fyGhlTA0/image.png\"></a></div>",
        "id": 207964188,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598363106
    },
    {
        "content": "<p>my intention is that I would like to allow many destinations on my message header, but only a single one with the Extension value of 'primary'</p>",
        "id": 207964321,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598363179
    },
    {
        "content": "<p>What's your discriminator?</p>",
        "id": 207964804,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598363434
    },
    {
        "content": "<p>extension('http://medcom.dk/fhir/medcom-core/StructureDefinition/medcom-messaging-destinationUseExtension').value[x].code</p>\n<p>(from <a href=\"https://github.com/hl7dk/dk-medcom/blob/corrections/input/resources/MedcomMessagingMessageHeader.StructureDefinition.xml#L53\">https://github.com/hl7dk/dk-medcom/blob/corrections/input/resources/MedcomMessagingMessageHeader.StructureDefinition.xml#L53</a>)</p>",
        "id": 207975379,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598368195
    },
    {
        "content": "<p>value[x] isn't legal in FHIRPath.  just say <code>value</code></p>",
        "id": 207976414,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598368565
    },
    {
        "content": "<p>as in - just value, or valueCoding or alike</p>",
        "id": 207976471,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598368591
    },
    {
        "content": "<p>?</p>",
        "id": 207976641,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598368682
    },
    {
        "content": "<p>I'm not sure that valueCoding is allowed either.  The element name is just value.  If you want to constrain the type, that's a separate filter.</p>",
        "id": 207976723,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598368713
    },
    {
        "content": "<p>but value.code is allowed?</p>",
        "id": 207976850,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598368784
    },
    {
        "content": "<p>thats pretty bold</p>",
        "id": 207976953,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598368808
    },
    {
        "content": "<p>value.code is fine.  FHIRPath works with collections - it's not strongly typed.  If value is a string then value.code will evaluate to an empty set.</p>",
        "id": 207977511,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598369049
    },
    {
        "content": "<p>thx - worked like a charm</p>",
        "id": 207982835,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598371637
    },
    {
        "content": "<p>(and someone maybe should do something about that error message .... <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> )</p>",
        "id": 207982876,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598371667
    },
    {
        "content": "<p>you probably know who that would be. Does that require a Jira?</p>",
        "id": 207982901,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598371682
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?</p>",
        "id": 207991861,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598375708
    },
    {
        "content": "<p>Jira is for the FHIR spec. If it's for the tools (publisher or template), you'd enter a github issue</p>",
        "id": 207992190,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598375839
    },
    {
        "content": "<p>ok then - should the spec then be fixed in order to give a specification specified error?</p>",
        "id": 207992377,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598375916
    },
    {
        "content": "<p>or are the publisher errors purely a matter of how the author of the publisher likes the error messages to be presented?</p>",
        "id": 207992495,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598375989
    },
    {
        "content": "<p>I'm trying to follow the issue. Is it about this <br>\n<a href=\"https://www.hl7.org/fhir/fhirpath.html#polymorphism\">https://www.hl7.org/fhir/fhirpath.html#polymorphism</a> <br>\n?</p>",
        "id": 207992908,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598376148
    },
    {
        "content": "<p>seems related</p>",
        "id": 207993875,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598376574
    },
    {
        "content": "<p>it would be awesome if the error had said something like: </p>\n<blockquote>\n<p>if you specify [x], you're doing it wrong. Look at <a href=\"https://www.hl7.org/fhir/fhirpath.html#polymorphism\">https://www.hl7.org/fhir/fhirpath.html#polymorphism</a>\"</p>\n</blockquote>",
        "id": 207994123,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598376678
    },
    {
        "content": "<p>:)</p>",
        "id": 207994156,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598376695
    },
    {
        "content": "<p>Sounds like a publisher thing then.</p>",
        "id": 207994249,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598376723
    },
    {
        "content": "<p>well ... I would believe it is in the FhirPathEngine ...</p>",
        "id": 207994322,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598376751
    },
    {
        "content": "<p>which is embedded in the publisher</p>",
        "id": 207994364,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598376773
    },
    {
        "content": "<p>so if I can find the time to reproduce it, I'll make an awesome PR so that I can get the awesome error message</p>",
        "id": 207994892,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598377002
    },
    {
        "content": "<p>Correct. I'm trying to look through the code .</p>",
        "id": 207994969,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598377046
    },
    {
        "content": "<p><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/376e4f0ef15f81c559c05ddb2a3bc4e2342fa06f/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils/FHIRPathEngine.java#L4868\">https://github.com/hapifhir/org.hl7.fhir.core/blob/376e4f0ef15f81c559c05ddb2a3bc4e2342fa06f/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils/FHIRPathEngine.java#L4868</a></p>",
        "id": 207995023,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598377077
    },
    {
        "content": "<p>or this<br>\n<a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/3ff241bcf89ba094b0e7bf1d850723f9f4a433c1/org.hl7.fhir.utilities/src/main/resources/Messages.properties#L563\">https://github.com/hapifhir/org.hl7.fhir.core/blob/3ff241bcf89ba094b0e7bf1d850723f9f4a433c1/org.hl7.fhir.utilities/src/main/resources/Messages.properties#L563</a></p>",
        "id": 207995109,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598377103
    },
    {
        "content": "<p>from what I can understand from the code I don't think you can get to \"if you're doing vaue[x], you're doing it wrong\". Perhaps you need to stick to \"you're just doing it wrong\".</p>",
        "id": 207995270,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598377179
    },
    {
        "content": "<p>and then add the RTFM thing</p>",
        "id": 207995376,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1598377207
    },
    {
        "content": "<p>well ... I can refine the expression at <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/376e4f0ef15f81c559c05ddb2a3bc4e2342fa06f/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils/FHIRPathEngine.java#L4868\">https://github.com/hapifhir/org.hl7.fhir.core/blob/376e4f0ef15f81c559c05ddb2a3bc4e2342fa06f/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils/FHIRPathEngine.java#L4868</a> and check if [0] is part of the expression. If that is the case it could be a candidate</p>",
        "id": 208008844,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598382654
    },
    {
        "content": "<p>this won't be easy. lexically, value[x] is perfectly valid</p>",
        "id": 208024001,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598389811
    },
    {
        "content": "<p>the engine could only decide that this is invalid much later, when it actually evaluates it</p>",
        "id": 208024043,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598389839
    }
]