[
    {
        "content": "<p>Somewhat inspired by a recent thread on <a class=\"stream\" data-stream-id=\"179280\" href=\"/#narrow/stream/179280-fhir.2Finfrastructure-wg\">#fhir/infrastructure-wg</a> and by some limitations that I'm running into with my development environment, I'm wondering if anyone is doing IG development in cloud containers? What I'm envisioning is putting a container in AWS that I can run the IG publisher in, along with Apache or similar pointing to the output directory, and then connecting to the container using VS Code remote development. (AWS only because I have a little experience, which is more than what I have on other platforms.)</p>",
        "id": 256806360,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1633727397
    },
    {
        "content": "<p>there's a docker somewhere</p>",
        "id": 257000775,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633916264
    },
    {
        "content": "<p>and <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> has been doing something like this for a long time</p>",
        "id": 257000781,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633916277
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span>  I dont understand the question. Are you asking if the igpub can run in a container? If that is the question, the answer is: yes</p>",
        "id": 257177224,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634032671
    },
    {
        "content": "<p>and if it can run in a container it can run basically everywhere - local and cloud</p>",
        "id": 257177364,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634032728
    },
    {
        "content": "<p>and - yes, that is what I do</p>",
        "id": 257177414,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634032752
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> , so, I know IG pub can run in a container, and have used the hl7fhir/ig-publisher-base image to do local development. I'm wondering about people who have experience using containers in the cloud. </p>\n<p>My local system is resource constrained, so I'd like to run IG publisher elsewhere (running it in a container on my local machine just makes it more resource constrained). Ideally, I'd like to take advantage of VSCode's remote development capabilities that lets me locally edit the IG files on a remote system, and run the builds on the remote system. I've tried setting up an AWS EC2 instance (EC2 = a regular AWS VM) and doing development in it both directly, and running docker in the VM, and that works. But it seems to be an extra level of virtualization that I should be able to avoid. So, my vision is to set up an AWS ECS (AWS container service) container that I can connect to directly from VSCode. I think my issue is less running IG publisher in the container, and more about setting up the container parameters themselves.</p>\n<p>I'll ping <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> to see if he has any experience to share.</p>",
        "id": 257262929,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1634068784
    },
    {
        "content": "<p>I'll see if I can throw together an example of using  Codespaces for this (this is a github feature I've been using more and more in my daily development)</p>",
        "id": 257263762,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634069069
    },
    {
        "content": "<p>I was looking at Codespaces briefly, but my impression is that it's limited to paid Github accounts.</p>",
        "id": 257268258,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1634071031
    },
    {
        "content": "<p>That's true, but same applies to cloud VMs, right?</p>",
        "id": 257271149,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634072307
    },
    {
        "content": "<p>True, but I'm already set up with an AWS account, but not with a paid Github account.</p>",
        "id": 257271818,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1634072623
    },
    {
        "content": "<p>There's also a story where you can also run VS Code locally and connect to a container hosted in any cloud server of your choice (<a href=\"https://code.visualstudio.com/docs/remote/containers\">https://code.visualstudio.com/docs/remote/containers</a>)</p>",
        "id": 257271824,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634072624
    },
    {
        "content": "<p>That'd let you run a docker container on AWS and connect from your local VS Code.</p>",
        "id": 257271906,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634072650
    },
    {
        "content": "<p>Anyway, I'll start with a self-contained example and see if it's any good.</p>",
        "id": 257271934,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634072665
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20development.20in.20the.20cloud/near/257271824\">said</a>:</p>\n<blockquote>\n<p>There's also a story where you can also run VS Code locally and connect to a container hosted in any cloud server of your choice (<a href=\"https://code.visualstudio.com/docs/remote/containers\">https://code.visualstudio.com/docs/remote/containers</a>)</p>\n</blockquote>\n<p>That's exactly where I was heading -- I just need to figure out how to set up the container in AWS.</p>",
        "id": 257272181,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1634072767
    },
    {
        "content": "<p>Sounds good; hopefully I'll have a working example of a container for you by the time you've got the AWS side of things set up.</p>",
        "id": 257273222,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634073249
    },
    {
        "content": "<p><a href=\"https://github.com/jmandel/smart-app-launch/tree/master/.devcontainer\">https://github.com/jmandel/smart-app-launch/tree/master/.devcontainer</a> has an example --</p>\n<ul>\n<li>you can add this same directory to your own project and update <a href=\"https://github.com/jmandel/smart-app-launch/blob/master/.devcontainer/devcontainer.json#L23\">https://github.com/jmandel/smart-app-launch/blob/master/.devcontainer/devcontainer.json#L23</a> to use your project name instead of <code>smart-app-launch</code> (there's obviously work that'd make this easier; right now just trying to get the rough shape working)</li>\n<li>this will be slow to create the container as it compiles ruby extensions right now (this'll easy to avoid by using a hosted docker image instead of re-building a Dockerfile every time)</li>\n</ul>",
        "id": 257277693,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634075631
    },
    {
        "content": "<p>I made a few improvements and put together a quick demo at <a href=\"https://youtu.be/4o9dDQM_zHA\">https://youtu.be/4o9dDQM_zHA</a></p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"4o9dDQM_zHA\" href=\"https://youtu.be/4o9dDQM_zHA\"><img src=\"https://uploads.zulipusercontent.net/b33af986916845b10cf967da794fb72d7316c390/68747470733a2f2f692e7974696d672e636f6d2f76692f346f396444514d5f7a48412f64656661756c742e6a7067\"></a></div>",
        "id": 257452134,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634166001
    },
    {
        "content": "<p>This is great, we are also doing this with the CQL VSCode plugin using codespaces: <br>\n<a href=\"/user_uploads/10155/BuXC7Pf4fPHDhSg_Jv_8nCpf/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/BuXC7Pf4fPHDhSg_Jv_8nCpf/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/BuXC7Pf4fPHDhSg_Jv_8nCpf/image.png\"></a></div>",
        "id": 257454995,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1634167739
    },
    {
        "content": "<p>Here's the .devcontainer we're using: <a href=\"https://github.com/alphora/cqf-ccc/tree/master/.devcontainer\">https://github.com/alphora/cqf-ccc/tree/master/.devcontainer</a></p>",
        "id": 257455041,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1634167778
    },
    {
        "content": "<p>That's beautiful--just what I was trying to do. <br>\nI'm still fighting with AWS--I think I should be able to run the container in Farscape on ECS (their \"serverless\" container service), but right now have only been able connect to the container when I'm running docker in an EC2 instance. (Also, the connection was via ssh; I haven't gone back and tried to do it via a container connection.) Since I was able to get something going, I may need to put aside perfecting it for now though.</p>",
        "id": 257477617,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1634185386
    },
    {
        "content": "<p>I use a docker image running in Azure DevOps, but I think the others here have all referenced something nicer ;)<br>\n(supporting our own internal CI-CD, and for some that don't do it often, running it locally)</p>",
        "id": 257518892,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1634210780
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> maybe there is something I'm not catching here - ... but AFAIK, you already draftet an IG setup using GH actions, which by the way works perfectly. It may just be me, but where does the need come from to have to step into the container that runs the build? Especially if its already running at e.g. github? Are you doing a lot of formatting in the templates or something like that?</p>",
        "id": 257580966,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634235492
    },
    {
        "content": "<blockquote>\n<p>where does the need come from to have to step into the container that runs the build?</p>\n</blockquote>\n<p>Elliot is looking for an easier or faster or more flexible way to edit IGs without having a local environment configured with all the dependencies.</p>",
        "id": 257584445,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634236906
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> and the turn-around time using eg. GH actions is insufficient?</p>",
        "id": 257586411,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634237691
    },
    {
        "content": "<p>arh .... ok ...... just looked at the times for our GH actions for the build ... and that is ~5 mins ... thats too long .... I get it</p>",
        "id": 257586670,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634237794
    },
    {
        "content": "<p>Yeah. And also, just not having to push code between every tweak, and having syntax highlighting, extensions, etc.</p>",
        "id": 257587420,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1634238097
    },
    {
        "content": "<p>Correct. I realize I could check in every change, but my preference is not to commit “transient” versions.  It has little to do with GitHub build times and more to do with my pitiful laptop.</p>",
        "id": 257591322,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1634239600
    }
]