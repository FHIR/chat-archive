[
    {
        "content": "<p>I am suddenly getting a bunch of broken links in my vital signs derived profiles.  When I open the resource html, the narrative now includes the narrative from the base vital signs profile which includes a bunch of links to value sets and such.  Except that those links are relative so they fail in my IGuide.  Why is the narrative generator including the vital signs narrative in my profile?</p>",
        "id": 207981555,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598371060
    },
    {
        "content": "<p>can you point to an example?</p>",
        "id": 207991001,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598375373
    },
    {
        "content": "<p>nothing has changed recently in this space to my knowledge. The links should not be relative, that's for sure. but Eric is right - where's an example?</p>",
        "id": 208022903,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598389235
    },
    {
        "content": "<p><a href=\"https://best-im.com/fhir-ig/StructureDefinition-ibm-fda-icsr-patientheight.html\">https://best-im.com/fhir-ig/StructureDefinition-ibm-fda-icsr-patientheight.html</a><br>\n<a href=\"https://best-im.com/fhir-ig/StructureDefinition-ibm-fda-icsr-patientlastmenstrualperiod.html\">https://best-im.com/fhir-ig/StructureDefinition-ibm-fda-icsr-patientlastmenstrualperiod.html</a></p>",
        "id": 208024132,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598389907
    },
    {
        "content": "<p>I'm not seeing any broken links there</p>",
        "id": 208024444,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598390059
    },
    {
        "content": "<p>Look at the 2nd one (Last Menstrual Period) and the Text Summary 1) ObservationStatus value set link, 3) Vital Signs value set link, etc.</p>\n<p>In general, that entire text summary is <em>NOT</em> from my profile but is seemingly imported from the base profile.  I've never seen this summary before nor has the link checker complained before.</p>",
        "id": 208030116,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598393059
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> I didn't generate that text that is a problem for Jean. I presume it's coming from the template somewhere</p>",
        "id": 208032541,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598394763
    },
    {
        "content": "<p>It's grabbing the [id]-summary.xhtml fragment.  Pretty sure that comes from the publisher.  I don't believe anything has been committed that overrides it - though it does look less sucky than it used to...  <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> ?</p>",
        "id": 208036834,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598397879
    },
    {
        "content": "<p>but that summary is the vitalsigns summary.  Why is it slurping it into my profile?  Does the publisher (or template?) slurp the summary of any based-on profile?</p>",
        "id": 208037596,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598398658
    },
    {
        "content": "<p>mmm  the summary is being inherited.... lemme see where that is defined. since I want to do custom summaries in the future.  but I don't recall anything in the templates.</p>",
        "id": 208037737,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598398765
    },
    {
        "content": "<p>and the weird thing is that this wasn't happening until I re-ran the publisher today.</p>",
        "id": 208037929,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598398919
    },
    {
        "content": "<p>template...</p>\n<div class=\"codehilite\"><pre><span></span><code>    <span class=\"nt\">&lt;div</span> <span class=\"na\">id=</span><span class=\"s\">&quot;tabs-summ&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;div</span> <span class=\"na\">id=</span><span class=\"s\">&quot;tbl-summ&quot;</span><span class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;p&gt;</span>This structure is derived from <span class=\"nt\">&lt;a</span> <span class=\"na\">href=</span><span class=\"s\">&quot;{{site.data.structuredefinitions[&#39;{{[id]}}&#39;].basepath}}&quot;</span><span class=\"nt\">&gt;</span>{{site.data.structuredefinitions[&#39;{{[id]}}&#39;].basename}}<span class=\"nt\">&lt;/a&gt;</span>\n        <span class=\"nt\">&lt;/p&gt;</span>\n        <span class=\"nt\">&lt;div</span> <span class=\"na\">id=</span><span class=\"s\">&quot;tbl-summ-inner&quot;</span><span class=\"nt\">&gt;</span>\n          <span class=\"nt\">&lt;a</span> <span class=\"na\">name=</span><span class=\"s\">&quot;summary&quot;</span><span class=\"nt\">&gt;</span> <span class=\"nt\">&lt;/a&gt;</span>\n          {%include StructureDefinition-{{[id]}}-summary.xhtml%}  ******* INJECTED HERE********\n        <span class=\"nt\">&lt;/div&gt;</span>\n      <span class=\"nt\">&lt;/div&gt;</span>\n    <span class=\"nt\">&lt;/div&gt;</span>\n</code></pre></div>",
        "id": 208038026,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598398990
    },
    {
        "content": "<p>the summary that the publisher generates looks like the first pic in this topic: <a href=\"#narrow/stream/179252-IG-creation/topic/Profile.20Text.20Summary.20not.20picking.20up.20all.20referenced.20structure\">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/Profile.20Text.20Summary.20not.20picking.20up.20all.20referenced.20structure</a></p>",
        "id": 208038147,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598399076
    },
    {
        "content": "<p>right, that's what I expect to see and what I was seeing before.</p>",
        "id": 208038291,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598399174
    },
    {
        "content": "<p>Jean can  you show us the file in the temp/includes for {%include StructureDefinition-{{[id]}}-summary.xhtml%}</p>",
        "id": 208038299,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598399177
    },
    {
        "content": "<p>or just share your repro - where is it?</p>",
        "id": 208038324,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598399218
    },
    {
        "content": "<p>repro is currently an IBM github so not publicly accessible</p>",
        "id": 208038348,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598399243
    },
    {
        "content": "<p>another data point - take it for what it's worth - but the Generating Narratives step has taken a long time today</p>",
        "id": 208038414,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598399285
    },
    {
        "content": "<p>ok lemme see if I can reproduce this behavior</p>",
        "id": 208038636,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598399507
    },
    {
        "content": "<p>got my test ig on it....</p>",
        "id": 208038683,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598399526
    },
    {
        "content": "<p>i can bundle up my source and send it to you<br>\nit looks like I don't have a temp/include</p>",
        "id": 208038686,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598399527
    },
    {
        "content": "<p>it would be here :  <br>\n<code>~/[your-ig]/temp/_includes</code></p>",
        "id": 208038737,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598399595
    },
    {
        "content": "<p>my temp directory only has a pages and a qa directory</p>",
        "id": 208038761,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598399631
    },
    {
        "content": "<p>you certainly do have a temp/_includes after the build happens</p>",
        "id": 208038964,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598399808
    },
    {
        "content": "<p>does it get deleted?  because I just finished a build and there is no _includes.  temp only has pages and qa directory</p>",
        "id": 208039081,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598399921
    },
    {
        "content": "<p>then you're putting it somewhere else</p>",
        "id": 208039095,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598399935
    },
    {
        "content": "<p>ah, it is in temp/pages/_includes</p>",
        "id": 208039107,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598399950
    },
    {
        "content": "<p>i'm not putting it anywhere :)  I think the template might be.</p>",
        "id": 208039120,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598399961
    },
    {
        "content": "<blockquote>\n<p>I think the template might be.</p>\n</blockquote>\n<p>nope it puts in temp/_includes</p>",
        "id": 208039263,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598400086
    },
    {
        "content": "<p>you guys keep saying that, but I'm not doing anything but running <a href=\"http://_genonce.sh\">_genonce.sh</a> with the base template and it is doing whatever it is doing.  i'm not overriding anything</p>",
        "id": 208039300,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598400120
    },
    {
        "content": "<p>in any case, StructureDefinition-ibm-fda-icsr-patientlastmenstrualperiod-summary.html has the text that you see in the guide.</p>",
        "id": 208039399,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598400194
    },
    {
        "content": "<p>we're trying to figure out where it came from</p>",
        "id": 208039411,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598400211
    },
    {
        "content": "<p>so whatever is generating that file is grabbing the summary from the vitalsigns profile</p>",
        "id": 208039416,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598400213
    },
    {
        "content": "<p>cannot reproduce in my test case</p>\n<p><a href=\"/user_uploads/10155/oV38WbU7NHd0njWNeZRRhtWr/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/oV38WbU7NHd0njWNeZRRhtWr/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/oV38WbU7NHd0njWNeZRRhtWr/image.png\"></a></div>",
        "id": 208039894,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598400649
    },
    {
        "content": "<p>i just pmed you a zip of my source</p>",
        "id": 208039907,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598400665
    },
    {
        "content": "<p>okay, looks like SUSHI is adding this in as the input/StructureDefinition has an extension with the inherited summary in it.   I just blew away my input directory and just ran SUSHI and I get this:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;StructureDefinition&quot;,\n  &quot;id&quot;: &quot;ibm-fda-icsr-patientlastmenstrualperiod&quot;,\n  &quot;extension&quot;: [\n    {\n      &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-summary&quot;,\n      &quot;valueMarkdown&quot;: &quot;\\&quot;#### Complete Summary of the Mandatory Requirements\\n\\n1.  One status in `Observation.status`which has a [required](http://build.fhir.org/terminologies.html#extensible) binding to:\\n    -    [ObservationStatus] value set.\\n1.  A category in `Observation.category` which must have:\\n    -   a fixed `Observation.category.coding.system`=\\&quot;http://terminology.hl7.org/CodeSystem/observation-category\\&quot;\\n    -   a fixed `Observation.category.coding.code`= \\&quot;vital-signs\\&quot;\\n\\n1.  A code in `Observation.code`\\n    -   a fixed `Observation.code.coding.system`= \\&quot;http://loinc.org\\&quot;\\&quot;\\n    -   a LOINC code in `Observation.code.coding.code` which has an [extensible](http://build.fhir.org/terminologies.html#extensible) binding to:\\n         -   [Vital Signs] value set.\\n                \\n1.  One patient in `Observation.subject`\\n1.  A date and time in `effectiveDateTime` or `effectivePeriod`\\n1.  Either one `Observation.value[x]` or, if there is no value, one code in `Observation.DataAbsentReason`\\n    -   if a vital sign measure then:\\n        -  One numeric value in Observation.valueQuantity.value\\n        - a fixed Observation.valueQuantity.system=\\&quot;http://unitsofmeasure.org\\&quot;\\n        - a UCUM unit code in Observation.valueQuantity.code which has an required binding to the [Vital Signs Units] value set.\\n    -   Observation.DataAbsentReason is bound to [Observation Value\\n        Absent Reason] value set.\\n\\n1.  When using a panel code to group component observations (Note: See\\n    the comments regarding blood pressure in the table above), one or\\n    more `Observation.component.code` each of which must have:\\n    -   a fixed\\n        `Observation.component.code.coding.system` =\\&quot;\\&quot;http://loinc.org\\&quot;\\&quot;\\n         -   a LOINC code in `Observation.code.coding.code` which has an [extensible] binding to:\\n             -   [Vital Signs Units] value set.\\n\\n1.  Either one `Observation.component.valueQuantity` or, if there is\\n    no value, one code in `Observation.component.DataAbsentReason`\\n    -   Observation.component.DataAbsentReason is bound to [Observation\\n        Value Absent Reason] value set.\\n\\n1.  When using a panel code to group observations, one or more reference\\n    to Vitals Signs Observations in `Observation.related.target`\\n    -   a fixed `Observation.related.type`= \\&quot;has-member\\&quot;\\&quot;\\n\\n [Vital Signs]: valueset-observation-vitalsignresult.html\\n  [Vital Signs Units]: valueset-ucum-vitals-common.html\\n  [extensible]: terminologies.html#extensible\\n  [ObservationStatus]: valueset-observation-status.html\\n [Observation Value Absent Reason]: valueset-data-absent-reason.html\\n[required]: terminologies.html#required\\&quot;&quot;\n    }\n  ],\n  &quot;url&quot;: &quot;http://ibm.com/fhir/fda/icsr/StructureDefinition/ibm-fda-icsr-patientlastmenstrualperiod&quot;,\n...\n</code></pre></div>",
        "id": 208040105,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598400849
    },
    {
        "content": "<p>I don't think that Sushi can do this. The logic to get the links right is sadly rather complicated</p>",
        "id": 208040127,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598400892
    },
    {
        "content": "<p>and I don't think that they should inherit the summary like this</p>",
        "id": 208040135,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598400908
    },
    {
        "content": "<p>i totally agree.</p>",
        "id": 208040155,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598400933
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 208040273,
        "sender_full_name": "Eric Haas",
        "timestamp": 1598401061
    },
    {
        "content": "<p>thanks for everyone's help in narrowing down what <em>wasn't</em> happening :)</p>",
        "id": 208040503,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1598401311
    },
    {
        "content": "<p>the template uses temp/pages for as the 'temp' folder - so Jean is correct that the relevant place is temp/pages/includes</p>",
        "id": 208040554,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598401331
    },
    {
        "content": "<p>There should be no inheritance of summary - it <em>should</em> be generated for each structure definition...</p>",
        "id": 208040576,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1598401364
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"239822\">@Nick Freiter</span> discussed this <a href=\"#narrow/stream/215610-shorthand/topic/SUSHI.20adding.20base.20definition.20summary.3F/near/208079732\">here</a>. Based on previous discussions with <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> and <span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span>, SUSHI maintains a list of extensions that <em>should not</em> be inherited.  That list has been discussed <a href=\"#narrow/stream/179239-tooling/topic/Forge.20added.20extension.20explicit-type-name/near/203906359\">here</a> and is also tracked <a href=\"https://jira.hl7.org/browse/FHIR-27535\">here</a>.  The <code>structuredefinition-summary</code> is not currently on that list, but we'll add it based on the above conversation.</p>",
        "id": 208085716,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1598445731
    },
    {
        "content": "<p>So, to be clear, SUSHI isn't really <em>adding</em> it (or doing anything special to include it) -- it's merely being inherited from the parent; and we'll make a fix to explicitly prevent this specific extension from being inherited.</p>",
        "id": 208085835,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1598445823
    },
    {
        "content": "<p>thanks</p>",
        "id": 208141699,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598472416
    }
]