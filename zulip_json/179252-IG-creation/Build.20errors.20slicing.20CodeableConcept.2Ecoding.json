[
    {
        "content": "<p>I have an IG where we are looking to require 2 codes be provided from the same CodeSystem on a CodeableConcept element with a base cardinality of 1..1. We want to require the granular code (in or use case it is an RxNorm code that includes ingredient, strength, and form) and a less granular code (RxNorm ingredient and form) in order to allow for searching across strengths.<br>\nThe way I am trying to address this is to slice the CodeableConcept with a pattern match on code with each slice bound to a different ValueSet. Both of these use the RxNorm codeSystem, but have different non-overlapping properties.</p>\n<p>I am getting a build error: <code>Slicing cannot be evaluated: Could not match discriminator ([code]) for slice MedicationKnowledge.code.coding:semantic-drug-form-group in profile http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-FormularyDrug - the discriminator [code] does not have fixed value, binding or existence assertions</code></p>\n<p>What am I doing wrong here?</p>\n<p>Profile: <a href=\"http://build.fhir.org/ig/HL7/davinci-pdex-formulary/StructureDefinition-usdf-FormularyDrug.html\">http://build.fhir.org/ig/HL7/davinci-pdex-formulary/StructureDefinition-usdf-FormularyDrug.html</a><br>\nGranular VS: <a href=\"http://build.fhir.org/ig/HL7/davinci-pdex-formulary/ValueSet-SemanticDrugVS.html\">http://build.fhir.org/ig/HL7/davinci-pdex-formulary/ValueSet-SemanticDrugVS.html</a><br>\nGeneral VS: <a href=\"http://build.fhir.org/ig/HL7/davinci-pdex-formulary/ValueSet-SemanticDrugFormGroupVS.html\">http://build.fhir.org/ig/HL7/davinci-pdex-formulary/ValueSet-SemanticDrugFormGroupVS.html</a><br>\nQA report: <a href=\"http://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/master/MedicationKnowledge-FormularyDrug-1541228.html\">http://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/master/MedicationKnowledge-FormularyDrug-1541228.html</a></p>",
        "id": 260583147,
        "sender_full_name": "Corey Spears",
        "timestamp": 1636302694
    },
    {
        "content": "<p>I do not know if these are the cause of your problem, but<br>\n1/ System and code are optional in both slices, so an instance with neither will satisfy both slices. <br>\n2/ In the slice semantic-drug you bind the coding.code and in the other slice you bind the coding. That looks strange.</p>",
        "id": 260622292,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1636356721
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191682\">@Richard Townley-O'Neill</span>, That got me part of the way there.<br>\nIt looks like my issue now is not with slicing, but with a valueSet binding on RxNorm with property TTY. I have been working with Lloyd on this and he said this might be an issue to raise with Grahame.</p>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, have you seen this problem?<br>\nI have a simple binding of MedicationKnowledge.code (CodeableConcept) to a ValueSet with RxNorm code with a matching property requirement. The ValueSet expeansion has the code \"753532\" in it, but when I include it in the example it fails validation stating <code>None of the codings provided are in the value set http://hl7.org/fhir/us/davinci-drug-formulary/ValueSet/SemanticDrugVS (http://hl7.org/fhir/us/davinci-drug-formulary/ValueSet/SemanticDrugVS), and a coding from this value set is required) (codes = http://www.nlm.nih.gov/research/umls/rxnorm#753532)</code></p>\n<p>QA error here: <a href=\"http://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/master/qa.html#_scratch_ig-build-temp-6ONJIC_repo_fsh-generated_resources_MedicationKnowledge-FormularyDrug-1541228\">http://build.fhir.org/ig/HL7/davinci-pdex-formulary/branches/master/qa.html#_scratch_ig-build-temp-6ONJIC_repo_fsh-generated_resources_MedicationKnowledge-FormularyDrug-1541228</a></p>",
        "id": 260702715,
        "sender_full_name": "Corey Spears",
        "timestamp": 1636397990
    },
    {
        "content": "<p>the answer is that you've referred directly to a vsac value set, and the server doesn't have access to that vsac value set definition. And it's part of the generally 'vsac is broken' problem that's on my todo list, but it's a big problem</p>",
        "id": 260754877,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636435079
    },
    {
        "content": "<p>Unfortunately that is not the case. I had removed use of that ValueSet before starting to work on this. I see the vsac dependency was still listed.  It is now removed. Still not able to determine that it is in the VS.</p>",
        "id": 260760375,
        "sender_full_name": "Corey Spears",
        "timestamp": 1636440893
    },
    {
        "content": "<p>where's the value set defined?</p>",
        "id": 260760399,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636440925
    },
    {
        "content": "<p>I went ahead and simplified the examples and binding in order to remove other possible variables. It now has a regular (non-sliced) binding, and I only include 1 example.<br>\nVS Definition: <a href=\"http://build.fhir.org/ig/HL7/davinci-pdex-formulary/ValueSet-SemanticDrugVS.html\">http://build.fhir.org/ig/HL7/davinci-pdex-formulary/ValueSet-SemanticDrugVS.html</a><br>\nExample: <a href=\"https://build.fhir.org/ig/HL7/davinci-pdex-formulary/MedicationKnowledge-FormularyDrug-993804.json.html\">https://build.fhir.org/ig/HL7/davinci-pdex-formulary/MedicationKnowledge-FormularyDrug-993804.json.html</a></p>",
        "id": 260806046,
        "sender_full_name": "Corey Spears",
        "timestamp": 1636468665
    },
    {
        "content": "<p>bug in the server - will be fixed by this time tomorrow</p>",
        "id": 260885270,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636505247
    },
    {
        "content": "<p>Sorry we did not find this earlier. It just was identified as a requirement on Friday.</p>",
        "id": 260921584,
        "sender_full_name": "Corey Spears",
        "timestamp": 1636513108
    }
]