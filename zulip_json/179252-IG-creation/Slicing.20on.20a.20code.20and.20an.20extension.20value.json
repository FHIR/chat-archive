[
    {
        "content": "<p>I want to slice my Questionnaire items based on their type and then, within a type, based on the value of an extension.  I think I finally got the definition of my slice discriminator right:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Questionnaire.item&quot;,\n        &quot;path&quot;: &quot;Questionnaire.item&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;value&quot;,\n              &quot;path&quot;: &quot;type&quot;\n            },\n            {\n              &quot;type&quot;: &quot;value&quot;,\n              &quot;path&quot;: &quot;extension(&#39;http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl&#39;).value&quot;\n            }\n          ],\n          &quot;rules&quot;: &quot;closed&quot;,\n          &quot;description&quot;: &quot;Slice based on type to restrict the different types of answers allowed.&quot;\n        },\n</code></pre></div>",
        "id": 235908147,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1619211722
    },
    {
        "content": "<p>I am getting an error when running the publisher and I think it might be because this discriminator might be doing more than I think it is.  I don't want to have to specify the extension on every item, only on those items that have the same type.  My 'string', 'text', and 'date' item types don't need the extension, but the 'radio-button', 'check-box',  and 'drop-down' choice items do.</p>",
        "id": 235908839,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1619211891
    },
    {
        "content": "<p>Here is the error that I'm getting:</p>\n<div class=\"codehilite\"><pre><span></span><code>java.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0\n    at java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64)\n    at java.base/jdk.internal.util.Preconditions.outOfBoundsCheckIndex(Preconditions.java:70)\n    at java.base/jdk.internal.util.Preconditions.checkIndex(Preconditions.java:248)\n    at java.base/java.util.Objects.checkIndex(Objects.java:372)\n    at java.base/java.util.ArrayList.get(ArrayList.java:458)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.evaluateDefinition(FHIRPathEngine.java:5479)\n    at org.hl7.fhir.validation.instance.InstanceValidator.getCriteriaForDiscriminator(InstanceValidator.java:2991)\n    at org.hl7.fhir.validation.instance.InstanceValidator.sliceMatches(InstanceValidator.java:3486)\n    at org.hl7.fhir.validation.instance.InstanceValidator.matchSlice(InstanceValidator.java:4831)\n</code></pre></div>",
        "id": 235909614,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1619212136
    },
    {
        "content": "<p>Here is the definition of my SingleLine slice:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Questionnaire.item:SingleLine&quot;,\n        &quot;path&quot;: &quot;Questionnaire.item&quot;,\n        &quot;sliceName&quot;: &quot;SingleLine&quot;,\n        &quot;min&quot;: 0,\n        &quot;max&quot;: &quot;*&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Questionnaire.item:SingleLine.type&quot;,\n        &quot;path&quot;: &quot;Questionnaire.item.type&quot;,\n        &quot;patternCode&quot;: &quot;string&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Questionnaire.item:SingleLine.initial&quot;,\n        &quot;path&quot;: &quot;Questionnaire.item.initial&quot;,\n        &quot;max&quot;: &quot;1&quot;,\n        &quot;mustSupport&quot;: true\n      },\n      {\n        &quot;id&quot;: &quot;Questionnaire.item:SingleLine.initial.value[x]&quot;,\n        &quot;path&quot;: &quot;Questionnaire.item.initial.value[x]&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;type&quot;,\n              &quot;path&quot;: &quot;$this&quot;\n            }\n          ],\n          &quot;ordered&quot;: false,\n          &quot;rules&quot;: &quot;open&quot;\n        },\n        &quot;type&quot;: [\n          {\n            &quot;code&quot;: &quot;string&quot;\n          }\n        ]\n      },\n      {\n        &quot;id&quot;: &quot;Questionnaire.item:SingleLine.initial.valueString&quot;,\n        &quot;path&quot;: &quot;Questionnaire.item.initial.valueString&quot;,\n        &quot;min&quot;: 1,\n        &quot;max&quot;: &quot;1&quot;,\n        &quot;mustSupport&quot;: true\n      },\n</code></pre></div>",
        "id": 235909909,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1619212222
    },
    {
        "content": "<p>my question is thus - if you specify a multi-part discriminator, do all parts of the discriminator have to appear in each slice?</p>",
        "id": 235911476,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1619212847
    },
    {
        "content": "<p>They're not supposed to, but it's possible the tooling doesn't handle that in all cases.  Are you able to share a trimmed down version of the profile as a test case?</p>",
        "id": 235911642,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1619212934
    },
    {
        "content": "<p>i might be able to.  Let me see if I can make a simple two slice profile that fails the same way</p>",
        "id": 235911689,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1619212983
    }
]