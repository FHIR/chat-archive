[
    {
        "content": "<p>I'm moving this to a separate topic so it isn't lost.  On the IPS <a href=\"https://github.com/HL7/fhir-ips/tree/connectathon\">connectathon</a> branch, following successful Sushi processing and the package loading I now get this exception:</p>\n<div class=\"codehilite\"><pre><span></span><code>Load Template from hl7.fhir.template                                             (00:27.0482)\n2021-09-02 17:50:47.270 [main] INFO  o.h.f.u.npm.BasePackageCacheManager [BasePackageCacheManager.java:80] Failed to resolve package hl7.fhir.template#null from server: http://packages.fhir.org\nInstalling hl7.fhir.template#0.3.2 to the package cache\n  Fetching:\n  Installing:  done.\n Load Template from hl7.base.template#0.3.1                                      (00:28.0561)\n2021-09-02 17:50:48.316 [main] INFO  o.h.f.u.npm.BasePackageCacheManager [BasePackageCacheManager.java:80] Failed to resolve package hl7.base.template#0.3.1 from server: http://packages.fhir.org\nInstalling hl7.base.template#0.3.1 to the package cache\n  Fetching:\n  Installing:  done.\n  Load Template from fhir.base.template#0.2.1                                    (00:29.0064)\n2021-09-02 17:50:48.817 [main] INFO  o.h.f.u.npm.BasePackageCacheManager [BasePackageCacheManager.java:80] Failed to resolve package fhir.base.template#0.2.1 from server: http://packages.fhir.org\nInstalling fhir.base.template#0.2.1 to the package cache\n  Fetching:.\n  Installing: . done.\nPre-Process: /scratch/ig-build-temp-GCBS68/repo/input/includes = _includes | null\nPre-Process: /scratch/ig-build-temp-GCBS68/repo/input/pagecontent = _includes | /scratch/ig-build-temp-GCBS68/repo/template/scripts/processPages.xslt\n\nonLoad.findSpreadsheets:\n\nonLoad.updateIg:\n     [xslt] Processing /scratch/ig-build-temp-GCBS68/repo/template/onLoad-ig-working.xml to /scratch/ig-build-temp-GCBS68/repo/template/onLoad-ig-updated.xml\n     [xslt] Loading stylesheet /scratch/ig-build-temp-GCBS68/repo/template/scripts/onLoad.xslt\n\nonLoad.extend:\n\nonLoad:\nRoot directory: /scratch/ig-build-temp-GCBS68/repo                               (00:32.0856)\nCore Package hl7.fhir.r4.core#4.0.1\nInstalling hl7.fhir.r4.core#4.0.1 to the package cache\n  Fetching:....................................................................................................\n  Installing: .................................................................................................... done.\nTerminology Cache is at /scratch/ig-build-temp-GCBS68/repo/input-cache/txcache. Trimming now (00:45.0078)\nConnect to Terminology Server at http://tx.fhir.org/r4                           (01:42.0692)\n2021-09-02 17:52:02.901 [main] INFO  o.h.f.u.npm.BasePackageCacheManager [BasePackageCacheManager.java:80] Failed to resolve package hl7.fhir.pubpack#0.0.9 from server: http://packages.fhir.org\nInstalling hl7.fhir.pubpack#0.0.9 to the package cache\n  Fetching:.........\n  Installing: ......... done.\nLoad Package hl7.fhir.pubpack#0.0.9\nInstalling hl7.fhir.xver-extensions#0.0.5 to the package cache\n  Fetching:\n  Installing:  done.\nLoad Package hl7.fhir.xver-extensions#0.0.5\nInstalling hl7.terminology.r4#2.1.0 to the package cache\n  Fetching:............................................................................\n  Installing: ............................................................................ done.\nLoad Package hl7.terminology.r4#2.1.0\nInitialization complete                                                          (01:49.0656)\nFetch http://hl7.org/fhir/uv/ips/package-list.json for version check             (01:49.0659)\nLoad Content                                                                     (01:49.0768)\nTranslating CQL source                                                           (01:49.0856)\nTranslating CQL source in folder /scratch/ig-build-temp-GCBS68/repo/input/cql    (01:49.0856)\nPublishing Content Failed: No Source directories to scan found                   (01:49.0862)\n                                                                                 (01:49.0862)\nUse -? to get command line help                                                  (01:49.0862)\n                                                                                 (01:49.0862)\nStack Dump (for debugging):                                                      (01:49.0862)\norg.hl7.fhir.exceptions.FHIRException: No Source directories to scan found\n    at org.hl7.fhir.igtools.publisher.SimpleFetcher.scan(SimpleFetcher.java:301)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadResources(Publisher.java:3705)\n    at org.hl7.fhir.igtools.publisher.Publisher.load(Publisher.java:3200)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:892)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:752)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8664)\n</code></pre></div>\n<p>The issue started showing up in the CI build about 24-48 hours ago, but wasn't occurring for me locally until <strong>after</strong> I deleted the package cache (in <code>.fhir</code>).<br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 251779053,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630613520
    },
    {
        "content": "<p>The SANER IG on the CI system gets the same error</p>",
        "id": 251779228,
        "sender_full_name": "David Pyke",
        "timestamp": 1630613597
    },
    {
        "content": "<p>But builds locally for me</p>",
        "id": 251779261,
        "sender_full_name": "David Pyke",
        "timestamp": 1630613613
    },
    {
        "content": "<p>that can't have anything to do with the package cache</p>",
        "id": 251780878,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630614351
    },
    {
        "content": "<p>Maybe it can't have anything to do with it, but it seems pretty clear that it does.  I was getting the error in the CI build and not locally.  But as soon as I removed the local cache and did another IG rebuild, with no other changes, I had the same error locally.</p>",
        "id": 251781271,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630614521
    },
    {
        "content": "<p>I am getting the same error now with the Patient Corrections IG (it builds locally).</p>",
        "id": 251781400,
        "sender_full_name": "John Keyes",
        "timestamp": 1630614566
    },
    {
        "content": "<p>That's an interesting clue.</p>\n<ul>\n<li>Broken stuff in CI build:<ul>\n<li>fhir-saner</li>\n<li>ips connectathon branch</li>\n<li>fhir-patient-correction</li>\n</ul>\n</li>\n<li>Working stuff in CI build:<ul>\n<li>fhir-mCODE-ig</li>\n<li>fhir-bfdr</li>\n<li>vr-common-library</li>\n<li>UTG</li>\n<li>sdc</li>\n<li>dcc-tw-test</li>\n</ul>\n</li>\n</ul>",
        "id": 251783527,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1630615470
    },
    {
        "content": "<p>^^ What's the pattern?</p>",
        "id": 251783570,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1630615502
    },
    {
        "content": "<p>well, it turns out, it's related to the breaking change, and it is indeed obscured by the package cache in some weird way.</p>",
        "id": 251784927,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630616133
    },
    {
        "content": "<p>turns out that the latest released templates are not correct.</p>",
        "id": 251785149,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630616238
    },
    {
        "content": "<p>the only way to work around this for now is to change your ig.ini to this:</p>\n<div class=\"codehilite\"><pre><span></span><code>[IG]\nig = ...\ntemplate = hl7.fhir.template#current\n</code></pre></div>\n<p>from this:</p>\n<div class=\"codehilite\"><pre><span></span><code>[IG]\nig = ...\ntemplate = hl7.fhir.template\n</code></pre></div>",
        "id": 251785296,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630616305
    },
    {
        "content": "<p>this is required for at least Sushi IGs, and maybe all of them.</p>",
        "id": 251785341,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630616331
    },
    {
        "content": "<p>That's actually the next thing that I was going to try - but hadn't yet.  Yes.  It seems to be affecting two IPS branches - one of them is using Sushi and the other isn't.  But I'll re-verify after adding <code>#current</code>.</p>",
        "id": 251785505,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630616406
    },
    {
        "content": "<p>Okay, I'll make the change and then test it before pushing</p>",
        "id": 251785528,
        "sender_full_name": "David Pyke",
        "timestamp": 1630616416
    },
    {
        "content": "<p>That fixes it for fhir-patient-correction. Thank you Grahame.</p>",
        "id": 251786524,
        "sender_full_name": "John Keyes",
        "timestamp": 1630616843
    },
    {
        "content": "<p>That breaks pretty much all the terminology for SANER.  I now have 347 errors all from terminology errors</p>",
        "id": 251788930,
        "sender_full_name": "David Pyke",
        "timestamp": 1630617979
    },
    {
        "content": "<p>CapabilityStatement.jurisdiction[0].coding[0]   error   Error performing operation 'validate-code: null' (parameters = \"\") for '<a href=\"http://unstats.un.org/unsd/methods/m49/m49.htm#001\">http://unstats.un.org/unsd/methods/m49/m49.htm#001</a>'<br>\nCapabilityStatement.format[0]   error   The value provided ('xml') is not in the value set <a href=\"http://hl7.org/fhir/ValueSet/mimetypes|4.0.1\">http://hl7.org/fhir/ValueSet/mimetypes|4.0.1</a> (<a href=\"http://hl7.org/fhir/ValueSet/mimetypes\">http://hl7.org/fhir/ValueSet/mimetypes</a>), and a code is required from this value set) (error message = Error performing operation 'validate-code: null' (parameters = \"\"))<br>\nCapabilityStatement.format[1]   error   The value provided ('json') is not in the value set <a href=\"http://hl7.org/fhir/ValueSet/mimetypes|4.0.1\">http://hl7.org/fhir/ValueSet/mimetypes|4.0.1</a> (<a href=\"http://hl7.org/fhir/ValueSet/mimetypes\">http://hl7.org/fhir/ValueSet/mimetypes</a>), and a code is required from this value set) (error message = Error performing operation 'validate-code: null' (parameters = \"\"))</p>",
        "id": 251789002,
        "sender_full_name": "David Pyke",
        "timestamp": 1630618022
    },
    {
        "content": "<p>This fixed the \"No Source directories to scan found\" and similar errors on both of my IPS IG branches.  But I do still have the \"validate-code\" issues that David describes, with both LOINC and unstats m49.</p>",
        "id": 251789791,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630618272
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192587\">@David Pyke</span> have you cleared the txCache?</p>",
        "id": 251794046,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630620530
    },
    {
        "content": "<p>No, but I'll try that</p>",
        "id": 251798011,
        "sender_full_name": "David Pyke",
        "timestamp": 1630622869
    },
    {
        "content": "<p>That fixed it locally, let's see what the CI does</p>",
        "id": 251798997,
        "sender_full_name": "David Pyke",
        "timestamp": 1630623461
    },
    {
        "content": "<p>And it fixed it on CI.  All is happy and good.</p>",
        "id": 251800587,
        "sender_full_name": "David Pyke",
        "timestamp": 1630624406
    },
    {
        "content": "<p>well, you can go back to taking #current off now - I've released a new version of the templates</p>",
        "id": 251800673,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630624452
    },
    {
        "content": "<p>Great.  And, yes.  I've cleared txcache multiple times - but possibly not since you've fixed this.</p>",
        "id": 251800774,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630624520
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/lFu1eEM_7JGnDAlmiBpDjVNV/tumblr_mdbbwkMBmF1qirsuqo1_500.gif\">but I just...! </a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/lFu1eEM_7JGnDAlmiBpDjVNV/tumblr_mdbbwkMBmF1qirsuqo1_500.gif\" title=\"but I just...! \"><img src=\"/user_uploads/10155/lFu1eEM_7JGnDAlmiBpDjVNV/tumblr_mdbbwkMBmF1qirsuqo1_500.gif\"></a></div>",
        "id": 251800965,
        "sender_full_name": "David Pyke",
        "timestamp": 1630624666
    },
    {
        "content": "<p>You're free to <em>leave</em> #current <span class=\"user-mention\" data-user-id=\"192587\">@David Pyke</span>.  It means you'll continue to get the latest and greatest (as you were before, but just didn't realize...)</p>",
        "id": 251809946,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1630632269
    },
    {
        "content": "<p>When I switched back to not including <code>#current</code>, the build failed again - and then after adding <code>#current</code> back again, it succeeded.  So the new version of the templates doesn't seem to have entirely fixed it yet. <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 251813288,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630635345
    },
    {
        "content": "<p>can you try it again, and delete your cache before you run without #current?</p>",
        "id": 251813534,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630635548
    },
    {
        "content": "<p>Sure - I'll give it another try.  The CI build without <code>#current</code> failed about 45 min. ago - and the cache shouldn't be an issue with that.</p>",
        "id": 251814172,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630636099
    },
    {
        "content": "<p>Nope.  After deleting the package cache It failed again locally without <code>#current</code>.</p>",
        "id": 251814675,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630636558
    },
    {
        "content": "<p>what version of the base template did it load?</p>",
        "id": 251814732,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630636581
    },
    {
        "content": "<p>My two branches fail with different messages in different places, but both of them seem to be due to the template issues.  The branch that doesn't use Sushi shows:</p>\n<div class=\"codehilite\"><pre><span></span><code>Package Cache: /Users/rhausam/.fhir/packages                                     (00:00.0013)\nLoad Template from hl7.fhir.template                                             (00:00.0398)\n2021-09-02 21:31:18.610 [main] INFO  o.h.f.u.npm.BasePackageCacheManager [BasePackageCacheManager.java:80] Failed to resolve package hl7.fhir.template#null from server: http://packages.fhir.org\nInstalling hl7.fhir.template#0.3.2 to the package cache\n  Fetching:\n  Installing:  done.\n Load Template from hl7.base.template#0.3.1                                      (00:02.0122)\n2021-09-02 21:31:20.177 [main] INFO  o.h.f.u.npm.BasePackageCacheManager [BasePackageCacheManager.java:80] Failed to resolve package hl7.base.template#0.3.1 from server: http://packages.fhir.org\nInstalling hl7.base.template#0.3.1 to the package cache\n  Fetching:\n  Installing:  done.\n  Load Template from fhir.base.template#0.2.1                                    (00:02.0732)\n2021-09-02 21:31:20.786 [main] INFO  o.h.f.u.npm.BasePackageCacheManager [BasePackageCacheManager.java:80] Failed to resolve package fhir.base.template#0.2.1 from server: http://packages.fhir.org\nInstalling fhir.base.template#0.2.1 to the package cache\n  Fetching:.\n  Installing: . done.\n</code></pre></div>\n<p>And the one using Sushi shows:</p>\n<div class=\"codehilite\"><pre><span></span><code>Package Cache: /Users/rhausam/.fhir/packages                                     (00:00.0013)\n[Sushi stuff ...]\nLoad Template from hl7.fhir.template                                             (00:12.0241)\n Load Template from hl7.base.template#0.3.1                                      (00:12.0257)\n  Load Template from fhir.base.template#0.2.1\n</code></pre></div>\n<p>So it looks a little different and has less detail when Sushi is run, but it's loading the same packages.</p>",
        "id": 251815119,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630636935
    },
    {
        "content": "<p>I'm just guessing but it looks like maybe you have the path-binary parameter set to input/cql, but you don't have an input/cql directory in your IG?</p>",
        "id": 251944726,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1630704759
    },
    {
        "content": "<p>no. it's a problem in the templates.</p>",
        "id": 251954036,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1630711120
    },
    {
        "content": "<p>Yes, adding <code>#current</code> to the template allows it to work.  The \"Translating CQL source\" looking in a non-existent folder doesn't seem to be an issue.</p>",
        "id": 252003847,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1630765053
    }
]