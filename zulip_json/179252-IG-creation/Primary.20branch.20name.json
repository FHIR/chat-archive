[
    {
        "content": "<p><a href=\"https://sfconservancy.org/news/2020/jun/23/gitbranchname/\">Git</a> and <a href=\"https://github.com/github/renaming\">GitHub</a> are considering moving from <code>master</code> to <code>main</code> for default branch names (new repos on GitHub are already using <code>main</code> rather than <code>master</code>).</p>\n<p>Are there technical issues that would prevent existing IGs from switching primary branch names? For example, does the <a href=\"http://build.fhir.org\">build.fhir.org</a> CI hard-code <code>master</code> as the primary branch, or is it deriving this from the GitHub repo somehow?</p>",
        "id": 214037411,
        "sender_full_name": "Max Masnick",
        "timestamp": 1603279684
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span></p>",
        "id": 214068468,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1603294603
    },
    {
        "content": "<p>For the auto-build pipeline: <a href=\"https://github.com/FHIR/auto-ig-builder/search?q=master\">https://github.com/FHIR/auto-ig-builder/search?q=master</a> gives you a quick sense of what's hard-coded. Summarizing...</p>\n<ul>\n<li>For IGs, we delete all \"stale\" branches after 3 weeks, except <code>master</code> which lives indefinitely</li>\n<li>For <a href=\"https://fhir.github.io/auto-ig-builder/builds.html\">https://fhir.github.io/auto-ig-builder/builds.html</a>, we only show <code>master</code> branches on the dashboard</li>\n<li>For <a href=\"https://build.fhir.org/ig/:org/:repo\">https://build.fhir.org/ig/:org/:repo</a> URLs, we display the <code>master</code> branch by default, if no \"/branches/:branch\" path suffix is provided</li>\n</ul>",
        "id": 214074247,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603296755
    },
    {
        "content": "<p><em>Bottom line: If you create a new repo with a <code>main</code> instead of <code>master</code>, it should work right now; but you'll have to send people to <a href=\"https://build.fhir.org/ig/:org/:repo/:branches/main\">https://build.fhir.org/ig/:org/:repo/:branches/main</a> to see it.</em></p>",
        "id": 214075175,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603297098
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 214103136,
        "sender_full_name": "Max Masnick",
        "timestamp": 1603308876
    },
    {
        "content": "<p>Should we update our code to handle both master and main as equivalent?</p>",
        "id": 214105056,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1603309729
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> given that new GitHub repos are already defaulting to using <code>main</code> as the primary branch, I think that it makes sense to have build code assume <code>main</code> is the primary branch if it exists, and otherwise fall back to <code>master</code>.</p>",
        "id": 214112588,
        "sender_full_name": "Max Masnick",
        "timestamp": 1603313230
    },
    {
        "content": "<p>(For example, I just created this repo via the <a href=\"http://github.com\">github.com</a> interface: <a href=\"https://github.com/masnick/test-repo\">https://github.com/masnick/test-repo</a>. It has one branch called <code>main</code>.)</p>",
        "id": 214112660,
        "sender_full_name": "Max Masnick",
        "timestamp": 1603313273
    },
    {
        "content": "<blockquote>\n<p>Should we update our code to handle both master and main as equivalent?</p>\n</blockquote>\n<p>Yeah, I'd love it if someone else wanted to come up to speed on the auto-build infrastructure. Right now I think I'm the only person familiar with it, which isn't great because:</p>\n<ol>\n<li>It lets me write idiosyncratic, hard-to-understand stuff, and</li>\n<li>It means my availability places a hard limit on speed of development</li>\n</ol>\n<p>So... consider this an open call for anyone who wants to co-maintain this infrastructure with me. There's a fair amount of low hanging fruit that'd make it easier to use/maintain over time (which is a polite way of saying that today it's... ad-hoc.)</p>",
        "id": 214200898,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603379393
    },
    {
        "content": "<p>OK, so tentative plan...</p>\n<ul>\n<li>When building an IG, determine if the current branch is \"the default branch per github\"<ul>\n<li>If not, no special processing;</li>\n<li>If yes, symlink a \"_ghDefaultBranch\" directory on the build server to this branch</li>\n</ul>\n</li>\n</ul>\n<p>Then, the web hosting logic, the dashboard, etc, can be driven based on the \"_ghDefaultBranch\" symlink (which will point to <code>main</code> or <code>master</code> or <code>default</code> or whatever people choose as their default branch in github).</p>",
        "id": 214332545,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603469327
    },
    {
        "content": "<p>I'm taking the first step (which should have no visible effect) with <a href=\"https://github.com/FHIR/auto-ig-builder/commit/65af363ef9965d93e6b196e4c1882b9e5d820eab#diff-a85b50832551b8becae29784c5541114cc7b34a0dd96edb0953c5006c5b5f76fR44\">this commit</a>. Will continue with the plan next week if this steps works OK.</p>",
        "id": 214342033,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603474164
    },
    {
        "content": "<p>(Please @-mention me here if you see anything unusual.)</p>",
        "id": 214343536,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603474907
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> How do I get up to speed with the auto-build infrastructure?</p>",
        "id": 214751337,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1603826885
    },
    {
        "content": "<p>I love this question <span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span>  ;-) What I'd propose if you're willing would be we schedule a video chat to talk through what's there --  and ideally we record it, and see if we want to use that as a starting point for writing up additional docs.</p>",
        "id": 214752036,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603827227
    },
    {
        "content": "<p>I just made <a href=\"https://docs.google.com/presentation/d/12JykZwSdQ1pwSuzP2fGZSXr3jYMmvEcwVgNAy3dWr_U/present?slide=id.p\">https://docs.google.com/presentation/d/12JykZwSdQ1pwSuzP2fGZSXr3jYMmvEcwVgNAy3dWr_U/present?slide=id.p</a> with a quick overview of the build infrastructure</p>",
        "id": 214756259,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603829005
    },
    {
        "content": "<p>(permissions fixed)</p>",
        "id": 214758428,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603829974
    },
    {
        "content": "<p>It all fits on one slide, can't be that hard... <br>\n<span aria-label=\"dragon\" class=\"emoji emoji-1f409\" role=\"img\" title=\"dragon\">:dragon:</span> <span aria-label=\"dragon\" class=\"emoji emoji-1f409\" role=\"img\" title=\"dragon\">:dragon:</span> <span aria-label=\"dragon face\" class=\"emoji emoji-1f432\" role=\"img\" title=\"dragon face\">:dragon_face:</span> <span aria-label=\"dragon\" class=\"emoji emoji-1f409\" role=\"img\" title=\"dragon\">:dragon:</span> <span aria-label=\"dragon\" class=\"emoji emoji-1f409\" role=\"img\" title=\"dragon\">:dragon:</span></p>",
        "id": 214759151,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1603830276
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> while you are looking at this, I have a need for a secret - an api key - to be stored in a secure location, and passed to the IG publisher as a parameter. I'll provide the key, but it can't be public. Is that doable?</p>",
        "id": 214767294,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603834541
    },
    {
        "content": "<p>It's sorta doable. It depends on your threat model -- anyone on the sushi team, or anyone able to push the ig publisher jar can obviously cause this to leak. A clever ig author might also be able to cause it to leak. (This is similar to how we protect access to the \"publish\" script today with a publication keypair; a dedicated attacker could probably exfiltrate it.)</p>",
        "id": 214768343,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603835073
    },
    {
        "content": "<p>why on the sushi team?</p>",
        "id": 214768408,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603835113
    },
    {
        "content": "<p>An IG Author won't be able to cause it to leak.</p>",
        "id": 214768445,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603835135
    },
    {
        "content": "<p>I don't know for sure, but I think <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> probably said anyone on the SUSHI team could leak it because SUSHI gets automatically loaded from NPM and is run inside the CI environment.  So anything accessible in the CI environment (via file system, environment variables, etc) is accessible to SUSHI code -- and therefore to nefarious SUSHI developers.  But don't worry, you can trust us. ;-)</p>",
        "id": 214771041,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1603836685
    },
    {
        "content": "<p>That's what I meant, yes. And the surface area of the IG Publisher's inputs is huge, so I'm pretty confident that a determined IG author could cause arbitrary code execution  in the \"IG Build\" docker image.</p>",
        "id": 214771407,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603836905
    },
    {
        "content": "<p>ok. I don't think the sushi team can get to the IG publisher memory space or parameters but agree they have access to the system. I'm not concerned about that. </p>\n<p>IG authors cannot execute arbitrary code. Template authors can. I already have sufficient control over that.</p>",
        "id": 214771636,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603837054
    },
    {
        "content": "<blockquote>\n<p>IG authors cannot execute arbitrary code. Template authors can. I already have sufficient control over that.</p>\n</blockquote>\n<p>It's really hard to prove something like that. Maybe what you mean is you don't intend for IG authors to execute arbitrary code :-)</p>",
        "id": 214771841,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603837153
    },
    {
        "content": "<p>I have taken what steps I know to take, but agree it's hard to prove.</p>",
        "id": 214771913,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603837202
    },
    {
        "content": "<p>they can't run scripts. They can't register plug-ins with Jekyll. They don't have any loaded html space to play with javascript</p>",
        "id": 214772059,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603837283
    },
    {
        "content": "<p>although I'm not really worried about ig authors in actual fact. if they can really figure out how to get the API key, then they're welcome to it...</p>",
        "id": 214772509,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603837563
    },
    {
        "content": "<p>Do keep in mind that anyone in the world can be an IG author just by calling our webhook</p>",
        "id": 214772824,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603837777
    },
    {
        "content": "<p>I very much keep that in mind.</p>",
        "id": 214772916,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603837836
    },
    {
        "content": "<p>Okay, so s/ig authors/anyone/ in the statement above</p>",
        "id": 214773046,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603837923
    },
    {
        "content": "<p>anyone really technically capable, yes. And if they're really dedicated to spend that much to acquire an API Key that they can get for free and only gives them access to data that's publicly available... sure.</p>",
        "id": 214773133,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603837975
    },
    {
        "content": "<p>Anyway, we can definitely call the publisher with an API key. Where/how will that be used downstream?</p>",
        "id": 214773197,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603838017
    },
    {
        "content": "<p>I will use it to access NLM terminology services. People using the IG publisher locally who use NLM resources will have to provide their own key.</p>",
        "id": 214773285,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603838060
    },
    {
        "content": "<p>Perfect -- more NLM silliness causing people to jump through hoops to access public data :(</p>",
        "id": 214773321,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603838099
    },
    {
        "content": "<p>Anyway that makes me feel much better about the risks of leakage</p>",
        "id": 214773348,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603838123
    },
    {
        "content": "<p>yep that's exactly what it is. You should read the API - 3 levels of keys, including getting a new API key before every single transaction.</p>",
        "id": 214773358,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603838134
    },
    {
        "content": "<p>this is fort knox levels of security.</p>",
        "id": 214773422,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603838167
    },
    {
        "content": "<p>I've read it and used it Alas, many years ago. So painful</p>",
        "id": 214773423,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603838168
    },
    {
        "content": "<p>Enough to make me never use it again :-)</p>",
        "id": 214773437,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603838177
    },
    {
        "content": "<p>And I did share this feedback at the time of course.</p>",
        "id": 214773451,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603838192
    },
    {
        "content": "<p>I've been told that the NLM FHIR interface should support the API Key <em>and</em> intentional value sets by the end of the year.  Then I think you should be able to ditch using the SVS API.</p>",
        "id": 214847771,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1603897088
    },
    {
        "content": "<p>Re: single-slide overview, I've <a href=\"https://docs.google.com/presentation/d/12JykZwSdQ1pwSuzP2fGZSXr3jYMmvEcwVgNAy3dWr_U/present?slide=id.p\">updated it with links</a> to the relevant bits in the <code>auto-ig-builder</code> repo (FYI <span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span>)</p>",
        "id": 214856680,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603900455
    },
    {
        "content": "<p>I'm not using the SVS api</p>",
        "id": 214887651,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603914078
    },
    {
        "content": "<blockquote>\n<p>3 levels of keys, including getting a new API key before every single transaction</p>\n</blockquote>\n<p>That's CAS authentication.  Their SVS API uses CAS authentication.  Do they have <em>another</em> value set API (besides SVS) that <em>also</em> uses CAS?  AFAIK, their FHIR API only uses Basic Auth at this time.</p>",
        "id": 214897694,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1603919202
    },
    {
        "content": "<p>that's changing</p>",
        "id": 214907617,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603925748
    },
    {
        "content": "<p>For anyone interested in details of the auto-build infrastructure, <span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span>  and I did a deep dive yesterday: <a href=\"https://youtu.be/VVbF1O4pgQA\">https://youtu.be/VVbF1O4pgQA</a></p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"VVbF1O4pgQA\" href=\"https://youtu.be/VVbF1O4pgQA\"><img src=\"https://i.ytimg.com/vi/VVbF1O4pgQA/default.jpg\"></a></div>",
        "id": 215743478,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1604596272
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span> <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> Any insight into when the CI build tool will handle 'main' the same way it handles 'master'?</p>",
        "id": 218448629,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1606841104
    },
    {
        "content": "<p>It won't be for another probably two weeks from my side. I haven't had a chance to do any changes yet.</p>",
        "id": 218449412,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1606841380
    }
]