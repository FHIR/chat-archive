[
    {
        "content": "<p>When generating an example DiagnosticReport resource for my IG, I get the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>java.lang.NullPointerException: Cannot invoke &quot;org.hl7.fhir.r5.model.DataType.isPrimitive()&quot; because &quot;type&quot; is null\n    at org.hl7.fhir.r5.renderers.DataRenderer.render(DataRenderer.java:361)\n    at org.hl7.fhir.r5.renderers.PatientRenderer.describe(PatientRenderer.java:198)\n    at org.hl7.fhir.r5.renderers.PatientRenderer.describe(PatientRenderer.java:170)\n    at org.hl7.fhir.r5.renderers.DiagnosticReportRenderer.generatePatientSummary(DiagnosticReportRenderer.java:182)\n    at org.hl7.fhir.r5.renderers.DiagnosticReportRenderer.populateSubjectSummary(DiagnosticReportRenderer.java:176)\n    at org.hl7.fhir.r5.renderers.DiagnosticReportRenderer.render(DiagnosticReportRenderer.java:67)\n    at org.hl7.fhir.r5.renderers.ResourceRenderer.render(ResourceRenderer.java:84)\n    at org.hl7.fhir.igtools.publisher.Publisher.generateNarratives(Publisher.java:1176)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3912)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:893)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:748)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8566)\n</code></pre></div>\n<p>My example resource is this:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;DiagnosticReport&quot;,\n  &quot;id&quot;: &quot;HAICA-TC-Lab-DiagnosticReport&quot;,\n  &quot;meta&quot;: {\n    &quot;profile&quot;: [\n      &quot;http://cbsig.chai.gatech.edu/StructureDefinition/cbs-lab-diagnosticreport&quot;\n    ]\n  },\n  &quot;category&quot;: [\n    {\n      &quot;coding&quot;: [\n        {\n          &quot;code&quot;: &quot;LAB&quot;,\n          &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v2-0074&quot;\n        }\n      ]\n    }\n  ],\n  &quot;status&quot;: &quot;final&quot;,\n  &quot;code&quot;: {\n    &quot;coding&quot;: [\n      {\n        &quot;code&quot;: &quot;85069-3&quot;,\n        &quot;system&quot;: &quot;http://loinc.org&quot;\n      }\n    ]\n  },\n  &quot;subject&quot;: {\n    &quot;reference&quot;: &quot;Patient/HAICA-TC-Patient&quot;\n  },\n  &quot;specimen&quot;: [\n    {\n      &quot;reference&quot;: &quot;Specimen/HAICA-TC-Specimen&quot;\n    }\n  ],\n  &quot;result&quot;: [\n    {\n      &quot;reference&quot;: &quot;Observation/HAICA-TC-Lab-Observation&quot;\n    }\n  ]\n}\n</code></pre></div>\n<p>It has something to do with the subject element but we cant figure out why theres an issue</p>",
        "id": 248988741,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1628606614
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span></p>",
        "id": 248991744,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1628607980
    },
    {
        "content": "<p>what resource is \"Patient/HAICA-TC-Patient\" referring to</p>",
        "id": 249005811,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628614605
    },
    {
        "content": "<p>Does it have a type</p>",
        "id": 249005823,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628614611
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span>  This is the Patient resource it references:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Patient&quot;,\n  &quot;id&quot;: &quot;HAICA-TC-Patient&quot;,\n  &quot;meta&quot;: {\n    &quot;profile&quot;: [\n      &quot;http://cbsig.chai.gatech.edu/StructureDefinition/cbs-patient&quot;\n    ]\n  },\n  &quot;extension&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;ombCategory&quot;,\n          &quot;valueCoding&quot;: {\n            &quot;code&quot;: &quot;2106-3&quot;,\n            &quot;system&quot;: &quot;urn:oid:2.16.840.1.113883.6.238&quot;,\n            &quot;display&quot;: &quot;White&quot;\n          }\n        },\n        {\n          &quot;url&quot;: &quot;detailed&quot;,\n          &quot;valueCoding&quot;: {\n            &quot;code&quot;: &quot;2135-2&quot;,\n            &quot;system&quot;: &quot;urn:oid:2.16.840.1.113883.6.238&quot;,\n            &quot;display&quot;: &quot;Hispanic or Latino&quot;\n          }\n        },\n        {\n          &quot;url&quot;: &quot;text&quot;,\n          &quot;valueString&quot;: &quot;Mixed&quot;\n        }\n      ],\n      &quot;url&quot;: &quot;http://cbsig.chai.gatech.edu/StructureDefinition/cbs-race&quot;\n    },\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;ombCategory&quot;,\n          &quot;valueCoding&quot;: {\n            &quot;code&quot;: &quot;2186-5&quot;,\n            &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v2-0005&quot;\n          }\n        },\n        {\n          &quot;url&quot;: &quot;text&quot;,\n          &quot;valueString&quot;: &quot;Not Hispanic or Latino&quot;\n        }\n      ],\n      &quot;url&quot;: &quot;http://cbsig.chai.gatech.edu/StructureDefinition/cbs-ethnicity&quot;\n    },\n    {\n      &quot;url&quot;: &quot;http://cbsig.chai.gatech.edu/StructureDefinition/cbs-birthsex&quot;,\n      &quot;valueCodeableConcept&quot;: {\n        &quot;coding&quot;: [\n          {\n            &quot;code&quot;: &quot;F&quot;,\n            &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v2-0001&quot;\n          }\n        ]\n      }\n    },\n    {\n      &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/patient-birthPlace&quot;,\n      &quot;valueAddress&quot;: {\n        &quot;country&quot;: &quot;USA&quot;\n      }\n    },\n    {\n      &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/patient-genderIdentity&quot;,\n      &quot;valueCodeableConcept&quot;: {\n        &quot;coding&quot;: [\n          {\n            &quot;code&quot;: &quot;female&quot;,\n            &quot;system&quot;: &quot;http://hl7.org/fhir/gender-identity&quot;\n          }\n        ]\n      }\n    }\n  ],\n  &quot;address&quot;: [\n    {\n      &quot;use&quot;: &quot;Address-at-Diagnosis&quot;,\n      &quot;district&quot;: &quot;Cobb&quot;,\n      &quot;state&quot;: &quot;Georgia&quot;,\n      &quot;postalCode&quot;: &quot;30126&quot;\n    },\n    {\n      &quot;use&quot;: &quot;Usual-Residence&quot;,\n      &quot;country&quot;: &quot;USA&quot;\n    }\n  ],\n  &quot;identifier&quot;: [\n    {\n      &quot;type&quot;: {\n        &quot;coding&quot;: [\n          {\n            &quot;code&quot;: &quot;Local-Record-ID&quot;,\n            &quot;system&quot;: &quot;http://cbsig.chai.gatech.edu/CodeSystem/cbs-temp-code-system&quot;,\n            &quot;display&quot;: &quot;Local Record ID&quot;\n          }\n        ],\n        &quot;text&quot;: &quot;Local Record ID&quot;\n      },\n      &quot;system&quot;: &quot;urn:temp:national-reporting-jurisdiction:48&quot;,\n      &quot;value&quot;: &quot;C_auris_02&quot;\n    },\n    {\n      &quot;type&quot;: {\n        &quot;coding&quot;: [\n          {\n            &quot;code&quot;: &quot;Local-Subject-ID&quot;,\n            &quot;system&quot;: &quot;http://cbsig.chai.gatech.edu/CodeSystem/cbs-temp-code-system&quot;,\n            &quot;display&quot;: &quot;Local Subject ID&quot;\n          }\n        ],\n        &quot;text&quot;: &quot;Local Subject ID&quot;\n      },\n      &quot;system&quot;: &quot;urn:temp:national-reporting-jurisdiction:48&quot;,\n      &quot;value&quot;: &quot;C_auris_PAT_02&quot;\n    }\n  ],\n  &quot;gender&quot;: &quot;female&quot;,\n  &quot;birthDate&quot;: &quot;1940-01-01&quot;\n}\n</code></pre></div>\n<p>(which works fine when being referenced in other examples)</p>",
        "id": 249007968,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1628615583
    },
    {
        "content": "<p>So, looking at the code you have provided, this is occuring because the <code>describe</code> method is trying to pull a <code>HumanName</code> from the patient object, which I think is a mandatory field, and there is not one.</p>",
        "id": 249111731,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628690516
    },
    {
        "content": "<p>So it pulls human name, it gets null, and then it passes that null to <code>render</code>, and when it can't find a match, it ends up at the last cases of the if statement</p>",
        "id": 249112118,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628690636
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code> else if (type.isPrimitive()) {\n      x.tx(type.primitiveValue());\n    } else {\n      x.tx(&quot;No display for &quot;+type.fhirType());\n    }\n</code></pre></div>",
        "id": 249112131,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628690641
    },
    {
        "content": "<p>and <code>type.isPrimative()</code> throws a NPE</p>",
        "id": 249112223,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628690666
    },
    {
        "content": "<p>Is it intentional to not define a <code>HumanName</code>  field for that <code>Patient</code>? <span class=\"user-mention\" data-user-id=\"421123\">@Andy Stevens</span></p>",
        "id": 249112313,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628690706
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span>  Our application is for public health case reporting, so the patient resources are not going to have names as part of the case reporting workflow. Is this an issue with DiagnosticReport specifically? Because this error only happens when I have that example resource in our input.</p>",
        "id": 249113301,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1628691181
    },
    {
        "content": "<p>We should certainly update the publisher to handle the situation of the name being omitted.</p>",
        "id": 249113803,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1628691352
    },
    {
        "content": "<p>Is there a current version of the IG i can look at online?</p>",
        "id": 249114257,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628691534
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"421123\">@Andy Stevens</span></p>",
        "id": 249115324,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628691950
    },
    {
        "content": "<p>Like, I would like to see the differential table for the patient resource in this IG</p>",
        "id": 249115526,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628692037
    },
    {
        "content": "<p>does it define HumanName as a non-mandatory field?</p>",
        "id": 249115552,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628692056
    },
    {
        "content": "<p>What is the cardinality and is there a flag for that field?</p>",
        "id": 249115657,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628692094
    },
    {
        "content": "<p>Heres our current IG: <a href=\"http://cbsig.chai.gatech.edu/index.html\">http://cbsig.chai.gatech.edu/index.html</a><br>\nIt doesnt have that set of examples that is causing the issue, but all of the profiles involved are published on there</p>",
        "id": 249116334,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1628692384
    },
    {
        "content": "<p>So that's a big dead link for me</p>",
        "id": 249116483,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628692445
    },
    {
        "content": "<p>name is originally a 0..* cardinality and we added a MS flag in case there ever will be a name (our sponsors like options), but still 0..*</p>",
        "id": 249116495,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1628692450
    },
    {
        "content": "<p>oh sorry I completely forgot that its currently behind a VPN for us. Heres the differential table for the patient:<br>\n<a href=\"/user_uploads/10155/NcUlQUovwfB3YgYqp1ttPGK9/Screen-Shot-2021-08-11-at-10.35.07-AM.png\">Screen-Shot-2021-08-11-at-10.35.07-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/NcUlQUovwfB3YgYqp1ttPGK9/Screen-Shot-2021-08-11-at-10.35.07-AM.png\" title=\"Screen-Shot-2021-08-11-at-10.35.07-AM.png\"><img src=\"/user_uploads/10155/NcUlQUovwfB3YgYqp1ttPGK9/Screen-Shot-2021-08-11-at-10.35.07-AM.png\"></a></div>",
        "id": 249116638,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1628692514
    },
    {
        "content": "<p>okay</p>",
        "id": 249116735,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628692560
    },
    {
        "content": "<p>So, please open an issue in github: <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/issues\">https://github.com/hapifhir/org.hl7.fhir.core/issues</a> (the files for this are located in the core project)</p>",
        "id": 249116862,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628692606
    },
    {
        "content": "<p>include all the details you provided above with the differential table screenshot</p>",
        "id": 249116894,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628692623
    },
    {
        "content": "<p>tag me in the github issue once you've created it <span class=\"user-mention\" data-user-id=\"421123\">@Andy Stevens</span></p>",
        "id": 249117186,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628692746
    },
    {
        "content": "<p>ok issue has been created</p>",
        "id": 249118345,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1628693283
    },
    {
        "content": "<p>I also see a strange error in DiagnosticReport gen:</p>\n<div class=\"codehilite\"><pre><span></span><code>Generating Narratives                                                            (00:23.0711)\nPublishing Content Failed: Cannot invoke &quot;org.hl7.fhir.r5.renderers.utils.BaseWrappers$PropertyWrapper.hasValues()&quot; because &quot;t&quot; is null (00:24.0535)\n                                                                                 (00:24.0535)\nUse -? to get command line help                                                  (00:24.0536)\n                                                                                 (00:24.0537)\nStack Dump (for debugging):                                                      (00:24.0537)\njava.lang.NullPointerException: Cannot invoke &quot;org.hl7.fhir.r5.renderers.utils.BaseWrappers$PropertyWrapper.hasValues()&quot; because &quot;t&quot; is null\n    at org.hl7.fhir.r5.renderers.DiagnosticReportRenderer.fetchObservations(DiagnosticReportRenderer.java:194)\n    at org.hl7.fhir.r5.renderers.DiagnosticReportRenderer.render(DiagnosticReportRenderer.java:123)\n    at org.hl7.fhir.r5.renderers.ResourceRenderer.render(ResourceRenderer.java:84)\n    at org.hl7.fhir.igtools.publisher.Publisher.generateNarratives(Publisher.java:1176)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3912)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:893)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:748)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8566)\n</code></pre></div>",
        "id": 249313865,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1628819724
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span></p>",
        "id": 249313920,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1628819772
    },
    {
        "content": "<p>This is a different issue, and should probably go in a different thread. The only thing in common is that you are both encountering issues with the same data type. Can you start a new thread with details on how you reproduced this, with all the inputs please.</p>",
        "id": 249361236,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628861915
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194192\">@Richard Stanley</span></p>",
        "id": 249361243,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1628861919
    }
]