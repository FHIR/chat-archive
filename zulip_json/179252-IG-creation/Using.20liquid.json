[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191387\">@Keith Boone</span> asked for more documentation about how to use liquid. So here goes:</p>",
        "id": 193854219,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586845355
    },
    {
        "content": "<p>in your IG you define a parameter <code>path-liquid</code> that points to a directory where you have liquid templates. E.g. <code>path-liquid</code>=<code>liquid</code></p>",
        "id": 193854257,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586845438
    },
    {
        "content": "<p>then, in that directory, you have a series of files like  <code>Patient.liquid</code> - .e.g with the name of the resource that they are the template for</p>",
        "id": 193854319,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586845479
    },
    {
        "content": "<p>the liquid template will be executed automatically when generating the narrative for any resource of that type.</p>",
        "id": 193854342,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586845510
    },
    {
        "content": "<p>the liquid spec is found here: <a href=\"https://confluence.hl7.org/display/FHIR/FHIR+Liquid+Profile\" title=\"https://confluence.hl7.org/display/FHIR/FHIR+Liquid+Profile\">https://confluence.hl7.org/display/FHIR/FHIR+Liquid+Profile</a></p>",
        "id": 193854349,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586845524
    },
    {
        "content": "<p>here's an example:</p>",
        "id": 193854351,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586845530
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>&lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;\n  &lt;table&gt;\n  &lt;tbody&gt;\n   &lt;tr&gt;\n    &lt;td&gt; Name&lt;/td&gt;\n    &lt;td&gt;\n<span class=\"p\">{%</span><span class=\"nt\">loop</span><span class=\"w\"> </span>name<span class=\"w\"> </span>in<span class=\"w\"> </span>Patient.name<span class=\"p\">%}</span>\n &lt;b&gt;<span class=\"p\">{{</span><span class=\"nv\">name</span><span class=\"p\">.</span><span class=\"nv\">family</span><span class=\"p\">}}</span>&lt;/b&gt;, <span class=\"p\">{{</span><span class=\"nv\">name</span><span class=\"p\">.</span><span class=\"nv\">given</span><span class=\"p\">}}</span> &lt;/br&gt;\n<span class=\"p\">{%</span><span class=\"nt\">endloop</span><span class=\"p\">%}</span>\n    &lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td&gt; Address&lt;/td&gt;\n    &lt;td&gt;<span class=\"p\">{{</span><span class=\"nv\">Patient</span><span class=\"p\">.</span><span class=\"nv\">address</span><span class=\"p\">.</span><span class=\"nv\">text</span><span class=\"p\">}}</span>&lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td&gt; Contacts&lt;/td&gt;\n    &lt;td&gt; Home: unknown. Work: (03) 5555 6473&lt;/td&gt;\n  &lt;/tr&gt;\n  <span class=\"p\">{%</span><span class=\"kr\">if</span><span class=\"w\"> </span><span class=\"nv\">Patient</span><span class=\"p\">.</span><span class=\"nv\">identifier</span><span class=\"p\">.</span><span class=\"nv\">exists</span><span class=\"err\">()</span><span class=\"p\">%}</span>\n  &lt;tr&gt;\n    &lt;td&gt; Id&lt;/td&gt;\n    &lt;td&gt; <span class=\"p\">{{</span><span class=\"nv\">identifier</span><span class=\"err\">[</span><span class=\"mi\">0</span><span class=\"err\">].</span><span class=\"nv\">type</span><span class=\"p\">.</span><span class=\"nv\">text</span><span class=\"p\">}}</span>: <span class=\"p\">{{</span><span class=\"nv\">identifier</span><span class=\"err\">[</span><span class=\"mi\">0</span><span class=\"err\">].</span><span class=\"nv\">value</span><span class=\"p\">}}</span>&lt;/td&gt;\n  &lt;/tr&gt;\n  <span class=\"p\">{%</span><span class=\"kr\">endif</span><span class=\"p\">%}</span>\n  &lt;/tbody&gt;\n  &lt;/table&gt;\n&lt;/div&gt;\n</pre></div>",
        "id": 193854913,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586846053
    },
    {
        "content": "<p>there's a rather useful FHIRPath function defined in the IG publisher called <code>.render() </code> which applies to data types which takes a lot of the finickity work out of this - you can use it on any data type, and it will generate the text that it think best represents the data type</p>",
        "id": 193855162,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586846299
    },
    {
        "content": "<p>e.g. the fragment above, you want to render and address... well, you can write liquid for all the possible combinations of Address... you can just do .render() and let my code do it.. and mostly my code is pretty robust</p>",
        "id": 193855204,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586846372
    },
    {
        "content": "<p>Keith - let me know if you want more... and it would be lovely if someone turned this into doco somewhere,,,?</p>",
        "id": 193855261,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586846412
    },
    {
        "content": "<p>Somewhere = the guidance IG?</p>",
        "id": 193860394,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1586850462
    },
    {
        "content": "<p>probably confluence for thta</p>",
        "id": 193874310,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586858380
    },
    {
        "content": "<p>though an example in the guidance IG would also be excellent</p>",
        "id": 193874329,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586858391
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  will  .render()  work for references and url so that you get a link?  It currently causes an error when I try to use it like so...</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;ul&gt;\n<span class=\"p\">{%</span><span class=\"w\"> </span><span class=\"nt\">for</span><span class=\"w\"> </span>var<span class=\"w\"> </span>in<span class=\"w\"> </span>Subscription.modifierExtension<span class=\"w\"> </span><span class=\"p\">%}</span>\n&lt;li&gt;(&lt;strong&gt;url:&lt;/strong&gt; <span class=\"p\">{{</span><span class=\"nv\">var</span><span class=\"p\">.</span><span class=\"nv\">url</span><span class=\"p\">.</span><span class=\"nv\">render</span><span class=\"err\">()</span><span class=\"p\">}}</span>, &lt;strong&gt;value: &lt;/strong&gt;<span class=\"p\">{{</span><span class=\"nv\">var</span><span class=\"p\">.</span><span class=\"nv\">valueUri</span><span class=\"p\">.</span><span class=\"nv\">render</span><span class=\"err\">()</span><span class=\"p\">}}</span>)&lt;/li&gt;\n<span class=\"p\">{%</span><span class=\"w\"> </span><span class=\"nt\">endfor</span><span class=\"w\"> </span><span class=\"p\">%}</span>\n&lt;/ul&gt;\n</code></pre></div>",
        "id": 199809115,
        "sender_full_name": "Eric Haas",
        "timestamp": 1591305216
    },
    {
        "content": "<p>there is a \" not yet implemented error\" error</p>",
        "id": 199809219,
        "sender_full_name": "Eric Haas",
        "timestamp": 1591305279
    },
    {
        "content": "<p>have you got a full stack?</p>",
        "id": 199809763,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1591305563
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Load Content                                                                     (00:56.0332)\nProcessing Conformance Resources                                                 (00:56.0852)\nPublishing Content Failed: Not done yet (IGPublisherHostServices.resolveFunction) (00:58.0736)\n                                                                                 (00:58.0737)\nUse -? to get command line help                                                  (00:58.0737)\n                                                                                 (00:58.0737)\nStack Dump (for debugging):                                                      (00:58.0738)\norg.apache.commons.lang3.NotImplementedException: Not done yet (IGPublisherHostServices.resolveFunction)\n    at org.hl7.fhir.igtools.publisher.Publisher$IGPublisherHostServices.resolveFunction(Publisher.java:377)\n    at org.hl7.fhir.r5.utils.LiquidEngine.resolveFunction(LiquidEngine.java:623)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parseExpression(FHIRPathEngine.java:902)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parseExpression(FHIRPathEngine.java:938)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parseExpression(FHIRPathEngine.java:938)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parse(FHIRPathEngine.java:369)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parse(FHIRPathEngine.java:362)\n    at org.hl7.fhir.r5.utils.LiquidEngine$LiquidStatement.evaluate(LiquidEngine.java:141)\n    at org.hl7.fhir.r5.utils.LiquidEngine$LiquidFor.evaluate(LiquidEngine.java:268)\n    at org.hl7.fhir.r5.utils.LiquidEngine.evaluate(LiquidEngine.java:102)\n    at org.hl7.fhir.r5.renderers.LiquidRenderer.render(LiquidRenderer.java:65)\n    at org.hl7.fhir.r5.renderers.ResourceRenderer.render(ResourceRenderer.java:76)\n    at org.hl7.fhir.igtools.publisher.Publisher.generateNarratives(Publisher.java:1032)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3605)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:834)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:696)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7430)\n(venv37) Erics-MacBook-Air-2:subscription-backport-ig ehaas$\n</code></pre></div>",
        "id": 199810834,
        "sender_full_name": "Eric Haas",
        "timestamp": 1591306214
    },
    {
        "content": "<p>it could be user error or misuse.  i am not sure what it would do for a url.</p>",
        "id": 199810942,
        "sender_full_name": "Eric Haas",
        "timestamp": 1591306289
    },
    {
        "content": "<p>I got this to work on Patient and Subscription but not on Bundle.  Is there a reason why can't use on Bundles?</p>",
        "id": 199831481,
        "sender_full_name": "Eric Haas",
        "timestamp": 1591325441
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?</p>",
        "id": 199831563,
        "sender_full_name": "Eric Haas",
        "timestamp": 1591325606
    },
    {
        "content": "<p>narrative generation won't work for bundles since they don't have narrative</p>",
        "id": 199832744,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1591327516
    },
    {
        "content": "<p>Ah stupid me...the Ig publisher is generating a display for them nonetheless, is that a template used by the publisher and can that be customized?</p>",
        "id": 199918727,
        "sender_full_name": "Eric Haas",
        "timestamp": 1591382692
    },
    {
        "content": "<p>to some degree - some bundles are rendered differently, but other than the special cases, the rendering is a series of html fragments separated by &lt;hr/&gt;, and where the default renderer is used for each entry. So liquid would apply</p>",
        "id": 199932244,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1591390091
    },
    {
        "content": "<p>I need to use this to render PlanDefinitions, but only a specific profile of PlanDefinitions.</p>",
        "id": 227102824,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1613839212
    },
    {
        "content": "<p>Is this a big change to ask?</p>",
        "id": 227102964,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1613839405
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> the reason for me to ask this is:<br>\nI want to render some resources using some liquid templates. For this, I need to tell the publisher:</p>\n<ul>\n<li>resource type A, profile 1 - liquid template X</li>\n<li>resource type A, profile 2 - liquid template Y</li>\n<li>resource type B, profile 1 - liquid template Z<br>\nFor this I need to tell the template what to do for each. Currently I'd have to do a big IF THEN ELSE.</li>\n</ul>",
        "id": 227514754,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614118771
    },
    {
        "content": "<p>Some of these resources are expected to be custom resources, so i need to differentiate the flavours</p>",
        "id": 227514796,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614118797
    },
    {
        "content": "<p>at the moment you can't have different liquid templates for different profiles</p>",
        "id": 227542203,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614136990
    },
    {
        "content": "<p>Is that something we could expose? Or too much work?</p>",
        "id": 227551501,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614145728
    },
    {
        "content": "<p>I don't know. I haven't really thought about it</p>",
        "id": 227552395,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614146603
    },
    {
        "content": "<p>If in my liquid folder I have not only <code>plandefinition.liquid</code> but also <code>plandefinition-homecare.liquid</code> and <code>plandefinition-medicationtreatment.liquid</code> and if the publisher would know the difference (i.e. <code>homecare</code>and <code>medicationtreatment</code> are the profile ids) that would be helpful</p>",
        "id": 227554827,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614148735
    },
    {
        "content": "<p>Is there a way to discover which liquid variables are defined in an IG?<br>\nI have found <a href=\"https://confluence.hl7.org/display/FHIR/FHIR+Liquid+Profile\">https://confluence.hl7.org/display/FHIR/FHIR+Liquid+Profile</a> but values like {{ page.title }} are not mentioned.</p>",
        "id": 227717963,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614229075
    },
    {
        "content": "<p>you can read the jekyll documentation ,and look in the _data directory</p>",
        "id": 227718092,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614229123
    },
    {
        "content": "<p>because that's what jekyll gets access too,</p>",
        "id": 227718096,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614229132
    },
    {
        "content": "<p>if that's what you mean by liquid.</p>",
        "id": 227718102,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614229139
    },
    {
        "content": "<p>Thanks<br>\nI found some stuff in temp\\pages\\_data<br>\nWhere is the FHIR IG docco?</p>",
        "id": 227718346,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614229306
    },
    {
        "content": "<p>actually, I'm not sure what you're asking about. there's 2 different contexts in which liquid is used - in jekyll, when building an IG, and in the IG publisher, when creating resource narratives. The work differnetly</p>",
        "id": 227719289,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614230017
    },
    {
        "content": "<p>Thanks. I did not know that. I'm looking at variable for creating resource narratives.</p>",
        "id": 227719388,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614230085
    },
    {
        "content": "<p>I'm after a variable for the title of a resource. I've found one for the name, but I want to put the title in documentation.</p>",
        "id": 227719451,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614230148
    },
    {
        "content": "<p>I thought it would be easy. Now it is a rabbit hole. <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 227719521,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614230196
    },
    {
        "content": "<p>I can get the name from {{ site.data.structuredefinitions.&lt;RESOURCE ID&gt;.name }}, but there is no title.<br>\nI'll do it with text instead of a variable.</p>",
        "id": 227719611,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614230325
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191682\">@Richard Townley-O'Neill</span> I'm in the rabbit hole (it's nice and cozy and it's dangerous out there). What do you need?</p>",
        "id": 227719781,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614230496
    },
    {
        "content": "<p>We have an IG not using the template approach built using the ig.json approach.<br>\nOn -intro pages for profiles we put the title of the profile at the start. I thought it would be nice to use a variable instead of remembering to change it when the resource gets a new title during development. I found a variable for the ig's title : {{ site.data.fhir.ig.title }}<br>\nbut for the resource all I could find was a name: {{ site.data.structuredefinitions.&lt;RESOURCE ID&gt;.name }} </p>\n<p>I expect there is no such vartiable.</p>",
        "id": 227721008,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614231689
    },
    {
        "content": "<p>what about site.data.pages?</p>",
        "id": 227721223,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614231876
    },
    {
        "content": "<p>if you have a pages.json file, does it contain the info?</p>",
        "id": 227721270,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614231926
    },
    {
        "content": "<p>also site.data.resources should have that info</p>",
        "id": 227721366,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614231998
    },
    {
        "content": "<p>pages.json has almost nothing. It has what is in  <a href=\"http://ImplementationGuide.definition.page\">ImplementationGuide.definition.page</a>, and that is just a stub.</p>",
        "id": 227721584,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614232230
    },
    {
        "content": "<p>if you're generating narrative, you only have what's in the resource that is being generated. If theres's no title in the resource, you can't use it when generating narrative</p>",
        "id": 227722290,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614232962
    },
    {
        "content": "<p>The structure definition has a title, which I can see in site.data.resources <br>\nWith site.data.resources I tried {{ site.data.resources.StructureDefinition/sra-match-record.title}}<br>\nand got nothing.<br>\nMaybe I need to escape the \"/\".</p>",
        "id": 227722461,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614233119
    },
    {
        "content": "<p>I think you're confused. Are you writing liquid for jekyll to process, or for generating narrative?</p>",
        "id": 227722875,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614233512
    },
    {
        "content": "<p>but if you're writing for a structure definition, the liquid will (or should) never be called - the IG publisher renders that itself</p>",
        "id": 227722940,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614233543
    },
    {
        "content": "<p>I am writing for the narrative. I want the circled bit to be a variable <br>\n<a href=\"/user_uploads/10155/XYofDUknXIvbvUxRuzLuvM1V/image.png\">image.png</a> <br>\nfrom <a href=\"https://sra.digitalhealth.gov.au/fhir/currentdraft/StructureDefinition-sra-organization.html\">https://sra.digitalhealth.gov.au/fhir/currentdraft/StructureDefinition-sra-organization.html</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/XYofDUknXIvbvUxRuzLuvM1V/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/XYofDUknXIvbvUxRuzLuvM1V/image.png\"></a></div>",
        "id": 227723483,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614234082
    },
    {
        "content": "<p>Gotta go.</p>",
        "id": 227723501,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1614234117
    },
    {
        "content": "<p>there's no variables - you just have access to what's in the resource</p>",
        "id": 227724614,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614235109
    },
    {
        "content": "<p>If anyone is trying to get this to work in a SUSHI project, this worked for me:</p>\n<p>1) Add the following to sushi-config.yaml:</p>\n<div class=\"codehilite\"><pre><span></span><code>parameters:\n  &quot;liquid-path&quot;: &quot;liquid&quot;\n</code></pre></div>\n<p>2) Create a folder <code>input/liquid/</code> and add a file like <code>Patient.liquid</code> as Grahame describes above</p>",
        "id": 227760767,
        "sender_full_name": "Max Masnick",
        "timestamp": 1614257203
    },
    {
        "content": "<p>When I add my own <code>Patient.liquid</code> file, is there a place I can see the template I'm overriding?</p>",
        "id": 227760864,
        "sender_full_name": "Max Masnick",
        "timestamp": 1614257254
    },
    {
        "content": "<p>I believe that when you add a Patient.liquid, you are not overriding the template, you are telling the Java code to let it go</p>",
        "id": 227761890,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614257746
    },
    {
        "content": "<p>Ah ok, that makes sense</p>",
        "id": 227762376,
        "sender_full_name": "Max Masnick",
        "timestamp": 1614258003
    },
    {
        "content": "<p>I have yet to find an object that <code>render()</code> actually works on. For example, <code>Observation.value.render()</code>, <code>Observation.value.coding.render()</code>, <code>Observation.value.coding.code.render()</code> all produce the following exception:</p>\n<div class=\"codehilite\"><pre><span></span><code>org.apache.commons.lang3.NotImplementedException: Not done yet (IGPublisherHostServices.resolveFunction)\n    at org.hl7.fhir.igtools.publisher.Publisher$IGPublisherHostServices.resolveFunction(Publisher.java:385)\n    at org.hl7.fhir.r5.utils.LiquidEngine.resolveFunction(LiquidEngine.java:623)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parseExpression(FHIRPathEngine.java:1038)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parseExpression(FHIRPathEngine.java:1079)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parseExpression(FHIRPathEngine.java:1079)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parse(FHIRPathEngine.java:431)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.parse(FHIRPathEngine.java:423)\n    at org.hl7.fhir.r5.utils.LiquidEngine$LiquidStatement.evaluate(LiquidEngine.java:141)\n    at org.hl7.fhir.r5.utils.LiquidEngine.evaluate(LiquidEngine.java:102)\n    at org.hl7.fhir.r5.renderers.LiquidRenderer.render(LiquidRenderer.java:75)\n    at org.hl7.fhir.r5.renderers.ResourceRenderer.render(ResourceRenderer.java:84)\n    at org.hl7.fhir.igtools.publisher.Publisher.generateNarratives(Publisher.java:1152)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3826)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:877)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:732)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8417)\n</code></pre></div>\n<p>Is this truly not implemented, or am I just doing something silly?</p>",
        "id": 227763304,
        "sender_full_name": "Max Masnick",
        "timestamp": 1614258429
    },
    {
        "content": "<p>truly not implemented.</p>",
        "id": 227807595,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614275123
    },
    {
        "content": "<p>apparently I overlooked hooking something up</p>",
        "id": 227807627,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614275132
    },
    {
        "content": "<p>Well having briefly attempted to replicate the behavior of <code>render()</code> in Liquid, I can definitely see the value of <code>render()</code> <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 227808270,
        "sender_full_name": "Max Masnick",
        "timestamp": 1614275380
    },
    {
        "content": "<p>y.</p>",
        "id": 227808314,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614275399
    },
    {
        "content": "<p>it's now on my list</p>",
        "id": 227808370,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614275407
    },
    {
        "content": "<p>Thanks!!</p>",
        "id": 227808399,
        "sender_full_name": "Max Masnick",
        "timestamp": 1614275416
    },
    {
        "content": "<p>I have a similar setup and having problems with <code>include</code>.</p>\n<p>I would like to create a partial and include it in Patient.liquid. However any attempt at <code>{% include 'test' %}</code> fails in the rendered output with an inline error </p>\n<div class=\"codehilite\"><pre><span></span><code>Exception generating Narrative: Script template: Error reading include: &quot;test&quot;\n</code></pre></div>\n<p>I think it is happening here <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils/LiquidEngine.java#L494-L521\">https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils/LiquidEngine.java#L494-L521</a>, but really can't make any sense of what that code is doing.</p>\n<p>Any suggestions? Is there an example somewhere of a successful <code>include</code>?</p>",
        "id": 272339520,
        "sender_full_name": "Brian Kaney",
        "timestamp": 1645140720
    },
    {
        "content": "<p>There is this testcase in the fhir-test-cases repository: <a href=\"https://github.com/FHIR/fhir-test-cases/blob/master/r5/liquid/liquid-tests.json#L46\">https://github.com/FHIR/fhir-test-cases/blob/master/r5/liquid/liquid-tests.json#L46</a></p>",
        "id": 272728178,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645472404
    },
    {
        "content": "<p>It looks like the LiquidEngine that is being used at that point for the narrative generation doesn't have an implementation of the IncludeResolver, so it doesn't know how to get the templates. I've sketched what I _think_ will work here:</p>",
        "id": 272739830,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645481636
    },
    {
        "content": "<p><a href=\"https://github.com/cqframework/org.hl7.fhir.core/pull/2\">https://github.com/cqframework/org.hl7.fhir.core/pull/2</a></p>",
        "id": 272739832,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645481636
    },
    {
        "content": "<p>But it's a change down in core to the LiquidRenderer</p>",
        "id": 272739890,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645481657
    },
    {
        "content": "<p>But I can't get a good build locally due to some seemingly unrelated package cache tests failing</p>",
        "id": 272739949,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645481734
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> I don't understand this - the test passes?</p>",
        "id": 273029256,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645660710
    },
    {
        "content": "<p>It does, but that's because it sets a includeTemplateResolver in the test setup. When the Liquid Engine is used in the publisher to generate the narratives, it doesn't have an includeTemplateResolver set. We can see in the debug that the templates are loaded in the template provider, but there's no glue from the LiquidEngine to be able to resolve the templates there. So that's what this proposed PR does, just adds a class that implements the template resolver interface using the template provider in the context, and sets the LiquidEngine's include resolver to that instance.</p>",
        "id": 273031999,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645662676
    },
    {
        "content": "<p>ok well make it as a PR then</p>",
        "id": 273032727,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645663260
    },
    {
        "content": "<p><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/pull/750\">https://github.com/hapifhir/org.hl7.fhir.core/pull/750</a></p>",
        "id": 273041096,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645671442
    }
]