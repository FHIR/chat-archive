[
    {
        "content": "<p>Is it possible to constrain the <code>valueReference</code> of an extension to a specific profile?  See the example below for something the IG publisher outputs in this situation:<br>\n<a href=\"/user_uploads/10155/8cjXSl8ka-0mRVqrM--ZNkP5/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/8cjXSl8ka-0mRVqrM--ZNkP5/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/8cjXSl8ka-0mRVqrM--ZNkP5/pasted_image.png\"></a></div><p><code>shr-base-Subject-extension</code> defines a <code>valueReference</code> to <code>DomainResource</code>.  In a profile, the profile constrains that extension's <code>valueReference</code> to point to a <code>WoundPresent</code> profile.</p>\n<p>You can see in the screenshot above that the IG ends up listing both the original reference (in line with the base extension) and the profile reference (in line with the unrolled <code>valueReference</code>).  This doesn't seem quite right, but I'm not sure if I'm doing something unsupported or if the IG publisher just doesn't handle it correctly.</p>",
        "id": 153986079,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1534211541
    },
    {
        "content": "<p>it feels like an IG publisher issue, but I won't know until I debug in detail</p>",
        "id": 153986080,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534211618
    },
    {
        "content": "<p>Alright.  Relatively speaking, I'd say this one is low priority.  I mainly wanted to be sure that the general idea of what I was doing (applying a type constraint on an extension) wasn't horribly illegal.</p>",
        "id": 153986088,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1534212949
    },
    {
        "content": "<p>Is this the same use case?</p>\n<p><a href=\"/user_uploads/10155/lt_EBoGyWERLL_58zs3yBWga/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/lt_EBoGyWERLL_58zs3yBWga/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/lt_EBoGyWERLL_58zs3yBWga/pasted_image.png\"></a></div><p>And then in the extension:<br>\n<a href=\"user_uploads/10155/UpwzBeIAvrC1BE-0wXTaZXe4/pasted_image.png\" target=\"_blank\" title=\"user_uploads/10155/UpwzBeIAvrC1BE-0wXTaZXe4/pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"user_uploads/10155/UpwzBeIAvrC1BE-0wXTaZXe4/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"user_uploads/10155/UpwzBeIAvrC1BE-0wXTaZXe4/pasted_image.png\"></a></div><p>It looks different to yours though...</p>",
        "id": 153986096,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534213352
    },
    {
        "content": "<p>I'm not sure?  The first image looks like the use of the <code>extension-rr-routing-entity</code> extension in a profile.  The 2nd image looks like the definition of the <code>extension-rr-responsible-agency</code> extension.  Are those supposed to be related somehow?</p>\n<p>I think mine is more like the first if you had another profile (e.g., <code>Child Routing Entity</code>) and you tried to constrain the <code>extension-rr-routing-entity</code> extension to reference the <code>Child Routing Entity</code> instead.</p>",
        "id": 153986108,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1534213934
    },
    {
        "content": "<p>Yeah, wrong screen shot... <br>\nSo the extension-rr-routing-entity references a profile called Routing Entity. <br>\nIs that what your extension is doing?</p>",
        "id": 153986110,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534214068
    },
    {
        "content": "<p>I'm not sure if I'm doing it correctly - it seems like the same idea, but maybe it isn't....</p>",
        "id": 153986112,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534214159
    },
    {
        "content": "<p>It looks like your screen shot is showing where the extension is used, not where it's defined?</p>",
        "id": 153986115,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534214226
    },
    {
        "content": "<p>I think that what you're doing is the pretty typical use case -- and it looks to me like you're doing it right.</p>",
        "id": 153986116,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1534214296
    },
    {
        "content": "<p>So you are constraining the valueReference when it gets used? Is that the difference?</p>",
        "id": 153986117,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534214378
    },
    {
        "content": "<p>My use case is a little different.  In my use case, imagine a profiler says, \"I like that extension-rr-routing-entity extension, but I actually want to constrain the profile it references (RoutingEntity) even further! I want it to say the reference must be to StricterRoutingEntity!\"</p>",
        "id": 153986118,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1534214415
    },
    {
        "content": "<p>Yeah, I think that's the difference.  The other approach, of course, would be just to create _another_ whole extension with its own unique name.  But maybe that's not necessary?</p>",
        "id": 153986119,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1534214465
    },
    {
        "content": "<p>Ah ok... Interesting!</p>",
        "id": 153986120,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534214466
    },
    {
        "content": "<p>It actually is close to my use case - I've been struggling with it. I have ended up with 3 of almost the same extension - if it's possible to do what you are doing, I might have to change it. Then I'd only have the one extension (entity/agency) which could be further constrained at that higher level to routing/responsible/rules authoring. </p>\n<p>I'll have to look into it. It would be less clutter - it's been bothering me to have the 3 extensions.</p>",
        "id": 153986123,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534214620
    },
    {
        "content": "<p>Darn it! Didn't want to get sucked into any rabbit holes today! <span class=\"emoji emoji-1f602\" title=\"joy\">:joy:</span> <span class=\"emoji emoji-1f602\" title=\"joy\">:joy:</span> <span class=\"emoji emoji-1f602\" title=\"joy\">:joy:</span></p>",
        "id": 153986125,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534214734
    },
    {
        "content": "<p>Ha!  You're welcome!</p>",
        "id": 153986126,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1534214783
    },
    {
        "content": "<p>so where are we with this now?</p>",
        "id": 153986424,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534271318
    },
    {
        "content": "<p>I've updated my IG to use that same pattern and it looks the same as Chris's. (Haven't run it yet this morning though - not sure what changes have happened over night...).</p>\n<p><a href=\"/user_uploads/10155/HYOuRyG9Z11TSgFwKBifXchx/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/HYOuRyG9Z11TSgFwKBifXchx/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/HYOuRyG9Z11TSgFwKBifXchx/pasted_image.png\"></a></div>",
        "id": 153986433,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534271501
    },
    {
        "content": "<p>which page is that?</p>",
        "id": 153986437,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534271561
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/ig/HL7/case-reporting/StructureDefinition-rr-plandefinition.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/case-reporting/StructureDefinition-rr-plandefinition.html\">http://build.fhir.org/ig/HL7/case-reporting/StructureDefinition-rr-plandefinition.html</a> </p>\n<p><a href=\"https://github.com/HL7/case-reporting/blob/master/source/resources/profiles/structuredefinition-rr-plandefinition.xml\" target=\"_blank\" title=\"https://github.com/HL7/case-reporting/blob/master/source/resources/profiles/structuredefinition-rr-plandefinition.xml\">https://github.com/HL7/case-reporting/blob/master/source/resources/profiles/structuredefinition-rr-plandefinition.xml</a></p>",
        "id": 153986442,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534271928
    },
    {
        "content": "<p>Did you take a look at this <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ? Is it expected behaviour? Is the pattern even legal?</p>",
        "id": 153987279,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534382727
    },
    {
        "content": "<p>I can't find that reference?</p>",
        "id": 153987283,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534383689
    },
    {
        "content": "<p>Oh yeah, I changed the name (for a way longer and clearly superior name <span class=\"emoji emoji-1f602\" title=\"joy\">:joy:</span> ): </p>\n<p><a href=\"http://build.fhir.org/ig/HL7/case-reporting/StructureDefinition-rr-relevant-reportable-condition-plandefinition.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/case-reporting/StructureDefinition-rr-relevant-reportable-condition-plandefinition.html\">http://build.fhir.org/ig/HL7/case-reporting/StructureDefinition-rr-relevant-reportable-condition-plandefinition.html</a></p>\n<p><a href=\"https://github.com/HL7/case-reporting/blob/master/source/resources/profiles/structuredefinition-rr-relevant-reportable-condition-plandefinition.xml\" target=\"_blank\" title=\"https://github.com/HL7/case-reporting/blob/master/source/resources/profiles/structuredefinition-rr-relevant-reportable-condition-plandefinition.xml\">https://github.com/HL7/case-reporting/blob/master/source/resources/profiles/structuredefinition-rr-relevant-reportable-condition-plandefinition.xml</a></p>",
        "id": 153987285,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534384113
    },
    {
        "content": "<p>It's the \"Rules Authoring Agency Test\" bit</p>",
        "id": 153987286,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534384187
    },
    {
        "content": "<p>so I don't understand what you're trying to do here</p>",
        "id": 153987292,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534384845
    },
    {
        "content": "<blockquote>\n<p>My use case is a little different.  In my use case, imagine a profiler says, \"I like that extension-rr-routing-entity extension, but I actually want to constrain the profile it references (RoutingEntity) even further! I want it to say the reference must be to StricterRoutingEntity!\"</p>\n</blockquote>\n<p>Trying out <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> pattern that he explains above. It works for my use case as I could have fewer specific extensions...</p>",
        "id": 153987294,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534384949
    },
    {
        "content": "<p>this:</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;element id=&quot;PlanDefinition.publisher.extension:rulesAuthoringAgency&quot;&gt;\n      &lt;path value=&quot;PlanDefinition.publisher.extension&quot; /&gt;\n      &lt;sliceName value=&quot;rulesAuthoringAgency&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Extension&quot; /&gt;\n        &lt;profile value=&quot;http://hl7.org/fhir/us/ecr/StructureDefinition/extension-rr-rules-authoring-agency&quot; /&gt;\n      &lt;/type&gt;\n      &lt;mustSupport value=&quot;true&quot; /&gt;\n      &lt;mapping&gt;\n        &lt;identity value=&quot;cda-rr&quot; /&gt;\n        &lt;map value=&quot;Rules Authoring Agency&quot; /&gt;\n      &lt;/mapping&gt;\n    &lt;/element&gt;\n</pre></div>\n\n\n<p>That's a standard extension profile, ok. Then this:</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;element id=&quot;PlanDefinition.publisher.extension:rulesAuthoringAgencyTest&quot;&gt;\n      &lt;path value=&quot;PlanDefinition.publisher.extension&quot; /&gt;\n      &lt;sliceName value=&quot;rulesAuthoringAgencyTest&quot; /&gt;\n      &lt;short value=&quot;Rules Authoring Agency Test&quot; /&gt;\n      &lt;definition value=&quot;Optional Extension Element - found in all resources.&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Extension&quot; /&gt;\n        &lt;profile value=&quot;http://hl7.org/fhir/us/ecr/StructureDefinition/extension-ecr-organization&quot; /&gt;\n      &lt;/type&gt;\n      &lt;mustSupport value=&quot;true&quot; /&gt;\n    &lt;/element&gt;\n</pre></div>\n\n\n<p>ok that's very similar. but then we walk into the extension, and say:</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;element id=&quot;PlanDefinition.publisher.extension:rulesAuthoringAgencyTest.value[x]:valueReference&quot;&gt;\n      &lt;path value=&quot;PlanDefinition.publisher.extension.valueReference&quot; /&gt;\n      &lt;sliceName value=&quot;valueReference&quot; /&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot; /&gt;\n        &lt;targetProfile value=&quot;http://hl7.org/fhir/us/ecr/StructureDefinition/rr-rules-authoring-agency&quot; /&gt;\n      &lt;/type&gt;\n    &lt;/element&gt;\n</pre></div>\n\n\n<p>I don't understand that pattern at all, but it looks like exactly what's rendered to me...</p>",
        "id": 153987295,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534384972
    },
    {
        "content": "<p>It is exactly what is rendered - but my question is - is this even a reasonable pattern? If you scroll to the beginning of topic you can see Chris's original question...</p>",
        "id": 153987297,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534385058
    },
    {
        "content": "<p>I don't understand the intention?</p>",
        "id": 153987300,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534385323
    },
    {
        "content": "<p>So rather than creating 3 extensions, one for each of my different types of organisation, just create one extension that references the base of the 3 different organisations, the when you use the extension, specialise it further at that point.</p>",
        "id": 153987301,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534385468
    },
    {
        "content": "<p>I should probably just roll back to my original pattern - if YOU don't understand it, probably not the best idea!</p>",
        "id": 153987302,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534385682
    },
    {
        "content": "<p>Ha.  I never claimed that it was a good idea.  Only that we do it. ;-)</p>",
        "id": 153987322,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1534387904
    },
    {
        "content": "<p>I liked it!</p>",
        "id": 153987323,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534388322
    },
    {
        "content": "<p>I'm actually rolling it back though - I can't get an example to validate when I use the pattern. Maybe I'm doing something wrong in my example, but no time to debug at this late juncture... Maybe will investigate again after ballot...</p>",
        "id": 153987325,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534388413
    },
    {
        "content": "<blockquote>\n<p>create one extension that references the base of the 3 different organisations, the when you use the extension, specialise it further at that point</p>\n</blockquote>\n<p>That part makes sense, I think. I would've thought it would validate</p>",
        "id": 153987326,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534389516
    },
    {
        "content": "<p>Who knows - seeing double at this point... As I'm sure you are, actually you're probably at triple ...</p>",
        "id": 153987328,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534389627
    },
    {
        "content": "<p>Might test again later</p>",
        "id": 153987329,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534389675
    },
    {
        "content": "<p>I'm going for your pattern <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  - managed to get it to work - just some dumb errors in my example were causing the errors.</p>",
        "id": 153987336,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1534393145
    },
    {
        "content": "<p>We want a profile to constrain references in an extension using the technique discussed above. We can constrain the extension values in the profile using a text editor. (See 4/ below) The result displays acceptably in IG Publisher output <br>\n<a href=\"/user_uploads/10155/Z6MOWSuTsDjBWdizUFHB7D4T/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/Z6MOWSuTsDjBWdizUFHB7D4T/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/Z6MOWSuTsDjBWdizUFHB7D4T/pasted_image.png\"></a></div><p>and in Forge<br>\n<a href=\"/user_uploads/10155/BM3nXhdz_Rc1R25oWadUmHlH/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/BM3nXhdz_Rc1R25oWadUmHlH/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/BM3nXhdz_Rc1R25oWadUmHlH/pasted_image.png\"></a></div><p>But we cannot create this constraint using Forge. @Vadim Peretokin @Michel Rutten Can Forge do this? How?</p>\n<p>1/ The extension: <a href=\"https://github.com/hl7au/au-fhir-base-stu3/blob/master/resources/structuredefinition-composition-author-role.xml\" target=\"_blank\" title=\"https://github.com/hl7au/au-fhir-base-stu3/blob/master/resources/structuredefinition-composition-author-role.xml\">composition-author-role</a><br>\n2/ The profile using the extension at lines 39-50: <a href=\"https://github.com/hl7au/au-fhir-base-stu3/blob/master/resources/au-composition.xml\" target=\"_blank\" title=\"https://github.com/hl7au/au-fhir-base-stu3/blob/master/resources/au-composition.xml\">au-composition</a><br>\n3/ The profile of au-composition in which we constrain the extension with an invariant at lines 50-63: <a href=\"https://github.com/AuDigitalHealth/ci-fhir-stu3/blob/master/resources/composition-shs-1.xml\" target=\"_blank\" title=\"https://github.com/AuDigitalHealth/ci-fhir-stu3/blob/master/resources/composition-shs-1.xml\">composition-shs-1</a><br>\n4/ How we'd like to constrain the extension</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;element id=&quot;Composition.extension:compositionAuthorRole&quot;&gt;\n      &lt;path value=&quot;Composition.extension&quot; /&gt;\n      &lt;sliceName value=&quot;compositionAuthorRole&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;max value=&quot;1&quot; /&gt;\n      &lt;mustSupport value=&quot;true&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Composition.extension:compositionAuthorRole.valueReference:valueReference&quot;&gt;\n      &lt;path value=&quot;Composition.extension.valueReference&quot; /&gt;\n      &lt;sliceName value=&quot;valueReference&quot; /&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot; /&gt;\n        &lt;targetProfile value=&quot;http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/practitionerrole-withpractitionerident-1&quot; /&gt;\n      &lt;/type&gt;\n    &lt;/element&gt;\n</pre></div>",
        "id": 169364921,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1561950492
    }
]