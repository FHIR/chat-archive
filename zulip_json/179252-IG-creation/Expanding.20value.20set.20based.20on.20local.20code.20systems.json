[
    {
        "content": "<p>I made some attempts to define intensional value sets based on local code systems for my IG, but in all the cases the result is \"No Expansion for this valueset (not supported by Publication Tooling)\". <br>\nBefore analyzing more in deep if I did anything wrong (not unlikely :-) ) I'd like to be sure that this depends by the fact that these code systems are not known by the terminology server used by the publisher. (and likely they will never be)</p>",
        "id": 198459496,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590163486
    },
    {
        "content": "<p>..obviously the intensional value set works if the rule is take all the codes from code system XYZ..</p>",
        "id": 198460685,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590164026
    },
    {
        "content": "<p>Right.  If a value set points to codes from a code system the terminology server doesn't know - and that aren't defined in the value set defined within the IG or inherited from dependent IGs - the terminology server can't expand the value set.</p>",
        "id": 198460700,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590164034
    },
    {
        "content": "<p>Thanks Lloyd. So.. what should be done to overcome this and allow the usage of intensional value sets based on local code systems for IGs developed by affiliates ? I don't think it is reasonable to imagine that all local code systems would be centrally loaded ...</p>",
        "id": 198462788,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590164841
    },
    {
        "content": "<p>I think you can add the code system to the IG?  That's what we did with the absent-unknown codes in IPS.</p>",
        "id": 198463172,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1590165012
    },
    {
        "content": "<p>And the alternative would be add support for the code system to whatever terminology server you specify for the IG build.</p>",
        "id": 198463325,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1590165107
    },
    {
        "content": "<p>I have the code system in the IG. <br>\nthe &lt;include&gt;&lt;system value=\"xyz\"/&gt;&lt;/include&gt; works<br>\nBut when I try to apply filters the results is \"No Expansion for this valueset ...\"</p>",
        "id": 198466090,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590166483
    },
    {
        "content": "<p>Adding the code system to the IG means an actual CodeSystem instance</p>",
        "id": 198472223,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590169463
    },
    {
        "content": "<p>I would expect this to work. you don't get any additional information in the error?</p>",
        "id": 198500609,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590185450
    },
    {
        "content": "<p>the message I see from the QA page is \"Error from server: Unable to provide support for code system ...\"</p>",
        "id": 198533159,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590236489
    },
    {
        "content": "<p>can I reproduce this?</p>",
        "id": 198550213,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590264939
    },
    {
        "content": "<p><a href=\"https://github.com/HL7-IT/base.git\">https://github.com/HL7-IT/base.git</a></p>",
        "id": 198783387,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590508561
    },
    {
        "content": "<p>hmm. Sushi fails in a way I don't understand:</p>\n<div class=\"codehilite\"><pre><span></span><code>Sushi: info  Running SUSHI v0.12.3                                               (00:01.0048)\nSushi: info  Current FSH tank conforms to an IG Publisher context. Output will be adjusted accordingly. (00:01.0048)\nSushi: info  Checking local cache for hl7.fhir.r4.core#4.0.1...                  (00:01.0050)\nSushi: info  Found hl7.fhir.r4.core#4.0.1 in local cache.                        (00:01.0553)\nSushi: info  Checking local cache for hl7.fhir.it.base#dev...                    (00:01.0553)\nSushi: info  Did not find hl7.fhir.it.base#dev in local cache.                   (00:01.0554)\nSushi: info  Falling back to hl7.fhir.it.base#current since hl7.fhir.it.base#dev is not locally cached. To avoid this, add hl7.fhir.it.base#dev to your local FHIR cache. (00:01.0554)\nSushi: info  Importing FSH text...                                               (00:01.0561)\nSushi: info  Preprocessed 5 documents with 15 aliases.                           (00:01.0745)\nSushi: info  Imported 22 definitions and 6 instances.                            (00:01.0755)\nSushi: info  Loaded package hl7.fhir.r4.core#4.0.1                               (00:01.0761)\nSushi: error Failed to load hl7.fhir.it.base#dev                                 (00:04.0027)\nSushi: error The package hl7.fhir.it.base#current is not available on http://build.fhir.org/ig/qas.json, so no current version can be loaded (00:04.0027)\nSushi: info  Converting FSH to FHIR resources...                                 (00:04.0034)\nSushi: info  Converted 9 FHIR StructureDefinitions.                              (00:04.0155)\nSushi: info  Converted 11 FHIR ValueSets.                                        (00:04.0183)\nSushi: info  Converted 2 FHIR CodeSystems.                                       (00:04.0188)\nSushi: info  Converted 6 FHIR instances.                                         (00:04.0268)\nSushi: info  Exporting FHIR resources as JSON...                                 (00:04.0269)\nSushi: info  Exported 28 FHIR resources as JSON.                                 (00:04.0294)\nSushi:                                                                           (00:04.0295)\nSushi: ╔════════════════════════ SUSHI RESULTS ══════════════════════════╗       (00:04.0295)\nSushi: ║ ╭──────────┬────────────┬───────────┬─────────────┬───────────╮ ║       (00:04.0295)\nSushi: ║ │ Profiles │ Extensions │ ValueSets │ CodeSystems │ Instances │ ║       (00:04.0296)\nSushi: ║ ├──────────┼────────────┼───────────┼─────────────┼───────────┤ ║       (00:04.0296)\nSushi: ║ │    6     │     3      │    11     │      2      │     6     │ ║       (00:04.0296)\nSushi: ║ ╰──────────┴────────────┴───────────┴─────────────┴───────────╯ ║       (00:04.0296)\nSushi: ║                                                                 ║       (00:04.0296)\nSushi: ╠═════════════════════════════════════════════════════════════════╣       (00:04.0296)\nSushi: ║ That really smelt.                     2 Errors      0 Warnings ║       (00:04.0296)\nSushi: ╚═════════════════════════════════════════════════════════════════╝       (00:04.0297)\nSushi couldn&#39;t be run. Complete output from running Sushi :                      (00:04.0314)\nNote: Check that Sushi is installed correctly (&quot;npm install -g fsh-sushi&quot;. On windows, get npm from https://www.npmjs.com/get-npm) (00:04.0315)\nException: Process exited with an error: 1 (Exit value: 1)                       (00:04.0315)\nPublishing Content Failed: Process exited with an error: 1 (Exit value: 1)       (00:04.0315)\n</code></pre></div>",
        "id": 198830916,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590533261
    },
    {
        "content": "<p>Your version of sushi is old.  0.12.7 is latest</p>",
        "id": 198834507,
        "sender_full_name": "David Pyke",
        "timestamp": 1590535962
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  could sushi advise if an old version is running?</p>",
        "id": 198839195,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590540153
    },
    {
        "content": "<p>version didn't make any difference</p>",
        "id": 198840846,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590542187
    },
    {
        "content": "<p>Mmhh ..interesting to know..I was wondering if it may be due to a dependency I've in my fsh package..BTW this is not relevant here..</p>",
        "id": 198861879,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590567243
    },
    {
        "content": "<p>I've created a branch (\"no-fsh\") that doesn't use fsh , in case you may have still time to make this check</p>",
        "id": 198862140,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590567469
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- here are the two reported errors from this log:</p>\n<blockquote>\n<p>Sushi: error Failed to load hl7.fhir.it.base#dev                                 (00:04.0027)<br>\nSushi: error The package hl7.fhir.it.base#current is not available on <a href=\"http://build.fhir.org/ig/qas.json\">http://build.fhir.org/ig/qas.json</a>, so no current version can be loaded (00:04.0027)</p>\n</blockquote>\n<p>In short, it can't resolve the <code>hl7.fhir.it.base</code> dependency.  The <code>hl7.fhir.it.base</code> dependency is specified as version <code>dev</code> in this IG.  Since SUSHI fails to find it in the local cache, it falls back to <code>current</code> -- which tries to pull it from the auto-build.  But the autobuild listing (<a href=\"http://build.fhir.org/ig/qas.json\">here</a>) doesn't know anything about <code>hl7.fhir.it.base</code> either -- so the dependency fails to resolve.</p>",
        "id": 198888857,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590585583
    },
    {
        "content": "<p>As for notifying when SUSHI is old, we'll look into that.  We just need to ensure that we can have an approach that still allows SUSHI to run offline (when dependencies are already cached).</p>",
        "id": 198889000,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590585656
    },
    {
        "content": "<blockquote>\n<p>it can't resolve the hl7.fhir.it.base dependency</p>\n</blockquote>\n<p>right. Which is odd since that's what it's actually building - it can't depend on itself. I don't expect that the problem is with Sushi there</p>",
        "id": 198945441,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590609867
    },
    {
        "content": "<p>Ah.  I see that now.  In the <a href=\"https://github.com/HL7-IT/base/blob/master/package.json\">package.json</a> (which is what SUSHI 0.12.x reads) it declares itself as a dependency.  <span class=\"user-mention\" data-user-id=\"191415\">@Giorgio Cangioli</span> -- can you edit <code>package.json</code> to remove <code>hl7.fhir.it.base</code> from the dependencies and instead make it the value of <code>\"name\"</code> (instead of <code>\"fish\"</code>)?  I think that will help with at least the issue Grahame ran into.</p>",
        "id": 198951379,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590612606
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> . At a certain point I added this \"internal dependency\" to overcome a fsh error that I had referring a profile defined in the same IG, but not as a fsh file. Now it seems to work also without this self-dependency :-). I committed the modified version.  Nothing has been changed concerning the expansion.</p>",
        "id": 198986629,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590647032
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191415\">@Giorgio Cangioli</span> I still can't run this: Unable to load template from it-template</p>",
        "id": 199115910,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590730734
    },
    {
        "content": "<p>I think I remember seeing somewhere else that you need to prefix <code>#</code> to local templates in the ig.ini.  So in ig.ini, maybe try this instead?</p>\n<div class=\"codehilite\"><pre><span></span><code>template = #it-template\n</code></pre></div>\n\n\n<p>I don't recall for sure, so I might be wrong, but it's worth a shot since it's so quick and easy to do.</p>",
        "id": 199150759,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590757455
    },
    {
        "content": "<p>that is correct - local templates are prefixed with # <br>\nIt is documented in the file itself</p>",
        "id": 199152043,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1590758123
    },
    {
        "content": "<p><a href=\"https://github.com/FHIR/sample-ig/blob/master/ig.ini\">https://github.com/FHIR/sample-ig/blob/master/ig.ini</a></p>",
        "id": 199152051,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1590758126
    },
    {
        "content": "<p>It seems that the github repository includes the it-template/package folder ... what do you suggest I should check  ? (obviously in my building environment all work fine ...)</p>",
        "id": 199160665,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590762217
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191415\">@Giorgio Cangioli</span> -- I think you need to change <code>it-template</code> to <code>#it-template</code> in the <code>ig.ini</code> file.</p>",
        "id": 199161989,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1590762824
    },
    {
        "content": "<p>change pushed on GitHub</p>",
        "id": 199163781,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590763661
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span></p>",
        "id": 199163794,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1590763672
    },
    {
        "content": "<p>ok now that I can run the IG succesfully, where do I look for this issue?</p>",
        "id": 199206989,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1590783599
    },
    {
        "content": "<p>I apologize <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ,  it seems I missed your answer...<br>\n... now things are a little worse,  in the sense that all the expansions with the local code systems are not rendered (message: \"No Expansion for this valueset (not supported by Publication Tooling)\") ; also those simple as <br>\n \"compose\": {<br>\n    \"include\": [<br>\n      {<br>\n        \"system\": \"<a href=\"http://terminology.hl7.it/CodeSystem/istat-professioni\">http://terminology.hl7.it/CodeSystem/istat-professioni</a>\"<br>\n      }<br>\n    ]</p>",
        "id": 200997872,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1592304698
    },
    {
        "content": "<p>In any case this is the example of the value set with filter <br>\n    - <a href=\"http://www.hl7.it/fhir/build/it-base/site/ValueSet-minsan-esenzioni.html\">http://www.hl7.it/fhir/build/it-base/site/ValueSet-minsan-esenzioni.html</a></p>\n<p>Other intensional value sets without filters are for example:<br>\n    - <a href=\"http://www.hl7.it/fhir/build/it-base/site/ValueSet-minsan-idStrutture.html\">http://www.hl7.it/fhir/build/it-base/site/ValueSet-minsan-idStrutture.html</a><br>\n    - <a href=\"http://www.hl7.it/fhir/build/it-base/site/ValueSet-istat-titoloStudio.html\">http://www.hl7.it/fhir/build/it-base/site/ValueSet-istat-titoloStudio.html</a></p>",
        "id": 200997961,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1592304758
    },
    {
        "content": "<p>thanks for your suggestions</p>",
        "id": 200997980,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1592304775
    },
    {
        "content": "<p>can you please create a task here: <a href=\"https://github.com/HL7/fhir-ig-publisher/issues\">https://github.com/HL7/fhir-ig-publisher/issues</a> and reference the branch of your repo that demonstrates the problem, and where to find it - thanks</p>",
        "id": 201044721,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592326749
    },
    {
        "content": "<p>done, thanks</p>",
        "id": 201127149,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1592392150
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  have you any feedback on the <a href=\"https://github.com/HL7/fhir-ig-publisher/issues/113#issuecomment-645857666\">remaining issue</a> ? Thanks for your kind help :-)</p>",
        "id": 201710562,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1592909086
    },
    {
        "content": "<p>it won't build because package-list.json is in the pages input folder. don't put it there</p>",
        "id": 201924513,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593049570
    },
    {
        "content": "<p>but it says \"unknown code system\" because it's an unknown code system.</p>",
        "id": 201925297,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593050437
    },
    {
        "content": "<p>Thanks a lot <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ..<br>\nThis brings me back to my very initial questions :-)<br>\n(1) Expanding value set based on local code systems (by using filters) is not currently possible , because \"local code systems\" are not known by the terminology server used by the publishing process<br>\n(2) is anything that can be done to overcome this issue when developing a REALM specific IG</p>",
        "id": 202319836,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1593441838
    },
    {
        "content": "<p>I don't think that's true. Do you have an example?</p>",
        "id": 202366137,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593463748
    }
]