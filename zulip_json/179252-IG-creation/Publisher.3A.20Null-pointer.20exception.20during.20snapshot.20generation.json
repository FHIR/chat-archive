[
    {
        "content": "<p>Hi! Not sure if this is by design or a newly introduced bug, but running later IG-publishers, I'm getting a null-pointer exception if mapping for an element is a blank string. From what I have seen this happens both with an empty string and a whitespace.</p>\n<p>Example snippet from differential:</p>\n<div class=\"codehilite\"><pre><span></span>{\n        &quot;id&quot;: &quot;Observation.valueQuantity.value&quot;,\n        &quot;path&quot;: &quot;Observation.valueQuantity.value&quot;,\n        &quot;mapping&quot;: [\n          {\n            &quot;identity&quot;: &quot;v2&quot;,\n            &quot;map&quot;: &quot;SN.2  / CQ - N/A&quot;\n          },\n          {\n            &quot;identity&quot;: &quot;other-mapping&quot;,\n            &quot;map&quot;: &quot;&quot;\n          }\n        ]\n      }\n</pre></div>\n\n\n<p>The stacktrace:</p>\n<div class=\"codehilite\"><pre><span></span>java.lang.Exception: Error generating snapshot for ExampleProfile(example-profile): Unable to generate snapshot for http://example.com/StructureDefinition/example-profile in ..\n        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4019)\n        at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3448)\n        at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:796)\n        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:657)\n        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7062)\nCaused by: org.hl7.fhir.exceptions.FHIRException: Unable to generate snapshot for http://example.com/StructureDefinition/example-profile in ..\n        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4072)\n        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshots(Publisher.java:4017)\n        ... 4 more\nCaused by: java.lang.NullPointerException\n        at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:591)\n        at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:4070)\n        ... 5 more\nException in thread &quot;main&quot; java.lang.NullPointerException\n        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7085)\n</pre></div>\n\n\n<p>I haven't done too much debugging, but can see that the ElementDefinitionMappingComponent.map is null which causes a null-pointer due to the trim call in <code>mm.setMap(mm.getMap().trim())</code>. I don't know if the fix, if one is to be done, should be to ensure that the ElementDefinitionMappingComponent.map is not null, to compensate for the possibility of it being null before <code>mm.setMap(mm.getMap().trim())</code> or to throw a more verbose exception. Until then, I've ensured that the map always has some none-whitespace content in my profiles.</p>",
        "id": 192778484,
        "sender_full_name": "Pétur Valdimarsson",
        "timestamp": 1585906253
    },
    {
        "content": "<p>well, ok, I'll fix that next release. But \"map\" : \"\" is illegal</p>",
        "id": 192778815,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585906457
    },
    {
        "content": "<p>Yes, it was in my profiles due to a sushi-workaround. I think just a more descriptive exception would be quite sufficient.</p>",
        "id": 192778916,
        "sender_full_name": "Pétur Valdimarsson",
        "timestamp": 1585906520
    },
    {
        "content": "<p>not having a problem in the first place would be even better</p>",
        "id": 192778970,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585906558
    },
    {
        "content": "<p>Indeed true.</p>",
        "id": 192779101,
        "sender_full_name": "Pétur Valdimarsson",
        "timestamp": 1585906620
    },
    {
        "content": "<blockquote>\n<p>Yes, it was in my profiles due to a sushi-workaround</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"193397\">@Pétur Valdimarsson</span> -- what is this SUSHI workaround?  Something we need to address on our side?</p>",
        "id": 192796382,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585917343
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  This may alrady have been fixed, have not tried since before 0.11 came out:</p>",
        "id": 192796572,
        "sender_full_name": "Pétur Valdimarsson",
        "timestamp": 1585917461
    },
    {
        "content": "<p><a href=\"#narrow/stream/215610-shorthand/topic/Mapping.20value.5Bx.5D.2Eproperty\" title=\"#narrow/stream/215610-shorthand/topic/Mapping.20value.5Bx.5D.2Eproperty\">https://chat.fhir.org/#narrow/stream/215610-shorthand/topic/Mapping.20value.5Bx.5D.2Eproperty</a></p>",
        "id": 192796578,
        "sender_full_name": "Pétur Valdimarsson",
        "timestamp": 1585917465
    }
]