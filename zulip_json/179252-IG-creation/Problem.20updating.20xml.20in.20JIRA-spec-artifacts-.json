[
    {
        "content": "<p>I'm trying to check in <code>FHIR-us-mcode.xml </code> and getting validation errors. Here are type of statement causing the problem:</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;artifact deprecated=&quot;true&quot; id=&quot;StructureDefinition/mcode-cancer-patient&quot; key=&quot;cancer-patient&quot; name=&quot;Cancer Patient Profile&quot;/&gt;\n&lt;artifact id=&quot;StructureDefinition/mcode-cancer-patient&quot; key=&quot;StructureDefinition-mcode-cancer-patient&quot; name=&quot;Cancer Patient Profile&quot;/&gt;\n</code></pre></div>\n<p>I am getting two types of error messages:</p>\n<div class=\"codehilite\"><pre><span></span><code>[schemavalidate] /home/runner/work/JIRA-Spec-Artifacts/JIRA-Spec-Artifacts/xml/FHIR-us-mcode.xml:33:135: cvc-identity-constraint.4.1: Duplicate unique value [StructureDefinition/mcode-cancer-patient] declared for identity constraint &quot;artifact-id-unique&quot; of element &quot;specification&quot;.\n</code></pre></div>\n<p>and:</p>\n<div class=\"codehilite\"><pre><span></span><code>     [xslt] ERROR: Artifact with key FHIR-us-mcode-cancer-patient in specification FHIR-us-mcode has been removed or changed.  Keys should never change - just change the name.  Keys should also not usually be removed.  Instead, set the &#39;deprecated&#39; flag to true.  Keys can only be removed if no JIRA tracker references that artifact.  If this is the case and the key should really be removed, please coordinate with an administrator.\n</code></pre></div>",
        "id": 260158083,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635956163
    },
    {
        "content": "<p>you're intentionally trying to change the key of that structure definition?</p>",
        "id": 260159876,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1635956950
    },
    {
        "content": "<p>Yeah, moving from the old key format to the new causes all kinds of problems <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span></p>",
        "id": 260160154,
        "sender_full_name": "David Pyke",
        "timestamp": 1635957069
    },
    {
        "content": "<p>You can't change keys.  Keys need to stay the same forever or it breaks Jira.  (That's not entirely true - there are back-end things we can do, but they're painful and time-consuming, so the default answer is 'once a key exists, it never goes away and never changes')</p>",
        "id": 260165322,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635959078
    },
    {
        "content": "<p>Keep the key as it was and just change the name and/or artifact id.</p>",
        "id": 260165371,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635959099
    },
    {
        "content": "<p>Noting that other xml's don't have keys for deprecated items, I deleted the keys. That only gave another error, and it is a frustrating one, because it is claiming something changed, but I am directly copying jira-xml-new.</p>",
        "id": 260166449,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635959575
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code> [xslt] ERROR: Artifact with key FHIR-us-mcode-StructureDefinition-mcode-evidence-type in specification FHIR-us-mcode has been removed or changed.  Keys should never change - just change the name.  Keys should also not usually be removed.  Instead, set the &#39;deprecated&#39; flag to true.  Keys can only be removed if no JIRA tracker references that artifact.  If this is the case and the key should really be removed, please coordinate with an administrator.\n</code></pre></div>",
        "id": 260166465,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635959581
    },
    {
        "content": "<p>Impossible. I give up. <a href=\"/user_uploads/10155/gFUU-dlFWA3an5Zvx-196vVo/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/gFUU-dlFWA3an5Zvx-196vVo/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/gFUU-dlFWA3an5Zvx-196vVo/image.png\"></a></div>",
        "id": 260167382,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635959997
    },
    {
        "content": "<p>please move this to the <a class=\"stream\" data-stream-id=\"179252\" href=\"/#narrow/stream/179252-IG-creation\">#IG creation</a></p>",
        "id": 260168952,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1635960722
    },
    {
        "content": "<p><a href=\"https://zulip.com/help/move-content-to-another-stream\">https://zulip.com/help/move-content-to-another-stream</a><br>\nThis doesn't work for me because \"move topic\" is not a menu choice I have at my disposal.</p>",
        "id": 260173481,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635962651
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"184932\" href=\"/#narrow/stream/184932-JIRA.2FConfluence/topic/Problem.20updating.20xml.20in.20JIRA-spec-artifacts-\">#JIRA/Confluence &gt; Problem updating xml in JIRA-spec-artifacts-</a> by <span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span></p>",
        "id": 260174853,
        "sender_full_name": "Notification Bot",
        "timestamp": 1635963202
    },
    {
        "content": "<p>(<span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span> moving messages across topics is configured as a moderators-only feature here. For anyone who wants to be a mod, please ping me, I expect we could use more  :-))</p>",
        "id": 260174922,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1635963237
    },
    {
        "content": "<p>So, just to reiterate the problem... I <em>thought</em> one just had to take jira-new.xml and check it into the Jira-spec-artifacts/xml.  But it doesn't work that way, apparently. Nor can I find -- after MUCH MUCH trial and error -- any edits that successfully address the error messages that come out of the verification checks.</p>",
        "id": 260175407,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635963435
    },
    {
        "content": "<p>This process sounds incredibly frustrating.</p>",
        "id": 260175572,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1635963496
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span> just to be pedantic - you've run the IG Publisher on your guide, you get the jira-new.xml that it produces, and when you overwrite your entry in your Jira-Spec-Artifacts fork and run the build on that, you get the errors that you posted about a missing key?</p>",
        "id": 260181094,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1635965916
    },
    {
        "content": "<p>Exactly. But the first set of errors are about duplicate keys (I get a bunch of this type):</p>\n<div class=\"codehilite\"><pre><span></span><code>Duplicate unique value [StructureDefinition/mcode-cancer-patient] declared for identity constraint\n</code></pre></div>",
        "id": 260181457,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635966047
    },
    {
        "content": "<p>I tried just about everything to get around this, and that's when I started seeing errors of this type:</p>\n<div class=\"codehilite\"><pre><span></span><code>Artifact with key FHIR-us-mcode-cancer-patient in specification FHIR-us-mcode has been removed or changed.\n</code></pre></div>",
        "id": 260181607,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635966118
    },
    {
        "content": "<p>Can you share the current 'new' file?</p>",
        "id": 260182272,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635966410
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/AoEe1goYq3343KxNe05jsQKV/jira-new.xml\">jira-new.xml</a> </p>\n<p>i just cloned the repo to see and I see the same problem that Mark saw - the jira-new is being produced with artifacts that have the same id but a different key - one is deprecated and one isn't.</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;artifact deprecated=&quot;true&quot; id=&quot;StructureDefinition/mcode-cancer-patient&quot; key=&quot;cancer-patient&quot; name=&quot;Cancer Patient&quot;/&gt;\n&lt;artifact id=&quot;StructureDefinition/mcode-cancer-patient&quot; key=&quot;StructureDefinition-mcode-cancer-patient&quot; name=&quot;Cancer Patient Profile&quot;/&gt;\n</code></pre></div>",
        "id": 260182506,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1635966495
    },
    {
        "content": "<p>And I should point out that <code>mcode-cancer-patient</code> is not deprecated and there has never been a version without that profile. However, we did change the title from \"title\" : \"Cancer Patient\" to \"title\" : \"Cancer Patient Profile\", because that renders better in some contexts. That should be benign; title is just a display text with no deeper significance.</p>",
        "id": 260184829,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635967659
    },
    {
        "content": "<p>Right.  But the process doesn't understand renames, so it instead puts in an 'add' and a 'deprecate'.  What you want to do is move the new name to the 'deprecated' key and remove the deprecated flag and remove the new entry with the 'new' key entirely.</p>",
        "id": 260185635,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635968004
    },
    {
        "content": "<p>I wonder whether the process could understand renames - whether it would be easier to remember to make a record somewhere when you rename</p>",
        "id": 260190942,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1635970288
    },
    {
        "content": "<p>This has been my day -- 5 hours.  Now the problem seems to be revolving around the change of ids on extensions from id=\"Extension/foo\" to id=\"StructureDefinition/foo\" . No idea how to fix the mess. </p>\n<div class=\"codehilite\"><pre><span></span><code>     [xslt] ERROR: Artifact with key FHIR-us-mcode-StructureDefinition-mcode-evidence-type in specification FHIR-us-mcode has been removed or changed.  Keys should never change - just change the name.  Keys should also not usually be removed.  Instead, set the &#39;deprecated&#39; flag to true.  Keys can only be removed if no JIRA tracker references that artifact.  If this is the case and the key should really be removed, please coordinate with an administrator.\n</code></pre></div>",
        "id": 260191216,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635970437
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 260191654,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635970659
    },
    {
        "content": "<p>&lt;!-- Here is a problem --&gt;<br>\n&lt;artifact deprecated=\"true\" id=\"Extension/mcode-evidence-type-extension\" key=\"evidence-type-extension\" name=\"Evidence Type\"/&gt;<br>\n&lt;artifact id=\"StructureDefinition/mcode-evidence-type-extension\" key=\"evidence-type-extension\" name=\"Evidence Type Extension\"/&gt;<br>\n&lt;!-- End of problem ha ha --&gt;</p>",
        "id": 260192099,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635970845
    },
    {
        "content": "<p>For that one, just delete the 'deprecated' row and submit with the new artifact id and the original key.  (Not sure how you got an id of 'Extension/???' originally...)</p>",
        "id": 260205110,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635977775
    },
    {
        "content": "<p>We've talked about trying to drive renames from Git, but it'd be pretty complex and wouldn't catch the numerous cases where renames happen that don't manifest in Git.  For example, if you have 3 examples in a FSH file, renaming the artifact in the FSH file isn't going to show up in Git.<br>\nAs mentioned in an earlier thread, there's a proposal to revemp this process which will help with some of the pain, but not all of it.</p>",
        "id": 260205589,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635978144
    },
    {
        "content": "<p>These aren't name, they are Titles. The profile name did not change.</p>",
        "id": 260210477,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635981298
    },
    {
        "content": "<p>'name' is irrelevant.  It's just for computable artifacts.  Jira cares about 'title', which is what shows up as artifact/@name.  That's what \"real humans\" are expected to see when looking at an artifact page or table of contents.</p>",
        "id": 260211343,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635981888
    },
    {
        "content": "<p>Your suggestion 6:16 pm did not work. It is still giving the \"Keys should not change\" message.</p>",
        "id": 260211534,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635982029
    },
    {
        "content": "<p>But I copied what was in master, and it passed, finally. But it makes zero sense because the current name is not \"Evidence Type\"</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;artifact id=&quot;StructureDefinition/mcode-evidence-type&quot; key=&quot;StructureDefinition-mcode-evidence-type&quot; name=&quot;Evidence Type&quot;/&gt;\n&lt;artifact deprecated=&quot;true&quot; id=&quot;Extension/mcode-evidence-type-extension&quot; key=&quot;evidence-type-extension&quot; name=&quot;Evidence Type Extension&quot;/&gt;\n</code></pre></div>\n<p><span aria-label=\"cross mark\" class=\"emoji emoji-274c\" role=\"img\" title=\"cross mark\">:cross_mark:</span></p>",
        "id": 260211700,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635982188
    },
    {
        "content": "<p>Anyway, I am so so so done with this and someone with powers can merge it: <a href=\"https://github.com/HL7/JIRA-Spec-Artifacts/pull/333\">https://github.com/HL7/JIRA-Spec-Artifacts/pull/333</a></p>",
        "id": 260211788,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635982237
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/ig/HL7/fhir-mCODE-ig/branches/master/StructureDefinition-mcode-evidence-type.profile.json.html\">http://build.fhir.org/ig/HL7/fhir-mCODE-ig/branches/master/StructureDefinition-mcode-evidence-type.profile.json.html</a></p>",
        "id": 260211920,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635982327
    },
    {
        "content": "<p>I suspect this will not get rid of the build warning either</p>",
        "id": 260211989,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635982397
    },
    {
        "content": "<blockquote>\n<p>'name' is irrelevant. It's just for computable artifacts. Jira cares about 'title', which is what shows up as artifact/@name. That's what \"real humans\" are expected to see when looking at an artifact page or table of contents.</p>\n</blockquote>\n<p>However 'title' is not a proper persistent identifier. It is just free text and if one thinks of a better description, the title may change and it is still the same StructureDefinition.  Change the ID, however, they it is not the same.</p>",
        "id": 260212499,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635982891
    },
    {
        "content": "<p>hey <span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span> congratulations - you are now a qualified expert, well suited to help others with this onerous task. Congratulations on graduating</p>",
        "id": 260213988,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1635984116
    },
    {
        "content": "<p>I know you are teasing, but I truly have no idea what I am doing.  What finally passed validation is dead wrong.</p>",
        "id": 260214325,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635984401
    },
    {
        "content": "<p>When we come to FMG soon for publication approval, that Jira warning will will still be on the QA page.</p>",
        "id": 260214571,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1635984677
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span> Sorry for not having time to chase this further.  First thing I see is this:<br>\nIn the build log, when processing the Jira file, it's reporting this:<br>\n<strong>WARNING</strong> Jira file generation will not be correct because multiple artifacts have the same name (ignoring content in \"()\"): Staging Type Value Set<br>\n<strong>WARNING</strong> Jira file generation will not be correct because multiple artifacts have the same name (ignoring content in \"()\"): Staging Type Value Set<br>\n<strong>WARNING</strong> Jira file generation will not be correct because multiple artifacts have the same name (ignoring content in \"()\"): Staging Type Value Set</p>\n<p>Content in round brackets is used to designate old names for the artifact and are ignored in name comparisons and for matching.  So, I'd suggest renaming \"Staging Type Value Set (for Distant Metastases Category)\" to \"Distant Metastases Category Staging Type Value Set\" or, if you need them to sort together, \"Staging Type Value Set - Distant Metastases Category\"</p>\n<p>I recognize that this rule isn't well-documented.  Grahame is working on catching it earlier in the process.  If you have thoughts on where would be a good place to put it that IG authors would see, we can put it there too.</p>\n<p>Continuing to probe to see what else is going on for you.</p>",
        "id": 260219876,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635990171
    },
    {
        "content": "<p>I've made some fixes to the HL7 template around generating new Jira files that handled some edge cases you had in your file <span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span>.  The only remaining issue that I see now with the generated 'new' file is that it (correctly) yells about there being a duplicate name between an artifact that was deprecated in the 'current' Jira-Spec-Artifacts and an artifact that is being added as 'new' based on the current set of artifacts in the IG - specifically \"Evidence Type Extension\".  (Looks like you yanked it, then put it back?)<br>\nThe simplest thing to do is to un-deprecate the old artifact (i.e. use the old key) and associate it with the new artifact id.  If you do that and commit the Jira spec file, then all should be well.</p>\n<p>I have <em>not</em> merged your current pull request so you can look at the results of the new template process and address this one change.</p>\n<p>I'm sorry for the time this has cost you :(</p>",
        "id": 260226555,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1635997866
    },
    {
        "content": "<p>from the next release of the IG publisher HL7 IGs will get a new kind of error:</p>",
        "id": 260235703,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636009921
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/cUSD8zoBtvjQO14O9G2bBUMW/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/cUSD8zoBtvjQO14O9G2bBUMW/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/cUSD8zoBtvjQO14O9G2bBUMW/image.png\"></a></div>",
        "id": 260235739,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636009923
    },
    {
        "content": "<p>this is because these name clashes are a common source of problems in the jira file</p>",
        "id": 260235766,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636009944
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> heads up since that's from yours (I happened to be building that IG when I tested this)</p>",
        "id": 260236018,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636010274
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> It looks like you manually tweaked your Jira file to avoid the duplicates, but didn't update your source, so presumably you're getting the \"not aligned\" warning.</p>",
        "id": 260313583,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1636050300
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> my sins in the past with Plan-Net will be atoned for by someone else....I think <span class=\"user-mention\" data-user-id=\"215603\">@Sean Mahoney</span> will have that opportunity.</p>",
        "id": 260361021,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1636080863
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  Almost all the errors are now gone, but there is still trouble with Evidence Type Extension. I did exactly what you said (I think), and now I am getting:</p>\n<div class=\"codehilite\"><pre><span></span><code>[xslt] ERROR: Artifact with key FHIR-us-mcode-StructureDefinition-mcode-evidence-type in specification FHIR-us-mcode has been removed or changed.  Keys should never change - just change the name.  Keys should also not usually be removed.  Instead, set the &#39;deprecated&#39; flag to true.  Keys can only be removed if no JIRA tracker references that artifact.  If this is the case and the key should really be removed, please coordinate with an administrator.\n</code></pre></div>",
        "id": 260465304,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1636146713
    },
    {
        "content": "<p>It looks like we've now got both old and new committed, each with their own key, so we can't delete one of them anymore.  If the issue is you want the new 'current' one to be called \"Evidence Type Extension\" rather than \"Evidence Type\" (which is what's there now), then you'll need to change the name of the old deprecated one to something that doesn't conflict. (e.g. \"Evidence Type Extension - old\")</p>",
        "id": 260466141,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1636147136
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  I changed the new name. So now it is good to merge, if you can do so: <a href=\"https://github.com/HL7/JIRA-Spec-Artifacts/pull/336\">https://github.com/HL7/JIRA-Spec-Artifacts/pull/336</a><br>\nThank you for your help.</p>",
        "id": 260472212,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1636151215
    },
    {
        "content": "<p>&lt;deleted&gt; <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 260476222,
        "sender_full_name": "Rob Reynolds",
        "timestamp": 1636154471
    },
    {
        "content": "<p>Is it an anti-pattern to have the same title for both a code system and a value set? Or is this just an issue with Jira integration?</p>",
        "id": 260622543,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1636356982
    },
    {
        "content": "<p>In the standard templates, it also means you'll get two entries with the same name in the table of contents - which is less than ideal.  So I'd say it's at least somewhat an anti-pattern</p>",
        "id": 261434784,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1636918847
    },
    {
        "content": "<p>very much so, since newbies are already confused by value set vs code system all the time. So we want to be as clear as we can about this</p>",
        "id": 261434913,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636919048
    }
]