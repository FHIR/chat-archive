[
    {
        "content": "<p>Hi,</p>\n<p>Our project generates a DSTU3 implementation guide using a jruby docker image (see attached Dockerfile), including latest Jekyll install and the latest org.hl7.fhir.igpublisher.jar. However, this broke recently. It seems to stall during \"Jekyll generating...\". If I login to the docker image while it's running and perform a thread dump on the Jekyll process, it seems to be resolving/looking up some gems (but I'm no Ruby expert - see attached thread_dump.txt). I tried adding a Java 11 runtime and fixing the Jekyll version to 3.8.5, but no luck.</p>\n<p>I'm able to generate the IG outside of docker, but that requires a Ruby installation, XCode, Jekyll etc. Anyway, it doesn't seem to be an issue with our IG.</p>\n<p>Does anyone have a working Dockerfile (or just a working documented setup) using the new IG publisher?</p>\n<p>Btw: I build+run the publisher like this:</p>\n<p>docker build . -t igpublisher:localbuild<br>\ncd &lt;IG directory&gt;<br>\ndocker run -v ${PWD}/:/app/ igpublisher:localbuild  /app/ig.json</p>\n<p><a href=\"/user_uploads/10155/e65mNXttaXdqheZq-lsGOl7z/Dockerfile\" target=\"_blank\" title=\"Dockerfile\">Dockerfile</a> <br>\n<a href=\"/user_uploads/10155/Yjo8aYIbhv0qnD_5lmzr_fsg/thread_dump.txt\" target=\"_blank\" title=\"thread_dump.txt\">thread_dump.txt</a></p>",
        "id": 174697600,
        "sender_full_name": "Ole Hedegaard",
        "timestamp": 1567410402
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 174723618,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567435969
    },
    {
        "content": "<p>beats me. I don't use docker or know anything about it, and it works outside docker...</p>",
        "id": 174738653,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567453336
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> which versions of Jekyll is the IgPublisher compatible with?</p>",
        "id": 174769392,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567500480
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191363\">@Vadim Peretokin</span> are you guys using the IGpub and docker in combo?</p>",
        "id": 174794887,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567521659
    },
    {
        "content": "<p>We have our own custom IG publisher engine on Simplifier because the performance of the IG publisher isn't really realtime, so no we don't use it</p>",
        "id": 174796584,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1567522733
    },
    {
        "content": "<p>There's no structural dependency on Jekyll version that I know of; we run it via command line so we're pretty isolated. There's nasty stuff around Ruby which is a horrible thing, but if Jekyll runs from the command line, I have no idea why it wouldn't work for the IGPublisher</p>",
        "id": 174820460,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567538219
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> so what versions of jekyll is the Ig compatible with?</p>",
        "id": 174862538,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567586869
    },
    {
        "content": "<p>really I don't know. the IGPublisher doesn't use any feature of Jekyll that wasn't documented 4 years ago. It would be up to the templates / html things to hammer away on new features</p>",
        "id": 174862728,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567587013
    },
    {
        "content": "<p>So the million dollar question is then: Have you changed anything in the part of executing jekyll from the igpub jar in the last couple of months?</p>",
        "id": 174951332,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567668749
    },
    {
        "content": "<p>docker is a tool for process isolation - and our docker image for building IG's haven't changed. The only thing that has changed within the image is the version of the igpub</p>",
        "id": 174951366,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567668802
    },
    {
        "content": "<p>and now stuff does not work any more with the latest version of the igpub as it hangs in the statement:<br>\n<code>Jekyll: Generating...</code></p>",
        "id": 174951824,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567669245
    },
    {
        "content": "<p>I confirm that there has been no change around executing Jekyll. </p>\n<p>Looking at the code: \"Generating...\" comes from Jekyll. That means Jekyll has started correctly.</p>",
        "id": 174952153,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567669658
    },
    {
        "content": "<p>what happens if you kill the process at the point, and run Jekyll directly from the command line? The command line parameters for Jekyll are :</p>\n<p><code> build --destination  [output]</code></p>\n<p>Where output is the name of the output folder, and current folder is the temp folder. Does it work then?</p>",
        "id": 174952217,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567669728
    },
    {
        "content": "<p>Hmmmm .... so far I've found the following: During generation of the IG the following is in the output:</p>\n<div class=\"codehilite\"><pre><span></span>Error in snapshot generation: Differential for http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-address with id: Address.extension:regionalSubdivisionCode.valueCodeableConcept:valueCodeableConcept.coding has an element that is not marked with a snapshot match\nError in snapshot generation: Differential for http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-address with id: Address.extension:regionalSubdivisionCode.valueCodeableConcept:valueCodeableConcept.coding:regionalCode has an element that is not marked with a snapshot match\nError in snapshot generation: Differential for http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-address with id: Address.extension:regionalSubdivisionCode.valueCodeableConcept:valueCodeableConcept.coding:regionalCode.system has an element that is not marked with a snapshot match\n</pre></div>\n\n\n<p>This does not stop the further processing of the publisher. In the end it still hangs in the <code>Jekyll: Generating...</code></p>\n<p>Now, if I step into the container, I've found an exception:<br>\n<code>Liquid Exception: Could not locate the included file 'header.html' in any of [\"/app/_includes\"]. Ensure it exists in one of those directories and, if it is a symlink, does not point outside your site source. in temp/Address-ehealth-address-genexample.html</code><br>\nI suspect there's a link between these errors. What is more interesting is that the reason why it looks like Jekyll keeps hanging is that the exception is probably not interpreted/handled by the IGpublisher</p>",
        "id": 174966463,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567684933
    },
    {
        "content": "<blockquote>\n<p>f I step into the container</p>\n</blockquote>\n<p>not sure what that means but I could believe that I'm failing to pick up a Jekyll error... that's kind of a fun game. but nothing has changed there recently. But you can't step into Jekyll...</p>",
        "id": 174966536,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567685018
    },
    {
        "content": "<p>but you can pick up the output of running jekyll</p>",
        "id": 174966589,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567685049
    },
    {
        "content": "<p><a href=\"https://github.com/HL7/fhir-ig-publisher/blob/c422f4d5992dab4f477072e656be3078799d5312/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L4458\" target=\"_blank\" title=\"https://github.com/HL7/fhir-ig-publisher/blob/c422f4d5992dab4f477072e656be3078799d5312/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L4458\">https://github.com/HL7/fhir-ig-publisher/blob/c422f4d5992dab4f477072e656be3078799d5312/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L4458</a></p>",
        "id": 174966623,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567685122
    },
    {
        "content": "<p>It doesn't look like you pick anything up</p>",
        "id": 174966629,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567685134
    },
    {
        "content": "<p>it's the PumpStreamHandler, and it's working because you get the Generating... line which comes fromJekyll</p>",
        "id": 174966686,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567685171
    },
    {
        "content": "<p>but that only comes into play if it throws an io exception</p>",
        "id": 174966731,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567685233
    },
    {
        "content": "<p>right?</p>",
        "id": 174966740,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567685252
    },
    {
        "content": "<p>no. you get \"Jekyll has failed \" in that case. But the Jekyll: Generating... can only come from the PumpStreamHandler.</p>",
        "id": 174966808,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567685293
    },
    {
        "content": "<p>either the Apache commons library is not picking up process termination, or the Jekyll process is not terminating. Easy to tell those apart.... look in the system process monitor</p>",
        "id": 174966834,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567685333
    },
    {
        "content": "<p>why doesn't the publisher stop at the snapshot generation part? that happens way earlier?</p>",
        "id": 174967318,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567685711
    },
    {
        "content": "<p>it is logged as an error</p>",
        "id": 174967355,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567685736
    },
    {
        "content": "<p>jekyll does not terminate in this case</p>",
        "id": 174967476,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567685826
    },
    {
        "content": "<p>so the IG needs to terminate the jekyll process based on jekylls output</p>",
        "id": 174967715,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567686023
    },
    {
        "content": "<p>You could perhaps throw an exception here: <a href=\"https://github.com/HL7/fhir-ig-publisher/blob/c422f4d5992dab4f477072e656be3078799d5312/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L4405\" target=\"_blank\" title=\"https://github.com/HL7/fhir-ig-publisher/blob/c422f4d5992dab4f477072e656be3078799d5312/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L4405\">https://github.com/HL7/fhir-ig-publisher/blob/c422f4d5992dab4f477072e656be3078799d5312/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L4405</a></p>",
        "id": 174968956,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567687165
    },
    {
        "content": "<p>instead of returning a boolean that doesn't do much</p>",
        "id": 174968974,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567687182
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> here you go: <a href=\"https://github.com/HL7/fhir-ig-publisher/pull/32\" target=\"_blank\" title=\"https://github.com/HL7/fhir-ig-publisher/pull/32\">https://github.com/HL7/fhir-ig-publisher/pull/32</a></p>",
        "id": 174971371,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567688922
    },
    {
        "content": "<p>I'm not following the logic of this change. What the code does now is log anything significant from Jekyll, and wait for it to finish. </p>\n<p>You're proposing for it to simply ignore the fact that Jekyll hasn't terminated, and hide the error, and abandon the IG publication? I'm certainly not approving a PR like that</p>",
        "id": 175010545,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567714432
    },
    {
        "content": "<p>what happens if you run Jekyll outside the IG publisher? do you get that error, and then it hangs?</p>",
        "id": 175010623,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567714464
    },
    {
        "content": "<p>My PR was a bit eagerly I must admit</p>",
        "id": 175012297,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567715712
    },
    {
        "content": "<p>I'll try to do some further investigation, but I'm pretty sure that something needs to be changed</p>",
        "id": 175012550,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567715893
    },
    {
        "content": "<p>maybe. but you haven't actually identified the problem yet</p>",
        "id": 175012575,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567715922
    },
    {
        "content": "<p>Jekyll does not terminate when it encounters the error</p>",
        "id": 175012597,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567715943
    },
    {
        "content": "<p>thats the problem</p>",
        "id": 175012604,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567715949
    },
    {
        "content": "<p>and that causes the publisher to hang</p>",
        "id": 175012610,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567715957
    },
    {
        "content": "<p>and you can reproduce this running Jekyll manually?</p>",
        "id": 175012639,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567715979
    },
    {
        "content": "<p>working on it</p>",
        "id": 175012701,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716004
    },
    {
        "content": "<p>preferably, I would favour that the IG actually did not spawn other processes</p>",
        "id": 175012770,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716054
    },
    {
        "content": "<p>so that the chaining of tools would be in hands of one self</p>",
        "id": 175012811,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716094
    },
    {
        "content": "<p>do you know why the IG does not stop processing during the </p>\n<div class=\"codehilite\"><pre><span></span>Error in snapshot generation: Differential for http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-address with id: Address.extension:regionalSubdivisionCode.valueCodeableConcept:valueCodeableConcept.coding has an element that is not marked with a snapshot match\nError in snapshot generation: Differential for http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-address with id: Address.extension:regionalSubdivisionCode.valueCodeableConcept:valueCodeableConcept.coding:regionalCode has an element that is not marked with a snapshot match\nError in snapshot generation: Differential for http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-address with id: Address.extension:regionalSubdivisionCode.valueCodeableConcept:valueCodeableConcept.coding:regionalCode.system has an element that is not marked with a snapshot match\n</pre></div>",
        "id": 175012949,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716195
    },
    {
        "content": "<p>And yes, I can produce it manually - however the error logs from jekyll is sent to stderr</p>\n<div class=\"codehilite\"><pre><span></span> Liquid Exception: Could not locate the included file &#39;header.html&#39; in any of [&quot;/Users/jvi/gitlab/implementationguide/_includes&quot;]. Ensure it exists in one of those directories and, if it is a symlink, does not point outside your site source. in temp/Address-ehealth-address-genexample.html\n</pre></div>",
        "id": 175013245,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716450
    },
    {
        "content": "<p>you don't see it when running with the IG publisher</p>",
        "id": 175013328,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716495
    },
    {
        "content": "<p>it is present when you invoke <code>jekyll build -t</code></p>",
        "id": 175013358,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716520
    },
    {
        "content": "<blockquote>\n<p>preferably, I would favour that the IG actually did not spawn other processes</p>\n</blockquote>\n<p>Sure I'll just rewrite Jekyll</p>",
        "id": 175013418,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567716568
    },
    {
        "content": "<p>thats not what I mean</p>",
        "id": 175013447,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716586
    },
    {
        "content": "<p>the pulisher generates some artifacts right? and after that jekyll processes those artifacts with some templates</p>",
        "id": 175013545,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716638
    },
    {
        "content": "<blockquote>\n<p>do you know why the IG does not stop processing during the</p>\n</blockquote>\n<p>because the IG publisher tries very hard not to stop, and it doesn't have to stop for those errors. They'll be in QA.html</p>",
        "id": 175013549,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567716644
    },
    {
        "content": "<p>yes</p>",
        "id": 175013561,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567716653
    },
    {
        "content": "<p>what I mean is that I would like to do the chaining myself.</p>",
        "id": 175013635,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716705
    },
    {
        "content": "<p>as in run the igpub, run jekyll and then run whatever i need afterwards</p>",
        "id": 175013714,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716735
    },
    {
        "content": "<p>like piping output from one process to another</p>",
        "id": 175013749,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716762
    },
    {
        "content": "<p>the IG publisher does lots of work after Jekyll has finished</p>",
        "id": 175013773,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567716788
    },
    {
        "content": "<p>could that be reordered?</p>",
        "id": 175013786,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716804
    },
    {
        "content": "<p>or are there some logical constraints to the output of jekyll?</p>",
        "id": 175013812,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716827
    },
    {
        "content": "<blockquote>\n<p>error logs from jekyll is sent to stderr</p>\n</blockquote>\n<p>the apache commons doco appears to claim that stderr output should be sent to the pump handler.</p>",
        "id": 175013827,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567716840
    },
    {
        "content": "<p>I saw that as well ...</p>",
        "id": 175013894,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716866
    },
    {
        "content": "<p>and the fact that I have a catcher for Liquid Exception implies it is being seen.... so I'm not following</p>",
        "id": 175013900,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567716869
    },
    {
        "content": "<p>well it isn't logged</p>",
        "id": 175013918,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716883
    },
    {
        "content": "<p>that still doesn't relate to not terminating? but maybe apache commons has a bug here? log to stderr and then it hangs somewhere?</p>",
        "id": 175013956,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567716935
    },
    {
        "content": "<p>maybe</p>",
        "id": 175013965,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716947
    },
    {
        "content": "<p>I can send you the content of the IG</p>",
        "id": 175013969,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716950
    },
    {
        "content": "<p>then you can run it and see for yourself</p>",
        "id": 175013982,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716962
    },
    {
        "content": "<p>ok</p>",
        "id": 175014027,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567716969
    },
    {
        "content": "<p>when run by the IG the output is not present</p>",
        "id": 175014035,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716974
    },
    {
        "content": "<p>when you afterwards run <code>jekyll build -t</code> you see it</p>",
        "id": 175014065,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567716997
    },
    {
        "content": "<p>same email as always?</p>",
        "id": 175014224,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567717089
    },
    {
        "content": "<p>sure</p>",
        "id": 175014249,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567717109
    },
    {
        "content": "<p>it should be running through the SMTP servers now</p>",
        "id": 175014463,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567717260
    },
    {
        "content": "<p>it went to your gmail</p>",
        "id": 175014878,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567717582
    },
    {
        "content": "<p>you'll be unhappy to know that works just fine for me</p>",
        "id": 175015524,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718121
    },
    {
        "content": "<p>what works?</p>",
        "id": 175015528,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718130
    },
    {
        "content": "<p>well I got to the end of the production run but there were so many html errors I couldn't see what happened. running again with a break point</p>",
        "id": 175015584,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718169
    },
    {
        "content": "<p>and running <code>jekyll build -t</code>does not print anything to stderr?</p>",
        "id": 175015607,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718220
    },
    {
        "content": "<p>Jekyll: Source: C:/work/org.hl7.fhir.igs/jens-dk/temp                            (00:02:40.0920sec)<br>\nJekyll: Generating...                                                            (00:02:40.0920sec)<br>\nJekyll: done in 13.688 seconds.                                                  (00:02:54.0608sec)</p>",
        "id": 175015726,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718293
    },
    {
        "content": "<p>thats the output of the IG right?</p>",
        "id": 175015743,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718313
    },
    {
        "content": "<p>yep. jekyll worked just fine for me</p>",
        "id": 175015810,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718392
    },
    {
        "content": "<p>now try to call jekyll yourself</p>",
        "id": 175015866,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718405
    },
    {
        "content": "<p>I can't find an /app/ so I don't know what that's about....</p>",
        "id": 175015876,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718411
    },
    {
        "content": "<p>?</p>",
        "id": 175015914,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718446
    },
    {
        "content": "<p>if there's and app folder you can safely delete it</p>",
        "id": 175016009,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718524
    },
    {
        "content": "<p>that was based on <code>Could not locate the included file 'header.html' in any of [\"/app/_includes\"</code></p>",
        "id": 175016052,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718583
    },
    {
        "content": "<p>disregard that</p>",
        "id": 175016075,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718607
    },
    {
        "content": "<p>the /app/ thing is a leftover artifact</p>",
        "id": 175016092,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718632
    },
    {
        "content": "<p>so this time I manually deleted the header file from /temp/_includes, and I got this log:</p>",
        "id": 175016143,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718647
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Jekyll: Source: C:/work/org.hl7.fhir.igs/jens-dk/temp                            (00:03:48.0351sec)\nJekyll: Generating...                                                            (00:03:48.0352sec)\nJekyll has failed - not installed (correcty?). Complete output from running Jekyll: \u001b[31m  Liquid Exception: Could not locate the included file &#39;header.html&#39; in any of [&quot;C:/work/org.hl7.fhir.igs/jens-dk/temp/_includes&quot;]. Ensure it exists in one of those directories and, if it is a symlink, does not point outside your site source. in Addre (00:03:50.0751sec)\nPublishing Content Failed: Process exited with an error: 1 (Exit value: 1)       (00:03:50.0753sec)\n</pre></div>",
        "id": 175016156,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718668
    },
    {
        "content": "<p>just remove temp and output and whatnot</p>",
        "id": 175016157,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718668
    },
    {
        "content": "<p>yes</p>",
        "id": 175016163,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718674
    },
    {
        "content": "<p>there you hav eit</p>",
        "id": 175016178,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718695
    },
    {
        "content": "<p>there I have what? What I see is that it handled the failure properly.</p>",
        "id": 175016202,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718715
    },
    {
        "content": "<p><a href=\"https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&amp;g=org.hl7.fhir.publisher&amp;a=org.hl7.fhir.publisher.cli&amp;v=LATEST&amp;e=jar\" target=\"_blank\" title=\"https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&amp;g=org.hl7.fhir.publisher&amp;a=org.hl7.fhir.publisher.cli&amp;v=LATEST&amp;e=jar\">https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&amp;g=org.hl7.fhir.publisher&amp;a=org.hl7.fhir.publisher.cli&amp;v=LATEST&amp;e=jar</a></p>",
        "id": 175016214,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718728
    },
    {
        "content": "<p>Jekyll has failed, and I got the input</p>",
        "id": 175016218,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718731
    },
    {
        "content": "<p>is that not the proper place to fetch the IGpbulisher?</p>",
        "id": 175016231,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718742
    },
    {
        "content": "<p>no. it's not. Maven can't get latest correct. The right place is</p>",
        "id": 175016306,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718801
    },
    {
        "content": "<p><a href=\"https://fhir.github.io/latest-ig-publisher/org.hl7.fhir.publisher.jar\" target=\"_blank\" title=\"https://fhir.github.io/latest-ig-publisher/org.hl7.fhir.publisher.jar\">https://fhir.github.io/latest-ig-publisher/org.hl7.fhir.publisher.jar</a></p>",
        "id": 175016323,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718824
    },
    {
        "content": "<p>wtf?</p>",
        "id": 175016333,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718830
    },
    {
        "content": "<p>but it doesn't make any difference for this stuff</p>",
        "id": 175016336,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718834
    },
    {
        "content": "<p>lets find out</p>",
        "id": 175016356,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567718861
    },
    {
        "content": "<p><a href=\"https://issues.sonatype.org/browse/NEXUS-5440\" target=\"_blank\" title=\"https://issues.sonatype.org/browse/NEXUS-5440\">https://issues.sonatype.org/browse/NEXUS-5440</a></p>",
        "id": 175016366,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567718865
    },
    {
        "content": "<blockquote>\n<p>but it doesn't make any difference for this stuff</p>\n</blockquote>\n<p>if it does not make a difference, how come you saw the output</p>",
        "id": 175016742,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567719114
    },
    {
        "content": "<p>I wonder if it's because I'm on windows?</p>",
        "id": 175017016,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567719279
    },
    {
        "content": "<p>and im on linux and mac?</p>",
        "id": 175017031,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567719297
    },
    {
        "content": "<p>see this is one of the reasons for running on docker</p>",
        "id": 175017056,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567719341
    },
    {
        "content": "<p>well... I don't know what else it could be. But I did have to delete the file manually to create the problem. do you have a file temp/_includes/header.html?</p>",
        "id": 175017061,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567719343
    },
    {
        "content": "<p>yep</p>",
        "id": 175017111,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567719364
    },
    {
        "content": "<p>so why can't jekyll find it?</p>",
        "id": 175017119,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567719376
    },
    {
        "content": "<p>you get the same error running jekyll from the command line in temp?</p>",
        "id": 175017136,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567719394
    },
    {
        "content": "<p>no</p>",
        "id": 175017187,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567719435
    },
    {
        "content": "<p>no errors</p>",
        "id": 175017196,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567719441
    },
    {
        "content": "<p>this is not making a lot of sense.... under what conditions do you get the jekyll error from the command line?</p>",
        "id": 175017331,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567719553
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Jenss-MacBook-Pro-2:implementationguide jvi$ pwd\n/Users/jvi/gitlab/implementationguide\nJenss-MacBook-Pro-2:implementationguide jvi$ jekyll build -t\nConfiguration file: none\n            Source: /Users/jvi/gitlab/implementationguide\n       Destination: /Users/jvi/gitlab/implementationguide/_site\n Incremental build: disabled. Enable with --incremental\n      Generating...\n  Liquid Exception: Could not locate the included file &#39;header.html&#39; in any of [&quot;/Users/jvi/gitlab/implementationguide/_includes&quot;]. Ensure it exists in one of those directories and, if it is a symlink, does not point outside your site source. in temp/Address-ehealth-address-genexample.html\n/Users/jvi/.gem/ruby/2.3.0/gems/jekyll-3.8.5/lib/jekyll/tags/include.rb:121:in `locate_include_file&#39;: Could not locate the included file &#39;header.html&#39; in any of [&quot;/Users/jvi/gitlab/implementationguide/_includes&quot;]. Ensure it exists in one of those directories and, if it is a symlink, does not point outside your site source. (IOError)\n</pre></div>",
        "id": 175017521,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567719707
    },
    {
        "content": "<p>you missing /temp on the source?</p>",
        "id": 175017738,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567719853
    },
    {
        "content": "<p>1)running <code>java -jar org.hl7.fhir.publisher.jar -ig ig.json</code> processes without issues (so it looks like)<br>\n2)running <code>jekyll build -t</code>shows the LiquidException in stderr<br>\n3)running <code>java -jar org.hl7.fhir.publisher.jar -ig ig.json</code> in my docker container never ends (probably because of 2)<br>\n4)running <code>jekyll build -t</code>in my docker container shows the LiquidException in stderr </p>\n<p>1) 2) and 4) is only done as part of troubleshooting 3)</p>",
        "id": 175018711,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567720711
    },
    {
        "content": "<blockquote>\n<p>you missing /temp on the source?</p>\n</blockquote>\n<p>what do you mean?</p>",
        "id": 175018835,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567720823
    },
    {
        "content": "<p>Source: /Users/jvi/gitlab/implementationguide - that's wrong. it should be Source: /Users/jvi/gitlab/implementationguide/temp</p>",
        "id": 175018849,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567720838
    },
    {
        "content": "<p>I do not understand 1&amp;2 unless you are running jekyll wrongly</p>",
        "id": 175018905,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567720899
    },
    {
        "content": "<blockquote>\n<p>I do not understand 1&amp;2 unless you are running jekyll wrongly</p>\n</blockquote>\n<p>how can that be done?</p>",
        "id": 175019066,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567721037
    },
    {
        "content": "<blockquote>\n<p>Source: /Users/jvi/gitlab/implementationguide - that's wrong. it should be Source: /Users/jvi/gitlab/implementationguide/temp</p>\n</blockquote>\n<p>I agree - so why does this happen?</p>",
        "id": 175019116,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567721077
    },
    {
        "content": "<p>why does what happen? looks like you're running it in the wrong directory</p>",
        "id": 175019144,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567721110
    },
    {
        "content": "<p>so I shouldn't have to run jekyll manually at all</p>",
        "id": 175019170,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567721158
    },
    {
        "content": "<p>that should be spawned by the IG</p>",
        "id": 175019214,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567721171
    },
    {
        "content": "<p>no you're doing that for troubleshooting purposes</p>",
        "id": 175019217,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567721175
    },
    {
        "content": "<p>hmmm I seem to get another error if invoke jekyll in the temp dir and then eventually terminate it (as it just keeps spinninig)</p>",
        "id": 175019703,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567721653
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Configuration file: none\n            Source: /app/temp\n       Destination: /app/temp/_site\n Incremental build: disabled. Enable with --incremental\n      Generating...\n^C  Liquid Exception:  in StructureDefinition-ehealth-careteam-example-operations.html\n</pre></div>\n\n\n<ul>\n<li>i wonder what that could be ...</li>\n</ul>",
        "id": 175019743,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567721695
    },
    {
        "content": "<p>now we're getting somewhere. where does the ^C thing come from? is that jekyll output?</p>",
        "id": 175019888,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567721826
    },
    {
        "content": "<p>thats me terminating it</p>",
        "id": 175019900,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567721843
    },
    {
        "content": "<p>so you get the liquid exception printed out after you terminate it?</p>",
        "id": 175019920,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567721875
    },
    {
        "content": "<p>yep</p>",
        "id": 175019973,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567721899
    },
    {
        "content": "<p><a href=\"https://github.com/envygeeks/jekyll-docker/issues/12\" target=\"_blank\" title=\"https://github.com/envygeeks/jekyll-docker/issues/12\">https://github.com/envygeeks/jekyll-docker/issues/12</a></p>",
        "id": 175019996,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567721931
    },
    {
        "content": "<p>interesting ... but that does not explain why we suddenly have encountered this bug after an upgrade of jruby and the publisher</p>",
        "id": 175020150,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567722077
    },
    {
        "content": "<p>it has been working for months</p>",
        "id": 175020163,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567722096
    },
    {
        "content": "<p>sure. but this is definitely a jekyll bug...</p>",
        "id": 175020239,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567722136
    },
    {
        "content": "<p>I'm going to pout a limit of 5 minutes on Jekyll</p>",
        "id": 175020395,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567722295
    },
    {
        "content": "<p>i'll try to run from the jekyll images and see if that does any magic</p>",
        "id": 175020425,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567722324
    },
    {
        "content": "<p><a href=\"https://github.com/envygeeks/jekyll-docker/issues/12\" target=\"_blank\" title=\"https://github.com/envygeeks/jekyll-docker/issues/12\">https://github.com/envygeeks/jekyll-docker/issues/12</a> is solved</p>",
        "id": 175042525,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567755666
    },
    {
        "content": "<p>I just tried it myself</p>",
        "id": 175042528,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567755672
    },
    {
        "content": "<p>I've downloaded the source of the IG and added a -V to the runJekyll command line ...</p>",
        "id": 175043312,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567756641
    },
    {
        "content": "<p>now ... I've seem to have found something</p>",
        "id": 175043320,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567756662
    },
    {
        "content": "<p>it simply goes cold at a point ....</p>\n<div class=\"codehilite\"><pre><span></span>Jekyll: Rendering Liquid: StructureDefinition-ehealth-careteam-definitions.html  (00:03:08.0232sec)\nJekyll: Rendering Markup: StructureDefinition-ehealth-careteam-definitions.html  (00:03:08.0245sec)\nJekyll: Rendering Layout: StructureDefinition-ehealth-careteam-definitions.html  (00:03:08.0245sec)\nJekyll: Rendering: StructureDefinition-ehealth-careteam-example-operations.html  (00:03:08.0245sec)\nJekyll: Pre-Render Hooks: StructureDefinition-ehealth-careteam-example-operations.html (00:03:08.0245sec)\nJekyll: Rendering Liquid: StructureDefinition-ehealth-careteam-example-operations.html (00:03:08.0245sec)\n</pre></div>",
        "id": 175043702,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567757018
    },
    {
        "content": "<p>well, that was a given. I'm not sure that the point in very informative? is it a memory issue?</p>",
        "id": 175057251,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771200
    },
    {
        "content": "<p>Haven't looked, but I would be surprised if that was the cause</p>",
        "id": 175058430,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567772204
    },
    {
        "content": "<p>any other cause would also be surprising...?</p>",
        "id": 175058446,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567772226
    },
    {
        "content": "<p>not to the same extent</p>",
        "id": 175058485,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567772277
    },
    {
        "content": "<p>By default docker does not impose constraints on memory, disk, cpu. So if it was a memory issue, it would also hit me outside docker</p>",
        "id": 175058681,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567772419
    },
    {
        "content": "<p>which is not the case</p>",
        "id": 175058688,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567772427
    },
    {
        "content": "<p>and actually ... delivering the igpublisher in docker would probably be welcomed by a load of users</p>",
        "id": 175058735,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567772484
    },
    {
        "content": "<p>they wouldn't have to deal with ruby, jekyll or java in terms of installation</p>",
        "id": 175058751,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567772504
    },
    {
        "content": "<p>they would only have to deal with docker</p>",
        "id": 175058758,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567772513
    },
    {
        "content": "<p>nothing else</p>",
        "id": 175058762,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567772520
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Sending Usage Stats to Server                                                    (00:01:41.0150sec)\nSubmitting Usage Stats failed: Connection refused (Connection refused)\nJekyll: Source: /app/temp                                                        (00:03:05.0425sec)\nJekyll: Generating...                                                            (00:03:05.0427sec)\nJekyll has failed - not installed (correctly?). Complete output from running Jekyll:       Generating...\nisabled. Enable with --incremental\n (00:07:58.0316sec)\nCheck that Jekyll is installed correctly                                         (00:07:58.0316sec)\nPublishing Content Failed: Process exited with an error: 143 (Exit value: 143)   (00:07:58.0352sec)\n                                                                                 (00:07:58.0352sec)\nUse -? to get command line help                                                  (00:07:58.0352sec)\n                                                                                 (00:07:58.0352sec)\nStack Dump (for debugging):                                                      (00:07:58.0352sec)\norg.apache.commons.exec.ExecuteException: Process exited with an error: 143 (Exit value: 143)\n    at org.apache.commons.exec.DefaultExecutor.executeInternal(DefaultExecutor.java:404)\n    at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:166)\n    at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:153)\n    at org.hl7.fhir.igtools.publisher.Publisher.runJekyll(Publisher.java:4467)\n    at org.hl7.fhir.igtools.publisher.Publisher.runTool(Publisher.java:4385)\n    at org.hl7.fhir.igtools.publisher.Publisher.generate(Publisher.java:3900)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:731)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:609)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6410)\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6420)\n</pre></div>\n\n\n<ul>\n<li>with your new kill-feature</li>\n</ul>",
        "id": 175064383,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567776728
    },
    {
        "content": "<p>so where does this leave us? it's certainly frustrating...</p>",
        "id": 175098392,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567799936
    },
    {
        "content": "<p>probably somewhere where the Igpub is not a great fit for docker as long as it has to spawn sub processes. Is there an optional argument where you can get the igpub to stop processing when it encounters an error? e.g. at the snapshot generation part?</p>",
        "id": 175154335,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567888188
    },
    {
        "content": "<ul>\n<li>docker doesn't support sub-processes?</li>\n<li>have you asked about this on a Jekyll support forum? </li>\n<li>there's no optional argument</li>\n<li>but why do you think there's a connection? the snapshot generation errors are arcane issues inside the generation of the snapshot that don't affect anything else except that correctness of the snapshot</li>\n</ul>",
        "id": 175155274,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567889893
    },
    {
        "content": "<ul>\n<li>docker is primarily process isolation and it is considered good practice to only have a single process running pr container (<a href=\"https://devops.stackexchange.com/questions/447/why-it-is-recommended-to-run-only-one-process-in-a-container\" target=\"_blank\" title=\"https://devops.stackexchange.com/questions/447/why-it-is-recommended-to-run-only-one-process-in-a-container\">https://devops.stackexchange.com/questions/447/why-it-is-recommended-to-run-only-one-process-in-a-container</a>) while the use of multiple processes actually are supported.</li>\n<li>Jekyll in itself has no issue running in docker</li>\n<li>ok</li>\n<li>I'm simply looking into what is piped out at errors, and the snapshot generation is listed as an error.</li>\n</ul>",
        "id": 175155609,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567890517
    },
    {
        "content": "<p>so I read that link, but I don't understand it. Spawning sub-processes is standard software re-use. Docker's trying to reinvent software development?</p>",
        "id": 175155689,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567890681
    },
    {
        "content": "<p>docker is trying to revinvent virtualization ... and then some ...</p>",
        "id": 175155747,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567890805
    },
    {
        "content": "<p>its actually not trying ... it already succeeded</p>",
        "id": 175155751,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567890819
    },
    {
        "content": "<p>anyway I though you had shown that Jekyll hangs when you run it directly on the source</p>",
        "id": 175155753,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567890820
    },
    {
        "content": "<p>reinvent virtualization != reinvent software development</p>",
        "id": 175155759,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567890836
    },
    {
        "content": "<p>not when running locally</p>",
        "id": 175155760,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567890840
    },
    {
        "content": "<blockquote>\n<p>reinvent virtualization != reinvent software development</p>\n</blockquote>\n<p>right</p>",
        "id": 175155802,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567890852
    },
    {
        "content": "<p>what happens when you run it on the source manually?</p>",
        "id": 175155805,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567890860
    },
    {
        "content": "<p>define source</p>",
        "id": 175155812,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567890886
    },
    {
        "content": "<p>this is what you pasted above:</p>\n<div class=\"codehilite\"><pre><span></span>Configuration file: none\n            Source: /app/temp\n       Destination: /app/temp/_site\n Incremental build: disabled. Enable with --incremental\n      Generating...\n^C  Liquid Exception:  in StructureDefinition-ehealth-careteam-example-operations.html\n</pre></div>",
        "id": 175155813,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567890894
    },
    {
        "content": "<p>you had to kill it manually</p>",
        "id": 175155822,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567890908
    },
    {
        "content": "<p>is what you said</p>",
        "id": 175155824,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567890918
    },
    {
        "content": "<p>thats from within docker, yes</p>",
        "id": 175155827,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567890933
    },
    {
        "content": "<p>where I had to kill it manually</p>",
        "id": 175155829,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567890942
    },
    {
        "content": "<p>so you started it manually in docker, it hangs, and then, when the IGpublisher starts it the same way and it hangs, this is an IG publisher issue?</p>",
        "id": 175155881,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567890975
    },
    {
        "content": "<p>I started the ig in docker where it hangs in the jekyll step</p>",
        "id": 175155951,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891086
    },
    {
        "content": "<p>but happens if you kill the ig process manually and run jekyll on the source directly?</p>",
        "id": 175155959,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891124
    },
    {
        "content": "<p>from the command line, which you must have done to get the output above</p>",
        "id": 175155962,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891138
    },
    {
        "content": "<p>and if I step into the docker container while the ig is still hanging and run jekyll it still hangs</p>",
        "id": 175155966,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891144
    },
    {
        "content": "<p>... you had to ^C it</p>",
        "id": 175155969,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891149
    },
    {
        "content": "<p>kill the IG process first...</p>",
        "id": 175155972,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891162
    },
    {
        "content": "<p>if I kill the ig inside the docker container, it is the same as killing the docker container</p>",
        "id": 175155979,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891198
    },
    {
        "content": "<p>how much memory does the JVM have, and how much memory does the docker have? is docker running out of memory, so Jekyll is going into a memory disaster?</p>",
        "id": 175156017,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891204
    },
    {
        "content": "<p>1Gb</p>",
        "id": 175156022,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891217
    },
    {
        "content": "<p>for the JVM</p>",
        "id": 175156028,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891230
    },
    {
        "content": "<p>no limits on the docker container</p>",
        "id": 175156032,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891251
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> a question. There's JRuby where we could possibly run Jekyll directly inside the JVM. But it's kind of a big addition to the cli package and I would only use it by configuration request on the command line, to support docker. is there a way to use it if it's installed, but not to put it in the cli? And how would you set that up in Eclipse? </p>\n<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> maybe if the Jekyll issue is just not resolveable, JRuby can help but it seems like a risky thing to me</p>",
        "id": 175156151,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891477
    },
    {
        "content": "<p>is it out of the question to split the generation up in multiple steps?</p>",
        "id": 175156167,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891559
    },
    {
        "content": "<p>yes in the sense you are asking. The IG publisher does things before Jekyll runs, and then it does things afterwards</p>",
        "id": 175156214,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891610
    },
    {
        "content": "<p>and a bunch of context is carried across that process</p>",
        "id": 175156222,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891628
    },
    {
        "content": "<p>and the things afterwards ... they depend on the output of jekyll?</p>",
        "id": 175156224,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891639
    },
    {
        "content": "<p>they do, or they wouldn't be done afterwards</p>",
        "id": 175156227,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891654
    },
    {
        "content": "<p>the context that is carried over ... that stuff that is not serialized to disk, what is that?</p>",
        "id": 175156285,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891740
    },
    {
        "content": "<p>all the context of the classes that run the publishing</p>",
        "id": 175156294,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891772
    },
    {
        "content": "<p>from the source it looks like some NPM generation, some zip stuff and some validation, right?</p>",
        "id": 175156360,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567891876
    },
    {
        "content": "<p>yes</p>",
        "id": 175156363,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567891890
    },
    {
        "content": "<p>and the context cannot be reconstructed from the ig configuration + the result of the jekyll execution?</p>",
        "id": 175156445,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567892016
    },
    {
        "content": "<p>look it's probably theoretically possible. But I'm not going to spend months rewriting to work around some problem running jekyll in docker. Specially when it already worked in the past</p>",
        "id": 175156498,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567892059
    },
    {
        "content": "<p>Loading all of that stuff takes a good chunk of time.  It would decrease performance of a process that's already problematic in terms of performance.</p>",
        "id": 175156504,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1567892088
    },
    {
        "content": "<p>and I've learnt too, about this: each new more complex configuration that allows for something to work.... it kills me. Maven... man... I hate maven. It's made what we do so much more complex in ways I could not have imagined when we moved the java code to maven</p>",
        "id": 175156521,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567892141
    },
    {
        "content": "<p>then pick gradle or ivy if you have issues with maven</p>",
        "id": 175156568,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567892189
    },
    {
        "content": "<p>I would if <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> told me it would make my life simpler. but I think it wouldn't</p>",
        "id": 175156576,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567892231
    },
    {
        "content": "<p>sounds like you are trying to shoehorn maven into something that doesn't fit the bill</p>",
        "id": 175156631,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567892339
    },
    {
        "content": "<p>perhaps. But it's the cross project dependencies and the way that interacts with PRs that's creating us problems. We just shouldn't have split our project up.... but it has other advantages. Anyway, this is a rabbit hole. Jekyll used to work, it hangs internally... it really feels like a Jekyll issue to me</p>",
        "id": 175156701,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567892459
    },
    {
        "content": "<p>if you ask here: <a href=\"https://talk.jekyllrb.com/\" target=\"_blank\" title=\"https://talk.jekyllrb.com/\">https://talk.jekyllrb.com/</a> I'll track the discussion</p>",
        "id": 175156756,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567892592
    },
    {
        "content": "<p><a href=\"https://talk.jekyllrb.com/t/jekyll-spawned-from-another-process-inside-docker/3308\" target=\"_blank\" title=\"https://talk.jekyllrb.com/t/jekyll-spawned-from-another-process-inside-docker/3308\">https://talk.jekyllrb.com/t/jekyll-spawned-from-another-process-inside-docker/3308</a></p>",
        "id": 175157499,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1567894049
    },
    {
        "content": "<p>I'll in some further details</p>",
        "id": 175158143,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567895294
    },
    {
        "content": "<p>does it work on docker with some other IG?</p>",
        "id": 175217523,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568009841
    },
    {
        "content": "<p>It previously worked on our IG</p>",
        "id": 175219491,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568012822
    },
    {
        "content": "<p>right. but that was then. Does it work on a different ig now?</p>",
        "id": 175219582,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568012956
    },
    {
        "content": "<p>can you point to an IG that works? I just tried to check out IPS and that failed</p>",
        "id": 175219671,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568013105
    },
    {
        "content": "<p>as in:</p>\n<div class=\"codehilite\"><pre><span></span>Terminology Cache is at /app/txCache. 14 files in cache                          (02.0127sec)\nLoading package.tgz to the package cache\n  Fetching:............................................................................................................\n  ......................................................................................................................\n  ......................................................................................................................\n  .............................................................................................. done.\nLoad hl7.fhir.core-4.0.0 package from memory                                     (03.0168sec)\nPublishing Content Failed: Not a JSON Object: &quot;AuditEvent.entity&quot;                (04.0766sec)\n                                                                                 (04.0766sec)\nUse -? to get command line help                                                  (04.0766sec)\n                                                                                 (04.0766sec)\nStack Dump (for debugging):                                                      (04.0766sec)\njava.lang.IllegalStateException: Not a JSON Object: &quot;AuditEvent.entity&quot;\n    at com.google.gson.JsonElement.getAsJsonObject(JsonElement.java:91)\n    at org.hl7.fhir.r4.formats.JsonParser.parseStructureDefinitionProperties(JsonParser.java:23590)\n    at org.hl7.fhir.r4.formats.JsonParser.parseStructureDefinition(JsonParser.java:23489)\n</pre></div>",
        "id": 175219726,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568013177
    },
    {
        "content": "<p>I'm seeing a pattern here: error was the same for FHIR QI Core ...</p>",
        "id": 175219875,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568013413
    },
    {
        "content": "<p><a href=\"https://github.com/HL7/sdc\" target=\"_blank\" title=\"https://github.com/HL7/sdc\">https://github.com/HL7/sdc</a></p>",
        "id": 175219951,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568013519
    },
    {
        "content": "<p>master branch?</p>",
        "id": 175219955,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568013534
    },
    {
        "content": "<p>y</p>",
        "id": 175219956,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568013541
    },
    {
        "content": "<p>have you seen this page? <a href=\"https://fhir.github.io/auto-ig-builder/builds.html\" target=\"_blank\" title=\"https://fhir.github.io/auto-ig-builder/builds.html\">https://fhir.github.io/auto-ig-builder/builds.html</a></p>",
        "id": 175219964,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568013549
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>onLoad:\nPublishing Content Failed: null                                                  (09.0631sec)\n                                                                                 (09.0632sec)\nUse -? to get command line help                                                  (09.0632sec)\n                                                                                 (09.0632sec)\nStack Dump (for debugging):                                                      (09.0633sec)\njava.lang.NullPointerException\n    at org.hl7.fhir.igtools.templates.Template.loadValidationMessages(Template.java:260)\n    at org.hl7.fhir.igtools.templates.Template.runScriptTarget(Template.java:198)\n    at org.hl7.fhir.igtools.templates.Template.onLoadEvent(Template.java:323)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:1185)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1116)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:603)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6410)\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6420)\n</pre></div>",
        "id": 175220047,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568013675
    },
    {
        "content": "<p>what's the start of the log? Did you get the very latest IG publisher? (it's only an hour old...)</p>",
        "id": 175220062,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568013715
    },
    {
        "content": "<p>i just cloned it</p>",
        "id": 175220106,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568013733
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>FHIR IG Publisher Version 0.9.65-SNAPSHOT - Built 2019-09-06T15:04:14.427+10:00 - Git 07429344b330\nDetected Java version: 1.8.0_212 from /usr/lib/jvm/java-8-openjdk-amd64/jre on amd64 (64bit). 1820MB available\nRun time = Monday, September 9, 2019 7:20:09 AM UTC ( @ 2019-09-09T07:20:09Z )\n[/] -spec package.tgz -ig /app/ig.ini\nPackage Cache: /root/.fhir/packages\nContacting Build Server...                                                       (00.0116sec)\n ... done                                                                        (01.0728sec)\nLoad Template from hl7.fhir.template\nInstalling hl7.fhir.template#current to the package cache\n  Fetching:...|\n  Analysing done.\n\nonLoad.setup:\n\nonLoad.r5-schemas:\n      [get] Getting: http://build.fhir.org/fhir-single.xsd\n      [get] To: /app/input-cache/schemas-r5/fhir-single.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/fhir-xhtml.xsd\n      [get] To: /app/input-cache/schemas-r5/fhir-xhtml.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/xml.xsd\n      [get] To: /app/input-cache/schemas-r5/xml.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/xmldsig-core-schema.xsd\n      [get] To: /app/input-cache/schemas-r5/xmldsig-core-schema.xsd\n      [get] Not modified - so not downloaded\n\nonLoad.checkPublisher:\n\nonLoad.upgradeWarning:\n\nonLoad.findSpreadsheets:\n\nonLoad.updateIg:\n     [xslt] Processing /app/template/onLoad-ig-working.xml to /app/template/onLoad-ig-updated.xml\n     [xslt] Loading stylesheet /app/template/scripts/onLoad.xslt\n\nonLoad:\nPublishing Content Failed: null                                                  (09.0631sec)\n                                                                                 (09.0632sec)\nUse -? to get command line help                                                  (09.0632sec)\n                                                                                 (09.0632sec)\nStack Dump (for debugging):                                                      (09.0633sec)\njava.lang.NullPointerException\n    at org.hl7.fhir.igtools.templates.Template.loadValidationMessages(Template.java:260)\n    at org.hl7.fhir.igtools.templates.Template.runScriptTarget(Template.java:198)\n    at org.hl7.fhir.igtools.templates.Template.onLoadEvent(Template.java:323)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:1185)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1116)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:603)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6410)\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6420)\n</pre></div>",
        "id": 175220116,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568013750
    },
    {
        "content": "<p>that's not the latest - latest is 69</p>",
        "id": 175220127,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568013793
    },
    {
        "content": "<p>not 65</p>",
        "id": 175220131,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568013796
    },
    {
        "content": "<p>arh... you talked 'bout the tool version</p>",
        "id": 175220143,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568013832
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>FHIR IG Publisher Version 0.9.69-SNAPSHOT - Built 2019-09-09T15:20:31.152+10:00 - Git bbf4b68a7f57\nDetected Java version: 1.8.0_212 from /usr/lib/jvm/java-8-openjdk-amd64/jre on amd64 (64bit). 1820MB available\nParameters: -spec package.tgz -ig /app/ig.ini [dir = /]\nRun time = Monday, September 9, 2019 7:29:58 AM UTC (2019-09-09T07:29:58Z)\nPackage Cache: /root/.fhir/packages                                              (00:00.0102)\nContacting Build Server...                                                       (00:00.0115)\n ... done                                                                        (00:01.0756)\nLoad Template from hl7.fhir.template                                             (00:02.0805)\nInstalling hl7.fhir.template#current to the package cache\n  Fetching:...|\n  Analysing done.\n\nonLoad.setup:\n\nonLoad.r5-schemas:\n      [get] Getting: http://build.fhir.org/fhir-single.xsd\n      [get] To: /app/input-cache/schemas-r5/fhir-single.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/fhir-xhtml.xsd\n      [get] To: /app/input-cache/schemas-r5/fhir-xhtml.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/xml.xsd\n      [get] To: /app/input-cache/schemas-r5/xml.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/xmldsig-core-schema.xsd\n      [get] To: /app/input-cache/schemas-r5/xmldsig-core-schema.xsd\n      [get] Not modified - so not downloaded\n\nonLoad.checkPublisher:\n\nonLoad.upgradeWarning:\n\nonLoad.findSpreadsheets:\n\nonLoad.updateIg:\n     [xslt] Processing /app/template/onLoad-ig-working.xml to /app/template/onLoad-ig-updated.xml\n     [xslt] Loading stylesheet /app/template/scripts/onLoad.xslt\n\nonLoad:\nRoot directory: /app                                                             (00:09.0524)\nLoading package.tgz to the package cache\n  Fetching:............................................................................................................\n  ......................................................................................................................\n  ......................................................................................................................\n  .............................................................................................. done.\nPublishing Content Failed: Not a JSON Object: &quot;AuditEvent.entity&quot;                (00:14.0645)\n                                                                                 (00:14.0645)\nUse -? to get command line help                                                  (00:14.0645)\n                                                                                 (00:14.0645)\nStack Dump (for debugging):                                                      (00:14.0646)\njava.lang.IllegalStateException: Not a JSON Object: &quot;AuditEvent.entity&quot;\n    at com.google.gson.JsonElement.getAsJsonObject(JsonElement.java:91)\n    at org.hl7.fhir.r4.formats.JsonParser.parseStructureDefinitionProperties(JsonParser.java:23590)\n    at org.hl7.fhir.r4.formats.JsonParser.parseStructureDefinition(JsonParser.java:23489)\n    at org.hl7.fhir.r4.formats.JsonParser.parseResource(JsonParser.java:27666)\n    at org.hl7.fhir.r4.formats.JsonParserBase.parse(JsonParserBase.java:113)\n    at org.hl7.fhir.convertors.R4ToR5Loader.loadBundle(R4ToR5Loader.java:58)\n    at org.hl7.fhir.r5.context.SimpleWorkerContext.loadFromFileJson(SimpleWorkerContext.java:260)\n    at org.hl7.fhir.r5.context.SimpleWorkerContext.loadDefinitionItem(SimpleWorkerContext.java:212)\n    at org.hl7.fhir.r5.context.SimpleWorkerContext.loadFromPackage(SimpleWorkerContext.java:289)\n    at org.hl7.fhir.r5.context.SimpleWorkerContext.fromPackage(SimpleWorkerContext.java:158)\n    at org.hl7.fhir.igtools.publisher.SpecificationPackage.fromPackage(SpecificationPackage.java:65)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadPack(Publisher.java:2082)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadCorePackage(Publisher.java:2045)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:1341)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1112)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:604)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6437)\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6447)\n</pre></div>",
        "id": 175220436,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568014240
    },
    {
        "content": "<p>oh. that's bad</p>",
        "id": 175220692,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568014669
    },
    {
        "content": "<p>wait a sec ... I bootstrapped with the wrong package version</p>",
        "id": 175220766,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568014795
    },
    {
        "content": "<p>sdc runs with 4.0</p>",
        "id": 175220817,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568014809
    },
    {
        "content": "<p>where does it matter what you say about that?</p>",
        "id": 175220825,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568014824
    },
    {
        "content": "<p><code>-spec package.tgz</code></p>",
        "id": 175220839,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568014853
    },
    {
        "content": "<p>hmm. you're trying to circumvent the package cache?</p>",
        "id": 175220848,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568014874
    },
    {
        "content": "<p>I would say that you have no reason to use the -spec parameter ?</p>",
        "id": 175220852,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568014891
    },
    {
        "content": "<p>im bootstrapping the package cache</p>",
        "id": 175220853,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568014891
    },
    {
        "content": "<p>i would ... its a cache .... so it speeds up the process</p>",
        "id": 175220859,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568014914
    },
    {
        "content": "<p>that means you're slowing down the process by destroying the cache otherwise</p>",
        "id": 175220899,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568014928
    },
    {
        "content": "<p>like there's no reason to do that</p>",
        "id": 175220904,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568014940
    },
    {
        "content": "<p>i would then need to fetch it for each build otherwise</p>",
        "id": 175220909,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568014965
    },
    {
        "content": "<p>I don't see why that makes sense. the cache is a system cache. No need to do anything to it</p>",
        "id": 175220920,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568014990
    },
    {
        "content": "<p>please elaborate on that</p>",
        "id": 175220935,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015019
    },
    {
        "content": "<p>and please remember that when run in docker nothing is shared with the host system</p>",
        "id": 175220940,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015036
    },
    {
        "content": "<p>unless explicitly stated</p>",
        "id": 175220990,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015051
    },
    {
        "content": "<p>hmm ok I forgot about the docker thing. can you share the cache through docker?</p>",
        "id": 175221005,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015092
    },
    {
        "content": "<p>thats what I just did</p>",
        "id": 175221018,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015114
    },
    {
        "content": "<p>by the -spec parameter? that isn't the same thing </p>\n<p>btw the sdc thing works for me if I blow my cache. So your spec.tgz may be the problem</p>",
        "id": 175221032,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015137
    },
    {
        "content": "<p>it is ... igpub does not like to be bootstrapped with a v3.0 cache when it is about to generate an artifact for v4.0</p>",
        "id": 175221083,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015178
    },
    {
        "content": "<p>apparently it does not check whether the cache is stale or not</p>",
        "id": 175221093,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015200
    },
    {
        "content": "<p>consider that a bugreport</p>",
        "id": 175221099,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015220
    },
    {
        "content": "<p>better to just have a cache that is shared directly through docker and let the packages manage themselves. We're going to push ever more into the package cach....</p>",
        "id": 175221113,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015240
    },
    {
        "content": "<p>anyways (without cache):</p>\n<div class=\"codehilite\"><pre><span></span>Jenss-MacBook-Pro-2:sdc jvi$ docker run --rm -v ${PWD}/:/app/ igpublisher:localbuild /app/ig.ini\nFHIR IG Publisher Version 0.9.69-SNAPSHOT - Built 2019-09-09T15:20:31.152+10:00 - Git bbf4b68a7f57\nDetected Java version: 1.8.0_212 from /usr/lib/jvm/java-8-openjdk-amd64/jre on amd64 (64bit). 1820MB available\nParameters: -ig /app/ig.ini [dir = /]\nRun time = Monday, September 9, 2019 7:37:37 AM UTC (2019-09-09T07:37:37Z)\nPackage Cache: /root/.fhir/packages                                              (00:00.0103)\nContacting Build Server...                                                       (00:00.0115)\n ... done                                                                        (00:01.0690)\nLoad Template from hl7.fhir.template                                             (00:02.0715)\nInstalling hl7.fhir.template#current to the package cache\n  Fetching:...|\n  Analysing done.\n\nonLoad.setup:\n\nonLoad.r5-schemas:\n      [get] Getting: http://build.fhir.org/fhir-single.xsd\n      [get] To: /app/input-cache/schemas-r5/fhir-single.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/fhir-xhtml.xsd\n      [get] To: /app/input-cache/schemas-r5/fhir-xhtml.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/xml.xsd\n      [get] To: /app/input-cache/schemas-r5/xml.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/xmldsig-core-schema.xsd\n      [get] To: /app/input-cache/schemas-r5/xmldsig-core-schema.xsd\n      [get] Not modified - so not downloaded\n\nonLoad.checkPublisher:\n\nonLoad.upgradeWarning:\n\nonLoad.findSpreadsheets:\n\nonLoad.updateIg:\n     [xslt] Processing /app/template/onLoad-ig-working.xml to /app/template/onLoad-ig-updated.xml\n     [xslt] Loading stylesheet /app/template/scripts/onLoad.xslt\n\nonLoad:\nRoot directory: /app                                                             (00:09.0244)\nInstalling hl7.fhir.core#4.0.0 to the package cache\n  Fetching:............................................................................................................\n  ......................................................................................................................\n  .......................................................................................|\n  Analysing.............................................................................................................\n  ......................................................................................................................\n  ................................................... done.\nTerminology Cache is at /app/input-cache/txcache. 12 files in cache              (01:31.0097)\nConnect to Terminology Server at http://tx.fhir.org                              (01:31.0157)\nInitialization complete                                                          (01:32.0944)\nLoad Content                                                                     (01:32.0944)\nProcessing Conformance Resources                                                 (01:35.0463)\nTerminology server: Check for supported code systems for http://unstats.un.org/unsd/methods/m49/m49.htm (01:35.0842)\nGenerating Narratives                                                            (01:39.0695)\nValidating Resources                                                             (01:39.0695)\nGenerating Outputs in /app/output                                                (01:41.0184)\n\nonGenerate.setup:\n\nonGenerate.infoFile:\n\nonGenerate.processIncludes:\n     [copy] Copying 4 files to /app/temp/pages/_includes\n     [xslt] Transforming into /app/temp/pages/_includes\n     [xslt] Processing /app/input/includes/menu.xml to /app/temp/pages/_includes/menu.xml\n     [xslt] Loading stylesheet /app/template/scripts/processPages.xslt\n     [xslt] Transforming into /app/temp/pages/_includes\n     [xslt] Processing /app/input/pagecontent/adaptive.xml to /app/temp/pages/_includes/adaptive.xml\n     [xslt] Loading stylesheet /app/template/scripts/processPages.xslt\n     [xslt] Processing /app/input/pagecontent/behavior.xml to /app/temp/pages/_includes/behavior.xml\n     [xslt] Processing /app/input/pagecontent/changes.xml to /app/temp/pages/_includes/changes.xml\n     [xslt] Processing /app/input/pagecontent/downloads.xml to /app/temp/pages/_includes/downloads.xml\n     [xslt] Processing /app/input/pagecontent/expressions.xml to /app/temp/pages/_includes/expressions.xml\n     [xslt] Processing /app/input/pagecontent/extraction.xml to /app/temp/pages/_includes/extraction.xml\n     [xslt] Processing /app/input/pagecontent/index.xml to /app/temp/pages/_includes/index.xml\n     [xslt] Processing /app/input/pagecontent/intro.xml to /app/temp/pages/_includes/intro.xml\n     [xslt] Processing /app/input/pagecontent/parameters-questionnaire-next-question-in-intro.xml to /app/temp/pages/_includes/parameters-questionnaire-next-question-in-intro.xml\n     [xslt] Processing /app/input/pagecontent/parameters-questionnaire-next-question-out-intro.xml to /app/temp/pages/_includes/parameters-questionnaire-next-question-out-intro.xml\n     [xslt] Processing /app/input/pagecontent/parameters-questionnaire-process-response-in-intro.xml to /app/temp/pages/_includes/parameters-questionnaire-process-response-in-intro.xml\n     [xslt] Processing /app/input/pagecontent/parameters-questionnaireresponse-extract-in-intro.xml to /app/temp/pages/_includes/parameters-questionnaireresponse-extract-in-intro.xml\n     [xslt] Processing /app/input/pagecontent/populate.xml to /app/temp/pages/_includes/populate.xml\n     [xslt] Processing /app/input/pagecontent/rendering.xml to /app/temp/pages/_includes/rendering.xml\n     [xslt] Processing /app/input/pagecontent/sdc-codesystem-examples-notes.xml to /app/temp/pages/_includes/sdc-codesystem-examples-notes.xml\n     [xslt] Processing /app/input/pagecontent/sdc-codesystem-intro.xml to /app/temp/pages/_includes/sdc-codesystem-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-dataelement-examples-notes.xml to /app/temp/pages/_includes/sdc-dataelement-examples-notes.xml\n     [xslt] Processing /app/input/pagecontent/sdc-dataelement-intro.xml to /app/temp/pages/_includes/sdc-dataelement-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-dataelement-notes.xml to /app/temp/pages/_includes/sdc-dataelement-notes.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-adapt-intro.xml to /app/temp/pages/_includes/sdc-questionnaire-adapt-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-behave-intro.xml to /app/temp/pages/_includes/sdc-questionnaire-behave-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-examples-notes.xml to /app/temp/pages/_includes/sdc-questionnaire-examples-notes.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-extract-intro.xml to /app/temp/pages/_includes/sdc-questionnaire-extract-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-intro.xml to /app/temp/pages/_includes/sdc-questionnaire-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-notes.xml to /app/temp/pages/_includes/sdc-questionnaire-notes.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-populate-intro.xml to /app/temp/pages/_includes/sdc-questionnaire-populate-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-render-intro.xml to /app/temp/pages/_includes/sdc-questionnaire-render-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaire-search-intro.xml to /app/temp/pages/_includes/sdc-questionnaire-search-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaireresponse-examples-notes.xml to /app/temp/pages/_includes/sdc-questionnaireresponse-examples-notes.xml\n     [xslt] Processing /app/input/pagecontent/sdc-questionnaireresponse-intro.xml to /app/temp/pages/_includes/sdc-questionnaireresponse-intro.xml\n     [xslt] Processing /app/input/pagecontent/sdc-valueset-examples-notes.xml to /app/temp/pages/_includes/sdc-valueset-examples-notes.xml\n     [xslt] Processing /app/input/pagecontent/sdc-valueset-intro.xml to /app/temp/pages/_includes/sdc-valueset-intro.xml\n     [xslt] Processing /app/input/pagecontent/search.xml to /app/temp/pages/_includes/search.xml\n     [xslt] Processing /app/input/pagecontent/security.xml to /app/temp/pages/_includes/security.xml\n     [xslt] Processing /app/input/pagecontent/workflow.xml to /app/temp/pages/_includes/workflow.xml\n\nonGenerate.processIg:\n     [xslt] Processing /app/template/onGenerate-ig-working.xml to /app/template/onGenerate-ig-working.1.xml\n     [xslt] Loading stylesheet /app/template/scripts/onGenerate.group.xslt\n     [xslt] Processing /app/template/onGenerate-ig-working.1.xml to /app/template/onGenerate-ig-updated.xml\n     [xslt] Loading stylesheet /app/template/scripts/onGenerate.final.xslt\n\nonGenerate.artifactList:\n     [xslt] Processing /app/template/onGenerate-ig-updated.xml to /app/temp/pages/_includes/artifacts.xml\n     [xslt] Loading stylesheet /app/template/scripts/createArtifactSummary.xslt\n\nonGenerate:\nGenerating Summary Outputs                                                       (02:04.0530)\nSending Usage Stats to Server                                                    (02:10.0588)\nJekyll: Source: /app/temp/pages                                                  (02:20.0513)\nJekyll: Generating...                                                            (02:20.0514)\nERRO[0158] error waiting for container: EOF\n</pre></div>",
        "id": 175221117,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015247
    },
    {
        "content": "<p>so that also has the jekyll timeout....</p>",
        "id": 175221122,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015276
    },
    {
        "content": "<p>nop</p>",
        "id": 175221165,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015287
    },
    {
        "content": "<p>that simply fails</p>",
        "id": 175221169,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015295
    },
    {
        "content": "<p>well, that suggests that it's something more infrastructural than content (though it's not proof)</p>",
        "id": 175221172,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015302
    },
    {
        "content": "<blockquote>\n<p>ERRO[0158] error waiting for container: EOF</p>\n</blockquote>\n<p>isn't that timeout?</p>",
        "id": 175221178,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015320
    },
    {
        "content": "<p>as suspected (from my side)</p>",
        "id": 175221179,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015320
    },
    {
        "content": "<p>no</p>",
        "id": 175221196,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015372
    },
    {
        "content": "<p>this happened almost instantly</p>",
        "id": 175221203,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015392
    },
    {
        "content": "<p>oh?</p>",
        "id": 175221210,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015400
    },
    {
        "content": "<p>wait a sec</p>",
        "id": 175221257,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015417
    },
    {
        "content": "<p>it's from the Apache code?</p>",
        "id": 175221261,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015424
    },
    {
        "content": "<p>docker crashed</p>",
        "id": 175221263,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015430
    },
    {
        "content": "<p>wooah</p>",
        "id": 175221265,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015436
    },
    {
        "content": "<p>one thing I've been wondering... can we make a -docker parameter which means that instead of running jekyll from the command line, we ask a (different) docker process to run it?</p>",
        "id": 175221289,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015472
    },
    {
        "content": "<p>I hd a quick look for Java code to do that, but didn't find anything. Google was overwhelmed with other stuff about running java on docker as a deployment thing</p>",
        "id": 175221304,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015502
    },
    {
        "content": "<p>that would be docker in docker ... for this setup I would not recommend it</p>",
        "id": 175221356,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568015529
    },
    {
        "content": "<p>I though it would be asking the docker host to spawn another docker and then wait for it... but never mind... I'm just searching for a solution here. still Jekyll seems unhappy in docker. what happens if you run Jekyll manually in the docker on the SDC IG?</p>",
        "id": 175221393,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568015599
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Jenss-MacBook-Pro-2:sdc jvi$ docker run --rm -v ${PWD}/:/app/ igpublisher:localbuild /app/ig.ini\nFHIR IG Publisher Version 0.9.69-SNAPSHOT - Built 2019-09-09T15:20:31.152+10:00 - Git bbf4b68a7f57\nDetected Java version: 1.8.0_212 from /usr/lib/jvm/java-8-openjdk-amd64/jre on amd64 (64bit). 1820MB available\nParameters: -ig /app/ig.ini [dir = /]\nRun time = Monday, September 9, 2019 8:17:20 AM UTC (2019-09-09T08:17:20Z)\nPackage Cache: /root/.fhir/packages                                              (00:00.0076)\nContacting Build Server...                                                       (00:00.0094)\n ... done                                                                        (00:01.0948)\nLoad Template from hl7.fhir.template                                             (00:03.0236)\nInstalling hl7.fhir.template#current to the package cache\n  Fetching:...|\n  Analysing done.\n\nonLoad.setup:\n\nonLoad.r5-schemas:\n      [get] Getting: http://build.fhir.org/fhir-single.xsd\n      [get] To: /app/input-cache/schemas-r5/fhir-single.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/fhir-xhtml.xsd\n      [get] To: /app/input-cache/schemas-r5/fhir-xhtml.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/xml.xsd\n      [get] To: /app/input-cache/schemas-r5/xml.xsd\n      [get] Not modified - so not downloaded\n      [get] Getting: http://build.fhir.org/xmldsig-core-schema.xsd\n      [get] To: /app/input-cache/schemas-r5/xmldsig-core-schema.xsd\n      [get] Not modified - so not downloaded\n\nonLoad.checkPublisher:\n\nonLoad.upgradeWarning:\n\nonLoad.findSpreadsheets:\n\nonLoad.updateIg:\n     [xslt] Processing /app/template/onLoad-ig-working.xml to /app/template/onLoad-ig-updated.xml\n     [xslt] Loading stylesheet /app/template/scripts/onLoad.xslt\n\nonLoad:\nRoot directory: /app                                                             (00:09.0427)\nInstalling hl7.fhir.core#4.0.0 to the package cache\n  Fetching:............................................................................................................\n  ......................................................................................................................\n  .......................................................................................|\n  Analysing.............................................................................................................\n  ......................................................................................................................\n  ................................................... done.\nTerminology Cache is at /app/input-cache/txcache. 12 files in cache              (01:43.0508)\nConnect to Terminology Server at http://tx.fhir.org                              (01:43.0572)\nInitialization complete                                                          (01:46.0973)\nLoad Content                                                                     (01:46.0973)\nProcessing Conformance Resources                                                 (01:49.0851)\nTerminology server: Check for supported code systems for http://unstats.un.org/unsd/methods/m49/m49.htm (01:50.0201)\nGenerating Narratives                                                            (01:54.0063)\nValidating Resources                                                             (01:54.0063)\nGenerating Outputs in /app/output                                                (01:55.0920)\n\nonGenerate.setup:\n\nonGenerate.infoFile:\n...\n     [xslt] Processing /app/input/pagecontent/sdc-valueset-examples-notes.xml to /app/temp/pages/_includes/sdc-valueset-examples-notes.xml\n     [xslt] Processing /app/input/pagecontent/sdc-valueset-intro.xml to /app/temp/pages/_includes/sdc-valueset-intro.xml\n     [xslt] Processing /app/input/pagecontent/search.xml to /app/temp/pages/_includes/search.xml\n     [xslt] Processing /app/input/pagecontent/security.xml to /app/temp/pages/_includes/security.xml\n     [xslt] Processing /app/input/pagecontent/workflow.xml to /app/temp/pages/_includes/workflow.xml\n\nonGenerate.processIg:\n     [xslt] Processing /app/template/onGenerate-ig-working.xml to /app/template/onGenerate-ig-working.1.xml\n     [xslt] Loading stylesheet /app/template/scripts/onGenerate.group.xslt\n     [xslt] Processing /app/template/onGenerate-ig-working.1.xml to /app/template/onGenerate-ig-updated.xml\n     [xslt] Loading stylesheet /app/template/scripts/onGenerate.final.xslt\n\nonGenerate.artifactList:\n     [xslt] Processing /app/template/onGenerate-ig-updated.xml to /app/temp/pages/_includes/artifacts.xml\n     [xslt] Loading stylesheet /app/template/scripts/createArtifactSummary.xslt\n\nonGenerate:\nGenerating Summary Outputs                                                       (02:40.0705)\nSending Usage Stats to Server                                                    (02:49.0899)\nJekyll: Source: /app/temp/pages                                                  (02:57.0197)\nJekyll: Generating...                                                            (02:57.0197)\nJekyll: done in 26.797 seconds.                                                  (03:23.0998)\nInstalling hl7.fhir.uv.sdc#dev to the package cache\n  Fetching:.....|\n  Analysing.. done.\nChecking Output HTML                                                             (03:30.0889)\nfound 1123 files                                                                 (03:31.0535)\n  ... 1123 html files, 0 pages invalid xhtml (0%)                                (04:12.0198)\n  ... 509587 links, 2 broken links (0%)                                          (04:12.0199)\nBuild final .zip                                                                 (04:12.0203)\nFinal .zip built                                                                 (04:18.0963)\ncontext [anonymous] 2:13 attribute path isn&#39;t defined\nFinished. 02:29.0112. Validation output in /app/output/qa.html\nErrors: 156  Warnings: 398  Info: 0 (04:19.0317)\nDone\n</pre></div>",
        "id": 175223034,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568017436
    },
    {
        "content": "<p>sdc works fine in docker</p>",
        "id": 175223077,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568017447
    },
    {
        "content": "<p>i don't think jekyll is the issue here</p>",
        "id": 175223102,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568017500
    },
    {
        "content": "<p>as it is not unhappy</p>",
        "id": 175224487,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568019275
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> any ideas to the next step of debugging?</p>",
        "id": 175232431,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568028075
    },
    {
        "content": "<p>Hmmm. SDC does work under docker.... well. That’s challenging. What’s the size of the sdc temp directory compared to your ig?</p>",
        "id": 175232841,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568028484
    },
    {
        "content": "<p>Size: 145.671.385 bytes (171,7 MB on disk) for 6.758 items</p>",
        "id": 175234669,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568030312
    },
    {
        "content": "<p>that was SDC</p>",
        "id": 175234917,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568030613
    },
    {
        "content": "<p>105.710.547 bytes (123,3 MB on disk) for 9.054 items for my own</p>",
        "id": 175235461,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568031137
    },
    {
        "content": "<p>that doesn't feel like it. I wonder whether it's possible to debug Jekyll?</p>",
        "id": 175272643,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568055818
    },
    {
        "content": "<p>I'll start by adding <code>--verbose</code> to jekyll args ...</p>",
        "id": 175380995,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568151702
    },
    {
        "content": "<p>I could add that as a flag...</p>",
        "id": 175383352,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568153632
    },
    {
        "content": "<p>I've got the source to igpub ... so I'll just do it locally for now</p>",
        "id": 175463031,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568227479
    },
    {
        "content": "<p>ok</p>",
        "id": 175463056,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568227499
    },
    {
        "content": "<p>I don't have the same anxiety towards maven  ... ;)</p>",
        "id": 175463132,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568227556
    },
    {
        "content": "<p>I think I found the bug - at least removing some content made it pass through. It's due to some extra tabs we've added as part of the generation process. Content in these extra tabs contains markdown. This markdown is probably badly formatted which causes Jekyll to hang. Why it only does it in Docker beats me</p>",
        "id": 175475400,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568235473
    },
    {
        "content": "<p>Maybe a linefeed or something ... The docker container always runs in a linux environment ...</p>",
        "id": 175475484,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568235507
    },
    {
        "content": "<p>that's.... weird</p>",
        "id": 175475517,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568235528
    },
    {
        "content": "<p>indeed</p>",
        "id": 175475690,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1568235621
    }
]