[
    {
        "content": "<p>I have a resource with one code system url in it</p>\n<p>The IG builder gives me this error</p>\n<div class=\"codehilite\"><pre><span></span>     [java] Validating Resources                                                             (18.0712sec)\n     [java] Terminology server: Check for supported code systems for http://unstats.un.org/unsd/methods/m49/m49.htm\n     [java] java.lang.NullPointerException\n     [java]     at org.hl7.fhir.r4.utils.FHIRPathEngine.tailMatches(FHIRPathEngine.java:3765)\n</pre></div>\n\n\n<p>But the only CodeSystem URL I have is for the dataAbsentReason</p>\n<p><a href=\"http://terminology.hl7.org/CodeSystem/data-absent-reason\" target=\"_blank\" title=\"http://terminology.hl7.org/CodeSystem/data-absent-reason\">http://terminology.hl7.org/CodeSystem/data-absent-reason</a></p>\n<p>Maybe I just do not understand this error. The resource is</p>\n<div class=\"codehilite\"><pre><span></span>{\n    &quot;resourceType&quot;: &quot;Observation&quot;,\n    &quot;id&quot;: &quot;nan-1.0.0.42&quot;,\n    &quot;meta&quot;: {\n        &quot;profile&quot;: [\n            &quot;http://hl7.org/fhir/uv/phd/StructureDefinition/PhdNumericObservation&quot;\n        ]\n    },\n    &quot;extension&quot;: [\n        {\n            &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/observation-gatewayDevice&quot;,\n            &quot;valueReference&quot;: {\n                &quot;reference&quot;: &quot;Device/ecde3d4e58532d31&quot;\n            }\n        }\n    ],\n    &quot;status&quot;: &quot;final&quot;,\n    &quot;code&quot;: {\n        &quot;coding&quot;: [\n            {\n                &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                &quot;code&quot;: &quot;150320&quot;\n            }\n        ],\n        &quot;text&quot;: &quot;MDC_SAT_O2_QUAL: Blood oxygen saturation&quot;\n    },\n    &quot;subject&quot;: {\n        &quot;reference&quot;: &quot;Patient/sisansarahId.1.2.3.4.5.6.7.8.10&quot;\n    },\n    &quot;effectiveDateTime&quot;: &quot;2018-11-11T19:07:48-05:00&quot;,\n    &quot;dataAbsentReason&quot;: {\n        &quot;coding&quot;: [\n            {\n                &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/data-absent-reason&quot;,\n                &quot;code&quot;: &quot;not-a-number&quot;\n            }\n        ],\n        &quot;text&quot;: &quot;not-a-number (Not a number)&quot;\n    },\n    &quot;device&quot;: {\n        &quot;reference&quot;: &quot;Device/74E8FFFEFF051C00.001C05FFE874&quot;\n    },\n    &quot;derivedFrom&quot;: [\n        {\n            &quot;reference&quot;: &quot;Observation/coincident-3.14159.20181111190736&quot;\n        }\n    ]\n}\n</pre></div>",
        "id": 154018253,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542153599
    },
    {
        "content": "<p>That coding system is associated with stats.  Its not related to this observation.</p>",
        "id": 154018265,
        "sender_full_name": "Eric Haas",
        "timestamp": 1542155183
    },
    {
        "content": "<blockquote>\n<p>That coding system is associated with stats.  Its not related to this observation.</p>\n</blockquote>\n<p>Why am I getting that error on my Observation example?</p>",
        "id": 154018268,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542155923
    },
    {
        "content": "<p>the build may be processing other files in your directory... do you have any folders with other directories.</p>",
        "id": 154018270,
        "sender_full_name": "Eric Haas",
        "timestamp": 1542156595
    },
    {
        "content": "<blockquote>\n<p>the build may be processing other files in your directory... do you have any folders with other directories.</p>\n</blockquote>\n<p>Well, if I remove the example file above from the ImplementationGuide.xml, it builds fine.</p>",
        "id": 154018271,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542156704
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <br>\nAny idea why my example gets this validation error?</p>\n<div class=\"codehilite\"><pre><span></span>  [java] Terminology server: Check for supported code systems for http://unstats.un.org/unsd/methods/m49/m49.htm\n</pre></div>\n\n\n<p>What is '<a href=\"http://unstats.un.org\" target=\"_blank\" title=\"http://unstats.un.org\">unstats.un.org</a>' and why does it have anything to do with my example? The reference to a coding system in the example is for the dataAbsentReason.coding.system.</p>",
        "id": 154018343,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542192033
    },
    {
        "content": "<p>that's not a validation error - it's a performance optimization note for me</p>",
        "id": 154018344,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1542192075
    },
    {
        "content": "<blockquote>\n<p>that's not a validation error - it's a performance optimization note for me</p>\n</blockquote>\n<p>Oh. Its always the last line before a null pointer exception</p>",
        "id": 154018345,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542192132
    },
    {
        "content": "<p>I guess I'll have to debug... that has no bearing on the NPE</p>",
        "id": 154018346,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1542192174
    },
    {
        "content": "<p>I figure if I can get one example to work it should be easy to add more ... I can give you the entire log around the error ...</p>\n<p>For some reason the validator does not like this resource</p>\n<div class=\"codehilite\"><pre><span></span>{\n    &quot;resourceType&quot;: &quot;Observation&quot;,\n    &quot;id&quot;: &quot;nan-1.0.0.42&quot;,\n    &quot;meta&quot;: {\n        &quot;profile&quot;: [\n            &quot;http://hl7.org/fhir/uv/phd/StructureDefinition/PhdNumericObservation&quot;\n        ]\n    },\n    &quot;extension&quot;: [\n        {\n            &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/observation-gatewayDevice&quot;,\n            &quot;valueReference&quot;: {\n                &quot;reference&quot;: &quot;Device/ecde3d4e58532d31&quot;\n            }\n        }\n    ],\n    &quot;status&quot;: &quot;final&quot;,\n    &quot;code&quot;: {\n        &quot;coding&quot;: [\n            {\n                &quot;system&quot;: &quot;urn:iso:std:iso:11073:10101&quot;,\n                &quot;code&quot;: &quot;150320&quot;\n            }\n        ],\n        &quot;text&quot;: &quot;MDC_SAT_O2_QUAL: Pulsatile quality&quot;\n    },\n    &quot;subject&quot;: {\n        &quot;reference&quot;: &quot;Patient/sisansarahId.1.2.3.4.5.6.7.8.10&quot;\n    },\n    &quot;effectiveDateTime&quot;: &quot;2018-11-11T19:07:48-05:00&quot;,\n    &quot;dataAbsentReason&quot;: {\n        &quot;coding&quot;: [\n            {\n                &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/data-absent-reason&quot;,\n                &quot;code&quot;: &quot;not-a-number&quot;\n            }\n        ],\n        &quot;text&quot;: &quot;not-a-number (Not a number)&quot;\n    },\n    &quot;device&quot;: {\n        &quot;reference&quot;: &quot;Device/74E8FFFEFF051C00.001C05FFE874&quot;\n    }\n}\n</pre></div>\n\n\n<p>Since it is throwing a null pointer exception it must be looking for something that isn't there....I just don't know what. I made up the id since this observation was extracted from a transaction bundle.</p>",
        "id": 154018347,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542192296
    },
    {
        "content": "<p>Can you post the full stack trace for the NPE?</p>",
        "id": 154018351,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1542192878
    },
    {
        "content": "<blockquote>\n<p>Can you post the full stack trace for the NPE?</p>\n</blockquote>\n<p>here</p>\n<div class=\"codehilite\"><pre><span></span>     [java] E:\\Ruby25-x64\\IG_Publisher\\PHD\\src\\examples\\nan-1.0.0.42\n     [java] -tx cache miss: $validate null#not-a-number: &quot;null&quot; for null\n     [java] Validating Resources                                                             (15.0711sec)\n     [java] Terminology server: Check for supported code systems for http://unstats.un.org/unsd/methods/m49/m49.htm\n     [java] java.lang.NullPointerException                                                   (17.0032sec)\n     [java] Publishing Content Failed: null                                                  (17.0042sec)\n     [java]                                                                                  (17.0042sec)\n     [java] Use -? to get command line help                                                  (17.0042sec)\n     [java]                                                                                  (17.0042sec)\n     [java] Stack Dump (for debugging):                                                      (17.0042sec)\n     [java] java.lang.NullPointerException\n     [java]     at org.hl7.fhir.r4.utils.FHIRPathEngine.tailMatches(FHIRPathEngine.java:3765)\n     [java]     at org.hl7.fhir.r4.utils.FHIRPathEngine.evaluateDefinition(FHIRPathEngine.java:3693)\n     [java]     at org.hl7.fhir.r4.validation.InstanceValidator.getCriteriaForDiscriminator(InstanceValidator.java:2020)\n     [java]     at org.hl7.fhir.r4.validation.InstanceValidator.sliceMatches(InstanceValidator.java:2495)\n     [java]     at org.hl7.fhir.r4.validation.InstanceValidator.validateElement(InstanceValidator.java:3479)\n     [java]     at org.hl7.fhir.r4.validation.InstanceValidator.validateElement(InstanceValidator.java:3785)\n     [java]     at org.hl7.fhir.r4.validation.InstanceValidator.start(InstanceValidator.java:2665)\n     [java]     at org.hl7.fhir.r4.validation.InstanceValidator.validateResource(InstanceValidator.java:3978)\n     [java]     at org.hl7.fhir.r4.validation.InstanceValidator.validate(InstanceValidator.java:709)\n     [java]     at org.hl7.fhir.r4.validation.InstanceValidator.validate(InstanceValidator.java:669)\n     [java]     at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:2802)\n     [java]     at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:2779)\n     [java]     at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:591)\n     [java]     at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:526)\n     [java]     at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:4925)\n     [java] Exception in thread &quot;main&quot; java.lang.NullPointerException\n     [java]     at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:4935)\n     [java] Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8\n\nBUILD FAILED\n</pre></div>",
        "id": 154018354,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542192929
    },
    {
        "content": "<p>unusual...</p>",
        "id": 154018365,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1542193336
    },
    {
        "content": "<p>you have a slice with no value somewhere?</p>",
        "id": 154018366,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1542193359
    },
    {
        "content": "<p>The specific error seems to be choking on either an element with no path or an element with a single type with no code.</p>",
        "id": 154018370,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1542193550
    },
    {
        "content": "<p>Is the IG checked in anywhere we can run it through the debugger?</p>",
        "id": 154018371,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1542193570
    },
    {
        "content": "<blockquote>\n<p>Is the IG checked in anywhere we can run it through the debugger?</p>\n</blockquote>\n<p>I am trying to build it so I can check it in. My understanding is that I need to do that first. But it is on git hub. I can check it in as is</p>\n<p><a href=\"https://github.com/HL7/PHD\" target=\"_blank\" title=\"https://github.com/HL7/PHD\">https://github.com/HL7/PHD</a></p>\n<p>I just noted that I committed it with an attempt I was doing on another example resource. That one is BIG. In the ImplementationGuide you can get the same error using the small single-Observation example by uncommenting the small example and commenting out the big one.</p>\n<div class=\"codehilite\"><pre><span></span>--- The big one ---\n    &lt;resource&gt;\n      &lt;reference&gt;\n        &lt;reference value=&quot;Bundle/bundle-continuousnonin&quot;/&gt;\n      &lt;/reference&gt;\n      &lt;name value=&quot;Example upload from Pulse Oximeter&quot;/&gt;\n      &lt;description value=&quot;This example is an upload from a Bluetooth Low Energy Pulse oximeter device streaming data. In this case the gateway has previously uploaded measurements and saved the logical ids of the Patient and Device resources so they are not re-uploaded.&quot; /&gt;\n      &lt;exampleBoolean value=&quot;true&quot;/&gt;\n      &lt;groupingId value=&quot;hl7.fhir.uv.phd&quot; /&gt;\n    &lt;/resource&gt;\n    &lt;!-- (small example)\n    &lt;resource&gt;\n      &lt;reference&gt;\n        &lt;reference value=&quot;Observation/nan-1.0.0.42&quot;/&gt;\n      &lt;/reference&gt;\n      &lt;name value=&quot;Example upload from Pulse Oximeter&quot;/&gt;\n      &lt;description value=&quot;Example contains a NaN (not a number) measurement.&quot; /&gt;\n      &lt;exampleBoolean value=&quot;true&quot;/&gt;\n      &lt;groupingId value=&quot;hl7.fhir.uv.phd&quot; /&gt;\n    &lt;/resource&gt; --&gt;\n</pre></div>\n\n\n<p><strong>I recommitted with the simple example ...</strong></p>",
        "id": 154018372,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542193642
    },
    {
        "content": "<p>the build will just fail. You don't have to get IGs to build in order to commit (different to the main build)</p>",
        "id": 154018373,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1542193759
    },
    {
        "content": "<p>ok checking in a fix</p>",
        "id": 154018376,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1542194457
    },
    {
        "content": "<blockquote>\n<p>ok checking in a fix</p>\n</blockquote>\n<p>I still get the error but I only cleared the src-generated files. Probably need to clear the .fhir cache?</p>",
        "id": 154018377,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542194717
    },
    {
        "content": "<p>I don't think the fix has been pushed yet?</p>",
        "id": 154018378,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1542194832
    },
    {
        "content": "<p>OH.  I guess it takes a while to check in ... I cleared the cache and the src-generated but get the same result. <br>\nWhat was the problem or is it too complicated to explain?</p>",
        "id": 154018379,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542194919
    },
    {
        "content": "<blockquote>\n<p>I don't think the fix has been pushed yet?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  Do I need to commit the IGpublisher.jar in the src-generated files to have the continuous integration work?</p>",
        "id": 154018380,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542195453
    },
    {
        "content": "<p>No.  Grahame's commit is now merged and built and it looks like it fixes your issue.</p>",
        "id": 154018391,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1542197642
    },
    {
        "content": "<blockquote>\n<p>No.  Grahame's commit is now merged and built and it looks like it fixes your issue.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  YES IT DID!</p>\n<p>Given that, what files in the src-generated do I need to commit in order to have the continuous integration work? Do I just need the directory hierarchy? GitHub is complaining about the igpublisher being too big.</p>",
        "id": 154018395,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1542197942
    },
    {
        "content": "<p>Github complains, but it still does it.  I always commit everything in src-generated</p>",
        "id": 154018400,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1542200185
    },
    {
        "content": "<p>you don't need igpublisher committed for the auto-build. it uses it's own version of the igpublisher</p>",
        "id": 154018401,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1542200623
    },
    {
        "content": "<p>In creating some example SDC questionnaires with a contained bundle found a validation issue:<br>\n<a href=\"https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/gp-assessment-report\" target=\"_blank\" title=\"https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/gp-assessment-report\">https://sqlonfhir-r4.azurewebsites.net/fhir/Questionnaire/gp-assessment-report</a></p>\n<div class=\"codehilite\"><pre><span></span>&lt;Questionnaire &gt;\n  &lt;id value=&quot;gp-assessment-report&quot;/&gt;\n  &lt;contained &gt;\n    &lt;Bundle &gt;\n      &lt;id value=&quot;PrePopQuery&quot;/&gt;\n      &lt;type value=&quot;batch&quot;/&gt;\n      &lt;entry &gt;\n      &lt;fullUrl value=&quot;urn:uuid:88f151c0-a954-468a-88bd-5ae15c08e059&quot;/&gt;\n      &lt;request &gt;\n      &lt;method value=&quot;GET&quot;/&gt;\n      &lt;url value=&quot;RelatedPerson?patient={{%LaunchPatient.id}}&amp;active=true&quot;/&gt;\n      &lt;/request&gt;\n      &lt;/entry&gt;\n    &lt;/Bundle&gt;\n  &lt;/contained&gt;\n</pre></div>\n\n\n<p>This returns the following 2 invariant errors:<br>\nbdl-3: entry.request mandatory for batch/transaction/history, otherwise prohibited [entry.all(request.exists() = ((%resource.type = 'batch') or (%resource.type = 'transaction') or (%resource.type = 'history')))]<br>\nbdl-4: entry.response mandatory for batch-response/transaction-response/history, otherwise prohibited [entry.all(response.exists() = ((%resource.type = 'batch-response') or (%resource.type = 'transaction-response') or (%resource.type = 'history')))]<br>\nWhich I think are not correct.</p>",
        "id": 180783590,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1573771300
    },
    {
        "content": "<p>Yup.  Looks like a FHIRPath issue where %resource is resolving to the Questionnaire rather than the Bundle.</p>",
        "id": 180787040,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1573773753
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , does the fhirpath/validation tests contain an example like this one?</p>",
        "id": 180954492,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1573991050
    },
    {
        "content": "<p>It’s on my todo list to investigate</p>",
        "id": 180954499,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573991097
    },
    {
        "content": "<p>looks like i've fixed this, but I've added it as a test case</p>",
        "id": 182141210,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574983851
    }
]