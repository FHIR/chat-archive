[
    {
        "content": "<p>Coming across error(s) using the <a href=\"http://hl7.org/fhir/StructureDefinition/request-doNotPerform\">request-doNotPerform</a> extension as a modifier extension within <a href=\"http://build.fhir.org/ig/HL7/fhir-qi-core/StructureDefinition-qicore-devicenotrequested.html\">deviceRequest</a>. The scope of the extension is outside of NutritionOrder and deviceRequest was one of the <a href=\"https://jira.hl7.org/browse/FHIR-26526\">approved profiles</a> but recently informed that the final outcome was to add doNotPerform as an explicit element in R5. </p>\n<p>It was suggested for R4 to use the <a href=\"https://build.fhir.org/versions.html#extensions\">pre-adoption extension mechanism</a> for conversion between versions .- so <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-DeviceRequest.doNotPerform</code></p>\n<p>Changed the type within the profile spreadsheet from <code>Extension{http://hl7.org/fhir/StructureDefinition/request-doNotPerform}</code> to  <code>Extension{http://hl7.org/fhir/5.0/StructureDefinition/extension-DeviceRequest.doNotPerform}</code> but getting a build error within the publisher for '<em>reference of an unknown extension -http://hl7.org/fhir/5.0/StructureDefinition/extension-DeviceRequest.doNotPerform</em> '</p>\n<p><a href=\"/user_uploads/10155/xx3sDXgU7ExD4qMBsGog2G6r/Screen-Shot-2021-10-19-at-12.37.54-PM.png\">Spreadsheet</a></p>\n<p><a href=\"/user_uploads/10155/eBHemDWx5Sby2ECdrLWIgZTw/Screen-Shot-2021-10-19-at-9.43.30-AM.png\">Spreadsheet change with pre-adoption extension mechanism</a></p>\n<p>Wanted to confirm if the pre-adoption extension mechanism will suffice for a modifierExtension and if the url looks to be correct?</p>",
        "id": 258229956,
        "sender_full_name": "Abdullah Rafiqi",
        "timestamp": 1634662057
    },
    {
        "content": "<p>You might need to say \"4.6\" right now as 5.0 doesn't yet exist.</p>",
        "id": 258244908,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1634666809
    },
    {
        "content": "<p>no that would always be 5.0 not 4.6 in that context</p>",
        "id": 258251954,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634669494
    },
    {
        "content": "<p>Thoughts on the cause of the error then <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>?</p>",
        "id": 258252056,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1634669523
    },
    {
        "content": "<p>no idea. I'll have to debug. And my list of things to debug is growing rapidly this week</p>",
        "id": 258252155,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634669564
    },
    {
        "content": "<p>Committed to QICore</p>",
        "id": 260200245,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1635974942
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , I've done a bit of debugging here and I got as far as the \"DeviceRequest.doNotPerform\" doesn't appear to be in the xver-paths.json file. I'm guessing that's something that gets generated, but I'm not sure how or where?</p>",
        "id": 261060640,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1636581472
    },
    {
        "content": "<p>this should be fixed now</p>",
        "id": 261061837,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636581984
    },
    {
        "content": "<p>roughly:</p>\n<ul>\n<li>the file itself is produced by the main build</li>\n<li>when I do a release, I copy that file into the source for hl7.fhir.xver-extensions, and release a new version</li>\n<li>I forgot to do that when I released 4.6.0, so I did last week - released 0.0.7</li>\n<li>it has \"package\\other\\xver-paths-4.6.json\" in it</li>\n<li>that contains DeviceRequest.doNotPerform</li>\n<li>the validator maps /5.0/ to 4.6.0. And it should all work now</li>\n</ul>",
        "id": 261062229,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636582170
    },
    {
        "content": "<p>Perfect, thank you!</p>",
        "id": 261072695,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1636587795
    },
    {
        "content": "<p>Tried again this morning with the latest release (v1.1.85) and now I'm getting a different error, says the version is incorrect:<br>\norg.hl7.fhir.exceptions.FHIRException: Reference to invalid version in extension url <a href=\"http://hl7.org/fhir/5.0/StructureDefinition/extension-DeviceRequest.doNotPerform\">http://hl7.org/fhir/5.0/StructureDefinition/extension-DeviceRequest.doNotPerform</a></p>",
        "id": 261142812,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1636642322
    },
    {
        "content": "<p>I blew away my package cache and tried again, same result, though I did notice that the xver-extensions package was version 0.0.5, but I see you're referencing 0.0.7 above, is that potentially the issue?</p>",
        "id": 261142935,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1636642383
    },
    {
        "content": "<p>well, it certainly is the issue but why are you getting an old version?</p>",
        "id": 261169811,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636655691
    },
    {
        "content": "<p>... and that is my fault. I've had some code reversion somewhere.</p>",
        "id": 261170384,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636656006
    },
    {
        "content": "<p>this is  my issue too but not as burning for me... GG do you still need me to provide a test build to investigate?</p>",
        "id": 261174804,
        "sender_full_name": "Eric Haas",
        "timestamp": 1636658605
    },
    {
        "content": "<p>not for this one. I will try and get an update out for this fix today</p>",
        "id": 261178540,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636660901
    },
    {
        "content": "<p>I tried this again with the latest publisher (v1.1.86) and I'm getting the same error about \"Reference to invalid version in extension url\". I cleared my package cache and tried again, same result, and I notice that the xver-extensions pacakage is still 0.0.5.</p>",
        "id": 261514459,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1636990826
    },
    {
        "content": "<p>what IG is this?</p>",
        "id": 261571734,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637016506
    },
    {
        "content": "<p>QICore</p>",
        "id": 261573854,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1637017613
    },
    {
        "content": "<p><a href=\"https://github.com/HL7/fhir-qi-core\">https://github.com/HL7/fhir-qi-core</a></p>",
        "id": 261573886,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1637017637
    },
    {
        "content": "<p>sigh. I'll make the same change to the code for a third time. And I'll try to figure out why I've done it three times... Git screwed me somewhere but I didn't think it was that</p>",
        "id": 261580952,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637022047
    },
    {
        "content": "<p>anyway, next release</p>",
        "id": 261580968,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637022062
    },
    {
        "content": "<p>Okay, the good news is, it worked and we can build now :) The bad news is, since it is a \"modifier\" element, we are using a \"modifierExtension\", but the build tooling is now giving an error that it should be an \"extension\", not a \"modifierExtension\". We can change it, but then how does an R4 implementation know that it's a modifier? <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <a href=\"https://build.fhir.org/ig/HL7/fhir-qi-core/branches/master/qa.html#_scratch_ig-build-temp-S6MEHV_repo_input_resources_devicerequest-negation-example\">https://build.fhir.org/ig/HL7/fhir-qi-core/branches/master/qa.html#_scratch_ig-build-temp-S6MEHV_repo_input_resources_devicerequest-negation-example</a></p>",
        "id": 262141961,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1637362311
    },
    {
        "content": "<p>that's a bug. I'll fix it before the next release</p>",
        "id": 262158032,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637377111
    },
    {
        "content": "<p>this should be sorted now <span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span></p>",
        "id": 262654554,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637799709
    },
    {
        "content": "<p>Confirmed this is fixed, thank you <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 262662745,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1637809856
    }
]