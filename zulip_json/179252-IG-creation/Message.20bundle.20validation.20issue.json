[
    {
        "content": "<p>I have a bundle of type=\"message\", with a MessageHeader as the first entry in the bundle.  An example bundle in the IG is getting several of the following errors in qa.html:</p>\n<p>\"Entry isn't reachable by traversing from first Bundle entry\"</p>\n<p>Should that constraint be triggered for a message bundle?  Not sure how a MessageHeader could cause the other entries to be reachable?</p>",
        "id": 182079196,
        "sender_full_name": "Tim Blake",
        "timestamp": 1574911977
    },
    {
        "content": "<p>oh. this is the contexst</p>",
        "id": 182080249,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574913854
    },
    {
        "content": "<p>I thought we said this somewhere</p>",
        "id": 182080286,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574913950
    },
    {
        "content": "<p>Sorry, my bad</p>",
        "id": 182080287,
        "sender_full_name": "Tim Blake",
        "timestamp": 1574913951
    },
    {
        "content": "<p>well, I can't find it. <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> ?</p>",
        "id": 182080341,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574914005
    },
    {
        "content": "<p>The MessageHeader.focus should point to something and everything else should be linked by some path to that.</p>",
        "id": 182084109,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574920200
    },
    {
        "content": "<p>see this error #2.  the reverse link causes this error in my case:   <a href=\"#narrow/stream/179252-IG-creation/topic/link.20errors.20for.20uuids.20in.20a.20bundle/near/180897993\" title=\"#narrow/stream/179252-IG-creation/topic/link.20errors.20for.20uuids.20in.20a.20bundle/near/180897993\">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/link.20errors.20for.20uuids.20in.20a.20bundle/near/180897993</a></p>",
        "id": 182086597,
        "sender_full_name": "Eric Haas",
        "timestamp": 1574924237
    },
    {
        "content": "<p>It's possible that reverse links aren't well-handled by the code, though the algorithm <em>should</em> find them...</p>",
        "id": 182118764,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574956161
    },
    {
        "content": "<p>I'm getting \"Entry isn't reachable by traversing from first Bundle entry\" for all of the reverse links...</p>",
        "id": 182137781,
        "sender_full_name": "Tim Blake",
        "timestamp": 1574978033
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> </p>\n<blockquote>\n<p>The MessageHeader.focus should point to something and everything else should be linked by some path to that.</p>\n</blockquote>\n<p>I can't find this written anywhere?</p>",
        "id": 182144591,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574990427
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> this code must be wrong:</p>\n<div class=\"codehilite\"><pre><span></span>        <span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span> <span class=\"n\">references</span> <span class=\"o\">=</span> <span class=\"n\">findReferences</span><span class=\"o\">(</span><span class=\"n\">unusedResource</span><span class=\"o\">);</span>\n        <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">reference</span><span class=\"o\">:</span> <span class=\"n\">references</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n          <span class=\"k\">if</span> <span class=\"o\">(!</span><span class=\"n\">visitedResources</span><span class=\"o\">.</span><span class=\"na\">containsKey</span><span class=\"o\">(</span><span class=\"n\">reference</span><span class=\"o\">))</span> <span class=\"o\">{</span>\n            <span class=\"n\">visitedResources</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"n\">reference</span><span class=\"o\">,</span> <span class=\"n\">unusedResource</span><span class=\"o\">);</span>\n            <span class=\"n\">reverseLinksFound</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n          <span class=\"o\">}</span>\n        <span class=\"o\">}</span>\n</pre></div>",
        "id": 182144901,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574991033
    },
    {
        "content": "<p>if you find a reference in an unlinked resource.. then <em>if it doesn't point to a resource already linked</em>, call it a new link... surely the ! is wrong?</p>",
        "id": 182144914,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574991092
    },
    {
        "content": "<p>also, that code generally doesn't use the bundle resolution algorithm</p>",
        "id": 182144920,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574991122
    },
    {
        "content": "<p>I rewrote it from scratch</p>",
        "id": 182146117,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574993475
    },
    {
        "content": "<p>fixed next release</p>",
        "id": 182146171,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574993607
    },
    {
        "content": "<p>btw, issues related to message interlinking of resources are warnings until <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>can point to where in the spec it says that this isn't allowed</p>",
        "id": 182146214,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574993664
    },
    {
        "content": "<p>Thanks.  I can't find it in the spec either, nor understand the reason why this would always need to be the case...</p>",
        "id": 182147225,
        "sender_full_name": "Tim Blake",
        "timestamp": 1574995585
    },
    {
        "content": "<p>It makes no sense for a message to contain content that isn't linked (somehow) to the MessageHeader.  Sending content with no connection means the content has no meaning relating to the message event or to the message focus.  As well, the MessageDefinition resource provides two mechanisms for defining the content - profile (which allows you to trace only forward-path relationships) and GraphDefinition which allows you to trace both forward and reverse path references.  Both Document and MessageHeader start with a special resource and the remainder of the Bundle contains related resources.  Document has clear language requiring that.  I thought we'd approved a change request to add the same for messaging, but I can't find it.</p>",
        "id": 182148968,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574998733
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191802\">@Tim Blake</span> What's your use-case for sending unconnected content in the message?  What sort of event code are you using?  What is the focal resource for the message?</p>",
        "id": 182148979,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574998771
    },
    {
        "content": "<p>I don't have one in mind.  I was just wondering why this constraint exists?  Why does it matter if you can't reach every resource?</p>",
        "id": 182149041,
        "sender_full_name": "Tim Blake",
        "timestamp": 1574998874
    },
    {
        "content": "<p>If the resources aren't reachable, then they have no relevance to the message - at least as far as the recipient can tell...</p>",
        "id": 182149344,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574999513
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> I didn't ask for an explanation I asked where we said this</p>",
        "id": 182152488,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575005712
    },
    {
        "content": "<p>As far as I can tell, we don't.  Do you disagree that we should?  If we're in agreement, I'll submit a tracker item</p>",
        "id": 182181781,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575037693
    },
    {
        "content": "<p>The closest thing to this requirement being mentioned is in the definition and comments to MedsageHeader.focus. I agree that's not sufficient, and needs to be made explicit.</p>",
        "id": 182183106,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1575038802
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/messageheader-definitions.html#MessageHeader.focus\" target=\"_blank\" title=\"http://build.fhir.org/messageheader-definitions.html#MessageHeader.focus\">http://build.fhir.org/messageheader-definitions.html#MessageHeader.focus</a></p>",
        "id": 182183154,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1575038854
    },
    {
        "content": "<p>we should certainly have a task. I'm less persauded it should be a rule. A FHIR equivalent of a records management message for instance  - why should it have to reference every resource in the .focus?</p>",
        "id": 182193705,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575049001
    },
    {
        "content": "<p>It is not that you reference every resource in .focus, quite the opposite - more than one reference in .focus is only for special messages like merge.</p>\n<p>The \"rule\" is that, starting from .focus, you can (indirectly) reach every resource in the message bundle.</p>",
        "id": 182194007,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1575049240
    },
    {
        "content": "<p>so you would need a lit to list all the resources in a ,say , Master Files message? just because we wanted to make this rule? Or in a query response message? I think that is not a value proposition.</p>\n<p>OTOH, I firmly agree that dropping random unlinked and undescribed resources into a message is a bad thing. But I think it depends on the event</p>",
        "id": 182194439,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575049685
    },
    {
        "content": "<p>If you have a MasterFiles message, then yes, the MessageHeader would point to each of the providers or ObservationDefinitions that are included.  (Because there may be some situations where Practitioners are included in the message that aren't \"focuses\" of the event but are included for other reasons.)  Traversing the relationships or being pointed to by 'focus' is the only way you know how to interpret a particular instance in the message.</p>",
        "id": 182195483,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575050784
    },
    {
        "content": "<blockquote>\n<p>the MessageHeader would point to each of the providers</p>\n</blockquote>\n<p>Doesn't seem like a value proposition to me. A master files message only containing practitioner resources to update?</p>",
        "id": 182195546,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575050868
    },
    {
        "content": "<p><a href=\"http://jira.hl7.org/browse/FHIR-25257\" target=\"_blank\" title=\"http://jira.hl7.org/browse/FHIR-25257\">J#25257</a></p>",
        "id": 182195653,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575050989
    },
    {
        "content": "<p>The value proposition is clarity about what's happening.  You can't know that the only content in the message will be practitioners that are the focus of the update - there could be practitioners they're being linked to or that are authoring the change, etc.</p>",
        "id": 182195736,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575051043
    },
    {
        "content": "<p>All meaning in FHIR comes from relationships.  If you don't have relationships, you have no idea what's going on.</p>",
        "id": 182195753,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575051079
    },
    {
        "content": "<p>it depends on the definition of the event. I think that we have to consider that in the rule</p>",
        "id": 182195764,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575051094
    },
    {
        "content": "<p>Furthermore, there's no capability to define the content if it's not connected.  MessageDefinition can't handle that.</p>",
        "id": 182195773,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575051116
    },
    {
        "content": "<p>FWIW, the V2 master file messages have an MFI segment to identify what \"Master File\" is being updated, and MFE segments to contain the records for the master file that are changed. The specific purpose v2 messages have even more complicated structure, which leads me to think that a FHIR Master File  message will be unlikely to just have a header and 1..n resource[T] as the entries in the bundle. List, or something else will be present.</p>",
        "id": 182196096,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1575051520
    },
    {
        "content": "<p>I'm may be off on a tangent but I thought the purpose of graph in MessageDefinition was to define the message (response) content? Even if the GraphDefinition only contains 'nodes', it could still define profiles and cardinality.</p>",
        "id": 182225056,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1575094043
    },
    {
        "content": "<p>The point is that in GraphDefinition, everything has to be connected.  There's no mechanism to specify non-connected nodes</p>",
        "id": 182289825,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575215461
    },
    {
        "content": "<p>should there be? But that's a different question</p>",
        "id": 182295575,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575225756
    },
    {
        "content": "<p>We had approved a tracker to this in FHIR-I a few weeks back...</p>\n<p><a href=\"https://jira.hl7.org/browse/FHIR-23722\" target=\"_blank\" title=\"https://jira.hl7.org/browse/FHIR-23722\">https://jira.hl7.org/browse/FHIR-23722</a></p>",
        "id": 182305901,
        "sender_full_name": "Eric Haas",
        "timestamp": 1575244402
    },
    {
        "content": "<p>ok I will make it an error in R5, not a warning</p>",
        "id": 182306237,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575244931
    }
]