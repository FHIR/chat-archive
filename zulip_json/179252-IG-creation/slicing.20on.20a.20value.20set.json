[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>  Can you tell me how to slice on a value set or a binding? Can I do that in a pattern? Do I need to use a pattern to do that? Right now it appears I have to re-list the codes contained in the value set in a patternCodeableConcept for example.</p>",
        "id": 159329147,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1551092749
    },
    {
        "content": "<p>Slice by value.  When you slice by value, the process checks for either a fixed value or a fixed value set binding on the discriminator</p>",
        "id": 159349713,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551111513
    },
    {
        "content": "<blockquote>\n<p>Slice by value.  When you slice by value, the process checks for either a fixed value or a fixed value set binding on the discriminator</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <br>\nSo is this correct way to slice on system and value set?</p>\n<p><code>    &lt;element id=\"Device.property\"&gt;\n      &lt;path value=\"Device.property\" /&gt;\n      &lt;slicing&gt;\n        &lt;!-- The type.system and the type of value (code or quantity) are needed to distinguish entrants. The BITs properties\n        (time capabilities and regulation status) will have a fixed system ASN1-url with a coded value. The remaining entrants\n        will have the same fixed 10101-url with either a single-coded, multiple-coded, or quantity entry. --&gt;\n        &lt;discriminator&gt;\n          &lt;type value=\"value\" /&gt;\n &lt;!-- system being used in value set value set --&gt;\n          &lt;path value=\"system\" /&gt;\n        &lt;/discriminator&gt;\n        &lt;discriminator&gt;\n          &lt;type value=\"value\" /&gt;\n &lt;!-- codes specified by value set --&gt;\n          &lt;path value=\"code\" /&gt;\n        &lt;/discriminator&gt;\n        &lt;rules value=\"open\" /&gt;\n      &lt;/slicing&gt;\n    &lt;/element&gt;\n    &lt;element id=\"Device.property:quantitiesProperty\"&gt;\n      &lt;path value=\"Device.property\" /&gt;\n      &lt;sliceName value=\"quantitiesProperty\" /&gt;\n      &lt;short value=\"The device properties represented by quantities such as clock resolution\" /&gt;\n      &lt;definition value=\"This element represents all those time properties that are a quantity such as the various clock resolutions and synchronization accuracy.\" /&gt;\n      &lt;comment value=\"If the PHD reports that one of these given properties are unknown, this element shall not be populated for that property.\" /&gt;\n    &lt;/element&gt;\n    &lt;element id=\"Device.property:quantitiesProperty.type\"&gt;\n      &lt;path value=\"Device.property.type\" /&gt;\n      &lt;short value=\"The type of time quantity\" /&gt;\n      &lt;binding&gt; \n        &lt;strength value=\"required\"/&gt;\n        &lt;!-- These are the codes that identify this Quantities property --&gt;\n        &lt;valueSet value=\"http://hl7.org/fhir/uv/phd/ValueSet/Quantity11073MDC\"/&gt; \n      &lt;/binding&gt;\n    &lt;/element&gt;\n    &lt;element id=\"Device.property:quantitiesProperty.type.text\"&gt;\n      &lt;path value=\"Device.property.type.text\" /&gt;\n      &lt;definition value=\"It is recommended to display at least the MDC reference identifier for the MDC code\" /&gt;\n    &lt;/element&gt;\n    &lt;!-- Slice the coding to allow one to express the same concept in another coding system --&gt;\n    &lt;element id=\"Device.property:quantitiesProperty.type.coding\"&gt;\n      &lt;path value=\"Device.property.type.coding\" /&gt;\n      &lt;slicing&gt;\n        &lt;discriminator&gt;\n          &lt;type value=\"value\" /&gt;\n          &lt;path value=\"system\" /&gt;\n        &lt;/discriminator&gt;\n        &lt;rules value=\"open\" /&gt;\n      &lt;/slicing&gt;\n      &lt;min value=\"1\" /&gt;\n    &lt;/element&gt;\n    &lt;element id=\"Device.property:quantitiesProperty.type.coding:MDCType\"&gt;\n      &lt;path value=\"Device.property.type.coding\" /&gt;\n      &lt;sliceName value=\"MDCType\" /&gt;\n      &lt;short value=\"The 11073-10101 MDC code for the type\" /&gt;\n      &lt;min value=\"1\" /&gt;\n      &lt;max value=\"1\" /&gt;\n    &lt;/element&gt;\n    &lt;!-- The system value is fixed --&gt;\n    &lt;element id=\"Device.property:quantitiesProperty.type.coding:MDCType.system\"&gt;\n      &lt;path value=\"Device.property.type.coding.system\" /&gt;\n      &lt;min value=\"1\" /&gt;\n      &lt;fixedUri value=\"urn:iso:std:iso:11073:10101\" /&gt;\n    &lt;/element&gt;\n    &lt;!-- These code shall be from the value set --&gt;\n    &lt;element id=\"Device.property:quantitiesProperty.type.coding:MDCType.code\"&gt;\n      &lt;path value=\"Device.property.type.coding.code\" /&gt;\n      &lt;definition value=\"The MDC code representing the property\" /&gt;\n      &lt;min value=\"1\" /&gt;\n    &lt;/element&gt;</code></p>",
        "id": 159350859,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1551112322
    },
    {
        "content": "<p>The discriminator should be the CodeableConcept element or possibly a coding, not the individual system and code as the value set always deals with the combination</p>",
        "id": 159351528,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551112801
    },
    {
        "content": "<blockquote>\n<p>The discriminator should be the CodeableConcept element or possibly a coding, not the individual system and code as the value set always deals with the combination</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <br>\n Oh yes, that was carelessness on my quick creation of the descriminators - <strong>and the binding is in the 'type' element</strong><br>\nIt should be like this:<br>\n<code>      &lt;slicing&gt;\n        &lt;discriminator&gt;\n          &lt;type value=\"value\" /&gt;\n &lt;!-- system being used in value set value set --&gt;\n          &lt;path value=\"type.coding.system\" /&gt;\n        &lt;/discriminator&gt;\n        &lt;discriminator&gt;\n          &lt;type value=\"value\" /&gt;\n &lt;!-- codes specified by value set --&gt;\n          &lt;path value=\"type.coding.code\" /&gt;\n        &lt;/discriminator&gt;\n        &lt;rules value=\"open\" /&gt;\n      &lt;/slicing&gt;</code></p>",
        "id": 159351736,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1551112953
    },
    {
        "content": "<p>I'd expect it to be this:<br>\n    &lt;slicing&gt;<br>\n      &lt;discriminator&gt;<br>\n        &lt;type value=\"value\"/&gt;<br>\n        &lt;path value=\"type\"/&gt;<br>\n      &lt;/discriminator&gt;<br>\n    &lt;/slicing&gt;</p>",
        "id": 159353939,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551114653
    },
    {
        "content": "<p>If you're slicing by value set, no reason to reach inside to .coding or .system/.code</p>",
        "id": 159353974,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551114678
    },
    {
        "content": "<blockquote>\n<p>I'd expect it to be this:<br>\n    &lt;slicing&gt;<br>\n      &lt;discriminator&gt;<br>\n        &lt;type value=\"value\"/&gt;<br>\n        &lt;path value=\"type\"/&gt;<br>\n      &lt;/discriminator&gt;<br>\n    &lt;/slicing&gt;</p>\n</blockquote>\n<p>Hmm... That's what I had to start with ... and the validator is complaining. I must have something else sick then.</p>",
        "id": 159354088,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1551114762
    },
    {
        "content": "<p>You have fixed value sets declared on the \"type\" elements in your slices?</p>",
        "id": 159354369,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551114981
    },
    {
        "content": "<blockquote>\n<p>You have fixed value sets declared on the \"type\" elements in your slices?</p>\n</blockquote>\n<p>I believe so: I have this on the first slice:<br>\n<code>    &lt;element id=\"Device.property:bitProperties\"&gt;\n      &lt;path value=\"Device.property\" /&gt;\n      &lt;sliceName value=\"bitProperties\" /&gt;\n      &lt;short value=\"Properties reported in BITs fields\" /&gt;\n      &lt;definition value=\"For each bit setting reported a BITs value, a bitProperties element is used.\" /&gt;\n      &lt;comment value=\"A BITs measurement is a 16 or 32-bit ASN1 BITs value where each bit means something. \" /&gt;\n    &lt;/element&gt;\n    &lt;!-- The bitProperties type: It will contain at least one coding element using the ASN1 system with one of\n    the ASN1 codes. Currently the MdsTimeInfo capabilities and RegCertDataList regulation status are reported as BITS  --&gt;\n    &lt;element id=\"Device.property:bitProperties.type\"&gt;\n      &lt;path value=\"Device.property.type\" /&gt;\n      &lt;short value=\"Tells what the BITs item is\" /&gt;\n      &lt;definition value=\"One of the capabilities reported in the Mds-Time-Info.mds-time-caps-state or Reg-Cert-Data-List.regulation-status field.\" /&gt;\n      &lt;comment value=\"Only set 'event' types need be reported. Both set and cleared 'state' types need to be reported. The regulation status is as state type. All time capabilities are event types\" /&gt;\n      &lt;binding&gt; \n        &lt;strength value=\"required\"/&gt; \n        &lt;valueSet value=\"http://hl7.org/fhir/uv/phd/ValueSet/ASN1attribute\"/&gt; \n      &lt;/binding&gt;\n    &lt;/element&gt;</code></p>",
        "id": 159354508,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1551115098
    },
    {
        "content": "<p>That looks right.  What error are you getting?</p>",
        "id": 159354651,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551115220
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> We (IPS) got errors with this approach (multiple variations of it), too.  The issue that I see is that this isn't slicing by value.  There is no value in the instance itself that can be used to discriminate and validate that the chosen code came from a particular value set - that is not (normally) carried in the instance.  And I don't understand what the syntax '&lt;path value=\"type\"/&gt;' would actually by trying to say (and I'm pretty sure I haven't seen it documented).</p>",
        "id": 159355081,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1551115619
    },
    {
        "content": "<p>The validator will check the instance against all of the slices, checking the value set.  If only one matches, you're good.  If more than one matches, it'll raise an error</p>",
        "id": 159355279,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551115829
    },
    {
        "content": "<p>I know that's what it is intended to do.  That was the premise we started working on but we weren't able to get it to work.  So far I haven't seen an example where it actually does work for validating instance data.  Can you share or point to an example that does work?</p>",
        "id": 159355704,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1551116218
    },
    {
        "content": "<blockquote>\n<p>That looks right.  What error are you getting?</p>\n</blockquote>\n<p>The error (well warning) is </p>\n<p><code>Device/phg-ecde3d4e58532d31.000000000000: Device.property[1]: This element does not match any known slice for the profile http://hl7.org/fhir/uv/phd/StructureDefinition/PhgDevice</code></p>\n<p>I get this warning for every property element in the Device resource for all my Device resources; well, slight variations of course but the idea is the same.</p>",
        "id": 159385219,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1551139950
    },
    {
        "content": "<p>The code system and value set are both defined within the IG?  May need to run that through the IG publisher in debug mode to see what's going on.  (Unfortunately that's unlikely to happen until the end of the week.)  Where is your stuff committed again?</p>",
        "id": 159396484,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551154207
    },
    {
        "content": "<blockquote>\n<p>The code system and value set are both defined within the IG?  May need to run that through the IG publisher in debug mode to see what's going on.  (Unfortunately that's unlikely to happen until the end of the week.)  Where is your stuff committed again?</p>\n</blockquote>\n<p>Yes, the value sets are defined in the IG and contain subsets of the MDC code system and the codes are listed in the value sets. Location <a href=\"https://github.com/HL7/PHD\" target=\"_blank\" title=\"https://github.com/HL7/PHD\">https://github.com/HL7/PHD</a></p>",
        "id": 159410995,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1551173768
    },
    {
        "content": "<p>Yes, that's what we see, as well.  It's not much consolation that it's a warning rather than an error, because it's indicating that it doesn't actually work.</p>",
        "id": 159435574,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1551197541
    },
    {
        "content": "<blockquote>\n<p>Yes, that's what we see, as well.  It's not much consolation that it's a warning rather than an error, because it's indicating that it doesn't actually work.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  Any idea why that is happening?</p>",
        "id": 159435617,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1551197593
    },
    {
        "content": "<p>Not yet :(</p>",
        "id": 159436260,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1551198075
    },
    {
        "content": "<p>do we have a test case for this?</p>",
        "id": 159862511,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1551643299
    }
]