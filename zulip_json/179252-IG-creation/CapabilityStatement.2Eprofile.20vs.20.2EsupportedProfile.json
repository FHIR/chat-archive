[
    {
        "content": "<p>I am trying to include the following in an IG:</p>\n<ul>\n<li>an IG-defined, quite general profile on Observation</li>\n<li>the core spec vital signs profile on Observation (which satisfies all the requirements of the IG-defined profile)<br>\nIt looks like within a capability statement, there can be only one entry for each type of resource, so I can't simply add two independent entries of type Observation. I have added one entry of type observation that contains:</li>\n</ul>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"nt\">\"type\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"Observation\"</span><span class=\"p\">,</span>\n<span class=\"nt\">\"profile\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"http://hl7.org/fhir/uv/ipa/StructureDefinition/ipa-observation\"</span><span class=\"p\">,</span>\n<span class=\"nt\">\"supportedProfile\"</span> <span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"s2\">\"http://hl7.org/fhir/StructureDefinition/vitalsigns\"</span>\n          <span class=\"p\">],</span>\n<span class=\"nt\">\"_supportedProfile\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"p\">{</span>\n              <span class=\"nt\">\"extension\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"p\">{</span>\n                  <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://hl7.org/fhir/StructureDefinition/capabilitystatement-expectation\"</span><span class=\"p\">,</span>\n                  <span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span> <span class=\"s2\">\"SHALL\"</span>\n                <span class=\"p\">}</span>\n              <span class=\"p\">]</span>\n            <span class=\"p\">}</span>\n         <span class=\"p\">],</span>\n</code></pre></div>\n<p>The IG publisher has no issues with it, but there is no indication in the (locally) generated content that the \"supported profile\" is part of the implementation guide. Is there something I need to add for the publisher to add a note and a link to the core profile of vital signs? </p>\n<p>Possibly related: In US Core, I see an extensive XHTML block in CapabilityStatement.text, but with the designation \"derived\". Is there a tool to generate such a block, or is it strictly a manual process?</p>",
        "id": 261304370,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1636747610
    },
    {
        "content": "<p>the CapabilityStatement is ignoring the supportedProfile, yes. I can - and should - update so it shows the supported profiles. </p>\n<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> does have a tool to generate narrative, and I presume that's what you're talking about. You can use that, though in general it's better if we can work to make the default presentation the right one</p>",
        "id": 261305024,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636748009
    },
    {
        "content": "<p>If I created a narrative, is that what will show for the capability statement? I could take the default presentation, and place it in .text with the addition of the external profile (until the default presentation is enhanced).</p>",
        "id": 261305569,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1636748303
    },
    {
        "content": "<blockquote>\n<p>@Eric Haas does have a tool to generate narrative, and I presume that's what you're talking about. You can use that, though in general it's better if we can work to make the default presentation the right one</p>\n</blockquote>\n<p>I looked at doing this in liquid it is too hard.    I would be very loathe to give it up my generation tool.</p>",
        "id": 261310081,
        "sender_full_name": "Eric Haas",
        "timestamp": 1636750899
    },
    {
        "content": "<p>I too created a narrative for my CapabilityStatement and put it in the text.  It was quite long and the narrative shows up in two places in the guide so I'm not sure I'm going to keep it.</p>",
        "id": 261311838,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1636751841
    },
    {
        "content": "<p>Not far along enough to post yet, but it was frustrating enough for me that I'm building some tooling to help with this  =).</p>",
        "id": 261313346,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1636752639
    },
    {
        "content": "<p>you know, all of you, you can propose improvements in the default rendering instead of just doing your own thing</p>",
        "id": 261317483,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636754782
    },
    {
        "content": "<blockquote>\n<p>If I created a narrative, is that what will show for the capability statement? I could take the default presentation, and place it in .text with the addition of the external profile</p>\n</blockquote>",
        "id": 261317524,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636754812
    },
    {
        "content": "<p>yes you can do that</p>",
        "id": 261317531,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636754818
    },
    {
        "content": "<p>maybe I should take it away so that people actually contribute to the default rendering instead of doing their own thing and not helping everyone else</p>",
        "id": 261317566,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636754846
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/CapabilityStatement.2Eprofile.20vs.20.2EsupportedProfile/near/261317483\">said</a>:</p>\n<blockquote>\n<p>you know, all of you, you can propose improvements in the default rendering instead of just doing your own thing</p>\n</blockquote>\n<p>Yes, but I'm not trying to just fix the rendering.  I found the process of hand-writing Capability Statements (and tagging <em>every</em> element with a conformance level) too tedious to actually do.</p>\n<p>I'm building an light app to load an IG (already run through publisher) that lets you select what goes into the CapStatment.  I was going to build the narrative in it too, since the goal is to output JSON or FSH that you can re-insert into the IG.</p>\n<p>I'd be happy to push back the format for narrative once I've settled on something - but I have no idea where that lives today (Java code?).</p>",
        "id": 261319526,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1636756017
    },
    {
        "content": "<p><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/renderers/CapabilityStatementRenderer.java\">https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/renderers/CapabilityStatementRenderer.java</a></p>",
        "id": 261319797,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636756265
    },
    {
        "content": "<p>Cool.  I'll have to burn that bridge when I get to it, since I don't have a Java dev env set up.  But saved the link and added to my list (need to finish the UI to build the cap statement first, since I'm still not doing that by hand).</p>",
        "id": 261319972,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1636756407
    },
    {
        "content": "<p>I understand your concern.  In my case, I added a ton of text that no renderer could possibly know about.  I'm not sure where that text would go since it is purely about providing a non-technical person an understanding of the capabilities that the statement is asserting via its data elements.</p>",
        "id": 261327476,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1636762281
    },
    {
        "content": "<p>than you're in manual space for sure. And I don't mind people doing whatever in their tooling, it's just frustrating if that means we don't continue to iterate to improve the default</p>",
        "id": 261327639,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1636762498
    },
    {
        "content": "<blockquote>\n<p>you can propose improvements in the default rendering instead of just doing your own thing</p>\n</blockquote>\n<p>I tried to add supportedProfile (see diff), but that broke validation somehow. Should I just create an issue, or is there a simple extra step I need to address?</p>\n<div class=\"codehilite\" data-code-language=\"Darcs Patch\"><pre><span></span><code><span class=\"gd\">--- a/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/renderers/CapabilityStatementRenderer.java</span>\n<span class=\"gi\">+++ b/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/renderers/CapabilityStatementRenderer.java</span>\n@@ -14,6 +14,7 @@ import org.hl7.fhir.r5.model.CapabilityStatement.ResourceInteractionComponent;\n import org.hl7.fhir.r5.model.CapabilityStatement.SystemInteractionComponent;\n import org.hl7.fhir.r5.model.CapabilityStatement.SystemRestfulInteraction;\n import org.hl7.fhir.r5.model.CapabilityStatement.TypeRestfulInteraction;\n<span class=\"gi\">+import org.hl7.fhir.r5.model.CanonicalType;</span>\n import org.hl7.fhir.r5.renderers.utils.RenderingContext;\n import org.hl7.fhir.r5.renderers.utils.BaseWrappers.ResourceWrapper;\n import org.hl7.fhir.r5.renderers.utils.Resolver.ResourceContext;\n@@ -82,8 +83,27 @@ public class CapabilityStatementRenderer extends ResourceRenderer {\n       for (CapabilityStatementRestResourceComponent r : rest.getResource()) {\n         tr = t.tr();\n         tr.td().addText(r.getType());\n<span class=\"gd\">-        if (r.hasProfile()) {</span>\n<span class=\"gd\">-          tr.td().ah(r.getProfile()).addText(r.getProfile());</span>\n<span class=\"gi\">+        if (r.hasProfile() &amp;&amp; r.hasSupportedProfile()) {</span>\n<span class=\"gi\">+          XhtmlNode profileNode = tr.td().ah(r.getProfile()).addText(r.getProfile());</span>\n<span class=\"gi\">+          for (CanonicalType sp: r.getSupportedProfile()) {</span>\n<span class=\"gi\">+            profileNode.br();</span>\n<span class=\"gi\">+            profileNode.nbsp().nbsp();</span>\n<span class=\"gi\">+            profileNode.ah(sp.getValue()).addText(sp.getValue());</span>\n<span class=\"gi\">+          }</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+          if (r.hasSupportedProfile()) {</span>\n<span class=\"gi\">+</span>\n<span class=\"gi\">+          }</span>\n<span class=\"gi\">+        }</span>\n<span class=\"gi\">+        if (!r.hasProfile() &amp;&amp; r.hasSupportedProfile()) {</span>\n<span class=\"gi\">+          boolean first = true;</span>\n<span class=\"gi\">+          XhtmlNode profileNode = tr.td();</span>\n<span class=\"gi\">+          for (CanonicalType sp: r.getSupportedProfile()) {</span>\n<span class=\"gi\">+              if (!first) {</span>\n<span class=\"gi\">+                profileNode.br();</span>\n<span class=\"gi\">+              }</span>\n<span class=\"gi\">+              profileNode.ah(sp.getValue()).addText(sp.getValue());</span>\n<span class=\"gi\">+          }</span>\n         }\n         tr.td().addText(showOp(r, TypeRestfulInteraction.READ));\n         if (hasVRead)\n</code></pre></div>",
        "id": 261538271,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1637000523
    },
    {
        "content": "<p>this doesn't show any difference between the two kids of profile? And how many supported profiles before this starts to be a problem?</p>",
        "id": 261547655,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637004919
    },
    {
        "content": "<p>And how did it break validation somehow?</p>",
        "id": 261547677,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637004931
    },
    {
        "content": "<p>I got \"Test Failed\" for validation, but when I ran <code>maven clean install</code> there were no failed tests. Created an issue and PR is running checks right now.</p>\n<blockquote>\n<p>this doesn't show any difference between the two kinds of profile? And how many supported profiles before this starts to be a problem?</p>\n</blockquote>\n<p>If there are both .profile and .supportedProfile, it would look something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>+-------------+-----------------------------\n| Observation | &lt;.profile URL&gt;\n|             |   &lt;.supportedProfile URL 1&gt;\n|             |   &lt;.supportedProfile URL 2&gt;\n|             |   ...\n</code></pre></div>\n<p>In the cases when there are only .supportedProfile entries, and no .profile (like US Core), it will just list them, with no indentation.</p>",
        "id": 261550779,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1637006388
    },
    {
        "content": "<p>I think that's too subtle. I think that there should be separate table cells for profile and supported profile, so that people are clear. They're very different things. And I note that there's a bug around the profile cell - heading and cell don't line up on being shown</p>",
        "id": 261552613,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637007234
    },
    {
        "content": "<p>Are you suggesting something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>+-------------+------------------------------+------------------------------\n| Resource    | Profile                      |  Supported Profile\n+-------------+------------------------------+------------------------------\n</code></pre></div>\n<p>I think that will make the table too wide. Maybe still one cell, but more obvious, like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>+-------------+-----------------------------\n| Observation | &lt;.profile URL&gt;\n|             | Additional supported profiles:\n|             |   &lt;.supportedProfile URL 1&gt;\n|             |   &lt;.supportedProfile URL 2&gt;\n|             |   ...\n</code></pre></div>\n<p>and for the cases where there are only .supportedProfile entries:</p>\n<div class=\"codehilite\"><pre><span></span><code>+-------------+-----------------------------\n| Observation | Supported profiles:\n|             |   &lt;.supportedProfile URL 1&gt;\n|             |   &lt;.supportedProfile URL 2&gt;\n|             |   ...\n</code></pre></div>",
        "id": 261555120,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1637008358
    },
    {
        "content": "<p>ok that makes sense</p>",
        "id": 261555165,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637008385
    },
    {
        "content": "<p>The PR checks tell me I need to add tests for the code changes, any hint what types of tests I need to add?</p>",
        "id": 261555702,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1637008693
    },
    {
        "content": "<p>because code coverage failed? That's advisory, something we're chipping away at over time. And there's no tests covering this part of the code yet, and so it's too big a lift. I mean, you can if you want - that would be in <a href=\"https://github.com/FHIR/fhir-test-cases/tree/master/r5/narrative\">https://github.com/FHIR/fhir-test-cases/tree/master/r5/narrative</a> but I wouldn't (and I'll approve the PR without it)</p>",
        "id": 261555904,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637008814
    },
    {
        "content": "<blockquote>\n<p>Grahame Grieve: you know, all of you, you can propose improvements in the default rendering instead of just doing your own thing</p>\n</blockquote>\n<p>I'd maybe \"hear\" the various efforts here <em>as</em> proposals for improvements (indeed, the best kind: specific proposals where the details have been worked through)</p>",
        "id": 261561970,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1637011803
    },
    {
        "content": "<p>well, I tried, but in practice, what happens is people make their own thing, and never bring any discussion forward, and so it doesn't turn into actual proposals. This one has turned into a very concrete proposal..</p>",
        "id": 261562271,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637011940
    },
    {
        "content": "<p><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/pull/661\">PR #661</a> is running checks...</p>",
        "id": 261565118,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1637013331
    }
]