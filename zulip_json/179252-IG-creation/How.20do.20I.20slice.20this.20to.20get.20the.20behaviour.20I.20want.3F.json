[
    {
        "content": "<p>I'm trying to slice my Questionnaire.items to specify constraints on different types of items.  I have constraints on the following \"types\" of questions that I want to make: Single Line, TextArea, DateTime, RadioGroup, Checkboxes, Dropdowns, Slider, Integer Text.  I put \"types\" because some of these have the same item.type and I use the itemControl extension to differentiate (i.e RadioGroup, Checkboxes, Dropdowns are all type=choice with different itemControl codes).</p>\n<p>I wasn't sure how to make a single slice with a discriminator of type + extension(itemControl).value because not every slice would have the extension.  Right now, I have an initial slice on type to get SingleLine, TextArea, DateTime, Choices, Integers.  I then further slice Choices and Integers on extension(itemControl).value to get the different types of choices and integers.</p>\n<p>That gets me the following in my SD:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Questionnaire.item&quot;,\n        &quot;path&quot;: &quot;Questionnaire.item&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;value&quot;,\n              &quot;path&quot;: &quot;type&quot;\n            }\n          ],\n          &quot;rules&quot;: &quot;closed&quot;,\n          &quot;description&quot;: &quot;Slice based on type to restrict the different types of answers allowed.&quot;\n        },\n        &quot;mustSupport&quot;: true\n      }\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Questionnaire.item:Choices&quot;,\n        &quot;path&quot;: &quot;Questionnaire.item&quot;,\n        &quot;sliceName&quot;: &quot;Choices&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;value&quot;,\n              &quot;path&quot;: &quot;extension(&#39;http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl&#39;).value&quot;\n            }\n          ],\n          &quot;rules&quot;: &quot;closed&quot;,\n          &quot;description&quot;: &quot;Slice based on type to restrict the different types of answers allowed.&quot;\n        },\n        &quot;min&quot;: 0,\n        &quot;max&quot;: &quot;*&quot;\n      },\n</code></pre></div>\n<p>That seems to me that it should give me the behaviour that I want but I'm getting validation errors that don't make sense.  With the following item:</p>\n<div class=\"codehilite\"><pre><span></span><code>            {\n              &quot;extension&quot;: [\n                {\n                  &quot;url&quot;: &quot;http://hl7.org/fhir/us/icsr-ae-reporting/StructureDefinition/extension-itemTitle&quot;,\n                  &quot;valueString&quot;: &quot;Single Line Text&quot;\n                },\n                {\n                  &quot;url&quot;: &quot;http://hl7.org/fhir/us/icsr-ae-reporting/StructureDefinition/extension-itemSASVariableName&quot;,\n                  &quot;valueString&quot;: &quot;SLT&quot;\n                },\n                {\n                  &quot;url&quot;: &quot;http://hl7.org/fhir/us/icsr-ae-reporting/StructureDefinition/extension-itemRequiredText&quot;,\n                  &quot;valueMarkdown&quot;: &quot;Please answer this&quot;\n                },\n              &quot;type&quot;: &quot;string&quot;,\n              &quot;linkId&quot;: &quot;d635f126-e754-3f5b-2cff-f713a3b2e42d&quot;,\n              &quot;required&quot;: true,\n              &quot;text&quot;: &quot;Enter some text&quot;,\n              &quot;initial&quot;: [\n                {\n                  &quot;valueString&quot;: &quot;placeholder text&quot;\n                }\n              ]\n            },\n</code></pre></div>\n<p>I'm getting these errors:</p>\n<div class=\"codehilite\"><pre><span></span><code>  Error @ Bundle.entry[1].resource.ofType(Questionnaire).item[0] (line 67, col11) : Profile http://hl7.org/fhir/us/icsr-ae-reporting/StructureDefinition/ibm-fda-shape-questionnaire, Element matches more than one slice - SingleLine, Choices/Checkbox\n  Error @ Bundle.entry[1].resource.ofType(Questionnaire).item[0] (line 67, col11) : Profile http://hl7.org/fhir/us/icsr-ae-reporting/StructureDefinition/ibm-fda-shape-questionnaire, Element matches more than one slice - SingleLine, Choices/Dropdown\n  Error @ Bundle.entry[1].resource.ofType(Questionnaire).item[0] (line 67, col11) : Profile http://hl7.org/fhir/us/icsr-ae-reporting/StructureDefinition/ibm-fda-shape-questionnaire, Element matches more than one slice - SingleLine, Choices/RadioGroup\n  Error @ Bundle.entry[1].resource.ofType(Questionnaire).item[0] (line 67, col11) : Profile http://hl7.org/fhir/us/icsr-ae-reporting/StructureDefinition/ibm-fda-shape-questionnaire, Element matches more than one slice - SingleLine, Integers/Range\n  Error @ Bundle.entry[1].resource.ofType(Questionnaire).item[0] (line 67, col11) : Profile http://hl7.org/fhir/us/icsr-ae-reporting/StructureDefinition/ibm-fda-shape-questionnaire, Element matches more than one slice - SingleLine, Integers/Slider\n</code></pre></div>\n<p>And I'm getting similar errors on my other items.</p>",
        "id": 219422429,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1607563141
    },
    {
        "content": "<p>I'll have to debug this. Is this for ballot?</p>",
        "id": 219422824,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607563576
    },
    {
        "content": "<p>nope.</p>",
        "id": 219422832,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1607563588
    },
    {
        "content": "<p>i'm adding it to an HL7 guide of mine so that you can take a look if you want.</p>",
        "id": 219422839,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1607563603
    },
    {
        "content": "<p>I'll look next week</p>",
        "id": 219422868,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607563649
    },
    {
        "content": "<p>what?  you're not going to drop everything to solve my problem?!?  how dare you!  :)</p>\n<p>I was actually hoping that someone less busier than you could help me and tell me what I'm obviously doing wrong ;)</p>",
        "id": 219422942,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1607563703
    },
    {
        "content": "<p>element.slicing should only be for the root element, all the element definitions for the individual slices should have fixedCode or something similar right?<br>\nit looks like from your excerpts that you have a slicing definition in both the root element (Questionnaire.item) and the slice (Questionnaire.item:Choices) but no actual definition of any particular slice</p>\n<p>But do you want a discriminator that can define a slice based on the combination of questionnaire.item.value and questionnaire.item.extension(itemControl).value? if so my only thought is using patternBackboneElement but I have no idea if you can do that..</p>",
        "id": 219424145,
        "sender_full_name": "ryan moehrke",
        "timestamp": 1607565019
    },
    {
        "content": "<p>You can check out my ICSR guide - fhir-icsr-ae-reporting - to see what I'm trying to do.</p>",
        "id": 219430327,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1607573500
    }
]