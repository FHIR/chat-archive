[
    {
        "content": "<p>I'm getting QA errors with type slicing in <a href=\"https://github.com/devices-on-fhir/PoCD-IG/blob/master/resources/StructureDefinition-NumericObservation.xml\" target=\"_blank\" title=\"https://github.com/devices-on-fhir/PoCD-IG/blob/master/resources/StructureDefinition-NumericObservation.xml\">this</a> profile, which restricts Observation.value[x] to valueQuantity or valueRatio and makes constraints on each of them. Here is the relevant part of StructureDefinition.differential:</p>\n<div class=\"codehilite\"><pre><span></span>    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x]&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;slicing&gt;</span>\n        <span class=\"nt\">&lt;discriminator&gt;</span>\n          <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;type&quot;</span><span class=\"nt\">/&gt;</span>\n          <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;$this&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/discriminator&gt;</span>\n        <span class=\"nt\">&lt;rules</span> <span class=\"na\">value=</span><span class=\"s\">&quot;open&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/slicing&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;0&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Quantity&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Ratio&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;condition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;pocd-obs-1&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueQuantity&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueQuantity&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;valueQuantity&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Quantity&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueQuantity.value&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueQuantity.value&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueQuantity.system&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueQuantity.system&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;fixedUri</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://unitsofmeasure.org&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueRatio&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueRatio&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;valueRatio&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Ratio&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueRatio.numerator&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueRatio.numerator&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueRatio.numerator.value&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueRatio.numerator.value&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueRatio.numerator.system&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueRatio.numerator.system&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;fixedUri</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://unitsofmeasure.org&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueRatio.denominator&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueRatio.denominator&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueRatio.denominator.value&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueRatio.denominator.value&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:valueRatio.denominator.system&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.valueRatio.denominator.system&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;fixedUri</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://unitsofmeasure.org&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>\n\n\n<p><a href=\"https://github.com/devices-on-fhir/PoCD-IG/blob/master/examples/HeartRateNumericObservation.xml\" target=\"_blank\" title=\"https://github.com/devices-on-fhir/PoCD-IG/blob/master/examples/HeartRateNumericObservation.xml\">This</a> example referencing the profile gets an \"Element matches more than one slice\" error. What's going wrong here?</p>",
        "id": 153987500,
        "sender_full_name": "Stefan Karl",
        "timestamp": 1534417357
    },
    {
        "content": "<p>I don't know. is it committed?</p>",
        "id": 153987503,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534417429
    },
    {
        "content": "<p>It's in the <a href=\"http://build.fhir.org/ig/devices-on-fhir/PoCD-IG/StructureDefinition-NumericObservation.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/devices-on-fhir/PoCD-IG/StructureDefinition-NumericObservation.html\">PoCD Implementation Guide</a>.</p>",
        "id": 153987505,
        "sender_full_name": "Stefan Karl",
        "timestamp": 1534417698
    },
    {
        "content": "<p>ok I'll add it to my list</p>",
        "id": 153987507,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534417836
    },
    {
        "content": "<p>Thanks</p>",
        "id": 153987508,
        "sender_full_name": "Stefan Karl",
        "timestamp": 1534417870
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> I'm not sure what to do with this one. The goal is to constrain a 0..1 element with a choice of types to a single type, and then constrain it.</p>",
        "id": 153987936,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534465690
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/elementdefinition.html#slicing\" target=\"_blank\" title=\"http://build.fhir.org/elementdefinition.html#slicing\">http://build.fhir.org/elementdefinition.html#slicing</a> says:<br>\nElements that allow a choice of multiple types can be constrained. In principle, there are two different types of constraints to apply:</p>\n<ul>\n<li>A constraint that applies to the element as a whole - e.g. as restricting the cardinality, or limiting the choice of types</li>\n<li>A constraint that applies to the use of a particular type - e.g. value set binding</li>\n</ul>\n<p>When constraining elements with multiple types, the following rules apply:</p>\n<ul>\n<li>Constraints limiting the acceptable list of types must be applied to the original \"[x]\" element as this is where the list of acceptable types is defined</li>\n<li>The inclusion of a type specific path (such as \"Patient.deceasedBoolean\") SHALL NOT be interpreted as constraining allowed types, but instead, it constrains the use of a particular type</li>\n<li>the original element SHALL always be represented in a snapshot; the type specific variants are only represented when needed</li>\n</ul>",
        "id": 153987939,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534465799
    },
    {
        "content": "<p>so I would expect that you'd have this:<br>\nObservation.value[x]<br>\n   type = Quantity<br>\nObservation.valueQuantity<br>\nObservation.valueQuantity.system<br>\n  fixedUri = <a href=\"http://unitsofmeasure.org\" target=\"_blank\" title=\"http://unitsofmeasure.org\">http://unitsofmeasure.org</a></p>",
        "id": 153987940,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534465863
    },
    {
        "content": "<p>but the snapshot generator doesn't accept this. Where as the validator seems to assume it...</p>",
        "id": 153987941,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534465884
    },
    {
        "content": "<p>Agree that the snapshot generator should allow/expect this.  Also realize that digging into that particular piece of code at this point in the process is a very scary prospect...</p>",
        "id": 153987970,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1534467040
    },
    {
        "content": "<p>Yes <span class=\"user-mention\" data-user-id=\"192966\">@Stefan Karl</span> we're going to carry this error. We'll fix it after ballot</p>",
        "id": 153987975,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1534467191
    }
]