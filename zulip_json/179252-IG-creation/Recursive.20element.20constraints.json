[
    {
        "content": "<p>I am trying to understand the new guidance on making restrictions on recursive elements.  I am profiling Composition and have some restrictions on Composition.section, a different set of restrictions on Composition.section.section, and I would like those last restrictions to apply recursively to section.section.section, etc.</p>\n<p>Here is what my differential looks like:</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Composition.section.section&quot;,\n        &quot;path&quot;: &quot;Composition.section.section&quot;,\n        &quot;type&quot;: [\n          {\n            &quot;code&quot;: &quot;BackboneElement&quot;,\n            &quot;profile&quot;: [\n              &quot;http://hl7.org/fhir/us/spl/StructureDefinition/ProductSubmissionDocument&quot;\n            ],\n            &quot;_profile&quot;: [\n              {\n                &quot;extension&quot;: [\n                  {\n                    &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-profile-element&quot;,\n                    &quot;valueString&quot;: &quot;Composition.section.section&quot;\n                  }\n                ]\n              }\n            ]\n          }\n        ],\n        &quot;mustSupport&quot;: true\n      },\n</code></pre></div>\n<p>But that gets me the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>Caused by: org.hl7.fhir.exceptions.DefinitionException: Type mismatch processing profile http://hl7.org/fhir/us/spl/StructureDefinition/ProductSubmissionDocument at path Composition.section.section: The element type is BackboneElement, but the profile http://hl7.org/fhir/us/spl/StructureDefinition/ProductSubmissionDocument is for a different type Composition\n</code></pre></div>\n<p>If I change the differential to have just Composition.section in the extension:</p>\n<div class=\"codehilite\"><pre><span></span><code>            &quot;_profile&quot;: [\n              {\n                &quot;extension&quot;: [\n                  {\n                    &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-profile-element&quot;,\n                    &quot;valueString&quot;: &quot;Composition.section&quot;\n                  }\n                ]\n              }\n            ]\n</code></pre></div>\n<p>that doesn't throw an error, but it reports that the snapshot generation failed and it applies the Composition constraints on Composition.section.section,  i.e. it requires status, type, author, etc. that are on Composition.  That sort of makes sense since I seem to be saying \"apply the ProductSubmissionDocument profile to Composition.section\".</p>\n<p>So what is the proper way to say \"apply all of the constraints on Composition.section.section to the recursive ...section element?</p>",
        "id": 278060461,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1649267102
    },
    {
        "content": "<p>NOTE: To make this simpler, I even tried just loosening my constraints on Composition.section and tried to say that the applied to Composition.section.section, etc.</p>\n<div class=\"codehilite\"><pre><span></span><code>      {\n        &quot;id&quot;: &quot;Composition.section&quot;,\n        &quot;path&quot;: &quot;Composition.section&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;value&quot;,\n              &quot;path&quot;: &quot;code&quot;\n            }\n          ],\n          &quot;rules&quot;: &quot;open&quot;,\n          &quot;description&quot;: &quot;Slice based on the different sections that are needed in a SPL document.&quot;\n        },\n        &quot;type&quot;: [\n          {\n            &quot;code&quot;: &quot;BackboneElement&quot;,\n            &quot;profile&quot;: [\n              &quot;http://hl7.org/fhir/us/spl/StructureDefinition/ProductSubmissionDocument&quot;\n            ],\n            &quot;_profile&quot;: [\n              {\n                &quot;extension&quot;: [\n                  {\n                    &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-profile-element&quot;,\n                    &quot;valueString&quot;: &quot;Composition.section&quot;\n                  }\n                ]\n              }\n            ]\n          }\n        ],\n        &quot;mustSupport&quot;: true\n      },\n</code></pre></div>\n<p>This got me a different error:</p>\n<div class=\"codehilite\"><pre><span></span><code>Caused by: org.hl7.fhir.exceptions.DefinitionException: Unable to find element Composition.section in http://hl7.org/fhir/us/spl/StructureDefinition/ProductSubmissionDocument\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1214)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1485)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1109)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:669)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1203)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1548)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:669)\n    at org.hl7.fhir.igtools.publisher.Publisher.generateSnapshot(Publisher.java:5459)\n</code></pre></div>",
        "id": 278060854,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1649267292
    },
    {
        "content": "<p>Anyone?  I hate to do this but <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, do you have any guidance?</p>",
        "id": 278360920,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1649451266
    },
    {
        "content": "<p>on my todo list</p>",
        "id": 278494559,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1649631974
    }
]