[
    {
        "content": "<p>The IG Publisher is reporting the following error for one of our logical model structure definitions:</p>\n<blockquote>\n<p>Types must be unique by the combination of code and profile [type.select(code&amp;profile&amp;targetProfile).isDistinct()]</p>\n</blockquote>\n<p>When I look at the element it refers to, however, the codes <em>are</em> unique:</p>\n<div class=\"codehilite\"><pre><span></span>&quot;type&quot; : [\n  {\n    &quot;code&quot; : &quot;code&quot;\n  },\n  {\n    &quot;code&quot; : &quot;Coding&quot;\n  }\n],\n</pre></div>\n\n\n<p>Now you can argue that maybe allowing a choice between a <code>code</code> and a <code>Coding</code> isn't a great idea, but... I don't understand why this invariant is getting triggered since they are technically unique.  Is there special logic in the invariant processing that treats <code>code</code> and <code>Coding</code> the same?</p>",
        "id": 153983799,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1533760323
    },
    {
        "content": "<p>no special logic. It doesn't look right to me either</p>",
        "id": 153983802,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533760412
    },
    {
        "content": "<p>OK.  Thanks for the confirmation.  There must be something else going on.  I'll dig in a little more.  Although this whole model only has two elements (it's kind of a silly one) -- so there's not much I could have missed!</p>",
        "id": 153983804,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1533760570
    },
    {
        "content": "<p>We may have an internal rule that prohibits that combination as it's a nonsensical thing to do, but the error message could be better.</p>",
        "id": 153983878,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533764234
    },
    {
        "content": "<p>If you're going to support Coding, there's never a reason to allow 'code'.</p>",
        "id": 153983880,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533764250
    },
    {
        "content": "<p>can I reproduce this easily?</p>",
        "id": 153983934,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533770273
    },
    {
        "content": "<p>I hear you <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>.  I agree it's probably a silly thing to do.  I haven't yet asked <em>why</em> we're doing it.  The error message just surprised me.</p>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- I expect you can repro it by simply creating a logical model with an element that has a choice between <code>code</code> and <code>Coding</code>.  But if you want to reproduce it with existing code, you can build <a href=\"https://github.com/HL7/us-breastcancer\" target=\"_blank\" title=\"https://github.com/HL7/us-breastcancer\">US BreastCancer</a> and look at the <a href=\"http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-cimi-element-Status-model.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-cimi-element-Status-model.html\">cimi-element-Status-model</a>.  BUT... perhaps I should find out if it's really <em>necessary</em> for us to create a choice between a <code>code</code> and a <code>Coding</code> before you chase this down too far?</p>",
        "id": 153983942,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1533772957
    },
    {
        "content": "<p>well, I'm looking at stuff like this today anyway, and I while agree that the choice reflects a bad understanding of terminology (or what can go wrong) it still looks like an infrastructural problem to me</p>",
        "id": 153983944,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533773808
    },
    {
        "content": "<p>OK.  In looking at it further, I suspect the model was done this way to allow it to be easily mapped onto resource properties that might be <code>code</code> or <code>Coding</code> (or <code>CodeableConcept</code>, but we supress that for a different reason).  So it's probably more of a side-effect of a tooling approach than an intentional decision about the model.  That said, I think we can find another way.</p>",
        "id": 153983945,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1533774402
    },
    {
        "content": "<p>there might be some sense in that somewhere</p>",
        "id": 153983946,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533774467
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> this is what I see:</p>\n<div class=\"codehilite\"><pre><span></span>&quot;type&quot;: [\n          {\n            &quot;code&quot;: &quot;code&quot;\n          },\n          {\n            &quot;code&quot;: &quot;Coding&quot;\n          },\n          {\n            &quot;code&quot;: &quot;Coding&quot;\n          }\n        ],\n</pre></div>\n\n\n<p>That will fail the test, no doubt</p>",
        "id": 153983987,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533783700
    },
    {
        "content": "<p>Oh no.  If that's what's really there then I feel like a moron.  I am sorry.</p>",
        "id": 153983990,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1533784192
    },
    {
        "content": "<p>Ugh.  You're right.  I was looking at the JSON linked from the IG (<a href=\"http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-cimi-element-Status-model.json\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-cimi-element-Status-model.json\">http://build.fhir.org/ig/HL7/us-breastcancer/StructureDefinition-cimi-element-Status-model.json</a>).  I didn't realize that was a _sanitized_ version of what the source actually was (<a href=\"https://github.com/HL7/us-breastcancer/blob/master/resources/structuredefinition-cimi-element-Status-model.json\" target=\"_blank\" title=\"https://github.com/HL7/us-breastcancer/blob/master/resources/structuredefinition-cimi-element-Status-model.json\">https://github.com/HL7/us-breastcancer/blob/master/resources/structuredefinition-cimi-element-Status-model.json</a>).  I learned something today and I <em>hope</em> I did not waste much of your time, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>!</p>",
        "id": 153983994,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1533784391
    },
    {
        "content": "<p>found it straight away, so no time lost</p>",
        "id": 153983995,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533784440
    }
]