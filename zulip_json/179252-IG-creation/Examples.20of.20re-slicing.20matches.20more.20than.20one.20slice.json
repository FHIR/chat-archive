[
    {
        "content": "<p>The Dental Consult Note (Composition) is dependent on CCDAonFHIR Consult Note. CCDAonFHIR's Plan of Treatment section entry has a targetProfile of (base) ServiceRequest. Dental Consult has resliced entry (Composition.section:plan_of_treatment_section.entry:sliceEntry/dental_sliceEntry) and adds a a targetProfile of Dental-ServiceRequest; Dental-ServiceRequest profile is based on ServiceRequest.</p>\n<p>The IG Publisher should recognize Dental-ServiceRequest entry targetProfile references as valid (and not *also *as base ServiceRequest targetProfiles). Yet, Dental-ServiceRequest entry references are getting this error in the Dental Consult example, \"Profile <a href=\"http://hl7.org/fhir/us/dentalreferral/StructureDefinition/dental-consult\">http://hl7.org/fhir/us/dentalreferral/StructureDefinition/dental-consult</a>, Element matches more than one slice - sliceEntry, sliceEntry/dental_sliceEntry\"</p>",
        "id": 205803025,
        "sender_full_name": "David deRoode",
        "timestamp": 1596466315
    },
    {
        "content": "<p>how to reproduce this?</p>",
        "id": 205863554,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596502713
    },
    {
        "content": "<p>These errors persist in the Dental Data Exchange CI build, so rebuilding the Dental IG in the CI build would be simplest. If you're trying to recreate outside of the Dental and CCDAonFHIR IGs, I'm at a loss for any quicker way than recreating in a new IG following the dependency structure above.</p>",
        "id": 205920982,
        "sender_full_name": "David deRoode",
        "timestamp": 1596554570
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> to clarify, the error is on the example, as it contains an entry with a targetProfile (dental-serviceRequest) that ittself is based on base ServiceRequest. I think the issue is related to the fact that base ServiceRequest is also a targetProfile of CCDAonFHIR Plan of Treatment section.entry. The sliced and resliced profiles use the same profile/resolve() discriminator (which doesn't seem to be forbidden as long as the same discriminator uniquely identifies all allowable data); the IG publisher should be able to distinguish that Dental-SericeRequest is a more specific profile based on the base resource ServiceRequest.</p>",
        "id": 206042551,
        "sender_full_name": "David deRoode",
        "timestamp": 1596643965
    },
    {
        "content": "<p>I am getting the same error on my IG. Mine isn't to do with re-slicing though, I don't think. </p>\n<p>I'm getting it on Composition.section.entry slices. <br>\n<a href=\"/user_uploads/10155/F2NYSfT8SZw2JG1i7iIMcMVv/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/F2NYSfT8SZw2JG1i7iIMcMVv/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/F2NYSfT8SZw2JG1i7iIMcMVv/image.png\"></a></div><p>I can make all the errors above disappear If I remove from the Composition, all slices whose referenced profiles do not have a hard coded code (i.e. Procedure.code, Observation.code, Condition.code are bound to a value set rather than being patternCodeableConcept). That is the common denominator of all the profiles that are creating the multiple matches.</p>\n<p>The other thing about all the offending profiles is that the value sets they are bound to all live either in VSAC or PhinVADS so there is no way for the publisher to check the values. They all have warnings like <code>ValueSet https://phinvads.cdc.gov/vads/ViewValueSet.action?oid=2.16.840.1.114222.4.11.7113 not found by validator</code></p>\n<p>So I feel like what is happening is that the publisher is trying to check the code to make the differentiation but it can't so it matches to multiple slices. Or something.</p>\n<p>This is the Composition: <a href=\"http://build.fhir.org/ig/HL7/fhir-bfdr/branches/master/StructureDefinition-Composition-jurisdiction-live-birth-report.html\">http://build.fhir.org/ig/HL7/fhir-bfdr/branches/master/StructureDefinition-Composition-jurisdiction-live-birth-report.html</a><br>\nThis is one of the profiles that I think is causing the issue: <a href=\"http://build.fhir.org/ig/HL7/fhir-bfdr/branches/master/StructureDefinition-Observation-cigarette-smoking-before-during-pregnancy.html\">http://build.fhir.org/ig/HL7/fhir-bfdr/branches/master/StructureDefinition-Observation-cigarette-smoking-before-during-pregnancy.html</a><br>\nAnd this one: <a href=\"http://build.fhir.org/ig/HL7/fhir-bfdr/branches/master/StructureDefinition-Procedure-obstetric.html\">http://build.fhir.org/ig/HL7/fhir-bfdr/branches/master/StructureDefinition-Procedure-obstetric.html</a></p>",
        "id": 207062594,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597568608
    },
    {
        "content": "<p>It also counts multiples where there is very clearly only a single matching slice:<br>\n<a href=\"/user_uploads/10155/opPaaQeHd2BDjdyJsHLNGObu/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/opPaaQeHd2BDjdyJsHLNGObu/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/opPaaQeHd2BDjdyJsHLNGObu/image.png\"></a></div>",
        "id": 207063030,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597569375
    },
    {
        "content": "<p>Any chance of looking at this <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ? I'm at a loss as to how to fix it. It is happening on all my Compositions. Or any suggestions on further debugging on my part?</p>\n<p>I've created a test Composition profile and test Composition example to try to get to the bottom of it.</p>\n<p><a href=\"https://github.com/HL7/fhir-bfdr/blob/master/input/resources/structuredefinition/Composition-test.xml\">https://github.com/HL7/fhir-bfdr/blob/master/input/resources/structuredefinition/Composition-test.xml</a> <br>\n<a href=\"https://github.com/HL7/fhir-bfdr/blob/master/input/resources/composition/composition-test.xml\">https://github.com/HL7/fhir-bfdr/blob/master/input/resources/composition/composition-test.xml</a></p>\n<p>This errors with: <code>Profile http://hl7.org/fhir/us/bfdr/StructureDefinition/Composition-test, Element matches more than one slice - testEntrySliceHC1, testEntrySliceVS1</code></p>\n<p>If I comment out one of the two slices that have .code bound to a value set (testEntrySliceVS1 or testEntrySliceVS2) rather than a patternCodeableConcept, all the errors go away.</p>\n<p>Then I get  a warning: <code>This element does not match any known slice defined in the profile http://hl7.org/fhir/us/bfdr/StructureDefinition/Composition-test</code> for the entries that match the slice I commented out - GOOD.<br>\nI also get a warning <code>This element does not match any known slice defined in the profile http://hl7.org/fhir/us/bfdr/StructureDefinition/Composition-test</code> for an entry that matches a slice I didn't comment out (but is also a value set binding on code) - BAD - because it definitely does match.</p>",
        "id": 207372709,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597816258
    },
    {
        "content": "<p>+1 on getting this error as well</p>",
        "id": 207419803,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1597849660
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191918\">@Sarah Gaunt</span> these are all extensible bindings?</p>",
        "id": 207476967,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597882801
    },
    {
        "content": "<p>Correct</p>",
        "id": 207478569,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597884522
    },
    {
        "content": "<p>But I'm not specifically slicing on an extensible binding. Just on a profile that contains an extensible binding.</p>",
        "id": 207478597,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597884567
    },
    {
        "content": "<p>you can't</p>",
        "id": 207478603,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597884579
    },
    {
        "content": "<p>because the infrastructure can never determine whether a resource doesn't conform to a profile if the determination is based on an extensible binding</p>",
        "id": 207478660,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597884623
    },
    {
        "content": "<p>So the infrastructure doesn't take into account at all what meta.profile is pointing to?</p>",
        "id": 207478672,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597884653
    },
    {
        "content": "<p>no. that's just a claim. It's not an assertion of fact that the validator can accept</p>",
        "id": 207478693,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597884680
    },
    {
        "content": "<p>Like I just want to say you have to have one of these types of profiles in this entry. And that is impossible to say unless the bindings contained in that profile are required?</p>",
        "id": 207478720,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597884722
    },
    {
        "content": "<p>you can say that, you just can't discriminate on it</p>",
        "id": 207478772,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597884749
    },
    {
        "content": "<p>How do I say it without discriminating on it?</p>",
        "id": 207478825,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597884838
    },
    {
        "content": "<p>just don't have a discriminator. I think the implementers will complain, but they can ballot about this, right?</p>",
        "id": 207479006,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597885030
    },
    {
        "content": "<p>TBH, I can probably change most of them to required bindings.</p>",
        "id": 207479019,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597885042
    },
    {
        "content": "<p>that would be much better for everyone</p>",
        "id": 207479025,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597885055
    },
    {
        "content": "<p>Ok, will play around with it.</p>",
        "id": 207479032,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597885060
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 207479036,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597885065
    },
    {
        "content": "<p>Still getting the same errors. No extensible bindings left in the IG. I'm going to guess it's because the bindings are to VSAC and PhinVADS value sets?</p>",
        "id": 207480674,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1597887081
    },
    {
        "content": "<p>maybe. I'm working on that now</p>",
        "id": 207481482,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1597888237
    },
    {
        "content": "<p>I think we can come up with a better policy for how to validate this situation (with extensible bindings, etc.).  I'm working on submitting a tracker.</p>",
        "id": 207576072,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1597958464
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191918\">@Sarah Gaunt</span> does changing to the new PHINVads value sets sort this issue out?</p>",
        "id": 207792271,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598218137
    },
    {
        "content": "<p>Haven't had a chance to try yet, will check a bit later today and let you know</p>",
        "id": 207792346,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1598218240
    }
]