[
    {
        "content": "<p>I'm having a problem with a Communication inside a Bundle.  When the exact same Communication is standalone, I get no errors, but when it's contained inside the Bundle I get the following:</p>\n<div class=\"codehilite\"><pre><span></span>Exception in thread &quot;main&quot; java.lang.Error: Not the right type for Communication.payload.content[x]: string\n    at org.hl7.fhir.r5.model.Communication$CommunicationPayloadComponent.setContent(Communication.java:163)\n    at org.hl7.fhir.convertors.conv40_50.Communication.convertCommunicationPayloadComponent(Communication.java:235)\n    at org.hl7.fhir.convertors.conv40_50.Communication.convertCommunication(Communication.java:111)\n    at org.hl7.fhir.convertors.VersionConvertor_40_50.convertResource(VersionConvertor_40_50.java:3327)\n    at org.hl7.fhir.convertors.conv40_50.Bundle.convertBundleEntryComponent(Bundle.java:175)\n    at org.hl7.fhir.convertors.conv40_50.Bundle.convertBundle(Bundle.java:79)\n    at org.hl7.fhir.convertors.VersionConvertor_40_50.convertResource(VersionConvertor_40_50.java:3305)\n    at org.hl7.fhir.igtools.publisher.Publisher.convertFromElement(Publisher.java:4487)\n    at org.hl7.fhir.igtools.publisher.Publisher.load(Publisher.java:3793)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3310)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:776)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:663)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6893)\n</pre></div>\n\n\n<p>If I delete the &lt;contentString&gt; element, it builds.</p>\n<p>It's valid to have Communication.payload.content as a string - the profile restricts content to string ( <a href=\"https://github.com/HL7/case-reporting/blob/master/source/resources/structuredefinition/rr-communication.xml\" target=\"_blank\" title=\"https://github.com/HL7/case-reporting/blob/master/source/resources/structuredefinition/rr-communication.xml\">https://github.com/HL7/case-reporting/blob/master/source/resources/structuredefinition/rr-communication.xml</a>).</p>\n<p>The xml in the Bundle.Communication is:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;payload id=&quot;reportability-response-summary&quot;&gt;\n    &lt;contentString\n      value=&quot;Your organization electronically submitted an initial case report to determine if reporting to public health is needed for a patient. &#39;Zika virus disease (disorder)&#39; is reportable to &#39;State Department of Health&#39;. An initial case report was sent to &#39;State Department of Health&#39;. Additional information may be required for this report.&quot;\n     /&gt;\n  &lt;/payload&gt;\n</pre></div>\n\n\n<p>I've tried replacing the long string with \"TEST\" to see if there were maybe weird characters in there, but that also crashed.</p>\n<p>So strange that it works fine in the standalone Communication but not in the Bundle. Cannot figure out what I'm doing wrong...</p>",
        "id": 186360516,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579760610
    },
    {
        "content": "<p>Hmmmm... I just had a thought and checked the R5 version of Communication - it does NOT have string as an option.<br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> - any ideas here? Seems that when the Communication is inside a Bundle it's being checked as if it were an R5 resource. <br>\n(This is an R4 IG).</p>",
        "id": 186360708,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579760958
    },
    {
        "content": "<p>I think that this will be fixed next release</p>",
        "id": 186464581,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579843651
    },
    {
        "content": "<p>Ok thanks... Any eta on next release?</p>",
        "id": 186464782,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579843944
    },
    {
        "content": "<p>maybe very early tomorrow morning?</p>",
        "id": 186464982,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579844271
    },
    {
        "content": "<p>Ok sounds great, thanks.</p>",
        "id": 186465110,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579844475
    },
    {
        "content": "<p>maybe tonight...</p>",
        "id": 186465623,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579845333
    },
    {
        "content": "<p>Ok, will keep an eye out to test...</p>",
        "id": 186467028,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579847559
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> - it's not crashing anymore...</p>",
        "id": 186544101,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579908063
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> not sure what to do - I'm ready to just remove this Bundle example from the IG because I keep running into problems with it. There isn't a specific profile in the IG for this bundle, so it's not like I'd get a warning or anything. The issue is that I'd really like to be able to have a nice example for implementers.</p>\n<p>I'm geting a bunch of slicing errors now on a Document Bundle in this collection Bundle - but no errors on either the standalone Compositition or standalone Document Bundle (the one in the Bundle is just a copy and paste from the one that doesn't error as standalone).</p>\n<p>The QA is here: <a href=\"http://build.fhir.org/ig/HL7/case-reporting/branches/master/qa.html#_scratch_ig-build-temp-NAZRR1_repo_source_resources_bundle_bundle-rr-collection-communication\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/case-reporting/branches/master/qa.html#_scratch_ig-build-temp-NAZRR1_repo_source_resources_bundle_bundle-rr-collection-communication\">http://build.fhir.org/ig/HL7/case-reporting/branches/master/qa.html#_scratch_ig-build-temp-NAZRR1_repo_source_resources_bundle_bundle-rr-collection-communication</a></p>\n<p>This is one of the errors - the matching profile is clearly there with the correct fullUrl and meta.profile:</p>\n<div class=\"codehilite\"><pre><span></span>Unable to find matching profile for Bundle/bundle-eicr-document-zika among choices: http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-document-bundle\n</pre></div>\n\n\n<p>and  another - there is definitely an entry with that meta.profile:</p>\n<div class=\"codehilite\"><pre><span></span>Problem evaluating slicing expression for element in profile http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-composition path resource.section[2].entry[0] (fhirPath = true and resolve().conformsTo(&#39;http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-condition&#39;)): null\n</pre></div>",
        "id": 186548213,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579912108
    },
    {
        "content": "<p>wooah that was a hard one to nail down. Fixed next release</p>",
        "id": 186616339,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580036031
    },
    {
        "content": "<p>Thank you! (Sorry it was hard...)</p>",
        "id": 186648466,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1580091866
    },
    {
        "content": "<p>Just tested this - all good. Thanks again!</p>",
        "id": 186738141,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1580168164
    }
]