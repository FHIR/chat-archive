[
    {
        "content": "<p>Hi, I am working on the PDDI CDS IG using the most recent IG publisher I downloaded from HL7. Things seem to build fine on my machine but when I push to github and the code is pushed via webhook to <a href=\"https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger\" target=\"_blank\" title=\"https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger\">https://us-central1-fhir-org-starter-project.cloudfunctions.net/ig-commit-trigger</a> I see the following error on <a href=\"http://build.fhir.org/ig/HL7/PDDI-CDS/build.log\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/PDDI-CDS/build.log\">http://build.fhir.org/ig/HL7/PDDI-CDS/build.log</a>. I am not sure what it means. Would someone be able to advise me on what to check/fix? Thanks!</p>",
        "id": 160799812,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1552582265
    },
    {
        "content": "<p>Just to confirm, you grabbed the publisher from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">http://build.fhir.org</a> and have downloaded in the last few hours?</p>",
        "id": 160806303,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1552586820
    },
    {
        "content": "<blockquote>\n<p>Just to confirm, you grabbed the publisher from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">http://build.fhir.org</a> and have downloaded in the last few hours?</p>\n</blockquote>\n<p>Yes. Here is the log from my local build with the publisher from <a href=\"http://build.fhir.org/org.hl7.fhir.igpublisher.jar\" target=\"_blank\" title=\"http://build.fhir.org/org.hl7.fhir.igpublisher.jar\">http://build.fhir.org/org.hl7.fhir.igpublisher.jar</a> :  <a href=\"https://drive.google.com/open?id=1gZcoJnY9-CHhd49JdHFwRvgk-LCLssGn\" target=\"_blank\" title=\"https://drive.google.com/open?id=1gZcoJnY9-CHhd49JdHFwRvgk-LCLssGn\">https://drive.google.com/open?id=1gZcoJnY9-CHhd49JdHFwRvgk-LCLssGn</a></p>",
        "id": 160819952,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1552595881
    },
    {
        "content": "<p>Not sure why there's a difference.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?</p>",
        "id": 160820723,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1552596406
    },
    {
        "content": "<p>that part shouldn't be different</p>",
        "id": 160821121,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1552596704
    },
    {
        "content": "<p>Is there something like a cache that could be making my build work while the remote one fails? Would it be possible for one of you to clone and build the PDDI CDS IG locally to see if you find the same issue as on the remote one?</p>",
        "id": 160870482,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1552653546
    },
    {
        "content": "<p>Builds locally for me</p>",
        "id": 160874609,
        "sender_full_name": "David Pyke",
        "timestamp": 1552656805
    },
    {
        "content": "<p>I get the same outcome as the build server - it fails</p>",
        "id": 160903679,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1552676497
    },
    {
        "content": "<p>Is everything committed?</p>",
        "id": 160904539,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1552677137
    },
    {
        "content": "<p>I thought so but I will do some more testing tomorrow including checking it out on a different machine. Must be something like what Lloyd asks...</p>",
        "id": 160911235,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1552682158
    },
    {
        "content": "<p>sure enough - did not work on a totally new machine. Error \"java.lang.Exception: Unable to determine type for  (long identifier) com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject``` -- I notice that this exception is raised by org.hl7.fhir.r5.formats.JsonParser.parseMedicationAdministration -- the R5 threw me off --- I specify &lt;fhirVersion value=\"4.0.0\"/&gt; in the resources/ig.xml  -- is the publisher looking somewhere else or how can I fix the version to be 4? thanks</p>",
        "id": 160978379,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1552788913
    },
    {
        "content": "<p>I tried some more things to get past the error \"Unable to determine type\"  but am out of ideas. I am trying to follow the docs and info in the thread but am missing something.  The ig.json has an entry \"specification\": \"<a href=\"http://hl7.org/fhir/R4\" target=\"_blank\" title=\"http://hl7.org/fhir/R4\">http://hl7.org/fhir/R4</a>\" and the resources/ig.xml has &lt;fhirVersion value=\"4.0.0\"/&gt; yet the error seems to be raised by an R5 parser java class so maybe I don't have the version set up correctly? Please help with any suggestions. Thanks.</p>",
        "id": 161168892,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1553014802
    },
    {
        "content": "<p>what happens if you remove the offending example?</p>\n<p>medicationadministration-warfarin-nsaid-warfarin-prefetch</p>",
        "id": 161172718,
        "sender_full_name": "Eric Haas",
        "timestamp": 1553016925
    },
    {
        "content": "<p>the R5 thing is not the issue.</p>",
        "id": 161180449,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553022198
    },
    {
        "content": "<p>no maybe -what's the stack look like?</p>",
        "id": 161180462,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553022219
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 161180642,
        "sender_full_name": "Eric Haas",
        "timestamp": 1553022331
    },
    {
        "content": "<p>This is from the latest build log on the autobuilder:</p>\n<div class=\"codehilite\"><pre><span></span>Check Generate /scratch/ig-build-temp-IAJ6LO/repo/temp/tbl_bck01101.png          (20.0159sec)\nCheck Generate /scratch/ig-build-temp-IAJ6LO/repo/qa/tbl_spacer.png              (20.0160sec)\nCheck Generate /scratch/ig-build-temp-IAJ6LO/repo/temp/tbl_spacer.png            (20.0160sec)\nInitialization complete                                                          (20.0160sec)\nLoad Content                                                                     (20.0160sec)\nPublishing Content Failed: Unable to determine type for  /scratch/ig-build-temp-IAJ6LO/repo/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch: com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject (21.0747sec)\n                                                                                 (21.0747sec)\nUse -? to get command line help                                                  (21.0747sec)\n                                                                                 (21.0747sec)\nStack Dump (for debugging):                                                      (21.0747sec)\njava.lang.Exception: Unable to determine type for  /scratch/ig-build-temp-IAJ6LO/repo/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch: com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject\n    at org.hl7.fhir.igtools.publisher.Publisher.loadAsElementModel(Publisher.java:2458)\n    at org.hl7.fhir.igtools.publisher.Publisher.load(Publisher.java:1842)\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:610)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:554)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5103)\nCaused by: java.lang.ClassCastException: com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject\n    at com.google.gson.JsonObject.getAsJsonObject(JsonObject.java:205)\n    at org.hl7.fhir.r5.formats.JsonParser.parseMedicationAdministrationProperties(JsonParser.java:15886)\n    at org.hl7.fhir.r5.formats.JsonParser.parseMedicationAdministration(JsonParser.java:15842)\n    at org.hl7.fhir.r5.formats.JsonParser.parseResource(JsonParser.java:27554)\n    at org.hl7.fhir.r5.formats.JsonParserBase.parse(JsonParserBase.java:113)\n    at org.hl7.fhir.r5.formats.ParserBase.parse(ParserBase.java:79)\n    at org.hl7.fhir.r5.elementmodel.ObjectConverter.convert(ObjectConverter.java:117)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadAsElementModel(Publisher.java:2451)\n    ... 4 more\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5113)\n</pre></div>",
        "id": 161180941,
        "sender_full_name": "Eric Haas",
        "timestamp": 1553022484
    },
    {
        "content": "<p>just looking at this again. <span class=\"user-mention\" data-user-id=\"196276\">@Rich Boyce</span> what version of FHIR is this supposed to be based on?</p>",
        "id": 161294995,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553118841
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  - we are trying for R4 since its the current official release</p>",
        "id": 161390570,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1553198306
    },
    {
        "content": "<p>so you need \"version\" : \"4.0.0\" in your config.json</p>",
        "id": 161392501,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553199819
    },
    {
        "content": "<p>since you don't, it's being treated as R5, and the model for MedAdmin is different in R5 now</p>",
        "id": 161392510,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553199838
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Thank you. That did help. Interestingly, there is still a problem with the MedicationAdministration resource created in our IG that is not obvious to me when I cross-walk it with the R4 spec. Unless I comment out in ig.xml the offending resource, the publisher stops with the following exception:</p>\n<div class=\"codehilite\"><pre><span></span>Stack Dump (for debugging):                                                      (12.0882sec)\norg.hl7.fhir.exceptions.FHIRException: MedicationAdministration null\n        at org.hl7.fhir.igtools.publisher.IGKnowledgeProvider.doReplacements(IGKnowledgeProvider.java:134)\n        at org.hl7.fhir.igtools.publisher.Publisher.load(Publisher.java:1868)\n        at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:610)\n        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:554)\n        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5103)\nException in thread &quot;main&quot; java.lang.NullPointerException\n        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5113)\n</pre></div>\n\n\n<p>The bad resource is here: <a href=\"https://github.com/HL7/PDDI-CDS/blob/master/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch.xml\" target=\"_blank\" title=\"https://github.com/HL7/PDDI-CDS/blob/master/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch.xml\">https://github.com/HL7/PDDI-CDS/blob/master/examples/medicationadministration-warfarin-nsaid-warfarin-prefetch.xml</a> </p>\n<p>and the reference to it in ig.xml is as follows:</p>\n<div class=\"codehilite\"><pre><span></span>   &lt;resource&gt;\n      &lt;reference&gt;\n        &lt;reference value=&quot;MedicationAdministration/medicationadministration-warfarin-nsaid-warfarin-prefetch&quot; /&gt;\n      &lt;/reference&gt;\n      &lt;name value=&quot;medicationadministration-warfarin-nsaid-warfarin-prefetch&quot; /&gt;\n      &lt;exampleBoolean value=&quot;true&quot; /&gt;\n    &lt;/resource&gt;\n</pre></div>\n\n\n<p>The only thing I saw that might trigger an issue was the use of the extension for the effectivePeriod. I tested that by replacing it with the ordinary period below and the publisher was still not happy -- Any ideas?</p>\n<div class=\"codehilite\"><pre><span></span>        &lt;start value=&quot;2011-05-23&quot; /&gt;\n        &lt;end value=&quot;2011-05-27&quot; /&gt;\n</pre></div>",
        "id": 161397153,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1553203683
    },
    {
        "content": "<p>null error is always a bug in my code even if there's a genuine underlying error. if you commit the version fix Ill have a look</p>",
        "id": 161399816,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553206128
    },
    {
        "content": "<p>Done just now : <a href=\"https://github.com/HL7/PDDI-CDS\" target=\"_blank\" title=\"https://github.com/HL7/PDDI-CDS\">https://github.com/HL7/PDDI-CDS</a></p>",
        "id": 161401438,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1553207579
    },
    {
        "content": "<p>ok should be better - try again</p>",
        "id": 161404605,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553210571
    },
    {
        "content": "<p>That worked! Thank you for your help.</p>",
        "id": 161448636,
        "sender_full_name": "Rich Boyce",
        "timestamp": 1553262393
    }
]