[
    {
        "content": "<p>I've run into what seems to be a rather weird issue.  I have a CodeSystem resource instance (a LOINC code system fragment) that I'm trying to use in the livd IG.  This CodeSystem resource instance is valid against the <a href=\"http://hl7.org/fhir/uv/livd/StructureDefinition/codesystem-loinc-frag-uv-livd\" target=\"_blank\" title=\"http://hl7.org/fhir/uv/livd/StructureDefinition/codesystem-loinc-frag-uv-livd\">http://hl7.org/fhir/uv/livd/StructureDefinition/codesystem-loinc-frag-uv-livd</a> profile that is included in the IG (and livd package).  The resource instance has a meta.profile element that specifies that profile.  When I validate the resource instance separately against the ig and that profile with the latest validator, it's gives all \"Success...\", with zero errors, warnings and info.  But when I include it in the IG as a vocabulary resource and attempt to build the IG (using the latest 0.9.43-SNAPSHOT IG Publisher), if the meta profile declaration is present the build errors out with:</p>\n<blockquote>\n<div class=\"codehilite\"><pre><span></span> [java] Stack Dump (for debugging):                                                      (19.0984sec)\n [java] java.lang.Exception: Error parsing /Users/rhausam/git-repo/livd/src/vocabulary/codesystem-loinc-fragment-livd: com.google.gson.JsonPrimitive cannot be cast to com.google.gson.JsonArray\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.load(Publisher.java:3294)\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:2905)\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:723)\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:612)\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6208)\n [java] Caused by: java.lang.ClassCastException: com.google.gson.JsonPrimitive cannot be cast to com.google.gson.JsonArray\n [java]     at com.google.gson.JsonObject.getAsJsonArray(JsonObject.java:195)\n [java]     at org.hl7.fhir.r4.formats.JsonParser.parseMetaProperties(JsonParser.java:260)\n [java]     at org.hl7.fhir.r4.formats.JsonParser.parseMeta(JsonParser.java:241)\n [java]     at org.hl7.fhir.r4.formats.JsonParser.parseResourceProperties(JsonParser.java:1988)\n [java]     at org.hl7.fhir.r4.formats.JsonParser.parseDomainResourceProperties(JsonParser.java:1918)\n [java]     at org.hl7.fhir.r4.formats.JsonParser.parseCodeSystemProperties(JsonParser.java:6057)\n [java]     at org.hl7.fhir.r4.formats.JsonParser.parseCodeSystem(JsonParser.java:6052)\n [java]     at org.hl7.fhir.r4.formats.JsonParser.parseResource(JsonParser.java:27446)\n [java]     at org.hl7.fhir.r4.formats.JsonParserBase.parse(JsonParserBase.java:113)\n [java]     at org.hl7.fhir.r4.formats.ParserBase.parse(ParserBase.java:79)\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.parseContent(Publisher.java:3569)\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.parse(Publisher.java:3620)\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.load(Publisher.java:3291)\n [java]     ... 4 more\n [java] Exception in thread &quot;main&quot; java.lang.NullPointerException\n [java]     at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6218)\n</pre></div>\n\n\n</blockquote>\n<p>But if I remove the meta element and profile declaration in the CodeSystem instance and don't make any other changes, then the IG builds just fine.  I don't see anything anywhere that seems like it would relate to an \"array vs primitive\" discrepancy, and I expect that's not really the issue since the the resource validates fine independently.  Do any of you have thoughts or solutions for this?</p>",
        "id": 171899576,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564339574
    },
    {
        "content": "<p>paste the meta here:</p>",
        "id": 171899636,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564339691
    },
    {
        "content": "<p>It's just this:</p>\n<div class=\"codehilite\"><pre><span></span>    &quot;meta&quot;: {\n        &quot;profile&quot;: &quot;http://hl7.org/fhir/uv/livd/StructureDefinition/codesystem-loinc-frag-uv-livd&quot;\n    },\n</pre></div>",
        "id": 171899662,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564339764
    },
    {
        "content": "<p>oh, I see it now - I thought I had the array there but I don't</p>",
        "id": 171899793,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564339923
    },
    {
        "content": "<p>well, that's wrong...</p>",
        "id": 171899803,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564339957
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>   <span class=\"s2\">&quot;meta&quot;</span><span class=\"err\">:</span> <span class=\"p\">{</span>\n        <span class=\"err\">[</span><span class=\"nt\">&quot;profile&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/uv/livd/StructureDefinition/codesystem-loinc-frag-uv-livd&quot;</span><span class=\"err\">]</span>\n    <span class=\"p\">}</span><span class=\"err\">,</span>\n</pre></div>",
        "id": 171899866,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564340063
    },
    {
        "content": "<p>I know - I thought I looked that over multiple times, but guess I wasn't looking carefully enough!</p>",
        "id": 171899950,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564340253
    },
    {
        "content": "<p>shouldn't have validated correctly though</p>",
        "id": 171899955,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564340276
    },
    {
        "content": "<p>yeah, it shouldn't have, but it did<br>\nthe issue itself is fixed now - I just wasn't seeing it, partly I think because it was validating ok</p>",
        "id": 171900395,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564341016
    },
    {
        "content": "<p>Currently getting this error using the latest version of the tool - any ideas what the issue might be?<br>\n<a href=\"/user_uploads/10155/WoireeuBEXxHoBQYKiSChisF/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/WoireeuBEXxHoBQYKiSChisF/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/WoireeuBEXxHoBQYKiSChisF/pasted_image.png\"></a></div>",
        "id": 182840733,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1575717577
    },
    {
        "content": "<p>if you are using the latest version of the ig publisher - empty your FHIR package cache</p>",
        "id": 182842897,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575721523
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  - i did that and got the following results. I'm suspecting I have security issues, not sure why though.<br>\n<a href=\"/user_uploads/10155/qlNgEvTpgDk-cSinHEOOPOEN/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/qlNgEvTpgDk-cSinHEOOPOEN/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/qlNgEvTpgDk-cSinHEOOPOEN/pasted_image.png\"></a></div>",
        "id": 182843128,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1575721931
    },
    {
        "content": "<blockquote>\n<p>if you are using the latest version of the ig publisher</p>\n</blockquote>\n<p>You are using quite an old version of the IG publisher</p>",
        "id": 182857439,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575745782
    }
]