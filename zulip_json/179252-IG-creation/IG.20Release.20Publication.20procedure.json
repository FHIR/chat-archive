[
    {
        "content": "<p>So, <span class=\"user-mention\" data-user-id=\"191916\">@ Bob Milius</span> 's input was really helpful and unblocked me.<br>\nI can publish a first draft (to be corrected by anyone that knows better) of a simple procedure for gettting from A to B (similar to Bob's procedure but for an existing IG, and not only one freshly generated by sushi.</p>",
        "id": 231094164,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1616190428
    },
    {
        "content": "<p>About Documentation: Confluence? A github repo with step by step progress?</p>",
        "id": 231094476,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1616190598
    },
    {
        "content": "<p>I think that this deserves / needs a procedure. It's too sensitive to minor mistakes and some pre-processing would help.<br>\nMy current understanding is the following (Taken from Grahame's idea):</p>\n<ol>\n<li>For every new IG, the user sets up the processing folder and dependencies</li>\n<li>When there is a new release, the user adds a token (a small json) which should the job the done</li>\n<li>When the user wants to roll back or remove a release, well, we'll have to see about that.</li>\n</ol>",
        "id": 231094779,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1616190754
    },
    {
        "content": "<p>This sounds like a job for a GUI-enabled tool. A command line script should work, but would be ...meh...</p>",
        "id": 231094888,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1616190825
    },
    {
        "content": "<p>My leaning would be Confluence page</p>",
        "id": 231099372,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616193637
    },
    {
        "content": "<p>yes, just document the steps on a confluence page.</p>",
        "id": 231300496,
        "sender_full_name": "John Moehrke",
        "timestamp": 1616415643
    },
    {
        "content": "<p>Phase 2: <br>\nI want to start a process for semi-automating the release (the release is manually triggered and there's review needed, but the process steps for releasing can be automated). <br>\nI'm thinking of using github actions for that. Does anyone have ideas / requirements to share?</p>",
        "id": 255699561,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633072013
    },
    {
        "content": "<p>I'd start with:</p>\n<ol>\n<li>Release manager creates a RC branch</li>\n<li>Release manager Reviews IG in that branch, reviews QA, reviews a bunch of other stuff (manual work so we don't automate that)</li>\n<li>when done, the Release manager signs off by doing something special (not sure what, perhaps committing a release token) which triggers the process</li>\n<li>The publication process is executed. If all is fine (no errors), the github release is then created.</li>\n</ol>",
        "id": 255700000,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633072289
    },
    {
        "content": "<p>I've kind of done something similar. Some additional steps that might be applicable:</p>\n<ol>\n<li>Test the IG using example resources that should validate without errors, and invalid resources (negative-tests) that does not conform to the IG and is expected to trigger validation errors. I've created a lib called <a href=\"https://github.com/navikt/fhir-validator-junit-engine\">fhir-validator-junit-engine</a> that might be of interest, the README contains example of how this can be integrated in a gh-action workflow.</li>\n<li>If you are planning  to automate the publishing of FHIR Packages this can be done by including the package as an asset in the GitHub-release. The package-feed.xml can then be generated from the GitHub releases API using a template and hosted on e.g. gh-pages, <a href=\"https://github.com/navikt/fhir/blob/main/package-feed.liquid\">here is an example of such a template using liquid</a>, and <a href=\"https://github.com/navikt/fhir/blob/main/.github/workflows/Update-package-feed.yml\">here is an example of a gh-action</a>.</li>\n</ol>",
        "id": 255707807,
        "sender_full_name": "Eirik Myklebost",
        "timestamp": 1633076612
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"223185\">@Eirik Myklebost</span> for this input.</p>",
        "id": 255734814,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633091099
    },
    {
        "content": "<p>The validator - do you use it besides the FHIR validator that is run with the FHIR IG publisher?</p>",
        "id": 255734818,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633091101
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/255734818\">said</a>:</p>\n<blockquote>\n<p>The validator - do you use it besides the FHIR validator that is run with the FHIR IG publisher?</p>\n</blockquote>\n<p>Yes. We use the junit-engine to get a TDD (test-driven-profiling if you'd like)  feedback-loop while working locally  on an IG. It is also used in pull-request <a href=\"https://docs.github.com/en/rest/reference/checks\">checks</a> for IGs to test validation of both valid and invalid resources, similar to how you would require unit-tests to pass before accepting a PR to a code project. These test resources are not necessarily included in the IG, especially when they are expected to be invalid according to the IG.</p>\n<p>The IG Publisher is still doing validation, but that is part of the deployment step, after the tests have passed and the PR has been merged.</p>",
        "id": 255737200,
        "sender_full_name": "Eirik Myklebost",
        "timestamp": 1633092256
    },
    {
        "content": "<p>good. While I'm reading on this, let me ping <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> <span class=\"user-mention\" data-user-id=\"195726\">@Jo√£o Almeida</span></p>",
        "id": 255738685,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633092960
    },
    {
        "content": "<blockquote>\n<p>especially when they are expected to be invalid according to the IG</p>\n</blockquote>\n<p>This has already come up. Perhaps the IG should explicitly have a way to include test cases that are in error?</p>",
        "id": 255796740,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633117046
    },
    {
        "content": "<p>Maybe a flag that says \"this is deliberately erroneous\" that then allows the suppression of errors? - or better yet, spits out those errors in a fragment that can be rendered along with the example?</p>",
        "id": 255830179,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633138336
    },
    {
        "content": "<p>From the testing discussion - I was initially thinking of an IG parameter \"skip_validation\" with the urls of those resources that are to be accepted even if invalid.</p>",
        "id": 255853388,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633163458
    },
    {
        "content": "<p>better to validate, and know that the errors are expected, and not errors in a different way</p>",
        "id": 255861548,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633171633
    },
    {
        "content": "<p>ok back to the procedure for publication, I think it could look likle this:<br>\n<a href=\"/user_uploads/10155/lD4gfyK350aiZqud5ySMeiJ8/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/lD4gfyK350aiZqud5ySMeiJ8/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/lD4gfyK350aiZqud5ySMeiJ8/image.png\"></a></div>",
        "id": 256151462,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633391043
    },
    {
        "content": "<p>short: </p>\n<ol>\n<li>release manager (person) creates a github branch for a release candidate. </li>\n<li>after a first build, release manager does all the manual stuff (no automation on that for now)</li>\n<li>\n<p>when all is ok, the release manager creates a release token which triggers the automatic publication for release (I have it scripted)<br>\nIf the script runs OK, </p>\n</li>\n<li>\n<p>an actual release is created (in github) with the package.tgz (and others?) as binaries</p>\n</li>\n<li>optionally the release manager needs to create a PR for the updated ig-registry</li>\n</ol>",
        "id": 256151879,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633391340
    },
    {
        "content": "<p>The whole thing seems automatable (where it should) while ensuring that there is a manual trigger which is expected to be preceded by all the human review that is necessary</p>",
        "id": 256152312,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633391636
    },
    {
        "content": "<p>Do you have any thoughts\\plans on automating the release-notes\\changelog and versioning? E.g. <a href=\"https://github.com/google-github-actions/release-please-action\">google's release-please action</a>.</p>",
        "id": 256231328,
        "sender_full_name": "Eirik Myklebost",
        "timestamp": 1633434545
    },
    {
        "content": "<p>I'll read up on this, thanks</p>",
        "id": 256234406,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633436097
    },
    {
        "content": "<p>For release notes, the only idea I have is that we could compile all the issues /changes that are closed in a release, and this would help create part of the release notes. Thus not automated , but assisted</p>",
        "id": 256253775,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633443676
    },
    {
        "content": "<p>(nevermind)</p>",
        "id": 256318517,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633467753
    },
    {
        "content": "<p>Is there a recommended / best branching strategy for releases?<br>\na) when we need to make a release we make a Release Candidate branch. We clean up and release that one while the main branch is getting our future work. <br>\nb) While we are cleaning up a release we keep the main line clean, all the development goes into a development branch.</p>",
        "id": 256357074,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633495796
    },
    {
        "content": "<p>Any recommendations?</p>",
        "id": 256357114,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633495803
    },
    {
        "content": "<p>There's a couple of flows that comes into mind: <a href=\"https://medium.com/@patrickporto/4-branching-workflows-for-git-30d0aaee7bf\">https://medium.com/@patrickporto/4-branching-workflows-for-git-30d0aaee7bf</a> / <a href=\"https://www.atlassian.com/git/tutorials/comparing-workflows\">https://www.atlassian.com/git/tutorials/comparing-workflows</a></p>",
        "id": 256950334,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1633867709
    },
    {
        "content": "<p>I know how I prefer my git branch strategy but that might not fit into other people's workflow</p>",
        "id": 256950388,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1633867764
    },
    {
        "content": "<p>ok so my script will work independently of which branch. As long as there is an approval to release, it will do so.</p>",
        "id": 257122868,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633990378
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> is it ok to make a change request to the Publisher to allow it to run without prompting for the <code>y</code> at the end?<br>\n(since I don't understand the <code>-filter</code> parameter, I don't dare make a PR)</p>",
        "id": 257123009,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1633990490
    },
    {
        "content": "<p>One further step on this:<br>\nI took the assumption that the ImplementationGuide.url should be in the form <br>\n{canonical}/ImplementationGuide/{ig_id}</p>\n<p><a href=\"https://confluence.hl7.org/pages/viewpage.action?pageId=104580055#ProcessforPublishingaFHIRImplementationGuide(fornonHL7IGs)-2.SetuptheIGforpublication\">https://confluence.hl7.org/pages/viewpage.action?pageId=104580055#ProcessforPublishingaFHIRImplementationGuide(fornonHL7IGs)-2.SetuptheIGforpublication</a></p>",
        "id": 265789954,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640169911
    },
    {
        "content": "<p>TBH I only did that because that somehow worked.</p>",
        "id": 265789979,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640169931
    },
    {
        "content": "<p>Is this necessary? Is the ImplementationGuide's URL supposed to be in that form?</p>",
        "id": 265790079,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640169989
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span>  this should matter to you</p>",
        "id": 265790659,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640170463
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I guess you're the one to help us here</p>",
        "id": 265790668,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640170477
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191916\">@ Bob Milius</span> just to say Hi on this :)</p>",
        "id": 265790682,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640170501
    },
    {
        "content": "<p>yes that's how it should be</p>",
        "id": 265790749,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1640170561
    },
    {
        "content": "<p>Should that URL resolve?</p>",
        "id": 265791757,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640171213
    },
    {
        "content": "<p>it generally should but it doesn't have to</p>",
        "id": 265792000,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1640171397
    },
    {
        "content": "<p>And what should it resolve to? The overall page of the ig / history page / something else?</p>",
        "id": 265795909,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640174451
    },
    {
        "content": "<p>Is there a good example where it resolves?</p>",
        "id": 265796047,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640174537
    },
    {
        "content": "<p>apparently not</p>",
        "id": 265796088,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1640174575
    },
    {
        "content": "<p>I</p>",
        "id": 265796100,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1640174586
    },
    {
        "content": "<p>I'll have to investigate that one</p>",
        "id": 265796105,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1640174591
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> could you perhaps also look into why the release script puts importance into the name of the folder where it is executed from?</p>",
        "id": 265796345,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640174768
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> if noone uses the feature of the IG's URL they way is it currently constructed, why then have it at all?</p>",
        "id": 265796488,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640174892
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> / <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> this is current issue (that hits me and probably others) that is probably triggered by implied naming convention:</p>\n<div class=\"codehilite\"><pre><span></span><code>Update /Users/jvi/hl7.fhir.dk.core/www for http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core\nError in /Users/jvi/hl7.fhir.dk.core/www/package-list.json:path to build.fhir.org should not use https://\n  /Users/jvi/hl7.fhir.dk.core/www/1.1.0: This page is part of the HL7 FHIR Implementation Guide: DK Core (v1.1.0: Release) based on &lt;a href=&quot;http://hl7.org/fhir/R4&quot;&gt;FHIR R4&lt;/a&gt;. This is the current published version in its permanent home (it will always be available at this URL).  For a full list of available versions, see the &lt;a href=&quot;http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core/history.html&quot;&gt;Directory of published versions &lt;img src=&quot;external.png&quot; style=&quot;text-align: baseline&quot;&gt;&lt;/a&gt;\n  .. 282 files checked, 282 updated\n  .. 101 clones checked, 202 updated\nProblem #15 with /Users/jvi/hl7.fhir.dk.core/www/1.1.0/package.tgz: expected canonical http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core but found http://hl7.dk/fhir/core\n  .. 0 redirections (0 created/updated)\n  /Users/jvi/hl7.fhir.dk.core/www: This page is part of the HL7 FHIR Implementation Guide: DK Core (v1.1.0: Release) based on &lt;a href=&quot;http://hl7.org/fhir/R4&quot;&gt;FHIR R4&lt;/a&gt;. This is the current published version.  For a full list of available versions, see the &lt;a href=&quot;http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core/history.html&quot;&gt;Directory of published versions &lt;img src=&quot;external.png&quot; style=&quot;text-align: baseline&quot;&gt;&lt;/a&gt;\n  .. 282 files checked, 282 updated\n  .. 204 clones checked, 0 updated\nProblem #15 with /Users/jvi/hl7.fhir.dk.core/www/package.tgz: expected canonical http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core but found http://hl7.dk/fhir/core\n  .. 0 redirections (0 created/updated)\njava.io.IOException: Source &#39;/Users/jvi/hl7.fhir.dk.core/www/dist-hist&#39; and destination &#39;/Users/jvi/hl7.fhir.dk.core/www/dist-hist&#39; are the same\n    at org.apache.commons.io.FileUtils.copyDirectory(FileUtils.java:1351)\n    at org.apache.commons.io.FileUtils.copyDirectory(FileUtils.java:1246)\n    at org.apache.commons.io.FileUtils.copyDirectory(FileUtils.java:1215)\n    at org.hl7.fhir.igtools.publisher.utils.IGReleaseUpdater.checkCopyFolderFromRoot(IGReleaseUpdater.java:261)\n    at org.hl7.fhir.igtools.publisher.utils.IGReleaseUpdater.check(IGReleaseUpdater.java:216)\n    at org.hl7.fhir.igtools.publisher.utils.IGWebSiteMaintainer.execute(IGWebSiteMaintainer.java:106)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8743)\n\n    Source &#39;/Users/jvi/hl7.fhir.dk.core/www/dist-hist&#39; and destination &#39;/Users/jvi/hl7.fhir.dk.core/www/dist-hist&#39; are the same\n</code></pre></div>",
        "id": 265796614,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640175008
    },
    {
        "content": "<p>right. This dist-hist thing happens every time I run the procedure, but I don't know where the folders should be to avoid it</p>",
        "id": 265798671,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640176109
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> the release script i made no longer enforces the folder name to be the same as ig id (i forgot why it was there, so we may have some surprises ahead)</p>",
        "id": 265798970,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640176273
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> where's the 'normative' version of the script?</p>",
        "id": 265831894,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640194923
    },
    {
        "content": "<p>I haven't released it formally yet..</p>",
        "id": 265834588,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640196360
    },
    {
        "content": "<p>but you can see it here<br>\n<a href=\"https://github.com/hl7-be/IG-release-pub/blob/master/release.py\">https://github.com/hl7-be/IG-release-pub/blob/master/release.py</a></p>",
        "id": 265834781,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1640196442
    },
    {
        "content": "<p>umm I don't understand this. dist-hist should be at the root, and will just be copied as necessary</p>",
        "id": 267026144,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641445540
    },
    {
        "content": "<p>dist-hist is not in <code>&lt;root&gt;</code>, but in the folder <code>&lt;root&gt;/fhir-ig-history-template</code>which is where the history template is cloned to</p>",
        "id": 267051794,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641469490
    },
    {
        "content": "<p>Is this the right place or do we have to copy the folder somewhere?</p>",
        "id": 267051836,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641469535
    },
    {
        "content": "<p>cloned to?</p>",
        "id": 267092960,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641492099
    },
    {
        "content": "<p>procedure is:<br>\n...</p>\n<ol start=\"6\">\n<li>\n<p>Change the working folder to the IG root folder<br>\n<code>cd my-ig</code></p>\n</li>\n<li>\n<p>Create a folder that will be your web root (typically the folder that you will publish to the web)<br>\n<code>md www</code></p>\n</li>\n<li>\n<p>Copy content of history template to web root folder<br>\n<code>xcopy /s /y ../fhir-ig-history-template/* www</code></p>\n</li>\n</ol>",
        "id": 267111456,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641501671
    },
    {
        "content": "<p>I don't think that 8 is correct.</p>",
        "id": 267111888,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641501932
    },
    {
        "content": "<p>you need the history template, but you just pass that as a reference to the publish process - it should be somewhere else</p>",
        "id": 267111925,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641501951
    },
    {
        "content": "<p>this ?<br>\n<code>java -jar ../publisher.jar -publish-update -folder www -registry ../ig-registry/fhir-ig-list.json -history ../fhir-ig-history-template</code></p>",
        "id": 267114441,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641503232
    },
    {
        "content": "<p>yes</p>",
        "id": 267114632,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641503319
    },
    {
        "content": "<p>(which actually points to ../fhir-ig-history-template), so point 8 seems useless)</p>",
        "id": 267114644,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641503325
    },
    {
        "content": "<p>but this is the procedure that causes the issue</p>",
        "id": 267114665,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641503341
    },
    {
        "content": "<p>in other words, if I run that line which points to ../fhir-ig-history-template, i get the error \"source dist-hist and target are the same..\"</p>",
        "id": 267114804,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641503412
    },
    {
        "content": "<p>because it has to be somewhere else</p>",
        "id": 267116587,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641504178
    },
    {
        "content": "<p>any idea where i should put it?</p>",
        "id": 267116621,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641504199
    },
    {
        "content": "<p>anywhere else</p>",
        "id": 267116635,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641504206
    },
    {
        "content": "<p>I get this<br>\nHistory Error: C:\\work\\ImplementationGuides\\dk-core\\www\\dist-hist doe not exist<br>\nHistory Error: C:\\work\\ImplementationGuides\\dk-core\\www\\assets-hist doe not exist<br>\nwhen running<br>\n<code>java -jar ../publisher.jar -publish-update -folder www -registry ../ig-registry/fhir-ig-list.json -history ./anywhereelse</code></p>",
        "id": 267118313,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641505152
    },
    {
        "content": "<p>(after copying the content of the history template to ./anywhereelse):</p>",
        "id": 267118904,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641505515
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/ovgd2EiaFnTHXidCmRGlljhM/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/ovgd2EiaFnTHXidCmRGlljhM/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/ovgd2EiaFnTHXidCmRGlljhM/image.png\"></a></div>",
        "id": 267118907,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641505516
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"281760\">@Manisha Mantri</span> this is the thread you want to know</p>",
        "id": 267151014,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641530779
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"261896\">@Sayali Pophalkar</span></p>",
        "id": 267151018,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641530797
    },
    {
        "content": "<p>Thank you</p>",
        "id": 267155557,
        "sender_full_name": "Manisha Mantri",
        "timestamp": 1641536553
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> any advice on how to fix the error I get?</p>",
        "id": 267176615,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641553451
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> - there is still something funky about the links generated when publishing. For instance when looking at <a href=\"https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-patient.html#profile\">https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-patient.html#profile</a> ( and IG that depens on the DK core)- <br>\n<a href=\"/user_uploads/10155/ANrQEysV1eAw232bjjwqwVqB/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/ANrQEysV1eAw232bjjwqwVqB/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/ANrQEysV1eAw232bjjwqwVqB/image.png\"></a></div><ul>\n<li>you will see the link is <a href=\"http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core/1.1.0/StructureDefinition-dk-core-patient.html\">http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core/1.1.0/StructureDefinition-dk-core-patient.html</a> - but it should have been <a href=\"http://hl7.dk/fhir/core/1.1.0/StructureDefinition-dk-core-patient.html\">http://hl7.dk/fhir/core/1.1.0/StructureDefinition-dk-core-patient.html</a> - with the <code>/ImplementationGuide/hl7.fhir.dk.core</code> omitted</li>\n</ul>",
        "id": 267575455,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641905157
    },
    {
        "content": "<p>I suspect someone put the full URL for the IG somewhere they should have put the canonical URL for the IG root.</p>",
        "id": 267593054,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1641913143
    },
    {
        "content": "<p>That must be the publish script I assume <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> ?</p>",
        "id": 267613711,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641921234
    },
    {
        "content": "<p>don't see how it could be. This comes from the IG itself</p>",
        "id": 267613970,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641921325
    },
    {
        "content": "<p><a href=\"https://github.com/hl7dk/dk-core/tree/1.1.0\">https://github.com/hl7dk/dk-core/tree/1.1.0</a> is the state of the IG when I ran the script</p>",
        "id": 267614289,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641921474
    },
    {
        "content": "<p>I also see that the web base on the qa page has the same wrong address</p>",
        "id": 267614437,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641921528
    },
    {
        "content": "<p>The script being <a href=\"https://github.com/hl7dk/dk-core/blob/1.1.0/release.py\">https://github.com/hl7dk/dk-core/blob/1.1.0/release.py</a></p>",
        "id": 267614662,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641921621
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> are you saying you dont think it is a bug?</p>",
        "id": 267621658,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641924305
    },
    {
        "content": "<p>it's a bug somewhere. But where?</p>",
        "id": 267621698,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641924327
    },
    {
        "content": "<p>I hope to catch <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> for a moment and see if he has a clue</p>",
        "id": 267622218,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641924573
    },
    {
        "content": "<p>Sorry for the delay. From what I can see, the issue is visible not in the dk-core, but on an ig that depends on dk-core, right?</p>",
        "id": 267625800,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641926124
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span></p>",
        "id": 267625863,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641926152
    },
    {
        "content": "<p>the dk-core ig seems ok (unless I'm missing sometyhing)</p>",
        "id": 267626100,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641926258
    },
    {
        "content": "<p>Yes and no</p>",
        "id": 267626221,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641926303
    },
    {
        "content": "<p>It looks correct from the inside</p>",
        "id": 267626275,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641926329
    },
    {
        "content": "<p>But when you depend it there is yet another warning</p>",
        "id": 267626347,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641926367
    },
    {
        "content": "<p>What ... ?<br>\n<code>Publishing Content Failed: Cannot invoke \"com.google.gson.JsonElement.getAsString()\" because the return value of \"com.google.gson.JsonObject.get(String)\" is null (00:46.0809)\n</code> - that one is for you <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 267628122,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641927115
    },
    {
        "content": "<p>happens when running <code>genonce</code>on the DK Core IG</p>",
        "id": 267628201,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641927144
    },
    {
        "content": "<p>using IG Pub 1.1.94 (latest stable)</p>",
        "id": 267628241,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641927164
    },
    {
        "content": "<p>wait ... my bad ... wrong directory</p>",
        "id": 267629604,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641927750
    },
    {
        "content": "<p>nope ... it was it fact the right directory</p>",
        "id": 267630022,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641927965
    },
    {
        "content": "<p>The bug is real - and the following error is also present <code>Error setting locale for jurisdiction: Cannot invoke \"String.toUpperCase()\" because \"c\" is null (00:15.0436)</code></p>",
        "id": 267630067,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641927991
    },
    {
        "content": "<p>i'm lost</p>",
        "id": 267630579,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641928243
    },
    {
        "content": "<p>how do i replicate this on my machine?</p>",
        "id": 267630589,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641928253
    },
    {
        "content": "<p>(the implementationguide/hl7.fhir.dk.core thing)</p>",
        "id": 267630639,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641928289
    },
    {
        "content": "<p>2 sec</p>",
        "id": 267630774,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641928367
    },
    {
        "content": "<p>ok ... if you run <code>python3 release.py release.json</code>from the HEAD of the master branch</p>",
        "id": 267631083,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641928536
    },
    {
        "content": "<p>The package-feed.xml will look like the following:</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;rss xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:content=&quot;http://purl.org/rss/1.0/modules/content/&quot; xmlns:fhir=&quot;http://hl7.org/fhir/feed&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot; version=&quot;2.0&quot;&gt;\n  &lt;channel&gt;\n    &lt;title&gt;HL7DK FHIR Packages&lt;/title&gt;\n    &lt;description&gt;New Packages published by HL7DK&gt;&lt;/description&gt;\n    &lt;link&gt;http://hl7.dk/fhir/corehl7.fhir.dk.core/package-feed.xml&lt;/link&gt;\n    &lt;generator&gt;HL7, Inc FHIR Publication tooling&lt;/generator&gt;\n    &lt;lastBuildDate&gt;Sun, 19 Dec 2021 09:10:14 GMT&lt;/lastBuildDate&gt;\n    &lt;atom:link href=&quot;http://hl7.dk/fhir/corehl7.fhir.dk.core/package-feed.xml&quot; rel=&quot;self&quot; type=&quot;application/rss+xml&quot;/&gt;\n    &lt;pubDate&gt;Sun, 19 Dec 2021 09:10:14&lt;/pubDate&gt;\n    &lt;language&gt;en&gt;&lt;/language&gt;\n    &lt;ttl&gt;600&lt;/ttl&gt;\n    &lt;item&gt;\n      &lt;title&gt;hl7.fhir.dk.core#1.1.0&lt;/title&gt;\n      &lt;description&gt;A FHIR Implementation Guide for the Danish common needs across healthcare sectors (built Sun, Dec 19, 2021 21:09+0100+01:00)&lt;/description&gt;\n      &lt;link&gt;http://hl7.dk/fhir/corehl7.fhir.dk.core/1.1.0/package.tgz&lt;/link&gt;\n      &lt;guid isPermaLink=&quot;true&quot;&gt;http://hl7.dk/fhir/corehl7.fhir.dk.core/1.1.0/package.tgz&lt;/guid&gt;\n      &lt;dc:creator&gt;HL7DK&lt;/dc:creator&gt;\n      &lt;fhir:version&gt;4.0.1&lt;/fhir:version&gt;\n      &lt;fhir:kind&gt;fhir.ig&lt;/fhir:kind&gt;\n      &lt;pubDate&gt;Sat, 18 Dec 2021 12:00:00 GMT&lt;/pubDate&gt;\n    &lt;/item&gt;\n  &lt;/channel&gt;\n&lt;/rss&gt;\n</code></pre></div>",
        "id": 267631188,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641928577
    },
    {
        "content": "<p>The <code>http://hl7.dk/fhir/corehl7.fhir.dk.core/package-feed.xml</code> is missing a <code>/</code></p>",
        "id": 267631214,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641928597
    },
    {
        "content": "<p>now I can't tell if any fixes in the IGPublisher since the publication has fixed the <code>/ImplementationGuide/&lt;id&gt;</code></p>",
        "id": 267631355,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641928674
    },
    {
        "content": "<p>and <code>http://hl7.dk/fhir/corehl7.fhir.dk.core/package-feed.xml</code> is not correct either ... The link should simply be <code>http://hl7.dk/fhir/core</code>as that is the base URL</p>",
        "id": 267631606,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641928782
    },
    {
        "content": "<p>so it looks like the √¨d`is appended when it should not be appended at all</p>",
        "id": 267631704,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641928818
    },
    {
        "content": "<p>You follow <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> ?</p>",
        "id": 267631837,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641928883
    },
    {
        "content": "<p>and <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> another thing - the publish script still insist on that the folder it runs in should have the name of the Id of the IG ... <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 267634598,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641930241
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267630067\">said</a>:</p>\n<blockquote>\n<p>The bug is real - and the following error is also present <code>Error setting locale for jurisdiction: Cannot invoke \"String.toUpperCase()\" because \"c\" is null (00:15.0436)</code></p>\n</blockquote>\n<p>I just noticed this on my build too. From the debugging I could to, it doesn't like my jurisdiction:</p>\n<div class=\"codehilite\"><pre><span></span><code>  &lt;jurisdiction&gt;\n    &lt;coding&gt;\n      &lt;system value=&quot;urn:iso:std:iso:3166&quot;/&gt;\n      &lt;code value=&quot;CA&quot;/&gt;\n    &lt;/coding&gt;\n  &lt;/jurisdiction&gt;\n</code></pre></div>\n<p>It's trying to find CA in iso:3166:-2 (3166:-2 is subnational jurisdictions, not 2-letter jurisdictions.)</p>\n<p>I don't think that's your larger problem though.</p>",
        "id": 267636105,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1641930978
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267634598\">said</a>:</p>\n<blockquote>\n<p>and <span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> another thing - the publish script still insist on that the folder it runs in should have the name of the Id of the IG ... <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>you didn't have the fix in your branch. I made a PR now</p>",
        "id": 267636175,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641931014
    },
    {
        "content": "<p>(made the PR in the 1.1.0 branch)</p>",
        "id": 267636516,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641931166
    },
    {
        "content": "<p>for the rest, the trailing / etc - can i look into this tomorrow? I am struggling to finish some  slides for a session I'm hosting tomorrow</p>",
        "id": 267636948,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641931323
    },
    {
        "content": "<p>Sure - just happy to receive help</p>",
        "id": 267637953,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641931751
    },
    {
        "content": "<p>Arh ... The PR is targeted 1.1.0 and not master but I can fix it locally</p>",
        "id": 267638144,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641931846
    },
    {
        "content": "<p>ok. so let's have some documentation: <a href=\"https://confluence.hl7.org/display/FHIR/Maintaining+a+FHIR+IG+Publication\">https://confluence.hl7.org/display/FHIR/Maintaining+a+FHIR+IG+Publication</a></p>",
        "id": 267666840,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641947063
    },
    {
        "content": "<p>comments welcome</p>",
        "id": 267666844,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1641947066
    },
    {
        "content": "<p>Thank you!</p>",
        "id": 267671865,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1641950890
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> let me know if I can assist you any time today debugging</p>",
        "id": 267693241,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641975710
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> for this.</p>",
        "id": 267698938,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641979102
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> After my webinar today i'll use Grahame's notes and will step through the script, updating where needed. Want to do it together, or you want me to suffer the first impact and then you jump in?</p>",
        "id": 267699003,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641979151
    },
    {
        "content": "<p>That depends on when your webinar ends</p>",
        "id": 267704888,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641982515
    },
    {
        "content": "<p>I meant _as of_ , not immediately after</p>",
        "id": 267706836,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1641983832
    },
    {
        "content": "<p>You got a rough point in time?</p>",
        "id": 267725202,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641994932
    },
    {
        "content": "<p>I'm getting the same error on PDex <br>\nError setting locale for jurisdiction: Cannot invoke \"String.toUpperCase()\" because \"c\" is null (00:46.0593)<br>\nProcessing Conformance Resources                                                 (00:46.0594)<br>\nGenerating Snapshots                                                             (00:46.0854)<br>\nGenerating Narratives                                                            (00:47.0352)<br>\nValidating Conformance Resources                                                 (01:25.0239)<br>\nPublishing Content Failed: Error parsing JSON source: Unexpected char '&lt;' in json stream at Line 1 (path=[null]) (01:32.0469)</p>",
        "id": 267739559,
        "sender_full_name": "Mark Scrimshire",
        "timestamp": 1642001173
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> since I missed the vilcan track to show my resources and the next session is only in 1 hour, I'm getting into this now</p>",
        "id": 267746193,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642003888
    },
    {
        "content": "<p>seeing  same in RA</p>",
        "id": 267748509,
        "sender_full_name": "Linda",
        "timestamp": 1642004866
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> using the go-publish approach brings back the issues I had with the canonical urls - it says <code>canonical URL of https://costateixeira.github.io/hl7.fhir.be.core does not match the required canonical of http://hl7.org/fhir/be/core</code></p>",
        "id": 267750784,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642005781
    },
    {
        "content": "<p>right. that's an actual issue.</p>",
        "id": 267756756,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642008075
    },
    {
        "content": "<p>why aren't you publishing at the canonical URL?</p>",
        "id": 267756814,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642008099
    },
    {
        "content": "<blockquote>\n<p>Error setting locale for jurisdiction: Cannot invoke \"String.toUpperCase()\" because \"c\" is null (00:46.0593)</p>\n</blockquote>\n<p>A bunch of people have reported this, but I just can't reproduce this ?</p>",
        "id": 267758180,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642008616
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267756814\">said</a>:</p>\n<blockquote>\n<p>why aren't you publishing at the canonical URL?</p>\n</blockquote>\n<p>Where do we set the required canonical URL? I'm looking at non-HL7 IGs</p>",
        "id": 267758305,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642008686
    },
    {
        "content": "<p>you define it</p>",
        "id": 267758564,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642008807
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267758180\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>Error setting locale for jurisdiction: Cannot invoke \"String.toUpperCase()\" because \"c\" is null (00:46.0593)</p>\n</blockquote>\n<p>A bunch of people have reported this, but I just can't reproduce this ?</p>\n</blockquote>\n<p>I investigated a bit, and you're validating against iso 3166:-2, not 3166.</p>\n<p>I see it in the test repo I sent you yesterday.</p>",
        "id": 267759015,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1642008987
    },
    {
        "content": "<p>like I said, I can't reproduce it</p>",
        "id": 267759090,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642009027
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267758564\">said</a>:</p>\n<blockquote>\n<p>you define it</p>\n</blockquote>\n<p>Where?</p>",
        "id": 267759259,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642009096
    },
    {
        "content": "<p>(maybe I should just acknowledge the thread has been hijacked and start a new one..?)</p>",
        "id": 267759368,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642009168
    },
    {
        "content": "<p>the canonical is in the npm package, based on what the IG defines</p>",
        "id": 267759614,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642009284
    },
    {
        "content": "<p>the URLs (ig.,url, ig.canonical and package-list) are all the same</p>",
        "id": 267763446,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642010910
    },
    {
        "content": "<p>what are they?</p>",
        "id": 267763473,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642010924
    },
    {
        "content": "<p>maybe I need to build the ig first to set the npm package right</p>",
        "id": 267763504,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642010938
    },
    {
        "content": "<p>the url is <br>\n<a href=\"https://costateixeira.github.io/hl7.fhir.be.core\">https://costateixeira.github.io/hl7.fhir.be.core</a></p>",
        "id": 267763528,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642010947
    },
    {
        "content": "<p>yes that's true, you do need to do a local build with the URLs correct.</p>",
        "id": 267764897,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642011531
    },
    {
        "content": "<p>because the QA checks that run first assume that these things are all correct and you've run a local build to verify that everything is building correctly (per documented process)</p>",
        "id": 267764950,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642011567
    },
    {
        "content": "<p>still same issue.</p>",
        "id": 267770291,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642013975
    },
    {
        "content": "<p>my package.json inside package.tgz says<br>\n  \"canonical\": \"<a href=\"https://costateixeira.github.io/hl7.fhir.be.core\">https://costateixeira.github.io/hl7.fhir.be.core</a>\",</p>",
        "id": 267770445,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642014018
    },
    {
        "content": "<p>I think it may be the java code that's doing this. I see no reference to <code>hl7.org/fhir/be/</code> in the artifacts</p>",
        "id": 267771218,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642014357
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> can I be of any help?</p>",
        "id": 267786061,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642021501
    },
    {
        "content": "<p>If you want to go through the process that Grahame described... You also have an affiliate IG so it could be useful to see if you end up with similar result</p>",
        "id": 267786394,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642021670
    },
    {
        "content": "<p>)Perhaps the problem is in my brain. But I don't expect my brain to have issues, it's almost brand new and rarely used.)</p>",
        "id": 267786764,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642021840
    },
    {
        "content": "<p>Well this is still broken: <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267631188\">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267631188</a></p>",
        "id": 267791618,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642024477
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> have you debugged this part? <a href=\"https://github.com/hl7dk/dk-core/blob/4216254684cec264a1d61a8189244017f67dff08/release.py#L156\">https://github.com/hl7dk/dk-core/blob/4216254684cec264a1d61a8189244017f67dff08/release.py#L156</a></p>",
        "id": 267799249,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642028449
    },
    {
        "content": "<p>It doesnt look correct to me</p>",
        "id": 267799281,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642028463
    },
    {
        "content": "<p>That code was a way to get the canonical URL from the IG and also check that the URL contains the ig_id/ImplementationGuide/ig_id pattern. It does that job but is not clear to understand or change. I'll improve that</p>",
        "id": 267803313,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642030563
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267770445\">said</a>:</p>\n<blockquote>\n<p>my package.json inside package.tgz says<br>\n  \"canonical\": \"<a href=\"https://costateixeira.github.io/hl7.fhir.be.core\">https://costateixeira.github.io/hl7.fhir.be.core</a>\",</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  Still same issue - something seems to be forcing for a <a href=\"http://hl7.org\">hl7.org</a> url</p>",
        "id": 267809489,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642034619
    },
    {
        "content": "<p>Well ... there are some assumptions in the computations that do not hold</p>",
        "id": 267846996,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642068241
    },
    {
        "content": "<p>The IG url that is fetched on <a href=\"https://github.com/hl7dk/dk-core/blob/4216254684cec264a1d61a8189244017f67dff08/release.py#L157\">https://github.com/hl7dk/dk-core/blob/4216254684cec264a1d61a8189244017f67dff08/release.py#L157</a> from the IG resource in the DK core ends up being <code>http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core</code></p>",
        "id": 267847108,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642068311
    },
    {
        "content": "<p>On line 163 that ends up assigning the base to <code>http://hl7.dk/fhir/core/ImplementationGuide/</code>which should have been <code>http://hl7.dk/fhir/core</code></p>",
        "id": 267847231,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642068368
    },
    {
        "content": "<p>I would think (depending on the meaning of <code>base</code>)</p>",
        "id": 267847256,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642068391
    },
    {
        "content": "<p>As shown in the QA page for eg. <a href=\"https://build.fhir.org/ig/hl7dk/dk-core/qa.html\">https://build.fhir.org/ig/hl7dk/dk-core/qa.html</a> - The canonical should be <code>http://hl7.dk/fhir/core</code>and the package-id should be `hl7.fhir.dk.core. Package-id seems to be correct for the time being</p>",
        "id": 267847515,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642068546
    },
    {
        "content": "<p>So ... going back to the drawing board ...</p>",
        "id": 267849705,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642069874
    },
    {
        "content": "<p>The DK QA page says (as I expected, correctly) that the Canonical is <code>http://hl7.dk/fhir/core</code></p>",
        "id": 267849809,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642069940
    },
    {
        "content": "<p>The documentation states:<br>\n<a href=\"/user_uploads/10155/5Evy_m2TXxywsWjIymBXMeIV/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/5Evy_m2TXxywsWjIymBXMeIV/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/5Evy_m2TXxywsWjIymBXMeIV/image.png\"></a></div>",
        "id": 267849826,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642069954
    },
    {
        "content": "<p>So ... when the FSH calculated ImplementationGuide.url ends up being (which all the calculations afterwards depends on):<br>\n<a href=\"/user_uploads/10155/JiquSjthl2GpIQ1THTBVynPa/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/JiquSjthl2GpIQ1THTBVynPa/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/JiquSjthl2GpIQ1THTBVynPa/image.png\"></a></div>",
        "id": 267849896,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642070018
    },
    {
        "content": "<p>Is that then incorrect?</p>",
        "id": 267849909,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642070033
    },
    {
        "content": "<p>Shoulnd't that url just have been <code>http://hl7.dk/fhir/core</code> ?</p>",
        "id": 267849993,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642070072
    },
    {
        "content": "<p>So <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> if I'm correct - the ig_canonical should be calculated as this: <code>ig_canonical = url_data[0].split('/ImplementationGuide/')[0]</code></p>",
        "id": 267851390,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642070892
    },
    {
        "content": "<p>If I add the following logging around line 240-ish</p>\n<div class=\"codehilite\"><pre><span></span><code>        print (&quot;URL in ig.ini does not match that of the IG&quot;)\n        print (&quot;URL in ig.ini:&quot; + publishini[&#39;website&#39;][&#39;url&#39;])\n        print (&quot;ig_canonical: &quot; + ig_canonical )\n</code></pre></div>",
        "id": 267851529,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642070989
    },
    {
        "content": "<p>I get this:</p>\n<div class=\"codehilite\"><pre><span></span><code>### Reading and checking publish.ini\nURL in ig.ini does not match that of the IG\nURL in ig.ini:http://hl7.dk/fhir/core/ImplementationGuide/hl7.fhir.dk.core\nig_canonical: http://hl7.dk/fhir/core\n</code></pre></div>",
        "id": 267851589,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642071004
    },
    {
        "content": "<p>now, the publish.ini is autogenerated and reflects the URL in the ImplementationGuide.url resource - which I'm more and more convinced is wrong</p>",
        "id": 267851916,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642071172
    },
    {
        "content": "<p>Now - someone tell me I'm wrong.</p>",
        "id": 267851943,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642071185
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267849896\">said</a>:</p>\n<blockquote>\n<p>So ... when the FSH calculated ImplementationGuide.url ends up being (which all the calculations afterwards depends on):<br>\n<a href=\"/user_uploads/10155/JiquSjthl2GpIQ1THTBVynPa/image.png\">image.png</a></p>\n</blockquote>\n<p>I haven't followed this whole conversation closely enough to know what's really going on (sorry)!  But... I <em>think</em> SUSHI does the right thing here.  There is a difference between the canonical base for an IG and the canonical URL for the IG resource.  And I think it is correct for the canonical URL of the IG resource to end in <code>/ImplementationGuide/${packageId}</code>.  I think you'll find this pattern in nearly all (if not ALL) HL7 IGs.  For example, US Core: <a href=\"http://www.hl7.org/fhir/us/core/ImplementationGuide-hl7.fhir.us.core.html\">http://www.hl7.org/fhir/us/core/ImplementationGuide-hl7.fhir.us.core.html</a>.</p>",
        "id": 267871263,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1642082101
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  Yeah - I've seen the same pattern for the other Ig's as well so I agree with you</p>",
        "id": 267873448,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642083066
    },
    {
        "content": "<p>That then brings we to the question: Is it the case that the canonical base is only indirectly included in the ImplementationGuide resource?</p>",
        "id": 267873645,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642083150
    },
    {
        "content": "<p>And if you are correct - (which I believe you are) - I think the documentation on the ImplementationGuide.url should be a bit more precise in its wording or at least state an example:</p>\n<p><code>An absolute URI that is used to identify this implementation guide when it is referenced in a specification, model, design or an instance; also called its canonical identifier. This SHOULD be globally unique and SHOULD be a literal address at which at which an authoritative instance of this implementation guide is (or will be) published. This URL can be the target of a canonical reference. It SHALL remain the same when the implementation guide is stored on different servers.</code></p>",
        "id": 267873941,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642083269
    },
    {
        "content": "<p>AFAIK, there is no requirement that the canonical ends with ${packageId}. It just ends with the <a href=\"http://ImplementationGuide.id\">ImplementationGuide.id</a> from the ImplementationGuide resource.</p>\n<p>See <a href=\"https://build.fhir.org/ig/HL7/fhir-ipa/branches/master/qa.html\">https://build.fhir.org/ig/HL7/fhir-ipa/branches/master/qa.html</a></p>",
        "id": 267874183,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1642083377
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span> - I may have been overly prescriptive.  You're right that the id in the URI needs to match the id on the ImplementationGuide resource.  That is what's most important -- so thanks for the correction. Perhaps having the IG resource id match the package id is just a best practice?  I know I've definitely seen it a <em>lot</em>.</p>",
        "id": 267877348,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1642084689
    },
    {
        "content": "<p>I don't think it is a best practice for all cases. From what I understood, for HL7 published IGs, the <a href=\"http://ImplementationGuide.id\">ImplementationGuide.id</a> must match the code in the approval document, and that is usually not the packageId.</p>",
        "id": 267881468,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1642086454
    },
    {
        "content": "<p>How is the URL that goes into publish.ini supposed to look like?</p>",
        "id": 267903608,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642095368
    },
    {
        "content": "<p>Should that be the canonical or the value of ImplementationGuide.url</p>",
        "id": 267904453,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642095742
    },
    {
        "content": "<p>The value of <code>ImplementationGuide.url</code> <strong>is</strong> the canonical of the IG.</p>",
        "id": 267906203,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1642096531
    },
    {
        "content": "<p>Okay ...</p>",
        "id": 267909267,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642097921
    },
    {
        "content": "<p>Well ... <a href=\"https://fshschool.org/docs/sushi/configuration/\">https://fshschool.org/docs/sushi/configuration/</a> says that the canonical here is the canonical URL - not the base</p>",
        "id": 267910421,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642098481
    },
    {
        "content": "<p>Right?</p>",
        "id": 267910566,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642098539
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span></p>",
        "id": 267914693,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642100497
    },
    {
        "content": "<p>afaik sushi does assume that the IG's id is the same as the package id but we can override that by specifying both the id and the packageid</p>",
        "id": 267916011,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642101053
    },
    {
        "content": "<p>the canonical I've seen documented and has worked (kind of) so far is the one with the full canonical path of the implementationguide resource, not the base url for the canonicals in the IG's resources</p>",
        "id": 267916131,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642101119
    },
    {
        "content": "<p>Regardless - <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> the publish script currently stops on <a href=\"https://github.com/hl7dk/dk-core/blob/master/release.py#L239\">https://github.com/hl7dk/dk-core/blob/master/release.py#L239</a></p>",
        "id": 267923942,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642104755
    },
    {
        "content": "<p>Due to the fact that the content of the generated publish.ini contains:</p>\n<div class=\"codehilite\"><pre><span></span><code>[website]\nstyle = fhir.layout\nserver = apache\nurl = http://hl7.dk/fhir/corehl7.fhir.dk.core\norg = HL7DK\nno-registry = 1\n\n[feeds]\npackage = package-feed.xml\npublication = publication-feed.xml\n</code></pre></div>",
        "id": 267924003,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642104795
    },
    {
        "content": "<p>finally getting to look at this...</p>",
        "id": 267924046,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642104829
    },
    {
        "content": "<p>the publication process gets the canonical from the npm package</p>",
        "id": 267924128,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642104861
    },
    {
        "content": "<p>then it checks the canonical against the package id using some business rules that I think apply for HL7 publications. If they are wrong for some affiliates, we can discuss that.</p>",
        "id": 267924219,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642104929
    },
    {
        "content": "<p>then it loads the package-list from the destination and cross-checks all the canonicals and package ids</p>",
        "id": 267924320,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642104970
    },
    {
        "content": "<p>and it also checks that the websites publish.ini matches the canonical URL</p>",
        "id": 267924381,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642105007
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> that publish.ini is not correct</p>",
        "id": 267924403,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642105019
    },
    {
        "content": "<p>its generated ...</p>",
        "id": 267924423,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642105033
    },
    {
        "content": "<p>by this: <a href=\"https://github.com/hl7dk/dk-core/blob/4216254684cec264a1d61a8189244017f67dff08/release.py#L217\">https://github.com/hl7dk/dk-core/blob/4216254684cec264a1d61a8189244017f67dff08/release.py#L217</a></p>",
        "id": 267924452,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642105053
    },
    {
        "content": "<p>the publish.ini url is where the root of the folder is published - I would expect it to be <a href=\"http://hl7.dk/fhir\">http://hl7.dk/fhir</a></p>",
        "id": 267924479,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642105076
    },
    {
        "content": "<p>that sounds about right - so what did I specify incorrectly?</p>",
        "id": 267924601,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642105133
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267910421\">said</a>:</p>\n<blockquote>\n<p>Well ... <a href=\"https://fshschool.org/docs/sushi/configuration/\">https://fshschool.org/docs/sushi/configuration/</a> says that the canonical here is the canonical URL - not the base.<br>\nRight?</p>\n</blockquote>\n<p>That's probably just imprecise language on our part.  The intention is that the <code>canonical</code> field in the config (or in sushi-config.yaml) is really the <em>base</em> canonical for the IG (as opposed to the canonical of the IG resource).  Sorry for any confusion there.</p>",
        "id": 267924883,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1642105273
    },
    {
        "content": "<p>there may be some confusion in the spec here - I originally just used the base canonical, but <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> insisted (rightly <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> ) that the canonical URL for the IG resource is not the same as the canonical base for the IG as a whole. So as long as I have any say - which is in all the tools - there'll be an algorithmic relationship between the two, since it's the base one that I care about</p>",
        "id": 267925084,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642105394
    },
    {
        "content": "<p>May I suggest that you add examples in the doc where possible since the language is not clear</p>",
        "id": 267925693,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642105696
    },
    {
        "content": "<p>which doc?</p>",
        "id": 267925924,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642105813
    },
    {
        "content": "<p>for starters  - the fsh configuration page</p>",
        "id": 267925977,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642105836
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267924479\">said</a>:</p>\n<blockquote>\n<p>the publish.ini url is where the root of the folder is published - I would expect it to be <a href=\"http://hl7.dk/fhir\">http://hl7.dk/fhir</a></p>\n</blockquote>\n<p>where is it possible to specify the root folder?</p>",
        "id": 267926222,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642105958
    },
    {
        "content": "<p>in the publish.ini</p>",
        "id": 267926364,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106035
    },
    {
        "content": "<p>aint that a product of running <a href=\"https://github.com/hl7dk/dk-core/blob/4216254684cec264a1d61a8189244017f67dff08/release.py#L217\">https://github.com/hl7dk/dk-core/blob/4216254684cec264a1d61a8189244017f67dff08/release.py#L217</a> ?</p>",
        "id": 267926476,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642106093
    },
    {
        "content": "<p>I don't know what that py file is, but for me, publish.ini is an independent input - why generate it?</p>",
        "id": 267926563,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106147
    },
    {
        "content": "<p>nothing in there can be inferred from anywhere else</p>",
        "id": 267926634,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106171
    },
    {
        "content": "<p>that explains some parts ... <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> - looks like we still got work to do</p>",
        "id": 267926659,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642106195
    },
    {
        "content": "<p>So this web IG root should probably go into the <code>release.json</code></p>",
        "id": 267926748,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642106246
    },
    {
        "content": "<p>why?</p>",
        "id": 267926895,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106325
    },
    {
        "content": "<p>it's a property of the website, nothing to do with any release</p>",
        "id": 267926923,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106342
    },
    {
        "content": "<p>the <code>release.json</code> is the parameter file that is used to control the python script</p>",
        "id": 267926954,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642106367
    },
    {
        "content": "<p>I'm looking at this now</p>",
        "id": 267927372,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642106573
    },
    {
        "content": "<p>I don't know what the python script is doing, but publish.ini is input into any automated process, not output</p>",
        "id": 267927522,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106644
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267927522\">said</a>:</p>\n<blockquote>\n<p>I don't know what the python script is doing, but publish.ini is input into any automated process, not output</p>\n</blockquote>\n<p>indeed</p>",
        "id": 267927553,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642106663
    },
    {
        "content": "<p>perhaps useful to separate a few things</p>",
        "id": 267927584,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642106686
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> where in the script is it publish.ini generated?</p>",
        "id": 267927585,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642106686
    },
    {
        "content": "<p>the python script is not an official thing (yet? - but there would be several discussions for that). It's a way to automate the procedure described by Grahame. Automation not to save effort, but to avoid variance</p>",
        "id": 267927687,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642106748
    },
    {
        "content": "<p>if it can be used by the belgium affiliate and used by the danish affiliate ...</p>",
        "id": 267927804,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642106797
    },
    {
        "content": "<p>i would say it can be used by any affiliate</p>",
        "id": 267927819,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642106806
    },
    {
        "content": "<p>what does it automate?</p>",
        "id": 267927828,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106810
    },
    {
        "content": "<p>(right, we'll get there. let me type a few more things)</p>",
        "id": 267927838,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642106816
    },
    {
        "content": "<p>the python script takes a \"release token\" that contains all the information that is needed for the procedure - namely the data that would be needed to say \"hey, there's an IG, take this data and go make a release\".</p>",
        "id": 267927902,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642106856
    },
    {
        "content": "<p>It would be helpful to document the applicable canonical better for package-list.json and package.json.</p>",
        "id": 267927904,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1642106856
    },
    {
        "content": "<p>this is the release.json. release.json is a proposal. I think it makes sense at least in this phase but hopefully in the long run, if we agree that we could automate the release build (only the build part)</p>",
        "id": 267928074,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642106931
    },
    {
        "content": "<p>well, I do need to automate this for HL7. But what I need to automate is:</p>",
        "id": 267928139,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106959
    },
    {
        "content": "<ul>\n<li>update the local copy of the website</li>\n<li>execute the -go-publish process</li>\n<li>update the changes to the website</li>\n</ul>",
        "id": 267928193,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642106990
    },
    {
        "content": "<p>Before you type anything more ... a wild guess would be that the requirements by HL7 org is beyond affiliate needs</p>",
        "id": 267928267,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642107011
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267928267\">said</a>:</p>\n<blockquote>\n<p>Before you type anything more ... a wild guess would be that the requirements by HL7 org is beyond affiliate needs</p>\n</blockquote>\n<p>Or a non-affiliate.</p>",
        "id": 267928318,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1642107043
    },
    {
        "content": "<p>what I don't know how to automate is:</p>\n<ul>\n<li>check that the proposed release is administratively correct (e.g. business rules)</li>\n<li>check that the publication succeeded (there is a myriad of things go wrong in practice, including file locking problems)</li>\n</ul>",
        "id": 267928321,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642107046
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267927828\">said</a>:</p>\n<blockquote>\n<p>what does it automate?</p>\n</blockquote>\n<p>roughly: </p>\n<ol>\n<li>setup the folders as needed</li>\n<li>clone what is needed - ig-history and ig-registry</li>\n<li>create the publish.ini if one does not exist</li>\n<li>run a first build of the ig</li>\n<li>create/update the package.ini</li>\n<li>run the final publish step</li>\n<li>do a minor update for the history page template to work</li>\n</ol>",
        "id": 267928349,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642107061
    },
    {
        "content": "<p>everything else is already automated</p>",
        "id": 267928356,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642107063
    },
    {
        "content": "<p>what's the package.ini?</p>",
        "id": 267928410,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642107096
    },
    {
        "content": "<p>and what's the minor update?</p>",
        "id": 267928420,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642107100
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> I just found the first bug ... you don't start deleting any existing <code>www</code>-folder</p>",
        "id": 267928544,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642107163
    },
    {
        "content": "<p>the main change I want to make to the existing -go-publish process is that the release information is buried in a local edited copy of the package-list.json file, and that's massively confusing for editors who think that they're somehow maintaining package-list.json in their repository, and keep trying to revise the past publication history, but they can't</p>",
        "id": 267928580,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642107180
    },
    {
        "content": "<p>(trying to catch up here)</p>",
        "id": 267928595,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642107187
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267928580\">said</a>:</p>\n<blockquote>\n<p>the main change I want to make to the existing -go-publish process is that the release information is buried in a local edited copy of the package-list.json file, and that's massively confusing for editors who think that they're somehow maintaining package-list.json in their repository, and keep trying to revise the past publication history, but they can't</p>\n</blockquote>\n<p>this is good to know</p>",
        "id": 267928686,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642107239
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267928420\">said</a>:</p>\n<blockquote>\n<p>and what's the minor update?</p>\n</blockquote>\n<p>IIRC it's about applying a skin to the history page</p>",
        "id": 267928811,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642107283
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267928544\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> I just found the first bug ... you don't start deleting any existing <code>www</code>-folder</p>\n</blockquote>\n<p>possibly. I don't think that causes anything to be broken. But once this is working fine we can add this</p>",
        "id": 267929016,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642107376
    },
    {
        "content": "<p>it caused my stuff to break</p>",
        "id": 267929085,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642107406
    },
    {
        "content": "<p>because the script reads any exisitng file BEFORE it writes it</p>",
        "id": 267929192,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642107459
    },
    {
        "content": "<p>ah, you already had a publish.ini and that messed up the next build?<br>\nIf so, since the publish.ini is input, that is exactly what you should expect - broken input, broken output (and I'm not avoiding the issue, just challenging  my own assumption)</p>",
        "id": 267929986,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642107768
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> :<br>\n<a href=\"https://confluence.hl7.org/display/FHIR/NPM+Package+Specification#NPMPackageSpecification-ImplementationGuideCanonical\">https://confluence.hl7.org/display/FHIR/NPM+Package+Specification#NPMPackageSpecification-ImplementationGuideCanonical</a> + I updated the Package List doco to point ot that</p>",
        "id": 267930199,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642107861
    },
    {
        "content": "<p>about the publish.ini:<br>\nshould the publish.ini url be <code>http://hl7.dk/fhir/dk-core</code> ? that is what I am getting (what the .py script is initializing it with)</p>",
        "id": 267930446,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642107972
    },
    {
        "content": "<p>it should - by suggestion from <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> - be <a href=\"http://hl7.dk/fhir\">http://hl7.dk/fhir</a></p>",
        "id": 267931037,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108218
    },
    {
        "content": "<p>which also sounds correct to me</p>",
        "id": 267931057,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108230
    },
    {
        "content": "<p>and that value should probably be taken from a new field in the release.json</p>",
        "id": 267931104,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108254
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267929986\">said</a>:</p>\n<blockquote>\n<p>ah, you already had a publish.ini and that messed up the next build?<br>\nIf so, since the publish.ini is input, that is exactly what you should expect - broken input, broken output (and I'm not avoiding the issue, just challenging  my own assumption)</p>\n</blockquote>\n<p>I had the www folder from a previous run which failed</p>",
        "id": 267931161,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108285
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267931161\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267929986\">said</a>:</p>\n<blockquote>\n<p>ah, you already had a publish.ini and that messed up the next build?<br>\nIf so, since the publish.ini is input, that is exactly what you should expect - broken input, broken output (and I'm not avoiding the issue, just challenging  my own assumption)</p>\n</blockquote>\n<p>I had the www folder from a previous run which failed</p>\n</blockquote>\n<p>you can try to see if you don't mind -  replace <code>ig_canonical</code> with <code>base</code> in the py script, in both lines 238 and 254</p>",
        "id": 267931376,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642108389
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267931104\">said</a>:</p>\n<blockquote>\n<p>and that value should probably be taken from a new field in the release.json</p>\n</blockquote>\n<p>that can be done indeed</p>",
        "id": 267931410,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642108413
    },
    {
        "content": "<p>another piece of feedback - if you have a evaluation statement and stop the program due to something that is not alligned - do print out what is not alligned for debugging purposes</p>",
        "id": 267931588,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108494
    },
    {
        "content": "<p>and <em>then</em> you can exit</p>",
        "id": 267931633,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108518
    },
    {
        "content": "<blockquote>\n<p>should the publish.ini url be <a href=\"http://hl7.dk/fhir/dk-core\">http://hl7.dk/fhir/dk-core</a></p>\n</blockquote>\n<p>where is the folder published?</p>",
        "id": 267931652,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642108535
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I am moving towards the go-publish and if I need to trim the release script (or remove it completely), i'll do it. So I'm trying to follow the new process. <br>\nI'm currently stuck at the fact that it tells me it expects the <a href=\"http://hl7.org/&lt;country&gt;/&lt;\">hl7.org/&lt;country&gt;/&lt;</a>...&gt;<br>\n<a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267770291\">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267770291</a></p>",
        "id": 267931736,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642108568
    },
    {
        "content": "<p>if the publish.ini has a url of {url} then the browser should be able to find {url}/publish.ini e.g.</p>",
        "id": 267931748,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642108575
    },
    {
        "content": "<p><a href=\"http://hl7.dk/fhir/\">http://hl7.dk/fhir/</a> is the root</p>",
        "id": 267931762,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108584
    },
    {
        "content": "<p><a href=\"http://hl7.org/fhir/publish.ini\">http://hl7.org/fhir/publish.ini</a></p>",
        "id": 267931773,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642108590
    },
    {
        "content": "<p>huh the <a href=\"http://HL7.org\">HL7.org</a> webserver won't serve that file but it does exist.</p>",
        "id": 267931823,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642108615
    },
    {
        "content": "<p><a href=\"https://fhir.org/guides/publish.ini\">https://fhir.org/guides/publish.ini</a> does get served</p>",
        "id": 267931864,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642108633
    },
    {
        "content": "<p><a href=\"http://hl7.dk/fhir/dk-core\">http://hl7.dk/fhir/dk-core</a> is none-existing as it is named <a href=\"http://hl7.dk/fhir/core\">http://hl7.dk/fhir/core</a></p>",
        "id": 267931875,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108635
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> I guess it's this code:</p>\n<div class=\"codehilite\" data-code-language=\"Java\"><pre><span></span><code><span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"n\">p</span><span class=\"p\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"mi\">4</span> <span class=\"o\">&amp;&amp;</span> <span class=\"s\">\"hl7\"</span><span class=\"p\">.</span><span class=\"na\">equals</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"p\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"s\">\"fhir\"</span><span class=\"p\">.</span><span class=\"na\">equals</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"p\">),</span> <span class=\"s\">\"Package Id '\"</span><span class=\"o\">+</span><span class=\"n\">id</span><span class=\"o\">+</span><span class=\"s\">\"' is not valid:  must have 4 parts (hl7.fhir.[realm].[code]\"</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">res</span><span class=\"p\">;</span>\n      <span class=\"p\">}</span>\n      <span class=\"n\">realm</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"p\">;</span>\n      <span class=\"n\">code</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"p\">;</span>\n      <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"n\">canonical</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"p\">(</span><span class=\"n\">canonical</span><span class=\"p\">.</span><span class=\"na\">equals</span><span class=\"p\">(</span><span class=\"s\">\"http://hl7.org/fhir/\"</span><span class=\"o\">+</span><span class=\"n\">realm</span><span class=\"o\">+</span><span class=\"s\">\"/\"</span><span class=\"o\">+</span><span class=\"n\">code</span><span class=\"p\">)</span>  <span class=\"o\">||</span> <span class=\"n\">canonical</span><span class=\"p\">.</span><span class=\"na\">equals</span><span class=\"p\">(</span><span class=\"s\">\"http://hl7.org/fhir/smart-app-launch\"</span><span class=\"p\">)),</span> <span class=\"s\">\"canonical URL of \"</span><span class=\"o\">+</span><span class=\"n\">canonical</span><span class=\"o\">+</span><span class=\"s\">\" does not match the required canonical of http://hl7.org/fhir/\"</span><span class=\"o\">+</span><span class=\"n\">realm</span><span class=\"o\">+</span><span class=\"s\">\"/\"</span><span class=\"o\">+</span><span class=\"n\">code</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">res</span><span class=\"p\">;</span>\n      <span class=\"p\">}</span>\n      <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"n\">canonical</span><span class=\"p\">.</span><span class=\"na\">startsWith</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">),</span> <span class=\"s\">\"Proposed canonical '\"</span><span class=\"o\">+</span><span class=\"n\">canonical</span><span class=\"o\">+</span><span class=\"s\">\"' does not match the web site URL '\"</span><span class=\"o\">+</span><span class=\"n\">url</span><span class=\"o\">+</span><span class=\"s\">\"'\"</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">res</span><span class=\"p\">;</span>\n      <span class=\"p\">}</span>\n</code></pre></div>",
        "id": 267932282,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642108724
    },
    {
        "content": "<p>why don't those rules apply?</p>",
        "id": 267932373,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642108744
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>### Creating the web root folder\nTraceback (most recent call last):\n  File &quot;release.py&quot;, line 224, in &lt;module&gt;\n    os.makedirs(os.path.join(webrootfolder), exist_ok=True)\nTypeError: makedirs() got an unexpected keyword argument &#39;exist_ok&#39;\n</code></pre></div>",
        "id": 267932607,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642108834
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> that is a python version thing, I think. let me get to that</p>",
        "id": 267932713,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642108890
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267932282\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> I guess it's this code:</p>\n<p><div class=\"codehilite\" data-code-language=\"Java\"><pre><span></span><code><span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"n\">p</span><span class=\"p\">.</span><span class=\"na\">length</span> <span class=\"o\">==</span> <span class=\"mi\">4</span> <span class=\"o\">&amp;&amp;</span> <span class=\"s\">\"hl7\"</span><span class=\"p\">.</span><span class=\"na\">equals</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"p\">)</span> <span class=\"o\">&amp;&amp;</span> <span class=\"s\">\"fhir\"</span><span class=\"p\">.</span><span class=\"na\">equals</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span><span class=\"p\">),</span> <span class=\"s\">\"Package Id '\"</span><span class=\"o\">+</span><span class=\"n\">id</span><span class=\"o\">+</span><span class=\"s\">\"' is not valid:  must have 4 parts (hl7.fhir.[realm].[code]\"</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">res</span><span class=\"p\">;</span>\n      <span class=\"p\">}</span>\n      <span class=\"n\">realm</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"p\">;</span>\n      <span class=\"n\">code</span> <span class=\"o\">=</span> <span class=\"n\">p</span><span class=\"o\">[</span><span class=\"mi\">3</span><span class=\"o\">]</span><span class=\"p\">;</span>\n      <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"n\">canonical</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span> <span class=\"o\">&amp;&amp;</span> <span class=\"p\">(</span><span class=\"n\">canonical</span><span class=\"p\">.</span><span class=\"na\">equals</span><span class=\"p\">(</span><span class=\"s\">\"http://hl7.org/fhir/\"</span><span class=\"o\">+</span><span class=\"n\">realm</span><span class=\"o\">+</span><span class=\"s\">\"/\"</span><span class=\"o\">+</span><span class=\"n\">code</span><span class=\"p\">)</span>  <span class=\"o\">||</span> <span class=\"n\">canonical</span><span class=\"p\">.</span><span class=\"na\">equals</span><span class=\"p\">(</span><span class=\"s\">\"http://hl7.org/fhir/smart-app-launch\"</span><span class=\"p\">)),</span> <span class=\"s\">\"canonical URL of \"</span><span class=\"o\">+</span><span class=\"n\">canonical</span><span class=\"o\">+</span><span class=\"s\">\" does not match the required canonical of http://hl7.org/fhir/\"</span><span class=\"o\">+</span><span class=\"n\">realm</span><span class=\"o\">+</span><span class=\"s\">\"/\"</span><span class=\"o\">+</span><span class=\"n\">code</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">res</span><span class=\"p\">;</span>\n      <span class=\"p\">}</span>\n      <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"n\">canonical</span><span class=\"p\">.</span><span class=\"na\">startsWith</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">),</span> <span class=\"s\">\"Proposed canonical '\"</span><span class=\"o\">+</span><span class=\"n\">canonical</span><span class=\"o\">+</span><span class=\"s\">\"' does not match the web site URL '\"</span><span class=\"o\">+</span><span class=\"n\">url</span><span class=\"o\">+</span><span class=\"s\">\"'\"</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n        <span class=\"k\">return</span> <span class=\"n\">res</span><span class=\"p\">;</span>\n      <span class=\"p\">}</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Yes. This says that if the package name is hl7.fhir.xxx.yyy, the canonical must have the form <a href=\"http://hl7.org/fhir/xx/yyy\">hl7.org/fhir/xx/yyy</a></p>",
        "id": 267933101,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642109103
    },
    {
        "content": "<p>indeed. Why do you think that shouldn't apply?</p>",
        "id": 267933148,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642109126
    },
    {
        "content": "<p>from past discussions I understood that a affiliate package would be hl7.fhir.country.whatever</p>",
        "id": 267933251,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642109171
    },
    {
        "content": "<p>yes that is the case.</p>",
        "id": 267933293,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642109194
    },
    {
        "content": "<p>but some Belgian packages would be hosted in <a href=\"http://hl7belgium.org/whatever\">hl7belgium.org/whatever</a> and some other packages in another url</p>",
        "id": 267933351,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642109235
    },
    {
        "content": "<p>same thing with the danish</p>",
        "id": 267933367,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642109249
    },
    {
        "content": "<p>then I'll accept a request to that nature from the affiliates  and update the code accordingly</p>",
        "id": 267933467,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642109286
    },
    {
        "content": "<p>these urls are getting a bit clearer to me, which is good.</p>",
        "id": 267933616,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642109399
    },
    {
        "content": "<p>a request from the affiliates: is this chat with a few upvotes ok?</p>",
        "id": 267933700,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642109432
    },
    {
        "content": "<p>The danish would be hosted under <a href=\"http://hl7.dk\">hl7.dk</a></p>",
        "id": 267933793,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642109494
    },
    {
        "content": "<p>no. An email from an affiliate technical representative cc:ed to the affiliate chair will do the job</p>",
        "id": 267933873,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642109524
    },
    {
        "content": "<p>As in eg. <a href=\"https://hl7.dk/fhir/core/1.1.0/\">https://hl7.dk/fhir/core/1.1.0/</a></p>",
        "id": 267933877,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642109524
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> so I need to send a mail to myself?</p>",
        "id": 267934021,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642109618
    },
    {
        "content": "<p>no you can just send me the email directly!</p>",
        "id": 267934086,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642109643
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267925977\">said</a>:</p>\n<blockquote>\n<p>for starters  - the fsh configuration page</p>\n</blockquote>\n<p>This one's mine.  I can clarify on that page.</p>",
        "id": 267934172,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1642109698
    },
    {
        "content": "<p>Speaking of bugs: <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> could you have a look at <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/issues/703\">https://github.com/hapifhir/org.hl7.fhir.core/issues/703</a></p>",
        "id": 267934384,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642109841
    },
    {
        "content": "<p>And regarding </p>\n<blockquote>\n<p>no. An email from an affiliate technical representative cc:ed to the affiliate chair will do the job</p>\n</blockquote>\n<p>I think that should be shared in the IC forum as well</p>",
        "id": 267934614,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642109971
    },
    {
        "content": "<p>As well as eg. HL7 EU</p>",
        "id": 267934756,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642110047
    },
    {
        "content": "<p>what forum?</p>",
        "id": 267934860,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642110104
    },
    {
        "content": "<p>International Council</p>",
        "id": 267934887,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642110119
    },
    {
        "content": "<p>the email list?</p>",
        "id": 267934960,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642110152
    },
    {
        "content": "<p>Haha .... We also meet from time to time</p>",
        "id": 267935001,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642110185
    },
    {
        "content": "<p>So we are a bit more than an email list</p>",
        "id": 267935024,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642110205
    },
    {
        "content": "<p><a href=\"https://confluence.hl7.org/display/IC/International+Council\">https://confluence.hl7.org/display/IC/International+Council</a></p>",
        "id": 267935110,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642110250
    },
    {
        "content": "<p>is the IC meeting by zoom this week? I would usually do an in person update but no one has spoken to me about that</p>",
        "id": 267935122,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642110259
    },
    {
        "content": "<p>I thik it's on the 26th?</p>",
        "id": 267935523,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642110511
    },
    {
        "content": "<p><a href=\"https://confluence.hl7.org/display/IC/January+26th%2C+2022+International+Council+Virtual+Meeting+Agenda\">https://confluence.hl7.org/display/IC/January+26th%2C+2022+International+Council+Virtual+Meeting+Agenda</a></p>",
        "id": 267935525,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642110513
    },
    {
        "content": "<p>I think an in person update would make sense. We can notify Line to add to the agenda</p>",
        "id": 267935637,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642110574
    },
    {
        "content": "<p>I might be able to do it on the 26th - depends on the timezone. I'm off in the bush for most of the WGM, but I get back late that day</p>",
        "id": 267935818,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642110655
    },
    {
        "content": "<p>ok <a href=\"https://github.com/HL7/fhir-ig-publisher/pull/369/files#diff-ccc6b4e460052b5fd03d8984f50b8d8b82bc0be544295b962203c8c622bd16a1\">https://github.com/HL7/fhir-ig-publisher/pull/369/files#diff-ccc6b4e460052b5fd03d8984f50b8d8b82bc0be544295b962203c8c622bd16a1</a></p>",
        "id": 267939401,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642112347
    },
    {
        "content": "<p>should be released in the next 24 hours</p>",
        "id": 267939409,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642112352
    },
    {
        "content": "<p>Does this still support IHE's <a href=\"http://profiles.ihe.net\">profiles.ihe.net</a>?</p>",
        "id": 267943081,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642114347
    },
    {
        "content": "<p>IHE's packages are not in the form hl7.fhir.... but I don't see if the logic supports other URLs if the package name is different</p>",
        "id": 267943349,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642114497
    },
    {
        "content": "<p>at present, it doesn't check IHE canonicals at all. if someone wants to tell me what the IHE rules for packages and canonicals I can add QA checks for IHE too</p>",
        "id": 267943601,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642114622
    },
    {
        "content": "<p>I don't need to check IHE - it's just QA for IHE if I do</p>",
        "id": 267943642,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1642114645
    },
    {
        "content": "<p>for IHE the web publication is at <a href=\"https://profiles.ihe.net/\">https://profiles.ihe.net/</a> e.g. IG with package name IHE.ITI.PIXm#3.0.0 lives at <a href=\"https://profiles.ihe.net/ITI/PIXm/index.html\">https://profiles.ihe.net/ITI/PIXm/index.html</a>, canonical <a href=\"http://profiles.ihe.net/ITI/PIXm\">http://profiles.ihe.net/ITI/PIXm</a> </p>\n<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> can you pleas confirm also?</p>",
        "id": 267983589,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1642148599
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> </p>\n<blockquote>\n<p>you can try to see if you don't mind -  replace <code>ig_canonical</code> with <code>base</code> in the py script, in both lines 238 and 254</p>\n</blockquote>\n<p>Looks like it fixes the most troublesome parts. Will you fix this in your 'normative' repository - wherever that may be?</p>",
        "id": 267996273,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642156550
    },
    {
        "content": "<p>Yes, I will commit that change</p>",
        "id": 267996535,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642156689
    },
    {
        "content": "<p>there's no normative repository but there may be a primary source, <em>after</em> we have this process clear.</p>",
        "id": 267996580,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642156716
    },
    {
        "content": "<p>where's the 'temporary repository' then?</p>",
        "id": 267996712,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642156806
    },
    {
        "content": "<p>My plan is (please let me know if it makes sense)</p>\n<ol>\n<li>Get something to work (done) that can be used in a CI process and document it</li>\n<li>Adapt this to the new approach that Grahame added (including the go-publish thing)</li>\n<li>If there is a script to facilitate the work, I'll put it in a repo somewhere where it can be reused (github does have reusable workflows since recently, I think)</li>\n</ol>",
        "id": 267996750,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642156843
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267996712\">said</a>:</p>\n<blockquote>\n<p>where's the 'temporary repository' then?</p>\n</blockquote>\n<p><a href=\"https://github.com/costateixeira/testrel/blob/master/release.py\">https://github.com/costateixeira/testrel/blob/master/release.py</a> for now</p>",
        "id": 267996802,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642156900
    },
    {
        "content": "<p>I am making the script to show that there is value in some automation. If this has value for HL7 then I hope we can put a \"community version\" somewhere</p>",
        "id": 267996917,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642156970
    },
    {
        "content": "<p>if not, then it will be a bottom-up volunteer initiative :)</p>",
        "id": 267996998,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642157026
    },
    {
        "content": "<p>Or make this the priority of the new CSDO <span class=\"user-mention\" data-user-id=\"191978\">@Daniel Vreeman</span></p>",
        "id": 267998978,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1642158166
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191478\">Oliver Egger</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/267983589\">said</a>:</p>\n<blockquote>\n<p>for IHE the web publication is at <a href=\"https://profiles.ihe.net/\">https://profiles.ihe.net/</a> e.g. IG with package name IHE.ITI.PIXm#3.0.0 lives at <a href=\"https://profiles.ihe.net/ITI/PIXm/index.html\">https://profiles.ihe.net/ITI/PIXm/index.html</a>, canonical <a href=\"http://profiles.ihe.net/ITI/PIXm\">http://profiles.ihe.net/ITI/PIXm</a> </p>\n<p><span class=\"user-mention silent\" data-user-id=\"191404\">John Moehrke</span> can you pleas confirm also?</p>\n</blockquote>\n<p>yes, current thinking for IHE is</p>\n<div class=\"codehilite\"><pre><span></span><code>https://profiles.ihe.net/${domain}/${profile}\n</code></pre></div>\n<p>I have adjusted the guidance to lowercase the IG id, while we continue to use uppercase in the canonical.</p>\n<p>current thinking. Glad to be guided.</p>",
        "id": 268010908,
        "sender_full_name": "John Moehrke",
        "timestamp": 1642165734
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191404\">John Moehrke</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Release.20Publication.20procedure/near/268010908\">said</a>:</p>\n<blockquote>\n<div class=\"codehilite\"><pre><span></span><code>https://profiles.ihe.net/${domain}/${profile}\n</code></pre></div>\n<p>I have adjusted the guidance to lowercase the IG id, while we continue to use uppercase in the canonical.</p>\n</blockquote>\n<p>Do you mean <code>PIXm</code> in the canonical, but <code>pixm</code> in the id?</p>",
        "id": 268053735,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642185204
    },
    {
        "content": "<p>yes</p>",
        "id": 268073614,
        "sender_full_name": "John Moehrke",
        "timestamp": 1642194867
    },
    {
        "content": "<p>that has not yet been fixed. pull-request has been submitted, ITI committee needs to agree, and publication governance.</p>",
        "id": 268073654,
        "sender_full_name": "John Moehrke",
        "timestamp": 1642194902
    },
    {
        "content": "<p>And are there any case requirements for the package name?</p>",
        "id": 268074596,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1642195416
    },
    {
        "content": "<p>I think that was discussed - yes, package name is expected to be lower case (I can't find the spec but this for example describes the rules: <a href=\"https://www.npmjs.com/package/validate-npm-package-name\">https://www.npmjs.com/package/validate-npm-package-name</a>)</p>",
        "id": 268081176,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642198829
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> a few things as I'm exploring:</p>\n<div class=\"codehilite\" data-code-language=\"Java\"><pre><span></span><code>      <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"n\">canonical</span> <span class=\"o\">==</span> <span class=\"kc\">null</span><span class=\"p\">,</span> <span class=\"s\">\"canonical URL not found\"</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n</code></pre></div>\n<p>(publicationprocess, line 136)<br>\nshould this be <code>canonical != null</code>?</p>",
        "id": 268081642,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642199132
    },
    {
        "content": "<p>also, line 152:</p>\n<div class=\"codehilite\" data-code-language=\"Java\"><pre><span></span><code><span class=\"n\">String</span> <span class=\"n\">destination</span> <span class=\"o\">=</span> <span class=\"n\">tho</span> <span class=\"o\">||</span> <span class=\"n\">cql</span> <span class=\"o\">?</span> <span class=\"n\">rootFolder</span> <span class=\"p\">:</span> <span class=\"n\">PastProcessHackerUtilities</span><span class=\"p\">.</span><span class=\"na\">useRealm</span><span class=\"p\">(</span><span class=\"n\">realm</span><span class=\"p\">,</span> <span class=\"n\">code</span><span class=\"p\">)</span> <span class=\"o\">?</span> <span class=\"n\">Utilities</span><span class=\"p\">.</span><span class=\"na\">path</span><span class=\"p\">(</span><span class=\"n\">rootFolder</span><span class=\"p\">,</span> <span class=\"n\">realm</span><span class=\"p\">,</span> <span class=\"n\">code</span><span class=\"p\">)</span> <span class=\"p\">:</span>  <span class=\"n\">Utilities</span><span class=\"p\">.</span><span class=\"na\">path</span><span class=\"p\">(</span><span class=\"n\">rootFolder</span><span class=\"p\">,</span> <span class=\"n\">code</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>I'm not sure this is compatible with the scenario for BE (or others). It seems to require that the folder structure will be <code>web-root\\be\\core</code>. <br>\nHowever, there is no <code>be</code>in the URL for the publication: it's <a href=\"http://hl7belgium.org/profiles/fhir/core\">hl7belgium.org/profiles/fhir/core</a></p>",
        "id": 268081756,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1642199188
    }
]