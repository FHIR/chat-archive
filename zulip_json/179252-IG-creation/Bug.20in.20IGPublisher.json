[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> it seems there's a bug in the IGpublisher. When looking at the capabilitystatement, it looks like it removes <a href=\"https://www.hl7.org/fhir/stu3/capabilitystatement-definitions.html#CapabilityStatement.profile\" target=\"_blank\" title=\"https://www.hl7.org/fhir/stu3/capabilitystatement-definitions.html#CapabilityStatement.profile\">https://www.hl7.org/fhir/stu3/capabilitystatement-definitions.html#CapabilityStatement.profile</a> when stated in the capabilitystatement in the rendered version</p>",
        "id": 182026015,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574866402
    },
    {
        "content": "<p>fixed next release</p>",
        "id": 182064537,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574894176
    },
    {
        "content": "<p>thx</p>",
        "id": 182064547,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574894189
    },
    {
        "content": "<p>when is that?</p>",
        "id": 182064552,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574894200
    },
    {
        "content": "<p>probably sometime in the next 12 hours</p>",
        "id": 182064567,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574894222
    },
    {
        "content": "<p>i had no idea that the capa-statemnt was subject to undergo changes when put through the IG.</p>",
        "id": 182064872,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574894412
    },
    {
        "content": "<p>that's a version conversion issue</p>",
        "id": 182065041,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574894560
    },
    {
        "content": "<p>makes sense - you're running on R4 internally?</p>",
        "id": 182065076,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574894600
    },
    {
        "content": "<p>R5</p>",
        "id": 182065099,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574894627
    },
    {
        "content": "<p>wait a minute ... the IGPub also overwrites the fhirVersion stated in all sd's (seems fair) - but also all sd.version</p>",
        "id": 182066092,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574895608
    },
    {
        "content": "<p>is that last part really intentional?</p>",
        "id": 182066169,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574895712
    },
    {
        "content": "<p>um. maybe. what does it overwrite it with?</p>",
        "id": 182066342,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574895874
    },
    {
        "content": "<p>looks like 'fixed-business-version' from ig.json</p>",
        "id": 182066368,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574895923
    },
    {
        "content": "<p>that's what it does - overwrites all the versions</p>",
        "id": 182066387,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574895955
    },
    {
        "content": "<p>but it should overwrite the fhirVersion with the right version</p>",
        "id": 182066450,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574895996
    },
    {
        "content": "<p>also does so</p>",
        "id": 182066468,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574896017
    },
    {
        "content": "<p>guess I hadn't read the <a href=\"https://wiki.hl7.org/index.php?title=IG_Publisher_Documentation#Business_Version\" target=\"_blank\" title=\"https://wiki.hl7.org/index.php?title=IG_Publisher_Documentation#Business_Version\">https://wiki.hl7.org/index.php?title=IG_Publisher_Documentation#Business_Version</a> thoroughly</p>",
        "id": 182066508,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574896065
    },
    {
        "content": "<p>its still a bug in v1.0.3-SNAPSHOT i think</p>",
        "id": 182175374,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1575031820
    },
    {
        "content": "<p>what is?</p>",
        "id": 182176607,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575032983
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> it seems there's a bug in the IGpublisher. When looking at the capabilitystatement, it looks like it removes <a href=\"https://www.hl7.org/fhir/stu3/capabilitystatement-definitions.html#CapabilityStatement.profile\" target=\"_blank\" title=\"https://www.hl7.org/fhir/stu3/capabilitystatement-definitions.html#CapabilityStatement.profile\">https://www.hl7.org/fhir/stu3/capabilitystatement-definitions.html#CapabilityStatement.profile</a> when stated in the capabilitystatement in the rendered version</p>\n</blockquote>",
        "id": 182177796,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1575034090
    },
    {
        "content": "<p>should be fixed in 1.0.4</p>",
        "id": 182193620,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575048941
    },
    {
        "content": "<p>So <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> has found a bug in the IGPublisher that is difficult to fix. It relates to the discriminator format in spreadsheets. The format is </p>\n<p><code>path@type</code></p>\n<p>Though the @type is optional. @type can be @pattern, @profile, @type or @exists (which is the default). The bug is that for all except @exists, the parser chops off the last character of <code>path</code>. for @exists, it chops off the last 2 characters.</p>\n<p>I could fix this, at the price of breaking anything that already works. I'm not going to fix it, since I want the spreadsheet format to <em>go away</em>.</p>",
        "id": 195684650,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1588153920
    },
    {
        "content": "<p>fyi <span class=\"user-mention\" data-user-id=\"196553\">@Jamie Jones</span> <span class=\"user-mention\" data-user-id=\"191913\">@Kevin Power</span> <span class=\"user-mention\" data-user-id=\"191916\">@ Bob Milius</span></p>",
        "id": 195686642,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1588154839
    },
    {
        "content": "<p>It's supposed to be path.@type I thought</p>",
        "id": 195713644,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588169002
    },
    {
        "content": "<p>Maybe those who want the spreadsheet format to stay (not me) could band together and pull the spreadsheet parsing code out and put it into a separate utility that converts spreadsheets to resources in the folder structure recognized by the publisher?</p>",
        "id": 195723718,
        "sender_full_name": "Rick Geimer",
        "timestamp": 1588172745
    },
    {
        "content": "<p>Need an import too.  It's on the list, but not a small undertaking</p>",
        "id": 195728891,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588174824
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Bug.20in.20IGPublisher/near/195684650\" title=\"#narrow/stream/179252-IG-creation/topic/Bug.20in.20IGPublisher/near/195684650\">said</a>:</p>\n<blockquote>\n<p>Though the @type is optional. @type can be @pattern, @profile, @type or @exists (which is the default). The bug is that for all except @exists, the parser chops off the last character of <code>path</code>. for @exists, it chops off the last 2 characters.</p>\n</blockquote>\n<p>just curious: in the testcase for this issue only @pattern and @type are used. No @exists was applied. Is this a side-effect? The Creator isn't parsing one of the discriminators and sets it to @exists by default?</p>",
        "id": 195739068,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1588179109
    },
    {
        "content": "<p>just straight errors in code in the number of characters removed at the end. But actually, I think they are all out by one, hence the spurious character</p>",
        "id": 195757770,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1588188079
    },
    {
        "content": "<p>Thanks to <span class=\"user-mention\" data-user-id=\"191913\">@Kevin Power</span> who found a workaround by just adding extra dots (tried that as well, but must have made some mistake). Discriminator like this: <code>resolve().code..@pattern,resolve()..@type</code>will be processed to <code>resolve().code</code> with pattern and <code>resolve()</code>with type.</p>",
        "id": 195801565,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1588227169
    },
    {
        "content": "<p>Actually <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> I didn't do that.  In the spreadsheet, I simply did this:<br>\n<code>resolve().@type,resolve().code.@pattern</code> (single dot)</p>\n<p>The StructureDef that was generated had the discriminator defined like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>        <span class=\"s2\">&quot;id&quot;</span><span class=\"err\">:</span> <span class=\"s2\">&quot;Observation.derivedFrom&quot;</span><span class=\"err\">,</span>\n        <span class=\"s2\">&quot;path&quot;</span><span class=\"err\">:</span> <span class=\"s2\">&quot;Observation.derivedFrom&quot;</span><span class=\"err\">,</span>\n        <span class=\"s2\">&quot;slicing&quot;</span><span class=\"err\">:</span> <span class=\"p\">{</span>\n          <span class=\"nt\">&quot;discriminator&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"p\">{</span>\n              <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;type&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;resolve()&quot;</span>\n            <span class=\"p\">},</span>\n            <span class=\"p\">{</span>\n              <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;pattern&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;resolve().code&quot;</span>\n            <span class=\"p\">}</span>\n          <span class=\"p\">],</span>\n          <span class=\"nt\">&quot;rules&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;open&quot;</span>\n</code></pre></div>\n\n\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> said that he thought the dot at the end of the path was required, and it seems like that is enough to get the discriminator defined the way we were trying too?  Or am I confused?</p>",
        "id": 195833987,
        "sender_full_name": "Kevin Power",
        "timestamp": 1588251156
    },
    {
        "content": "<p>it was there with a dot before. Only difference was that it was <code>resolve().code.@pattern,resolve().@type</code></p>",
        "id": 195853231,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1588259406
    },
    {
        "content": "<p>but very glad it is working again</p>",
        "id": 195853256,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1588259421
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/ZMuIbsy9MNhbCeth4pKbf0Jl/image.png\">image.png</a> - <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> seen that beforer?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/ZMuIbsy9MNhbCeth4pKbf0Jl/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/ZMuIbsy9MNhbCeth4pKbf0Jl/image.png\"></a></div>",
        "id": 206201068,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1596750472
    },
    {
        "content": "<p>Did you update the publisher? doesn't look like it</p>",
        "id": 206201854,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1596751009
    },
    {
        "content": "<p>I'm going to have to wear this - it's how the change to a new deployment infrastructure breaks the old publishers</p>",
        "id": 206204005,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596752557
    },
    {
        "content": "<p>and of course, I can't fix them</p>",
        "id": 206204010,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596752562
    },
    {
        "content": "<p>new bug on the block:</p>\n<div class=\"codehilite\"><pre><span></span><code>java.lang.NullPointerException\n        at org.hl7.fhir.r5.utils.FHIRPathEngine.evaluateDefinition(FHIRPathEngine.java:4842)\n        at org.hl7.fhir.validation.instance.InstanceValidator.getCriteriaForDiscriminator(InstanceValidator.java:2712)\n        at org.hl7.fhir.validation.instance.InstanceValidator.sliceMatches(InstanceValidator.java:3128)\n        at org.hl7.fhir.validation.instance.InstanceValidator.matchSlice(InstanceValidator.java:4264)\n        at org.hl7.fhir.validation.instance.InstanceValidator.assignChildren(InstanceValidator.java:4184)\n        at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:3761)\n        at org.hl7.fhir.validation.instance.InstanceValidator.startInner(InstanceValidator.java:3527)\n        at org.hl7.fhir.validation.instance.InstanceValidator.start(InstanceValidator.java:3425)\n        at org.hl7.fhir.validation.instance.InstanceValidator.validateResource(InstanceValidator.java:4496)\n        at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:686)\n        at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:668)\n        at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:4668)\n        at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:4541)\n        at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:856)\n        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:712)\n        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7850)\n</code></pre></div>\n\n\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  - probably because a structuredef url was incorrect</p>",
        "id": 207949949,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1598354163
    },
    {
        "content": "<p>ok fixed next release</p>",
        "id": 208022742,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1598389161
    }
]