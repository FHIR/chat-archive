[
    {
        "content": "<p>Something about my slicing causes the IG Publisher to unceremoniously blow up.   If I delete the slicing on supportingInfo, it happily generates appropriate output.   Sushi v0.12.5 is delighted with the input.    You can find the inputs at :    <a href=\"https://github.com/saulakravitz/carin-bb.git\">https://github.com/saulakravitz/carin-bb.git</a>. </p>\n<p>Here is the output:<br>\n% ./_genonce.sh <br>\nChecking internet connection...<br>\nOnline</p>\n<p>FHIR IG Publisher Version 1.0.94-SNAPSHOT (Git# 77c06d8ca14c). Built 2020-05-12T11:55:14.985+10:00 (36 hours old)<br>\nDetected Java version: 1.8.0_242 from /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available<br>\nParameters: -ig ig.ini<br>\ndir = /Users/skravitz/git/carin-bb/fsh/build, path = /Users/skravitz/.rvm/gems/ruby-2.6.3/bin:/Users/skravitz/.rvm/gems/ruby-2.6.3@global/bin:/Users/skravitz/.rvm/rubies/ruby-2.6.3/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Users/skravitz/.rvm/bin<br>\nRun time = Wednesday, May 13, 2020 10:47:23 AM EDT (2020-05-13T10:47:23-04:00)<br>\nPackage Cache: /Users/skravitz/.fhir/packages                                    (00:00.0122)<br>\nLoad Template from fhir.base.template#current                                    (00:02.0485)</p>\n<p>onLoad.findSpreadsheets:</p>\n<p>onLoad.updateIg:<br>\n     [xslt] Processing /Users/skravitz/git/carin-bb/fsh/build/template/onLoad-ig-working.xml to /Users/skravitz/git/carin-bb/fsh/build/template/onLoad-ig-updated.xml<br>\n     [xslt] Loading stylesheet /Users/skravitz/git/carin-bb/fsh/build/template/scripts/onLoad.xslt</p>\n<p>onLoad.extend:</p>\n<p>onLoad:<br>\nRoot directory: /Users/skravitz/git/carin-bb/fsh/build                           (00:09.0848)<br>\nCore Package hl7.fhir.r4.core#4.0.1<br>\nTerminology Cache is at /Users/skravitz/git/carin-bb/fsh/build/input-cache/txcache. 1 files in cache (00:34.0195)<br>\nConnect to Terminology Server at <a href=\"http://tx.fhir.org\">http://tx.fhir.org</a>                              (00:34.0197)<br>\nLoad Package hl7.fhir.pubpack#0.0.4<br>\nLoad Package hl7.fhir.xver-extensions#0.0.4<br>\nDependency 'hl7.fhir.us.core' has no id, so can't be referred to in markdown in the IG (00:35.0129)<br>\nInitialization complete                                                          (00:38.0462)<br>\nLoad Content                                                                     (00:38.0464)<br>\nProcessing Conformance Resources                                                 (00:39.0286)<br>\nPublishing Content Failed: null                                                  (00:57.0249)<br>\n                                                                                 (00:57.0249)<br>\nUse -? to get command line help                                                  (00:57.0249)<br>\n                                                                                 (00:57.0249)<br>\nStack Dump (for debugging):                                                      (00:57.0249)<br>\njava.lang.NullPointerException<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.commas(ProfileUtilities.java:4255)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.describeSlice(ProfileUtilities.java:4249)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateDescription(ProfileUtilities.java:3829)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateDescription(ProfileUtilities.java:3749)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.genElement(ProfileUtilities.java:3430)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.genElement(ProfileUtilities.java:3492)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateTable(ProfileUtilities.java:3235)<br>\n    at org.hl7.fhir.r5.utils.NarrativeGenerator.generate(NarrativeGenerator.java:2604)<br>\n    at org.hl7.fhir.r5.utils.NarrativeGenerator.generate(NarrativeGenerator.java:236)<br>\n    at org.hl7.fhir.r5.utils.NarrativeGenerator.generate(NarrativeGenerator.java:208)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.generateNarratives(Publisher.java:1014)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3568)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:826)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:688)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7310)</p>",
        "id": 197424683,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1589381905
    },
    {
        "content": "<blockquote>\n<p>Sushi v0.12.5 is delighted with the input</p>\n</blockquote>\n<p>Just FYI - SUSHI doesn't validate any of the slicing details (discriminator path, type, etc) -- so SUSHI may be too easily delighted if something isn't quite right there.</p>",
        "id": 197431480,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589384544
    },
    {
        "content": "<p>delectable and delightful...</p>",
        "id": 197432079,
        "sender_full_name": "John Moehrke",
        "timestamp": 1589384739
    },
    {
        "content": "<blockquote>\n<p>If I delete the slicing on supportingInfo</p>\n</blockquote>\n<p>Which profile is this in?  It wasn't clear from the stack trace.</p>",
        "id": 197432220,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589384773
    },
    {
        "content": "<p>The IG publisher is delighted with the slicing in Coverage, and repulsed by the slicing in each/every EOB profile.</p>",
        "id": 197434978,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1589385788
    },
    {
        "content": "<p>Should I be looking at the <code>saul</code> branch?</p>",
        "id": 197436113,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589386224
    },
    {
        "content": "<p>OK.  This is what I'm seeing:</p>\n<div class=\"codehilite\"><pre><span></span><code>* supportingInfo ^slicing.discriminator.path = &quot;value:category.coding.code&quot;\n* supportingInfo ^slicing.rules = #open\n* supportingInfo ^slicing.ordered = false   // can be omitted, since false is the default\n* supportingInfo ^slicing.description = &quot;Slice based on value pattern&quot;\n</code></pre></div>\n\n\n<p>I'm not familiar with the <code>value:...</code> syntax for discriminator paths -- and I see you didn't declare a discriminator type at all.  I think maybe what you really want is:</p>\n<div class=\"codehilite\"><pre><span></span><code>* supportingInfo ^slicing.discriminator.type = #value\n* supportingInfo ^slicing.discriminator.path = &quot;category.coding.code&quot;\n* supportingInfo ^slicing.rules = #open\n* supportingInfo ^slicing.ordered = false   // can be omitted, since false is the default\n* supportingInfo ^slicing.description = &quot;Slice based on value pattern&quot;\n</code></pre></div>\n\n\n<p><em>(EDIT: Corrected based on <span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span>'s astute observation below!)</em></p>",
        "id": 197437072,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589386617
    },
    {
        "content": "<p>Ohhhhh... I think I see.  I expect you are just doing what you see in rendered profiles.  For example, the BP profile rendering shows this: <a href=\"/user_uploads/10155/7gY1CbWSkzW8Qb6E3pO_-FzK/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/7gY1CbWSkzW8Qb6E3pO_-FzK/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/7gY1CbWSkzW8Qb6E3pO_-FzK/image.png\"></a></div>",
        "id": 197437364,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589386746
    },
    {
        "content": "<p>So that's probably where <code>value:code.coding.code</code> came from.  I get it.  So that style of indicating the discriminator is currently not supported in FSH -- but it's an interesting idea!  For now, however, you need to set the type and path discreetly in two separate rules (as in my example above).</p>",
        "id": 197437572,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589386836
    },
    {
        "content": "<ul>\n<li>supportingInfo ^slicing.discriminator.type = #value</li>\n</ul>",
        "id": 197438348,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1589387169
    },
    {
        "content": "<p>Ha.  You're exactly right!  Thanks for the correction!</p>",
        "id": 197439400,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589387613
    },
    {
        "content": "<p>I'll correct it above as well.</p>",
        "id": 197439450,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589387632
    },
    {
        "content": "<p>IG Publisher is now happy, so I'm (not un)happy.   Thanks.<br>\nError messages from sushi and IG publisher that eliminate the need for expert consulting support would be GREATLY appreciated.</p>",
        "id": 197440406,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1589388048
    },
    {
        "content": "<p>BTW, adding slicing to a FSH spec causes the sushi runtime to go up dramatically in the \"info  Converting FSH to FHIR resources...\" step.   Dramatically means:  from taking 10s, to taking 2-3 minutes.</p>",
        "id": 197441969,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1589388731
    },
    {
        "content": "<p>I hadn't noticed that slicing has that affect in SUSHI.  That's interesting (and a little surprising), but also good to know...</p>",
        "id": 197443099,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1589389146
    },
    {
        "content": "<blockquote>\n<p>Error messages from sushi and IG publisher that eliminate the need for expert consulting support would be GREATLY appreciated</p>\n</blockquote>\n<p>of course but that doesn't make it easy. This particular scenario will be more graceful in the future</p>",
        "id": 197452232,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589392802
    },
    {
        "content": "<p>&lt;wrong place&gt;</p>",
        "id": 197565252,
        "sender_full_name": "David Pyke",
        "timestamp": 1589467485
    }
]