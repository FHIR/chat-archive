[
    {
        "content": "<p>We would like some SUSHI-generated files to include a warning that the file is generated, so users should not directly edit it, else their changes may be overwritten.  Usually this would be done using a comment, but JSON does not allow comments.  The common Internet wisdom is that if you really need this (and can't use JSON5), use a special <code>\"//\"</code> or <code>\"_comment\"</code> key.  In our case, <code>\"//\"</code> would make the most sense, since <code>\"_comment\"</code> could clash or be confused with a real field.  For example, we would like to support this:</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;//&quot;: &quot;***********************************************************************************************&quot;,\n  &quot;//&quot;: &quot;*                              WARNING: DO NOT EDIT THIS FILE                                 *&quot;,\n  &quot;//&quot;: &quot;*                                                                                             *&quot;,\n  &quot;//&quot;: &quot;* This file is generated by SUSHI. Any edits you make to this file will be overwritten.       *&quot;,\n  &quot;//&quot;: &quot;***********************************************************************************************&quot;,\n  &quot;resourceType&quot;: &quot;ImplementationGuide&quot;,\n  &quot;id&quot;: &quot;hl7.fhir.us.sushi-test&quot;,\n  ...\n}\n</pre></div>",
        "id": 192557387,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585759600
    },
    {
        "content": "<p>There are a few issues w/ this, however.  The first if that the IG Publisher does not like duplicate keys -- even though the JSON spec does explicitly allow them (and most suggested comment workarounds do leverage this allowance):</p>\n<div class=\"codehilite\"><pre><span></span>Publishing Content Failed: Error parsing JSON source: Duplicated property name: // at Line 3\n</pre></div>",
        "id": 192557648,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585759705
    },
    {
        "content": "<p>If we change it to use one <code>\"//\"</code> key with a value that is the array of comment strings instead, then the publisher completes, but we get this error in the qa.html: <a href=\"/user_uploads/10155/Hb5TpUmCLJJ02bySi70muGSH/image.png\" title=\"image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/Hb5TpUmCLJJ02bySi70muGSH/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/Hb5TpUmCLJJ02bySi70muGSH/image.png\"></a></div>",
        "id": 192557954,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585759830
    },
    {
        "content": "<p>Adding unexpected tags is explicity prohibited in FHIR.  We could talk about adding something for FHIR R5, but we can't make it legal in prior versions.  The only thing possible right now would be to send it as an extension.</p>",
        "id": 192558244,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1585759945
    },
    {
        "content": "<p>I looked for a core extension that might be applicable but did not find one (and honestly, that's not the preferred approach anyway, as this shouldn't really be a formal component of the resource).  Would it be legal to have the IG publisher automatically ignore (and toss) the <code>\"//\"</code> key?  That way the resources that land in the final (IG Publisher produced) spec don't have these extra keys (so they're valid FHIR) -- but there's a way to have comments in dev resources...</p>",
        "id": 192558549,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585760056
    },
    {
        "content": "<p>Not and be a legal R4 or earlier instance</p>",
        "id": 192559197,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1585760321
    },
    {
        "content": "<p>If the IGPublisher took the input files and stripped \"//\" keys, then the resulting output files would be legal instances.</p>",
        "id": 192559300,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1585760360
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192166\">Jean Duteau</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Comments.20in.20JSON/near/192559300\" title=\"#narrow/stream/179252-IG-creation/topic/Comments.20in.20JSON/near/192559300\">said</a>:</p>\n<blockquote>\n<p>If the IGPublisher took the input files and stripped \"//\" keys, then the resulting output files would be legal instances.</p>\n</blockquote>\n<p>Yeah, that's what I was thinking (and hoping for).</p>",
        "id": 192559635,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585760473
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> could you potentially get around this by generating XML files instead of JSON files?  Then you could include comments.  I know that XML just doesn't have the pizzazz these days, but...</p>",
        "id": 192559692,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1585760492
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192166\">@Jean Duteau</span> -- yes, I suppose that's another approach.  Since we use the TypeScript language (which is a superset of JavaScript), it's just so much easier for us to work in JSON.  I guess we'd need to determine if the ROI is high enough.  Currently, we're trying to come up w/ a solution we can implement quickly.</p>",
        "id": 192560025,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585760611
    },
    {
        "content": "<p>good point.  I'm +1 on having the publisher strip comments :)</p>",
        "id": 192560475,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1585760728
    },
    {
        "content": "<p>some history on this: </p>\n<ul>\n<li>The lack of support for comments is absolutely the worst thing about json</li>\n<li>I'm not going to apologise for a validating parser prohibiting duplicate names</li>\n<li>we did define a special property name for comments in json, but the community insisted it be removed</li>\n<li>I can't see how JSON5 could be on the agenda</li>\n</ul>",
        "id": 192580048,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585769073
    },
    {
        "content": "<p>i think we (the sushi community) agree with all of that.  we're just wondering if tooling could look for and remove a special tag when it is converting input instances to output instances?</p>",
        "id": 192580203,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1585769138
    },
    {
        "content": "<p>that's not very easy. The tooling is using the standard parsers, so you're asking for surgery down in the validator, since the validator loads all those resources</p>",
        "id": 192580666,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585769354
    },
    {
        "content": "<p>not to mention needing a custom json parser</p>",
        "id": 192581587,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585769776
    },
    {
        "content": "<p>(well, it we're going to allow comments we should do them for real)</p>",
        "id": 192583242,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585770584
    },
    {
        "content": "<p>OK.  Fair enough.  Thanks for considering.  As for the parser, if you're using a 3rd party parser, I'm surprised it doesn't support duplicate keys -- as the JSON spec explicitly allows this and even notes that there are use cases in which duplicate keys are helpful.  I assumed the duplicate key detection was added in FHIR code. In any case, it sounds like this is a no-go.  We've found another workaround -- we'll put the warning in <code>text.div</code> but set <code>text.status</code> to <code>empty</code> so the IG Publisher overwrites our warning w/ the generated narrative.</p>",
        "id": 192583705,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585770822
    },
    {
        "content": "<blockquote>\n<p>even notes that there are use cases in which duplicate keys are helpful</p>\n</blockquote>\n<p>where?</p>",
        "id": 192584269,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585771081
    },
    {
        "content": "<p><a href=\"https://www.tbray.org/ongoing/When/201x/2013/02/21/JSON-Lesson\" title=\"https://www.tbray.org/ongoing/When/201x/2013/02/21/JSON-Lesson\">https://www.tbray.org/ongoing/When/201x/2013/02/21/JSON-Lesson</a></p>",
        "id": 192585824,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585771708
    },
    {
        "content": "<p>but don't give up. I'm trying comments out</p>",
        "id": 192585855,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585771718
    },
    {
        "content": "<p>Uh... yeah.  Well I feel dumb now.  I think I misread a discussion on the spec -- and it really was why unique keys are helpful (not duplicate keys), so I got that totally backwards. I'm sorry for the mixup.  Sometimes I get too excited and read things too fast I guess.  But in the discussions on comment syntaxes, it seemed generally agreed upon that it was a good use case for duplicate keys.  As noted in the blog you linked to, RFC8259 allows for it since it uses \"should\".  In addition <a href=\"http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf\" title=\"http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf\">ECMA-404</a> (\"The JSON Data Interchange Syntax\") states:</p>\n<blockquote>\n<p>The JSON syntax does not impose any restrictions on the strings used  as  names,  does  not  require  that  name strings be  unique,  and  does  not  assign  any significance to the orderingof name/value pairs.</p>\n</blockquote>\n<p>All that said, I'm fine w/ enforcing unique keys.  I'm even more fine with it if I can use a single <code>\"//\"</code> key with a string or  array of strings value. ;-)</p>",
        "id": 192588478,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585772973
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- it seems that the IG publisher does allow me to get away with a single <code>\"//\"</code> property in <code>package.json</code> and <code>package-list.json</code>.  If I do that will it cause any issues in other tools further down the line?</p>",
        "id": 192588673,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585773033
    },
    {
        "content": "<p>it might. particularly package-list.json. Please don't make me test that. You shouldn't be generating package-list.json anyway</p>",
        "id": 192589205,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585773254
    },
    {
        "content": "<p>Right now, we basically generate a template of it because a lot of the values can be pulled from data in other places.  We expect the author to ultimately take control of it, but we generate one when they don't provide it - as a kickstart.  In the future, we'll be introducing a more comprehensive config file that can be used to reliably generate a package-list.  So we want to make it clear when a specific package-list is output of SUSHI -- so authors edit the right thing.</p>",
        "id": 192589702,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585773494
    },
    {
        "content": "<p>personally, I don't think you should try generating a complete one, since entries for part versions are always ignored during the publication process. As for generating the current... put a comment on there with instructions to remove the comment when you edit it - as you must</p>",
        "id": 192589900,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585773593
    },
    {
        "content": "<p>I think we're still figuring out how the integration all works and what the separation is between SUSHI input files, SUSHI output files, and IG Publisher input files.  There are some gray lines right now and we're just trying to make things a little more clear while we go through some of these growing pains.</p>",
        "id": 192589972,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585773613
    },
    {
        "content": "<p>well, as of next release, IG pbulisher will accept comments in json input resources</p>",
        "id": 192591034,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585774154
    },
    {
        "content": "<p>genuine comments.</p>",
        "id": 192591045,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585774161
    },
    {
        "content": "<p>per JSON5</p>",
        "id": 192591055,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585774167
    },
    {
        "content": "<p>Ha.  From</p>\n<blockquote>\n<p>I can't see how JSON5 could be on the agenda</p>\n</blockquote>\n<p>to</p>\n<blockquote>\n<p>as of next release, IG pbulisher will accept comments in json input resources<br>\ngenuine comments.<br>\nper JSON5</p>\n</blockquote>\n<p>in less than 90 minutes.  Not bad!  Thank you, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>!  Now I have to figure out how to support JSON5 comments in my stack...</p>",
        "id": 192591512,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585774420
    },
    {
        "content": "<p>well, JSON5 isn't going to get on the general agenda, but I can implement a special mode for IG publisher. This only applies to R4+ btw</p>",
        "id": 192591659,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585774502
    },
    {
        "content": "<p>Got it.  When you say \"input resources\", you mean stuff like <code>package.json</code> and <code>package-list.json</code>, but not necessarily resources (like <code>ig-foo.json</code>), right?</p>",
        "id": 192591755,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585774555
    },
    {
        "content": "<p>not I mean resources in the FHIR sense</p>",
        "id": 192591863,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585774593
    },
    {
        "content": "<blockquote>\n<p>not I mean resources in the FHIR sense</p>\n</blockquote>\n<p>Sorry, I'm having trouble interpreting that.  Just to be clear, can you answer yes/no on these?</p>\n<ol>\n<li>Comment support in package.json?</li>\n<li>Comment support in package-list.json?</li>\n<li>Comment support in FHIR resource instances?</li>\n</ol>",
        "id": 192593132,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1585775281
    },
    {
        "content": "<p>package.json, package-list.json: comments not supported. And not going to be supported<br>\nresources : comments supported</p>",
        "id": 192594030,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585775771
    },
    {
        "content": "<p>comments supported in source or comments supported in published instances?</p>",
        "id": 192595110,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1585776445
    },
    {
        "content": "<p>in the published resources</p>",
        "id": 192597167,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585777672
    },
    {
        "content": "<p>Is that conformant with our published spec or an R5 change?</p>",
        "id": 192604227,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1585782962
    },
    {
        "content": "<p>of course not. So I wouldn't do it. That was just a April 1st answer. Comments are only supported in source</p>",
        "id": 192606478,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585784703
    },
    {
        "content": "<p>i was about to start the impeach process</p>",
        "id": 192606501,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1585784737
    },
    {
        "content": "<p>It's well past April 1 for you - cheater! :)</p>",
        "id": 192606798,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1585785099
    }
]