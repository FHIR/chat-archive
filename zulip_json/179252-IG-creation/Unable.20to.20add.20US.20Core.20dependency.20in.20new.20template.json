[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <br>\nI am trying to add IG dependency for US core and i get it to work in the old templates but not in the new template.<br>\nThe dependency looks like : ( I have tried 3.1.0, 3.0.1 etc) I am dependent on FHIR Core 4.0.1</p>\n<div class=\"codehilite\"><pre><span></span>&lt;uri value=&quot;http://hl7.org/fhir/us/core&quot;/&gt;\n&lt;packageId value=&quot;hl7.fhir.us.core&quot;/&gt;\n&lt;version value=&quot;3.1.0&quot;/&gt;\n</pre></div>\n\n\n<p>&lt;/dependsOn&gt;</p>\n<p>The error that i get is : <br>\nConnect to Terminology Server at <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">http://tx.fhir.org</a>                              (01:40.0500)<br>\nDependency has no id, so can't be referred to in markdown in the IG              (01:41.0424)<br>\nPublishing Content Failed: Unable to understand IG url: <a href=\"http://hl7.org/fhir/us/core\" target=\"_blank\" title=\"http://hl7.org/fhir/us/core\">http://hl7.org/fhir/us/core</a> (01:41.0425)<br>\n                                                                                 (01:41.0425)<br>\nUse -? to get command line help                                                  (01:41.0426)<br>\n                                                                                 (01:41.0426)<br>\nStack Dump (for debugging):                                                      (01:41.0426)<br>\norg.hl7.fhir.exceptions.FHIRException: Unable to understand IG url: <a href=\"http://hl7.org/fhir/us/core\" target=\"_blank\" title=\"http://hl7.org/fhir/us/core\">http://hl7.org/fhir/us/core</a><br>\n    at org.hl7.fhir.igtools.publisher.Publisher.determineCanonical(Publisher.java:1487)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.loadIg(Publisher.java:2140)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:1422)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1121)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:612)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6537)</p>",
        "id": 180051742,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573058831
    },
    {
        "content": "<p>Any thoughts on what may be going wrong ?</p>",
        "id": 180051775,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573058847
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>    {\n      &quot;location&quot;: &quot;http://hl7.org/fhir/us/core&quot;,\n      &quot;version&quot;: &quot;3.1.0&quot;,\n      &quot;name&quot;: &quot;uscore&quot;,\n      &quot;package&quot;: &quot;hl7.fhir.us.core&quot;\n    }\n</pre></div>\n\n\n<p>works for me</p>",
        "id": 180054696,
        "sender_full_name": "Eric Haas",
        "timestamp": 1573060457
    },
    {
        "content": "<p>that is my ig config file</p>\n<p>here is the ig resource....</p>",
        "id": 180059820,
        "sender_full_name": "Eric Haas",
        "timestamp": 1573063528
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>  &lt;dependsOn&gt;\n    &lt;!-- 0..* Another Implementation guide this depends on --&gt;\n    &lt;uri value=&quot;http://hl7.org/fhir/us/core/ImplementationGuide/hl7.fhir.us.core&quot;&gt;\n      &lt;!-- 1..1 canonical(ImplementationGuide) Identity of the IG that this depends on --&gt;\n    &lt;/uri&gt;\n    &lt;packageId value=&quot;hl7.fhir.us.core&quot;/&gt;\n    &lt;!-- 0..1 NPM Package name for IG this depends on --&gt;\n    &lt;version value=&quot;3.1.0&quot;/&gt;&lt;!-- 0..1 Version of the IG --&gt;\n&lt;/dependsOn&gt;\n</pre></div>",
        "id": 180064602,
        "sender_full_name": "Eric Haas",
        "timestamp": 1573066317
    },
    {
        "content": "<p>I have not tested that though...</p>",
        "id": 180064665,
        "sender_full_name": "Eric Haas",
        "timestamp": 1573066334
    },
    {
        "content": "<p>That helped a little but got a new error..<br>\nDependency has no id, so can't be referred to in markdown in the IG              (01:25.0977)<br>\nPublishing Content Failed: null                                                  (01:26.0071)<br>\n                                                                                 (01:26.0071)<br>\nUse -? to get command line help                                                  (01:26.0071)<br>\n                                                                                 (01:26.0072)<br>\nStack Dump (for debugging):                                                      (01:26.0072)<br>\njava.lang.NullPointerException<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.loadIg(Publisher.java:2168)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:1422)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1121)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:612)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6537)</p>",
        "id": 180073738,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573072401
    },
    {
        "content": "<p>I am getting it to work but is referencing the wrong version of US Core and renders it incorrectly... some of that is due to standard template which I am still working through.</p>",
        "id": 180076153,
        "sender_full_name": "Eric Haas",
        "timestamp": 1573074234
    },
    {
        "content": "<p>using the non templates (old) way works just fine for me.</p>",
        "id": 180076892,
        "sender_full_name": "Eric Haas",
        "timestamp": 1573074739
    },
    {
        "content": "<p>Yes ...it works with the old template ..but does not work with the new template</p>",
        "id": 180078936,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573076141
    },
    {
        "content": "<p>THis is how my dependency looks now, the publisher is loading the version of US Core but fails after that with the IgLoad Null pointer exception. <br>\nSo it is better from that standpoint but still does not work well.</p>\n<p>&lt;dependsOn&gt;<br>\n    &lt;uri value=\"http://hl7.org/fhir/us/core/ImplementationGuide/hl7.fhir.us.core\"/&gt;<br>\n    &lt;packageId value=\"hl7.fhir.us.core\"/&gt;<br>\n    &lt;version value=\"3.1.0\"/&gt;<br>\n  &lt;/dependsOn&gt;</p>",
        "id": 180079159,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573076299
    },
    {
        "content": "<p>can I reproduce this?</p>",
        "id": 180084542,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573080526
    },
    {
        "content": "<p>Yes,</p>\n<p>It is checked in at <a href=\"https://github.com/HL7/davinci-atr\" target=\"_blank\" title=\"https://github.com/HL7/davinci-atr\">https://github.com/HL7/davinci-atr</a></p>",
        "id": 180114561,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573118304
    },
    {
        "content": "<p>Let me know if you need anything else.</p>",
        "id": 180114581,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573118321
    },
    {
        "content": "<p>fixed next release</p>",
        "id": 180201306,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573186509
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , I tried with the latest publisher and I get the following exception after everything is fixed. The original problem is fixed but this new one appears. Is  this supposed to happen ? </p>\n<p>Installing hl7.fhir.us.davinci-atr#dev to the package cache<br>\n  Fetching:|<br>\n  Analysing done.<br>\nPublishing Content Failed: null                                                  (01:11.0010)<br>\n                                                                                 (01:11.0010)<br>\nUse -? to get command line help                                                  (01:11.0010)<br>\n                                                                                 (01:11.0010)<br>\nStack Dump (for debugging):                                                      (01:11.0010)<br>\njava.lang.NullPointerException<br>\n    at org.hl7.fhir.utilities.cache.PackageCacheManager.addPackageToCache(PackageCacheManager.java:569)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.generate(Publisher.java:4045)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:772)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:649)<br>\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6593)</p>",
        "id": 180558136,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573590663
    },
    {
        "content": "<p>can I reproduce this?</p>",
        "id": 180558200,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573590713
    },
    {
        "content": "<p>3:36 PM<br>\nThe .index.json has this weird character at the begining<br>\n&lt;U+FEFF&gt;<br>\nThat makes the JSON invalid</p>",
        "id": 180558683,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573590985
    },
    {
        "content": "<p>The .index.json in the .fhir/packages/..../.index.json is the one that has this problem</p>",
        "id": 180558753,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573591028
    },
    {
        "content": "<p>ah thank you. Weird. And I hate Java.</p>",
        "id": 180558757,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573591030
    },
    {
        "content": "<p>That's a UTF byte order mark. Totally unnecessary for UTF-8</p>",
        "id": 180558768,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1573591041
    },
    {
        "content": "<p>Should i just delete that for now...and try it out ...</p>",
        "id": 180558777,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573591047
    },
    {
        "content": "<p>looks like it</p>",
        "id": 180558783,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573591053
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span> The question is why some people are tripped over by some IGs and I never am when Java inserts the byte order mark when I never get it</p>",
        "id": 180558868,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573591097
    },
    {
        "content": "<p>bet you can't delete it though. it's generated in process</p>",
        "id": 180558892,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573591111
    },
    {
        "content": "<p>Removed and verified but it gets re-generated, so assume it has to be a code fix. <br>\nRemoving BOM from a file on MAC/Linux , this is what i used. <br>\nvi .index.json<br>\n:set nobomb<br>\n:wq</p>",
        "id": 180559630,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573591512
    },
    {
        "content": "<p>You should be able to reproduce by ..on linux/Mac using <br>\n<a href=\"https://github.com/HL7/davinci-atr\" target=\"_blank\" title=\"https://github.com/HL7/davinci-atr\">https://github.com/HL7/davinci-atr</a> project</p>",
        "id": 180560021,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573591728
    },
    {
        "content": "<p>In this particular case, is the difference between Windows and Mac/Linux? Or Java versions? Oracle JDK vs OpenJDK?</p>",
        "id": 180561048,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1573592304
    },
    {
        "content": "<p>I have no idea. That's why I hate Java.</p>",
        "id": 180561074,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573592323
    },
    {
        "content": "<p>Not sure, have not tried on Windows and the different JDKs.</p>",
        "id": 180562830,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573593399
    },
    {
        "content": "<p>ok I got a new release of IGPublisher out - can you update and try again please</p>",
        "id": 180562869,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573593429
    },
    {
        "content": "<p>not enough. but now I've got to the bottom of this.</p>",
        "id": 180566044,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573595476
    },
    {
        "content": "<p>Tried it , but something else now. It is not able to find xml.xsd from the <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a> site. Dont know if that exists or was removed.</p>\n<p>onLoad.r5-schemas:<br>\n      [get] Getting: <a href=\"http://build.fhir.org/fhir-single.xsd\" target=\"_blank\" title=\"http://build.fhir.org/fhir-single.xsd\">http://build.fhir.org/fhir-single.xsd</a><br>\n      [get] To: /Users/nbashyam/git/davinci-atr/input-cache/schemas-r5/fhir-single.xsd<br>\n      [get] Not modified - so not downloaded<br>\n      [get] Getting: <a href=\"http://build.fhir.org/fhir-xhtml.xsd\" target=\"_blank\" title=\"http://build.fhir.org/fhir-xhtml.xsd\">http://build.fhir.org/fhir-xhtml.xsd</a><br>\n      [get] To: /Users/nbashyam/git/davinci-atr/input-cache/schemas-r5/fhir-xhtml.xsd<br>\n      [get] Not modified - so not downloaded<br>\n      [get] Getting: <a href=\"http://build.fhir.org/xml.xsd\" target=\"_blank\" title=\"http://build.fhir.org/xml.xsd\">http://build.fhir.org/xml.xsd</a><br>\n      [get] To: /Users/nbashyam/git/davinci-atr/input-cache/schemas-r5/xml.xsd<br>\n      [get] Error opening connection java.io.FileNotFoundException: <a href=\"http://build.fhir.org/xml.xsd\" target=\"_blank\" title=\"http://build.fhir.org/xml.xsd\">http://build.fhir.org/xml.xsd</a><br>\n      [get] Error opening connection java.io.FileNotFoundException: <a href=\"http://build.fhir.org/xml.xsd\" target=\"_blank\" title=\"http://build.fhir.org/xml.xsd\">http://build.fhir.org/xml.xsd</a><br>\n      [get] Error opening connection java.io.FileNotFoundException: <a href=\"http://build.fhir.org/xml.xsd\" target=\"_blank\" title=\"http://build.fhir.org/xml.xsd\">http://build.fhir.org/xml.xsd</a><br>\n      [get] Can't get <a href=\"http://build.fhir.org/xml.xsd\" target=\"_blank\" title=\"http://build.fhir.org/xml.xsd\">http://build.fhir.org/xml.xsd</a> to /Users/nbashyam/git/davinci-atr/input-cache/schemas-r5/xml.xsd<br>\nPublishing Content Failed: Can't get <a href=\"http://build.fhir.org/xml.xsd\" target=\"_blank\" title=\"http://build.fhir.org/xml.xsd\">http://build.fhir.org/xml.xsd</a> to /Users/nbashyam/git/davinci-atr/input-cache/schemas-r5/xml.xsd (00:05.0657)<br>\n                                                                                 (00:05.0658)<br>\nUse -? to get command line help                                                  (00:05.0658)<br>\n                                                                                 (00:05.0658)<br>\nStack Dump (for debugging):                                                      (00:05.0659)<br>\n/Users/nbashyam/git/davinci-atr/template/scripts/ant.xml:19: Can't get <a href=\"http://build.fhir.org/xml.xsd\" target=\"_blank\" title=\"http://build.fhir.org/xml.xsd\">http://build.fhir.org/xml.xsd</a> to /Users/nbashyam/git/davinci-atr/input-cache/schemas-r5/xml.xsd<br>\n    at org.apache.tools.ant.taskdefs.Get$GetThread.downloadFile(Get.java:843)<br>\n    at org.apache.tools.ant.taskdefs.Get$GetThread.get(Get.java:682)<br>\n    at org.apache.tools.ant.taskdefs.Get$GetThread.run(Get.java:666)</p>",
        "id": 180568782,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573597402
    },
    {
        "content": "<p>That was not happening with the previous version ...no other changes in the project.</p>",
        "id": 180568921,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573597519
    },
    {
        "content": "<p>The file is part of the fhir-all-xsd.zip but is not available as an individual file download but the template tries to download it as part of the build</p>",
        "id": 180569327,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573597872
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  - Any thoughts on how to overcome this issue..I am using the new template <br>\nIt can be reproduced by <a href=\"https://github.com/HL7/davinci-atr\" target=\"_blank\" title=\"https://github.com/HL7/davinci-atr\">https://github.com/HL7/davinci-atr</a></p>",
        "id": 180571144,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573599342
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> this is a template problem</p>",
        "id": 180572384,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573600382
    },
    {
        "content": "<p>as in, the template is accessing xml.xsd. Which, as I have said before, is not a value proposition for anyone</p>",
        "id": 180572405,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573600413
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> this is a problem with the build infrastructure. it seems as though we have lost all files on <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a> where the name starts with \"v\" or subsequent letters</p>",
        "id": 180572660,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573600629
    },
    {
        "content": "<p>but <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> if you really insist on mucking around with xsds you should just include them in the tmplate</p>",
        "id": 180572783,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573600786
    },
    {
        "content": "<p>Hmmm, did these files disappear from the CI build of master, or everywhere?</p>",
        "id": 180573448,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573601516
    },
    {
        "content": "<p>Other recent branches like <a href=\"http://build.fhir.org/branches/Consent-performer-function/valueset\" target=\"_blank\" title=\"http://build.fhir.org/branches/Consent-performer-function/valueset\">http://build.fhir.org/branches/Consent-performer-function/valueset</a>  appear intact.</p>",
        "id": 180573542,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573601586
    },
    {
        "content": "<p>Is the issue on master persisting across builds? (I'm not somewhere that I can debug at the moment.)</p>",
        "id": 180573575,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573601631
    },
    {
        "content": "<p>doing a rebuild now to find out</p>",
        "id": 180573630,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573601666
    },
    {
        "content": "<p>Okay (I was just about to do the same)</p>",
        "id": 180573634,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573601674
    },
    {
        "content": "<p>Thanks</p>",
        "id": 180573637,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573601678
    },
    {
        "content": "<p>Obviously this shouldn't be allowed to occur; we try to only swap the result of a build into the public build site once it has been completely and successfully uploaded.</p>",
        "id": 180573683,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573601727
    },
    {
        "content": "<p>can upload fail silently?</p>",
        "id": 180573891,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573601937
    },
    {
        "content": "<p>I can include the xml template in the IG I suppose, but the others change<br>\nfrom time to time - and I don't necessarily know when/if that has happened<br>\nin order to update the template.  I'd therefore prefer to continue to pull<br>\nthem down from source.  (And if we get to the point where JSON editors<br>\ncould use the templates, I'll start pulling those down too.)  Anyone who's<br>\nhand-editing XML or JSON absolutely ought to be using the schemas if they<br>\ncan.  (And hand-editing is still an unfortunate part of life for many<br>\nresources.)</p>",
        "id": 180575810,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1573603614
    },
    {
        "content": "<p>Well, the <code>&amp;&amp;</code> in <a href=\"https://github.com/FHIR/auto-ig-builder/blob/master/images/ci-build/publish#L18\" target=\"_blank\" title=\"https://github.com/FHIR/auto-ig-builder/blob/master/images/ci-build/publish#L18\">https://github.com/FHIR/auto-ig-builder/blob/master/images/ci-build/publish#L18</a> is supposed to prevent that -- in other words, if the tgz extraction fails, the publish script should fail (given <code>set -e</code>, which causes exit on failure).</p>",
        "id": 180575853,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573603678
    },
    {
        "content": "<p>But obviously something is wrong with my assessment :)</p>",
        "id": 180575893,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573603686
    },
    {
        "content": "<p>Still broken, so likely a systematic issue. How many files are generated in the fhir build output file these days?</p>",
        "id": 180588781,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573617512
    },
    {
        "content": "<p>we haven't had a successful build since then. I think this PR is going to be ok....</p>",
        "id": 180589164,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573617895
    },
    {
        "content": "<p>ok it worked, and we're all good again.</p>",
        "id": 180590419,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573619362
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192017\">@Nagesh Bashyam</span> you can try again</p>",
        "id": 180590421,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573619370
    },
    {
        "content": "<p>Ah, ok -- thought you were triggering a rebuild earlier. Glad it's working now, but I'm not yet sure what happened.</p>",
        "id": 180590758,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573619944
    },
    {
        "content": "<p>it took me that long to get a successful build</p>",
        "id": 180591146,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573620451
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , It is all good now. The builds are successful. Thank you very much.</p>",
        "id": 180600857,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1573632039
    }
]