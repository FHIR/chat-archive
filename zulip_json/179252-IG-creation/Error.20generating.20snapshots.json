[
    {
        "content": "<p>We have been looking into changing our SUSHI compiler for FHIR Shorthand to only generate differentials and not snapshots, but we are hitting the following error in the IG Publisher:<br>\n<a href=\"/user_uploads/10155/llPXx8AUzelu7W24ZgPzKUIx/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/llPXx8AUzelu7W24ZgPzKUIx/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/llPXx8AUzelu7W24ZgPzKUIx/pasted_image.png\"></a></div><p>After some investigation, I think this might have something to do with circular dependencies. The profile that causes this error, TNMClinicalStageGroup, is based on another profile, CancerStageParent, which is based on Observation. The \"focus\" element on CancerStageParent is constrained as a reference to our PrimaryCancerCondition profile. But the \"stage.assessment\" element on PrimaryCancerCondition is a reference to TNMClinicalStageGroup, so the references are circular. As can be seen in the image above, the snapshot seems like it is getting terminated prematurely once it gets to \"Observation.focus\",  and if  I change the \"focus\" element on CancerStageParent to not reference PrimaryCancerCondition, the error goes away.</p>\n<p>Should we be handling our circular dependencies differently?</p>",
        "id": 187478757,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1580926000
    },
    {
        "content": "<p>I'm not sure. Is this in the committed mcode?</p>",
        "id": 187485327,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580930440
    },
    {
        "content": "<p>Not yet.  But it can be.  Working on it.</p>",
        "id": 187486720,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1580931287
    },
    {
        "content": "<p>Source code is on <code>no-snapshots</code> branch: <a href=\"https://github.com/HL7/fhir-mCODE-ig/tree/no-snapshots\" target=\"_blank\" title=\"https://github.com/HL7/fhir-mCODE-ig/tree/no-snapshots\">https://github.com/HL7/fhir-mCODE-ig/tree/no-snapshots</a></p>",
        "id": 187489720,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1580933154
    },
    {
        "content": "<p>Built output: <a href=\"https://github.com/HL7/fhir-mCODE-ig/tree/no-snapshots\" target=\"_blank\" title=\"https://github.com/HL7/fhir-mCODE-ig/tree/no-snapshots\">https://github.com/HL7/fhir-mCODE-ig/tree/no-snapshots</a></p>",
        "id": 187492284,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1580935000
    },
    {
        "content": "<p>Build log (has some useful stuff): <a href=\"http://build.fhir.org/ig/HL7/fhir-mCODE-ig/branches/no-snapshots/build.log\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/fhir-mCODE-ig/branches/no-snapshots/build.log\">http://build.fhir.org/ig/HL7/fhir-mCODE-ig/branches/no-snapshots/build.log</a></p>",
        "id": 187492321,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1580935036
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, did you ever have any luck reproducing this issue?</p>",
        "id": 187923814,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1581436190
    },
    {
        "content": "<p>no it's on my list</p>",
        "id": 187947571,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581450762
    },
    {
        "content": "<p>well, I have some progress. Now, trying to do that generates this:</p>",
        "id": 187981126,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581482339
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Attempt to use a snapshot on profile &#39;http://hl7.org/fhir/us/mcode/StructureDefinition/CancerStageParent&#39; as Base for generating a snapshot for the profile http://hl7.org/fhir/us/mcode/StructureDefinition/TNMClinicalStageGroup before it is generated\n</pre></div>",
        "id": 187981702,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581483525
    },
    {
        "content": "<p>having captured the bug, it was clear that I was generating the snapshot when I didn't need to. So I cleaned it up and now it seems to generate ok</p>",
        "id": 187981905,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581483851
    },
    {
        "content": "<p>Oh great, thank you for taking a look!</p>",
        "id": 188010985,
        "sender_full_name": "Nick Freiter",
        "timestamp": 1581515484
    }
]