[
    {
        "content": "<p>For <a href=\"https://github.com/fhir/sample-ig\">https://github.com/fhir/sample-ig</a> <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>, would you be OK with using tagged releases? Several tools are grabbing .sh scripts from this repo and running them, but I'd feel a lot more comfortable if I could reference a specific rlease rather than \"whatever's on master\".</p>",
        "id": 221797916,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609954965
    },
    {
        "content": "<p>Can you expand on what that would mean?  You mean that we would just tag the version we wanted systems to grab rather than bringing down current?  In what situations would we not put that tag on current?</p>",
        "id": 221802950,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1609957403
    },
    {
        "content": "<p>Git tags are \"sticky\" -- once you apply them, you don't move them. Then, a tagged commit can be used to generate a \"release\" in github, which gets a downloadable structure that folks can refer to. (If <strong>every</strong> commit you make on <code>master</code> is seeing careful review and can be used/trusted by everyone in the community, then every commit could be tagged with an incremented version and associated with a release.)</p>",
        "id": 221824549,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609967708
    },
    {
        "content": "<p>When a user runs the _updatePublisher, should they be asked to point to a specific release? <br>\nOr would we have a command line argument?</p>",
        "id": 221840089,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1609977309
    },
    {
        "content": "<p>I think of _updatePublisher just like _genOnce, and so on; users would fetch the \"set of scripts\" in a versioned release, and update to a newer set when they chose. It gets complicated because some of these scripts update themselves, which is behavior I'd personally not want to opt into.</p>",
        "id": 221842485,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609979090
    },
    {
        "content": "<p>I'm trying to figure out the desired behaviour to see if it makes sense. <br>\nThere should be no issue to point the _updatePublisher to a specific release, but I think we want to support updates, right? <br>\nFor example if I'm using the scripts v1.0.0, when there's a v1.0.1, do we update?</p>",
        "id": 221842788,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1609979296
    },
    {
        "content": "<p>I'd expect that to be a user's choice, but sure it should be an option.</p>",
        "id": 221844290,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609980582
    },
    {
        "content": "<p>(I'd expect users to update as an explicit, intentional step.)</p>",
        "id": 221844341,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609980604
    },
    {
        "content": "<p>(Like updating a template, I guess.)</p>",
        "id": 221844352,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609980614
    },
    {
        "content": "<p>I think the big question is \"what should the review process be for the scripts to be deemed 'trusted'\".  The tagging question would be secondary.  (Though moving the scripts to a stand-alone Git project that could have a formal pull request review process might be a good idea.)</p>",
        "id": 221851496,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1609988093
    },
    {
        "content": "<p>Yes, standalone repo would be nice. That way folks who wanted to could pull it into their IGs as a submodule or subtree (without getting a bunch of sample ig content in the process).</p>",
        "id": 221852912,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609989852
    },
    {
        "content": "<p>And yeah, the trust is a big deal on these since folks are automatically downloading and executing code in them.</p>",
        "id": 221852923,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609989893
    },
    {
        "content": "<p>(Would be good to enable master branch protections, require review before merges, prevent force pushes, and limit editors with write permissions.)</p>",
        "id": 221852993,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1609989988
    },
    {
        "content": "<p>How many reviews should there be before a commit can be merged to main, and thoughts on who we might want those folks to be?</p>",
        "id": 221853287,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1609990402
    },
    {
        "content": "<p>If you're looking for volunteers to help with this, I'd be glad to help!</p>",
        "id": 221939161,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610024833
    },
    {
        "content": "<p>I think the default should be to use current stable... otherwise we get people who unknowingly get stuck behind.   Our hope is to have more than the current 6 people doing Implementation Guide creation, so we need to make it easier, not harder.</p>",
        "id": 221944803,
        "sender_full_name": "John Moehrke",
        "timestamp": 1610028314
    },
    {
        "content": "<p>current stable, i think, would be the latest tag</p>",
        "id": 221949246,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610030708
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/221852912\">said</a>:</p>\n<blockquote>\n<p>Yes, standalone repo would be nice. That way folks who wanted to could pull it into their IGs as a submodule or subtree (without getting a bunch of sample ig content in the process).</p>\n</blockquote>\n<p>I think a standard repo is a good thing.</p>",
        "id": 221949503,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610030830
    },
    {
        "content": "<p>For avoiding the sample ig content, I made a barebones github template - only the necessary files for all IGs in an organization. Sort of an \"IG content template\". This way we can create a full IG repo in a much shorter time, no need to delete any content.</p>",
        "id": 221949581,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610030874
    },
    {
        "content": "<p>(if sushi had this function, it would be something like \"sushi --init - template=ihe.empty-ig\")</p>",
        "id": 221949810,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610030969
    },
    {
        "content": "<blockquote>\n<p>How many reviews should there be</p>\n</blockquote>\n<p>Let's start with one?</p>",
        "id": 221962242,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1610036179
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> I think the scripts should be separated from a minimum IG.  The level of review we need for IG starter files is different.  We can update the scripts for the starter IG by just running the \"Update scripts\" and then committing them.</p>",
        "id": 221963026,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610036521
    },
    {
        "content": "<p>Yes, I'm good with that.</p>",
        "id": 221963175,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610036580
    },
    {
        "content": "<p>Ok, done.  Jose, Josh, initial pull request is here for review.  Josh, if you can check that I've got the settings sufficiently tight, that'd be wonderful<br>\n<a href=\"https://github.com/HL7/ig-publisher-scripts/pull/1\">https://github.com/HL7/ig-publisher-scripts/pull/1</a></p>",
        "id": 221976572,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610042092
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> -- I just pulled down your branch on my mac and noted that the <code>*.sh</code> files don't have their executable bit set.  Is it possible to <code>chmod 755</code> those <code>*.sh</code> files and push up another commit?</p>",
        "id": 221977299,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1610042395
    },
    {
        "content": "<p>i don't know the permissions now but i presume chmod +x is (also) what we need, right?</p>",
        "id": 221978646,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610042920
    },
    {
        "content": "<p>Either <code>chmod 755</code> or <code>chmod +x</code> should get you to the same place...at least the <code>.sh</code> files in the IGs I work on are set to <code>755</code></p>",
        "id": 221981974,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610044427
    },
    {
        "content": "<p>I finally could commit. <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> care to review?</p>",
        "id": 221983444,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610045152
    },
    {
        "content": "<p>Can someone please check if they are executable yet?</p>",
        "id": 221984301,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610045534
    },
    {
        "content": "<p>Merged</p>",
        "id": 221985230,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610045951
    },
    {
        "content": "<p>I have confirmed that the  <code>.sh</code> scripts _are_ executable in the main branch.  Thanks all!</p>",
        "id": 222001302,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1610053824
    },
    {
        "content": "<p>Protection rules look good <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> , thanks!</p>",
        "id": 222003029,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1610054670
    },
    {
        "content": "<p>It's also great to have this as a standalone repo.</p>",
        "id": 222003045,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1610054678
    },
    {
        "content": "<p><code>sushi --init</code> currently downloads the scripts from the sample IG.  We'll have to update SUSHI to pull them from here instead.  When do you anticipate <em>removing</em> those scripts from <code>sample-ig</code>?</p>",
        "id": 222004841,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1610055532
    },
    {
        "content": "<p>as soon as we find a good way to handle their replacement. I'm now looking at submodules</p>",
        "id": 222005889,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610056069
    },
    {
        "content": "<p>I have an example at <a href=\"https://github.com/HL7/smart-app-launch\">https://github.com/HL7/smart-app-launch</a></p>\n<p>(but to <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>'s point, we don't want to break people using an installed version of sushi. Maybe even good to add some \"deprecation warning\" printouts in the scripts hosted in sample-ig, with a note like \"if you're using sushi &lt;= version X, you should update\".)</p>",
        "id": 222006059,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1610056149
    },
    {
        "content": "<p>this is my struggle with submodules - i can add them in a \"scripts\" folder, but for backwards compatibility i'd need it to be on the root</p>",
        "id": 222006839,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610056506
    },
    {
        "content": "<p>Don't think you can do that.</p>",
        "id": 222006869,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1610056523
    },
    {
        "content": "<p>i'm learning that :)</p>",
        "id": 222006888,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610056533
    },
    {
        "content": "<p>whatever comes out of this, we will indeed need a tag to signal this change</p>",
        "id": 222007061,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610056601
    },
    {
        "content": "<p>Exploring ideas: </p>\n<ol>\n<li>Just remove the scripts, and update documentation to explain why things are failing.</li>\n<li>keep the scripts, just have them self-update from the new location</li>\n<li>replace the script in sample-ig with a simpler one that doesn't do anything except redirect the user to the \"proper\" ones. </li>\n</ol>\n<div class=\"codehilite\"><pre><span></span><code>echo &quot;The scripts you need are located here https://.....\n</code></pre></div>",
        "id": 222008970,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610057491
    },
    {
        "content": "<p>#2 means that everything still works as before, and after running _updatePublisher 1 or 2 times, every ig will be up to date with the proper scripts from the proper location.  But this means one more thing to keep in sync, because submodules don't work</p>",
        "id": 222009183,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610057606
    },
    {
        "content": "<p>I have no idea if this would work (or what it means for Windows), but can you replace the existing scripts with symlinks to the scripts in the submodule?</p>",
        "id": 222024054,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1610068547
    },
    {
        "content": "<p>Don't think you can do that on Windows.  They'd also fail if you weren't online, which would suck...</p>",
        "id": 222026524,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610071407
    },
    {
        "content": "<p>I tried symlinks on Windows, it kind of works, but it's messy to put in github. Besides, I expect issues  when users get it from github (somehow the links become absolute, they should be relative).</p>",
        "id": 222047079,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610094001
    },
    {
        "content": "<p>I would avoid git submodules if possible...I doubt most IG authors are familiar with them, and they add complexity to standard operations. For example <code>git clone git@github.com:HL7/some-ig.git</code> would no longer produce a local clone with the scripts in place. Users would have to add <code>--recursive</code> to the clone command or subsequently run <code>git submodule update --init --recursive</code>.</p>",
        "id": 222060582,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610104352
    },
    {
        "content": "<p>Right. I am trying subtree which seems to be working (at least the commits and pushes)</p>",
        "id": 222062547,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610105895
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> do you want to see if it works?</p>",
        "id": 222063884,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610106929
    },
    {
        "content": "<p><a href=\"https://github.com/costateixeira/sample-ig/tree/subtree\">https://github.com/costateixeira/sample-ig/tree/subtree</a></p>",
        "id": 222063925,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610106950
    },
    {
        "content": "<p>Sure, one sec...</p>",
        "id": 222063985,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610106969
    },
    {
        "content": "<p>this has to work for any git client, OR for downloading the zip file (submodules don't work there)</p>",
        "id": 222064006,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610106980
    },
    {
        "content": "<p>the only thing I need to check is whether the scripts will be automatically updated when we update the  main repo</p>",
        "id": 222064045,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610107022
    },
    {
        "content": "<p>I don't think I've heard of <code>git subtree</code> before...wonder what else is lurking in git that I should know about :)</p>",
        "id": 222064058,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610107035
    },
    {
        "content": "<p>i also hadn't until this morning :)</p>",
        "id": 222064238,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610107174
    },
    {
        "content": "<p>Ok so I did:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ git clone git@github.com:costateixeira/sample-ig.git\n$ git checkout -b subtree origin/subtree\n</code></pre></div>\n<p>The <code>scripts/</code> folder appeared and <code>scripts/_updatePublisher.sh</code> and <code>scripts/_genonce.sh</code> both ran (though the IG Publisher crashed at the end, presumably for an unrelated reason).</p>",
        "id": 222065172,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610107753
    },
    {
        "content": "<p>I assume if this was in the main branch, then <code>git clone ...</code> would work just like ↑ but without any additional commands</p>",
        "id": 222065263,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610107806
    },
    {
        "content": "<p>A small request: can you call the sub-folder <code>script/</code> rather than <code>scripts/</code>? This matches the other folders (input, output, etc.) which are singular.</p>",
        "id": 222065499,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610108006
    },
    {
        "content": "<p>(It also matches my Ruby on Rails muscle-memory for <code>script/generate</code> <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span> )</p>",
        "id": 222065523,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610108031
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span>  Are you planning to make the subtree self-updating? (As in automatically pull down changes when <code>HL7/ig-publisher-scripts</code> has a new tagged release?) I've done this before with scripts in a git repo and it works quite nicely, but I've never done it with subtrees.</p>",
        "id": 222066223,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610108557
    },
    {
        "content": "<p>the goal is to use ./_genonce, not scripts/_genonce<br>\n(i only made that for .bat)</p>",
        "id": 222066576,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610108821
    },
    {
        "content": "<p>i can change to script, no issue</p>",
        "id": 222066609,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610108864
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"322501\">Max Masnick</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222066223\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span>  Are you planning to make the subtree self-updating? (As in automatically pull down changes when <code>HL7/ig-publisher-scripts</code> has a new tagged release?) I've done this before with scripts in a git repo and it works quite nicely, but I've never done it with subtrees.</p>\n</blockquote>\n<p>that would be good indeed, if I knew how...</p>",
        "id": 222066671,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610108890
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222066671\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"322501\">Max Masnick</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222066223\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span>  Are you planning to make the subtree self-updating? (As in automatically pull down changes when <code>HL7/ig-publisher-scripts</code> has a new tagged release?) I've done this before with scripts in a git repo and it works quite nicely, but I've never done it with subtrees.</p>\n</blockquote>\n<p>that would be good indeed, if I knew how...</p>\n</blockquote>\n<p>Yeah it may be tricky with subtrees because from what I can tell, the commit hashes won't be preserved between <code>ig-publisher-scripts</code> and whatever IG repo the subtree is created in.</p>",
        "id": 222066819,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610109020
    },
    {
        "content": "<p>The simplest thing would be to have a <code>version.json</code> file or something in <code>ig-publisher-scripts</code>, which would get bumped as part of the release process. Then <code>_genonce</code> could check this against the tags on <code>https://github.com/HL7/ig-publisher-scripts</code>. If there's a bigger version number in a tag on <code>main</code>, then that would trigger an update. I <em>think</em> this will work <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span> </p>\n<p>Looking at <a href=\"https://blog.developer.atlassian.com/the-power-of-git-subtree/\">https://blog.developer.atlassian.com/the-power-of-git-subtree/</a>, it seems like the command for updating the subtree will be something like <code>git subtree pull --prefix script https://github.com/HL7/ig-publisher-scripts.git master --squash</code>, which is probably not something users should ever have to type in themselves...so some sort of updating mechanism seems important from a UX perspective.</p>",
        "id": 222067088,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610109249
    },
    {
        "content": "<p>or this<br>\n<a href=\"https://github.com/xedi/action-subtree-sync\">https://github.com/xedi/action-subtree-sync</a></p>",
        "id": 222070149,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610111488
    },
    {
        "content": "<p>Interesting...so could be set as a hook for every push or something?</p>",
        "id": 222070292,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610111598
    },
    {
        "content": "<p>maybe (i'm just learning about this)</p>",
        "id": 222070818,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610111947
    },
    {
        "content": "<p>I think there are a lot of different ways to accomplish this...another would be using local <a href=\"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks\">git hooks</a>. I just worry about the usability of anything involving git, especially anything that goes beyond the basics.</p>\n<p>Even with <code>git subtree</code>, there may be some sharp edges...what if someone changes a file in <code>script/</code>? Would we want updates to overwrite any local changes automatically? I don't think it's a good idea to put users in the position of dealing with a merge inside the subtree.</p>",
        "id": 222071501,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610112393
    },
    {
        "content": "<p>especially when these scripts are just a simple thing to facilitate lanching the publisher.. I would like feedback to see what is the preferred goal here. <br>\nMy view is that we can do something as long as it's hit and forget. I don't expect the scripts to change often. putting them on a separate repo makes sense, but it should remain simple to use and maintain.</p>",
        "id": 222071940,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610112703
    },
    {
        "content": "<p>I think it would be helpful to do two things:</p>\n<ol>\n<li>Tell users when there is an update available (same for <code>publisher.jar</code>...it's easy to fall behind the most recent release, especially when working on multiple projects that each have their own <code>publisher.jar</code>)</li>\n<li>Provide an easy path to doing the update (could be as simple as telling the user to run <code>_updatePublisher</code>, modified to work with the subtree if we go that route)</li>\n</ol>\n<p>#1 would have been pretty difficult prior to moving the scripts to <a href=\"https://github.com/HL7/ig-publisher-scripts\">https://github.com/HL7/ig-publisher-scripts</a>, and if the scripts have to be modified anyway to work with this new repo, I think this is a good opportunity to do it.</p>",
        "id": 222076744,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610115499
    },
    {
        "content": "<p>I actually wrote a wrapper around <code>_genonce.sh</code> to provide system notifications when an IG build finishes, and I added in update notifications for <code>publisher.jar</code>...the notifications are quite handy in practice, especially when there are frequent <code>publisher.jar</code> updates:</p>\n<p><a href=\"/user_uploads/10155/sDz3SQeUW056m8mAuxFsa-Zb/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/sDz3SQeUW056m8mAuxFsa-Zb/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/sDz3SQeUW056m8mAuxFsa-Zb/image.png\"></a></div>",
        "id": 222076973,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610115643
    },
    {
        "content": "<p>Unless there's a mechanism to prompt users when the build scripts are updated, folks will end up accidentally running old versions of the scripts -- especially if the updates are really infrequent. This will be problematic if there's ever a need for a critical update to fix a bug or security issue.</p>",
        "id": 222077834,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610116050
    },
    {
        "content": "<p>we could incorporate those checks in _updatePublisher. And possibly in _genonce.</p>",
        "id": 222078203,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610116222
    },
    {
        "content": "<p>It would be great if they could go in _genonce. I think this is the best path to keeping everything up to date.</p>",
        "id": 222088057,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610121204
    },
    {
        "content": "<p>_genOnce could do a check, and call _updatePublisher if needed.</p>",
        "id": 222088191,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610121253
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> thoughts?</p>",
        "id": 222088230,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610121272
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> how can we implement such check (in windows .bat language)?</p>",
        "id": 222088350,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610121320
    },
    {
        "content": "<p>I don’t know anything about .bat implementation off the top of my head, but I can investigate. I was actually getting set up to work on testing something in .bat for Windows anyway, so I can look at this too if it can wait until next week</p>",
        "id": 222088999,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610121571
    },
    {
        "content": "<p>how did you implement this ? I'd presume you get the remote json and somehow parse it. The parsing bit I don't know how to do</p>",
        "id": 222090861,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610122372
    },
    {
        "content": "<p>The desire is to separate the 'update' step from the 'generate' step.  Updating can take a long time and can sometimes grab a copy of the publisher known to be broken.  The current design where if you gen with something that's out-of-date you get a warning, but <em>you</em> are in control of if/when updates happen is the preferred approach.</p>",
        "id": 222094530,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610124133
    },
    {
        "content": "<p>(in my opinion)</p>",
        "id": 222094549,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610124143
    },
    {
        "content": "<p>I agree with Lloyd...having a clear indication of when the scripts need to be updated, but leaving the timing of the update in the user's hands is preferable.</p>\n<p>(Real life example: I'm currently a point release behind on publisher.jar because it introduces a bug, but I still want to be reminded of that each time I run <code>_genonce</code> so I can update with the next release.)</p>",
        "id": 222105229,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610129057
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222090861\">said</a>:</p>\n<blockquote>\n<p>how did you implement this ? I'd presume you get the remote json and somehow parse it. The parsing bit I don't know how to do</p>\n</blockquote>\n<p>There's two parts: </p>\n<ol>\n<li>Grab the current version data from GitHub: <code>PUBLISHER_VERSION_GITHUB=$(curl -vs \"https://api.github.com/repos/HL7/fhir-ig-publisher/releases?per_page=1\" 2&gt;&amp;1 | grep '^    \"name\":' | sed 's/[ \\t]*\"name\": \"\\(.*\\)\",/\\1/')</code></li>\n<li>Get the current version of publisher.jar: <code>PUBLISHER_VERSION_JAR=$((java -jar input-cache/publisher.jar -version || true) 2&gt;&amp;1 | grep \"FHIR IG Publisher Version\" | sed 's/.*Version \\([0-9.]*\\).*/\\1/')</code> (there's probably a better way to do this, but this was easy and it works)</li>\n</ol>",
        "id": 222105548,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610129238
    },
    {
        "content": "<p>I was thinking of a warning at the end of _genOnce - after all is done, we say \"this was generated with an old version...\"</p>",
        "id": 222105641,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610129292
    },
    {
        "content": "<p>you don't really need that because the qa.html tells you that</p>",
        "id": 222105672,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1610129312
    },
    {
        "content": "<p>nice - sed, grep, curl - all things that we don't have</p>",
        "id": 222105678,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610129316
    },
    {
        "content": "<p>Yeah :(</p>",
        "id": 222105686,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610129323
    },
    {
        "content": "<p>qa.html tells about the old version of the publisher, not the script</p>",
        "id": 222105698,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610129332
    },
    {
        "content": "<p>(not that it matters a lot)</p>",
        "id": 222105719,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610129345
    },
    {
        "content": "<p>And I would argue this belongs in the terminal output if possible -- it should be visible in the interface where the commands are run (the terminal/command prompt) rather than having to go somewhere else</p>",
        "id": 222105844,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610129404
    },
    {
        "content": "<p>Making the update check as part of the script also gives us the opportunity to offer to run the update for the user (or tell them how)...this is more important for the scripts than <code>publisher.jar</code> because it's not as simple as downloading/replacing <code>publisher.jar</code></p>",
        "id": 222106091,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610129536
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"322501\">Max Masnick</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222067088\">said</a>:</p>\n<blockquote>\n<p>The simplest thing would be to have a <code>version.json</code> file or something in <code>ig-publisher-scripts</code>, which would get bumped as part of the release process. Then <code>_genonce</code> could check this against the tags on <code>https://github.com/HL7/ig-publisher-scripts</code>. If there's a bigger version number in a tag on <code>main</code>, then that would trigger an update. I <em>think</em> this will work <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span> </p>\n</blockquote>\n<p>if we make that version.txt, we can do something with ms-dos</p>",
        "id": 222106580,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610129802
    },
    {
        "content": "<p>(and it would be \"if there is a different number\", not \"there is a bigger number\".</p>",
        "id": 222106900,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610129958
    },
    {
        "content": "<p>that should be doable.</p>",
        "id": 222106931,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610129974
    },
    {
        "content": "<p>So where is this landing? I know a few things we can do, but to change anything we need to settle on what we want to do</p>",
        "id": 222107072,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610130045
    },
    {
        "content": "<p>Old version of the script generally isn't that big an issue.  If it works, it's probably ok</p>",
        "id": 222114489,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610133919
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222107072\">said</a>:</p>\n<blockquote>\n<p>So where is this landing? I know a few things we can do, but to change anything we need to settle on what we want to do</p>\n</blockquote>\n<p>Since it's probably not too hard to do the version checking as Jose described above, I personally think it's worth putting that in. I'm a big believer in setting up tooling to help users do the right thing, and if the \"right thing\" is updating these scripts if there are changes, having the update checking built in will help a lot.</p>\n<p>For actually updating the scripts, I think continuing to use <code>_updatePublisher</code> as-is may make sense for IG authors. Unless I'm missing something, IG authors won't see any major benefits from using <code>git subtree</code> -- but I could be missing something here.</p>\n<p>For the <code>FHIR/sample-ig</code> project, I think <code>git subtree</code> should be used as it will be helpful in updating the included scripts in a consistent way.</p>",
        "id": 222118366,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610136058
    },
    {
        "content": "<p>I more or less have the code for doing the update checking in <code>sh</code> so I'm happy to contribute that part. I can also help on the Windows side but I'm definitely not a batch file expert.</p>",
        "id": 222118504,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610136126
    },
    {
        "content": "<p>The \"are you up to date\" checking is built into the base template.  I don't see a reason to add a redundant call to put it in the script too.</p>",
        "id": 222119567,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610136756
    },
    {
        "content": "<p>i already said that and they pooh-poohed me :)</p>",
        "id": 222119728,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1610136842
    },
    {
        "content": "<p>For the update checking, I'm talking about checking for updates to the contents of <a href=\"https://github.com/HL7/ig-publisher-scripts\">https://github.com/HL7/ig-publisher-scripts</a>, not <code>publisher.jar</code></p>",
        "id": 222119879,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610136918
    },
    {
        "content": "<p>We don't really care if the scripts are up-to-date.  The scripts don't influence the publication.  The only negative consequence of out-of-date scripts is that if something major changes, they start to fail - which itself provides a pretty strong indication you should try updating the scripts :)  Also, the publisher changes <em>far</em> more often than the scripts do, so being notified that the publisher has changed is generally enough to trigger someone to update the scripts at the same time.</p>",
        "id": 222120099,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610137029
    },
    {
        "content": "<p>Maybe <code>_updatePublisher</code> could do the update check for the scripts then, and directly warn users if they were out of date.</p>\n<p>This wasn't really possible until the scripts were in a separate repo, but now that they are it still seems worth doing to me.</p>",
        "id": 222120341,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610137145
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192166\">Jean Duteau</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222119728\">said</a>:</p>\n<blockquote>\n<p>i already said that and they pooh-poohed me :)</p>\n</blockquote>\n<p>I agree there's no point in duplicating the <code>publisher.jar</code> check. I didn't realize the out-of-date publisher warning showed up in <code>qa.txt</code> until now, but since it does that makes it easy to programmatically check for updates.</p>",
        "id": 222120497,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610137223
    },
    {
        "content": "<p>There is currently no version control on the scripts. If we want the scripts to have some sort of check, it makes sense only if it is very simple or if it prevents us from having to maintain updates in 2 places</p>",
        "id": 222121247,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610137615
    },
    {
        "content": "<p>My concern is about the scripts being on the root folder of sample-ig - and we may need to put it inside a folder if we want to keep only one source.</p>",
        "id": 222121560,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610137792
    },
    {
        "content": "<p>We want the warning to show up in the qa.html, not elsewhere.  The qa.html is part of the publication and it needs to be there for external review purposes.  So moving it isn't an option.  I don't understand why we'd want to duplicate it.</p>",
        "id": 222122549,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610138268
    },
    {
        "content": "<p>Note that we don't have to put the scripts in the sample-ig at all if it's too hard.  Simply providing guidance in the readme that explains where to download the desired 'upload scripts' script is sufficient if we can't find an automated way to make it work.</p>",
        "id": 222122708,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610138338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222122549\">said</a>:</p>\n<blockquote>\n<p>We want the warning to show up in the qa.html, not elsewhere.  The qa.html is part of the publication and it needs to be there for external review purposes.  So moving it isn't an option.  I don't understand why we'd want to duplicate it.</p>\n</blockquote>\n<p>You're talking about the <code>publisher.jar</code> version check? I'm not suggesting that should be moved or duplicated</p>",
        "id": 222122962,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610138471
    },
    {
        "content": "<p>I'm talking about a separate version check for the script files in <a href=\"https://github.com/HL7/ig-publisher-scripts\">https://github.com/HL7/ig-publisher-scripts</a>, which isn't hard to implement and I think is worthwhile for the reasons I described above. I don't believe this currently exists, but it would make sense with the introduction of tagged releases in <a href=\"https://github.com/HL7/ig-publisher-scripts\">https://github.com/HL7/ig-publisher-scripts</a></p>",
        "id": 222123261,
        "sender_full_name": "Max Masnick",
        "timestamp": 1610138639
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Releases.20of.20sample-ig.3F/near/222122708\">said</a>:</p>\n<blockquote>\n<p>Note that we don't have to put the scripts in the sample-ig at all if it's too hard.  Simply providing guidance in the readme that explains where to download the desired 'upload scripts' script is sufficient if we can't find an automated way to make it work.</p>\n</blockquote>\n<p>the simplest i can think of is to put the _updatePublisher script in the IG root folder. Once people run it, they will get the other scripts, and the _updatePublisher will update itself</p>",
        "id": 222123816,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610138906
    },
    {
        "content": "<p>We don't really want the _updatePublisher committed in more than one place though.  Doing so would eliminate at least some of the benefit of maintaining the scripts only in a tightly controlled repository.</p>",
        "id": 222125959,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610140047
    },
    {
        "content": "<p>Just realized that we may need to keep  the scripts (or at least _updatePublisher) in the sample IG for a while, because that is where all the _updatePublishers out there will get the scripts from.</p>",
        "id": 222127784,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610141012
    },
    {
        "content": "<p>so we need to allow current IGs to update the _updatePublisher from the sampleIG , even if it is just to be able to run it again and get the scripts from the repo</p>",
        "id": 222127928,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610141075
    },
    {
        "content": "<p>Not really.  If we yank them, the update scripts will just stop working.  I think we push the current ones for a week or so and tell everyone to update.  Those who fail to do so will find that they fail to work and will need to go download.</p>",
        "id": 222127961,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610141096
    },
    {
        "content": "<p>2 weeks and a dedicated Zulip stream for the complaints. Deal? <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 222133715,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610144369
    },
    {
        "content": "<p>(jk about the zulip stream of course)</p>",
        "id": 222133798,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610144405
    },
    {
        "content": "<p>just document well the very specific error that happens when someone failed to update... (making it easy to search the internet for, start a zulip thread covering it)...</p>",
        "id": 222297487,
        "sender_full_name": "John Moehrke",
        "timestamp": 1610372365
    },
    {
        "content": "<p>FYI -- there was a bug in the download location in the scripts causing the dynamic script updates to fail.  I've submitted a PR.  <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> / <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> -- can you review? <a href=\"https://github.com/HL7/ig-publisher-scripts/pull/3\">https://github.com/HL7/ig-publisher-scripts/pull/3</a></p>",
        "id": 222585413,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1610547580
    },
    {
        "content": "<p>reviewed. Thanks</p>",
        "id": 222591564,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1610549884
    },
    {
        "content": "<p>Cool.  So how do we get that merged?  We have a ready update for SUSHI that points to the new scripts, but I don't want to release that until the scripts have been fixed here.</p>",
        "id": 222593613,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1610550522
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> merged it.  Thanks, Lloyd!</p>",
        "id": 222609060,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1610556175
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  <a href=\"https://github.com/FHIR/sample-ig/pull/45\">https://github.com/FHIR/sample-ig/pull/45</a> <br>\nupdates the sample script so that all scripts point to the same location</p>",
        "id": 226024923,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1613063564
    },
    {
        "content": "<p>Merged</p>",
        "id": 226030817,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1613065925
    }
]