[
    {
        "content": "<p>I am trying to slice on the Device.identifier. One slice represents the IEEE system id. The other slice the transport address. To do so the discriminator slices on value with the path pointing to the identifier.type. In the system id slice, the type is bound to a value set that only contains the single code \"SYSID\" from an IG-defined code system called ContinuaDeviceIdenfiers. The transport slice binds to a value set that contains 3 codes all representing different types of transports. These value sets and code system look correct in the Artifacts page of the rendered guide.</p>\n<p>Yet the validator does not discriminate between the slices and I don't know why. It gives me this error</p>\n<div class=\"codehilite\"><pre><span></span>Device/phd-711000FEFF5F49B0.B0495F001071: Device.identifier[1]  error   Profile http://hl7.org/fhir/uv/phd/StructureDefinition/PhdDevice, Element matches more than one slice - systemIdIdentifier, transportAddressIdentifier\nDevice/phd-711000FEFF5F49B0.B0495F001071: Device.identifier[2]  error   Profile http://hl7.org/fhir/uv/phd/StructureDefinition/PhdDevice, Element matches more than one slice - systemIdIdentifier, transportAddressIdentifier\n</pre></div>\n\n\n<p>It does not seem to be able to tell that there are two slices distinguished by identifier.type.coding.code=\"SYSID\" and identifier.type.coding.code=\"BTMAC\" <br>\nHere is my slicing: (I wish they weren't so BIG!!!)</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;!-- IDENTIFIER --&gt;\n    &lt;!-- The identifier is used for the system id and transport addresses. There can be many such identifiers. The Contina slices shall be identified by the system element value --&gt;\n    &lt;element id=&quot;Device.identifier&quot;&gt;\n      &lt;path value=&quot;Device.identifier&quot; /&gt;\n      &lt;slicing&gt;\n        &lt;discriminator&gt;\n          &lt;type value=&quot;value&quot; /&gt;\n          &lt;path value=&quot;type&quot; /&gt;\n        &lt;/discriminator&gt;\n        &lt;rules value=&quot;open&quot; /&gt;\n      &lt;/slicing&gt;\n      &lt;short value=&quot;Information that uniquely describes the personal health device&quot; /&gt;\n      &lt;definition value=&quot;The assigned unique identification of the device that is semantically meaningful outside of the FHIR resource context. An example would be the IEEE EUI-64 System-Id or transport address. For PHDs the systemIdentifier is required and the transportAddressIdentifier is highly recommended as this is what most end users see and can obtain from the device itself or device packaging.&quot; /&gt;\n      &lt;alias value=&quot;11073-20601 System id, transport address, etc.&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n    &lt;/element&gt;\n\n    &lt;!-- Give the Continua system id slice a name. This slice shall exist --&gt;\n    &lt;element id=&quot;Device.identifier:systemIdIdentifier&quot;&gt;\n      &lt;path value=&quot;Device.identifier&quot; /&gt;\n      &lt;sliceName value=&quot;systemIdIdentifier&quot; /&gt;\n      &lt;short value=&quot;System Id identifier&quot; /&gt;\n      &lt;definition value=&quot;This entry contains the IEEE EUI-64. If absent (bad device) set to all zeros.&quot; /&gt;\n      &lt;alias value=&quot;11073-20601 System id&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;max value=&quot;1&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:systemIdIdentifier.type&quot;&gt;\n      &lt;path value=&quot;Device.identifier.type&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;binding&gt;\n        &lt;strength value=&quot;required&quot;/&gt;\n        &lt;valueSet value=&quot;http://hl7.org/fhir/uv/phd/ValueSet/DeviceSystemIdIdentifier&quot;/&gt;\n      &lt;/binding&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:systemIdIdentifier.type.coding&quot;&gt;\n      &lt;path value=&quot;Device.identifier.type.coding&quot; /&gt;\n      &lt;short value=&quot;Indicates this is the IEEE 11073 System Id identifier&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:systemIdIdentifier.type.coding.system&quot;&gt;\n      &lt;path value=&quot;Device.identifier.type.coding.system&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;fixedUri value=&quot;http://hl7.org/fhir/uv/phd/CodeSystem/ContinuaDeviceIdentifiers&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:systemIdIdentifier.type.coding.code&quot;&gt;\n      &lt;path value=&quot;Device.identifier.type.coding.code&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;fixedCode value=&quot;SYSID&quot; /&gt;\n    &lt;/element&gt;\n    &lt;!-- The system element of the systemIdentifier slice shall indicate the EUI  --&gt;\n    &lt;element id=&quot;Device.identifier:systemIdIdentifier.system&quot;&gt;\n      &lt;path value=&quot;Device.identifier.system&quot; /&gt;\n      &lt;short value=&quot;EUI-64 system identifier&quot; /&gt;\n      &lt;definition value=&quot;Identifies the system as an IEEE EUI.&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;fixedUri value=&quot;urn:oid:1.2.840.10004.1.1.1.0.0.1.0.0.1.2680&quot; /&gt;\n    &lt;/element&gt;\n    &lt;!-- The value element of the systemIdentifier slice shall have the system id attribute value  --&gt;\n    &lt;element id=&quot;Device.identifier:systemIdIdentifier.value&quot;&gt;\n      &lt;path value=&quot;Device.identifier.value&quot; /&gt;\n      &lt;short value=&quot;System id value from System-Id attribute&quot; /&gt;\n      &lt;definition value=&quot;The System id from the System-Id attribute as an 8-byte HEX string where each byte is separated by dashes, for example FE-ED-AB-EE-DE-AD-77-C3. &quot; /&gt;\n      &lt;comment value=&quot;The formatting is specified in the IEEE document Guidelines for 64-bit Global Identifier.&amp;#xD;&amp;#xA;&amp;#xD;&amp;#xA;To allow the mapping of non-compliant proprietary devices that do not provide a system id, the value is set to all zeros in the same format, 00-00-00-00-00-00-00-00&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n    &lt;/element&gt;\n\n    &lt;element id=&quot;Device.identifier:transportAddressIdentifier&quot;&gt;\n      &lt;path value=&quot;Device.identifier&quot; /&gt;\n      &lt;sliceName value=&quot;transportAddressIdentifier&quot; /&gt;\n      &lt;short value=&quot;Transport address identifier&quot; /&gt;\n      &lt;definition value=&quot;This entry contains the transport address, for example the Bluetooth, ZigBee, USB, or mac address.&quot; /&gt;\n      &lt;comment value=&quot;USB does not have an &#39;address&#39; as it is a point to point wired protocol. However, it does have a Vendor identification and Production identification number which together uniquely define the unit. For USB transports, the VID.PID in HEX is used as the transport identifier.&quot; /&gt;\n      &lt;alias value=&quot;Transport address&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:transportAddressIdentifier.type&quot;&gt;\n      &lt;path value=&quot;Device.identifier.type&quot; /&gt;\n      &lt;binding&gt;\n        &lt;strength value=&quot;required&quot;/&gt;\n        &lt;valueSet value=&quot;http://hl7.org/fhir/uv/phd/ValueSet/DeviceTransportIdentifiers&quot;/&gt;\n      &lt;/binding&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:transportAddressIdentifier.type.coding&quot;&gt;\n      &lt;path value=&quot;Device.identifier.type.coding&quot; /&gt;\n      &lt;short value=&quot;Indicates this is the IEEE 11073 System Id identifier&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:transportAddressIdentifier.type.coding.system&quot;&gt;\n      &lt;path value=&quot;Device.identifier.type.coding.system&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;fixedUri value=&quot;http://hl7.org/fhir/uv/phd/CodeSystem/ContinuaDeviceIdentifiers&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:transportAddressIdentifier.type.coding.code&quot;&gt;\n      &lt;path value=&quot;Device.identifier.type.coding.code&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:transportAddressIdentifier.system&quot;&gt;\n      &lt;path value=&quot;Device.identifier.system&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Device.identifier:transportAddressIdentifier.value&quot;&gt;\n      &lt;path value=&quot;Device.identifier.value&quot; /&gt;\n      &lt;definition value=&quot;The transport address. If Bluetooth, use an EUI-48 such as 00-E5-DE-AD-77-C3. If a USB device use the VID.PID as HEX such as 0043.F90D. If a ZigBee address use an EUI-64 as with the system id.&quot; /&gt;\n      &lt;comment value=&quot;Transport addresses are supposed to be unique for a given device.&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n    &lt;/element&gt;\n</pre></div>",
        "id": 154020851,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1543240920
    },
    {
        "content": "<p>You shouldn't be setting fixed values for the code and system.  What does your instance look like?  What do your value sets look like?</p>",
        "id": 154020867,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1543244844
    },
    {
        "content": "<blockquote>\n<p>You shouldn't be setting fixed values for the code and system.  What does your instance look like?  What do your value sets look like?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>   The value set for the SystemIdIdentifier binding looks like this</p>\n<div class=\"codehilite\"><pre><span></span>  &lt;compose&gt;\n    &lt;include&gt;\n      &lt;system value=&quot;http://hl7.org/fhir/uv/phd/CodeSystem/ContinuaDeviceIdentifiers&quot;/&gt;\n      &lt;concept&gt;\n        &lt;code value=&quot;SYSID&quot;/&gt;\n      &lt;/concept&gt;\n    &lt;/include&gt;\n  &lt;/compose&gt;\n</pre></div>\n\n\n<p>The value set for the TransportIdentifier looks like this</p>\n<div class=\"codehilite\"><pre><span></span>  &lt;compose&gt;\n    &lt;include&gt;\n      &lt;system value=&quot;http://hl7.org/fhir/uv/phd/CodeSystem/ContinuaDeviceIdentifiers&quot;/&gt;\n      &lt;concept&gt;\n        &lt;code value=&quot;BTMAC&quot;/&gt;\n      &lt;/concept&gt;\n      &lt;concept&gt;\n        &lt;code value=&quot;USB&quot;/&gt;\n      &lt;/concept&gt;\n      &lt;concept&gt;\n        &lt;code value=&quot;ZIGBEE&quot;/&gt;\n      &lt;/concept&gt;\n    &lt;/include&gt;\n  &lt;/compose&gt;\n</pre></div>\n\n\n<p>In the systemId case the system is a fixed value. In the transport case, I don't know what the system value is. Are you saying I need to drop the system element in the systemId case? I not sure how the system effects the discriminators as that is done on the type element. Isn't that all the parsers need to consider?</p>",
        "id": 154020870,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1543245283
    },
    {
        "content": "<p>If you want to match on identifiers, you need system + value.  \"type\" is irrelevant and is only intended for humans.  What does your instance look like?</p>",
        "id": 154020872,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1543246726
    },
    {
        "content": "<blockquote>\n<p>If you want to match on identifiers, you need system + value.  \"type\" is irrelevant and is only intended for humans.  What does your instance look like?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  Well that (you cant bind on type) is unexpected given it is a CodeableConcept! Isn't a CodeableConcept designed for machine reading? </p>\n<p>The problem is that I do not have system values for the different cases or I would use that (I started with that). I only know of a system value for the systemId case. I have no 'system' value for the various transport cases.</p>\n<p>I changed my instance to use the type so it looks like this</p>\n<div class=\"codehilite\"><pre><span></span>&quot;identifier&quot;: [\n    {\n        &quot;type&quot;: {\n            &quot;coding&quot;: [\n                {\n                    &quot;system&quot;: &quot;http://hl7.org/fhir/uv/phd/CodeSystem/ContinuaDeviceIdentifiers&quot;,\n                    &quot;code&quot;: &quot;SYSID&quot;\n                }\n            ],\n            &quot;text&quot;: &quot;System Identifier&quot;\n        },\n        &quot;system&quot;: &quot;urn:oid:1.2.840.10004.1.1.1.0.0.1.0.0.1.2680&quot;,\n        &quot;value&quot;: &quot;00-09-1F-FF-FE-80-07-3A&quot;\n    },\n    {\n        &quot;type&quot;: {\n            &quot;coding&quot;: [\n                {\n                    &quot;system&quot;: &quot;http://hl7.org/fhir/uv/phd/CodeSystem/ContinuaDeviceIdentifiers&quot;,\n                    &quot;code&quot;: &quot;BTMAC&quot;\n                }\n            ],\n            &quot;text&quot;: &quot;Bluetooth Address&quot;\n        },\n        &quot;value&quot;: &quot;00-09-1F-80-07-3A&quot;\n    }\n],\n</pre></div>",
        "id": 154020873,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1543247161
    },
    {
        "content": "<p>I didn't say you couldn't bind on type.  I just said that it's not used for identifier matching.  And I'm suggesting that you'd be better off defining \"system\" values for each identifier system rather than defining custom identifier types.</p>",
        "id": 154020881,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1543249752
    }
]