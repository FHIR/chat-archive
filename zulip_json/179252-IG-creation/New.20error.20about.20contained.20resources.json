[
    {
        "content": "<p>I just updated my IG publisher from 1.1.73 to 1.1.81 and I'm getting a new error around contained resources and I'm pretty sure that the error is incorrect, but I'll welcome a change in my understanding.  In a repository that ran clean before (<br>\n<a href=\"https://github.com/hl7/fhir-spl\">https://github.com/hl7/fhir-spl</a>), the new error I'm getting is:</p>\n<div class=\"codehilite\"><pre><span></span><code>ref-1: &#39;SHALL have a contained resource if a local reference is provided&#39; &#39;SHALL have a contained resource if a local reference is provided&#39; ( (url: usagent; ids: ))\n</code></pre></div>\n<p>The resource in question has three contained resources.  One OrganizationAffilation references the containing resource and references another contained resource:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n      &quot;resourceType&quot; : &quot;OrganizationAffiliation&quot;,\n      &quot;id&quot; : &quot;SampleLabelerUSAgentAffiliation&quot;,\n      &quot;meta&quot; : {\n        &quot;profile&quot; : [\n          &quot;http://hl7.org/fhir/us/spl/StructureDefinition/USAgentAffiliation&quot;\n        ]\n      },\n      &quot;organization&quot; : {\n        &quot;reference&quot; : &quot;#&quot;\n      },\n      &quot;participatingOrganization&quot; : {\n        &quot;reference&quot; : &quot;#usagent&quot;\n      },\n      &quot;code&quot; : [\n        {\n          &quot;coding&quot; : [\n            {\n              &quot;system&quot; : &quot;http://ncicb.nci.nih.gov/xml/owl/EVS/Thesaurus.owl&quot;,\n              &quot;code&quot; : &quot;C73330&quot;,\n              &quot;display&quot; : &quot;Foreign Facility&#39;s United States Agent&quot;\n            }\n          ]\n        }\n      ]\n    },\n</code></pre></div>\n<p>This is the resource that is getting the error and from the error message, I'm assuming that it's taking the #usagent and expecting that to be in a contained resource within the resource itself.  But a) contained resources can't contain resources and b) the relative link is intended to be to other contained resources.</p>",
        "id": 255757112,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1633100219
    },
    {
        "content": "<p>And #usagent exists as a resource in a sibling contained resource?</p>",
        "id": 255772368,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633106316
    },
    {
        "content": "<p>Yep, it's in the same array of contained resources. <a href=\"/user_uploads/10155/z-IjPYROsdLL9_bxNN-lSMuh/Organization-SampleLabelerOrganization.json\">Organization-SampleLabelerOrganization.json</a></p>",
        "id": 255783515,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1633111069
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 255830061,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633138204
    },
    {
        "content": "<p>well this one is weird. Certainly nothing has changed in the validation layer that has anything to do with this</p>",
        "id": 256001536,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633318306
    },
    {
        "content": "<p>like I said, it wasn't an error in 1.1.73 but it is in 1.1.81</p>",
        "id": 256002470,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1633319310
    },
    {
        "content": "<p>oh this might be Lloyd's changes around invariant validation</p>",
        "id": 256003838,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633320635
    },
    {
        "content": "<p>Did I mess up, or is it just now checking something it wasn't before?</p>",
        "id": 256003931,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633320731
    },
    {
        "content": "<p>well, the error actually happens when it's checking slicing. So it shouldn't be recorded (as well as it shouldn't happen)</p>",
        "id": 256004095,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633320924
    },
    {
        "content": "<p>the underlying issue is that conformsTo() jumps into the bundle in the contained resource, without the context, so the contained references can't be resolved.</p>",
        "id": 256004368,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633321179
    },
    {
        "content": "<p>fixed next release. Seems like some sort of discovered check, because the issue has always been there</p>",
        "id": 256008072,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633325031
    },
    {
        "content": "<p>I feel like I have similar scenario here. I have QuestionnaireResponse who has 2 contained resources - Questionnaire and ValueSet. Questionnaire contained resource is referencing ValueSet as #VSPHQ9 (where VSPHQ9 is the id of the contained ValueSet). In QA - I am getting this warning message \"ValueSet #VSPHQ9 not found by validator\" - Any insights on why this might be happening?</p>",
        "id": 263061704,
        "sender_full_name": "Ramandeep Dhanoa",
        "timestamp": 1638216616
    },
    {
        "content": "<p>no. how would I reproduce?</p>",
        "id": 263062149,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638216881
    },
    {
        "content": "<p>I have pushed the example in the CI-build. Here is the example: <a href=\"https://build.fhir.org/ig/HL7/sdc/QuestionnaireResponse-adaptive-questionnaireresponse-sdc-example-phq9.html\">https://build.fhir.org/ig/HL7/sdc/QuestionnaireResponse-adaptive-questionnaireresponse-sdc-example-phq9.html</a><br>\nand warning message:<br>\n<a href=\"https://build.fhir.org/ig/HL7/sdc/qa.html#_scratch_ig-build-temp-1S9L3Q_repo_input_examples_adaptive-questionnaireresponse-sdc-profile-example-PHQ9\">https://build.fhir.org/ig/HL7/sdc/qa.html#_scratch_ig-build-temp-1S9L3Q_repo_input_examples_adaptive-questionnaireresponse-sdc-profile-example-PHQ9</a></p>",
        "id": 263063417,
        "sender_full_name": "Ramandeep Dhanoa",
        "timestamp": 1638217601
    },
    {
        "content": "<p>fixed next release, though you'll get lots of validation errors once it's fixed.</p>",
        "id": 263386975,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638413050
    },
    {
        "content": "<p>did this get fixed? I seem to have this showing up</p>",
        "id": 264882911,
        "sender_full_name": "John Moehrke",
        "timestamp": 1639498918
    },
    {
        "content": "<p>what specifically is showing up?</p>",
        "id": 264908247,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1639508314
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I am getting errors using \"rel-1\" where I have contained resoruces. I don't know how to make it more contained than it already is.</p>",
        "id": 264934654,
        "sender_full_name": "John Moehrke",
        "timestamp": 1639520194
    }
]