[
    {
        "content": "<p>My IG has defined a new extension that is to be applied to a code system, however when I use this extension in the IG, it fails to find it and gives validation errors.<br>\n(I even created the CodeSystem profile, and referenced it to the CS, and the validator result in the qa.html says it can't find the profile too)<br>\nMoving the definition of the extension and profile ahead of the code system doesn't help</p>",
        "id": 168568336,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561009111
    },
    {
        "content": "<p>what's the extension?</p>",
        "id": 168568351,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1561009170
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>&lt;StructureDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n    &lt;id value=&quot;lga-centrepoint&quot; /&gt;\n    &lt;url value=&quot;http://fhir.telstrahealth.com/th-epd/StructureDefinition/lga-centrepoint&quot; /&gt;\n...\n&lt;kind value=&quot;primitive-type&quot; /&gt;\n    &lt;abstract value=&quot;false&quot; /&gt;\n    &lt;context&gt;\n        &lt;type value=&quot;element&quot; /&gt;\n        &lt;expression value=&quot;CodeSystem.concept&quot; /&gt;\n    &lt;/context&gt;\n    &lt;type value=&quot;Extension&quot; /&gt;\n    &lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Extension&quot; /&gt;\n    &lt;derivation value=&quot;constraint&quot; /&gt;\n</pre></div>",
        "id": 168568401,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561009222
    },
    {
        "content": "<p>Then using it in my CodeSystem like</p>\n<div class=\"codehilite\"><pre><span></span>&lt;CodeSystem xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n    &lt;id value=&quot;hcxdir-locality&quot; /&gt;\n    &lt;meta&gt;\n        &lt;profile value=&quot;http://fhir.telstrahealth.com/th-epd/StructureDefinition/hcxdir-codesystem&quot;/&gt;\n    &lt;/meta&gt;\n...\n    &lt;concept id=&quot;16986&quot;&gt;\n        &lt;extension url=&quot;http://fhir.telstrahealth.com/th-epd/StructureDefinition/lga-centrepoint&quot;&gt;\n            &lt;valueString value=&quot;POINT(146.6999019,-36.9153738)&quot; /&gt;\n        &lt;/extension&gt;\n        &lt;code value=&quot;ABBEYARD, 3737 VIC&quot; /&gt;\n        &lt;display value=&quot;ABBEYARD, 3737 VIC&quot; /&gt;\n    &lt;/concept&gt;\n</pre></div>",
        "id": 168568409,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561009253
    },
    {
        "content": "<p>Then in the QA :<br>\n<a href=\"/user_uploads/10155/tf_iideJ5NHFnYFadJbSt5Qo/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/tf_iideJ5NHFnYFadJbSt5Qo/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/tf_iideJ5NHFnYFadJbSt5Qo/pasted_image.png\"></a></div>",
        "id": 168568466,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561009342
    },
    {
        "content": "<p>The IG does render the codesystem, profile, and extensions correctly, so they are in the guide (and the others don't report any qa errors)</p>",
        "id": 168568488,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561009423
    },
    {
        "content": "<p>you have to add <a href=\"http://fhir.telstrahealth.com/th-epd\" target=\"_blank\" title=\"http://fhir.telstrahealth.com/th-epd\">http://fhir.telstrahealth.com/th-epd</a> as an allowed extension domain</p>",
        "id": 168572176,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1561014950
    },
    {
        "content": "<p>Where does that go? IG.Json?</p>",
        "id": 168572344,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561015175
    },
    {
        "content": "<p>That is the canonical base for my whole guide.</p>",
        "id": 168572355,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561015190
    },
    {
        "content": "<p>oh then the extension should be recognised.</p>",
        "id": 168572679,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1561015593
    },
    {
        "content": "<p>I might need to debug it</p>",
        "id": 168572680,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1561015598
    },
    {
        "content": "<p>Ok.</p>",
        "id": 168573207,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561016171
    },
    {
        "content": "<p>I managed to get debugging this, and discovered that the csvalidator doesn't seem to be configured to resolve references from the IG Publisher - which there is a comment above a little that is used for doing InstanceValidations<br>\n<a href=\"https://github.com/HL7/fhir-ig-publisher/blob/1ba4ad3ce5cbe06611a68bea057a60c0abde1152/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L1371\" target=\"_blank\" title=\"https://github.com/HL7/fhir-ig-publisher/blob/1ba4ad3ce5cbe06611a68bea057a60c0abde1152/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L1371\">https://github.com/HL7/fhir-ig-publisher/blob/1ba4ad3ce5cbe06611a68bea057a60c0abde1152/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L1371</a><br>\nAnd probably the same for the ProfileValidator too<br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> does this look right?</p>",
        "id": 168652567,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561087242
    },
    {
        "content": "<p>you aren't getting that error from the code System validator....</p>",
        "id": 168655209,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1561092097
    },
    {
        "content": "<p>Have worked it out, any of the resource types that are loaded before StructureDefinition can't have extensions defined in the IG<br>\n<a href=\"https://github.com/HL7/fhir-ig-publisher/blob/1ba4ad3ce5cbe06611a68bea057a60c0abde1152/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L2852\" target=\"_blank\" title=\"https://github.com/HL7/fhir-ig-publisher/blob/1ba4ad3ce5cbe06611a68bea057a60c0abde1152/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L2852\">https://github.com/HL7/fhir-ig-publisher/blob/1ba4ad3ce5cbe06611a68bea057a60c0abde1152/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L2852</a><br>\nAs its during the load(), not the scan() that the extension resource is cached into the context so that the fetcher can find them, and hence validate correctly.<br>\nTo fix this I moved the StructureDefinition to the top of the load() calls in the block, alternately the scan could cache the StructureDefinitions too.</p>",
        "id": 168819565,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561346950
    },
    {
        "content": "<p>How Does the affect the current igs ?</p>",
        "id": 168819893,
        "sender_full_name": "Eric Haas",
        "timestamp": 1561347414
    },
    {
        "content": "<p>You would be getting validation errors in your QA report if you were subject to the issue.<br>\nMy IG had extensions in the CodeSystem, so suffered.<br>\nAny Extensions defined in your IG on NamingSystem, CodeSystem, ValueSet, ConceptMap or DataElement types would fail (which mine did)</p>",
        "id": 168820662,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561348896
    },
    {
        "content": "<p>that's not such a simple fix. let me think about that. Scan is supposed to pick stuff up like that. can you make an issue report</p>",
        "id": 168838396,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1561372701
    },
    {
        "content": "<p>Sure will do.<br>\n(enjoying the drive?)</p>",
        "id": 168844721,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561379218
    },
    {
        "content": "<p>today was hard - 550km of wall to wall nothing.... just scrub. Real badlands (port Augusta --&gt; Coober Pedy)</p>",
        "id": 168845615,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1561380101
    },
    {
        "content": "<p>Staying in a hole in the ground?  Childhood memories ;)</p>",
        "id": 168845692,
        "sender_full_name": "Brett Esler",
        "timestamp": 1561380153
    },
    {
        "content": "<p>doing some mining?</p>",
        "id": 168845723,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1561380202
    },
    {
        "content": "<p>data or opals?</p>",
        "id": 168845792,
        "sender_full_name": "Brett Esler",
        "timestamp": 1561380262
    },
    {
        "content": "<p>hah. we have a van, so we're staying in that. Kath is doing a tour of some holes in the ground tomorrow. I'm heading out on the oodnadatta track</p>",
        "id": 168847052,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1561381324
    },
    {
        "content": "<p>Logged <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22758\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22758\">GF#22758</a></p>",
        "id": 168893959,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1561418814
    }
]