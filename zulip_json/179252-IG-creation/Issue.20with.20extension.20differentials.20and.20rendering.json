[
    {
        "content": "<p>When updating <a href=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-race.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-race.html\">race</a> and <a href=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-ethnicity.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-ethnicity.html\">ethnicity</a> extensions in  US Core we discovered a few issues.... Our complex differentials lacked the element ...</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;element id=&quot;Extension.value[x]&quot;&gt;\n      &lt;path value=&quot;Extension.value[x]&quot;/&gt;\n      &lt;min value=&quot;0&quot;/&gt;\n      &lt;max value=&quot;0&quot;/&gt;\n    &lt;/element&gt;\n</pre></div>\n\n\n<p>... but contain  <code>Extension.extension</code> elements.  </p>\n<p>This resulted in:</p>\n<ul>\n<li>a valid StructureDefinition according to the validator  (yay!)</li>\n<li>an error in <a href=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/US-Core-R4/StructureDefinition-us-core-patient.html\">US Core Patient</a>  example instance that populate the extension:  <code>The Extension 'http://hl7.org/fhir/us/core/StructureDefinition/us-core-race' definition is for a simple extension, so it must contain a value, not extensions</code>  (dang!)</li>\n<li>US Core Patient rendering of an extension with type of an array of every value[x] instead of \"(Complex)\"  (dang!)  here is a screenshot of this...</li>\n</ul>\n<p><a href=\"/user_uploads/10155/POwa_MJU5OHchTHcgdKQV4yh/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<p>Unless there is some irreconcilable technical reason for this,  I think a valid diff should be able to have an Extension.value[x] or <code>Extension.extension</code> element without having to declare a max value=\"0\" for the other element.</p>\n<p>*Note source for race and ethnicity are here:   <a href=\"https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-race.xml\" target=\"_blank\" title=\"https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-race.xml\">https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-race.xml</a> and <a href=\"https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-ethnicity.xml\" target=\"_blank\" title=\"https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-ethnicity.xml\">https://github.com/HL7/US-Core-R4/blob/master/source/resources/structuredefinition-us-core-ethnicity.xml</a></p>",
        "id": 179971385,
        "sender_full_name": "Eric Haas",
        "timestamp": 1572984426
    },
    {
        "content": "<blockquote>\n<p>I think a valid diff should be able to have an Extension.value[x] or Extension.extension element without having to declare a max value=\"0\" for the other element.</p>\n</blockquote>",
        "id": 179975292,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572986626
    },
    {
        "content": "<p>why?</p>",
        "id": 179975295,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572986627
    },
    {
        "content": "<p>Extensions aren't 'special'.  If you want to prohibit an element, you need to be explicit.</p>",
        "id": 179975392,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572986678
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>   there is an invariant that says you can't have both so my reasoning if you have a value[x] then you would assume the extension.extension is max = 0 and vice versa in your differential.</p>",
        "id": 179975978,
        "sender_full_name": "Eric Haas",
        "timestamp": 1572987006
    },
    {
        "content": "<p>and besides value[x] and extension are min = 0</p>",
        "id": 179976132,
        "sender_full_name": "Eric Haas",
        "timestamp": 1572987118
    },
    {
        "content": "<p>But if I am wrong or missed some key documentation then that's OK too.  But if this is not documented then would be nice to make explicit        ( where to document is the question )</p>",
        "id": 179976291,
        "sender_full_name": "Eric Haas",
        "timestamp": 1572987216
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> it's not really about wrong or right, to me. The code that does the rendering is generic for all structure definitions. It doesn't know anything about extensions, or the implications of the invariant that refer to. And I'm not going to try and infer meaning out of inherited invariants like that while rendering. (sorry). It does mean that that differentials need to be a bit more verbose, but it makes them consistent.</p>",
        "id": 179976636,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572987411
    },
    {
        "content": "<p>as for </p>\n<blockquote>\n<p>The Extension '<a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race\" target=\"_blank\" title=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race\">http://hl7.org/fhir/us/core/StructureDefinition/us-core-race</a>' definition is for a simple extension, so it must contain a value, not extensions</p>\n</blockquote>\n<p>I could revise that, since it's extension specific logic, but what should that code do when the extension definition allows for both value[x] and extension? How does that code decide what you actually mean? The base extension allows both, and says, choose one. That means you actually have to choose, and you do that by setting the cardinality one of them to 0. All the extension processing logic works that way. So just set it to 0. </p>\n<p>As for where this is documented.... I don't know. It's obvious to me. But I'm ok to make it explicit somewhere if you can identify the most logical place</p>",
        "id": 179976894,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572987548
    },
    {
        "content": "<p>Since it was not obvious to me,  I'll assume won't be to others. I'll read through spec and see where is make the most sense to document it and create a tracker...</p>",
        "id": 179977623,
        "sender_full_name": "Eric Haas",
        "timestamp": 1572987902
    },
    {
        "content": "<p>ok. and you're going to fix US-Core?</p>",
        "id": 179978414,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572988419
    },
    {
        "content": "<p>Fixed</p>",
        "id": 179992591,
        "sender_full_name": "Eric Haas",
        "timestamp": 1573000521
    },
    {
        "content": "<p>Ok Iâ€™ll release shorlty</p>",
        "id": 179993463,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573001538
    }
]