[
    {
        "content": "<p>I'm working on a FHIR 1.0.2 -based IG that has a dependency on Argonaut Data Query.  I have this in the control file:</p>\n<div class=\"codehilite\"><pre><span></span>&quot;dependencyList&quot;: [\n    {\n      &quot;name&quot;: &quot;argonaut&quot;,\n      &quot;location&quot;: &quot;https://www.fhir.org/guides/argonaut/r2&quot;,\n      &quot;source&quot;: &quot;argonaut&quot;,\n      &quot;version&quot;: &quot;1.0.0&quot;\n    }\n  ]\n</pre></div>\n\n\n<p>and the IG publisher spits out this error:</p>\n<div class=\"codehilite\"><pre><span></span>Fetch Package history from https://www.fhir.org/guides/argonaut/r2/package-list.json\nPublishing Content Failed: https://www.fhir.org/guides/argonaut/r2/package-list.json (10.0922sec)\n                                                                                 (10.0922sec)\nUse -? to get command line help                                                  (10.0922sec)\n                                                                                 (10.0922sec)\nStack Dump (for debugging):                                                      (10.0922sec)\njava.io.FileNotFoundException: https://www.fhir.org/guides/argonaut/r2/package-list.json\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1890)\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1492)\n    at sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:263)\n    at org.hl7.fhir.igtools.publisher.Publisher.fetchJson(Publisher.java:1545)\n    at org.hl7.fhir.igtools.publisher.Publisher.resolveDependency(Publisher.java:1529)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadIg(Publisher.java:1456)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1111)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:507)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:4895)\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:4905)\n</pre></div>",
        "id": 154013228,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1540822877
    },
    {
        "content": "<p>I tried it without the <code>/r2</code>, but that basically had the same result.  I also downloaded the <code>validator.pack</code> and put it in a local folder <code>argonaut</code> (to match the <code>source</code> value in the control file).</p>",
        "id": 154013229,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1540823178
    },
    {
        "content": "<p>Anyone know how to properly indicate Argonaut Data Query as an IG dependency?</p>",
        "id": 154013230,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1540823259
    },
    {
        "content": "<p>So, does <em>no response</em> mean that no one else has tried to do this?  I'm trying to understand if this is a bug, a limitation, or if I'm just doing it the wrong way...</p>",
        "id": 154014452,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1541041521
    },
    {
        "content": "<p>My understanding is that is the correct way to do it, but because the package-list.json artifact was added after the Argonaut IG was published, it doesn't have that piece. You should be able to get around it by building the Argonaut guide locally and specifying dev in your dependency to it (so that it resolves in your local package cache). That's how I did this with QI-Core before it had a package-list.json file.</p>",
        "id": 154014601,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1541087392
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> -- thanks for the information.  It makes sense.  It's too bad though... I'm trying to build a toolchain that makes this super simple for IG authors, but this extra step of having to build the Argonaut IG locally first kind of messes that up.  (sigh).</p>",
        "id": 154014615,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1541088090
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> I'm catching up on things (always in that state, I guess). THe problem is that we don't have a package server... that's coming... in the meantime, I have a bunch of hacks in place, and I guess you've found a hole in my hacks</p>",
        "id": 154017029,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541738459
    },
    {
        "content": "<p>is this something I can reproduce?</p>",
        "id": 154017030,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1541738465
    },
    {
        "content": "<p>Thanks for the response, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>.  You should be able to reproduce it by simply trying to add the argonaut IG to the <code>dependencyList</code> in any ig.json.  If you're asking for a specific source repository to reproduce it, however, I don't have anything public right now.  I could probably put something simple together and attach here as a zip if you think that would be helpful.  Let me know.</p>",
        "id": 154018096,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1542133193
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- I've pushed a branch that adds the argonaut dependency to the FHIR test IG for DSTU2.  The branch is called <code>cmoesel_argonaut_dependency_example</code>.  You can see the diff here: <a href=\"https://github.com/HL7/fhir/compare/cmoesel_argonaut_dependency_example\" target=\"_blank\" title=\"https://github.com/HL7/fhir/compare/cmoesel_argonaut_dependency_example\">https://github.com/HL7/fhir/compare/cmoesel_argonaut_dependency_example</a></p>\n<p>If you run the publisher against the <code>tests/ig10</code> IG, you'll get a crash:</p>\n<div class=\"codehilite\"><pre><span></span>Fetch Package history from https://www.fhir.org/guides/argonaut/r2/package-list.json\nPublishing Content Failed: https://www.fhir.org/guides/argonaut/r2/package-list.json?nocache=1542406170409 (10.0164sec)\n                                                                                 (10.0164sec)\nUse -? to get command line help                                                  (10.0164sec)\n                                                                                 (10.0164sec)\nStack Dump (for debugging):                                                      (10.0164sec)\njava.io.FileNotFoundException: https://www.fhir.org/guides/argonaut/r2/package-list.json?nocache=1542406170409\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1890)\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1492)\n    at sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:263)\n    at org.hl7.fhir.igtools.publisher.Publisher.fetchJson(Publisher.java:1606)\n    at org.hl7.fhir.igtools.publisher.Publisher.resolveDependency(Publisher.java:1590)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadIg(Publisher.java:1517)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromJson(Publisher.java:1138)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:944)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:523)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:4925)\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:4935)\n</pre></div>",
        "id": 154019297,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1542406455
    },
    {
        "content": "<p>This is still an issue for the mCODE IG which is based on Argonaut.  Since we cannot register Argonaut as a dependency, all of the links to Argonaut value sets, extensions, and profiles are broken in our IG.  Is there any workaround to get it to be able to properly resolve those links?</p>\n<p>NOTE: I also updated the branch I reference above -- to rebase it on the latest code and fixed the Argonaut canonical URL from <code>https://www.fhir.org/guides/argonaut/r2</code> to <code>https://www.fhir.org/guides/argonaut</code>.</p>",
        "id": 162884407,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1554790659
    },
    {
        "content": "<p>There is now a package-list.json at <a href=\"http://www.fhir.org/guides/argonaut/r2/package-list.json\" target=\"_blank\" title=\"http://www.fhir.org/guides/argonaut/r2/package-list.json\">http://www.fhir.org/guides/argonaut/r2/package-list.json</a> -- so I can get further with this config:</p>\n<div class=\"codehilite\"><pre><span></span>&quot;dependencyList&quot;: [\n    {\n      &quot;name&quot;: &quot;argonaut&quot;,\n      &quot;location&quot;: &quot;http://fhir.org/guides/argonaut/r2&quot;,\n      &quot;version&quot;: &quot;1.0.0&quot;\n    }\n  ]\n</pre></div>\n\n\n<p>But... Now I'm getting this error: <strong>Attempt to import a mis-identified package. Expected fhir.argonaut.r2, got fhir.argonaut.ehr</strong>.</p>\n<div class=\"codehilite\"><pre><span></span>Fetch Package history from http://fhir.org/guides/argonaut/r2/package-list.json\nFetch fhir.argonaut.r2-1.0.0 package from http://fhir.org/guides/argonaut/r2/1.0/package.tgz (10.0217sec)\nInstalling fhir.argonaut.r2#1.0.0 to the package cache\n  Fetching:...|Publishing Content Failed: Attempt to import a mis-identified package. Expected fhir.argonaut.r2, got fhir.argonaut.ehr (11.0132sec)\n                                                                                 (11.0132sec)\nUse -? to get command line help                                                  (11.0132sec)\n                                                                                 (11.0132sec)\nStack Dump (for debugging):                                                      (11.0133sec)\njava.io.IOException: Attempt to import a mis-identified package. Expected fhir.argonaut.r2, got fhir.argonaut.ehr\n    at org.hl7.fhir.utilities.cache.PackageCacheManager.addPackageToCache(PackageCacheManager.java:361)\n    at org.hl7.fhir.igtools.publisher.Publisher.resolveDependency(Publisher.java:1666)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadIg(Publisher.java:1580)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromJson(Publisher.java:1198)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:984)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:555)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5172)\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5182)\n</pre></div>",
        "id": 163487831,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1555434853
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> -- are you aware of this issue?  Is there an easy fix?  (See my last comment for the most recent update on it).</p>",
        "id": 163669528,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1555606817
    },
    {
        "content": "<p>should be fixed now</p>",
        "id": 164859765,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1556963565
    },
    {
        "content": "<p>Thank you-- I'll give it a shot!</p>",
        "id": 164871890,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1556982246
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 164992983,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1557157750
    },
    {
        "content": "<p>So after some trial and error, I ended up declaring the dependency on Argonaut like this:</p>\n<div class=\"codehilite\"><pre><span></span>&quot;dependencyList&quot;: [\n    {\n      &quot;name&quot;: &quot;argonaut&quot;,\n      &quot;location&quot;: &quot;http://fhir.org/guides/argonaut/r2&quot;,\n      &quot;version&quot;: &quot;1.0.0&quot;\n    }\n  ]\n</pre></div>\n\n\n<p>This gets me further than ever before, but now I'm getting this error instead:</p>\n<div class=\"codehilite\"><pre><span></span>Fetch Package history from http://fhir.org/guides/argonaut/r2/package-list.json\nFetch fhir.argonaut.r2-1.0.0 package from http://fhir.org/guides/argonaut/r2/1.0/package.tgz (46.0535sec)\nInstalling fhir.argonaut.r2#1.0.0 to the package cache\n  Fetching:...|\n  Analysing.. done.\nLoad argonaut (http://fhir.org/guides/argonaut/r2) from null#1.0.0               (49.0972sec)\nPublishing Content Failed: Unable to find the file other/spec.internals in the package fhir.argonaut.r2 (49.0972sec)\n                                                                                 (49.0972sec)\nUse -? to get command line help                                                  (49.0972sec)\n                                                                                 (49.0973sec)\nStack Dump (for debugging):                                                      (49.0973sec)\njava.io.IOException: Unable to find the file other/spec.internals in the package fhir.argonaut.r2\n    at org.hl7.fhir.utilities.cache.NpmPackage.load(NpmPackage.java:252)\n    at org.hl7.fhir.igtools.publisher.Publisher.loadIg(Publisher.java:2106)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromJson(Publisher.java:1611)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1078)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:591)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5678)\nException in thread &quot;main&quot; java.lang.NullPointerException\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5688)\n</pre></div>",
        "id": 164993155,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1557157884
    },
    {
        "content": "<p>hmm</p>",
        "id": 164993312,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1557158021
    },
    {
        "content": "<p>you shouldn't need location - what happens if you don't have that?</p>",
        "id": 164993324,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1557158037
    },
    {
        "content": "<p>I should have fixed the actual error now, but you will have to blow your package cache since the error is in the cache material</p>",
        "id": 164994630,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1557158936
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>.  I've deleted my cache (both <code>$USER/.fhir</code> and <code>txCache</code> just to be sure), but still running into the same issue above.  I've also tried deleting the <code>location</code> from the config, but them I get the following stack trace:</p>\n<div class=\"codehilite\"><pre><span></span>exception generating new IG\njava.lang.NullPointerException\n    at org.hl7.fhir.utilities.cache.PackageCacheManager.getPackageId(PackageCacheManager.java:273)\n    at org.hl7.fhir.igtools.publisher.ConfigFileConverter.convert(ConfigFileConverter.java:205)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromJson(Publisher.java:1554)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1078)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:591)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:5678)\n</pre></div>",
        "id": 164995826,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1557159775
    },
    {
        "content": "<p>And to be clear, with the <code>location</code> back in the config, I'm getting the other stack trace (<code>java.io.IOException: Unable to find the file other/spec.internals in the package fhir.argonaut.r2</code>).</p>",
        "id": 164995902,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1557159837
    },
    {
        "content": "<p>In case it helps, I'll create a branch on <code>fhir-ig-publisher</code> and update the <code>ig10</code> test to demonstrate the problem.</p>",
        "id": 164996176,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1557160013
    },
    {
        "content": "<p>OK, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> -- I've forked the fhir-ig-publisher, created a branch w/ a new (failing) test case for depending on argo, and issued it as a PR (just to make it easy to find).  You can find the PR here: <a href=\"https://github.com/HL7/fhir-ig-publisher/pull/3\" target=\"_blank\" title=\"https://github.com/HL7/fhir-ig-publisher/pull/3\">https://github.com/HL7/fhir-ig-publisher/pull/3</a></p>",
        "id": 165005196,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1557166563
    }
]