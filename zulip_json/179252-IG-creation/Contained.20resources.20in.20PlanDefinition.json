[
    {
        "content": "<p>I'm wanting to contain a couple of ActivityDefinition resources in a PlanDefinition, but as the reference from the PlanDefinition.actiondefinition[x] is a canonical datatype rather than a Reference, the IG publisher is complaining. Example is <a href=\"http://build.fhir.org/ig/HL7NZ/cca/branches/master/PlanDefinition-coloRectal.html\">here</a></p>",
        "id": 205300275,
        "sender_full_name": "David Hay",
        "timestamp": 1595976732
    },
    {
        "content": "<p>are you referring to this? </p>\n<blockquote>\n<p>dom-3: If the resource is contained in another resource, it SHALL be referred to from elsewhere in the resource or SHALL refer to the containing resource ( (unmatched: ActTragacanth)) [contained.where(((('#' + id) in (%resource.descendants().reference | %resource.descendants().as(canonical) | %resource.descendants().as(uri) | %resource.descendants().as(url))) or descendants().where(reference = '#').exists() or descendants().where(as(canonical) = '#').exists() or descendants().where(as(canonical) = '#').exists()).not()).trace('unmatched', id).empty()]</p>\n</blockquote>",
        "id": 205304929,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1595980792
    },
    {
        "content": "<p>yep</p>",
        "id": 205310807,
        "sender_full_name": "David Hay",
        "timestamp": 1595987982
    },
    {
        "content": "<p>do you think it's wrong?</p>",
        "id": 205312509,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1595990009
    },
    {
        "content": "<p>Yes, it's wrong.  I don't think we can write an invariant that enforces our genuine rule, which is \"every contained resource must be connected via a reference path to the containing resource\".  That path could involve container pointing to containedA which points to containedB which is pointed to by containedC.  That would still meet our fundamental need - and there are situations where a direct connection between container and contained isn't appropriate.  But we can't write an invariant that would do that - anymore than we could write one that said that all message resources need to connect somehow to the MessageHeader.  We had to write that one in code (and it took a while to get it right).</p>",
        "id": 205313382,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1595991203
    },
    {
        "content": "<p>it doesn't prevent two contained resources from referring to each other but not referring to the container or vice versa, yes. but it's not clear to me how how it's wrong in regards to canonical resources</p>",
        "id": 205313896,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1595991756
    },
    {
        "content": "<p>Is it OK for a resource to have contained resources where the 'reference' from the parent to the contained is a canonical url - in this case  PlanDefinition.action.definitionCanonical? If it is OK, then it is being incorrectly marked as an error by the IG publisher. I can hide the error of course, but wanted to be sure I have the right behaviour...</p>",
        "id": 205660729,
        "sender_full_name": "David Hay",
        "timestamp": 1596250932
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 205661320,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1596252066
    },
    {
        "content": "<p>yes- see <a href=\"http://hl7.org/fhir/references.html#canonical-fragments\">http://hl7.org/fhir/references.html#canonical-fragments</a></p>",
        "id": 205745065,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596403973
    }
]