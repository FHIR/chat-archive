[
    {
        "content": "<p>Snapshots generated by the publisher can result in duplicate element entries when adding invariants. See <a href=\"https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-appointment.xml.html\" target=\"_blank\" title=\"https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-appointment.xml.html\">https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-appointment.xml.html</a> and search for  \"&lt;element id=\"Appointment.extension:legalBasis.value[x]:valueCodeableConcept\"&gt;\" <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 185310145,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578663494
    },
    {
        "content": "<p>this ends up in     an sdf-16: All element definitions must have unique ids (snapshot ...</p>",
        "id": 185317458,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578668650
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> would you agree? The case is that I've added an invariant on an extension on the sdf. Let me know if you need the source of the IG</p>",
        "id": 185433203,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578833291
    },
    {
        "content": "<p>it shouldn't happen. can I add it as a snapshot generation test?</p>",
        "id": 185450668,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578864103
    },
    {
        "content": "<p>I think so - I'll  send you the raw material</p>",
        "id": 185451169,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578864990
    },
    {
        "content": "<p>yes I'll need the extension definition as well</p>",
        "id": 185451418,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578865444
    },
    {
        "content": "<p>I would imagine, yes</p>",
        "id": 185451419,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578865459
    },
    {
        "content": "<p>you've got mail -</p>",
        "id": 185452086,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578866690
    },
    {
        "content": "<p>so the extension/profile is bizarre. The extension assigns a value set to Extension.valueCodeableConcept.coding. Then, when you use it,  you assign the same value set to Extension.valueCodeableConcept. I think that must be an error, and I don't think that you mean that. Still, I do think that the validator should get this right</p>",
        "id": 185488957,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578919467
    },
    {
        "content": "<p>hmmm .... that makes sense. Now I'm however getting another error with the latest build of the IG:</p>\n<div class=\"codehilite\"><pre><span></span>validate res: ConceptMap/oio-bpp-roles-to-careteam-participant-roles             (00:14.0701)\nvalidate res: StructureDefinition/ehealth-activitydefinition                     (00:14.0705)\nPublishing Content Failed: Problem processing expression (%resource.kind = #39;.logical#39;. or element.first().path = %resource.type) and element.tail().all(path.startsWith(%resource.snapshot.element.first().path&amp;&#39;.&#39;)) in profile http://hl7.org/fhir/StructureDefinition/StructureDefinition path StructureDefinition.snapshot: Error in ?? at 1, 3: Found # expecting a token name (00:14.0719)\n                                                                                 (00:14.0719)\nUse -? to get command line help                                                  (00:14.0719)\n                                                                                 (00:14.0720)\nStack Dump (for debugging):                                                      (00:14.0720)\norg.hl7.fhir.exceptions.FHIRException: Problem processing expression (%resource.kind = #39;.logical#39;. or element.first().path = %resource.type) and element.tail().all(path.startsWith(%resource.snapshot.element.first().path&amp;&#39;.&#39;)) in profile http://hl7.org/fhir/StructureDefinition/StructureDefinition path StructureDefinition.snapshot: Error in ?? at 1, 3: Found # expecting a token name\n        at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariant(InstanceValidator.java:4930)\n        at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariants(InstanceValidator.java:4915)\n        at org.hl7.fhir.r5.validation.InstanceValidator.checkInvariants(InstanceValidator.java:4806)\n        at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:4464)\n        at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:4376)\n        at org.hl7.fhir.r5.validation.InstanceValidator.start(InstanceValidator.java:3287)\n        at org.hl7.fhir.r5.validation.InstanceValidator.validateResource(InstanceValidator.java:5047)\n        at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:851)\n        at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:811)\n        at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:4046)\n        at org.hl7.fhir.igtools.publisher.Publisher.validate(Publisher.java:3259)\n        at org.hl7.fhir.igtools.publisher.Publisher.loadConformance(Publisher.java:3240)\n        at org.hl7.fhir.igtools.publisher.Publisher.createIg(Publisher.java:774)\n        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:661)\n        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:6705)\n</pre></div>",
        "id": 185491592,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578921477
    },
    {
        "content": "<p>Latest being <code>FHIR IG Publisher Version 1.0.38-SNAPSHOT (Git# beda1a6eb614). Built 2020-01-11T07:15:31.737+11:00 (65 hours old)</code></p>",
        "id": 185491681,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578921538
    },
    {
        "content": "<p>It seems unrelated to the specific sdf (\"ehealth-activitydefinition\")</p>",
        "id": 185491892,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578921720
    },
    {
        "content": "<p>what version of FHIR is the IG based on?</p>",
        "id": 185529894,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578944794
    },
    {
        "content": "<p>\"version\": \"3.0.2\",</p>",
        "id": 185531072,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578945477
    },
    {
        "content": "<p>from the ig.json</p>",
        "id": 185531121,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578945487
    },
    {
        "content": "<p>hmm. this isn't a generic issue with 3.0.2 guides - i just tested - so I'll have to build yours specifically. can you send me an updated one with this issue?</p>",
        "id": 185532017,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578946043
    },
    {
        "content": "<p>on its way ...</p>",
        "id": 185534706,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578947806
    },
    {
        "content": "<p>that builds fine for me. can you clear your package cache and try again?</p>",
        "id": 185537438,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578949546
    },
    {
        "content": "<p>cant remember the location - where would that be?</p>",
        "id": 185537699,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578949693
    },
    {
        "content": "<p>it's stated in one of the first few lines of the IG Publisher output</p>",
        "id": 185537827,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578949798
    },
    {
        "content": "<p>worked like a charm :D - thx</p>",
        "id": 185538269,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578950016
    },
    {
        "content": "<p>great</p>",
        "id": 185538283,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578950027
    },
    {
        "content": "<p>thought I had already done that ...</p>",
        "id": 185538286,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578950030
    },
    {
        "content": "<p>hmm. well, you won't have to do it again - there's no making changes to past packages anymore</p>",
        "id": 185538379,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578950081
    },
    {
        "content": "<p>famous last words ;)</p>",
        "id": 185538412,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1578950108
    },
    {
        "content": "<p>Hmmmm <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  - I've found that if I put the valueset binding on the extension then the invariant is not inspected during validation. If I move the valueset binding back to the Appointment profile and do the binding there, then the invariant gets inspected</p>",
        "id": 185686945,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1579085464
    },
    {
        "content": "<p>Is this out of context? the value set binding on what extension?</p>",
        "id": 185690435,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579089129
    },
    {
        "content": "<blockquote>\n<p>so the extension/profile is bizarre. The extension assigns a value set to Extension.valueCodeableConcept.coding. Then, when you use it,  you assign the same value set to Extension.valueCodeableConcept. I think that must be an error, and I don't think that you mean that. Still, I do think that the validator should get this right</p>\n</blockquote>",
        "id": 185695295,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1579093607
    },
    {
        "content": "<blockquote>\n<p>Is this out of context? the value set binding on what extension?</p>\n</blockquote>\n<p><a href=\"https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-legalBasis.html\" target=\"_blank\" title=\"https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-legalBasis.html\">https://docs.ehealth.sundhed.dk/latest/ig/StructureDefinition-ehealth-legalBasis.html</a></p>",
        "id": 185705106,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1579100278
    }
]